(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(o){if(o.ep)return;o.ep=!0;const u=i(o);fetch(o.href,u)}})();var CA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function T0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function NA(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var i=function a(){var o=!1;try{o=this instanceof a}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(a){var o=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(i,a,o.get?o:{enumerable:!0,get:function(){return n[a]}})}),i}var Ef={exports:{}},No={};var Mv;function QS(){if(Mv)return No;Mv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(a,o,u){var d=null;if(u!==void 0&&(d=""+u),o.key!==void 0&&(d=""+o.key),"key"in o){u={};for(var f in o)f!=="key"&&(u[f]=o[f])}else u=o;return o=u.ref,{$$typeof:n,type:a,key:d,ref:o!==void 0?o:null,props:u}}return No.Fragment=t,No.jsx=i,No.jsxs=i,No}var Lv;function JS(){return Lv||(Lv=1,Ef.exports=QS()),Ef.exports}var r=JS(),kf={exports:{}},Bt={};var zv;function XS(){if(zv)return Bt;zv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function w(A){return A===null||typeof A!="object"?null:(A=x&&A[x]||A["@@iterator"],typeof A=="function"?A:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,S={};function N(A,O,K){this.props=A,this.context=O,this.refs=S,this.updater=K||_}N.prototype.isReactComponent={},N.prototype.setState=function(A,O){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,O,"setState")},N.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function T(){}T.prototype=N.prototype;function L(A,O,K){this.props=A,this.context=O,this.refs=S,this.updater=K||_}var R=L.prototype=new T;R.constructor=L,C(R,N.prototype),R.isPureReactComponent=!0;var J=Array.isArray;function H(){}var V={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function M(A,O,K){var de=K.ref;return{$$typeof:n,type:A,key:O,ref:de!==void 0?de:null,props:K}}function z(A,O){return M(A.type,O,A.props)}function U(A){return typeof A=="object"&&A!==null&&A.$$typeof===n}function F(A){var O={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(K){return O[K]})}var Y=/\/+/g;function $(A,O){return typeof A=="object"&&A!==null&&A.key!=null?F(""+A.key):O.toString(36)}function P(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(H,H):(A.status="pending",A.then(function(O){A.status==="pending"&&(A.status="fulfilled",A.value=O)},function(O){A.status==="pending"&&(A.status="rejected",A.reason=O)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function E(A,O,K,de,pe){var ve=typeof A;(ve==="undefined"||ve==="boolean")&&(A=null);var te=!1;if(A===null)te=!0;else switch(ve){case"bigint":case"string":case"number":te=!0;break;case"object":switch(A.$$typeof){case n:case t:te=!0;break;case y:return te=A._init,E(te(A._payload),O,K,de,pe)}}if(te)return pe=pe(A),te=de===""?"."+$(A,0):de,J(pe)?(K="",te!=null&&(K=te.replace(Y,"$&/")+"/"),E(pe,O,K,"",function(ke){return ke})):pe!=null&&(U(pe)&&(pe=z(pe,K+(pe.key==null||A&&A.key===pe.key?"":(""+pe.key).replace(Y,"$&/")+"/")+te)),O.push(pe)),1;te=0;var W=de===""?".":de+":";if(J(A))for(var me=0;me<A.length;me++)de=A[me],ve=W+$(de,me),te+=E(de,O,K,ve,pe);else if(me=w(A),typeof me=="function")for(A=me.call(A),me=0;!(de=A.next()).done;)de=de.value,ve=W+$(de,me++),te+=E(de,O,K,ve,pe);else if(ve==="object"){if(typeof A.then=="function")return E(P(A),O,K,de,pe);throw O=String(A),Error("Objects are not valid as a React child (found: "+(O==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":O)+"). If you meant to render a collection of children, use an array instead.")}return te}function B(A,O,K){if(A==null)return A;var de=[],pe=0;return E(A,de,"","",function(ve){return O.call(K,ve,pe++)}),de}function q(A){if(A._status===-1){var O=A._result;O=O(),O.then(function(K){(A._status===0||A._status===-1)&&(A._status=1,A._result=K)},function(K){(A._status===0||A._status===-1)&&(A._status=2,A._result=K)}),A._status===-1&&(A._status=0,A._result=O)}if(A._status===1)return A._result.default;throw A._result}var Q=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var O=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(O))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)},G={map:B,forEach:function(A,O,K){B(A,function(){O.apply(this,arguments)},K)},count:function(A){var O=0;return B(A,function(){O++}),O},toArray:function(A){return B(A,function(O){return O})||[]},only:function(A){if(!U(A))throw Error("React.Children.only expected to receive a single React element child.");return A}};return Bt.Activity=v,Bt.Children=G,Bt.Component=N,Bt.Fragment=i,Bt.Profiler=o,Bt.PureComponent=L,Bt.StrictMode=a,Bt.Suspense=h,Bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=V,Bt.__COMPILER_RUNTIME={__proto__:null,c:function(A){return V.H.useMemoCache(A)}},Bt.cache=function(A){return function(){return A.apply(null,arguments)}},Bt.cacheSignal=function(){return null},Bt.cloneElement=function(A,O,K){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var de=C({},A.props),pe=A.key;if(O!=null)for(ve in O.key!==void 0&&(pe=""+O.key),O)!k.call(O,ve)||ve==="key"||ve==="__self"||ve==="__source"||ve==="ref"&&O.ref===void 0||(de[ve]=O[ve]);var ve=arguments.length-2;if(ve===1)de.children=K;else if(1<ve){for(var te=Array(ve),W=0;W<ve;W++)te[W]=arguments[W+2];de.children=te}return M(A.type,pe,de)},Bt.createContext=function(A){return A={$$typeof:d,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:u,_context:A},A},Bt.createElement=function(A,O,K){var de,pe={},ve=null;if(O!=null)for(de in O.key!==void 0&&(ve=""+O.key),O)k.call(O,de)&&de!=="key"&&de!=="__self"&&de!=="__source"&&(pe[de]=O[de]);var te=arguments.length-2;if(te===1)pe.children=K;else if(1<te){for(var W=Array(te),me=0;me<te;me++)W[me]=arguments[me+2];pe.children=W}if(A&&A.defaultProps)for(de in te=A.defaultProps,te)pe[de]===void 0&&(pe[de]=te[de]);return M(A,ve,pe)},Bt.createRef=function(){return{current:null}},Bt.forwardRef=function(A){return{$$typeof:f,render:A}},Bt.isValidElement=U,Bt.lazy=function(A){return{$$typeof:y,_payload:{_status:-1,_result:A},_init:q}},Bt.memo=function(A,O){return{$$typeof:p,type:A,compare:O===void 0?null:O}},Bt.startTransition=function(A){var O=V.T,K={};V.T=K;try{var de=A(),pe=V.S;pe!==null&&pe(K,de),typeof de=="object"&&de!==null&&typeof de.then=="function"&&de.then(H,Q)}catch(ve){Q(ve)}finally{O!==null&&K.types!==null&&(O.types=K.types),V.T=O}},Bt.unstable_useCacheRefresh=function(){return V.H.useCacheRefresh()},Bt.use=function(A){return V.H.use(A)},Bt.useActionState=function(A,O,K){return V.H.useActionState(A,O,K)},Bt.useCallback=function(A,O){return V.H.useCallback(A,O)},Bt.useContext=function(A){return V.H.useContext(A)},Bt.useDebugValue=function(){},Bt.useDeferredValue=function(A,O){return V.H.useDeferredValue(A,O)},Bt.useEffect=function(A,O){return V.H.useEffect(A,O)},Bt.useEffectEvent=function(A){return V.H.useEffectEvent(A)},Bt.useId=function(){return V.H.useId()},Bt.useImperativeHandle=function(A,O,K){return V.H.useImperativeHandle(A,O,K)},Bt.useInsertionEffect=function(A,O){return V.H.useInsertionEffect(A,O)},Bt.useLayoutEffect=function(A,O){return V.H.useLayoutEffect(A,O)},Bt.useMemo=function(A,O){return V.H.useMemo(A,O)},Bt.useOptimistic=function(A,O){return V.H.useOptimistic(A,O)},Bt.useReducer=function(A,O,K){return V.H.useReducer(A,O,K)},Bt.useRef=function(A){return V.H.useRef(A)},Bt.useState=function(A){return V.H.useState(A)},Bt.useSyncExternalStore=function(A,O,K){return V.H.useSyncExternalStore(A,O,K)},Bt.useTransition=function(){return V.H.useTransition()},Bt.version="19.2.3",Bt}var Uv;function sc(){return Uv||(Uv=1,kf.exports=XS()),kf.exports}var b=sc();const _e=T0(b);var Tf={exports:{}},Eo={},Af={exports:{}},Rf={};var Iv;function ZS(){return Iv||(Iv=1,(function(n){function t(E,B){var q=E.length;E.push(B);e:for(;0<q;){var Q=q-1>>>1,G=E[Q];if(0<o(G,B))E[Q]=B,E[q]=G,q=Q;else break e}}function i(E){return E.length===0?null:E[0]}function a(E){if(E.length===0)return null;var B=E[0],q=E.pop();if(q!==B){E[0]=q;e:for(var Q=0,G=E.length,A=G>>>1;Q<A;){var O=2*(Q+1)-1,K=E[O],de=O+1,pe=E[de];if(0>o(K,q))de<G&&0>o(pe,K)?(E[Q]=pe,E[de]=q,Q=de):(E[Q]=K,E[O]=q,Q=O);else if(de<G&&0>o(pe,q))E[Q]=pe,E[de]=q,Q=de;else break e}}return B}function o(E,B){var q=E.sortIndex-B.sortIndex;return q!==0?q:E.id-B.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,f=d.now();n.unstable_now=function(){return d.now()-f}}var h=[],p=[],y=1,v=null,x=3,w=!1,_=!1,C=!1,S=!1,N=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function R(E){for(var B=i(p);B!==null;){if(B.callback===null)a(p);else if(B.startTime<=E)a(p),B.sortIndex=B.expirationTime,t(h,B);else break;B=i(p)}}function J(E){if(C=!1,R(E),!_)if(i(h)!==null)_=!0,H||(H=!0,F());else{var B=i(p);B!==null&&P(J,B.startTime-E)}}var H=!1,V=-1,k=5,M=-1;function z(){return S?!0:!(n.unstable_now()-M<k)}function U(){if(S=!1,H){var E=n.unstable_now();M=E;var B=!0;try{e:{_=!1,C&&(C=!1,T(V),V=-1),w=!0;var q=x;try{t:{for(R(E),v=i(h);v!==null&&!(v.expirationTime>E&&z());){var Q=v.callback;if(typeof Q=="function"){v.callback=null,x=v.priorityLevel;var G=Q(v.expirationTime<=E);if(E=n.unstable_now(),typeof G=="function"){v.callback=G,R(E),B=!0;break t}v===i(h)&&a(h),R(E)}else a(h);v=i(h)}if(v!==null)B=!0;else{var A=i(p);A!==null&&P(J,A.startTime-E),B=!1}}break e}finally{v=null,x=q,w=!1}B=void 0}}finally{B?F():H=!1}}}var F;if(typeof L=="function")F=function(){L(U)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,$=Y.port2;Y.port1.onmessage=U,F=function(){$.postMessage(null)}}else F=function(){N(U,0)};function P(E,B){V=N(function(){E(n.unstable_now())},B)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(E){E.callback=null},n.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<E?Math.floor(1e3/E):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(E){switch(x){case 1:case 2:case 3:var B=3;break;default:B=x}var q=x;x=B;try{return E()}finally{x=q}},n.unstable_requestPaint=function(){S=!0},n.unstable_runWithPriority=function(E,B){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var q=x;x=E;try{return B()}finally{x=q}},n.unstable_scheduleCallback=function(E,B,q){var Q=n.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?Q+q:Q):q=Q,E){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=q+G,E={id:y++,callback:B,priorityLevel:E,startTime:q,expirationTime:G,sortIndex:-1},q>Q?(E.sortIndex=q,t(p,E),i(h)===null&&E===i(p)&&(C?(T(V),V=-1):C=!0,P(J,q-Q))):(E.sortIndex=G,t(h,E),_||w||(_=!0,H||(H=!0,F()))),E},n.unstable_shouldYield=z,n.unstable_wrapCallback=function(E){var B=x;return function(){var q=x;x=B;try{return E.apply(this,arguments)}finally{x=q}}}})(Rf)),Rf}var Bv;function ej(){return Bv||(Bv=1,Af.exports=ZS()),Af.exports}var Of={exports:{}},dr={};var $v;function tj(){if($v)return dr;$v=1;var n=sc();function t(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(h,p,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:h,containerInfo:p,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return dr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,dr.createPortal=function(h,p){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return u(h,p,null,y)},dr.flushSync=function(h){var p=d.T,y=a.p;try{if(d.T=null,a.p=2,h)return h()}finally{d.T=p,a.p=y,a.d.f()}},dr.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,a.d.C(h,p))},dr.prefetchDNS=function(h){typeof h=="string"&&a.d.D(h)},dr.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var y=p.as,v=f(y,p.crossOrigin),x=typeof p.integrity=="string"?p.integrity:void 0,w=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;y==="style"?a.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:w}):y==="script"&&a.d.X(h,{crossOrigin:v,integrity:x,fetchPriority:w,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},dr.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var y=f(p.as,p.crossOrigin);a.d.M(h,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&a.d.M(h)},dr.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var y=p.as,v=f(y,p.crossOrigin);a.d.L(h,y,{crossOrigin:v,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},dr.preloadModule=function(h,p){if(typeof h=="string")if(p){var y=f(p.as,p.crossOrigin);a.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else a.d.m(h)},dr.requestFormReset=function(h){a.d.r(h)},dr.unstable_batchedUpdates=function(h,p){return h(p)},dr.useFormState=function(h,p,y){return d.H.useFormState(h,p,y)},dr.useFormStatus=function(){return d.H.useHostTransitionStatus()},dr.version="19.2.3",dr}var Pv;function A0(){if(Pv)return Of.exports;Pv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Of.exports=tj(),Of.exports}var qv;function nj(){if(qv)return Eo;qv=1;var n=ej(),t=sc(),i=A0();function a(e){var s="https://react.dev/errors/"+e;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+e+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var s=e,l=e;if(e.alternate)for(;s.return;)s=s.return;else{e=s;do s=e,(s.flags&4098)!==0&&(l=s.return),e=s.return;while(e)}return s.tag===3?l:null}function d(e){if(e.tag===13){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function f(e){if(e.tag===31){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(a(188))}function p(e){var s=e.alternate;if(!s){if(s=u(e),s===null)throw Error(a(188));return s!==e?null:e}for(var l=e,c=s;;){var m=l.return;if(m===null)break;var g=m.alternate;if(g===null){if(c=m.return,c!==null){l=c;continue}break}if(m.child===g.child){for(g=m.child;g;){if(g===l)return h(m),e;if(g===c)return h(m),s;g=g.sibling}throw Error(a(188))}if(l.return!==c.return)l=m,c=g;else{for(var j=!1,D=m.child;D;){if(D===l){j=!0,l=m,c=g;break}if(D===c){j=!0,c=m,l=g;break}D=D.sibling}if(!j){for(D=g.child;D;){if(D===l){j=!0,l=g,c=m;break}if(D===c){j=!0,c=g,l=m;break}D=D.sibling}if(!j)throw Error(a(189))}}if(l.alternate!==c)throw Error(a(190))}if(l.tag!==3)throw Error(a(188));return l.stateNode.current===l?e:s}function y(e){var s=e.tag;if(s===5||s===26||s===27||s===6)return e;for(e=e.child;e!==null;){if(s=y(e),s!==null)return s;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),L=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),V=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function F(e){return e===null||typeof e!="object"?null:(e=U&&e[U]||e["@@iterator"],typeof e=="function"?e:null)}var Y=Symbol.for("react.client.reference");function $(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Y?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case C:return"Fragment";case N:return"Profiler";case S:return"StrictMode";case J:return"Suspense";case H:return"SuspenseList";case M:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case L:return e.displayName||"Context";case T:return(e._context.displayName||"Context")+".Consumer";case R:var s=e.render;return e=e.displayName,e||(e=s.displayName||s.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case V:return s=e.displayName||null,s!==null?s:$(e.type)||"Memo";case k:s=e._payload,e=e._init;try{return $(e(s))}catch{}}return null}var P=Array.isArray,E=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q={pending:!1,data:null,method:null,action:null},Q=[],G=-1;function A(e){return{current:e}}function O(e){0>G||(e.current=Q[G],Q[G]=null,G--)}function K(e,s){G++,Q[G]=e.current,e.current=s}var de=A(null),pe=A(null),ve=A(null),te=A(null);function W(e,s){switch(K(ve,s),K(pe,e),K(de,null),s.nodeType){case 9:case 11:e=(e=s.documentElement)&&(e=e.namespaceURI)?rv(e):0;break;default:if(e=s.tagName,s=s.namespaceURI)s=rv(s),e=sv(s,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}O(de),K(de,e)}function me(){O(de),O(pe),O(ve)}function ke(e){e.memoizedState!==null&&K(te,e);var s=de.current,l=sv(s,e.type);s!==l&&(K(pe,e),K(de,l))}function ie(e){pe.current===e&&(O(de),O(pe)),te.current===e&&(O(te),So._currentValue=q)}var je,Re;function Oe(e){if(je===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);je=s&&s[1]||"",Re=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+je+e+Re}var qe=!1;function et(e,s){if(!e||qe)return"";qe=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(s){var Le=function(){throw Error()};if(Object.defineProperty(Le.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Le,[])}catch(Ce){var be=Ce}Reflect.construct(e,[],Le)}else{try{Le.call()}catch(Ce){be=Ce}e.call(Le.prototype)}}else{try{throw Error()}catch(Ce){be=Ce}(Le=e())&&typeof Le.catch=="function"&&Le.catch(function(){})}}catch(Ce){if(Ce&&be&&typeof Ce.stack=="string")return[Ce.stack,be.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),j=g[0],D=g[1];if(j&&D){var X=j.split(`
`),ye=D.split(`
`);for(m=c=0;c<X.length&&!X[c].includes("DetermineComponentFrameRoot");)c++;for(;m<ye.length&&!ye[m].includes("DetermineComponentFrameRoot");)m++;if(c===X.length||m===ye.length)for(c=X.length-1,m=ye.length-1;1<=c&&0<=m&&X[c]!==ye[m];)m--;for(;1<=c&&0<=m;c--,m--)if(X[c]!==ye[m]){if(c!==1||m!==1)do if(c--,m--,0>m||X[c]!==ye[m]){var Ae=`
`+X[c].replace(" at new "," at ");return e.displayName&&Ae.includes("<anonymous>")&&(Ae=Ae.replace("<anonymous>",e.displayName)),Ae}while(1<=c&&0<=m);break}}}finally{qe=!1,Error.prepareStackTrace=l}return(l=e?e.displayName||e.name:"")?Oe(l):""}function at(e,s){switch(e.tag){case 26:case 27:case 5:return Oe(e.type);case 16:return Oe("Lazy");case 13:return e.child!==s&&s!==null?Oe("Suspense Fallback"):Oe("Suspense");case 19:return Oe("SuspenseList");case 0:case 15:return et(e.type,!1);case 11:return et(e.type.render,!1);case 1:return et(e.type,!0);case 31:return Oe("Activity");default:return""}}function lt(e){try{var s="",l=null;do s+=at(e,l),l=e,e=e.return;while(e);return s}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var pt=Object.prototype.hasOwnProperty,we=n.unstable_scheduleCallback,ae=n.unstable_cancelCallback,Ge=n.unstable_shouldYield,Ne=n.unstable_requestPaint,dt=n.unstable_now,rt=n.unstable_getCurrentPriorityLevel,Ve=n.unstable_ImmediatePriority,ot=n.unstable_UserBlockingPriority,tt=n.unstable_NormalPriority,St=n.unstable_LowPriority,gn=n.unstable_IdlePriority,Ct=n.log,zt=n.unstable_setDisableYieldValue,Ft=null,rn=null;function ln(e){if(typeof Ct=="function"&&zt(e),rn&&typeof rn.setStrictMode=="function")try{rn.setStrictMode(Ft,e)}catch{}}var sn=Math.clz32?Math.clz32:ee,zn=Math.log,Xt=Math.LN2;function ee(e){return e>>>=0,e===0?32:31-(zn(e)/Xt|0)|0}var De=256,Te=262144,Ie=4194304;function Fe(e){var s=e&42;if(s!==0)return s;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function it(e,s,l){var c=e.pendingLanes;if(c===0)return 0;var m=0,g=e.suspendedLanes,j=e.pingedLanes;e=e.warmLanes;var D=c&134217727;return D!==0?(c=D&~g,c!==0?m=Fe(c):(j&=D,j!==0?m=Fe(j):l||(l=D&~e,l!==0&&(m=Fe(l))))):(D=c&~g,D!==0?m=Fe(D):j!==0?m=Fe(j):l||(l=c&~e,l!==0&&(m=Fe(l)))),m===0?0:s!==0&&s!==m&&(s&g)===0&&(g=m&-m,l=s&-s,g>=l||g===32&&(l&4194048)!==0)?s:m}function wt(e,s){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&s)===0}function Pt(e,s){switch(e){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vt(){var e=Ie;return Ie<<=1,(Ie&62914560)===0&&(Ie=4194304),e}function on(e){for(var s=[],l=0;31>l;l++)s.push(e);return s}function he(e,s){e.pendingLanes|=s,s!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ke(e,s,l,c,m,g){var j=e.pendingLanes;e.pendingLanes=l,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=l,e.entangledLanes&=l,e.errorRecoveryDisabledLanes&=l,e.shellSuspendCounter=0;var D=e.entanglements,X=e.expirationTimes,ye=e.hiddenUpdates;for(l=j&~l;0<l;){var Ae=31-sn(l),Le=1<<Ae;D[Ae]=0,X[Ae]=-1;var be=ye[Ae];if(be!==null)for(ye[Ae]=null,Ae=0;Ae<be.length;Ae++){var Ce=be[Ae];Ce!==null&&(Ce.lane&=-536870913)}l&=~Le}c!==0&&mt(e,c,0),g!==0&&m===0&&e.tag!==0&&(e.suspendedLanes|=g&~(j&~s))}function mt(e,s,l){e.pendingLanes|=s,e.suspendedLanes&=~s;var c=31-sn(s);e.entangledLanes|=s,e.entanglements[c]=e.entanglements[c]|1073741824|l&261930}function ct(e,s){var l=e.entangledLanes|=s;for(e=e.entanglements;l;){var c=31-sn(l),m=1<<c;m&s|e[c]&s&&(e[c]|=s),l&=~m}}function Lt(e,s){var l=s&-s;return l=(l&42)!==0?1:ut(l),(l&(e.suspendedLanes|s))!==0?0:l}function ut(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Mt(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function tn(){var e=B.p;return e!==0?e:(e=window.event,e===void 0?32:Ev(e.type))}function ht(e,s){var l=B.p;try{return B.p=e,s()}finally{B.p=l}}var le=Math.random().toString(36).slice(2),$e="__reactFiber$"+le,ze="__reactProps$"+le,At="__reactContainer$"+le,Tt="__reactEvents$"+le,Et="__reactListeners$"+le,oe="__reactHandles$"+le,ne="__reactResources$"+le,ue="__reactMarker$"+le;function xe(e){delete e[$e],delete e[ze],delete e[Tt],delete e[Et],delete e[oe]}function Pe(e){var s=e[$e];if(s)return s;for(var l=e.parentNode;l;){if(s=l[At]||l[$e]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(e=dv(e);e!==null;){if(l=e[$e])return l;e=dv(e)}return s}e=l,l=e.parentNode}return null}function Je(e){if(e=e[$e]||e[At]){var s=e.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return e}return null}function Xe(e){var s=e.tag;if(s===5||s===26||s===27||s===6)return e.stateNode;throw Error(a(33))}function Ye(e){var s=e[ne];return s||(s=e[ne]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function jt(e){e[ue]=!0}var an=new Set,nn={};function We(e,s){_t(e,s),_t(e+"Capture",s)}function _t(e,s){for(nn[e]=s,e=0;e<s.length;e++)an.add(s[e])}var fn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qn={},Jn={};function mr(e){return pt.call(Jn,e)?!0:pt.call(Qn,e)?!1:fn.test(e)?Jn[e]=!0:(Qn[e]=!0,!1)}function Jr(e,s,l){if(mr(s))if(l===null)e.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":e.removeAttribute(s);return;case"boolean":var c=s.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(s);return}}e.setAttribute(s,""+l)}}function Mr(e,s,l){if(l===null)e.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttribute(s,""+l)}}function Xr(e,s,l,c){if(c===null)e.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(l);return}e.setAttributeNS(s,l,""+c)}}function ur(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ii(e){var s=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function wa(e,s,l){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,s);if(!e.hasOwnProperty(s)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var m=c.get,g=c.set;return Object.defineProperty(e,s,{configurable:!0,get:function(){return m.call(this)},set:function(j){l=""+j,g.call(this,j)}}),Object.defineProperty(e,s,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(j){l=""+j},stopTracking:function(){e._valueTracker=null,delete e[s]}}}}function Sa(e){if(!e._valueTracker){var s=Ii(e)?"checked":"value";e._valueTracker=wa(e,s,""+e[s])}}function mc(e){if(!e)return!1;var s=e._valueTracker;if(!s)return!0;var l=s.getValue(),c="";return e&&(c=Ii(e)?e.checked?"true":"false":e.value),e=c,e!==l?(s.setValue(e),!0):!1}function ja(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Td=/[\n"\\]/g;function gr(e){return e.replace(Td,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Bi(e,s,l,c,m,g,j,D){e.name="",j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?e.type=j:e.removeAttribute("type"),s!=null?j==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+ur(s)):e.value!==""+ur(s)&&(e.value=""+ur(s)):j!=="submit"&&j!=="reset"||e.removeAttribute("value"),s!=null?Dl(e,j,ur(s)):l!=null?Dl(e,j,ur(l)):c!=null&&e.removeAttribute("value"),m==null&&g!=null&&(e.defaultChecked=!!g),m!=null&&(e.checked=m&&typeof m!="function"&&typeof m!="symbol"),D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?e.name=""+ur(D):e.removeAttribute("name")}function gc(e,s,l,c,m,g,j,D){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),s!=null||l!=null){if(!(g!=="submit"&&g!=="reset"||s!=null)){Sa(e);return}l=l!=null?""+ur(l):"",s=s!=null?""+ur(s):l,D||s===e.value||(e.value=s),e.defaultValue=s}c=c??m,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=D?e.checked:!!c,e.defaultChecked=!!c,j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(e.name=j),Sa(e)}function Dl(e,s,l){s==="number"&&ja(e.ownerDocument)===e||e.defaultValue===""+l||(e.defaultValue=""+l)}function Lr(e,s,l,c){if(e=e.options,s){s={};for(var m=0;m<l.length;m++)s["$"+l[m]]=!0;for(l=0;l<e.length;l++)m=s.hasOwnProperty("$"+e[l].value),e[l].selected!==m&&(e[l].selected=m),m&&c&&(e[l].defaultSelected=!0)}else{for(l=""+ur(l),s=null,m=0;m<e.length;m++){if(e[m].value===l){e[m].selected=!0,c&&(e[m].defaultSelected=!0);return}s!==null||e[m].disabled||(s=e[m])}s!==null&&(s.selected=!0)}}function yc(e,s,l){if(s!=null&&(s=""+ur(s),s!==e.value&&(e.value=s),l==null)){e.defaultValue!==s&&(e.defaultValue=s);return}e.defaultValue=l!=null?""+ur(l):""}function vc(e,s,l,c){if(s==null){if(c!=null){if(l!=null)throw Error(a(92));if(P(c)){if(1<c.length)throw Error(a(93));c=c[0]}l=c}l==null&&(l=""),s=l}l=ur(s),e.defaultValue=l,c=e.textContent,c===l&&c!==""&&c!==null&&(e.value=c),Sa(e)}function Js(e,s){if(s){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=s;return}}e.textContent=s}var Ad=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ml(e,s,l){var c=s.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="":c?e.setProperty(s,l):typeof l!="number"||l===0||Ad.has(s)?s==="float"?e.cssFloat=l:e[s]=(""+l).trim():e[s]=l+"px"}function Ll(e,s,l){if(s!=null&&typeof s!="object")throw Error(a(62));if(e=e.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||s!=null&&s.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var m in s)c=s[m],s.hasOwnProperty(m)&&l[m]!==c&&Ml(e,m,c)}else for(var g in s)s.hasOwnProperty(g)&&Ml(e,g,s[g])}function zl(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function _a(e){return xc.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function zr(){}var Ul=null;function Il(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Xs=null,Zs=null;function Bl(e){var s=Je(e);if(s&&(e=s.stateNode)){var l=e[ze]||null;e:switch(e=s.stateNode,s.type){case"input":if(Bi(e,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),s=l.name,l.type==="radio"&&s!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+gr(""+s)+'"][type="radio"]'),s=0;s<l.length;s++){var c=l[s];if(c!==e&&c.form===e.form){var m=c[ze]||null;if(!m)throw Error(a(90));Bi(c,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(s=0;s<l.length;s++)c=l[s],c.form===e.form&&mc(c)}break e;case"textarea":yc(e,l.value,l.defaultValue);break e;case"select":s=l.value,s!=null&&Lr(e,!!l.multiple,s,!1)}}}var $l=!1;function $i(e,s,l){if($l)return e(s,l);$l=!0;try{var c=e(s);return c}finally{if($l=!1,(Xs!==null||Zs!==null)&&(tu(),Xs&&(s=Xs,e=Zs,Zs=Xs=null,Bl(s),e)))for(s=0;s<e.length;s++)Bl(e[s])}}function ei(e,s){var l=e.stateNode;if(l===null)return null;var c=l[ze]||null;if(c===null)return null;l=c[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(a(231,s,typeof l));return l}var Zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),I=!1;if(Zr)try{var Z={};Object.defineProperty(Z,"passive",{get:function(){I=!0}}),window.addEventListener("test",Z,Z),window.removeEventListener("test",Z,Z)}catch{I=!1}var re=null,Se=null,Ue=null;function Be(){if(Ue)return Ue;var e,s=Se,l=s.length,c,m="value"in re?re.value:re.textContent,g=m.length;for(e=0;e<l&&s[e]===m[e];e++);var j=l-e;for(c=1;c<=j&&s[l-c]===m[g-c];c++);return Ue=m.slice(e,1<c?1-c:void 0)}function He(e){var s=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&s===13&&(e=13)):e=s,e===10&&(e=13),32<=e||e===13?e:0}function Qe(){return!0}function Ze(){return!1}function st(e){function s(l,c,m,g,j){this._reactName=l,this._targetInst=m,this.type=c,this.nativeEvent=g,this.target=j,this.currentTarget=null;for(var D in e)e.hasOwnProperty(D)&&(l=e[D],this[D]=l?l(g):g[D]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?Qe:Ze,this.isPropagationStopped=Ze,this}return v(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Qe)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Qe)},persist:function(){},isPersistent:Qe}),s}var gt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xt=st(gt),nt=v({},gt,{view:0,detail:0}),It=st(nt),En,kn,Ur,es=v({},nt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ni,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ur&&(Ur&&e.type==="mousemove"?(En=e.screenX-Ur.screenX,kn=e.screenY-Ur.screenY):kn=En=0,Ur=e),En)},movementY:function(e){return"movementY"in e?e.movementY:kn}}),vt=st(es),kt=v({},es,{dataTransfer:0}),Ut=st(kt),jn=v({},nt,{relatedTarget:0}),An=st(jn),Bn=v({},gt,{animationName:0,elapsedTime:0,pseudoElement:0}),Gt=st(Bn),tr=v({},gt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Rn=st(tr),Ss=v({},gt,{data:0}),ts=st(Ss),ti={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function js(e){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(e):(e=lm[e])?!!s[e]:!1}function ni(){return js}var Pi=v({},nt,{key:function(e){if(e.key){var s=ti[e.key]||e.key;if(s!=="Unidentified")return s}return e.type==="keypress"?(e=He(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Pl[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ni,charCode:function(e){return e.type==="keypress"?He(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?He(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),ow=st(Pi),cw=v({},es,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),om=st(cw),uw=v({},nt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ni}),dw=st(uw),hw=v({},gt,{propertyName:0,elapsedTime:0,pseudoElement:0}),fw=st(hw),pw=v({},es,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),mw=st(pw),gw=v({},gt,{newState:0,oldState:0}),yw=st(gw),vw=[9,13,27,32],Od=Zr&&"CompositionEvent"in window,ql=null;Zr&&"documentMode"in document&&(ql=document.documentMode);var xw=Zr&&"TextEvent"in window&&!ql,cm=Zr&&(!Od||ql&&8<ql&&11>=ql),um=" ",dm=!1;function hm(e,s){switch(e){case"keyup":return vw.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ca=!1;function bw(e,s){switch(e){case"compositionend":return fm(s);case"keypress":return s.which!==32?null:(dm=!0,um);case"textInput":return e=s.data,e===um&&dm?null:e;default:return null}}function ww(e,s){if(Ca)return e==="compositionend"||!Od&&hm(e,s)?(e=Be(),Ue=Se=re=null,Ca=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return cm&&s.locale!=="ko"?null:s.data;default:return null}}var Sw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pm(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s==="input"?!!Sw[e.type]:s==="textarea"}function mm(e,s,l,c){Xs?Zs?Zs.push(c):Zs=[c]:Xs=c,s=ou(s,"onChange"),0<s.length&&(l=new xt("onChange","change",null,l,c),e.push({event:l,listeners:s}))}var Fl=null,Hl=null;function jw(e){Jy(e,0)}function bc(e){var s=Xe(e);if(mc(s))return e}function gm(e,s){if(e==="change")return s}var ym=!1;if(Zr){var Dd;if(Zr){var Md="oninput"in document;if(!Md){var vm=document.createElement("div");vm.setAttribute("oninput","return;"),Md=typeof vm.oninput=="function"}Dd=Md}else Dd=!1;ym=Dd&&(!document.documentMode||9<document.documentMode)}function xm(){Fl&&(Fl.detachEvent("onpropertychange",bm),Hl=Fl=null)}function bm(e){if(e.propertyName==="value"&&bc(Hl)){var s=[];mm(s,Hl,e,Il(e)),$i(jw,s)}}function _w(e,s,l){e==="focusin"?(xm(),Fl=s,Hl=l,Fl.attachEvent("onpropertychange",bm)):e==="focusout"&&xm()}function Cw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return bc(Hl)}function Nw(e,s){if(e==="click")return bc(s)}function Ew(e,s){if(e==="input"||e==="change")return bc(s)}function kw(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var _r=typeof Object.is=="function"?Object.is:kw;function Vl(e,s){if(_r(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;var l=Object.keys(e),c=Object.keys(s);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var m=l[c];if(!pt.call(s,m)||!_r(e[m],s[m]))return!1}return!0}function wm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Sm(e,s){var l=wm(e);e=0;for(var c;l;){if(l.nodeType===3){if(c=e+l.textContent.length,e<=s&&c>=s)return{node:l,offset:s-e};e=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=wm(l)}}function jm(e,s){return e&&s?e===s?!0:e&&e.nodeType===3?!1:s&&s.nodeType===3?jm(e,s.parentNode):"contains"in e?e.contains(s):e.compareDocumentPosition?!!(e.compareDocumentPosition(s)&16):!1:!1}function _m(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var s=ja(e.document);s instanceof e.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)e=s.contentWindow;else break;s=ja(e.document)}return s}function Ld(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s&&(s==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||s==="textarea"||e.contentEditable==="true")}var Tw=Zr&&"documentMode"in document&&11>=document.documentMode,Na=null,zd=null,Gl=null,Ud=!1;function Cm(e,s,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Ud||Na==null||Na!==ja(c)||(c=Na,"selectionStart"in c&&Ld(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Gl&&Vl(Gl,c)||(Gl=c,c=ou(zd,"onSelect"),0<c.length&&(s=new xt("onSelect","select",null,s,l),e.push({event:s,listeners:c}),s.target=Na)))}function qi(e,s){var l={};return l[e.toLowerCase()]=s.toLowerCase(),l["Webkit"+e]="webkit"+s,l["Moz"+e]="moz"+s,l}var Ea={animationend:qi("Animation","AnimationEnd"),animationiteration:qi("Animation","AnimationIteration"),animationstart:qi("Animation","AnimationStart"),transitionrun:qi("Transition","TransitionRun"),transitionstart:qi("Transition","TransitionStart"),transitioncancel:qi("Transition","TransitionCancel"),transitionend:qi("Transition","TransitionEnd")},Id={},Nm={};Zr&&(Nm=document.createElement("div").style,"AnimationEvent"in window||(delete Ea.animationend.animation,delete Ea.animationiteration.animation,delete Ea.animationstart.animation),"TransitionEvent"in window||delete Ea.transitionend.transition);function Fi(e){if(Id[e])return Id[e];if(!Ea[e])return e;var s=Ea[e],l;for(l in s)if(s.hasOwnProperty(l)&&l in Nm)return Id[e]=s[l];return e}var Em=Fi("animationend"),km=Fi("animationiteration"),Tm=Fi("animationstart"),Aw=Fi("transitionrun"),Rw=Fi("transitionstart"),Ow=Fi("transitioncancel"),Am=Fi("transitionend"),Rm=new Map,Bd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Bd.push("scrollEnd");function ns(e,s){Rm.set(e,s),We(s,[e])}var wc=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Ir=[],ka=0,$d=0;function Sc(){for(var e=ka,s=$d=ka=0;s<e;){var l=Ir[s];Ir[s++]=null;var c=Ir[s];Ir[s++]=null;var m=Ir[s];Ir[s++]=null;var g=Ir[s];if(Ir[s++]=null,c!==null&&m!==null){var j=c.pending;j===null?m.next=m:(m.next=j.next,j.next=m),c.pending=m}g!==0&&Om(l,m,g)}}function jc(e,s,l,c){Ir[ka++]=e,Ir[ka++]=s,Ir[ka++]=l,Ir[ka++]=c,$d|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function Pd(e,s,l,c){return jc(e,s,l,c),_c(e)}function Hi(e,s){return jc(e,null,null,s),_c(e)}function Om(e,s,l){e.lanes|=l;var c=e.alternate;c!==null&&(c.lanes|=l);for(var m=!1,g=e.return;g!==null;)g.childLanes|=l,c=g.alternate,c!==null&&(c.childLanes|=l),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(m=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,m&&s!==null&&(m=31-sn(l),e=g.hiddenUpdates,c=e[m],c===null?e[m]=[s]:c.push(s),s.lane=l|536870912),g):null}function _c(e){if(50<mo)throw mo=0,Qh=null,Error(a(185));for(var s=e.return;s!==null;)e=s,s=e.return;return e.tag===3?e.stateNode:null}var Ta={};function Dw(e,s,l,c){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cr(e,s,l,c){return new Dw(e,s,l,c)}function qd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function _s(e,s){var l=e.alternate;return l===null?(l=Cr(e.tag,s,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=s,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&65011712,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,s=e.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l.refCleanup=e.refCleanup,l}function Dm(e,s){e.flags&=65011714;var l=e.alternate;return l===null?(e.childLanes=0,e.lanes=s,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=l.childLanes,e.lanes=l.lanes,e.child=l.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=l.memoizedProps,e.memoizedState=l.memoizedState,e.updateQueue=l.updateQueue,e.type=l.type,s=l.dependencies,e.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),e}function Cc(e,s,l,c,m,g){var j=0;if(c=e,typeof e=="function")qd(e)&&(j=1);else if(typeof e=="string")j=IS(e,l,de.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case M:return e=Cr(31,l,s,m),e.elementType=M,e.lanes=g,e;case C:return Vi(l.children,m,g,s);case S:j=8,m|=24;break;case N:return e=Cr(12,l,s,m|2),e.elementType=N,e.lanes=g,e;case J:return e=Cr(13,l,s,m),e.elementType=J,e.lanes=g,e;case H:return e=Cr(19,l,s,m),e.elementType=H,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case L:j=10;break e;case T:j=9;break e;case R:j=11;break e;case V:j=14;break e;case k:j=16,c=null;break e}j=29,l=Error(a(130,e===null?"null":typeof e,"")),c=null}return s=Cr(j,l,s,m),s.elementType=e,s.type=c,s.lanes=g,s}function Vi(e,s,l,c){return e=Cr(7,e,c,s),e.lanes=l,e}function Fd(e,s,l){return e=Cr(6,e,null,s),e.lanes=l,e}function Mm(e){var s=Cr(18,null,null,0);return s.stateNode=e,s}function Hd(e,s,l){return s=Cr(4,e.children!==null?e.children:[],e.key,s),s.lanes=l,s.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},s}var Lm=new WeakMap;function Br(e,s){if(typeof e=="object"&&e!==null){var l=Lm.get(e);return l!==void 0?l:(s={value:e,source:s,stack:lt(s)},Lm.set(e,s),s)}return{value:e,source:s,stack:lt(s)}}var Aa=[],Ra=0,Nc=null,Kl=0,$r=[],Pr=0,ri=null,ps=1,ms="";function Cs(e,s){Aa[Ra++]=Kl,Aa[Ra++]=Nc,Nc=e,Kl=s}function zm(e,s,l){$r[Pr++]=ps,$r[Pr++]=ms,$r[Pr++]=ri,ri=e;var c=ps;e=ms;var m=32-sn(c)-1;c&=~(1<<m),l+=1;var g=32-sn(s)+m;if(30<g){var j=m-m%5;g=(c&(1<<j)-1).toString(32),c>>=j,m-=j,ps=1<<32-sn(s)+m|l<<m|c,ms=g+e}else ps=1<<g|l<<m|c,ms=e}function Vd(e){e.return!==null&&(Cs(e,1),zm(e,1,0))}function Gd(e){for(;e===Nc;)Nc=Aa[--Ra],Aa[Ra]=null,Kl=Aa[--Ra],Aa[Ra]=null;for(;e===ri;)ri=$r[--Pr],$r[Pr]=null,ms=$r[--Pr],$r[Pr]=null,ps=$r[--Pr],$r[Pr]=null}function Um(e,s){$r[Pr++]=ps,$r[Pr++]=ms,$r[Pr++]=ri,ps=s.id,ms=s.overflow,ri=e}var nr=null,Cn=null,Zt=!1,si=null,qr=!1,Kd=Error(a(519));function ii(e){var s=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Yl(Br(s,e)),Kd}function Im(e){var s=e.stateNode,l=e.type,c=e.memoizedProps;switch(s[$e]=e,s[ze]=c,l){case"dialog":Yt("cancel",s),Yt("close",s);break;case"iframe":case"object":case"embed":Yt("load",s);break;case"video":case"audio":for(l=0;l<yo.length;l++)Yt(yo[l],s);break;case"source":Yt("error",s);break;case"img":case"image":case"link":Yt("error",s),Yt("load",s);break;case"details":Yt("toggle",s);break;case"input":Yt("invalid",s),gc(s,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Yt("invalid",s);break;case"textarea":Yt("invalid",s),vc(s,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||s.textContent===""+l||c.suppressHydrationWarning===!0||tv(s.textContent,l)?(c.popover!=null&&(Yt("beforetoggle",s),Yt("toggle",s)),c.onScroll!=null&&Yt("scroll",s),c.onScrollEnd!=null&&Yt("scrollend",s),c.onClick!=null&&(s.onclick=zr),s=!0):s=!1,s||ii(e,!0)}function Bm(e){for(nr=e.return;nr;)switch(nr.tag){case 5:case 31:case 13:qr=!1;return;case 27:case 3:qr=!0;return;default:nr=nr.return}}function Oa(e){if(e!==nr)return!1;if(!Zt)return Bm(e),Zt=!0,!1;var s=e.tag,l;if((l=s!==3&&s!==27)&&((l=s===5)&&(l=e.type,l=!(l!=="form"&&l!=="button")||hf(e.type,e.memoizedProps)),l=!l),l&&Cn&&ii(e),Bm(e),s===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));Cn=uv(e)}else if(s===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));Cn=uv(e)}else s===27?(s=Cn,xi(e.type)?(e=yf,yf=null,Cn=e):Cn=s):Cn=nr?Hr(e.stateNode.nextSibling):null;return!0}function Gi(){Cn=nr=null,Zt=!1}function Yd(){var e=si;return e!==null&&(br===null?br=e:br.push.apply(br,e),si=null),e}function Yl(e){si===null?si=[e]:si.push(e)}var Wd=A(null),Ki=null,Ns=null;function ai(e,s,l){K(Wd,s._currentValue),s._currentValue=l}function Es(e){e._currentValue=Wd.current,O(Wd)}function Qd(e,s,l){for(;e!==null;){var c=e.alternate;if((e.childLanes&s)!==s?(e.childLanes|=s,c!==null&&(c.childLanes|=s)):c!==null&&(c.childLanes&s)!==s&&(c.childLanes|=s),e===l)break;e=e.return}}function Jd(e,s,l,c){var m=e.child;for(m!==null&&(m.return=e);m!==null;){var g=m.dependencies;if(g!==null){var j=m.child;g=g.firstContext;e:for(;g!==null;){var D=g;g=m;for(var X=0;X<s.length;X++)if(D.context===s[X]){g.lanes|=l,D=g.alternate,D!==null&&(D.lanes|=l),Qd(g.return,l,e),c||(j=null);break e}g=D.next}}else if(m.tag===18){if(j=m.return,j===null)throw Error(a(341));j.lanes|=l,g=j.alternate,g!==null&&(g.lanes|=l),Qd(j,l,e),j=null}else j=m.child;if(j!==null)j.return=m;else for(j=m;j!==null;){if(j===e){j=null;break}if(m=j.sibling,m!==null){m.return=j.return,j=m;break}j=j.return}m=j}}function Da(e,s,l,c){e=null;for(var m=s,g=!1;m!==null;){if(!g){if((m.flags&524288)!==0)g=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var j=m.alternate;if(j===null)throw Error(a(387));if(j=j.memoizedProps,j!==null){var D=m.type;_r(m.pendingProps.value,j.value)||(e!==null?e.push(D):e=[D])}}else if(m===te.current){if(j=m.alternate,j===null)throw Error(a(387));j.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(e!==null?e.push(So):e=[So])}m=m.return}e!==null&&Jd(s,e,l,c),s.flags|=262144}function Ec(e){for(e=e.firstContext;e!==null;){if(!_r(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Yi(e){Ki=e,Ns=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function rr(e){return $m(Ki,e)}function kc(e,s){return Ki===null&&Yi(e),$m(e,s)}function $m(e,s){var l=s._currentValue;if(s={context:s,memoizedValue:l,next:null},Ns===null){if(e===null)throw Error(a(308));Ns=s,e.dependencies={lanes:0,firstContext:s},e.flags|=524288}else Ns=Ns.next=s;return l}var Mw=typeof AbortController<"u"?AbortController:function(){var e=[],s=this.signal={aborted:!1,addEventListener:function(l,c){e.push(c)}};this.abort=function(){s.aborted=!0,e.forEach(function(l){return l()})}},Lw=n.unstable_scheduleCallback,zw=n.unstable_NormalPriority,$n={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Xd(){return{controller:new Mw,data:new Map,refCount:0}}function Wl(e){e.refCount--,e.refCount===0&&Lw(zw,function(){e.controller.abort()})}var Ql=null,Zd=0,Ma=0,La=null;function Uw(e,s){if(Ql===null){var l=Ql=[];Zd=0,Ma=nf(),La={status:"pending",value:void 0,then:function(c){l.push(c)}}}return Zd++,s.then(Pm,Pm),s}function Pm(){if(--Zd===0&&Ql!==null){La!==null&&(La.status="fulfilled");var e=Ql;Ql=null,Ma=0,La=null;for(var s=0;s<e.length;s++)(0,e[s])()}}function Iw(e,s){var l=[],c={status:"pending",value:null,reason:null,then:function(m){l.push(m)}};return e.then(function(){c.status="fulfilled",c.value=s;for(var m=0;m<l.length;m++)(0,l[m])(s)},function(m){for(c.status="rejected",c.reason=m,m=0;m<l.length;m++)(0,l[m])(void 0)}),c}var qm=E.S;E.S=function(e,s){Cy=dt(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Uw(e,s),qm!==null&&qm(e,s)};var Wi=A(null);function eh(){var e=Wi.current;return e!==null?e:wn.pooledCache}function Tc(e,s){s===null?K(Wi,Wi.current):K(Wi,s.pool)}function Fm(){var e=eh();return e===null?null:{parent:$n._currentValue,pool:e}}var za=Error(a(460)),th=Error(a(474)),Ac=Error(a(542)),Rc={then:function(){}};function Hm(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Vm(e,s,l){switch(l=e[l],l===void 0?e.push(s):l!==s&&(s.then(zr,zr),s=l),s.status){case"fulfilled":return s.value;case"rejected":throw e=s.reason,Km(e),e;default:if(typeof s.status=="string")s.then(zr,zr);else{if(e=wn,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=s,e.status="pending",e.then(function(c){if(s.status==="pending"){var m=s;m.status="fulfilled",m.value=c}},function(c){if(s.status==="pending"){var m=s;m.status="rejected",m.reason=c}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw e=s.reason,Km(e),e}throw Ji=s,za}}function Qi(e){try{var s=e._init;return s(e._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Ji=l,za):l}}var Ji=null;function Gm(){if(Ji===null)throw Error(a(459));var e=Ji;return Ji=null,e}function Km(e){if(e===za||e===Ac)throw Error(a(483))}var Ua=null,Jl=0;function Oc(e){var s=Jl;return Jl+=1,Ua===null&&(Ua=[]),Vm(Ua,e,s)}function Xl(e,s){s=s.props.ref,e.ref=s!==void 0?s:null}function Dc(e,s){throw s.$$typeof===x?Error(a(525)):(e=Object.prototype.toString.call(s),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)))}function Ym(e){function s(fe,se){if(e){var ge=fe.deletions;ge===null?(fe.deletions=[se],fe.flags|=16):ge.push(se)}}function l(fe,se){if(!e)return null;for(;se!==null;)s(fe,se),se=se.sibling;return null}function c(fe){for(var se=new Map;fe!==null;)fe.key!==null?se.set(fe.key,fe):se.set(fe.index,fe),fe=fe.sibling;return se}function m(fe,se){return fe=_s(fe,se),fe.index=0,fe.sibling=null,fe}function g(fe,se,ge){return fe.index=ge,e?(ge=fe.alternate,ge!==null?(ge=ge.index,ge<se?(fe.flags|=67108866,se):ge):(fe.flags|=67108866,se)):(fe.flags|=1048576,se)}function j(fe){return e&&fe.alternate===null&&(fe.flags|=67108866),fe}function D(fe,se,ge,Me){return se===null||se.tag!==6?(se=Fd(ge,fe.mode,Me),se.return=fe,se):(se=m(se,ge),se.return=fe,se)}function X(fe,se,ge,Me){var Nt=ge.type;return Nt===C?Ae(fe,se,ge.props.children,Me,ge.key):se!==null&&(se.elementType===Nt||typeof Nt=="object"&&Nt!==null&&Nt.$$typeof===k&&Qi(Nt)===se.type)?(se=m(se,ge.props),Xl(se,ge),se.return=fe,se):(se=Cc(ge.type,ge.key,ge.props,null,fe.mode,Me),Xl(se,ge),se.return=fe,se)}function ye(fe,se,ge,Me){return se===null||se.tag!==4||se.stateNode.containerInfo!==ge.containerInfo||se.stateNode.implementation!==ge.implementation?(se=Hd(ge,fe.mode,Me),se.return=fe,se):(se=m(se,ge.children||[]),se.return=fe,se)}function Ae(fe,se,ge,Me,Nt){return se===null||se.tag!==7?(se=Vi(ge,fe.mode,Me,Nt),se.return=fe,se):(se=m(se,ge),se.return=fe,se)}function Le(fe,se,ge){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return se=Fd(""+se,fe.mode,ge),se.return=fe,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case w:return ge=Cc(se.type,se.key,se.props,null,fe.mode,ge),Xl(ge,se),ge.return=fe,ge;case _:return se=Hd(se,fe.mode,ge),se.return=fe,se;case k:return se=Qi(se),Le(fe,se,ge)}if(P(se)||F(se))return se=Vi(se,fe.mode,ge,null),se.return=fe,se;if(typeof se.then=="function")return Le(fe,Oc(se),ge);if(se.$$typeof===L)return Le(fe,kc(fe,se),ge);Dc(fe,se)}return null}function be(fe,se,ge,Me){var Nt=se!==null?se.key:null;if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return Nt!==null?null:D(fe,se,""+ge,Me);if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case w:return ge.key===Nt?X(fe,se,ge,Me):null;case _:return ge.key===Nt?ye(fe,se,ge,Me):null;case k:return ge=Qi(ge),be(fe,se,ge,Me)}if(P(ge)||F(ge))return Nt!==null?null:Ae(fe,se,ge,Me,null);if(typeof ge.then=="function")return be(fe,se,Oc(ge),Me);if(ge.$$typeof===L)return be(fe,se,kc(fe,ge),Me);Dc(fe,ge)}return null}function Ce(fe,se,ge,Me,Nt){if(typeof Me=="string"&&Me!==""||typeof Me=="number"||typeof Me=="bigint")return fe=fe.get(ge)||null,D(se,fe,""+Me,Nt);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case w:return fe=fe.get(Me.key===null?ge:Me.key)||null,X(se,fe,Me,Nt);case _:return fe=fe.get(Me.key===null?ge:Me.key)||null,ye(se,fe,Me,Nt);case k:return Me=Qi(Me),Ce(fe,se,ge,Me,Nt)}if(P(Me)||F(Me))return fe=fe.get(ge)||null,Ae(se,fe,Me,Nt,null);if(typeof Me.then=="function")return Ce(fe,se,ge,Oc(Me),Nt);if(Me.$$typeof===L)return Ce(fe,se,ge,kc(se,Me),Nt);Dc(se,Me)}return null}function ft(fe,se,ge,Me){for(var Nt=null,cn=null,yt=se,Ht=se=0,Jt=null;yt!==null&&Ht<ge.length;Ht++){yt.index>Ht?(Jt=yt,yt=null):Jt=yt.sibling;var un=be(fe,yt,ge[Ht],Me);if(un===null){yt===null&&(yt=Jt);break}e&&yt&&un.alternate===null&&s(fe,yt),se=g(un,se,Ht),cn===null?Nt=un:cn.sibling=un,cn=un,yt=Jt}if(Ht===ge.length)return l(fe,yt),Zt&&Cs(fe,Ht),Nt;if(yt===null){for(;Ht<ge.length;Ht++)yt=Le(fe,ge[Ht],Me),yt!==null&&(se=g(yt,se,Ht),cn===null?Nt=yt:cn.sibling=yt,cn=yt);return Zt&&Cs(fe,Ht),Nt}for(yt=c(yt);Ht<ge.length;Ht++)Jt=Ce(yt,fe,Ht,ge[Ht],Me),Jt!==null&&(e&&Jt.alternate!==null&&yt.delete(Jt.key===null?Ht:Jt.key),se=g(Jt,se,Ht),cn===null?Nt=Jt:cn.sibling=Jt,cn=Jt);return e&&yt.forEach(function(_i){return s(fe,_i)}),Zt&&Cs(fe,Ht),Nt}function Rt(fe,se,ge,Me){if(ge==null)throw Error(a(151));for(var Nt=null,cn=null,yt=se,Ht=se=0,Jt=null,un=ge.next();yt!==null&&!un.done;Ht++,un=ge.next()){yt.index>Ht?(Jt=yt,yt=null):Jt=yt.sibling;var _i=be(fe,yt,un.value,Me);if(_i===null){yt===null&&(yt=Jt);break}e&&yt&&_i.alternate===null&&s(fe,yt),se=g(_i,se,Ht),cn===null?Nt=_i:cn.sibling=_i,cn=_i,yt=Jt}if(un.done)return l(fe,yt),Zt&&Cs(fe,Ht),Nt;if(yt===null){for(;!un.done;Ht++,un=ge.next())un=Le(fe,un.value,Me),un!==null&&(se=g(un,se,Ht),cn===null?Nt=un:cn.sibling=un,cn=un);return Zt&&Cs(fe,Ht),Nt}for(yt=c(yt);!un.done;Ht++,un=ge.next())un=Ce(yt,fe,Ht,un.value,Me),un!==null&&(e&&un.alternate!==null&&yt.delete(un.key===null?Ht:un.key),se=g(un,se,Ht),cn===null?Nt=un:cn.sibling=un,cn=un);return e&&yt.forEach(function(WS){return s(fe,WS)}),Zt&&Cs(fe,Ht),Nt}function xn(fe,se,ge,Me){if(typeof ge=="object"&&ge!==null&&ge.type===C&&ge.key===null&&(ge=ge.props.children),typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case w:e:{for(var Nt=ge.key;se!==null;){if(se.key===Nt){if(Nt=ge.type,Nt===C){if(se.tag===7){l(fe,se.sibling),Me=m(se,ge.props.children),Me.return=fe,fe=Me;break e}}else if(se.elementType===Nt||typeof Nt=="object"&&Nt!==null&&Nt.$$typeof===k&&Qi(Nt)===se.type){l(fe,se.sibling),Me=m(se,ge.props),Xl(Me,ge),Me.return=fe,fe=Me;break e}l(fe,se);break}else s(fe,se);se=se.sibling}ge.type===C?(Me=Vi(ge.props.children,fe.mode,Me,ge.key),Me.return=fe,fe=Me):(Me=Cc(ge.type,ge.key,ge.props,null,fe.mode,Me),Xl(Me,ge),Me.return=fe,fe=Me)}return j(fe);case _:e:{for(Nt=ge.key;se!==null;){if(se.key===Nt)if(se.tag===4&&se.stateNode.containerInfo===ge.containerInfo&&se.stateNode.implementation===ge.implementation){l(fe,se.sibling),Me=m(se,ge.children||[]),Me.return=fe,fe=Me;break e}else{l(fe,se);break}else s(fe,se);se=se.sibling}Me=Hd(ge,fe.mode,Me),Me.return=fe,fe=Me}return j(fe);case k:return ge=Qi(ge),xn(fe,se,ge,Me)}if(P(ge))return ft(fe,se,ge,Me);if(F(ge)){if(Nt=F(ge),typeof Nt!="function")throw Error(a(150));return ge=Nt.call(ge),Rt(fe,se,ge,Me)}if(typeof ge.then=="function")return xn(fe,se,Oc(ge),Me);if(ge.$$typeof===L)return xn(fe,se,kc(fe,ge),Me);Dc(fe,ge)}return typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint"?(ge=""+ge,se!==null&&se.tag===6?(l(fe,se.sibling),Me=m(se,ge),Me.return=fe,fe=Me):(l(fe,se),Me=Fd(ge,fe.mode,Me),Me.return=fe,fe=Me),j(fe)):l(fe,se)}return function(fe,se,ge,Me){try{Jl=0;var Nt=xn(fe,se,ge,Me);return Ua=null,Nt}catch(yt){if(yt===za||yt===Ac)throw yt;var cn=Cr(29,yt,null,fe.mode);return cn.lanes=Me,cn.return=fe,cn}}}var Xi=Ym(!0),Wm=Ym(!1),li=!1;function nh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rh(e,s){e=e.updateQueue,s.updateQueue===e&&(s.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function oi(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ci(e,s,l){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(dn&2)!==0){var m=c.pending;return m===null?s.next=s:(s.next=m.next,m.next=s),c.pending=s,s=_c(e),Om(e,null,l),s}return jc(e,c,s,l),_c(e)}function Zl(e,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194048)!==0)){var c=s.lanes;c&=e.pendingLanes,l|=c,s.lanes=l,ct(e,l)}}function sh(e,s){var l=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var m=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var j={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};g===null?m=g=j:g=g.next=j,l=l.next}while(l!==null);g===null?m=g=s:g=g.next=s}else m=g=s;l={baseState:c.baseState,firstBaseUpdate:m,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=s:e.next=s,l.lastBaseUpdate=s}var ih=!1;function eo(){if(ih){var e=La;if(e!==null)throw e}}function to(e,s,l,c){ih=!1;var m=e.updateQueue;li=!1;var g=m.firstBaseUpdate,j=m.lastBaseUpdate,D=m.shared.pending;if(D!==null){m.shared.pending=null;var X=D,ye=X.next;X.next=null,j===null?g=ye:j.next=ye,j=X;var Ae=e.alternate;Ae!==null&&(Ae=Ae.updateQueue,D=Ae.lastBaseUpdate,D!==j&&(D===null?Ae.firstBaseUpdate=ye:D.next=ye,Ae.lastBaseUpdate=X))}if(g!==null){var Le=m.baseState;j=0,Ae=ye=X=null,D=g;do{var be=D.lane&-536870913,Ce=be!==D.lane;if(Ce?(Qt&be)===be:(c&be)===be){be!==0&&be===Ma&&(ih=!0),Ae!==null&&(Ae=Ae.next={lane:0,tag:D.tag,payload:D.payload,callback:null,next:null});e:{var ft=e,Rt=D;be=s;var xn=l;switch(Rt.tag){case 1:if(ft=Rt.payload,typeof ft=="function"){Le=ft.call(xn,Le,be);break e}Le=ft;break e;case 3:ft.flags=ft.flags&-65537|128;case 0:if(ft=Rt.payload,be=typeof ft=="function"?ft.call(xn,Le,be):ft,be==null)break e;Le=v({},Le,be);break e;case 2:li=!0}}be=D.callback,be!==null&&(e.flags|=64,Ce&&(e.flags|=8192),Ce=m.callbacks,Ce===null?m.callbacks=[be]:Ce.push(be))}else Ce={lane:be,tag:D.tag,payload:D.payload,callback:D.callback,next:null},Ae===null?(ye=Ae=Ce,X=Le):Ae=Ae.next=Ce,j|=be;if(D=D.next,D===null){if(D=m.shared.pending,D===null)break;Ce=D,D=Ce.next,Ce.next=null,m.lastBaseUpdate=Ce,m.shared.pending=null}}while(!0);Ae===null&&(X=Le),m.baseState=X,m.firstBaseUpdate=ye,m.lastBaseUpdate=Ae,g===null&&(m.shared.lanes=0),pi|=j,e.lanes=j,e.memoizedState=Le}}function Qm(e,s){if(typeof e!="function")throw Error(a(191,e));e.call(s)}function Jm(e,s){var l=e.callbacks;if(l!==null)for(e.callbacks=null,e=0;e<l.length;e++)Qm(l[e],s)}var Ia=A(null),Mc=A(0);function Xm(e,s){e=zs,K(Mc,e),K(Ia,s),zs=e|s.baseLanes}function ah(){K(Mc,zs),K(Ia,Ia.current)}function lh(){zs=Mc.current,O(Ia),O(Mc)}var Nr=A(null),Fr=null;function ui(e){var s=e.alternate;K(Un,Un.current&1),K(Nr,e),Fr===null&&(s===null||Ia.current!==null||s.memoizedState!==null)&&(Fr=e)}function oh(e){K(Un,Un.current),K(Nr,e),Fr===null&&(Fr=e)}function Zm(e){e.tag===22?(K(Un,Un.current),K(Nr,e),Fr===null&&(Fr=e)):di()}function di(){K(Un,Un.current),K(Nr,Nr.current)}function Er(e){O(Nr),Fr===e&&(Fr=null),O(Un)}var Un=A(0);function Lc(e){for(var s=e;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||mf(l)||gf(l)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var ks=0,qt=null,yn=null,Pn=null,zc=!1,Ba=!1,Zi=!1,Uc=0,no=0,$a=null,Bw=0;function On(){throw Error(a(321))}function ch(e,s){if(s===null)return!1;for(var l=0;l<s.length&&l<e.length;l++)if(!_r(e[l],s[l]))return!1;return!0}function uh(e,s,l,c,m,g){return ks=g,qt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,E.H=e===null||e.memoizedState===null?zg:Ch,Zi=!1,g=l(c,m),Zi=!1,Ba&&(g=tg(s,l,c,m)),eg(e),g}function eg(e){E.H=io;var s=yn!==null&&yn.next!==null;if(ks=0,Pn=yn=qt=null,zc=!1,no=0,$a=null,s)throw Error(a(300));e===null||qn||(e=e.dependencies,e!==null&&Ec(e)&&(qn=!0))}function tg(e,s,l,c){qt=e;var m=0;do{if(Ba&&($a=null),no=0,Ba=!1,25<=m)throw Error(a(301));if(m+=1,Pn=yn=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}E.H=Ug,g=s(l,c)}while(Ba);return g}function $w(){var e=E.H,s=e.useState()[0];return s=typeof s.then=="function"?ro(s):s,e=e.useState()[0],(yn!==null?yn.memoizedState:null)!==e&&(qt.flags|=1024),s}function dh(){var e=Uc!==0;return Uc=0,e}function hh(e,s,l){s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~l}function fh(e){if(zc){for(e=e.memoizedState;e!==null;){var s=e.queue;s!==null&&(s.pending=null),e=e.next}zc=!1}ks=0,Pn=yn=qt=null,Ba=!1,no=Uc=0,$a=null}function fr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pn===null?qt.memoizedState=Pn=e:Pn=Pn.next=e,Pn}function In(){if(yn===null){var e=qt.alternate;e=e!==null?e.memoizedState:null}else e=yn.next;var s=Pn===null?qt.memoizedState:Pn.next;if(s!==null)Pn=s,yn=e;else{if(e===null)throw qt.alternate===null?Error(a(467)):Error(a(310));yn=e,e={memoizedState:yn.memoizedState,baseState:yn.baseState,baseQueue:yn.baseQueue,queue:yn.queue,next:null},Pn===null?qt.memoizedState=Pn=e:Pn=Pn.next=e}return Pn}function Ic(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ro(e){var s=no;return no+=1,$a===null&&($a=[]),e=Vm($a,e,s),s=qt,(Pn===null?s.memoizedState:Pn.next)===null&&(s=s.alternate,E.H=s===null||s.memoizedState===null?zg:Ch),e}function Bc(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return ro(e);if(e.$$typeof===L)return rr(e)}throw Error(a(438,String(e)))}function ph(e){var s=null,l=qt.updateQueue;if(l!==null&&(s=l.memoCache),s==null){var c=qt.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(s={data:c.data.map(function(m){return m.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),l===null&&(l=Ic(),qt.updateQueue=l),l.memoCache=s,l=s.data[s.index],l===void 0)for(l=s.data[s.index]=Array(e),c=0;c<e;c++)l[c]=z;return s.index++,l}function Ts(e,s){return typeof s=="function"?s(e):s}function $c(e){var s=In();return mh(s,yn,e)}function mh(e,s,l){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=l;var m=e.baseQueue,g=c.pending;if(g!==null){if(m!==null){var j=m.next;m.next=g.next,g.next=j}s.baseQueue=m=g,c.pending=null}if(g=e.baseState,m===null)e.memoizedState=g;else{s=m.next;var D=j=null,X=null,ye=s,Ae=!1;do{var Le=ye.lane&-536870913;if(Le!==ye.lane?(Qt&Le)===Le:(ks&Le)===Le){var be=ye.revertLane;if(be===0)X!==null&&(X=X.next={lane:0,revertLane:0,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null}),Le===Ma&&(Ae=!0);else if((ks&be)===be){ye=ye.next,be===Ma&&(Ae=!0);continue}else Le={lane:0,revertLane:ye.revertLane,gesture:null,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},X===null?(D=X=Le,j=g):X=X.next=Le,qt.lanes|=be,pi|=be;Le=ye.action,Zi&&l(g,Le),g=ye.hasEagerState?ye.eagerState:l(g,Le)}else be={lane:Le,revertLane:ye.revertLane,gesture:ye.gesture,action:ye.action,hasEagerState:ye.hasEagerState,eagerState:ye.eagerState,next:null},X===null?(D=X=be,j=g):X=X.next=be,qt.lanes|=Le,pi|=Le;ye=ye.next}while(ye!==null&&ye!==s);if(X===null?j=g:X.next=D,!_r(g,e.memoizedState)&&(qn=!0,Ae&&(l=La,l!==null)))throw l;e.memoizedState=g,e.baseState=j,e.baseQueue=X,c.lastRenderedState=g}return m===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function gh(e){var s=In(),l=s.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=e;var c=l.dispatch,m=l.pending,g=s.memoizedState;if(m!==null){l.pending=null;var j=m=m.next;do g=e(g,j.action),j=j.next;while(j!==m);_r(g,s.memoizedState)||(qn=!0),s.memoizedState=g,s.baseQueue===null&&(s.baseState=g),l.lastRenderedState=g}return[g,c]}function ng(e,s,l){var c=qt,m=In(),g=Zt;if(g){if(l===void 0)throw Error(a(407));l=l()}else l=s();var j=!_r((yn||m).memoizedState,l);if(j&&(m.memoizedState=l,qn=!0),m=m.queue,xh(ig.bind(null,c,m,e),[e]),m.getSnapshot!==s||j||Pn!==null&&Pn.memoizedState.tag&1){if(c.flags|=2048,Pa(9,{destroy:void 0},sg.bind(null,c,m,l,s),null),wn===null)throw Error(a(349));g||(ks&127)!==0||rg(c,s,l)}return l}function rg(e,s,l){e.flags|=16384,e={getSnapshot:s,value:l},s=qt.updateQueue,s===null?(s=Ic(),qt.updateQueue=s,s.stores=[e]):(l=s.stores,l===null?s.stores=[e]:l.push(e))}function sg(e,s,l,c){s.value=l,s.getSnapshot=c,ag(s)&&lg(e)}function ig(e,s,l){return l(function(){ag(s)&&lg(e)})}function ag(e){var s=e.getSnapshot;e=e.value;try{var l=s();return!_r(e,l)}catch{return!0}}function lg(e){var s=Hi(e,2);s!==null&&wr(s,e,2)}function yh(e){var s=fr();if(typeof e=="function"){var l=e;if(e=l(),Zi){ln(!0);try{l()}finally{ln(!1)}}}return s.memoizedState=s.baseState=e,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ts,lastRenderedState:e},s}function og(e,s,l,c){return e.baseState=l,mh(e,yn,typeof c=="function"?c:Ts)}function Pw(e,s,l,c,m){if(Fc(e))throw Error(a(485));if(e=s.action,e!==null){var g={payload:m,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(j){g.listeners.push(j)}};E.T!==null?l(!0):g.isTransition=!1,c(g),l=s.pending,l===null?(g.next=s.pending=g,cg(s,g)):(g.next=l.next,s.pending=l.next=g)}}function cg(e,s){var l=s.action,c=s.payload,m=e.state;if(s.isTransition){var g=E.T,j={};E.T=j;try{var D=l(m,c),X=E.S;X!==null&&X(j,D),ug(e,s,D)}catch(ye){vh(e,s,ye)}finally{g!==null&&j.types!==null&&(g.types=j.types),E.T=g}}else try{g=l(m,c),ug(e,s,g)}catch(ye){vh(e,s,ye)}}function ug(e,s,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){dg(e,s,c)},function(c){return vh(e,s,c)}):dg(e,s,l)}function dg(e,s,l){s.status="fulfilled",s.value=l,hg(s),e.state=l,s=e.pending,s!==null&&(l=s.next,l===s?e.pending=null:(l=l.next,s.next=l,cg(e,l)))}function vh(e,s,l){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do s.status="rejected",s.reason=l,hg(s),s=s.next;while(s!==c)}e.action=null}function hg(e){e=e.listeners;for(var s=0;s<e.length;s++)(0,e[s])()}function fg(e,s){return s}function pg(e,s){if(Zt){var l=wn.formState;if(l!==null){e:{var c=qt;if(Zt){if(Cn){t:{for(var m=Cn,g=qr;m.nodeType!==8;){if(!g){m=null;break t}if(m=Hr(m.nextSibling),m===null){m=null;break t}}g=m.data,m=g==="F!"||g==="F"?m:null}if(m){Cn=Hr(m.nextSibling),c=m.data==="F!";break e}}ii(c)}c=!1}c&&(s=l[0])}}return l=fr(),l.memoizedState=l.baseState=s,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fg,lastRenderedState:s},l.queue=c,l=Dg.bind(null,qt,c),c.dispatch=l,c=yh(!1),g=_h.bind(null,qt,!1,c.queue),c=fr(),m={state:s,dispatch:null,action:e,pending:null},c.queue=m,l=Pw.bind(null,qt,m,g,l),m.dispatch=l,c.memoizedState=e,[s,l,!1]}function mg(e){var s=In();return gg(s,yn,e)}function gg(e,s,l){if(s=mh(e,s,fg)[0],e=$c(Ts)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var c=ro(s)}catch(j){throw j===za?Ac:j}else c=s;s=In();var m=s.queue,g=m.dispatch;return l!==s.memoizedState&&(qt.flags|=2048,Pa(9,{destroy:void 0},qw.bind(null,m,l),null)),[c,g,e]}function qw(e,s){e.action=s}function yg(e){var s=In(),l=yn;if(l!==null)return gg(s,l,e);In(),s=s.memoizedState,l=In();var c=l.queue.dispatch;return l.memoizedState=e,[s,c,!1]}function Pa(e,s,l,c){return e={tag:e,create:l,deps:c,inst:s,next:null},s=qt.updateQueue,s===null&&(s=Ic(),qt.updateQueue=s),l=s.lastEffect,l===null?s.lastEffect=e.next=e:(c=l.next,l.next=e,e.next=c,s.lastEffect=e),e}function vg(){return In().memoizedState}function Pc(e,s,l,c){var m=fr();qt.flags|=e,m.memoizedState=Pa(1|s,{destroy:void 0},l,c===void 0?null:c)}function qc(e,s,l,c){var m=In();c=c===void 0?null:c;var g=m.memoizedState.inst;yn!==null&&c!==null&&ch(c,yn.memoizedState.deps)?m.memoizedState=Pa(s,g,l,c):(qt.flags|=e,m.memoizedState=Pa(1|s,g,l,c))}function xg(e,s){Pc(8390656,8,e,s)}function xh(e,s){qc(2048,8,e,s)}function Fw(e){qt.flags|=4;var s=qt.updateQueue;if(s===null)s=Ic(),qt.updateQueue=s,s.events=[e];else{var l=s.events;l===null?s.events=[e]:l.push(e)}}function bg(e){var s=In().memoizedState;return Fw({ref:s,nextImpl:e}),function(){if((dn&2)!==0)throw Error(a(440));return s.impl.apply(void 0,arguments)}}function wg(e,s){return qc(4,2,e,s)}function Sg(e,s){return qc(4,4,e,s)}function jg(e,s){if(typeof s=="function"){e=e();var l=s(e);return function(){typeof l=="function"?l():s(null)}}if(s!=null)return e=e(),s.current=e,function(){s.current=null}}function _g(e,s,l){l=l!=null?l.concat([e]):null,qc(4,4,jg.bind(null,s,e),l)}function bh(){}function Cg(e,s){var l=In();s=s===void 0?null:s;var c=l.memoizedState;return s!==null&&ch(s,c[1])?c[0]:(l.memoizedState=[e,s],e)}function Ng(e,s){var l=In();s=s===void 0?null:s;var c=l.memoizedState;if(s!==null&&ch(s,c[1]))return c[0];if(c=e(),Zi){ln(!0);try{e()}finally{ln(!1)}}return l.memoizedState=[c,s],c}function wh(e,s,l){return l===void 0||(ks&1073741824)!==0&&(Qt&261930)===0?e.memoizedState=s:(e.memoizedState=l,e=Ey(),qt.lanes|=e,pi|=e,l)}function Eg(e,s,l,c){return _r(l,s)?l:Ia.current!==null?(e=wh(e,l,c),_r(e,s)||(qn=!0),e):(ks&42)===0||(ks&1073741824)!==0&&(Qt&261930)===0?(qn=!0,e.memoizedState=l):(e=Ey(),qt.lanes|=e,pi|=e,s)}function kg(e,s,l,c,m){var g=B.p;B.p=g!==0&&8>g?g:8;var j=E.T,D={};E.T=D,_h(e,!1,s,l);try{var X=m(),ye=E.S;if(ye!==null&&ye(D,X),X!==null&&typeof X=="object"&&typeof X.then=="function"){var Ae=Iw(X,c);so(e,s,Ae,Ar(e))}else so(e,s,c,Ar(e))}catch(Le){so(e,s,{then:function(){},status:"rejected",reason:Le},Ar())}finally{B.p=g,j!==null&&D.types!==null&&(j.types=D.types),E.T=j}}function Hw(){}function Sh(e,s,l,c){if(e.tag!==5)throw Error(a(476));var m=Tg(e).queue;kg(e,m,s,q,l===null?Hw:function(){return Ag(e),l(c)})}function Tg(e){var s=e.memoizedState;if(s!==null)return s;s={memoizedState:q,baseState:q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ts,lastRenderedState:q},next:null};var l={};return s.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ts,lastRenderedState:l},next:null},e.memoizedState=s,e=e.alternate,e!==null&&(e.memoizedState=s),s}function Ag(e){var s=Tg(e);s.next===null&&(s=e.alternate.memoizedState),so(e,s.next.queue,{},Ar())}function jh(){return rr(So)}function Rg(){return In().memoizedState}function Og(){return In().memoizedState}function Vw(e){for(var s=e.return;s!==null;){switch(s.tag){case 24:case 3:var l=Ar();e=oi(l);var c=ci(s,e,l);c!==null&&(wr(c,s,l),Zl(c,s,l)),s={cache:Xd()},e.payload=s;return}s=s.return}}function Gw(e,s,l){var c=Ar();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Fc(e)?Mg(s,l):(l=Pd(e,s,l,c),l!==null&&(wr(l,e,c),Lg(l,s,c)))}function Dg(e,s,l){var c=Ar();so(e,s,l,c)}function so(e,s,l,c){var m={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Fc(e))Mg(s,m);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=s.lastRenderedReducer,g!==null))try{var j=s.lastRenderedState,D=g(j,l);if(m.hasEagerState=!0,m.eagerState=D,_r(D,j))return jc(e,s,m,0),wn===null&&Sc(),!1}catch{}if(l=Pd(e,s,m,c),l!==null)return wr(l,e,c),Lg(l,s,c),!0}return!1}function _h(e,s,l,c){if(c={lane:2,revertLane:nf(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Fc(e)){if(s)throw Error(a(479))}else s=Pd(e,l,c,2),s!==null&&wr(s,e,2)}function Fc(e){var s=e.alternate;return e===qt||s!==null&&s===qt}function Mg(e,s){Ba=zc=!0;var l=e.pending;l===null?s.next=s:(s.next=l.next,l.next=s),e.pending=s}function Lg(e,s,l){if((l&4194048)!==0){var c=s.lanes;c&=e.pendingLanes,l|=c,s.lanes=l,ct(e,l)}}var io={readContext:rr,use:Bc,useCallback:On,useContext:On,useEffect:On,useImperativeHandle:On,useLayoutEffect:On,useInsertionEffect:On,useMemo:On,useReducer:On,useRef:On,useState:On,useDebugValue:On,useDeferredValue:On,useTransition:On,useSyncExternalStore:On,useId:On,useHostTransitionStatus:On,useFormState:On,useActionState:On,useOptimistic:On,useMemoCache:On,useCacheRefresh:On};io.useEffectEvent=On;var zg={readContext:rr,use:Bc,useCallback:function(e,s){return fr().memoizedState=[e,s===void 0?null:s],e},useContext:rr,useEffect:xg,useImperativeHandle:function(e,s,l){l=l!=null?l.concat([e]):null,Pc(4194308,4,jg.bind(null,s,e),l)},useLayoutEffect:function(e,s){return Pc(4194308,4,e,s)},useInsertionEffect:function(e,s){Pc(4,2,e,s)},useMemo:function(e,s){var l=fr();s=s===void 0?null:s;var c=e();if(Zi){ln(!0);try{e()}finally{ln(!1)}}return l.memoizedState=[c,s],c},useReducer:function(e,s,l){var c=fr();if(l!==void 0){var m=l(s);if(Zi){ln(!0);try{l(s)}finally{ln(!1)}}}else m=s;return c.memoizedState=c.baseState=m,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:m},c.queue=e,e=e.dispatch=Gw.bind(null,qt,e),[c.memoizedState,e]},useRef:function(e){var s=fr();return e={current:e},s.memoizedState=e},useState:function(e){e=yh(e);var s=e.queue,l=Dg.bind(null,qt,s);return s.dispatch=l,[e.memoizedState,l]},useDebugValue:bh,useDeferredValue:function(e,s){var l=fr();return wh(l,e,s)},useTransition:function(){var e=yh(!1);return e=kg.bind(null,qt,e.queue,!0,!1),fr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,s,l){var c=qt,m=fr();if(Zt){if(l===void 0)throw Error(a(407));l=l()}else{if(l=s(),wn===null)throw Error(a(349));(Qt&127)!==0||rg(c,s,l)}m.memoizedState=l;var g={value:l,getSnapshot:s};return m.queue=g,xg(ig.bind(null,c,g,e),[e]),c.flags|=2048,Pa(9,{destroy:void 0},sg.bind(null,c,g,l,s),null),l},useId:function(){var e=fr(),s=wn.identifierPrefix;if(Zt){var l=ms,c=ps;l=(c&~(1<<32-sn(c)-1)).toString(32)+l,s="_"+s+"R_"+l,l=Uc++,0<l&&(s+="H"+l.toString(32)),s+="_"}else l=Bw++,s="_"+s+"r_"+l.toString(32)+"_";return e.memoizedState=s},useHostTransitionStatus:jh,useFormState:pg,useActionState:pg,useOptimistic:function(e){var s=fr();s.memoizedState=s.baseState=e;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=l,s=_h.bind(null,qt,!0,l),l.dispatch=s,[e,s]},useMemoCache:ph,useCacheRefresh:function(){return fr().memoizedState=Vw.bind(null,qt)},useEffectEvent:function(e){var s=fr(),l={impl:e};return s.memoizedState=l,function(){if((dn&2)!==0)throw Error(a(440));return l.impl.apply(void 0,arguments)}}},Ch={readContext:rr,use:Bc,useCallback:Cg,useContext:rr,useEffect:xh,useImperativeHandle:_g,useInsertionEffect:wg,useLayoutEffect:Sg,useMemo:Ng,useReducer:$c,useRef:vg,useState:function(){return $c(Ts)},useDebugValue:bh,useDeferredValue:function(e,s){var l=In();return Eg(l,yn.memoizedState,e,s)},useTransition:function(){var e=$c(Ts)[0],s=In().memoizedState;return[typeof e=="boolean"?e:ro(e),s]},useSyncExternalStore:ng,useId:Rg,useHostTransitionStatus:jh,useFormState:mg,useActionState:mg,useOptimistic:function(e,s){var l=In();return og(l,yn,e,s)},useMemoCache:ph,useCacheRefresh:Og};Ch.useEffectEvent=bg;var Ug={readContext:rr,use:Bc,useCallback:Cg,useContext:rr,useEffect:xh,useImperativeHandle:_g,useInsertionEffect:wg,useLayoutEffect:Sg,useMemo:Ng,useReducer:gh,useRef:vg,useState:function(){return gh(Ts)},useDebugValue:bh,useDeferredValue:function(e,s){var l=In();return yn===null?wh(l,e,s):Eg(l,yn.memoizedState,e,s)},useTransition:function(){var e=gh(Ts)[0],s=In().memoizedState;return[typeof e=="boolean"?e:ro(e),s]},useSyncExternalStore:ng,useId:Rg,useHostTransitionStatus:jh,useFormState:yg,useActionState:yg,useOptimistic:function(e,s){var l=In();return yn!==null?og(l,yn,e,s):(l.baseState=e,[e,l.queue.dispatch])},useMemoCache:ph,useCacheRefresh:Og};Ug.useEffectEvent=bg;function Nh(e,s,l,c){s=e.memoizedState,l=l(c,s),l=l==null?s:v({},s,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var Eh={enqueueSetState:function(e,s,l){e=e._reactInternals;var c=Ar(),m=oi(c);m.payload=s,l!=null&&(m.callback=l),s=ci(e,m,c),s!==null&&(wr(s,e,c),Zl(s,e,c))},enqueueReplaceState:function(e,s,l){e=e._reactInternals;var c=Ar(),m=oi(c);m.tag=1,m.payload=s,l!=null&&(m.callback=l),s=ci(e,m,c),s!==null&&(wr(s,e,c),Zl(s,e,c))},enqueueForceUpdate:function(e,s){e=e._reactInternals;var l=Ar(),c=oi(l);c.tag=2,s!=null&&(c.callback=s),s=ci(e,c,l),s!==null&&(wr(s,e,l),Zl(s,e,l))}};function Ig(e,s,l,c,m,g,j){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,j):s.prototype&&s.prototype.isPureReactComponent?!Vl(l,c)||!Vl(m,g):!0}function Bg(e,s,l,c){e=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,c),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,c),s.state!==e&&Eh.enqueueReplaceState(s,s.state,null)}function ea(e,s){var l=s;if("ref"in s){l={};for(var c in s)c!=="ref"&&(l[c]=s[c])}if(e=e.defaultProps){l===s&&(l=v({},l));for(var m in e)l[m]===void 0&&(l[m]=e[m])}return l}function $g(e){wc(e)}function Pg(e){console.error(e)}function qg(e){wc(e)}function Hc(e,s){try{var l=e.onUncaughtError;l(s.value,{componentStack:s.stack})}catch(c){setTimeout(function(){throw c})}}function Fg(e,s,l){try{var c=e.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function kh(e,s,l){return l=oi(l),l.tag=3,l.payload={element:null},l.callback=function(){Hc(e,s)},l}function Hg(e){return e=oi(e),e.tag=3,e}function Vg(e,s,l,c){var m=l.type.getDerivedStateFromError;if(typeof m=="function"){var g=c.value;e.payload=function(){return m(g)},e.callback=function(){Fg(s,l,c)}}var j=l.stateNode;j!==null&&typeof j.componentDidCatch=="function"&&(e.callback=function(){Fg(s,l,c),typeof m!="function"&&(mi===null?mi=new Set([this]):mi.add(this));var D=c.stack;this.componentDidCatch(c.value,{componentStack:D!==null?D:""})})}function Kw(e,s,l,c,m){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(s=l.alternate,s!==null&&Da(s,l,m,!0),l=Nr.current,l!==null){switch(l.tag){case 31:case 13:return Fr===null?nu():l.alternate===null&&Dn===0&&(Dn=3),l.flags&=-257,l.flags|=65536,l.lanes=m,c===Rc?l.flags|=16384:(s=l.updateQueue,s===null?l.updateQueue=new Set([c]):s.add(c),Zh(e,c,m)),!1;case 22:return l.flags|=65536,c===Rc?l.flags|=16384:(s=l.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=s):(l=s.retryQueue,l===null?s.retryQueue=new Set([c]):l.add(c)),Zh(e,c,m)),!1}throw Error(a(435,l.tag))}return Zh(e,c,m),nu(),!1}if(Zt)return s=Nr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=m,c!==Kd&&(e=Error(a(422),{cause:c}),Yl(Br(e,l)))):(c!==Kd&&(s=Error(a(423),{cause:c}),Yl(Br(s,l))),e=e.current.alternate,e.flags|=65536,m&=-m,e.lanes|=m,c=Br(c,l),m=kh(e.stateNode,c,m),sh(e,m),Dn!==4&&(Dn=2)),!1;var g=Error(a(520),{cause:c});if(g=Br(g,l),po===null?po=[g]:po.push(g),Dn!==4&&(Dn=2),s===null)return!0;c=Br(c,l),l=s;do{switch(l.tag){case 3:return l.flags|=65536,e=m&-m,l.lanes|=e,e=kh(l.stateNode,c,e),sh(l,e),!1;case 1:if(s=l.type,g=l.stateNode,(l.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(mi===null||!mi.has(g))))return l.flags|=65536,m&=-m,l.lanes|=m,m=Hg(m),Vg(m,e,l,c),sh(l,m),!1}l=l.return}while(l!==null);return!1}var Th=Error(a(461)),qn=!1;function sr(e,s,l,c){s.child=e===null?Wm(s,null,l,c):Xi(s,e.child,l,c)}function Gg(e,s,l,c,m){l=l.render;var g=s.ref;if("ref"in c){var j={};for(var D in c)D!=="ref"&&(j[D]=c[D])}else j=c;return Yi(s),c=uh(e,s,l,j,g,m),D=dh(),e!==null&&!qn?(hh(e,s,m),As(e,s,m)):(Zt&&D&&Vd(s),s.flags|=1,sr(e,s,c,m),s.child)}function Kg(e,s,l,c,m){if(e===null){var g=l.type;return typeof g=="function"&&!qd(g)&&g.defaultProps===void 0&&l.compare===null?(s.tag=15,s.type=g,Yg(e,s,g,c,m)):(e=Cc(l.type,null,c,s,s.mode,m),e.ref=s.ref,e.return=s,s.child=e)}if(g=e.child,!Uh(e,m)){var j=g.memoizedProps;if(l=l.compare,l=l!==null?l:Vl,l(j,c)&&e.ref===s.ref)return As(e,s,m)}return s.flags|=1,e=_s(g,c),e.ref=s.ref,e.return=s,s.child=e}function Yg(e,s,l,c,m){if(e!==null){var g=e.memoizedProps;if(Vl(g,c)&&e.ref===s.ref)if(qn=!1,s.pendingProps=c=g,Uh(e,m))(e.flags&131072)!==0&&(qn=!0);else return s.lanes=e.lanes,As(e,s,m)}return Ah(e,s,l,c,m)}function Wg(e,s,l,c){var m=c.children,g=e!==null?e.memoizedState:null;if(e===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((s.flags&128)!==0){if(g=g!==null?g.baseLanes|l:l,e!==null){for(c=s.child=e.child,m=0;c!==null;)m=m|c.lanes|c.childLanes,c=c.sibling;c=m&~g}else c=0,s.child=null;return Qg(e,s,g,l,c)}if((l&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},e!==null&&Tc(s,g!==null?g.cachePool:null),g!==null?Xm(s,g):ah(),Zm(s);else return c=s.lanes=536870912,Qg(e,s,g!==null?g.baseLanes|l:l,l,c)}else g!==null?(Tc(s,g.cachePool),Xm(s,g),di(),s.memoizedState=null):(e!==null&&Tc(s,null),ah(),di());return sr(e,s,m,l),s.child}function ao(e,s){return e!==null&&e.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Qg(e,s,l,c,m){var g=eh();return g=g===null?null:{parent:$n._currentValue,pool:g},s.memoizedState={baseLanes:l,cachePool:g},e!==null&&Tc(s,null),ah(),Zm(s),e!==null&&Da(e,s,c,!0),s.childLanes=m,null}function Vc(e,s){return s=Kc({mode:s.mode,children:s.children},e.mode),s.ref=e.ref,e.child=s,s.return=e,s}function Jg(e,s,l){return Xi(s,e.child,null,l),e=Vc(s,s.pendingProps),e.flags|=2,Er(s),s.memoizedState=null,e}function Yw(e,s,l){var c=s.pendingProps,m=(s.flags&128)!==0;if(s.flags&=-129,e===null){if(Zt){if(c.mode==="hidden")return e=Vc(s,c),s.lanes=536870912,ao(null,e);if(oh(s),(e=Cn)?(e=cv(e,qr),e=e!==null&&e.data==="&"?e:null,e!==null&&(s.memoizedState={dehydrated:e,treeContext:ri!==null?{id:ps,overflow:ms}:null,retryLane:536870912,hydrationErrors:null},l=Mm(e),l.return=s,s.child=l,nr=s,Cn=null)):e=null,e===null)throw ii(s);return s.lanes=536870912,null}return Vc(s,c)}var g=e.memoizedState;if(g!==null){var j=g.dehydrated;if(oh(s),m)if(s.flags&256)s.flags&=-257,s=Jg(e,s,l);else if(s.memoizedState!==null)s.child=e.child,s.flags|=128,s=null;else throw Error(a(558));else if(qn||Da(e,s,l,!1),m=(l&e.childLanes)!==0,qn||m){if(c=wn,c!==null&&(j=Lt(c,l),j!==0&&j!==g.retryLane))throw g.retryLane=j,Hi(e,j),wr(c,e,j),Th;nu(),s=Jg(e,s,l)}else e=g.treeContext,Cn=Hr(j.nextSibling),nr=s,Zt=!0,si=null,qr=!1,e!==null&&Um(s,e),s=Vc(s,c),s.flags|=4096;return s}return e=_s(e.child,{mode:c.mode,children:c.children}),e.ref=s.ref,s.child=e,e.return=s,e}function Gc(e,s){var l=s.ref;if(l===null)e!==null&&e.ref!==null&&(s.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(a(284));(e===null||e.ref!==l)&&(s.flags|=4194816)}}function Ah(e,s,l,c,m){return Yi(s),l=uh(e,s,l,c,void 0,m),c=dh(),e!==null&&!qn?(hh(e,s,m),As(e,s,m)):(Zt&&c&&Vd(s),s.flags|=1,sr(e,s,l,m),s.child)}function Xg(e,s,l,c,m,g){return Yi(s),s.updateQueue=null,l=tg(s,c,l,m),eg(e),c=dh(),e!==null&&!qn?(hh(e,s,g),As(e,s,g)):(Zt&&c&&Vd(s),s.flags|=1,sr(e,s,l,g),s.child)}function Zg(e,s,l,c,m){if(Yi(s),s.stateNode===null){var g=Ta,j=l.contextType;typeof j=="object"&&j!==null&&(g=rr(j)),g=new l(c,g),s.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Eh,s.stateNode=g,g._reactInternals=s,g=s.stateNode,g.props=c,g.state=s.memoizedState,g.refs={},nh(s),j=l.contextType,g.context=typeof j=="object"&&j!==null?rr(j):Ta,g.state=s.memoizedState,j=l.getDerivedStateFromProps,typeof j=="function"&&(Nh(s,l,j,c),g.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(j=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),j!==g.state&&Eh.enqueueReplaceState(g,g.state,null),to(s,c,g,m),eo(),g.state=s.memoizedState),typeof g.componentDidMount=="function"&&(s.flags|=4194308),c=!0}else if(e===null){g=s.stateNode;var D=s.memoizedProps,X=ea(l,D);g.props=X;var ye=g.context,Ae=l.contextType;j=Ta,typeof Ae=="object"&&Ae!==null&&(j=rr(Ae));var Le=l.getDerivedStateFromProps;Ae=typeof Le=="function"||typeof g.getSnapshotBeforeUpdate=="function",D=s.pendingProps!==D,Ae||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(D||ye!==j)&&Bg(s,g,c,j),li=!1;var be=s.memoizedState;g.state=be,to(s,c,g,m),eo(),ye=s.memoizedState,D||be!==ye||li?(typeof Le=="function"&&(Nh(s,l,Le,c),ye=s.memoizedState),(X=li||Ig(s,l,X,c,be,ye,j))?(Ae||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(s.flags|=4194308)):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=c,s.memoizedState=ye),g.props=c,g.state=ye,g.context=j,c=X):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),c=!1)}else{g=s.stateNode,rh(e,s),j=s.memoizedProps,Ae=ea(l,j),g.props=Ae,Le=s.pendingProps,be=g.context,ye=l.contextType,X=Ta,typeof ye=="object"&&ye!==null&&(X=rr(ye)),D=l.getDerivedStateFromProps,(ye=typeof D=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(j!==Le||be!==X)&&Bg(s,g,c,X),li=!1,be=s.memoizedState,g.state=be,to(s,c,g,m),eo();var Ce=s.memoizedState;j!==Le||be!==Ce||li||e!==null&&e.dependencies!==null&&Ec(e.dependencies)?(typeof D=="function"&&(Nh(s,l,D,c),Ce=s.memoizedState),(Ae=li||Ig(s,l,Ae,c,be,Ce,X)||e!==null&&e.dependencies!==null&&Ec(e.dependencies))?(ye||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,Ce,X),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,Ce,X)),typeof g.componentDidUpdate=="function"&&(s.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof g.componentDidUpdate!="function"||j===e.memoizedProps&&be===e.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&be===e.memoizedState||(s.flags|=1024),s.memoizedProps=c,s.memoizedState=Ce),g.props=c,g.state=Ce,g.context=X,c=Ae):(typeof g.componentDidUpdate!="function"||j===e.memoizedProps&&be===e.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&be===e.memoizedState||(s.flags|=1024),c=!1)}return g=c,Gc(e,s),c=(s.flags&128)!==0,g||c?(g=s.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:g.render(),s.flags|=1,e!==null&&c?(s.child=Xi(s,e.child,null,m),s.child=Xi(s,null,l,m)):sr(e,s,l,m),s.memoizedState=g.state,e=s.child):e=As(e,s,m),e}function ey(e,s,l,c){return Gi(),s.flags|=256,sr(e,s,l,c),s.child}var Rh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Oh(e){return{baseLanes:e,cachePool:Fm()}}function Dh(e,s,l){return e=e!==null?e.childLanes&~l:0,s&&(e|=Tr),e}function ty(e,s,l){var c=s.pendingProps,m=!1,g=(s.flags&128)!==0,j;if((j=g)||(j=e!==null&&e.memoizedState===null?!1:(Un.current&2)!==0),j&&(m=!0,s.flags&=-129),j=(s.flags&32)!==0,s.flags&=-33,e===null){if(Zt){if(m?ui(s):di(),(e=Cn)?(e=cv(e,qr),e=e!==null&&e.data!=="&"?e:null,e!==null&&(s.memoizedState={dehydrated:e,treeContext:ri!==null?{id:ps,overflow:ms}:null,retryLane:536870912,hydrationErrors:null},l=Mm(e),l.return=s,s.child=l,nr=s,Cn=null)):e=null,e===null)throw ii(s);return gf(e)?s.lanes=32:s.lanes=536870912,null}var D=c.children;return c=c.fallback,m?(di(),m=s.mode,D=Kc({mode:"hidden",children:D},m),c=Vi(c,m,l,null),D.return=s,c.return=s,D.sibling=c,s.child=D,c=s.child,c.memoizedState=Oh(l),c.childLanes=Dh(e,j,l),s.memoizedState=Rh,ao(null,c)):(ui(s),Mh(s,D))}var X=e.memoizedState;if(X!==null&&(D=X.dehydrated,D!==null)){if(g)s.flags&256?(ui(s),s.flags&=-257,s=Lh(e,s,l)):s.memoizedState!==null?(di(),s.child=e.child,s.flags|=128,s=null):(di(),D=c.fallback,m=s.mode,c=Kc({mode:"visible",children:c.children},m),D=Vi(D,m,l,null),D.flags|=2,c.return=s,D.return=s,c.sibling=D,s.child=c,Xi(s,e.child,null,l),c=s.child,c.memoizedState=Oh(l),c.childLanes=Dh(e,j,l),s.memoizedState=Rh,s=ao(null,c));else if(ui(s),gf(D)){if(j=D.nextSibling&&D.nextSibling.dataset,j)var ye=j.dgst;j=ye,c=Error(a(419)),c.stack="",c.digest=j,Yl({value:c,source:null,stack:null}),s=Lh(e,s,l)}else if(qn||Da(e,s,l,!1),j=(l&e.childLanes)!==0,qn||j){if(j=wn,j!==null&&(c=Lt(j,l),c!==0&&c!==X.retryLane))throw X.retryLane=c,Hi(e,c),wr(j,e,c),Th;mf(D)||nu(),s=Lh(e,s,l)}else mf(D)?(s.flags|=192,s.child=e.child,s=null):(e=X.treeContext,Cn=Hr(D.nextSibling),nr=s,Zt=!0,si=null,qr=!1,e!==null&&Um(s,e),s=Mh(s,c.children),s.flags|=4096);return s}return m?(di(),D=c.fallback,m=s.mode,X=e.child,ye=X.sibling,c=_s(X,{mode:"hidden",children:c.children}),c.subtreeFlags=X.subtreeFlags&65011712,ye!==null?D=_s(ye,D):(D=Vi(D,m,l,null),D.flags|=2),D.return=s,c.return=s,c.sibling=D,s.child=c,ao(null,c),c=s.child,D=e.child.memoizedState,D===null?D=Oh(l):(m=D.cachePool,m!==null?(X=$n._currentValue,m=m.parent!==X?{parent:X,pool:X}:m):m=Fm(),D={baseLanes:D.baseLanes|l,cachePool:m}),c.memoizedState=D,c.childLanes=Dh(e,j,l),s.memoizedState=Rh,ao(e.child,c)):(ui(s),l=e.child,e=l.sibling,l=_s(l,{mode:"visible",children:c.children}),l.return=s,l.sibling=null,e!==null&&(j=s.deletions,j===null?(s.deletions=[e],s.flags|=16):j.push(e)),s.child=l,s.memoizedState=null,l)}function Mh(e,s){return s=Kc({mode:"visible",children:s},e.mode),s.return=e,e.child=s}function Kc(e,s){return e=Cr(22,e,null,s),e.lanes=0,e}function Lh(e,s,l){return Xi(s,e.child,null,l),e=Mh(s,s.pendingProps.children),e.flags|=2,s.memoizedState=null,e}function ny(e,s,l){e.lanes|=s;var c=e.alternate;c!==null&&(c.lanes|=s),Qd(e.return,s,l)}function zh(e,s,l,c,m,g){var j=e.memoizedState;j===null?e.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:m,treeForkCount:g}:(j.isBackwards=s,j.rendering=null,j.renderingStartTime=0,j.last=c,j.tail=l,j.tailMode=m,j.treeForkCount=g)}function ry(e,s,l){var c=s.pendingProps,m=c.revealOrder,g=c.tail;c=c.children;var j=Un.current,D=(j&2)!==0;if(D?(j=j&1|2,s.flags|=128):j&=1,K(Un,j),sr(e,s,c,l),c=Zt?Kl:0,!D&&e!==null&&(e.flags&128)!==0)e:for(e=s.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ny(e,l,s);else if(e.tag===19)ny(e,l,s);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break e;for(;e.sibling===null;){if(e.return===null||e.return===s)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(m){case"forwards":for(l=s.child,m=null;l!==null;)e=l.alternate,e!==null&&Lc(e)===null&&(m=l),l=l.sibling;l=m,l===null?(m=s.child,s.child=null):(m=l.sibling,l.sibling=null),zh(s,!1,m,l,g,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,m=s.child,s.child=null;m!==null;){if(e=m.alternate,e!==null&&Lc(e)===null){s.child=m;break}e=m.sibling,m.sibling=l,l=m,m=e}zh(s,!0,l,null,g,c);break;case"together":zh(s,!1,null,null,void 0,c);break;default:s.memoizedState=null}return s.child}function As(e,s,l){if(e!==null&&(s.dependencies=e.dependencies),pi|=s.lanes,(l&s.childLanes)===0)if(e!==null){if(Da(e,s,l,!1),(l&s.childLanes)===0)return null}else return null;if(e!==null&&s.child!==e.child)throw Error(a(153));if(s.child!==null){for(e=s.child,l=_s(e,e.pendingProps),s.child=l,l.return=s;e.sibling!==null;)e=e.sibling,l=l.sibling=_s(e,e.pendingProps),l.return=s;l.sibling=null}return s.child}function Uh(e,s){return(e.lanes&s)!==0?!0:(e=e.dependencies,!!(e!==null&&Ec(e)))}function Ww(e,s,l){switch(s.tag){case 3:W(s,s.stateNode.containerInfo),ai(s,$n,e.memoizedState.cache),Gi();break;case 27:case 5:ke(s);break;case 4:W(s,s.stateNode.containerInfo);break;case 10:ai(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,oh(s),null;break;case 13:var c=s.memoizedState;if(c!==null)return c.dehydrated!==null?(ui(s),s.flags|=128,null):(l&s.child.childLanes)!==0?ty(e,s,l):(ui(s),e=As(e,s,l),e!==null?e.sibling:null);ui(s);break;case 19:var m=(e.flags&128)!==0;if(c=(l&s.childLanes)!==0,c||(Da(e,s,l,!1),c=(l&s.childLanes)!==0),m){if(c)return ry(e,s,l);s.flags|=128}if(m=s.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),K(Un,Un.current),c)break;return null;case 22:return s.lanes=0,Wg(e,s,l,s.pendingProps);case 24:ai(s,$n,e.memoizedState.cache)}return As(e,s,l)}function sy(e,s,l){if(e!==null)if(e.memoizedProps!==s.pendingProps)qn=!0;else{if(!Uh(e,l)&&(s.flags&128)===0)return qn=!1,Ww(e,s,l);qn=(e.flags&131072)!==0}else qn=!1,Zt&&(s.flags&1048576)!==0&&zm(s,Kl,s.index);switch(s.lanes=0,s.tag){case 16:e:{var c=s.pendingProps;if(e=Qi(s.elementType),s.type=e,typeof e=="function")qd(e)?(c=ea(e,c),s.tag=1,s=Zg(null,s,e,c,l)):(s.tag=0,s=Ah(null,s,e,c,l));else{if(e!=null){var m=e.$$typeof;if(m===R){s.tag=11,s=Gg(null,s,e,c,l);break e}else if(m===V){s.tag=14,s=Kg(null,s,e,c,l);break e}}throw s=$(e)||e,Error(a(306,s,""))}}return s;case 0:return Ah(e,s,s.type,s.pendingProps,l);case 1:return c=s.type,m=ea(c,s.pendingProps),Zg(e,s,c,m,l);case 3:e:{if(W(s,s.stateNode.containerInfo),e===null)throw Error(a(387));c=s.pendingProps;var g=s.memoizedState;m=g.element,rh(e,s),to(s,c,null,l);var j=s.memoizedState;if(c=j.cache,ai(s,$n,c),c!==g.cache&&Jd(s,[$n],l,!0),eo(),c=j.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:j.cache},s.updateQueue.baseState=g,s.memoizedState=g,s.flags&256){s=ey(e,s,c,l);break e}else if(c!==m){m=Br(Error(a(424)),s),Yl(m),s=ey(e,s,c,l);break e}else for(e=s.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,Cn=Hr(e.firstChild),nr=s,Zt=!0,si=null,qr=!0,l=Wm(s,null,c,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Gi(),c===m){s=As(e,s,l);break e}sr(e,s,c,l)}s=s.child}return s;case 26:return Gc(e,s),e===null?(l=mv(s.type,null,s.pendingProps,null))?s.memoizedState=l:Zt||(l=s.type,e=s.pendingProps,c=cu(ve.current).createElement(l),c[$e]=s,c[ze]=e,ir(c,l,e),jt(c),s.stateNode=c):s.memoizedState=mv(s.type,e.memoizedProps,s.pendingProps,e.memoizedState),null;case 27:return ke(s),e===null&&Zt&&(c=s.stateNode=hv(s.type,s.pendingProps,ve.current),nr=s,qr=!0,m=Cn,xi(s.type)?(yf=m,Cn=Hr(c.firstChild)):Cn=m),sr(e,s,s.pendingProps.children,l),Gc(e,s),e===null&&(s.flags|=4194304),s.child;case 5:return e===null&&Zt&&((m=c=Cn)&&(c=CS(c,s.type,s.pendingProps,qr),c!==null?(s.stateNode=c,nr=s,Cn=Hr(c.firstChild),qr=!1,m=!0):m=!1),m||ii(s)),ke(s),m=s.type,g=s.pendingProps,j=e!==null?e.memoizedProps:null,c=g.children,hf(m,g)?c=null:j!==null&&hf(m,j)&&(s.flags|=32),s.memoizedState!==null&&(m=uh(e,s,$w,null,null,l),So._currentValue=m),Gc(e,s),sr(e,s,c,l),s.child;case 6:return e===null&&Zt&&((e=l=Cn)&&(l=NS(l,s.pendingProps,qr),l!==null?(s.stateNode=l,nr=s,Cn=null,e=!0):e=!1),e||ii(s)),null;case 13:return ty(e,s,l);case 4:return W(s,s.stateNode.containerInfo),c=s.pendingProps,e===null?s.child=Xi(s,null,c,l):sr(e,s,c,l),s.child;case 11:return Gg(e,s,s.type,s.pendingProps,l);case 7:return sr(e,s,s.pendingProps,l),s.child;case 8:return sr(e,s,s.pendingProps.children,l),s.child;case 12:return sr(e,s,s.pendingProps.children,l),s.child;case 10:return c=s.pendingProps,ai(s,s.type,c.value),sr(e,s,c.children,l),s.child;case 9:return m=s.type._context,c=s.pendingProps.children,Yi(s),m=rr(m),c=c(m),s.flags|=1,sr(e,s,c,l),s.child;case 14:return Kg(e,s,s.type,s.pendingProps,l);case 15:return Yg(e,s,s.type,s.pendingProps,l);case 19:return ry(e,s,l);case 31:return Yw(e,s,l);case 22:return Wg(e,s,l,s.pendingProps);case 24:return Yi(s),c=rr($n),e===null?(m=eh(),m===null&&(m=wn,g=Xd(),m.pooledCache=g,g.refCount++,g!==null&&(m.pooledCacheLanes|=l),m=g),s.memoizedState={parent:c,cache:m},nh(s),ai(s,$n,m)):((e.lanes&l)!==0&&(rh(e,s),to(s,null,null,l),eo()),m=e.memoizedState,g=s.memoizedState,m.parent!==c?(m={parent:c,cache:c},s.memoizedState=m,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=m),ai(s,$n,c)):(c=g.cache,ai(s,$n,c),c!==m.cache&&Jd(s,[$n],l,!0))),sr(e,s,s.pendingProps.children,l),s.child;case 29:throw s.pendingProps}throw Error(a(156,s.tag))}function Rs(e){e.flags|=4}function Ih(e,s,l,c,m){if((s=(e.mode&32)!==0)&&(s=!1),s){if(e.flags|=16777216,(m&335544128)===m)if(e.stateNode.complete)e.flags|=8192;else if(Ry())e.flags|=8192;else throw Ji=Rc,th}else e.flags&=-16777217}function iy(e,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!bv(s))if(Ry())e.flags|=8192;else throw Ji=Rc,th}function Yc(e,s){s!==null&&(e.flags|=4),e.flags&16384&&(s=e.tag!==22?Vt():536870912,e.lanes|=s,Va|=s)}function lo(e,s){if(!Zt)switch(e.tailMode){case"hidden":s=e.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?s||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Nn(e){var s=e.alternate!==null&&e.alternate.child===e.child,l=0,c=0;if(s)for(var m=e.child;m!==null;)l|=m.lanes|m.childLanes,c|=m.subtreeFlags&65011712,c|=m.flags&65011712,m.return=e,m=m.sibling;else for(m=e.child;m!==null;)l|=m.lanes|m.childLanes,c|=m.subtreeFlags,c|=m.flags,m.return=e,m=m.sibling;return e.subtreeFlags|=c,e.childLanes=l,s}function Qw(e,s,l){var c=s.pendingProps;switch(Gd(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nn(s),null;case 1:return Nn(s),null;case 3:return l=s.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),Es($n),me(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(Oa(s)?Rs(s):e===null||e.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Yd())),Nn(s),null;case 26:var m=s.type,g=s.memoizedState;return e===null?(Rs(s),g!==null?(Nn(s),iy(s,g)):(Nn(s),Ih(s,m,null,c,l))):g?g!==e.memoizedState?(Rs(s),Nn(s),iy(s,g)):(Nn(s),s.flags&=-16777217):(e=e.memoizedProps,e!==c&&Rs(s),Nn(s),Ih(s,m,e,c,l)),null;case 27:if(ie(s),l=ve.current,m=s.type,e!==null&&s.stateNode!=null)e.memoizedProps!==c&&Rs(s);else{if(!c){if(s.stateNode===null)throw Error(a(166));return Nn(s),null}e=de.current,Oa(s)?Im(s):(e=hv(m,c,l),s.stateNode=e,Rs(s))}return Nn(s),null;case 5:if(ie(s),m=s.type,e!==null&&s.stateNode!=null)e.memoizedProps!==c&&Rs(s);else{if(!c){if(s.stateNode===null)throw Error(a(166));return Nn(s),null}if(g=de.current,Oa(s))Im(s);else{var j=cu(ve.current);switch(g){case 1:g=j.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:g=j.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":g=j.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":g=j.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":g=j.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof c.is=="string"?j.createElement("select",{is:c.is}):j.createElement("select"),c.multiple?g.multiple=!0:c.size&&(g.size=c.size);break;default:g=typeof c.is=="string"?j.createElement(m,{is:c.is}):j.createElement(m)}}g[$e]=s,g[ze]=c;e:for(j=s.child;j!==null;){if(j.tag===5||j.tag===6)g.appendChild(j.stateNode);else if(j.tag!==4&&j.tag!==27&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===s)break e;for(;j.sibling===null;){if(j.return===null||j.return===s)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}s.stateNode=g;e:switch(ir(g,m,c),m){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Rs(s)}}return Nn(s),Ih(s,s.type,e===null?null:e.memoizedProps,s.pendingProps,l),null;case 6:if(e&&s.stateNode!=null)e.memoizedProps!==c&&Rs(s);else{if(typeof c!="string"&&s.stateNode===null)throw Error(a(166));if(e=ve.current,Oa(s)){if(e=s.stateNode,l=s.memoizedProps,c=null,m=nr,m!==null)switch(m.tag){case 27:case 5:c=m.memoizedProps}e[$e]=s,e=!!(e.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||tv(e.nodeValue,l)),e||ii(s,!0)}else e=cu(e).createTextNode(c),e[$e]=s,s.stateNode=e}return Nn(s),null;case 31:if(l=s.memoizedState,e===null||e.memoizedState!==null){if(c=Oa(s),l!==null){if(e===null){if(!c)throw Error(a(318));if(e=s.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[$e]=s}else Gi(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Nn(s),e=!1}else l=Yd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=l),e=!0;if(!e)return s.flags&256?(Er(s),s):(Er(s),null);if((s.flags&128)!==0)throw Error(a(558))}return Nn(s),null;case 13:if(c=s.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(m=Oa(s),c!==null&&c.dehydrated!==null){if(e===null){if(!m)throw Error(a(318));if(m=s.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(a(317));m[$e]=s}else Gi(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Nn(s),m=!1}else m=Yd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=m),m=!0;if(!m)return s.flags&256?(Er(s),s):(Er(s),null)}return Er(s),(s.flags&128)!==0?(s.lanes=l,s):(l=c!==null,e=e!==null&&e.memoizedState!==null,l&&(c=s.child,m=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(m=c.alternate.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==m&&(c.flags|=2048)),l!==e&&l&&(s.child.flags|=8192),Yc(s,s.updateQueue),Nn(s),null);case 4:return me(),e===null&&lf(s.stateNode.containerInfo),Nn(s),null;case 10:return Es(s.type),Nn(s),null;case 19:if(O(Un),c=s.memoizedState,c===null)return Nn(s),null;if(m=(s.flags&128)!==0,g=c.rendering,g===null)if(m)lo(c,!1);else{if(Dn!==0||e!==null&&(e.flags&128)!==0)for(e=s.child;e!==null;){if(g=Lc(e),g!==null){for(s.flags|=128,lo(c,!1),e=g.updateQueue,s.updateQueue=e,Yc(s,e),s.subtreeFlags=0,e=l,l=s.child;l!==null;)Dm(l,e),l=l.sibling;return K(Un,Un.current&1|2),Zt&&Cs(s,c.treeForkCount),s.child}e=e.sibling}c.tail!==null&&dt()>Zc&&(s.flags|=128,m=!0,lo(c,!1),s.lanes=4194304)}else{if(!m)if(e=Lc(g),e!==null){if(s.flags|=128,m=!0,e=e.updateQueue,s.updateQueue=e,Yc(s,e),lo(c,!0),c.tail===null&&c.tailMode==="hidden"&&!g.alternate&&!Zt)return Nn(s),null}else 2*dt()-c.renderingStartTime>Zc&&l!==536870912&&(s.flags|=128,m=!0,lo(c,!1),s.lanes=4194304);c.isBackwards?(g.sibling=s.child,s.child=g):(e=c.last,e!==null?e.sibling=g:s.child=g,c.last=g)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=dt(),e.sibling=null,l=Un.current,K(Un,m?l&1|2:l&1),Zt&&Cs(s,c.treeForkCount),e):(Nn(s),null);case 22:case 23:return Er(s),lh(),c=s.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(s.flags|=8192):c&&(s.flags|=8192),c?(l&536870912)!==0&&(s.flags&128)===0&&(Nn(s),s.subtreeFlags&6&&(s.flags|=8192)):Nn(s),l=s.updateQueue,l!==null&&Yc(s,l.retryQueue),l=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),c=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),c!==l&&(s.flags|=2048),e!==null&&O(Wi),null;case 24:return l=null,e!==null&&(l=e.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),Es($n),Nn(s),null;case 25:return null;case 30:return null}throw Error(a(156,s.tag))}function Jw(e,s){switch(Gd(s),s.tag){case 1:return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 3:return Es($n),me(),e=s.flags,(e&65536)!==0&&(e&128)===0?(s.flags=e&-65537|128,s):null;case 26:case 27:case 5:return ie(s),null;case 31:if(s.memoizedState!==null){if(Er(s),s.alternate===null)throw Error(a(340));Gi()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 13:if(Er(s),e=s.memoizedState,e!==null&&e.dehydrated!==null){if(s.alternate===null)throw Error(a(340));Gi()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 19:return O(Un),null;case 4:return me(),null;case 10:return Es(s.type),null;case 22:case 23:return Er(s),lh(),e!==null&&O(Wi),e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 24:return Es($n),null;case 25:return null;default:return null}}function ay(e,s){switch(Gd(s),s.tag){case 3:Es($n),me();break;case 26:case 27:case 5:ie(s);break;case 4:me();break;case 31:s.memoizedState!==null&&Er(s);break;case 13:Er(s);break;case 19:O(Un);break;case 10:Es(s.type);break;case 22:case 23:Er(s),lh(),e!==null&&O(Wi);break;case 24:Es($n)}}function oo(e,s){try{var l=s.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var m=c.next;l=m;do{if((l.tag&e)===e){c=void 0;var g=l.create,j=l.inst;c=g(),j.destroy=c}l=l.next}while(l!==m)}}catch(D){mn(s,s.return,D)}}function hi(e,s,l){try{var c=s.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var g=m.next;c=g;do{if((c.tag&e)===e){var j=c.inst,D=j.destroy;if(D!==void 0){j.destroy=void 0,m=s;var X=l,ye=D;try{ye()}catch(Ae){mn(m,X,Ae)}}}c=c.next}while(c!==g)}}catch(Ae){mn(s,s.return,Ae)}}function ly(e){var s=e.updateQueue;if(s!==null){var l=e.stateNode;try{Jm(s,l)}catch(c){mn(e,e.return,c)}}}function oy(e,s,l){l.props=ea(e.type,e.memoizedProps),l.state=e.memoizedState;try{l.componentWillUnmount()}catch(c){mn(e,s,c)}}function co(e,s){try{var l=e.ref;if(l!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof l=="function"?e.refCleanup=l(c):l.current=c}}catch(m){mn(e,s,m)}}function gs(e,s){var l=e.ref,c=e.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(m){mn(e,s,m)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(m){mn(e,s,m)}else l.current=null}function cy(e){var s=e.type,l=e.memoizedProps,c=e.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(m){mn(e,e.return,m)}}function Bh(e,s,l){try{var c=e.stateNode;xS(c,e.type,l,s),c[ze]=s}catch(m){mn(e,e.return,m)}}function uy(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&xi(e.type)||e.tag===4}function $h(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||uy(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&xi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ph(e,s,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,s?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(e,s):(s=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,s.appendChild(e),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=zr));else if(c!==4&&(c===27&&xi(e.type)&&(l=e.stateNode,s=null),e=e.child,e!==null))for(Ph(e,s,l),e=e.sibling;e!==null;)Ph(e,s,l),e=e.sibling}function Wc(e,s,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,s?l.insertBefore(e,s):l.appendChild(e);else if(c!==4&&(c===27&&xi(e.type)&&(l=e.stateNode),e=e.child,e!==null))for(Wc(e,s,l),e=e.sibling;e!==null;)Wc(e,s,l),e=e.sibling}function dy(e){var s=e.stateNode,l=e.memoizedProps;try{for(var c=e.type,m=s.attributes;m.length;)s.removeAttributeNode(m[0]);ir(s,c,l),s[$e]=e,s[ze]=l}catch(g){mn(e,e.return,g)}}var Os=!1,Fn=!1,qh=!1,hy=typeof WeakSet=="function"?WeakSet:Set,Xn=null;function Xw(e,s){if(e=e.containerInfo,uf=gu,e=_m(e),Ld(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var m=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var j=0,D=-1,X=-1,ye=0,Ae=0,Le=e,be=null;t:for(;;){for(var Ce;Le!==l||m!==0&&Le.nodeType!==3||(D=j+m),Le!==g||c!==0&&Le.nodeType!==3||(X=j+c),Le.nodeType===3&&(j+=Le.nodeValue.length),(Ce=Le.firstChild)!==null;)be=Le,Le=Ce;for(;;){if(Le===e)break t;if(be===l&&++ye===m&&(D=j),be===g&&++Ae===c&&(X=j),(Ce=Le.nextSibling)!==null)break;Le=be,be=Le.parentNode}Le=Ce}l=D===-1||X===-1?null:{start:D,end:X}}else l=null}l=l||{start:0,end:0}}else l=null;for(df={focusedElem:e,selectionRange:l},gu=!1,Xn=s;Xn!==null;)if(s=Xn,e=s.child,(s.subtreeFlags&1028)!==0&&e!==null)e.return=s,Xn=e;else for(;Xn!==null;){switch(s=Xn,g=s.alternate,e=s.flags,s.tag){case 0:if((e&4)!==0&&(e=s.updateQueue,e=e!==null?e.events:null,e!==null))for(l=0;l<e.length;l++)m=e[l],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,l=s,m=g.memoizedProps,g=g.memoizedState,c=l.stateNode;try{var ft=ea(l.type,m);e=c.getSnapshotBeforeUpdate(ft,g),c.__reactInternalSnapshotBeforeUpdate=e}catch(Rt){mn(l,l.return,Rt)}}break;case 3:if((e&1024)!==0){if(e=s.stateNode.containerInfo,l=e.nodeType,l===9)pf(e);else if(l===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":pf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=s.sibling,e!==null){e.return=s.return,Xn=e;break}Xn=s.return}}function fy(e,s,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:Ms(e,l),c&4&&oo(5,l);break;case 1:if(Ms(e,l),c&4)if(e=l.stateNode,s===null)try{e.componentDidMount()}catch(j){mn(l,l.return,j)}else{var m=ea(l.type,s.memoizedProps);s=s.memoizedState;try{e.componentDidUpdate(m,s,e.__reactInternalSnapshotBeforeUpdate)}catch(j){mn(l,l.return,j)}}c&64&&ly(l),c&512&&co(l,l.return);break;case 3:if(Ms(e,l),c&64&&(e=l.updateQueue,e!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{Jm(e,s)}catch(j){mn(l,l.return,j)}}break;case 27:s===null&&c&4&&dy(l);case 26:case 5:Ms(e,l),s===null&&c&4&&cy(l),c&512&&co(l,l.return);break;case 12:Ms(e,l);break;case 31:Ms(e,l),c&4&&gy(e,l);break;case 13:Ms(e,l),c&4&&yy(e,l),c&64&&(e=l.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(l=lS.bind(null,l),ES(e,l))));break;case 22:if(c=l.memoizedState!==null||Os,!c){s=s!==null&&s.memoizedState!==null||Fn,m=Os;var g=Fn;Os=c,(Fn=s)&&!g?Ls(e,l,(l.subtreeFlags&8772)!==0):Ms(e,l),Os=m,Fn=g}break;case 30:break;default:Ms(e,l)}}function py(e){var s=e.alternate;s!==null&&(e.alternate=null,py(s)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(s=e.stateNode,s!==null&&xe(s)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Tn=null,yr=!1;function Ds(e,s,l){for(l=l.child;l!==null;)my(e,s,l),l=l.sibling}function my(e,s,l){if(rn&&typeof rn.onCommitFiberUnmount=="function")try{rn.onCommitFiberUnmount(Ft,l)}catch{}switch(l.tag){case 26:Fn||gs(l,s),Ds(e,s,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Fn||gs(l,s);var c=Tn,m=yr;xi(l.type)&&(Tn=l.stateNode,yr=!1),Ds(e,s,l),xo(l.stateNode),Tn=c,yr=m;break;case 5:Fn||gs(l,s);case 6:if(c=Tn,m=yr,Tn=null,Ds(e,s,l),Tn=c,yr=m,Tn!==null)if(yr)try{(Tn.nodeType===9?Tn.body:Tn.nodeName==="HTML"?Tn.ownerDocument.body:Tn).removeChild(l.stateNode)}catch(g){mn(l,s,g)}else try{Tn.removeChild(l.stateNode)}catch(g){mn(l,s,g)}break;case 18:Tn!==null&&(yr?(e=Tn,lv(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,l.stateNode),Za(e)):lv(Tn,l.stateNode));break;case 4:c=Tn,m=yr,Tn=l.stateNode.containerInfo,yr=!0,Ds(e,s,l),Tn=c,yr=m;break;case 0:case 11:case 14:case 15:hi(2,l,s),Fn||hi(4,l,s),Ds(e,s,l);break;case 1:Fn||(gs(l,s),c=l.stateNode,typeof c.componentWillUnmount=="function"&&oy(l,s,c)),Ds(e,s,l);break;case 21:Ds(e,s,l);break;case 22:Fn=(c=Fn)||l.memoizedState!==null,Ds(e,s,l),Fn=c;break;default:Ds(e,s,l)}}function gy(e,s){if(s.memoizedState===null&&(e=s.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Za(e)}catch(l){mn(s,s.return,l)}}}function yy(e,s){if(s.memoizedState===null&&(e=s.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Za(e)}catch(l){mn(s,s.return,l)}}function Zw(e){switch(e.tag){case 31:case 13:case 19:var s=e.stateNode;return s===null&&(s=e.stateNode=new hy),s;case 22:return e=e.stateNode,s=e._retryCache,s===null&&(s=e._retryCache=new hy),s;default:throw Error(a(435,e.tag))}}function Qc(e,s){var l=Zw(e);s.forEach(function(c){if(!l.has(c)){l.add(c);var m=oS.bind(null,e,c);c.then(m,m)}})}function vr(e,s){var l=s.deletions;if(l!==null)for(var c=0;c<l.length;c++){var m=l[c],g=e,j=s,D=j;e:for(;D!==null;){switch(D.tag){case 27:if(xi(D.type)){Tn=D.stateNode,yr=!1;break e}break;case 5:Tn=D.stateNode,yr=!1;break e;case 3:case 4:Tn=D.stateNode.containerInfo,yr=!0;break e}D=D.return}if(Tn===null)throw Error(a(160));my(g,j,m),Tn=null,yr=!1,g=m.alternate,g!==null&&(g.return=null),m.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)vy(s,e),s=s.sibling}var rs=null;function vy(e,s){var l=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:vr(s,e),xr(e),c&4&&(hi(3,e,e.return),oo(3,e),hi(5,e,e.return));break;case 1:vr(s,e),xr(e),c&512&&(Fn||l===null||gs(l,l.return)),c&64&&Os&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(l=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var m=rs;if(vr(s,e),xr(e),c&512&&(Fn||l===null||gs(l,l.return)),c&4){var g=l!==null?l.memoizedState:null;if(c=e.memoizedState,l===null)if(c===null)if(e.stateNode===null){e:{c=e.type,l=e.memoizedProps,m=m.ownerDocument||m;t:switch(c){case"title":g=m.getElementsByTagName("title")[0],(!g||g[ue]||g[$e]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=m.createElement(c),m.head.insertBefore(g,m.querySelector("head > title"))),ir(g,c,l),g[$e]=e,jt(g),c=g;break e;case"link":var j=vv("link","href",m).get(c+(l.href||""));if(j){for(var D=0;D<j.length;D++)if(g=j[D],g.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&g.getAttribute("rel")===(l.rel==null?null:l.rel)&&g.getAttribute("title")===(l.title==null?null:l.title)&&g.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){j.splice(D,1);break t}}g=m.createElement(c),ir(g,c,l),m.head.appendChild(g);break;case"meta":if(j=vv("meta","content",m).get(c+(l.content||""))){for(D=0;D<j.length;D++)if(g=j[D],g.getAttribute("content")===(l.content==null?null:""+l.content)&&g.getAttribute("name")===(l.name==null?null:l.name)&&g.getAttribute("property")===(l.property==null?null:l.property)&&g.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&g.getAttribute("charset")===(l.charSet==null?null:l.charSet)){j.splice(D,1);break t}}g=m.createElement(c),ir(g,c,l),m.head.appendChild(g);break;default:throw Error(a(468,c))}g[$e]=e,jt(g),c=g}e.stateNode=c}else xv(m,e.type,e.stateNode);else e.stateNode=yv(m,c,e.memoizedProps);else g!==c?(g===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):g.count--,c===null?xv(m,e.type,e.stateNode):yv(m,c,e.memoizedProps)):c===null&&e.stateNode!==null&&Bh(e,e.memoizedProps,l.memoizedProps)}break;case 27:vr(s,e),xr(e),c&512&&(Fn||l===null||gs(l,l.return)),l!==null&&c&4&&Bh(e,e.memoizedProps,l.memoizedProps);break;case 5:if(vr(s,e),xr(e),c&512&&(Fn||l===null||gs(l,l.return)),e.flags&32){m=e.stateNode;try{Js(m,"")}catch(ft){mn(e,e.return,ft)}}c&4&&e.stateNode!=null&&(m=e.memoizedProps,Bh(e,m,l!==null?l.memoizedProps:m)),c&1024&&(qh=!0);break;case 6:if(vr(s,e),xr(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,l=e.stateNode;try{l.nodeValue=c}catch(ft){mn(e,e.return,ft)}}break;case 3:if(hu=null,m=rs,rs=uu(s.containerInfo),vr(s,e),rs=m,xr(e),c&4&&l!==null&&l.memoizedState.isDehydrated)try{Za(s.containerInfo)}catch(ft){mn(e,e.return,ft)}qh&&(qh=!1,xy(e));break;case 4:c=rs,rs=uu(e.stateNode.containerInfo),vr(s,e),xr(e),rs=c;break;case 12:vr(s,e),xr(e);break;case 31:vr(s,e),xr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Qc(e,c)));break;case 13:vr(s,e),xr(e),e.child.flags&8192&&e.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Xc=dt()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Qc(e,c)));break;case 22:m=e.memoizedState!==null;var X=l!==null&&l.memoizedState!==null,ye=Os,Ae=Fn;if(Os=ye||m,Fn=Ae||X,vr(s,e),Fn=Ae,Os=ye,xr(e),c&8192)e:for(s=e.stateNode,s._visibility=m?s._visibility&-2:s._visibility|1,m&&(l===null||X||Os||Fn||ta(e)),l=null,s=e;;){if(s.tag===5||s.tag===26){if(l===null){X=l=s;try{if(g=X.stateNode,m)j=g.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none";else{D=X.stateNode;var Le=X.memoizedProps.style,be=Le!=null&&Le.hasOwnProperty("display")?Le.display:null;D.style.display=be==null||typeof be=="boolean"?"":(""+be).trim()}}catch(ft){mn(X,X.return,ft)}}}else if(s.tag===6){if(l===null){X=s;try{X.stateNode.nodeValue=m?"":X.memoizedProps}catch(ft){mn(X,X.return,ft)}}}else if(s.tag===18){if(l===null){X=s;try{var Ce=X.stateNode;m?ov(Ce,!0):ov(X.stateNode,!1)}catch(ft){mn(X,X.return,ft)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===e)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;l===s&&(l=null),s=s.return}l===s&&(l=null),s.sibling.return=s.return,s=s.sibling}c&4&&(c=e.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,Qc(e,l))));break;case 19:vr(s,e),xr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Qc(e,c)));break;case 30:break;case 21:break;default:vr(s,e),xr(e)}}function xr(e){var s=e.flags;if(s&2){try{for(var l,c=e.return;c!==null;){if(uy(c)){l=c;break}c=c.return}if(l==null)throw Error(a(160));switch(l.tag){case 27:var m=l.stateNode,g=$h(e);Wc(e,g,m);break;case 5:var j=l.stateNode;l.flags&32&&(Js(j,""),l.flags&=-33);var D=$h(e);Wc(e,D,j);break;case 3:case 4:var X=l.stateNode.containerInfo,ye=$h(e);Ph(e,ye,X);break;default:throw Error(a(161))}}catch(Ae){mn(e,e.return,Ae)}e.flags&=-3}s&4096&&(e.flags&=-4097)}function xy(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var s=e;xy(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),e=e.sibling}}function Ms(e,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)fy(e,s.alternate,s),s=s.sibling}function ta(e){for(e=e.child;e!==null;){var s=e;switch(s.tag){case 0:case 11:case 14:case 15:hi(4,s,s.return),ta(s);break;case 1:gs(s,s.return);var l=s.stateNode;typeof l.componentWillUnmount=="function"&&oy(s,s.return,l),ta(s);break;case 27:xo(s.stateNode);case 26:case 5:gs(s,s.return),ta(s);break;case 22:s.memoizedState===null&&ta(s);break;case 30:ta(s);break;default:ta(s)}e=e.sibling}}function Ls(e,s,l){for(l=l&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var c=s.alternate,m=e,g=s,j=g.flags;switch(g.tag){case 0:case 11:case 15:Ls(m,g,l),oo(4,g);break;case 1:if(Ls(m,g,l),c=g,m=c.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(ye){mn(c,c.return,ye)}if(c=g,m=c.updateQueue,m!==null){var D=c.stateNode;try{var X=m.shared.hiddenCallbacks;if(X!==null)for(m.shared.hiddenCallbacks=null,m=0;m<X.length;m++)Qm(X[m],D)}catch(ye){mn(c,c.return,ye)}}l&&j&64&&ly(g),co(g,g.return);break;case 27:dy(g);case 26:case 5:Ls(m,g,l),l&&c===null&&j&4&&cy(g),co(g,g.return);break;case 12:Ls(m,g,l);break;case 31:Ls(m,g,l),l&&j&4&&gy(m,g);break;case 13:Ls(m,g,l),l&&j&4&&yy(m,g);break;case 22:g.memoizedState===null&&Ls(m,g,l),co(g,g.return);break;case 30:break;default:Ls(m,g,l)}s=s.sibling}}function Fh(e,s){var l=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),e=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(e=s.memoizedState.cachePool.pool),e!==l&&(e!=null&&e.refCount++,l!=null&&Wl(l))}function Hh(e,s){e=null,s.alternate!==null&&(e=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==e&&(s.refCount++,e!=null&&Wl(e))}function ss(e,s,l,c){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)by(e,s,l,c),s=s.sibling}function by(e,s,l,c){var m=s.flags;switch(s.tag){case 0:case 11:case 15:ss(e,s,l,c),m&2048&&oo(9,s);break;case 1:ss(e,s,l,c);break;case 3:ss(e,s,l,c),m&2048&&(e=null,s.alternate!==null&&(e=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==e&&(s.refCount++,e!=null&&Wl(e)));break;case 12:if(m&2048){ss(e,s,l,c),e=s.stateNode;try{var g=s.memoizedProps,j=g.id,D=g.onPostCommit;typeof D=="function"&&D(j,s.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(X){mn(s,s.return,X)}}else ss(e,s,l,c);break;case 31:ss(e,s,l,c);break;case 13:ss(e,s,l,c);break;case 23:break;case 22:g=s.stateNode,j=s.alternate,s.memoizedState!==null?g._visibility&2?ss(e,s,l,c):uo(e,s):g._visibility&2?ss(e,s,l,c):(g._visibility|=2,qa(e,s,l,c,(s.subtreeFlags&10256)!==0||!1)),m&2048&&Fh(j,s);break;case 24:ss(e,s,l,c),m&2048&&Hh(s.alternate,s);break;default:ss(e,s,l,c)}}function qa(e,s,l,c,m){for(m=m&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var g=e,j=s,D=l,X=c,ye=j.flags;switch(j.tag){case 0:case 11:case 15:qa(g,j,D,X,m),oo(8,j);break;case 23:break;case 22:var Ae=j.stateNode;j.memoizedState!==null?Ae._visibility&2?qa(g,j,D,X,m):uo(g,j):(Ae._visibility|=2,qa(g,j,D,X,m)),m&&ye&2048&&Fh(j.alternate,j);break;case 24:qa(g,j,D,X,m),m&&ye&2048&&Hh(j.alternate,j);break;default:qa(g,j,D,X,m)}s=s.sibling}}function uo(e,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var l=e,c=s,m=c.flags;switch(c.tag){case 22:uo(l,c),m&2048&&Fh(c.alternate,c);break;case 24:uo(l,c),m&2048&&Hh(c.alternate,c);break;default:uo(l,c)}s=s.sibling}}var ho=8192;function Fa(e,s,l){if(e.subtreeFlags&ho)for(e=e.child;e!==null;)wy(e,s,l),e=e.sibling}function wy(e,s,l){switch(e.tag){case 26:Fa(e,s,l),e.flags&ho&&e.memoizedState!==null&&BS(l,rs,e.memoizedState,e.memoizedProps);break;case 5:Fa(e,s,l);break;case 3:case 4:var c=rs;rs=uu(e.stateNode.containerInfo),Fa(e,s,l),rs=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=ho,ho=16777216,Fa(e,s,l),ho=c):Fa(e,s,l));break;default:Fa(e,s,l)}}function Sy(e){var s=e.alternate;if(s!==null&&(e=s.child,e!==null)){s.child=null;do s=e.sibling,e.sibling=null,e=s;while(e!==null)}}function fo(e){var s=e.deletions;if((e.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var c=s[l];Xn=c,_y(c,e)}Sy(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)jy(e),e=e.sibling}function jy(e){switch(e.tag){case 0:case 11:case 15:fo(e),e.flags&2048&&hi(9,e,e.return);break;case 3:fo(e);break;case 12:fo(e);break;case 22:var s=e.stateNode;e.memoizedState!==null&&s._visibility&2&&(e.return===null||e.return.tag!==13)?(s._visibility&=-3,Jc(e)):fo(e);break;default:fo(e)}}function Jc(e){var s=e.deletions;if((e.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var c=s[l];Xn=c,_y(c,e)}Sy(e)}for(e=e.child;e!==null;){switch(s=e,s.tag){case 0:case 11:case 15:hi(8,s,s.return),Jc(s);break;case 22:l=s.stateNode,l._visibility&2&&(l._visibility&=-3,Jc(s));break;default:Jc(s)}e=e.sibling}}function _y(e,s){for(;Xn!==null;){var l=Xn;switch(l.tag){case 0:case 11:case 15:hi(8,l,s);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Wl(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,Xn=c;else e:for(l=e;Xn!==null;){c=Xn;var m=c.sibling,g=c.return;if(py(c),c===l){Xn=null;break e}if(m!==null){m.return=g,Xn=m;break e}Xn=g}}}var eS={getCacheForType:function(e){var s=rr($n),l=s.data.get(e);return l===void 0&&(l=e(),s.data.set(e,l)),l},cacheSignal:function(){return rr($n).controller.signal}},tS=typeof WeakMap=="function"?WeakMap:Map,dn=0,wn=null,Kt=null,Qt=0,pn=0,kr=null,fi=!1,Ha=!1,Vh=!1,zs=0,Dn=0,pi=0,na=0,Gh=0,Tr=0,Va=0,po=null,br=null,Kh=!1,Xc=0,Cy=0,Zc=1/0,eu=null,mi=null,Vn=0,gi=null,Ga=null,Us=0,Yh=0,Wh=null,Ny=null,mo=0,Qh=null;function Ar(){return(dn&2)!==0&&Qt!==0?Qt&-Qt:E.T!==null?nf():tn()}function Ey(){if(Tr===0)if((Qt&536870912)===0||Zt){var e=Te;Te<<=1,(Te&3932160)===0&&(Te=262144),Tr=e}else Tr=536870912;return e=Nr.current,e!==null&&(e.flags|=32),Tr}function wr(e,s,l){(e===wn&&(pn===2||pn===9)||e.cancelPendingCommit!==null)&&(Ka(e,0),yi(e,Qt,Tr,!1)),he(e,l),((dn&2)===0||e!==wn)&&(e===wn&&((dn&2)===0&&(na|=l),Dn===4&&yi(e,Qt,Tr,!1)),ys(e))}function ky(e,s,l){if((dn&6)!==0)throw Error(a(327));var c=!l&&(s&127)===0&&(s&e.expiredLanes)===0||wt(e,s),m=c?sS(e,s):Xh(e,s,!0),g=c;do{if(m===0){Ha&&!c&&yi(e,s,0,!1);break}else{if(l=e.current.alternate,g&&!nS(l)){m=Xh(e,s,!1),g=!1;continue}if(m===2){if(g=s,e.errorRecoveryDisabledLanes&g)var j=0;else j=e.pendingLanes&-536870913,j=j!==0?j:j&536870912?536870912:0;if(j!==0){s=j;e:{var D=e;m=po;var X=D.current.memoizedState.isDehydrated;if(X&&(Ka(D,j).flags|=256),j=Xh(D,j,!1),j!==2){if(Vh&&!X){D.errorRecoveryDisabledLanes|=g,na|=g,m=4;break e}g=br,br=m,g!==null&&(br===null?br=g:br.push.apply(br,g))}m=j}if(g=!1,m!==2)continue}}if(m===1){Ka(e,0),yi(e,s,0,!0);break}e:{switch(c=e,g=m,g){case 0:case 1:throw Error(a(345));case 4:if((s&4194048)!==s)break;case 6:yi(c,s,Tr,!fi);break e;case 2:br=null;break;case 3:case 5:break;default:throw Error(a(329))}if((s&62914560)===s&&(m=Xc+300-dt(),10<m)){if(yi(c,s,Tr,!fi),it(c,0,!0)!==0)break e;Us=s,c.timeoutHandle=iv(Ty.bind(null,c,l,br,eu,Kh,s,Tr,na,Va,fi,g,"Throttled",-0,0),m);break e}Ty(c,l,br,eu,Kh,s,Tr,na,Va,fi,g,null,-0,0)}}break}while(!0);ys(e)}function Ty(e,s,l,c,m,g,j,D,X,ye,Ae,Le,be,Ce){if(e.timeoutHandle=-1,Le=s.subtreeFlags,Le&8192||(Le&16785408)===16785408){Le={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zr},wy(s,g,Le);var ft=(g&62914560)===g?Xc-dt():(g&4194048)===g?Cy-dt():0;if(ft=$S(Le,ft),ft!==null){Us=g,e.cancelPendingCommit=ft(Uy.bind(null,e,s,g,l,c,m,j,D,X,Ae,Le,null,be,Ce)),yi(e,g,j,!ye);return}}Uy(e,s,g,l,c,m,j,D,X)}function nS(e){for(var s=e;;){var l=s.tag;if((l===0||l===11||l===15)&&s.flags&16384&&(l=s.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var m=l[c],g=m.getSnapshot;m=m.value;try{if(!_r(g(),m))return!1}catch{return!1}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function yi(e,s,l,c){s&=~Gh,s&=~na,e.suspendedLanes|=s,e.pingedLanes&=~s,c&&(e.warmLanes|=s),c=e.expirationTimes;for(var m=s;0<m;){var g=31-sn(m),j=1<<g;c[g]=-1,m&=~j}l!==0&&mt(e,l,s)}function tu(){return(dn&6)===0?(go(0),!1):!0}function Jh(){if(Kt!==null){if(pn===0)var e=Kt.return;else e=Kt,Ns=Ki=null,fh(e),Ua=null,Jl=0,e=Kt;for(;e!==null;)ay(e.alternate,e),e=e.return;Kt=null}}function Ka(e,s){var l=e.timeoutHandle;l!==-1&&(e.timeoutHandle=-1,SS(l)),l=e.cancelPendingCommit,l!==null&&(e.cancelPendingCommit=null,l()),Us=0,Jh(),wn=e,Kt=l=_s(e.current,null),Qt=s,pn=0,kr=null,fi=!1,Ha=wt(e,s),Vh=!1,Va=Tr=Gh=na=pi=Dn=0,br=po=null,Kh=!1,(s&8)!==0&&(s|=s&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=s;0<c;){var m=31-sn(c),g=1<<m;s|=e[m],c&=~g}return zs=s,Sc(),l}function Ay(e,s){qt=null,E.H=io,s===za||s===Ac?(s=Gm(),pn=3):s===th?(s=Gm(),pn=4):pn=s===Th?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,kr=s,Kt===null&&(Dn=1,Hc(e,Br(s,e.current)))}function Ry(){var e=Nr.current;return e===null?!0:(Qt&4194048)===Qt?Fr===null:(Qt&62914560)===Qt||(Qt&536870912)!==0?e===Fr:!1}function Oy(){var e=E.H;return E.H=io,e===null?io:e}function Dy(){var e=E.A;return E.A=eS,e}function nu(){Dn=4,fi||(Qt&4194048)!==Qt&&Nr.current!==null||(Ha=!0),(pi&134217727)===0&&(na&134217727)===0||wn===null||yi(wn,Qt,Tr,!1)}function Xh(e,s,l){var c=dn;dn|=2;var m=Oy(),g=Dy();(wn!==e||Qt!==s)&&(eu=null,Ka(e,s)),s=!1;var j=Dn;e:do try{if(pn!==0&&Kt!==null){var D=Kt,X=kr;switch(pn){case 8:Jh(),j=6;break e;case 3:case 2:case 9:case 6:Nr.current===null&&(s=!0);var ye=pn;if(pn=0,kr=null,Ya(e,D,X,ye),l&&Ha){j=0;break e}break;default:ye=pn,pn=0,kr=null,Ya(e,D,X,ye)}}rS(),j=Dn;break}catch(Ae){Ay(e,Ae)}while(!0);return s&&e.shellSuspendCounter++,Ns=Ki=null,dn=c,E.H=m,E.A=g,Kt===null&&(wn=null,Qt=0,Sc()),j}function rS(){for(;Kt!==null;)My(Kt)}function sS(e,s){var l=dn;dn|=2;var c=Oy(),m=Dy();wn!==e||Qt!==s?(eu=null,Zc=dt()+500,Ka(e,s)):Ha=wt(e,s);e:do try{if(pn!==0&&Kt!==null){s=Kt;var g=kr;t:switch(pn){case 1:pn=0,kr=null,Ya(e,s,g,1);break;case 2:case 9:if(Hm(g)){pn=0,kr=null,Ly(s);break}s=function(){pn!==2&&pn!==9||wn!==e||(pn=7),ys(e)},g.then(s,s);break e;case 3:pn=7;break e;case 4:pn=5;break e;case 7:Hm(g)?(pn=0,kr=null,Ly(s)):(pn=0,kr=null,Ya(e,s,g,7));break;case 5:var j=null;switch(Kt.tag){case 26:j=Kt.memoizedState;case 5:case 27:var D=Kt;if(j?bv(j):D.stateNode.complete){pn=0,kr=null;var X=D.sibling;if(X!==null)Kt=X;else{var ye=D.return;ye!==null?(Kt=ye,ru(ye)):Kt=null}break t}}pn=0,kr=null,Ya(e,s,g,5);break;case 6:pn=0,kr=null,Ya(e,s,g,6);break;case 8:Jh(),Dn=6;break e;default:throw Error(a(462))}}iS();break}catch(Ae){Ay(e,Ae)}while(!0);return Ns=Ki=null,E.H=c,E.A=m,dn=l,Kt!==null?0:(wn=null,Qt=0,Sc(),Dn)}function iS(){for(;Kt!==null&&!Ge();)My(Kt)}function My(e){var s=sy(e.alternate,e,zs);e.memoizedProps=e.pendingProps,s===null?ru(e):Kt=s}function Ly(e){var s=e,l=s.alternate;switch(s.tag){case 15:case 0:s=Xg(l,s,s.pendingProps,s.type,void 0,Qt);break;case 11:s=Xg(l,s,s.pendingProps,s.type.render,s.ref,Qt);break;case 5:fh(s);default:ay(l,s),s=Kt=Dm(s,zs),s=sy(l,s,zs)}e.memoizedProps=e.pendingProps,s===null?ru(e):Kt=s}function Ya(e,s,l,c){Ns=Ki=null,fh(s),Ua=null,Jl=0;var m=s.return;try{if(Kw(e,m,s,l,Qt)){Dn=1,Hc(e,Br(l,e.current)),Kt=null;return}}catch(g){if(m!==null)throw Kt=m,g;Dn=1,Hc(e,Br(l,e.current)),Kt=null;return}s.flags&32768?(Zt||c===1?e=!0:Ha||(Qt&536870912)!==0?e=!1:(fi=e=!0,(c===2||c===9||c===3||c===6)&&(c=Nr.current,c!==null&&c.tag===13&&(c.flags|=16384))),zy(s,e)):ru(s)}function ru(e){var s=e;do{if((s.flags&32768)!==0){zy(s,fi);return}e=s.return;var l=Qw(s.alternate,s,zs);if(l!==null){Kt=l;return}if(s=s.sibling,s!==null){Kt=s;return}Kt=s=e}while(s!==null);Dn===0&&(Dn=5)}function zy(e,s){do{var l=Jw(e.alternate,e);if(l!==null){l.flags&=32767,Kt=l;return}if(l=e.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!s&&(e=e.sibling,e!==null)){Kt=e;return}Kt=e=l}while(e!==null);Dn=6,Kt=null}function Uy(e,s,l,c,m,g,j,D,X){e.cancelPendingCommit=null;do su();while(Vn!==0);if((dn&6)!==0)throw Error(a(327));if(s!==null){if(s===e.current)throw Error(a(177));if(g=s.lanes|s.childLanes,g|=$d,Ke(e,l,g,j,D,X),e===wn&&(Kt=wn=null,Qt=0),Ga=s,gi=e,Us=l,Yh=g,Wh=m,Ny=c,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,cS(tt,function(){return qy(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||c){c=E.T,E.T=null,m=B.p,B.p=2,j=dn,dn|=4;try{Xw(e,s,l)}finally{dn=j,B.p=m,E.T=c}}Vn=1,Iy(),By(),$y()}}function Iy(){if(Vn===1){Vn=0;var e=gi,s=Ga,l=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||l){l=E.T,E.T=null;var c=B.p;B.p=2;var m=dn;dn|=4;try{vy(s,e);var g=df,j=_m(e.containerInfo),D=g.focusedElem,X=g.selectionRange;if(j!==D&&D&&D.ownerDocument&&jm(D.ownerDocument.documentElement,D)){if(X!==null&&Ld(D)){var ye=X.start,Ae=X.end;if(Ae===void 0&&(Ae=ye),"selectionStart"in D)D.selectionStart=ye,D.selectionEnd=Math.min(Ae,D.value.length);else{var Le=D.ownerDocument||document,be=Le&&Le.defaultView||window;if(be.getSelection){var Ce=be.getSelection(),ft=D.textContent.length,Rt=Math.min(X.start,ft),xn=X.end===void 0?Rt:Math.min(X.end,ft);!Ce.extend&&Rt>xn&&(j=xn,xn=Rt,Rt=j);var fe=Sm(D,Rt),se=Sm(D,xn);if(fe&&se&&(Ce.rangeCount!==1||Ce.anchorNode!==fe.node||Ce.anchorOffset!==fe.offset||Ce.focusNode!==se.node||Ce.focusOffset!==se.offset)){var ge=Le.createRange();ge.setStart(fe.node,fe.offset),Ce.removeAllRanges(),Rt>xn?(Ce.addRange(ge),Ce.extend(se.node,se.offset)):(ge.setEnd(se.node,se.offset),Ce.addRange(ge))}}}}for(Le=[],Ce=D;Ce=Ce.parentNode;)Ce.nodeType===1&&Le.push({element:Ce,left:Ce.scrollLeft,top:Ce.scrollTop});for(typeof D.focus=="function"&&D.focus(),D=0;D<Le.length;D++){var Me=Le[D];Me.element.scrollLeft=Me.left,Me.element.scrollTop=Me.top}}gu=!!uf,df=uf=null}finally{dn=m,B.p=c,E.T=l}}e.current=s,Vn=2}}function By(){if(Vn===2){Vn=0;var e=gi,s=Ga,l=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||l){l=E.T,E.T=null;var c=B.p;B.p=2;var m=dn;dn|=4;try{fy(e,s.alternate,s)}finally{dn=m,B.p=c,E.T=l}}Vn=3}}function $y(){if(Vn===4||Vn===3){Vn=0,Ne();var e=gi,s=Ga,l=Us,c=Ny;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Vn=5:(Vn=0,Ga=gi=null,Py(e,e.pendingLanes));var m=e.pendingLanes;if(m===0&&(mi=null),Mt(l),s=s.stateNode,rn&&typeof rn.onCommitFiberRoot=="function")try{rn.onCommitFiberRoot(Ft,s,void 0,(s.current.flags&128)===128)}catch{}if(c!==null){s=E.T,m=B.p,B.p=2,E.T=null;try{for(var g=e.onRecoverableError,j=0;j<c.length;j++){var D=c[j];g(D.value,{componentStack:D.stack})}}finally{E.T=s,B.p=m}}(Us&3)!==0&&su(),ys(e),m=e.pendingLanes,(l&261930)!==0&&(m&42)!==0?e===Qh?mo++:(mo=0,Qh=e):mo=0,go(0)}}function Py(e,s){(e.pooledCacheLanes&=s)===0&&(s=e.pooledCache,s!=null&&(e.pooledCache=null,Wl(s)))}function su(){return Iy(),By(),$y(),qy()}function qy(){if(Vn!==5)return!1;var e=gi,s=Yh;Yh=0;var l=Mt(Us),c=E.T,m=B.p;try{B.p=32>l?32:l,E.T=null,l=Wh,Wh=null;var g=gi,j=Us;if(Vn=0,Ga=gi=null,Us=0,(dn&6)!==0)throw Error(a(331));var D=dn;if(dn|=4,jy(g.current),by(g,g.current,j,l),dn=D,go(0,!1),rn&&typeof rn.onPostCommitFiberRoot=="function")try{rn.onPostCommitFiberRoot(Ft,g)}catch{}return!0}finally{B.p=m,E.T=c,Py(e,s)}}function Fy(e,s,l){s=Br(l,s),s=kh(e.stateNode,s,2),e=ci(e,s,2),e!==null&&(he(e,2),ys(e))}function mn(e,s,l){if(e.tag===3)Fy(e,e,l);else for(;s!==null;){if(s.tag===3){Fy(s,e,l);break}else if(s.tag===1){var c=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(mi===null||!mi.has(c))){e=Br(l,e),l=Hg(2),c=ci(s,l,2),c!==null&&(Vg(l,c,s,e),he(c,2),ys(c));break}}s=s.return}}function Zh(e,s,l){var c=e.pingCache;if(c===null){c=e.pingCache=new tS;var m=new Set;c.set(s,m)}else m=c.get(s),m===void 0&&(m=new Set,c.set(s,m));m.has(l)||(Vh=!0,m.add(l),e=aS.bind(null,e,s,l),s.then(e,e))}function aS(e,s,l){var c=e.pingCache;c!==null&&c.delete(s),e.pingedLanes|=e.suspendedLanes&l,e.warmLanes&=~l,wn===e&&(Qt&l)===l&&(Dn===4||Dn===3&&(Qt&62914560)===Qt&&300>dt()-Xc?(dn&2)===0&&Ka(e,0):Gh|=l,Va===Qt&&(Va=0)),ys(e)}function Hy(e,s){s===0&&(s=Vt()),e=Hi(e,s),e!==null&&(he(e,s),ys(e))}function lS(e){var s=e.memoizedState,l=0;s!==null&&(l=s.retryLane),Hy(e,l)}function oS(e,s){var l=0;switch(e.tag){case 31:case 13:var c=e.stateNode,m=e.memoizedState;m!==null&&(l=m.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(s),Hy(e,l)}function cS(e,s){return we(e,s)}var iu=null,Wa=null,ef=!1,au=!1,tf=!1,vi=0;function ys(e){e!==Wa&&e.next===null&&(Wa===null?iu=Wa=e:Wa=Wa.next=e),au=!0,ef||(ef=!0,dS())}function go(e,s){if(!tf&&au){tf=!0;do for(var l=!1,c=iu;c!==null;){if(e!==0){var m=c.pendingLanes;if(m===0)var g=0;else{var j=c.suspendedLanes,D=c.pingedLanes;g=(1<<31-sn(42|e)+1)-1,g&=m&~(j&~D),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(l=!0,Yy(c,g))}else g=Qt,g=it(c,c===wn?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||wt(c,g)||(l=!0,Yy(c,g));c=c.next}while(l);tf=!1}}function uS(){Vy()}function Vy(){au=ef=!1;var e=0;vi!==0&&wS()&&(e=vi);for(var s=dt(),l=null,c=iu;c!==null;){var m=c.next,g=Gy(c,s);g===0?(c.next=null,l===null?iu=m:l.next=m,m===null&&(Wa=l)):(l=c,(e!==0||(g&3)!==0)&&(au=!0)),c=m}Vn!==0&&Vn!==5||go(e),vi!==0&&(vi=0)}function Gy(e,s){for(var l=e.suspendedLanes,c=e.pingedLanes,m=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var j=31-sn(g),D=1<<j,X=m[j];X===-1?((D&l)===0||(D&c)!==0)&&(m[j]=Pt(D,s)):X<=s&&(e.expiredLanes|=D),g&=~D}if(s=wn,l=Qt,l=it(e,e===s?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,l===0||e===s&&(pn===2||pn===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&ae(c),e.callbackNode=null,e.callbackPriority=0;if((l&3)===0||wt(e,l)){if(s=l&-l,s===e.callbackPriority)return s;switch(c!==null&&ae(c),Mt(l)){case 2:case 8:l=ot;break;case 32:l=tt;break;case 268435456:l=gn;break;default:l=tt}return c=Ky.bind(null,e),l=we(l,c),e.callbackPriority=s,e.callbackNode=l,s}return c!==null&&c!==null&&ae(c),e.callbackPriority=2,e.callbackNode=null,2}function Ky(e,s){if(Vn!==0&&Vn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var l=e.callbackNode;if(su()&&e.callbackNode!==l)return null;var c=Qt;return c=it(e,e===wn?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(ky(e,c,s),Gy(e,dt()),e.callbackNode!=null&&e.callbackNode===l?Ky.bind(null,e):null)}function Yy(e,s){if(su())return null;ky(e,s,!0)}function dS(){jS(function(){(dn&6)!==0?we(Ve,uS):Vy()})}function nf(){if(vi===0){var e=Ma;e===0&&(e=De,De<<=1,(De&261888)===0&&(De=256)),vi=e}return vi}function Wy(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:_a(""+e)}function Qy(e,s){var l=s.ownerDocument.createElement("input");return l.name=s.name,l.value=s.value,e.id&&l.setAttribute("form",e.id),s.parentNode.insertBefore(l,s),e=new FormData(e),l.parentNode.removeChild(l),e}function hS(e,s,l,c,m){if(s==="submit"&&l&&l.stateNode===m){var g=Wy((m[ze]||null).action),j=c.submitter;j&&(s=(s=j[ze]||null)?Wy(s.formAction):j.getAttribute("formAction"),s!==null&&(g=s,j=null));var D=new xt("action","action",null,c,m);e.push({event:D,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(vi!==0){var X=j?Qy(m,j):new FormData(m);Sh(l,{pending:!0,data:X,method:m.method,action:g},null,X)}}else typeof g=="function"&&(D.preventDefault(),X=j?Qy(m,j):new FormData(m),Sh(l,{pending:!0,data:X,method:m.method,action:g},g,X))},currentTarget:m}]})}}for(var rf=0;rf<Bd.length;rf++){var sf=Bd[rf],fS=sf.toLowerCase(),pS=sf[0].toUpperCase()+sf.slice(1);ns(fS,"on"+pS)}ns(Em,"onAnimationEnd"),ns(km,"onAnimationIteration"),ns(Tm,"onAnimationStart"),ns("dblclick","onDoubleClick"),ns("focusin","onFocus"),ns("focusout","onBlur"),ns(Aw,"onTransitionRun"),ns(Rw,"onTransitionStart"),ns(Ow,"onTransitionCancel"),ns(Am,"onTransitionEnd"),_t("onMouseEnter",["mouseout","mouseover"]),_t("onMouseLeave",["mouseout","mouseover"]),_t("onPointerEnter",["pointerout","pointerover"]),_t("onPointerLeave",["pointerout","pointerover"]),We("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),We("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),We("onBeforeInput",["compositionend","keypress","textInput","paste"]),We("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),We("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),We("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yo));function Jy(e,s){s=(s&4)!==0;for(var l=0;l<e.length;l++){var c=e[l],m=c.event;c=c.listeners;e:{var g=void 0;if(s)for(var j=c.length-1;0<=j;j--){var D=c[j],X=D.instance,ye=D.currentTarget;if(D=D.listener,X!==g&&m.isPropagationStopped())break e;g=D,m.currentTarget=ye;try{g(m)}catch(Ae){wc(Ae)}m.currentTarget=null,g=X}else for(j=0;j<c.length;j++){if(D=c[j],X=D.instance,ye=D.currentTarget,D=D.listener,X!==g&&m.isPropagationStopped())break e;g=D,m.currentTarget=ye;try{g(m)}catch(Ae){wc(Ae)}m.currentTarget=null,g=X}}}}function Yt(e,s){var l=s[Tt];l===void 0&&(l=s[Tt]=new Set);var c=e+"__bubble";l.has(c)||(Xy(s,e,2,!1),l.add(c))}function af(e,s,l){var c=0;s&&(c|=4),Xy(l,e,c,s)}var lu="_reactListening"+Math.random().toString(36).slice(2);function lf(e){if(!e[lu]){e[lu]=!0,an.forEach(function(l){l!=="selectionchange"&&(mS.has(l)||af(l,!1,e),af(l,!0,e))});var s=e.nodeType===9?e:e.ownerDocument;s===null||s[lu]||(s[lu]=!0,af("selectionchange",!1,s))}}function Xy(e,s,l,c){switch(Ev(s)){case 2:var m=FS;break;case 8:m=HS;break;default:m=Sf}l=m.bind(null,s,l,e),m=void 0,!I||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(m=!0),c?m!==void 0?e.addEventListener(s,l,{capture:!0,passive:m}):e.addEventListener(s,l,!0):m!==void 0?e.addEventListener(s,l,{passive:m}):e.addEventListener(s,l,!1)}function of(e,s,l,c,m){var g=c;if((s&1)===0&&(s&2)===0&&c!==null)e:for(;;){if(c===null)return;var j=c.tag;if(j===3||j===4){var D=c.stateNode.containerInfo;if(D===m)break;if(j===4)for(j=c.return;j!==null;){var X=j.tag;if((X===3||X===4)&&j.stateNode.containerInfo===m)return;j=j.return}for(;D!==null;){if(j=Pe(D),j===null)return;if(X=j.tag,X===5||X===6||X===26||X===27){c=g=j;continue e}D=D.parentNode}}c=c.return}$i(function(){var ye=g,Ae=Il(l),Le=[];e:{var be=Rm.get(e);if(be!==void 0){var Ce=xt,ft=e;switch(e){case"keypress":if(He(l)===0)break e;case"keydown":case"keyup":Ce=ow;break;case"focusin":ft="focus",Ce=An;break;case"focusout":ft="blur",Ce=An;break;case"beforeblur":case"afterblur":Ce=An;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ce=vt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ce=Ut;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ce=dw;break;case Em:case km:case Tm:Ce=Gt;break;case Am:Ce=fw;break;case"scroll":case"scrollend":Ce=It;break;case"wheel":Ce=mw;break;case"copy":case"cut":case"paste":Ce=Rn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ce=om;break;case"toggle":case"beforetoggle":Ce=yw}var Rt=(s&4)!==0,xn=!Rt&&(e==="scroll"||e==="scrollend"),fe=Rt?be!==null?be+"Capture":null:be;Rt=[];for(var se=ye,ge;se!==null;){var Me=se;if(ge=Me.stateNode,Me=Me.tag,Me!==5&&Me!==26&&Me!==27||ge===null||fe===null||(Me=ei(se,fe),Me!=null&&Rt.push(vo(se,Me,ge))),xn)break;se=se.return}0<Rt.length&&(be=new Ce(be,ft,null,l,Ae),Le.push({event:be,listeners:Rt}))}}if((s&7)===0){e:{if(be=e==="mouseover"||e==="pointerover",Ce=e==="mouseout"||e==="pointerout",be&&l!==Ul&&(ft=l.relatedTarget||l.fromElement)&&(Pe(ft)||ft[At]))break e;if((Ce||be)&&(be=Ae.window===Ae?Ae:(be=Ae.ownerDocument)?be.defaultView||be.parentWindow:window,Ce?(ft=l.relatedTarget||l.toElement,Ce=ye,ft=ft?Pe(ft):null,ft!==null&&(xn=u(ft),Rt=ft.tag,ft!==xn||Rt!==5&&Rt!==27&&Rt!==6)&&(ft=null)):(Ce=null,ft=ye),Ce!==ft)){if(Rt=vt,Me="onMouseLeave",fe="onMouseEnter",se="mouse",(e==="pointerout"||e==="pointerover")&&(Rt=om,Me="onPointerLeave",fe="onPointerEnter",se="pointer"),xn=Ce==null?be:Xe(Ce),ge=ft==null?be:Xe(ft),be=new Rt(Me,se+"leave",Ce,l,Ae),be.target=xn,be.relatedTarget=ge,Me=null,Pe(Ae)===ye&&(Rt=new Rt(fe,se+"enter",ft,l,Ae),Rt.target=ge,Rt.relatedTarget=xn,Me=Rt),xn=Me,Ce&&ft)t:{for(Rt=gS,fe=Ce,se=ft,ge=0,Me=fe;Me;Me=Rt(Me))ge++;Me=0;for(var Nt=se;Nt;Nt=Rt(Nt))Me++;for(;0<ge-Me;)fe=Rt(fe),ge--;for(;0<Me-ge;)se=Rt(se),Me--;for(;ge--;){if(fe===se||se!==null&&fe===se.alternate){Rt=fe;break t}fe=Rt(fe),se=Rt(se)}Rt=null}else Rt=null;Ce!==null&&Zy(Le,be,Ce,Rt,!1),ft!==null&&xn!==null&&Zy(Le,xn,ft,Rt,!0)}}e:{if(be=ye?Xe(ye):window,Ce=be.nodeName&&be.nodeName.toLowerCase(),Ce==="select"||Ce==="input"&&be.type==="file")var cn=gm;else if(pm(be))if(ym)cn=Ew;else{cn=Cw;var yt=_w}else Ce=be.nodeName,!Ce||Ce.toLowerCase()!=="input"||be.type!=="checkbox"&&be.type!=="radio"?ye&&zl(ye.elementType)&&(cn=gm):cn=Nw;if(cn&&(cn=cn(e,ye))){mm(Le,cn,l,Ae);break e}yt&&yt(e,be,ye),e==="focusout"&&ye&&be.type==="number"&&ye.memoizedProps.value!=null&&Dl(be,"number",be.value)}switch(yt=ye?Xe(ye):window,e){case"focusin":(pm(yt)||yt.contentEditable==="true")&&(Na=yt,zd=ye,Gl=null);break;case"focusout":Gl=zd=Na=null;break;case"mousedown":Ud=!0;break;case"contextmenu":case"mouseup":case"dragend":Ud=!1,Cm(Le,l,Ae);break;case"selectionchange":if(Tw)break;case"keydown":case"keyup":Cm(Le,l,Ae)}var Ht;if(Od)e:{switch(e){case"compositionstart":var Jt="onCompositionStart";break e;case"compositionend":Jt="onCompositionEnd";break e;case"compositionupdate":Jt="onCompositionUpdate";break e}Jt=void 0}else Ca?hm(e,l)&&(Jt="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(Jt="onCompositionStart");Jt&&(cm&&l.locale!=="ko"&&(Ca||Jt!=="onCompositionStart"?Jt==="onCompositionEnd"&&Ca&&(Ht=Be()):(re=Ae,Se="value"in re?re.value:re.textContent,Ca=!0)),yt=ou(ye,Jt),0<yt.length&&(Jt=new ts(Jt,e,null,l,Ae),Le.push({event:Jt,listeners:yt}),Ht?Jt.data=Ht:(Ht=fm(l),Ht!==null&&(Jt.data=Ht)))),(Ht=xw?bw(e,l):ww(e,l))&&(Jt=ou(ye,"onBeforeInput"),0<Jt.length&&(yt=new ts("onBeforeInput","beforeinput",null,l,Ae),Le.push({event:yt,listeners:Jt}),yt.data=Ht)),hS(Le,e,ye,l,Ae)}Jy(Le,s)})}function vo(e,s,l){return{instance:e,listener:s,currentTarget:l}}function ou(e,s){for(var l=s+"Capture",c=[];e!==null;){var m=e,g=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||g===null||(m=ei(e,l),m!=null&&c.unshift(vo(e,m,g)),m=ei(e,s),m!=null&&c.push(vo(e,m,g))),e.tag===3)return c;e=e.return}return[]}function gS(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Zy(e,s,l,c,m){for(var g=s._reactName,j=[];l!==null&&l!==c;){var D=l,X=D.alternate,ye=D.stateNode;if(D=D.tag,X!==null&&X===c)break;D!==5&&D!==26&&D!==27||ye===null||(X=ye,m?(ye=ei(l,g),ye!=null&&j.unshift(vo(l,ye,X))):m||(ye=ei(l,g),ye!=null&&j.push(vo(l,ye,X)))),l=l.return}j.length!==0&&e.push({event:s,listeners:j})}var yS=/\r\n?/g,vS=/\u0000|\uFFFD/g;function ev(e){return(typeof e=="string"?e:""+e).replace(yS,`
`).replace(vS,"")}function tv(e,s){return s=ev(s),ev(e)===s}function vn(e,s,l,c,m,g){switch(l){case"children":typeof c=="string"?s==="body"||s==="textarea"&&c===""||Js(e,c):(typeof c=="number"||typeof c=="bigint")&&s!=="body"&&Js(e,""+c);break;case"className":Mr(e,"class",c);break;case"tabIndex":Mr(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Mr(e,l,c);break;case"style":Ll(e,c,g);break;case"data":if(s!=="object"){Mr(e,"data",c);break}case"src":case"href":if(c===""&&(s!=="a"||l!=="href")){e.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=_a(""+c),e.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(l==="formAction"?(s!=="input"&&vn(e,s,"name",m.name,m,null),vn(e,s,"formEncType",m.formEncType,m,null),vn(e,s,"formMethod",m.formMethod,m,null),vn(e,s,"formTarget",m.formTarget,m,null)):(vn(e,s,"encType",m.encType,m,null),vn(e,s,"method",m.method,m,null),vn(e,s,"target",m.target,m,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=_a(""+c),e.setAttribute(l,c);break;case"onClick":c!=null&&(e.onclick=zr);break;case"onScroll":c!=null&&Yt("scroll",e);break;case"onScrollEnd":c!=null&&Yt("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(m.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}l=_a(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""+c):e.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""):e.removeAttribute(l);break;case"capture":case"download":c===!0?e.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,c):e.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(l,c):e.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(l):e.setAttribute(l,c);break;case"popover":Yt("beforetoggle",e),Yt("toggle",e),Jr(e,"popover",c);break;case"xlinkActuate":Xr(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Xr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Xr(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Xr(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Xr(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Xr(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Jr(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Rd.get(l)||l,Jr(e,l,c))}}function cf(e,s,l,c,m,g){switch(l){case"style":Ll(e,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(m.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"children":typeof c=="string"?Js(e,c):(typeof c=="number"||typeof c=="bigint")&&Js(e,""+c);break;case"onScroll":c!=null&&Yt("scroll",e);break;case"onScrollEnd":c!=null&&Yt("scrollend",e);break;case"onClick":c!=null&&(e.onclick=zr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!nn.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(m=l.endsWith("Capture"),s=l.slice(2,m?l.length-7:void 0),g=e[ze]||null,g=g!=null?g[l]:null,typeof g=="function"&&e.removeEventListener(s,g,m),typeof c=="function")){typeof g!="function"&&g!==null&&(l in e?e[l]=null:e.hasAttribute(l)&&e.removeAttribute(l)),e.addEventListener(s,c,m);break e}l in e?e[l]=c:c===!0?e.setAttribute(l,""):Jr(e,l,c)}}}function ir(e,s,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Yt("error",e),Yt("load",e);var c=!1,m=!1,g;for(g in l)if(l.hasOwnProperty(g)){var j=l[g];if(j!=null)switch(g){case"src":c=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,s));default:vn(e,s,g,j,l,null)}}m&&vn(e,s,"srcSet",l.srcSet,l,null),c&&vn(e,s,"src",l.src,l,null);return;case"input":Yt("invalid",e);var D=g=j=m=null,X=null,ye=null;for(c in l)if(l.hasOwnProperty(c)){var Ae=l[c];if(Ae!=null)switch(c){case"name":m=Ae;break;case"type":j=Ae;break;case"checked":X=Ae;break;case"defaultChecked":ye=Ae;break;case"value":g=Ae;break;case"defaultValue":D=Ae;break;case"children":case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(a(137,s));break;default:vn(e,s,c,Ae,l,null)}}gc(e,g,D,X,ye,j,m,!1);return;case"select":Yt("invalid",e),c=j=g=null;for(m in l)if(l.hasOwnProperty(m)&&(D=l[m],D!=null))switch(m){case"value":g=D;break;case"defaultValue":j=D;break;case"multiple":c=D;default:vn(e,s,m,D,l,null)}s=g,l=j,e.multiple=!!c,s!=null?Lr(e,!!c,s,!1):l!=null&&Lr(e,!!c,l,!0);return;case"textarea":Yt("invalid",e),g=m=c=null;for(j in l)if(l.hasOwnProperty(j)&&(D=l[j],D!=null))switch(j){case"value":c=D;break;case"defaultValue":m=D;break;case"children":g=D;break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(a(91));break;default:vn(e,s,j,D,l,null)}vc(e,c,m,g);return;case"option":for(X in l)l.hasOwnProperty(X)&&(c=l[X],c!=null)&&(X==="selected"?e.selected=c&&typeof c!="function"&&typeof c!="symbol":vn(e,s,X,c,l,null));return;case"dialog":Yt("beforetoggle",e),Yt("toggle",e),Yt("cancel",e),Yt("close",e);break;case"iframe":case"object":Yt("load",e);break;case"video":case"audio":for(c=0;c<yo.length;c++)Yt(yo[c],e);break;case"image":Yt("error",e),Yt("load",e);break;case"details":Yt("toggle",e);break;case"embed":case"source":case"link":Yt("error",e),Yt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ye in l)if(l.hasOwnProperty(ye)&&(c=l[ye],c!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,s));default:vn(e,s,ye,c,l,null)}return;default:if(zl(s)){for(Ae in l)l.hasOwnProperty(Ae)&&(c=l[Ae],c!==void 0&&cf(e,s,Ae,c,l,void 0));return}}for(D in l)l.hasOwnProperty(D)&&(c=l[D],c!=null&&vn(e,s,D,c,l,null))}function xS(e,s,l,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,g=null,j=null,D=null,X=null,ye=null,Ae=null;for(Ce in l){var Le=l[Ce];if(l.hasOwnProperty(Ce)&&Le!=null)switch(Ce){case"checked":break;case"value":break;case"defaultValue":X=Le;default:c.hasOwnProperty(Ce)||vn(e,s,Ce,null,c,Le)}}for(var be in c){var Ce=c[be];if(Le=l[be],c.hasOwnProperty(be)&&(Ce!=null||Le!=null))switch(be){case"type":g=Ce;break;case"name":m=Ce;break;case"checked":ye=Ce;break;case"defaultChecked":Ae=Ce;break;case"value":j=Ce;break;case"defaultValue":D=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(a(137,s));break;default:Ce!==Le&&vn(e,s,be,Ce,c,Le)}}Bi(e,j,D,X,ye,Ae,g,m);return;case"select":Ce=j=D=be=null;for(g in l)if(X=l[g],l.hasOwnProperty(g)&&X!=null)switch(g){case"value":break;case"multiple":Ce=X;default:c.hasOwnProperty(g)||vn(e,s,g,null,c,X)}for(m in c)if(g=c[m],X=l[m],c.hasOwnProperty(m)&&(g!=null||X!=null))switch(m){case"value":be=g;break;case"defaultValue":D=g;break;case"multiple":j=g;default:g!==X&&vn(e,s,m,g,c,X)}s=D,l=j,c=Ce,be!=null?Lr(e,!!l,be,!1):!!c!=!!l&&(s!=null?Lr(e,!!l,s,!0):Lr(e,!!l,l?[]:"",!1));return;case"textarea":Ce=be=null;for(D in l)if(m=l[D],l.hasOwnProperty(D)&&m!=null&&!c.hasOwnProperty(D))switch(D){case"value":break;case"children":break;default:vn(e,s,D,null,c,m)}for(j in c)if(m=c[j],g=l[j],c.hasOwnProperty(j)&&(m!=null||g!=null))switch(j){case"value":be=m;break;case"defaultValue":Ce=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(a(91));break;default:m!==g&&vn(e,s,j,m,c,g)}yc(e,be,Ce);return;case"option":for(var ft in l)be=l[ft],l.hasOwnProperty(ft)&&be!=null&&!c.hasOwnProperty(ft)&&(ft==="selected"?e.selected=!1:vn(e,s,ft,null,c,be));for(X in c)be=c[X],Ce=l[X],c.hasOwnProperty(X)&&be!==Ce&&(be!=null||Ce!=null)&&(X==="selected"?e.selected=be&&typeof be!="function"&&typeof be!="symbol":vn(e,s,X,be,c,Ce));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Rt in l)be=l[Rt],l.hasOwnProperty(Rt)&&be!=null&&!c.hasOwnProperty(Rt)&&vn(e,s,Rt,null,c,be);for(ye in c)if(be=c[ye],Ce=l[ye],c.hasOwnProperty(ye)&&be!==Ce&&(be!=null||Ce!=null))switch(ye){case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(a(137,s));break;default:vn(e,s,ye,be,c,Ce)}return;default:if(zl(s)){for(var xn in l)be=l[xn],l.hasOwnProperty(xn)&&be!==void 0&&!c.hasOwnProperty(xn)&&cf(e,s,xn,void 0,c,be);for(Ae in c)be=c[Ae],Ce=l[Ae],!c.hasOwnProperty(Ae)||be===Ce||be===void 0&&Ce===void 0||cf(e,s,Ae,be,c,Ce);return}}for(var fe in l)be=l[fe],l.hasOwnProperty(fe)&&be!=null&&!c.hasOwnProperty(fe)&&vn(e,s,fe,null,c,be);for(Le in c)be=c[Le],Ce=l[Le],!c.hasOwnProperty(Le)||be===Ce||be==null&&Ce==null||vn(e,s,Le,be,c,Ce)}function nv(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function bS(){if(typeof performance.getEntriesByType=="function"){for(var e=0,s=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var m=l[c],g=m.transferSize,j=m.initiatorType,D=m.duration;if(g&&D&&nv(j)){for(j=0,D=m.responseEnd,c+=1;c<l.length;c++){var X=l[c],ye=X.startTime;if(ye>D)break;var Ae=X.transferSize,Le=X.initiatorType;Ae&&nv(Le)&&(X=X.responseEnd,j+=Ae*(X<D?1:(D-ye)/(X-ye)))}if(--c,s+=8*(g+j)/(m.duration/1e3),e++,10<e)break}}if(0<e)return s/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var uf=null,df=null;function cu(e){return e.nodeType===9?e:e.ownerDocument}function rv(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function sv(e,s){if(e===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&s==="foreignObject"?0:e}function hf(e,s){return e==="textarea"||e==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var ff=null;function wS(){var e=window.event;return e&&e.type==="popstate"?e===ff?!1:(ff=e,!0):(ff=null,!1)}var iv=typeof setTimeout=="function"?setTimeout:void 0,SS=typeof clearTimeout=="function"?clearTimeout:void 0,av=typeof Promise=="function"?Promise:void 0,jS=typeof queueMicrotask=="function"?queueMicrotask:typeof av<"u"?function(e){return av.resolve(null).then(e).catch(_S)}:iv;function _S(e){setTimeout(function(){throw e})}function xi(e){return e==="head"}function lv(e,s){var l=s,c=0;do{var m=l.nextSibling;if(e.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"||l==="/&"){if(c===0){e.removeChild(m),Za(s);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")xo(e.ownerDocument.documentElement);else if(l==="head"){l=e.ownerDocument.head,xo(l);for(var g=l.firstChild;g;){var j=g.nextSibling,D=g.nodeName;g[ue]||D==="SCRIPT"||D==="STYLE"||D==="LINK"&&g.rel.toLowerCase()==="stylesheet"||l.removeChild(g),g=j}}else l==="body"&&xo(e.ownerDocument.body);l=m}while(l);Za(s)}function ov(e,s){var l=e;e=0;do{var c=l.nextSibling;if(l.nodeType===1?s?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(s?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(e===0)break;e--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||e++;l=c}while(l)}function pf(e){var s=e.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var l=s;switch(s=s.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":pf(l),xe(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}e.removeChild(l)}}function CS(e,s,l,c){for(;e.nodeType===1;){var m=l;if(e.nodeName.toLowerCase()!==s.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[ue])switch(s){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==m.rel||e.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||e.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||e.getAttribute("title")!==(m.title==null?null:m.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(m.src==null?null:m.src)||e.getAttribute("type")!==(m.type==null?null:m.type)||e.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(s==="input"&&e.type==="hidden"){var g=m.name==null?null:""+m.name;if(m.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=Hr(e.nextSibling),e===null)break}return null}function NS(e,s,l){if(s==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!l||(e=Hr(e.nextSibling),e===null))return null;return e}function cv(e,s){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!s||(e=Hr(e.nextSibling),e===null))return null;return e}function mf(e){return e.data==="$?"||e.data==="$~"}function gf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function ES(e,s){var l=e.ownerDocument;if(e.data==="$~")e._reactRetry=s;else if(e.data!=="$?"||l.readyState!=="loading")s();else{var c=function(){s(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function Hr(e){for(;e!=null;e=e.nextSibling){var s=e.nodeType;if(s===1||s===3)break;if(s===8){if(s=e.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return e}var yf=null;function uv(e){e=e.nextSibling;for(var s=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"||l==="/&"){if(s===0)return Hr(e.nextSibling);s--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||s++}e=e.nextSibling}return null}function dv(e){e=e.previousSibling;for(var s=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(s===0)return e;s--}else l!=="/$"&&l!=="/&"||s++}e=e.previousSibling}return null}function hv(e,s,l){switch(s=cu(l),e){case"html":if(e=s.documentElement,!e)throw Error(a(452));return e;case"head":if(e=s.head,!e)throw Error(a(453));return e;case"body":if(e=s.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function xo(e){for(var s=e.attributes;s.length;)e.removeAttributeNode(s[0]);xe(e)}var Vr=new Map,fv=new Set;function uu(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Is=B.d;B.d={f:kS,r:TS,D:AS,C:RS,L:OS,m:DS,X:LS,S:MS,M:zS};function kS(){var e=Is.f(),s=tu();return e||s}function TS(e){var s=Je(e);s!==null&&s.tag===5&&s.type==="form"?Ag(s):Is.r(e)}var Qa=typeof document>"u"?null:document;function pv(e,s,l){var c=Qa;if(c&&typeof s=="string"&&s){var m=gr(s);m='link[rel="'+e+'"][href="'+m+'"]',typeof l=="string"&&(m+='[crossorigin="'+l+'"]'),fv.has(m)||(fv.add(m),e={rel:e,crossOrigin:l,href:s},c.querySelector(m)===null&&(s=c.createElement("link"),ir(s,"link",e),jt(s),c.head.appendChild(s)))}}function AS(e){Is.D(e),pv("dns-prefetch",e,null)}function RS(e,s){Is.C(e,s),pv("preconnect",e,s)}function OS(e,s,l){Is.L(e,s,l);var c=Qa;if(c&&e&&s){var m='link[rel="preload"][as="'+gr(s)+'"]';s==="image"&&l&&l.imageSrcSet?(m+='[imagesrcset="'+gr(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(m+='[imagesizes="'+gr(l.imageSizes)+'"]')):m+='[href="'+gr(e)+'"]';var g=m;switch(s){case"style":g=Ja(e);break;case"script":g=Xa(e)}Vr.has(g)||(e=v({rel:"preload",href:s==="image"&&l&&l.imageSrcSet?void 0:e,as:s},l),Vr.set(g,e),c.querySelector(m)!==null||s==="style"&&c.querySelector(bo(g))||s==="script"&&c.querySelector(wo(g))||(s=c.createElement("link"),ir(s,"link",e),jt(s),c.head.appendChild(s)))}}function DS(e,s){Is.m(e,s);var l=Qa;if(l&&e){var c=s&&typeof s.as=="string"?s.as:"script",m='link[rel="modulepreload"][as="'+gr(c)+'"][href="'+gr(e)+'"]',g=m;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Xa(e)}if(!Vr.has(g)&&(e=v({rel:"modulepreload",href:e},s),Vr.set(g,e),l.querySelector(m)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(wo(g)))return}c=l.createElement("link"),ir(c,"link",e),jt(c),l.head.appendChild(c)}}}function MS(e,s,l){Is.S(e,s,l);var c=Qa;if(c&&e){var m=Ye(c).hoistableStyles,g=Ja(e);s=s||"default";var j=m.get(g);if(!j){var D={loading:0,preload:null};if(j=c.querySelector(bo(g)))D.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":s},l),(l=Vr.get(g))&&vf(e,l);var X=j=c.createElement("link");jt(X),ir(X,"link",e),X._p=new Promise(function(ye,Ae){X.onload=ye,X.onerror=Ae}),X.addEventListener("load",function(){D.loading|=1}),X.addEventListener("error",function(){D.loading|=2}),D.loading|=4,du(j,s,c)}j={type:"stylesheet",instance:j,count:1,state:D},m.set(g,j)}}}function LS(e,s){Is.X(e,s);var l=Qa;if(l&&e){var c=Ye(l).hoistableScripts,m=Xa(e),g=c.get(m);g||(g=l.querySelector(wo(m)),g||(e=v({src:e,async:!0},s),(s=Vr.get(m))&&xf(e,s),g=l.createElement("script"),jt(g),ir(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(m,g))}}function zS(e,s){Is.M(e,s);var l=Qa;if(l&&e){var c=Ye(l).hoistableScripts,m=Xa(e),g=c.get(m);g||(g=l.querySelector(wo(m)),g||(e=v({src:e,async:!0,type:"module"},s),(s=Vr.get(m))&&xf(e,s),g=l.createElement("script"),jt(g),ir(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(m,g))}}function mv(e,s,l,c){var m=(m=ve.current)?uu(m):null;if(!m)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(s=Ja(l.href),l=Ye(m).hoistableStyles,c=l.get(s),c||(c={type:"style",instance:null,count:0,state:null},l.set(s,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){e=Ja(l.href);var g=Ye(m).hoistableStyles,j=g.get(e);if(j||(m=m.ownerDocument||m,j={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,j),(g=m.querySelector(bo(e)))&&!g._p&&(j.instance=g,j.state.loading=5),Vr.has(e)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Vr.set(e,l),g||US(m,e,l,j.state))),s&&c===null)throw Error(a(528,""));return j}if(s&&c!==null)throw Error(a(529,""));return null;case"script":return s=l.async,l=l.src,typeof l=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Xa(l),l=Ye(m).hoistableScripts,c=l.get(s),c||(c={type:"script",instance:null,count:0,state:null},l.set(s,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Ja(e){return'href="'+gr(e)+'"'}function bo(e){return'link[rel="stylesheet"]['+e+"]"}function gv(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function US(e,s,l,c){e.querySelector('link[rel="preload"][as="style"]['+s+"]")?c.loading=1:(s=e.createElement("link"),c.preload=s,s.addEventListener("load",function(){return c.loading|=1}),s.addEventListener("error",function(){return c.loading|=2}),ir(s,"link",l),jt(s),e.head.appendChild(s))}function Xa(e){return'[src="'+gr(e)+'"]'}function wo(e){return"script[async]"+e}function yv(e,s,l){if(s.count++,s.instance===null)switch(s.type){case"style":var c=e.querySelector('style[data-href~="'+gr(l.href)+'"]');if(c)return s.instance=c,jt(c),c;var m=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),jt(c),ir(c,"style",m),du(c,l.precedence,e),s.instance=c;case"stylesheet":m=Ja(l.href);var g=e.querySelector(bo(m));if(g)return s.state.loading|=4,s.instance=g,jt(g),g;c=gv(l),(m=Vr.get(m))&&vf(c,m),g=(e.ownerDocument||e).createElement("link"),jt(g);var j=g;return j._p=new Promise(function(D,X){j.onload=D,j.onerror=X}),ir(g,"link",c),s.state.loading|=4,du(g,l.precedence,e),s.instance=g;case"script":return g=Xa(l.src),(m=e.querySelector(wo(g)))?(s.instance=m,jt(m),m):(c=l,(m=Vr.get(g))&&(c=v({},l),xf(c,m)),e=e.ownerDocument||e,m=e.createElement("script"),jt(m),ir(m,"link",c),e.head.appendChild(m),s.instance=m);case"void":return null;default:throw Error(a(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(c=s.instance,s.state.loading|=4,du(c,l.precedence,e));return s.instance}function du(e,s,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=c.length?c[c.length-1]:null,g=m,j=0;j<c.length;j++){var D=c[j];if(D.dataset.precedence===s)g=D;else if(g!==m)break}g?g.parentNode.insertBefore(e,g.nextSibling):(s=l.nodeType===9?l.head:l,s.insertBefore(e,s.firstChild))}function vf(e,s){e.crossOrigin==null&&(e.crossOrigin=s.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=s.referrerPolicy),e.title==null&&(e.title=s.title)}function xf(e,s){e.crossOrigin==null&&(e.crossOrigin=s.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=s.referrerPolicy),e.integrity==null&&(e.integrity=s.integrity)}var hu=null;function vv(e,s,l){if(hu===null){var c=new Map,m=hu=new Map;m.set(l,c)}else m=hu,c=m.get(l),c||(c=new Map,m.set(l,c));if(c.has(e))return c;for(c.set(e,null),l=l.getElementsByTagName(e),m=0;m<l.length;m++){var g=l[m];if(!(g[ue]||g[$e]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var j=g.getAttribute(s)||"";j=e+j;var D=c.get(j);D?D.push(g):c.set(j,[g])}}return c}function xv(e,s,l){e=e.ownerDocument||e,e.head.insertBefore(l,s==="title"?e.querySelector("head > title"):null)}function IS(e,s,l){if(l===1||s.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(e=s.disabled,typeof s.precedence=="string"&&e==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function bv(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function BS(e,s,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var m=Ja(c.href),g=s.querySelector(bo(m));if(g){s=g._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(e.count++,e=fu.bind(e),s.then(e,e)),l.state.loading|=4,l.instance=g,jt(g);return}g=s.ownerDocument||s,c=gv(c),(m=Vr.get(m))&&vf(c,m),g=g.createElement("link"),jt(g);var j=g;j._p=new Promise(function(D,X){j.onload=D,j.onerror=X}),ir(g,"link",c),l.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(l,s),(s=l.state.preload)&&(l.state.loading&3)===0&&(e.count++,l=fu.bind(e),s.addEventListener("load",l),s.addEventListener("error",l))}}var bf=0;function $S(e,s){return e.stylesheets&&e.count===0&&mu(e,e.stylesheets),0<e.count||0<e.imgCount?function(l){var c=setTimeout(function(){if(e.stylesheets&&mu(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+s);0<e.imgBytes&&bf===0&&(bf=62500*bS());var m=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&mu(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>bf?50:800)+s);return e.unsuspend=l,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(m)}}:null}function fu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)mu(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var pu=null;function mu(e,s){e.stylesheets=null,e.unsuspend!==null&&(e.count++,pu=new Map,s.forEach(PS,e),pu=null,fu.call(e))}function PS(e,s){if(!(s.state.loading&4)){var l=pu.get(e);if(l)var c=l.get(null);else{l=new Map,pu.set(e,l);for(var m=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<m.length;g++){var j=m[g];(j.nodeName==="LINK"||j.getAttribute("media")!=="not all")&&(l.set(j.dataset.precedence,j),c=j)}c&&l.set(null,c)}m=s.instance,j=m.getAttribute("data-precedence"),g=l.get(j)||c,g===c&&l.set(null,m),l.set(j,m),this.count++,c=fu.bind(this),m.addEventListener("load",c),m.addEventListener("error",c),g?g.parentNode.insertBefore(m,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(m,e.firstChild)),s.state.loading|=4}}var So={$$typeof:L,Provider:null,Consumer:null,_currentValue:q,_currentValue2:q,_threadCount:0};function qS(e,s,l,c,m,g,j,D,X){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=on(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=on(0),this.hiddenUpdates=on(null),this.identifierPrefix=c,this.onUncaughtError=m,this.onCaughtError=g,this.onRecoverableError=j,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=X,this.incompleteTransitions=new Map}function wv(e,s,l,c,m,g,j,D,X,ye,Ae,Le){return e=new qS(e,s,l,j,X,ye,Ae,Le,D),s=1,g===!0&&(s|=24),g=Cr(3,null,null,s),e.current=g,g.stateNode=e,s=Xd(),s.refCount++,e.pooledCache=s,s.refCount++,g.memoizedState={element:c,isDehydrated:l,cache:s},nh(g),e}function Sv(e){return e?(e=Ta,e):Ta}function jv(e,s,l,c,m,g){m=Sv(m),c.context===null?c.context=m:c.pendingContext=m,c=oi(s),c.payload={element:l},g=g===void 0?null:g,g!==null&&(c.callback=g),l=ci(e,c,s),l!==null&&(wr(l,e,s),Zl(l,e,s))}function _v(e,s){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<s?l:s}}function wf(e,s){_v(e,s),(e=e.alternate)&&_v(e,s)}function Cv(e){if(e.tag===13||e.tag===31){var s=Hi(e,67108864);s!==null&&wr(s,e,67108864),wf(e,67108864)}}function Nv(e){if(e.tag===13||e.tag===31){var s=Ar();s=ut(s);var l=Hi(e,s);l!==null&&wr(l,e,s),wf(e,s)}}var gu=!0;function FS(e,s,l,c){var m=E.T;E.T=null;var g=B.p;try{B.p=2,Sf(e,s,l,c)}finally{B.p=g,E.T=m}}function HS(e,s,l,c){var m=E.T;E.T=null;var g=B.p;try{B.p=8,Sf(e,s,l,c)}finally{B.p=g,E.T=m}}function Sf(e,s,l,c){if(gu){var m=jf(c);if(m===null)of(e,s,c,yu,l),kv(e,c);else if(GS(m,e,s,l,c))c.stopPropagation();else if(kv(e,c),s&4&&-1<VS.indexOf(e)){for(;m!==null;){var g=Je(m);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var j=Fe(g.pendingLanes);if(j!==0){var D=g;for(D.pendingLanes|=2,D.entangledLanes|=2;j;){var X=1<<31-sn(j);D.entanglements[1]|=X,j&=~X}ys(g),(dn&6)===0&&(Zc=dt()+500,go(0))}}break;case 31:case 13:D=Hi(g,2),D!==null&&wr(D,g,2),tu(),wf(g,2)}if(g=jf(c),g===null&&of(e,s,c,yu,l),g===m)break;m=g}m!==null&&c.stopPropagation()}else of(e,s,c,null,l)}}function jf(e){return e=Il(e),_f(e)}var yu=null;function _f(e){if(yu=null,e=Pe(e),e!==null){var s=u(e);if(s===null)e=null;else{var l=s.tag;if(l===13){if(e=d(s),e!==null)return e;e=null}else if(l===31){if(e=f(s),e!==null)return e;e=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;e=null}else s!==e&&(e=null)}}return yu=e,null}function Ev(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(rt()){case Ve:return 2;case ot:return 8;case tt:case St:return 32;case gn:return 268435456;default:return 32}default:return 32}}var Cf=!1,bi=null,wi=null,Si=null,jo=new Map,_o=new Map,ji=[],VS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function kv(e,s){switch(e){case"focusin":case"focusout":bi=null;break;case"dragenter":case"dragleave":wi=null;break;case"mouseover":case"mouseout":Si=null;break;case"pointerover":case"pointerout":jo.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":_o.delete(s.pointerId)}}function Co(e,s,l,c,m,g){return e===null||e.nativeEvent!==g?(e={blockedOn:s,domEventName:l,eventSystemFlags:c,nativeEvent:g,targetContainers:[m]},s!==null&&(s=Je(s),s!==null&&Cv(s)),e):(e.eventSystemFlags|=c,s=e.targetContainers,m!==null&&s.indexOf(m)===-1&&s.push(m),e)}function GS(e,s,l,c,m){switch(s){case"focusin":return bi=Co(bi,e,s,l,c,m),!0;case"dragenter":return wi=Co(wi,e,s,l,c,m),!0;case"mouseover":return Si=Co(Si,e,s,l,c,m),!0;case"pointerover":var g=m.pointerId;return jo.set(g,Co(jo.get(g)||null,e,s,l,c,m)),!0;case"gotpointercapture":return g=m.pointerId,_o.set(g,Co(_o.get(g)||null,e,s,l,c,m)),!0}return!1}function Tv(e){var s=Pe(e.target);if(s!==null){var l=u(s);if(l!==null){if(s=l.tag,s===13){if(s=d(l),s!==null){e.blockedOn=s,ht(e.priority,function(){Nv(l)});return}}else if(s===31){if(s=f(l),s!==null){e.blockedOn=s,ht(e.priority,function(){Nv(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function vu(e){if(e.blockedOn!==null)return!1;for(var s=e.targetContainers;0<s.length;){var l=jf(e.nativeEvent);if(l===null){l=e.nativeEvent;var c=new l.constructor(l.type,l);Ul=c,l.target.dispatchEvent(c),Ul=null}else return s=Je(l),s!==null&&Cv(s),e.blockedOn=l,!1;s.shift()}return!0}function Av(e,s,l){vu(e)&&l.delete(s)}function KS(){Cf=!1,bi!==null&&vu(bi)&&(bi=null),wi!==null&&vu(wi)&&(wi=null),Si!==null&&vu(Si)&&(Si=null),jo.forEach(Av),_o.forEach(Av)}function xu(e,s){e.blockedOn===s&&(e.blockedOn=null,Cf||(Cf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,KS)))}var bu=null;function Rv(e){bu!==e&&(bu=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){bu===e&&(bu=null);for(var s=0;s<e.length;s+=3){var l=e[s],c=e[s+1],m=e[s+2];if(typeof c!="function"){if(_f(c||l)===null)continue;break}var g=Je(l);g!==null&&(e.splice(s,3),s-=3,Sh(g,{pending:!0,data:m,method:l.method,action:c},c,m))}}))}function Za(e){function s(X){return xu(X,e)}bi!==null&&xu(bi,e),wi!==null&&xu(wi,e),Si!==null&&xu(Si,e),jo.forEach(s),_o.forEach(s);for(var l=0;l<ji.length;l++){var c=ji[l];c.blockedOn===e&&(c.blockedOn=null)}for(;0<ji.length&&(l=ji[0],l.blockedOn===null);)Tv(l),l.blockedOn===null&&ji.shift();if(l=(e.ownerDocument||e).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var m=l[c],g=l[c+1],j=m[ze]||null;if(typeof g=="function")j||Rv(l);else if(j){var D=null;if(g&&g.hasAttribute("formAction")){if(m=g,j=g[ze]||null)D=j.formAction;else if(_f(m)!==null)continue}else D=j.action;typeof D=="function"?l[c+1]=D:(l.splice(c,3),c-=3),Rv(l)}}}function Ov(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(j){return m=j})},focusReset:"manual",scroll:"manual"})}function s(){m!==null&&(m(),m=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,m=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),m!==null&&(m(),m=null)}}}function Nf(e){this._internalRoot=e}wu.prototype.render=Nf.prototype.render=function(e){var s=this._internalRoot;if(s===null)throw Error(a(409));var l=s.current,c=Ar();jv(l,c,e,s,null,null)},wu.prototype.unmount=Nf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var s=e.containerInfo;jv(e.current,2,null,e,null,null),tu(),s[At]=null}};function wu(e){this._internalRoot=e}wu.prototype.unstable_scheduleHydration=function(e){if(e){var s=tn();e={blockedOn:null,target:e,priority:s};for(var l=0;l<ji.length&&s!==0&&s<ji[l].priority;l++);ji.splice(l,0,e),l===0&&Tv(e)}};var Dv=t.version;if(Dv!=="19.2.3")throw Error(a(527,Dv,"19.2.3"));B.findDOMNode=function(e){var s=e._reactInternals;if(s===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=p(s),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var YS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:E,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Su=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Su.isDisabled&&Su.supportsFiber)try{Ft=Su.inject(YS),rn=Su}catch{}}return Eo.createRoot=function(e,s){if(!o(e))throw Error(a(299));var l=!1,c="",m=$g,g=Pg,j=qg;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(c=s.identifierPrefix),s.onUncaughtError!==void 0&&(m=s.onUncaughtError),s.onCaughtError!==void 0&&(g=s.onCaughtError),s.onRecoverableError!==void 0&&(j=s.onRecoverableError)),s=wv(e,1,!1,null,null,l,c,null,m,g,j,Ov),e[At]=s.current,lf(e),new Nf(s)},Eo.hydrateRoot=function(e,s,l){if(!o(e))throw Error(a(299));var c=!1,m="",g=$g,j=Pg,D=qg,X=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(g=l.onUncaughtError),l.onCaughtError!==void 0&&(j=l.onCaughtError),l.onRecoverableError!==void 0&&(D=l.onRecoverableError),l.formState!==void 0&&(X=l.formState)),s=wv(e,1,!0,s,l??null,c,m,X,g,j,D,Ov),s.context=Sv(null),l=s.current,c=Ar(),c=ut(c),m=oi(c),m.callback=null,ci(l,m,c),l=c,s.current.lanes=l,he(s,l),ys(s),e[At]=s.current,lf(e),new wu(s)},Eo.version="19.2.3",Eo}var Fv;function rj(){if(Fv)return Tf.exports;Fv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Tf.exports=nj(),Tf.exports}var sj=rj();var Hv="popstate";function ij(n={}){function t(a,o){let{pathname:u,search:d,hash:f}=a.location;return yp("",{pathname:u,search:d,hash:f},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function i(a,o){return typeof o=="string"?o:Ko(o)}return lj(t,i,null,n)}function Wn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Wr(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function aj(){return Math.random().toString(36).substring(2,10)}function Vv(n,t){return{usr:n.state,key:n.key,idx:t}}function yp(n,t,i=null,a){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?ic(t):t,state:i,key:t&&t.key||a||aj()}}function Ko({pathname:n="/",search:t="",hash:i=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(n+=i.charAt(0)==="#"?i:"#"+i),n}function ic(n){let t={};if(n){let i=n.indexOf("#");i>=0&&(t.hash=n.substring(i),n=n.substring(0,i));let a=n.indexOf("?");a>=0&&(t.search=n.substring(a),n=n.substring(0,a)),n&&(t.pathname=n)}return t}function lj(n,t,i,a={}){let{window:o=document.defaultView,v5Compat:u=!1}=a,d=o.history,f="POP",h=null,p=y();p==null&&(p=0,d.replaceState({...d.state,idx:p},""));function y(){return(d.state||{idx:null}).idx}function v(){f="POP";let S=y(),N=S==null?null:S-p;p=S,h&&h({action:f,location:C.location,delta:N})}function x(S,N){f="PUSH";let T=yp(C.location,S,N);p=y()+1;let L=Vv(T,p),R=C.createHref(T);try{d.pushState(L,"",R)}catch(J){if(J instanceof DOMException&&J.name==="DataCloneError")throw J;o.location.assign(R)}u&&h&&h({action:f,location:C.location,delta:1})}function w(S,N){f="REPLACE";let T=yp(C.location,S,N);p=y();let L=Vv(T,p),R=C.createHref(T);d.replaceState(L,"",R),u&&h&&h({action:f,location:C.location,delta:0})}function _(S){return oj(S)}let C={get action(){return f},get location(){return n(o,d)},listen(S){if(h)throw new Error("A history only accepts one active listener");return o.addEventListener(Hv,v),h=S,()=>{o.removeEventListener(Hv,v),h=null}},createHref(S){return t(o,S)},createURL:_,encodeLocation(S){let N=_(S);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:x,replace:w,go(S){return d.go(S)}};return C}function oj(n,t=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Wn(i,"No window.location.(origin|href) available to create URL");let a=typeof n=="string"?n:Ko(n);return a=a.replace(/ $/,"%20"),!t&&a.startsWith("//")&&(a=i+a),new URL(a,i)}function R0(n,t,i="/"){return cj(n,t,i,!1)}function cj(n,t,i,a){let o=typeof t=="string"?ic(t):t,u=Gs(o.pathname||"/",i);if(u==null)return null;let d=O0(n);uj(d);let f=null;for(let h=0;f==null&&h<d.length;++h){let p=wj(u);f=xj(d[h],p,a)}return f}function O0(n,t=[],i=[],a="",o=!1){let u=(d,f,h=o,p)=>{let y={relativePath:p===void 0?d.path||"":p,caseSensitive:d.caseSensitive===!0,childrenIndex:f,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(a)&&h)return;Wn(y.relativePath.startsWith(a),`Absolute route path "${y.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(a.length)}let v=Vs([a,y.relativePath]),x=i.concat(y);d.children&&d.children.length>0&&(Wn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),O0(d.children,t,x,v,h)),!(d.path==null&&!d.index)&&t.push({path:v,score:yj(v,d.index),routesMeta:x})};return n.forEach((d,f)=>{if(d.path===""||!d.path?.includes("?"))u(d,f);else for(let h of D0(d.path))u(d,f,!0,h)}),t}function D0(n){let t=n.split("/");if(t.length===0)return[];let[i,...a]=t,o=i.endsWith("?"),u=i.replace(/\?$/,"");if(a.length===0)return o?[u,""]:[u];let d=D0(a.join("/")),f=[];return f.push(...d.map(h=>h===""?u:[u,h].join("/"))),o&&f.push(...d),f.map(h=>n.startsWith("/")&&h===""?"/":h)}function uj(n){n.sort((t,i)=>t.score!==i.score?i.score-t.score:vj(t.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}var dj=/^:[\w-]+$/,hj=3,fj=2,pj=1,mj=10,gj=-2,Gv=n=>n==="*";function yj(n,t){let i=n.split("/"),a=i.length;return i.some(Gv)&&(a+=gj),t&&(a+=fj),i.filter(o=>!Gv(o)).reduce((o,u)=>o+(dj.test(u)?hj:u===""?pj:mj),a)}function vj(n,t){return n.length===t.length&&n.slice(0,-1).every((a,o)=>a===t[o])?n[n.length-1]-t[t.length-1]:0}function xj(n,t,i=!1){let{routesMeta:a}=n,o={},u="/",d=[];for(let f=0;f<a.length;++f){let h=a[f],p=f===a.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=Wu({path:h.relativePath,caseSensitive:h.caseSensitive,end:p},y),x=h.route;if(!v&&p&&i&&!a[a.length-1].route.index&&(v=Wu({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},y)),!v)return null;Object.assign(o,v.params),d.push({params:o,pathname:Vs([u,v.pathname]),pathnameBase:Cj(Vs([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=Vs([u,v.pathnameBase]))}return d}function Wu(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[i,a]=bj(n.path,n.caseSensitive,n.end),o=t.match(i);if(!o)return null;let u=o[0],d=u.replace(/(.)\/+$/,"$1"),f=o.slice(1);return{params:a.reduce((p,{paramName:y,isOptional:v},x)=>{if(y==="*"){let _=f[x]||"";d=u.slice(0,u.length-_.length).replace(/(.)\/+$/,"$1")}const w=f[x];return v&&!w?p[y]=void 0:p[y]=(w||"").replace(/%2F/g,"/"),p},{}),pathname:u,pathnameBase:d,pattern:n}}function bj(n,t=!1,i=!0){Wr(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let a=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,f,h)=>(a.push({paramName:f,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(a.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),a]}function wj(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Wr(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Gs(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,a=n.charAt(i);return a&&a!=="/"?null:n.slice(i)||"/"}var M0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Sj=n=>M0.test(n);function jj(n,t="/"){let{pathname:i,search:a="",hash:o=""}=typeof n=="string"?ic(n):n,u;if(i)if(Sj(i))u=i;else{if(i.includes("//")){let d=i;i=i.replace(/\/\/+/g,"/"),Wr(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${i}`)}i.startsWith("/")?u=Kv(i.substring(1),"/"):u=Kv(i,t)}else u=t;return{pathname:u,search:Nj(a),hash:Ej(o)}}function Kv(n,t){let i=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?i.length>1&&i.pop():o!=="."&&i.push(o)}),i.length>1?i.join("/"):"/"}function Df(n,t,i,a){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function _j(n){return n.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function L0(n){let t=_j(n);return t.map((i,a)=>a===t.length-1?i.pathname:i.pathnameBase)}function z0(n,t,i,a=!1){let o;typeof n=="string"?o=ic(n):(o={...n},Wn(!o.pathname||!o.pathname.includes("?"),Df("?","pathname","search",o)),Wn(!o.pathname||!o.pathname.includes("#"),Df("#","pathname","hash",o)),Wn(!o.search||!o.search.includes("#"),Df("#","search","hash",o)));let u=n===""||o.pathname==="",d=u?"/":o.pathname,f;if(d==null)f=i;else{let v=t.length-1;if(!a&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;o.pathname=x.join("/")}f=v>=0?t[v]:"/"}let h=jj(o,f),p=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&i.endsWith("/");return!h.pathname.endsWith("/")&&(p||y)&&(h.pathname+="/"),h}var Vs=n=>n.join("/").replace(/\/\/+/g,"/"),Cj=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Nj=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Ej=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,kj=class{constructor(n,t,i,a=!1){this.status=n,this.statusText=t||"",this.internal=a,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}};function Tj(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function Aj(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var U0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function I0(n,t){let i=n;if(typeof i!="string"||!M0.test(i))return{absoluteURL:void 0,isExternal:!1,to:i};let a=i,o=!1;if(U0)try{let u=new URL(window.location.href),d=i.startsWith("//")?new URL(u.protocol+i):new URL(i),f=Gs(d.pathname,t);d.origin===u.origin&&f!=null?i=f+d.search+d.hash:o=!0}catch{Wr(!1,`<Link to="${i}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:o,to:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var B0=["POST","PUT","PATCH","DELETE"];new Set(B0);var Rj=["GET",...B0];new Set(Rj);var Cl=b.createContext(null);Cl.displayName="DataRouter";var hd=b.createContext(null);hd.displayName="DataRouterState";var Oj=b.createContext(!1),$0=b.createContext({isTransitioning:!1});$0.displayName="ViewTransition";var Dj=b.createContext(new Map);Dj.displayName="Fetchers";var Mj=b.createContext(null);Mj.displayName="Await";var Qr=b.createContext(null);Qr.displayName="Navigation";var fd=b.createContext(null);fd.displayName="Location";var Ys=b.createContext({outlet:null,matches:[],isDataRoute:!1});Ys.displayName="Route";var Pp=b.createContext(null);Pp.displayName="RouteError";var P0="REACT_ROUTER_ERROR",Lj="REDIRECT",zj="ROUTE_ERROR_RESPONSE";function Uj(n){if(n.startsWith(`${P0}:${Lj}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function Ij(n){if(n.startsWith(`${P0}:${zj}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new kj(t.status,t.statusText,t.data)}catch{}}function Bj(n,{relative:t}={}){Wn(ac(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:a}=b.useContext(Qr),{hash:o,pathname:u,search:d}=lc(n,{relative:t}),f=u;return i!=="/"&&(f=u==="/"?i:Vs([i,u])),a.createHref({pathname:f,search:d,hash:o})}function ac(){return b.useContext(fd)!=null}function Ws(){return Wn(ac(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(fd).location}var q0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function F0(n){b.useContext(Qr).static||b.useLayoutEffect(n)}function H0(){let{isDataRoute:n}=b.useContext(Ys);return n?Xj():$j()}function $j(){Wn(ac(),"useNavigate() may be used only in the context of a <Router> component.");let n=b.useContext(Cl),{basename:t,navigator:i}=b.useContext(Qr),{matches:a}=b.useContext(Ys),{pathname:o}=Ws(),u=JSON.stringify(L0(a)),d=b.useRef(!1);return F0(()=>{d.current=!0}),b.useCallback((h,p={})=>{if(Wr(d.current,q0),!d.current)return;if(typeof h=="number"){i.go(h);return}let y=z0(h,JSON.parse(u),o,p.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Vs([t,y.pathname])),(p.replace?i.replace:i.push)(y,p.state,p)},[t,i,u,o,n])}b.createContext(null);function lc(n,{relative:t}={}){let{matches:i}=b.useContext(Ys),{pathname:a}=Ws(),o=JSON.stringify(L0(i));return b.useMemo(()=>z0(n,JSON.parse(o),a,t==="path"),[n,o,a,t])}function Pj(n,t,i,a,o){Wn(ac(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=b.useContext(Qr),{matches:d}=b.useContext(Ys),f=d[d.length-1],h=f?f.params:{},p=f?f.pathname:"/",y=f?f.pathnameBase:"/",v=f&&f.route;{let T=v&&v.path||"";G0(p,!v||T.endsWith("*")||T.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${T}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${T}"> to <Route path="${T==="/"?"*":`${T}/*`}">.`)}let x=Ws(),w;w=x;let _=w.pathname||"/",C=_;if(y!=="/"){let T=y.replace(/^\//,"").split("/");C="/"+_.replace(/^\//,"").split("/").slice(T.length).join("/")}let S=R0(n,{pathname:C});return Wr(v||S!=null,`No routes matched location "${w.pathname}${w.search}${w.hash}" `),Wr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${w.pathname}${w.search}${w.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),Gj(S&&S.map(T=>Object.assign({},T,{params:Object.assign({},h,T.params),pathname:Vs([y,u.encodeLocation?u.encodeLocation(T.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathname]),pathnameBase:T.pathnameBase==="/"?y:Vs([y,u.encodeLocation?u.encodeLocation(T.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:T.pathnameBase])})),d,i,a,o)}function qj(){let n=Jj(),t=Tj(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),i=n instanceof Error?n.stack:null,a="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:a},u={padding:"2px 4px",backgroundColor:a},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:u},"ErrorBoundary")," or"," ",b.createElement("code",{style:u},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},t),i?b.createElement("pre",{style:o},i):null,d)}var Fj=b.createElement(qj,null),V0=class extends b.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const i=Ij(n.digest);i&&(n=i)}let t=n!==void 0?b.createElement(Ys.Provider,{value:this.props.routeContext},b.createElement(Pp.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?b.createElement(Hj,{error:n},t):t}};V0.contextType=Oj;var Mf=new WeakMap;function Hj({children:n,error:t}){let{basename:i}=b.useContext(Qr);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let a=Uj(t.digest);if(a){let o=Mf.get(t);if(o)throw o;let u=I0(a.location,i);if(U0&&!Mf.get(t))if(u.isExternal||a.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:a.replace}));throw Mf.set(t,d),d}return b.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function Vj({routeContext:n,match:t,children:i}){let a=b.useContext(Cl);return a&&a.static&&a.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=t.route.id),b.createElement(Ys.Provider,{value:n},i)}function Gj(n,t=[],i=null,a=null,o=null){if(n==null){if(!i)return null;if(i.errors)n=i.matches;else if(t.length===0&&!i.initialized&&i.matches.length>0)n=i.matches;else return null}let u=n,d=i?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);Wn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let f=!1,h=-1;if(i)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(h=y),v.route.id){let{loaderData:x,errors:w}=i,_=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!w||w[v.route.id]===void 0);if(v.route.lazy||_){f=!0,h>=0?u=u.slice(0,h+1):u=[u[0]];break}}}let p=i&&a?(y,v)=>{a(y,{location:i.location,params:i.matches?.[0]?.params??{},unstable_pattern:Aj(i.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let w,_=!1,C=null,S=null;i&&(w=d&&v.route.id?d[v.route.id]:void 0,C=v.route.errorElement||Fj,f&&(h<0&&x===0?(G0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),_=!0,S=null):h===x&&(_=!0,S=v.route.hydrateFallbackElement||null)));let N=t.concat(u.slice(0,x+1)),T=()=>{let L;return w?L=C:_?L=S:v.route.Component?L=b.createElement(v.route.Component,null):v.route.element?L=v.route.element:L=y,b.createElement(Vj,{match:v,routeContext:{outlet:y,matches:N,isDataRoute:i!=null},children:L})};return i&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?b.createElement(V0,{location:i.location,revalidation:i.revalidation,component:C,error:w,children:T(),routeContext:{outlet:null,matches:N,isDataRoute:!0},onError:p}):T()},null)}function qp(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Kj(n){let t=b.useContext(Cl);return Wn(t,qp(n)),t}function Yj(n){let t=b.useContext(hd);return Wn(t,qp(n)),t}function Wj(n){let t=b.useContext(Ys);return Wn(t,qp(n)),t}function Fp(n){let t=Wj(n),i=t.matches[t.matches.length-1];return Wn(i.route.id,`${n} can only be used on routes that contain a unique "id"`),i.route.id}function Qj(){return Fp("useRouteId")}function Jj(){let n=b.useContext(Pp),t=Yj("useRouteError"),i=Fp("useRouteError");return n!==void 0?n:t.errors?.[i]}function Xj(){let{router:n}=Kj("useNavigate"),t=Fp("useNavigate"),i=b.useRef(!1);return F0(()=>{i.current=!0}),b.useCallback(async(o,u={})=>{Wr(i.current,q0),i.current&&(typeof o=="number"?await n.navigate(o):await n.navigate(o,{fromRouteId:t,...u}))},[n,t])}var Yv={};function G0(n,t,i){!t&&!Yv[n]&&(Yv[n]=!0,Wr(!1,i))}b.memo(Zj);function Zj({routes:n,future:t,state:i,onError:a}){return Pj(n,void 0,i,a,t)}function e_({basename:n="/",children:t=null,location:i,navigationType:a="POP",navigator:o,static:u=!1,unstable_useTransitions:d}){Wn(!ac(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=n.replace(/^\/*/,"/"),h=b.useMemo(()=>({basename:f,navigator:o,static:u,unstable_useTransitions:d,future:{}}),[f,o,u,d]);typeof i=="string"&&(i=ic(i));let{pathname:p="/",search:y="",hash:v="",state:x=null,key:w="default"}=i,_=b.useMemo(()=>{let C=Gs(p,f);return C==null?null:{location:{pathname:C,search:y,hash:v,state:x,key:w},navigationType:a}},[f,p,y,v,x,w,a]);return Wr(_!=null,`<Router basename="${f}"> is not able to match the URL "${p}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:b.createElement(Qr.Provider,{value:h},b.createElement(fd.Provider,{children:t,value:_}))}var qu="get",Fu="application/x-www-form-urlencoded";function pd(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function t_(n){return pd(n)&&n.tagName.toLowerCase()==="button"}function n_(n){return pd(n)&&n.tagName.toLowerCase()==="form"}function r_(n){return pd(n)&&n.tagName.toLowerCase()==="input"}function s_(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function i_(n,t){return n.button===0&&(!t||t==="_self")&&!s_(n)}function vp(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,i)=>{let a=n[i];return t.concat(Array.isArray(a)?a.map(o=>[i,o]):[[i,a]])},[]))}function a_(n,t){let i=vp(n);return t&&t.forEach((a,o)=>{i.has(o)||t.getAll(o).forEach(u=>{i.append(o,u)})}),i}var ju=null;function l_(){if(ju===null)try{new FormData(document.createElement("form"),0),ju=!1}catch{ju=!0}return ju}var o_=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Lf(n){return n!=null&&!o_.has(n)?(Wr(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Fu}"`),null):n}function c_(n,t){let i,a,o,u,d;if(n_(n)){let f=n.getAttribute("action");a=f?Gs(f,t):null,i=n.getAttribute("method")||qu,o=Lf(n.getAttribute("enctype"))||Fu,u=new FormData(n)}else if(t_(n)||r_(n)&&(n.type==="submit"||n.type==="image")){let f=n.form;if(f==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=n.getAttribute("formaction")||f.getAttribute("action");if(a=h?Gs(h,t):null,i=n.getAttribute("formmethod")||f.getAttribute("method")||qu,o=Lf(n.getAttribute("formenctype"))||Lf(f.getAttribute("enctype"))||Fu,u=new FormData(f,n),!l_()){let{name:p,type:y,value:v}=n;if(y==="image"){let x=p?`${p}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else p&&u.append(p,v)}}else{if(pd(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=qu,a=null,o=Fu,d=n}return u&&o==="text/plain"&&(d=u,u=void 0),{action:a,method:i.toLowerCase(),encType:o,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Hp(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function u_(n,t,i){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return a.pathname==="/"?a.pathname=`_root.${i}`:t&&Gs(a.pathname,t)==="/"?a.pathname=`${t.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function d_(n,t){if(n.id in t)return t[n.id];try{let i=await import(n.module);return t[n.id]=i,i}catch(i){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function h_(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function f_(n,t,i){let a=await Promise.all(n.map(async o=>{let u=t.routes[o.route.id];if(u){let d=await d_(u,i);return d.links?d.links():[]}return[]}));return y_(a.flat(1).filter(h_).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function Wv(n,t,i,a,o,u){let d=(h,p)=>i[p]?h.route.id!==i[p].route.id:!0,f=(h,p)=>i[p].pathname!==h.pathname||i[p].route.path?.endsWith("*")&&i[p].params["*"]!==h.params["*"];return u==="assets"?t.filter((h,p)=>d(h,p)||f(h,p)):u==="data"?t.filter((h,p)=>{let y=a.routes[h.route.id];if(!y||!y.hasLoader)return!1;if(d(h,p)||f(h,p))return!0;if(h.route.shouldRevalidate){let v=h.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:i[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function p_(n,t,{includeHydrateFallback:i}={}){return m_(n.map(a=>{let o=t.routes[a.route.id];if(!o)return[];let u=[o.module];return o.clientActionModule&&(u=u.concat(o.clientActionModule)),o.clientLoaderModule&&(u=u.concat(o.clientLoaderModule)),i&&o.hydrateFallbackModule&&(u=u.concat(o.hydrateFallbackModule)),o.imports&&(u=u.concat(o.imports)),u}).flat(1))}function m_(n){return[...new Set(n)]}function g_(n){let t={},i=Object.keys(n).sort();for(let a of i)t[a]=n[a];return t}function y_(n,t){let i=new Set;return new Set(t),n.reduce((a,o)=>{let u=JSON.stringify(g_(o));return i.has(u)||(i.add(u),a.push({key:u,link:o})),a},[])}function K0(){let n=b.useContext(Cl);return Hp(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function v_(){let n=b.useContext(hd);return Hp(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Vp=b.createContext(void 0);Vp.displayName="FrameworkContext";function Y0(){let n=b.useContext(Vp);return Hp(n,"You must render this element inside a <HydratedRouter> element"),n}function x_(n,t){let i=b.useContext(Vp),[a,o]=b.useState(!1),[u,d]=b.useState(!1),{onFocus:f,onBlur:h,onMouseEnter:p,onMouseLeave:y,onTouchStart:v}=t,x=b.useRef(null);b.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let C=N=>{N.forEach(T=>{d(T.isIntersecting)})},S=new IntersectionObserver(C,{threshold:.5});return x.current&&S.observe(x.current),()=>{S.disconnect()}}},[n]),b.useEffect(()=>{if(a){let C=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(C)}}},[a]);let w=()=>{o(!0)},_=()=>{o(!1),d(!1)};return i?n!=="intent"?[u,x,{}]:[u,x,{onFocus:ko(f,w),onBlur:ko(h,_),onMouseEnter:ko(p,w),onMouseLeave:ko(y,_),onTouchStart:ko(v,w)}]:[!1,x,{}]}function ko(n,t){return i=>{n&&n(i),i.defaultPrevented||t(i)}}function b_({page:n,...t}){let{router:i}=K0(),a=b.useMemo(()=>R0(i.routes,n,i.basename),[i.routes,n,i.basename]);return a?b.createElement(S_,{page:n,matches:a,...t}):null}function w_(n){let{manifest:t,routeModules:i}=Y0(),[a,o]=b.useState([]);return b.useEffect(()=>{let u=!1;return f_(n,t,i).then(d=>{u||o(d)}),()=>{u=!0}},[n,t,i]),a}function S_({page:n,matches:t,...i}){let a=Ws(),{manifest:o,routeModules:u}=Y0(),{basename:d}=K0(),{loaderData:f,matches:h}=v_(),p=b.useMemo(()=>Wv(n,t,h,o,a,"data"),[n,t,h,o,a]),y=b.useMemo(()=>Wv(n,t,h,o,a,"assets"),[n,t,h,o,a]),v=b.useMemo(()=>{if(n===a.pathname+a.search+a.hash)return[];let _=new Set,C=!1;if(t.forEach(N=>{let T=o.routes[N.route.id];!T||!T.hasLoader||(!p.some(L=>L.route.id===N.route.id)&&N.route.id in f&&u[N.route.id]?.shouldRevalidate||T.hasClientLoader?C=!0:_.add(N.route.id))}),_.size===0)return[];let S=u_(n,d,"data");return C&&_.size>0&&S.searchParams.set("_routes",t.filter(N=>_.has(N.route.id)).map(N=>N.route.id).join(",")),[S.pathname+S.search]},[d,f,a,o,p,t,n,u]),x=b.useMemo(()=>p_(y,o),[y,o]),w=w_(y);return b.createElement(b.Fragment,null,v.map(_=>b.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...i})),x.map(_=>b.createElement("link",{key:_,rel:"modulepreload",href:_,...i})),w.map(({key:_,link:C})=>b.createElement("link",{key:_,nonce:i.nonce,...C})))}function j_(...n){return t=>{n.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}var __=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{__&&(window.__reactRouterVersion="7.11.0")}catch{}function C_({basename:n,children:t,unstable_useTransitions:i,window:a}){let o=b.useRef();o.current==null&&(o.current=ij({window:a,v5Compat:!0}));let u=o.current,[d,f]=b.useState({action:u.action,location:u.location}),h=b.useCallback(p=>{i===!1?f(p):b.startTransition(()=>f(p))},[i]);return b.useLayoutEffect(()=>u.listen(h),[u,h]),b.createElement(e_,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:i})}var W0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Q0=b.forwardRef(function({onClick:t,discover:i="render",prefetch:a="none",relative:o,reloadDocument:u,replace:d,state:f,target:h,to:p,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...w},_){let{basename:C,unstable_useTransitions:S}=b.useContext(Qr),N=typeof p=="string"&&W0.test(p),T=I0(p,C);p=T.to;let L=Bj(p,{relative:o}),[R,J,H]=x_(a,w),V=T_(p,{replace:d,state:f,target:h,preventScrollReset:y,relative:o,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:S});function k(z){t&&t(z),z.defaultPrevented||V(z)}let M=b.createElement("a",{...w,...H,href:T.absoluteURL||L,onClick:T.isExternal||u?t:k,ref:j_(_,J),target:h,"data-discover":!N&&i==="render"?"true":void 0});return R&&!N?b.createElement(b.Fragment,null,M,b.createElement(b_,{page:L})):M});Q0.displayName="Link";var N_=b.forwardRef(function({"aria-current":t="page",caseSensitive:i=!1,className:a="",end:o=!1,style:u,to:d,viewTransition:f,children:h,...p},y){let v=lc(d,{relative:p.relative}),x=Ws(),w=b.useContext(hd),{navigator:_,basename:C}=b.useContext(Qr),S=w!=null&&M_(v)&&f===!0,N=_.encodeLocation?_.encodeLocation(v).pathname:v.pathname,T=x.pathname,L=w&&w.navigation&&w.navigation.location?w.navigation.location.pathname:null;i||(T=T.toLowerCase(),L=L?L.toLowerCase():null,N=N.toLowerCase()),L&&C&&(L=Gs(L,C)||L);const R=N!=="/"&&N.endsWith("/")?N.length-1:N.length;let J=T===N||!o&&T.startsWith(N)&&T.charAt(R)==="/",H=L!=null&&(L===N||!o&&L.startsWith(N)&&L.charAt(N.length)==="/"),V={isActive:J,isPending:H,isTransitioning:S},k=J?t:void 0,M;typeof a=="function"?M=a(V):M=[a,J?"active":null,H?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let z=typeof u=="function"?u(V):u;return b.createElement(Q0,{...p,"aria-current":k,className:M,ref:y,style:z,to:d,viewTransition:f},typeof h=="function"?h(V):h)});N_.displayName="NavLink";var E_=b.forwardRef(({discover:n="render",fetcherKey:t,navigate:i,reloadDocument:a,replace:o,state:u,method:d=qu,action:f,onSubmit:h,relative:p,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...w},_)=>{let{unstable_useTransitions:C}=b.useContext(Qr),S=O_(),N=D_(f,{relative:p}),T=d.toLowerCase()==="get"?"get":"post",L=typeof f=="string"&&W0.test(f),R=J=>{if(h&&h(J),J.defaultPrevented)return;J.preventDefault();let H=J.nativeEvent.submitter,V=H?.getAttribute("formmethod")||d,k=()=>S(H||J.currentTarget,{fetcherKey:t,method:V,navigate:i,replace:o,state:u,relative:p,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});C&&i!==!1?b.startTransition(()=>k()):k()};return b.createElement("form",{ref:_,method:T,action:N,onSubmit:a?h:R,...w,"data-discover":!L&&n==="render"?"true":void 0})});E_.displayName="Form";function k_(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function J0(n){let t=b.useContext(Cl);return Wn(t,k_(n)),t}function T_(n,{target:t,replace:i,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:h}={}){let p=H0(),y=Ws(),v=lc(n,{relative:u});return b.useCallback(x=>{if(i_(x,t)){x.preventDefault();let w=i!==void 0?i:Ko(y)===Ko(v),_=()=>p(n,{replace:w,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f});h?b.startTransition(()=>_()):_()}},[y,p,v,i,a,t,n,o,u,d,f,h])}function oc(n){Wr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=b.useRef(vp(n)),i=b.useRef(!1),a=Ws(),o=b.useMemo(()=>a_(a.search,i.current?null:t.current),[a.search]),u=H0(),d=b.useCallback((f,h)=>{const p=vp(typeof f=="function"?f(new URLSearchParams(o)):f);i.current=!0,u("?"+p,h)},[u,o]);return[o,d]}var A_=0,R_=()=>`__${String(++A_)}__`;function O_(){let{router:n}=J0("useSubmit"),{basename:t}=b.useContext(Qr),i=Qj(),a=n.fetch,o=n.navigate;return b.useCallback(async(u,d={})=>{let{action:f,method:h,encType:p,formData:y,body:v}=c_(u,t);if(d.navigate===!1){let x=d.fetcherKey||R_();await a(x,i,d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||h,formEncType:d.encType||p,flushSync:d.flushSync})}else await o(d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||h,formEncType:d.encType||p,replace:d.replace,state:d.state,fromRouteId:i,flushSync:d.flushSync,viewTransition:d.viewTransition})},[a,o,t,i])}function D_(n,{relative:t}={}){let{basename:i}=b.useContext(Qr),a=b.useContext(Ys);Wn(a,"useFormAction must be used inside a RouteContext");let[o]=a.matches.slice(-1),u={...lc(n||".",{relative:t})},d=Ws();if(n==null){u.search=d.search;let f=new URLSearchParams(u.search),h=f.getAll("index");if(h.some(y=>y==="")){f.delete("index"),h.filter(v=>v).forEach(v=>f.append("index",v));let y=f.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&o.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(u.pathname=u.pathname==="/"?i:Vs([i,u.pathname])),Ko(u)}function M_(n,{relative:t}={}){let i=b.useContext($0);Wn(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=J0("useViewTransitionState"),o=lc(n,{relative:t});if(!i.isTransitioning)return!1;let u=Gs(i.currentLocation.pathname,a)||i.currentLocation.pathname,d=Gs(i.nextLocation.pathname,a)||i.nextLocation.pathname;return Wu(o.pathname,d)!=null||Wu(o.pathname,u)!=null}var pa=A0();const L_=({children:n})=>(Ws(),r.jsxs("div",{className:"app-layout",children:[r.jsx("header",{className:"app-header",children:r.jsx("div",{className:"container app-header__content",children:r.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),r.jsx("main",{className:"container app-main",children:n}),r.jsx("footer",{className:"app-footer",children:r.jsx("div",{className:"container",children:r.jsx("p",{children:" 2026 recipe management"})})})]})),hn=({children:n,className:t="",hoverable:i=!1,...a})=>r.jsx("div",{className:`glass-card ${i?"glass-card--hoverable":""} ${t}`,...a,children:n}),ce=({children:n,variant:t="primary",size:i="md",isLoading:a,block:o,className:u="",...d})=>{const f=["btn",`btn--${t}`,`btn--${i}`,o?"btn--block":"",a?"btn--loading":"",u].filter(Boolean).join(" ");return r.jsxs("button",{className:f,disabled:a,...d,children:[a&&r.jsx("span",{className:"btn__spinner"}),r.jsx("span",{className:"btn__content",children:n})]})};function z_(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return b.useMemo(()=>a=>{t.forEach(o=>o(a))},t)}const md=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Nl(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function Gp(n){return"nodeType"in n}function pr(n){var t,i;return n?Nl(n)?n:Gp(n)&&(t=(i=n.ownerDocument)==null?void 0:i.defaultView)!=null?t:window:window}function Kp(n){const{Document:t}=pr(n);return n instanceof t}function cc(n){return Nl(n)?!1:n instanceof pr(n).HTMLElement}function X0(n){return n instanceof pr(n).SVGElement}function El(n){return n?Nl(n)?n.document:Gp(n)?Kp(n)?n:cc(n)||X0(n)?n.ownerDocument:document:document:document}const ds=md?b.useLayoutEffect:b.useEffect;function gd(n){const t=b.useRef(n);return ds(()=>{t.current=n}),b.useCallback(function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t.current==null?void 0:t.current(...a)},[])}function U_(){const n=b.useRef(null),t=b.useCallback((a,o)=>{n.current=setInterval(a,o)},[]),i=b.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,i]}function Yo(n,t){t===void 0&&(t=[n]);const i=b.useRef(n);return ds(()=>{i.current!==n&&(i.current=n)},t),i}function uc(n,t){const i=b.useRef();return b.useMemo(()=>{const a=n(i.current);return i.current=a,a},[...t])}function Qu(n){const t=gd(n),i=b.useRef(null),a=b.useCallback(o=>{o!==i.current&&t?.(o,i.current),i.current=o},[]);return[i,a]}function Ju(n){const t=b.useRef();return b.useEffect(()=>{t.current=n},[n]),t.current}let zf={};function dc(n,t){return b.useMemo(()=>{if(t)return t;const i=zf[n]==null?0:zf[n]+1;return zf[n]=i,n+"-"+i},[n,t])}function Z0(n){return function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return a.reduce((u,d)=>{const f=Object.entries(d);for(const[h,p]of f){const y=u[h];y!=null&&(u[h]=y+n*p)}return u},{...t})}}const vl=Z0(1),Wo=Z0(-1);function I_(n){return"clientX"in n&&"clientY"in n}function yd(n){if(!n)return!1;const{KeyboardEvent:t}=pr(n.target);return t&&n instanceof t}function B_(n){if(!n)return!1;const{TouchEvent:t}=pr(n.target);return t&&n instanceof t}function Xu(n){if(B_(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:i}=n.touches[0];return{x:t,y:i}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:i}=n.changedTouches[0];return{x:t,y:i}}}return I_(n)?{x:n.clientX,y:n.clientY}:null}const jr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:i}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(i?Math.round(i):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:i}=n;return"scaleX("+t+") scaleY("+i+")"}},Transform:{toString(n){if(n)return[jr.Translate.toString(n),jr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:i,easing:a}=n;return t+" "+i+"ms "+a}}}),Qv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function $_(n){return n.matches(Qv)?n:n.querySelector(Qv)}const P_={display:"none"};function q_(n){let{id:t,value:i}=n;return _e.createElement("div",{id:t,style:P_},i)}function F_(n){let{id:t,announcement:i,ariaLiveType:a="assertive"}=n;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return _e.createElement("div",{id:t,style:o,role:"status","aria-live":a,"aria-atomic":!0},i)}function H_(){const[n,t]=b.useState("");return{announce:b.useCallback(a=>{a!=null&&t(a)},[]),announcement:n}}const eb=b.createContext(null);function V_(n){const t=b.useContext(eb);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function G_(){const[n]=b.useState(()=>new Set),t=b.useCallback(a=>(n.add(a),()=>n.delete(a)),[n]);return[b.useCallback(a=>{let{type:o,event:u}=a;n.forEach(d=>{var f;return(f=d[o])==null?void 0:f.call(d,u)})},[n]),t]}const K_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Y_={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:i}=n;return i?"Draggable item "+t.id+" was moved over droppable area "+i.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:i}=n;return i?"Draggable item "+t.id+" was dropped over droppable area "+i.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function W_(n){let{announcements:t=Y_,container:i,hiddenTextDescribedById:a,screenReaderInstructions:o=K_}=n;const{announce:u,announcement:d}=H_(),f=dc("DndLiveRegion"),[h,p]=b.useState(!1);if(b.useEffect(()=>{p(!0)},[]),V_(b.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:w}=v;t.onDragMove&&u(t.onDragMove({active:x,over:w}))},onDragOver(v){let{active:x,over:w}=v;u(t.onDragOver({active:x,over:w}))},onDragEnd(v){let{active:x,over:w}=v;u(t.onDragEnd({active:x,over:w}))},onDragCancel(v){let{active:x,over:w}=v;u(t.onDragCancel({active:x,over:w}))}}),[u,t])),!h)return null;const y=_e.createElement(_e.Fragment,null,_e.createElement(q_,{id:a,value:o.draggable}),_e.createElement(F_,{id:f,announcement:d}));return i?pa.createPortal(y,i):y}var Kn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Kn||(Kn={}));function Zu(){}function hr(n,t){return b.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function xa(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return b.useMemo(()=>[...t].filter(a=>a!=null),[...t])}const hs=Object.freeze({x:0,y:0});function Yp(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function Q_(n,t){const i=Xu(n);if(!i)return"0 0";const a={x:(i.x-t.left)/t.width*100,y:(i.y-t.top)/t.height*100};return a.x+"% "+a.y+"%"}function Wp(n,t){let{data:{value:i}}=n,{data:{value:a}}=t;return i-a}function J_(n,t){let{data:{value:i}}=n,{data:{value:a}}=t;return a-i}function xp(n){let{left:t,top:i,height:a,width:o}=n;return[{x:t,y:i},{x:t+o,y:i},{x:t,y:i+a},{x:t+o,y:i+a}]}function tb(n,t){if(!n||n.length===0)return null;const[i]=n;return i[t]}function Jv(n,t,i){return t===void 0&&(t=n.left),i===void 0&&(i=n.top),{x:t+n.width*.5,y:i+n.height*.5}}const ed=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=Jv(t,t.left,t.top),u=[];for(const d of a){const{id:f}=d,h=i.get(f);if(h){const p=Yp(Jv(h),o);u.push({id:f,data:{droppableContainer:d,value:p}})}}return u.sort(Wp)},X_=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=xp(t),u=[];for(const d of a){const{id:f}=d,h=i.get(f);if(h){const p=xp(h),y=o.reduce((x,w,_)=>x+Yp(p[_],w),0),v=Number((y/4).toFixed(4));u.push({id:f,data:{droppableContainer:d,value:v}})}}return u.sort(Wp)};function Z_(n,t){const i=Math.max(t.top,n.top),a=Math.max(t.left,n.left),o=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=o-a,f=u-i;if(a<o&&i<u){const h=t.width*t.height,p=n.width*n.height,y=d*f,v=y/(h+p-y);return Number(v.toFixed(4))}return 0}const e1=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=[];for(const u of a){const{id:d}=u,f=i.get(d);if(f){const h=Z_(f,t);h>0&&o.push({id:d,data:{droppableContainer:u,value:h}})}}return o.sort(J_)};function t1(n,t){const{top:i,left:a,bottom:o,right:u}=t;return i<=n.y&&n.y<=o&&a<=n.x&&n.x<=u}const nb=n=>{let{droppableContainers:t,droppableRects:i,pointerCoordinates:a}=n;if(!a)return[];const o=[];for(const u of t){const{id:d}=u,f=i.get(d);if(f&&t1(a,f)){const p=xp(f).reduce((v,x)=>v+Yp(a,x),0),y=Number((p/4).toFixed(4));o.push({id:d,data:{droppableContainer:u,value:y}})}}return o.sort(Wp)};function n1(n,t,i){return{...n,scaleX:t&&i?t.width/i.width:1,scaleY:t&&i?t.height/i.height:1}}function rb(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:hs}function r1(n){return function(i){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];return o.reduce((d,f)=>({...d,top:d.top+n*f.y,bottom:d.bottom+n*f.y,left:d.left+n*f.x,right:d.right+n*f.x}),{...i})}}const s1=r1(1);function sb(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function i1(n,t,i){const a=sb(t);if(!a)return n;const{scaleX:o,scaleY:u,x:d,y:f}=a,h=n.left-d-(1-o)*parseFloat(i),p=n.top-f-(1-u)*parseFloat(i.slice(i.indexOf(" ")+1)),y=o?n.width/o:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:p,right:h+y,bottom:p+v,left:h}}const a1={ignoreTransform:!1};function kl(n,t){t===void 0&&(t=a1);let i=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:p,transformOrigin:y}=pr(n).getComputedStyle(n);p&&(i=i1(i,p,y))}const{top:a,left:o,width:u,height:d,bottom:f,right:h}=i;return{top:a,left:o,width:u,height:d,bottom:f,right:h}}function Xv(n){return kl(n,{ignoreTransform:!0})}function l1(n){const t=n.innerWidth,i=n.innerHeight;return{top:0,left:0,right:t,bottom:i,width:t,height:i}}function o1(n,t){return t===void 0&&(t=pr(n).getComputedStyle(n)),t.position==="fixed"}function c1(n,t){t===void 0&&(t=pr(n).getComputedStyle(n));const i=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const u=t[o];return typeof u=="string"?i.test(u):!1})}function vd(n,t){const i=[];function a(o){if(t!=null&&i.length>=t||!o)return i;if(Kp(o)&&o.scrollingElement!=null&&!i.includes(o.scrollingElement))return i.push(o.scrollingElement),i;if(!cc(o)||X0(o)||i.includes(o))return i;const u=pr(n).getComputedStyle(o);return o!==n&&c1(o,u)&&i.push(o),o1(o,u)?i:a(o.parentNode)}return n?a(n):i}function ib(n){const[t]=vd(n,1);return t??null}function Uf(n){return!md||!n?null:Nl(n)?n:Gp(n)?Kp(n)||n===El(n).scrollingElement?window:cc(n)?n:null:null}function ab(n){return Nl(n)?n.scrollX:n.scrollLeft}function lb(n){return Nl(n)?n.scrollY:n.scrollTop}function bp(n){return{x:ab(n),y:lb(n)}}var er;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(er||(er={}));function ob(n){return!md||!n?!1:n===document.scrollingElement}function cb(n){const t={x:0,y:0},i=ob(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},a={x:n.scrollWidth-i.width,y:n.scrollHeight-i.height},o=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=a.y,f=n.scrollLeft>=a.x;return{isTop:o,isLeft:u,isBottom:d,isRight:f,maxScroll:a,minScroll:t}}const u1={x:.2,y:.2};function d1(n,t,i,a,o){let{top:u,left:d,right:f,bottom:h}=i;a===void 0&&(a=10),o===void 0&&(o=u1);const{isTop:p,isBottom:y,isLeft:v,isRight:x}=cb(n),w={x:0,y:0},_={x:0,y:0},C={height:t.height*o.y,width:t.width*o.x};return!p&&u<=t.top+C.height?(w.y=er.Backward,_.y=a*Math.abs((t.top+C.height-u)/C.height)):!y&&h>=t.bottom-C.height&&(w.y=er.Forward,_.y=a*Math.abs((t.bottom-C.height-h)/C.height)),!x&&f>=t.right-C.width?(w.x=er.Forward,_.x=a*Math.abs((t.right-C.width-f)/C.width)):!v&&d<=t.left+C.width&&(w.x=er.Backward,_.x=a*Math.abs((t.left+C.width-d)/C.width)),{direction:w,speed:_}}function h1(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:i,right:a,bottom:o}=n.getBoundingClientRect();return{top:t,left:i,right:a,bottom:o,width:n.clientWidth,height:n.clientHeight}}function ub(n){return n.reduce((t,i)=>vl(t,bp(i)),hs)}function f1(n){return n.reduce((t,i)=>t+ab(i),0)}function p1(n){return n.reduce((t,i)=>t+lb(i),0)}function db(n,t){if(t===void 0&&(t=kl),!n)return;const{top:i,left:a,bottom:o,right:u}=t(n);ib(n)&&(o<=0||u<=0||i>=window.innerHeight||a>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const m1=[["x",["left","right"],f1],["y",["top","bottom"],p1]];class Qp{constructor(t,i){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=vd(i),o=ub(a);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,f]of m1)for(const h of d)Object.defineProperty(this,h,{get:()=>{const p=f(a),y=o[u]-p;return this.rect[h]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Po{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(i=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...i)})},this.target=t}add(t,i,a){var o;(o=this.target)==null||o.addEventListener(t,i,a),this.listeners.push([t,i,a])}}function g1(n){const{EventTarget:t}=pr(n);return n instanceof t?n:El(n)}function If(n,t){const i=Math.abs(n.x),a=Math.abs(n.y);return typeof t=="number"?Math.sqrt(i**2+a**2)>t:"x"in t&&"y"in t?i>t.x&&a>t.y:"x"in t?i>t.x:"y"in t?a>t.y:!1}var Yr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Yr||(Yr={}));function Zv(n){n.preventDefault()}function y1(n){n.stopPropagation()}var en;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(en||(en={}));const hb={start:[en.Space,en.Enter],cancel:[en.Esc],end:[en.Space,en.Enter,en.Tab]},v1=(n,t)=>{let{currentCoordinates:i}=t;switch(n.code){case en.Right:return{...i,x:i.x+25};case en.Left:return{...i,x:i.x-25};case en.Down:return{...i,y:i.y+25};case en.Up:return{...i,y:i.y-25}}};class Tl{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:i}}=t;this.props=t,this.listeners=new Po(El(i)),this.windowListeners=new Po(pr(i)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Yr.Resize,this.handleCancel),this.windowListeners.add(Yr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Yr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:i}=this.props,a=t.node.current;a&&db(a),i(hs)}handleKeyDown(t){if(yd(t)){const{active:i,context:a,options:o}=this.props,{keyboardCodes:u=hb,coordinateGetter:d=v1,scrollBehavior:f="smooth"}=o,{code:h}=t;if(u.end.includes(h)){this.handleEnd(t);return}if(u.cancel.includes(h)){this.handleCancel(t);return}const{collisionRect:p}=a.current,y=p?{x:p.left,y:p.top}:hs;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:i,context:a.current,currentCoordinates:y});if(v){const x=Wo(v,y),w={x:0,y:0},{scrollableAncestors:_}=a.current;for(const C of _){const S=t.code,{isTop:N,isRight:T,isLeft:L,isBottom:R,maxScroll:J,minScroll:H}=cb(C),V=h1(C),k={x:Math.min(S===en.Right?V.right-V.width/2:V.right,Math.max(S===en.Right?V.left:V.left+V.width/2,v.x)),y:Math.min(S===en.Down?V.bottom-V.height/2:V.bottom,Math.max(S===en.Down?V.top:V.top+V.height/2,v.y))},M=S===en.Right&&!T||S===en.Left&&!L,z=S===en.Down&&!R||S===en.Up&&!N;if(M&&k.x!==v.x){const U=C.scrollLeft+x.x,F=S===en.Right&&U<=J.x||S===en.Left&&U>=H.x;if(F&&!x.y){C.scrollTo({left:U,behavior:f});return}F?w.x=C.scrollLeft-U:w.x=S===en.Right?C.scrollLeft-J.x:C.scrollLeft-H.x,w.x&&C.scrollBy({left:-w.x,behavior:f});break}else if(z&&k.y!==v.y){const U=C.scrollTop+x.y,F=S===en.Down&&U<=J.y||S===en.Up&&U>=H.y;if(F&&!x.x){C.scrollTo({top:U,behavior:f});return}F?w.y=C.scrollTop-U:w.y=S===en.Down?C.scrollTop-J.y:C.scrollTop-H.y,w.y&&C.scrollBy({top:-w.y,behavior:f});break}}this.handleMove(t,vl(Wo(v,this.referenceCoordinates),w))}}}handleMove(t,i){const{onMove:a}=this.props;t.preventDefault(),a(i)}handleEnd(t){const{onEnd:i}=this.props;t.preventDefault(),this.detach(),i()}handleCancel(t){const{onCancel:i}=this.props;t.preventDefault(),this.detach(),i()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Tl.activators=[{eventName:"onKeyDown",handler:(n,t,i)=>{let{keyboardCodes:a=hb,onActivation:o}=t,{active:u}=i;const{code:d}=n.nativeEvent;if(a.start.includes(d)){const f=u.activatorNode.current;return f&&n.target!==f?!1:(n.preventDefault(),o?.({event:n.nativeEvent}),!0)}return!1}}];function ex(n){return!!(n&&"distance"in n)}function tx(n){return!!(n&&"delay"in n)}class Jp{constructor(t,i,a){var o;a===void 0&&(a=g1(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=i;const{event:u}=t,{target:d}=u;this.props=t,this.events=i,this.document=El(d),this.documentListeners=new Po(this.document),this.listeners=new Po(a),this.windowListeners=new Po(pr(d)),this.initialCoordinates=(o=Xu(u))!=null?o:hs,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:i,bypassActivationConstraint:a}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Yr.Resize,this.handleCancel),this.windowListeners.add(Yr.DragStart,Zv),this.windowListeners.add(Yr.VisibilityChange,this.handleCancel),this.windowListeners.add(Yr.ContextMenu,Zv),this.documentListeners.add(Yr.Keydown,this.handleKeydown),i){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(tx(i)){this.timeoutId=setTimeout(this.handleStart,i.delay),this.handlePending(i);return}if(ex(i)){this.handlePending(i);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,i){const{active:a,onPending:o}=this.props;o(a,t,this.initialCoordinates,i)}handleStart(){const{initialCoordinates:t}=this,{onStart:i}=this.props;t&&(this.activated=!0,this.documentListeners.add(Yr.Click,y1,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Yr.SelectionChange,this.removeTextSelection),i(t))}handleMove(t){var i;const{activated:a,initialCoordinates:o,props:u}=this,{onMove:d,options:{activationConstraint:f}}=u;if(!o)return;const h=(i=Xu(t))!=null?i:hs,p=Wo(o,h);if(!a&&f){if(ex(f)){if(f.tolerance!=null&&If(p,f.tolerance))return this.handleCancel();if(If(p,f.distance))return this.handleStart()}if(tx(f)&&If(p,f.tolerance))return this.handleCancel();this.handlePending(f,p);return}t.cancelable&&t.preventDefault(),d(h)}handleEnd(){const{onAbort:t,onEnd:i}=this.props;this.detach(),this.activated||t(this.props.active),i()}handleCancel(){const{onAbort:t,onCancel:i}=this.props;this.detach(),this.activated||t(this.props.active),i()}handleKeydown(t){t.code===en.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const x1={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class xd extends Jp{constructor(t){const{event:i}=t,a=El(i.target);super(t,x1,a)}}xd.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;return!i.isPrimary||i.button!==0?!1:(a?.({event:i}),!0)}}];const b1={move:{name:"mousemove"},end:{name:"mouseup"}};var wp;(function(n){n[n.RightClick=2]="RightClick"})(wp||(wp={}));class Al extends Jp{constructor(t){super(t,b1,El(t.event.target))}}Al.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;return i.button===wp.RightClick?!1:(a?.({event:i}),!0)}}];const Bf={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Rl extends Jp{constructor(t){super(t,Bf)}static setup(){return window.addEventListener(Bf.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Bf.move.name,t)};function t(){}}}Rl.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;const{touches:o}=i;return o.length>1?!1:(a?.({event:i}),!0)}}];var qo;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(qo||(qo={}));var td;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(td||(td={}));function w1(n){let{acceleration:t,activator:i=qo.Pointer,canScroll:a,draggingRect:o,enabled:u,interval:d=5,order:f=td.TreeOrder,pointerCoordinates:h,scrollableAncestors:p,scrollableAncestorRects:y,delta:v,threshold:x}=n;const w=j1({delta:v,disabled:!u}),[_,C]=U_(),S=b.useRef({x:0,y:0}),N=b.useRef({x:0,y:0}),T=b.useMemo(()=>{switch(i){case qo.Pointer:return h?{top:h.y,bottom:h.y,left:h.x,right:h.x}:null;case qo.DraggableRect:return o}},[i,o,h]),L=b.useRef(null),R=b.useCallback(()=>{const H=L.current;if(!H)return;const V=S.current.x*N.current.x,k=S.current.y*N.current.y;H.scrollBy(V,k)},[]),J=b.useMemo(()=>f===td.TreeOrder?[...p].reverse():p,[f,p]);b.useEffect(()=>{if(!u||!p.length||!T){C();return}for(const H of J){if(a?.(H)===!1)continue;const V=p.indexOf(H),k=y[V];if(!k)continue;const{direction:M,speed:z}=d1(H,k,T,t,x);for(const U of["x","y"])w[U][M[U]]||(z[U]=0,M[U]=0);if(z.x>0||z.y>0){C(),L.current=H,_(R,d),S.current=z,N.current=M;return}}S.current={x:0,y:0},N.current={x:0,y:0},C()},[t,R,a,C,u,d,JSON.stringify(T),JSON.stringify(w),_,p,J,y,JSON.stringify(x)])}const S1={x:{[er.Backward]:!1,[er.Forward]:!1},y:{[er.Backward]:!1,[er.Forward]:!1}};function j1(n){let{delta:t,disabled:i}=n;const a=Ju(t);return uc(o=>{if(i||!a||!o)return S1;const u={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[er.Backward]:o.x[er.Backward]||u.x===-1,[er.Forward]:o.x[er.Forward]||u.x===1},y:{[er.Backward]:o.y[er.Backward]||u.y===-1,[er.Forward]:o.y[er.Forward]||u.y===1}}},[i,t,a])}function _1(n,t){const i=t!=null?n.get(t):void 0,a=i?i.node.current:null;return uc(o=>{var u;return t==null?null:(u=a??o)!=null?u:null},[a,t])}function C1(n,t){return b.useMemo(()=>n.reduce((i,a)=>{const{sensor:o}=a,u=o.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,a)}));return[...i,...u]},[]),[n,t])}var Qo;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Qo||(Qo={}));var Sp;(function(n){n.Optimized="optimized"})(Sp||(Sp={}));const nx=new Map;function N1(n,t){let{dragging:i,dependencies:a,config:o}=t;const[u,d]=b.useState(null),{frequency:f,measure:h,strategy:p}=o,y=b.useRef(n),v=S(),x=Yo(v),w=b.useCallback(function(N){N===void 0&&(N=[]),!x.current&&d(T=>T===null?N:T.concat(N.filter(L=>!T.includes(L))))},[x]),_=b.useRef(null),C=uc(N=>{if(v&&!i)return nx;if(!N||N===nx||y.current!==n||u!=null){const T=new Map;for(let L of n){if(!L)continue;if(u&&u.length>0&&!u.includes(L.id)&&L.rect.current){T.set(L.id,L.rect.current);continue}const R=L.node.current,J=R?new Qp(h(R),R):null;L.rect.current=J,J&&T.set(L.id,J)}return T}return N},[n,u,i,v,h]);return b.useEffect(()=>{y.current=n},[n]),b.useEffect(()=>{v||w()},[i,v]),b.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),b.useEffect(()=>{v||typeof f!="number"||_.current!==null||(_.current=setTimeout(()=>{w(),_.current=null},f))},[f,v,w,...a]),{droppableRects:C,measureDroppableContainers:w,measuringScheduled:u!=null};function S(){switch(p){case Qo.Always:return!1;case Qo.BeforeDragging:return i;default:return!i}}}function Xp(n,t){return uc(i=>n?i||(typeof t=="function"?t(n):n):null,[t,n])}function E1(n,t){return Xp(n,t)}function k1(n){let{callback:t,disabled:i}=n;const a=gd(t),o=b.useMemo(()=>{if(i||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(a)},[a,i]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function bd(n){let{callback:t,disabled:i}=n;const a=gd(t),o=b.useMemo(()=>{if(i||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(a)},[i]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function T1(n){return new Qp(kl(n),n)}function rx(n,t,i){t===void 0&&(t=T1);const[a,o]=b.useState(null);function u(){o(h=>{if(!n)return null;if(n.isConnected===!1){var p;return(p=h??i)!=null?p:null}const y=t(n);return JSON.stringify(h)===JSON.stringify(y)?h:y})}const d=k1({callback(h){if(n)for(const p of h){const{type:y,target:v}=p;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),f=bd({callback:u});return ds(()=>{u(),n?(f?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(f?.disconnect(),d?.disconnect())},[n]),a}function A1(n){const t=Xp(n);return rb(n,t)}const sx=[];function R1(n){const t=b.useRef(n),i=uc(a=>n?a&&a!==sx&&n&&t.current&&n.parentNode===t.current.parentNode?a:vd(n):sx,[n]);return b.useEffect(()=>{t.current=n},[n]),i}function O1(n){const[t,i]=b.useState(null),a=b.useRef(n),o=b.useCallback(u=>{const d=Uf(u.target);d&&i(f=>f?(f.set(d,bp(d)),new Map(f)):null)},[]);return b.useEffect(()=>{const u=a.current;if(n!==u){d(u);const f=n.map(h=>{const p=Uf(h);return p?(p.addEventListener("scroll",o,{passive:!0}),[p,bp(p)]):null}).filter(h=>h!=null);i(f.length?new Map(f):null),a.current=n}return()=>{d(n),d(u)};function d(f){f.forEach(h=>{const p=Uf(h);p?.removeEventListener("scroll",o)})}},[o,n]),b.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>vl(u,d),hs):ub(n):hs,[n,t])}function ix(n,t){t===void 0&&(t=[]);const i=b.useRef(null);return b.useEffect(()=>{i.current=null},t),b.useEffect(()=>{const a=n!==hs;a&&!i.current&&(i.current=n),!a&&i.current&&(i.current=null)},[n]),i.current?Wo(n,i.current):hs}function D1(n){b.useEffect(()=>{if(!md)return;const t=n.map(i=>{let{sensor:a}=i;return a.setup==null?void 0:a.setup()});return()=>{for(const i of t)i?.()}},n.map(t=>{let{sensor:i}=t;return i}))}function M1(n,t){return b.useMemo(()=>n.reduce((i,a)=>{let{eventName:o,handler:u}=a;return i[o]=d=>{u(d,t)},i},{}),[n,t])}function fb(n){return b.useMemo(()=>n?l1(n):null,[n])}const ax=[];function L1(n,t){t===void 0&&(t=kl);const[i]=n,a=fb(i?pr(i):null),[o,u]=b.useState(ax);function d(){u(()=>n.length?n.map(h=>ob(h)?a:new Qp(t(h),h)):ax)}const f=bd({callback:d});return ds(()=>{f?.disconnect(),d(),n.forEach(h=>f?.observe(h))},[n]),o}function pb(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return cc(t)?t:n}function z1(n){let{measure:t}=n;const[i,a]=b.useState(null),o=b.useCallback(p=>{for(const{target:y}of p)if(cc(y)){a(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=bd({callback:o}),d=b.useCallback(p=>{const y=pb(p);u?.disconnect(),y&&u?.observe(y),a(y?t(y):null)},[t,u]),[f,h]=Qu(d);return b.useMemo(()=>({nodeRef:f,rect:i,setRef:h}),[i,f,h])}const U1=[{sensor:xd,options:{}},{sensor:Tl,options:{}}],I1={current:{}},Hu={draggable:{measure:Xv},droppable:{measure:Xv,strategy:Qo.WhileDragging,frequency:Sp.Optimized},dragOverlay:{measure:kl}};class Fo extends Map{get(t){var i;return t!=null&&(i=super.get(t))!=null?i:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:i}=t;return!i})}getNodeFor(t){var i,a;return(i=(a=this.get(t))==null?void 0:a.node.current)!=null?i:void 0}}const B1={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Fo,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Zu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Hu,measureDroppableContainers:Zu,windowRect:null,measuringScheduled:!1},mb={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Zu,draggableNodes:new Map,over:null,measureDroppableContainers:Zu},hc=b.createContext(mb),gb=b.createContext(B1);function $1(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Fo}}}function P1(n,t){switch(t.type){case Kn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Kn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case Kn.DragEnd:case Kn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Kn.RegisterDroppable:{const{element:i}=t,{id:a}=i,o=new Fo(n.droppable.containers);return o.set(a,i),{...n,droppable:{...n.droppable,containers:o}}}case Kn.SetDroppableDisabled:{const{id:i,key:a,disabled:o}=t,u=n.droppable.containers.get(i);if(!u||a!==u.key)return n;const d=new Fo(n.droppable.containers);return d.set(i,{...u,disabled:o}),{...n,droppable:{...n.droppable,containers:d}}}case Kn.UnregisterDroppable:{const{id:i,key:a}=t,o=n.droppable.containers.get(i);if(!o||a!==o.key)return n;const u=new Fo(n.droppable.containers);return u.delete(i),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function q1(n){let{disabled:t}=n;const{active:i,activatorEvent:a,draggableNodes:o}=b.useContext(hc),u=Ju(a),d=Ju(i?.id);return b.useEffect(()=>{if(!t&&!a&&u&&d!=null){if(!yd(u)||document.activeElement===u.target)return;const f=o.get(d);if(!f)return;const{activatorNode:h,node:p}=f;if(!h.current&&!p.current)return;requestAnimationFrame(()=>{for(const y of[h.current,p.current]){if(!y)continue;const v=$_(y);if(v){v.focus();break}}})}},[a,t,o,d,u]),null}function yb(n,t){let{transform:i,...a}=t;return n!=null&&n.length?n.reduce((o,u)=>u({transform:o,...a}),i):i}function F1(n){return b.useMemo(()=>({draggable:{...Hu.draggable,...n?.draggable},droppable:{...Hu.droppable,...n?.droppable},dragOverlay:{...Hu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function H1(n){let{activeNode:t,measure:i,initialRect:a,config:o=!0}=n;const u=b.useRef(!1),{x:d,y:f}=typeof o=="boolean"?{x:o,y:o}:o;ds(()=>{if(!d&&!f||!t){u.current=!1;return}if(u.current||!a)return;const p=t?.node.current;if(!p||p.isConnected===!1)return;const y=i(p),v=rb(y,a);if(d||(v.x=0),f||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=ib(p);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,f,a,i])}const wd=b.createContext({...hs,scaleX:1,scaleY:1});var ki;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(ki||(ki={}));const Mi=b.memo(function(t){var i,a,o,u;let{id:d,accessibility:f,autoScroll:h=!0,children:p,sensors:y=U1,collisionDetection:v=e1,measuring:x,modifiers:w,..._}=t;const C=b.useReducer(P1,void 0,$1),[S,N]=C,[T,L]=G_(),[R,J]=b.useState(ki.Uninitialized),H=R===ki.Initialized,{draggable:{active:V,nodes:k,translate:M},droppable:{containers:z}}=S,U=V!=null?k.get(V):null,F=b.useRef({initial:null,translated:null}),Y=b.useMemo(()=>{var Ie;return V!=null?{id:V,data:(Ie=U?.data)!=null?Ie:I1,rect:F}:null},[V,U]),$=b.useRef(null),[P,E]=b.useState(null),[B,q]=b.useState(null),Q=Yo(_,Object.values(_)),G=dc("DndDescribedBy",d),A=b.useMemo(()=>z.getEnabled(),[z]),O=F1(x),{droppableRects:K,measureDroppableContainers:de,measuringScheduled:pe}=N1(A,{dragging:H,dependencies:[M.x,M.y],config:O.droppable}),ve=_1(k,V),te=b.useMemo(()=>B?Xu(B):null,[B]),W=Te(),me=E1(ve,O.draggable.measure);H1({activeNode:V!=null?k.get(V):null,config:W.layoutShiftCompensation,initialRect:me,measure:O.draggable.measure});const ke=rx(ve,O.draggable.measure,me),ie=rx(ve?ve.parentElement:null),je=b.useRef({activatorEvent:null,active:null,activeNode:ve,collisionRect:null,collisions:null,droppableRects:K,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:z,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Re=z.getNodeFor((i=je.current.over)==null?void 0:i.id),Oe=z1({measure:O.dragOverlay.measure}),qe=(a=Oe.nodeRef.current)!=null?a:ve,et=H?(o=Oe.rect)!=null?o:ke:null,at=!!(Oe.nodeRef.current&&Oe.rect),lt=A1(at?null:ke),pt=fb(qe?pr(qe):null),we=R1(H?Re??ve:null),ae=L1(we),Ge=yb(w,{transform:{x:M.x-lt.x,y:M.y-lt.y,scaleX:1,scaleY:1},activatorEvent:B,active:Y,activeNodeRect:ke,containerNodeRect:ie,draggingNodeRect:et,over:je.current.over,overlayNodeRect:Oe.rect,scrollableAncestors:we,scrollableAncestorRects:ae,windowRect:pt}),Ne=te?vl(te,M):null,dt=O1(we),rt=ix(dt),Ve=ix(dt,[ke]),ot=vl(Ge,rt),tt=et?s1(et,Ge):null,St=Y&&tt?v({active:Y,collisionRect:tt,droppableRects:K,droppableContainers:A,pointerCoordinates:Ne}):null,gn=tb(St,"id"),[Ct,zt]=b.useState(null),Ft=at?Ge:vl(Ge,Ve),rn=n1(Ft,(u=Ct?.rect)!=null?u:null,ke),ln=b.useRef(null),sn=b.useCallback((Ie,Fe)=>{let{sensor:it,options:wt}=Fe;if($.current==null)return;const Pt=k.get($.current);if(!Pt)return;const Vt=Ie.nativeEvent,on=new it({active:$.current,activeNode:Pt,event:Vt,options:wt,context:je,onAbort(Ke){if(!k.get(Ke))return;const{onDragAbort:ct}=Q.current,Lt={id:Ke};ct?.(Lt),T({type:"onDragAbort",event:Lt})},onPending(Ke,mt,ct,Lt){if(!k.get(Ke))return;const{onDragPending:Mt}=Q.current,tn={id:Ke,constraint:mt,initialCoordinates:ct,offset:Lt};Mt?.(tn),T({type:"onDragPending",event:tn})},onStart(Ke){const mt=$.current;if(mt==null)return;const ct=k.get(mt);if(!ct)return;const{onDragStart:Lt}=Q.current,ut={activatorEvent:Vt,active:{id:mt,data:ct.data,rect:F}};pa.unstable_batchedUpdates(()=>{Lt?.(ut),J(ki.Initializing),N({type:Kn.DragStart,initialCoordinates:Ke,active:mt}),T({type:"onDragStart",event:ut}),E(ln.current),q(Vt)})},onMove(Ke){N({type:Kn.DragMove,coordinates:Ke})},onEnd:he(Kn.DragEnd),onCancel:he(Kn.DragCancel)});ln.current=on;function he(Ke){return async function(){const{active:ct,collisions:Lt,over:ut,scrollAdjustedTranslate:Mt}=je.current;let tn=null;if(ct&&Mt){const{cancelDrop:ht}=Q.current;tn={activatorEvent:Vt,active:ct,collisions:Lt,delta:Mt,over:ut},Ke===Kn.DragEnd&&typeof ht=="function"&&await Promise.resolve(ht(tn))&&(Ke=Kn.DragCancel)}$.current=null,pa.unstable_batchedUpdates(()=>{N({type:Ke}),J(ki.Uninitialized),zt(null),E(null),q(null),ln.current=null;const ht=Ke===Kn.DragEnd?"onDragEnd":"onDragCancel";if(tn){const le=Q.current[ht];le?.(tn),T({type:ht,event:tn})}})}}},[k]),zn=b.useCallback((Ie,Fe)=>(it,wt)=>{const Pt=it.nativeEvent,Vt=k.get(wt);if($.current!==null||!Vt||Pt.dndKit||Pt.defaultPrevented)return;const on={active:Vt};Ie(it,Fe.options,on)===!0&&(Pt.dndKit={capturedBy:Fe.sensor},$.current=wt,sn(it,Fe))},[k,sn]),Xt=C1(y,zn);D1(y),ds(()=>{ke&&R===ki.Initializing&&J(ki.Initialized)},[ke,R]),b.useEffect(()=>{const{onDragMove:Ie}=Q.current,{active:Fe,activatorEvent:it,collisions:wt,over:Pt}=je.current;if(!Fe||!it)return;const Vt={active:Fe,activatorEvent:it,collisions:wt,delta:{x:ot.x,y:ot.y},over:Pt};pa.unstable_batchedUpdates(()=>{Ie?.(Vt),T({type:"onDragMove",event:Vt})})},[ot.x,ot.y]),b.useEffect(()=>{const{active:Ie,activatorEvent:Fe,collisions:it,droppableContainers:wt,scrollAdjustedTranslate:Pt}=je.current;if(!Ie||$.current==null||!Fe||!Pt)return;const{onDragOver:Vt}=Q.current,on=wt.get(gn),he=on&&on.rect.current?{id:on.id,rect:on.rect.current,data:on.data,disabled:on.disabled}:null,Ke={active:Ie,activatorEvent:Fe,collisions:it,delta:{x:Pt.x,y:Pt.y},over:he};pa.unstable_batchedUpdates(()=>{zt(he),Vt?.(Ke),T({type:"onDragOver",event:Ke})})},[gn]),ds(()=>{je.current={activatorEvent:B,active:Y,activeNode:ve,collisionRect:tt,collisions:St,droppableRects:K,draggableNodes:k,draggingNode:qe,draggingNodeRect:et,droppableContainers:z,over:Ct,scrollableAncestors:we,scrollAdjustedTranslate:ot},F.current={initial:et,translated:tt}},[Y,ve,St,tt,k,qe,et,K,z,Ct,we,ot]),w1({...W,delta:M,draggingRect:tt,pointerCoordinates:Ne,scrollableAncestors:we,scrollableAncestorRects:ae});const ee=b.useMemo(()=>({active:Y,activeNode:ve,activeNodeRect:ke,activatorEvent:B,collisions:St,containerNodeRect:ie,dragOverlay:Oe,draggableNodes:k,droppableContainers:z,droppableRects:K,over:Ct,measureDroppableContainers:de,scrollableAncestors:we,scrollableAncestorRects:ae,measuringConfiguration:O,measuringScheduled:pe,windowRect:pt}),[Y,ve,ke,B,St,ie,Oe,k,z,K,Ct,de,we,ae,O,pe,pt]),De=b.useMemo(()=>({activatorEvent:B,activators:Xt,active:Y,activeNodeRect:ke,ariaDescribedById:{draggable:G},dispatch:N,draggableNodes:k,over:Ct,measureDroppableContainers:de}),[B,Xt,Y,ke,N,G,k,Ct,de]);return _e.createElement(eb.Provider,{value:L},_e.createElement(hc.Provider,{value:De},_e.createElement(gb.Provider,{value:ee},_e.createElement(wd.Provider,{value:rn},p)),_e.createElement(q1,{disabled:f?.restoreFocus===!1})),_e.createElement(W_,{...f,hiddenTextDescribedById:G}));function Te(){const Ie=P?.autoScrollEnabled===!1,Fe=typeof h=="object"?h.enabled===!1:h===!1,it=H&&!Ie&&!Fe;return typeof h=="object"?{...h,enabled:it}:{enabled:it}}}),V1=b.createContext(null),lx="button",G1="Draggable";function Zp(n){let{id:t,data:i,disabled:a=!1,attributes:o}=n;const u=dc(G1),{activators:d,activatorEvent:f,active:h,activeNodeRect:p,ariaDescribedById:y,draggableNodes:v,over:x}=b.useContext(hc),{role:w=lx,roleDescription:_="draggable",tabIndex:C=0}=o??{},S=h?.id===t,N=b.useContext(S?wd:V1),[T,L]=Qu(),[R,J]=Qu(),H=M1(d,t),V=Yo(i);ds(()=>(v.set(t,{id:t,key:u,node:T,activatorNode:R,data:V}),()=>{const M=v.get(t);M&&M.key===u&&v.delete(t)}),[v,t]);const k=b.useMemo(()=>({role:w,tabIndex:C,"aria-disabled":a,"aria-pressed":S&&w===lx?!0:void 0,"aria-roledescription":_,"aria-describedby":y.draggable}),[a,w,C,S,_,y.draggable]);return{active:h,activatorEvent:f,activeNodeRect:p,attributes:k,isDragging:S,listeners:a?void 0:H,node:T,over:x,setNodeRef:L,setActivatorNodeRef:J,transform:N}}function vb(){return b.useContext(gb)}const K1="Droppable",Y1={timeout:25};function fc(n){let{data:t,disabled:i=!1,id:a,resizeObserverConfig:o}=n;const u=dc(K1),{active:d,dispatch:f,over:h,measureDroppableContainers:p}=b.useContext(hc),y=b.useRef({disabled:i}),v=b.useRef(!1),x=b.useRef(null),w=b.useRef(null),{disabled:_,updateMeasurementsFor:C,timeout:S}={...Y1,...o},N=Yo(C??a),T=b.useCallback(()=>{if(!v.current){v.current=!0;return}w.current!=null&&clearTimeout(w.current),w.current=setTimeout(()=>{p(Array.isArray(N.current)?N.current:[N.current]),w.current=null},S)},[S]),L=bd({callback:T,disabled:_||!d}),R=b.useCallback((k,M)=>{L&&(M&&(L.unobserve(M),v.current=!1),k&&L.observe(k))},[L]),[J,H]=Qu(R),V=Yo(t);return b.useEffect(()=>{!L||!J.current||(L.disconnect(),v.current=!1,L.observe(J.current))},[J,L]),b.useEffect(()=>(f({type:Kn.RegisterDroppable,element:{id:a,key:u,disabled:i,node:J,rect:x,data:V}}),()=>f({type:Kn.UnregisterDroppable,key:u,id:a})),[a]),b.useEffect(()=>{i!==y.current.disabled&&(f({type:Kn.SetDroppableDisabled,id:a,key:u,disabled:i}),y.current.disabled=i)},[a,u,i,f]),{active:d,rect:x,isOver:h?.id===a,node:J,over:h,setNodeRef:H}}function W1(n){let{animation:t,children:i}=n;const[a,o]=b.useState(null),[u,d]=b.useState(null),f=Ju(i);return!i&&!a&&f&&o(f),ds(()=>{if(!u)return;const h=a?.key,p=a?.props.id;if(h==null||p==null){o(null);return}Promise.resolve(t(p,u)).then(()=>{o(null)})},[t,a,u]),_e.createElement(_e.Fragment,null,i,a?b.cloneElement(a,{ref:d}):null)}const Q1={x:0,y:0,scaleX:1,scaleY:1};function J1(n){let{children:t}=n;return _e.createElement(hc.Provider,{value:mb},_e.createElement(wd.Provider,{value:Q1},t))}const X1={position:"fixed",touchAction:"none"},Z1=n=>yd(n)?"transform 250ms ease":void 0,eC=b.forwardRef((n,t)=>{let{as:i,activatorEvent:a,adjustScale:o,children:u,className:d,rect:f,style:h,transform:p,transition:y=Z1}=n;if(!f)return null;const v=o?p:{...p,scaleX:1,scaleY:1},x={...X1,width:f.width,height:f.height,top:f.top,left:f.left,transform:jr.Transform.toString(v),transformOrigin:o&&a?Q_(a,f):void 0,transition:typeof y=="function"?y(a):y,...h};return _e.createElement(i,{className:d,style:x,ref:t},u)}),em=n=>t=>{let{active:i,dragOverlay:a}=t;const o={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[f,h]of Object.entries(u.active))h!==void 0&&(o[f]=i.node.style.getPropertyValue(f),i.node.style.setProperty(f,h));if(u!=null&&u.dragOverlay)for(const[f,h]of Object.entries(u.dragOverlay))h!==void 0&&a.node.style.setProperty(f,h);return d!=null&&d.active&&i.node.classList.add(d.active),d!=null&&d.dragOverlay&&a.node.classList.add(d.dragOverlay),function(){for(const[h,p]of Object.entries(o))i.node.style.setProperty(h,p);d!=null&&d.active&&i.node.classList.remove(d.active)}},tC=n=>{let{transform:{initial:t,final:i}}=n;return[{transform:jr.Transform.toString(t)},{transform:jr.Transform.toString(i)}]},nC={duration:250,easing:"ease",keyframes:tC,sideEffects:em({styles:{active:{opacity:"0"}}})};function rC(n){let{config:t,draggableNodes:i,droppableContainers:a,measuringConfiguration:o}=n;return gd((u,d)=>{if(t===null)return;const f=i.get(u);if(!f)return;const h=f.node.current;if(!h)return;const p=pb(d);if(!p)return;const{transform:y}=pr(d).getComputedStyle(d),v=sb(y);if(!v)return;const x=typeof t=="function"?t:sC(t);return db(h,o.draggable.measure),x({active:{id:u,data:f.data,node:h,rect:o.draggable.measure(h)},draggableNodes:i,dragOverlay:{node:d,rect:o.dragOverlay.measure(p)},droppableContainers:a,measuringConfiguration:o,transform:v})})}function sC(n){const{duration:t,easing:i,sideEffects:a,keyframes:o}={...nC,...n};return u=>{let{active:d,dragOverlay:f,transform:h,...p}=u;if(!t)return;const y={x:f.rect.left-d.rect.left,y:f.rect.top-d.rect.top},v={scaleX:h.scaleX!==1?d.rect.width*h.scaleX/f.rect.width:1,scaleY:h.scaleY!==1?d.rect.height*h.scaleY/f.rect.height:1},x={x:h.x-y.x,y:h.y-y.y,...v},w=o({...p,active:d,dragOverlay:f,transform:{initial:h,final:x}}),[_]=w,C=w[w.length-1];if(JSON.stringify(_)===JSON.stringify(C))return;const S=a?.({active:d,dragOverlay:f,...p}),N=f.node.animate(w,{duration:t,easing:i,fill:"forwards"});return new Promise(T=>{N.onfinish=()=>{S?.(),T()}})}}let ox=0;function iC(n){return b.useMemo(()=>{if(n!=null)return ox++,ox},[n])}const tm=_e.memo(n=>{let{adjustScale:t=!1,children:i,dropAnimation:a,style:o,transition:u,modifiers:d,wrapperElement:f="div",className:h,zIndex:p=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:w,draggableNodes:_,droppableContainers:C,dragOverlay:S,over:N,measuringConfiguration:T,scrollableAncestors:L,scrollableAncestorRects:R,windowRect:J}=vb(),H=b.useContext(wd),V=iC(v?.id),k=yb(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:w,draggingNodeRect:S.rect,over:N,overlayNodeRect:S.rect,scrollableAncestors:L,scrollableAncestorRects:R,transform:H,windowRect:J}),M=Xp(x),z=rC({config:a,draggableNodes:_,droppableContainers:C,measuringConfiguration:T}),U=M?S.setRef:void 0;return _e.createElement(J1,null,_e.createElement(W1,{animation:z},v&&V?_e.createElement(eC,{key:V,id:v.id,ref:U,as:f,activatorEvent:y,adjustScale:t,className:h,transition:u,rect:M,style:{zIndex:p,...o},transform:k},i):null))});function Ui(n,t,i){const a=n.slice();return a.splice(i<0?a.length+i:i,0,a.splice(t,1)[0]),a}function aC(n,t){return n.reduce((i,a,o)=>{const u=t.get(a);return u&&(i[o]=u),i},Array(n.length))}function _u(n){return n!==null&&n>=0}function lC(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(n[i]!==t[i])return!1;return!0}function oC(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const nm=n=>{let{rects:t,activeIndex:i,overIndex:a,index:o}=n;const u=Ui(t,a,i),d=t[o],f=u[o];return!f||!d?null:{x:f.left-d.left,y:f.top-d.top,scaleX:f.width/d.width,scaleY:f.height/d.height}},Cu={scaleX:1,scaleY:1},Sl=n=>{var t;let{activeIndex:i,activeNodeRect:a,index:o,rects:u,overIndex:d}=n;const f=(t=u[i])!=null?t:a;if(!f)return null;if(o===i){const p=u[d];return p?{x:0,y:i<d?p.top+p.height-(f.top+f.height):p.top-f.top,...Cu}:null}const h=cC(u,o,i);return o>i&&o<=d?{x:0,y:-f.height-h,...Cu}:o<i&&o>=d?{x:0,y:f.height+h,...Cu}:{x:0,y:0,...Cu}};function cC(n,t,i){const a=n[t],o=n[t-1],u=n[t+1];return a?i<t?o?a.top-(o.top+o.height):u?u.top-(a.top+a.height):0:u?u.top-(a.top+a.height):o?a.top-(o.top+o.height):0:0}const xb="Sortable",bb=_e.createContext({activeIndex:-1,containerId:xb,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:nm,disabled:{draggable:!1,droppable:!1}});function va(n){let{children:t,id:i,items:a,strategy:o=nm,disabled:u=!1}=n;const{active:d,dragOverlay:f,droppableRects:h,over:p,measureDroppableContainers:y}=vb(),v=dc(xb,i),x=f.rect!==null,w=b.useMemo(()=>a.map(H=>typeof H=="object"&&"id"in H?H.id:H),[a]),_=d!=null,C=d?w.indexOf(d.id):-1,S=p?w.indexOf(p.id):-1,N=b.useRef(w),T=!lC(w,N.current),L=S!==-1&&C===-1||T,R=oC(u);ds(()=>{T&&_&&y(w)},[T,w,_,y]),b.useEffect(()=>{N.current=w},[w]);const J=b.useMemo(()=>({activeIndex:C,containerId:v,disabled:R,disableTransforms:L,items:w,overIndex:S,useDragOverlay:x,sortedRects:aC(w,h),strategy:o}),[C,v,R.draggable,R.droppable,L,w,S,h,x,o]);return _e.createElement(bb.Provider,{value:J},t)}const uC=n=>{let{id:t,items:i,activeIndex:a,overIndex:o}=n;return Ui(i,a,o).indexOf(t)},dC=n=>{let{containerId:t,isSorting:i,wasDragging:a,index:o,items:u,newIndex:d,previousItems:f,previousContainerId:h,transition:p}=n;return!p||!a||f!==u&&o===d?!1:i?!0:d!==o&&t===h},hC={duration:200,easing:"ease"},wb="transform",fC=jr.Transition.toString({property:wb,duration:0,easing:"linear"}),pC={roleDescription:"sortable"};function mC(n){let{disabled:t,index:i,node:a,rect:o}=n;const[u,d]=b.useState(null),f=b.useRef(i);return ds(()=>{if(!t&&i!==f.current&&a.current){const h=o.current;if(h){const p=kl(a.current,{ignoreTransform:!0}),y={x:h.left-p.left,y:h.top-p.top,scaleX:h.width/p.width,scaleY:h.height/p.height};(y.x||y.y)&&d(y)}}i!==f.current&&(f.current=i)},[t,i,a,o]),b.useEffect(()=>{u&&d(null)},[u]),u}function ba(n){let{animateLayoutChanges:t=dC,attributes:i,disabled:a,data:o,getNewIndex:u=uC,id:d,strategy:f,resizeObserverConfig:h,transition:p=hC}=n;const{items:y,containerId:v,activeIndex:x,disabled:w,disableTransforms:_,sortedRects:C,overIndex:S,useDragOverlay:N,strategy:T}=b.useContext(bb),L=gC(a,w),R=y.indexOf(d),J=b.useMemo(()=>({sortable:{containerId:v,index:R,items:y},...o}),[v,o,R,y]),H=b.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:V,node:k,isOver:M,setNodeRef:z}=fc({id:d,data:J,disabled:L.droppable,resizeObserverConfig:{updateMeasurementsFor:H,...h}}),{active:U,activatorEvent:F,activeNodeRect:Y,attributes:$,setNodeRef:P,listeners:E,isDragging:B,over:q,setActivatorNodeRef:Q,transform:G}=Zp({id:d,data:J,attributes:{...pC,...i},disabled:L.draggable}),A=z_(z,P),O=!!U,K=O&&!_&&_u(x)&&_u(S),de=!N&&B,pe=de&&K?G:null,te=K?pe??(f??T)({rects:C,activeNodeRect:Y,activeIndex:x,overIndex:S,index:R}):null,W=_u(x)&&_u(S)?u({id:d,items:y,activeIndex:x,overIndex:S}):R,me=U?.id,ke=b.useRef({activeId:me,items:y,newIndex:W,containerId:v}),ie=y!==ke.current.items,je=t({active:U,containerId:v,isDragging:B,isSorting:O,id:d,index:R,items:y,newIndex:ke.current.newIndex,previousItems:ke.current.items,previousContainerId:ke.current.containerId,transition:p,wasDragging:ke.current.activeId!=null}),Re=mC({disabled:!je,index:R,node:k,rect:V});return b.useEffect(()=>{O&&ke.current.newIndex!==W&&(ke.current.newIndex=W),v!==ke.current.containerId&&(ke.current.containerId=v),y!==ke.current.items&&(ke.current.items=y)},[O,W,v,y]),b.useEffect(()=>{if(me===ke.current.activeId)return;if(me!=null&&ke.current.activeId==null){ke.current.activeId=me;return}const qe=setTimeout(()=>{ke.current.activeId=me},50);return()=>clearTimeout(qe)},[me]),{active:U,activeIndex:x,attributes:$,data:J,rect:V,index:R,newIndex:W,items:y,isOver:M,isSorting:O,isDragging:B,listeners:E,node:k,overIndex:S,over:q,setNodeRef:A,setActivatorNodeRef:Q,setDroppableNodeRef:z,setDraggableNodeRef:P,transform:Re??te,transition:Oe()};function Oe(){if(Re||ie&&ke.current.newIndex===R)return fC;if(!(de&&!yd(F)||!p)&&(O||je))return jr.Transition.toString({...p,property:wb})}}function gC(n,t){var i,a;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(i=n?.draggable)!=null?i:t.draggable,droppable:(a=n?.droppable)!=null?a:t.droppable}}function nd(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const yC=[en.Down,en.Right,en.Up,en.Left],Sd=(n,t)=>{let{context:{active:i,collisionRect:a,droppableRects:o,droppableContainers:u,over:d,scrollableAncestors:f}}=t;if(yC.includes(n.code)){if(n.preventDefault(),!i||!a)return;const h=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=o.get(v.id);if(x)switch(n.code){case en.Down:a.top<x.top&&h.push(v);break;case en.Up:a.top>x.top&&h.push(v);break;case en.Left:a.left>x.left&&h.push(v);break;case en.Right:a.left<x.left&&h.push(v);break}});const p=X_({collisionRect:a,droppableRects:o,droppableContainers:h});let y=tb(p,"id");if(y===d?.id&&p.length>1&&(y=p[1].id),y!=null){const v=u.get(i.id),x=u.get(y),w=x?o.get(x.id):null,_=x?.node.current;if(_&&w&&v&&x){const S=vd(_).some((H,V)=>f[V]!==H),N=Sb(v,x),T=vC(v,x),L=S||!N?{x:0,y:0}:{x:T?a.width-w.width:0,y:T?a.height-w.height:0},R={x:w.left,y:w.top};return L.x&&L.y?R:Wo(R,L)}}}};function Sb(n,t){return!nd(n)||!nd(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function vC(n,t){return!nd(n)||!nd(t)||!Sb(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const xC=()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1,bC=(n,{mobile:t=!1}={})=>{if(!n||typeof n!="string"||n.startsWith("data:")||n.startsWith("blob:"))return n;if(n.includes("/storage/v1/object/public/")){const i=t?360:640,a=t?55:68,o=n.includes("?")?"&":"?";return`${n}${o}width=${i}&quality=${a}&resize=contain`}return n},cx=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},Li=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],wC=({recipe:n,isSelected:t,isSelectMode:i,onSelectRecipe:a,onToggleSelection:o,disableDrag:u,showOwner:d,ownerLabelFn:f,index:h=0,mobileView:p=!1})=>{const{attributes:y,listeners:v,setNodeRef:x,transform:w,transition:_,isDragging:C}=ba({id:n.id,disabled:u}),S={transform:jr.Transform.toString(w),transition:_,opacity:C?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"},N=p?4:8,T=h<N?"eager":"lazy",L=h<N?"high":"low",R=bC(n.image,{mobile:p});return r.jsx("div",{ref:x,style:S,...y,...v,children:r.jsxs(hn,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some(J=>/|Dessert/i.test(J))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{i?o(n.id):a(n)},children:[r.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?r.jsx("img",{src:R,alt:n.title,className:"recipe-card__image",loading:T,decoding:"async",fetchPriority:L,sizes:p?"(max-width: 700px) 45vw, 320px":"(max-width: 1024px) 33vw, 280px"}):r.jsx("div",{className:"recipe-card__image placeholder"}),r.jsx("div",{className:"recipe-card__overlay"}),i&&r.jsx("div",{className:"recipe-card__selection-overlay",children:r.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),r.jsx("div",{className:"recipe-card__tags",children:(()=>{const J=Li(n.tags);if(J.length===0)return null;const H=J.filter(M=>!M.startsWith("owner:"));return(H.includes("URL")?["URL"]:H).slice(0,1).map((M,z)=>r.jsx("span",{className:"recipe-tag",children:M},`${M}-${z}`))})()})]}),r.jsxs("div",{className:"recipe-card__content",children:[r.jsx("h3",{className:"recipe-title",children:n.title}),r.jsx("p",{className:"recipe-desc",children:n.description}),r.jsxs("div",{className:"recipe-meta",children:[n.storeName&&r.jsxs("span",{children:[" ",n.storeName]}),d&&typeof f=="function"&&r.jsxs("span",{className:"recipe-owner",children:[" ",f(n)]}),r.jsxs("div",{className:"recipe-dates",children:[r.jsxs("span",{className:"recipe-date",children:[" : ",cx(n.created_at)]}),n.updated_at&&r.jsxs("span",{className:"recipe-date",children:[" : ",cx(n.updated_at)]})]})]})]})]})})},ux=n=>{const t=Li(n.tags);return n.type==="bread"||t.some(i=>/|Bread/i.test(i))},dx=n=>{const t=a=>/|Dessert/i.test(a),i=Li(n.tags);return/|Dessert/i.test(n.category||"")||i.some(t)},hx=n=>{const t=Li(n.tags);return/|Sauce/i.test(n.category||"")||t.some(i=>/|Sauce/i.test(i))},fx=n=>{const t=Li(n.tags);return/||Decor/i.test(n.category||"")||t.some(i=>/||Decor/i.test(i))},px=n=>{const t=n.category||"",i=Li(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||i.some(a=>/|Dressing||Vinaigrette||Mayonnaise/i.test(a))},mx=n=>{const t=n.filter(v=>ux(v)),i=n.filter(v=>!ux(v)),a=i.filter(v=>hx(v)),o=i.filter(v=>!hx(v)),u=o.filter(v=>fx(v)),d=o.filter(v=>!fx(v)),f=d.filter(v=>px(v)),h=d.filter(v=>!px(v)),p=h.filter(v=>dx(v));return{cookingRecipes:h.filter(v=>!dx(v)),breadRecipes:t,dessertRecipes:p,sauceRecipes:a,dressingRecipes:f,decorationRecipes:u}},gx=({recipes:n,onSelectRecipe:t,isSelectMode:i,selectedIds:a,onToggleSelection:o,disableDrag:u,displayMode:d="normal",publicRecipeView:f="none",showOwner:h=!1,ownerLabelFn:p,currentUser:y=null})=>{const[v,x]=b.useState({}),[w,_]=b.useState(()=>xC());_e.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const B=window.matchMedia("(max-width: 700px)"),q=()=>_(!!B.matches);return q(),B.addEventListener?B.addEventListener("change",q):B.addListener(q),()=>{B.removeEventListener?B.removeEventListener("change",q):B.removeListener(q)}},[]);const C=B=>{x(q=>({...q,[B]:!q[B]}))},S=B=>Li(B?.tags).map(Q=>Q.toLowerCase()).includes("public"),N=B=>{if(!y)return!1;const q=Li(B?.tags).filter(G=>G.startsWith("owner:"));if(q.length===0)return!1;const Q=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return q.some(G=>Q.has(G))},T=n.filter(B=>S(B)),L=T.filter(B=>N(B)),R=T.filter(B=>!N(B)),J=n.filter(B=>!S(B)),{cookingRecipes:H,breadRecipes:V,dessertRecipes:k,sauceRecipes:M,dressingRecipes:z,decorationRecipes:U}=mx(J),[F,Y]=b.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);_e.useEffect(()=>{const B=()=>{window.innerWidth>=1024?Y(9):Y(8)};return window.addEventListener("resize",B),()=>window.removeEventListener("resize",B)},[]);const $=(B,q,Q,G,{showWhenEmpty:A=!1,emptyMessage:O=""}={})=>{if(q.length===0&&!A)return null;const K=d==="all";let de=q,pe=!1,ve=!1;return K||(pe=v[G],ve=q.length>F,de=pe?q:q.slice(0,F)),r.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[r.jsxs("h3",{onClick:()=>!K&&ve&&C(G),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!K&&ve?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[r.jsx("span",{children:Q})," ",B,r.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",q.length,")"]}),!K&&ve&&r.jsx("span",{className:"section-toggle-btn",children:pe?" ":" "})]}),r.jsx("div",{className:"recipe-grid",children:r.jsx(va,{items:de.map(te=>te.id),strategy:nm,children:de.map((te,W)=>{const me=a&&a.has(te.id);return r.jsx(wC,{recipe:te,isSelected:me,isSelectMode:i,onSelectRecipe:t,onToggleSelection:o,disableDrag:u,showOwner:h,ownerLabelFn:p,index:W,mobileView:w},te.id)})})}),q.length===0&&r.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:O||`${B}`})]})},P=()=>{if(f!=="mine"&&f!=="others")return null;const B=f==="mine",q=B?"":"",Q=B?"":"",G=B?"public-mine":"public-others",A=B?L:R,O=B?"":"",K=mx(A);return r.jsxs("div",{className:"public-recipes-block",children:[r.jsxs("div",{className:"public-recipes-block__header",children:[r.jsx("span",{children:Q}),r.jsx("span",{children:q}),r.jsxs("span",{className:"public-recipes-block__count",children:["(",A.length,")"]})]}),A.length===0?r.jsx("div",{className:"public-recipes-block__empty",children:O}):r.jsxs(r.Fragment,{children:[$("",K.cookingRecipes,"",`${G}-cooking`),$("",K.breadRecipes,"",`${G}-bread`),$("",K.dessertRecipes,"",`${G}-dessert`),$("",K.sauceRecipes,"",`${G}-sauce`),$("",K.dressingRecipes,"",`${G}-dressing`),$("",K.decorationRecipes,"",`${G}-decoration`)]})]})},E=f==="none"&&T.length>0&&J.length===0;return r.jsxs("div",{className:"recipe-list-container",children:[P(),E&&r.jsx("div",{className:"recipe-list-empty-hint",children:""}),$("",H,"","cooking"),$("",V,"","bread"),$("",k,"","dessert"),$("",M,"","sauce"),$("",z,"","dressing"),$("",U,"","decoration"),n.length===0&&r.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},bn=({isOpen:n,onClose:t,title:i,children:a,size:o="medium",showCloseButton:u=!0})=>{if(b.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),b.useEffect(()=>{const f=h=>{h.key==="Escape"&&n&&t()};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[n,t]),!n)return null;const d=f=>{f.target===f.currentTarget&&t()};return r.jsx("div",{className:"modal-overlay",onClick:d,children:r.jsxs("div",{className:`modal-content modal-${o}`,children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"modal-title",children:i}),u&&r.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),r.jsx("div",{className:"modal-body",children:a})]})})};function jd(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(n);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(n,a[o])&&(i[a[o]]=n[a[o]]);return i}function SC(n,t,i,a){function o(u){return u instanceof i?u:new i(function(d){d(u)})}return new(i||(i=Promise))(function(u,d){function f(y){try{p(a.next(y))}catch(v){d(v)}}function h(y){try{p(a.throw(y))}catch(v){d(v)}}function p(y){y.done?u(y.value):o(y.value).then(f,h)}p((a=a.apply(n,t||[])).next())})}const jC=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class rm extends Error{constructor(t,i="FunctionsError",a){super(t),this.name=i,this.context=a}}class _C extends rm{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class yx extends rm{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class vx extends rm{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var jp;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(jp||(jp={}));class CC{constructor(t,{headers:i={},customFetch:a,region:o=jp.Any}={}){this.url=t,this.headers=i,this.region=o,this.fetch=jC(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return SC(this,arguments,void 0,function*(i,a={}){var o;let u,d;try{const{headers:f,method:h,body:p,signal:y,timeout:v}=a;let x={},{region:w}=a;w||(w=this.region);const _=new URL(`${this.url}/${i}`);w&&w!=="any"&&(x["x-region"]=w,_.searchParams.set("forceFunctionRegion",w));let C;p&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)?typeof Blob<"u"&&p instanceof Blob||p instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",C=p):typeof p=="string"?(x["Content-Type"]="text/plain",C=p):typeof FormData<"u"&&p instanceof FormData?C=p:(x["Content-Type"]="application/json",C=JSON.stringify(p)):p&&typeof p!="string"&&!(typeof Blob<"u"&&p instanceof Blob)&&!(p instanceof ArrayBuffer)&&!(typeof FormData<"u"&&p instanceof FormData)?C=JSON.stringify(p):C=p;let S=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(S=d.signal,y.addEventListener("abort",()=>d.abort())):S=d.signal);const N=yield this.fetch(_.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),f),body:C,signal:S}).catch(J=>{throw new _C(J)}),T=N.headers.get("x-relay-error");if(T&&T==="true")throw new yx(N);if(!N.ok)throw new vx(N);let L=((o=N.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),R;return L==="application/json"?R=yield N.json():L==="application/octet-stream"||L==="application/pdf"?R=yield N.blob():L==="text/event-stream"?R=N:L==="multipart/form-data"?R=yield N.formData():R=yield N.text(),{data:R,error:null,response:N}}catch(f){return{data:null,error:f,response:f instanceof vx||f instanceof yx?f.context:void 0}}finally{u&&clearTimeout(u)}})}}var NC=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},EC=class{constructor(n){var t,i,a;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(i=n.isMaybeSingle)!==null&&i!==void 0?i:!1,this.urlLengthLimit=(a=n.urlLengthLimit)!==null&&a!==void 0?a:8e3,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var i=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let o=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,f=null,h=null,p=u.status,y=u.statusText;if(u.ok){var v,x;if(i.method!=="HEAD"){var w;const N=await u.text();N===""||(i.headers.get("Accept")==="text/csv"||i.headers.get("Accept")&&(!((w=i.headers.get("Accept"))===null||w===void 0)&&w.includes("application/vnd.pgrst.plan+text"))?f=N:f=JSON.parse(N))}const C=(v=i.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),S=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");C&&S&&S.length>1&&(h=parseInt(S[1])),i.isMaybeSingle&&i.method==="GET"&&Array.isArray(f)&&(f.length>1?(d={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,p=406,y="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{var _;const C=await u.text();try{d=JSON.parse(C),Array.isArray(d)&&u.status===404&&(f=[],d=null,p=200,y="OK")}catch{u.status===404&&C===""?(p=204,y="No Content"):d={message:C}}if(d&&i.isMaybeSingle&&(!(d==null||(_=d.details)===null||_===void 0)&&_.includes("0 rows"))&&(d=null,p=200,y="OK"),d&&i.shouldThrowOnError)throw new NC(d)}return{error:d,data:f,count:h,status:p,statusText:y}});return this.shouldThrowOnError||(o=o.catch(u=>{var d;let f="",h="",p="";const y=u?.cause;if(y){var v,x,w,_;const N=(v=y?.message)!==null&&v!==void 0?v:"",T=(x=y?.code)!==null&&x!==void 0?x:"";f=`${(w=u?.name)!==null&&w!==void 0?w:"FetchError"}: ${u?.message}`,f+=`

Caused by: ${(_=y?.name)!==null&&_!==void 0?_:"Error"}: ${N}`,T&&(f+=` (${T})`),y?.stack&&(f+=`
${y.stack}`)}else{var C;f=(C=u?.stack)!==null&&C!==void 0?C:""}const S=this.url.toString().length;return u?.name==="AbortError"||u?.code==="ABORT_ERR"?(p="",h="Request was aborted (timeout or manual cancellation)",S>this.urlLengthLimit&&(h+=`. Note: Your request URL is ${S} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(y?.name==="HeadersOverflowError"||y?.code==="UND_ERR_HEADERS_OVERFLOW")&&(p="",h="HTTP headers exceeded server limits (typically 16KB)",S>this.urlLengthLimit&&(h+=`. Your request URL is ${S} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:f,hint:h,code:p},data:null,count:null,status:0,statusText:""}})),o.then(n,t)}returns(){return this}overrideTypes(){return this}},kC=class extends EC{select(n){let t=!1;const i=(n??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:i,foreignTable:a,referencedTable:o=a}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:i=t}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,t,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:i=!1,buffers:a=!1,wal:o=!1,format:u="text"}={}){var d;const f=[n?"analyze":null,t?"verbose":null,i?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),h=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${h}"; options=${f};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const xx=new RegExp("[,()]");var hl=class extends kC{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const i=Array.from(new Set(t)).map(a=>typeof a=="string"&&xx.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`in.(${i})`),this}notIn(n,t){const i=Array.from(new Set(t)).map(a=>typeof a=="string"&&xx.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`not.in.(${i})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:i,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const u=i===void 0?"":`(${i})`;return this.url.searchParams.append(n,`${o}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,i])=>{this.url.searchParams.append(t,`eq.${i}`)}),this}not(n,t,i){return this.url.searchParams.append(n,`not.${t}.${i}`),this}or(n,{foreignTable:t,referencedTable:i=t}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${n})`),this}filter(n,t,i){return this.url.searchParams.append(n,`${t}.${i}`),this}},TC=class{constructor(n,{headers:t={},schema:i,fetch:a,urlLengthLimit:o=8e3}){this.url=n,this.headers=new Headers(t),this.schema=i,this.fetch=a,this.urlLengthLimit=o}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(n,t){const{head:i=!1,count:a}=t??{},o=i?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(p=>/\s/.test(p)&&!u?"":(p==='"'&&(u=!u),p)).join(""),{url:f,headers:h}=this.cloneRequestState();return f.searchParams.set("select",d),a&&h.append("Prefer",`count=${a}`),new hl({method:o,url:f,headers:h,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(n,{count:t,defaultToNull:i=!0}={}){var a;const o="POST",{url:u,headers:d}=this.cloneRequestState();if(t&&d.append("Prefer",`count=${t}`),i||d.append("Prefer","missing=default"),Array.isArray(n)){const f=n.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(f.length>0){const h=[...new Set(f)].map(p=>`"${p}"`);u.searchParams.set("columns",h.join(","))}}return new hl({method:o,url:u,headers:d,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(n,{onConflict:t,ignoreDuplicates:i=!1,count:a,defaultToNull:o=!0}={}){var u;const d="POST",{url:f,headers:h}=this.cloneRequestState();if(h.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),t!==void 0&&f.searchParams.set("on_conflict",t),a&&h.append("Prefer",`count=${a}`),o||h.append("Prefer","missing=default"),Array.isArray(n)){const p=n.reduce((y,v)=>y.concat(Object.keys(v)),[]);if(p.length>0){const y=[...new Set(p)].map(v=>`"${v}"`);f.searchParams.set("columns",y.join(","))}}return new hl({method:d,url:f,headers:h,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch,urlLengthLimit:this.urlLengthLimit})}update(n,{count:t}={}){var i;const a="PATCH",{url:o,headers:u}=this.cloneRequestState();return t&&u.append("Prefer",`count=${t}`),new hl({method:a,url:o,headers:u,schema:this.schema,body:n,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:n}={}){var t;const i="DELETE",{url:a,headers:o}=this.cloneRequestState();return n&&o.append("Prefer",`count=${n}`),new hl({method:i,url:a,headers:o,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function Jo(n){"@babel/helpers - typeof";return Jo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jo(n)}function AC(n,t){if(Jo(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(Jo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function RC(n){var t=AC(n,"string");return Jo(t)=="symbol"?t:t+""}function OC(n,t,i){return(t=RC(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function bx(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function Nu(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?bx(Object(i),!0).forEach(function(a){OC(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):bx(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}var DC=class jb{constructor(t,{headers:i={},schema:a,fetch:o,timeout:u,urlLengthLimit:d=8e3}={}){this.url=t,this.headers=new Headers(i),this.schemaName=a,this.urlLengthLimit=d;const f=o??globalThis.fetch;u!==void 0&&u>0?this.fetch=(h,p)=>{const y=new AbortController,v=setTimeout(()=>y.abort(),u),x=p?.signal;if(x){if(x.aborted)return clearTimeout(v),f(h,p);const w=()=>{clearTimeout(v),y.abort()};return x.addEventListener("abort",w,{once:!0}),f(h,Nu(Nu({},p),{},{signal:y.signal})).finally(()=>{clearTimeout(v),x.removeEventListener("abort",w)})}return f(h,Nu(Nu({},p),{},{signal:y.signal})).finally(()=>clearTimeout(v))}:this.fetch=f}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new TC(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new jb(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,i={},{head:a=!1,get:o=!1,count:u}={}){var d;let f;const h=new URL(`${this.url}/rpc/${t}`);let p;const y=w=>w!==null&&typeof w=="object"&&(!Array.isArray(w)||w.some(y)),v=a&&Object.values(i).some(y);v?(f="POST",p=i):a||o?(f=a?"HEAD":"GET",Object.entries(i).filter(([w,_])=>_!==void 0).map(([w,_])=>[w,Array.isArray(_)?`{${_.join(",")}}`:`${_}`]).forEach(([w,_])=>{h.searchParams.append(w,_)})):(f="POST",p=i);const x=new Headers(this.headers);return v?x.set("Prefer",u?`count=${u},return=minimal`:"return=minimal"):u&&x.set("Prefer",`count=${u}`),new hl({method:f,url:h,headers:x,schema:this.schemaName,body:p,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch,urlLengthLimit:this.urlLengthLimit})}};class MC{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const i=globalThis.process;if(i){const a=i.versions;if(a&&a.node){const o=a.node,u=parseInt(o.replace(/^v/,"").split(".")[0]);return u>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${u} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${u} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let i=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(i+=`

Suggested solution: ${t.workaround}`),new Error(i)}static createWebSocket(t,i){const a=this.getWebSocketConstructor();return new a(t,i)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const LC="2.97.0",zC=`realtime-js/${LC}`,UC="1.0.0",_b="2.0.0",wx=_b,_p=1e4,IC=1e3,BC=100;var Ti;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Ti||(Ti={}));var Gn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Gn||(Gn={}));var cs;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(cs||(cs={}));var Cp;(function(n){n.websocket="websocket"})(Cp||(Cp={}));var da;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(da||(da={}));class $C{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,i){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return i(this._binaryEncodeUserBroadcastPush(t));let a=[t.join_ref,t.ref,t.topic,t.event,t.payload];return i(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(t){var i;return this._isArrayBuffer((i=t.payload)===null||i===void 0?void 0:i.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var i,a;const o=(a=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var i,a;const o=(a=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&a!==void 0?a:{},d=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,i,a){var o,u;const d=t.topic,f=(o=t.ref)!==null&&o!==void 0?o:"",h=(u=t.join_ref)!==null&&u!==void 0?u:"",p=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(h.length>255)throw new Error(`joinRef length ${h.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`ref length ${f.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`userEvent length ${p.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+f.length+d.length+p.length+v.length,w=new ArrayBuffer(this.HEADER_LENGTH+x);let _=new DataView(w),C=0;_.setUint8(C++,this.KINDS.userBroadcastPush),_.setUint8(C++,h.length),_.setUint8(C++,f.length),_.setUint8(C++,d.length),_.setUint8(C++,p.length),_.setUint8(C++,v.length),_.setUint8(C++,i),Array.from(h,N=>_.setUint8(C++,N.charCodeAt(0))),Array.from(f,N=>_.setUint8(C++,N.charCodeAt(0))),Array.from(d,N=>_.setUint8(C++,N.charCodeAt(0))),Array.from(p,N=>_.setUint8(C++,N.charCodeAt(0))),Array.from(v,N=>_.setUint8(C++,N.charCodeAt(0)));var S=new Uint8Array(w.byteLength+a.byteLength);return S.set(new Uint8Array(w),0),S.set(new Uint8Array(a),w.byteLength),S.buffer}decode(t,i){if(this._isArrayBuffer(t)){let a=this._binaryDecode(t);return i(a)}if(typeof t=="string"){const a=JSON.parse(t),[o,u,d,f,h]=a;return i({join_ref:o,ref:u,topic:d,event:f,payload:h})}return i({})}_binaryDecode(t){const i=new DataView(t),a=i.getUint8(0),o=new TextDecoder;if(a===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,i,o)}_decodeUserBroadcast(t,i,a){const o=i.getUint8(1),u=i.getUint8(2),d=i.getUint8(3),f=i.getUint8(4);let h=this.HEADER_LENGTH+4;const p=a.decode(t.slice(h,h+o));h=h+o;const y=a.decode(t.slice(h,h+u));h=h+u;const v=a.decode(t.slice(h,h+d));h=h+d;const x=t.slice(h,t.byteLength),w=f===this.JSON_ENCODING?JSON.parse(a.decode(x)):x,_={type:this.BROADCAST_EVENT,event:y,payload:w};return d>0&&(_.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:p,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(t){var i;return t instanceof ArrayBuffer||((i=t?.constructor)===null||i===void 0?void 0:i.name)==="ArrayBuffer"}_pick(t,i){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([a])=>i.includes(a)))}}class Cb{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var _n;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(_n||(_n={}));const Sx=(n,t,i={})=>{var a;const o=(a=i.skipTypes)!==null&&a!==void 0?a:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=PC(d,n,t,o),u),{}):{}},PC=(n,t,i,a)=>{const o=t.find(f=>f.name===n),u=o?.type,d=i[n];return u&&!a.includes(u)?Nb(u,d):Np(d)},Nb=(n,t)=>{if(n.charAt(0)==="_"){const i=n.slice(1,n.length);return VC(t,i)}switch(n){case _n.bool:return qC(t);case _n.float4:case _n.float8:case _n.int2:case _n.int4:case _n.int8:case _n.numeric:case _n.oid:return FC(t);case _n.json:case _n.jsonb:return HC(t);case _n.timestamp:return GC(t);case _n.abstime:case _n.date:case _n.daterange:case _n.int4range:case _n.int8range:case _n.money:case _n.reltime:case _n.text:case _n.time:case _n.timestamptz:case _n.timetz:case _n.tsrange:case _n.tstzrange:return Np(t);default:return Np(t)}},Np=n=>n,qC=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},FC=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},HC=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},VC=(n,t)=>{if(typeof n!="string")return n;const i=n.length-1,a=n[i];if(n[0]==="{"&&a==="}"){let u;const d=n.slice(1,i);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(f=>Nb(t,f))}return n},GC=n=>typeof n=="string"?n.replace(" ","T"):n,Eb=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class $f{constructor(t,i,a={},o=_p){this.channel=t,this.event=i,this.payload=a,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var a;return this._hasReceived(t)&&i((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var jx;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(jx||(jx={}));class Ho{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=i?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},o=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ho.syncState(this.state,o,u,d),this.pendingDiffs.forEach(h=>{this.state=Ho.syncDiff(this.state,h,u,d)}),this.pendingDiffs=[],f()}),this.channel._on(a.diff,{},o=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=Ho.syncDiff(this.state,o,u,d),f())}),this.onJoin((o,u,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:u,newPresences:d})}),this.onLeave((o,u,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,a,o){const u=this.cloneDeep(t),d=this.transformState(i),f={},h={};return this.map(u,(p,y)=>{d[p]||(h[p]=y)}),this.map(d,(p,y)=>{const v=u[p];if(v){const x=y.map(S=>S.presence_ref),w=v.map(S=>S.presence_ref),_=y.filter(S=>w.indexOf(S.presence_ref)<0),C=v.filter(S=>x.indexOf(S.presence_ref)<0);_.length>0&&(f[p]=_),C.length>0&&(h[p]=C)}else f[p]=y}),this.syncDiff(u,{joins:f,leaves:h},a,o)}static syncDiff(t,i,a,o){const{joins:u,leaves:d}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return a||(a=()=>{}),o||(o=()=>{}),this.map(u,(f,h)=>{var p;const y=(p=t[f])!==null&&p!==void 0?p:[];if(t[f]=this.cloneDeep(h),y.length>0){const v=t[f].map(w=>w.presence_ref),x=y.filter(w=>v.indexOf(w.presence_ref)<0);t[f].unshift(...x)}a(f,y,h)}),this.map(d,(f,h)=>{let p=t[f];if(!p)return;const y=h.map(v=>v.presence_ref);p=p.filter(v=>y.indexOf(v.presence_ref)<0),t[f]=p,o(f,p,h),p.length===0&&delete t[f]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(a=>i(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,a)=>{const o=t[a];return"metas"in o?i[a]=o.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):i[a]=o,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var _x;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(_x||(_x={}));var Vo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Vo||(Vo={}));var qs;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(qs||(qs={}));class gl{constructor(t,i={config:{}},a){var o,u;if(this.topic=t,this.params=i,this.socket=a,this.bindings={},this.state=Gn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new $f(this,cs.join,this.params,this.timeout),this.rejoinTimer=new Cb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Gn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Gn.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Gn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Gn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Gn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(cs.reply,{},(d,f)=>{this._trigger(this._replyEventName(f),d)}),this.presence=new Ho(this),this.broadcastEndpointURL=Eb(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,i=this.timeout){var a,o,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Gn.closed){const{config:{broadcast:d,presence:f,private:h}}=this.params,p=(o=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(w=>w.filter))!==null&&o!==void 0?o:[],y=!!this.bindings[Vo.PRESENCE]&&this.bindings[Vo.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},f),{enabled:y}),postgres_changes:p,private:h};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(w=>t?.(qs.CHANNEL_ERROR,w)),this._onClose(()=>t?.(qs.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:w})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),w===void 0){t?.(qs.SUBSCRIBED);return}else{const C=this.bindings.postgres_changes,S=(_=C?.length)!==null&&_!==void 0?_:0,N=[];for(let T=0;T<S;T++){const L=C[T],{filter:{event:R,schema:J,table:H,filter:V}}=L,k=w&&w[T];if(k&&k.event===R&&gl.isFilterValueEqual(k.schema,J)&&gl.isFilterValueEqual(k.table,H)&&gl.isFilterValueEqual(k.filter,V))N.push(Object.assign(Object.assign({},L),{id:k.id}));else{this.unsubscribe(),this.state=Gn.errored,t?.(qs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=N,t&&t(qs.SUBSCRIBED);return}}).receive("error",w=>{this.state=Gn.errored,t?.(qs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(w).join(", ")||"error")))}).receive("timeout",()=>{t?.(qs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,a){return this.state===Gn.joined&&t===Vo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,i,a)}async httpSend(t,i,a={}){var o;if(i==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:i,private:this.private}]})},f=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=a.timeout)!==null&&o!==void 0?o:this.timeout);if(f.status===202)return{success:!0};let h=f.statusText;try{const p=await f.json();h=p.error||p.message||h}catch{}return Promise.reject(new Error(h))}async send(t,i={}){var a,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,f={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(f.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:f,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const p=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(a=i.timeout)!==null&&a!==void 0?a:this.timeout);return await((o=p.body)===null||o===void 0?void 0:o.cancel()),p.ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,f,h;const p=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((h=(f=(d=this.params)===null||d===void 0?void 0:d.config)===null||f===void 0?void 0:f.broadcast)===null||h===void 0)&&h.ack)&&u("ok"),p.receive("ok",()=>u("ok")),p.receive("error",()=>u("error")),p.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Gn.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(cs.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(o=>{a=new $f(this,cs.leave,{},t),a.receive("ok",()=>{i(),o("ok")}).receive("timeout",()=>{i(),o("timed out")}).receive("error",()=>{o("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Gn.closed,this.bindings={}}async _fetchWithTimeout(t,i,a){const o=new AbortController,u=setTimeout(()=>o.abort(),a),d=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:o.signal}));return clearTimeout(u),d}_push(t,i,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new $f(this,t,i,a);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>BC){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(t,i,a){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,a){var o,u;const d=t.toLocaleLowerCase(),{close:f,error:h,leave:p,join:y}=cs;if(a&&[f,h,p,y].indexOf(d)>=0&&a!==this._joinRef())return;let x=this._onMessage(d,i,a);if(i&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(w=>{var _,C,S;return((_=w.filter)===null||_===void 0?void 0:_.event)==="*"||((S=(C=w.filter)===null||C===void 0?void 0:C.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===d}).map(w=>w.callback(x,a)):(u=this.bindings[d])===null||u===void 0||u.filter(w=>{var _,C,S,N,T,L;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in w){const R=w.id,J=(_=w.filter)===null||_===void 0?void 0:_.event;return R&&((C=i.ids)===null||C===void 0?void 0:C.includes(R))&&(J==="*"||J?.toLocaleLowerCase()===((S=i.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const R=(T=(N=w?.filter)===null||N===void 0?void 0:N.event)===null||T===void 0?void 0:T.toLocaleLowerCase();return R==="*"||R===((L=i?.event)===null||L===void 0?void 0:L.toLocaleLowerCase())}else return w.type.toLocaleLowerCase()===d}).map(w=>{if(typeof x=="object"&&"ids"in x){const _=x.data,{schema:C,table:S,commit_timestamp:N,type:T,errors:L}=_;x=Object.assign(Object.assign({},{schema:C,table:S,commit_timestamp:N,eventType:T,new:{},old:{},errors:L}),this._getPayloadRecords(_))}w.callback(x,a)})}_isClosed(){return this.state===Gn.closed}_isJoined(){return this.state===Gn.joined}_isJoining(){return this.state===Gn.joining}_isLeaving(){return this.state===Gn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,a){const o=t.toLocaleLowerCase(),u={type:o,filter:i,callback:a};return this.bindings[o]?this.bindings[o].push(u):this.bindings[o]=[u],this}_off(t,i){const a=t.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(o=>{var u;return!(((u=o.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===a&&gl.isEqual(o.filter,i))})),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(t[a]!==i[a])return!1;return!0}static isFilterValueEqual(t,i){return(t??void 0)===(i??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(cs.close,{},t)}_onError(t){this._on(cs.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Gn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=Sx(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=Sx(t.columns,t.old_record)),i}}const Pf=()=>{},Eu={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},KC=[1e3,2e3,5e3,1e4],YC=1e4,WC=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class QC{constructor(t,i){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=_p,this.transport=null,this.heartbeatIntervalMs=Eu.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Pf,this.ref=0,this.reconnectTimer=null,this.vsn=wx,this.logger=Pf,this.conn=null,this.sendBuffer=[],this.serializer=new $C,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=o=>o?(...u)=>o(...u):(...u)=>fetch(...u),!(!((a=i?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${t}/${Cp.websocket}`,this.httpEndpoint=Eb(t),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=MC.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const i=t.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,i??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,i,a){this.logger(t,i,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Ti.connecting:return da.Connecting;case Ti.open:return da.Open;case Ti.closing:return da.Closing;default:return da.Closed}}isConnected(){return this.connectionState()===da.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,i={config:{}}){const a=`realtime:${t}`,o=this.getChannels().find(u=>u.topic===a);if(o)return o;{const u=new gl(`realtime:${t}`,i,this);return this.channels.push(u),u}}push(t){const{topic:i,event:a,payload:o,ref:u}=t,d=()=>{this.encode(t,f=>{var h;(h=this.conn)===null||h===void 0||h.send(f)})};this.log("push",`${i} ${a} (${u})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(IC,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},Eu.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply"&&i.ref&&i.ref===this.pendingHeartbeatRef){const p=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error",p)}catch(y){this.log("error","error in heartbeat callback",y)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:a,event:o,payload:u,ref:d}=i,f=d?`(${d})`:"",h=u.status||"";this.log("receive",`${h} ${a} ${o} ${f}`.trim(),u),this.channels.filter(p=>p._isMember(a)).forEach(p=>p._trigger(o,u,d)),this._triggerStateCallbacks("message",i)})}_clearTimer(t){var i;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Ti.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Ti.open||this.conn.readyState===Ti.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(i=>{this.log("error","error waiting for auth on connect",i),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this._terminateWorker()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var i;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(i){this.log("error","error in heartbeat callback",i)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(cs.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const a=t.match(/\?/)?"&":"?",o=new URLSearchParams(i);return`${t}${a}${o}`}_workerObjectUrl(t){let i;if(t)i=t;else{const a=new Blob([WC],{type:"application/javascript"});i=URL.createObjectURL(a)}return i}_setConnectionState(t,i=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(t=null){let i,a=!1;if(t)i=t,a=!0;else if(this.accessToken)try{i=await this.accessToken()}catch(o){this.log("error","Error fetching access token from callback",o),i=this.accessTokenValue}else i=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(o=>{const u={access_token:i,version:zC};i&&o.updateJoinPayload(u),o.joinedOnce&&o._isJoined()&&o._push(cs.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(i=>{this.log("error",`Error setting auth in ${t}`,i)})}_triggerStateCallbacks(t,i){try{this.stateChangeCallbacks[t].forEach(a=>{try{a(i)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(a){this.log("error",`error triggering ${t} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new Cb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Eu.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var i,a,o,u,d,f,h,p,y,v,x,w;switch(this.transport=(i=t?.transport)!==null&&i!==void 0?i:null,this.timeout=(a=t?.timeout)!==null&&a!==void 0?a:_p,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:Eu.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(f=t?.heartbeatCallback)!==null&&f!==void 0?f:Pf,this.vsn=(h=t?.vsn)!==null&&h!==void 0?h:wx,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(p=t?.reconnectAfterMs)!==null&&p!==void 0?p:(_=>KC[_-1]||YC),this.vsn){case UC:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((_,C)=>C(JSON.stringify(_))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((_,C)=>C(JSON.parse(_)));break;case _b:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(w=t?.decode)!==null&&w!==void 0?w:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var Xo=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function JC(n,t,i){const a=new URL(t,n);if(i)for(const[o,u]of Object.entries(i))u!==void 0&&a.searchParams.set(o,u);return a.toString()}async function XC(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function ZC(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:i,path:a,query:o,body:u,headers:d}){const f=JC(n.baseUrl,a,o),h=await XC(n.auth),p=await t(f,{method:i,headers:{...u?{"Content-Type":"application/json"}:{},...h,...d},body:u?JSON.stringify(u):void 0}),y=await p.text(),v=(p.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!p.ok){const w=v?x:void 0,_=w?.error;throw new Xo(_?.message??`Request failed with status ${p.status}`,{status:p.status,icebergType:_?.type,icebergCode:_?.code,details:w})}return{status:p.status,headers:p.headers,data:x}}}}function ku(n){return n.join("")}var eN=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:ku(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(n,t){const i={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:i})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ku(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ku(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ku(n.namespace)}`}),!0}catch(t){if(t instanceof Xo&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(i){if(i instanceof Xo&&i.status===409)return;throw i}}};function el(n){return n.join("")}var tN=class{constructor(n,t="",i){this.client=n,this.prefix=t,this.accessDelegation=i}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${el(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const i={};return this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${el(n.namespace)}/tables`,body:t,headers:i})).data.metadata}async updateTable(n,t){const i=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${el(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":i.data["metadata-location"],metadata:i.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${el(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${el(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${el(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(i){if(i instanceof Xo&&i.status===404)return!1;throw i}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(i){if(i instanceof Xo&&i.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw i}}},nN=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const i=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=ZC({baseUrl:i,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new eN(this.client,t),this.tableOps=new tN(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},_d=class extends Error{constructor(n,t="storage",i,a){super(n),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=i,this.statusCode=a}};function Cd(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Tu=class extends _d{constructor(n,t,i,a="storage"){super(n,a,t,i),this.name=a==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},kb=class extends _d{constructor(n,t,i="storage"){super(n,i),this.name=i==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const rN=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),sN=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Ep=n=>{if(Array.isArray(n))return n.map(i=>Ep(i));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([i,a])=>{const o=i.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[o]=Ep(a)}),t},iN=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Zo(n){"@babel/helpers - typeof";return Zo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zo(n)}function aN(n,t){if(Zo(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(Zo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function lN(n){var t=aN(n,"string");return Zo(t)=="symbol"?t:t+""}function oN(n,t,i){return(t=lN(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function Cx(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function Ot(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Cx(Object(i),!0).forEach(function(a){oN(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):Cx(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}const Nx=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},cN=async(n,t,i,a)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!i?.noResolveJson){const o=n,u=o.status||500;if(typeof o.json=="function")o.json().then(d=>{const f=d?.statusCode||d?.code||u+"";t(new Tu(Nx(d),u,f,a))}).catch(()=>{if(a==="vectors"){const d=u+"";t(new Tu(o.statusText||`HTTP ${u} error`,u,d,a))}else{const d=u+"";t(new Tu(o.statusText||`HTTP ${u} error`,u,d,a))}});else{const d=u+"";t(new Tu(o.statusText||`HTTP ${u} error`,u,d,a))}}else t(new kb(Nx(n),n,a))},uN=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"||n==="HEAD"||!a?Ot(Ot({},o),i):(sN(a)?(o.headers=Ot({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,t?.duplex&&(o.duplex=t.duplex),Ot(Ot({},o),i))};async function To(n,t,i,a,o,u,d){return new Promise((f,h)=>{n(i,uN(t,a,o,u)).then(p=>{if(!p.ok)throw p;if(a?.noResolveJson)return p;if(d==="vectors"){const y=p.headers.get("content-type");if(p.headers.get("content-length")==="0"||p.status===204)return{};if(!y||!y.includes("application/json"))return{}}return p.json()}).then(p=>f(p)).catch(p=>cN(p,h,a,d))})}function Tb(n="storage"){return{get:async(t,i,a,o)=>To(t,"GET",i,a,o,void 0,n),post:async(t,i,a,o,u)=>To(t,"POST",i,o,u,a,n),put:async(t,i,a,o,u)=>To(t,"PUT",i,o,u,a,n),head:async(t,i,a,o)=>To(t,"HEAD",i,Ot(Ot({},a),{},{noResolveJson:!0}),o,void 0,n),remove:async(t,i,a,o,u)=>To(t,"DELETE",i,o,u,a,n)}}const dN=Tb("storage"),{get:ec,post:os,put:kp,head:hN,remove:sm}=dN,Dr=Tb("vectors");var Ol=class{constructor(n,t={},i,a="storage"){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.fetch=rN(i),this.namespace=a}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=Ot(Ot({},this.headers),{},{[n]:t}),this}async handleOperation(n){var t=this;try{return{data:await n(),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Cd(i))return{data:null,error:i};throw i}}},fN=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Cd(t))return{data:null,error:t};throw t}}};let Ab;Ab=Symbol.toStringTag;var pN=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[Ab]="BlobDownloadBuilder",this.promise=null}asStream(){return new fN(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Cd(t))return{data:null,error:t};throw t}}};const mN={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ex={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var gN=class extends Ol{constructor(n,t={},i,a){super(n,t,a,"storage"),this.bucketId=i}async uploadOrUpdate(n,t,i,a){var o=this;return o.handleOperation(async()=>{let u;const d=Ot(Ot({},Ex),a);let f=Ot(Ot({},o.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const h=d.metadata;typeof Blob<"u"&&i instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),h&&u.append("metadata",o.encodeMetadata(h)),u.append("",i)):typeof FormData<"u"&&i instanceof FormData?(u=i,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),h&&!u.has("metadata")&&u.append("metadata",o.encodeMetadata(h))):(u=i,f["cache-control"]=`max-age=${d.cacheControl}`,f["content-type"]=d.contentType,h&&(f["x-metadata"]=o.toBase64(o.encodeMetadata(h))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),a?.headers&&(f=Ot(Ot({},f),a.headers));const p=o._removeEmptyFolders(t),y=o._getFinalPath(p),v=await(n=="PUT"?kp:os)(o.fetch,`${o.url}/object/${y}`,u,Ot({headers:f},d?.duplex?{duplex:d.duplex}:{}));return{path:p,id:v.Id,fullPath:v.Key}})}async upload(n,t,i){return this.uploadOrUpdate("POST",n,t,i)}async uploadToSignedUrl(n,t,i,a){var o=this;const u=o._removeEmptyFolders(n),d=o._getFinalPath(u),f=new URL(o.url+`/object/upload/sign/${d}`);return f.searchParams.set("token",t),o.handleOperation(async()=>{let h;const p=Ot({upsert:Ex.upsert},a),y=Ot(Ot({},o.headers),{"x-upsert":String(p.upsert)});return typeof Blob<"u"&&i instanceof Blob?(h=new FormData,h.append("cacheControl",p.cacheControl),h.append("",i)):typeof FormData<"u"&&i instanceof FormData?(h=i,h.append("cacheControl",p.cacheControl)):(h=i,y["cache-control"]=`max-age=${p.cacheControl}`,y["content-type"]=p.contentType),{path:u,fullPath:(await kp(o.fetch,f.toString(),h,{headers:y})).Key}})}async createSignedUploadUrl(n,t){var i=this;return i.handleOperation(async()=>{let a=i._getFinalPath(n);const o=Ot({},i.headers);t?.upsert&&(o["x-upsert"]="true");const u=await os(i.fetch,`${i.url}/object/upload/sign/${a}`,{},{headers:o}),d=new URL(i.url+u.url),f=d.searchParams.get("token");if(!f)throw new _d("No token returned by API");return{signedUrl:d.toString(),path:n,token:f}})}async update(n,t,i){return this.uploadOrUpdate("PUT",n,t,i)}async move(n,t,i){var a=this;return a.handleOperation(async()=>await os(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:a.headers}))}async copy(n,t,i){var a=this;return a.handleOperation(async()=>({path:(await os(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:a.headers})).Key}))}async createSignedUrl(n,t,i){var a=this;return a.handleOperation(async()=>{let o=a._getFinalPath(n),u=await os(a.fetch,`${a.url}/object/sign/${o}`,Ot({expiresIn:t},i?.transform?{transform:i.transform}:{}),{headers:a.headers});const d=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{signedUrl:encodeURI(`${a.url}${u.signedURL}${d}`)}})}async createSignedUrls(n,t,i){var a=this;return a.handleOperation(async()=>{const o=await os(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:t,paths:n},{headers:a.headers}),u=i?.download?`&download=${i.download===!0?"":i.download}`:"";return o.map(d=>Ot(Ot({},d),{},{signedUrl:d.signedURL?encodeURI(`${a.url}${d.signedURL}${u}`):null}))})}download(n,t,i){const a=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),u=o?`?${o}`:"",d=this._getFinalPath(n),f=()=>ec(this.fetch,`${this.url}/${a}/${d}${u}`,{headers:this.headers,noResolveJson:!0},i);return new pN(f,this.shouldThrowOnError)}async info(n){var t=this;const i=t._getFinalPath(n);return t.handleOperation(async()=>Ep(await ec(t.fetch,`${t.url}/object/info/${i}`,{headers:t.headers})))}async exists(n){var t=this;const i=t._getFinalPath(n);try{return await hN(t.fetch,`${t.url}/object/${i}`,{headers:t.headers}),{data:!0,error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Cd(a)&&a instanceof kb){const o=a.originalError;if([400,404].includes(o?.status))return{data:!1,error:a}}throw a}}getPublicUrl(n,t){const i=this._getFinalPath(n),a=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&a.push(o);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&a.push(d);let f=a.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${i}${f}`)}}}async remove(n){var t=this;return t.handleOperation(async()=>await sm(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}))}async list(n,t,i){var a=this;return a.handleOperation(async()=>{const o=Ot(Ot(Ot({},mN),t),{},{prefix:n||""});return await os(a.fetch,`${a.url}/object/list/${a.bucketId}`,o,{headers:a.headers},i)})}async listV2(n,t){var i=this;return i.handleOperation(async()=>{const a=Ot({},n);return await os(i.fetch,`${i.url}/object/list-v2/${i.bucketId}`,a,{headers:i.headers},t)})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const yN="2.97.0",pc={"X-Client-Info":`storage-js/${yN}`};var vN=class extends Ol{constructor(n,t={},i,a){const o=new URL(n);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase."));const u=o.href.replace(/\/$/,""),d=Ot(Ot({},pc),t);super(u,d,i,"storage")}async listBuckets(n){var t=this;return t.handleOperation(async()=>{const i=t.listBucketOptionsToQueryString(n);return await ec(t.fetch,`${t.url}/bucket${i}`,{headers:t.headers})})}async getBucket(n){var t=this;return t.handleOperation(async()=>await ec(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}))}async createBucket(n,t={public:!1}){var i=this;return i.handleOperation(async()=>await os(i.fetch,`${i.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}))}async updateBucket(n,t){var i=this;return i.handleOperation(async()=>await kp(i.fetch,`${i.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}))}async emptyBucket(n){var t=this;return t.handleOperation(async()=>await os(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}))}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await sm(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},xN=class extends Ol{constructor(n,t={},i){const a=n.replace(/\/$/,""),o=Ot(Ot({},pc),t);super(a,o,i,"storage")}async createBucket(n){var t=this;return t.handleOperation(async()=>await os(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}))}async listBuckets(n){var t=this;return t.handleOperation(async()=>{const i=new URLSearchParams;n?.limit!==void 0&&i.set("limit",n.limit.toString()),n?.offset!==void 0&&i.set("offset",n.offset.toString()),n?.sortColumn&&i.set("sortColumn",n.sortColumn),n?.sortOrder&&i.set("sortOrder",n.sortOrder),n?.search&&i.set("search",n.search);const a=i.toString(),o=a?`${t.url}/bucket?${a}`:`${t.url}/bucket`;return await ec(t.fetch,o,{headers:t.headers})})}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await sm(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}))}from(n){var t=this;if(!iN(n))throw new _d("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const i=new nN({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(i,{get(o,u){const d=o[u];return typeof d!="function"?d:async(...f)=>{try{return{data:await d.apply(o,f),error:null}}catch(h){if(a)throw h;return{data:null,error:h}}}}})}},bN=class extends Ol{constructor(n,t={},i){const a=n.replace(/\/$/,""),o=Ot(Ot({},pc),{},{"Content-Type":"application/json"},t);super(a,o,i,"vectors")}async createIndex(n){var t=this;return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{})}async getIndex(n,t){var i=this;return i.handleOperation(async()=>await Dr.post(i.fetch,`${i.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:i.headers}))}async listIndexes(n){var t=this;return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}))}async deleteIndex(n,t){var i=this;return i.handleOperation(async()=>await Dr.post(i.fetch,`${i.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:i.headers})||{})}},wN=class extends Ol{constructor(n,t={},i){const a=n.replace(/\/$/,""),o=Ot(Ot({},pc),{},{"Content-Type":"application/json"},t);super(a,o,i,"vectors")}async putVectors(n){var t=this;if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{})}async getVectors(n){var t=this;return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}))}async listVectors(n){var t=this;if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}))}async queryVectors(n){var t=this;return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}))}async deleteVectors(n){var t=this;if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{})}},SN=class extends Ol{constructor(n,t={},i){const a=n.replace(/\/$/,""),o=Ot(Ot({},pc),{},{"Content-Type":"application/json"},t);super(a,o,i,"vectors")}async createBucket(n){var t=this;return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{})}async getBucket(n){var t=this;return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}))}async listBuckets(n={}){var t=this;return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}))}async deleteBucket(n){var t=this;return t.handleOperation(async()=>await Dr.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{})}},jN=class extends SN{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new _N(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,i=this;return t().call(i,n)}async getBucket(n){var t=()=>super.getBucket,i=this;return t().call(i,n)}async listBuckets(n={}){var t=()=>super.listBuckets,i=this;return t().call(i,n)}async deleteBucket(n){var t=()=>super.deleteBucket,i=this;return t().call(i,n)}},_N=class extends bN{constructor(n,t,i,a){super(n,t,a),this.vectorBucketName=i}async createIndex(n){var t=()=>super.createIndex,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,i=this;return t().call(i,i.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,i=this;return t().call(i,i.vectorBucketName,n)}index(n){return new CN(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},CN=class extends wN{constructor(n,t,i,a,o){super(n,t,o),this.vectorBucketName=i,this.indexName=a}async putVectors(n){var t=()=>super.putVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async getVectors(n){var t=()=>super.getVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}},NN=class extends vN{constructor(n,t={},i,a){super(n,t,i,a)}from(n){return new gN(this.url,this.headers,n,this.fetch)}get vectors(){return new jN(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new xN(this.url+"/iceberg",this.headers,this.fetch)}};const Rb="2.97.0",fl=30*1e3,Tp=3,qf=Tp*fl,EN="http://localhost:9999",kN="supabase.auth.token",TN={"X-Client-Info":`gotrue-js/${Rb}`},Ap="X-Supabase-Api-Version",Ob={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},AN=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,RN=600*1e3;class tc extends Error{constructor(t,i,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=a}}function bt(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class ON extends tc{constructor(t,i,a){super(t,i,a),this.name="AuthApiError",this.status=i,this.code=a}}function DN(n){return bt(n)&&n.name==="AuthApiError"}class ha extends tc{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class Qs extends tc{constructor(t,i,a,o){super(t,a,o),this.name=i,this.status=a}}class Rr extends Qs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ff(n){return bt(n)&&n.name==="AuthSessionMissingError"}class tl extends Qs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Au extends Qs{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Ru extends Qs{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function MN(n){return bt(n)&&n.name==="AuthImplicitGrantRedirectError"}class kx extends Qs{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class LN extends Qs{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Rp extends Qs{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function Hf(n){return bt(n)&&n.name==="AuthRetryableFetchError"}class Tx extends Qs{constructor(t,i,a){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=a}}class Op extends Qs{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const rd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ax=` 	
\r=`.split(""),zN=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<Ax.length;t+=1)n[Ax[t].charCodeAt(0)]=-2;for(let t=0;t<rd.length;t+=1)n[rd[t].charCodeAt(0)]=t;return n})();function Rx(n,t,i){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;i(rd[a]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;i(rd[a]),t.queuedBits-=6}}function Db(n,t,i){const a=zN[n];if(a>-1)for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)i(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Ox(n){const t=[],i=d=>{t.push(String.fromCodePoint(d))},a={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},u=d=>{BN(d,a,i)};for(let d=0;d<n.length;d+=1)Db(n.charCodeAt(d),o,u);return t.join("")}function UN(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function IN(n,t){for(let i=0;i<n.length;i+=1){let a=n.charCodeAt(i);if(a>55295&&a<=56319){const o=(a-55296)*1024&65535;a=(n.charCodeAt(i+1)-56320&65535|o)+65536,i+=1}UN(a,t)}}function BN(n,t,i){if(t.utf8seq===0){if(n<=127){i(n);return}for(let a=1;a<6;a+=1)if((n>>7-a&1)===0){t.utf8seq=a;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&i(t.codepoint)}}function xl(n){const t=[],i={queue:0,queuedBits:0},a=o=>{t.push(o)};for(let o=0;o<n.length;o+=1)Db(n.charCodeAt(o),i,a);return new Uint8Array(t)}function $N(n){const t=[];return IN(n,i=>t.push(i)),new Uint8Array(t)}function ma(n){const t=[],i={queue:0,queuedBits:0},a=o=>{t.push(o)};return n.forEach(o=>Rx(o,i,a)),Rx(null,i,a),t.join("")}function PN(n){return Math.round(Date.now()/1e3)+n}function qN(){return Symbol("auth-callback")}const lr=()=>typeof window<"u"&&typeof document<"u",ra={tested:!1,writable:!1},Mb=()=>{if(!lr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ra.tested)return ra.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ra.tested=!0,ra.writable=!0}catch{ra.tested=!0,ra.writable=!1}return ra.writable};function FN(n){const t={},i=new URL(n);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((o,u)=>{t[u]=o})}catch{}return i.searchParams.forEach((a,o)=>{t[o]=a}),t}const Lb=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),HN=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",pl=async(n,t,i)=>{await n.setItem(t,JSON.stringify(i))},sa=async(n,t)=>{const i=await n.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},ar=async(n,t)=>{await n.removeItem(t)};class Nd{constructor(){this.promise=new Nd.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}Nd.promiseConstructor=Promise;function Ou(n){const t=n.split(".");if(t.length!==3)throw new Op("Invalid JWT structure");for(let a=0;a<t.length;a++)if(!AN.test(t[a]))throw new Op("JWT not in base64url format");return{header:JSON.parse(Ox(t[0])),payload:JSON.parse(Ox(t[1])),signature:xl(t[2]),raw:{header:t[0],payload:t[1]}}}async function VN(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function GN(n,t){return new Promise((a,o)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){a(d);return}}catch(d){if(!t(u,d)){o(d);return}}})()})}function KN(n){return("0"+n.toString(16)).substr(-2)}function YN(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=i.length;let o="";for(let u=0;u<56;u++)o+=i.charAt(Math.floor(Math.random()*a));return o}return crypto.getRandomValues(t),Array.from(t,KN).join("")}async function WN(n){const i=new TextEncoder().encode(n),a=await crypto.subtle.digest("SHA-256",i),o=new Uint8Array(a);return Array.from(o).map(u=>String.fromCharCode(u)).join("")}async function QN(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const i=await WN(n);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function nl(n,t,i=!1){const a=YN();let o=a;i&&(o+="/PASSWORD_RECOVERY"),await pl(n,`${t}-code-verifier`,o);const u=await QN(a);return[u,a===u?"plain":"s256"]}const JN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function XN(n){const t=n.headers.get(Ap);if(!t||!t.match(JN))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function ZN(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function eE(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const tE=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function rl(n){if(!tE.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Vf(){const n={};return new Proxy(n,{get:(t,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const a=i.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function nE(n,t){return new Proxy(n,{get:(i,a,o)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const u=a.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(i,a,o)}return!t.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(i,a,o)}})}function Dx(n){return JSON.parse(JSON.stringify(n))}const ua=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),rE=[502,503,504];async function Mx(n){var t;if(!HN(n))throw new Rp(ua(n),0);if(rE.includes(n.status))throw new Rp(ua(n),n.status);let i;try{i=await n.json()}catch(u){throw new ha(ua(u),u)}let a;const o=XN(n);if(o&&o.getTime()>=Ob["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?a=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(a=i.error_code),a){if(a==="weak_password")throw new Tx(ua(i),n.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new Rr}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new Tx(ua(i),n.status,i.weak_password.reasons);throw new ON(ua(i),n.status||500,a)}const sE=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(a),Object.assign(Object.assign({},o),i))};async function Dt(n,t,i,a){var o;const u=Object.assign({},a?.headers);u[Ap]||(u[Ap]=Ob["2024-01-01"].name),a?.jwt&&(u.Authorization=`Bearer ${a.jwt}`);const d=(o=a?.query)!==null&&o!==void 0?o:{};a?.redirectTo&&(d.redirect_to=a.redirectTo);const f=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",h=await iE(n,t,i+f,{headers:u,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(h):{data:Object.assign({},h),error:null}}async function iE(n,t,i,a,o,u){const d=sE(t,a,o,u);let f;try{f=await n(i,Object.assign({},d))}catch(h){throw console.error(h),new Rp(ua(h),0)}if(f.ok||await Mx(f),a?.noResolveJson)return f;try{return await f.json()}catch(h){await Mx(h)}}function is(n){var t;let i=null;oE(n)&&(i=Object.assign({},n),n.expires_at||(i.expires_at=PN(n.expires_in)));const a=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:i,user:a},error:null}}function Lx(n){const t=is(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0)&&(t.data.weak_password=n.weak_password),t}function Ri(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function aE(n){return{data:n,error:null}}function lE(n){const{action_link:t,email_otp:i,hashed_token:a,redirect_to:o,verification_type:u}=n,d=jd(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:t,email_otp:i,hashed_token:a,redirect_to:o,verification_type:u},h=Object.assign({},d);return{data:{properties:f,user:h},error:null}}function zx(n){return n}function oE(n){return n.access_token&&n.refresh_token&&n.expires_in}const Gf=["global","local","others"];class cE{constructor({url:t="",headers:i={},fetch:a}){this.url=t,this.headers=i,this.fetch=Lb(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,i=Gf[0]){if(Gf.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Gf.join(", ")}`);try{return await Dt(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(bt(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,i={}){try{return await Dt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:Ri})}catch(a){if(bt(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:i}=t,a=jd(t,["options"]),o=Object.assign(Object.assign({},a),i);return"newEmail"in a&&(o.new_email=a?.newEmail,delete o.newEmail),await Dt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:lE,redirectTo:i?.redirectTo})}catch(i){if(bt(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await Dt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ri})}catch(i){if(bt(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,a,o,u,d,f,h;try{const p={nextPage:null,lastPage:0,total:0},y=await Dt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:zx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,w=(h=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&h!==void 0?h:[];return w.length>0&&(w.forEach(_=>{const C=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(_.split(";")[1].split("=")[1]);p[`${S}Page`]=C}),p.total=parseInt(x)),{data:Object.assign(Object.assign({},v),p),error:null}}catch(p){if(bt(p))return{data:{users:[]},error:p};throw p}}async getUserById(t){rl(t);try{return await Dt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ri})}catch(i){if(bt(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){rl(t);try{return await Dt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:Ri})}catch(a){if(bt(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,i=!1){rl(t);try{return await Dt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:Ri})}catch(a){if(bt(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){rl(t.userId);try{const{data:i,error:a}=await Dt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:i,error:a}}catch(i){if(bt(i))return{data:null,error:i};throw i}}async _deleteFactor(t){rl(t.userId),rl(t.id);try{return{data:await Dt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(bt(i))return{data:null,error:i};throw i}}async _listOAuthClients(t){var i,a,o,u,d,f,h;try{const p={nextPage:null,lastPage:0,total:0},y=await Dt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:zx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,w=(h=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&h!==void 0?h:[];return w.length>0&&(w.forEach(_=>{const C=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(_.split(";")[1].split("=")[1]);p[`${S}Page`]=C}),p.total=parseInt(x)),{data:Object.assign(Object.assign({},v),p),error:null}}catch(p){if(bt(p))return{data:{clients:[]},error:p};throw p}}async _createOAuthClient(t){try{return await Dt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(bt(i))return{data:null,error:i};throw i}}async _getOAuthClient(t){try{return await Dt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(bt(i))return{data:null,error:i};throw i}}async _updateOAuthClient(t,i){try{return await Dt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:i,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(bt(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(t){try{return await Dt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(i){if(bt(i))return{data:null,error:i};throw i}}async _regenerateOAuthClientSecret(t){try{return await Dt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(bt(i))return{data:null,error:i};throw i}}}function Ux(n={}){return{getItem:t=>n[t]||null,setItem:(t,i)=>{n[t]=i},removeItem:t=>{delete n[t]}}}const sl={debug:!!(globalThis&&Mb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class zb extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Ix extends zb{}async function uE(n,t,i){sl.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const a=new globalThis.AbortController;t>0&&setTimeout(()=>{a.abort(),sl.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve();try{return await globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async o=>{if(o){sl.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await i()}finally{sl.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(t===0)throw sl.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Ix(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(sl.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}})}catch(o){throw o?.name==="AbortError"?new Ix(`Acquiring an exclusive Navigator LockManager lock "${n}" timed out waiting ${t}ms`):o}}function dE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Ub(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function hE(n){return parseInt(n,16)}function fE(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,a=>a.toString(16).padStart(2,"0")).join("")}function pE(n){var t;const{chainId:i,domain:a,expirationTime:o,issuedAt:u=new Date,nonce:d,notBefore:f,requestId:h,resources:p,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const w=Ub(n.address),_=y?`${y}://${a}`:a,C=n.statement?`${n.statement}
`:"",S=`${_} wants you to sign in with your Ethereum account:
${w}

${C}`;let N=`URI: ${v}
Version: ${x}
Chain ID: ${i}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(o&&(N+=`
Expiration Time: ${o.toISOString()}`),f&&(N+=`
Not Before: ${f.toISOString()}`),h&&(N+=`
Request ID: ${h}`),p){let T=`
Resources:`;for(const L of p){if(!L||typeof L!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${L}`);T+=`
- ${L}`}N+=T}return`${S}
${N}`}class Hn extends Error{constructor({message:t,code:i,cause:a,name:o}){var u;super(t,{cause:a}),this.__isWebAuthnError=!0,this.name=(u=o??(a instanceof Error?a.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=i}}class sd extends Hn{constructor(t,i){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i,message:t}),this.name="WebAuthnUnknownError",this.originalError=i}}function mE({error:n,options:t}){var i,a,o;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Hn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((i=u.authenticatorSelection)===null||i===void 0?void 0:i.requireResidentKey)===!0)return new Hn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((a=u.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new Hn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((o=u.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Hn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Hn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Hn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(f=>f.type==="public-key").length===0?new Hn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Hn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(Ib(d)){if(u.rp.id!==d)return new Hn({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Hn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Hn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Hn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Hn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function gE({error:n,options:t}){const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Hn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Hn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const a=window.location.hostname;if(Ib(a)){if(i.rpId!==a)return new Hn({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Hn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Hn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Hn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class yE{createNewAbortSignal(){if(this.controller){const i=new Error("Cancelling existing WebAuthn API call for new one");i.name="AbortError",this.controller.abort(i)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const vE=new yE;function xE(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:i,excludeCredentials:a}=n,o=jd(n,["challenge","user","excludeCredentials"]),u=xl(t).buffer,d=Object.assign(Object.assign({},i),{id:xl(i.id).buffer}),f=Object.assign(Object.assign({},o),{challenge:u,user:d});if(a&&a.length>0){f.excludeCredentials=new Array(a.length);for(let h=0;h<a.length;h++){const p=a[h];f.excludeCredentials[h]=Object.assign(Object.assign({},p),{id:xl(p.id).buffer,type:p.type||"public-key",transports:p.transports})}}return f}function bE(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:i}=n,a=jd(n,["challenge","allowCredentials"]),o=xl(t).buffer,u=Object.assign(Object.assign({},a),{challenge:o});if(i&&i.length>0){u.allowCredentials=new Array(i.length);for(let d=0;d<i.length;d++){const f=i[d];u.allowCredentials[d]=Object.assign(Object.assign({},f),{id:xl(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function wE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const i=n;return{id:n.id,rawId:n.id,response:{attestationObject:ma(new Uint8Array(n.response.attestationObject)),clientDataJSON:ma(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function SE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const i=n,a=n.getClientExtensionResults(),o=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:ma(new Uint8Array(o.authenticatorData)),clientDataJSON:ma(new Uint8Array(o.clientDataJSON)),signature:ma(new Uint8Array(o.signature)),userHandle:o.userHandle?ma(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Ib(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Bx(){var n,t;return!!(lr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function jE(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new sd("Browser returned unexpected credential type",t)}:{data:null,error:new sd("Empty credential response",t)}}catch(t){return{data:null,error:mE({error:t,options:n})}}}async function _E(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new sd("Browser returned unexpected credential type",t)}:{data:null,error:new sd("Empty credential response",t)}}catch(t){return{data:null,error:gE({error:t,options:n})}}}const CE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},NE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function id(...n){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),i=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),a={};for(const o of n)if(o)for(const u in o){const d=o[u];if(d!==void 0)if(Array.isArray(d))a[u]=d;else if(i(d))a[u]=d;else if(t(d)){const f=a[u];t(f)?a[u]=id(f,d):a[u]=id(d)}else a[u]=d}return a}function EE(n,t){return id(CE,n,t||{})}function kE(n,t){return id(NE,n,t||{})}class TE{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:i,friendlyName:a,signal:o},u){var d;try{const{data:f,error:h}=await this.client.mfa.challenge({factorId:t,webauthn:i});if(!f)return{data:null,error:h};const p=o??vE.createNewAbortSignal();if(f.webauthn.type==="create"){const{user:y}=f.webauthn.credential_options.publicKey;if(!y.name){const v=a;if(v)y.name=`${y.id}:${v}`;else{const w=(await this.client.getUser()).data.user,_=((d=w?.user_metadata)===null||d===void 0?void 0:d.name)||w?.email||w?.id||"User";y.name=`${y.id}:${_}`}}y.displayName||(y.displayName=y.name)}switch(f.webauthn.type){case"create":{const y=EE(f.webauthn.credential_options.publicKey,u?.create),{data:v,error:x}=await jE({publicKey:y,signal:p});return v?{data:{factorId:t,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:v}},error:null}:{data:null,error:x}}case"request":{const y=kE(f.webauthn.credential_options.publicKey,u?.request),{data:v,error:x}=await _E(Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:y,signal:p}));return v?{data:{factorId:t,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:v}},error:null}:{data:null,error:x}}}}catch(f){return bt(f)?{data:null,error:f}:{data:null,error:new ha("Unexpected error in challenge",f)}}}async _verify({challengeId:t,factorId:i,webauthn:a}){return this.client.mfa.verify({factorId:i,challengeId:t,webauthn:a})}async _authenticate({factorId:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!i)return{data:null,error:new tc("rpId is required for WebAuthn authentication")};try{if(!Bx())return{data:null,error:new ha("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this.challenge({factorId:t,webauthn:{rpId:i,rpOrigins:a},signal:o},{request:u});if(!d)return{data:null,error:f};const{webauthn:h}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:h.type,rpId:i,rpOrigins:a,credential_response:h.credential_response}})}catch(d){return bt(d)?{data:null,error:d}:{data:null,error:new ha("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!i)return{data:null,error:new tc("rpId is required for WebAuthn registration")};try{if(!Bx())return{data:null,error:new ha("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:f};const{data:h,error:p}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:i,rpOrigins:a},signal:o},{create:u});return h?this._verify({factorId:d.id,challengeId:h.challengeId,webauthn:{rpId:i,rpOrigins:a,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:p}}catch(d){return bt(d)?{data:null,error:d}:{data:null,error:new ha("Unexpected error in register",d)}}}}dE();const AE={url:EN,storageKey:kN,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:TN,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function $x(n,t,i){return await i()}const il={};class nc{get jwks(){var t,i;return(i=(t=il[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(t){il[this.storageKey]=Object.assign(Object.assign({},il[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,i;return(i=(t=il[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){il[this.storageKey]=Object.assign(Object.assign({},il[this.storageKey]),{cachedAt:t})}constructor(t){var i,a,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},AE),t);if(this.storageKey=u.storageKey,this.instanceID=(i=nc.nextInstanceID[this.storageKey])!==null&&i!==void 0?i:0,nc.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&lr()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new cE({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=Lb(u.fetch),this.lock=u.lock||$x,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,this.lockAcquireTimeout=u.lockAcquireTimeout,u.lock?this.lock=u.lock:this.persistSession&&lr()&&(!((a=globalThis?.navigator)===null||a===void 0)&&a.locks)?this.lock=uE:this.lock=$x,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new TE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:Mb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ux(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=Ux(this.memoryStorage)),lr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d);try{await this._notifyAllSubscribers(d.data.event,d.data.session,!1)}catch(f){this._debug("#broadcastChannel","error",f)}})}u.skipAutoInitialize||this.initialize().catch(d=>{this._debug("#initialize()","error",d)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Rb}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let i={},a="none";if(lr()&&(i=FN(window.location.href),this._isImplicitGrantCallback(i)?a="implicit":await this._isPKCECallback(i)&&(a="pkce")),lr()&&this.detectSessionInUrl&&a!=="none"){const{data:o,error:u}=await this._getSessionFromURL(i,a);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),MN(u)){const h=(t=u.details)===null||t===void 0?void 0:t.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:u}}return{error:u}}const{session:d,redirectType:f}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",f),await this._saveSession(d),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return bt(i)?this._returnResult({error:i}):this._returnResult({error:new ha("Unexpected error during initialization",i)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,a,o;try{const u=await Dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(i=t?.options)===null||i===void 0?void 0:i.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:is}),{data:d,error:f}=u;if(f||!d)return this._returnResult({data:{user:null,session:null},error:f});const h=d.session,p=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:p,session:h},error:null})}catch(u){if(bt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var i,a,o;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let w=null,_=null;this.flowType==="pkce"&&([w,_]=await nl(this.storage,this.storageKey)),u=await Dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(i=x?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:w,code_challenge_method:_},xform:is})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await Dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(a=x?.data)!==null&&a!==void 0?a:{},channel:(o=x?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:is})}else throw new Au("You must provide either an email or phone number and a password");const{data:d,error:f}=u;if(f||!d)return await ar(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:f});const h=d.session,p=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:p,session:h},error:null})}catch(u){if(await ar(this.storage,`${this.storageKey}-code-verifier`),bt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let i;if("email"in t){const{email:u,password:d,options:f}=t;i=await Dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Lx})}else if("phone"in t){const{phone:u,password:d,options:f}=t;i=await Dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Lx})}else throw new Au("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!a||!a.session||!a.user){const u=new tl;return this._returnResult({data:{user:null,session:null},error:u})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:o})}catch(i){if(bt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOAuth(t){var i,a,o,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:i}=t;switch(i){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(t){var i,a,o,u,d,f,h,p,y,v,x;let w,_;if("message"in t)w=t.message,_=t.signature;else{const{chain:C,wallet:S,statement:N,options:T}=t;let L;if(lr())if(typeof S=="object")L=S;else{const M=window;if("ethereum"in M&&typeof M.ethereum=="object"&&"request"in M.ethereum&&typeof M.ethereum.request=="function")L=M.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!T?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");L=S}const R=new URL((i=T?.url)!==null&&i!==void 0?i:window.location.href),J=await L.request({method:"eth_requestAccounts"}).then(M=>M).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!J||J.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const H=Ub(J[0]);let V=(a=T?.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!V){const M=await L.request({method:"eth_chainId"});V=hE(M)}const k={domain:R.host,address:H,statement:N,uri:R.href,version:"1",chainId:V,nonce:(o=T?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(u=T?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(f=T?.signInWithEthereum)===null||f===void 0?void 0:f.expirationTime,notBefore:(h=T?.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(p=T?.signInWithEthereum)===null||p===void 0?void 0:p.requestId,resources:(y=T?.signInWithEthereum)===null||y===void 0?void 0:y.resources};w=pE(k),_=await L.request({method:"personal_sign",params:[fE(w),H]})}try{const{data:C,error:S}=await Dt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:w,signature:_},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:is});if(S)throw S;if(!C||!C.session||!C.user){const N=new tl;return this._returnResult({data:{user:null,session:null},error:N})}return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",C.session)),this._returnResult({data:Object.assign({},C),error:S})}catch(C){if(bt(C))return this._returnResult({data:{user:null,session:null},error:C});throw C}}async signInWithSolana(t){var i,a,o,u,d,f,h,p,y,v,x,w;let _,C;if("message"in t)_=t.message,C=t.signature;else{const{chain:S,wallet:N,statement:T,options:L}=t;let R;if(lr())if(typeof N=="object")R=N;else{const H=window;if("solana"in H&&typeof H.solana=="object"&&("signIn"in H.solana&&typeof H.solana.signIn=="function"||"signMessage"in H.solana&&typeof H.solana.signMessage=="function"))R=H.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!L?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");R=N}const J=new URL((i=L?.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in R&&R.signIn){const H=await R.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},L?.signInWithSolana),{version:"1",domain:J.host,uri:J.href}),T?{statement:T}:null));let V;if(Array.isArray(H)&&H[0]&&typeof H[0]=="object")V=H[0];else if(H&&typeof H=="object"&&"signedMessage"in H&&"signature"in H)V=H;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in V&&"signature"in V&&(typeof V.signedMessage=="string"||V.signedMessage instanceof Uint8Array)&&V.signature instanceof Uint8Array)_=typeof V.signedMessage=="string"?V.signedMessage:new TextDecoder().decode(V.signedMessage),C=V.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in R)||typeof R.signMessage!="function"||!("publicKey"in R)||typeof R!="object"||!R.publicKey||!("toBase58"in R.publicKey)||typeof R.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${J.host} wants you to sign in with your Solana account:`,R.publicKey.toBase58(),...T?["",T,""]:[""],"Version: 1",`URI: ${J.href}`,`Issued At: ${(o=(a=L?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((u=L?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${L.signInWithSolana.notBefore}`]:[],...!((d=L?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${L.signInWithSolana.expirationTime}`]:[],...!((f=L?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${L.signInWithSolana.chainId}`]:[],...!((h=L?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${L.signInWithSolana.nonce}`]:[],...!((p=L?.signInWithSolana)===null||p===void 0)&&p.requestId?[`Request ID: ${L.signInWithSolana.requestId}`]:[],...!((v=(y=L?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...L.signInWithSolana.resources.map(V=>`- ${V}`)]:[]].join(`
`);const H=await R.signMessage(new TextEncoder().encode(_),"utf8");if(!H||!(H instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");C=H}}try{const{data:S,error:N}=await Dt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:ma(C)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(w=t.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:is});if(N)throw N;if(!S||!S.session||!S.user){const T=new tl;return this._returnResult({data:{user:null,session:null},error:T})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:N})}catch(S){if(bt(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(t){const i=await sa(this.storage,`${this.storageKey}-code-verifier`),[a,o]=(i??"").split("/");try{if(!a&&this.flowType==="pkce")throw new LN;const{data:u,error:d}=await Dt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:is});if(await ar(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const f=new tl;return this._returnResult({data:{user:null,session:null,redirectType:null},error:f})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:o??null}),error:d})}catch(u){if(await ar(this.storage,`${this.storageKey}-code-verifier`),bt(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:i,provider:a,token:o,access_token:u,nonce:d}=t,f=await Dt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:o,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:is}),{data:h,error:p}=f;if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!h||!h.session||!h.user){const y=new tl;return this._returnResult({data:{user:null,session:null},error:y})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:p})}catch(i){if(bt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOtp(t){var i,a,o,u,d;try{if("email"in t){const{email:f,options:h}=t;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await nl(this.storage,this.storageKey));const{error:v}=await Dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(i=h?.data)!==null&&i!==void 0?i:{},create_user:(a=h?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:p,code_challenge_method:y},redirectTo:h?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:f,options:h}=t,{data:p,error:y}=await Dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(o=h?.data)!==null&&o!==void 0?o:{},create_user:(u=h?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(d=h?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:p?.message_id},error:y})}throw new Au("You must provide either an email or phone number.")}catch(f){if(await ar(this.storage,`${this.storageKey}-code-verifier`),bt(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async verifyOtp(t){var i,a;try{let o,u;"options"in t&&(o=(i=t.options)===null||i===void 0?void 0:i.redirectTo,u=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:d,error:f}=await Dt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:o,xform:is});if(f)throw f;if(!d)throw new Error("An error occurred on token verification.");const h=d.session,p=d.user;return h?.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:p,session:h},error:null})}catch(o){if(bt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var i,a,o,u,d;try{let f=null,h=null;this.flowType==="pkce"&&([f,h]=await nl(this.storage,this.storageKey));const p=await Dt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&a!==void 0?a:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:h}),headers:this.headers,xform:aE});return!((u=p.data)===null||u===void 0)&&u.url&&lr()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(p.data.url),this._returnResult(p)}catch(f){if(await ar(this.storage,`${this.storageKey}-code-verifier`),bt(f))return this._returnResult({data:null,error:f});throw f}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;if(a)throw a;if(!i)throw new Rr;const{error:o}=await Dt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(bt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:a,type:o,options:u}=t,{error:d}=await Dt(this.fetch,"POST",i,{headers:this.headers,body:{email:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:a,type:o,options:u}=t,{data:d,error:f}=await Dt(this.fetch,"POST",i,{headers:this.headers,body:{phone:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:f})}throw new Au("You must provide either an email or phone number and a type")}catch(i){if(bt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await a,await i()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=i();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await sa(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at*1e3-Date.now()<qf:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.userStorage){const d=await sa(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=Vf()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=nE(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const i=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return i.data.user&&(this.suppressGetSessionWarning=!0),i}async _getUser(t){try{return t?await Dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ri}):await this._useSession(async i=>{var a,o,u;const{data:d,error:f}=i;if(f)throw f;return!(!((a=d.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Rr}:await Dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:void 0,xform:Ri})})}catch(i){if(bt(i))return Ff(i)&&(await this._removeSession(),await ar(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:i});throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async a=>{const{data:o,error:u}=a;if(u)throw u;if(!o.session)throw new Rr;const d=o.session;let f=null,h=null;this.flowType==="pkce"&&t.email!=null&&([f,h]=await nl(this.storage,this.storageKey));const{data:p,error:y}=await Dt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:f,code_challenge_method:h}),jwt:d.access_token,xform:Ri});if(y)throw y;return d.user=p.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(a){if(await ar(this.storage,`${this.storageKey}-code-verifier`),bt(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Rr;const i=Date.now()/1e3;let a=i,o=!0,u=null;const{payload:d}=Ou(t.access_token);if(d.exp&&(a=d.exp,o=a<=i),o){const{data:f,error:h}=await this._callRefreshToken(t.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!f)return{data:{user:null,session:null},error:null};u=f}else{const{data:f,error:h}=await this._getUser(t.access_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});u={access_token:t.access_token,refresh_token:t.refresh_token,user:f.user,token_type:"bearer",expires_in:a-i,expires_at:a},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(i){if(bt(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var a;if(!t){const{data:d,error:f}=i;if(f)throw f;t=(a=d.session)!==null&&a!==void 0?a:void 0}if(!t?.refresh_token)throw new Rr;const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(i){if(bt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async _getSessionFromURL(t,i){try{if(!lr())throw new Ru("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Ru(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new kx("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ru("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new kx("No code detected.");const{data:T,error:L}=await this._exchangeCodeForSession(t.code);if(L)throw L;const R=new URL(window.location.href);return R.searchParams.delete("code"),window.history.replaceState(window.history.state,"",R.toString()),{data:{session:T.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:o,access_token:u,refresh_token:d,expires_in:f,expires_at:h,token_type:p}=t;if(!u||!f||!d||!p)throw new Ru("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(f);let x=y+v;h&&(x=parseInt(h));const w=x-y;w*1e3<=fl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${w}s, should have been closer to ${v}s`);const _=x-v;y-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,x,y):y-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,x,y);const{data:C,error:S}=await this._getUser(u);if(S)throw S;const N={provider_token:a,provider_refresh_token:o,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:p,user:C.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:N,redirectType:t.type},error:null})}catch(a){if(bt(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await sa(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u&&!Ff(u))return this._returnResult({error:u});const d=(a=o.session)===null||a===void 0?void 0:a.access_token;if(d){const{error:f}=await this.admin.signOut(d,t);if(f&&!(DN(f)&&(f.status===404||f.status===401||f.status===403)||Ff(f)))return this._returnResult({error:f})}return t!=="others"&&(await this._removeSession(),await ar(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const i=qN(),a={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,a),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async i=>{var a,o;try{const{data:{session:u},error:d}=i;if(d)throw d;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,i={}){let a=null,o=null;this.flowType==="pkce"&&([a,o]=await nl(this.storage,this.storageKey,!0));try{return await Dt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:o,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(u){if(await ar(this.storage,`${this.storageKey}-code-verifier`),bt(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:i,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(i){if(bt(i))return this._returnResult({data:null,error:i});throw i}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var i;try{const{data:a,error:o}=await this._useSession(async u=>{var d,f,h,p,y;const{data:v,error:x}=u;if(x)throw x;const w=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(f=t.options)===null||f===void 0?void 0:f.scopes,queryParams:(h=t.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await Dt(this.fetch,"GET",w,{headers:this.headers,jwt:(y=(p=v.session)===null||p===void 0?void 0:p.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return lr()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(a?.url),this._returnResult({data:{provider:t.provider,url:a?.url},error:null})}catch(a){if(bt(a))return this._returnResult({data:{provider:t.provider,url:null},error:a});throw a}}async linkIdentityIdToken(t){return await this._useSession(async i=>{var a;try{const{error:o,data:{session:u}}=i;if(o)throw o;const{options:d,provider:f,token:h,access_token:p,nonce:y}=t,v=await Dt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=u?.access_token)!==null&&a!==void 0?a:void 0,body:{provider:f,id_token:h,access_token:p,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:is}),{data:x,error:w}=v;return w?this._returnResult({data:{user:null,session:null},error:w}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new tl}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:w}))}catch(o){if(await ar(this.storage,`${this.storageKey}-code-verifier`),bt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async i=>{var a,o;const{data:u,error:d}=i;if(d)throw d;return await Dt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(a=u.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0})})}catch(i){if(bt(i))return this._returnResult({data:null,error:i});throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const a=Date.now();return await GN(async o=>(o>0&&await VN(200*Math.pow(2,o-1)),this._debug(i,"refreshing attempt",o),await Dt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:is})),(o,u)=>{const d=200*Math.pow(2,o);return u&&Hf(u)&&Date.now()+d-a<fl})}catch(a){if(this._debug(i,"error",a),bt(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",a),lr()&&!i.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t,i;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const o=await sa(this.storage,this.storageKey);if(o&&this.userStorage){let d=await sa(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await pl(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d?.user)!==null&&t!==void 0?t:Vf()}else if(o&&!o.user&&!o.user){const d=await sa(this.storage,this.storageKey+"-user");d&&d?.user?(o.user=d.user,await ar(this.storage,this.storageKey+"-user"),await pl(this.storage,this.storageKey,o)):o.user=Vf()}if(this._debug(a,"session from storage",o),!this._isValidSession(o)){this._debug(a,"session is not valid"),o!==null&&await this._removeSession();return}const u=((i=o.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<qf;if(this._debug(a,`session has${u?"":" not"} expired with margin of ${qf}s`),u){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),Hf(d)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:f}=await this._getUser(o.access_token);!f&&d?.user?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(a,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(a,"error",o),console.error(o);return}finally{this._debug(a,"end")}}async _callRefreshToken(t){var i,a;if(!t)throw new Rr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Nd;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new Rr;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const f={data:u.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(u){if(this._debug(o,"error",u),bt(u)){const d={data:null,error:u};return Hf(u)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(d),d}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(u),u}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,i,a=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",i,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:i});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(t,i)}catch(h){u.push(h)}});if(await Promise.all(d),u.length>0){for(let f=0;f<u.length;f+=1)console.error(u[f]);throw u[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await ar(this.storage,`${this.storageKey}-code-verifier`);const i=Object.assign({},t),a=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&i.user&&await pl(this.userStorage,this.storageKey+"-user",{user:i.user});const o=Object.assign({},i);delete o.user;const u=Dx(o);await pl(this.storage,this.storageKey,u)}else{const o=Dx(i);await pl(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ar(this.storage,this.storageKey),await ar(this.storage,this.storageKey+"-code-verifier"),await ar(this.storage,this.storageKey+"-user"),this.userStorage&&await ar(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&lr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),fl);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const i=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=i,i&&typeof i=="object"&&typeof i.unref=="function"?i.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(i)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const i=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,i&&clearTimeout(i)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:a}}=i;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((a.expires_at*1e3-t)/fl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${fl}ms, refresh threshold is ${Tp} ticks`),o<=Tp&&await this._callRefreshToken(a.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof zb)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!lr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,a){const o=[`provider=${encodeURIComponent(i)}`];if(a?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&o.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[u,d]=await nl(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(f.toString())}if(a?.queryParams){const u=new URLSearchParams(a.queryParams);o.push(u.toString())}return a?.skipBrowserRedirect&&o.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;return u?this._returnResult({data:null,error:u}):await Dt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token})})}catch(i){if(bt(i))return this._returnResult({data:null,error:i});throw i}}async _enroll(t){try{return await this._useSession(async i=>{var a,o;const{data:u,error:d}=i;if(d)return this._returnResult({data:null,error:d});const f=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:h,error:p}=await Dt(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(a=u?.session)===null||a===void 0?void 0:a.access_token});return p?this._returnResult({data:null,error:p}):(t.factorType==="totp"&&h.type==="totp"&&(!((o=h?.totp)===null||o===void 0)&&o.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(i){if(bt(i))return this._returnResult({data:null,error:i});throw i}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?wE(t.webauthn.credential_response):SE(t.webauthn.credential_response)})}:{code:t.code}),{data:f,error:h}=await Dt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+f.expires_in},f)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",f),this._returnResult({data:f,error:h}))})}catch(i){if(bt(i))return this._returnResult({data:null,error:i});throw i}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({data:null,error:u});const d=await Dt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});if(d.error)return d;const{data:f}=d;if(f.type!=="webauthn")return{data:f,error:null};switch(f.webauthn.type){case"create":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:xE(f.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:bE(f.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(i){if(bt(i))return this._returnResult({data:null,error:i});throw i}})}async _challengeAndVerify(t){const{data:i,error:a}=await this._challenge({factorId:t.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){var t;const{data:{user:i},error:a}=await this.getUser();if(a)return{data:null,error:a};const o={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=i?.factors)!==null&&t!==void 0?t:[])o.all.push(u),u.status==="verified"&&o[u.factor_type].push(u);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(t){var i,a,o,u;if(t)try{const{payload:w}=Ou(t);let _=null;w.aal&&(_=w.aal);let C=_;const{data:{user:S},error:N}=await this.getUser(t);if(N)return this._returnResult({data:null,error:N});((a=(i=S?.factors)===null||i===void 0?void 0:i.filter(R=>R.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(C="aal2");const L=w.amr||[];return{data:{currentLevel:_,nextLevel:C,currentAuthenticationMethods:L},error:null}}catch(w){if(bt(w))return this._returnResult({data:null,error:w});throw w}const{data:{session:d},error:f}=await this.getSession();if(f)return this._returnResult({data:null,error:f});if(!d)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:h}=Ou(d.access_token);let p=null;h.aal&&(p=h.aal);let y=p;((u=(o=d.user.factors)===null||o===void 0?void 0:o.filter(w=>w.status==="verified"))!==null&&u!==void 0?u:[]).length>0&&(y="aal2");const x=h.amr||[];return{data:{currentLevel:p,nextLevel:y,currentAuthenticationMethods:x},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;return o?this._returnResult({data:null,error:o}):a?await Dt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:a.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Rr})})}catch(i){if(bt(i))return this._returnResult({data:null,error:i});throw i}}async _approveAuthorization(t,i){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Rr});const d=await Dt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&lr()&&!i?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(bt(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(t,i){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Rr});const d=await Dt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&lr()&&!i?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(bt(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;return a?this._returnResult({data:null,error:a}):i?await Dt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Rr})})}catch(t){if(bt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;return o?this._returnResult({data:null,error:o}):a?(await Dt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Rr})})}catch(i){if(bt(i))return this._returnResult({data:null,error:i});throw i}}async fetchJwk(t,i={keys:[]}){let a=i.keys.find(f=>f.kid===t);if(a)return a;const o=Date.now();if(a=this.jwks.keys.find(f=>f.kid===t),a&&this.jwks_cached_at+RN>o)return a;const{data:u,error:d}=await Dt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=o,a=u.keys.find(f=>f.kid===t),!a)?null:a}async getClaims(t,i={}){try{let a=t;if(!a){const{data:w,error:_}=await this.getSession();if(_||!w.session)return this._returnResult({data:null,error:_});a=w.session.access_token}const{header:o,payload:u,signature:d,raw:{header:f,payload:h}}=Ou(a);i?.allowExpired||ZN(u.exp);const p=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,i?.keys?{keys:i.keys}:i?.jwks);if(!p){const{error:w}=await this.getUser(a);if(w)throw w;return{data:{claims:u,header:o,signature:d},error:null}}const y=eE(o.alg),v=await crypto.subtle.importKey("jwk",p,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,$N(`${f}.${h}`)))throw new Op("Invalid JWT signature");return{data:{claims:u,header:o,signature:d},error:null}}catch(a){if(bt(a))return this._returnResult({data:null,error:a});throw a}}}nc.nextInstanceID={};const RE=nc,OE="2.97.0";let Io="";typeof Deno<"u"?Io="deno":typeof document<"u"?Io="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Io="react-native":Io="node";const DE={"X-Client-Info":`supabase-js-${Io}/${OE}`},ME={headers:DE},LE={schema:"public"},zE={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},UE={};function rc(n){"@babel/helpers - typeof";return rc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rc(n)}function IE(n,t){if(rc(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(rc(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function BE(n){var t=IE(n,"string");return rc(t)=="symbol"?t:t+""}function $E(n,t,i){return(t=BE(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function Px(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function Mn(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Px(Object(i),!0).forEach(function(a){$E(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):Px(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}const PE=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),qE=()=>Headers,FE=(n,t,i)=>{const a=PE(i),o=qE();return async(u,d)=>{var f;const h=(f=await t())!==null&&f!==void 0?f:n;let p=new o(d?.headers);return p.has("apikey")||p.set("apikey",n),p.has("Authorization")||p.set("Authorization",`Bearer ${h}`),a(u,Mn(Mn({},d),{},{headers:p}))}};function HE(n){return n.endsWith("/")?n:n+"/"}function VE(n,t){var i,a;const{db:o,auth:u,realtime:d,global:f}=n,{db:h,auth:p,realtime:y,global:v}=t,x={db:Mn(Mn({},h),o),auth:Mn(Mn({},p),u),realtime:Mn(Mn({},y),d),storage:{},global:Mn(Mn(Mn({},v),f),{},{headers:Mn(Mn({},(i=v?.headers)!==null&&i!==void 0?i:{}),(a=f?.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function GE(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(HE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var KE=class extends RE{constructor(n){super(n)}},YE=class{constructor(n,t,i){var a,o;this.supabaseUrl=n,this.supabaseKey=t;const u=GE(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,f={db:LE,realtime:UE,auth:Mn(Mn({},zE),{},{storageKey:d}),global:ME},h=VE(i??{},f);if(this.storageKey=(a=h.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken)this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var p;this.auth=this._initSupabaseAuthClient((p=h.auth)!==null&&p!==void 0?p:{},this.headers,h.global.fetch)}this.fetch=FE(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Mn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new DC(new URL("rest/v1",u).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch,timeout:h.db.timeout,urlLengthLimit:h.db.urlLengthLimit}),this.storage=new NN(this.storageUrl.href,this.headers,this.fetch,i?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new CC(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,i)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,i;if(n.accessToken)return await n.accessToken();const{data:a}=await n.auth.getSession();return(t=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:i,storage:a,userStorage:o,storageKey:u,flowType:d,lock:f,debug:h,throwOnError:p},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new KE({url:this.authUrl.href,headers:Mn(Mn({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:i,storage:a,userStorage:o,flowType:d,lock:f,debug:h,throwOnError:p,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(w=>w.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new QC(this.realtimeUrl.href,Mn(Mn({},n),{},{params:Mn(Mn({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,i){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const WE=(n,t,i)=>new YE(n,t,i);function QE(){if(typeof window<"u")return!1;const n=globalThis.process;if(!n)return!1;const t=n.version;if(t==null)return!1;const i=t.match(/^v(\d+)\./);return i?parseInt(i[1],10)<=18:!1}QE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Kf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var JE={};const Bb=n=>{if(typeof import.meta<"u"&&Kf&&Kf[n])return Kf[n];const t=JE;return t&&t[n]?t[n]:null},$b=Bb("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",Pb=Bb("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",Go=$b,Vu=Pb,Ee=WE($b,Pb),XE=2,Yf=n=>{if(typeof n!="string")return!1;const t=n.trim();return t?!/^[\d-\s.,+\-/%~]+$/.test(t):!1},qx={async translateRecipe(n,t="EN-US"){const i=[],a=[],o=(h,p)=>{const y=typeof h=="string"?h:String(h??"");i.push(y),a.push((v,x)=>{p(x,v||y,y)})},u=h=>Array.isArray(h)?h.map(p=>p&&typeof p=="object"?{...p}:p):h,d={...n,ingredients:u(n.ingredients),flours:u(n.flours),breadIngredients:u(n.breadIngredients),steps:u(n.steps),ingredientGroups:u(n.ingredientGroups),stepGroups:u(n.stepGroups)};if(o(n.title||n.name||"",(h,p)=>{h.title=p,(h.name!==void 0||n.name!==void 0)&&(h.name=p)}),o(n.description||"",(h,p)=>{h.description=p}),n.course&&o(n.course,(h,p)=>{h.course=p}),n.category&&o(n.category,(h,p)=>{h.category=p}),n.storeName&&o(n.storeName,(h,p)=>{h.storeName=p}),Array.isArray(n.ingredientGroups)&&n.ingredientGroups.forEach((h,p)=>{const y=h?.name;y&&o(y,(v,x)=>{v.ingredientGroups?.[p]&&(v.ingredientGroups[p].name=x)})}),Array.isArray(n.stepGroups)&&n.stepGroups.forEach((h,p)=>{const y=h?.name;y&&o(y,(v,x)=>{v.stepGroups?.[p]&&(v.stepGroups[p].name=x)})}),n.type==="bread"?((n.flours||[]).forEach((h,p)=>{!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.flours?.[p]&&(y.flours[p].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.flours?.[p]&&(y.flours[p].unit=v)}),Yf(h.quantity)&&o(h.quantity,(y,v)=>{y.flours?.[p]&&(y.flours[p].quantity=v)}))}),(n.breadIngredients||[]).forEach((h,p)=>{!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.breadIngredients?.[p]&&(y.breadIngredients[p].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.breadIngredients?.[p]&&(y.breadIngredients[p].unit=v)}),Yf(h.quantity)&&o(h.quantity,(y,v)=>{y.breadIngredients?.[p]&&(y.breadIngredients[p].quantity=v)}))})):(n.ingredients||[]).forEach((h,p)=>{if(typeof h=="string"){o(h,(y,v)=>{Array.isArray(y.ingredients)&&(y.ingredients[p]=v)});return}!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.ingredients?.[p]&&typeof y.ingredients[p]=="object"&&(y.ingredients[p].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.ingredients?.[p]&&typeof y.ingredients[p]=="object"&&(y.ingredients[p].unit=v)}),Yf(h.quantity)&&o(h.quantity,(y,v)=>{y.ingredients?.[p]&&typeof y.ingredients[p]=="object"&&(y.ingredients[p].quantity=v)}))}),(n.steps||[]).forEach((h,p)=>{const y=typeof h=="object"&&h!==null?h.text||"":h||"";o(y,(v,x)=>{const w=v.steps?.[p];if(typeof w=="object"&&w!==null){w.text=x;return}Array.isArray(v.steps)&&(v.steps[p]=x)})}),!i.some(h=>String(h||"").trim().length>0))return n;try{const h=await this.translateList(i,t);return a.forEach((p,y)=>{p(h[y],d)}),d.__translationVersion=XE,d}catch(h){throw console.error("Translation failed:",h),h}},async translateList(n,t){const i=(n||[]).map(p=>typeof p=="string"?p:String(p??""));if(!i.some(p=>p.trim().length>0))return i;const a=`${Go}/functions/v1/translate`,o=async p=>await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:Vu,Authorization:`Bearer ${p}`},body:JSON.stringify({text:i,target_lang:t})}),u=async()=>{const{data:p}=await Ee.auth.getSession();if(p?.session?.access_token)return p.session.access_token;const{data:y,error:v}=await Ee.auth.refreshSession();if(v||!y?.session?.access_token){const x=v?.message||"",w=/refresh_token|session|expired|invalid|not found/i.test(x);throw new Error(w?"":x||"")}return y.session.access_token};let d=await u(),f=await o(d);if(f.status===401&&(d=await u(),f=await o(d)),!f.ok){const p=f.status;let y="";try{const v=await f.text();if(v)try{const x=JSON.parse(v);y=x?.error||x?.message||v}catch{y=v}}catch{}throw new Error(y||`Translation Error (${p})`)}const h=await f.json();if(h&&h.error)throw console.error("Edge Function returned error:",h.error),new Error(`Translation Error: ${h.error}`);if(!Array.isArray(h?.translations))throw console.error("Edge Function returned invalid payload:",h),new Error("Translation Error: invalid response payload");return h.translations.map(p=>p.text)}},Wt=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},Du=async(n,t,i)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${i||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},Gu=n=>{if(Array.isArray(n))return n.map(i=>String(i)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const i=t.slice(1,-1);return i?i.split(",").map(a=>a.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},ZE=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],i=Object.values(t)[0];return Gu(i)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return Gu(t)}return Gu(n)},qb=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const i=Gu(t);return i.length>0?i:t.split(",").map(a=>a.trim()).filter(Boolean)}return[]},Fx=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),i=String(n.message||"").toLowerCase(),a=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||i.includes("row-level security")||i.includes("permission denied")||i.includes("violates row-level security")||i.includes("invalid input syntax")||i.includes("column")||a.includes("row-level security")?!1:i.includes("failed to fetch")||i.includes("network")||i.includes("timeout")||i.includes("timed out")||i.includes("load failed")},Fb="recipe_list_cache",ek=300*1e3,Wf=(n,t)=>{try{const i=(n||[]).map(a=>({id:a.id,title:a.title,description:a.description,image:a.image,servings:a.servings,course:a.course,category:a.category,storeName:a.storeName,store_name:a.store_name,tags:a.tags,created_at:a.created_at,updated_at:a.updated_at,type:a.type,sourceUrl:a.sourceUrl}));localStorage.setItem(Fb,JSON.stringify({userId:t,updatedAt:Date.now(),recipes:i}))}catch{}},tk=n=>{try{const t=localStorage.getItem(Fb);if(!t)return null;const i=JSON.parse(t);return i.userId!==n||Date.now()-i.updatedAt>ek?null:i.recipes||null}catch{return null}},Sn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(n){return tk(n)},saveCachedRecipes(n,t){Wf(n,t)},async _resolveShowMasterPreference(n,t=15e3){const i=n?.showMasterRecipes===!0,a=n?.id;if(!a)return i;const o=this._showMasterPrefCache.get(a),u=Date.now();if(o&&o.value!==i)return this._showMasterPrefCache.set(a,{value:i,updatedAt:u}),i;if(o&&u-o.updatedAt<3e4)return o.value;try{const{data:d,error:f}=await Du(Ee.from("profiles").select("show_master_recipes").eq("id",a).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(f)throw f;const h=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(a,{value:h,updatedAt:u}),h}catch{return this._showMasterPrefCache.set(a,{value:i,updatedAt:u}),i}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:i,error:a}=await Du(Ee.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(a)throw a;const o=ZE(i),u=new Set(o.length>0?o:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const i=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:i,updatedAt:t},i}},async fetchRecipes(n,{timeoutMs:t=15e3,includeIngredients:i=!0,includeSources:a=!0,offset:o=0,limit:u=null,skipCacheSave:d=!1,returnMeta:f=!1}={}){if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const h=n.role==="admin",p=h?Promise.resolve(!1):this._resolveShowMasterPreference(n,t),y=Number.isInteger(o)&&o>=0?o:0,v=Number.isInteger(u)&&u>0?u:null;let x=0,w=[];const _=async(U,{withOrderIndex:F,queryTimeoutMs:Y})=>{let $=Ee.from("recipes").select(U);F?$=$.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):$=$.order("created_at",{ascending:!1}),v!=null&&($=$.range(y,y+v-1));const{data:P,error:E}=await Du($,Y,"recipes.select(list)");if(E)throw E;return x=Array.isArray(P)?P.length:0,(P||[]).map(as)},C=i?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`,S=i?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${a?",recipe_sources(url)":""}`,N=i?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",T=i?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let L=null;const R=`recipe_query_pattern:${i?"ing":"noing"}:${a?"src":"nosrc"}`,J=this._queryPatternCache.get(R),H=Math.max(2500,t);if(J)try{w=await _(J.spec,{withOrderIndex:J.withOrderIndex,queryTimeoutMs:H})}catch(U){console.warn("Cached query pattern failed, re-detecting...",U),this._queryPatternCache.delete(R),L=U}else{const F=Math.max(2500,Math.round(t/(i?[C,S,N,T]:[C,S,T]).length));try{w=await _(C,{withOrderIndex:!0,queryTimeoutMs:F}),this._queryPatternCache.set(R,{spec:C,withOrderIndex:!0})}catch(Y){L=Y;try{w=await _(S,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(R,{spec:S,withOrderIndex:!1})}catch($){L=$;try{w=await _(N,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(R,{spec:N,withOrderIndex:!1})}catch(P){L=P;try{w=await _(T,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(R,{spec:T,withOrderIndex:!1})}catch(E){L=E,w=[]}}}}}if(w.length===0&&L)try{const U=localStorage.getItem("local_recipes");if(U){const F=JSON.parse(U).map(Y=>typeof as=="function"?as(Y):Y);w=v!=null?F.slice(y,y+v):F,x=w.length}else throw L}catch{throw L}if(h)return d||Wf(w,n.id),f?{recipes:w,hasMoreRaw:v!=null?x===v:!1}:w;const V=[String(n.id)];n.displayId&&V.push(String(n.displayId));const k=await p,M=k?await this._resolveMasterOwnerTags(t):new Set,z=w.filter(U=>{const F=qb(U.tags),Y=F.filter(B=>B&&B.startsWith("owner:"));if(Y.length===0)return!0;const $=Y.some(B=>M.has(B));if(k&&$)return!0;const P=Y.some(B=>V.some(q=>B===`owner:${q}`)),E=F.includes("public");return!!(P||E)});return d||Wf(z,n.id),f?{recipes:z,hasMoreRaw:v!=null?x===v:!1}:z},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),a=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:o}=await Ee.storage.from("recipe-images").upload(a,n);if(o)throw o;const{data:u}=Ee.storage.from("recipe-images").getPublicUrl(a);return u.publicUrl},async getRecipe(n){try{const{data:t,error:i}=await Du(Ee.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(i)throw i;return as(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const i=localStorage.getItem("local_recipes");if(i){const o=JSON.parse(i).find(u=>u.id==n);if(o)return as(o)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:i,created_at:a,sourceUrl:o,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const h=(u.tags||[]).filter(p=>!p.startsWith("owner:"));u.tags=[...h,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=Mu(u);try{const{data:f,error:h}=await Ee.from("recipes").insert([d]).select().single();if(h)throw h;if(o){const{error:p}=await Ee.from("recipe_sources").insert([{recipe_id:f.id,url:o}]);p&&console.error("Failed to save source URL:",p)}return as({...f,recipe_sources:o?[{url:o}]:[]})}catch(f){if(!Fx(f))throw f;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",f);const h=Date.now(),p={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=Mu(p);y.id=h,y.created_at=p.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),f}return as(y)}},async updateRecipe(n){const{id:t,created_at:i,sourceUrl:a,...o}=n;o.image instanceof File&&(o.image=await this.uploadImage(o.image));const u=Mu(o);o.steps===void 0&&delete u.steps,o.tags===void 0&&delete u.tags,o.ingredients!==void 0||o.type!==void 0||o.ingredientGroups!==void 0||o.flours!==void 0||o.breadIngredients!==void 0||o.stepGroups!==void 0||delete u.ingredients;try{const{data:f,error:h}=await Ee.from("recipes").update(u).eq("id",n.id).select().single();if(h)throw h;if(a!==void 0&&(await Ee.from("recipe_sources").delete().eq("recipe_id",n.id),a)){const{error:p}=await Ee.from("recipe_sources").insert([{recipe_id:n.id,url:a}]);p&&console.error("Failed to update source URL:",p)}return as({...f,recipe_sources:a?[{url:a}]:[]})}catch(f){if(!Fx(f))throw f;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",f);const h=localStorage.getItem("local_recipes");if(h){let p=JSON.parse(h);const y=p.findIndex(v=>v.id==n.id);if(y!==-1){const v={...p[y],...u,updated_at:new Date().toISOString()};return p[y]=v,localStorage.setItem("local_recipes",JSON.stringify(p)),as(v)}}throw f}},async duplicateRecipe(n,t){const{id:i,created_at:a,updated_at:o,image:u,...d}=n;d.title=`${d.title} ()`;let f=null;if(u)try{const h=u.split("/").pop(),p=`copy-${Date.now()}-${h}`,{error:y}=await Ee.storage.from("recipe-images").copy(h,p);if(y)console.warn("Image copy failed, using original URL:",y),f=u;else{const{data:v}=Ee.storage.from("recipe-images").getPublicUrl(p);f=v.publicUrl}}catch(h){console.warn("Image copy logic error:",h),f=u}return d.image=f,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await Ee.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(nk)},async getDeletedCount(){const{count:n,error:t}=await Ee.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:i}=await Ee.from("recipes").select("*").eq("id",n).single();if(i)throw i;const{error:a}=await Ee.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Ee.from("recipes").delete().eq("id",n);if(o)throw o;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const i=localStorage.getItem("local_recipes");if(i){let a=JSON.parse(i);const o=a.length;if(a=a.filter(u=>u.id!=n),a.length<o)return localStorage.setItem("local_recipes",JSON.stringify(a)),!0}throw t}},async restoreRecipe(n){const{data:t,error:i}=await Ee.from("deleted_recipes").select("*").eq("id",n).single();if(i)throw i;const{error:a}=await Ee.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Ee.from("deleted_recipes").delete().eq("id",n);if(o)throw o;return!0},async hardDeleteRecipe(n){const{error:t}=await Ee.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await Ee.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(i=>i.recipe_id)},async addToHistory(n){const{error:t}=await Ee.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(i=>Ee.from("recipes").update({order_index:i.order_index}).eq("id",i.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,i=[];for(const a of n)try{await this.createRecipe(a),t++}catch(o){console.error("Import failed for recipe:",a.title,o),i.push({title:a.title,error:o.message})}return{success:!0,count:t,errors:i}},async updateRecipeCosts(n){const{data:t,error:i}=await Ee.from("recipes").select("*");if(i)throw i;let a=0;const o=[];for(const u of t){const d=as(u);let f=!1;const h=p=>p.map(y=>{if(!y.name)return y;const v=n.get(Wt(y.name));if(v&&y.purchaseCost!==v.price){f=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const w=parseFloat(x.quantity)||0;x.cost=Math.round(w/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const w=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*w)}return x}return y});if(d.type==="bread"){const p=h(d.flours||[]),y=h(d.breadIngredients||[]);f&&(d.flours=p,d.breadIngredients=y)}else{const p=h(d.ingredients||[]);f&&(d.ingredients=p)}if(f){const p=Mu(d);o.push(Ee.from("recipes").update(p).eq("id",d.id)),a++}}return o.length>0&&await Promise.all(o),a}},Mu=n=>{let t=n.ingredients||[];const i={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(i.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const o=n.steps||[],u=n.stepGroups.map(d=>({...d,count:o.filter(f=>f.groupId===d.id).length}));i.stepGroups=u}if(n.type==="bread"){const o=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[i,...o,...u]}else t=[i,...t];const a=(n.steps||[]).map(o=>typeof o=="string"?o:o.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:a,tags:n.tags||[]}},as=n=>{const t=n.ingredients||[];let i="normal",a=[],o=[],u=[],d=[],f=t;const h=qb(n.tags);if(Array.isArray(t)&&t.length>0&&t[0]&&typeof t[0]=="object"&&t[0]._meta){const v=t[0];i=v.type||"normal",v.groups&&(u=v.groups),v.stepGroups&&(d=v.stepGroups);const x=t.slice(1);i==="bread"?(a=x.filter(w=>w._group==="flour").map(w=>{const{_group:_,...C}=w;return C}),o=x.filter(w=>w._group==="other").map(w=>{const{_group:_,...C}=w;return C}),f=[...a,...o]):f=x}else n.ingredients_meta&&(i=n.ingredients_meta.type||"normal",Array.isArray(n.ingredients_meta.groups)&&(u=n.ingredients_meta.groups),Array.isArray(n.ingredients_meta.stepGroups)&&(d=n.ingredients_meta.stepGroups),f=Array.isArray(t)?t:[]);let y=n.steps||[];if(d.length>0&&Array.isArray(y)){let v=0;y=y.map(w=>({text:w}));const x=[];for(d.forEach(w=>{const _=w.count||0;for(let C=0;C<_;C++)v<y.length&&(x.push({...y[v],text:y[v].text,groupId:w.id}),v++)});v<y.length;)x.push({...y[v],groupId:"default"}),v++;y=x}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:i,flours:a,breadIngredients:o,ingredientGroups:u,stepGroups:d,ingredients:f,steps:y.length>0&&typeof y[0]=="object"?y:n.steps,tags:h,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},nk=n=>({...as(n),deletedAt:n.deleted_at,originalId:n.original_id}),Qf=Object.freeze(Object.defineProperty({__proto__:null,recipeService:Sn},Symbol.toStringTag,{value:"Module"})),Jf="food",rk="food_alcohol",sk=new Set(["food","alcohol","soft_drink","supplies"]),Lu=n=>{const t=String(n||"").trim();return!t||t===rk?Jf:sk.has(t)?t:Jf},Ln={async _getCurrentUserId(){const{data:n,error:t}=await Ee.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,i,a=null,o=null,u=void 0,d=void 0){try{const f=await this._getCurrentUserId();if(!f)throw new Error("");const h={user_id:f,ingredient_name:n,packet_size:parseFloat(t),packet_unit:i,last_price:a?parseFloat(a):null,updated_at:new Date().toISOString()};if(o&&(h.item_category=Lu(o)),u!==void 0){const x=String(u??"").trim();h.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let w=Number.isFinite(x)?x:100;w<=0&&(w=100),w>100&&(w=100),h.yield_percent=w}const p=async x=>Ee.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await p(h);if(v){const x=String(v.message||""),w=!!h.item_category&&x.includes("item_category"),_=Object.prototype.hasOwnProperty.call(h,"vendor")&&x.includes("vendor"),C=Object.prototype.hasOwnProperty.call(h,"yield_percent")&&x.includes("yield_percent");if(w||_||C){const S={...h};w&&delete S.item_category,_&&delete S.vendor,C&&delete S.yield_percent,{data:y,error:v}=await p(S)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:Lu(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(f){throw console.error("Error saving conversion:",f),f}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:i,error:a}=await Ee.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return a?(a.code==="PGRST116"||console.warn("Error fetching conversion:",a),null):{ingredientName:i.ingredient_name,packetSize:i.packet_size,packetUnit:i.packet_unit,lastPrice:i.last_price,vendor:i.vendor||"",itemCategory:Lu(i.item_category),yieldPercent:i.yield_percent===null||i.yield_percent===void 0?100:i.yield_percent,updatedAt:i.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:i}=await Ee.from("unit_conversions").select("*").eq("user_id",n);if(i)throw i;const a=new Map;return t.forEach(o=>{a.set(o.ingredient_name,{ingredientName:o.ingredient_name,packetSize:o.packet_size,packetUnit:o.packet_unit,lastPrice:o.last_price,vendor:o.vendor||"",itemCategory:Lu(o.item_category),yieldPercent:o.yield_percent===null||o.yield_percent===void 0?100:o.yield_percent,updatedAt:o.updated_at})}),a}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:i}=await Ee.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(i)throw i;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(n,{overwrite:t=!1}={}){const i=String(n||"").trim();if(!i)throw new Error("");const{data:a,error:o}=await Ee.rpc("admin_copy_ingredient_master",{target_profile_id:i,overwrite:t===!0});if(o)throw o;return a}},Hb=b.createContext(null),fs=()=>b.useContext(Hb),Vb=b.createContext(null),ws=()=>{const n=b.useContext(Vb);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},ad=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],ik=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var al={},Xf={exports:{}},Zf,Hx;function ak(){if(Hx)return Zf;Hx=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Zf=n,Zf}var ep,Vx;function lk(){if(Vx)return ep;Vx=1;var n=ak();function t(){}function i(){}return i.resetWarningCache=t,ep=function(){function a(d,f,h,p,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}a.isRequired=a;function o(){return a}var u={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:o,element:a,elementType:a,instanceOf:o,node:a,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:i,resetWarningCache:t};return u.PropTypes=u,u},ep}var Gx;function Gb(){return Gx||(Gx=1,Xf.exports=lk()()),Xf.exports}var tp,Kx;function Kb(){return Kx||(Kx=1,tp={L:1,M:0,Q:3,H:2}),tp}var np,Yx;function Yb(){return Yx||(Yx=1,np={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),np}var rp,Wx;function ok(){if(Wx)return rp;Wx=1;var n=Yb();function t(i){this.mode=n.MODE_8BIT_BYTE,this.data=i}return t.prototype={getLength:function(i){return this.data.length},write:function(i){for(var a=0;a<this.data.length;a++)i.put(this.data.charCodeAt(a),8)}},rp=t,rp}var sp,Qx;function ck(){if(Qx)return sp;Qx=1;var n=Kb();function t(i,a){this.totalCount=i,this.dataCount=a}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(i,a){var o=t.getRsBlockTable(i,a);if(o==null)throw new Error("bad rs block @ typeNumber:"+i+"/errorCorrectLevel:"+a);for(var u=o.length/3,d=new Array,f=0;f<u;f++)for(var h=o[f*3+0],p=o[f*3+1],y=o[f*3+2],v=0;v<h;v++)d.push(new t(p,y));return d},t.getRsBlockTable=function(i,a){switch(a){case n.L:return t.RS_BLOCK_TABLE[(i-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(i-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(i-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(i-1)*4+3];default:return}},sp=t,sp}var ip,Jx;function uk(){if(Jx)return ip;Jx=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var i=Math.floor(t/8);return(this.buffer[i]>>>7-t%8&1)==1},put:function(t,i){for(var a=0;a<i;a++)this.putBit((t>>>i-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var i=Math.floor(this.length/8);this.buffer.length<=i&&this.buffer.push(0),t&&(this.buffer[i]|=128>>>this.length%8),this.length++}},ip=n,ip}var ap,Xx;function Wb(){if(Xx)return ap;Xx=1;for(var n={glog:function(i){if(i<1)throw new Error("glog("+i+")");return n.LOG_TABLE[i]},gexp:function(i){for(;i<0;)i+=255;for(;i>=256;)i-=255;return n.EXP_TABLE[i]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return ap=n,ap}var lp,Zx;function Qb(){if(Zx)return lp;Zx=1;var n=Wb();function t(i,a){if(i.length==null)throw new Error(i.length+"/"+a);for(var o=0;o<i.length&&i[o]==0;)o++;this.num=new Array(i.length-o+a);for(var u=0;u<i.length-o;u++)this.num[u]=i[u+o]}return t.prototype={get:function(i){return this.num[i]},getLength:function(){return this.num.length},multiply:function(i){for(var a=new Array(this.getLength()+i.getLength()-1),o=0;o<this.getLength();o++)for(var u=0;u<i.getLength();u++)a[o+u]^=n.gexp(n.glog(this.get(o))+n.glog(i.get(u)));return new t(a,0)},mod:function(i){if(this.getLength()-i.getLength()<0)return this;for(var a=n.glog(this.get(0))-n.glog(i.get(0)),o=new Array(this.getLength()),u=0;u<this.getLength();u++)o[u]=this.get(u);for(var u=0;u<i.getLength();u++)o[u]^=n.gexp(n.glog(i.get(u))+a);return new t(o,0).mod(i)}},lp=t,lp}var op,e0;function dk(){if(e0)return op;e0=1;var n=Yb(),t=Qb(),i=Wb(),a={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;o.getBCHDigit(d)-o.getBCHDigit(o.G15)>=0;)d^=o.G15<<o.getBCHDigit(d)-o.getBCHDigit(o.G15);return(u<<10|d)^o.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;o.getBCHDigit(d)-o.getBCHDigit(o.G18)>=0;)d^=o.G18<<o.getBCHDigit(d)-o.getBCHDigit(o.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return o.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,f){switch(u){case a.PATTERN000:return(d+f)%2==0;case a.PATTERN001:return d%2==0;case a.PATTERN010:return f%3==0;case a.PATTERN011:return(d+f)%3==0;case a.PATTERN100:return(Math.floor(d/2)+Math.floor(f/3))%2==0;case a.PATTERN101:return d*f%2+d*f%3==0;case a.PATTERN110:return(d*f%2+d*f%3)%2==0;case a.PATTERN111:return(d*f%3+(d+f)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),f=0;f<u;f++)d=d.multiply(new t([1,i.gexp(f)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),f=0,h=0;h<d;h++)for(var p=0;p<d;p++){for(var y=0,v=u.isDark(h,p),x=-1;x<=1;x++)if(!(h+x<0||d<=h+x))for(var w=-1;w<=1;w++)p+w<0||d<=p+w||x==0&&w==0||v==u.isDark(h+x,p+w)&&y++;y>5&&(f+=3+y-5)}for(var h=0;h<d-1;h++)for(var p=0;p<d-1;p++){var _=0;u.isDark(h,p)&&_++,u.isDark(h+1,p)&&_++,u.isDark(h,p+1)&&_++,u.isDark(h+1,p+1)&&_++,(_==0||_==4)&&(f+=3)}for(var h=0;h<d;h++)for(var p=0;p<d-6;p++)u.isDark(h,p)&&!u.isDark(h,p+1)&&u.isDark(h,p+2)&&u.isDark(h,p+3)&&u.isDark(h,p+4)&&!u.isDark(h,p+5)&&u.isDark(h,p+6)&&(f+=40);for(var p=0;p<d;p++)for(var h=0;h<d-6;h++)u.isDark(h,p)&&!u.isDark(h+1,p)&&u.isDark(h+2,p)&&u.isDark(h+3,p)&&u.isDark(h+4,p)&&!u.isDark(h+5,p)&&u.isDark(h+6,p)&&(f+=40);for(var C=0,p=0;p<d;p++)for(var h=0;h<d;h++)u.isDark(h,p)&&C++;var S=Math.abs(100*C/d/d-50)/5;return f+=S*10,f}};return op=o,op}var cp,t0;function hk(){if(t0)return cp;t0=1;var n=ok(),t=ck(),i=uk(),a=dk(),o=Qb();function u(f,h){this.typeNumber=f,this.errorCorrectLevel=h,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(f){var h=new n(f);this.dataList.push(h),this.dataCache=null},d.isDark=function(f,h){if(f<0||this.moduleCount<=f||h<0||this.moduleCount<=h)throw new Error(f+","+h);return this.modules[f][h]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var f=1;for(f=1;f<40;f++){for(var h=t.getRSBlocks(f,this.errorCorrectLevel),p=new i,y=0,v=0;v<h.length;v++)y+=h[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];p.put(x.mode,4),p.put(x.getLength(),a.getLengthInBits(x.mode,f)),x.write(p)}if(p.getLengthInBits()<=y*8)break}this.typeNumber=f}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(f,h){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var p=0;p<this.moduleCount;p++){this.modules[p]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[p][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(f,h),this.typeNumber>=7&&this.setupTypeNumber(f),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,h)},d.setupPositionProbePattern=function(f,h){for(var p=-1;p<=7;p++)if(!(f+p<=-1||this.moduleCount<=f+p))for(var y=-1;y<=7;y++)h+y<=-1||this.moduleCount<=h+y||(0<=p&&p<=6&&(y==0||y==6)||0<=y&&y<=6&&(p==0||p==6)||2<=p&&p<=4&&2<=y&&y<=4?this.modules[f+p][h+y]=!0:this.modules[f+p][h+y]=!1)},d.getBestMaskPattern=function(){for(var f=0,h=0,p=0;p<8;p++){this.makeImpl(!0,p);var y=a.getLostPoint(this);(p==0||f>y)&&(f=y,h=p)}return h},d.createMovieClip=function(f,h,p){var y=f.createEmptyMovieClip(h,p),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var w=x*v,_=0;_<this.modules[x].length;_++){var C=_*v,S=this.modules[x][_];S&&(y.beginFill(0,100),y.moveTo(C,w),y.lineTo(C+v,w),y.lineTo(C+v,w+v),y.lineTo(C,w+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var f=8;f<this.moduleCount-8;f++)this.modules[f][6]==null&&(this.modules[f][6]=f%2==0);for(var h=8;h<this.moduleCount-8;h++)this.modules[6][h]==null&&(this.modules[6][h]=h%2==0)},d.setupPositionAdjustPattern=function(){for(var f=a.getPatternPosition(this.typeNumber),h=0;h<f.length;h++)for(var p=0;p<f.length;p++){var y=f[h],v=f[p];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var w=-2;w<=2;w++)x==-2||x==2||w==-2||w==2||x==0&&w==0?this.modules[y+x][v+w]=!0:this.modules[y+x][v+w]=!1}},d.setupTypeNumber=function(f){for(var h=a.getBCHTypeNumber(this.typeNumber),p=0;p<18;p++){var y=!f&&(h>>p&1)==1;this.modules[Math.floor(p/3)][p%3+this.moduleCount-8-3]=y}for(var p=0;p<18;p++){var y=!f&&(h>>p&1)==1;this.modules[p%3+this.moduleCount-8-3][Math.floor(p/3)]=y}},d.setupTypeInfo=function(f,h){for(var p=this.errorCorrectLevel<<3|h,y=a.getBCHTypeInfo(p),v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!f},d.mapData=function(f,h){for(var p=-1,y=this.moduleCount-1,v=7,x=0,w=this.moduleCount-1;w>0;w-=2)for(w==6&&w--;;){for(var _=0;_<2;_++)if(this.modules[y][w-_]==null){var C=!1;x<f.length&&(C=(f[x]>>>v&1)==1);var S=a.getMask(h,y,w-_);S&&(C=!C),this.modules[y][w-_]=C,v--,v==-1&&(x++,v=7)}if(y+=p,y<0||this.moduleCount<=y){y-=p,p=-p;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(f,h,p){for(var y=t.getRSBlocks(f,h),v=new i,x=0;x<p.length;x++){var w=p[x];v.put(w.mode,4),v.put(w.getLength(),a.getLengthInBits(w.mode,f)),w.write(v)}for(var _=0,x=0;x<y.length;x++)_+=y[x].dataCount;if(v.getLengthInBits()>_*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+_*8+")");for(v.getLengthInBits()+4<=_*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=_*8||(v.put(u.PAD0,8),v.getLengthInBits()>=_*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(f,h){for(var p=0,y=0,v=0,x=new Array(h.length),w=new Array(h.length),_=0;_<h.length;_++){var C=h[_].dataCount,S=h[_].totalCount-C;y=Math.max(y,C),v=Math.max(v,S),x[_]=new Array(C);for(var N=0;N<x[_].length;N++)x[_][N]=255&f.buffer[N+p];p+=C;var T=a.getErrorCorrectPolynomial(S),L=new o(x[_],T.getLength()-1),R=L.mod(T);w[_]=new Array(T.getLength()-1);for(var N=0;N<w[_].length;N++){var J=N+R.getLength()-w[_].length;w[_][N]=J>=0?R.get(J):0}}for(var H=0,N=0;N<h.length;N++)H+=h[N].totalCount;for(var V=new Array(H),k=0,N=0;N<y;N++)for(var _=0;_<h.length;_++)N<x[_].length&&(V[k++]=x[_][N]);for(var N=0;N<v;N++)for(var _=0;_<h.length;_++)N<w[_].length&&(V[k++]=w[_][N]);return V},cp=u,cp}var zu={},n0;function fk(){if(n0)return zu;n0=1,Object.defineProperty(zu,"__esModule",{value:!0});var n=Object.assign||function(p){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(p[x]=v[x])}return p},t=Gb(),i=u(t),a=sc(),o=u(a);function u(p){return p&&p.__esModule?p:{default:p}}function d(p,y){var v={};for(var x in p)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(p,x)&&(v[x]=p[x]);return v}var f={bgColor:i.default.oneOfType([i.default.object,i.default.string]).isRequired,bgD:i.default.string.isRequired,fgColor:i.default.oneOfType([i.default.object,i.default.string]).isRequired,fgD:i.default.string.isRequired,size:i.default.number.isRequired,title:i.default.string,viewBoxSize:i.default.number.isRequired,xmlns:i.default.string},h=(0,a.forwardRef)(function(p,y){var v=p.bgColor,x=p.bgD,w=p.fgD,_=p.fgColor,C=p.size,S=p.title,N=p.viewBoxSize,T=p.xmlns,L=T===void 0?"http://www.w3.org/2000/svg":T,R=d(p,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return o.default.createElement("svg",n({},R,{height:C,ref:y,viewBox:"0 0 "+N+" "+N,width:C,xmlns:L}),S?o.default.createElement("title",null,S):null,o.default.createElement("path",{d:x,fill:v}),o.default.createElement("path",{d:w,fill:_}))});return h.displayName="QRCodeSvg",h.propTypes=f,zu.default=h,zu}var r0;function pk(){if(r0)return al;r0=1,Object.defineProperty(al,"__esModule",{value:!0}),al.QRCode=void 0;var n=Object.assign||function(C){for(var S=1;S<arguments.length;S++){var N=arguments[S];for(var T in N)Object.prototype.hasOwnProperty.call(N,T)&&(C[T]=N[T])}return C},t=Gb(),i=v(t),a=Kb(),o=v(a),u=hk(),d=v(u),f=sc(),h=v(f),p=fk(),y=v(p);function v(C){return C&&C.__esModule?C:{default:C}}function x(C,S){var N={};for(var T in C)S.indexOf(T)>=0||Object.prototype.hasOwnProperty.call(C,T)&&(N[T]=C[T]);return N}var w={bgColor:i.default.oneOfType([i.default.object,i.default.string]),fgColor:i.default.oneOfType([i.default.object,i.default.string]),level:i.default.string,size:i.default.number,value:i.default.string.isRequired},_=(0,f.forwardRef)(function(C,S){var N=C.bgColor,T=N===void 0?"#FFFFFF":N,L=C.fgColor,R=L===void 0?"#000000":L,J=C.level,H=J===void 0?"L":J,V=C.size,k=V===void 0?256:V,M=C.value,z=x(C,["bgColor","fgColor","level","size","value"]),U=new d.default(-1,o.default[H]);U.addData(M),U.make();var F=U.modules;return h.default.createElement(y.default,n({},z,{bgColor:T,bgD:F.map(function(Y,$){return Y.map(function(P,E){return P?"":"M "+E+" "+$+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:R,fgD:F.map(function(Y,$){return Y.map(function(P,E){return P?"M "+E+" "+$+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:S,size:k,viewBoxSize:F.length}))});return al.QRCode=_,_.displayName="QRCode",_.propTypes=w,al.default=_,al}var mk=pk();const s0=T0(mk),i0=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},gk=n=>{if(n==null)return NaN;if(typeof n=="number")return Number.isFinite(n)?n:NaN;const t=String(n).trim().replace(/[,\s]/g,"");if(!t)return NaN;const i=parseFloat(t);return Number.isFinite(i)?i:NaN},vs=(n,{maximumFractionDigits:t=1}={})=>{const i=gk(n);return Number.isFinite(i)?`${i.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}`:null},yk=new Set(["food","alcohol","soft_drink","supplies"]),Jb=new Set(["alcohol","supplies"]),Xb=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":yk.has(t)?t:"":""},Dp=n=>{const t=Xb(n?.itemCategory??n?.item_category);return t?Jb.has(t):!!n?.isAlcohol},ia=n=>Dp(n)?1.1:1.08,a0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),vk=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=a0(t);if(!a)return null;for(const[o,u]of n.entries())if(a0(o)===a)return u;return null},Ks=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},xk=n=>{const t=Ks(n);return!Number.isFinite(t)||t<=0||t>100?100:t},bk=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return xk(i)/100},wk=(n,t,i)=>{const a=Ks(n),o=Ks(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:["kg","","l",""].includes(u)?a/o:["cl",""].includes(u)?a/o*100:a/o},l0=(n,t,i,{defaultWeightWhenUnitEmpty:a=!1,forceWeightBased:o=!1,yieldRate:u=1}={})=>{const d=Ks(n),f=Ks(t);if(!Number.isFinite(d)||!Number.isFinite(f))return NaN;const h=Number.isFinite(u)&&u>0?u:1,p=String(i||"").trim().toLowerCase();return o||!p&&a||["g","","ml","","cc",""].includes(p)?d/1e3*f/h:["cl",""].includes(p)?d*10/1e3*f/h:d*f/h},Sk=(n,t)=>{const i=Ks(n?.purchaseCost),a=Ks(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},jk=2,ml=Object.freeze({course:"",category:"",storeName:"",servings:"",ingredients:"",ingredientName:"",quantity:"",quantityGram:" (g)",unit:"",purchase:"",cost:"",totalCost:"",instructions:"",sourceRecipe:"",flourGroup:"",otherIngredients:"",scaleMultiplier:"",noSteps:"",print:"",close:""}),o0=Object.keys(ml),_k=({recipe:n,ownerLabel:t,onBack:i,onEdit:a,onDelete:o,onHardDelete:u,isDeleted:d,onView:f,onDuplicate:h,backLabel:p,onList:y})=>{const{user:v}=fs(),x=ws(),[w,_]=_e.useState(!1),[C,S]=_e.useState(!1),[N,T]=_e.useState(!1),[L,R]=_e.useState(new Set),[J,H]=_e.useState(new Set),[V,k]=_e.useState(new Set),[M,z]=_e.useState({}),[U,F]=_e.useState("ORIGINAL"),[Y,$]=_e.useState(!1),[P,E]=_e.useState(!0),[B,q]=_e.useState(!1),[Q,G]=_e.useState(new Map),[A,O]=_e.useState({}),[K,de]=_e.useState(""),[pe,ve]=_e.useState(1),[te,W]=_e.useState(""),[me,ke]=_e.useState(""),ie=_e.useMemo(()=>{const oe=parseFloat(pe);return isNaN(oe)?1:oe},[pe]),je=(oe,ne)=>{if(!oe)return"";const ue=parseFloat(oe);if(isNaN(ue))return oe;const xe=ue*parseFloat(ne);return Number.isInteger(xe)?xe.toString():xe.toFixed(1).replace(/\.0$/,"")},Re=(oe,ne)=>{if(!oe)return"";const ue=parseFloat(oe);return isNaN(ue)?oe:(ue*parseFloat(ne)).toFixed(2).replace(/\.00$/,"")},[Oe,qe]=_e.useState(n),[et,at]=_e.useState(!1),[lt,pt]=_e.useState(!1),we=Oe||n,ae=U==="ORIGINAL"?Oe:M[U]||Oe,Ge=U==="ORIGINAL"||U==="JA"?ml:A[U]||ml,Ne=oe=>Ge[oe]||ml[oe]||oe;_e.useEffect(()=>{let oe=!0;return Ln.getAllConversions().then(ne=>{oe&&G(ne)}).catch(()=>{oe&&G(new Map)}),()=>{oe=!1}},[]);const dt=_e.useMemo(()=>{const oe=(ne,ue={})=>{if(!ne||typeof ne!="object")return ne;const xe=vk(Q,ne.name),Pe=Xb(ne.itemCategory??ne.item_category??xe?.itemCategory),Je=bk(ne,xe);let Xe=ne;if(Pe&&(Xe={...Xe,itemCategory:Pe,isAlcohol:Jb.has(Pe)}),!xe||!xe.packetSize){const We=String(ne.unit||"").trim();if(ue.forceWeightBased||ue.defaultWeightWhenUnitEmpty&&!We){const fn=l0(ne.quantity,Xe.purchaseCost,ne.unit,{...ue,yieldRate:Je}),Qn=Number.isFinite(fn)?Math.round(fn*100)/100:NaN,Jn=Ks(Xe.cost);if(Number.isFinite(Qn)&&(!Number.isFinite(Jn)||Math.abs(Jn-Qn)>.01))return{...Xe,cost:Qn}}return Xe}const jt=[xe.lastPrice,ne.purchaseCostRef,ne.purchase_cost,ne.purchaseCost].find(We=>Number.isFinite(Ks(We))),an=wk(jt,xe.packetSize,xe.packetUnit);if(!Number.isFinite(an)||!Sk(ne,an))return Xe;const nn=l0(ne.quantity,an,ne.unit,{...ue,yieldRate:Je});return{...Xe,purchaseCost:Math.round(an*100)/100,cost:Number.isFinite(nn)?Math.round(nn*100)/100:Xe.cost}};return{...ae,ingredients:(ae.ingredients||[]).map(ne=>oe(ne)),flours:(ae.flours||[]).map(ne=>oe(ne,{forceWeightBased:!0})),breadIngredients:(ae.breadIngredients||[]).map(ne=>oe(ne,{forceWeightBased:!0}))}},[Q,ae]);_e.useEffect(()=>{qe(n),!n.steps&&!d&&(at(!0),Sn.getRecipe(n.id).then(oe=>{qe(oe)}).catch(oe=>{console.error("Failed to load details",oe)}).finally(()=>{at(!1)}))},[n,d]);const[rt,Ve]=_e.useState(n.tags?.includes("public")||!1),ot=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),St=!(n.tags&&n.tags.some(oe=>oe.startsWith("owner:")))||ot,gn=async()=>{const oe=!rt;try{const ne=n.tags||[];let ue;oe?ue=[...ne,"public"]:ue=ne.filter(xe=>xe!=="public"),Ve(oe),await Sn.updateRecipe({id:n.id,tags:ue})}catch(ne){console.error("Failed to toggle public",ne),x.error(""),Ve(!oe)}},Ct=(oe,ne,ue=!1)=>U==="ORIGINAL"||!P||!ne||oe===ne?oe:r.jsxs(r.Fragment,{children:[oe,ue?r.jsx("br",{}):" ",r.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",ne,")"]})]}),zt=(oe,ne)=>{const ue=String(oe??"").trim(),xe=String(ne??"").trim();return U==="ORIGINAL"||!P||!xe||ue===xe?ue||xe:`${ue}${xe}`},Ft=oe=>!oe||!Array.isArray(oe.steps)?!1:oe.type==="bread"?Array.isArray(oe.flours)&&Array.isArray(oe.breadIngredients):Array.isArray(oe.ingredients),rn=(oe,ne)=>!oe||!ne||oe.__translationVersion!==jk||Array.isArray(ne.steps)&&!Array.isArray(oe.steps)?!1:ne.type==="bread"?!((ne.flours||[]).length>0&&(oe.flours||[]).length===0||(ne.breadIngredients||[]).length>0&&(oe.breadIngredients||[]).length===0):!((ne.ingredients||[]).length>0&&(oe.ingredients||[]).length===0),ln=async oe=>{const ne=oe.target.value;if(F(ne),ne==="ORIGINAL")return;let ue=Oe||n;if(!d&&n?.id&&!Ft(ue))try{at(!0);const Je=await Sn.getRecipe(n.id);Je&&(ue=Je,qe(Je))}catch(Je){console.error("Failed to load full recipe for translation",Je)}finally{at(!1)}const xe=M[ne]&&rn(M[ne],ue),Pe=ne!=="JA"&&!A[ne];if(!(xe&&!Pe)){$(!0);try{let Je=null;if(await Promise.all([(async()=>{if(!xe)try{const Xe=await qx.translateRecipe(ue,ne);z(Ye=>({...Ye,[ne]:Xe}))}catch(Xe){Je=Xe}})(),(async()=>{if(Pe)try{const Xe=await qx.translateList(o0.map(jt=>ml[jt]),ne),Ye=o0.reduce((jt,an,nn)=>(jt[an]=Xe[nn]||ml[an],jt),{});O(jt=>({...jt,[ne]:Ye}))}catch(Xe){console.error("Failed to translate UI labels",Xe)}})()]),Je)throw Je}catch(Je){console.error(Je),x.error(""),F("ORIGINAL")}finally{$(!1)}}},sn=oe=>{R(ne=>{const ue=new Set(ne);return ue.has(oe)?ue.delete(oe):ue.add(oe),ue})},zn=oe=>{H(ne=>{const ue=new Set(ne);return ue.has(oe)?ue.delete(oe):ue.add(oe),ue})},Xt=oe=>{k(ne=>{const ue=new Set(ne);return ue.has(oe)?ue.delete(oe):ue.add(oe),ue})};_e.useEffect(()=>{window.scrollTo(0,0),f&&n&&!d&&f(n.id);const oe=document.title;return n&&n.title&&(document.title=n.title),z({}),F("ORIGINAL"),R(new Set),H(new Set),k(new Set),Ve(n.tags?.includes("public")||!1),()=>{document.title=oe}},[n.id,n.title]),_e.useEffect(()=>{n&&n.servings?ke(n.servings.toString()):ke(""),W("")},[n]);const ee=()=>{_(!0)},De=()=>{_(!1),o(n)},Te=()=>{_(!1)},Ie=()=>{T(!0)},Fe=()=>{T(!1),u(n)},it=()=>{T(!1)},wt=()=>{S(!0)},Pt=async()=>{S(!1);try{const oe=await Sn.duplicateRecipe(n,v);h&&h(oe)}catch(oe){console.error("Duplication failed",oe),x.error("")}},Vt=()=>{S(!1)},on=_e.useRef(null),he=_e.useRef(null),Ke=oe=>{he.current=null,on.current=oe.targetTouches[0].clientX},mt=oe=>{he.current=oe.targetTouches[0].clientX},ct=()=>{if(!on.current||!he.current)return;const oe=on.current-he.current,ne=on.current<50,ue=oe<-100;ne&&ue&&i()},Lt=oe=>{const ne=Math.round(parseFloat(oe)),ue=parseFloat(te),xe=parseFloat(me);let Pe=null,Je=null,Xe=null;return!isNaN(ne)&&!isNaN(xe)&&xe>0&&(Xe=ne/xe),!isNaN(ne)&&!isNaN(ue)&&!isNaN(xe)&&ue>0&&xe>0&&(Je=ue*xe,Pe=ne/Je*100),r.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[r.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{children:["  ",r.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),r.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[r.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),r.jsx("input",{type:"number",value:te,onChange:Ye=>W(Ye.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[r.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),r.jsx("input",{type:"number",value:me,onChange:Ye=>ke(Ye.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Xe!==null&&r.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Pe!==null?Pe>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Pe!==null?Pe>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Pe!==null?"6px":"0"},children:["1(): ",r.jsxs("strong",{children:["",Xe.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Pe!==null&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",Je.toLocaleString()]}),r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(Je-ne).toLocaleString()]}),r.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Pe>40?"#d32f2f":"#2e7d32"},children:[": ",Pe.toFixed(1),"%"]})]})]})]})]})},ut=dt.ingredients||[];let Mt=ae.steps||[];const tn=oe=>String(oe||"").trim().toLowerCase(),ht=oe=>{const ne=tn(oe);return ne?["","","steps","method"].some(ue=>ne===ue||ne.includes(ue)):!1};if(!Mt.length&&ae.ingredientGroups){const oe=ae.ingredientGroups.find(ne=>ht(ne.name));if(oe)Mt=ut.filter(ue=>ue.groupId===oe.id).map(ue=>typeof ue=="string"?ue:{...ue,text:ue.name||ue.text||""});else{const ne=ut.filter(ue=>ht(ue.group)||ht(ue.groupName));ne.length&&(Mt=ne.map(ue=>typeof ue=="string"?ue:{...ue,text:ue.name||ue.text||""}))}}const le=Mt,$e=_e.useMemo(()=>{const oe=ae.ingredientGroups||[],ne=["","steps","method",""],ue=Ye=>String(Ye||"").trim().toLowerCase(),xe=new Set(oe.filter(Ye=>ne.includes(ue(Ye.name))).map(Ye=>Ye.id)),Pe=oe.filter(Ye=>!xe.has(Ye.id));if(!Pe.length)return[{id:"default",name:null,items:ut.filter(Ye=>!xe.has(Ye.groupId))}];const Je=Pe.map(Ye=>{const jt=ut.filter(an=>an.groupId===Ye.id);return{id:Ye.id,name:Ye.name===""?null:Ye.name,items:jt}}).filter(Ye=>Ye.items.length>0),Xe=ut.filter(Ye=>Ye.groupId?xe.has(Ye.groupId)?!1:!Pe.some(jt=>jt.id===Ye.groupId):!0);return Xe.length&&Je.push({id:"ungrouped",name:null,items:Xe}),Je.length?Je:[{id:"default",name:null,items:ut.filter(Ye=>!xe.has(Ye.groupId))}]},[ae.ingredientGroups,ut]),ze=_e.useMemo(()=>{if(ae.type!=="bread")return null;const oe=dt.flours||[],ne=dt.breadIngredients||[],ue=oe.reduce((We,_t)=>We+(parseFloat(_t.quantity)||0),0),xe=ue+ne.reduce((We,_t)=>We+(parseFloat(_t.quantity)||0),0),Pe=parseFloat(K),Je=Pe&&xe?Pe/xe:1,Xe=We=>ue?((parseFloat(We)||0)/ue*100).toFixed(1):"0.0",Ye=We=>Pe?((parseFloat(We)||0)*Je).toFixed(1):We,jt=We=>{const _t=parseFloat(We)||0;if(!Pe)return _t;const fn=_t*Je;return Math.round(fn*100)/100},an=We=>{const _t=jt(We);return Number.isFinite(_t)?_t.toLocaleString(void 0,{maximumFractionDigits:2}):""},nn=We=>We.reduce((_t,fn)=>{const Jn=(parseFloat(fn.cost)||0)*(Pe?Je:1),mr=ia(fn);return _t+Jn*mr},0);return{flours:oe,others:ne,totalFlour:ue,grandTotal:xe,calcPercent:Xe,getScaledQtyValue:Ye,getScaledCostValue:jt,formatCostValue:an,scaleFactor:Je,totalTaxIncluded:nn(oe)+nn(ne)}},[dt.breadIngredients,dt.flours,ae.type,K]),At=_e.useMemo(()=>ae.type==="bread"?0:ut.reduce((oe,ne)=>{const xe=(parseFloat(ne.cost)||0)*ie,Pe=ia(ne);return oe+xe*Pe},0),[ae.type,ut,ie]),Tt=ae.type==="bread"?ze?Math.round(ze.totalTaxIncluded).toLocaleString():"0":Math.round(At).toLocaleString(),Et=ae.description||we.description;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:Ke,onTouchMove:mt,onTouchEnd:ct,children:[C&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(hn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:Vt,children:""}),r.jsx(ce,{variant:"primary",onClick:Pt,children:""})]})]})}),N&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(hn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:it,children:""}),r.jsx(ce,{variant:"danger",onClick:Fe,children:""})]})]})}),w&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(hn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("small",{style:{color:"#666"},children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:Te,children:""}),r.jsx(ce,{variant:"danger",onClick:De,children:""})]})]})}),r.jsxs("div",{className:"recipe-detail__header",children:[r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx(ce,{variant:"secondary",onClick:i,size:"sm",children:p||" "}),y&&r.jsx(ce,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&r.jsxs("div",{className:"recipe-detail__actions",children:[St&&(v?.displayId==="yoshito"||v?.role==="admin")&&r.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:rt,onChange:gn,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),r.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:rt?"#4CAF50":"#888"},children:rt?"":""})]})}),!St&&r.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),r.jsxs("select",{className:"language-select",value:U,onChange:ln,disabled:Y,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[r.jsx("option",{value:"ORIGINAL",children:" Original ()"}),ik.map(oe=>r.jsx("option",{value:oe.code,children:oe.label},oe.code))]}),U!=="ORIGINAL"&&r.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:P,onChange:oe=>E(oe.target.checked),style:{marginRight:"4px"}}),""]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>q(!0),children:" "}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:wt,children:""}),St&&r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:a,children:""}),r.jsx(ce,{variant:"danger",size:"sm",onClick:ee,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&r.jsxs("div",{className:"recipe-detail__actions",children:[r.jsx(ce,{variant:"ghost",size:"sm",onClick:Ie,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),r.jsx(ce,{variant:"primary",size:"sm",onClick:()=>o(n,!0),children:""})]})]}),r.jsx("div",{className:"recipe-detail__hero",children:ae.image?r.jsx("img",{src:ae.image,alt:ae.title,className:"recipe-detail__image"}):r.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),r.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[r.jsx("h1",{children:Ct(ae.title,we.title)}),r.jsx("p",{className:"recipe-detail__desc",children:Ct(ae.description,we.description,!0)}),v?.role==="admin"&&t&&r.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),r.jsxs("div",{className:"recipe-detail__meta",children:[ae.course&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:Ne("course")}),r.jsx("span",{className:"meta-value",children:Ct(ae.course,we.course)})]}),ae.category&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:Ne("category")}),r.jsx("span",{className:"meta-value",children:Ct(ae.category,we.category)})]}),ae.storeName&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:Ne("storeName")}),r.jsx("span",{className:"meta-value",children:Ct(ae.storeName,we.storeName)})]}),r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:Ne("servings")}),r.jsxs("span",{className:"meta-value",children:[ae.servings,""]})]})]}),ae.sourceUrl&&r.jsx("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.jsxs("div",{style:{fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"12px"},children:[r.jsxs("a",{href:ae.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",r.jsx("span",{className:"screen-only",children:Ne("sourceRecipe")}),r.jsx("span",{className:"print-only",children:Ne("sourceRecipe")})]}),r.jsx("button",{onClick:()=>pt(!0),className:"screen-only",style:{background:"none",border:"none",padding:0,color:"var(--color-text-muted)",cursor:"pointer",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"4px",textDecoration:"underline"},children:" QR"})]})})]}),r.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[r.jsxs("span",{children:[" : ",i0(n.created_at)]}),n.updated_at&&r.jsxs("span",{children:[" : ",i0(n.updated_at)]})]}),r.jsx("div",{className:"recipe-detail__content",children:r.jsxs("div",{className:"recipe-detail__main",children:[r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:Ne("ingredients")}),r.jsx(hn,{className:"ingredients-card",children:ae.type==="bread"?r.jsx("div",{className:"bread-detail-view",children:(()=>{const oe=dt.flours||[],ne=dt.breadIngredients||[],ue=oe.reduce((We,_t)=>We+(parseFloat(_t.quantity)||0),0),xe=ue+ne.reduce((We,_t)=>We+(parseFloat(_t.quantity)||0),0),Pe=ue?(xe/ue*100).toFixed(1):"0.0",Je=We=>ue?((parseFloat(We)||0)/ue*100).toFixed(1):"0.0",Xe=parseFloat(K),Ye=Xe&&xe?Xe/xe:1,jt=We=>Xe?((parseFloat(We)||0)*Ye).toFixed(1):We,an=We=>{const _t=parseFloat(We)||0;if(!Xe)return _t;const fn=_t*Ye;return Math.round(fn*100)/100},nn=We=>Number.isFinite(We)?We.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),r.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[xe.toLocaleString(),"g"]}),r.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Pe,"%)"]})]}),r.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("input",{id:"target-total-input",type:"number",value:K,onChange:We=>de(We.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),r.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),K&&r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>de(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),K&&r.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",Ye.toFixed(3)," "]})]}),r.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[r.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[r.jsx("span",{children:Ne("flourGroup")}),r.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",K?jt(ue):ue,"g (100%)"]})]}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:Ne("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:Ne("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:Ne("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:Ne("cost")})]})}),r.jsx("tbody",{children:oe.map((We,_t)=>{const fn=we.flours?.[_t]||{};return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`flour-${_t}`}),r.jsx("label",{htmlFor:`flour-${_t}`,children:Ct(We.name,fn?.name)})]})}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:K?r.jsx("span",{style:{color:"var(--color-primary)"},children:jt(We.quantity)}):We.quantity}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[Je(We.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(We.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:We.cost?`${nn(an(We.cost))}`:"-"})]},_t)})})]})]}),r.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[r.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:Ne("otherIngredients")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:Ne("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:Ne("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:Ne("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:Ne("cost")})]})}),r.jsx("tbody",{children:ne.map((We,_t)=>{const fn=we.breadIngredients?.[_t]||{};return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ingredient-${_t}`}),r.jsx("label",{htmlFor:`ingredient-${_t}`,children:Ct(We.name,fn?.name)})]})}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:K?r.jsx("span",{style:{color:"var(--color-primary)"},children:jt(We.quantity)}):We.quantity}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[Je(We.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(We.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:We.cost?`${nn(an(We.cost))}`:"-"})]},_t)})})]}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[Ne("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const We=fn=>fn.reduce((Qn,Jn)=>{const mr=parseFloat(Jn.cost)||0,Jr=ia(Jn),Mr=mr*Ye;return Qn+Mr*Jr},0),_t=We(oe)+We(ne);return Math.round(_t).toLocaleString()})()]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const We=fn=>fn.reduce((Qn,Jn)=>{const mr=parseFloat(Jn.cost)||0,Jr=ia(Jn),Mr=mr*Ye;return Qn+Mr*Jr},0),_t=We(oe)+We(ne);return Lt(_t)})()]})]})})()}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[r.jsxs("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:[Ne("scaleMultiplier"),":"]}),r.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),r.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:pe,onChange:oe=>ve(oe.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(pe)!==1&&r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>ve("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const oe=ae.ingredientGroups&&ae.ingredientGroups.length>0?ae.ingredientGroups:null;return oe?oe.map(ne=>{const ue=ut.filter(xe=>xe.groupId===ne.id);return ue.length===0||["","Steps","Method",""].includes(ne.name)?null:r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(ne.name)?"none":"block"},children:ne.name}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:Ne("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:Ne("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:Ne("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:Ne("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:Ne("cost")})]})}),r.jsx("tbody",{children:ue.map((xe,Pe)=>{const Je=ut.indexOf(xe),Xe=we.ingredients?.[Je],Ye=typeof xe=="string"?xe:xe.name,jt=Xe?typeof Xe=="string"?Xe:Xe.name:"",an=typeof xe=="object"?xe.unit:"",nn=Xe&&typeof Xe=="object"?Xe.unit:"",We=je(xe.quantity,pe),_t=Re(xe.cost,pe),fn=String(pe)!=="1";return r.jsxs("tr",{className:"ingredient-row",children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ing-${ne.id}-${Pe}`}),r.jsx("label",{htmlFor:`ing-${ne.id}-${Pe}`,children:Ct(Ye,jt)})]})}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:fn?"bold":"normal",color:fn?"var(--color-primary)":"inherit"},children:We}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:Ct(an,nn)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(xe.purchaseCost)??"-"}),r.jsxs("td",{style:{textAlign:"right"},children:[vs(_t)??"-",Dp(xe)&&r.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Pe)})})]})]},ne.id)}):r.jsxs(r.Fragment,{children:[r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:Ne("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:Ne("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:Ne("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:Ne("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:Ne("cost")})]})}),r.jsx("tbody",{children:ut.map((ne,ue)=>{const xe=we.ingredients?.[ue],Pe=typeof ne=="string"?ne:ne.name,Je=xe?typeof xe=="string"?xe:xe.name:"",Xe=typeof ne=="object"?ne.unit:"",Ye=xe&&typeof xe=="object"?xe.unit:"",jt=je(ne.quantity,pe),an=Re(ne.cost,pe),nn=String(pe)!=="1";return r.jsxs("tr",{className:"ingredient-row",children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ing-${ue}`}),r.jsx("label",{htmlFor:`ing-${ue}`,children:Ct(Pe,Je)})]})}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:nn?"bold":"normal",color:nn?"var(--color-primary)":"inherit"},children:jt}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:Ct(Xe,Ye)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(ne.purchaseCost)??"-"}),r.jsxs("td",{style:{textAlign:"right"},children:[vs(an)??"-",Dp(ne)&&r.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},ue)})})]}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[Ne("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ue=>ue.reduce((xe,Pe)=>{const Je=parseFloat(Pe.cost)||0,Xe=ia(Pe),Ye=Re(Je,pe),jt=parseFloat(Ye)||0;return xe+jt*Xe},0))(ut)).toLocaleString()]})]})]})})(),r.jsx("div",{className:"screen-only no-print",children:r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[Ne("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ne=>ne.reduce((ue,xe)=>{const Pe=parseFloat(xe.cost)||0,Je=ia(xe),Xe=Re(Pe,pe),Ye=parseFloat(Xe)||0;return ue+Ye*Je},0))(ut)).toLocaleString()]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]})}),r.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const ne=(ue=>ue.reduce((xe,Pe)=>{const Je=parseFloat(Pe.cost)||0,Xe=ia(Pe),Ye=parseFloat(Re(Je,pe))||0;return xe+Ye*Xe},0))(ut);return Lt(ne)})()]})})]}),r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:Ne("instructions")}),(()=>{const oe=ae.stepGroups&&ae.stepGroups.length>0?ae.stepGroups:null,ne=oe&&le.some(ue=>!ue||typeof ue!="object"||!ue.groupId?!1:oe.some(xe=>xe.id===ue.groupId));return oe&&ne?r.jsx("div",{className:"steps-container",children:oe.map(ue=>{const xe=le.filter(Pe=>(typeof Pe=="object"?Pe.groupId:null)===ue.id);return xe.length===0?null:r.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[ue.name!==""&&ue.name!=="Steps"&&r.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:ue.name}),r.jsx("div",{className:"steps-list",children:xe.map((Pe,Je)=>{const Xe=le.indexOf(Pe),Ye=typeof Pe=="object"?Pe.text:Pe,jt=we.steps?.[Xe],an=typeof jt=="object"?jt.text:jt,nn=We=>We?We.replace(/<[^>]*>?/gm,""):"";return r.jsxs(hn,{className:`step-card ${L.has(Xe)?"is-completed":""}`,onClick:()=>sn(Xe),children:[r.jsx("div",{className:"step-number",children:Xe+1}),r.jsx("p",{className:"step-text",children:Ct(nn(Ye),nn(an),!0)})]},Je)})})]},ue.id)})}):r.jsx("div",{className:"steps-list",children:le.map((ue,xe)=>{const Pe=typeof ue=="object"?ue.text:ue,Je=we.steps?.[xe],Xe=typeof Je=="object"?Je.text:Je;return r.jsxs(hn,{className:`step-card ${L.has(xe)?"is-completed":""}`,onClick:()=>sn(xe),children:[r.jsx("div",{className:"step-number",children:xe+1}),r.jsx("p",{className:"step-text",children:Ct(Pe,Xe,!0)})]},xe)})})})()]})]})}),r.jsx(bn,{isOpen:B,onClose:()=>q(!1),title:" ",size:"large",children:r.jsxs("div",{className:"print-preview-recipe",children:[r.jsx("div",{className:"preview-header",children:r.jsx("h2",{children:ae.title})}),r.jsxs("div",{className:"preview-meta",children:[ae.course&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ae.course]}),ae.category&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ae.category]}),ae.storeName&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ae.storeName]}),ae.servings&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ae.servings,""]})]}),ae.description&&r.jsx("div",{className:"preview-description",children:r.jsx("p",{children:ae.description})}),r.jsx("div",{className:"preview-controls",children:ae.type==="bread"?r.jsxs("div",{className:"preview-control-row",children:[r.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),r.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:K,onChange:oe=>de(oe.target.value),placeholder:"1000"}),K&&r.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>de(""),children:""}),ze?.grandTotal?r.jsxs("span",{className:"preview-control-note",children:[": ",ze.grandTotal.toLocaleString(),"g"]}):null]}):r.jsxs("div",{className:"preview-control-row",children:[r.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:Ne("scaleMultiplier")}),r.jsx("span",{className:"preview-control-mult",children:""}),r.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:pe,onChange:oe=>ve(oe.target.value),placeholder:"1"}),String(pe)!=="1"&&r.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>ve("1"),children:""})]})}),r.jsxs("div",{className:"preview-section",children:[r.jsx("h3",{children:Ne("ingredients")}),ae.type==="bread"?r.jsxs("div",{className:"preview-ingredients-bread",children:[r.jsxs("div",{className:"bread-group",children:[r.jsx("h4",{children:Ne("flourGroup")}),r.jsxs("table",{className:"preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:Ne("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:Ne("quantity")})]})}),r.jsx("tbody",{children:(dt.flours||[]).map((oe,ne)=>{const ue=`flour-${ne}`,xe=ze?ze.getScaledQtyValue(oe.quantity):oe.quantity;return r.jsxs("tr",{className:V.has(ue)?"is-completed":"",onClick:()=>Xt(ue),role:"button",tabIndex:0,onKeyDown:Pe=>{(Pe.key==="Enter"||Pe.key===" ")&&(Pe.preventDefault(),Xt(ue))},children:[r.jsx("td",{children:oe.name}),r.jsxs("td",{style:{textAlign:"right"},children:[xe,"g"]})]},ne)})})]})]}),r.jsxs("div",{className:"bread-group",children:[r.jsx("h4",{children:Ne("otherIngredients")}),r.jsxs("table",{className:"preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:Ne("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:Ne("quantity")})]})}),r.jsx("tbody",{children:(dt.breadIngredients||[]).map((oe,ne)=>{const ue=`bread-${ne}`,xe=ze?ze.getScaledQtyValue(oe.quantity):oe.quantity;return r.jsxs("tr",{className:V.has(ue)?"is-completed":"",onClick:()=>Xt(ue),role:"button",tabIndex:0,onKeyDown:Pe=>{(Pe.key==="Enter"||Pe.key===" ")&&(Pe.preventDefault(),Xt(ue))},children:[r.jsx("td",{children:oe.name}),r.jsxs("td",{style:{textAlign:"right"},children:[xe,"g"]})]},ne)})})]})]})]}):r.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const oe=ae.ingredientGroups&&ae.ingredientGroups.length>0?ae.ingredientGroups:null;return oe?oe.map(ne=>{const ue=ut.filter(xe=>xe.groupId===ne.id);return ue.length===0||["","Steps","Method",""].includes(ne.name)?null:r.jsxs("div",{className:"ingredient-group",children:[r.jsx("h4",{children:ne.name}),r.jsxs("table",{className:"preview-table preview-table--normal",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:Ne("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:Ne("quantity")}),r.jsx("th",{children:Ne("unit")})]})}),r.jsx("tbody",{children:ue.map((xe,Pe)=>{const Je=`${ne.id}-${Pe}`,Xe=typeof xe=="string"?xe:xe.name,Ye=typeof xe=="object"?je(xe.quantity,ie):"",jt=typeof xe=="object"?xe.unit:"";return r.jsxs("tr",{className:V.has(Je)?"is-completed":"",onClick:()=>Xt(Je),role:"button",tabIndex:0,onKeyDown:an=>{(an.key==="Enter"||an.key===" ")&&(an.preventDefault(),Xt(Je))},children:[r.jsx("td",{children:Xe}),r.jsx("td",{style:{textAlign:"right"},children:Ye}),r.jsx("td",{children:jt})]},Pe)})})]})]},ne.id)}):r.jsxs("table",{className:"preview-table preview-table--normal",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:Ne("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:Ne("quantity")}),r.jsx("th",{children:Ne("unit")})]})}),r.jsx("tbody",{children:ut.map((ne,ue)=>{const xe=`ungrouped-${ue}`,Pe=typeof ne=="string"?ne:ne.name,Je=typeof ne=="object"?je(ne.quantity,ie):"",Xe=typeof ne=="object"?ne.unit:"";return r.jsxs("tr",{className:V.has(xe)?"is-completed":"",onClick:()=>Xt(xe),role:"button",tabIndex:0,onKeyDown:Ye=>{(Ye.key==="Enter"||Ye.key===" ")&&(Ye.preventDefault(),Xt(xe))},children:[r.jsx("td",{children:Pe}),r.jsx("td",{style:{textAlign:"right"},children:Je}),r.jsx("td",{children:Xe})]},ue)})})]})})()})]}),le.length>0&&r.jsxs("div",{className:"preview-section",children:[r.jsx("h3",{children:Ne("instructions")}),r.jsx("ol",{className:"preview-steps",children:le.map((oe,ne)=>{const ue=typeof oe=="object"?oe.text:oe;return r.jsx("li",{className:J.has(ne)?"is-completed":"",onClick:()=>zn(ne),role:"button",tabIndex:0,onKeyDown:xe=>{(xe.key==="Enter"||xe.key===" ")&&(xe.preventDefault(),zn(ne))},children:ue},ne)})})]}),r.jsxs("div",{className:"modal-actions",children:[r.jsxs(ce,{variant:"primary",onClick:()=>window.print(),children:[" ",Ne("print")]}),r.jsx(ce,{variant:"ghost",onClick:()=>q(!1),children:Ne("close")})]})]})})]}),r.jsx(bn,{isOpen:lt,onClose:()=>pt(!1),title:" QR",size:"small",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",padding:"20px"},children:[r.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"#666",textAlign:"center"},children:["",r.jsx("br",{}),""]}),r.jsx("div",{style:{background:"white",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:r.jsx(s0,{value:ae.sourceUrl||"",size:200})}),r.jsx(ce,{variant:"secondary",onClick:()=>pt(!1),children:""})]})}),r.jsxs("div",{className:"print-layout",children:[r.jsx("div",{className:"recipe-detail__hero",children:ae.image?r.jsx("img",{src:ae.image,alt:ae.title,className:"recipe-detail__image"}):r.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),r.jsxs("div",{className:"recipe-detail__title-card",children:[r.jsx("h1",{children:zt(ae.title,we.title)}),Et&&r.jsx("p",{className:"recipe-detail__desc",children:zt(Et,we.description)})]}),r.jsxs("div",{className:"recipe-detail__meta",children:[ae.category&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:Ne("category")}),r.jsx("span",{className:"meta-value",children:zt(ae.category,we.category)})]}),ae.storeName&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:Ne("storeName")}),r.jsx("span",{className:"meta-value meta-value--store",children:zt(ae.storeName,we.storeName)})]}),ae.course&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:Ne("course")}),r.jsx("span",{className:"meta-value",children:zt(ae.course,we.course)})]}),ae.servings&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:Ne("servings")}),r.jsx("span",{className:"meta-value",children:zt(`${ae.servings}`,we.servings?`${we.servings}`:"")})]})]}),ae.sourceUrl&&r.jsxs("div",{className:"print-layout__source",children:[r.jsx("div",{className:"print-layout__source-label",children:Ne("sourceRecipe")}),r.jsx("div",{className:"print-layout__source-qr",children:r.jsx(s0,{value:ae.sourceUrl,size:84,style:{display:"block"}})})]}),r.jsxs("div",{className:"recipe-detail__main",children:[r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:Ne("ingredients")}),ae.type==="bread"&&ze?r.jsxs("div",{children:[r.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:Ne("flourGroup")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:Ne("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:Ne("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:Ne("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:Ne("cost")})]})}),r.jsx("tbody",{children:ze.flours.map((oe,ne)=>{const ue=we.flours?.[ne]||{},xe=ze.getScaledQtyValue(oe.quantity),Pe=K?"":ue.quantity;return r.jsxs("tr",{children:[r.jsx("td",{children:zt(oe.name,ue.name)}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:zt(xe,Pe)}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[ze.calcPercent(oe.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(oe.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:oe.cost?`${ze.formatCostValue(oe.cost)}`:"-"})]},`print-flour-${ne}`)})})]})]}),r.jsxs("div",{className:"bread-section",children:[r.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:Ne("otherIngredients")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:Ne("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:Ne("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:Ne("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:Ne("cost")})]})}),r.jsx("tbody",{children:ze.others.map((oe,ne)=>{const ue=we.breadIngredients?.[ne]||{},xe=ze.getScaledQtyValue(oe.quantity),Pe=K?"":ue.quantity;return r.jsxs("tr",{children:[r.jsx("td",{children:zt(oe.name,ue.name)}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:zt(xe,Pe)}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[ze.calcPercent(oe.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(oe.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:oe.cost?`${ze.formatCostValue(oe.cost)}`:"-"})]},`print-others-${ne}`)})})]})]})]}):$e.map(oe=>{const ne=we.ingredientGroups?.find(ue=>ue.id===oe.id)?.name||"";return r.jsxs("div",{style:{marginBottom:"1.2rem"},children:[oe.name&&r.jsx("div",{className:"print-group-heading",children:zt(oe.name,ne)}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:Ne("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:Ne("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:Ne("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:Ne("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:Ne("cost")})]})}),r.jsx("tbody",{children:oe.items.map((ue,xe)=>{const Pe=typeof ue=="object"?ue.quantity:"",Je=typeof ue=="object"?ue.unit:"",Xe=typeof ue=="object"?ue.purchaseCost:null,Ye=typeof ue=="object"?ue.cost:null,jt=typeof ue=="string"?ue:ue.name,an=typeof ue=="object"?je(ue.quantity,ie):Pe,nn=ut.indexOf(ue),We=we.ingredients?.[nn],_t=We?typeof We=="string"?We:We.name:"",fn=We&&typeof We=="object"?We.unit:"",Qn=String(ie)==="1"&&We&&typeof We=="object"?We.quantity:"";return r.jsxs("tr",{children:[r.jsx("td",{children:zt(jt,_t)}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:zt(an,Qn)}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:zt(Je,fn)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(Xe)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:vs(Ye)??"-"})]},`print-ing-${oe.id}-${xe}`)})})]})]},oe.id)}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[Ne("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Tt]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]}),r.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:Ne("instructions")}),le.length>0?r.jsx("div",{className:"steps-list",children:le.map((oe,ne)=>{const ue=typeof oe=="object"?oe.text:oe,xe=we.steps?.[ne],Pe=typeof xe=="object"?xe?.text:xe;return r.jsxs("div",{className:"step-card",children:[r.jsx("div",{className:"step-number",children:ne+1}),r.jsx("p",{className:"step-text",children:zt(ue,Pe)})]},`print-step-${ne}`)})}):r.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:Ne("noSteps")})]})]})]})]})},Zb=n=>{if(n==null)return"";let t=String(n);return t=t.replace(/[-]/g,i=>String.fromCharCode(i.charCodeAt(0)-65248)),t=t.replace(/[--]/g,i=>String.fromCharCode(i.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},$t=({label:n,id:t,error:i,textarea:a,wrapperClassName:o,...u})=>{const d=a?"textarea":"input",f=u.type==="number"||u.inputMode==="decimal"||u.inputMode==="numeric",h=p=>{if(!u.onChange)return;if(!f){u.onChange(p);return}const y=p?.target?.value??"",v=Zb(y);if(v===y){u.onChange(p);return}u.onChange({target:{id:p?.target?.id,name:p?.target?.name,value:v}})};return r.jsxs("div",{className:`input-group ${i?"input-group--error":""} ${o||""}`,children:[n&&r.jsx("label",{htmlFor:t,className:"input-label",children:n}),r.jsx(d,{id:t,className:`input-field ${u.className||""}`,style:u.style,...u,onChange:h}),i&&r.jsx("span",{className:"input-error",children:i})]})},xs="app-data",or={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await Ee.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const i=String(t||"").replace(/^\/+/,"");return`${n}/${i}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:i}=await Ee.storage.from(xs).list(n);if(i)return console.warn("Failed to list price files:",i.message),[];if(!t||t.length===0)return[];const a=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:f,error:h}=await Ee.storage.from(xs).download(d);if(h)return console.error(`Failed to download ${u.name}:`,h),null;const p=await f.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(p)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(p)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(a)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const i=this._cacheByUserId.get(t);if(i)return i;try{const a=new Map,o=await this._downloadAllCsvTexts(t);if(!o||o.length===0)return new Map;for(const{text:u}of o){if(!u)continue;const d=this.parseCSV(u);for(const[f,h]of d)if(a.has(f)){const p=a.get(f);(h?.dateStr||"")>(p?.dateStr||"")&&a.set(f,h)}else a.set(f,h)}return this._cacheByUserId.set(t,a),a}catch(a){return console.error("Error in fetchPriceList:",a),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:i,error:a}=await Ee.storage.from(xs).list(t);if(a)throw a;return i.filter(o=>String(o?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=n.name;this.clearCache(i);const o=this._getUserScopedPath(i,a),{data:u,error:d}=await Ee.storage.from(xs).upload(o,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(i){return console.error("Error uploading price list:",i),{success:!1,error:i}}},async deletePriceFile(n,t=null){try{const i=t||await this._getCurrentUserId();if(!i)throw new Error("");this.clearCache(i);const a=this._getUserScopedPath(i,n),{data:o,error:u}=await Ee.storage.from(xs).remove([a]);if(u)throw u;if(!o||o.length===0)throw new Error("");return{success:!0,data:o}}catch(i){return console.error("Error deleting price file:",i),{success:!1,error:i}}},_splitFileName(n){const t=String(n||""),i=t.lastIndexOf(".");return i<=0?{base:t,ext:""}:{base:t.slice(0,i),ext:t.slice(i)}},_makeCopyFileName(n,t){const i=String(n||"");if(!t?.has?.(i))return i;const{base:a,ext:o}=this._splitFileName(i),u=a||i||"price";let d=1;for(;d<1e3;){const f=d===1?"_copy":`_copy${d}`,h=`${u}${f}${o}`;if(!t.has(h))return h;d++}return`${u}_copy_${Date.now()}${o}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:t=null,onProgress:i=null}={}){const a=t||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("");if(o===a)throw new Error("");const{data:u,error:d}=await Ee.storage.from(xs).list(a);if(d)throw d;const f=(u||[]).map(w=>w?.name).filter(Boolean).filter(w=>String(w).toLowerCase().endsWith(".csv")),{data:h,error:p}=await Ee.storage.from(xs).list(o);let y=new Set;if(p){const w=String(p?.message||"").toLowerCase();if(w.includes("not found")||w.includes("404"))y=new Set;else throw p}else y=new Set((h||[]).map(w=>w?.name).filter(Boolean));const v={sourceUserId:a,targetUserId:o,copied:[],skipped:[],failed:[]},x=f.length;i?.({phase:"start",total:x,done:0,current:""});for(let w=0;w<f.length;w++){const _=f[w],C=this._makeCopyFileName(_,y);y.add(C);const S=this._getUserScopedPath(a,_),N=this._getUserScopedPath(o,C);i?.({phase:"progress",total:x,done:w,current:`${_}  ${C}`,fromFile:_,toFile:C});try{const{data:T,error:L}=await Ee.storage.from(xs).download(S);if(L)throw L;if(!T)throw new Error("");const{error:R}=await Ee.storage.from(xs).upload(N,T,{upsert:!1,contentType:"text/csv"});if(R){const J=String(R?.message||"").toLowerCase();if(J.includes("already exists")||J.includes("exists")||J.includes("409")){let H=0,V=R;for(;H<5;){H++;const k=this._makeCopyFileName(_,y);y.add(k);const M=this._getUserScopedPath(o,k),{error:z}=await Ee.storage.from(xs).upload(M,T,{upsert:!1,contentType:"text/csv"});if(!z){v.copied.push({fromFile:_,toFile:k}),V=null;break}V=z}if(V)throw V;continue}throw R}v.copied.push({fromFile:_,toFile:C})}catch(T){console.error("copyPriceFilesToUser failed:",T),v.failed.push({file:_,errorMessage:String(T?.message||T)})}i?.({phase:"progress",total:x,done:w+1,current:`${_}  ${C}`,fromFile:_,toFile:C})}return i?.({phase:"done",total:x,done:x,current:"",result:v}),this.clearCache(o),v},parseCSV(n){const t=new Map,i=n.split(/\r?\n/).filter(o=>o.trim());if(i.length===0)return t;if(i.some(o=>o.startsWith("D,")||o.startsWith('"D",')))for(let o of i){const u=[];let d="",f=!1;for(let S=0;S<o.length;S++){const N=o[S];N==='"'?f=!f:N===","&&!f?(u.push(d),d=""):d+=N}u.push(d);const h=u.map(S=>(S=S.trim(),S.startsWith('"')&&S.endsWith('"')?S.slice(1,-1):S));if(h[0]!=="D")continue;const p=h[1],y=h[8],v=h[14],x=h[18],w=h[20],_=String(v??"").trim(),C=Wt(_);if(C&&x){const S=parseFloat(x);if(!isNaN(S)){const N={price:S,vendor:y,unit:w,dateStr:p,displayName:_};if(t.has(C)){const T=t.get(C);(p||"")>=(T?.dateStr||"")&&t.set(C,N)}else t.set(C,N)}}}else{let o={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(i[0].split(",").map(h=>h.trim().replace(/^"|"$/g,"")).forEach((h,p)=>{["","","","","name","item"].some(y=>h.includes(y))&&(o.name=p),["","","","","price","cost"].some(y=>h.includes(y))&&(o.price=p),["","unit"].some(y=>h.includes(y))&&(o.unit=p),["","","","vendor","supplier"].some(y=>h.includes(y))&&(o.vendor=p)}),o.name===-1&&o.price===-1){o={name:0,price:1,unit:2,vendor:3};const h=i[0].split(",");isNaN(parseFloat(h[1]))&&(u=1)}else u=1;const f=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let h=u;h<i.length;h++){const p=i[h],y=[];let v="",x=!1;for(let R=0;R<p.length;R++){const J=p[R];J==='"'?x=!x:J===","&&!x?(y.push(v),v=""):v+=J}y.push(v);const w=y.map(R=>(R=R.trim(),R.startsWith('"')&&R.endsWith('"')?R.slice(1,-1):R)),_=o.name>-1?w[o.name]:null,C=o.price>-1?w[o.price]:null,S=o.unit>-1?w[o.unit]:"",N=o.vendor>-1?w[o.vendor]:"",T=String(_??"").trim(),L=Wt(T);if(L&&C){const R=parseFloat(C.replace(/[^0-9.]/g,""));isNaN(R)||t.set(L,{price:R,vendor:N,unit:S,dateStr:f,displayName:T})}}}return t},parseCSVEntries(n,t=""){const i=[],a=n.split(/\r?\n/).filter(x=>x.trim());if(a.length===0)return i;const o=x=>{const w=String(x??"").trim();if(!w)return null;const _=parseFloat(w.replace(/[^0-9.]/g,""));return Number.isFinite(_)?_:null},u=x=>{const w=[];let _="",C=!1;for(let S=0;S<x.length;S++){const N=x[S];N==='"'?C=!C:N===","&&!C?(w.push(_),_=""):_+=N}return w.push(_),w.map(S=>(S=S.trim(),S.startsWith('"')&&S.endsWith('"')?S.slice(1,-1):S))},d=x=>{const w=String(x??"").trim();if(!w)return"";const _=w.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(_)return`${_[1]}/${String(_[2]).padStart(2,"0")}/${String(_[3]).padStart(2,"0")}`;const C=w.match(/^(\d{4})(\d{2})(\d{2})$/);return C?`${C[1]}/${C[2]}/${C[3]}`:w};if(a.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of a){const w=u(x);if(w[0]!=="D")continue;const _=d(w[1]),C=w[8],S=w[14],N=w[18],T=o(w[19]),L=w[20],R=String(S??"").trim(),J=Wt(R);if(!J||!N)continue;const H=o(N);Number.isFinite(H)&&i.push({key:J,displayName:R,price:H,vendor:C,unit:L,dateStr:_,incomingQty:T,sourceFile:t})}return i}let h={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},p=0;if(a[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,w)=>{const _=String(x||"").toLowerCase();["","","","","name","item"].some(C=>_.includes(C))&&(h.name=w),["","","","","price","cost"].some(C=>_.includes(C))&&(h.price=w),["","unit"].some(C=>_.includes(C))&&(h.unit=w),["","","","vendor","supplier"].some(C=>_.includes(C))&&(h.vendor=w),["","","","date"].some(C=>_.includes(C))&&(h.date=w),["","","","","","qty","quantity"].some(C=>_.includes(C))&&(h.quantity=w)}),h.name===-1&&h.price===-1){h={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=a[0].split(",");isNaN(parseFloat(x[1]))&&(p=1)}else p=1;const v=d(new Date().toISOString().slice(0,10));for(let x=p;x<a.length;x++){const w=u(a[x]),_=h.name>-1?w[h.name]:null,C=h.price>-1?w[h.price]:null,S=h.unit>-1?w[h.unit]:"",N=h.vendor>-1?w[h.vendor]:"",T=h.date>-1?w[h.date]:"",L=h.quantity>-1?o(w[h.quantity]):null,R=String(_??"").trim(),J=Wt(R);if(!J||!C)continue;const H=o(C);Number.isFinite(H)&&i.push({key:J,displayName:R,price:H,vendor:N,unit:S,dateStr:d(T)||v,incomingQty:L,sourceFile:t})}return i},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const i=this._historyCacheByUserId.get(t);if(i)return i;try{const a=await this._downloadAllCsvTexts(t);if(!a||a.length===0)return new Map;const o=new Map;for(const{fileName:u,text:d}of a){if(!d)continue;this.parseCSVEntries(d,u).forEach(h=>{const p=h?.key;p&&(o.has(p)||o.set(p,[]),o.get(p).push(h))})}for(const u of o.values())u.sort((d,f)=>{const h=String(d?.dateStr||""),p=String(f?.dateStr||"");if(h!==p)return h.localeCompare(p);const y=Number(d?.price),v=Number(f?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(f?.sourceFile||""))});return this._historyCacheByUserId.set(t,o),o}catch(a){return console.error("Error in fetchPriceHistory:",a),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),i=[];for(const[a,o]of t.entries())if(o&&typeof o=="object"){const{displayName:u,...d}=o;i.push({name:u||a,...d})}else i.push({name:a,price:o});return i.sort((a,o)=>a.dateStr&&o.dateStr?o.dateStr.localeCompare(a.dateStr):a.name.localeCompare(o.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(Wt(n))||null}},bl={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:i}=await Ee.rpc("search_ingredients",{search_query:n,max_results:15});return i?(console.warn(" Database search failed:",i),console.warn("Error message:",i.message),console.warn("Error code:",i.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){const t=String(n||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const i=t.toLowerCase(),a=Wt(t);try{const o=await this._searchFromDatabase(i);if(o&&Array.isArray(o)){this._lastDbResults=o,this._lastDbQuery=i;const d=o.map(S=>({name:S.ingredient_name,price:S.last_price,size:S.packet_size,unit:S.packet_unit,itemCategory:S.item_category||null,source:"manual",displaySource:" "}));if(d.length===0)return await this._fallbackSearch(i);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[S,N]=await Promise.all([or.getPriceListArray(),Ln.getAllConversions()]),T=Array.from(N.values()).map(H=>({name:H.ingredientName,price:H.lastPrice,size:H.packetSize,unit:H.packetUnit,itemCategory:H.itemCategory||null,source:"manual",displaySource:" "})),L=S.map(H=>({name:H.name,price:H.price,size:null,unit:H.unit,source:"csv",displaySource:" CSV"})),R=new Set(T.map(H=>H.name)),J=L.filter(H=>!R.has(H.name));this._csvCache=[...T,...J]}const f=S=>{if(!a)return null;const N=String(S||"").indexOf(a);return N<0?null:{tier:S===a?0:N===0?1:2,idx:N,len:String(S||"").length}},h=(S,N)=>S.score.tier!==N.score.tier?S.score.tier-N.score.tier:S.score.idx!==N.score.idx?S.score.idx-N.score.idx:S.score.len!==N.score.len?S.score.len-N.score.len:S.name.localeCompare(N.name,"ja"),p=(S,N,T)=>{let L=0;for(;L<S.length&&h(S[L],N)<=0;)L++;S.splice(L,0,N),S.length>T&&S.pop()},v=Math.max(0,15-d.length),x=new Set(d.map(S=>Wt(S.name))),w=[],_=new Set;if(v>0)for(const S of this._csvCache){const N=Wt(S?.name);if(!N||x.has(N)||_.has(N))continue;const T=f(N);T&&(_.add(N),p(w,{...S,nameKey:N,score:T},v))}const C=w.map(S=>({name:S.name,price:S.price,size:S.size,unit:S.unit,source:S.source,displaySource:S.displaySource}));return[...d,...C]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",o);const u=await this._fallbackSearch(i);return console.log(" Fallback search returned:",u.length,"results"),u}catch(o){return console.error("Error searching ingredients:",o),[]}},async _fallbackSearch(n){try{const t=Wt(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[h,p]=await Promise.all([or.getPriceListArray(),Ln.getAllConversions()]);console.log(" CSV Data rows:",h.length),console.log(" Manual Data items:",p.size);const y=Array.from(p.values()).map(_=>({name:_.ingredientName,price:_.lastPrice,size:_.packetSize,unit:_.packetUnit,itemCategory:_.itemCategory||null,source:"manual",displaySource:" "})),v=h.map(_=>({name:_.name,price:_.price,size:null,unit:_.unit,source:"csv",displaySource:" CSV"})),x=new Set(y.map(_=>_.name)),w=v.filter(_=>!x.has(_.name));this._csvCache=[...y,...w],console.log(" Cache built. Total items:",this._csvCache.length)}const i=h=>{if(!t)return null;const p=String(h||"").indexOf(t);return p<0?null:{tier:h===t?0:p===0?1:2,idx:p,len:String(h||"").length}},a=(h,p)=>h.score.tier!==p.score.tier?h.score.tier-p.score.tier:h.score.idx!==p.score.idx?h.score.idx-p.score.idx:h.score.len!==p.score.len?h.score.len-p.score.len:h.name.localeCompare(p.name,"ja"),o=(h,p,y)=>{let v=0;for(;v<h.length&&a(h[v],p)<=0;)v++;h.splice(v,0,p),h.length>y&&h.pop()},u=15,d=[],f=new Set;for(const h of this._csvCache){const p=Wt(h?.name);if(!p||f.has(p))continue;const y=i(p);y&&(f.add(p),o(d,{...h,nameKey:p,score:y},u))}return d.map(h=>({name:h.name,price:h.price,size:h.size,unit:h.unit,itemCategory:h.itemCategory||null,source:h.source,displaySource:h.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},Ed=({value:n,onChange:t,placeholder:i,disabled:a,onSelect:o,name:u,required:d=!1,triggerSearchKey:f})=>{const[h,p]=b.useState([]),[y,v]=b.useState(!1),[x,w]=b.useState(-1),_=b.useRef(null),C=b.useRef(null),[S,N]=b.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),T=b.useCallback(()=>{if(_.current){const k=_.current.getBoundingClientRect(),M=8,z=4,U=k.top-M,F=window.innerHeight-k.bottom-M,$=(U>=180||U>=F)&&U>=110,P=Math.max(110,Math.min(280,$?U-z:F-z)),E=k.left,B=Math.max(220,window.innerWidth-M*2),q=Math.min(Math.max(k.width,220),B),Q=Math.min(Math.max(M,E),window.innerWidth-M-q);N({top:$?k.top-z:k.bottom+z,left:Q,width:q,maxHeight:P,placeAbove:$})}},[]);b.useEffect(()=>{const k=U=>{_.current&&!_.current.contains(U.target)&&C.current&&!C.current.contains(U.target)&&v(!1)},M=U=>{C.current&&C.current.contains(U.target)||v(!1)},z=()=>{y&&T()};return document.addEventListener("mousedown",k),window.addEventListener("scroll",M,{capture:!0}),window.addEventListener("resize",z),()=>{document.removeEventListener("mousedown",k),window.removeEventListener("scroll",M,{capture:!0}),window.removeEventListener("resize",z)}},[y,T]),b.useEffect(()=>{y&&T()},[y,h,T]),b.useEffect(()=>{if(f!=null&&String(n||"").trim().length>0){const k=String(n).trim();let M=!1;return(async()=>{const U=++L.current,F=await bl.search(k);!M&&U===L.current&&(p(F),v(F.length>0),w(-1),T())})(),()=>{M=!0}}},[f]);const L=b.useRef(0),R=b.useRef(null),J=async k=>{const M=k.target.value;if(t(k),R.current&&clearTimeout(R.current),M.length===0){v(!1);return}R.current=setTimeout(async()=>{if(M.length>0){const z=++L.current;console.log(" AutocompleteInput: Fetching suggestions for:",M);const U=await bl.search(M);console.log(" AutocompleteInput: Got",U.length,"suggestions"),z===L.current&&(p(U),v(U.length>0),w(-1))}},150)},H=k=>{const M={target:{value:k.name}};t(M),v(!1),o&&o(k)},V=k=>{y&&(k.key==="ArrowDown"?(k.preventDefault(),w(M=>M<h.length-1?M+1:M)):k.key==="ArrowUp"?(k.preventDefault(),w(M=>M>0?M-1:-1)):k.key==="Enter"?x>=0&&(k.preventDefault(),H(h[x])):k.key==="Escape"&&v(!1))};return r.jsxs("div",{className:"autocomplete-wrapper",ref:_,children:[r.jsx("input",{type:"text",className:"input-field autocomplete-input",name:u,value:n,onChange:J,onKeyDown:V,onFocus:async()=>{if(n&&n.length>0){T();const k=await bl.search(n);p(k),v(k.length>0)}else T()},placeholder:i,disabled:a,required:d}),y&&pa.createPortal(r.jsx("ul",{className:"suggestions-list",ref:C,style:{position:"fixed",top:`${S.top}px`,left:`${S.left}px`,width:`${S.width}px`,maxHeight:`${S.maxHeight}px`,transform:S.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:h.map((k,M)=>r.jsxs("li",{className:`suggestion-item ${M===x?"selected":""}`,onClick:()=>H(k),onMouseEnter:()=>w(M),children:[r.jsxs("div",{className:"suggestion-main",children:[r.jsx("span",{className:"suggestion-name",children:k.name}),k?.source&&k.source!=="manual"&&r.jsx("span",{className:"suggestion-source",children:k.displaySource})]}),r.jsxs("div",{className:"suggestion-details",children:[k.price&&`${Number(k.price).toLocaleString()}`,k.size&&` / ${k.size}${k.unit}`,!k.size&&k.unit&&` / ${k.unit}`]})]},`${k.source}-${M}`))}),document.body)]})},Ck=n=>new Promise((t,i)=>{const a=new FileReader;a.onerror=()=>i(new Error("")),a.onload=()=>{const o=String(a.result||""),u=o.includes(",")?o.split(",")[1]:o;t(u)},a.readAsDataURL(n)}),Nk={async transcribe(n,{mimeType:t,fileName:i,language:a="ja",promptContext:o}={}){if(!(n instanceof Blob))throw new Error("");const u=await Ck(n);if(!u)throw new Error("");const d={audioBase64:u,mimeType:t||n.type||"audio/webm",fileName:i||"voice-input.webm",language:a,promptContext:o||null},f=25e3,h=Ee.functions.invoke("transcribe",{body:d}),p=new Promise((x,w)=>{setTimeout(()=>w(new Error("")),f)}),{data:y,error:v}=await Promise.race([h,p]);if(v)throw new Error(v.message||"");if(y?.success!==!0)throw new Error(y?.error||"");return String(y?.text||"").trim()}},Ek=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"],kk=()=>{if(typeof MediaRecorder>"u")return"";for(const n of Ek)if(MediaRecorder.isTypeSupported(n))return n;return""},Tk=()=>typeof window>"u"?!1:!!(navigator?.mediaDevices?.getUserMedia&&typeof window.MediaRecorder<"u"),Ak=n=>{let t=String(n||"").trim();return t=t.replace(/[]+$/u,""),t.trim()},Rk=(n,t)=>{const i=String(n||"").trim(),a=Ak(t);return a?i?/[.!?]$/.test(i)?`${i}
${a}`:`${i}
${a}`:a:i},zi=({onTranscript:n,getCurrentValue:t,disabled:i=!1,size:a="sm",className:o="",label:u="",language:d="ja",promptContext:f})=>{const h=ws(),[p,y]=b.useState(!1),[v,x]=b.useState(!1),w=b.useRef(null),_=b.useRef(null),C=b.useRef([]),S=b.useRef(!0),N=b.useRef(!1),T=()=>{const M=_.current;M&&M.getTracks().forEach(z=>z.stop()),_.current=null},L=()=>{w.current=null,C.current=[]},R=()=>{console.warn("[VoiceInputButton] Forcing reset. Mounted:",S.current);try{T(),L()}catch(M){console.error("[VoiceInputButton] cleanup failed:",M)}finally{y(!1),x(!1)}},J=async()=>{if(!p&&!v)return;const M=w.current;if(!M){p&&R();return}try{M.state!=="inactive"?(M.stop(),y(!1),x(!0)):R()}catch(z){console.error("[VoiceInputButton] failed to stop recorder:",z),h.error(""),R()}},H=async()=>{if(!(i||p||v)){if(!Tk()){h.error("");return}try{N.current=!1;const M=await navigator.mediaDevices.getUserMedia({audio:!0});_.current=M;const z=kk(),U=z?new MediaRecorder(M,{mimeType:z}):new MediaRecorder(M);C.current=[],U.ondataavailable=F=>{F?.data?.size>0&&C.current.push(F.data)},U.onerror=F=>{console.error("[VoiceInputButton] MediaRecorder error:",F?.error||F),T(),L(),y(!1),x(!1),h.error("")},U.onstop=async()=>{if(N.current){T(),L(),S.current&&(y(!1),x(!1));return}S.current&&(y(!1),x(!0));try{const F=U.mimeType||z||"audio/webm",Y=new Blob(C.current,{type:F});if(Y.size===0)throw new Error("");const $=await Nk.transcribe(Y,{mimeType:F,fileName:`voice-input.${F.includes("mp4")?"m4a":"webm"}`,language:d,promptContext:f||void 0});if(!$){h.warning("");return}const P=typeof t=="function"?t():"",E=Rk(P,$);n?.(E,$),h.success("")}catch(F){console.error("[VoiceInputButton] transcription failed:",F),h.error(F?.message||"")}finally{try{T()}catch{}try{L()}catch{}y(!1),x(!1)}},w.current=U,U.start(),y(!0)}catch(M){if(console.error("[VoiceInputButton] failed to start recording:",M),M?.name==="NotAllowedError"||M?.name==="SecurityError"){h.error(""),R();return}h.error(""),R()}}};b.useEffect(()=>()=>{S.current=!1,N.current=!0;try{w.current&&w.current.state!=="inactive"&&w.current.stop()}catch{}T(),L()},[]);const V=()=>{if(!i){if(v){R();return}if(p){J();return}H()}},k=v?"...":p?"":u;return r.jsxs(ce,{type:"button",variant:"secondary",size:a,onClick:V,disabled:i,className:["voice-input-btn",p?"is-recording":"",o].filter(Boolean).join(" "),title:p?"":v?"":"",children:[p?"":v?"":""," ",k]})},ew=({isOpen:n,onClose:t,onApply:i,ingredientName:a,currentCost:o,currentQuantity:u,unit:d="g",initialPurchaseCost:f,initialContentAmount:h})=>{const[p,y]=b.useState(""),[v,x]=b.useState(""),[w,_]=b.useState(d),[C,S]=b.useState(""),[N,T]=b.useState(!1),[L,R]=b.useState(!1),J=b.useCallback(async()=>{if(R(!0),S(""),f&&h){y(f),x(h);const F=await Ln.getConversion(a);if(F)_(F.packetUnit||d),S(F.vendor||"");else{_(d);try{const Y=await or.getPrice(a);S(Y?.vendor||"")}catch{}}}else{const F=await Ln.getConversion(a);if(F)x(F.packetSize),_(F.packetUnit||d),F.lastPrice&&y(F.lastPrice),S(F.vendor||"");else try{const Y=await or.getPrice(a);if(Y)if(y(o||Y.price),S(Y.vendor||""),Y.unit){const $=Y.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if($){let P=$[1]?parseFloat($[1]):1,E=$[2]?$[2].trim().toLowerCase():"";E==="kg"?(P*=1e3,E="g"):E==="l"?(P*=1e3,E="ml"):E==="cl"?(P*=10,E="ml"):E==="pk"||E==="pack"?E="":E==="bag"?E="":(E==="pc"||E==="pcs")&&(E=""),x(P),_(E||d)}else x(1),_(Y.unit)}else x(""),_(d);else x(""),y(o||""),_(d),S("")}catch(Y){console.warn("Failed to load master price:",Y),x(""),y(o||""),_(d),S("")}}R(!1)},[a,f,h,d,o]);b.useEffect(()=>{if(!n||!a)return;const F=setTimeout(()=>{J()},0);return()=>clearTimeout(F)},[n,a,J]);const H=()=>{const F=parseFloat(p),Y=parseFloat(v);return!F||!Y?0:["g","ml","cc"].includes(w)?F/Y*1e3:w==="cl"?F/Y*100:(["kg","l"].includes(w),F/Y)},V=async()=>{const F=H();if(N&&v)try{await Ln.saveConversion(a,v,w,p,null,C)}catch(Y){console.error("Failed to save default conversion:",Y)}i(F,w,p,v,C),t()};if(!n)return null;const k=H(),M=String(d||"").trim().toLowerCase(),z=u?M==="cl"||M===""?k*(u*10/1e3):["g","ml","cc"].includes(M)?k*(u/1e3):k*u:0,U=r.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:r.jsx("div",{className:"unit-conversion-modal__card",onClick:F=>F.stopPropagation(),children:r.jsxs("div",{className:"unit-conversion-modal__body",children:[r.jsx("h3",{className:"unit-conversion-modal__title",children:""}),r.jsxs("div",{className:"unit-conversion-modal__field",children:[r.jsx("span",{className:"unit-conversion-modal__label",children:""}),r.jsx("div",{className:"unit-conversion-modal__value",children:a||"()"})]}),r.jsxs("div",{className:"unit-conversion-modal__inputs",children:[r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),r.jsx("input",{type:"number",value:p,onChange:F=>y(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:""}),r.jsxs("div",{className:"unit-conversion-modal__row",children:[r.jsx("input",{type:"number",value:v,onChange:F=>x(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),r.jsxs("select",{value:w,onChange:F=>_(F.target.value),className:"unit-conversion-modal__select",children:[r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:"p"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),!["g","ml","","","","","","cc","cl"].includes(w)&&r.jsx("option",{value:w,children:w})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:""}),r.jsx("input",{type:"text",value:C,onChange:F=>S(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),r.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:L?r.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[r.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),r.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(k).toLocaleString()]})]}),u&&r.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[r.jsxs("span",{children:[" (",u,d,"):"]}),r.jsxs("span",{children:["",Math.round(z).toLocaleString()]})]})]})}),r.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[r.jsx("input",{type:"checkbox",id:"saveDefault",checked:N,onChange:F=>T(F.target.checked)}),r.jsxs("span",{children:["(",v,w,")"]})]}),r.jsxs("div",{className:"unit-conversion-modal__actions",children:[r.jsx(ce,{type:"button",variant:"secondary",onClick:t,disabled:L,children:""}),r.jsx(ce,{type:"button",variant:"primary",onClick:V,disabled:!p||!v||L,children:""})]})]})})});return pa.createPortal(U,document.body)},ld=["","g","kg","ml","cc","cl","L","","","","","PC","","","","","","","","",""],Ok=new Set(["food","alcohol","soft_drink","supplies"]),Dk=new Set(["alcohol","supplies"]),tw={food:"",alcohol:"",soft_drink:"",supplies:""},Oi=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":Ok.has(t)?t:"":""},kd=n=>Dk.has(n),up=(n,t)=>{const i=Oi(t);return i?{...n,itemCategory:i,isAlcohol:kd(i)}:{...n,itemCategory:null}},Yn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},Mk=n=>{const t=String(n||"").trim().replace(/[]+$/u,""),i=t.match(/(\d+(?:\.\d+)?)/);if(i)return i[1];const a=[["","19"],["","18"],["","17"],["","16"],["","15"],["","14"],["","13"],["","12"],["","11"],["","90"],["","80"],["","70"],["","60"],["","50"],["","40"],["","30"],["","20"],["","10"],["","9"],["","8"],["","7"],["","6"],["","5"],["","4"],["","3"],["","2"],["","1"],["","0"],["","0"]],o=t.replace(/\s+/g,"");for(const[u,d]of a)if(o===u||o.startsWith(u))return d;return t},Mp=n=>{const t=Yn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},aa=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return Mp(i)/100},Lk=(n,t,i)=>{const a=Yn(n),o=Yn(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:["kg","","l",""].includes(u)?a/o:["cl",""].includes(u)?a/o*100:a/o},c0=(n,t,i,a=!1,o=1)=>{const u=Yn(n),d=Yn(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const f=Number.isFinite(o)&&o>0?o:1;if(a)return u/1e3*d/f;const h=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(h)||!h?u/1e3*d/f:["cl",""].includes(h)?u*10/1e3*d/f:u*d/f},zk=(n,t)=>{const i=Yn(n?.purchaseCost),a=Yn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},u0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Gr=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=u0(t);if(!a)return null;for(const[o,u]of n.entries())if(u0(o)===a)return u;return null},Uk=({formData:n,setFormData:t})=>{const i=ws(),[a,o]=b.useState(new Map),[u,d]=b.useState({isOpen:!1,type:null,index:null}),[f,h]=b.useState({key:0,type:null,index:null}),[p,y]=b.useState(new Map);b.useEffect(()=>{(async()=>{const[U,F]=await Promise.all([or.fetchPriceList(),Ln.getAllConversions()]);o(U),y(F)})()},[]);const x=(z=>z.reduce((U,F)=>U+(parseFloat(F.quantity)||0),0))(n.flours||[]),w=z=>!x||x===0?0:((parseFloat(z)||0)/x*100).toFixed(1);b.useEffect(()=>{if(p.size===0)return;const z=(Y=[])=>{let $=!1;return{adjusted:Y.map(E=>{if(!E||typeof E!="object")return E;const B=Gr(p,E.name);let q=E;const Q=Oi(E.itemCategory??E.item_category??B?.itemCategory);if(Q){const de=kd(Q);(Oi(E.itemCategory??E.item_category)!==Q||!!E.isAlcohol!==de)&&(q={...q,itemCategory:Q,isAlcohol:de})}const G=aa(E,B),A=c0(E.quantity,q.purchaseCost,E.unit,!0,G),O=Number.isFinite(A)?Math.round(A*100)/100:NaN,K=Yn(q.cost);if(Number.isFinite(O)&&(!Number.isFinite(K)||Math.abs(K-O)>.01)&&(q={...q,cost:O}),B&&B.packetSize){const pe=[B.lastPrice,E.purchaseCostRef,E.purchase_cost,E.purchaseCost].find(te=>Number.isFinite(Yn(te))),ve=Lk(pe,B.packetSize,B.packetUnit);if(Number.isFinite(ve)&&zk(E,ve)){const te=aa(E,B),W=Math.round(ve*100)/100,me=c0(E.quantity,W,E.unit,!0,te),ke=Number.isFinite(me)?Math.round(me*100)/100:q.cost,ie=Yn(q.purchaseCost),je=Yn(q.cost),Re=!Number.isFinite(ie)||Math.abs(ie-W)>.01,Oe=Number.isFinite(Yn(ke))&&(!Number.isFinite(je)||Math.abs(je-ke)>.01);(Re||Oe)&&(q={...q,purchaseCost:W,cost:ke})}}return q!==E&&($=!0),q}),changed:$}},U=z(n.flours||[]),F=z(n.breadIngredients||[]);!U.changed&&!F.changed||t(Y=>({...Y,flours:U.adjusted,breadIngredients:F.adjusted}))},[p,n.breadIngredients,n.flours,t]);const _=(z,U,F)=>{const Y=[...n.flours||[]];if(Y[z]={...Y[z],[U]:F},U==="name"){const $=a.get(Wt(F));if($){const P=typeof $=="object"?$.price:$,E=typeof $=="object"?$.vendor:null,B=typeof $=="object"?$.unit:null;Y[z].purchaseCostRef=P,Y[z].vendorRef=E;const q=Gr(p,F);if(q&&q.packetSize){let G=0;const A=q.lastPrice!==null&&q.lastPrice!==void 0&&q.lastPrice!==""?q.lastPrice:P,O=(q.packetUnit||"").trim().toLowerCase();["g",""].includes(O)?G=A/q.packetSize*1e3:["kg",""].includes(O)?G=A/q.packetSize:["ml","","cc",""].includes(O)?G=A/q.packetSize*1e3:["l",""].includes(O)?G=A/q.packetSize:["cl",""].includes(O)?G=A/q.packetSize*100:G=A/q.packetSize,Y[z].purchaseCost=Math.round(G*100)/100,Y[z].unit="g"}else Y[z].purchaseCost||(Y[z].purchaseCost=P,!Y[z].unit&&B&&(Y[z].unit=B));const Q=Oi(q?.itemCategory);Q?Y[z]=up(Y[z],Q):Y[z].itemCategory=null}else Y[z].purchaseCostRef=null,Y[z].vendorRef=null,Y[z].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(U)||U==="name"){const $=Y[z],P=parseFloat($.quantity),E=parseFloat($.purchaseCost);if(!isNaN(P)&&!isNaN(E)){let B=0;const q=($.unit||"").trim().toLowerCase();q==="g"||q===""||q==="ml"||q===""||q==="cc"||q===""||!q?B=P/1e3*E:q==="cl"||q===""?B=P*10/1e3*E:B=P*E;const Q=Gr(p,$.name),G=aa($,Q),A=Number.isFinite(G)&&G>0?G:1,O=Math.round(B/A*100)/100;O!==$.cost&&(Y[z].cost=O)}}t($=>({...$,flours:Y}))},C=(z,U,F)=>{const Y=[...n.breadIngredients||[]];if(Y[z]={...Y[z],[U]:F},U==="name"){const $=a.get(Wt(F));if($){const P=typeof $=="object"?$.price:$,E=typeof $=="object"?$.vendor:null,B=typeof $=="object"?$.unit:null;Y[z].purchaseCostRef=P,Y[z].vendorRef=E;const q=Gr(p,F);if(q&&q.packetSize){let G=0;const A=q.lastPrice!==null&&q.lastPrice!==void 0&&q.lastPrice!==""?q.lastPrice:P,O=(q.packetUnit||"").trim().toLowerCase();["g",""].includes(O)?(G=A/q.packetSize*1e3,Y[z].unit="g"):["kg",""].includes(O)?(G=A/q.packetSize,Y[z].unit="g"):["ml","","cc",""].includes(O)?(G=A/q.packetSize*1e3,Y[z].unit="ml"):["l",""].includes(O)?(G=A/q.packetSize,Y[z].unit="ml"):(G=A/q.packetSize,Y[z].unit=q.packetUnit),Y[z].purchaseCost=Math.round(G*100)/100}else Y[z].purchaseCost||(Y[z].purchaseCost=P,!Y[z].unit&&B&&(Y[z].unit=B));const Q=Oi(q?.itemCategory);Q?Y[z]=up(Y[z],Q):Y[z].itemCategory=null}else Y[z].purchaseCostRef=null,Y[z].vendorRef=null,Y[z].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(U)||U==="name"){const $=Y[z],P=parseFloat($.quantity),E=parseFloat($.purchaseCost);if(!isNaN(P)&&!isNaN(E)){let B=0;const q=$.unit?$.unit.trim().toLowerCase():"g";q==="g"||q===""||q==="ml"||q===""||q==="cc"||q===""?B=P/1e3*E:B=P*E;const Q=Gr(p,$.name),G=aa($,Q),A=Number.isFinite(G)&&G>0?G:1,O=Math.round(B/A*100)/100;O!==$.cost&&(Y[z].cost=O)}}t($=>({...$,breadIngredients:Y}))},S=(z,U,F)=>{const Y=Mk(F),$=Yn(Y);if(!Number.isFinite($)||$<0){i.warning("1015");return}z(U,"quantity",String(Y))},N=()=>{t(z=>({...z,flours:[...z.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},T=()=>{t(z=>({...z,breadIngredients:[...z.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},L=z=>{t(U=>({...U,flours:U.flours.filter((F,Y)=>Y!==z)}))},R=z=>{t(U=>({...U,breadIngredients:U.breadIngredients.filter((F,Y)=>Y!==z)}))},J=xa(hr(Al,{activationConstraint:{distance:10}}),hr(Rl,{activationConstraint:{delay:250,tolerance:5}}),hr(Tl,{coordinateGetter:Sd})),H=z=>{const{active:U,over:F}=z;U.id!==F.id&&t(Y=>{const P=Y.flours.some(q=>q.id===U.id)?"flours":"breadIngredients",E=Y[P].findIndex(q=>q.id===U.id),B=Y[P].findIndex(q=>q.id===F.id);return E!==-1&&B!==-1?{...Y,[P]:Ui(Y[P],E,B)}:Y})};b.useEffect(()=>{if(!n.flours)t(z=>({...z,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const z=n.flours.map(U=>U.id?U:{...U,id:crypto.randomUUID()});JSON.stringify(z)!==JSON.stringify(n.flours)&&t(U=>({...U,flours:z}))}if(!n.breadIngredients)t(z=>({...z,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const z=n.breadIngredients.map(U=>U.id?U:{...U,id:crypto.randomUUID()});JSON.stringify(z)!==JSON.stringify(n.breadIngredients)&&t(U=>({...U,breadIngredients:z}))}},[]);const V=(z,U,F,Y)=>{const{type:$,index:P}=u;t(E=>{if($==="flour"){const B=[...E.flours],q={...B[P],purchaseCost:z,unit:U,purchase_cost:F,content_amount:Y},Q=parseFloat(q.quantity),G=parseFloat(z);if(!isNaN(Q)&&!isNaN(G)){let A=0;U==="g"||U===""?A=Q/1e3*G:A=Q*G;const O=Gr(p,q.name),K=aa(q,O),de=Number.isFinite(K)&&K>0?K:1;q.cost=Math.round(A/de*100)/100}return B[P]=q,Ln.getAllConversions().then(A=>y(A)),bl.invalidateCache(),{...E,flours:B}}else if($==="ingredient"){const B=[...E.breadIngredients],q={...B[P],purchaseCost:z,unit:U,purchase_cost:F,content_amount:Y},Q=parseFloat(q.quantity),G=parseFloat(z);if(!isNaN(Q)&&!isNaN(G)){let A=0;U==="g"||U===""?A=Q/1e3*G:A=Q*G;const O=Gr(p,q.name),K=aa(q,O),de=Number.isFinite(K)&&K>0?K:1;q.cost=Math.round(A/de*100)/100}return B[P]=q,Ln.getAllConversions().then(A=>y(A)),bl.invalidateCache(),{...E,breadIngredients:B}}return E})},k=(z,U,F)=>{F&&t(Y=>{const $=z==="flour"?"flours":"breadIngredients",P=[...Y[$]||[]],E={...P[U]};if(E.name=F.name,E.itemCategory=null,F.price!==void 0&&F.price!==null&&F.price!==""){E.purchaseCostRef=F.price,E.vendorRef=F.source==="csv"?"CSV":"Master";let G=F.price,A=F.unit;if(F.source==="manual")if(F.size&&F.size>0){const O=(F.unit||"").trim().toLowerCase();["g",""].includes(O)?(G=F.price/F.size*1e3,A="g"):["kg",""].includes(O)?(G=F.price/F.size,A="g"):["ml","","cc",""].includes(O)?(G=F.price/F.size*1e3,A="ml"):["l",""].includes(O)?(G=F.price/F.size,A="ml"):["cl",""].includes(O)?(G=F.price/F.size*100,A="ml"):(G=F.price/F.size,A=F.unit)}else G=F.price,A=F.unit;else{const O=Gr(p,F.name);if(O&&O.packetSize){const K=O.lastPrice!==null&&O.lastPrice!==void 0&&O.lastPrice!==""?O.lastPrice:F.price,de=(O.packetUnit||"").trim().toLowerCase();["g",""].includes(de)?(G=K/O.packetSize*1e3,A="g"):["kg",""].includes(de)?(G=K/O.packetSize,A="g"):["ml","","cc",""].includes(de)?(G=K/O.packetSize*1e3,A="ml"):["l",""].includes(de)?(G=K/O.packetSize,A="ml"):["cl",""].includes(de)?(G=K/O.packetSize*100,A="ml"):(G=K/O.packetSize,A=O.packetUnit)}else G=F.price,A=F.unit}E.purchaseCost=Math.round(G*100)/100,z==="flour"?E.unit="g":A&&(E.unit=A)}const B=Oi(F.itemCategory??F.item_category??Gr(p,F.name)?.itemCategory);if(B){const G=up(E,B);Object.assign(E,G)}const q=parseFloat(E.quantity),Q=parseFloat(E.purchaseCost);if(!isNaN(q)&&!isNaN(Q)){const G=Gr(p,E.name),A=aa(E,G),O=Number.isFinite(A)&&A>0?A:1,K=(E.unit||"").trim().toLowerCase();let de=0;K==="g"||K===""||K==="ml"||K===""||K==="cc"||K===""?de=q/1e3*Q:K==="cl"||K===""?de=q*10/1e3*Q:de=q*Q,E.cost=Math.round(de/O*100)/100}return P[U]=E,{...Y,[$]:P}})},M=u.isOpen&&u.index!==null?u.type==="flour"?n.flours[u.index]:n.breadIngredients[u.index]:null;return r.jsxs("div",{className:"bread-form",children:[r.jsxs(hn,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[r.jsxs("div",{className:"bread-header",children:[r.jsxs("h3",{children:[" (Total: ",x,"g)"]}),r.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),r.jsxs("div",{className:"recipe-scroll-wrapper",children:[r.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[r.jsx("span",{})," ",r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{className:"text-center",children:"%"}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsx("div",{className:"bread-grid-body",children:r.jsx(Mi,{sensors:J,collisionDetection:ed,onDragEnd:H,id:"flours-dnd",children:r.jsx(va,{items:n.flours||[],strategy:Sl,children:(n.flours||[]).map((z,U)=>{const F=Gr(p,z?.name),Y=Mp(F?.yieldPercent??F?.yield_percent??z?.yieldPercent??z?.yield_percent);return r.jsx(Ik,{id:z.id,index:U,item:z,yieldPercentApplied:Y,onChange:_,onRemove:L,onSelect:k,calculatePercentage:w,floursLength:(n.flours||[]).length,onOpenConversion:()=>d({isOpen:!0,type:"flour",index:U}),onQuantityVoiceTranscript:($,P)=>S(_,$,P),onNameVoiceComplete:($,P)=>h(E=>({key:E.key+1,type:$,index:P})),voiceSearchTrigger:f},z.id)})})})})]}),r.jsx(ce,{type:"button",variant:"secondary",size:"sm",onClick:N,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),r.jsxs(hn,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[r.jsxs("div",{className:"bread-header",children:[r.jsx("h3",{children:""}),r.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),r.jsxs("div",{className:"recipe-scroll-wrapper",children:[r.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[r.jsx("span",{})," ",r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{className:"text-center",children:"%"}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsx("div",{className:"bread-grid-body",children:r.jsx(Mi,{sensors:J,collisionDetection:ed,onDragEnd:H,id:"breadIngredients-dnd",children:r.jsx(va,{items:n.breadIngredients||[],strategy:Sl,children:(n.breadIngredients||[]).map((z,U)=>{const F=Gr(p,z?.name),Y=Mp(F?.yieldPercent??F?.yield_percent??z?.yieldPercent??z?.yield_percent);return r.jsx(Bk,{id:z.id,index:U,item:z,yieldPercentApplied:Y,onChange:C,onRemove:R,onSelect:k,calculatePercentage:w,onOpenConversion:()=>d({isOpen:!0,type:"ingredient",index:U}),onQuantityVoiceTranscript:($,P)=>S(C,$,P),onNameVoiceComplete:($,P)=>h(E=>({key:E.key+1,type:$,index:P})),voiceSearchTrigger:f},z.id)})})})})]}),r.jsx(ce,{type:"button",variant:"secondary",size:"sm",onClick:T,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),r.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:r.jsx(ce,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),r.jsx(ew,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,type:null,index:null}),onApply:V,ingredientName:M?.name||"",currentCost:M?.purchaseCost,currentQuantity:M?.quantity,unit:M?.unit||"g",initialPurchaseCost:M?.purchase_cost,initialContentAmount:M?.content_amount})]})},Ik=({id:n,index:t,item:i,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:f,floursLength:h,onOpenConversion:p,onQuantityVoiceTranscript:y,onNameVoiceComplete:v,voiceSearchTrigger:x})=>{const w=Oi(i.itemCategory??i.item_category),_=!!w,C=tw[w]||"",S=_?`${C}${kd(w)?"10%":"8%"}`:"",{attributes:N,listeners:T,setNodeRef:L,transform:R,transition:J,isDragging:H}=ba({id:n}),V={transform:jr.Transform.toString(R),transition:J,opacity:H?.5:1,position:"relative",zIndex:H?999:"auto"};return r.jsxs("div",{ref:L,style:V,className:"form-ingredient-row--bread",children:[r.jsx("div",{...N,...T,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Ed,{value:i.name,onChange:k=>o(t,"name",k.target.value),onSelect:k=>d("flour",t,k),placeholder:": ",triggerSearchKey:x?.type==="flour"&&x?.index===t?x.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(zi,{size:"xs",label:"",getCurrentValue:()=>i.name,onTranscript:k=>{o(t,"name",k),v&&v("flour",t)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx($t,{type:"number",step:"any",value:i.quantity,onChange:k=>o(t,"quantity",k.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin",style:{width:"100%",minWidth:0}}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(zi,{size:"xs",label:"",getCurrentValue:()=>i.quantity,onTranscript:(k,M)=>y&&y(t,M),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:i.unit??"",onChange:k=>o(t,"unit",k.target.value),className:"input-field",style:{width:"100%",textAlign:"center",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),ld.filter(k=>k).map(k=>r.jsx("option",{value:k,children:k},k)),i.unit&&!ld.includes(i.unit)&&r.jsx("option",{value:i.unit,children:i.unit})]})}),r.jsxs("div",{className:"bread-percent",children:[f(i.quantity),"%"]}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[r.jsx($t,{type:"number",step:"any",value:i.purchaseCost||"",onChange:k=>o(t,"purchaseCost",k.target.value),placeholder:i.purchaseCostRef?`Ref: ${i.purchaseCostRef}`:"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:i.purchaseCostRef?`: ${i.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",onClick:p,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",i.purchaseCostRef," ",i.vendorRef&&`(${i.vendorRef})`]})]}),r.jsxs("div",{className:"ingredient-cost",children:[r.jsx($t,{type:"number",step:"any",value:i.cost||"",onChange:k=>o(t,"cost",k.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Yn(a))&&Yn(a)<99.999&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const k=Yn(a),M=Math.round(k*10)/10;return`${Number.isInteger(M)?Math.round(M):M}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:i.isAlcohol||!1,onChange:k=>o(t,"isAlcohol",k.target.checked),disabled:_,style:{cursor:_?"not-allowed":"pointer"},title:_?`${S}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:h>1&&r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},Bk=({id:n,index:t,item:i,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:f,onOpenConversion:h,onQuantityVoiceTranscript:p,onNameVoiceComplete:y,voiceSearchTrigger:v})=>{const x=Oi(i.itemCategory??i.item_category),w=!!x,_=tw[x]||"",C=w?`${_}${kd(x)?"10%":"8%"}`:"",{attributes:S,listeners:N,setNodeRef:T,transform:L,transition:R,isDragging:J}=ba({id:n}),H={transform:jr.Transform.toString(L),transition:R,opacity:J?.5:1,position:"relative",zIndex:J?999:"auto"};return r.jsxs("div",{ref:T,style:H,className:"form-ingredient-row--bread",children:[r.jsx("div",{...S,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Ed,{value:i.name,onChange:V=>o(t,"name",V.target.value),onSelect:V=>d("ingredient",t,V),placeholder:": ",triggerSearchKey:v?.type==="ingredient"&&v?.index===t?v.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(zi,{size:"xs",label:"",getCurrentValue:()=>i.name,onTranscript:V=>{o(t,"name",V),y&&y("ingredient",t)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx($t,{type:"number",step:"any",value:i.quantity,onChange:V=>o(t,"quantity",V.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin",style:{width:"100%",minWidth:0}}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(zi,{size:"xs",label:"",getCurrentValue:()=>i.quantity,onTranscript:(V,k)=>p&&p(t,k),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:i.unit??"",onChange:V=>o(t,"unit",V.target.value),className:"input-field",style:{width:"100%",textAlign:"center",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),ld.filter(V=>V).map(V=>r.jsx("option",{value:V,children:V},V)),i.unit&&!ld.includes(i.unit)&&r.jsx("option",{value:i.unit,children:i.unit})]})}),r.jsxs("div",{className:"bread-percent",children:[f(i.quantity),"%"]}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[r.jsx($t,{type:"number",step:"any",value:i.purchaseCost||"",onChange:V=>o(t,"purchaseCost",V.target.value),placeholder:i.purchaseCostRef?`Ref: ${i.purchaseCostRef}`:"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:i.purchaseCostRef?`: ${i.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",onClick:h,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",i.purchaseCostRef," ",i.vendorRef&&`(${i.vendorRef})`]})]}),r.jsxs("div",{className:"ingredient-cost",children:[r.jsx($t,{type:"number",step:"any",value:i.cost||"",onChange:V=>o(t,"cost",V.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Yn(a))&&Yn(a)<99.999&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const V=Yn(a),k=Math.round(V*10)/10;return`${Number.isInteger(k)?Math.round(k):k}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:i.isAlcohol||!1,onChange:V=>o(t,"isAlcohol",V.target.checked),disabled:w,style:{cursor:w?"not-allowed":"pointer"},title:w?`${C}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},d0=["","g","kg","ml","cc","cl","L","","","","","PC","","","","","","","","",""],$k=new Set(["food","alcohol","soft_drink","supplies"]),Pk=new Set(["alcohol","supplies"]),qk={food:"",alcohol:"",soft_drink:"",supplies:""},yl=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":$k.has(t)?t:"":""},od=n=>Pk.has(n),h0=(n,t)=>{const i=yl(t);return i?{...n,itemCategory:i,isAlcohol:od(i)}:{...n,itemCategory:null}},f0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Bs=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=f0(t);if(!a)return null;for(const[o,u]of n.entries())if(f0(o)===a)return u;return null},cr=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},Fk=n=>{const t=String(n||"").trim().replace(/[]+$/u,""),i=t.match(/(\d+(?:\.\d+)?)/);if(i)return i[1];const a=[["","19"],["","18"],["","17"],["","16"],["","15"],["","14"],["","13"],["","12"],["","11"],["","90"],["","80"],["","70"],["","60"],["","50"],["","40"],["","30"],["","20"],["","10"],["","9"],["","8"],["","7"],["","6"],["","5"],["","4"],["","3"],["","2"],["","1"],["","0"],["","0"]],o=t.replace(/\s+/g,"");for(const[u,d]of a)if(o===u||o.startsWith(u))return d;return t},nw=n=>{const t=cr(n);return!Number.isFinite(t)||t<=0||t>100?100:t},ll=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return nw(i)/100},Hk=(n,t,i)=>{const a=cr(n),o=cr(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:["kg","","l",""].includes(u)?a/o:["cl",""].includes(u)?a/o*100:a/o},dp=(n,t,i,a=1)=>{const o=cr(n),u=cr(t);if(!Number.isFinite(o)||!Number.isFinite(u))return NaN;const d=String(i||"").trim().toLowerCase();let f=0;["g","","ml","","cc",""].includes(d)?f=o/1e3*u:["cl",""].includes(d)?f=o*10/1e3*u:f=o*u;const h=Number.isFinite(a)&&a>0?a:1;return f/h},Vk=(n,t)=>{const i=cr(n?.purchaseCost),a=cr(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},Gk=_e.memo(({id:n,index:t,item:i,groupId:a,yieldPercentApplied:o,onChange:u,onRemove:d,handleSuggestionSelect:f,onOpenConversion:h,onQuantityVoiceTranscript:p,onNameVoiceComplete:y,voiceSearchTrigger:v})=>{const x=yl(i.itemCategory??i.item_category),w=!!x,_=qk[x]||"",C=w?`${_}${od(x)?"10%":"8%"}`:"",S=w?od(x):!!i.isAlcohol,{attributes:N,listeners:T,setNodeRef:L,transform:R,transition:J,isDragging:H}=ba({id:n,data:{groupId:a,index:t}}),V={transform:jr.Translate.toString(R),transition:J,opacity:H?.3:1,position:"relative",zIndex:H?999:"auto"};return r.jsxs("div",{ref:L,style:V,className:"form-ingredient-row",children:[r.jsx("div",{...N,...T,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Ed,{value:i.name,onChange:k=>u(a,t,"name",k.target.value),onSelect:k=>f(a,t,k),placeholder:"",triggerSearchKey:v?.groupId===a&&v?.index===t?v.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(zi,{size:"xs",label:"",getCurrentValue:()=>i.name,onTranscript:k=>{u(a,t,"name",k),y&&y(a,t)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx($t,{value:i.quantity,onChange:k=>u(a,t,"quantity",k.target.value),placeholder:"0",style:{width:"100%",minWidth:0},wrapperClassName:"input-group--no-margin"}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(zi,{size:"xs",label:"",getCurrentValue:()=>i.quantity,onTranscript:(k,M)=>p(a,t,M),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:i.unit??"",onChange:k=>u(a,t,"unit",k.target.value),className:"input-field",style:{width:"100%",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),d0.filter(k=>k).map(k=>r.jsx("option",{value:k,children:k},k)),i.unit&&!d0.includes(i.unit)&&r.jsx("option",{value:i.unit,children:i.unit})]})}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[r.jsx($t,{type:"number",value:i.purchaseCost,onChange:k=>u(a,t,"purchaseCost",k.target.value),step:"0.01",placeholder:i.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},title:i.purchaseCostRef?`: ${i.purchaseCostRef}${i.vendorRef?` (${i.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:h,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&r.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",i.purchaseCostRef]})]}),r.jsxs("div",{className:"ingredient-cost","data-label":"",children:[r.jsx($t,{type:"number",step:"0.01",value:i.cost,onChange:k=>u(a,t,"cost",k.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(cr(o))&&cr(o)<99.999&&r.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const k=cr(o),M=Math.round(k*10)/10;return`${Number.isInteger(M)?Math.round(M):M}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:S,onChange:k=>u(a,t,"isAlcohol",k.target.checked),disabled:w,style:{cursor:w?"not-allowed":"pointer"},title:w?`${C}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(a,t),children:""})})]})},(n,t)=>(a=>a&&a.groupId===t.groupId&&a.index===t.index)(t.voiceSearchTrigger)&&n.voiceSearchTrigger?.key!==t.voiceSearchTrigger?.key?!1:n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),Kk=({section:n,sections:t,onSectionChange:i,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=fc({id:n.id});return r.jsxs(hn,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[r.jsx($t,{value:n.name,onChange:d=>i(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),r.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&r.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),r.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[r.jsx("span",{}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&r.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},Yk=({formData:n,setFormData:t,priceList:i})=>{const a=ws(),[o,u]=b.useState(new Map);b.useEffect(()=>{Ln.getAllConversions().then(k=>u(k))},[]);const[d,f]=b.useState({isOpen:!1,groupId:null,index:null}),[h,p]=b.useState({key:0,groupId:null,index:null});b.useEffect(()=>{if(!n.ingredientSections){const k=n.ingredientGroups||[{id:"default",name:""}],M=n.ingredients||[],z=k.map(Y=>({id:Y.id,name:Y.name,items:M.filter($=>Y.id==="default"&&!$.groupId?!0:$.groupId===Y.id)})),U=new Set(z.flatMap(Y=>Y.items.map($=>$.id))),F=M.filter(Y=>!U.has(Y.id));F.length>0&&(z.length>0?z[0].items.push(...F):z.push({id:"default",name:"",items:F})),z.length===0&&z.push({id:crypto.randomUUID(),name:"",items:[]}),t(Y=>({...Y,ingredientSections:z}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const y=n.ingredientSections||[];b.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||o.size===0)return;let k=!1;const M=n.ingredientSections.map(z=>{const U=z.items.map(F=>{if(!F||typeof F!="object")return F;const Y=Bs(o,F.name);let $=F;const P=yl(F.itemCategory??F.item_category??Y?.itemCategory);if(P){const B=od(P);(yl(F.itemCategory??F.item_category)!==P||!!F.isAlcohol!==B)&&($={...$,itemCategory:P,isAlcohol:B})}if(Y&&Y.packetSize){const q=[Y.lastPrice,F.purchaseCostRef,F.purchase_cost,F.purchaseCost].find(G=>Number.isFinite(cr(G))),Q=Hk(q,Y.packetSize,Y.packetUnit);if(Number.isFinite(Q)&&Vk(F,Q)){const G=ll(F,Y),A=Math.round(Q*100)/100,O=dp(F.quantity,A,F.unit,G),K=Number.isFinite(O)?Math.round(O*100)/100:$.cost,de=cr($.purchaseCost),pe=cr($.cost),ve=!Number.isFinite(de)||Math.abs(de-A)>.01,te=Number.isFinite(cr(K))&&(!Number.isFinite(pe)||Math.abs(pe-K)>.01);(ve||te)&&($={...$,purchaseCost:A,cost:K})}}const E=ll(F,Y);if(Number.isFinite(E)&&E>0&&Math.abs(E-1)>1e-4){const B=dp(F.quantity,$.purchaseCost,F.unit,E),q=dp(F.quantity,$.purchaseCost,F.unit,1),Q=cr($.cost);if(Number.isFinite(B)&&(!Number.isFinite(Q)||Number.isFinite(q)&&Math.abs(Q-q)<=.01)){const A=Math.round(B*100)/100,O=cr($.cost);(!Number.isFinite(O)||Math.abs(O-A)>.01)&&($={...$,cost:A})}}return $!==F&&(k=!0),$});return U!==z.items?{...z,items:U}:z});k&&t(z=>({...z,ingredientSections:M}))},[o,n.ingredientSections,t]);const v=xa(hr(Al,{activationConstraint:{distance:10}}),hr(Rl,{activationConstraint:{delay:250,tolerance:5}}),hr(Tl,{coordinateGetter:Sd})),x=({active:k,over:M})=>{if(!M)return;const z=k.id,U=M.id,F=y.find($=>$.items.some(P=>P.id===z)),Y=y.find($=>$.items.some(P=>P.id===U))||y.find($=>$.id===U);!F||!Y||F===Y||t($=>{const P=F.items,E=Y.items,B=P.findIndex(G=>G.id===z),q=E.findIndex(G=>G.id===U);let Q;if(U===Y.id)Q=E.length+1;else{const A=M&&k.rect.current.translated&&k.rect.current.translated.top>M.rect.top+M.rect.height?1:0;Q=q>=0?q+A:E.length+1}return{...$,ingredientSections:$.ingredientSections.map(G=>G.id===F.id?{...G,items:P.filter(A=>A.id!==z)}:G.id===Y.id?{...G,items:[...E.slice(0,Q),P[B],...E.slice(Q,E.length)]}:G)}})},w=({active:k,over:M})=>{if(!M)return;const z=k.id,U=M.id,F=y.find($=>$.items.some(P=>P.id===z)),Y=y.find($=>$.items.some(P=>P.id===U))||y.find($=>$.id===U);if(F&&Y&&F===Y){const $=F.items.findIndex(E=>E.id===z),P=Y.items.findIndex(E=>E.id===U);$!==P&&t(E=>({...E,ingredientSections:E.ingredientSections.map(B=>B.id===F.id?{...B,items:Ui(B.items,$,P)}:B)}))}},_=(k,M,z,U)=>{const{groupId:F,index:Y}=d;F!==null&&Y!==null&&t($=>{const P=$.ingredientSections.map(E=>{if(E.id!==F)return E;const B=[...E.items],q={...B[Y],purchaseCost:k,unit:M,purchase_cost:z,content_amount:U},Q=parseFloat(q.quantity),G=parseFloat(k);if(!isNaN(Q)&&!isNaN(G)){const A=Bs(o,q.name),O=ll(q,A),K=M?M.trim().toLowerCase():"";let de=0;K==="g"||K===""||K==="ml"||K===""||K==="cc"||K===""?de=Q/1e3*G:K==="cl"||K===""?de=Q*10/1e3*G:de=Q*G;const pe=Number.isFinite(O)&&O>0?O:1;q.cost=Math.round(de/pe*100)/100}return B[Y]=q,{...E,items:B}});return Ln.getAllConversions().then(E=>u(E)),bl.invalidateCache(),{...$,ingredientSections:P}})},C=d.isOpen&&d.groupId!==null&&d.index!==null?y.find(k=>k.id===d.groupId)?.items[d.index]:null,S=_e.useCallback((k,M,z,U)=>{t(F=>{const Y=F.ingredientSections.map($=>{if($.id!==k)return $;const P=[...$.items],E={...P[M],[z]:U};if(P[M]=E,["quantity","purchaseCost","unit","name","isAlcohol"].includes(z)){const B=parseFloat(E.quantity),q=parseFloat(E.purchaseCost),Q=Bs(o,E.name),G=ll(E,Q),A=Number.isFinite(G)&&G>0?G:1;if(!isNaN(B)&&!isNaN(q)){let O=0;const K=E.unit?E.unit.trim().toLowerCase():"";K==="g"||K===""||K==="ml"||K===""||K==="cc"||K===""?O=B/1e3*q:K==="cl"||K===""?O=B*10/1e3*q:O=B*q;const de=Math.round(O/A*100)/100;de!==E.cost&&(E.cost=de,P[M]=E)}}if(z==="name"){const B=i.get(Wt(U)),q=Bs(o,U),Q=yl(q?.itemCategory);if(Q){const G=h0(E,Q);Object.assign(E,G)}else B||(E.itemCategory=null);if(B){const G=typeof B=="object"?B.price:B,A=typeof B=="object"?B.vendor:null,O=typeof B=="object"?B.unit:null,K=typeof B=="object"?B.size:null;if(E.purchaseCostRef=G,E.vendorRef=A,q&&q.packetSize){const ve=q.lastPrice!==null&&q.lastPrice!==void 0&&q.lastPrice!==""?q.lastPrice:G;let te=0;const W=(q.packetUnit||"").trim().toLowerCase();["g",""].includes(W)?(te=ve/q.packetSize*1e3,E.unit="g"):["kg",""].includes(W)?(te=ve/q.packetSize,E.unit="g"):["ml","","cc",""].includes(W)?(te=ve/q.packetSize*1e3,E.unit="ml"):["l",""].includes(W)?(te=ve/q.packetSize,E.unit="ml"):["cl",""].includes(W)?(te=ve/q.packetSize*100,E.unit="ml"):(te=ve/q.packetSize,E.unit=q.packetUnit),E.purchaseCost=Math.round(te*100)/100}else{let ve=G,te=O;K&&K>1&&(["g",""].includes((O||"").toLowerCase())?(ve=G/K*1e3,te="g"):["ml","","cc",""].includes((O||"").toLowerCase())?(ve=G/K*1e3,te="ml"):["cl",""].includes((O||"").toLowerCase())?(ve=G/K*100,te="ml"):["kg",""].includes(O?O.toLowerCase():"")?(ve=G/K,te="g"):["l",""].includes(O?O.toLowerCase():"")?(ve=G/K,te="ml"):ve=G/K),E.purchaseCost||(E.purchaseCost=Math.round(ve*100)/100),!E.unit&&te&&(E.unit=te)}const de=parseFloat(E.quantity),pe=parseFloat(E.purchaseCost);if(!isNaN(de)&&!isNaN(pe)){const ve=Bs(o,E.name),te=ll(E,ve),W=Number.isFinite(te)&&te>0?te:1,me=E.unit?E.unit.trim().toLowerCase():"";let ke=0;me==="g"||me===""||me==="ml"||me===""||me==="cc"||me===""?ke=de/1e3*pe:me==="cl"||me===""?ke=de*10/1e3*pe:ke=de*pe,E.cost=Math.round(ke/W*100)/100}}else E.purchaseCostRef=null,E.vendorRef=null;P[M]=E}return{...$,items:P}});return{...F,ingredientSections:Y}})},[o,i,t]),N=_e.useCallback((k,M,z)=>{const U=Fk(z),F=cr(U);if(!Number.isFinite(F)||F<0){a.warning("1015");return}S(k,M,"quantity",String(U))},[a,S]),T=_e.useCallback((k,M,z)=>{t(U=>{const F=U.ingredientSections.map(Y=>{if(Y.id!==k)return Y;const $=[...Y.items],P={...$[M]};if(P.name=z.name,P.itemCategory=null,z.price)if(P.purchaseCostRef=z.price,P.vendorRef=z.source==="csv"?"CSV":"Master",z.source==="manual")if(z.size&&z.size>0){const Q=(z.unit||"").trim().toLowerCase();if(["g",""].includes(Q)){const G=z.price/z.size*1e3;P.purchaseCost=Math.round(G*100)/100,P.unit="g"}else if(["kg",""].includes(Q)){const G=z.price/z.size;P.purchaseCost=Math.round(G*100)/100,P.unit="g"}else if(["ml","","cc",""].includes(Q)){const G=z.price/z.size*1e3;P.purchaseCost=Math.round(G*100)/100,P.unit="ml"}else if(["l",""].includes(Q)){const G=z.price/z.size;P.purchaseCost=Math.round(G*100)/100,P.unit="ml"}else if(["cl",""].includes(Q)){const G=z.price/z.size*100;P.purchaseCost=Math.round(G*100)/100,P.unit="ml"}else{const G=z.price/z.size;P.purchaseCost=Math.round(G*100)/100,P.unit=z.unit}}else P.purchaseCost=z.price,P.unit=z.unit;else{const Q=Bs(o,z.name);if(Q&&Q.packetSize){const G=Q.lastPrice!==null&&Q.lastPrice!==void 0&&Q.lastPrice!==""?Q.lastPrice:z.price;let A=0;const O=(Q.packetUnit||"").trim().toLowerCase();["g",""].includes(O)?(A=G/Q.packetSize*1e3,P.unit="g"):["kg",""].includes(O)?(A=G/Q.packetSize,P.unit="g"):["ml","","cc",""].includes(O)?(A=G/Q.packetSize*1e3,P.unit="ml"):["l",""].includes(O)?(A=G/Q.packetSize,P.unit="ml"):["cl",""].includes(O)?(A=G/Q.packetSize*100,P.unit="ml"):(A=G/Q.packetSize,P.unit=Q.packetUnit),P.purchaseCost=Math.round(A*100)/100}else P.purchaseCost=z.price,P.unit=z.unit}const E=yl(z.itemCategory??z.item_category??Bs(o,z.name)?.itemCategory);if(E){const Q=h0(P,E);Object.assign(P,Q)}const B=parseFloat(P.quantity),q=parseFloat(P.purchaseCost);if(!isNaN(B)&&!isNaN(q)){const Q=Bs(o,P.name),G=ll(P,Q),A=Number.isFinite(G)&&G>0?G:1,O=P.unit?P.unit.trim().toLowerCase():"";let K=0;O==="g"||O===""||O==="ml"||O===""||O==="cc"||O===""?K=B/1e3*q:O==="cl"||O===""?K=B*10/1e3*q:K=B*q,P.cost=Math.round(K/A*100)/100}return $[M]=P,{...Y,items:$}});return{...U,ingredientSections:F}})},[o,t]),L=_e.useCallback((k,M)=>{t(z=>({...z,ingredientSections:z.ingredientSections.map(U=>U.id===k?{...U,items:U.items.filter((F,Y)=>Y!==M)}:U)}))},[t]),R=k=>{const M={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(z=>({...z,ingredientSections:z.ingredientSections.map(U=>U.id===k?{...U,items:[...U.items,M]}:U)}))},J=()=>{t(k=>({...k,ingredientSections:[...k.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},H=k=>{t(M=>({...M,ingredientSections:M.ingredientSections.filter(z=>z.id!==k)}))},V=(k,M)=>{t(z=>({...z,ingredientSections:z.ingredientSections.map(U=>U.id===k?{...U,name:M}:U)}))};return r.jsxs(Mi,{sensors:v,collisionDetection:nb,onDragOver:x,onDragEnd:w,children:[r.jsxs("div",{className:"recipe-form-ingredients",children:[y.map(k=>r.jsx(va,{id:k.id,items:k.items.map(M=>M.id),strategy:Sl,children:r.jsxs(Kk,{section:k,sections:y,onSectionChange:V,onRemoveSection:H,children:[k.items.map((M,z)=>(()=>{const U=Bs(o,M?.name),F=nw(U?.yieldPercent??U?.yield_percent??M?.yieldPercent??M?.yield_percent);return r.jsx(Gk,{id:M.id,index:z,item:M,groupId:k.id,yieldPercentApplied:F,onChange:S,onRemove:L,handleSuggestionSelect:T,onOpenConversion:()=>f({isOpen:!0,groupId:k.id,index:z}),onQuantityVoiceTranscript:N,onNameVoiceComplete:(Y,$)=>p(P=>({key:P.key+1,groupId:Y,index:$})),voiceSearchTrigger:h},M.id)})()),r.jsx(ce,{type:"button",variant:"ghost",onClick:()=>R(k.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},k.id)),r.jsx(ce,{type:"button",variant:"secondary",onClick:J,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),r.jsx(tm,{dropAnimation:{sideEffects:em({styles:{active:{opacity:"0.5"}}})},children:null}),r.jsx(ew,{isOpen:d.isOpen,onClose:()=>f({isOpen:!1,groupId:null,index:null}),onApply:_,ingredientName:C?.name||"",currentCost:C?.purchaseCost,currentQuantity:C?.quantity,unit:C?.unit||"g",initialPurchaseCost:C?.purchase_cost,initialContentAmount:C?.content_amount})]})},Wk=({id:n,index:t,item:i,groupId:a,voiceInputEnabled:o,onChange:u,onRemove:d,onVoiceAppend:f})=>{const{attributes:h,listeners:p,setNodeRef:y,transform:v,transition:x,isDragging:w}=ba({id:n,data:{groupId:a,index:t}}),_={transform:jr.Translate.toString(v),transition:x,opacity:w?.3:1,position:"relative",zIndex:w?999:"auto"};return r.jsxs("div",{ref:y,style:{..._,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[r.jsx("div",{...h,...p,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),r.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),r.jsxs("div",{style:{flex:1},children:[r.jsx($t,{textarea:!0,value:i.text,onChange:C=>u(a,t,C.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}}),o&&r.jsx("div",{className:"step-row__voice-action",children:r.jsx(zi,{label:"",getCurrentValue:()=>i.text,onTranscript:C=>f(a,t,C)})})]}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(a,t),title:"",children:""})})]})},Qk=({section:n,sections:t,onSectionChange:i,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=fc({id:n.id});return r.jsxs(hn,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[r.jsx($t,{value:n.name,onChange:d=>i(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),r.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&r.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),r.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&r.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},Jk=({formData:n,setFormData:t,voiceInputEnabled:i=!1})=>{b.useEffect(()=>{if(!n.stepSections){const _=n.stepGroups||[{id:"default",name:""}],S=(n.steps||[]||[]).map(R=>typeof R=="string"?{id:crypto.randomUUID(),text:R}:R),N=_.map(R=>({id:R.id,name:R.name,items:S.filter(J=>R.id==="default"&&!J.groupId?!0:J.groupId===R.id)})),T=new Set(N.flatMap(R=>R.items.map(J=>J.id))),L=S.filter(R=>!T.has(R.id));L.length>0&&(N.length>0?N[0].items.push(...L):N.push({id:"default",name:"",items:L})),N.length===0&&N.push({id:crypto.randomUUID(),name:"",items:[]}),t(R=>({...R,stepSections:N}))}},[n.steps,n.stepGroups,n.stepSections,t]);const a=n.stepSections||[],o=xa(hr(Al,{activationConstraint:{distance:10}}),hr(Rl,{activationConstraint:{delay:250,tolerance:5}}),hr(Tl,{coordinateGetter:Sd})),u=({active:_,over:C})=>{if(!C)return;const S=_.id,N=C.id,T=a.find(R=>R.items.some(J=>J.id===S)),L=a.find(R=>R.items.some(J=>J.id===N))||a.find(R=>R.id===N);!T||!L||T===L||t(R=>{const J=T.items,H=L.items,V=J.findIndex(z=>z.id===S),k=H.findIndex(z=>z.id===N);let M;if(N===L.id)M=H.length+1;else{const U=C&&_.rect.current.translated&&_.rect.current.translated.top>C.rect.top+C.rect.height?1:0;M=k>=0?k+U:H.length+1}return{...R,stepSections:R.stepSections.map(z=>z.id===T.id?{...z,items:J.filter(U=>U.id!==S)}:z.id===L.id?{...z,items:[...H.slice(0,M),J[V],...H.slice(M,H.length)]}:z)}})},d=({active:_,over:C})=>{if(!C)return;const S=_.id,N=C.id,T=a.find(R=>R.items.some(J=>J.id===S)),L=a.find(R=>R.items.some(J=>J.id===N))||a.find(R=>R.id===N);if(T&&L&&T===L){const R=T.items.findIndex(H=>H.id===S),J=L.items.findIndex(H=>H.id===N);R!==J&&t(H=>({...H,stepSections:H.stepSections.map(V=>V.id===T.id?{...V,items:Ui(V.items,R,J)}:V)}))}},f=(_,C,S)=>{t(N=>({...N,stepSections:N.stepSections.map(T=>{if(T.id!==_)return T;const L=[...T.items];return L[C]={...L[C],text:S},{...T,items:L}})}))},h=(_,C)=>{t(S=>({...S,stepSections:S.stepSections.map(N=>N.id===_?{...N,items:N.items.filter((T,L)=>L!==C)}:N)}))},p=(_,C,S)=>{t(N=>({...N,stepSections:N.stepSections.map(T=>{if(T.id!==_)return T;const L=[...T.items];return L[C]={...L[C],text:S},{...T,items:L}})}))},y=_=>{const C={id:crypto.randomUUID(),text:""};t(S=>({...S,stepSections:S.stepSections.map(N=>N.id===_?{...N,items:[...N.items,C]}:N)}))},v=()=>{t(_=>({..._,stepSections:[..._.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},x=_=>{t(C=>({...C,stepSections:C.stepSections.filter(S=>S.id!==_)}))},w=(_,C)=>{t(S=>({...S,stepSections:S.stepSections.map(N=>N.id===_?{...N,name:C}:N)}))};return r.jsxs(Mi,{sensors:o,collisionDetection:nb,onDragOver:u,onDragEnd:d,children:[r.jsxs("div",{className:"recipe-form-steps",children:[a.map(_=>r.jsx(va,{id:_.id,items:_.items.map(C=>C.id),strategy:Sl,children:r.jsxs(Qk,{section:_,sections:a,onSectionChange:w,onRemoveSection:x,children:[_.items.map((C,S)=>r.jsx(Wk,{id:C.id,index:S,item:C,groupId:_.id,voiceInputEnabled:i,onChange:f,onRemove:h,onVoiceAppend:p},C.id)),r.jsx(ce,{type:"button",variant:"ghost",onClick:()=>y(_.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},_.id)),r.jsx(ce,{type:"button",variant:"secondary",onClick:v,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),r.jsx(tm,{dropAnimation:{sideEffects:em({styles:{active:{opacity:"0.5"}}})},children:null})]})},Xk="voice_input_enabled",Zk=15*1e3,cd=new Map,Uu=(n,t)=>{cd.set(n,{value:t===!0,expiresAt:Date.now()+Zk})},eT=n=>{const t=cd.get(n);return t?Date.now()>t.expiresAt?(cd.delete(n),null):t.value:null},tT=async n=>{const{data:t,error:i}=await Ee.rpc("get_feature_flag",{p_key:n});if(i)throw i;return t===!0},nT=async n=>{const{data:t,error:i}=await Ee.from("app_feature_flags").select("enabled").eq("feature_key",n).maybeSingle();if(i)throw i;return t?.enabled===!0},Lp={async getFlag(n,{force:t=!1}={}){if(!t){const i=eT(n);if(i!==null)return i}try{const i=await tT(n);return Uu(n,i),i}catch(i){console.warn("[featureFlagService] RPC get_feature_flag failed, fallback to table:",i);const a=await nT(n);return Uu(n,a),a}},async setFlag(n,t){const i=t===!0;try{const{data:a,error:o}=await Ee.rpc("admin_set_feature_flag",{p_key:n,p_enabled:i});if(o)throw o;return Uu(n,a?.enabled===!0),a?.enabled===!0}catch(a){console.warn("[featureFlagService] RPC admin_set_feature_flag failed, fallback to table:",a);const{data:o,error:u}=await Ee.from("app_feature_flags").upsert({feature_key:n,enabled:i,updated_at:new Date().toISOString()},{onConflict:"feature_key"}).select("enabled").single();if(u)throw u;const d=o?.enabled===!0;return Uu(n,d),d}},async getVoiceInputEnabled(){return!0},async setVoiceInputEnabled(n){return this.setFlag(Xk,n)},clearCache(){cd.clear()}},rw=({onClose:n,onImport:t,initialMode:i="url"})=>{const a=ws(),[o,u]=b.useState(i),[d,f]=b.useState(null),[h,p]=b.useState(""),[y,v]=b.useState(""),[x,w]=b.useState(null),[_,C]=b.useState(null),S="groq",[N,T]=b.useState(()=>{try{const ie=localStorage.getItem("preferredImageEngine");return!ie||ie==="auto"?S:ie}catch{return S}}),[L,R]=b.useState(!1),[J,H]=b.useState(!1),[V,k]=b.useState(null),[M,z]=b.useState(!1),U=b.useRef(null),F=b.useRef(null),Y=b.useRef(null),$=b.useRef(null),P=()=>{$.current&&(clearTimeout($.current),$.current=null)},E=(ie="")=>{if(P(),Y.current){try{Y.current.abort()}catch{}Y.current=null}H(!1),ie&&k(ie)};b.useEffect(()=>()=>{if(P(),Y.current){try{Y.current.abort()}catch{}Y.current=null}},[]),b.useEffect(()=>{if(!x){C(null);return}const ie=URL.createObjectURL(x);return C(ie),()=>URL.revokeObjectURL(ie)},[x]),b.useEffect(()=>{try{localStorage.setItem("preferredImageEngine",N)}catch{}},[N]);const B=ie=>new Promise(je=>{if(!ie||typeof ie!="object")return je(ie);const Re=String(ie.type||"").toLowerCase();if(!Re.startsWith("image/"))return je(ie);const Oe=2e6,qe=2e3,et=.9,at=String(ie.name||"").toLowerCase(),lt=Re.includes("heic")||Re.includes("heif")||at.endsWith(".heic")||at.endsWith(".heif"),pt=URL.createObjectURL(ie);let we=!1;const ae=dt=>{if(!we){we=!0;try{URL.revokeObjectURL(pt)}catch{}je(dt)}},Ge=setTimeout(()=>ae(ie),15e3),Ne=new Image;Ne.onload=()=>{const dt=Ne.naturalWidth||Ne.width||0,rt=Ne.naturalHeight||Ne.height||0;if(!dt||!rt)return clearTimeout(Ge),ae(ie);const Ve=Math.min(1,qe/Math.max(dt,rt)),ot=Math.max(1,Math.round(dt*Ve)),tt=Math.max(1,Math.round(rt*Ve)),St=Ve<1,gn=lt||ie.size>Oe;if(!St&&!gn)return clearTimeout(Ge),ae(ie);const Ct=document.createElement("canvas");Ct.width=ot,Ct.height=tt;const zt=Ct.getContext("2d");if(!zt)return clearTimeout(Ge),ae(ie);zt.drawImage(Ne,0,0,ot,tt),Ct.toBlob(Ft=>{if(clearTimeout(Ge),!Ft)return ae(ie);const rn=String(ie.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);ae(new File([Ft],`${rn}.jpg`,{type:"image/jpeg"}))},"image/jpeg",et)},Ne.onerror=()=>{clearTimeout(Ge),ae(ie)},Ne.src=pt}),q=async ie=>{if(ie){if(!String(ie.type||"").startsWith("image/")){k("");return}k(null),R(!0);try{const je=await B(ie);w(je||ie)}finally{R(!1)}}},Q=()=>U.current?.click?.(),G=()=>F.current?.click?.(),A=ie=>{ie.preventDefault(),ie.stopPropagation(),ie.type==="dragenter"||ie.type==="dragover"?z(!0):ie.type==="dragleave"&&z(!1)},O=ie=>{if(ie.preventDefault(),ie.stopPropagation(),z(!1),ie.dataTransfer.files&&ie.dataTransfer.files[0]){const je=ie.dataTransfer.files[0];je.type.startsWith("image/")&&q(je)}},K=ie=>/[---]/.test(ie||""),de=ie=>typeof ie=="string"?ie.trim():ie&&typeof ie=="object"?String(ie.text||ie.name||"").trim():"",pe=async ie=>{const je=[];je.push((ie.name||ie.title||"").trim()),je.push((ie.description||"").trim());const Re=[];Array.isArray(ie.ingredients)&&ie.ingredients.forEach((rt,Ve)=>{if(typeof rt=="string"){const tt=rt.trim();if(!tt)return;je.push(tt),Re.push(Ve);return}const ot=String(rt?.name||rt?.text||"").trim();ot&&(je.push(ot),Re.push(Ve))});const Oe=[];if(Array.isArray(ie.steps)&&ie.steps.forEach((rt,Ve)=>{const ot=de(rt);ot&&(je.push(ot),Oe.push(Ve))}),!je.some(rt=>String(rt||"").trim()))return ie;const{data:qe,error:et}=await Ee.auth.refreshSession(),at=qe?.session;if(et||!at?.access_token){const rt=et?.message||"",Ve=/refresh_token|session|expired|invalid|not found/i.test(rt);throw new Error(Ve?"":rt||"")}const lt=`${Go}/functions/v1/translate`,pt=await fetch(lt,{method:"POST",headers:{"Content-Type":"application/json",apikey:Vu,Authorization:`Bearer ${at.access_token}`},body:JSON.stringify({text:je,target_lang:"JA"})});if(!pt.ok){const rt=pt.status;if(rt===401)throw new Error("");let Ve="";try{const ot=await pt.text();if(ot)try{const tt=JSON.parse(ot);Ve=tt?.error||tt?.message||ot}catch{Ve=ot}}catch{}throw new Error(Ve||`: ${rt}`)}const we=await pt.json();if(we&&we.error)throw new Error(String(we.error));if(!Array.isArray(we?.translations))throw new Error("");const ae=we.translations.map(rt=>rt.text);let Ge=0;const Ne={...ie},dt=ae[Ge++]||Ne.name||Ne.title||"";if(Ne.name=dt,Ne.title=dt,Ne.description=ae[Ge++]||Ne.description,Re.length>0){const rt=new Map;Re.forEach((Ve,ot)=>{rt.set(Ve,ae[Ge+ot])}),Ne.ingredients=Ne.ingredients.map((Ve,ot)=>{const tt=rt.get(ot);return tt?typeof Ve=="string"?tt:Ve&&typeof Ve=="object"?{...Ve,name:tt}:Ve:Ve}),Ge+=Re.length}if(Oe.length>0){const rt=new Map;Oe.forEach((Ve,ot)=>{rt.set(Ve,ae[Ge+ot])}),Ne.steps=Ne.steps.map((Ve,ot)=>{const tt=rt.get(ot);return tt?Ve&&typeof Ve=="object"?{...Ve,text:tt}:tt:Ve})}return Ne},[ve,te]=b.useState([]),W=async()=>{H(!0),k(null),te([]);try{let ie,je="";if(o==="url"){if(!y)return;je=y;const{data:et,error:at}=await Ee.auth.refreshSession(),lt=et?.session;if(at||!lt?.access_token){const Ge=at?.message||"",Ne=/refresh_token|session|expired|invalid|not found/i.test(Ge);throw new Error(Ne?"":Ge||"")}const pt=`${Go}/functions/v1/scrape-recipe`,we=await fetch(pt,{method:"POST",headers:{"Content-Type":"application/json",apikey:Vu,Authorization:`Bearer ${lt.access_token}`},body:JSON.stringify({url:y})});if(!we.ok){const Ge=we.status;if(Ge===401)throw new Error("");if(Ge===403)throw new Error("URL");if(Ge>=500)throw new Error("");let Ne="";try{const dt=await we.text();if(dt)try{const rt=JSON.parse(dt);Ne=rt?.error||rt?.message||dt}catch{Ne=dt}}catch{}throw new Error(Ne||`URL: ${Ge}`)}ie=await we.json()}else{if(!x)return;P();const et=new AbortController;Y.current=et;const at=12e4;$.current=setTimeout(()=>{E("")},at),te(tt=>[...tt," ..."]);const lt=new FormData;lt.append("image",x),lt.append("engine",N);const pt=Go,we=Vu,ae=`${pt}/functions/v1/analyze-image`,{data:Ge,error:Ne}=await Ee.auth.refreshSession(),dt=Ge?.session;if(Ne||!dt?.access_token){const tt=Ne?.message||"",St=/refresh_token|session|expired|invalid/i.test(tt);throw new Error(St?"":tt||"")}const rt=dt.access_token,Ve={apikey:we,Authorization:`Bearer ${rt}`,"X-User-JWT":rt};let ot;try{ot=await fetch(ae,{method:"POST",headers:Ve,body:lt,signal:et.signal})}catch(tt){throw console.error("Network Error:",tt),new Error("")}if(ot.status===401){let tt="";try{tt=await ot.text()}catch{}if(/invalid\s+jwt|jwt\s+expired|token\s+expired/i.test(String(tt||"")))try{const{data:gn,error:Ct}=await Ee.auth.refreshSession(),zt=gn?.session;if(Ct||!zt?.access_token)throw Ct||new Error("No session after refresh");const Ft=zt.access_token;Ve.Authorization=`Bearer ${Ft}`,Ve["X-User-JWT"]=Ft,ot=await fetch(ae,{method:"POST",headers:Ve,body:lt,signal:et.signal})}catch(gn){throw console.warn("Session refresh failed:",gn),new Error("")}}if(!ot.ok){const tt=ot.status;let St="";try{const Ct=await ot.text();if(Ct)try{const zt=JSON.parse(Ct);St=zt?.message||zt?.error||Ct}catch{St=Ct}}catch{}const gn=St?`: ${St}`:"";throw new Error(`Server Error (${tt})${gn}`)}if(!ot.body)ie=await ot.json();else{const tt=ot.body.getReader(),St=new TextDecoder;let gn=null,Ct="",zt=!1;for(;;){const{done:Ft,value:rn}=await tt.read();if(Ft)break;Ct+=St.decode(rn,{stream:!0});const ln=Ct.split(`

`);Ct=ln.pop()||"";for(const sn of ln){const zn=sn.trim();if(zn.startsWith("data: "))try{const Xt=JSON.parse(zn.slice(6));if(Xt.type==="log")te(ee=>[...ee,Xt.message]);else if(Xt.type==="result")gn=Xt,zt=!0;else if(Xt.type==="error")throw new Error(Xt.message)}catch(Xt){if(Xt.message&&!Xt.message.includes("Failed to parse"))throw Xt;console.warn("Failed to parse SSE event",Xt)}}if(zt)break}try{await tt.cancel()}catch{}if(!gn)throw new Error("");ie=gn}}if(ie.error)throw new Error(ie.error);if(!ie.recipe)throw new Error("No recipe found");let Re=ie.recipe;if(Re.title=Re.title||Re.name||"",Re.name=Re.name||Re.title||"",Re.recipeYield=Re.recipeYield||Re.servings||"",Re.description=Re.description||"",!Re.ingredients&&Re.recipeIngredient&&(Re.ingredients=Re.recipeIngredient),Array.isArray(Re.ingredients)){const et=["","","method","instructions","steps","preparation"],at=[],lt=[];Re.ingredients.forEach(pt=>{const we=(pt.group||"").trim().toLowerCase();if(we&&et.some(ae=>we===ae||we.includes(ae))){const ae=pt.name||pt.text||"";ae&&lt.push(ae)}else at.push(pt)}),lt.length>0&&(console.log("Extracted steps from ingredients:",lt),Re.ingredients=at,Re.steps=Array.isArray(Re.steps)?Re.steps:[],Re.steps=[...Re.steps,...lt])}const Oe=Array.isArray(Re.steps)?Re.steps.slice(0,3).map(et=>de(et)).join(""):"",qe=`${Re.name||Re.title||""}${Oe}`;if(qe&&!K(qe)){f(Re),p(je),u("confirm-translation"),H(!1);return}t(Re,je),n()}catch(ie){if(console.error("Import failed details:",ie),ie?.name==="AbortError")return;const je=ie.message||"Import failed. Please try again.";k(je)}finally{P(),Y.current=null,o!=="confirm-translation"&&H(!1)}},me=async ie=>{H(!0),k(null);try{let je=d;ie&&(je=await pe(d)),t(je,h),n()}catch(je){console.error("Translation flow error:",je);const Re=je?.message||"";k(Re),a.warning(Re)}finally{H(!1)}},ke=ie=>{const je=ie.target.files[0];je&&q(je),ie.target.value=""};return r.jsxs("div",{className:"modal-overlay fade-in",children:[J&&r.jsx("div",{className:"analyze-status-popup",role:"status","aria-live":"polite",children:r.jsxs("div",{className:"analyze-status-popup-inner",children:[r.jsx("div",{className:"spinner"}),r.jsx("p",{className:"analyze-status-title",children:"..."}),ve.length>0&&r.jsx("div",{className:"progress-log-container",children:r.jsxs("div",{className:"progress-log",children:[ve.map((ie,je)=>r.jsx("div",{className:"log-entry",children:r.jsx("span",{className:"log-message",children:ie})},je)),r.jsx("div",{ref:ie=>ie?.scrollIntoView({behavior:"smooth"})})]})}),r.jsx("div",{className:"analyze-status-actions",children:r.jsx(ce,{type:"button",variant:"secondary",onClick:()=>E(),children:""})})]})}),r.jsxs(hn,{className:"import-modal-card",children:[r.jsx("h3",{className:"modal-title",children:o==="confirm-translation"?"":""}),o==="confirm-translation"?r.jsxs("div",{className:"translation-confirm-content",children:[r.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[r.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),r.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),V&&r.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:V}),r.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[r.jsx(ce,{type:"button",variant:"primary",onClick:()=>me(!0),isLoading:J,style:{width:"100%"},children:""}),r.jsx(ce,{type:"button",variant:"secondary",onClick:()=>me(!1),disabled:J,style:{width:"100%"},children:""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"import-mode-tabs",children:[r.jsx("button",{type:"button",onClick:()=>u("url"),className:`tab-btn tab-import-web ${o==="url"?"active":""}`,children:" Web URL"}),r.jsx("button",{type:"button",onClick:()=>u("image"),className:`tab-btn tab-import-image ${o==="image"?"active":""}`,children:"  (Best Effort)"})]}),o==="url"?r.jsxs(r.Fragment,{children:[r.jsx("p",{children:"URL"}),r.jsx("input",{type:"url",placeholder:"https://...",value:y,onChange:ie=>v(ie.target.value),className:"import-url-input",autoFocus:!0})]}):r.jsxs(r.Fragment,{children:[r.jsx("p",{children:""}),r.jsxs("div",{className:"image-engine-panel",children:[r.jsxs("label",{className:"image-engine-label",children:["",r.jsxs("select",{className:"image-engine-select",value:N,onChange:ie=>T(ie.target.value),disabled:J||L,children:[r.jsx("option",{value:"groq",children:"Groq"}),r.jsx("option",{value:"auto",children:"Best EffortGroqAzure OCRGroqGemini"}),r.jsx("option",{value:"gemini",children:"Gemini"}),r.jsx("option",{value:"groq_vision",children:"Groq"})]})]}),r.jsx("div",{className:"image-engine-help",children:"AIGroqBest EffortGeminiGemini"})]}),r.jsxs("div",{className:"image-upload-wrapper",children:[r.jsx("input",{ref:U,type:"file",accept:"image/*",capture:"environment",onChange:ke,className:"image-upload-input"}),r.jsx("input",{ref:F,type:"file",accept:"image/*",onChange:ke,className:"image-upload-input"}),r.jsx("div",{onDragEnter:A,onDragLeave:A,onDragOver:A,onDrop:O,className:`image-upload-label ${M?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{J||L||G()},onKeyDown:ie=>{J||L||(ie.key==="Enter"||ie.key===" ")&&(ie.preventDefault(),G())},children:_?r.jsx("img",{src:_,alt:"Preview",className:"image-upload-preview"}):M?"":""}),r.jsxs("div",{className:"image-upload-actions",children:[r.jsx(ce,{type:"button",variant:"secondary",onClick:Q,disabled:J||L,children:""}),r.jsx(ce,{type:"button",variant:"secondary",onClick:G,disabled:J||L,children:""})]})]}),L&&r.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),V&&r.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto"},children:V}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(ce,{type:"button",variant:"ghost",onClick:n,disabled:J,children:""}),r.jsx(ce,{type:"button",variant:"primary",onClick:W,isLoading:J,disabled:L||(o==="url"?!y:!x),children:""})]})]})]})]})},p0=({onSave:n,onCancel:t,initialData:i})=>{const a=i||{},[o,u]=b.useState("ingredients"),[d,f]=b.useState(null),[h,p]=b.useState(new Map);_e.useEffect(()=>{(async()=>{const E=await or.fetchPriceList();p(E)})()},[]);const y=b.useMemo(()=>{const P=a.steps||[""];let E=a.stepGroups||[];const B=P.some(Q=>typeof Q=="object"&&Q.group);if(E.length===0&&B){const Q=new Map;P.forEach(G=>{typeof G=="object"&&G.group&&!Q.has(G.group)&&Q.set(G.group,crypto.randomUUID())}),E=Array.from(Q.entries()).map(([G,A])=>({id:A,name:G}))}return{steps:P.map(Q=>{const G=typeof Q=="string"?Q:Q.text||"",A=typeof Q=="object"&&Q.id?Q.id:crypto.randomUUID();let O=typeof Q=="object"?Q.groupId:void 0;const K=typeof Q=="object"?Q.group:void 0;if(!O&&K&&E.length>0){const de=E.find(pe=>pe.name===K);de&&(O=de.id)}return{id:A,text:G,groupId:O}}),stepGroups:E}},[a]),v=y.steps,x=y.stepGroups,w=b.useMemo(()=>{const P=a.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let E=a.ingredientGroups||[];if(E.length===0&&P.some(q=>q.group)){const q=new Map;P.forEach(Q=>{Q.group&&!q.has(Q.group)&&q.set(Q.group,crypto.randomUUID())}),E=Array.from(q.entries()).map(([Q,G])=>({id:G,name:Q})),q.size>0&&P.some(Q=>!Q.group)}return{ingredients:P.map(q=>{const Q=typeof q=="string"?{name:q,quantity:"",unit:"",cost:"",purchaseCost:""}:{...q,cost:q.cost||"",purchaseCost:q.purchaseCost||""};let G=Q.groupId;if(!G&&Q.group&&E.length>0){const A=E.find(O=>O.name===Q.group);A&&(G=A.id)}return{...Q,id:Q.id||crypto.randomUUID(),groupId:G}}),ingredientGroups:E}},[a]),_=w.ingredients,C=w.ingredientGroups,[S,N]=b.useState({title:a.title||"",description:a.description||"",image:a.image||"",imageFile:null,storeName:a.storeName||"",servings:a.servings||"",ingredients:_,ingredientGroups:C,steps:v,stepGroups:x,tags:a.tags||[""],course:a.course||"",category:a.category||"",type:a.type||"normal",flours:a.flours||[],breadIngredients:a.breadIngredients||[],sourceUrl:a.sourceUrl||""}),[T,L]=b.useState(!1),[R,J]=b.useState(!1);b.useEffect(()=>{let P=!0;return(async()=>{try{const B=await Lp.getVoiceInputEnabled();P&&J(B)}catch(B){console.warn("[RecipeForm] failed to load voice input feature flag:",B),P&&J(!1)}})(),()=>{P=!1}},[]);const H=(P,E="")=>{const B=new Map,q=P.ingredients||[];q.forEach(pe=>{let ve=pe.group||"";ve==="Main"&&(ve=""),B.has(ve)||B.set(ve,crypto.randomUUID())});const Q=Array.from(B.entries()).map(([pe,ve])=>({id:ve,name:pe})),G=q.map(pe=>{let ve=pe.group||"";ve==="Main"&&(ve="");let te;return B.has(ve)&&(te=B.get(ve)),{id:crypto.randomUUID(),name:pe.name||"",quantity:pe.quantity||"",unit:pe.unit||"",cost:"",purchaseCost:"",groupId:te}}),A=new Map,O=P.steps||[];O.forEach(pe=>{typeof pe=="object"&&pe.group&&pe.group!=="Main"&&(A.has(pe.group)||A.set(pe.group,crypto.randomUUID()))});const K=Array.from(A.entries()).map(([pe,ve])=>({id:ve,name:pe})),de=O.map(pe=>{const ve=typeof pe=="object",te=ve?pe.text||"":pe,W=ve?pe.group:null;let me;return W&&A.has(W)&&(me=A.get(W)),{id:crypto.randomUUID(),text:te,groupId:me}});N(pe=>({...pe,title:P.name||P.title||pe.title,description:P.description||pe.description,category:E?"URL":P.category||pe.category,image:P.image||pe.image,servings:P.recipeYield||P.servings||pe.servings,ingredients:G,ingredientGroups:Q,steps:de,stepGroups:K,ingredientSections:void 0,stepSections:void 0,sourceUrl:E||pe.sourceUrl})),f(null),u("ingredients")},V=P=>{P.preventDefault(),P.stopPropagation(),P.type==="dragenter"||P.type==="dragover"?L(!0):P.type==="dragleave"&&L(!1)},k=P=>{if(P.preventDefault(),P.stopPropagation(),L(!1),P.dataTransfer.files&&P.dataTransfer.files[0]){const E=P.dataTransfer.files[0];E.type.startsWith("image/")&&N(B=>({...B,imageFile:E,image:URL.createObjectURL(E)}))}},M=P=>{const{id:E,value:B}=P.target;N(q=>({...q,[E]:B}))},z=P=>{const E=P.target.files[0];E&&N(B=>({...B,imageFile:E,image:URL.createObjectURL(E)}))},U=b.useMemo(()=>{if(S.type==="bread")return(S.flours?.length||0)+(S.breadIngredients?.length||0);const P=S.ingredientSections||[];return P.length>0?P.reduce((E,B)=>E+(B?.items?.length||0),0):S.ingredients?.length||0},[S.breadIngredients,S.flours,S.ingredientSections,S.ingredients,S.type]),F=b.useMemo(()=>{const P=S.stepSections||[];return P.length>0?P.reduce((E,B)=>E+(B?.items?.length||0),0):S.steps?.length||0},[S.stepSections,S.steps]),Y=P=>{P.preventDefault();let E=[],B=[];if(S.type==="bread")E=S.ingredients.map(K=>{const{id:de,...pe}=K;return pe});else{const K=S.ingredientSections||[];K.length===0&&S.ingredients.length>0?E=S.ingredients.map(de=>{const{id:pe,...ve}=de;return ve}):(E=K.flatMap(de=>de.items.map(pe=>({...pe,groupId:de.id}))).map(de=>{const{id:pe,...ve}=de;return ve}),B=K.map(de=>({id:de.id,name:de.name})))}const q=new Set(S.tags||[]);S.course&&q.add(S.course),S.category&&q.add(S.category),S.type==="bread"&&q.add("");const Q=Array.from(q).filter(Boolean);let G=[],A=[];const O=S.stepSections||[];O.length===0&&S.steps.length>0?G=S.steps.map(K=>typeof K=="string"?{text:K}:K):(G=O.flatMap(K=>K.items.map(de=>({text:de.text,groupId:K.id}))),A=O.map(K=>({id:K.id,name:K.name}))),n({...S,ingredients:E,ingredientGroups:B,steps:G,stepGroups:A,image:S.imageFile||S.image,id:a.id||Date.now(),tags:Q,ingredientSections:void 0,stepSections:void 0})},$=!!a?.id;return r.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:Y,children:[d&&r.jsx(rw,{onClose:()=>f(null),onImport:H,initialMode:d}),r.jsxs("div",{className:"recipe-form-mock__page",children:[r.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:r.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[r.jsxs("div",{className:"recipe-form-mock__crumb",children:[r.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),r.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),r.jsx("span",{className:"recipe-form-mock__crumb-page",children:$?"":""})]}),r.jsxs("div",{className:"recipe-form-mock__actions",children:[r.jsx(ce,{type:"button",variant:"ghost",onClick:t,children:""}),r.jsx(ce,{type:"submit",variant:"primary",children:""})]})]})}),r.jsxs("div",{className:"recipe-form-mock__sheet",children:[r.jsxs("header",{className:"recipe-form-mock__doc",children:[r.jsxs("div",{className:"recipe-form-mock__doc-title",children:[r.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:S.title,onChange:M,placeholder:"",required:!0}),r.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),r.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx($t,{label:"",id:"course",value:S.course,onChange:M,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),r.jsxs("datalist",{id:"course-options",children:[r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""})]})]}),r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx($t,{label:"",id:"category",value:S.category,onChange:M,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),r.jsxs("datalist",{id:"category-options",children:[r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""})]})]}),r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx($t,{label:"",id:"storeName",value:S.storeName,onChange:M,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),r.jsx("datalist",{id:"store-options",children:ad.map(P=>r.jsx("option",{value:P},P))})]}),r.jsx("div",{className:"recipe-form-mock__meta-field",children:r.jsx($t,{label:"",id:"servings",value:S.servings,onChange:M,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),r.jsxs("div",{className:"recipe-form-mock__grid",children:[r.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[r.jsxs(hn,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsx($t,{label:"",id:"description",textarea:!0,value:S.description,onChange:M,placeholder:"..."}),R&&r.jsx("div",{className:"recipe-form__voice-action",children:r.jsx(zi,{label:"",getCurrentValue:()=>S.description,onTranscript:P=>N(E=>({...E,description:P}))})}),r.jsx($t,{label:"URL",id:"sourceUrl",value:S.sourceUrl||"",onChange:M,placeholder:"https://example.com/recipe/..."})]}),r.jsxs(hn,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("div",{className:`recipe-form-mock__image-drop ${T?"is-active":""}`,onDragEnter:V,onDragLeave:V,onDragOver:V,onDrop:k,children:[S.image?r.jsxs("div",{className:"recipe-form-mock__image-preview",children:[r.jsx("img",{src:S.image,alt:"",onError:P=>{P.target.style.display="none"}}),r.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>N(P=>({...P,image:"",imageFile:null})),title:"",children:""})]}):r.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",r.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),r.jsx("input",{type:"file",accept:"image/*",onChange:z,className:"recipe-form-mock__image-input"})]})]}),!a?.id&&r.jsxs(hn,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("div",{className:"recipe-form-mock__import-actions",children:[r.jsx(ce,{variant:"secondary",type:"button",onClick:()=>f("url"),children:"URL"}),r.jsx(ce,{variant:"secondary",type:"button",onClick:()=>f("image"),children:""})]}),r.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),r.jsxs(hn,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[r.jsx("li",{children:""}),r.jsx("li",{children:""}),r.jsx("li",{children:""})]})]})]}),r.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:r.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[r.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[r.jsxs("div",{className:"recipe-form-mock__nav",children:[r.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",r.jsx("span",{className:"recipe-form-mock__nav-count",children:U.toLocaleString()})]}),r.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${o==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",r.jsx("span",{className:"recipe-form-mock__nav-count",children:F.toLocaleString()})]})]}),r.jsx("div",{className:"recipe-form-mock__workspace-right",children:o==="ingredients"?r.jsxs("div",{className:"recipe-form-mock__segmented",children:[r.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${S.type==="normal"?"active":""}`,onClick:()=>N(P=>({...P,type:"normal"})),children:""}),r.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${S.type==="bread"?"active":""}`,onClick:()=>N(P=>({...P,type:"bread"})),children:""})]}):r.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),r.jsx("div",{className:"recipe-form-mock__workspace-body",children:o==="ingredients"?r.jsx("div",{className:"recipe-form-mock__editor-surface",children:S.type==="bread"?r.jsx(Uk,{formData:S,setFormData:N}):r.jsx(Yk,{formData:S,setFormData:N,priceList:h})}):r.jsx("div",{className:"recipe-form-mock__editor-surface",children:r.jsx(Jk,{formData:S,setFormData:N,voiceInputEnabled:R})})})]})})]})]})]})]})},rT="modulepreload",sT=function(n){return"/app/"+n},m0={},Ku=function(t,i,a){let o=Promise.resolve();if(i&&i.length>0){let h=function(p){return Promise.all(p.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");o=h(i.map(p=>{if(p=sT(p),p in m0)return;m0[p]=!0;const y=p.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":rT,y||(x.as="script"),x.crossOrigin="",x.href=p,f&&x.setAttribute("nonce",f),document.head.appendChild(x),y)return new Promise((w,_)=>{x.addEventListener("load",w),x.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${p}`)))})}))}function u(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return o.then(d=>{for(const f of d||[])f.status==="rejected"&&u(f.reason);return t().catch(u)})},iT=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},Hs={async fetchAllProfiles(){try{const{data:t,error:i}=await Ee.rpc("admin_list_profiles");if(!i&&Array.isArray(t))return t;i&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",i)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const n=await Ee.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await Ee.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const a=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let o=null;if(a)try{const{data:d,error:f}=await Ee.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(f)throw f;if(d){const h=iT(d);if(h)return h}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),o=d}const u=await Ee.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(o&&a)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${o.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await Ee.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminGetLoginLogs(n){const{data:t,error:i}=await Ee.rpc("admin_get_login_logs",{p_user_id:n});if(i)throw i;return t||[]},async adminResetPassword(n,t){const{data:i,error:a}=await Ee.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(a)throw a;if(i?.error)throw new Error(i.error);return i},async sendPasswordResetEmail(n){const{error:t}=await Ee.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin+"/app/"});if(t)throw t;return!0}},g0="csv_unit_overrides",y0=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),ud={async _getCurrentUserId(){const{data:n,error:t}=await Ee.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:i,error:a}=await Ee.from(g0).select("ingredient_name,csv_unit").eq("user_id",t);if(a){if(y0(a))return new Map;throw a}const o=new Map;return(i||[]).forEach(u=>{u?.ingredient_name&&o.set(String(u.ingredient_name),String(u.csv_unit||""))}),o}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim(),u=String(t||"").trim();if(!o)throw new Error("");if(!u)throw new Error("");const{data:d,error:f}=await Ee.from(g0).upsert({user_id:a,ingredient_name:o,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(f)throw y0(f)?new Error("DB csv_unit_overrides "):f;return d}},v0="ingredient_vendor_orders",x0=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),b0={async getAll(n){const t=String(n||"").trim();if(!t)return[];const{data:i,error:a}=await Ee.from(v0).select("vendor_name,sort_order").eq("user_id",t).order("sort_order",{ascending:!0}).order("vendor_name",{ascending:!0});if(a){if(x0(a))return[];throw a}return(i||[]).map(o=>String(o?.vendor_name||"").trim()).filter(Boolean)},async saveOrder(n,t){const i=String(n||"").trim();if(!i)throw new Error("User ID is required");const a=[],o=new Set;if((t||[]).forEach(h=>{const p=String(h||"").trim();!p||o.has(p)||(o.add(p),a.push(p))}),a.length===0)return;const u=new Date().toISOString(),d=a.map((h,p)=>({user_id:i,vendor_name:h,sort_order:p,updated_at:u})),{error:f}=await Ee.from(v0).upsert(d,{onConflict:"user_id,vendor_name"});if(f)throw x0(f)?new Error("DB ingredient_vendor_orders "):f}},Ao="manual",Ro="__all__",la="__unassigned__",aT=({vendorKey:n,label:t,count:i,active:a,disabled:o,onSelect:u})=>{const{attributes:d,listeners:f,setNodeRef:h,transform:p,transition:y,isDragging:v}=ba({id:n,data:{type:"vendor-order-item"},disabled:!!o}),x={transform:jr.Transform.toString(p),transition:y,opacity:v?.7:1};return r.jsxs("li",{ref:h,style:x,className:`vendor-order-item ${a?"active":""} ${o?"disabled":""}`,onClick:()=>{o||u(n)},role:"button",tabIndex:o?-1:0,onKeyDown:w=>{o||(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),u(n))},"aria-label":`${t} `,children:[r.jsxs("span",{className:"vendor-order-item__label",title:t,children:[t,r.jsxs("span",{className:"vendor-order-item__count",children:["(",Number(i||0).toLocaleString(),")"]})]}),r.jsx("span",{className:"vendor-order-item__handle",...o?{}:d,...o?{}:f,title:"","aria-label":`${t} `,children:""})]})},lT=()=>{const n=ws(),{user:t}=fs(),i=t?.id||null,[a,o]=b.useState([]),[u,d]=b.useState(""),[f,h]=b.useState("all"),[p,y]=b.useState(!1),[v,x]=b.useState(Ro),[w,_]=b.useState([]),[C,S]=b.useState(!1),[N,T]=b.useState(null),[L,R]=b.useState(!1),[J,H]=b.useState(new Map),[V,k]=b.useState(new Map),[M,z]=b.useState({}),[U,F]=b.useState(!1),[Y,$]=b.useState([]),[P,E]=b.useState(!1),[B,q]=b.useState(""),[Q,G]=b.useState(""),[A,O]=b.useState(!1),[K,de]=b.useState(!1),[pe,ve]=b.useState(null),[te,W]=b.useState(!1),me=ee=>{const De=String(ee||"").trim();return!De||De==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(De)?De:"food"},ke=ee=>{const De=me(ee);return De==="food"?"8%":De==="soft_drink"?"8%":De==="alcohol"?"10%":De==="supplies"?"10%":"8%"},ie=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:Ao,label:""}],je=b.useCallback(ee=>{const De=Wt(ee);return De?J?.has(De):!1},[J]),Re=_e.useMemo(()=>{const ee={all:a.length,food:0,alcohol:0,soft_drink:0,supplies:0,[Ao]:0};return a.forEach(De=>{const Te=me(De?.itemCategory);ee[Te]=(ee[Te]||0)+1,je(De?.ingredientName)||(ee[Ao]=(ee[Ao]||0)+1)}),ee},[a,je]),Oe=b.useCallback(async()=>{R(!0);try{let ee=await Ln.getAllConversions();if((ee?.size||0)===0){await new Promise(Ie=>setTimeout(Ie,350));const Te=await Ln.getAllConversions();(Te?.size||0)>0&&(ee=Te)}const De=Array.from(ee.values()).map(Te=>({...Te,clientId:Te.ingredientName,isNew:!1,isEditing:!1}));o(De.sort((Te,Ie)=>String(Te?.ingredientName||"").localeCompare(String(Ie?.ingredientName||""),"ja"))),R(!1),Promise.allSettled([or.fetchPriceList(),ud.getAll()]).then(([Te,Ie])=>{Te.status==="fulfilled"?H(Te.value||new Map):(H(new Map),console.warn("Failed to load CSV prices (ingredient master still available):",Te.reason)),Ie.status==="fulfilled"?k(Ie.value||new Map):(k(new Map),console.warn("Failed to load CSV unit overrides (ingredient master still available):",Ie.reason))}).catch(Te=>{console.warn("Failed to load auxiliary ingredient master data:",Te),H(new Map),k(new Map)})}catch(ee){n.error(""),console.error("Failed to load ingredients:",ee),R(!1)}},[n]);b.useEffect(()=>{const ee=setTimeout(()=>{Oe()},0);return()=>clearTimeout(ee)},[Oe]),b.useEffect(()=>{let ee=!0;return(async()=>{if(!i){ee&&_([]);return}try{const Te=await b0.getAll(i);ee&&_(Te)}catch(Te){console.error("Failed to load vendor order:",Te),ee&&_([])}})(),()=>{ee=!1}},[i]);const qe=()=>{const ee=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,De=["food","alcohol","soft_drink","supplies"].includes(f)?f:"food",Te={clientId:ee,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:De,isNew:!0,isEditing:!0};o(Ie=>[Te,...Ie.map(Fe=>({...Fe,isEditing:!1}))]),T(ee)},et=b.useCallback(ee=>a.findIndex(De=>De?.clientId===ee),[a]),at=async ee=>{const De=et(ee);if(De<0)return;const Te=a[De];if(!Te.ingredientName||!Te.packetSize||!Te.lastPrice){n.warning("");return}const Ie=parseFloat(Te.yieldPercent),Fe=Number.isFinite(Ie)?Ie:100;if(Fe<=0||Fe>100){n.warning("% 1100 ");return}try{await Ln.saveConversion(Te.ingredientName,Te.packetSize,Te.packetUnit,Te.lastPrice,Te.itemCategory,Te.vendor,Fe),n.success(""),Oe(),T(null)}catch(it){n.error(""),console.error("Save error:",it)}},lt=async ee=>{const De=et(ee);if(De<0)return;const Te=a[De],Ie=Te?.ingredientName;if(Te.isNew){o(Fe=>Fe.filter(it=>it?.clientId!==ee)),T(null);return}try{await Ln.deleteConversion(Ie),n.success(""),Oe()}catch(Fe){n.error(""),console.error("Delete error:",Fe)}},pt=ee=>{T(ee),o(De=>De.map(Te=>({...Te,isEditing:Te?.clientId===ee})))},we=ee=>{const De=et(ee);De<0||(a[De].isNew?o(Te=>Te.filter(Ie=>Ie?.clientId!==ee)):Oe(),T(null))},ae=(ee,De,Te)=>{o(Ie=>Ie.map(Fe=>Fe?.clientId!==ee?Fe:{...Fe,[De]:Te}))},Ge=ee=>{const De=parseFloat(ee.lastPrice),Te=parseFloat(ee.packetSize);if(!De||!Te)return"-";const Ie=ee.packetUnit?ee.packetUnit.trim().toLowerCase():"";return Ie==="g"||Ie===""?`${Math.round(De/Te*1e3).toLocaleString()}/kg`:Ie==="ml"||Ie==="cc"||Ie===""||Ie===""?`${Math.round(De/Te*1e3).toLocaleString()}/L`:Ie==="cl"||Ie===""?`${Math.round(De/Te*100).toLocaleString()}/L`:`${Math.round(De/Te).toLocaleString()}/${ee.packetUnit}`},Ne=a.filter(ee=>{const De=String(ee?.ingredientName||"");return De.toLowerCase().includes(u.toLowerCase())?f==="all"?!0:f===Ao?!je(De):me(ee?.itemCategory)===f:!1}),dt=_e.useMemo(()=>{const ee=new Map;a.forEach(it=>{const wt=String(it?.ingredientName||"").trim();if(!wt)return;const Pt=Wt(wt);if(!Pt)return;const Vt=ee.get(Pt)||[];Vt.push({clientId:it?.clientId,name:wt}),ee.set(Pt,Vt)});const De=new Set,Te=new Set,Ie=new Map,Fe=[];for(const[it,wt]of ee.entries()){if(!Array.isArray(wt)||wt.length<2)continue;De.add(it),wt.forEach(Vt=>{Vt?.clientId&&Te.add(Vt.clientId)});const Pt=Array.from(new Set(wt.map(Vt=>Vt?.name).filter(Boolean)));Ie.set(it,Pt),Fe.push({key:it,names:Pt,rows:wt.length})}return Fe.sort((it,wt)=>{const Pt=String(it?.names?.[0]||""),Vt=String(wt?.names?.[0]||"");return Pt.localeCompare(Vt,"ja")}),{duplicateKeys:De,duplicateClientIds:Te,keyToNames:Ie,groups:Fe}},[a]);b.useEffect(()=>{p&&(dt?.groups?.length||0)===0&&y(!1)},[p,dt]);const rt=f!=="all"||String(u||"").trim()!=="",Ve=ee=>{const De=Wt(ee);if(!De)return"-";const Ie=(J?.get(De)||null)?.unit;return Ie?String(Ie):"-"},ot=b.useCallback(ee=>{const De=Wt(ee);if(!De)return"";const Ie=(J?.get(De)||null)?.vendor;return Ie?String(Ie):""},[J]),tt=_e.useCallback(ee=>{const De=String(ee?.vendor||"").trim();if(De)return De;const Te=ot(ee?.ingredientName);return Te||la},[ot]),St=_e.useMemo(()=>{const ee=new Map;Ne.forEach(Fe=>{const it=tt(Fe);ee.set(it,(ee.get(it)||0)+1)});const De=new Set(ee.keys()),Te=Array.from(ee.entries()).map(([Fe,it])=>({key:Fe,count:it})),Ie=new Map((w||[]).map((Fe,it)=>[Fe,it]));return Te.sort((Fe,it)=>{const wt=Ie.has(Fe.key)?Ie.get(Fe.key):Number.MAX_SAFE_INTEGER,Pt=Ie.has(it.key)?Ie.get(it.key):Number.MAX_SAFE_INTEGER;return wt!==Pt?wt-Pt:Fe.key===la&&it.key!==la?1:it.key===la&&Fe.key!==la?-1:String(Fe.key).localeCompare(String(it.key),"ja")}),{total:Ne.length,vendorKeys:De,entries:Te}},[Ne,tt,w]);b.useEffect(()=>{const ee=(St?.entries||[]).map(De=>De.key);_(De=>{const Te=Array.isArray(De)?De:[],Ie=Te.filter(wt=>ee.includes(wt)),Fe=ee.filter(wt=>!Ie.includes(wt)),it=[...Ie,...Fe];return it.length===Te.length&&it.every((wt,Pt)=>wt===Te[Pt])?Te:it})},[St]);const gn=xa(hr(xd,{activationConstraint:{distance:6}})),Ct=b.useCallback(async ee=>{if(N!==null)return;const{active:De,over:Te}=ee;if(!De?.id||!Te?.id||De.id===Te.id)return;const Ie=(St?.entries||[]).map(he=>he.key),Fe=Ie.indexOf(De.id),it=Ie.indexOf(Te.id);if(Fe<0||it<0)return;const wt=Ui(Ie,Fe,it),Vt=(Array.isArray(w)?w:[]).filter(he=>!Ie.includes(he)),on=[...wt,...Vt];if(_(on),!!i)try{await b0.saveOrder(i,on)}catch(he){console.error("Failed to save vendor order:",he),n.error(he?.message||"")}},[N,i,St,n,w]);b.useEffect(()=>{v!==Ro&&(St?.vendorKeys?.has?.(v)||x(Ro))},[v,St]);const zt=_e.useMemo(()=>{let ee=Ne.filter(De=>{const Te=De?.clientId,Ie=!!N&&Te===N;return!(p&&!(dt?.duplicateClientIds||new Set).has(Te)&&!Ie||v!==Ro&&!(tt(De)===v)&&!Ie)});if(N&&!ee.some(De=>De?.clientId===N)){const De=a.find(Te=>Te?.clientId===N);De&&(ee=[De,...ee])}return ee},[Ne,p,dt,v,tt,N,a]),Ft=ee=>{const De=(ee??"").toString().trim();if(!De)return"";if(Object.prototype.hasOwnProperty.call(M,De))return M[De];const Te=V?.get(De);if(Te)return String(Te);const Ie=Ve(De);return Ie==="-"?"":Ie},rn=ee=>{const De=(ee??"").toString().trim();if(!De)return"-";const Te=V?.get(De);return Te?String(Te):Ve(De)},ln=async(ee,De)=>{const Te=(ee??"").toString().trim(),Ie=(De??"").toString().trim();if(Te){if(!Ie){z(Fe=>{const it={...Fe};return delete it[Te],it});return}try{await ud.upsert(Te,Ie),k(Fe=>{const it=new Map(Fe);return it.set(Te,Ie),it}),n.success("CSV")}catch(Fe){console.error(Fe),n.error(Fe?.message||"")}}},sn=async()=>{if(t?.role==="admin"){F(!0),q(""),$([]),G(""),O(!1),ve(null),W(!1),E(!0);try{const ee=await Hs.fetchAllProfiles();$(ee||[])}catch(ee){console.error(ee),q("")}finally{E(!1)}}},zn=()=>{K||(W(!1),F(!1))},Xt=async()=>{if(!(!Q||K)){de(!0),ve({type:"info",message:"..."});try{const ee=await Ln.adminCopyIngredientMasterToUser(Q,{overwrite:A}),De=ee?.unit_conversions||{},Te=ee?.csv_unit_overrides||{},Ie=`: ${Number(De.source_total||0).toLocaleString()}   ${Number(De.copied||0).toLocaleString()} /  ${Number(De.updated||0).toLocaleString()} /  ${Number(De.skipped||0).toLocaleString()}`,Fe=`(CSV): ${Number(Te.source_total||0).toLocaleString()}   ${Number(Te.copied||0).toLocaleString()} /  ${Number(Te.updated||0).toLocaleString()} /  ${Number(Te.skipped||0).toLocaleString()}`;ve({type:"success",message:`
${Ie}
${Fe}`}),n.success("")}catch(ee){console.error(ee),ve({type:"error",message:`: ${String(ee?.message||ee)}`}),n.error("")}finally{de(!1)}}};return r.jsxs("div",{className:"ingredient-master-container",children:[r.jsxs("div",{className:"master-header",children:[r.jsx("h3",{children:" "}),r.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[t?.role==="admin"&&r.jsx(ce,{variant:"secondary",onClick:sn,disabled:N!==null||L||K,title:N!==null?"":void 0,children:""}),r.jsx(ce,{variant:"primary",onClick:qe,disabled:N!==null,children:"+ "})]})]}),r.jsx("div",{className:"master-search",children:r.jsx($t,{placeholder:"...",value:u,onChange:ee=>d(ee.target.value)})}),r.jsxs("div",{className:"ingredient-master-stats",children:[r.jsxs("span",{children:[": ",r.jsx("strong",{children:(a.length||0).toLocaleString()})," "]}),rt&&r.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",r.jsx("strong",{children:(Ne.length||0).toLocaleString()})," "]}),r.jsxs("button",{type:"button",className:`ingredient-dup-toggle ${p?"active":""}`,onClick:()=>y(ee=>!ee),disabled:N!==null||(dt?.groups?.length||0)===0,title:N!==null?"":(dt?.groups?.length||0)===0?"":"",children:[": ",r.jsx("strong",{children:(dt?.groups?.length||0).toLocaleString()})," "]})]}),r.jsx("div",{className:"ingredient-category-tabs",children:ie.map(ee=>r.jsxs("button",{type:"button",className:`ingredient-category-tab ${f===ee.key?"active":""}`,onClick:()=>h(ee.key),disabled:N!==null,title:N!==null?"":void 0,children:[ee.label," (",(Re[ee.key]??0).toLocaleString(),")"]},ee.key))}),r.jsxs("div",{className:"ingredient-vendor-filter-row",children:[r.jsx("label",{htmlFor:"ingredient-vendor-filter",className:"ingredient-vendor-filter-label",children:""}),r.jsxs("select",{id:"ingredient-vendor-filter",value:v,onChange:ee=>x(ee.target.value),disabled:N!==null,className:"ingredient-vendor-select",title:N!==null?"":"",children:[r.jsxs("option",{value:Ro,children:[" (",(St?.total||0).toLocaleString(),")"]}),(St?.entries||[]).map(({key:ee,count:De})=>{const Te=ee===la?"":ee;return r.jsxs("option",{value:ee,children:[Te," (",Number(De||0).toLocaleString(),")"]},ee)})]}),r.jsx("button",{type:"button",className:`ingredient-vendor-order-toggle ${C?"active":""}`,onClick:()=>S(ee=>!ee),disabled:N!==null,title:N!==null?"":"",children:C?"":""})]}),C&&r.jsxs("div",{className:"ingredient-vendor-order-panel",children:[r.jsx("div",{className:"ingredient-vendor-order-title",children:""}),(St?.entries||[]).length===0?r.jsx("div",{className:"ingredient-vendor-order-empty",children:""}):r.jsx(Mi,{sensors:gn,collisionDetection:ed,onDragEnd:Ct,children:r.jsx(va,{items:(St?.entries||[]).map(ee=>ee.key),strategy:Sl,children:r.jsx("ul",{className:"vendor-order-list",children:(St?.entries||[]).map(({key:ee,count:De})=>{const Te=ee===la?"":ee;return r.jsx(aT,{vendorKey:ee,label:Te,count:De,active:v===ee,disabled:N!==null,onSelect:x},ee)})})})})]}),L?r.jsx("div",{className:"master-loading",children:"..."}):r.jsx("div",{className:"master-table-wrapper",children:r.jsxs("table",{className:"master-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"master-col-no",children:"No"}),r.jsx("th",{children:""}),r.jsx("th",{className:"master-col-category",children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:"CSV"}),r.jsx("th",{children:""}),r.jsx("th",{children:"%"}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:zt.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#999"},children:p?"":rt?"":""})}):zt.map((ee,De)=>{const Te=ee?.clientId??ee?.ingredientName??String(De),Ie=ot(ee?.ingredientName),Fe=String(ee?.vendor||"").trim(),it=ee?.isEditing&&!!Ie&&Ie!==Fe,wt=Fe||Ie||"",Pt=Fe?"vendor-tag--master":Ie?"vendor-tag--csv":"vendor-tag--empty",Vt=wt?Fe&&Ie&&Ie!==Fe?`: ${Fe} / CSV: ${Ie}`:Fe?"":"CSV":"",on=me(ee?.itemCategory),he=on==="food",Ke=Wt(ee?.ingredientName),mt=!!Ke&&dt?.duplicateKeys?.has?.(Ke),ct=Ke&&dt?.keyToNames?.get?.(Ke)||null,Lt=mt&&Array.isArray(ct)&&ct.length>0?`: ${ct.join(" / ")}`:"";return r.jsxs("tr",{className:[ee.isEditing?"editing":"",mt?"duplicate":""].filter(Boolean).join(" "),children:[r.jsx("td",{className:"master-col-no",children:r.jsx("span",{className:"master-col-no__text",children:De+1})}),r.jsx("td",{children:ee.isEditing?r.jsxs("div",{className:"ingredient-name-cell",children:[r.jsx($t,{value:ee.ingredientName,onChange:ut=>ae(Te,"ingredientName",ut.target.value),placeholder:": ",disabled:!ee.isNew,wrapperClassName:"input-group--no-margin"}),r.jsx($t,{value:ee.vendor||"",onChange:ut=>ae(Te,"vendor",ut.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),it&&r.jsx("div",{className:"ingredient-vendor-tags",children:r.jsxs("span",{className:"vendor-tag vendor-tag--csv",title:"CSV",children:[": ",Ie]})})]}):r.jsxs("div",{className:"ingredient-name-cell",children:[r.jsxs("div",{className:"ingredient-name-row",children:[r.jsx("span",{children:ee.ingredientName}),mt&&r.jsx("span",{className:"ingredient-dup-badge",title:Lt,children:""})]}),r.jsx("div",{className:"ingredient-vendor-tags",children:r.jsxs("span",{className:`vendor-tag ${Pt}`,title:Vt,children:[": ",wt||"-"]})})]})}),r.jsx("td",{className:"master-col-category",children:ee.isEditing?r.jsxs("select",{value:on,onChange:ut=>ae(Te,"itemCategory",ut.target.value),className:"category-select",children:[r.jsx("option",{value:"food",children:"8%"}),r.jsx("option",{value:"soft_drink",children:"8%"}),r.jsx("option",{value:"alcohol",children:"10%"}),r.jsx("option",{value:"supplies",children:"10%"})]}):r.jsx("span",{title:"",children:ke(ee?.itemCategory)})}),r.jsx("td",{children:ee.isEditing?r.jsx($t,{type:"number",value:ee.lastPrice,onChange:ut=>ae(Te,"lastPrice",ut.target.value),placeholder:": 500"}):`${parseFloat(ee.lastPrice||0).toLocaleString()}`}),r.jsx("td",{children:ee.isEditing?r.jsxs("div",{className:"input-with-hint",children:[r.jsx($t,{type:"number",value:ee.packetSize,onChange:ut=>ae(Te,"packetSize",ut.target.value),placeholder:["","","","PC","","",""].includes(ee.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(ee.packetUnit)&&r.jsxs("span",{className:"unit-hint",children:["1",ee.packetUnit,"1"]})]}):ee.packetSize}),r.jsx("td",{children:ee.isEditing?r.jsxs("select",{value:ee.packetUnit,onChange:ut=>ae(Te,"packetUnit",ut.target.value),className:"unit-select",children:[r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]}):ee.packetUnit}),r.jsx("td",{className:"csv-unit-cell",children:ee.isEditing?r.jsx($t,{value:Ft(ee.ingredientName),onChange:ut=>{const Mt=(ee.ingredientName??"").toString().trim(),tn=ut.target.value;z(ht=>({...ht,[Mt]:tn}))},onBlur:ut=>ln(ee.ingredientName,ut.target.value),placeholder:Ve(ee.ingredientName)==="-"?"":`CSV: ${Ve(ee.ingredientName)}`}):r.jsx("span",{children:rn(ee.ingredientName)})}),r.jsx("td",{className:"normalized-cost",children:Ge(ee)}),r.jsx("td",{children:he?ee.isEditing?r.jsx($t,{type:"number",value:ee.yieldPercent??"",onChange:ut=>ae(Te,"yieldPercent",ut.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const ut=parseFloat(ee.yieldPercent);if(!Number.isFinite(ut)||ut<=0)return"-";const Mt=Math.round(ut*10)/10;return`${Number.isInteger(Mt)?Math.round(Mt):Mt}%`})():r.jsx("span",{style:{color:"#999"},children:"-"})}),r.jsx("td",{children:r.jsx("div",{className:"action-buttons",children:ee.isEditing?r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"primary",size:"sm",onClick:()=>at(Te),children:""}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>we(Te),children:""})]}):r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>pt(Te),disabled:N!==null,children:""}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>lt(Te),disabled:N!==null,children:""})]})})})]},Te)})})]})}),r.jsx("div",{className:"master-info",children:r.jsx("p",{children:" "})}),r.jsx(bn,{isOpen:U,onClose:zn,title:"",size:"medium",showCloseButton:!K,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),te?r.jsxs(r.Fragment,{children:[(()=>{const ee=Y.find(Te=>String(Te?.id)===String(Q)),De=ee?`${ee.display_id}${ee.email?` (${ee.email})`:""}`:Q?String(Q).slice(0,8):"-";return r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",r.jsx("strong",{children:De}),r.jsx("br",{}),": ",r.jsx("strong",{children:A?"":""})]})]})})(),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>W(!1),disabled:K,children:""}),r.jsx(ce,{variant:"primary",onClick:Xt,disabled:!Q||K,children:K?"...":""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),P?r.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):r.jsxs("select",{value:Q,onChange:ee=>G(ee.target.value),disabled:K||!!B,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:K?"#f3f4f6":"white"},children:[r.jsx("option",{value:"",children:"..."}),Y.filter(ee=>String(ee?.id)&&String(ee?.id)!==String(t?.id)).map(ee=>r.jsxs("option",{value:ee.id,children:[ee.display_id,ee.email?` (${ee.email})`:"",ee.role==="admin"?" []":""]},ee.id))]}),B&&r.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:B})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[r.jsx("input",{type:"checkbox",checked:A,onChange:ee=>O(ee.target.checked),disabled:K}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:zn,disabled:K,children:""}),r.jsx(ce,{variant:"primary",onClick:()=>W(!0),disabled:!Q||K||P||!!B,children:""})]})]}),K&&r.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),pe?.message&&r.jsx("div",{className:`status-msg ${pe.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:pe.message})]})})]})},Iu="__all_vendors__",sw="__unknown_vendor__",Oo="__all_categories__",hp="food",Yu=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],zp=Yu.reduce((n,t)=>(n[t.value]=t.label,n),{}),oT=new Set(["","","","","PC","","",""]),oa=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const i=Number(t);return Number.isFinite(i)?i:null},w0=n=>(typeof n=="string"?n.trim():"")||sw,ol=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?hp:zp[t]?t:hp},cT=()=>{const[n,t]=b.useState([]),[i,a]=b.useState(!0),[o,u]=b.useState(null),[d,f]=b.useState(null),[h,p]=b.useState("all"),[y,v]=b.useState({key:null,direction:"asc"}),[x,w]=b.useState(""),[_,C]=b.useState(Oo),[S,N]=b.useState(Iu),[T,L]=b.useState(!1),[R,J]=b.useState(null),H=b.useRef(null),V=ws(),[k,M]=b.useState({isOpen:!1,title:"",message:"",onConfirm:null}),z=()=>{f(W=>!W||W.phase==="running"?W:null)};b.useEffect(()=>{U()},[]);const U=async()=>{a(!0),J(null);try{console.log("Starting data load for CsvToMasterImporter...");const[W,me]=await Promise.all([or.getPriceListArray().catch(ie=>(console.error("Error fetching price list:",ie),[])),Ln.getAllConversions().catch(ie=>(console.error("Error fetching conversions:",ie),new Map))]);if(console.log("Data fetched:",{csvCount:W?.length,masterSize:me?.size}),!Array.isArray(W))throw new Error("CSV");if(!(me instanceof Map))throw new Error("Map");const ke=[];for(const ie of W){if(!ie||!ie.name)continue;const je=me.get(ie.name),Re=ol(je?.itemCategory),Oe=je?.packetSize??"",qe=je?.packetUnit||ie.unit||"",et=je?.lastPrice??"",at=je?Oe:oT.has(qe)?1:"";ke.push({name:ie.name,csvPrice:ie.price,csvUnit:ie.unit,csvVendor:ie.vendor,masterCategory:Re,masterSize:Oe,masterUnit:qe,masterPrice:et,isRegistered:!!je,inputSize:at,inputUnit:qe,inputPrice:je?et:ie.price??"",inputCategory:Re,isModified:!1})}console.log("Merge completed. Items:",ke.length),t(ke)}catch(W){console.error("Failed to load data for importer:",W),J(W.message||"")}finally{a(!1)}},F=async W=>{u(W.name);try{const me=oa(W.inputSize),ke=oa(W.inputPrice);if(me===null||me<=0){V.error("");return}if(!W.inputUnit){V.error("");return}if(!W.inputCategory){V.error("");return}await Ln.saveConversion(W.name,me,W.inputUnit,ke,W.inputCategory),t(ie=>ie.map(je=>je.name===W.name?{...je,isRegistered:!0,isModified:!1,masterSize:me,masterUnit:W.inputUnit,masterPrice:ke??"",masterCategory:W.inputCategory,inputCategory:W.inputCategory}:je)),V.success("")}catch(me){console.error("Failed to save ingredient:",me),V.error("")}finally{u(null)}},Y=async W=>{M(me=>({...me,isOpen:!1}));try{const me=W.filter(rt=>{const Ve=oa(rt.inputSize);return!(Ve!==null&&Ve>0)||!rt.inputUnit||!rt.inputCategory});if(me.length>0){const rt=me.slice(0,5).map(ot=>ot.name).join(""),Ve=me.length>5?` ${me.length-5}`:"";V.error(`: ${rt}${Ve}`);return}u("bulk");const ke=W.length;f({phase:"running",total:ke,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const ie=5,je=120;let Re=0,Oe=0,qe=0,et=0;const at=[],lt=[],pt=(rt=!1,Ve="")=>{const ot=Date.now();!rt&&ot-et<je||(et=ot,f(tt=>!tt||tt.phase!=="running"?tt:{...tt,processed:Re,success:Oe,failed:qe,currentName:Ve||tt.currentName}))};let we=0;const ae=async()=>{for(;;){const rt=we++;if(rt>=W.length)return;const Ve=W[rt],ot=Ve?.name?String(Ve.name):"";try{const tt=oa(Ve.inputSize),St=oa(Ve.inputPrice);if(tt===null||tt<=0)throw new Error("Invalid size");if(!Ve.inputUnit)throw new Error("Invalid unit");if(!Ve.inputCategory)throw new Error("Invalid category");await Ln.saveConversion(Ve.name,tt,Ve.inputUnit,St,Ve.inputCategory),Oe++,at.push(Ve)}catch(tt){qe++,lt.push(ot||`#${rt+1}`),console.error(`Failed to save ${ot}:`,tt)}finally{Re++,pt(!1,ot)}}},Ge=Math.min(ie,W.length);await Promise.all(Array.from({length:Ge},()=>ae())),pt(!0);const Ne=new Set(at.map(rt=>rt.name)),dt=new Map(W.map(rt=>[rt.name,rt]));t(rt=>rt.map(Ve=>{if(Ne.has(Ve.name)){const ot=dt.get(Ve.name);return{...Ve,isRegistered:!0,isModified:!1,masterSize:oa(ot.inputSize)??"",masterUnit:ot.inputUnit,masterPrice:oa(ot.inputPrice)??"",masterCategory:ot.inputCategory,inputCategory:ot.inputCategory}}return Ve})),qe===0?V.success(`${Oe} `):V.warning(`:  ${Oe}  /  ${qe} `),f({phase:"done",total:ke,processed:Re,success:Oe,failed:qe,currentName:"",failedNames:lt.slice(0,10)})}catch(me){console.error("Bulk save error:",me),V.error(""),f(ke=>({phase:"error",total:ke?.total??W.length,processed:ke?.processed??0,success:ke?.success??0,failed:ke?.failed??0,currentName:"",failedNames:ke?.failedNames??[],errorMessage:me?.message?String(me.message):""}))}finally{u(null)}},$=()=>{const W=n.filter(me=>me.isModified);W.length!==0&&M({isOpen:!0,title:"",message:`${W.length} `,onConfirm:()=>Y(W)})},P=(W,me,ke)=>{t(ie=>ie.map(je=>je.name===W?{...je,[me]:ke,isModified:!0}:je))},E=W=>{(W.key==="ArrowUp"||W.key==="ArrowDown")&&W.preventDefault()},B=W=>{v(me=>me.key===W?{key:W,direction:me.direction==="asc"?"desc":"asc"}:{key:W,direction:"asc"})},q=W=>y.key!==W?"":y.direction==="asc"?" ":" ",Q=b.useMemo(()=>{const W=new Map;n.forEach(ke=>{const ie=w0(ke.csvVendor),je=ie===sw?"":ie,Re=W.get(ie);Re?Re.count+=1:W.set(ie,{key:ie,label:je,count:1})});const me=Array.from(W.values()).sort((ke,ie)=>ke.label.localeCompare(ie.label,"ja"));return[{key:Iu,label:"",count:n.length},...me]},[n]);b.useEffect(()=>{Q.some(me=>me.key===S)||N(Iu)},[Q,S]),b.useEffect(()=>{if(!T)return;const W=ke=>{H.current&&!H.current.contains(ke.target)&&L(!1)},me=ke=>{ke.key==="Escape"&&L(!1)};return document.addEventListener("mousedown",W),document.addEventListener("touchstart",W),document.addEventListener("keydown",me),()=>{document.removeEventListener("mousedown",W),document.removeEventListener("touchstart",W),document.removeEventListener("keydown",me)}},[T]);const G=b.useMemo(()=>S===Iu?n:n.filter(W=>w0(W.csvVendor)===S),[n,S]),A=b.useMemo(()=>{const W={[Oo]:G.length};return Yu.forEach(me=>{W[me.value]=0}),G.forEach(me=>{const ke=ol(me.inputCategory);W[ke]=(W[ke]||0)+1}),W},[G]),O=b.useMemo(()=>_===Oo?G:G.filter(W=>ol(W.inputCategory)===_),[G,_]),K=b.useMemo(()=>({all:O.length,unregistered:O.filter(W=>!W.isRegistered).length,registered:O.filter(W=>W.isRegistered).length}),[O]),de=b.useMemo(()=>Q.find(W=>W.key===S)||Q[0],[Q,S]),pe=b.useMemo(()=>O.filter(W=>!(h==="unregistered"&&W.isRegistered||h==="registered"&&!W.isRegistered||x&&!W.name.includes(x))),[O,h,x]),ve=b.useMemo(()=>{if(!y.key)return pe;const W=ie=>String(ie??""),me=ie=>{const je=parseFloat(ie);return Number.isFinite(je)?je:Number.NEGATIVE_INFINITY},ke=[...pe];return ke.sort((ie,je)=>{let Re=0;switch(y.key){case"name":Re=W(ie.name).localeCompare(W(je.name),"ja");break;case"csvPrice":Re=me(ie.csvPrice)-me(je.csvPrice);break;case"inputCategory":{const Oe=zp[ol(ie.inputCategory)]||"",qe=zp[ol(je.inputCategory)]||"";Re=Oe.localeCompare(qe,"ja");break}case"inputSize":Re=me(ie.inputSize)-me(je.inputSize);break;case"inputUnit":Re=W(ie.inputUnit).localeCompare(W(je.inputUnit),"ja");break;case"inputPrice":Re=me(ie.inputPrice)-me(je.inputPrice);break;default:Re=0;break}return Re===0&&(Re=W(ie.name).localeCompare(W(je.name),"ja")),y.direction==="asc"?Re:-Re}),ke},[pe,y]),te=n.filter(W=>W.isModified).length;return i?r.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):R?r.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[r.jsx("h3",{children:""}),r.jsx("p",{children:R}),r.jsx(ce,{variant:"secondary",onClick:U,children:""})]}):r.jsxs("div",{className:"csv-importer",children:[r.jsxs("div",{className:"importer-header",children:[r.jsx($t,{placeholder:"...",value:x,onChange:W=>w(W.target.value),style:{maxWidth:"300px"}}),r.jsxs("div",{className:"filter-buttons",children:[r.jsxs(ce,{variant:h==="all"?"primary":"secondary",onClick:()=>p("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",K.all,")"]}),r.jsxs(ce,{variant:h==="unregistered"?"primary":"secondary",onClick:()=>p("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",K.unregistered,")"]}),r.jsxs(ce,{variant:h==="registered"?"primary":"secondary",onClick:()=>p("registered"),size:"sm",children:[" (",K.registered,")"]})]}),r.jsxs("div",{className:"vendor-dropdown",ref:H,children:[r.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>L(W=>!W),"aria-haspopup":"listbox","aria-expanded":T,children:[r.jsxs("span",{children:[": ",de?.label," (",de?.count??0,")"]}),r.jsx("span",{className:`vendor-dropdown-chevron ${T?"open":""}`,children:""})]}),T&&r.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:Q.map(W=>r.jsxs("button",{type:"button",className:`vendor-tab ${S===W.key?"active":""}`,onClick:()=>{N(W.key),L(!1)},role:"option","aria-selected":S===W.key,children:[W.label," (",W.count,")"]},W.key))})]}),r.jsxs("div",{className:"category-filter-row",children:[r.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),r.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:_,onChange:W=>C(W.target.value),children:[r.jsxs("option",{value:Oo,children:[" (",A[Oo]||0,")"]}),Yu.map(W=>r.jsxs("option",{value:W.value,children:[W.label," (",A[W.value]||0,")"]},W.value))]})]}),r.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[te>0&&r.jsx(ce,{variant:"primary",size:"sm",onClick:$,disabled:o!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o==="bulk"?"...":`(${te})`}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:U,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsxs("th",{style:{width:"22%"},onClick:()=>B("name"),children:[" (CSV)",q("name")]}),r.jsxs("th",{style:{width:"14%"},onClick:()=>B("csvPrice"),children:[" (CSV)",q("csvPrice")]}),r.jsxs("th",{style:{width:"14%"},onClick:()=>B("inputCategory"),children:[" ",r.jsx("span",{style:{color:"red"},children:"*"}),q("inputCategory")]}),r.jsxs("th",{style:{width:"18%"},onClick:()=>B("inputSize"),children:[" () ",r.jsx("span",{style:{color:"red"},children:"*"}),q("inputSize")]}),r.jsxs("th",{style:{width:"13%"},onClick:()=>B("inputUnit"),children:[" () ",r.jsx("span",{style:{color:"red"},children:"*"}),q("inputUnit")]}),r.jsxs("th",{style:{width:"12%"},onClick:()=>B("inputPrice"),children:[" ()",q("inputPrice")]}),r.jsx("th",{style:{width:"7%"},children:""})]})}),r.jsx("tbody",{children:ve.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"no-data",children:""})}):ve.map(W=>r.jsxs("tr",{style:{backgroundColor:W.isModified?"#fff8e1":W.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[r.jsxs("td",{style:{fontWeight:"500"},children:[W.name,W.csvVendor&&r.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:W.csvVendor})]}),r.jsxs("td",{children:[W.csvPrice?`${W.csvPrice.toLocaleString()} `:"-",W.csvUnit&&r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",W.csvUnit]})]}),r.jsx("td",{children:r.jsx("select",{className:"input-field",value:ol(W.inputCategory),onChange:me=>P(W.name,"inputCategory",me.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:Yu.map(me=>r.jsx("option",{value:me.value,children:me.label},me.value))})}),r.jsx("td",{children:r.jsx($t,{type:"number",value:W.inputSize,onChange:me=>P(W.name,"inputSize",me.target.value),onKeyDown:E,placeholder:["","","","PC","","",""].includes(W.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),r.jsx("td",{children:r.jsxs("select",{className:"input-field",value:W.inputUnit,onChange:me=>P(W.name,"inputUnit",me.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","cl","","","","","PC","","",""].includes(W.inputUnit)&&W.inputUnit&&r.jsxs("option",{value:W.inputUnit,children:[W.inputUnit," (CSV)"]}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"kg",children:"kg"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"L",children:"L"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"PC",children:"PC"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})}),r.jsx("td",{children:r.jsx($t,{type:"number",value:W.inputPrice,onChange:me=>P(W.name,"inputPrice",me.target.value),placeholder:"",style:{width:"100%"}})}),r.jsx("td",{children:r.jsx(ce,{variant:W.isRegistered?"secondary":"primary",size:"sm",onClick:()=>F(W),disabled:o===W.name||o==="bulk",block:!0,children:o===W.name?"...":W.isRegistered?"":""})})]},W.name))})]})}),r.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[r.jsx("p",{children:" CSV"}),r.jsx("p",{children:" "})]}),r.jsxs(bn,{isOpen:k.isOpen,onClose:()=>M({...k,isOpen:!1}),title:k.title,size:"small",children:[r.jsx("div",{style:{marginBottom:"1.5rem"},children:k.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[r.jsx(ce,{variant:"secondary",onClick:()=>M({...k,isOpen:!1}),children:""}),r.jsx(ce,{variant:"primary",onClick:k.onConfirm,children:""})]})]}),r.jsx(bn,{isOpen:!!d,onClose:z,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?r.jsxs("div",{className:"bulk-progress",children:[r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:""}),r.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),r.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:r.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),r.jsxs("div",{className:"bulk-progress-meta",children:[r.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&r.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?r.jsxs("div",{className:"bulk-progress",children:[r.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&r.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),r.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[r.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:r.jsx(ce,{variant:"primary",onClick:z,children:""})})]}):r.jsxs("div",{className:"bulk-progress",children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),r.jsxs("div",{className:"bulk-progress-meta",children:[r.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&r.jsxs("div",{className:"bulk-progress-failures",children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),r.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:r.jsx(ce,{variant:"primary",onClick:z,children:""})})]})})]})},S0=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},uT=({onBack:n})=>{const[t,i]=oc(),{user:a}=fs(),[o,u]=b.useState("price"),[d,f]=b.useState(null),[h,p]=b.useState({type:"",message:""}),[y,v]=b.useState(!1),[x,w]=b.useState([]),[_,C]=b.useState(!1),[S,N]=b.useState(null),[T,L]=b.useState({type:"",message:""}),[R,J]=b.useState(null),[H,V]=b.useState(!1),[k,M]=b.useState(!1),[z,U]=b.useState(!1),[F,Y]=b.useState([]),[$,P]=b.useState(!1),[E,B]=b.useState(""),[q,Q]=b.useState(""),[G,A]=b.useState(!1),[O,K]=b.useState({total:0,done:0,current:""}),[de,pe]=b.useState(null),[ve,te]=b.useState(!1),[W,me]=b.useState(!1),[ke,ie]=b.useState(!1),[je,Re]=b.useState(!1),[Oe,qe]=b.useState({type:"",message:""}),[et,at]=b.useState(!1),[lt,pt]=b.useState(new Map),[we,ae]=b.useState([]),[Ge,Ne]=b.useState(""),[dt,rt]=b.useState(""),[Ve,ot]=b.useState(""),tt=_e.useMemo(()=>{if(!Ge)return[];const he=lt.get(Ge)||[],Ke=new Set;return he.forEach(mt=>{const ct=S0(mt?.dateStr);ct&&Ke.add(ct)}),Array.from(Ke).sort((mt,ct)=>ct.localeCompare(mt))},[lt,Ge]);b.useEffect(()=>{if(Ve){if(!Ge){ot("");return}tt.length>0&&!tt.includes(Ve)&&ot("")}},[tt,Ve,Ge]);const[St,gn]=b.useState({key:"dateStr",direction:"desc"}),[Ct,zt]=b.useState("");b.useEffect(()=>{const he=t.get("tab");(he==="price"||he==="ingredients"||he==="csv-import"||he==="duplicates")&&u(he)},[]);const Ft=he=>{let Ke="asc";St.key===he&&St.direction==="asc"&&(Ke="desc"),gn({key:he,direction:Ke})},rn=_e.useMemo(()=>{let he=[...x];if(Ct){const Ke=Ct.toLowerCase().trim();he=he.filter(mt=>mt.name&&mt.name.toLowerCase().includes(Ke)||mt.vendor&&mt.vendor.toLowerCase().includes(Ke)||mt.dateStr&&mt.dateStr.includes(Ke))}return St.key&&he.sort((Ke,mt)=>{let ct=Ke[St.key]||"",Lt=mt[St.key]||"";return ct<Lt?St.direction==="asc"?-1:1:ct>Lt?St.direction==="asc"?1:-1:0}),he},[x,St,Ct]),[ln,sn]=b.useState([]);b.useEffect(()=>{ee()},[]),b.useEffect(()=>{let he=!0;return(async()=>{if(o==="price"){if(a?.role!=="admin"){he&&(me(!1),Re(!1));return}me(!0);try{const mt=await Lp.getVoiceInputEnabled({force:!0});if(!he)return;Re(mt),qe({type:"",message:""})}catch(mt){if(console.error("Failed to load voice feature flag:",mt),!he)return;qe({type:"error",message:""})}finally{he&&me(!1)}}})(),()=>{he=!1}},[o,a?.id,a?.role]);const zn=async he=>{if(!(a?.role!=="admin"||ke)){ie(!0),qe({type:"info",message:"..."});try{const Ke=await Lp.setVoiceInputEnabled(he);Re(Ke),qe({type:"success",message:`${Ke?"":""}`})}catch(Ke){console.error("Failed to save voice feature flag:",Ke),qe({type:"error",message:""})}finally{ie(!1)}}},Xt=async()=>{at(!0);try{const Ke=await or.fetchPriceHistory()||new Map;pt(Ke);const mt=[];for(const[ct,Lt]of Ke.entries()){const ut=new Set,Mt=[];if((Lt||[]).forEach(Et=>{const oe=[String(Et?.dateStr||""),String(Et?.price??""),String(Et?.incomingQty??""),String(Et?.unit||""),String(Et?.vendor||""),String(Et?.displayName||"")].join("|");ut.has(oe)||(ut.add(oe),Mt.push(Et))}),Mt.length<2)continue;Mt.sort((Et,oe)=>String(Et?.dateStr||"").localeCompare(String(oe?.dateStr||"")));const tn=Mt[Mt.length-1]||{},ht=Mt.map(Et=>Number(Et?.price)).filter(Et=>Number.isFinite(Et)),le=ht.length?Math.min(...ht):null,$e=ht.length?Math.max(...ht):null,ze=new Set(Mt.map(Et=>String(Et?.dateStr||""))).size,At=new Set(Mt.map(Et=>String(Et?.displayName||""))).size;let Tt=0;for(let Et=1;Et<Mt.length;Et++){const oe=Number(Mt[Et-1]?.price),ne=Number(Mt[Et]?.price);Number.isFinite(oe)&&Number.isFinite(ne)&&oe!==ne&&Tt++}mt.push({key:ct,name:tn?.displayName||ct,lastDate:tn?.dateStr||"",lastPrice:Number.isFinite(Number(tn?.price))?Number(tn?.price):null,lastIncomingQty:Number.isFinite(Number(tn?.incomingQty))?Number(tn?.incomingQty):null,unit:tn?.unit||"",vendor:tn?.vendor||"",rows:Mt.length,dates:ze,nameVariants:At,minPrice:le,maxPrice:$e,changes:Tt})}mt.sort((ct,Lt)=>{const ut=String(ct?.lastDate||""),Mt=String(Lt?.lastDate||"");return ut!==Mt?Mt.localeCompare(ut):(Lt?.changes||0)!==(ct?.changes||0)?(Lt?.changes||0)-(ct?.changes||0):(Lt?.rows||0)!==(ct?.rows||0)?(Lt?.rows||0)-(ct?.rows||0):String(ct?.name||"").localeCompare(String(Lt?.name||""),"ja")}),ae(mt),Ge&&!Ke.has(Ge)&&Ne("")}catch(he){console.error(he)}finally{at(!1)}};b.useEffect(()=>{o==="duplicates"&&Xt()},[o]);const ee=async()=>{C(!0);try{const he=await or.getPriceListArray();w(he);const Ke=await or.getFileList();sn(Ke)}catch(he){console.error("Failed to load price data",he)}finally{C(!1)}},De=he=>{he.target.files&&he.target.files[0]&&(f(he.target.files[0]),p({type:"",message:""}))},Te=async()=>{if(!d)return;v(!0),p({type:"info",message:"..."});const he=await or.uploadPriceList(d);if(he.success){p({type:"success",message:"..."});try{const{recipeService:mt}=await Ku(async()=>{const{recipeService:ut}=await Promise.resolve().then(()=>Qf);return{recipeService:ut}},[]),ct=await or.fetchPriceList(),Lt=await mt.updateRecipeCosts(ct);p({type:"success",message:`${Lt}`})}catch(mt){console.error("Cost update failed",mt),p({type:"warning",message:""})}f(null);const Ke=document.getElementById("csv-upload-input");Ke&&(Ke.value=""),ee()}else p({type:"error",message:`: ${he.error.message}`});v(!1)},Ie=he=>{N({message:`${he}
`,onConfirm:async()=>{v(!0);const Ke=await or.deletePriceFile(he);v(!1),Ke.success?(p({type:"success",message:""}),ee()):p({type:"error",message:`: ${Ke.error.message}`})}})},Fe=he=>{he&&(J(he),V(!0),L({type:"",message:""}))},it=()=>{if(k)return;V(!1),J(null);const he=document.getElementById("backup-upload-input");he&&(he.value="")},wt=async()=>{const he=R;if(!(!he||k)){M(!0),L({type:"info",message:"..."});try{const Ke=await he.text(),mt=JSON.parse(Ke),{recipeService:ct}=await Ku(async()=>{const{recipeService:tn}=await Promise.resolve().then(()=>Qf);return{recipeService:tn}},void 0),Lt=await ct.importRecipes(mt),ut=Number(Lt?.count||0),Mt=Array.isArray(Lt?.errors)?Lt.errors.length:0;L({type:Mt>0?"warning":"success",message:`: ${ut}${Mt>0?` / : ${Mt}`:""}`}),V(!1),J(null)}catch(Ke){console.error(Ke),L({type:"error",message:""})}finally{M(!1);const Ke=document.getElementById("backup-upload-input");Ke&&(Ke.value="")}}},Pt=async()=>{U(!0),pe(null),K({total:0,done:0,current:""}),Q(""),B(""),te(!1),P(!0);try{const he=await Hs.fetchAllProfiles();Y(he||[])}catch(he){console.error(he),Y([]),B("")}finally{P(!1)}},Vt=()=>{G||(te(!1),U(!1))},on=async()=>{if(!(!q||G)){A(!0),pe({type:"info",message:"..."}),K({total:0,done:0,current:""});try{const he=await or.copyPriceFilesToUser({targetUserId:q,onProgress:({total:ct,done:Lt,current:ut})=>{K({total:ct||0,done:Lt||0,current:ut||""})}}),Ke=he?.copied?.length??0,mt=he?.failed?.length??0;pe({type:mt>0?"error":"success",message:`: ${Ke}${mt>0?` / : ${mt}`:""}`,failed:he?.failed||[]})}catch(he){console.error(he),pe({type:"error",message:`: ${String(he?.message||he)}`})}finally{A(!1)}}};return r.jsxs("div",{className:["dashboard-container","fade-in",o==="ingredients"||o==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[r.jsxs("div",{className:"dashboard-header",children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),r.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[o==="csv-import"&&r.jsx(ce,{variant:"secondary",onClick:()=>i({view:"inventory"}),title:"",children:" "}),r.jsx(ce,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsx("div",{className:"tabs-container",children:r.jsxs("div",{className:"tabs",children:[r.jsx("button",{className:`tab ${o==="price"?"active":""}`,onClick:()=>u("price"),children:" "}),r.jsx("button",{className:`tab ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:" "}),r.jsx("button",{className:`tab ${o==="csv-import"?"active":""}`,onClick:()=>u("csv-import"),children:" CSV"}),r.jsx("button",{className:`tab ${o==="duplicates"?"active":""}`,onClick:()=>u("duplicates"),children:" "})]})}),a?.role==="admin"&&o==="price"&&r.jsxs("div",{className:"voice-feature-card",children:[r.jsxs("div",{className:"voice-feature-card__left",children:[r.jsx("div",{className:"voice-feature-card__title",children:" Avalon API"}),r.jsx("div",{className:"voice-feature-card__desc",children:"ON/OFF"})]}),r.jsxs("div",{className:"voice-feature-card__right",children:[r.jsxs("label",{className:`voice-feature-switch ${je?"is-on":""}`,children:[r.jsx("input",{type:"checkbox",checked:je,onChange:he=>zn(he.target.checked),disabled:W||ke}),r.jsx("span",{className:"voice-feature-switch__slider"})]}),r.jsx("div",{className:"voice-feature-card__state",children:W?"...":je?": ":": "})]}),Oe.message&&r.jsx("div",{className:`status-msg ${Oe.type||"info"}`,style:{marginTop:"10px",width:"100%"},children:Oe.message})]}),o==="ingredients"?r.jsx(lT,{}):o==="csv-import"?r.jsx(cT,{}):o==="duplicates"?r.jsxs("div",{className:"dashboard-content",children:[r.jsxs("aside",{className:"dashboard-sidebar",children:[r.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," ",r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[we.length.toLocaleString(),""]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[r.jsx($t,{placeholder:"...",value:dt,onChange:he=>rt(he.target.value),style:{flex:1,fontSize:"0.9rem"}}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:Xt,disabled:et,title:"",children:""})]}),r.jsx("div",{className:"dup-list",children:et?r.jsx("div",{className:"dup-empty",children:"..."}):we.length===0?r.jsx("div",{className:"dup-empty",children:"2"}):we.filter(he=>{const Ke=String(dt||"").trim();return Ke?String(he?.name||"").includes(Ke):!0}).map(he=>{const Ke=he.key===Ge,mt=he.minPrice!==null&&he.maxPrice!==null&&he.minPrice!==he.maxPrice;return r.jsxs("button",{type:"button",className:`dup-item ${Ke?"active":""}`,onClick:()=>Ne(he.key),children:[r.jsxs("div",{className:"dup-item-top",children:[r.jsx("div",{className:"dup-item-name",title:he.name,children:he.name}),mt&&r.jsx("span",{className:"dup-badge",children:""})]}),r.jsxs("div",{className:"dup-item-meta",children:[r.jsxs("span",{children:[": ",he.lastDate||"-"]}),r.jsxs("span",{children:[": ",he.rows,""]}),r.jsxs("span",{children:[": ",he.dates,""]})]}),r.jsxs("div",{className:"dup-item-meta",children:[r.jsxs("span",{children:[he.lastPrice!==null?`${Math.round(he.lastPrice).toLocaleString()}`:"-",he.unit?` / ${he.unit}`:""]}),r.jsxs("span",{children:[": ",he.lastIncomingQty!==null?Math.round(he.lastIncomingQty).toLocaleString():"-"]}),he.vendor?r.jsxs("span",{title:he.vendor,children:[": ",he.vendor]}):r.jsx("span",{children:": -"})]}),he.nameVariants>1&&r.jsxs("div",{className:"dup-item-note",children:[": ",he.nameVariants,""]})]},he.key)})})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsx("div",{className:"sidebar-title",children:" "}),r.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),r.jsxs("main",{className:"dashboard-main",children:[r.jsxs("div",{className:"main-toolbar",children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:Ge?"":""})}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsxs("select",{value:Ve,onChange:he=>ot(he.target.value),disabled:!Ge,title:Ge?"":"",className:"dup-month-select",children:[r.jsx("option",{value:"",children:""}),tt.map(he=>r.jsx("option",{value:he,children:he.replace("-","/")},he))]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:Xt,disabled:et,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",children:(()=>{if(!Ge)return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const he=lt.get(Ge)||[],Ke=new Set,mt=[];he.forEach(ht=>{const le=[String(ht?.dateStr||""),String(ht?.price??""),String(ht?.incomingQty??""),String(ht?.unit||""),String(ht?.vendor||""),String(ht?.displayName||""),String(ht?.sourceFile||"")].join("|");Ke.has(le)||(Ke.add(le),mt.push(ht))}),mt.sort((ht,le)=>String(ht?.dateStr||"").localeCompare(String(le?.dateStr||"")));const ct=Ve?mt.filter(ht=>S0(ht?.dateStr)===Ve):mt,Lt=ct.map((ht,le)=>{const $e=le>0?ct[le-1]:null,ze=$e?Number($e?.price):NaN,At=Number(ht?.price);let Tt=null,Et=null;return Number.isFinite(ze)&&Number.isFinite(At)&&(Tt=At-ze,Et=ze!==0?Tt/ze*100:null),{...ht,_diff:Tt,_pct:Et}}),ut=ct.reduce((ht,le)=>{const $e=Number(le?.incomingQty);return ht+(Number.isFinite($e)?$e:0)},0),Mt=ct.reduce((ht,le)=>{const $e=Number(le?.incomingQty),ze=Number(le?.price);return!Number.isFinite($e)||!Number.isFinite(ze)?ht:ht+$e*ze},0),tn=[...Lt].reverse();return r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"120px"},children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:"CSV"}),r.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),r.jsx("tbody",{children:tn.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"no-data",children:Ve?`${Ve}`:""})}):tn.map((ht,le)=>{const $e=ht?._diff,ze=ht?._pct,At=$e==null||!Number.isFinite($e)?"-":`${$e>=0?"+":""}${Math.round($e).toLocaleString()}`,Tt=ze==null||!Number.isFinite(ze)?"":` (${ze>=0?"+":""}${ze.toFixed(1)}%)`,Et=$e==null||!Number.isFinite($e)?"#888":$e>0?"#c92a2a":$e<0?"#2b8a3e":"#666",oe=Number(ht?.price),ne=Number.isFinite(oe)?`${Math.round(oe).toLocaleString()}`:"-",ue=Number(ht?.incomingQty),xe=Number.isFinite(ue)?Math.round(ue).toLocaleString():"-",Pe=Number.isFinite(ue)&&Number.isFinite(oe)?ue*oe:NaN,Je=Number.isFinite(Pe)?`${Math.round(Pe).toLocaleString()}`:"-";return r.jsxs("tr",{children:[r.jsx("td",{className:"col-date",children:ht?.dateStr||"-"}),r.jsx("td",{children:ht?.vendor||"-"}),r.jsx("td",{style:{fontWeight:500},children:ht?.displayName||"-"}),r.jsx("td",{className:"col-number",children:xe}),r.jsxs("td",{className:"col-number",children:[ne,ht?.unit&&r.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",ht.unit]})]}),r.jsx("td",{className:"col-number",children:Je}),r.jsxs("td",{className:"col-number",style:{color:Et},children:[At,Tt]})]},`${ht?.dateStr||"d"}-${le}`)})}),tn.length>0&&r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",Ve?`${Ve}`:""]}),r.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(ut).toLocaleString()}),r.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),r.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(Mt).toLocaleString()]}),r.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):r.jsxs("div",{className:"dashboard-content",children:[r.jsxs("aside",{className:"dashboard-sidebar",children:[r.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[r.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),r.jsx(ce,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const he=await Ku(()=>Promise.resolve().then(()=>Qf),void 0).then(Lt=>Lt.recipeService.exportAllRecipes()),Ke=new Blob([JSON.stringify(he,null,2)],{type:"application/json"}),mt=URL.createObjectURL(Ke),ct=document.createElement("a");ct.href=mt,ct.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(ct),ct.click(),document.body.removeChild(ct),URL.revokeObjectURL(mt)}catch(he){L({type:"error",message:""}),console.error(he)}},children:" JSON"})]}),r.jsxs("div",{children:[r.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),r.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:he=>{const Ke=he.target.files?.[0];Ke&&Fe(Ke)}}),r.jsx(ce,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:y||k,children:" "}),T.message&&r.jsx("div",{className:`status-msg ${T.type}`,style:{marginTop:"10px"},children:T.message})]})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," "]}),r.jsxs("div",{className:"upload-area",children:[r.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",r.jsx("br",{}),r.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",r.jsx("br",{})," 2: "]})]}),r.jsx("input",{type:"file",accept:".csv",onChange:De,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),r.jsx(ce,{variant:"primary",onClick:Te,disabled:!d||y,className:"upload-btn",size:"sm",block:!0,children:y?"...":""})]}),h.message&&r.jsx("div",{className:`status-msg ${h.type}`,children:h.message})]}),a?.role==="admin"&&r.jsxs("div",{className:"sidebar-card",children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),r.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",ln.length,""]}),r.jsx("div",{style:{marginTop:"0.75rem"},children:r.jsx(ce,{variant:"secondary",size:"sm",block:!0,onClick:Pt,disabled:G||y,title:"",children:""})})]}),r.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," ",r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[ln.length,""]})]}),ln.length===0?r.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):r.jsx("div",{className:"file-list",children:ln.map(he=>r.jsxs("div",{className:"file-list-item",children:[r.jsx("span",{className:"file-name",title:he.name,children:he.name}),r.jsx(ce,{variant:"danger",size:"sm",onClick:()=>Ie(he.name),disabled:y,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},he.name))})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsx("div",{className:"sidebar-title",children:" "}),r.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:" "}),r.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),r.jsxs("main",{className:"dashboard-main",children:[r.jsxs("div",{className:"main-toolbar",children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),r.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",rn.length.toLocaleString()," "]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsx($t,{placeholder:" (, , )...",value:Ct,onChange:he=>zt(he.target.value),style:{width:"250px",fontSize:"0.9rem"}}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:ee,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",children:_?r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsxs("th",{onClick:()=>Ft("dateStr"),style:{width:"120px"},children:[" ",St.key==="dateStr"&&(St.direction==="asc"?"":"")]}),r.jsxs("th",{onClick:()=>Ft("vendor"),children:[" ",St.key==="vendor"&&(St.direction==="asc"?"":"")]}),r.jsxs("th",{onClick:()=>Ft("name"),children:[" ",St.key==="name"&&(St.direction==="asc"?"":"")]}),r.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),r.jsx("tbody",{children:rn.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"4",className:"no-data",children:""})}):rn.map((he,Ke)=>r.jsxs("tr",{children:[r.jsx("td",{className:"col-date",children:he.dateStr||"-"}),r.jsx("td",{children:he.vendor||"-"}),r.jsx("td",{style:{fontWeight:"500"},children:he.name}),r.jsxs("td",{className:"col-number",children:[he.price?he.price.toLocaleString():"-",he.unit&&r.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",he.unit]})]})]},Ke))})]})})]})]}),r.jsx(bn,{isOpen:H,onClose:it,title:" / ",size:"medium",showCloseButton:!k,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:R?.name||"-"})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:it,disabled:k,children:""}),r.jsx(ce,{variant:"primary",onClick:wt,disabled:!R||k,children:k?"...":""})]}),k&&r.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),T.message&&r.jsx("div",{className:`status-msg ${T.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:T.message})]})}),r.jsx(bn,{isOpen:z,onClose:Vt,title:"",size:"medium",showCloseButton:!G,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",r.jsx("br",{}),r.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",r.jsx("code",{children:"_copy"})," "]})]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",r.jsx("strong",{style:{color:"#111827"},children:a?.displayId||""})," / : ",ln.length,""]}),ve?r.jsxs(r.Fragment,{children:[(()=>{const he=F.find(mt=>String(mt?.id)===String(q)),Ke=he?`${he.display_id}${he.email?` (${he.email})`:""}`:q?String(q).slice(0,8):"-";return r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",r.jsx("strong",{children:Ke}),r.jsx("br",{}),": ",r.jsx("strong",{children:ln.length.toLocaleString()})," CSV",r.jsx("br",{}),": ",r.jsx("code",{children:"_copy"})," "]})]})})(),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>te(!1),disabled:G,children:""}),r.jsx(ce,{variant:"primary",onClick:on,disabled:!q||G,children:G?"...":""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),$?r.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):r.jsxs("select",{value:q,onChange:he=>Q(he.target.value),disabled:G||!!E,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:G?"#f3f4f6":"white"},children:[r.jsx("option",{value:"",children:"..."}),F.filter(he=>String(he?.id)&&String(he?.id)!==String(a?.id)).map(he=>r.jsxs("option",{value:he.id,children:[he.display_id,he.email?` (${he.email})`:"",he.role==="admin"?" []":""]},he.id))]}),E&&r.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:E})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:Vt,disabled:G,children:""}),r.jsx(ce,{variant:"primary",onClick:()=>te(!0),disabled:!q||G||$||!!E,children:""})]})]}),G&&r.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:O.total?`${O.done} / ${O.total}`:"..."})]})]}),r.jsx("div",{className:"bulk-progress-bar",children:r.jsx("div",{className:"bulk-progress-bar-inner",style:{width:O.total?`${Math.round(O.done/O.total*100)}%`:"0%"}})}),r.jsx("div",{className:"bulk-progress-current",title:O.current,children:O.current})]}),de?.message&&r.jsx("div",{className:`status-msg ${de.type||"info"}`,children:de.message}),Array.isArray(de?.failed)&&de.failed.length>0&&r.jsxs("div",{className:"bulk-progress-failures",children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",de.failed.length,""]}),r.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:de.failed.slice(0,10).map((he,Ke)=>r.jsxs("li",{children:[he?.file||"-",": ",he?.errorMessage||"unknown error"]},`${he?.file||"f"}-${Ke}`))}),de.failed.length>10&&r.jsxs("div",{style:{marginTop:"6px"},children:["... ",de.failed.length-10,""]})]})]})}),S&&r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>N(null),children:r.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:he=>he.stopPropagation(),children:[r.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),r.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:S.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>N(null),children:""}),r.jsx(ce,{variant:"danger",onClick:()=>{S.onConfirm(),N(null)},children:""})]})]})})]})},dT=({recipes:n,recentIds:t,onSelect:i})=>{if(!t||t.length===0)return null;const a=t.map(o=>n.find(u=>u.id===o)).filter(Boolean).slice(0,7);return a.length===0?null:r.jsxs("div",{className:"recent-recipes",children:[r.jsx("h3",{className:"recent-header",children:""}),r.jsx("div",{className:"recent-list",children:a.map(o=>r.jsxs("div",{className:"recent-item",onClick:()=>i(o),children:[r.jsx("div",{className:"recent-thumbnail",children:o.image?r.jsx("img",{src:o.image,alt:o.title}):r.jsx("div",{className:"recent-placeholder"})}),r.jsx("div",{className:"recent-info",children:r.jsx("div",{className:"recent-title",children:o.title})})]},o.id))})]})},hT=({onBack:n})=>(b.useEffect(()=>{window.scrollTo(0,0)},[]),r.jsxs("div",{className:"levain-guide-container",children:[r.jsxs("header",{className:"levain-guide-header",children:[r.jsx("h1",{children:"LEVAIN GUIDE"}),r.jsx("p",{className:"subtitle",children:" "}),r.jsx("p",{className:"subtitle",children:""}),r.jsx("div",{className:"divider"})]}),r.jsxs("main",{className:"levain-guide-main",children:[r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("p",{children:"Levain"}),r.jsx("h3",{children:""}),r.jsx("p",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",r.jsx("br",{}),r.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",r.jsx("br",{}),r.jsx("strong",{children:""})," Acetobacter aceti "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:["",r.jsx("br",{}),r.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",r.jsx("br",{}),"(   +  + )"]}),"",r.jsx("br",{}),r.jsxs("div",{className:"formula",children:["CHO  2CHO",r.jsx("br",{}),"(  )"]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"- 7-10"}),r.jsxs("div",{className:"timeline",children:[r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),r.jsx("p",{children:"100g + 100ml 20-22"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),r.jsx("p",{children:"50%50g + 50ml "}),r.jsx("p",{children:"100g  50g50g + 50ml"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),r.jsx("p",{children:"50%50g + 50ml "}),r.jsxs("div",{className:"success-box",children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),r.jsx("p",{children:"1150%1:1"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," 15",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," pH 3.5-4.0"]})]})]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"(g)"}),r.jsx("th",{children:"(ml)"}),r.jsx("th",{children:"(g)"}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"0"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"2"}),r.jsx("td",{children:"1"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"0"}),r.jsx("td",{children:""})]})]})]})})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"5-8"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"2-4"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"15-18"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"1-2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"20-22"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"3-5"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"25-28"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"2-3"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"30"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"1-2"})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"1"}),r.jsx("br",{}),"100g50g + 50ml"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"8-12"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),""]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"2%100ml2g"}),r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"2"}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 12 8:00"}),r.jsx("br",{}),"50g25g + 25ml "]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 1  14:00"}),r.jsx("br",{}),"25g + 25ml 2"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 1  20:00"}),r.jsx("br",{}),""]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:" "})," ",r.jsx("br",{}),"",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:" "})," pH",r.jsx("br",{}),"pH 3.5-4.0pH"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"18"}),r.jsx("td",{children:"16-24"}),r.jsx("td",{children:"1"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"20-22"}),r.jsx("td",{children:"12-16"}),r.jsx("td",{children:"2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"24-26"}),r.jsx("td",{children:"8-12"}),r.jsx("td",{children:"2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"28"}),r.jsx("td",{children:"4-8"}),r.jsx("td",{children:"2"})]})]})]})})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"1"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. 22",r.jsx("br",{}),"2. 12",r.jsx("br",{}),"3. 1",r.jsx("br",{}),"4. 1-2"]}),r.jsx("h3",{children:"2"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," pH",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," "]}),r.jsx("h3",{children:"3"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. 15",r.jsx("br",{}),"3. 80%"]}),r.jsx("h3",{children:"4"}),r.jsxs("div",{className:"success-box",children:["",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," "]}),r.jsx("h3",{children:"5"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. 1:0.8",r.jsx("br",{}),"2. ",r.jsx("br",{}),"3. "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"pH"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"pH4-8.0"}),r.jsx("br",{}),r.jsx("br",{})," pH 7.0",r.jsx("br",{})," pH 4.5-5.5",r.jsx("br",{})," pH 3.5-4.0",r.jsx("br",{})," pH 3.0"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:[r.jsx("strong",{children:"pH 3.8-4.0"})," ",r.jsx("br",{}),r.jsx("strong",{children:"pH 3.5"})," ",r.jsx("br",{}),r.jsx("strong",{children:"pH 4.5"})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," 1",r.jsx("br",{})," ",r.jsx("br",{})," -203"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"15-20"}),r.jsx("td",{children:"18-20"}),r.jsx("td",{children:"1-2"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"25+"}),r.jsx("td",{children:"22-24"}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"18-22"}),r.jsx("td",{children:"20-22"}),r.jsx("td",{children:"1-2"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"5-15"}),r.jsx("td",{children:"18"}),r.jsx("td",{children:"2-3"}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," 24",r.jsx("br",{})," ",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," 18",r.jsx("br",{})," "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"100g + 50g + 150ml 12-24",r.jsx("br",{}),"11-2"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"100ml"}),r.jsx("br",{})," 110 to 110 CFU/ml",r.jsx("br",{})," 110 to 110 CFU/ml",r.jsx("br",{})," pH3.5-4.0",r.jsx("br",{})," 0.5-1.5%",r.jsx("br",{})," 0.3-0.8%"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"15-25% ()"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"5-15%"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"20-30%"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"30-50%"}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"formula",children:[" 18   - 8",r.jsx("br",{}),r.jsx("br",{}),"",r.jsx("br",{})," 2018  (20-8) = 1.5",r.jsx("br",{})," 2418  (24-8) = 1.125",r.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),r.jsxs("footer",{className:"levain-footer",children:[r.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),r.jsx("p",{children:""})]}),r.jsxs("button",{className:"levain-back-button",onClick:n,children:[r.jsx("span",{children:""})," "]})]})),fT=({onBack:n})=>{const{user:t,patchCurrentUserProfile:i}=fs(),[a,o]=b.useState([]),[u,d]=b.useState(!0),[f,h]=b.useState(null),[p,y]=b.useState(null),[v,x]=b.useState(""),[w,_]=b.useState(""),[C,S]=b.useState(""),[N,T]=b.useState(""),[L,R]=b.useState(!1),[J,H]=b.useState(!1),[V,k]=b.useState(new Set),[M,z]=b.useState(null),[U,F]=b.useState([]),[Y,$]=b.useState(!1),P=_e.useCallback(async()=>{try{d(!0);const O=await Hs.fetchAllProfiles();o(O)}catch(O){console.error(O),h("")}finally{d(!1)}},[]);b.useEffect(()=>{P()},[P]);const E=a.filter(O=>O.role==="admin"),B=a.filter(O=>O.role!=="admin"),q=(O,K)=>{k(de=>{const pe=new Set(de);return K?pe.add(O):pe.delete(O),pe})},Q=async(O,K)=>{const de=!!O.show_master_recipes;h(null),o(pe=>pe.map(ve=>ve.id===O.id?{...ve,show_master_recipes:K}:ve)),O.id===t?.id&&i?.({showMasterRecipes:K}),q(O.id,!0);try{const ve=!!(await Hs.updateProfile(O.id,{show_master_recipes:K}))?.show_master_recipes;o(te=>te.map(W=>W.id===O.id?{...W,show_master_recipes:ve}:W)),O.id===t?.id&&i?.({showMasterRecipes:ve})}catch(pe){console.error(pe),o(ve=>ve.map(te=>te.id===O.id?{...te,show_master_recipes:de}:te)),O.id===t?.id&&i?.({showMasterRecipes:de}),h("RLS")}finally{q(O.id,!1)}},G=async O=>{z(O),$(!0),h("");try{const K=await Hs.adminGetLoginLogs(O.id);F(K)}catch(K){console.error(K),h("")}finally{$(!1)}},A=({user:O,isAdmin:K})=>{const pe=(ve=>{if(!ve)return null;const te=(Date.now()-new Date(ve).getTime())/(1e3*60*60);return te<24?{text:"24h",color:"#ff2d55",bg:"#ffe5e9"}:te<72?{text:"3",color:"#ff9500",bg:"#fff0d4"}:te<168?{text:"1",color:"#34c759",bg:"#e5f9e7"}:te<720?{text:"1",color:"#007aff",bg:"#e5f1ff"}:null})(O.last_sign_in_at);return r.jsxs(hn,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[r.jsxs("div",{children:[r.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[O.display_id," ",K&&r.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),O.email&&r.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:O.email}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date(O.created_at).toLocaleString()]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",O.updated_at?new Date(O.updated_at).toLocaleString():"---"]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",display:"flex",alignItems:"center"},children:[": ",O.last_sign_in_at?new Date(O.last_sign_in_at).toLocaleString():"",pe&&r.jsx("span",{style:{backgroundColor:pe.bg,color:pe.color,border:`1px solid ${pe.color}`,padding:"1px 6px",borderRadius:"12px",fontSize:"0.7rem",marginLeft:"8px",fontWeight:"bold",lineHeight:1},children:pe.text})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:O.show_master_recipes||!1,disabled:V.has(O.id),onChange:ve=>Q(O,ve.target.checked)}),""]}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>G(O),style:{whiteSpace:"nowrap"},children:""}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>{y({id:O.id,display_id:O.display_id,email:O.email}),x(""),_(""),S(""),T("")},style:{whiteSpace:"nowrap"},children:""})]})]},O.id)};return r.jsx("div",{style:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:r.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",width:"100%",overflowY:"auto",flex:1},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[r.jsx("h2",{children:""}),r.jsx(ce,{variant:"ghost",onClick:n,children:""})]}),f&&r.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:f}),u?r.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[E.length>0&&r.jsxs("div",{children:[r.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:E.map(O=>r.jsx(A,{user:O,isAdmin:!0},O.id))})]}),r.jsxs("div",{children:[r.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:B.length>0?B.map(O=>r.jsx(A,{user:O,isAdmin:!1},O.id)):r.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),r.jsx(bn,{isOpen:!!p,onClose:()=>{L||y(null)},title:": ",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",p?.display_id||p?.email||p?.id]}),p?.email&&r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:p.email}),r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),C&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:C}),N&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:N}),r.jsxs("div",{style:{display:"grid",gap:"10px"},children:[r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),r.jsx("input",{type:"password",value:v,onChange:O=>x(O.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),r.jsx("input",{type:"password",value:w,onChange:O=>_(O.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>y(null),disabled:L,children:""}),r.jsx(ce,{variant:"secondary",isLoading:J,disabled:!p?.email||L,onClick:async()=>{if(S(""),T(""),!p?.email){S("");return}H(!0);try{await Hs.sendPasswordResetEmail(p.email),T("")}catch(O){console.error(O),S(O?.message||"")}finally{H(!1)}},style:{whiteSpace:"nowrap"},children:""}),r.jsx(ce,{variant:"danger",isLoading:L,onClick:async()=>{if(S(""),T(""),!!p?.id){if(!v||v.length<8){S("8");return}if(v!==w){S("");return}R(!0);try{await Hs.adminResetPassword(p.id,v),T(""),x(""),_("")}catch(O){console.error(O);const K=O?.message||"";/FunctionsHttpError|not found|404/i.test(K)||/admin-reset-password/i.test(K)?S(""):S(K)}finally{R(!1)}}},children:""})]})]})}),r.jsx(bn,{isOpen:!!M,onClose:()=>z(null),title:"",size:"medium",children:r.jsxs("div",{style:{color:"var(--text-color)",lineHeight:1.5,minHeight:"300px",display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"16px",paddingBottom:"8px",borderBottom:"1px solid #ddd"},children:[": ",M?.display_id||M?.email||M?.id]}),Y?r.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:"#666"},children:"..."}):U.length>0?r.jsx("div",{style:{flex:1,overflowY:"auto",maxHeight:"400px"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsx("tr",{children:r.jsx("th",{style:{textAlign:"left",padding:"8px",borderBottom:"2px solid #ddd",backgroundColor:"#f5f5f5"},children:""})})}),r.jsx("tbody",{children:U.map((O,K)=>r.jsx("tr",{style:{borderBottom:"1px solid #eee"},children:r.jsx("td",{style:{padding:"8px"},children:new Date(O.login_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})},K))})]})}):r.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:["",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.85rem"},children:""})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"20px"},children:r.jsx(ce,{variant:"secondary",onClick:()=>z(null),children:""})})]})})]})})},bs="inventory_items",ca="inventory_snapshots",Do="deleted_inventory_snapshots",cl=(n,t)=>{const i=String(n?.message||"");return String(n?.code||"")==="42703"?i.toLowerCase().includes(String(t).toLowerCase()):i.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&i.toLowerCase().includes("does not exist")},Zn={getAll:async n=>{if(!n)return[];const{data:t,error:i}=await Ee.from(bs).select("*").eq("user_id",n).order("created_at",{ascending:!0});return i?(console.error("Error fetching inventory:",i),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:i,isPhantom:a,_master:o,_csv:u,...d}=t,f=t?.tax10_override??t?.tax10Override,h=Object.prototype.hasOwnProperty.call(t||{},"tax10"),p=Object.prototype.hasOwnProperty.call(t||{},"tax10_override")||Object.prototype.hasOwnProperty.call(t||{},"tax10Override"),y=String(d?.name??"").trim(),v=String(d?.vendor??"").trim(),x={...d,name:y,vendor:v||null,user_id:n,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0};h&&(x.tax10=!!t.tax10),p&&(x.tax10_override=!!f);const w=async S=>Ee.from(bs).insert([S]).select().single();let{data:_,error:C}=await w(x);if(C){const S=cl(C,"tax10"),N=cl(C,"tax10_override");if(S||N){const T={...x};S&&delete T.tax10,N&&delete T.tax10_override,{data:_,error:C}=await w(T)}}if(C&&String(C?.code||"")==="23505"){let S=Ee.from(bs).select("*").eq("user_id",n).eq("name",y).order("updated_at",{ascending:!1}).order("id",{ascending:!1}).limit(1);v?S=S.eq("vendor",v):S=S.is("vendor",null);const{data:N,error:T}=await S;if(!T&&Array.isArray(N)&&N.length>0){const L=N[0];return await Zn.update(n,{...L,...x,id:L.id})}}if(C)throw console.error("Error adding item:",C),C;return _},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:i,isPhantom:a,created_at:o,_master:u,_csv:d,...f}=t,h=t?.tax10_override??t?.tax10Override,p=Object.prototype.hasOwnProperty.call(t||{},"tax10"),y=Object.prototype.hasOwnProperty.call(t||{},"tax10_override")||Object.prototype.hasOwnProperty.call(t||{},"tax10Override"),v={...f,name:Object.prototype.hasOwnProperty.call(f||{},"name")?String(f.name??"").trim():f.name,vendor:Object.prototype.hasOwnProperty.call(f||{},"vendor")?String(f.vendor??"").trim()||null:f.vendor,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()};p&&(v.tax10=!!t.tax10),y&&(v.tax10_override=!!h);const x=async C=>Ee.from(bs).update(C).eq("id",t.id).eq("user_id",n).select().single();let{data:w,error:_}=await x(v);if(_){const C=cl(_,"tax10"),S=cl(_,"tax10_override");if(C||S){const N={...v};C&&delete N.tax10,S&&delete N.tax10_override,{data:w,error:_}=await x(N)}}if(_)throw console.error("Error updating item:",_),_;return w},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:i}=await Ee.from(bs).delete().eq("id",t).eq("user_id",n);if(i)throw console.error("Error deleting item:",i),i},adjustStock:async(n,t,i)=>{if(!n)throw new Error("User ID is required");const{data:a,error:o}=await Ee.from(bs).select("quantity").eq("id",t).eq("user_id",n).single();if(o||!a)throw new Error("Item not found");const u=Math.max(0,(a.quantity||0)+i),{data:d,error:f}=await Ee.from(bs).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(f)throw f;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await Ee.from(bs).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:i}=await Ee.from("ignored_items").select("name").eq("user_id",n);return i?(console.error("Error fetching ignored items:",i),new Set):new Set(t.map(a=>a.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:i}=await Ee.from("ignored_items").insert([{user_id:n,name:t}]).select();if(i&&i.code!=="23505")throw console.error("Error ignoring item:",i),i},getSnapshots:async n=>{if(!n)return[];const{data:t,error:i}=await Ee.from(ca).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return i?(console.error("Error fetching snapshots:",i),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:i}=await Ee.from(Do).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return i?(console.error("Error fetching deleted snapshots:",i),[]):t||[]},createSnapshot:async(n,t,i,a)=>{if(!n)throw new Error("User ID is required");let o=null,u=null;const d=await Ee.from(ca).insert([{user_id:n,title:t,items:i,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();if(o=d.data??null,u=d.error??null,u&&cl(u,"user_id")){const f=await Ee.from(ca).insert([{title:t,items:i,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();o=f.data??null,u=f.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return o},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:i,error:a}=await Ee.from(ca).select("*").eq("id",t).eq("user_id",n).single();if(a||!i)throw console.error("Error fetching snapshot for delete:",a),a||new Error("Snapshot not found");const{error:o}=await Ee.from(Do).insert([{original_id:i.id,user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at,deleted_at:new Date().toISOString()}]);if(o)throw console.error("Error moving snapshot to trash:",o),o;const{error:u}=await Ee.from(ca).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:i,error:a}=await Ee.from(Do).select("*").eq("id",t).eq("user_id",n).single();if(a||!i)throw console.error("Error fetching deleted snapshot:",a),a||new Error("Deleted snapshot not found");let o=null;{const{error:d}=await Ee.from(ca).insert([{id:i.original_id,user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at}]);o=d}if(o){const{error:d}=await Ee.from(ca).insert([{user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await Ee.from(Do).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:i}=await Ee.from(Do).delete().eq("id",t).eq("user_id",n);if(i)throw console.error("Error hard deleting snapshot from trash:",i),i;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await Ee.from(bs).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(cl(t.error,"user_id")){const i=await Ee.from(bs).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(i.error)throw console.error("Error resetting quantities (fallback):",i.error),i.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},fa=n=>{const t=String(n??"").trim();if(!t)return"";const i=t.toLowerCase();return i===""?"g":i===""?"ml":i===""?"cc":i===""?"kg":i===""?"l":i===""?"cl":i},pT=(n,t)=>{const i=fa(n),a=fa(t);if(!i||!a)return null;if(i===a)return 1;if(i==="kg"&&a==="g")return 1e3;if(i==="g"&&a==="kg")return 1/1e3;const o=i==="cc"?"ml":i,u=a==="cc"?"ml":a;return o==="l"&&u==="ml"?1e3:o==="ml"&&u==="l"?1/1e3:o==="cl"&&u==="ml"?10:o==="ml"&&u==="cl"?1/10:null},mT=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},Mo=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},gT=({index:n,item:t,isLowStock:i,onUpdateQuantity:a,onDelete:o,onToggleTax:u,onEdit:d,onRequestUnitSync:f})=>{const[h,p]=_e.useState(t.quantity===""?"":parseFloat(t.quantity)||0),y=$=>{const P=String($||"").trim();return P?P==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(P)?P:"":""},v={food:"",alcohol:"",soft_drink:"",supplies:""};_e.useEffect(()=>{p(t.quantity===""?"":parseFloat(t.quantity)||0)},[t.quantity]);const x=parseFloat(t.price)||0,w=(()=>{if(!Number.isFinite(x)||x<=0)return"-";const $=t?._csv?.unit,P=String($||"").trim(),E=String(t?.unit||"").trim();if(!P)return`${Mo(x)}`;const B=fa(E),q=fa(P);if(q===B)return`${Mo(x)}/${P}`;const Q=pT(q,B);if(Q!==null)return`${Mo(x*Q)}/${P}`;const G=parseFloat(t?._master?.packetSize),A=String(t?._master?.packetUnit||"").trim(),O=fa(A);return mT(P)&&Number.isFinite(G)&&G>0&&O===B?`${Mo(x*G)}/${P}`:`${Mo(x)}/${E||"-"}`})(),_=y(t?._master?.itemCategory),C=_==="alcohol"||_==="supplies",S=t?.tax10_override===!0||t?.tax10_override===1||t?.tax10_override==="1"||t?.tax10_override==="true",N=_?S?t?.tax10===!0||t?.tax10===1||t?.tax10==="1"||t?.tax10==="true":C:t?.tax10===!0||t?.tax10===1||t?.tax10==="1"||t?.tax10==="true",T=_?S?`${v[_]||_}: ${C?"10%":"8%"}/ `:`${v[_]||_}${N?"10%":"8%"}`:"10%",L=N?1.1:1.08,R=h===""?0:parseFloat(h),J=x*R*L,H=_e.useMemo(()=>{const $=t?._master?.packetSize,P=t?._master?.packetUnit,E=parseFloat($);return!Number.isFinite(E)||E<=0?"-":`${Number.isInteger(E)?E.toLocaleString():E.toLocaleString(void 0,{maximumFractionDigits:3})}${P?String(P):""}`},[t?._master?.packetSize,t?._master?.packetUnit]),V=()=>{const $=parseFloat(h);!isNaN($)&&$!==t.quantity&&a(t.id,$)},k=$=>{$&&setTimeout(()=>{try{$.select()}catch{}},0)},M=$=>{const E=$?.closest?.("table")||document;return Array.from(E.querySelectorAll("input.inventory-quantity-input"))},z=($,P)=>{const E=M($).filter(Q=>!Q.disabled),B=E.indexOf($);if(B<0)return!1;const q=E[B+P];return q?(requestAnimationFrame(()=>{try{q.scrollIntoView({block:"nearest"})}catch{}q.focus(),k(q)}),!0):!1},U=$=>{if($.key==="Enter"){$.preventDefault(),z($.currentTarget,$.shiftKey?-1:1),$.currentTarget.blur();return}$.key==="Tab"&&z($.currentTarget,$.shiftKey?-1:1)&&($.preventDefault(),$.currentTarget.blur()),($.key==="ArrowUp"||$.key==="ArrowDown")&&z($.currentTarget,$.key==="ArrowUp"?-1:1)&&($.preventDefault(),$.currentTarget.blur())},F=t?._master?.packetUnit||"",Y=!!F&&fa(F)!==fa(t?.unit);return r.jsxs("tr",{className:i(t)?"low-stock":"",children:[r.jsx("td",{style:{textAlign:"center",color:"#6b7280",fontVariantNumeric:"tabular-nums"},children:Number.isFinite(n)?n+1:""}),r.jsx("td",{style:{textAlign:"center"},children:r.jsx("input",{type:"checkbox",checked:N,onChange:$=>u&&u(t,$.target.checked),title:T,className:"inventory-tax-checkbox"})}),r.jsxs("td",{children:[t.name,i(t)&&r.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),r.jsx("td",{style:{textAlign:"right"},children:w}),r.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:H}),r.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[r.jsx("input",{type:"text",inputMode:"decimal",value:h,onChange:$=>p(Zb($.target.value)),className:"inventory-quantity-input no-print",onBlur:V,onKeyDown:U,onFocus:$=>k($.target),onClick:$=>k($.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),r.jsx("span",{className:"print-only",style:{display:"none"},children:h})]}),r.jsx("td",{children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx("span",{children:t.unit}),Y&&typeof f=="function"&&r.jsx("button",{type:"button",onClick:()=>f(t),title:`${F}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),r.jsx("td",{style:{textAlign:"right"},children:J>0?`${Math.round(J).toLocaleString()}`:"-"}),r.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:t.vendor||"-"}),r.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof d=="function"&&r.jsx("button",{type:"button",onClick:()=>d(t),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),r.jsx("button",{onClick:()=>o(t),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},yT=({items:n,loading:t,onDelete:i,onUpdateQuantity:a,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:f,isOver:h}=fc({id:"inventory-list-droppable"}),p=_=>_.threshold>0&&_.quantity<=_.threshold,[y,v]=_e.useState({key:null,direction:"asc"}),x=_=>{v(C=>C.key===_?{key:_,direction:C.direction==="asc"?"desc":"asc"}:{key:_,direction:"asc"})},w=_e.useMemo(()=>{if(!y.key)return n;const _=[...n];return y.key==="vendor"&&_.sort((C,S)=>{const N=(C?.vendor||"").toString(),T=(S?.vendor||"").toString(),L=N.localeCompare(T,"ja");if(L!==0)return y.direction==="asc"?L:-L;const R=(C?.name||"").toString(),J=(S?.name||"").toString(),H=R.localeCompare(J,"ja");return y.direction==="asc"?H:-H}),_},[n,y]);return r.jsxs("div",{ref:f,className:`inventory-list-droppable ${h?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:h?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[r.jsx("div",{className:"inventory-table-container",children:t?r.jsx("p",{children:"Loading..."}):r.jsxs("table",{className:"inventory-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{textAlign:"center",width:"44px"},children:"No"}),r.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"}),r.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),r.jsx("th",{style:{width:"40px"}})]})}),r.jsxs("tbody",{children:[w.map((_,C)=>r.jsx(gT,{index:C,item:_,isLowStock:p,onUpdateQuantity:a,onEdit:u,onDelete:i,onToggleTax:o,onRequestUnitSync:d},_.id)),w.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#888",padding:"2rem"},children:h?"":""})})]}),r.jsx("tfoot",{children:(()=>{const _=n.reduce((C,S)=>{const N=parseFloat(S.price)||0,T=S.quantity===""?0:parseFloat(S.quantity)||0,L=S?.tax10===!0||S?.tax10===1||S?.tax10==="1"||S?.tax10==="true"?1.1:1.08,R=N*T;return C.net+=R,C.taxed+=R*L,C},{net:0,taxed:0});return r.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[r.jsx("td",{colSpan:"7",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(_.net).toLocaleString()," / ",Math.round(_.taxed).toLocaleString()]}),r.jsx("td",{colSpan:"2"})]})})()})]})}),h&&r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},vT=({onBack:n})=>{const{user:t}=fs(),i=t?.id,[,a]=oc(),[o,u]=b.useState([]),[d,f]=b.useState([]),[h,p]=b.useState([]),[y,v]=b.useState([]),[x,w]=b.useState(new Map),[_,C]=b.useState(new Map),[S,N]=b.useState(new Set),[T,L]=b.useState(!0),[R,J]=b.useState(""),[H,V]=b.useState(!1),[k,M]=b.useState(null),[z,U]=b.useState(""),[F,Y]=b.useState(!1),[$,P]=b.useState(null),[E,B]=b.useState(!1),[q,Q]=b.useState(!1),[G,A]=b.useState(""),[O,K]=b.useState(!1),[de,pe]=b.useState(!0),[ve,te]=b.useState(!1),[W,me]=b.useState(null),[ke,ie]=b.useState("history"),[je,Re]=b.useState(null),[Oe,qe]=b.useState(""),[et,at]=b.useState(!1),[lt,pt]=b.useState(null),[we,ae]=b.useState(!0),[Ge,Ne]=b.useState({key:"name",direction:"asc"}),[dt,rt]=b.useState(!1),[Ve,ot]=b.useState(null),[tt,St]=b.useState(new Set),[gn,Ct]=b.useState(!1),[zt,Ft]=b.useState(null),[rn,ln]=b.useState(null),[sn,zn]=b.useState(!1),Xt=xa(hr(xd,{activationConstraint:{distance:8}})),[ee,De]=b.useState("all"),[Te,Ie]=b.useState(new Set),[Fe,it]=b.useState(""),[wt,Pt]=b.useState(""),[Vt,on]=b.useState({});b.useEffect(()=>{U(k&&k.name||"")},[k]);const[he,Ke]=b.useState(""),mt=({row:I,onVendorClick:Z,isSelected:re})=>{const{attributes:Se,listeners:Ue,setNodeRef:Be,setActivatorNodeRef:He,transform:Qe,transition:Ze,isDragging:st}=ba({id:I.vendor,data:{type:"summary-row"}}),gt={transform:jr.Transform.toString(Qe),transition:Ze,opacity:st?.6:1};return r.jsxs("tr",{ref:Be,style:gt,...Se,className:re?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[r.jsx("td",{className:"inventory-summary__drag",children:r.jsx("span",{ref:He,...Ue,className:"inventory-summary__drag-handle",title:"",children:""})}),r.jsx("td",{children:r.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>Z?.(I.vendor),"aria-expanded":!!re,children:[r.jsx("span",{children:I.vendor}),r.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:re?"":""})]})}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(I.total||0).toLocaleString()]})]})};b.useEffect(()=>{i&&(De("all"),J(""),ct())},[i]);const ct=async(I=!1)=>{I||L(!0);try{const[Z,re,Se,Ue,Be,He,Qe]=await Promise.all([Zn.getAll(i),or.getPriceListArray(),Zn.getIgnoredItems(i),Zn.getSnapshots(i),Zn.getDeletedSnapshots(i),Ln.getAllConversions(),ud.getAll(i)]);u(Z),v(re),N(Se),f(Ue||[]),p(Be||[]),w(He||new Map),C(Qe||new Map);const Ze=nt=>{if(!nt)return-1;const En=new Date(nt).getTime();return Number.isFinite(En)?En:-1},st=(nt,It)=>{const En=Math.max(Ze(nt?.updated_at),Ze(nt?.updatedAt),Ze(nt?.created_at),Ze(nt?.createdAt)),kn=Math.max(Ze(It?.updated_at),Ze(It?.updatedAt),Ze(It?.created_at),Ze(It?.createdAt));return En!==kn&&kn>En?It:nt},gt=new Map;(Z||[]).forEach(nt=>{const It=String(nt?.vendor??"").trim()||"__no_vendor__",En=Wt(nt?.name)||String(nt?.name??"").trim();if(!En)return;const kn=`${It}@@${En}`,Ur=gt.get(kn);if(!Ur){gt.set(kn,nt);return}gt.set(kn,st(Ur,nt))});const xt=new Set(Array.from(gt.values()).map(nt=>nt.id));Ie(xt)}catch(Z){console.error("Failed to load data:",Z)}finally{I||L(!1)}},Lt=I=>{if(!I)return"-";const Z=new Date(I);if(Number.isNaN(Z.getTime()))return String(I);const re=Z.getFullYear(),Se=String(Z.getMonth()+1).padStart(2,"0"),Ue=String(Z.getDate()).padStart(2,"0"),Be=String(Z.getHours()).padStart(2,"0"),He=String(Z.getMinutes()).padStart(2,"0");return`${re}/${Se}/${Ue} ${Be}:${He}`},ut=I=>{const Z=I?.items;return Array.isArray(Z)?Z:Z?[]:[]},Mt=I=>{const Z=I?.snapshot_date||I?.created_at;if(!Z)return null;const re=new Date(Z);return Number.isNaN(re.getTime())?null:re},tn=_e.useMemo(()=>new Set([""]),[]),ht=I=>{const Z=String(I??"").trim();return tn.has(Z)},le=I=>I===!0||I===1||I==="1"||I==="true",$e=I=>{const Z=String(I??"").trim();if(!Z)return"";const re=Z.toLowerCase();return re===""?"g":re===""?"ml":re===""?"cc":re===""?"kg":re===""?"l":re===""?"cl":re},ze=(I,Z)=>{const re=parseFloat(I?.lastPrice),Se=parseFloat(I?.packetSize),Ue=$e(I?.packetUnit),Be=$e(Z||Ue);if(!Number.isFinite(re)||!Number.isFinite(Se)||Se<=0||!Ue)return null;const He=re/Se;if(Be===Ue)return He;if(Ue==="g"&&Be==="kg")return He*1e3;if(Ue==="kg"&&Be==="g")return He/1e3;const Qe=Ue==="cc"?"ml":Ue,Ze=Be==="cc"?"ml":Be;return Qe==="ml"&&Ze==="l"?He*1e3:Qe==="l"&&Ze==="ml"?He/1e3:Qe==="cl"&&Ze==="ml"?re/Se/10:Qe==="ml"&&Ze==="cl"?He*10:Qe==="cl"&&Ze==="cl"?He:null},At=(I,Z)=>{const re=$e(I),Se=$e(Z);if(!re||!Se)return null;if(re===Se)return 1;if(re==="kg"&&Se==="g")return 1e3;if(re==="g"&&Se==="kg")return 1/1e3;const Ue=re==="cc"?"ml":re,Be=Se==="cc"?"ml":Se;return Ue==="l"&&Be==="ml"?1e3:Ue==="ml"&&Be==="l"?1/1e3:Ue==="cl"&&Be==="ml"?10:Ue==="ml"&&Be==="cl"?1/10:null},Tt=I=>{const Z=String(I||"").trim();return Z?Z==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(Z)?Z:"":""},Et=I=>{const Z=Tt(I);return Z==="alcohol"||Z==="supplies"},oe=I=>{const Z=Tt(I);return Z==="food"?"":Z==="alcohol"||Z==="soft_drink"?"":Z==="supplies"?"":""},ne=I=>{const Z=Tt(I);return Z==="food"?"food":Z==="alcohol"||Z==="soft_drink"?"drink":Z==="supplies"?"supplies":"unknown"},ue=I=>I==="food"?"":I==="drink"?"":I==="supplies"?"":"",xe=I=>le(I?.tax10)?1.1:1.08,Pe=I=>I?`${I.getFullYear()}-${String(I.getMonth()+1).padStart(2,"0")}`:"",Je=I=>{if(!I)return-1;const re=new Date(I).getTime();return Number.isFinite(re)?re:-1},Xe=I=>{const Z=[I?.updated_at,I?.updatedAt,I?.created_at,I?.createdAt];for(const re of Z){const Se=Je(re);if(Se>=0)return Se}return-1},Ye=_e.useMemo(()=>{const I=new Map;return d.forEach(Z=>{const re=Mt(Z);if(!re)return;const Se=Pe(re);I.has(Se)||I.set(Se,{key:Se,year:re.getFullYear(),month:re.getMonth()+1})}),Array.from(I.values()).sort((Z,re)=>re.key.localeCompare(Z.key)).map(Z=>({...Z,label:`${Z.year}${Z.month}`}))},[d]);b.useEffect(()=>{if(Ye.length===0){Fe&&it("");return}if(Fe&&Ye.some(re=>re.key===Fe))return;const I=Pe(new Date),Z=Ye.find(re=>re.key===I)?.key||Ye[0].key;it(Z)},[Ye,Fe]),b.useEffect(()=>{if(Ye.length===0){wt&&Pt("");return}if(wt&&Ye.some(re=>re.key===wt))return;const I=Pe(new Date),Z=Ye.find(re=>re.key===I)?.key||Ye[0].key;Pt(Z)},[Ye,wt]);const jt=_e.useMemo(()=>{if(!wt)return null;const[I,Z]=wt.split("-"),re=parseInt(I,10),Se=parseInt(Z,10);if(!Number.isFinite(re)||!Number.isFinite(Se))return null;const Ue=Qe=>String(Qe).padStart(2,"0"),Be=new Date(re,Se-1,1),He=new Date(re,Se,0);return{year:re,month:Se,start:Be,end:He,rangeLabel:`${re}/${Ue(Se)}/01${re}/${Ue(Se)}/${Ue(He.getDate())}`}},[wt]),an=_e.useMemo(()=>wt?d.map(I=>({snapshot:I,date:Mt(I)})).filter(I=>I.date&&Pe(I.date)===wt).sort((I,Z)=>Z.date-I.date).map(I=>I.snapshot):d,[d,wt]),nn=_e.useMemo(()=>{if(!Fe)return null;const[I,Z]=Fe.split("-"),re=parseInt(I,10),Se=parseInt(Z,10);if(!Number.isFinite(re)||!Number.isFinite(Se))return null;const Ue=Qe=>String(Qe).padStart(2,"0"),Be=new Date(re,Se-1,1),He=new Date(re,Se,0);return{year:re,month:Se,start:Be,end:He,rangeLabel:`${re}/${Ue(Se)}/01${re}/${Ue(Se)}/${Ue(He.getDate())}`}},[Fe]),We=_e.useMemo(()=>Fe?d.map(I=>({snapshot:I,date:Mt(I)})).filter(I=>I.date&&Pe(I.date)===Fe).sort((I,Z)=>Z.date-I.date).map(I=>I.snapshot):[],[d,Fe]),_t=We[0]||null,fn=Fe||(_t?.id?`snapshot:${_t.id}`:""),Qn=_e.useMemo(()=>{const I=new Map;return We.forEach(Z=>{const re=Mt(Z)?.getTime()||-1;ut(Z).forEach((Ue,Be)=>{const He=(Ue?.vendor||"").toString().trim();if(ht(He))return;const Qe=He||"",Ze=String(Ue?.name||"").trim();if(!Ze)return;const st=`${Qe}::${Ze}`,gt={item:{...Ue,vendor:Qe},snapshotMs:re,itemUpdatedMs:Xe(Ue),rowIndex:Be},xt=I.get(st);if(!xt){I.set(st,gt);return}if(gt.snapshotMs!==xt.snapshotMs){gt.snapshotMs>xt.snapshotMs&&I.set(st,gt);return}if(gt.itemUpdatedMs!==xt.itemUpdatedMs){gt.itemUpdatedMs>xt.itemUpdatedMs&&I.set(st,gt);return}gt.rowIndex>=xt.rowIndex&&I.set(st,gt)})}),Array.from(I.values()).map(Z=>Z.item)},[We,ht]),Jn=_e.useMemo(()=>{const I=new Map;return Qn.forEach(Z=>{const re=(Z?.vendor||"").toString().trim(),Se=re||"";if(ht(re))return;const Ue=parseFloat(Z?.price)||0,Be=Z?.quantity===""?0:parseFloat(Z?.quantity)||0,He=Ue*Be,Qe=He*xe(Z),Ze=I.get(Se)||{vendor:Se,net:0,taxed:0};Ze.net+=He,Ze.taxed+=Qe,I.set(Se,Ze)}),Array.from(I.values()).map(Z=>({vendor:Z.vendor,net:Z.net,taxed:Z.taxed,total:Z.taxed}))},[Qn,ht,xe]),mr=_e.useMemo(()=>{const I=new Map;return Jn.forEach(Z=>{I.set(Z.vendor,Z)}),I},[Jn]),Jr=_e.useMemo(()=>{const I=new Map;try{for(const[Z,re]of(x||new Map).entries()){const Se=String(Z??"").trim();Se&&I.set(Se,re)}}catch{}return I},[x]),Mr=_e.useCallback(I=>{const Z=Tt(I?.itemCategory??I?.item_category);if(Z)return Z;const re=String(I?.name??"").trim();if(!re)return"";const Se=Jr.get(re);return Tt(Se?.itemCategory??Se?.item_category)},[Jr]),Xr=_e.useMemo(()=>{const I=new Map;Qn.forEach((Z,re)=>{const Se=(Z?.vendor||"").toString().trim(),Ue=Se||"";if(ht(Se))return;const Be=parseFloat(Z?.price)||0,He=Z?.quantity===""?0:parseFloat(Z?.quantity)||0,Qe=Be*He,Ze=Qe*xe(Z),st=Mr(Z),gt=ne(st),xt=I.get(Ue)||{vendor:Ue,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};xt.totals[gt]+=Ze,xt.totals.net+=Qe,xt.totals.taxed+=Ze,xt.rows.push({id:Z?.id||`${Ue}-${Z?.name||"item"}-${re}`,name:Z?.name||"",unit:Z?.unit||"",quantity:He,price:Be,taxed:Ze,itemCategory:st,breakdownKey:gt}),I.set(Ue,xt)});for(const Z of I.values())Z.rows.sort((re,Se)=>{const Ue={food:0,drink:1,unknown:2,supplies:3},Be=Ue[re?.breakdownKey]??2,He=Ue[Se?.breakdownKey]??2;if(Be!==He)return Be-He;const Qe=(re?.name||"").toString(),Ze=(Se?.name||"").toString();return Qe.localeCompare(Ze,"ja")});return I},[Qn,ht,xe,Mr]),ur=_e.useMemo(()=>Jn.slice().sort((I,Z)=>Z.taxed!==I.taxed?Z.taxed-I.taxed:I.vendor.localeCompare(Z.vendor,"ja")).map(I=>I.vendor),[Jn]),Ii=_e.useMemo(()=>{if(!fn)return ur;const I=Vt[fn],Z=new Set(mr.keys()),re=Array.isArray(I)?I.filter(Ue=>Z.has(Ue)):[],Se=ur.filter(Ue=>!re.includes(Ue));return[...re,...Se]},[Vt,fn,ur,mr]),wa=_e.useMemo(()=>Ii.map(I=>mr.get(I)).filter(Boolean),[Ii,mr]),Sa=wa.reduce((I,Z)=>(I.net+=Z.net||0,I.taxed+=Z.taxed||0,I),{net:0,taxed:0});b.useEffect(()=>{he&&(mr.has(he)||Ke(""))},[he,mr]);const mc=I=>{Ke(Z=>Z===I?"":I)},ja=I=>{I?.id&&i&&(at(!1),pt(null),qe(""),Re({title:"",message:`${I.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{at(!0),pt({type:"move",id:I.id});try{await Zn.deleteSnapshotToTrash(i,I.id),await ct(!0),Ft({title:"",message:"",type:"success"})}catch(Z){console.error(Z),Ft({title:"",message:"()",type:"error"})}finally{at(!1),pt(null),Re(null)}}}))},Td=I=>{I?.id&&i&&(at(!1),pt(null),qe(""),Re({title:"",message:`${I.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{at(!0),pt({type:"restore",id:I.id});try{await Zn.restoreSnapshotFromTrash(i,I.id),await ct(!0),Ft({title:"",message:"",type:"success"})}catch(Z){console.error(Z),Ft({title:"",message:"",type:"error"})}finally{at(!1),pt(null),Re(null)}}}))},gr=I=>{I?.id&&i&&(at(!1),pt(null),qe(""),Re({title:" ",message:`${I.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{at(!0),pt({type:"hard-delete",id:I.id});try{await Zn.hardDeleteSnapshotFromTrash(i,I.id),await ct(!0),Ft({title:"",message:"",type:"success"})}catch(Z){console.error(Z),Ft({title:"",message:"",type:"error"})}finally{at(!1),pt(null),Re(null)}}}))},Bi=I=>{if(!I)return;const Z=ut(I).filter(nt=>!ht(nt?.vendor)),re=["","","","","()",""],Se=Z.map(nt=>{const It=parseFloat(nt?.price)||0,En=nt?.quantity===""?0:parseFloat(nt?.quantity)||0,kn=Math.round(It*En*xe(nt));return[nt?.name??"",It||"",nt?.unit??"",nt?.quantity??"",kn||"",nt?.vendor??""]}),Ue=nt=>{const It=String(nt??"");return It.includes(",")||It.includes('"')||It.includes(`
`)||It.includes("\r")?`"${It.replace(/"/g,'""')}"`:It},Be=[re.map(Ue).join(","),...Se.map(nt=>nt.map(Ue).join(","))].join(`
`),He=new Uint8Array([239,187,191]),Qe=new Blob([He,Be],{type:"text/csv"}),Ze=URL.createObjectURL(Qe),st=(I.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),gt=(I.snapshot_date?new Date(I.snapshot_date):new Date).toISOString().slice(0,10),xt=document.createElement("a");xt.href=Ze,xt.download=`InventorySnapshot_${gt}_${st}.csv`,document.body.appendChild(xt),xt.click(),document.body.removeChild(xt),URL.revokeObjectURL(Ze)},gc=()=>{if(!_t)return;const I=["","()"],Z=wa.map(nt=>[nt.vendor,Math.round(nt.total||0)]),re=nt=>{const It=String(nt??"");return It.includes(",")||It.includes('"')||It.includes(`
`)||It.includes("\r")?`"${It.replace(/"/g,'""')}"`:It},Se=[I.map(re).join(","),...Z.map(nt=>nt.map(re).join(","))].join(`
`),Ue=new Uint8Array([239,187,191]),Be=new Blob([Ue,Se],{type:"text/csv"}),He=URL.createObjectURL(Be),Qe=(_t.snapshot_date?new Date(_t.snapshot_date):new Date).toISOString().slice(0,10),Ze=_t.title||"inventory_summary",st=nn?`${nn.year}${String(nn.month).padStart(2,"0")}`:Qe,gt=Ze.toString().replace(/[\\/:*?"<>|]/g,"_"),xt=document.createElement("a");xt.href=He,xt.download=`InventorySummary_${st}_${gt}.csv`,document.body.appendChild(xt),xt.click(),document.body.removeChild(xt),URL.revokeObjectURL(He)},Dl=I=>{if(!I?.vendor)return;const Z=["","","","","","()",""],re=(I.rows||[]).map(nt=>{const It=nt.itemCategory?oe(nt.itemCategory):ue(nt.breakdownKey);return[nt.name||"",It,Math.round(nt.price||0),nt.unit||"",Number(nt.quantity||0),Math.round(nt.taxed||0),I.vendor]}),Se=nt=>{const It=String(nt??"");return It.includes(",")||It.includes('"')||It.includes(`
`)||It.includes("\r")?`"${It.replace(/"/g,'""')}"`:It},Ue=[Z.map(Se).join(","),...re.map(nt=>nt.map(Se).join(","))].join(`
`),Be=new Uint8Array([239,187,191]),He=new Blob([Be,Ue],{type:"text/csv"}),Qe=URL.createObjectURL(He),Ze=(_t?.snapshot_date?new Date(_t.snapshot_date):new Date).toISOString().slice(0,10),st=nn?`${nn.year}${String(nn.month).padStart(2,"0")}`:Ze,gt=I.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),xt=document.createElement("a");xt.href=Qe,xt.download=`InventorySummary_${st}_${gt}.csv`,document.body.appendChild(xt),xt.click(),document.body.removeChild(xt),URL.revokeObjectURL(Qe)},Lr=_e.useMemo(()=>{const I=vt=>vt?vt.toString().trim():"",Z=vt=>Wt(vt),re=new Set;try{for(const vt of(S||new Set).values()){const kt=Z(vt);kt&&re.add(kt)}}catch{}const Se=new Set;try{for(const vt of(tt||new Set).values()){const kt=Z(vt);kt&&Se.add(kt)}}catch{}const Ue=new Map;try{for(const[vt,kt]of(x||new Map).entries()){const Ut=Z(vt);Ut&&Ue.set(Ut,kt)}}catch{}const Be=new Map;try{(y||[]).forEach(vt=>{const kt=Z(vt?.name);kt&&Be.set(kt,vt)})}catch{}const He=new Map;try{for(const[vt,kt]of(_||new Map).entries()){const Ut=Z(vt);Ut&&He.set(Ut,kt)}}catch{}const Qe=vt=>{const kt=String(vt??"").trim();if(!kt)return"";const Ut=kt.toLowerCase();return Ut===""?"g":Ut===""?"ml":Ut===""?"cc":Ut===""?"kg":Ut===""?"l":Ut===""?"cl":Ut},Ze=(vt,kt)=>{const Ut=parseFloat(vt?.lastPrice),jn=parseFloat(vt?.packetSize),An=Qe(vt?.packetUnit),Bn=Qe(kt||An);if(!Number.isFinite(Ut)||!Number.isFinite(jn)||jn<=0||!An)return null;const Gt=Ut/jn;if(Bn===An)return Gt;if(An==="g"&&Bn==="kg")return Gt*1e3;if(An==="kg"&&Bn==="g")return Gt/1e3;const tr=An==="cc"?"ml":An,Rn=Bn==="cc"?"ml":Bn;return tr==="ml"&&Rn==="l"?Gt*1e3:tr==="l"&&Rn==="ml"?Gt/1e3:tr==="cl"&&Rn==="ml"?Ut/jn/10:tr==="ml"&&Rn==="cl"?Gt*10:tr==="cl"&&Rn==="cl"?Gt:null},st=vt=>{const kt=String(vt??"").trim();return kt?["","","","","","","","pc","PC",""].includes(kt):!1},gt=vt=>{const kt=Z(vt?.name),Ut=kt?Ue.get(kt):null,jn=kt?Be.get(kt):null,An=kt&&He.has(kt)?String(He.get(kt)||""):String(jn?.unit||""),Bn={...vt};if(Bn.name=I(Bn.name),Bn.vendor=I(Bn.vendor),Bn._csv={unit:An,price:jn?.price??null,vendor:I(jn?.vendor)||null,dateStr:jn?.dateStr??null},!Ut)return Bn;const Gt={...Bn},tr=Tt(Ut?.itemCategory),Rn=Ut.packetUnit||"",Ss=parseFloat(Ut.packetSize),ts=Rn?Ze(Ut,Rn):null;if(Gt.isPhantom)Rn&&ts!==null&&(Gt.unit=Rn,Gt.price=ts);else{if(!!Rn&&Number.isFinite(Ss)&&Ss>0&&(st(Gt.unit)||!Gt.unit)&&ts!==null){const js=Gt.quantity;if(js!==""&&js!==null&&js!==void 0){const Pi=parseFloat(js);Number.isFinite(Pi)&&(Gt.quantity=Pi*Ss)}const ni=Gt.threshold;if(ni!==""&&ni!==null&&ni!==void 0){const Pi=parseFloat(ni);Number.isFinite(Pi)&&(Gt.threshold=Pi*Ss)}Gt.unit=Rn}else(Rn&&ts!==null||!Gt.unit&&Rn)&&(Gt.unit=Rn);if(ts!==null&&Qe(Gt.unit)===Qe(Rn))Gt.price=ts;else{const js=Ze(Ut,Gt.unit||Rn);js!==null&&(Gt.price=js)}}const ti=le(Gt?.tax10_override??Gt?.tax10Override),Pl=tr?Et(tr):null;return Gt._master={packetSize:Ut.packetSize,packetUnit:Ut.packetUnit,lastPrice:Ut.lastPrice,itemCategory:tr||null,tax10Auto:Pl,tax10Override:ti,updatedAt:Ut.updatedAt},tr&&(Gt.tax10_override=ti,!ti&&Pl!==null&&(Gt.tax10=Pl)),Gt},xt=o.map(gt),nt=new Map;xt.forEach(vt=>{const kt=Z(vt?.name);kt&&nt.set(kt,vt)});const It=[...xt];y.forEach((vt,kt)=>{const Ut=String(vt?.name??""),jn=I(Ut),An=Z(Ut);if(An&&!(S.has(Ut)||jn&&S.has(jn)||re.has(An))&&!nt.has(An)){const Bn={id:`phantom-${kt}`,isPhantom:!0,name:jn,quantity:"",unit:vt.unit||"",category:"",price:vt.price,vendor:I(vt.vendor),threshold:0,tax10:!1,tax10_override:!1};It.push(gt(Bn))}});const En=It.filter(vt=>{const kt=String(vt?.name??""),Ut=I(kt),jn=Z(kt);return!(S.has(kt)||Ut&&S.has(Ut)||jn&&re.has(jn)||tt.has(kt)||Ut&&tt.has(Ut)||jn&&Se.has(jn)||ht(vt.vendor))}),kn=vt=>{if(!vt)return-1;const Ut=new Date(vt).getTime();return Number.isFinite(Ut)?Ut:-1},Ur=(vt,kt)=>{const Ut=!!vt?.isPhantom,jn=!!kt?.isPhantom;if(Ut!==jn)return Ut?kt:vt;const An=Math.max(kn(vt?.updated_at),kn(vt?.updatedAt),kn(vt?.created_at),kn(vt?.createdAt)),Bn=Math.max(kn(kt?.updated_at),kn(kt?.updatedAt),kn(kt?.created_at),kn(kt?.createdAt));if(An!==Bn)return Bn>An?kt:vt;const Gt=vt?.quantity,tr=kt?.quantity,Rn=Gt===""||Gt===null||Gt===void 0?null:parseFloat(Gt),Ss=tr===""||tr===null||tr===void 0?null:parseFloat(tr),ts=Rn!==null&&Number.isFinite(Rn),ti=Ss!==null&&Number.isFinite(Ss);return ts!==ti&&ti?kt:vt},es=new Map;return En.forEach(vt=>{const kt=Z(vt?.name)||I(vt?.name);if(!kt)return;const jn=`${I(vt?.vendor)||"__no_vendor__"}@@${kt}`,An=es.get(jn);if(!An){es.set(jn,vt);return}es.set(jn,Ur(An,vt))}),Array.from(es.values())},[o,y,S,tt,x,_,ht]),yc=I=>{const{active:Z,over:re}=I;if(!re)return;if(Z?.data?.current?.type==="summary-row"){if(!fn)return;const Ue=Z.id,Be=re.id;if(!Ue||!Be||Ue===Be)return;const He=Ii,Qe=He.indexOf(Ue),Ze=He.indexOf(Be);if(Qe<0||Ze<0)return;const st=Ui(He,Qe,Ze);on(gt=>({...gt,[fn]:st}));return}if(re.id==="inventory-list-droppable"){const Ue=Z.data.current.item;if(Z.data.current.type==="csv-item"){const Be=String(Ue?.name??"").trim(),He=Wt(Be);let Qe=null;if(x&&x.size>0&&He&&(Qe=x.get(Be)||null,!Qe)){for(const[xt,nt]of x.entries())if(Wt(xt)===He){Qe=nt;break}}const Ze=Qe?.packetUnit||Ue.unit,st=Qe?ze(Qe,Ze):null,gt=st!==null?st:Qe?.lastPrice!==null&&Qe?.lastPrice!==void 0&&Qe?.lastPrice!==""?Qe.lastPrice:Ue.price;M({name:Ue.name,price:gt,unit:Ze,category:"",threshold:0,quantity:0,vendor:Ue.vendor,tax10:le(Ue?.tax10),isNewFromCsv:!0}),V(!0),U(Ue.name||"")}}},vc=async I=>{if(I.preventDefault(),!i)return;const Z=new FormData(I.target),re=Z.get("name"),Se=parseFloat(Z.get("quantity")),Ue=Z.get("unit"),Be=Z.get("category"),He=parseFloat(Z.get("threshold")),Qe=Z.get("vendor"),Ze=parseFloat(Z.get("price")),st=Z.get("packetSize"),gt=Z.get("packetUnit"),xt={name:re,quantity:Number.isFinite(Se)?Se:0,unit:Ue,category:Be,threshold:Number.isFinite(He)?He:0,vendor:Qe||k?.vendor||"",price:Number.isFinite(Ze)?Ze:k?.price||0,tax10:le(k?.tax10)};try{if(st&&gt){const nt=parseFloat(st);Number.isFinite(nt)&&nt>0&&await Ln.saveConversion(re,nt,gt,Number.isFinite(Ze)?Ze:null,Be,Qe)}k?.id&&!k.isPhantom?await Zn.update(i,{...k,...xt}):await Zn.add(i,xt),V(!1),M(null),ct()}catch(nt){console.error("Failed to save item:",nt),Ft({title:"",message:"",type:"error"})}},Js=I=>{ot(I),rt(!0)},Ad=I=>{!I||I.isPhantom||!I?._master?.packetUnit||(P(I),Y(!0))},Ml=()=>{E||(Y(!1),P(null))},Ll=async({convertQuantity:I})=>{if(!i)return;const Z=$;if(!Z||Z.isPhantom)return;const re=Z?._master?.packetUnit;if(!re)return;const Se=re,Ue=ze(Z?._master,Se);if(Ue===null){Ft({title:"",message:"/",type:"error"});return}let Be=Z.quantity,He=Z.threshold;if(I){const Qe=At(Z.unit,Se);if(!Qe){Ft({title:"",message:"kgg / lml ",type:"error"});return}const Ze=Z.quantity===""?null:parseFloat(Z.quantity);Ze!==null&&Number.isFinite(Ze)&&(Be=Ze*Qe);const st=Z.threshold===""?null:parseFloat(Z.threshold);st!==null&&Number.isFinite(st)&&(He=st*Qe)}B(!0);try{await Zn.update(i,{id:Z.id,unit:Se,price:Ue,quantity:Be===""?0:parseFloat(Be)||0,threshold:He===""?0:parseFloat(He)||0,tax10:le(Z?.tax10)}),await ct(!0),Y(!1),P(null)}catch(Qe){console.error("Failed to sync unit:",Qe),Ft({title:"",message:"",type:"error"})}finally{B(!1)}},zl=async()=>{if(Ve)try{const Z=(re=>re?re.toString().trim():"")(Ve?.name);Z&&St(re=>{const Se=new Set(re);return Se.add(Z),Se}),rt(!1),ot(null)}catch(I){console.error("Failed to delete/ignore item:",I)}},Rd=async(I,Z)=>{try{if(!i)return;const re=Lr.find(Se=>Se.id===I);if(!re)return;if(re.isPhantom){const Se={name:re.name.trim(),quantity:Z,unit:re.unit,category:re.category||"",price:re.price,vendor:re.vendor,threshold:0,tax10:le(re?.tax10)},Ue=await Zn.add(i,Se);await ct(!0),Ie(Be=>{const He=new Set(Be);return He.add(Ue.id),He})}else u(Se=>Se.map(Ue=>Ue.id!==I?Ue:{...Ue,quantity:Z,unit:re.unit??Ue.unit,price:re.price??Ue.price,threshold:re.threshold??Ue.threshold})),Ie(Se=>{const Ue=new Set(Se);return Ue.add(I),Ue}),await Zn.update(i,{...re,quantity:Z})}catch(re){console.error(re);const Se=re?.message||re?.error_description||(typeof re=="string"?re:null)||(()=>{try{return JSON.stringify(re)}catch{return null}})()||"";Ft({title:"",message:`
${Se}`,type:"error"}),ct()}},xc=async(I,Z)=>{try{if(!i||!I)return;const re=!!Z;if(I.isPhantom){const Se={name:I.name.trim(),quantity:I.quantity===""?0:parseFloat(I.quantity)||0,unit:I.unit,category:I.category||"",price:I.price,vendor:I.vendor,threshold:0,tax10:re,tax10_override:!0};await Zn.add(i,Se),await ct(!0)}else{const Se=new Date().toISOString();u(Ue=>Ue.map(Be=>Be.id===I.id?{...Be,tax10:re,tax10_override:!0,updated_at:Se,updatedAt:Se}:Be)),await Zn.update(i,{...I,tax10:re,tax10_override:!0}),await ct(!0)}}catch(re){console.error(re);const Se=re?.message||re?.error_description||(typeof re=="string"?re:null)||(()=>{try{return JSON.stringify(re)}catch{return null}})()||"";Ft({title:"",message:`
${Se}`,type:"error"}),ct()}},_a=(I,Z)=>{if(Z===!0){ln({item:I});return}xc(I,Z)},zr=()=>{sn||ln(null)},Ul=async()=>{const I=rn?.item;if(I){zn(!0);try{await xc(I,!0),ln(null)}finally{zn(!1)}}},Il=async()=>{if(!O&&G&&i){K(!0);try{const I=Lr.filter(re=>!re.isPhantom).map(re=>{const Se={...re};return delete Se.isPhantom,delete Se._master,delete Se._csv,Se}),Z=I.reduce((re,Se)=>{const Ue=parseFloat(Se.price)||0,Be=Se.quantity===""?0:parseFloat(Se.quantity)||0;return re+Ue*Be*xe(Se)},0);await Zn.createSnapshot(i,G,I,Z),de?(await Zn.resetStockQuantities(i),await ct(),Ie(new Set)):await ct(!0),Q(!1),Ct(!0)}catch(I){console.error("Failed to complete inventory:",I);const Z=I?.message||I?.error_description||(typeof I=="string"?I:null)||(()=>{try{return JSON.stringify(I)}catch{return null}})()||"";Ft({title:"",message:`
${Z}`,type:"error"})}finally{K(!1)}}},Xs=()=>{const I=["","","","","()",""],Z=ei.map(Ze=>{const st=parseFloat(Ze.price)||0,gt=Ze.quantity===""?0:parseFloat(Ze.quantity)||0,xt=Math.round(st*gt*xe(Ze));return[Ze.name,st,Ze.unit,Ze.quantity,xt,Ze.vendor||""]}),re=[I.join(","),...Z.map(Ze=>Ze.map(st=>{const gt=String(st??"");return gt.includes(",")||gt.includes('"')||gt.includes(`
`)?`"${gt.replace(/"/g,'""')}"`:gt}).join(","))].join(`
`),Se=new Uint8Array([239,187,191]),Ue=new Blob([Se,re],{type:"text/csv"}),Be=document.createElement("a"),He=URL.createObjectURL(Ue),Qe=new Date().toISOString().split("T")[0];Be.href=He,Be.download=`Inventory_${Qe}.csv`,document.body.appendChild(Be),Be.click(),document.body.removeChild(Be),URL.revokeObjectURL(He)},Zs=["","","","","","","","","","","",""],Bl=[...new Set(Lr.map(I=>I.vendor).filter(I=>I&&!ht(I)))].sort(),$l=Lr.some(I=>!I.vendor),$i=ee==="summary",ei=Lr.filter(I=>I.name.toLowerCase().includes(R.toLowerCase())?ee==="all"||ee==="summary"?!0:ee==="inventory-check"?Te.has(I.id)||!I.isPhantom:ee==="other"?!I.vendor:I.vendor===ee:!1),Zr=I=>{if(!I)return;const Z=Wt(I.name);let re=null;if(x&&x.size>0&&Z&&(re=x.get(I.name)||null,!re)){for(const[Se,Ue]of x.entries())if(Wt(Se)===Z){re=Ue;break}}if(re){const Se=re.packetUnit||k?.unit||"",Ue=re.packetUnit?ze(re,Se):null,Be=Ue!==null?Ue:re.lastPrice||k?.price||0;M(He=>({...He,name:I.name,price:Be,unit:Se,vendor:re.vendor||He?.vendor||"",_master:{packetSize:re.packetSize,packetUnit:re.packetUnit,lastPrice:re.lastPrice,itemCategory:re.itemCategory,updatedAt:re.updatedAt}}))}else M(Se=>({...Se,name:I.name}))};if(H){const I=k?._master?.packetSize||"",Z=k?._master?.packetUnit||"";return r.jsxs("div",{className:"inventory-edit-container fade-in",children:[r.jsx("div",{className:"container-header",children:r.jsx("h2",{className:"section-title",children:k&&!k.isNewFromCsv?"":""})}),r.jsx(hn,{className:"edit-form-card",children:r.jsxs("form",{onSubmit:vc,children:[r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(Ed,{name:"name",required:!0,value:z,onChange:re=>U(re.target.value),onSelect:Zr,placeholder:": "})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:""}),r.jsx($t,{name:"vendor",defaultValue:k?.vendor,list:"vendor-list",placeholder:": "}),r.jsx("datalist",{id:"vendor-list",children:Bl.filter(re=>re!=="").map(re=>r.jsx("option",{value:re},re))})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:" ()"}),r.jsx($t,{name:"price",type:"number",step:"1",defaultValue:k?.price,placeholder:"0"})]})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx($t,{name:"quantity",type:"number",step:"0.01",defaultValue:k?.quantity,required:!0})]}),r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx($t,{name:"unit",defaultValue:k?.unit||"pc",required:!0,placeholder:"g, ml, , pc..."})]})]}),r.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px",color:"#495057"},children:["  ()",r.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",marginLeft:"8px",color:"#868e96"},children:" 1pc = 400g "})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{fontSize:"0.85rem"},children:" (1)"}),r.jsx($t,{name:"packetSize",type:"number",step:"0.01",defaultValue:I,placeholder:": 400"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{fontSize:"0.85rem"},children:""}),r.jsx($t,{name:"packetUnit",defaultValue:Z,placeholder:": g"})]})]})]}),r.jsxs("div",{className:"form-row",style:{marginTop:"16px"},children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:""}),r.jsx($t,{name:"category",defaultValue:k?.category,list:"category-list",placeholder:"",autoComplete:"off"}),r.jsx("datalist",{id:"category-list",children:Zs.map(re=>r.jsx("option",{value:re},re))})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:" ()"}),r.jsx($t,{name:"threshold",type:"number",step:"0.01",defaultValue:k?.threshold||0})]})]}),r.jsxs("div",{className:"form-actions",children:[r.jsx(ce,{variant:"ghost",type:"button",onClick:()=>{V(!1),M(null)},children:""}),r.jsx(ce,{variant:"primary",type:"submit",children:""})]})]})})]})}return r.jsx(Mi,{onDragEnd:yc,sensors:Xt,autoScroll:!1,children:r.jsxs("div",{className:"inventory-container fade-in",children:[r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions inventory-header-actions",children:[r.jsx(ce,{variant:"ghost",onClick:n,children:" "}),r.jsx(ce,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>a({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),r.jsx(ce,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const I=new Date;A(`${I.getFullYear()}${I.getMonth()+1} `),pe(!0),Q(!0)},children:" "}),r.jsx(ce,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{me(null),ie("history"),te(!0)},title:"",children:" "}),r.jsx(ce,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{M(null),U(""),V(!0)},children:"+ "})]})]}),r.jsx("div",{className:"inventory-split-layout",children:r.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[r.jsxs("div",{className:"inventory-controls",children:[$i?r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[r.jsxs("div",{className:"inventory-controls__field",children:[r.jsx("label",{className:"inventory-controls__label",children:":"}),r.jsx("select",{className:"inventory-controls__select",value:Fe,onChange:I=>it(I.target.value),disabled:Ye.length===0,children:Ye.length===0?r.jsx("option",{value:"",children:""}):Ye.map(I=>r.jsx("option",{value:I.key,children:I.label},I.key))})]}),nn&&r.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",nn.rangeLabel]})]}):r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[r.jsxs("div",{className:"inventory-controls__field",children:[r.jsx("label",{className:"inventory-controls__label",children:":"}),r.jsxs("select",{className:"inventory-controls__select",value:ee==="inventory-check"?"":ee,onChange:I=>{I.target.value&&De(I.target.value)},children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",disabled:!0,children:""}),r.jsxs("optgroup",{label:"",children:[Bl.map(I=>r.jsx("option",{value:I,children:I},I)),$l&&r.jsx("option",{value:"other",children:""})]})]})]}),r.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:R,onChange:I=>J(I.target.value)})]}),r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[r.jsxs("button",{className:"inventory-controls__btn",onClick:()=>De("inventory-check"),"data-active":ee==="inventory-check"?"true":"false",children:["  (",Te.size,")"]}),r.jsx("button",{className:"inventory-controls__btn",onClick:()=>De("summary"),"data-active":ee==="summary"?"true":"false",children:" "}),!$i&&r.jsx("button",{className:"inventory-controls__btn",onClick:Xs,title:"CSV",children:" CSV (.csv)"}),!$i&&ee==="inventory-check"&&r.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),$i?r.jsxs("div",{className:"inventory-summary",children:[r.jsx("div",{className:"inventory-summary__header",children:r.jsxs("div",{children:[r.jsx("div",{className:"inventory-summary__title",children:""}),nn&&r.jsxs("div",{className:"inventory-summary__meta",children:[": ",nn.rangeLabel]}),_t?r.jsxs("div",{className:"inventory-summary__meta",children:[": ",_t.title||"","",Lt(_t.snapshot_date),""]}):r.jsx("div",{className:"inventory-summary__meta",children:""}),We.length>1&&r.jsxs("div",{className:"inventory-summary__note",children:[" ",We.length," "]})]})}),_t?r.jsxs("div",{className:"inventory-summary__table-wrap",children:[r.jsx("div",{className:"inventory-summary__actions",children:r.jsx(ce,{variant:"secondary",size:"sm",onClick:gc,children:" CSV (.csv)"})}),r.jsxs("table",{className:"inventory-summary__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40px"}}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),r.jsx(va,{items:Ii,strategy:Sl,children:r.jsxs("tbody",{children:[wa.map(I=>{const Z=he===I.vendor,re=Xr.get(I.vendor)||null;return r.jsxs(_e.Fragment,{children:[r.jsx(mt,{row:I,onVendorClick:mc,isSelected:Z}),Z&&re&&r.jsxs("tr",{className:"inventory-summary__detail-row",children:[r.jsx("td",{}),r.jsx("td",{colSpan:"2",children:r.jsxs("div",{className:"inventory-summary__inline-detail",children:[r.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[r.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[re.vendor," "]}),r.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Dl(re),disabled:!re.rows||re.rows.length===0,children:" CSV"}),r.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(re.totals.taxed||0).toLocaleString()]})]})]}),r.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(Se=>r.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[r.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:ue(Se)}),r.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(re.totals[Se]||0).toLocaleString()]})]},Se)),re.totals.unknown>0&&r.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[r.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),r.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(re.totals.unknown).toLocaleString()]})]})]}),r.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(re.totals.net||0).toLocaleString()]}),r.jsx("div",{className:"inventory-summary__inline-items-wrap",children:r.jsxs("table",{className:"inventory-summary__inline-items-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),r.jsx("tbody",{children:re.rows.map((Se,Ue)=>{const Be=Se.itemCategory?oe(Se.itemCategory):ue(Se.breakdownKey),He=Ue>0?re.rows[Ue-1]:null,Qe=!!He&&He.breakdownKey!==Se.breakdownKey;return r.jsxs("tr",{className:Qe?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[r.jsx("td",{children:Se.name||"-"}),r.jsx("td",{children:Be}),r.jsxs("td",{style:{textAlign:"right"},children:["",Number(Se.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),r.jsxs("td",{style:{textAlign:"right"},children:[Number(Se.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),Se.unit?` ${Se.unit}`:""]}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(Se.taxed||0).toLocaleString()]})]},Se.id)})})]})})]})})]})]},I.vendor)}),wa.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsx("td",{}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),r.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(Sa.net).toLocaleString()," / ",Math.round(Sa.taxed).toLocaleString()]})]})})]})]}):r.jsx("div",{className:"inventory-summary__empty",children:""})]}):r.jsx(yT,{items:ei,loading:T,onSearch:J,searchQuery:R,onEdit:I=>{M(I),U(I?.name||""),V(!0)},onDelete:Js,onUpdateQuantity:Rd,onToggleTax:_a,onRequestUnitSync:Ad})]})}),r.jsx(bn,{isOpen:!!rn,onClose:zr,title:"10%",size:"small",showCloseButton:!sn,children:r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",rn?.item?.name||"","",r.jsx("strong",{children:"10%"}),""]}),r.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[r.jsx(ce,{variant:"secondary",onClick:zr,disabled:sn,children:""}),r.jsx(ce,{variant:"primary",onClick:Ul,disabled:sn,children:sn?"...":""})]})]})}),r.jsx(bn,{isOpen:q,onClose:()=>{O||Q(!1)},title:" ",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),r.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[r.jsx("strong",{children:":"}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. ",de?r.jsxs(r.Fragment,{children:[r.jsx("strong",{children:"()0"}),""]}):r.jsxs(r.Fragment,{children:[r.jsx("strong",{children:""}),""]}),r.jsx("br",{}),""]}),r.jsxs("div",{style:{marginBottom:"16px"},children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[r.jsx("input",{type:"radio",name:"inventory-reset",checked:de,disabled:O,onChange:()=>pe(!0)}),r.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",r.jsx("strong",{children:"0"}),""]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"radio",name:"inventory-reset",checked:!de,disabled:O,onChange:()=>pe(!1)}),r.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",r.jsx("strong",{children:""}),""]})]}),r.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),r.jsx("input",{type:"text",value:G,onChange:I=>A(I.target.value),disabled:O,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx("button",{onClick:()=>{O||Q(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:O?"not-allowed":"pointer",opacity:O?.6:1,fontSize:"0.9rem"},children:""}),r.jsx("button",{onClick:Il,disabled:O,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:O?"#94a3b8":"#2ecc71",color:"white",cursor:O?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:O?"...":de?"":""})]}),O&&r.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),r.jsxs(bn,{isOpen:ve,onClose:()=>te(!1),title:" ",size:"large",children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[r.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:ke==="history"?r.jsxs(r.Fragment,{children:[": ",r.jsx("strong",{children:an.length})," "]}):r.jsxs(r.Fragment,{children:[": ",r.jsx("strong",{children:h.length})," "]})}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{type:"button",onClick:()=>ie("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:ke==="history"?"#111":"#fff",color:ke==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),r.jsx("button",{type:"button",onClick:()=>ie("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:ke==="trash"?"#111":"#fff",color:ke==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>ct(!0),title:"",children:" "})]})]}),ke==="history"&&r.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),r.jsx("select",{value:wt,onChange:I=>Pt(I.target.value),disabled:Ye.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:Ye.length===0?r.jsx("option",{value:"",children:""}):Ye.map(I=>r.jsx("option",{value:I.key,children:I.label},I.key))})]}),jt&&r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",jt.rangeLabel]})]}),ke==="history"&&an.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):ke==="trash"&&h.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f0f0f0"},children:[r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:ke==="trash"?"":""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),r.jsx("tbody",{children:(ke==="history"?an:h).map(I=>{const Z=ut(I).filter(gt=>!ht(gt?.vendor)),re=Z.length,Se=Math.round(Z.reduce((gt,xt)=>{const nt=parseFloat(xt?.price)||0,It=xt?.quantity===""?0:parseFloat(xt?.quantity)||0;return gt+nt*It*xe(xt)},0)),Ue=ke==="trash"?`trash-${I.id}`:I.id,Be=Lt(ke==="trash"?I.deleted_at:I.snapshot_date),He=lt?.type==="move"&&lt?.id===I.id,Qe=lt?.type==="restore"&&lt?.id===I.id,Ze=lt?.type==="hard-delete"&&lt?.id===I.id,st=He||Qe||Ze;return r.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[r.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Be}),r.jsx("td",{style:{padding:"10px"},children:I.title||"-"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:re.toLocaleString()}),r.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",Se.toLocaleString()]}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:ke==="history"?r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Bi(I),disabled:re===0||st,title:re===0?"items CSV":"CSV",children:" CSV"}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>me(I),disabled:st,children:""}),r.jsx(ce,{variant:"danger",size:"sm",onClick:()=>ja(I),disabled:st,title:"",children:He?"...":""})]}):r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Bi(I),disabled:re===0||st,children:" CSV"}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>me(I),disabled:st,children:""}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Td(I),disabled:st,title:"",children:Qe?"...":""}),r.jsx(ce,{variant:"danger",size:"sm",onClick:()=>gr(I),disabled:st,title:"",children:Ze?"...":""})]})})]},Ue)})})]})})]}),r.jsx(bn,{isOpen:!!je,onClose:()=>{et||Re(null)},title:je?.title||"",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:je?.message}),je?.requireText&&r.jsxs("div",{style:{marginTop:"14px"},children:[r.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",r.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:je.requireText})," "]}),r.jsx("input",{type:"text",value:Oe,onChange:I=>qe(I.target.value),placeholder:je.requireText,disabled:et,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(ce,{variant:"ghost",disabled:et,onClick:()=>{et||Re(null)},children:""}),r.jsx(ce,{variant:"danger",disabled:et||!!je?.requireText&&Oe!==je.requireText,onClick:()=>je?.onConfirm&&je.onConfirm(),children:et?je?.loadingLabel||"...":je?.confirmLabel||""})]})]})}),r.jsx(bn,{isOpen:!!W,onClose:()=>me(null),title:W?` ${W.title||""}`:" ",size:"large",children:(()=>{const I=W;if(!I)return null;const Se=[...ut(I).filter(Be=>ht(Be?.vendor)?!1:we?(Be?.quantity===""?0:parseFloat(Be?.quantity)||0)!==0:!0)].sort((Be,He)=>{const Qe=Ge.direction==="desc"?-1:1;if(Ge.key==="vendor"){const It=(Be?.vendor||"").toString(),En=(He?.vendor||"").toString(),kn=It.localeCompare(En,"ja");if(kn!==0)return kn*Qe;const Ur=(Be?.name||"").toString(),es=(He?.name||"").toString();return Ur.localeCompare(es,"ja")*Qe}const Ze=(Be?.name||"").toString(),st=(He?.name||"").toString(),gt=Ze.localeCompare(st,"ja");if(gt!==0)return gt*Qe;const xt=(Be?.vendor||"").toString(),nt=(He?.vendor||"").toString();return xt.localeCompare(nt,"ja")*Qe}),Ue=Se.reduce((Be,He)=>{const Qe=parseFloat(He?.price)||0,Ze=He?.quantity===""?0:parseFloat(He?.quantity)||0,st=Qe*Ze;return Be.net+=st,Be.taxed+=st*xe(He),Be},{net:0,taxed:0});return r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[r.jsxs("div",{children:[": ",r.jsx("strong",{children:Lt(I.snapshot_date)})]}),r.jsxs("div",{children:[": ",r.jsx("strong",{children:Se.length.toLocaleString()})]}),r.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",r.jsxs("strong",{children:["",Math.round(Ue.net).toLocaleString()," / ",Math.round(Ue.taxed).toLocaleString()]})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:we,onChange:Be=>ae(Be.target.checked)}),"0"]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Bi(I),children:" CSV (.csv)"})]}),Se.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f0f0f0"},children:[r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),r.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{Ne(Be=>Be.key==="vendor"?{key:"vendor",direction:Be.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",Ge.key==="vendor"&&(Ge.direction==="asc"?"":"")]})]})}),r.jsx("tbody",{children:Se.map((Be,He)=>{const Qe=parseFloat(Be?.price)||0,Ze=Be?.quantity===""?0:parseFloat(Be?.quantity)||0,st=Math.round(Qe*Ze*xe(Be)),gt=Mr(Be),xt=oe(gt);return r.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[r.jsxs("td",{style:{padding:"10px"},children:[Be?.name||"-",le(Be?.tax10)&&r.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),r.jsx("td",{style:{padding:"10px"},children:xt}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Qe?`${Number(Qe).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),r.jsx("td",{style:{padding:"10px"},children:Be?.unit||"-"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Ze?Ze.toLocaleString():"0"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:st?`${st.toLocaleString()}`:"-"}),r.jsx("td",{style:{padding:"10px"},children:Be?.vendor||"-"})]},Be?.id||`${Be?.name||"item"}-${He}`)})})]})})]})})()}),r.jsx(bn,{isOpen:F,onClose:Ml,title:"",size:"small",children:(()=>{const I=$,Z=I?._master?.packetUnit||"",re=I?.unit||"",Se=At(re,Z),Ue=Se!==null&&Se!==1,Be=parseFloat(I?.price)||0,He=I?.quantity===""?0:parseFloat(I?.quantity)||0,Qe=I?xe(I):1.08,Ze=Be*He*Qe,st=Z?ze(I?._master,Z):null,gt=st===null?null:st*He*Qe,xt=st===null||!Ue?null:st*(He*Se)*Qe,nt=En=>`${Math.round(En).toLocaleString()}`,It=En=>Number.isInteger(En)?En.toLocaleString():En.toLocaleString(void 0,{maximumFractionDigits:3});return r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:I?.name||"-"}),r.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",It(He)," ",re," /  ",Be.toLocaleString()," /  ",nt(Ze)]}),!!Z&&r.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",Z]})]}),r.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",r.jsx("br",{}),""]})}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[r.jsx(ce,{variant:"ghost",type:"button",onClick:Ml,disabled:E,children:""}),r.jsx(ce,{variant:"secondary",type:"button",onClick:()=>Ll({convertQuantity:!1}),isLoading:E,disabled:E||!Z||st===null,title:gt===null?"":`:  ${nt(gt)}`,children:""}),Ue&&r.jsx(ce,{variant:"primary",type:"button",onClick:()=>Ll({convertQuantity:!0}),isLoading:E,disabled:E||!Z||st===null,title:xt===null?"":`:  ${nt(xt)}`,children:""})]})]})})()}),r.jsx(bn,{isOpen:dt,onClose:()=>rt(!1),title:"",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",r.jsx("strong",{children:Ve?.name}),""]}),r.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),"CSV"]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx("button",{onClick:()=>rt(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),r.jsx("button",{onClick:zl,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),r.jsx(bn,{isOpen:gn,onClose:()=>Ct(!1),title:" ",size:"small",children:r.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[r.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),r.jsxs("h3",{style:{marginBottom:"1rem"},children:[G," "]}),r.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",r.jsx("br",{}),""]}),r.jsx("button",{onClick:()=>Ct(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),r.jsx(bn,{isOpen:!!zt,onClose:()=>Ft(null),title:zt?.title||"",size:"small",children:r.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[zt?.type==="success"&&r.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),zt?.type==="error"&&r.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),r.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:zt?.message}),r.jsx("button",{onClick:()=>Ft(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:zt?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},Lo="app-data",xT="incoming-deliveries",bT=n=>{const t=String(n||"").trim();return t&&t.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},wT=n=>{const t=String(n),i=t.lastIndexOf(".");return i<=0?t:t.slice(0,i)},ST=async n=>{if(!n)return"";const t=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},us={async _getCurrentUserId(){const{data:n,error:t}=await Ee.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${xT}`},_filePath(n,t){const i=this._folderPath(n),a=String(t||"").replace(/^\/+/,"");return`${i}/${a}`},async listJsonFiles(n=null){const t=n||await this._getCurrentUserId();if(!t)return[];const i=this._folderPath(t),{data:a,error:o}=await Ee.storage.from(Lo).list(i,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return o?(console.error("Failed to list incoming deliveries:",o),[]):(a||[]).filter(u=>String(u?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._filePath(i,n),{data:o,error:u}=await Ee.storage.from(Lo).download(a);if(u)throw u;const d=await ST(o);return JSON.parse(d)},async saveDeliverySet({pdfFile:n,parsed:t},i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");if(!n)throw new Error("PDF");if(!t)throw new Error("");const o=new Date,u=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}_${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,d=bT(wT(n.name||"delivery")),f=`${u}_${d}`,h=this._filePath(a,`${f}.pdf`),p=this._filePath(a,`${f}.json`),y={...t,_meta:{savedAt:o.toISOString(),originalFileName:n.name||null}},[v,x]=await Promise.all([Ee.storage.from(Lo).upload(h,n,{upsert:!1,contentType:"application/pdf"}),Ee.storage.from(Lo).upload(p,new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(v.error)throw v.error;if(x.error)throw x.error;return{baseName:f,pdfPath:h,jsonPath:p}},async deleteDeliverySet(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=String(n||"").trim();if(!a)throw new Error("baseName ");const o=this._filePath(i,`${a}.pdf`),u=this._filePath(i,`${a}.json`),{data:d,error:f}=await Ee.storage.from(Lo).remove([o,u]);if(f)throw f;return d}},jT="/app/assets/pdf.worker-DU8cYlj-.js",_T=n=>typeof n=="string"&&n.trim().length>0,Fs=n=>String(n??"").replace(/\u0000/g,"").trim(),Bo=n=>{const t=String(n??"").trim();if(!t)return null;const i=t.replace(/[,\s]/g,""),a=Number(i);return Number.isFinite(a)?a:null},zo=n=>{const t=String(n??"").trim();if(!t)return null;const i=t.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return i?i[2]?`${i[1]} ${i[2]}`:i[1]:null},CT=n=>{const t=String(n??"").trim();return!!(!t||t==="/"||t.startsWith("")||t.includes(""))},NT=(n,t)=>{const i=String(n??"").trim(),a=i.match(/^No\.?\s*(\d{3,})\s*$/);if(a?.[1])return{slipNo:a[1],consumeNext:!1};if(/^No\.?\s*$/.test(i)){const o=String(t??"").trim();if(/^\d{3,}$/.test(o))return{slipNo:o,consumeNext:!0}}return null},Up=n=>{const t=String(n??"").trim();return t?!!/^No\.?\s*(\d{3,})?\s*$/.test(t):!1},ET=(n,t)=>{const i=Fs(n[t]);if(!i||Up(i)||i===""||i===""||i===""||i==="No"||i===""||i===""||i===""||i===""||i===""||i==="")return null;let a=t+1;const o=Bo(n[a]);if(o==null)return null;a+=1;const u=Bo(n[a]);if(u==null)return null;a+=1;const d=Fs(n[a]);if(!d)return null;a+=1;let f=null,h=null,p=null;const y=Bo(n[a]);for(y!=null?(h=y,a+=1,p=Fs(n[a]),a+=1):(f=Fs(n[a])||null,a+=1,h=Bo(n[a]),a+=1,p=Fs(n[a]),a+=1);a<n.length;){const w=Fs(n[a]);if(w===""||w===""){a+=1;continue}break}let v=null;const x=Fs(n[a]);return/^\d+$/.test(x)&&(v=parseInt(x,10),a+=1),{item:{no:v,code:null,name:i,unitPrice:o,deliveryQty:u,deliveryUnit:d,spec:f,orderQty:h,orderUnit:p},nextIndex:a}},kT=n=>{const t=(n||[]).map(Fs).filter(f=>!CT(f)),i={title:t.find(f=>f.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let f=0;f<t.length;f+=1){const h=t[f],p=h.match(/^?\s*(.+)$/);if(p?.[1]&&!i.outputAt){i.outputAt=zo(p[1])||p[1].trim();continue}const y=h.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);y&&!i.rangeFrom&&(i.rangeFrom=y[1],i.rangeTo=y[2])}const a=new Map;let o=null,u=null;for(let f=0;f<t.length;f+=1){const h=t[f],p=t[f+1],y=NT(h,p);if(y?.slipNo){const v=y.slipNo;y.consumeNext&&(f+=1);const x=a.get(v);x?o=x:(o={slipNo:v,vendor:u||null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},a.set(v,o));continue}if(/^(||)/.test(h)&&!h.includes("")&&!h.includes("")&&!h.includes("")){let v=3;(h.startsWith("")||h.startsWith("")||h.startsWith(""))&&(v=4);let x=h.slice(v).trim();(x.startsWith(":")||x.startsWith(""))&&(x=x.slice(1).trim());let w=null;if(!x)_T(p)&&!/^\d+$/.test(p)&&!p.includes("")&&(w=p.trim());else{const _=x.match(/^(\d+)\s+(.+)$/);_&&(x=_[2].trim()),w=x}w&&(o?o.vendor||(o.vendor=w):u=w);continue}if(o){if(h===""||h.startsWith("")){const v=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.slipDate=v[1]:zo(p)&&(o.slipDate=zo(p));continue}if(h===""){const v=Bo(p);v!=null&&(o.total=v);continue}if(h===""||h.startsWith("")){const v=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.deliveryDate=v[1]:zo(p)&&(o.deliveryDate=zo(p)?.slice(0,10));continue}if(h.startsWith("")){const x=h.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(x&&x!=="No"){o.comment=x;continue}const w=[];for(let C=f+1;C<t.length;C+=1){const S=t[C];if(S){if(Up(S)||S==="No"||S===""||S===""||S===""||S===""||S===""||S===""||S==="")break;w.push(S)}}const _=w.join(" ").trim();_&&_!=="No"&&(o.comment=_);continue}if(h===""||h===""){let v=f+1;for(;v<t.length;){const x=t[v];if(Up(x)||x==="")break;const w=ET(t,v);if(!w){v+=1;continue}o.items.push(w.item),v=w.nextIndex}f=v-1}}}const d=Array.from(a.values()).sort((f,h)=>String(f.slipNo).localeCompare(String(h.slipNo),"ja"));return{report:i,slips:d}},j0=async n=>{if(!n)throw new Error("PDF");const t=await n.arrayBuffer(),i=await Ku(()=>import("./pdf-TYbuEEMZ.js").then(f=>f.p),[]),a=i?.default&&i.default.getDocument?i.default:i;if(!a?.getDocument)throw new Error("PDF");a?.GlobalWorkerOptions&&(a.GlobalWorkerOptions.workerSrc=jT);const o=await a.getDocument({data:new Uint8Array(t)}).promise,u=[];for(let f=1;f<=o.numPages;f+=1){const p=await(await o.getPage(f)).getTextContent();for(const y of p.items||[]){const v=Fs(y?.str);v&&u.push(v)}}const d=kT(u);if(!d?.slips||d.slips.length===0)throw new Error("PDFPDF");return d},fp=n=>String(n||"").replace(/\.json$/i,""),_0=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${i}/${a}/${o} ${u}:${d}`},TT=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},AT=n=>String(n||"").trim(),RT=({onBack:n})=>{const[t,i]=oc(),[a,o]=_e.useState(!0),[u,d]=_e.useState([]),[f,h]=_e.useState(null),[p,y]=_e.useState(!1),[v,x]=_e.useState(!1),[w,_]=_e.useState(null),[C,S]=_e.useState(!1),[N,T]=_e.useState(""),[L,R]=_e.useState(null),[J,H]=_e.useState(!1),[V,k]=_e.useState(null),[M,z]=_e.useState(!1),[U,F]=_e.useState(!1),[Y,$]=_e.useState(null),P=_e.useCallback(async()=>{o(!0),T("");try{const te=await us.listJsonFiles();d(te||[])}catch(te){console.error(te),T(""),d([])}finally{o(!1)}},[]);_e.useEffect(()=>{P()},[P]);const E=te=>{te.preventDefault(),y(!0)},B=te=>{te.preventDefault(),y(!1)},q=te=>{te.preventDefault(),y(!1);const W=te.dataTransfer.files?.[0];W&&W.type==="application/pdf"?(h(W),_(null),$(null),T(""),Q(W)):W&&T("PDF")},Q=async te=>{if(te){T(""),x(!0),_(null),$(null);try{const W=await j0(te);_(W||null)}catch(W){console.error(W),T(`PDF:
${W?.message||String(W)}`)}finally{x(!1)}}},G=async()=>{if(f){T(""),x(!0),_(null),$(null);try{const te=await j0(f);_(te||null)}catch(te){console.error(te),T(`PDF:
${te?.message||String(te)}`)}finally{x(!1)}}},A=async()=>{if(!(!f||!w)){T(""),S(!0);try{await us.saveDeliverySet({pdfFile:f,parsed:w}),h(null),_(null),await P()}catch(te){console.error(te),T(`: ${te?.message||String(te)}`)}finally{S(!1)}}},O=async te=>{const W=fp(te);H(!0),T("");try{const me=await us.downloadJson(te);R({baseName:W,data:me})}catch(me){console.error(me),T(`: ${me?.message||String(me)}`)}finally{H(!1)}},K=async()=>{if(V?.baseName){z(!0),T("");try{await us.deleteDeliverySet(V.baseName),k(null),await P()}catch(te){console.error(te),T(`: ${te?.message||String(te)}`)}finally{z(!1)}}},de=te=>{const W=new Map,me=(ie,je)=>{const Re=String(ie?.name||"").trim();if(!Re)return;const Oe=AT(ie?.deliveryUnit||ie?.unit||ie?.unitName||""),qe=TT(ie?.deliveryQty??ie?.quantity??ie?.qty);if(!Number.isFinite(qe)||qe===null)return;const et=String(je||"").trim(),at=`${et}@@${Wt(Re)}@@${Oe||""}`,lt=W.get(at);lt?lt.qty+=qe:W.set(at,{vendor:et,name:Re,unit:Oe,qty:qe})};return(te?.slips||te?.receipts||[]).forEach(ie=>{const je=ie?.vendor||"";(ie?.items||[]).forEach(Oe=>me(Oe,je))}),Array.from(W.values()).sort((ie,je)=>ie.vendor!==je.vendor?ie.vendor.localeCompare(je.vendor,"ja"):ie.name!==je.name?ie.name.localeCompare(je.name,"ja"):String(ie.unit||"").localeCompare(String(je.unit||""),"ja"))},pe=async()=>{F(!0),T(""),$(null);try{const te=await us.listJsonFiles();if(!te||te.length===0){$([]);return}const W=[];for(const ie of te){const je=ie?.name;if(je)try{const Re=await us.downloadJson(je);W.push(Re)}catch(Re){console.warn("Failed to download:",je,Re)}}const me=new Map;W.forEach(ie=>{de(ie).forEach(Re=>{const Oe=`${Re.vendor}@@${Wt(Re.name)}@@${Re.unit||""}`,qe=me.get(Oe);qe?qe.qty+=Re.qty:me.set(Oe,{...Re})})});const ke=Array.from(me.values()).sort((ie,je)=>ie.vendor!==je.vendor?ie.vendor.localeCompare(je.vendor,"ja"):ie.name!==je.name?ie.name.localeCompare(je.name,"ja"):String(ie.unit||"").localeCompare(String(je.unit||""),"ja"));$(ke)}catch(te){console.error(te),T(`: ${te?.message||String(te)}`)}finally{F(!1)}},ve=w?.slips||w?.receipts||[];return r.jsxs("div",{className:"incoming-deliveries",children:[r.jsxs("div",{className:"incoming-deliveries__header",children:[r.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[r.jsx(ce,{variant:"secondary",onClick:()=>i({view:"incoming-stock"}),children:" "}),r.jsx(ce,{variant:"ghost",onClick:n,children:" "})]})]}),N&&r.jsx(hn,{className:"incoming-deliveries__error",children:N}),r.jsxs(hn,{className:"incoming-deliveries__card",children:[r.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",Go]}),r.jsxs("div",{className:"incoming-deliveries__upload",children:[r.jsxs("div",{className:`incoming-deliveries__upload-zone ${p?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:E,onDragLeave:B,onDrop:q,children:[r.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:p?"var(--color-primary)":"inherit"},children:p?"":"PDF"}),r.jsx("input",{type:"file",accept:"application/pdf",onChange:te=>{const W=te.target.files?.[0]||null;h(W),_(null),$(null),T("")},style:{width:"100%"}})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[r.jsx(ce,{variant:"secondary",onClick:G,disabled:!f||v||C,children:v?"":""}),r.jsx(ce,{variant:"primary",onClick:A,disabled:!f||!w||C||v,children:C?"":""})]})]}),w&&r.jsxs("div",{className:"incoming-deliveries__preview",children:[r.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",r.jsx("strong",{children:w?.report?.outputAt||w?.report?.outputDate||"-"})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",r.jsx("strong",{children:ve.length})]}),ve.slice(0,3).map((te,W)=>r.jsxs("div",{className:"incoming-deliveries__slip",children:[r.jsxs("div",{className:"incoming-deliveries__slip-head",children:[r.jsx("div",{style:{fontWeight:700},children:te?.vendor||""}),r.jsxs("div",{style:{opacity:.85},children:["No: ",te?.slipNo||"-"," / : ",te?.deliveryDate||"-"]})]}),r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"52%"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%"},children:""})]})}),r.jsx("tbody",{children:(te?.items||[]).slice(0,6).map((me,ke)=>r.jsxs("tr",{children:[r.jsx("td",{children:me?.name||"-"}),r.jsx("td",{style:{textAlign:"right"},children:me?.unitPrice!=null?`${Math.round(me.unitPrice).toLocaleString()}`:"-"}),r.jsx("td",{style:{textAlign:"right"},children:me?.deliveryQty!=null?me.deliveryQty:"-"}),r.jsx("td",{children:me?.deliveryUnit||"-"})]},`${me?.no||ke}`))})]}),(te?.items||[]).length>6&&r.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(te?.items||[]).length-6)," "]})]},`${te?.slipNo||te?.id||W}`)),ve.length>3&&r.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),r.jsxs(hn,{className:"incoming-deliveries__card",children:[r.jsxs("div",{className:"incoming-deliveries__list-head",children:[r.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[r.jsx(ce,{variant:"secondary",onClick:P,disabled:a||U,children:""}),r.jsx(ce,{variant:"secondary",onClick:pe,disabled:a||U,children:U?"":""})]})]}),a?r.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):u.length===0?r.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):r.jsx("div",{className:"incoming-deliveries__file-list",children:u.map(te=>r.jsxs("div",{className:"incoming-deliveries__file-row",children:[r.jsxs("div",{className:"incoming-deliveries__file-info",children:[r.jsx("div",{style:{fontWeight:700},children:fp(te.name)}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",_0(te.updated_at||te.created_at)]})]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>O(te.name),disabled:J||M,children:J?"":""}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>k({baseName:fp(te.name)}),disabled:M,children:""})]})]},te.name))}),Y&&r.jsxs("div",{className:"incoming-deliveries__aggregate",children:[r.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),Y.length===0?r.jsx("div",{style:{opacity:.85},children:""}):r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"/"}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:Y.slice(0,60).map(te=>r.jsxs("tr",{children:[r.jsx("td",{children:te.vendor||"-"}),r.jsx("td",{children:te.name}),r.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(te.qty)?te.qty:"-"}),r.jsx("td",{children:te.unit||"-"})]},`${te.vendor}@@${te.name}@@${te.unit||""}`))})]}),Y.length>60&&r.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),r.jsx(bn,{isOpen:!!L,onClose:()=>R(null),title:"PDF ",size:"large",children:L?.data?r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",_0(L.data?._meta?.savedAt),L.data?._meta?.originalFileName?` / : ${L.data._meta.originalFileName}`:""]}),(L.data?.slips||L.data?.receipts||[]).map((te,W)=>r.jsxs("div",{style:{marginBottom:"16px"},children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[te?.vendor||"","No: ",te?.slipNo||"-"," / : ",te?.deliveryDate||"-",""]}),r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"52%"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%"},children:""})]})}),r.jsx("tbody",{children:(te?.items||[]).map((me,ke)=>r.jsxs("tr",{children:[r.jsx("td",{children:me?.name||"-"}),r.jsx("td",{style:{textAlign:"right"},children:me?.unitPrice!=null?`${Math.round(me.unitPrice).toLocaleString()}`:"-"}),r.jsx("td",{style:{textAlign:"right"},children:me?.deliveryQty!=null?me.deliveryQty:"-"}),r.jsx("td",{children:me?.deliveryUnit||"-"})]},`${me?.no||ke}`))})]})]},`${te?.slipNo||W}`))]}):r.jsx("div",{style:{opacity:.8},children:""})}),r.jsx(bn,{isOpen:!!V,onClose:()=>k(null),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",V?.baseName,""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>k(null),disabled:M,children:""}),r.jsx(ce,{variant:"danger",onClick:K,disabled:M,children:M?"":""})]})]})})]})},$s="app-data",OT="incoming-stock",DT="stock.json",MT="applied",ga=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},jl=n=>String(n||"").trim(),ya=(n,t,i)=>`${String(i||"").trim()}@@${Wt(n)}@@${jl(t)}`,pp=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===404)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("not found")||a.includes("object not found")},LT=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===409)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("already exists")||a.includes("duplicate")||a.includes("409")},zT=n=>{const t=new Map;return(n?.slips||n?.receipts||[]).forEach(a=>{const o=String(a?.vendor||"").trim();(a?.items||[]).forEach(u=>{const d=String(u?.name||"").trim();if(!d)return;const f=jl(u?.deliveryUnit||u?.unit||u?.unitName||""),h=ga(u?.deliveryQty??u?.quantity??u?.qty);if(h==null)return;const p=ya(d,f,o),y=t.get(p);y?y.quantity+=h:t.set(p,{vendor:o,name:d,unit:f,quantity:h})})}),Array.from(t.values()).filter(a=>Number.isFinite(a.quantity))},UT=(n,t,i)=>{const a=new Map;return(n||[]).forEach(o=>{const u=String(o?.name||"").trim();if(!u)return;const d=jl(o?.unit||""),f=String(o?.vendor||"").trim(),h=ga(o?.quantity)??0;a.set(ya(u,d,f),{vendor:f,name:u,unit:d,quantity:h,updatedAt:o?.updatedAt||null})}),t.forEach(o=>{const u=ya(o.name,o.unit,o.vendor),d=a.get(u);d?(d.quantity=Math.max(0,(ga(d.quantity)??0)+(ga(o.quantity)??0)),d.updatedAt=i):a.set(u,{vendor:o.vendor,name:o.name,unit:jl(o.unit),quantity:Math.max(0,ga(o.quantity)??0),updatedAt:i})}),Array.from(a.values()).sort((o,u)=>o.vendor!==u.vendor?o.vendor.localeCompare(u.vendor,"ja"):o.name!==u.name?o.name.localeCompare(u.name,"ja"):String(o.unit||"").localeCompare(String(u.unit||""),"ja"))},Ps={async _getCurrentUserId(){const{data:n,error:t}=await Ee.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${OT}`},_stockPath(n){return`${this._folderPath(n)}/${DT}`},_appliedFolder(n){return`${this._folderPath(n)}/${MT}`},_appliedMarkerPath(n,t){const i=this._appliedFolder(n),a=String(t||"").trim();if(!a)throw new Error("baseName is required");return`${i}/${a}.json`},async listAppliedBaseNames(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Set;const i=this._appliedFolder(t),{data:a,error:o}=await Ee.storage.from($s).list(i,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(o)return pp(o)?new Set:(console.error("Failed to list applied markers:",o),new Set);const u=new Set;return(a||[]).forEach(d=>{const f=String(d?.name||"");f.toLowerCase().endsWith(".json")&&u.add(f.replace(/\.json$/i,""))}),u},async loadStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const i=this._stockPath(t),{data:a,error:o}=await Ee.storage.from($s).createSignedUrl(i,60);if(o){if(pp(o))return{_meta:{version:1,updatedAt:null},items:[]};throw o}try{const u=await fetch(a.signedUrl,{cache:"no-store"});if(!u.ok){if(u.status===404)return{_meta:{version:1,updatedAt:null},items:[]};throw new Error(`Failed to fetch stock: ${u.status} ${u.statusText}`)}const d=await u.text(),f=JSON.parse(d||"{}"),h=Array.isArray(f?.items)?f.items:[];return{_meta:{version:1,updatedAt:f?._meta?.updatedAt||null},items:h}}catch(u){throw console.warn("loadStock fetch failed",u),u}},async saveStock(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._stockPath(i),o={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(n?.items)?n.items:[]},{error:u}=await Ee.storage.from($s).upload(a,new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(u)throw u;return o},async applyDeliverySet({baseName:n,parsed:t},i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("baseName ");if(!t)throw new Error("");const u=zT(t),d=new Date().toISOString(),f=this._appliedMarkerPath(a,o),h={baseName:o,appliedAt:d,slipCount:(t?.slips||t?.receipts||[]).length||0,itemCount:u.length},p=await Ee.storage.from($s).upload(f,new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(p.error){if(LT(p.error))return{status:"already_applied"};throw p.error}try{const y=await this.loadStock(a),v=UT(y.items||[],u,d);return await this.saveStock({items:v},a),{status:"applied",addedCount:u.length}}catch(y){try{await Ee.storage.from($s).remove([f])}catch{}throw y}},async updateStockItem({name:n,unit:t,vendor:i,delta:a},o=null){const u=o||await this._getCurrentUserId();if(!u)throw new Error("");const d=String(n||"").trim();if(!d)throw new Error("");const f=jl(t),h=String(i||"").trim(),p=ya(d,f,h),y=ga(a);if(y===null||!Number.isFinite(y))throw new Error("");const x=(await this.loadStock(u)).items||[],w=new Date().toISOString();let _=!1;const C=x.map(S=>{if(ya(S.name,S.unit,S.vendor)===p){_=!0;const T=Math.max(0,(ga(S.quantity)??0)+y);return{...S,quantity:T,updatedAt:w}}return S});if(!_)throw new Error("");return await this.saveStock({items:C},u),{status:"updated",name:d,unit:f}},async deleteStockItem({name:n,unit:t,vendor:i},a=null){const o=a||await this._getCurrentUserId();if(!o)throw new Error("");const u=String(n||"").trim();if(!u)throw new Error("");const d=jl(t),f=String(i||"").trim(),h=ya(u,d,f),y=(await this.loadStock(o)).items||[],v=y.filter(x=>ya(x.name,x.unit,x.vendor)!==h);return v.length,y.length,await this.saveStock({items:v},o),{status:"deleted",name:u}},async clearStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const i=this._stockPath(t),a={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await Ee.storage.from($s).upload(i,new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const o=this._appliedFolder(t),{data:u}=await Ee.storage.from($s).list(o,{limit:1e3});if(u?.length){const d=u.map(f=>`${o}/${f.name}`);await Ee.storage.from($s).remove(d)}return{status:"cleared"}},async deleteAppliedMarker(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._appliedMarkerPath(i,n),{error:o}=await Ee.storage.from($s).remove([a]);if(o){if(pp(o))return{status:"not_found"};throw o}return{status:"deleted"}}},Di="meal_plans",IT="planner_data",Ci="",C0=20,Ai=[],BT=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,iw=n=>`planner_data_${n}`,Ni=n=>{Ai[Ai.length-1]!==n&&(Ai.push(n),Ai.length>C0&&Ai.splice(0,Ai.length-C0))},Sr=(n,t=null)=>{if(n==null||n==="")return t;const i=Number(n);return Number.isFinite(i)?i:t},Ip=(n,t)=>{const i=String(n?.message||"").toLowerCase();return String(n?.code||"")==="42703"?i.includes(`column "${String(t).toLowerCase()}"`):i.includes(`column "${String(t).toLowerCase()}"`)&&i.includes("does not exist")},Ei=n=>{try{if(!n)return{};const t=localStorage.getItem(iw(n));if(t)return JSON.parse(t);const i=localStorage.getItem(IT);if(i){const a=JSON.parse(i);return ls(n,a),a}return{}}catch{return{}}},ls=(n,t)=>{n&&localStorage.setItem(iw(n),JSON.stringify(t))},$T=()=>`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,wl=n=>{if(typeof n=="number")return n;const t=Number(n);return Number.isFinite(t)?t:n},PT=n=>({id:String(n.id),recipeId:wl(n.recipe_id??n.recipeId),type:n.meal_type??n.type??"dinner",note:n.note??"",multiplier:Sr(n.multiplier,1),totalWeight:Sr(n.total_weight??n.totalWeight,null)}),qT=n=>n?typeof n=="string"?n.slice(0,10):n instanceof Date?n.toISOString().slice(0,10):String(n).slice(0,10):"",FT=n=>{const t={};return(n||[]).forEach(i=>{const a=qT(i.plan_date??i.planDate);a&&(t[a]||(t[a]=[]),t[a].push(PT(i)))}),t},HT=(n,t)=>{const i=[];return Object.keys(t||{}).forEach(a=>{(t[a]||[]).forEach(u=>{i.push({user_id:n,plan_date:a,recipe_id:wl(u.recipeId),meal_type:u.type||"dinner",note:u.note||"",multiplier:Sr(u.multiplier,1),total_weight:Sr(u.totalWeight,null)})})}),i},VT=n=>({...n,date_str:n.plan_date,type:n.meal_type}),GT=n=>{const{date_str:t,type:i,...a}=n;return a},im=async n=>{if(!n||n.length===0)return;const t=n.map(VT);let{error:i}=await Ee.from(Di).insert(t);if(i&&(Ip(i,"date_str")||Ip(i,"type"))){const a=t.map(GT);({error:i}=await Ee.from(Di).insert(a))}if(i)throw i},N0=n=>BT.test(String(n||"")),Uo=n=>{if(n==null||n==="")return"";if(typeof n=="number")return String(n);const t=Number(n);return Number.isFinite(t)?String(t):String(n)},dd=(n,t)=>{const i=Uo(t?.recipeId),a=Uo(t?.type||"dinner"),o=Uo(t?.note||""),u=Uo(Sr(t?.multiplier,1)),d=Uo(Sr(t?.totalWeight,null));return`${n}|${i}|${a}|${o}|${u}|${d}`},KT=(n,t)=>{const i={};Object.keys(n||{}).forEach(o=>{i[o]=[...n[o]||[]]});const a=new Set;return Object.keys(n||{}).forEach(o=>{(n[o]||[]).forEach(u=>{a.add(dd(o,u))})}),Object.keys(t||{}).forEach(o=>{(t[o]||[]).forEach(d=>{const f=dd(o,d);a.has(f)||(i[o]||(i[o]=[]),i[o].push(d),a.add(f))})}),i},YT=(n,t,i)=>{const a={...n||{}};return a[t]||(a[t]=[]),a[t]=[...a[t],i],a},WT=(n,t,i)=>{const a={...n||{}};return a[t]&&(a[t]=(a[t]||[]).filter(o=>String(o.id)!==String(i)),a[t].length===0&&delete a[t]),a},QT=(n,t,i,a)=>{const o={...n||{}};return o[t]&&(o[t]=o[t].map(u=>String(u.id)!==String(i)?u:{...u,...a})),o},JT=(n,t,i)=>{const a={...n||{}};return Object.keys(a).forEach(o=>{o>=t&&o<=i&&delete a[o]}),a},XT=(n,t)=>{const i=new Set((t||[]).map(d=>String(d))),a={},o=[];let u=!1;return Object.keys(n||{}).forEach(d=>{const f=n[d]||[],h=f.filter(p=>{const y=i.has(String(p.recipeId));return y||o.push(String(p.id)),y});h.length>0&&(a[d]=h),h.length!==f.length&&(u=!0)}),{nextPlans:u?a:n,invalidIds:o,hasChanges:u}},am=async n=>{const{data:t,error:i}=await Ee.from(Di).select("id, plan_date, recipe_id, meal_type, note, multiplier, total_weight, created_at").eq("user_id",n).order("plan_date",{ascending:!0}).order("created_at",{ascending:!0});if(i)throw i;return FT(t||[])},ZT=async(n,t)=>{const i=HT(n,t);return i.length===0?null:(await im(i),am(n))},eA=async(n,t)=>{const i=Ei(n);if(!Object.keys(i).some(f=>(i[f]||[]).some(h=>!N0(h?.id))))return t;const o=new Set;Object.keys(t||{}).forEach(f=>{(t[f]||[]).forEach(h=>{o.add(dd(f,h))})});const u=[];Object.keys(i||{}).forEach(f=>{(i[f]||[]).forEach(h=>{if(N0(h?.id))return;const p=dd(f,h);o.has(p)||(u.push({user_id:n,plan_date:f,recipe_id:wl(h.recipeId),meal_type:h.type||"dinner",note:h.note||"",multiplier:Sr(h.multiplier,1),total_weight:Sr(h.totalWeight,null)}),o.add(p))})}),u.length>0&&await im(u);const d=await am(n);return ls(n,d),d},Kr={consumeWarnings:()=>{const n=[...Ai];return Ai.length=0,n},getAll:async n=>{if(!n)return{};try{const t=await am(n);if(Object.keys(t).length===0){const i=Ei(n);if(Object.keys(i).length>0)try{const a=await ZT(n,i);if(a)return ls(n,a),a}catch{return Ni(Ci),ls(n,i),i}}try{const i=await eA(n,t);return ls(n,i),i}catch(i){console.warn("plannerService.getAll: failed to sync local fallback meals",i),Ni(Ci);const a=Ei(n),o=KT(t,a);return ls(n,o),o}}catch(t){return console.warn("plannerService.getAll: falling back to localStorage",t),Ni(Ci),Ei(n)}},cleanupInvalidPlans:async(n,t)=>{if(!n)return{};if(!Array.isArray(t)||t.length===0)return Kr.getAll(n);const i=await Kr.getAll(n),{nextPlans:a,invalidIds:o,hasChanges:u}=XT(i,t);if(!u)return i;try{if(o.length>0)for(let f=0;f<o.length;f+=200){const h=o.slice(f,f+200),{error:p}=await Ee.from(Di).delete().eq("user_id",n).in("id",h);if(p)throw p}}catch(d){console.warn("plannerService.cleanupInvalidPlans: delete fallback to localStorage",d),Ni(Ci)}return ls(n,a),a},addMeal:async(n,t,i,a,o={})=>{if(!n)return null;const u={id:$T(),recipeId:wl(i),type:a||"dinner",note:"",multiplier:Sr(o?.multiplier,1),totalWeight:Sr(o?.totalWeight,null)},d=Ei(n),f=YT(d,t,u);ls(n,f);try{const h={user_id:n,plan_date:t,recipe_id:wl(i),meal_type:a||"dinner",note:"",multiplier:Sr(o?.multiplier,1),total_weight:Sr(o?.totalWeight,null)};return await im([h]),u}catch(h){return console.warn("plannerService.addMeal: insert fallback to localStorage",h),Ni(Ci),u}},removeMeal:async(n,t,i)=>{if(!n)return;try{const{error:u}=await Ee.from(Di).delete().eq("id",String(i)).eq("user_id",n);if(u)throw u}catch(u){console.warn("plannerService.removeMeal: delete fallback to localStorage",u),Ni(Ci)}const a=Ei(n),o=WT(a,t,i);ls(n,o)},updateMeal:async(n,t,i,a)=>{if(!n)return;const o={};Object.prototype.hasOwnProperty.call(a,"recipeId")&&(o.recipe_id=wl(a.recipeId)),Object.prototype.hasOwnProperty.call(a,"type")&&(o.meal_type=a.type||"dinner",o.type=o.meal_type),Object.prototype.hasOwnProperty.call(a,"note")&&(o.note=a.note||""),Object.prototype.hasOwnProperty.call(a,"multiplier")&&(o.multiplier=Sr(a.multiplier,1)),Object.prototype.hasOwnProperty.call(a,"totalWeight")&&(o.total_weight=Sr(a.totalWeight,null));try{if(Object.keys(o).length>0){let{error:f}=await Ee.from(Di).update(o).eq("id",String(i)).eq("user_id",n);if(f&&Ip(f,"type")){const{type:h,...p}=o;({error:f}=await Ee.from(Di).update(p).eq("id",String(i)).eq("user_id",n))}if(f)throw f}}catch(f){console.warn("plannerService.updateMeal: update fallback to localStorage",f),Ni(Ci)}const u=Ei(n),d=QT(u,t,i,a);ls(n,d)},clearPeriod:async(n,t,i)=>{if(!n)return;try{const{error:u}=await Ee.from(Di).delete().eq("user_id",n).gte("plan_date",t).lte("plan_date",i);if(u)throw u}catch(u){console.warn("plannerService.clearPeriod: delete fallback to localStorage",u),Ni(Ci)}const a=Ei(n),o=JT(a,t,i);ls(n,o)}},tA=["g","kg","ml","cc","l","cl"],_l=n=>(n??"").toString().trim(),aw=n=>{const t=_l(n);if(!t)return"";const i=t.toLowerCase();return i===""?"g":i===""?"ml":i===""?"cc":i===""?"kg":i===""?"l":i===""?"cl":i},nA=n=>{const t=_l(n);return t?["","","","","","","","PC","pc",""].includes(t):!1},$o=(n,t)=>{const i=parseFloat(n)||0,a=aw(t);return a==="kg"?{qty:i*1e3,unit:"g"}:a==="g"?{qty:i,unit:"g"}:a==="l"?{qty:i*1e3,unit:"ml"}:a==="cc"?{qty:i,unit:"ml"}:a==="ml"?{qty:i,unit:"ml"}:a==="cl"?{qty:i*10,unit:"ml"}:{qty:i,unit:_l(t)||""}},E0=(n,t,i,a)=>{const o=_l(i),u=parseFloat(t)||0;if(!a)return $o(u,o);const d=parseFloat(a.packetSize),f=aw(a.packetUnit);if(!Number.isFinite(d)||d<=0||!f)return $o(u,o);if(tA.includes(f)&&nA(o)){const p=u*d;return $o(p,f)}return $o(u,o)},Bp={async calculateShortages(n,t,i,a={}){if(!n?.id)throw new Error("User required");const o=a?.includeRecipeBreakdown===!0,u=await Kr.getAll(n.id),d=new Date(t),f=new Date(i);f.setHours(23,59,59,999);const h=[];if(Object.keys(u).forEach(H=>{const V=new Date(H);V>=d&&V<=f&&u[H].forEach(k=>{h.push(k)})}),h.length===0)return o?{items:[],recipeBreakdown:[]}:[];const[p,y,v,x,w]=await Promise.all([Sn.fetchRecipes(n),Ln.getAllConversions(),or.fetchPriceList(n.id),Zn.getAll(n.id),ud.getAll(n.id)]),_=new Map;p.forEach(H=>_.set(H.id,H));const C=new Map;try{for(const[H,V]of(y||new Map).entries()){const k=Wt(H);k&&(C.has(k)||C.set(k,V))}}catch{}const S=new Map;try{for(const[H,V]of(w||new Map).entries()){const k=Wt(H);k&&(S.has(k)||S.set(k,V))}}catch{}const N=new Map;try{(x||[]).forEach(H=>{const V=Wt(H?.name);V&&(N.has(V)||N.set(V,H))})}catch{}const T={},L=new Map;h.forEach(H=>{const V=_.get(H.recipeId);if(!V)return;let k=null;if(o){const F=String(V.id);L.has(F)||L.set(F,{recipeId:V.id,recipeTitle:V.title||`Recipe ${V.id}`,itemMap:new Map}),k=L.get(F)}let M=1;if(H.totalWeight&&H.totalWeight>0){let F=0;(V.ingredients||[]).forEach(Y=>{const{qty:$,unit:P}=$o(Y.quantity,Y.unit);(P==="g"||P==="ml")&&(F+=$)}),F>0&&(M=H.totalWeight/F)}else H.multiplier&&H.multiplier>0&&(M=H.multiplier);[...V.ingredients||[]].forEach(F=>{if(!F.name)return;const Y=_l(F.name),$=Wt(Y),P=($?C.get($):null)||y?.get(Y)||null,E=(parseFloat(F.quantity)||0)*M,B=E0(Y,E,F.unit,P),q=B.qty||0,Q=B.unit||"";if(T[Y]||(T[Y]={quantity:0,unit:Q,count:0}),T[Y].quantity+=q,o&&k){const G=$||Y,A=k.itemMap.get(G);A?(A.required+=q,!A.unit&&Q&&(A.unit=Q)):k.itemMap.set(G,{ingredientKey:G,name:Y,required:q,unit:Q})}})});const R=Object.keys(T).map(H=>{const V=T[H],k=Wt(H),M=(k?C.get(k):null)||y?.get(H)||null,z=k&&v?.get(k)||null,U=k&&N.get(k)||null,F=E0(H,U?.quantity??0,U?.unit??V.unit,M),Y=V.quantity||0,$=F.qty||0,P=V.unit||F.unit||"",E=$-Y,B=parseFloat(M?.packetSize),q=_l(M?.packetUnit),Q=Number.isFinite(B)&&B>0&&!!q,G=Q?B*.2:0,A=Q?E<G:!1,O=z?.unit?String(z.unit).trim():"",K=k&&S.has(k)?String(S.get(k)).trim():"",de=K||""||O||""||"",pe=(M?.lastPrice!==null&&M?.lastPrice!==void 0&&M?.lastPrice!==""?parseFloat(M.lastPrice):null)??(z?.price!==null&&z?.price!==void 0?parseFloat(z.price):null);let ve=null,te=0,W=P;if(Q){const ke=Math.max(0,G-E);ve=Math.ceil(ke/B),A&&ve<1&&(ve=1),te=ve,W=de}else te=Math.max(0,Y-$),W=P;const me=Q?A:te>.01;return{name:H,required:Y,stock:$,remaining:E,unit:P,shouldShow:me,toOrder:te,orderUnit:W,orderPacks:ve,packSize:Q?B:null,packUnit:Q?q:null,packPrice:Number.isFinite(pe)?pe:null,vendor:z?.vendor||U?.vendor||""}}).filter(H=>H.shouldShow);if(!o)return R;const J=Array.from(L.values()).map(H=>({recipeId:H.recipeId,recipeTitle:H.recipeTitle,items:Array.from(H.itemMap.values()).filter(V=>Number(V.required||0)>1e-4)}));return{items:R,recipeBreakdown:J}}},Bu=n=>String(n||"").replace(/\.json$/i,""),rA=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${i}/${a}/${o} ${u}:${d}`},sA=({onBack:n})=>{const{user:t}=fs(),[i,a]=oc(),[o,u]=_e.useState(!0),[d,f]=_e.useState(""),[h,p]=_e.useState([]),[y,v]=_e.useState(new Set),[x,w]=_e.useState({items:[]}),[_,C]=_e.useState([]),[S,N]=_e.useState(null),[T,L]=_e.useState("need_order"),[R,J]=_e.useState(!1),[H,V]=_e.useState(null),[k,M]=_e.useState(""),[z,U]=_e.useState(!1),F=_e.useCallback(async()=>{u(!0),f("");try{const we=new Date,ae=new Date(we);ae.setDate(we.getDate()+7);const[Ge,Ne,dt,rt]=await Promise.all([us.listJsonFiles(),Ps.listAppliedBaseNames(),Ps.loadStock(),t?.id?Bp.calculateShortages(t,we.toISOString(),ae.toISOString()):Promise.resolve([])]);p(Ge||[]),v(Ne||new Set),w(dt||{items:[]}),C(rt||[])}catch(we){console.error(we),f(we?.message||String(we))}finally{u(!1)}},[t]);_e.useEffect(()=>{F()},[F]);const Y=_e.useMemo(()=>{const we=new Map;return(_||[]).forEach(ae=>{const Ge=`${ae.vendor||""}@@${ae.name}@@${ae.unit||""}`;we.set(Ge,{...ae,quantity:ae.stock,isShortage:!0,reason:` (: ${ae.required.toFixed(1)}${ae.unit})`})}),(x?.items||[]).forEach(ae=>{if((ae.quantity||0)<=0){const Ge=`${ae.vendor||""}@@${ae.name}@@${ae.unit||""}`;we.has(Ge)||we.set(Ge,{...ae,isShortage:!1})}}),Array.from(we.values()).sort((ae,Ge)=>ae.isShortage!==Ge.isShortage?ae.isShortage?-1:1:(ae.vendor||"").localeCompare(Ge.vendor||""))},[_,x]),$=async we=>{const ae=Bu(we);N(ae),f("");try{const Ge=await us.downloadJson(we);(await Ps.applyDeliverySet({baseName:ae,parsed:Ge}))?.status==="already_applied"&&f("PDF"),await F()}catch(Ge){console.error(Ge),f(Ge?.message||String(Ge))}finally{N(null)}},P=async()=>{N("all"),f("");try{const we=await us.listJsonFiles(),ae=await Ps.listAppliedBaseNames();for(const Ge of we||[]){const Ne=Ge?.name;if(!Ne)continue;const dt=Bu(Ne);if(ae.has(dt))continue;const rt=await us.downloadJson(Ne);(await Ps.applyDeliverySet({baseName:dt,parsed:rt}))?.status==="applied"&&ae.add(dt)}await F()}catch(we){console.error(we),f(we?.message||String(we))}finally{N(null)}},E=we=>{V(we),M(""),J(!0),f("")},B=we=>{M(ae=>{const Ne=(parseFloat(ae)||0)+we;return String(Math.round(Ne*1e3)/1e3)})},q=async()=>{if(!H)return;const we=Number(k);if(!k||isNaN(we)||we<=0){f("");return}U(!0),f("");try{await Ps.updateStockItem({name:H.name,unit:H.unit,vendor:H.vendor,delta:-we}),await F(),J(!1),V(null)}catch(ae){console.error(ae),f(ae?.message||String(ae))}finally{U(!1)}},[Q,G]=_e.useState(!1),[A,O]=_e.useState(null),[K,de]=_e.useState(!1),[pe,ve]=_e.useState(!1),[te,W]=_e.useState(!1),me=we=>{O(we),G(!0),f("")},ke=async()=>{if(A){de(!0),f("");try{await Ps.deleteStockItem({name:A.name,unit:A.unit,vendor:A.vendor}),await F(),G(!1),O(null)}catch(we){console.error(we),f(": "+(we.message||String(we)))}finally{de(!1)}}},[ie,je]=_e.useState(!1),[Re,Oe]=_e.useState(null),[qe,et]=_e.useState(!1),at=we=>{const ae=Bu(we.name);Oe({name:we.name,baseName:ae}),je(!0),f("")},lt=async()=>{if(Re){et(!0),f("");try{await us.deleteDeliverySet(Re.baseName),await Ps.deleteAppliedMarker(Re.baseName),await F(),je(!1),Oe(null)}catch(we){console.error(we),f("PDF: "+(we.message||String(we)))}finally{et(!1)}}},pt=async()=>{W(!0),f("");try{await Ps.clearStock(),await F(),ve(!1)}catch(we){console.error(we),f(": "+(we.message||String(we)))}finally{W(!1)}};return r.jsxs("div",{className:"incoming-stock",children:[r.jsxs("div",{className:"incoming-stock__header",children:[r.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsx(ce,{variant:"secondary",onClick:()=>a({view:"incoming-deliveries"}),children:" PDF"}),r.jsx(ce,{variant:"ghost",onClick:n,children:" "})]})]}),d&&r.jsx(hn,{className:"incoming-stock__error",children:d}),r.jsxs(hn,{className:"incoming-stock__card",children:[r.jsxs("div",{className:"incoming-stock__card-head",children:[r.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[r.jsx(ce,{variant:"secondary",onClick:F,disabled:o||!!S,children:""}),r.jsx(ce,{variant:"primary",onClick:P,disabled:o||!!S,children:S==="all"?"":""}),r.jsx(ce,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:()=>ve(!0),disabled:o||!!S||!x?.items?.length,children:" "})]})]}),o?r.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):h.length===0?r.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):r.jsx("div",{className:"incoming-stock__file-list",children:h.map(we=>{const ae=Bu(we?.name),Ge=y.has(ae);return r.jsxs("div",{className:"incoming-stock__file-row",children:[r.jsxs("div",{className:"incoming-stock__file-info",children:[r.jsx("div",{style:{fontWeight:700},children:ae}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",rA(we.updated_at||we.created_at)]})]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[Ge?r.jsx("span",{className:"incoming-stock__badge",children:""}):r.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),r.jsx(ce,{variant:Ge?"secondary":"primary",size:"sm",onClick:()=>$(we.name),disabled:!!S||Ge,children:S===ae?"":Ge?"":""}),r.jsx(ce,{variant:"ghost",size:"sm",style:{color:"#d32f2f",marginLeft:"4px"},onClick:()=>at(we),disabled:!!S,title:"PDF",children:""})]})]},we.name)})}),!o&&r.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",r.jsx("strong",{children:y.size}),"  / PDF: ",r.jsx("strong",{children:h.length})," "]})]}),r.jsxs(hn,{className:"incoming-stock__card",children:[r.jsx("div",{className:"incoming-stock__card-head",children:r.jsx("h3",{className:"incoming-stock__section-title",children:""})}),r.jsxs("div",{className:"incoming-stock__tabs",children:[r.jsxs("button",{className:`incoming-stock__tab-button ${T==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>L("need_order"),children:[" ",r.jsx("span",{className:"incoming-stock__tab-count",children:Y.length})]}),Array.from(new Set((x?.items||[]).map(we=>we.vendor||""))).sort().map(we=>r.jsx("button",{className:`incoming-stock__tab-button ${T===we?"incoming-stock__tab-button--active":""}`,onClick:()=>L(we),children:we},we))]}),(()=>{let we=[];if(T==="need_order")we=Y;else{const ae=T===""?"":T;we=(x?.items||[]).filter(Ge=>(Ge.vendor||"")===ae)}return we.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:T==="need_order"?"0":""}):r.jsx("div",{className:"incoming-stock__table-wrap",children:r.jsxs("table",{className:"incoming-stock__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"45%"},children:"/"}),r.jsx("th",{style:{width:"25%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"10%"},children:""}),r.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),r.jsx("tbody",{children:we.map(ae=>r.jsxs("tr",{style:ae.isShortage?{backgroundColor:"#fff5f5"}:{},children:[r.jsxs("td",{children:[r.jsxs("div",{style:{fontWeight:500},children:[ae.name,ae.isShortage&&r.jsx("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#d32f2f",border:"1px solid #d32f2f",borderRadius:"4px",padding:"1px 4px",verticalAlign:"middle"},children:""})]}),ae.reason&&r.jsxs("div",{style:{fontSize:"0.8rem",color:"#d32f2f",marginTop:"2px"},children:[ae.reason,"  : ",ae.toOrder,ae.orderUnit]}),!ae.reason&&T==="need_order"&&ae.vendor&&r.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:ae.vendor})]}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(ae.quantity||0)<=0||ae.isShortage?"#d32f2f":"inherit"},children:Number.isFinite(ae.quantity)?ae.quantity:"-"}),r.jsx("td",{children:ae.unit||"-"}),r.jsx("td",{style:{textAlign:"center"},children:r.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>E(ae),children:"/"}),r.jsx(ce,{variant:"ghost",size:"sm",style:{color:"#d32f2f"},onClick:()=>me(ae),children:""})]})})]},`${ae.vendor}@@${ae.name}@@${ae.unit||""}`))})]})})})()]}),r.jsx(bn,{isOpen:R,onClose:()=>J(!1),title:"",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsx("div",{style:{fontWeight:"bold"},children:H?.name})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsxs("div",{children:[H?.quantity," ",H?.unit]})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx($t,{type:"text",inputMode:"decimal",value:k,onChange:we=>M(we.target.value),readOnly:!0,placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px",textAlign:"center",backgroundColor:"#f9f9f9",cursor:"default"}}),r.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:H?.unit})]}),r.jsxs("div",{className:"incoming-stock__calc-grid",children:[r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(.001),children:"+0.001"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(.01),children:"+0.01"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(.1),children:"+0.1"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(.5),children:"+0.5"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(1),children:"+1"}),r.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>M(""),children:""})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>J(!1),disabled:z,children:""}),r.jsx(ce,{variant:"primary",onClick:q,disabled:z||!k,children:z?"":""})]})]})}),r.jsx(bn,{isOpen:Q,onClose:()=>G(!1),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",A?.name,"",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.85rem",color:"#666"},children:""})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>G(!1),disabled:K,children:""}),r.jsx(ce,{variant:"danger",onClick:ke,disabled:K,children:K?"":""})]})]})}),r.jsx(bn,{isOpen:ie,onClose:()=>je(!1),title:"PDF",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",Re?.baseName,""]}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>je(!1),disabled:qe,children:""}),r.jsx(ce,{variant:"danger",onClick:lt,disabled:qe,children:qe?"":""})]})]})}),r.jsx(bn,{isOpen:pe,onClose:()=>ve(!1),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsx("p",{style:{marginTop:0,fontWeight:"bold",color:"#d32f2f"},children:""}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["PDF",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>ve(!1),disabled:te,children:""}),r.jsx(ce,{variant:"danger",onClick:pt,disabled:te,children:te?"":""})]})]})}),r.jsx(bn,{isOpen:!!S,onClose:()=>{},title:"",size:"small",showCloseButton:!1,children:r.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[r.jsx("div",{className:"incoming-stock__spinner"}),r.jsx("p",{style:{margin:"0 0 8px",fontWeight:"bold"},children:"PDF..."}),r.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",margin:0},children:[S==="all"?"":"",r.jsx("br",{}),""]})]})})]})},lw=n=>{const{totalWeight:t,multiplier:i}=n||{};return t?`${t}g`:i&&i!==1?`x${i}`:""},iA=({recipe:n})=>{const{attributes:t,listeners:i,setNodeRef:a,transform:o,isDragging:u}=Zp({id:`recipe-${n.id}`,data:{recipe:n}}),d=u?{opacity:.35}:o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,position:"relative",zIndex:999}:void 0;return r.jsx("div",{ref:a,style:d,...i,...t,className:"draggable-recipe",children:n.title})},aA=({meal:n,dateStr:t,children:i})=>{const{attributes:a,listeners:o,setNodeRef:u,transform:d,isDragging:f}=Zp({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),h=f?{opacity:.35}:d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0,p=lw(n);return r.jsxs("div",{ref:u,style:h,...o,...a,className:"draggable-meal-wrapper",children:[i,p&&r.jsx("div",{style:{position:"absolute",bottom:"2px",right:"4px",fontSize:"0.75rem",fontWeight:"bold",color:"#666",backgroundColor:"rgba(255,255,255,0.8)",padding:"0 2px",borderRadius:"2px",pointerEvents:"none"},children:p})]})},lA=({dateStr:n,dayNum:t,isToday:i,isOutside:a,children:o})=>{const{setNodeRef:u,isOver:d}=fc({id:`date-${n}`,data:{dateStr:n}});return r.jsxs("div",{ref:u,className:`calendar-cell ${i?"today":""} ${a?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[r.jsx("div",{className:"day-number",children:t}),o]})},ul=n=>`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,oA=({onBack:n,onSelectRecipe:t,onNavigateToOrderList:i})=>{const{user:a}=fs(),o=ws(),u=b.useRef(o),[d,f]=b.useState([]),[h,p]=b.useState({}),[y,v]=b.useState(new Date),[x,w]=b.useState(""),[_,C]=b.useState(!1),[S,N]=b.useState(null),[T,L]=b.useState(!1),[R,J]=b.useState(null),[H,V]=b.useState(1),[k,M]=b.useState(""),[z,U]=b.useState(null),[F,Y]=b.useState(!1),[$,P]=b.useState(ul(new Date)),[E,B]=b.useState(ul(new Date)),q=xa(hr(Al,{activationConstraint:{distance:6}}),hr(Rl,{activationConstraint:{delay:70,tolerance:8}}));b.useEffect(()=>{u.current=o},[o]);const Q=b.useCallback(()=>{const Oe=Kr.consumeWarnings?.()||[];Oe.length!==0&&[...new Set(Oe)].forEach(qe=>{u.current.warning(qe)})},[]),G=b.useCallback(async()=>{if(!a){f([]),p({});return}let Oe=[];try{Oe=await Sn.fetchRecipes(a)}catch(qe){console.error("Planner: failed to fetch recipes",qe),u.current.error(""),Oe=[]}if(f(Oe),a?.id)try{let qe;if(Array.isArray(Oe)&&Oe.length>0){const et=Oe.map(at=>at.id);qe=await Kr.cleanupInvalidPlans(a.id,et)}else qe=await Kr.getAll(a.id);p(qe)}finally{Q()}},[Q,a]);b.useEffect(()=>{const Oe=setTimeout(()=>{G()},0);return()=>clearTimeout(Oe)},[G]);const A=b.useCallback(Oe=>{const qe=Oe?.active;if(!qe?.id){U(null);return}const et=String(qe.id);if(et.startsWith("recipe-")){const at=qe.data.current?.recipe;U({kind:"recipe",title:at?.title||"",qtyStr:""});return}if(et.startsWith("meal-")){const at=qe.data.current?.meal,lt=d.find(pt=>pt.id===at?.recipeId);U({kind:"meal",title:lt?.title||"Unknown",qtyStr:lw(at)});return}U(null)},[d]),O=b.useCallback(()=>{U(null)},[]),K=async Oe=>{const{active:qe,over:et}=Oe;try{if(!et)return;if(et.id.startsWith("date-")){const at=et.data.current.dateStr;if(qe.id.startsWith("recipe-")){const lt=qe.data.current.recipe;J({type:"new",recipe:lt,targetDateStr:at}),V(1),M(""),L(!0)}else if(qe.id.startsWith("meal-")){const{meal:lt,dateStr:pt}=qe.data.current;if(pt===at)return;const we={multiplier:lt.multiplier,totalWeight:lt.totalWeight};await Kr.addMeal(a.id,at,lt.recipeId,lt.type||"dinner",we),await Kr.removeMeal(a.id,pt,lt.id),G()}}}finally{U(null)}},de=async()=>{if(!R)return;const{type:Oe,recipe:qe,targetDateStr:et}=R;if(Oe==="new"){const at={};if(qe.type==="bread"){const lt=parseFloat(k);at.totalWeight=Number.isFinite(lt)?lt:null,at.multiplier=1}else{const lt=parseFloat(H);at.multiplier=Number.isFinite(lt)?lt:1,at.totalWeight=null}await Kr.addMeal(a.id,et,qe.id,"dinner",at)}L(!1),J(null),G()},pe=()=>{L(!1),J(null)},ve=async(Oe,qe,et)=>{et&&et.stopPropagation(),N({dateStr:Oe,mealId:qe}),C(!0)},te=async()=>{if(!S)return;const{dateStr:Oe,mealId:qe}=S;C(!1),N(null);try{await Kr.removeMeal(a.id,Oe,qe),await G(),o.success("")}catch(et){o.error(""),console.error("Delete meal error:",et)}},W=()=>{C(!1),N(null)},me=()=>{P(ul(new Date)),B(ul(new Date)),Y(!0)},ke=async()=>{if(a?.id)try{await Kr.clearPeriod(a.id,$,E),await G(),Y(!1),o.success(`${$}${E}`)}catch(Oe){console.error(Oe),o.error("")}},ie=()=>{const Oe=y.getFullYear(),qe=y.getMonth(),et=new Date(Oe,qe,1),at=new Date(Oe,qe+1,0),lt=[],pt=et.getDay();for(let ae=pt-1;ae>=0;ae--){const Ge=new Date(Oe,qe,-ae);lt.push({date:Ge,isOutside:!0})}for(let ae=1;ae<=at.getDate();ae++){const Ge=new Date(Oe,qe,ae);lt.push({date:Ge,isOutside:!1})}const we=42-lt.length;for(let ae=1;ae<=we;ae++){const Ge=new Date(Oe,qe+1,ae);lt.push({date:Ge,isOutside:!0})}return lt},je=d.filter(Oe=>Oe.title.toLowerCase().includes(x.toLowerCase())),Re=Oe=>{v(new Date(y.getFullYear(),y.getMonth()+Oe,1))};return r.jsxs("div",{className:`planner-container fade-in ${z?"dragging":""}`,children:[_&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(hn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("strong",{children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:W,children:""}),r.jsx(ce,{variant:"danger",onClick:te,children:""})]})]})}),F&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(hn,{style:{width:"90%",maxWidth:"500px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("strong",{children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1.5rem"},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),r.jsx($t,{type:"date",value:$,onChange:Oe=>P(Oe.target.value)})]}),r.jsx("span",{style:{paddingTop:"24px"},children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),r.jsx($t,{type:"date",value:E,onChange:Oe=>B(Oe.target.value)})]})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>Y(!1),children:""}),r.jsx(ce,{variant:"danger",onClick:ke,children:""})]})]})}),T&&R&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(hn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",backgroundColor:"white"},children:[r.jsx("h3",{style:{marginTop:0},children:R.recipe.type==="bread"?"":""}),r.jsx("p",{style:{margin:"1rem 0",color:"#666"},children:R.recipe.title}),r.jsx("div",{style:{marginBottom:"1.5rem"},children:R.recipe.type==="bread"?r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:" (g)"}),r.jsx($t,{type:"number",value:k,onChange:Oe=>M(Oe.target.value),placeholder:": 1200",autoFocus:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:" "})]}):r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:""}),r.jsx($t,{type:"number",step:"0.1",value:H,onChange:Oe=>V(Oe.target.value),placeholder:": 1, 1.5, 2",autoFocus:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:"  (1 = )"})]})}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[r.jsx(ce,{variant:"ghost",onClick:pe,children:""}),r.jsx(ce,{variant:"primary",onClick:de,children:""})]})]})}),r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions",children:[r.jsx(ce,{variant:"secondary",onClick:i,style:{marginRight:"8px"},children:" "}),r.jsx(ce,{variant:"danger",onClick:me,style:{marginRight:"8px"},children:" "}),r.jsx(ce,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsxs(Mi,{sensors:q,onDragStart:A,onDragCancel:O,onDragEnd:K,autoScroll:!0,children:[r.jsxs("div",{className:"planner-layout",children:[r.jsxs("div",{className:"recipe-sidebar",children:[r.jsx("div",{className:"sidebar-search",children:r.jsx($t,{placeholder:"...",value:x,onChange:Oe=>w(Oe.target.value)})}),r.jsx("div",{className:"draggable-list",children:je.map(Oe=>r.jsx(iA,{recipe:Oe},Oe.id))})]}),r.jsxs("div",{className:"planner-calendar",children:[r.jsxs("div",{className:"calendar-header",children:[r.jsx(ce,{variant:"ghost",onClick:()=>Re(-1),children:" "}),r.jsxs("h3",{style:{margin:0},children:[y.getFullYear()," ",y.getMonth()+1,""]}),r.jsx(ce,{variant:"ghost",onClick:()=>Re(1),children:" "})]}),r.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(Oe=>r.jsx("div",{className:"calendar-day-header",children:Oe},Oe)),ie().map((Oe,qe)=>{const et=ul(Oe.date),at=h[et]||[],lt=et===ul(new Date);return r.jsx(lA,{dateStr:et,dayNum:Oe.date.getDate(),isToday:lt,isOutside:Oe.isOutside,children:at.map(pt=>{const we=d.find(ae=>ae.id===pt.recipeId);return r.jsx(aA,{meal:pt,dateStr:et,children:r.jsxs("div",{className:"planned-meal",title:we?.title,onClick:()=>we&&t&&t(we),children:[r.jsx("span",{children:we?.title||"Unknown"}),r.jsx("span",{className:"delete-meal-btn",onPointerDown:ae=>{ae.stopPropagation()},onClick:ae=>ve(et,pt.id,ae),children:""})]})},pt.id)})},qe)})]})]})]}),r.jsx(tm,{children:z?r.jsxs("div",{className:`drag-overlay-card ${z.kind==="meal"?"meal":""}`,children:[r.jsx("span",{className:"drag-overlay-title",children:z.title}),z.qtyStr&&r.jsx("span",{className:"drag-overlay-qty",children:z.qtyStr})]}):null})]})]})},cA=({onBack:n,onNavigateToPlanner:t})=>{const{user:i}=fs(),a=ws(),[o,u]=b.useState(new Date().toISOString().slice(0,10)),[d,f]=b.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[h,p]=b.useState([]),[y,v]=b.useState([]),[x,w]=b.useState(!1),[_,C]=b.useState(!1),[S,N]=b.useState(!1),[T,L]=b.useState(!1);_e.useEffect(()=>{window.plannerService=Kr,window.shortageService=Bp,window.recipeService=Sn},[]);const R=_e.useMemo(()=>{const U=new Set;return(h||[]).forEach(F=>{const Y=Wt(F?.name);U.add(Y||F?.name||"")}),U},[h]),J=_e.useMemo(()=>{const U=new Map;return(h||[]).forEach(F=>{const Y=Wt(F?.name)||F?.name||"";Y&&(U.has(Y)||U.set(Y,F))}),U},[h]),H=async()=>{w(!0);try{if(!i?.id){a.error(""),w(!1);return}const U=await Bp.calculateShortages(i,o,d,{includeRecipeBreakdown:!0}),F=Array.isArray(U)?U:U?.items||[],Y=Array.isArray(U)?[]:U?.recipeBreakdown||[];F.length,p(F),v(Y),C(!0)}catch(U){console.error(U),a.error(": "+(U.message||String(U)))}finally{w(!1)}},V=()=>{N(!0)},k=()=>{L(!0)},M=()=>h.map(U=>{if(Number.isFinite(U.orderPacks)&&U.orderPacks!==null){const F=U.packSize&&U.packUnit?`1${U.orderUnit}=${U.packSize}${U.packUnit}`:"";return`${U.name}: ${U.orderPacks}${U.orderUnit}${F}`}return`${U.name}: ${Number(U.toOrder||0).toFixed(1)}${U.unit}`}).join(`
`),z=async()=>{const U=document.getElementById("copy-textarea");if(U){U.select();try{await navigator.clipboard.writeText(U.value),a.success("")}catch{document.execCommand("copy"),a.success("")}}};return r.jsxs("div",{className:"order-list-container fade-in",children:[r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions",children:[r.jsx(ce,{variant:"secondary",onClick:t,style:{marginRight:"8px"},children:" "}),r.jsx(ce,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsx("div",{className:"filter-card",children:r.jsxs("div",{className:"date-range-inputs",children:[r.jsxs("div",{children:[r.jsx("label",{children:""}),r.jsx("input",{type:"date",value:o,onChange:U=>u(U.target.value)})]}),r.jsx("span",{children:""}),r.jsxs("div",{children:[r.jsx("label",{children:""}),r.jsx("input",{type:"date",value:d,onChange:U=>f(U.target.value)})]}),r.jsx(ce,{variant:"primary",onClick:H,disabled:x,children:x?"...":""})]})}),_&&r.jsxs("div",{className:"order-results",children:[r.jsxs("div",{className:"results-header",children:[r.jsxs("h3",{children:[" (",h.length,")"]}),r.jsxs("div",{className:"result-actions",children:[r.jsx(ce,{variant:"secondary",onClick:V,children:" "}),r.jsx(ce,{variant:"secondary",onClick:k,children:" "})]})]}),r.jsxs("table",{className:"order-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""})]})}),r.jsx("tbody",{children:h.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):h.map((U,F)=>r.jsxs("tr",{children:[r.jsx("td",{children:U.name}),r.jsxs("td",{style:{textAlign:"right"},children:[U.required.toFixed(1)," ",U.unit]}),r.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,U.remaining??0).toFixed(1)," ",U.unit]}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(U.orderPacks)&&U.orderPacks!==null?r.jsxs(r.Fragment,{children:[U.orderPacks,U.orderUnit,U.packSize&&U.packUnit&&r.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",U.orderUnit," = ",Number(U.packSize).toLocaleString(),U.packUnit,U.packPrice?` / ${Math.round(U.packPrice).toLocaleString()}`:""]})]}):r.jsxs(r.Fragment,{children:[U.toOrder.toFixed(1)," ",r.jsx("span",{style:{fontSize:"0.8em"},children:U.unit})]})})]},F))})]})]}),r.jsx(bn,{isOpen:S,onClose:()=>N(!1),title:" ",size:"medium",children:r.jsxs("div",{className:"copy-modal-content",children:[r.jsx("p",{className:"copy-instructions",children:""}),r.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:M(),onClick:U=>U.target.select()}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(ce,{variant:"primary",onClick:z,children:" "}),r.jsx(ce,{variant:"ghost",onClick:()=>N(!1),children:""})]})]})}),r.jsx(bn,{isOpen:T,onClose:()=>L(!1),title:" ",size:"large",children:r.jsxs("div",{className:"print-preview-content",children:[r.jsxs("div",{className:"print-preview-header",children:[r.jsx("h3",{children:""}),r.jsxs("p",{className:"print-period",children:[": ",o,"  ",d]})]}),y.length>0&&r.jsxs("div",{className:"recipe-breakdown-print",children:[r.jsx("h4",{children:" "}),y.map((U,F)=>{const Y=(U.items||[]).filter($=>{const P=$.ingredientKey||Wt($.name)||$.name;return R.has(P)});return Y.length===0?null:r.jsxs("section",{className:"recipe-breakdown-section",children:[r.jsx("div",{className:"recipe-breakdown-section-title",children:U.recipeTitle}),r.jsxs("table",{className:"recipe-breakdown-table",children:[r.jsxs("colgroup",{children:[r.jsx("col",{className:"rb-col-name"}),r.jsx("col",{className:"rb-col-required"}),r.jsx("col",{className:"rb-col-stock"}),r.jsx("col",{className:"rb-col-spec"})]}),r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""})]})}),r.jsx("tbody",{children:Y.map(($,P)=>{const E=$.ingredientKey||Wt($.name)||$.name,B=J.get(E),q=B?.unit||$.unit||"",Q=Math.max(0,Number(B?.remaining??0)),G=(B?.vendor||"").trim(),A=B?.packSize&&B?.packUnit?`1${B.orderUnit||""} = ${Number(B.packSize).toLocaleString()}${B.packUnit}${B.packPrice?` / ${Math.round(B.packPrice).toLocaleString()}`:""}`:"-";return r.jsxs("tr",{children:[r.jsxs("td",{children:[$.name,G&&r.jsxs("span",{className:"recipe-material-vendor",children:["",G]})]}),r.jsxs("td",{style:{textAlign:"right"},children:[Number($.required||0).toFixed(1)," ",$.unit||""]}),r.jsxs("td",{style:{textAlign:"right"},children:[Q.toFixed(1)," ",q]}),r.jsx("td",{style:{textAlign:"right",color:"#666",fontWeight:"normal"},children:A})]},`${$.ingredientKey||$.name||P}-${P}`)})})]})]},`${U.recipeId||U.recipeTitle||F}`)})]}),y.length===0&&r.jsx("p",{style:{margin:0,fontSize:"0.95rem",color:"#374151"},children:""}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(ce,{variant:"primary",onClick:()=>window.print(),children:" "}),r.jsx(ce,{variant:"ghost",onClick:()=>L(!1),children:""})]})]})})]})};function uA(){const[n,t]=b.useState([]),[i,a]=b.useState({}),[o,u]=b.useState(!0),[d,f]=b.useState("all"),[h,p]=b.useState({status:"all",dateFrom:"",dateTo:""}),[y,v]=b.useState({totalCalls:0,successRate:0,totalCost:0,totalAudioSec:0,byApi:{}}),x=[{id:"all",label:""},{id:"voice",label:""},{id:"vision",label:""}];b.useEffect(()=>{_()},[h]);const w=b.useMemo(()=>n.filter(R=>{if(d==="all")return!0;if(d==="voice"){const J=R.model_name&&R.model_name.toLowerCase().includes("whisper"),H=R.endpoint&&R.endpoint.toLowerCase().includes("voice"),V=R.metadata&&R.metadata.audio_duration_sec!==void 0;return J||H||V}return d==="vision"?R.endpoint&&R.endpoint.toLowerCase().includes("analyze-image"):!0}),[n,d]);b.useEffect(()=>{S(w)},[w]);async function _(){u(!0);try{let R=Ee.from("api_usage_logs").select("*").order("created_at",{ascending:!1}).limit(500);h.status!=="all"&&(R=R.eq("status",h.status)),h.dateFrom&&(R=R.gte("created_at",h.dateFrom)),h.dateTo&&(R=R.lte("created_at",h.dateTo+"T23:59:59"));const{data:J,error:H}=await R;if(H)throw H;t(J||[]),C()}catch(R){console.error(":",R),alert("")}finally{u(!1)}}async function C(){try{const R=await Hs.fetchAllProfiles(),J={};Array.isArray(R)&&R.forEach(H=>{H.id&&(J[H.id]=H)}),a(J)}catch(R){console.error("Failed to fetch user profiles for logs",R)}}function S(R){const J=R.length,H=R.filter(M=>M.status==="success").length,V=R.reduce((M,z)=>M+(z.estimated_cost_jpy||0),0),k=R.filter(M=>M.metadata?.audio_duration_sec).reduce((M,z)=>M+(Number(z.metadata.audio_duration_sec)||0),0);v({totalCalls:J,successRate:J>0?(H/J*100).toFixed(1):0,totalCost:V.toFixed(2),totalAudioSec:k.toFixed(1),byApi:{}})}function N(R){return new Date(R).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function T(R){return{success:" ",error:" ",rate_limited:" "}[R]||R}async function L(){const R=[["","API","","","ID","","(ms)","/","()",""].join(",")];w.forEach(M=>{let z="";M.metadata?.audio_duration_sec?z=`${M.metadata.audio_duration_sec}s`:(M.input_tokens||M.output_tokens)&&(z=`${M.input_tokens} ${M.output_tokens}`),R.push([N(M.created_at),M.api_name,M.endpoint,M.model_name||"",M.user_id||"",M.status,M.duration_ms||"",z,M.estimated_cost_jpy||"",(M.error_message||"").replace(/,/g,"")].join(","))});const J=R.join(`
`),H=new Blob(["\uFEFF"+J],{type:"text/csv;charset=utf-8;"}),V=URL.createObjectURL(H),k=document.createElement("a");k.href=V,k.download=`api_usage_logs_${d}_${new Date().toISOString().split("T")[0]}.csv`,k.click()}return r.jsxs("div",{className:"api-usage-logs",children:[r.jsxs("div",{className:"logs-header",children:[r.jsx("h1",{children:" API"}),r.jsx("button",{onClick:L,className:"export-btn",children:" CSV"})]}),r.jsx("div",{className:"logs-tabs",children:x.map(R=>r.jsx("button",{className:`log-tab ${d===R.id?"active":""}`,onClick:()=>f(R.id),children:R.label},R.id))}),r.jsx("div",{className:"stats-grid",children:d==="voice"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.totalAudioSec,""]}),r.jsxs("div",{className:"secondary-stat",children:[(y.totalAudioSec/60).toFixed(1),""]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(y.totalCost).toLocaleString()]}),r.jsx("div",{className:"secondary-stat",children:"Whisper large-v3 turbo"})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.successRate,"%"]}),r.jsxs("div",{className:"secondary-stat",children:[y.totalCalls,""]})]})]}):d==="vision"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.totalCalls,""]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(y.totalCost).toLocaleString()]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.successRate,"%"]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsx("div",{className:"stat-value",children:y.totalCalls.toLocaleString()})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.successRate,"%"]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(y.totalCost).toLocaleString()]})]})]})}),r.jsxs("div",{className:"filters",children:[r.jsxs("select",{value:h.status,onChange:R=>p({...h,status:R.target.value}),children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"success",children:""}),r.jsx("option",{value:"error",children:""}),r.jsx("option",{value:"rate_limited",children:""})]}),r.jsx("input",{type:"date",value:h.dateFrom,onChange:R=>p({...h,dateFrom:R.target.value}),placeholder:""}),r.jsx("input",{type:"date",value:h.dateTo,onChange:R=>p({...h,dateTo:R.target.value}),placeholder:""}),r.jsx("button",{onClick:_,className:"refresh-btn",children:" "})]}),o?r.jsx("div",{className:"loading",children:"..."}):r.jsxs("div",{className:"logs-table-container",children:[r.jsxs("table",{className:"logs-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"API"}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:" (/)"}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:w.map(R=>r.jsxs("tr",{className:`status-${R.status}`,children:[r.jsx("td",{children:N(R.created_at)}),r.jsx("td",{children:r.jsx("span",{className:`api-badge api-${R.api_name}`,children:R.api_name})}),r.jsx("td",{children:R.endpoint}),r.jsx("td",{children:r.jsx("code",{children:R.model_name||"-"})}),r.jsx("td",{children:R.user_email||i[R.user_id]?.email||i[R.user_id]?.display_id||(R.user_id?R.user_id.substring(0,8):"-")}),r.jsx("td",{children:T(R.status)}),r.jsx("td",{children:R.duration_ms?`${R.duration_ms}ms`:"-"}),r.jsx("td",{children:R.metadata&&R.metadata.audio_duration_sec?r.jsxs("span",{className:"audio-sec",children:[" ",Number(R.metadata.audio_duration_sec).toFixed(2),"s"]}):R.input_tokens||R.output_tokens?r.jsxs("span",{className:"tokens",children:[R.input_tokens?`${R.input_tokens}`:"",R.output_tokens?` ${R.output_tokens}`:""]}):"-"}),r.jsx("td",{children:R.estimated_cost_jpy!=null&&R.estimated_cost_jpy!==""?r.jsxs("span",{className:"cost",children:["",Number(R.estimated_cost_jpy)]}):"-"}),r.jsx("td",{className:"error-cell",children:R.error_message?r.jsxs("span",{className:"error-msg",title:R.error_message,children:[R.error_message.substring(0,50),"..."]}):"-"})]},R.id))})]}),w.length===0&&r.jsx("div",{className:"no-logs",children:""})]})]})}const dl=async(n,t,i)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${i||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},mp=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},dA=({children:n})=>{const[t,i]=b.useState(null),[a,o]=b.useState(!0),[u,d]=b.useState(!1),f=b.useCallback(async S=>{if(!S){i(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const N=S.id,T=S.email||"";let L=null;try{const $=localStorage.getItem("auth_user_cache");if($){const P=JSON.parse($);P&&P.id===N&&(L=P,i(P))}}catch($){console.warn("[Auth] Failed to load cache",$)}let R=null;const J=4e3,H=2,V=async()=>{let $=0;for(;$<H;)try{const[P,E]=await Promise.all([dl(Ee.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",N).single().then(Q=>({data:Q,error:null})).catch(Q=>({data:null,error:Q})),J,"profiles.select(with_email)").catch(Q=>({data:null,error:Q})),dl(Ee.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",N).single().then(Q=>({data:Q,error:null})).catch(Q=>({data:null,error:Q})),J,"profiles.select").catch(Q=>({data:null,error:Q}))]);let B=null,q=null;if(P?.data?.data?B=P.data.data:E?.data?.data?B=E.data.data:q=P?.error??E?.error??new Error("Profile fetch failed"),q)if(q.code==="PGRST116"){const Q=S.user_metadata?.display_id?String(S.user_metadata.display_id):mp(T)||N.slice(0,8);let G=null,A=null;const O=await dl(Ee.from("profiles").insert([{id:N,display_id:Q,email:T||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),6e3,"profiles.insert(with_email)");if(G=O?.data??null,A=O?.error??null,A&&String(A.message||"").toLowerCase().includes("email")){const K=await dl(Ee.from("profiles").insert([{id:N,display_id:Q,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),6e3,"profiles.insert");G=K?.data??null,A=K?.error??null}if(A)throw A;R=G}else throw q;else R=B;if(R&&Object.prototype.hasOwnProperty.call(R,"email")&&T&&!R.email)try{await Ee.from("profiles").update({email:T}).eq("id",N)}catch(Q){console.warn("Failed to backfill profile email",Q)}break}catch(P){console.error(`Failed to load/create profile (Attempt ${$+1}/${H}):`,P),$++,$<H&&await new Promise(E=>setTimeout(E,300*$))}return R};if(L){V().then($=>{if($){const P=(S?.user_metadata?.display_id||"").toString().trim(),E=$.display_id||P||L.displayId||mp(T)||N.slice(0,8),B=String($.role||"user").trim().toLowerCase(),q=$.show_master_recipes===!0;i({id:N,email:T,displayId:E,role:B,showMasterRecipes:q});try{localStorage.setItem("auth_user_cache",JSON.stringify({id:N,email:T,displayId:E,role:B,showMasterRecipes:q}))}catch(Q){console.warn("[Auth] Failed to save cache",Q)}}}).catch(()=>{});return}R=await V();const k=(S?.user_metadata?.display_id||"").toString().trim(),M=R?.display_id||k||""||L?.displayId||""||mp(T)||N.slice(0,8),z=R?.role||S?.app_metadata?.role||L?.role||"user",U=String(z).trim().toLowerCase(),F=R?.show_master_recipes===!0||R?.show_master_recipes==null&&L?.showMasterRecipes===!0,Y={id:N,email:T,displayId:M,role:U,showMasterRecipes:F};i(Y);try{localStorage.setItem("auth_user_cache",JSON.stringify(Y))}catch($){console.warn("[Auth] Failed to save cache",$)}},[]);b.useEffect(()=>{let S=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:N}=Ee.auth.onAuthStateChange(async(L,R)=>{L==="PASSWORD_RECOVERY"&&d(!0);try{await f(R?.user||null)}catch(J){console.error("Auth state change handler failed:",J)}});return S=N?.subscription,(async()=>{try{const{data:L}=await dl(Ee.auth.getSession(),5e3,"auth.getSession");await f(L?.session?.user||null)}catch(L){console.error("Auth init failed:",L)}finally{o(!1)}})(),()=>{try{S?.unsubscribe?.()}catch{}}},[f]);const h=b.useCallback(async(S,N)=>{const{error:T}=await Ee.auth.signInWithPassword({email:S,password:N});if(T)throw console.error("Login error:",T),new Error("")},[]),p=b.useCallback(async(S,N,T)=>{const{data:L,error:R}=await Ee.auth.signUp({email:S,password:N,options:{data:{display_id:T},emailRedirectTo:window.location.origin+"/app/"}});if(R)throw console.error("SignUp error:",R),new Error(R.message||"");const J=L?.user;if(J?.id){let H=null;H=(await Ee.from("profiles").insert([{id:J.id,display_id:T,email:S||null,role:"user",show_master_recipes:!1}]))?.error??null,H&&String(H.message||"").toLowerCase().includes("email")&&(H=(await Ee.from("profiles").insert([{id:J.id,display_id:T,role:"user",show_master_recipes:!1}]))?.error??null),H&&H.code!=="23505"&&console.error("Profile create error:",H)}return{needsEmailConfirmation:!L?.session}},[]),y=b.useCallback(async()=>{i(null),d(!1);try{localStorage.removeItem("auth_user_cache")}catch{}try{const{error:S}=await dl(Ee.auth.signOut({scope:"local"}),3e3,"auth.signOut(local)");S&&console.warn("Logout (local scope) returned error:",S)}catch(S){console.warn("Logout (local scope) failed/timed out:",S)}},[]),v=b.useCallback(S=>{!S||typeof S!="object"||i(N=>N&&{...N,...S})},[]),x=b.useCallback(async S=>{const{error:N}=await Ee.auth.resetPasswordForEmail(S,{redirectTo:window.location.origin+"/app/"});if(N)throw console.error("Password reset email error:",N),new Error("");return!0},[]),w=b.useCallback(async S=>{const{error:N}=await Ee.auth.updateUser({password:S});if(N)throw console.error("Update password error:",N),new Error("");return!0},[]),_=b.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),C=b.useMemo(()=>({user:t,loading:a,login:h,register:p,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:w,finishPasswordRecovery:_}),[t,a,h,p,y,v,x,u,w,_]);return r.jsx(Hb.Provider,{value:C,children:n})},hA=({id:n,message:t,type:i="info",onClose:a})=>{b.useEffect(()=>{const u=setTimeout(()=>{a(n)},3e3);return()=>clearTimeout(u)},[n,a]);const o=()=>{switch(i){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return r.jsxs("div",{className:`toast toast-${i}`,children:[r.jsx("div",{className:"toast-icon",children:o()}),r.jsx("div",{className:"toast-message",children:t}),r.jsx("button",{className:"toast-close",onClick:()=>a(n),"aria-label":"",children:""})]})},fA=({toasts:n,onRemove:t})=>n.length===0?null:r.jsx("div",{className:"toast-container",children:n.map(i=>r.jsx(hA,{id:i.id,message:i.message,type:i.type,onClose:t},i.id))}),pA=({children:n})=>{const[t,i]=b.useState([]),a=b.useCallback((d,f="info")=>{const h=Date.now()+Math.random();i(p=>[...p,{id:h,message:d,type:f}].slice(-5))},[]),o=b.useCallback(d=>{i(f=>f.filter(h=>h.id!==d))},[]),u={showToast:a,success:d=>a(d,"success"),error:d=>a(d,"error"),warning:d=>a(d,"warning"),info:d=>a(d,"info")};return r.jsxs(Vb.Provider,{value:u,children:[n,r.jsx(fA,{toasts:t,onRemove:o})]})},mA=()=>{const[n,t]=b.useState(!0),[i,a]=b.useState(!1),[o,u]=b.useState(""),[d,f]=b.useState(""),[h,p]=b.useState(""),[y,v]=b.useState(""),[x,w]=b.useState(""),[_,C]=b.useState(!1),[S,N]=b.useState(!1);_e.useEffect(()=>{const k=localStorage.getItem("savedEmail"),M=localStorage.getItem("savedPassword");k&&(u(k),M&&f(M),N(!0))},[]);const{login:T,register:L,sendPasswordResetEmail:R}=fs(),J=async k=>{k.preventDefault(),v(""),w(""),C(!0);try{await T(o.trim(),d),S?(localStorage.setItem("savedEmail",o.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(M){v(M.message||"")}finally{C(!1)}},H=async k=>{k.preventDefault(),v(""),w(""),C(!0);try{if(!h.trim()){v("ID: yoshito");return}(await L(o.trim(),d,h.trim()))?.needsEmailConfirmation?w(""):w(""),t(!0),f("")}catch(M){v(M.message||"")}finally{C(!1)}},V=async k=>{k.preventDefault(),v(""),w(""),C(!0);try{await R(o.trim()),w(""),a(!1)}catch(M){v(M.message||"")}finally{C(!1)}};return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:r.jsxs(hn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[r.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[r.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",r.jsx("br",{}),"Management"]}),r.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:i?"":n?"":""})]}),y&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),r.jsxs("form",{onSubmit:i?V:n?J:H,children:[r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"email",value:o,onChange:k=>u(k.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!i&&r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:d,onChange:k=>f(k.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!i&&!n&&r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",r.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),r.jsx("input",{type:"text",value:h,onChange:k=>p(k.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!i&&r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[r.jsx("input",{type:"checkbox",id:"rememberMe",checked:S,onChange:k=>N(k.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),r.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),r.jsx(ce,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:_,children:i?"":n?"":""})]}),r.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i?r.jsx("button",{type:"button",onClick:()=>{a(!1),v(""),w("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):r.jsx("button",{type:"button",onClick:()=>{a(!0),v(""),w("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!i&&r.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),w("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},gA=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:i}=fs(),[a,o]=_e.useState(""),[u,d]=_e.useState(""),[f,h]=_e.useState(""),[p,y]=_e.useState(""),[v,x]=_e.useState(!1),w=async _=>{if(_.preventDefault(),h(""),y(""),!a||a.length<8){h("8");return}if(a!==u){h("");return}x(!0);try{await n(a),y(""),t()}catch(C){console.error(C),h(C.message||"")}finally{x(!1)}};return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:r.jsxs(hn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[r.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),r.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),f&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:f}),p&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:p}),r.jsxs("form",{onSubmit:w,children:[r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:a,onChange:_=>o(_.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:u,onChange:_=>d(_.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),r.jsx(ce,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),r.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),r.jsx(ce,{variant:"ghost",onClick:i,style:{flex:1},children:""})]})]})})},gp=({label:n,subLabel:t,variant:i="screen",showLogo:a=!0})=>r.jsxs("div",{className:i==="screen"?"loading-screen":"loading-inline",children:[a&&r.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),r.jsxs("div",{className:"loading-text",children:[n,r.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[r.jsx("span",{children:"."}),r.jsx("span",{children:"."}),r.jsx("span",{children:"."})]})]}),r.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&r.jsx("div",{className:"loading-subtext",children:t})]}),yA=24,vA=120,xA=64,bA=180,$u="__NO_STORE__",Pu="__OTHER_STORE__",wA=(n,t)=>{const i=new Set((n||[]).map(o=>String(o.id))),a=[...n||[]];for(const o of t||[]){const u=String(o.id);i.has(u)||(i.add(u),a.push(o))}return a},$p=n=>(n||"").toString().replace(/\s+/g," ").trim(),Or=n=>$p(n).toLowerCase(),k0=new Set(ad.map(n=>Or(n)).filter(Boolean));function SA(){const{user:n,logout:t,loading:i,isPasswordRecovery:a}=fs(),o=ws(),[u,d]=oc(),[f,h]=b.useState([]),[p,y]=b.useState(!0),[v,x]=b.useState(0),[w,_]=b.useState([]),[C,S]=b.useState(!1),[N,T]=b.useState({}),[L,R]=b.useState({}),[J,H]=b.useState(!1),V=b.useRef(0),k=u.get("view"),M=(k==="create-mock"?"create":k)||"list",z=u.get("id"),U=f.find(le=>String(le.id)===z)||null,[F,Y]=b.useState(null),[$,P]=b.useState(!1),[E,B]=b.useState(""),[q,Q]=b.useState(null),[G,A]=b.useState(null),[O,K]=b.useState(""),[de,pe]=b.useState("none"),[ve,te]=b.useState(!1),[W,me]=b.useState(!1),[ke,ie]=b.useState(new Set),[je,Re]=b.useState("normal"),[Oe,qe]=b.useState(!1),[et,at]=b.useState(!1),[lt,pt]=b.useState(null),[we,ae]=b.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),Ge={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};b.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const le=window.matchMedia("(max-width: 700px)"),$e=()=>ae(!!le.matches);return $e(),le.addEventListener?le.addEventListener("change",$e):le.addListener($e),()=>{le.removeEventListener?le.removeEventListener("change",$e):le.removeListener($e)}},[]),b.useEffect(()=>{if(!we||!Ge[M]||typeof window>"u")return;const le=`pc-recommend-shown:${M}`;try{if(window.sessionStorage.getItem(le)==="1")return;window.sessionStorage.setItem(le,"1")}catch{}pt(M)},[M,we]),b.useEffect(()=>{M!=="list"&&pe("none")},[M]),b.useEffect(()=>{if(typeof document>"u"||!ve)return;const le=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=le}},[ve]),b.useEffect(()=>{if(!i){S(!1);return}const le=setTimeout(()=>S(!0),3500);return()=>clearTimeout(le)},[i]),b.useEffect(()=>{if(f.length>0||M==="trash")return;let le=n?.id;if(!le)try{le=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!le)return;const $e=Sn.getCachedRecipes(le);$e&&$e.length>0&&(h($e),H(!0),y(!1))},[n?.id]),b.useEffect(()=>{i||n&&(tt(),Ve())},[i,n?.id]),b.useEffect(()=>{if(i)return;if(!n||n.role!=="admin"){T({}),R({});return}let le=!1;return(async()=>{try{const $e=await Hs.fetchAllProfiles();if(le)return;const ze={},At={};for(const Tt of $e||[])Tt?.id&&(ze[String(Tt.id)]=Tt),Tt?.display_id&&(At[String(Tt.display_id)]=Tt);T(ze),R(At)}catch($e){console.warn("Failed to load profiles for admin owner labels",$e)}})(),()=>{le=!0}},[i,n?.id,n?.role]);const Ne=le=>{const ze=(le?.tags||[]).find(Et=>Et&&Et.startsWith("owner:"));if(!ze)return"/";const At=String(ze.slice(6)),Tt=N[At]||L[At]||null;return Tt?Tt.display_id||Tt.email||At:At.length>12?`${At.slice(0,8)}`:At},dt=xa(hr(Al,{activationConstraint:{distance:10}}),hr(Rl,{activationConstraint:{delay:1e3,tolerance:5}}),hr(Tl,{coordinateGetter:Sd})),rt=le=>{const{active:$e,over:ze}=le;$e.id!==ze.id&&h(At=>{const Tt=At.findIndex(ue=>ue.id===$e.id),Et=At.findIndex(ue=>ue.id===ze.id);if(Tt===-1||Et===-1)return At;const oe=Ui(At,Tt,Et),ne=oe.map((ue,xe)=>({id:ue.id,order_index:xe}));return Sn.updateOrder(ne).catch(ue=>console.error("Order update failed",ue)),oe})},Ve=async()=>{try{const le=await Sn.fetchRecentRecipes();_(le||[])}catch(le){console.error("Failed to load history:",le)}},ot=async le=>{const $e=[le,...w.filter(ze=>ze!==le)].slice(0,20);_($e);try{await Sn.addToHistory(le)}catch(ze){console.error("Failed to sync history",ze)}},tt=async()=>{try{const le=await Sn.getDeletedCount();x(le||0)}catch(le){console.error("Failed to load trash count:",le)}},St=async()=>{if(!n)return;const le=V.current+1;V.current=le;const $e=()=>V.current!==le,ze=we?yA:vA,At=we?xA:bA;try{J||y(!0);const Tt=await Sn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:0,limit:ze,skipCacheSave:!0,returnMeta:!0});if($e())return;let Et=Tt?.recipes||[],oe=Tt?.hasMoreRaw===!0,ne=ze;h(Et);let ue=!1;for(!J&&(Et.length>0||!oe)&&(y(!1),ue=!0);oe;){const xe=await Sn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:ne,limit:At,skipCacheSave:!0,returnMeta:!0});if($e())return;const Pe=xe?.recipes||[];if(Pe.length>0&&(Et=wA(Et,Pe),h(Et),!J&&!ue&&(y(!1),ue=!0)),ne+=At,oe=xe?.hasMoreRaw===!0,Pe.length===0&&!oe)break}if($e())return;Sn.saveCachedRecipes(Et,n.id)}catch(Tt){if($e())return;console.error("Failed to fetch recipes:",Tt),o.error(`

(${Tt?.message||"unknown error"})`)}finally{$e()||(y(!1),H(!1))}},{allCourses:gn,allCategories:Ct,storeCounts:zt,noStoreCount:Ft,otherStoreCount:rn,courseCounts:ln,categoryCounts:sn}=b.useMemo(()=>{const le=[...new Set(f.map(ne=>$p(ne.course)).filter(Boolean))],$e=[...new Set(f.map(ne=>$p(ne.category)).filter(Boolean))],ze=f.reduce((ne,ue)=>{const xe=Or(ue.storeName);return xe&&(ne[xe]=(ne[xe]||0)+1),ne},{}),At=f.reduce((ne,ue)=>Or(ue.storeName)?ne:ne+1,0),Tt=f.reduce((ne,ue)=>{const xe=Or(ue.storeName);return xe?k0.has(xe)?ne:ne+1:ne},0),Et=f.reduce((ne,ue)=>{const xe=Or(ue.course);return xe&&(ne[xe]=(ne[xe]||0)+1),ne},{}),oe=f.reduce((ne,ue)=>{const xe=Or(ue.category);return xe&&(ne[xe]=(ne[xe]||0)+1),ne},{});return{allCourses:le,allCategories:$e,storeCounts:ze,noStoreCount:At,otherStoreCount:Tt,courseCounts:Et,categoryCounts:oe}},[f]),zn=b.useMemo(()=>{const le=Or(E),$e=O.toLowerCase().trim();return f.filter(ze=>{const At=Or(ze.storeName);return E===""||E==="recent"&&w.includes(ze.id)||ze.tags&&ze.tags.includes(E)||E===$u&&!At||E===Pu&&At&&!k0.has(At)||ze.category&&Or(ze.category)===le||ze.course&&Or(ze.course)===le||ze.storeName&&At===le?$e?(ze.title||"").toLowerCase().includes($e)||ze.description&&ze.description.toLowerCase().includes($e)||Array.isArray(ze.ingredients)&&ze.ingredients.some(Et=>(Et?.name||"").toLowerCase().includes($e)):!0:!1})},[f,E,w,O]),Xt=E===""&&!O.trim()&&M==="list",ee=(le,$e={})=>{d({view:"detail",id:le.id,...$e})},De=async(le,$e=!1)=>{try{if(le.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&le.tags.some(At=>At==="owner:yoshito")){o.warning("");return}$e?(await Sn.restoreRecipe(le.id),(M==="trash"||M==="detail")&&(d({view:"trash"}),Ie()),o.success("")):(await Sn.deleteRecipe(le.id),h(f.filter(ze=>ze.id!==le.id)),d({view:"list"}),tt())}catch(ze){console.error("Failed to delete/restore recipe:",ze),o.error("")}finally{tt()}},Te=async le=>{try{await Sn.hardDeleteRecipe(le.id),h(f.filter($e=>$e.id!==le.id)),d({view:"trash"}),o.success(""),Ie(),tt()}catch($e){console.error("Failed to hard delete recipe:",$e),o.error("")}},Ie=async()=>{try{V.current+=1,y(!0);const le=await Sn.fetchDeletedRecipes();h(le||[]),B("")}catch(le){console.error("Failed to fetch deleted recipes:",le)}finally{y(!1)}},Fe=()=>{d({view:"trash"})},it=()=>{d({view:"list"})},wt=async()=>{te(!1);try{await t()}catch(le){console.error("Logout failed:",le),o.warning("")}},Pt=async(le,$e)=>{try{let ze,At=$e;if($e&&n.role!=="admin"){const Tt=le.tags?.find(oe=>oe.startsWith("owner:"));Tt===`owner:${n.id}`||n.displayId&&Tt===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${Tt||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),At=!1)}At?(ze=await Sn.updateRecipe(le,n),h(f.map(Tt=>Tt.id===ze.id?ze:Tt))):(ze=await Sn.createRecipe(le,n),h([ze,...f])),d(At?{view:"detail",id:ze.id}:{view:"detail",id:ze.id})}catch(ze){console.error("Failed to save recipe:",ze),o.error(`
: ${ze.message||ze.error_description||JSON.stringify(ze)}`)}};b.useEffect(()=>{let le=!1;return(async()=>{if(M!=="edit"||!z){Y(null),P(!1);return}P(!0);try{const ze=await Sn.getRecipe(z);if(le)return;Y(ze)}catch(ze){if(console.error("Failed to load edit recipe details",ze),le)return;Y(U),o.warning("")}finally{le||P(!1)}})(),()=>{le=!0}},[M,z]);const Vt=(le,$e="")=>{try{le.__importId=globalThis.crypto&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}_${Math.random().toString(16).slice(2)}`}catch{le.__importId=`${Date.now()}_${Math.random().toString(16).slice(2)}`}const ze=["","baker","","","","dough","fermentation"],At=le.title||le.name||"",Tt=ze.some(Je=>At.toLowerCase().includes(Je)),Et=["flour","","","","","","","","",""],oe=["yeast","","",""],ne=le.ingredients||[],ue=ne.some(Je=>oe.some(Xe=>(Je.name||"").toLowerCase().includes(Xe))),xe=ne.some(Je=>Et.some(Xe=>(Je.name||"").toLowerCase().includes(Xe))&&!Je.name.includes(""));if(ne.some(Je=>Je.quantity&&String(Je.quantity).includes("%")||Je.unit&&String(Je.unit).includes("%"))||ue||Tt&&xe){le.type="bread",le.flours=[],le.breadIngredients=[];const Je=["flour","","","","","","","",""];if(ne.forEach(Xe=>{Je.some(jt=>(Xe.name||"").includes(jt))?le.flours.push(Xe):le.breadIngredients.push(Xe)}),le.flours.length===0&&ne.length>0){const Xe=ne[0];(Xe.name||"").includes("")&&(le.flours.push(Xe),le.breadIngredients=le.breadIngredients.filter(Ye=>Ye!==Xe))}}le.sourceUrl=$e,$e&&(le.category="URL"),A(le),d({view:"create"})},on=()=>{me(!W),ie(new Set)},he=le=>{const $e=new Set(ke);$e.has(le)?$e.delete(le):$e.add(le),ie($e)},Ke=()=>{qe(!0)},mt=()=>{qe(!1)},ct=async()=>{qe(!1);try{y(!0),M==="trash"?(await Promise.all(Array.from(ke).map(le=>Sn.hardDeleteRecipe(le))),Ie()):(await Promise.all(Array.from(ke).map(le=>Sn.deleteRecipe(le))),h(f.filter(le=>!ke.has(le.id))),tt()),ie(new Set),me(!1),o.success("")}catch(le){console.error("Bulk delete failed",le),o.warning(""),M==="trash"?Ie():St()}finally{y(!1)}},Lt=()=>{ke.size!==0&&at(!0)},ut=()=>{at(!1)},Mt=async()=>{at(!1);try{y(!0);for(const le of ke)await Sn.restoreRecipe(le);h(f.filter(le=>!ke.has(le.id))),tt(),me(!1),ie(new Set),o.success(""),Ie()}catch(le){console.error("Bulk restore failed",le),o.warning(""),Ie()}finally{y(!1)}},tn=()=>{const le=zn.map($e=>$e.id);ie(new Set(le))},ht=le=>{h([le,...f]),d({view:"edit",id:le.id})};if(b.useEffect(()=>{i||n&&(M==="trash"?Ie():M==="list"&&St())},[M,i,n?.id]),i&&!C){let le=!1;try{const $e=JSON.parse(localStorage.getItem("auth_user_cache")||"null");$e?.id&&(le=!!Sn.getCachedRecipes($e.id))}catch{}if(!le)return r.jsx(gp,{label:"",subLabel:""})}return n?a?r.jsx(gA,{}):r.jsxs(L_,{children:[Oe&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(hn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," ",ke.size,"",M==="trash"?"":""]}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:M==="trash"?"":""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:mt,children:""}),r.jsx(ce,{variant:"danger",onClick:ct,children:M==="trash"?"":""})]})]})}),et&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(hn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," ",ke.size,""]}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:ut,children:""}),r.jsx(ce,{variant:"secondary",onClick:Mt,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),r.jsx(bn,{isOpen:!!lt,onClose:()=>pt(null),title:"PC",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[r.jsx("p",{style:{marginTop:0},children:Ge[lt]?r.jsxs(r.Fragment,{children:["",r.jsx("strong",{children:Ge[lt]}),"/"]}):r.jsx(r.Fragment,{children:"/"})}),r.jsxs("p",{style:{marginBottom:0},children:["",r.jsx("strong",{children:"PC"}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>{pt(null),d({view:"list"})},children:""}),r.jsx(ce,{variant:"primary",onClick:()=>pt(null),children:"OK"})]})]})}),(M==="list"||M==="trash")&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"container-header",children:[r.jsxs("h2",{className:"section-title",children:[M==="trash"?" ()":"",M==="list"&&r.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",f.length,")"]})]}),r.jsx("div",{className:"header-actions",children:M==="list"||M==="trash"?r.jsxs(r.Fragment,{children:[W?r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"ghost",onClick:on,children:""}),r.jsx(ce,{variant:"secondary",onClick:tn,children:""}),M==="trash"&&r.jsxs(ce,{variant:"secondary",onClick:Lt,disabled:ke.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",ke.size,")"]}),r.jsxs(ce,{variant:"danger",onClick:Ke,disabled:ke.size===0,children:[M==="trash"?"":""," (",ke.size,")"]})]}):r.jsx(r.Fragment,{children:M==="list"?r.jsx(r.Fragment,{children:r.jsx(ce,{onClick:()=>{A(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):r.jsx(ce,{variant:"ghost",onClick:it,children:" "})}),r.jsx("button",{className:"mobile-menu-toggle",onClick:()=>te(!ve),"aria-label":"",children:""}),r.jsxs("div",{className:`secondary-actions ${ve?"open":""}`,children:[r.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>te(!1),"aria-label":"",children:""}),r.jsxs("div",{className:"secondary-actions-content",children:[r.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[r.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&r.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&r.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),M==="list"&&r.jsxs(r.Fragment,{children:[r.jsxs(ce,{variant:"secondary",onClick:()=>{Q("url"),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{Q("image"),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsx("div",{className:"pc-recommend-note",children:r.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),r.jsxs(ce,{variant:"secondary",onClick:()=>{d({view:"inventory"}),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{d({view:"incoming-deliveries"}),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{d({view:"incoming-stock"}),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{d({view:"planner"}),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{d({view:"order-list"}),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsxs(ce,{variant:"secondary",onClick:()=>{d({view:"data"}),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsxs(ce,{variant:"secondary",onClick:()=>{d({view:"users"}),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{d({view:"api-logs"}),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," API"]})]}),r.jsx("div",{className:"menu-divider"})]}),!W&&r.jsxs(ce,{variant:"ghost",onClick:()=>{on(),te(!1)},className:"danger-text",children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," ",M==="trash"?"":""]}),M==="list"&&r.jsxs(ce,{variant:"ghost",onClick:()=>{Fe(),te(!1)},style:{position:"relative"},children:[r.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&r.jsx("span",{className:"trash-badge",children:v})]}),r.jsxs(ce,{variant:"ghost",onClick:()=>{it(),te(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsxs(ce,{variant:"ghost",onClick:wt,children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]})]}),r.jsx("div",{className:`menu-backdrop ${ve?"open":""}`,onClick:()=>te(!1),"aria-hidden":"true"})]}):null})]}),M==="list"&&r.jsxs("div",{className:"list-toolbar",children:[r.jsxs("div",{className:"search-container search-container--compact",children:[r.jsx("span",{className:"search-icon",children:""}),r.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:O,onChange:le=>K(le.target.value)})]}),r.jsxs("div",{className:"public-recipe-toggles",children:[r.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${de==="mine"?"active":""}`,"aria-pressed":de==="mine",onClick:()=>pe("mine"),children:" "}),r.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${de==="others"?"active":""}`,"aria-pressed":de==="others",onClick:()=>pe("others"),children:" "}),de!=="none"&&r.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>pe("none"),children:" "})]})]}),r.jsxs("div",{className:"tag-filter-container",children:[r.jsxs("select",{className:"store-filter-select",value:E===$u?$u:E===Pu?Pu:ad.includes(E)?E:"",onChange:le=>B(le.target.value||""),children:[r.jsx("option",{value:"",children:""}),ad.map(le=>r.jsxs("option",{value:le,children:[le," (",zt[Or(le)]||0,")"]},le)),r.jsxs("option",{value:$u,children:[" (",Ft,")"]}),r.jsxs("option",{value:Pu,children:[" (",rn,")"]})]}),r.jsxs("select",{className:"store-filter-select",value:gn.includes(E)?E:"",onChange:le=>B(le.target.value||""),children:[r.jsx("option",{value:"",children:""}),gn.sort().map(le=>r.jsxs("option",{value:le,children:[le," (",ln[Or(le)]||0,")"]},le))]}),r.jsxs("select",{className:"store-filter-select",value:Ct.includes(E)?E:"",onChange:le=>B(le.target.value||""),children:[r.jsx("option",{value:"",children:""}),Ct.sort().map(le=>r.jsxs("option",{value:le,children:[le," (",sn[Or(le)]||0,")"]},le))]}),r.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[r.jsx("button",{className:`tag-filter-btn ${je==="normal"?"active":""}`,onClick:()=>Re("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),r.jsx("button",{className:`tag-filter-btn ${je==="all"?"active":""}`,onClick:()=>Re("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),p?r.jsx(gp,{label:J?"":"",subLabel:J?void 0:"",variant:"inline",showLogo:!1}):f.length===0?r.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[M==="trash"?"":"",E!==""&&r.jsx("p",{children:""})]}):r.jsxs("div",{className:"main-content-wrapper",children:[M==="list"&&r.jsx("div",{className:"recent-list-wrapper",children:r.jsx(dT,{recipes:f,recentIds:w,onSelect:ee})}),r.jsx("div",{className:"recipe-list-container",children:M==="list"?r.jsx(Mi,{sensors:dt,collisionDetection:ed,onDragEnd:rt,children:r.jsx(gx,{recipes:zn,onSelectRecipe:ee,isSelectMode:W,selectedIds:ke,onToggleSelection:he,disableDrag:!Xt,displayMode:je,publicRecipeView:de,showOwner:n?.role==="admin",ownerLabelFn:Ne,currentUser:n})}):r.jsx(gx,{recipes:zn,onSelectRecipe:ee,isSelectMode:W,selectedIds:ke,onToggleSelection:he,disableDrag:!0,displayMode:je,publicRecipeView:de,showOwner:n?.role==="admin",ownerLabelFn:Ne,currentUser:n})})]})]}),M==="detail"&&U&&r.jsx(_k,{recipe:U,ownerLabel:n?.role==="admin"?Ne(U):void 0,isDeleted:!!U.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):U.deletedAt?Fe():it()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?it:void 0,onEdit:()=>d({view:"edit",id:U.id,from:u.get("from")}),onDelete:De,onView:ot,onHardDelete:Te,onDuplicate:ht}),M==="edit"&&z&&($?r.jsx(gp,{label:"",subLabel:"URL"}):F&&r.jsx(p0,{initialData:F,onCancel:()=>d({view:"detail",id:z}),onSave:le=>Pt(le,!0)},`edit-${z}`)),M==="create"&&r.jsx(p0,{initialData:G,onCancel:()=>{d({view:"list"}),A(null)},onSave:le=>Pt(le,!1)},G?.__importId?`create-form-imported-${G.__importId}`:"create-form"),q&&r.jsx(rw,{initialMode:q,onClose:()=>Q(null),onImport:Vt}),(M==="data"||M==="data-management")&&r.jsx(uT,{onBack:()=>d({view:"list"})}),M==="levain-guide"&&r.jsx(hT,{onBack:()=>d({view:"list"})}),M==="users"&&n?.role==="admin"&&r.jsx(fT,{onBack:()=>d({view:"list"})}),M==="inventory"&&r.jsx(vT,{onBack:()=>d({view:"list"})}),M==="incoming-deliveries"&&r.jsx(RT,{onBack:()=>d({view:"list"})}),M==="incoming-stock"&&r.jsx(sA,{onBack:()=>d({view:"list"})}),M==="planner"&&r.jsx(oA,{onBack:()=>d({view:"list"}),onSelectRecipe:le=>ee(le,{from:"planner"}),onNavigateToOrderList:()=>d({view:"order-list"})}),M==="order-list"&&r.jsx(cA,{onBack:()=>d({view:"list"}),onNavigateToPlanner:()=>d({view:"planner"})}),M==="api-logs"&&n?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{padding:"20px 20px 0",textAlign:"left"},children:r.jsx(ce,{onClick:()=>d({view:"list"}),children:" "})}),r.jsx(uA,{}),r.jsx("div",{style:{padding:"20px",textAlign:"center"},children:r.jsx(ce,{onClick:()=>d({view:"list"}),children:" "})})]})]}):r.jsx(mA,{})}function jA(){return r.jsx(pA,{children:r.jsx(dA,{children:r.jsx(SA,{})})})}class _A extends _e.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,i){console.error("Uncaught error:",t,i),this.setState({error:t,errorInfo:i})}render(){return this.state.hasError?r.jsxs("div",{style:{padding:"2rem",color:"red"},children:[r.jsx("h1",{children:""}),r.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),r.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),r.jsx("br",{}),r.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}sj.createRoot(document.getElementById("root")).render(r.jsx(b.StrictMode,{children:r.jsx(_A,{children:r.jsx(C_,{children:r.jsx(jA,{})})})}));export{T0 as a,CA as c,NA as g};
