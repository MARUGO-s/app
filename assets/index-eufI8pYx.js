(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(o){if(o.ep)return;o.ep=!0;const u=i(o);fetch(o.href,u)}})();var wT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function e0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function ST(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var i=function a(){var o=!1;try{o=this instanceof a}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(a){var o=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(i,a,o.get?o:{enumerable:!0,get:function(){return n[a]}})}),i}var rf={exports:{}},fo={};var hv;function wS(){if(hv)return fo;hv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(a,o,u){var d=null;if(u!==void 0&&(d=""+u),o.key!==void 0&&(d=""+o.key),"key"in o){u={};for(var f in o)f!=="key"&&(u[f]=o[f])}else u=o;return o=u.ref,{$$typeof:n,type:a,key:d,ref:o!==void 0?o:null,props:u}}return fo.Fragment=t,fo.jsx=i,fo.jsxs=i,fo}var fv;function SS(){return fv||(fv=1,rf.exports=wS()),rf.exports}var s=SS(),sf={exports:{}},Ut={};var pv;function jS(){if(pv)return Ut;pv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function b($){return $===null||typeof $!="object"?null:($=x&&$[x]||$["@@iterator"],typeof $=="function"?$:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,j={};function k($,Q,X){this.props=$,this.context=Q,this.refs=j,this.updater=X||_}k.prototype.isReactComponent={},k.prototype.setState=function($,Q){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,Q,"setState")},k.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function E(){}E.prototype=k.prototype;function D($,Q,X){this.props=$,this.context=Q,this.refs=j,this.updater=X||_}var U=D.prototype=new E;U.constructor=D,C(U,k.prototype),U.isPureReactComponent=!0;var B=Array.isArray;function T(){}var N={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function L($,Q,X){var fe=X.ref;return{$$typeof:n,type:$,key:Q,ref:fe!==void 0?fe:null,props:X}}function Y($,Q){return L($.type,Q,$.props)}function q($){return typeof $=="object"&&$!==null&&$.$$typeof===n}function V($){var Q={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(X){return Q[X]})}var F=/\/+/g;function I($,Q){return typeof $=="object"&&$!==null&&$.key!=null?V(""+$.key):Q.toString(36)}function P($){switch($.status){case"fulfilled":return $.value;case"rejected":throw $.reason;default:switch(typeof $.status=="string"?$.then(T,T):($.status="pending",$.then(function(Q){$.status==="pending"&&($.status="fulfilled",$.value=Q)},function(Q){$.status==="pending"&&($.status="rejected",$.reason=Q)})),$.status){case"fulfilled":return $.value;case"rejected":throw $.reason}}throw $}function R($,Q,X,fe,ke){var Ue=typeof $;(Ue==="undefined"||Ue==="boolean")&&($=null);var de=!1;if($===null)de=!0;else switch(Ue){case"bigint":case"string":case"number":de=!0;break;case"object":switch($.$$typeof){case n:case t:de=!0;break;case y:return de=$._init,R(de($._payload),Q,X,fe,ke)}}if(de)return ke=ke($),de=fe===""?"."+I($,0):fe,B(ke)?(X="",de!=null&&(X=de.replace(F,"$&/")+"/"),R(ke,Q,X,"",function(oe){return oe})):ke!=null&&(q(ke)&&(ke=Y(ke,X+(ke.key==null||$&&$.key===ke.key?"":(""+ke.key).replace(F,"$&/")+"/")+de)),Q.push(ke)),1;de=0;var H=fe===""?".":fe+":";if(B($))for(var G=0;G<$.length;G++)fe=$[G],Ue=H+I(fe,G),de+=R(fe,Q,X,Ue,ke);else if(G=b($),typeof G=="function")for($=G.call($),G=0;!(fe=$.next()).done;)fe=fe.value,Ue=H+I(fe,G++),de+=R(fe,Q,X,Ue,ke);else if(Ue==="object"){if(typeof $.then=="function")return R(P($),Q,X,fe,ke);throw Q=String($),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.")}return de}function z($,Q,X){if($==null)return $;var fe=[],ke=0;return R($,fe,"","",function(Ue){return Q.call(X,Ue,ke++)}),fe}function K($){if($._status===-1){var Q=$._result;Q=Q(),Q.then(function(X){($._status===0||$._status===-1)&&($._status=1,$._result=X)},function(X){($._status===0||$._status===-1)&&($._status=2,$._result=X)}),$._status===-1&&($._status=0,$._result=Q)}if($._status===1)return $._result.default;throw $._result}var ue=typeof reportError=="function"?reportError:function($){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof $=="object"&&$!==null&&typeof $.message=="string"?String($.message):String($),error:$});if(!window.dispatchEvent(Q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",$);return}console.error($)},ye={map:z,forEach:function($,Q,X){z($,function(){Q.apply(this,arguments)},X)},count:function($){var Q=0;return z($,function(){Q++}),Q},toArray:function($){return z($,function(Q){return Q})||[]},only:function($){if(!q($))throw Error("React.Children.only expected to receive a single React element child.");return $}};return Ut.Activity=v,Ut.Children=ye,Ut.Component=k,Ut.Fragment=i,Ut.Profiler=o,Ut.PureComponent=D,Ut.StrictMode=a,Ut.Suspense=h,Ut.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,Ut.__COMPILER_RUNTIME={__proto__:null,c:function($){return N.H.useMemoCache($)}},Ut.cache=function($){return function(){return $.apply(null,arguments)}},Ut.cacheSignal=function(){return null},Ut.cloneElement=function($,Q,X){if($==null)throw Error("The argument must be a React element, but you passed "+$+".");var fe=C({},$.props),ke=$.key;if(Q!=null)for(Ue in Q.key!==void 0&&(ke=""+Q.key),Q)!O.call(Q,Ue)||Ue==="key"||Ue==="__self"||Ue==="__source"||Ue==="ref"&&Q.ref===void 0||(fe[Ue]=Q[Ue]);var Ue=arguments.length-2;if(Ue===1)fe.children=X;else if(1<Ue){for(var de=Array(Ue),H=0;H<Ue;H++)de[H]=arguments[H+2];fe.children=de}return L($.type,ke,fe)},Ut.createContext=function($){return $={$$typeof:d,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null},$.Provider=$,$.Consumer={$$typeof:u,_context:$},$},Ut.createElement=function($,Q,X){var fe,ke={},Ue=null;if(Q!=null)for(fe in Q.key!==void 0&&(Ue=""+Q.key),Q)O.call(Q,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(ke[fe]=Q[fe]);var de=arguments.length-2;if(de===1)ke.children=X;else if(1<de){for(var H=Array(de),G=0;G<de;G++)H[G]=arguments[G+2];ke.children=H}if($&&$.defaultProps)for(fe in de=$.defaultProps,de)ke[fe]===void 0&&(ke[fe]=de[fe]);return L($,Ue,ke)},Ut.createRef=function(){return{current:null}},Ut.forwardRef=function($){return{$$typeof:f,render:$}},Ut.isValidElement=q,Ut.lazy=function($){return{$$typeof:y,_payload:{_status:-1,_result:$},_init:K}},Ut.memo=function($,Q){return{$$typeof:m,type:$,compare:Q===void 0?null:Q}},Ut.startTransition=function($){var Q=N.T,X={};N.T=X;try{var fe=$(),ke=N.S;ke!==null&&ke(X,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(T,ue)}catch(Ue){ue(Ue)}finally{Q!==null&&X.types!==null&&(Q.types=X.types),N.T=Q}},Ut.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},Ut.use=function($){return N.H.use($)},Ut.useActionState=function($,Q,X){return N.H.useActionState($,Q,X)},Ut.useCallback=function($,Q){return N.H.useCallback($,Q)},Ut.useContext=function($){return N.H.useContext($)},Ut.useDebugValue=function(){},Ut.useDeferredValue=function($,Q){return N.H.useDeferredValue($,Q)},Ut.useEffect=function($,Q){return N.H.useEffect($,Q)},Ut.useEffectEvent=function($){return N.H.useEffectEvent($)},Ut.useId=function(){return N.H.useId()},Ut.useImperativeHandle=function($,Q,X){return N.H.useImperativeHandle($,Q,X)},Ut.useInsertionEffect=function($,Q){return N.H.useInsertionEffect($,Q)},Ut.useLayoutEffect=function($,Q){return N.H.useLayoutEffect($,Q)},Ut.useMemo=function($,Q){return N.H.useMemo($,Q)},Ut.useOptimistic=function($,Q){return N.H.useOptimistic($,Q)},Ut.useReducer=function($,Q,X){return N.H.useReducer($,Q,X)},Ut.useRef=function($){return N.H.useRef($)},Ut.useState=function($){return N.H.useState($)},Ut.useSyncExternalStore=function($,Q,X){return N.H.useSyncExternalStore($,Q,X)},Ut.useTransition=function(){return N.H.useTransition()},Ut.version="19.2.3",Ut}var mv;function Fo(){return mv||(mv=1,sf.exports=jS()),sf.exports}var w=Fo();const Ce=e0(w);var af={exports:{}},po={},lf={exports:{}},of={};var gv;function _S(){return gv||(gv=1,(function(n){function t(R,z){var K=R.length;R.push(z);e:for(;0<K;){var ue=K-1>>>1,ye=R[ue];if(0<o(ye,z))R[ue]=z,R[K]=ye,K=ue;else break e}}function i(R){return R.length===0?null:R[0]}function a(R){if(R.length===0)return null;var z=R[0],K=R.pop();if(K!==z){R[0]=K;e:for(var ue=0,ye=R.length,$=ye>>>1;ue<$;){var Q=2*(ue+1)-1,X=R[Q],fe=Q+1,ke=R[fe];if(0>o(X,K))fe<ye&&0>o(ke,X)?(R[ue]=ke,R[fe]=K,ue=fe):(R[ue]=X,R[Q]=K,ue=Q);else if(fe<ye&&0>o(ke,K))R[ue]=ke,R[fe]=K,ue=fe;else break e}}return z}function o(R,z){var K=R.sortIndex-z.sortIndex;return K!==0?K:R.id-z.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,f=d.now();n.unstable_now=function(){return d.now()-f}}var h=[],m=[],y=1,v=null,x=3,b=!1,_=!1,C=!1,j=!1,k=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function U(R){for(var z=i(m);z!==null;){if(z.callback===null)a(m);else if(z.startTime<=R)a(m),z.sortIndex=z.expirationTime,t(h,z);else break;z=i(m)}}function B(R){if(C=!1,U(R),!_)if(i(h)!==null)_=!0,T||(T=!0,V());else{var z=i(m);z!==null&&P(B,z.startTime-R)}}var T=!1,N=-1,O=5,L=-1;function Y(){return j?!0:!(n.unstable_now()-L<O)}function q(){if(j=!1,T){var R=n.unstable_now();L=R;var z=!0;try{e:{_=!1,C&&(C=!1,E(N),N=-1),b=!0;var K=x;try{t:{for(U(R),v=i(h);v!==null&&!(v.expirationTime>R&&Y());){var ue=v.callback;if(typeof ue=="function"){v.callback=null,x=v.priorityLevel;var ye=ue(v.expirationTime<=R);if(R=n.unstable_now(),typeof ye=="function"){v.callback=ye,U(R),z=!0;break t}v===i(h)&&a(h),U(R)}else a(h);v=i(h)}if(v!==null)z=!0;else{var $=i(m);$!==null&&P(B,$.startTime-R),z=!1}}break e}finally{v=null,x=K,b=!1}z=void 0}}finally{z?V():T=!1}}}var V;if(typeof D=="function")V=function(){D(q)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,I=F.port2;F.port1.onmessage=q,V=function(){I.postMessage(null)}}else V=function(){k(q,0)};function P(R,z){N=k(function(){R(n.unstable_now())},z)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(R){R.callback=null},n.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<R?Math.floor(1e3/R):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(R){switch(x){case 1:case 2:case 3:var z=3;break;default:z=x}var K=x;x=z;try{return R()}finally{x=K}},n.unstable_requestPaint=function(){j=!0},n.unstable_runWithPriority=function(R,z){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var K=x;x=R;try{return z()}finally{x=K}},n.unstable_scheduleCallback=function(R,z,K){var ue=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?ue+K:ue):K=ue,R){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=K+ye,R={id:y++,callback:z,priorityLevel:R,startTime:K,expirationTime:ye,sortIndex:-1},K>ue?(R.sortIndex=K,t(m,R),i(h)===null&&R===i(m)&&(C?(E(N),N=-1):C=!0,P(B,K-ue))):(R.sortIndex=ye,t(h,R),_||b||(_=!0,T||(T=!0,V()))),R},n.unstable_shouldYield=Y,n.unstable_wrapCallback=function(R){var z=x;return function(){var K=x;x=z;try{return R.apply(this,arguments)}finally{x=K}}}})(of)),of}var yv;function CS(){return yv||(yv=1,lf.exports=_S()),lf.exports}var cf={exports:{}},lr={};var vv;function NS(){if(vv)return lr;vv=1;var n=Fo();function t(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(h,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:h,containerInfo:m,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return lr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,lr.createPortal=function(h,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return u(h,m,null,y)},lr.flushSync=function(h){var m=d.T,y=a.p;try{if(d.T=null,a.p=2,h)return h()}finally{d.T=m,a.p=y,a.d.f()}},lr.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,a.d.C(h,m))},lr.prefetchDNS=function(h){typeof h=="string"&&a.d.D(h)},lr.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var y=m.as,v=f(y,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,b=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?a.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:b}):y==="script"&&a.d.X(h,{crossOrigin:v,integrity:x,fetchPriority:b,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},lr.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=f(m.as,m.crossOrigin);a.d.M(h,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&a.d.M(h)},lr.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=f(y,m.crossOrigin);a.d.L(h,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},lr.preloadModule=function(h,m){if(typeof h=="string")if(m){var y=f(m.as,m.crossOrigin);a.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else a.d.m(h)},lr.requestFormReset=function(h){a.d.r(h)},lr.unstable_batchedUpdates=function(h,m){return h(m)},lr.useFormState=function(h,m,y){return d.H.useFormState(h,m,y)},lr.useFormStatus=function(){return d.H.useHostTransitionStatus()},lr.version="19.2.3",lr}var xv;function t0(){if(xv)return cf.exports;xv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),cf.exports=NS(),cf.exports}var bv;function ES(){if(bv)return po;bv=1;var n=CS(),t=Fo(),i=t0();function a(e){var r="https://react.dev/errors/"+e;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var r=e,l=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,(r.flags&4098)!==0&&(l=r.return),e=r.return;while(e)}return r.tag===3?l:null}function d(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function f(e){if(e.tag===31){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(a(188))}function m(e){var r=e.alternate;if(!r){if(r=u(e),r===null)throw Error(a(188));return r!==e?null:e}for(var l=e,c=r;;){var p=l.return;if(p===null)break;var g=p.alternate;if(g===null){if(c=p.return,c!==null){l=c;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===l)return h(p),e;if(g===c)return h(p),r;g=g.sibling}throw Error(a(188))}if(l.return!==c.return)l=p,c=g;else{for(var S=!1,A=p.child;A;){if(A===l){S=!0,l=p,c=g;break}if(A===c){S=!0,c=p,l=g;break}A=A.sibling}if(!S){for(A=g.child;A;){if(A===l){S=!0,l=g,c=p;break}if(A===c){S=!0,c=g,l=p;break}A=A.sibling}if(!S)throw Error(a(189))}}if(l.alternate!==c)throw Error(a(190))}if(l.tag!==3)throw Error(a(188));return l.stateNode.current===l?e:r}function y(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e;for(e=e.child;e!==null;){if(r=y(e),r!==null)return r;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),D=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),L=Symbol.for("react.activity"),Y=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function V(e){return e===null||typeof e!="object"?null:(e=q&&e[q]||e["@@iterator"],typeof e=="function"?e:null)}var F=Symbol.for("react.client.reference");function I(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===F?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case C:return"Fragment";case k:return"Profiler";case j:return"StrictMode";case B:return"Suspense";case T:return"SuspenseList";case L:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case D:return e.displayName||"Context";case E:return(e._context.displayName||"Context")+".Consumer";case U:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case N:return r=e.displayName||null,r!==null?r:I(e.type)||"Memo";case O:r=e._payload,e=e._init;try{return I(e(r))}catch{}}return null}var P=Array.isArray,R=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},ue=[],ye=-1;function $(e){return{current:e}}function Q(e){0>ye||(e.current=ue[ye],ue[ye]=null,ye--)}function X(e,r){ye++,ue[ye]=e.current,e.current=r}var fe=$(null),ke=$(null),Ue=$(null),de=$(null);function H(e,r){switch(X(Ue,r),X(ke,e),X(fe,null),r.nodeType){case 9:case 11:e=(e=r.documentElement)&&(e=e.namespaceURI)?zy(e):0;break;default:if(e=r.tagName,r=r.namespaceURI)r=zy(r),e=Uy(r,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Q(fe),X(fe,e)}function G(){Q(fe),Q(ke),Q(Ue)}function oe(e){e.memoizedState!==null&&X(de,e);var r=fe.current,l=Uy(r,e.type);r!==l&&(X(ke,e),X(fe,l))}function pe(e){ke.current===e&&(Q(fe),Q(ke)),de.current===e&&(Q(de),oo._currentValue=K)}var je,Ie;function Be(e){if(je===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);je=r&&r[1]||"",Ie=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+je+e+Ie}var Pe=!1;function lt(e,r){if(!e||Pe)return"";Pe=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var Te=function(){throw Error()};if(Object.defineProperty(Te.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Te,[])}catch(Se){var ge=Se}Reflect.construct(e,[],Te)}else{try{Te.call()}catch(Se){ge=Se}e.call(Te.prototype)}}else{try{throw Error()}catch(Se){ge=Se}(Te=e())&&typeof Te.catch=="function"&&Te.catch(function(){})}}catch(Se){if(Se&&ge&&typeof Se.stack=="string")return[Se.stack,ge.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),S=g[0],A=g[1];if(S&&A){var W=S.split(`
`),me=A.split(`
`);for(p=c=0;c<W.length&&!W[c].includes("DetermineComponentFrameRoot");)c++;for(;p<me.length&&!me[p].includes("DetermineComponentFrameRoot");)p++;if(c===W.length||p===me.length)for(c=W.length-1,p=me.length-1;1<=c&&0<=p&&W[c]!==me[p];)p--;for(;1<=c&&0<=p;c--,p--)if(W[c]!==me[p]){if(c!==1||p!==1)do if(c--,p--,0>p||W[c]!==me[p]){var Ne=`
`+W[c].replace(" at new "," at ");return e.displayName&&Ne.includes("<anonymous>")&&(Ne=Ne.replace("<anonymous>",e.displayName)),Ne}while(1<=c&&0<=p);break}}}finally{Pe=!1,Error.prepareStackTrace=l}return(l=e?e.displayName||e.name:"")?Be(l):""}function rt(e,r){switch(e.tag){case 26:case 27:case 5:return Be(e.type);case 16:return Be("Lazy");case 13:return e.child!==r&&r!==null?Be("Suspense Fallback"):Be("Suspense");case 19:return Be("SuspenseList");case 0:case 15:return lt(e.type,!1);case 11:return lt(e.type.render,!1);case 1:return lt(e.type,!0);case 31:return Be("Activity");default:return""}}function qe(e){try{var r="",l=null;do r+=rt(e,l),l=e,e=e.return;while(e);return r}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var xe=Object.prototype.hasOwnProperty,_e=n.unstable_scheduleCallback,te=n.unstable_cancelCallback,We=n.unstable_shouldYield,Tt=n.unstable_requestPaint,Ct=n.unstable_now,le=n.unstable_getCurrentPriorityLevel,Ae=n.unstable_ImmediatePriority,Oe=n.unstable_UserBlockingPriority,Ge=n.unstable_NormalPriority,nt=n.unstable_LowPriority,St=n.unstable_IdlePriority,on=n.log,Tn=n.unstable_setDisableYieldValue,Jt=null,dt=null;function tn(e){if(typeof on=="function"&&Tn(e),dt&&typeof dt.setStrictMode=="function")try{dt.setStrictMode(Jt,e)}catch{}}var qt=Math.clz32?Math.clz32:jn,ir=Math.log,xr=Math.LN2;function jn(e){return e>>>=0,e===0?32:31-(ir(e)/xr|0)|0}var ve=256,st=262144,Ze=4194304;function tt(e){var r=e&42;if(r!==0)return r;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function vt(e,r,l){var c=e.pendingLanes;if(c===0)return 0;var p=0,g=e.suspendedLanes,S=e.pingedLanes;e=e.warmLanes;var A=c&134217727;return A!==0?(c=A&~g,c!==0?p=tt(c):(S&=A,S!==0?p=tt(S):l||(l=A&~e,l!==0&&(p=tt(l))))):(A=c&~g,A!==0?p=tt(A):S!==0?p=tt(S):l||(l=c&~e,l!==0&&(p=tt(l)))),p===0?0:r!==0&&r!==p&&(r&g)===0&&(g=p&-p,l=r&-r,g>=l||g===32&&(l&4194048)!==0)?r:p}function At(e,r){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&r)===0}function Et(e,r){switch(e){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lt(){var e=Ze;return Ze<<=1,(Ze&62914560)===0&&(Ze=4194304),e}function ht(e){for(var r=[],l=0;31>l;l++)r.push(e);return r}function Pt(e,r){e.pendingLanes|=r,r!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Nt(e,r,l,c,p,g){var S=e.pendingLanes;e.pendingLanes=l,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=l,e.entangledLanes&=l,e.errorRecoveryDisabledLanes&=l,e.shellSuspendCounter=0;var A=e.entanglements,W=e.expirationTimes,me=e.hiddenUpdates;for(l=S&~l;0<l;){var Ne=31-qt(l),Te=1<<Ne;A[Ne]=0,W[Ne]=-1;var ge=me[Ne];if(ge!==null)for(me[Ne]=null,Ne=0;Ne<ge.length;Ne++){var Se=ge[Ne];Se!==null&&(Se.lane&=-536870913)}l&=~Te}c!==0&&Xt(e,c,0),g!==0&&p===0&&e.tag!==0&&(e.suspendedLanes|=g&~(S&~r))}function Xt(e,r,l){e.pendingLanes|=r,e.suspendedLanes&=~r;var c=31-qt(r);e.entangledLanes|=r,e.entanglements[c]=e.entanglements[c]|1073741824|l&261930}function mt(e,r){var l=e.entangledLanes|=r;for(e=e.entanglements;l;){var c=31-qt(l),p=1<<c;p&r|e[c]&r&&(e[c]|=r),l&=~p}}function Zt(e,r){var l=r&-r;return l=(l&42)!==0?1:Rt(l),(l&(e.suspendedLanes|r))!==0?0:l}function Rt(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function en(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function un(){var e=z.p;return e!==0?e:(e=window.event,e===void 0?32:iv(e.type))}function ce(e,r){var l=z.p;try{return z.p=e,r()}finally{z.p=l}}var Le=Math.random().toString(36).slice(2),He="__reactFiber$"+Le,pt="__reactProps$"+Le,Dt="__reactContainer$"+Le,ne="__reactEvents$"+Le,ae="__reactListeners$"+Le,re="__reactHandles$"+Le,be="__reactResources$"+Le,Me="__reactMarker$"+Le;function Je(e){delete e[He],delete e[pt],delete e[ne],delete e[ae],delete e[re]}function Fe(e){var r=e[He];if(r)return r;for(var l=e.parentNode;l;){if(r=l[Dt]||l[He]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(e=Fy(e);e!==null;){if(l=e[He])return l;e=Fy(e)}return r}e=l,l=e.parentNode}return null}function Ke(e){if(e=e[He]||e[Dt]){var r=e.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return e}return null}function Mt(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e.stateNode;throw Error(a(33))}function xt(e){var r=e[be];return r||(r=e[be]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function It(e){e[Me]=!0}var Ye=new Set,bt={};function Gt(e,r){cn(e,r),cn(e+"Capture",r)}function cn(e,r){for(bt[e]=r,e=0;e<r.length;e++)Ye.add(r[e])}var Kn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),br={},Wr={};function Dr(e){return xe.call(Wr,e)?!0:xe.call(br,e)?!1:Kn.test(e)?Wr[e]=!0:(br[e]=!0,!1)}function Ei(e,r,l){if(Dr(r))if(l===null)e.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":e.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(r);return}}e.setAttribute(r,""+l)}}function Vs(e,r,l){if(l===null)e.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttribute(r,""+l)}}function Qr(e,r,l,c){if(c===null)e.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(l);return}e.setAttributeNS(r,l,""+c)}}function ar(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function ki(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function da(e,r,l){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,r);if(!e.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,g=c.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return p.call(this)},set:function(S){l=""+S,g.call(this,S)}}),Object.defineProperty(e,r,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(S){l=""+S},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function ha(e){if(!e._valueTracker){var r=ki(e)?"checked":"value";e._valueTracker=da(e,r,""+e[r])}}function nc(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var l=r.getValue(),c="";return e&&(c=ki(e)?e.checked?"true":"false":e.value),e=c,e!==l?(r.setValue(e),!0):!1}function fa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var ad=/[\n"\\]/g;function dr(e){return e.replace(ad,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Ti(e,r,l,c,p,g,S,A){e.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.type=S:e.removeAttribute("type"),r!=null?S==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+ar(r)):e.value!==""+ar(r)&&(e.value=""+ar(r)):S!=="submit"&&S!=="reset"||e.removeAttribute("value"),r!=null?bl(e,S,ar(r)):l!=null?bl(e,S,ar(l)):c!=null&&e.removeAttribute("value"),p==null&&g!=null&&(e.defaultChecked=!!g),p!=null&&(e.checked=p&&typeof p!="function"&&typeof p!="symbol"),A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?e.name=""+ar(A):e.removeAttribute("name")}function rc(e,r,l,c,p,g,S,A){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),r!=null||l!=null){if(!(g!=="submit"&&g!=="reset"||r!=null)){ha(e);return}l=l!=null?""+ar(l):"",r=r!=null?""+ar(r):l,A||r===e.value||(e.value=r),e.defaultValue=r}c=c??p,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=A?e.checked:!!c,e.defaultChecked=!!c,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(e.name=S),ha(e)}function bl(e,r,l){r==="number"&&fa(e.ownerDocument)===e||e.defaultValue===""+l||(e.defaultValue=""+l)}function Mr(e,r,l,c){if(e=e.options,r){r={};for(var p=0;p<l.length;p++)r["$"+l[p]]=!0;for(l=0;l<e.length;l++)p=r.hasOwnProperty("$"+e[l].value),e[l].selected!==p&&(e[l].selected=p),p&&c&&(e[l].defaultSelected=!0)}else{for(l=""+ar(l),r=null,p=0;p<e.length;p++){if(e[p].value===l){e[p].selected=!0,c&&(e[p].defaultSelected=!0);return}r!==null||e[p].disabled||(r=e[p])}r!==null&&(r.selected=!0)}}function sc(e,r,l){if(r!=null&&(r=""+ar(r),r!==e.value&&(e.value=r),l==null)){e.defaultValue!==r&&(e.defaultValue=r);return}e.defaultValue=l!=null?""+ar(l):""}function ic(e,r,l,c){if(r==null){if(c!=null){if(l!=null)throw Error(a(92));if(P(c)){if(1<c.length)throw Error(a(93));c=c[0]}l=c}l==null&&(l=""),r=l}l=ar(r),e.defaultValue=l,c=e.textContent,c===l&&c!==""&&c!==null&&(e.value=c),ha(e)}function Ks(e,r){if(r){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=r;return}}e.textContent=r}var ld=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wl(e,r,l){var c=r.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="":c?e.setProperty(r,l):typeof l!="number"||l===0||ld.has(r)?r==="float"?e.cssFloat=l:e[r]=(""+l).trim():e[r]=l+"px"}function Sl(e,r,l){if(r!=null&&typeof r!="object")throw Error(a(62));if(e=e.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var p in r)c=r[p],r.hasOwnProperty(p)&&l[p]!==c&&wl(e,p,c)}else for(var g in r)r.hasOwnProperty(g)&&wl(e,g,r[g])}function jl(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var od=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ac=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function pa(e){return ac.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function zr(){}var _l=null;function Cl(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ys=null,Ws=null;function Nl(e){var r=Ke(e);if(r&&(e=r.stateNode)){var l=e[pt]||null;e:switch(e=r.stateNode,r.type){case"input":if(Ti(e,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),r=l.name,l.type==="radio"&&r!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+dr(""+r)+'"][type="radio"]'),r=0;r<l.length;r++){var c=l[r];if(c!==e&&c.form===e.form){var p=c[pt]||null;if(!p)throw Error(a(90));Ti(c,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(r=0;r<l.length;r++)c=l[r],c.form===e.form&&nc(c)}break e;case"textarea":sc(e,l.value,l.defaultValue);break e;case"select":r=l.value,r!=null&&Mr(e,!!l.multiple,r,!1)}}}var El=!1;function Ri(e,r,l){if(El)return e(r,l);El=!0;try{var c=e(r);return c}finally{if(El=!1,(Ys!==null||Ws!==null)&&(qc(),Ys&&(r=Ys,e=Ws,Ws=Ys=null,Nl(r),e)))for(r=0;r<e.length;r++)Nl(e[r])}}function Qs(e,r){var l=e.stateNode;if(l===null)return null;var c=l[pt]||null;if(c===null)return null;l=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(a(231,r,typeof l));return l}var Jr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),M=!1;if(Jr)try{var J={};Object.defineProperty(J,"passive",{get:function(){M=!0}}),window.addEventListener("test",J,J),window.removeEventListener("test",J,J)}catch{M=!1}var ee=null,we=null,De=null;function ze(){if(De)return De;var e,r=we,l=r.length,c,p="value"in ee?ee.value:ee.textContent,g=p.length;for(e=0;e<l&&r[e]===p[e];e++);var S=l-e;for(c=1;c<=S&&r[l-c]===p[g-c];c++);return De=p.slice(e,1<c?1-c:void 0)}function $e(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function Ve(){return!0}function Qe(){return!1}function et(e){function r(l,c,p,g,S){this._reactName=l,this._targetInst=p,this.type=c,this.nativeEvent=g,this.target=S,this.currentTarget=null;for(var A in e)e.hasOwnProperty(A)&&(l=e[A],this[A]=l?l(g):g[A]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?Ve:Qe,this.isPropagationStopped=Qe,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ve)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ve)},persist:function(){},isPersistent:Ve}),r}var at={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ut=et(at),Xe=v({},at,{view:0,detail:0}),Ot=et(Xe),_n,Cn,Ur,Xr=v({},Xe,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Xs,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ur&&(Ur&&e.type==="mousemove"?(_n=e.screenX-Ur.screenX,Cn=e.screenY-Ur.screenY):Cn=_n=0,Ur=e),_n)},movementY:function(e){return"movementY"in e?e.movementY:Cn}}),ct=et(Xr),yt=v({},Xr,{dataTransfer:0}),zt=et(yt),bn=v({},Xe,{relatedTarget:0}),En=et(bn),zn=v({},at,{animationName:0,elapsedTime:0,pseudoElement:0}),Vt=et(zn),hr=v({},at,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Un=et(hr),ys=v({},at,{data:0}),Zr=et(ys),Js={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function vs(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=Bp[e])?!!r[e]:!1}function Xs(){return vs}var Ai=v({},Xe,{key:function(e){if(e.key){var r=Js[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=$e(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?kl[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Xs,charCode:function(e){return e.type==="keypress"?$e(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?$e(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Db=et(Ai),Mb=v({},Xr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$p=et(Mb),zb=v({},Xe,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Xs}),Ub=et(zb),Lb=v({},at,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ib=et(Lb),Bb=v({},Xr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),$b=et(Bb),Pb=v({},at,{newState:0,oldState:0}),qb=et(Pb),Fb=[9,13,27,32],cd=Jr&&"CompositionEvent"in window,Tl=null;Jr&&"documentMode"in document&&(Tl=document.documentMode);var Hb=Jr&&"TextEvent"in window&&!Tl,Pp=Jr&&(!cd||Tl&&8<Tl&&11>=Tl),qp=" ",Fp=!1;function Hp(e,r){switch(e){case"keyup":return Fb.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ma=!1;function Gb(e,r){switch(e){case"compositionend":return Gp(r);case"keypress":return r.which!==32?null:(Fp=!0,qp);case"textInput":return e=r.data,e===qp&&Fp?null:e;default:return null}}function Vb(e,r){if(ma)return e==="compositionend"||!cd&&Hp(e,r)?(e=ze(),De=we=ee=null,ma=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Pp&&r.locale!=="ko"?null:r.data;default:return null}}var Kb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vp(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!Kb[e.type]:r==="textarea"}function Kp(e,r,l,c){Ys?Ws?Ws.push(c):Ws=[c]:Ys=c,r=Wc(r,"onChange"),0<r.length&&(l=new ut("onChange","change",null,l,c),e.push({event:l,listeners:r}))}var Rl=null,Al=null;function Yb(e){Ty(e,0)}function lc(e){var r=Mt(e);if(nc(r))return e}function Yp(e,r){if(e==="change")return r}var Wp=!1;if(Jr){var ud;if(Jr){var dd="oninput"in document;if(!dd){var Qp=document.createElement("div");Qp.setAttribute("oninput","return;"),dd=typeof Qp.oninput=="function"}ud=dd}else ud=!1;Wp=ud&&(!document.documentMode||9<document.documentMode)}function Jp(){Rl&&(Rl.detachEvent("onpropertychange",Xp),Al=Rl=null)}function Xp(e){if(e.propertyName==="value"&&lc(Al)){var r=[];Kp(r,Al,e,Cl(e)),Ri(Yb,r)}}function Wb(e,r,l){e==="focusin"?(Jp(),Rl=r,Al=l,Rl.attachEvent("onpropertychange",Xp)):e==="focusout"&&Jp()}function Qb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return lc(Al)}function Jb(e,r){if(e==="click")return lc(r)}function Xb(e,r){if(e==="input"||e==="change")return lc(r)}function Zb(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var wr=typeof Object.is=="function"?Object.is:Zb;function Ol(e,r){if(wr(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var l=Object.keys(e),c=Object.keys(r);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var p=l[c];if(!xe.call(r,p)||!wr(e[p],r[p]))return!1}return!0}function Zp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function em(e,r){var l=Zp(e);e=0;for(var c;l;){if(l.nodeType===3){if(c=e+l.textContent.length,e<=r&&c>=r)return{node:l,offset:r-e};e=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Zp(l)}}function tm(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?tm(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function nm(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var r=fa(e.document);r instanceof e.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)e=r.contentWindow;else break;r=fa(e.document)}return r}function hd(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}var ew=Jr&&"documentMode"in document&&11>=document.documentMode,ga=null,fd=null,Dl=null,pd=!1;function rm(e,r,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;pd||ga==null||ga!==fa(c)||(c=ga,"selectionStart"in c&&hd(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Dl&&Ol(Dl,c)||(Dl=c,c=Wc(fd,"onSelect"),0<c.length&&(r=new ut("onSelect","select",null,r,l),e.push({event:r,listeners:c}),r.target=ga)))}function Oi(e,r){var l={};return l[e.toLowerCase()]=r.toLowerCase(),l["Webkit"+e]="webkit"+r,l["Moz"+e]="moz"+r,l}var ya={animationend:Oi("Animation","AnimationEnd"),animationiteration:Oi("Animation","AnimationIteration"),animationstart:Oi("Animation","AnimationStart"),transitionrun:Oi("Transition","TransitionRun"),transitionstart:Oi("Transition","TransitionStart"),transitioncancel:Oi("Transition","TransitionCancel"),transitionend:Oi("Transition","TransitionEnd")},md={},sm={};Jr&&(sm=document.createElement("div").style,"AnimationEvent"in window||(delete ya.animationend.animation,delete ya.animationiteration.animation,delete ya.animationstart.animation),"TransitionEvent"in window||delete ya.transitionend.transition);function Di(e){if(md[e])return md[e];if(!ya[e])return e;var r=ya[e],l;for(l in r)if(r.hasOwnProperty(l)&&l in sm)return md[e]=r[l];return e}var im=Di("animationend"),am=Di("animationiteration"),lm=Di("animationstart"),tw=Di("transitionrun"),nw=Di("transitionstart"),rw=Di("transitioncancel"),om=Di("transitionend"),cm=new Map,gd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gd.push("scrollEnd");function es(e,r){cm.set(e,r),Gt(r,[e])}var oc=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Lr=[],va=0,yd=0;function cc(){for(var e=va,r=yd=va=0;r<e;){var l=Lr[r];Lr[r++]=null;var c=Lr[r];Lr[r++]=null;var p=Lr[r];Lr[r++]=null;var g=Lr[r];if(Lr[r++]=null,c!==null&&p!==null){var S=c.pending;S===null?p.next=p:(p.next=S.next,S.next=p),c.pending=p}g!==0&&um(l,p,g)}}function uc(e,r,l,c){Lr[va++]=e,Lr[va++]=r,Lr[va++]=l,Lr[va++]=c,yd|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function vd(e,r,l,c){return uc(e,r,l,c),dc(e)}function Mi(e,r){return uc(e,null,null,r),dc(e)}function um(e,r,l){e.lanes|=l;var c=e.alternate;c!==null&&(c.lanes|=l);for(var p=!1,g=e.return;g!==null;)g.childLanes|=l,c=g.alternate,c!==null&&(c.childLanes|=l),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(p=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,p&&r!==null&&(p=31-qt(l),e=g.hiddenUpdates,c=e[p],c===null?e[p]=[r]:c.push(r),r.lane=l|536870912),g):null}function dc(e){if(50<to)throw to=0,Eh=null,Error(a(185));for(var r=e.return;r!==null;)e=r,r=e.return;return e.tag===3?e.stateNode:null}var xa={};function sw(e,r,l,c){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sr(e,r,l,c){return new sw(e,r,l,c)}function xd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function xs(e,r){var l=e.alternate;return l===null?(l=Sr(e.tag,r,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=r,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&65011712,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,r=e.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l.refCleanup=e.refCleanup,l}function dm(e,r){e.flags&=65011714;var l=e.alternate;return l===null?(e.childLanes=0,e.lanes=r,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=l.childLanes,e.lanes=l.lanes,e.child=l.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=l.memoizedProps,e.memoizedState=l.memoizedState,e.updateQueue=l.updateQueue,e.type=l.type,r=l.dependencies,e.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e}function hc(e,r,l,c,p,g){var S=0;if(c=e,typeof e=="function")xd(e)&&(S=1);else if(typeof e=="string")S=cS(e,l,fe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case L:return e=Sr(31,l,r,p),e.elementType=L,e.lanes=g,e;case C:return zi(l.children,p,g,r);case j:S=8,p|=24;break;case k:return e=Sr(12,l,r,p|2),e.elementType=k,e.lanes=g,e;case B:return e=Sr(13,l,r,p),e.elementType=B,e.lanes=g,e;case T:return e=Sr(19,l,r,p),e.elementType=T,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case D:S=10;break e;case E:S=9;break e;case U:S=11;break e;case N:S=14;break e;case O:S=16,c=null;break e}S=29,l=Error(a(130,e===null?"null":typeof e,"")),c=null}return r=Sr(S,l,r,p),r.elementType=e,r.type=c,r.lanes=g,r}function zi(e,r,l,c){return e=Sr(7,e,c,r),e.lanes=l,e}function bd(e,r,l){return e=Sr(6,e,null,r),e.lanes=l,e}function hm(e){var r=Sr(18,null,null,0);return r.stateNode=e,r}function wd(e,r,l){return r=Sr(4,e.children!==null?e.children:[],e.key,r),r.lanes=l,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}var fm=new WeakMap;function Ir(e,r){if(typeof e=="object"&&e!==null){var l=fm.get(e);return l!==void 0?l:(r={value:e,source:r,stack:qe(r)},fm.set(e,r),r)}return{value:e,source:r,stack:qe(r)}}var ba=[],wa=0,fc=null,Ml=0,Br=[],$r=0,Zs=null,ds=1,hs="";function bs(e,r){ba[wa++]=Ml,ba[wa++]=fc,fc=e,Ml=r}function pm(e,r,l){Br[$r++]=ds,Br[$r++]=hs,Br[$r++]=Zs,Zs=e;var c=ds;e=hs;var p=32-qt(c)-1;c&=~(1<<p),l+=1;var g=32-qt(r)+p;if(30<g){var S=p-p%5;g=(c&(1<<S)-1).toString(32),c>>=S,p-=S,ds=1<<32-qt(r)+p|l<<p|c,hs=g+e}else ds=1<<g|l<<p|c,hs=e}function Sd(e){e.return!==null&&(bs(e,1),pm(e,1,0))}function jd(e){for(;e===fc;)fc=ba[--wa],ba[wa]=null,Ml=ba[--wa],ba[wa]=null;for(;e===Zs;)Zs=Br[--$r],Br[$r]=null,hs=Br[--$r],Br[$r]=null,ds=Br[--$r],Br[$r]=null}function mm(e,r){Br[$r++]=ds,Br[$r++]=hs,Br[$r++]=Zs,ds=r.id,hs=r.overflow,Zs=e}var Jn=null,wn=null,Wt=!1,ei=null,Pr=!1,_d=Error(a(519));function ti(e){var r=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw zl(Ir(r,e)),_d}function gm(e){var r=e.stateNode,l=e.type,c=e.memoizedProps;switch(r[He]=e,r[pt]=c,l){case"dialog":Ht("cancel",r),Ht("close",r);break;case"iframe":case"object":case"embed":Ht("load",r);break;case"video":case"audio":for(l=0;l<ro.length;l++)Ht(ro[l],r);break;case"source":Ht("error",r);break;case"img":case"image":case"link":Ht("error",r),Ht("load",r);break;case"details":Ht("toggle",r);break;case"input":Ht("invalid",r),rc(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Ht("invalid",r);break;case"textarea":Ht("invalid",r),ic(r,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||r.textContent===""+l||c.suppressHydrationWarning===!0||Dy(r.textContent,l)?(c.popover!=null&&(Ht("beforetoggle",r),Ht("toggle",r)),c.onScroll!=null&&Ht("scroll",r),c.onScrollEnd!=null&&Ht("scrollend",r),c.onClick!=null&&(r.onclick=zr),r=!0):r=!1,r||ti(e,!0)}function ym(e){for(Jn=e.return;Jn;)switch(Jn.tag){case 5:case 31:case 13:Pr=!1;return;case 27:case 3:Pr=!0;return;default:Jn=Jn.return}}function Sa(e){if(e!==Jn)return!1;if(!Wt)return ym(e),Wt=!0,!1;var r=e.tag,l;if((l=r!==3&&r!==27)&&((l=r===5)&&(l=e.type,l=!(l!=="form"&&l!=="button")||qh(e.type,e.memoizedProps)),l=!l),l&&wn&&ti(e),ym(e),r===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));wn=qy(e)}else if(r===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));wn=qy(e)}else r===27?(r=wn,mi(e.type)?(e=Kh,Kh=null,wn=e):wn=r):wn=Jn?Fr(e.stateNode.nextSibling):null;return!0}function Ui(){wn=Jn=null,Wt=!1}function Cd(){var e=ei;return e!==null&&(gr===null?gr=e:gr.push.apply(gr,e),ei=null),e}function zl(e){ei===null?ei=[e]:ei.push(e)}var Nd=$(null),Li=null,ws=null;function ni(e,r,l){X(Nd,r._currentValue),r._currentValue=l}function Ss(e){e._currentValue=Nd.current,Q(Nd)}function Ed(e,r,l){for(;e!==null;){var c=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),e===l)break;e=e.return}}function kd(e,r,l,c){var p=e.child;for(p!==null&&(p.return=e);p!==null;){var g=p.dependencies;if(g!==null){var S=p.child;g=g.firstContext;e:for(;g!==null;){var A=g;g=p;for(var W=0;W<r.length;W++)if(A.context===r[W]){g.lanes|=l,A=g.alternate,A!==null&&(A.lanes|=l),Ed(g.return,l,e),c||(S=null);break e}g=A.next}}else if(p.tag===18){if(S=p.return,S===null)throw Error(a(341));S.lanes|=l,g=S.alternate,g!==null&&(g.lanes|=l),Ed(S,l,e),S=null}else S=p.child;if(S!==null)S.return=p;else for(S=p;S!==null;){if(S===e){S=null;break}if(p=S.sibling,p!==null){p.return=S.return,S=p;break}S=S.return}p=S}}function ja(e,r,l,c){e=null;for(var p=r,g=!1;p!==null;){if(!g){if((p.flags&524288)!==0)g=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var S=p.alternate;if(S===null)throw Error(a(387));if(S=S.memoizedProps,S!==null){var A=p.type;wr(p.pendingProps.value,S.value)||(e!==null?e.push(A):e=[A])}}else if(p===de.current){if(S=p.alternate,S===null)throw Error(a(387));S.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(e!==null?e.push(oo):e=[oo])}p=p.return}e!==null&&kd(r,e,l,c),r.flags|=262144}function pc(e){for(e=e.firstContext;e!==null;){if(!wr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ii(e){Li=e,ws=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Xn(e){return vm(Li,e)}function mc(e,r){return Li===null&&Ii(e),vm(e,r)}function vm(e,r){var l=r._currentValue;if(r={context:r,memoizedValue:l,next:null},ws===null){if(e===null)throw Error(a(308));ws=r,e.dependencies={lanes:0,firstContext:r},e.flags|=524288}else ws=ws.next=r;return l}var iw=typeof AbortController<"u"?AbortController:function(){var e=[],r=this.signal={aborted:!1,addEventListener:function(l,c){e.push(c)}};this.abort=function(){r.aborted=!0,e.forEach(function(l){return l()})}},aw=n.unstable_scheduleCallback,lw=n.unstable_NormalPriority,Ln={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Td(){return{controller:new iw,data:new Map,refCount:0}}function Ul(e){e.refCount--,e.refCount===0&&aw(lw,function(){e.controller.abort()})}var Ll=null,Rd=0,_a=0,Ca=null;function ow(e,r){if(Ll===null){var l=Ll=[];Rd=0,_a=Dh(),Ca={status:"pending",value:void 0,then:function(c){l.push(c)}}}return Rd++,r.then(xm,xm),r}function xm(){if(--Rd===0&&Ll!==null){Ca!==null&&(Ca.status="fulfilled");var e=Ll;Ll=null,_a=0,Ca=null;for(var r=0;r<e.length;r++)(0,e[r])()}}function cw(e,r){var l=[],c={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return e.then(function(){c.status="fulfilled",c.value=r;for(var p=0;p<l.length;p++)(0,l[p])(r)},function(p){for(c.status="rejected",c.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),c}var bm=R.S;R.S=function(e,r){ry=Ct(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&ow(e,r),bm!==null&&bm(e,r)};var Bi=$(null);function Ad(){var e=Bi.current;return e!==null?e:gn.pooledCache}function gc(e,r){r===null?X(Bi,Bi.current):X(Bi,r.pool)}function wm(){var e=Ad();return e===null?null:{parent:Ln._currentValue,pool:e}}var Na=Error(a(460)),Od=Error(a(474)),yc=Error(a(542)),vc={then:function(){}};function Sm(e){return e=e.status,e==="fulfilled"||e==="rejected"}function jm(e,r,l){switch(l=e[l],l===void 0?e.push(r):l!==r&&(r.then(zr,zr),r=l),r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,Cm(e),e;default:if(typeof r.status=="string")r.then(zr,zr);else{if(e=gn,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=r,e.status="pending",e.then(function(c){if(r.status==="pending"){var p=r;p.status="fulfilled",p.value=c}},function(c){if(r.status==="pending"){var p=r;p.status="rejected",p.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,Cm(e),e}throw Pi=r,Na}}function $i(e){try{var r=e._init;return r(e._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Pi=l,Na):l}}var Pi=null;function _m(){if(Pi===null)throw Error(a(459));var e=Pi;return Pi=null,e}function Cm(e){if(e===Na||e===yc)throw Error(a(483))}var Ea=null,Il=0;function xc(e){var r=Il;return Il+=1,Ea===null&&(Ea=[]),jm(Ea,e,r)}function Bl(e,r){r=r.props.ref,e.ref=r!==void 0?r:null}function bc(e,r){throw r.$$typeof===x?Error(a(525)):(e=Object.prototype.toString.call(r),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)))}function Nm(e){function r(ie,Z){if(e){var he=ie.deletions;he===null?(ie.deletions=[Z],ie.flags|=16):he.push(Z)}}function l(ie,Z){if(!e)return null;for(;Z!==null;)r(ie,Z),Z=Z.sibling;return null}function c(ie){for(var Z=new Map;ie!==null;)ie.key!==null?Z.set(ie.key,ie):Z.set(ie.index,ie),ie=ie.sibling;return Z}function p(ie,Z){return ie=xs(ie,Z),ie.index=0,ie.sibling=null,ie}function g(ie,Z,he){return ie.index=he,e?(he=ie.alternate,he!==null?(he=he.index,he<Z?(ie.flags|=67108866,Z):he):(ie.flags|=67108866,Z)):(ie.flags|=1048576,Z)}function S(ie){return e&&ie.alternate===null&&(ie.flags|=67108866),ie}function A(ie,Z,he,Ee){return Z===null||Z.tag!==6?(Z=bd(he,ie.mode,Ee),Z.return=ie,Z):(Z=p(Z,he),Z.return=ie,Z)}function W(ie,Z,he,Ee){var gt=he.type;return gt===C?Ne(ie,Z,he.props.children,Ee,he.key):Z!==null&&(Z.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===O&&$i(gt)===Z.type)?(Z=p(Z,he.props),Bl(Z,he),Z.return=ie,Z):(Z=hc(he.type,he.key,he.props,null,ie.mode,Ee),Bl(Z,he),Z.return=ie,Z)}function me(ie,Z,he,Ee){return Z===null||Z.tag!==4||Z.stateNode.containerInfo!==he.containerInfo||Z.stateNode.implementation!==he.implementation?(Z=wd(he,ie.mode,Ee),Z.return=ie,Z):(Z=p(Z,he.children||[]),Z.return=ie,Z)}function Ne(ie,Z,he,Ee,gt){return Z===null||Z.tag!==7?(Z=zi(he,ie.mode,Ee,gt),Z.return=ie,Z):(Z=p(Z,he),Z.return=ie,Z)}function Te(ie,Z,he){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Z=bd(""+Z,ie.mode,he),Z.return=ie,Z;if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case b:return he=hc(Z.type,Z.key,Z.props,null,ie.mode,he),Bl(he,Z),he.return=ie,he;case _:return Z=wd(Z,ie.mode,he),Z.return=ie,Z;case O:return Z=$i(Z),Te(ie,Z,he)}if(P(Z)||V(Z))return Z=zi(Z,ie.mode,he,null),Z.return=ie,Z;if(typeof Z.then=="function")return Te(ie,xc(Z),he);if(Z.$$typeof===D)return Te(ie,mc(ie,Z),he);bc(ie,Z)}return null}function ge(ie,Z,he,Ee){var gt=Z!==null?Z.key:null;if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return gt!==null?null:A(ie,Z,""+he,Ee);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case b:return he.key===gt?W(ie,Z,he,Ee):null;case _:return he.key===gt?me(ie,Z,he,Ee):null;case O:return he=$i(he),ge(ie,Z,he,Ee)}if(P(he)||V(he))return gt!==null?null:Ne(ie,Z,he,Ee,null);if(typeof he.then=="function")return ge(ie,Z,xc(he),Ee);if(he.$$typeof===D)return ge(ie,Z,mc(ie,he),Ee);bc(ie,he)}return null}function Se(ie,Z,he,Ee,gt){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return ie=ie.get(he)||null,A(Z,ie,""+Ee,gt);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case b:return ie=ie.get(Ee.key===null?he:Ee.key)||null,W(Z,ie,Ee,gt);case _:return ie=ie.get(Ee.key===null?he:Ee.key)||null,me(Z,ie,Ee,gt);case O:return Ee=$i(Ee),Se(ie,Z,he,Ee,gt)}if(P(Ee)||V(Ee))return ie=ie.get(he)||null,Ne(Z,ie,Ee,gt,null);if(typeof Ee.then=="function")return Se(ie,Z,he,xc(Ee),gt);if(Ee.$$typeof===D)return Se(ie,Z,he,mc(Z,Ee),gt);bc(Z,Ee)}return null}function it(ie,Z,he,Ee){for(var gt=null,nn=null,ot=Z,$t=Z=0,Yt=null;ot!==null&&$t<he.length;$t++){ot.index>$t?(Yt=ot,ot=null):Yt=ot.sibling;var rn=ge(ie,ot,he[$t],Ee);if(rn===null){ot===null&&(ot=Yt);break}e&&ot&&rn.alternate===null&&r(ie,ot),Z=g(rn,Z,$t),nn===null?gt=rn:nn.sibling=rn,nn=rn,ot=Yt}if($t===he.length)return l(ie,ot),Wt&&bs(ie,$t),gt;if(ot===null){for(;$t<he.length;$t++)ot=Te(ie,he[$t],Ee),ot!==null&&(Z=g(ot,Z,$t),nn===null?gt=ot:nn.sibling=ot,nn=ot);return Wt&&bs(ie,$t),gt}for(ot=c(ot);$t<he.length;$t++)Yt=Se(ot,ie,$t,he[$t],Ee),Yt!==null&&(e&&Yt.alternate!==null&&ot.delete(Yt.key===null?$t:Yt.key),Z=g(Yt,Z,$t),nn===null?gt=Yt:nn.sibling=Yt,nn=Yt);return e&&ot.forEach(function(bi){return r(ie,bi)}),Wt&&bs(ie,$t),gt}function wt(ie,Z,he,Ee){if(he==null)throw Error(a(151));for(var gt=null,nn=null,ot=Z,$t=Z=0,Yt=null,rn=he.next();ot!==null&&!rn.done;$t++,rn=he.next()){ot.index>$t?(Yt=ot,ot=null):Yt=ot.sibling;var bi=ge(ie,ot,rn.value,Ee);if(bi===null){ot===null&&(ot=Yt);break}e&&ot&&bi.alternate===null&&r(ie,ot),Z=g(bi,Z,$t),nn===null?gt=bi:nn.sibling=bi,nn=bi,ot=Yt}if(rn.done)return l(ie,ot),Wt&&bs(ie,$t),gt;if(ot===null){for(;!rn.done;$t++,rn=he.next())rn=Te(ie,rn.value,Ee),rn!==null&&(Z=g(rn,Z,$t),nn===null?gt=rn:nn.sibling=rn,nn=rn);return Wt&&bs(ie,$t),gt}for(ot=c(ot);!rn.done;$t++,rn=he.next())rn=Se(ot,ie,$t,rn.value,Ee),rn!==null&&(e&&rn.alternate!==null&&ot.delete(rn.key===null?$t:rn.key),Z=g(rn,Z,$t),nn===null?gt=rn:nn.sibling=rn,nn=rn);return e&&ot.forEach(function(bS){return r(ie,bS)}),Wt&&bs(ie,$t),gt}function mn(ie,Z,he,Ee){if(typeof he=="object"&&he!==null&&he.type===C&&he.key===null&&(he=he.props.children),typeof he=="object"&&he!==null){switch(he.$$typeof){case b:e:{for(var gt=he.key;Z!==null;){if(Z.key===gt){if(gt=he.type,gt===C){if(Z.tag===7){l(ie,Z.sibling),Ee=p(Z,he.props.children),Ee.return=ie,ie=Ee;break e}}else if(Z.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===O&&$i(gt)===Z.type){l(ie,Z.sibling),Ee=p(Z,he.props),Bl(Ee,he),Ee.return=ie,ie=Ee;break e}l(ie,Z);break}else r(ie,Z);Z=Z.sibling}he.type===C?(Ee=zi(he.props.children,ie.mode,Ee,he.key),Ee.return=ie,ie=Ee):(Ee=hc(he.type,he.key,he.props,null,ie.mode,Ee),Bl(Ee,he),Ee.return=ie,ie=Ee)}return S(ie);case _:e:{for(gt=he.key;Z!==null;){if(Z.key===gt)if(Z.tag===4&&Z.stateNode.containerInfo===he.containerInfo&&Z.stateNode.implementation===he.implementation){l(ie,Z.sibling),Ee=p(Z,he.children||[]),Ee.return=ie,ie=Ee;break e}else{l(ie,Z);break}else r(ie,Z);Z=Z.sibling}Ee=wd(he,ie.mode,Ee),Ee.return=ie,ie=Ee}return S(ie);case O:return he=$i(he),mn(ie,Z,he,Ee)}if(P(he))return it(ie,Z,he,Ee);if(V(he)){if(gt=V(he),typeof gt!="function")throw Error(a(150));return he=gt.call(he),wt(ie,Z,he,Ee)}if(typeof he.then=="function")return mn(ie,Z,xc(he),Ee);if(he.$$typeof===D)return mn(ie,Z,mc(ie,he),Ee);bc(ie,he)}return typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint"?(he=""+he,Z!==null&&Z.tag===6?(l(ie,Z.sibling),Ee=p(Z,he),Ee.return=ie,ie=Ee):(l(ie,Z),Ee=bd(he,ie.mode,Ee),Ee.return=ie,ie=Ee),S(ie)):l(ie,Z)}return function(ie,Z,he,Ee){try{Il=0;var gt=mn(ie,Z,he,Ee);return Ea=null,gt}catch(ot){if(ot===Na||ot===yc)throw ot;var nn=Sr(29,ot,null,ie.mode);return nn.lanes=Ee,nn.return=ie,nn}}}var qi=Nm(!0),Em=Nm(!1),ri=!1;function Dd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Md(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function si(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ii(e,r,l){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(sn&2)!==0){var p=c.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),c.pending=r,r=dc(e),um(e,null,l),r}return uc(e,c,r,l),dc(e)}function $l(e,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194048)!==0)){var c=r.lanes;c&=e.pendingLanes,l|=c,r.lanes=l,mt(e,l)}}function zd(e,r){var l=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var p=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var S={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};g===null?p=g=S:g=g.next=S,l=l.next}while(l!==null);g===null?p=g=r:g=g.next=r}else p=g=r;l={baseState:c.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=r:e.next=r,l.lastBaseUpdate=r}var Ud=!1;function Pl(){if(Ud){var e=Ca;if(e!==null)throw e}}function ql(e,r,l,c){Ud=!1;var p=e.updateQueue;ri=!1;var g=p.firstBaseUpdate,S=p.lastBaseUpdate,A=p.shared.pending;if(A!==null){p.shared.pending=null;var W=A,me=W.next;W.next=null,S===null?g=me:S.next=me,S=W;var Ne=e.alternate;Ne!==null&&(Ne=Ne.updateQueue,A=Ne.lastBaseUpdate,A!==S&&(A===null?Ne.firstBaseUpdate=me:A.next=me,Ne.lastBaseUpdate=W))}if(g!==null){var Te=p.baseState;S=0,Ne=me=W=null,A=g;do{var ge=A.lane&-536870913,Se=ge!==A.lane;if(Se?(Kt&ge)===ge:(c&ge)===ge){ge!==0&&ge===_a&&(Ud=!0),Ne!==null&&(Ne=Ne.next={lane:0,tag:A.tag,payload:A.payload,callback:null,next:null});e:{var it=e,wt=A;ge=r;var mn=l;switch(wt.tag){case 1:if(it=wt.payload,typeof it=="function"){Te=it.call(mn,Te,ge);break e}Te=it;break e;case 3:it.flags=it.flags&-65537|128;case 0:if(it=wt.payload,ge=typeof it=="function"?it.call(mn,Te,ge):it,ge==null)break e;Te=v({},Te,ge);break e;case 2:ri=!0}}ge=A.callback,ge!==null&&(e.flags|=64,Se&&(e.flags|=8192),Se=p.callbacks,Se===null?p.callbacks=[ge]:Se.push(ge))}else Se={lane:ge,tag:A.tag,payload:A.payload,callback:A.callback,next:null},Ne===null?(me=Ne=Se,W=Te):Ne=Ne.next=Se,S|=ge;if(A=A.next,A===null){if(A=p.shared.pending,A===null)break;Se=A,A=Se.next,Se.next=null,p.lastBaseUpdate=Se,p.shared.pending=null}}while(!0);Ne===null&&(W=Te),p.baseState=W,p.firstBaseUpdate=me,p.lastBaseUpdate=Ne,g===null&&(p.shared.lanes=0),ui|=S,e.lanes=S,e.memoizedState=Te}}function km(e,r){if(typeof e!="function")throw Error(a(191,e));e.call(r)}function Tm(e,r){var l=e.callbacks;if(l!==null)for(e.callbacks=null,e=0;e<l.length;e++)km(l[e],r)}var ka=$(null),wc=$(0);function Rm(e,r){e=As,X(wc,e),X(ka,r),As=e|r.baseLanes}function Ld(){X(wc,As),X(ka,ka.current)}function Id(){As=wc.current,Q(ka),Q(wc)}var jr=$(null),qr=null;function ai(e){var r=e.alternate;X(Dn,Dn.current&1),X(jr,e),qr===null&&(r===null||ka.current!==null||r.memoizedState!==null)&&(qr=e)}function Bd(e){X(Dn,Dn.current),X(jr,e),qr===null&&(qr=e)}function Am(e){e.tag===22?(X(Dn,Dn.current),X(jr,e),qr===null&&(qr=e)):li()}function li(){X(Dn,Dn.current),X(jr,jr.current)}function _r(e){Q(jr),qr===e&&(qr=null),Q(Dn)}var Dn=$(0);function Sc(e){for(var r=e;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||Gh(l)||Vh(l)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var js=0,Bt=null,fn=null,In=null,jc=!1,Ta=!1,Fi=!1,_c=0,Fl=0,Ra=null,uw=0;function Rn(){throw Error(a(321))}function $d(e,r){if(r===null)return!1;for(var l=0;l<r.length&&l<e.length;l++)if(!wr(e[l],r[l]))return!1;return!0}function Pd(e,r,l,c,p,g){return js=g,Bt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,R.H=e===null||e.memoizedState===null?pg:nh,Fi=!1,g=l(c,p),Fi=!1,Ta&&(g=Dm(r,l,c,p)),Om(e),g}function Om(e){R.H=Vl;var r=fn!==null&&fn.next!==null;if(js=0,In=fn=Bt=null,jc=!1,Fl=0,Ra=null,r)throw Error(a(300));e===null||Bn||(e=e.dependencies,e!==null&&pc(e)&&(Bn=!0))}function Dm(e,r,l,c){Bt=e;var p=0;do{if(Ta&&(Ra=null),Fl=0,Ta=!1,25<=p)throw Error(a(301));if(p+=1,In=fn=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}R.H=mg,g=r(l,c)}while(Ta);return g}function dw(){var e=R.H,r=e.useState()[0];return r=typeof r.then=="function"?Hl(r):r,e=e.useState()[0],(fn!==null?fn.memoizedState:null)!==e&&(Bt.flags|=1024),r}function qd(){var e=_c!==0;return _c=0,e}function Fd(e,r,l){r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~l}function Hd(e){if(jc){for(e=e.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}jc=!1}js=0,In=fn=Bt=null,Ta=!1,Fl=_c=0,Ra=null}function cr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return In===null?Bt.memoizedState=In=e:In=In.next=e,In}function Mn(){if(fn===null){var e=Bt.alternate;e=e!==null?e.memoizedState:null}else e=fn.next;var r=In===null?Bt.memoizedState:In.next;if(r!==null)In=r,fn=e;else{if(e===null)throw Bt.alternate===null?Error(a(467)):Error(a(310));fn=e,e={memoizedState:fn.memoizedState,baseState:fn.baseState,baseQueue:fn.baseQueue,queue:fn.queue,next:null},In===null?Bt.memoizedState=In=e:In=In.next=e}return In}function Cc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Hl(e){var r=Fl;return Fl+=1,Ra===null&&(Ra=[]),e=jm(Ra,e,r),r=Bt,(In===null?r.memoizedState:In.next)===null&&(r=r.alternate,R.H=r===null||r.memoizedState===null?pg:nh),e}function Nc(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Hl(e);if(e.$$typeof===D)return Xn(e)}throw Error(a(438,String(e)))}function Gd(e){var r=null,l=Bt.updateQueue;if(l!==null&&(r=l.memoCache),r==null){var c=Bt.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(p){return p.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),l===null&&(l=Cc(),Bt.updateQueue=l),l.memoCache=r,l=r.data[r.index],l===void 0)for(l=r.data[r.index]=Array(e),c=0;c<e;c++)l[c]=Y;return r.index++,l}function _s(e,r){return typeof r=="function"?r(e):r}function Ec(e){var r=Mn();return Vd(r,fn,e)}function Vd(e,r,l){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=l;var p=e.baseQueue,g=c.pending;if(g!==null){if(p!==null){var S=p.next;p.next=g.next,g.next=S}r.baseQueue=p=g,c.pending=null}if(g=e.baseState,p===null)e.memoizedState=g;else{r=p.next;var A=S=null,W=null,me=r,Ne=!1;do{var Te=me.lane&-536870913;if(Te!==me.lane?(Kt&Te)===Te:(js&Te)===Te){var ge=me.revertLane;if(ge===0)W!==null&&(W=W.next={lane:0,revertLane:0,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),Te===_a&&(Ne=!0);else if((js&ge)===ge){me=me.next,ge===_a&&(Ne=!0);continue}else Te={lane:0,revertLane:me.revertLane,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},W===null?(A=W=Te,S=g):W=W.next=Te,Bt.lanes|=ge,ui|=ge;Te=me.action,Fi&&l(g,Te),g=me.hasEagerState?me.eagerState:l(g,Te)}else ge={lane:Te,revertLane:me.revertLane,gesture:me.gesture,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},W===null?(A=W=ge,S=g):W=W.next=ge,Bt.lanes|=Te,ui|=Te;me=me.next}while(me!==null&&me!==r);if(W===null?S=g:W.next=A,!wr(g,e.memoizedState)&&(Bn=!0,Ne&&(l=Ca,l!==null)))throw l;e.memoizedState=g,e.baseState=S,e.baseQueue=W,c.lastRenderedState=g}return p===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function Kd(e){var r=Mn(),l=r.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=e;var c=l.dispatch,p=l.pending,g=r.memoizedState;if(p!==null){l.pending=null;var S=p=p.next;do g=e(g,S.action),S=S.next;while(S!==p);wr(g,r.memoizedState)||(Bn=!0),r.memoizedState=g,r.baseQueue===null&&(r.baseState=g),l.lastRenderedState=g}return[g,c]}function Mm(e,r,l){var c=Bt,p=Mn(),g=Wt;if(g){if(l===void 0)throw Error(a(407));l=l()}else l=r();var S=!wr((fn||p).memoizedState,l);if(S&&(p.memoizedState=l,Bn=!0),p=p.queue,Qd(Lm.bind(null,c,p,e),[e]),p.getSnapshot!==r||S||In!==null&&In.memoizedState.tag&1){if(c.flags|=2048,Aa(9,{destroy:void 0},Um.bind(null,c,p,l,r),null),gn===null)throw Error(a(349));g||(js&127)!==0||zm(c,r,l)}return l}function zm(e,r,l){e.flags|=16384,e={getSnapshot:r,value:l},r=Bt.updateQueue,r===null?(r=Cc(),Bt.updateQueue=r,r.stores=[e]):(l=r.stores,l===null?r.stores=[e]:l.push(e))}function Um(e,r,l,c){r.value=l,r.getSnapshot=c,Im(r)&&Bm(e)}function Lm(e,r,l){return l(function(){Im(r)&&Bm(e)})}function Im(e){var r=e.getSnapshot;e=e.value;try{var l=r();return!wr(e,l)}catch{return!0}}function Bm(e){var r=Mi(e,2);r!==null&&yr(r,e,2)}function Yd(e){var r=cr();if(typeof e=="function"){var l=e;if(e=l(),Fi){tn(!0);try{l()}finally{tn(!1)}}}return r.memoizedState=r.baseState=e,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:e},r}function $m(e,r,l,c){return e.baseState=l,Vd(e,fn,typeof c=="function"?c:_s)}function hw(e,r,l,c,p){if(Rc(e))throw Error(a(485));if(e=r.action,e!==null){var g={payload:p,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){g.listeners.push(S)}};R.T!==null?l(!0):g.isTransition=!1,c(g),l=r.pending,l===null?(g.next=r.pending=g,Pm(r,g)):(g.next=l.next,r.pending=l.next=g)}}function Pm(e,r){var l=r.action,c=r.payload,p=e.state;if(r.isTransition){var g=R.T,S={};R.T=S;try{var A=l(p,c),W=R.S;W!==null&&W(S,A),qm(e,r,A)}catch(me){Wd(e,r,me)}finally{g!==null&&S.types!==null&&(g.types=S.types),R.T=g}}else try{g=l(p,c),qm(e,r,g)}catch(me){Wd(e,r,me)}}function qm(e,r,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){Fm(e,r,c)},function(c){return Wd(e,r,c)}):Fm(e,r,l)}function Fm(e,r,l){r.status="fulfilled",r.value=l,Hm(r),e.state=l,r=e.pending,r!==null&&(l=r.next,l===r?e.pending=null:(l=l.next,r.next=l,Pm(e,l)))}function Wd(e,r,l){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=l,Hm(r),r=r.next;while(r!==c)}e.action=null}function Hm(e){e=e.listeners;for(var r=0;r<e.length;r++)(0,e[r])()}function Gm(e,r){return r}function Vm(e,r){if(Wt){var l=gn.formState;if(l!==null){e:{var c=Bt;if(Wt){if(wn){t:{for(var p=wn,g=Pr;p.nodeType!==8;){if(!g){p=null;break t}if(p=Fr(p.nextSibling),p===null){p=null;break t}}g=p.data,p=g==="F!"||g==="F"?p:null}if(p){wn=Fr(p.nextSibling),c=p.data==="F!";break e}}ti(c)}c=!1}c&&(r=l[0])}}return l=cr(),l.memoizedState=l.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Gm,lastRenderedState:r},l.queue=c,l=dg.bind(null,Bt,c),c.dispatch=l,c=Yd(!1),g=th.bind(null,Bt,!1,c.queue),c=cr(),p={state:r,dispatch:null,action:e,pending:null},c.queue=p,l=hw.bind(null,Bt,p,g,l),p.dispatch=l,c.memoizedState=e,[r,l,!1]}function Km(e){var r=Mn();return Ym(r,fn,e)}function Ym(e,r,l){if(r=Vd(e,r,Gm)[0],e=Ec(_s)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=Hl(r)}catch(S){throw S===Na?yc:S}else c=r;r=Mn();var p=r.queue,g=p.dispatch;return l!==r.memoizedState&&(Bt.flags|=2048,Aa(9,{destroy:void 0},fw.bind(null,p,l),null)),[c,g,e]}function fw(e,r){e.action=r}function Wm(e){var r=Mn(),l=fn;if(l!==null)return Ym(r,l,e);Mn(),r=r.memoizedState,l=Mn();var c=l.queue.dispatch;return l.memoizedState=e,[r,c,!1]}function Aa(e,r,l,c){return e={tag:e,create:l,deps:c,inst:r,next:null},r=Bt.updateQueue,r===null&&(r=Cc(),Bt.updateQueue=r),l=r.lastEffect,l===null?r.lastEffect=e.next=e:(c=l.next,l.next=e,e.next=c,r.lastEffect=e),e}function Qm(){return Mn().memoizedState}function kc(e,r,l,c){var p=cr();Bt.flags|=e,p.memoizedState=Aa(1|r,{destroy:void 0},l,c===void 0?null:c)}function Tc(e,r,l,c){var p=Mn();c=c===void 0?null:c;var g=p.memoizedState.inst;fn!==null&&c!==null&&$d(c,fn.memoizedState.deps)?p.memoizedState=Aa(r,g,l,c):(Bt.flags|=e,p.memoizedState=Aa(1|r,g,l,c))}function Jm(e,r){kc(8390656,8,e,r)}function Qd(e,r){Tc(2048,8,e,r)}function pw(e){Bt.flags|=4;var r=Bt.updateQueue;if(r===null)r=Cc(),Bt.updateQueue=r,r.events=[e];else{var l=r.events;l===null?r.events=[e]:l.push(e)}}function Xm(e){var r=Mn().memoizedState;return pw({ref:r,nextImpl:e}),function(){if((sn&2)!==0)throw Error(a(440));return r.impl.apply(void 0,arguments)}}function Zm(e,r){return Tc(4,2,e,r)}function eg(e,r){return Tc(4,4,e,r)}function tg(e,r){if(typeof r=="function"){e=e();var l=r(e);return function(){typeof l=="function"?l():r(null)}}if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function ng(e,r,l){l=l!=null?l.concat([e]):null,Tc(4,4,tg.bind(null,r,e),l)}function Jd(){}function rg(e,r){var l=Mn();r=r===void 0?null:r;var c=l.memoizedState;return r!==null&&$d(r,c[1])?c[0]:(l.memoizedState=[e,r],e)}function sg(e,r){var l=Mn();r=r===void 0?null:r;var c=l.memoizedState;if(r!==null&&$d(r,c[1]))return c[0];if(c=e(),Fi){tn(!0);try{e()}finally{tn(!1)}}return l.memoizedState=[c,r],c}function Xd(e,r,l){return l===void 0||(js&1073741824)!==0&&(Kt&261930)===0?e.memoizedState=r:(e.memoizedState=l,e=iy(),Bt.lanes|=e,ui|=e,l)}function ig(e,r,l,c){return wr(l,r)?l:ka.current!==null?(e=Xd(e,l,c),wr(e,r)||(Bn=!0),e):(js&42)===0||(js&1073741824)!==0&&(Kt&261930)===0?(Bn=!0,e.memoizedState=l):(e=iy(),Bt.lanes|=e,ui|=e,r)}function ag(e,r,l,c,p){var g=z.p;z.p=g!==0&&8>g?g:8;var S=R.T,A={};R.T=A,th(e,!1,r,l);try{var W=p(),me=R.S;if(me!==null&&me(A,W),W!==null&&typeof W=="object"&&typeof W.then=="function"){var Ne=cw(W,c);Gl(e,r,Ne,Er(e))}else Gl(e,r,c,Er(e))}catch(Te){Gl(e,r,{then:function(){},status:"rejected",reason:Te},Er())}finally{z.p=g,S!==null&&A.types!==null&&(S.types=A.types),R.T=S}}function mw(){}function Zd(e,r,l,c){if(e.tag!==5)throw Error(a(476));var p=lg(e).queue;ag(e,p,r,K,l===null?mw:function(){return og(e),l(c)})}function lg(e){var r=e.memoizedState;if(r!==null)return r;r={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:K},next:null};var l={};return r.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_s,lastRenderedState:l},next:null},e.memoizedState=r,e=e.alternate,e!==null&&(e.memoizedState=r),r}function og(e){var r=lg(e);r.next===null&&(r=e.alternate.memoizedState),Gl(e,r.next.queue,{},Er())}function eh(){return Xn(oo)}function cg(){return Mn().memoizedState}function ug(){return Mn().memoizedState}function gw(e){for(var r=e.return;r!==null;){switch(r.tag){case 24:case 3:var l=Er();e=si(l);var c=ii(r,e,l);c!==null&&(yr(c,r,l),$l(c,r,l)),r={cache:Td()},e.payload=r;return}r=r.return}}function yw(e,r,l){var c=Er();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Rc(e)?hg(r,l):(l=vd(e,r,l,c),l!==null&&(yr(l,e,c),fg(l,r,c)))}function dg(e,r,l){var c=Er();Gl(e,r,l,c)}function Gl(e,r,l,c){var p={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Rc(e))hg(r,p);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=r.lastRenderedReducer,g!==null))try{var S=r.lastRenderedState,A=g(S,l);if(p.hasEagerState=!0,p.eagerState=A,wr(A,S))return uc(e,r,p,0),gn===null&&cc(),!1}catch{}if(l=vd(e,r,p,c),l!==null)return yr(l,e,c),fg(l,r,c),!0}return!1}function th(e,r,l,c){if(c={lane:2,revertLane:Dh(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Rc(e)){if(r)throw Error(a(479))}else r=vd(e,l,c,2),r!==null&&yr(r,e,2)}function Rc(e){var r=e.alternate;return e===Bt||r!==null&&r===Bt}function hg(e,r){Ta=jc=!0;var l=e.pending;l===null?r.next=r:(r.next=l.next,l.next=r),e.pending=r}function fg(e,r,l){if((l&4194048)!==0){var c=r.lanes;c&=e.pendingLanes,l|=c,r.lanes=l,mt(e,l)}}var Vl={readContext:Xn,use:Nc,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useLayoutEffect:Rn,useInsertionEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useSyncExternalStore:Rn,useId:Rn,useHostTransitionStatus:Rn,useFormState:Rn,useActionState:Rn,useOptimistic:Rn,useMemoCache:Rn,useCacheRefresh:Rn};Vl.useEffectEvent=Rn;var pg={readContext:Xn,use:Nc,useCallback:function(e,r){return cr().memoizedState=[e,r===void 0?null:r],e},useContext:Xn,useEffect:Jm,useImperativeHandle:function(e,r,l){l=l!=null?l.concat([e]):null,kc(4194308,4,tg.bind(null,r,e),l)},useLayoutEffect:function(e,r){return kc(4194308,4,e,r)},useInsertionEffect:function(e,r){kc(4,2,e,r)},useMemo:function(e,r){var l=cr();r=r===void 0?null:r;var c=e();if(Fi){tn(!0);try{e()}finally{tn(!1)}}return l.memoizedState=[c,r],c},useReducer:function(e,r,l){var c=cr();if(l!==void 0){var p=l(r);if(Fi){tn(!0);try{l(r)}finally{tn(!1)}}}else p=r;return c.memoizedState=c.baseState=p,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:p},c.queue=e,e=e.dispatch=yw.bind(null,Bt,e),[c.memoizedState,e]},useRef:function(e){var r=cr();return e={current:e},r.memoizedState=e},useState:function(e){e=Yd(e);var r=e.queue,l=dg.bind(null,Bt,r);return r.dispatch=l,[e.memoizedState,l]},useDebugValue:Jd,useDeferredValue:function(e,r){var l=cr();return Xd(l,e,r)},useTransition:function(){var e=Yd(!1);return e=ag.bind(null,Bt,e.queue,!0,!1),cr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,r,l){var c=Bt,p=cr();if(Wt){if(l===void 0)throw Error(a(407));l=l()}else{if(l=r(),gn===null)throw Error(a(349));(Kt&127)!==0||zm(c,r,l)}p.memoizedState=l;var g={value:l,getSnapshot:r};return p.queue=g,Jm(Lm.bind(null,c,g,e),[e]),c.flags|=2048,Aa(9,{destroy:void 0},Um.bind(null,c,g,l,r),null),l},useId:function(){var e=cr(),r=gn.identifierPrefix;if(Wt){var l=hs,c=ds;l=(c&~(1<<32-qt(c)-1)).toString(32)+l,r="_"+r+"R_"+l,l=_c++,0<l&&(r+="H"+l.toString(32)),r+="_"}else l=uw++,r="_"+r+"r_"+l.toString(32)+"_";return e.memoizedState=r},useHostTransitionStatus:eh,useFormState:Vm,useActionState:Vm,useOptimistic:function(e){var r=cr();r.memoizedState=r.baseState=e;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=l,r=th.bind(null,Bt,!0,l),l.dispatch=r,[e,r]},useMemoCache:Gd,useCacheRefresh:function(){return cr().memoizedState=gw.bind(null,Bt)},useEffectEvent:function(e){var r=cr(),l={impl:e};return r.memoizedState=l,function(){if((sn&2)!==0)throw Error(a(440));return l.impl.apply(void 0,arguments)}}},nh={readContext:Xn,use:Nc,useCallback:rg,useContext:Xn,useEffect:Qd,useImperativeHandle:ng,useInsertionEffect:Zm,useLayoutEffect:eg,useMemo:sg,useReducer:Ec,useRef:Qm,useState:function(){return Ec(_s)},useDebugValue:Jd,useDeferredValue:function(e,r){var l=Mn();return ig(l,fn.memoizedState,e,r)},useTransition:function(){var e=Ec(_s)[0],r=Mn().memoizedState;return[typeof e=="boolean"?e:Hl(e),r]},useSyncExternalStore:Mm,useId:cg,useHostTransitionStatus:eh,useFormState:Km,useActionState:Km,useOptimistic:function(e,r){var l=Mn();return $m(l,fn,e,r)},useMemoCache:Gd,useCacheRefresh:ug};nh.useEffectEvent=Xm;var mg={readContext:Xn,use:Nc,useCallback:rg,useContext:Xn,useEffect:Qd,useImperativeHandle:ng,useInsertionEffect:Zm,useLayoutEffect:eg,useMemo:sg,useReducer:Kd,useRef:Qm,useState:function(){return Kd(_s)},useDebugValue:Jd,useDeferredValue:function(e,r){var l=Mn();return fn===null?Xd(l,e,r):ig(l,fn.memoizedState,e,r)},useTransition:function(){var e=Kd(_s)[0],r=Mn().memoizedState;return[typeof e=="boolean"?e:Hl(e),r]},useSyncExternalStore:Mm,useId:cg,useHostTransitionStatus:eh,useFormState:Wm,useActionState:Wm,useOptimistic:function(e,r){var l=Mn();return fn!==null?$m(l,fn,e,r):(l.baseState=e,[e,l.queue.dispatch])},useMemoCache:Gd,useCacheRefresh:ug};mg.useEffectEvent=Xm;function rh(e,r,l,c){r=e.memoizedState,l=l(c,r),l=l==null?r:v({},r,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var sh={enqueueSetState:function(e,r,l){e=e._reactInternals;var c=Er(),p=si(c);p.payload=r,l!=null&&(p.callback=l),r=ii(e,p,c),r!==null&&(yr(r,e,c),$l(r,e,c))},enqueueReplaceState:function(e,r,l){e=e._reactInternals;var c=Er(),p=si(c);p.tag=1,p.payload=r,l!=null&&(p.callback=l),r=ii(e,p,c),r!==null&&(yr(r,e,c),$l(r,e,c))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var l=Er(),c=si(l);c.tag=2,r!=null&&(c.callback=r),r=ii(e,c,l),r!==null&&(yr(r,e,l),$l(r,e,l))}};function gg(e,r,l,c,p,g,S){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,S):r.prototype&&r.prototype.isPureReactComponent?!Ol(l,c)||!Ol(p,g):!0}function yg(e,r,l,c){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,c),r.state!==e&&sh.enqueueReplaceState(r,r.state,null)}function Hi(e,r){var l=r;if("ref"in r){l={};for(var c in r)c!=="ref"&&(l[c]=r[c])}if(e=e.defaultProps){l===r&&(l=v({},l));for(var p in e)l[p]===void 0&&(l[p]=e[p])}return l}function vg(e){oc(e)}function xg(e){console.error(e)}function bg(e){oc(e)}function Ac(e,r){try{var l=e.onUncaughtError;l(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function wg(e,r,l){try{var c=e.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function ih(e,r,l){return l=si(l),l.tag=3,l.payload={element:null},l.callback=function(){Ac(e,r)},l}function Sg(e){return e=si(e),e.tag=3,e}function jg(e,r,l,c){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var g=c.value;e.payload=function(){return p(g)},e.callback=function(){wg(r,l,c)}}var S=l.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(e.callback=function(){wg(r,l,c),typeof p!="function"&&(di===null?di=new Set([this]):di.add(this));var A=c.stack;this.componentDidCatch(c.value,{componentStack:A!==null?A:""})})}function vw(e,r,l,c,p){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=l.alternate,r!==null&&ja(r,l,p,!0),l=jr.current,l!==null){switch(l.tag){case 31:case 13:return qr===null?Fc():l.alternate===null&&An===0&&(An=3),l.flags&=-257,l.flags|=65536,l.lanes=p,c===vc?l.flags|=16384:(r=l.updateQueue,r===null?l.updateQueue=new Set([c]):r.add(c),Rh(e,c,p)),!1;case 22:return l.flags|=65536,c===vc?l.flags|=16384:(r=l.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=r):(l=r.retryQueue,l===null?r.retryQueue=new Set([c]):l.add(c)),Rh(e,c,p)),!1}throw Error(a(435,l.tag))}return Rh(e,c,p),Fc(),!1}if(Wt)return r=jr.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=p,c!==_d&&(e=Error(a(422),{cause:c}),zl(Ir(e,l)))):(c!==_d&&(r=Error(a(423),{cause:c}),zl(Ir(r,l))),e=e.current.alternate,e.flags|=65536,p&=-p,e.lanes|=p,c=Ir(c,l),p=ih(e.stateNode,c,p),zd(e,p),An!==4&&(An=2)),!1;var g=Error(a(520),{cause:c});if(g=Ir(g,l),eo===null?eo=[g]:eo.push(g),An!==4&&(An=2),r===null)return!0;c=Ir(c,l),l=r;do{switch(l.tag){case 3:return l.flags|=65536,e=p&-p,l.lanes|=e,e=ih(l.stateNode,c,e),zd(l,e),!1;case 1:if(r=l.type,g=l.stateNode,(l.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(di===null||!di.has(g))))return l.flags|=65536,p&=-p,l.lanes|=p,p=Sg(p),jg(p,e,l,c),zd(l,p),!1}l=l.return}while(l!==null);return!1}var ah=Error(a(461)),Bn=!1;function Zn(e,r,l,c){r.child=e===null?Em(r,null,l,c):qi(r,e.child,l,c)}function _g(e,r,l,c,p){l=l.render;var g=r.ref;if("ref"in c){var S={};for(var A in c)A!=="ref"&&(S[A]=c[A])}else S=c;return Ii(r),c=Pd(e,r,l,S,g,p),A=qd(),e!==null&&!Bn?(Fd(e,r,p),Cs(e,r,p)):(Wt&&A&&Sd(r),r.flags|=1,Zn(e,r,c,p),r.child)}function Cg(e,r,l,c,p){if(e===null){var g=l.type;return typeof g=="function"&&!xd(g)&&g.defaultProps===void 0&&l.compare===null?(r.tag=15,r.type=g,Ng(e,r,g,c,p)):(e=hc(l.type,null,c,r,r.mode,p),e.ref=r.ref,e.return=r,r.child=e)}if(g=e.child,!ph(e,p)){var S=g.memoizedProps;if(l=l.compare,l=l!==null?l:Ol,l(S,c)&&e.ref===r.ref)return Cs(e,r,p)}return r.flags|=1,e=xs(g,c),e.ref=r.ref,e.return=r,r.child=e}function Ng(e,r,l,c,p){if(e!==null){var g=e.memoizedProps;if(Ol(g,c)&&e.ref===r.ref)if(Bn=!1,r.pendingProps=c=g,ph(e,p))(e.flags&131072)!==0&&(Bn=!0);else return r.lanes=e.lanes,Cs(e,r,p)}return lh(e,r,l,c,p)}function Eg(e,r,l,c){var p=c.children,g=e!==null?e.memoizedState:null;if(e===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((r.flags&128)!==0){if(g=g!==null?g.baseLanes|l:l,e!==null){for(c=r.child=e.child,p=0;c!==null;)p=p|c.lanes|c.childLanes,c=c.sibling;c=p&~g}else c=0,r.child=null;return kg(e,r,g,l,c)}if((l&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},e!==null&&gc(r,g!==null?g.cachePool:null),g!==null?Rm(r,g):Ld(),Am(r);else return c=r.lanes=536870912,kg(e,r,g!==null?g.baseLanes|l:l,l,c)}else g!==null?(gc(r,g.cachePool),Rm(r,g),li(),r.memoizedState=null):(e!==null&&gc(r,null),Ld(),li());return Zn(e,r,p,l),r.child}function Kl(e,r){return e!==null&&e.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function kg(e,r,l,c,p){var g=Ad();return g=g===null?null:{parent:Ln._currentValue,pool:g},r.memoizedState={baseLanes:l,cachePool:g},e!==null&&gc(r,null),Ld(),Am(r),e!==null&&ja(e,r,c,!0),r.childLanes=p,null}function Oc(e,r){return r=Mc({mode:r.mode,children:r.children},e.mode),r.ref=e.ref,e.child=r,r.return=e,r}function Tg(e,r,l){return qi(r,e.child,null,l),e=Oc(r,r.pendingProps),e.flags|=2,_r(r),r.memoizedState=null,e}function xw(e,r,l){var c=r.pendingProps,p=(r.flags&128)!==0;if(r.flags&=-129,e===null){if(Wt){if(c.mode==="hidden")return e=Oc(r,c),r.lanes=536870912,Kl(null,e);if(Bd(r),(e=wn)?(e=Py(e,Pr),e=e!==null&&e.data==="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Zs!==null?{id:ds,overflow:hs}:null,retryLane:536870912,hydrationErrors:null},l=hm(e),l.return=r,r.child=l,Jn=r,wn=null)):e=null,e===null)throw ti(r);return r.lanes=536870912,null}return Oc(r,c)}var g=e.memoizedState;if(g!==null){var S=g.dehydrated;if(Bd(r),p)if(r.flags&256)r.flags&=-257,r=Tg(e,r,l);else if(r.memoizedState!==null)r.child=e.child,r.flags|=128,r=null;else throw Error(a(558));else if(Bn||ja(e,r,l,!1),p=(l&e.childLanes)!==0,Bn||p){if(c=gn,c!==null&&(S=Zt(c,l),S!==0&&S!==g.retryLane))throw g.retryLane=S,Mi(e,S),yr(c,e,S),ah;Fc(),r=Tg(e,r,l)}else e=g.treeContext,wn=Fr(S.nextSibling),Jn=r,Wt=!0,ei=null,Pr=!1,e!==null&&mm(r,e),r=Oc(r,c),r.flags|=4096;return r}return e=xs(e.child,{mode:c.mode,children:c.children}),e.ref=r.ref,r.child=e,e.return=r,e}function Dc(e,r){var l=r.ref;if(l===null)e!==null&&e.ref!==null&&(r.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(a(284));(e===null||e.ref!==l)&&(r.flags|=4194816)}}function lh(e,r,l,c,p){return Ii(r),l=Pd(e,r,l,c,void 0,p),c=qd(),e!==null&&!Bn?(Fd(e,r,p),Cs(e,r,p)):(Wt&&c&&Sd(r),r.flags|=1,Zn(e,r,l,p),r.child)}function Rg(e,r,l,c,p,g){return Ii(r),r.updateQueue=null,l=Dm(r,c,l,p),Om(e),c=qd(),e!==null&&!Bn?(Fd(e,r,g),Cs(e,r,g)):(Wt&&c&&Sd(r),r.flags|=1,Zn(e,r,l,g),r.child)}function Ag(e,r,l,c,p){if(Ii(r),r.stateNode===null){var g=xa,S=l.contextType;typeof S=="object"&&S!==null&&(g=Xn(S)),g=new l(c,g),r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=sh,r.stateNode=g,g._reactInternals=r,g=r.stateNode,g.props=c,g.state=r.memoizedState,g.refs={},Dd(r),S=l.contextType,g.context=typeof S=="object"&&S!==null?Xn(S):xa,g.state=r.memoizedState,S=l.getDerivedStateFromProps,typeof S=="function"&&(rh(r,l,S,c),g.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(S=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),S!==g.state&&sh.enqueueReplaceState(g,g.state,null),ql(r,c,g,p),Pl(),g.state=r.memoizedState),typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(e===null){g=r.stateNode;var A=r.memoizedProps,W=Hi(l,A);g.props=W;var me=g.context,Ne=l.contextType;S=xa,typeof Ne=="object"&&Ne!==null&&(S=Xn(Ne));var Te=l.getDerivedStateFromProps;Ne=typeof Te=="function"||typeof g.getSnapshotBeforeUpdate=="function",A=r.pendingProps!==A,Ne||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(A||me!==S)&&yg(r,g,c,S),ri=!1;var ge=r.memoizedState;g.state=ge,ql(r,c,g,p),Pl(),me=r.memoizedState,A||ge!==me||ri?(typeof Te=="function"&&(rh(r,l,Te,c),me=r.memoizedState),(W=ri||gg(r,l,W,c,ge,me,S))?(Ne||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=me),g.props=c,g.state=me,g.context=S,c=W):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{g=r.stateNode,Md(e,r),S=r.memoizedProps,Ne=Hi(l,S),g.props=Ne,Te=r.pendingProps,ge=g.context,me=l.contextType,W=xa,typeof me=="object"&&me!==null&&(W=Xn(me)),A=l.getDerivedStateFromProps,(me=typeof A=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(S!==Te||ge!==W)&&yg(r,g,c,W),ri=!1,ge=r.memoizedState,g.state=ge,ql(r,c,g,p),Pl();var Se=r.memoizedState;S!==Te||ge!==Se||ri||e!==null&&e.dependencies!==null&&pc(e.dependencies)?(typeof A=="function"&&(rh(r,l,A,c),Se=r.memoizedState),(Ne=ri||gg(r,l,Ne,c,ge,Se,W)||e!==null&&e.dependencies!==null&&pc(e.dependencies))?(me||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,Se,W),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,Se,W)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||S===e.memoizedProps&&ge===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&ge===e.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=Se),g.props=c,g.state=Se,g.context=W,c=Ne):(typeof g.componentDidUpdate!="function"||S===e.memoizedProps&&ge===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&ge===e.memoizedState||(r.flags|=1024),c=!1)}return g=c,Dc(e,r),c=(r.flags&128)!==0,g||c?(g=r.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:g.render(),r.flags|=1,e!==null&&c?(r.child=qi(r,e.child,null,p),r.child=qi(r,null,l,p)):Zn(e,r,l,p),r.memoizedState=g.state,e=r.child):e=Cs(e,r,p),e}function Og(e,r,l,c){return Ui(),r.flags|=256,Zn(e,r,l,c),r.child}var oh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ch(e){return{baseLanes:e,cachePool:wm()}}function uh(e,r,l){return e=e!==null?e.childLanes&~l:0,r&&(e|=Nr),e}function Dg(e,r,l){var c=r.pendingProps,p=!1,g=(r.flags&128)!==0,S;if((S=g)||(S=e!==null&&e.memoizedState===null?!1:(Dn.current&2)!==0),S&&(p=!0,r.flags&=-129),S=(r.flags&32)!==0,r.flags&=-33,e===null){if(Wt){if(p?ai(r):li(),(e=wn)?(e=Py(e,Pr),e=e!==null&&e.data!=="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Zs!==null?{id:ds,overflow:hs}:null,retryLane:536870912,hydrationErrors:null},l=hm(e),l.return=r,r.child=l,Jn=r,wn=null)):e=null,e===null)throw ti(r);return Vh(e)?r.lanes=32:r.lanes=536870912,null}var A=c.children;return c=c.fallback,p?(li(),p=r.mode,A=Mc({mode:"hidden",children:A},p),c=zi(c,p,l,null),A.return=r,c.return=r,A.sibling=c,r.child=A,c=r.child,c.memoizedState=ch(l),c.childLanes=uh(e,S,l),r.memoizedState=oh,Kl(null,c)):(ai(r),dh(r,A))}var W=e.memoizedState;if(W!==null&&(A=W.dehydrated,A!==null)){if(g)r.flags&256?(ai(r),r.flags&=-257,r=hh(e,r,l)):r.memoizedState!==null?(li(),r.child=e.child,r.flags|=128,r=null):(li(),A=c.fallback,p=r.mode,c=Mc({mode:"visible",children:c.children},p),A=zi(A,p,l,null),A.flags|=2,c.return=r,A.return=r,c.sibling=A,r.child=c,qi(r,e.child,null,l),c=r.child,c.memoizedState=ch(l),c.childLanes=uh(e,S,l),r.memoizedState=oh,r=Kl(null,c));else if(ai(r),Vh(A)){if(S=A.nextSibling&&A.nextSibling.dataset,S)var me=S.dgst;S=me,c=Error(a(419)),c.stack="",c.digest=S,zl({value:c,source:null,stack:null}),r=hh(e,r,l)}else if(Bn||ja(e,r,l,!1),S=(l&e.childLanes)!==0,Bn||S){if(S=gn,S!==null&&(c=Zt(S,l),c!==0&&c!==W.retryLane))throw W.retryLane=c,Mi(e,c),yr(S,e,c),ah;Gh(A)||Fc(),r=hh(e,r,l)}else Gh(A)?(r.flags|=192,r.child=e.child,r=null):(e=W.treeContext,wn=Fr(A.nextSibling),Jn=r,Wt=!0,ei=null,Pr=!1,e!==null&&mm(r,e),r=dh(r,c.children),r.flags|=4096);return r}return p?(li(),A=c.fallback,p=r.mode,W=e.child,me=W.sibling,c=xs(W,{mode:"hidden",children:c.children}),c.subtreeFlags=W.subtreeFlags&65011712,me!==null?A=xs(me,A):(A=zi(A,p,l,null),A.flags|=2),A.return=r,c.return=r,c.sibling=A,r.child=c,Kl(null,c),c=r.child,A=e.child.memoizedState,A===null?A=ch(l):(p=A.cachePool,p!==null?(W=Ln._currentValue,p=p.parent!==W?{parent:W,pool:W}:p):p=wm(),A={baseLanes:A.baseLanes|l,cachePool:p}),c.memoizedState=A,c.childLanes=uh(e,S,l),r.memoizedState=oh,Kl(e.child,c)):(ai(r),l=e.child,e=l.sibling,l=xs(l,{mode:"visible",children:c.children}),l.return=r,l.sibling=null,e!==null&&(S=r.deletions,S===null?(r.deletions=[e],r.flags|=16):S.push(e)),r.child=l,r.memoizedState=null,l)}function dh(e,r){return r=Mc({mode:"visible",children:r},e.mode),r.return=e,e.child=r}function Mc(e,r){return e=Sr(22,e,null,r),e.lanes=0,e}function hh(e,r,l){return qi(r,e.child,null,l),e=dh(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function Mg(e,r,l){e.lanes|=r;var c=e.alternate;c!==null&&(c.lanes|=r),Ed(e.return,r,l)}function fh(e,r,l,c,p,g){var S=e.memoizedState;S===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:p,treeForkCount:g}:(S.isBackwards=r,S.rendering=null,S.renderingStartTime=0,S.last=c,S.tail=l,S.tailMode=p,S.treeForkCount=g)}function zg(e,r,l){var c=r.pendingProps,p=c.revealOrder,g=c.tail;c=c.children;var S=Dn.current,A=(S&2)!==0;if(A?(S=S&1|2,r.flags|=128):S&=1,X(Dn,S),Zn(e,r,c,l),c=Wt?Ml:0,!A&&e!==null&&(e.flags&128)!==0)e:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Mg(e,l,r);else if(e.tag===19)Mg(e,l,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break e;for(;e.sibling===null;){if(e.return===null||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(p){case"forwards":for(l=r.child,p=null;l!==null;)e=l.alternate,e!==null&&Sc(e)===null&&(p=l),l=l.sibling;l=p,l===null?(p=r.child,r.child=null):(p=l.sibling,l.sibling=null),fh(r,!1,p,l,g,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,p=r.child,r.child=null;p!==null;){if(e=p.alternate,e!==null&&Sc(e)===null){r.child=p;break}e=p.sibling,p.sibling=l,l=p,p=e}fh(r,!0,l,null,g,c);break;case"together":fh(r,!1,null,null,void 0,c);break;default:r.memoizedState=null}return r.child}function Cs(e,r,l){if(e!==null&&(r.dependencies=e.dependencies),ui|=r.lanes,(l&r.childLanes)===0)if(e!==null){if(ja(e,r,l,!1),(l&r.childLanes)===0)return null}else return null;if(e!==null&&r.child!==e.child)throw Error(a(153));if(r.child!==null){for(e=r.child,l=xs(e,e.pendingProps),r.child=l,l.return=r;e.sibling!==null;)e=e.sibling,l=l.sibling=xs(e,e.pendingProps),l.return=r;l.sibling=null}return r.child}function ph(e,r){return(e.lanes&r)!==0?!0:(e=e.dependencies,!!(e!==null&&pc(e)))}function bw(e,r,l){switch(r.tag){case 3:H(r,r.stateNode.containerInfo),ni(r,Ln,e.memoizedState.cache),Ui();break;case 27:case 5:oe(r);break;case 4:H(r,r.stateNode.containerInfo);break;case 10:ni(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Bd(r),null;break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(ai(r),r.flags|=128,null):(l&r.child.childLanes)!==0?Dg(e,r,l):(ai(r),e=Cs(e,r,l),e!==null?e.sibling:null);ai(r);break;case 19:var p=(e.flags&128)!==0;if(c=(l&r.childLanes)!==0,c||(ja(e,r,l,!1),c=(l&r.childLanes)!==0),p){if(c)return zg(e,r,l);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),X(Dn,Dn.current),c)break;return null;case 22:return r.lanes=0,Eg(e,r,l,r.pendingProps);case 24:ni(r,Ln,e.memoizedState.cache)}return Cs(e,r,l)}function Ug(e,r,l){if(e!==null)if(e.memoizedProps!==r.pendingProps)Bn=!0;else{if(!ph(e,l)&&(r.flags&128)===0)return Bn=!1,bw(e,r,l);Bn=(e.flags&131072)!==0}else Bn=!1,Wt&&(r.flags&1048576)!==0&&pm(r,Ml,r.index);switch(r.lanes=0,r.tag){case 16:e:{var c=r.pendingProps;if(e=$i(r.elementType),r.type=e,typeof e=="function")xd(e)?(c=Hi(e,c),r.tag=1,r=Ag(null,r,e,c,l)):(r.tag=0,r=lh(null,r,e,c,l));else{if(e!=null){var p=e.$$typeof;if(p===U){r.tag=11,r=_g(null,r,e,c,l);break e}else if(p===N){r.tag=14,r=Cg(null,r,e,c,l);break e}}throw r=I(e)||e,Error(a(306,r,""))}}return r;case 0:return lh(e,r,r.type,r.pendingProps,l);case 1:return c=r.type,p=Hi(c,r.pendingProps),Ag(e,r,c,p,l);case 3:e:{if(H(r,r.stateNode.containerInfo),e===null)throw Error(a(387));c=r.pendingProps;var g=r.memoizedState;p=g.element,Md(e,r),ql(r,c,null,l);var S=r.memoizedState;if(c=S.cache,ni(r,Ln,c),c!==g.cache&&kd(r,[Ln],l,!0),Pl(),c=S.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:S.cache},r.updateQueue.baseState=g,r.memoizedState=g,r.flags&256){r=Og(e,r,c,l);break e}else if(c!==p){p=Ir(Error(a(424)),r),zl(p),r=Og(e,r,c,l);break e}else for(e=r.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,wn=Fr(e.firstChild),Jn=r,Wt=!0,ei=null,Pr=!0,l=Em(r,null,c,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Ui(),c===p){r=Cs(e,r,l);break e}Zn(e,r,c,l)}r=r.child}return r;case 26:return Dc(e,r),e===null?(l=Ky(r.type,null,r.pendingProps,null))?r.memoizedState=l:Wt||(l=r.type,e=r.pendingProps,c=Qc(Ue.current).createElement(l),c[He]=r,c[pt]=e,er(c,l,e),It(c),r.stateNode=c):r.memoizedState=Ky(r.type,e.memoizedProps,r.pendingProps,e.memoizedState),null;case 27:return oe(r),e===null&&Wt&&(c=r.stateNode=Hy(r.type,r.pendingProps,Ue.current),Jn=r,Pr=!0,p=wn,mi(r.type)?(Kh=p,wn=Fr(c.firstChild)):wn=p),Zn(e,r,r.pendingProps.children,l),Dc(e,r),e===null&&(r.flags|=4194304),r.child;case 5:return e===null&&Wt&&((p=c=wn)&&(c=Qw(c,r.type,r.pendingProps,Pr),c!==null?(r.stateNode=c,Jn=r,wn=Fr(c.firstChild),Pr=!1,p=!0):p=!1),p||ti(r)),oe(r),p=r.type,g=r.pendingProps,S=e!==null?e.memoizedProps:null,c=g.children,qh(p,g)?c=null:S!==null&&qh(p,S)&&(r.flags|=32),r.memoizedState!==null&&(p=Pd(e,r,dw,null,null,l),oo._currentValue=p),Dc(e,r),Zn(e,r,c,l),r.child;case 6:return e===null&&Wt&&((e=l=wn)&&(l=Jw(l,r.pendingProps,Pr),l!==null?(r.stateNode=l,Jn=r,wn=null,e=!0):e=!1),e||ti(r)),null;case 13:return Dg(e,r,l);case 4:return H(r,r.stateNode.containerInfo),c=r.pendingProps,e===null?r.child=qi(r,null,c,l):Zn(e,r,c,l),r.child;case 11:return _g(e,r,r.type,r.pendingProps,l);case 7:return Zn(e,r,r.pendingProps,l),r.child;case 8:return Zn(e,r,r.pendingProps.children,l),r.child;case 12:return Zn(e,r,r.pendingProps.children,l),r.child;case 10:return c=r.pendingProps,ni(r,r.type,c.value),Zn(e,r,c.children,l),r.child;case 9:return p=r.type._context,c=r.pendingProps.children,Ii(r),p=Xn(p),c=c(p),r.flags|=1,Zn(e,r,c,l),r.child;case 14:return Cg(e,r,r.type,r.pendingProps,l);case 15:return Ng(e,r,r.type,r.pendingProps,l);case 19:return zg(e,r,l);case 31:return xw(e,r,l);case 22:return Eg(e,r,l,r.pendingProps);case 24:return Ii(r),c=Xn(Ln),e===null?(p=Ad(),p===null&&(p=gn,g=Td(),p.pooledCache=g,g.refCount++,g!==null&&(p.pooledCacheLanes|=l),p=g),r.memoizedState={parent:c,cache:p},Dd(r),ni(r,Ln,p)):((e.lanes&l)!==0&&(Md(e,r),ql(r,null,null,l),Pl()),p=e.memoizedState,g=r.memoizedState,p.parent!==c?(p={parent:c,cache:c},r.memoizedState=p,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=p),ni(r,Ln,c)):(c=g.cache,ni(r,Ln,c),c!==p.cache&&kd(r,[Ln],l,!0))),Zn(e,r,r.pendingProps.children,l),r.child;case 29:throw r.pendingProps}throw Error(a(156,r.tag))}function Ns(e){e.flags|=4}function mh(e,r,l,c,p){if((r=(e.mode&32)!==0)&&(r=!1),r){if(e.flags|=16777216,(p&335544128)===p)if(e.stateNode.complete)e.flags|=8192;else if(cy())e.flags|=8192;else throw Pi=vc,Od}else e.flags&=-16777217}function Lg(e,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Xy(r))if(cy())e.flags|=8192;else throw Pi=vc,Od}function zc(e,r){r!==null&&(e.flags|=4),e.flags&16384&&(r=e.tag!==22?Lt():536870912,e.lanes|=r,za|=r)}function Yl(e,r){if(!Wt)switch(e.tailMode){case"hidden":r=e.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Sn(e){var r=e.alternate!==null&&e.alternate.child===e.child,l=0,c=0;if(r)for(var p=e.child;p!==null;)l|=p.lanes|p.childLanes,c|=p.subtreeFlags&65011712,c|=p.flags&65011712,p.return=e,p=p.sibling;else for(p=e.child;p!==null;)l|=p.lanes|p.childLanes,c|=p.subtreeFlags,c|=p.flags,p.return=e,p=p.sibling;return e.subtreeFlags|=c,e.childLanes=l,r}function ww(e,r,l){var c=r.pendingProps;switch(jd(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sn(r),null;case 1:return Sn(r),null;case 3:return l=r.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),Ss(Ln),G(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(Sa(r)?Ns(r):e===null||e.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Cd())),Sn(r),null;case 26:var p=r.type,g=r.memoizedState;return e===null?(Ns(r),g!==null?(Sn(r),Lg(r,g)):(Sn(r),mh(r,p,null,c,l))):g?g!==e.memoizedState?(Ns(r),Sn(r),Lg(r,g)):(Sn(r),r.flags&=-16777217):(e=e.memoizedProps,e!==c&&Ns(r),Sn(r),mh(r,p,e,c,l)),null;case 27:if(pe(r),l=Ue.current,p=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&Ns(r);else{if(!c){if(r.stateNode===null)throw Error(a(166));return Sn(r),null}e=fe.current,Sa(r)?gm(r):(e=Hy(p,c,l),r.stateNode=e,Ns(r))}return Sn(r),null;case 5:if(pe(r),p=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&Ns(r);else{if(!c){if(r.stateNode===null)throw Error(a(166));return Sn(r),null}if(g=fe.current,Sa(r))gm(r);else{var S=Qc(Ue.current);switch(g){case 1:g=S.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:g=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":g=S.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":g=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":g=S.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof c.is=="string"?S.createElement("select",{is:c.is}):S.createElement("select"),c.multiple?g.multiple=!0:c.size&&(g.size=c.size);break;default:g=typeof c.is=="string"?S.createElement(p,{is:c.is}):S.createElement(p)}}g[He]=r,g[pt]=c;e:for(S=r.child;S!==null;){if(S.tag===5||S.tag===6)g.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===r)break e;for(;S.sibling===null;){if(S.return===null||S.return===r)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}r.stateNode=g;e:switch(er(g,p,c),p){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Ns(r)}}return Sn(r),mh(r,r.type,e===null?null:e.memoizedProps,r.pendingProps,l),null;case 6:if(e&&r.stateNode!=null)e.memoizedProps!==c&&Ns(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(a(166));if(e=Ue.current,Sa(r)){if(e=r.stateNode,l=r.memoizedProps,c=null,p=Jn,p!==null)switch(p.tag){case 27:case 5:c=p.memoizedProps}e[He]=r,e=!!(e.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||Dy(e.nodeValue,l)),e||ti(r,!0)}else e=Qc(e).createTextNode(c),e[He]=r,r.stateNode=e}return Sn(r),null;case 31:if(l=r.memoizedState,e===null||e.memoizedState!==null){if(c=Sa(r),l!==null){if(e===null){if(!c)throw Error(a(318));if(e=r.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[He]=r}else Ui(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Sn(r),e=!1}else l=Cd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=l),e=!0;if(!e)return r.flags&256?(_r(r),r):(_r(r),null);if((r.flags&128)!==0)throw Error(a(558))}return Sn(r),null;case 13:if(c=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(p=Sa(r),c!==null&&c.dehydrated!==null){if(e===null){if(!p)throw Error(a(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(a(317));p[He]=r}else Ui(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Sn(r),p=!1}else p=Cd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=p),p=!0;if(!p)return r.flags&256?(_r(r),r):(_r(r),null)}return _r(r),(r.flags&128)!==0?(r.lanes=l,r):(l=c!==null,e=e!==null&&e.memoizedState!==null,l&&(c=r.child,p=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(p=c.alternate.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==p&&(c.flags|=2048)),l!==e&&l&&(r.child.flags|=8192),zc(r,r.updateQueue),Sn(r),null);case 4:return G(),e===null&&Lh(r.stateNode.containerInfo),Sn(r),null;case 10:return Ss(r.type),Sn(r),null;case 19:if(Q(Dn),c=r.memoizedState,c===null)return Sn(r),null;if(p=(r.flags&128)!==0,g=c.rendering,g===null)if(p)Yl(c,!1);else{if(An!==0||e!==null&&(e.flags&128)!==0)for(e=r.child;e!==null;){if(g=Sc(e),g!==null){for(r.flags|=128,Yl(c,!1),e=g.updateQueue,r.updateQueue=e,zc(r,e),r.subtreeFlags=0,e=l,l=r.child;l!==null;)dm(l,e),l=l.sibling;return X(Dn,Dn.current&1|2),Wt&&bs(r,c.treeForkCount),r.child}e=e.sibling}c.tail!==null&&Ct()>$c&&(r.flags|=128,p=!0,Yl(c,!1),r.lanes=4194304)}else{if(!p)if(e=Sc(g),e!==null){if(r.flags|=128,p=!0,e=e.updateQueue,r.updateQueue=e,zc(r,e),Yl(c,!0),c.tail===null&&c.tailMode==="hidden"&&!g.alternate&&!Wt)return Sn(r),null}else 2*Ct()-c.renderingStartTime>$c&&l!==536870912&&(r.flags|=128,p=!0,Yl(c,!1),r.lanes=4194304);c.isBackwards?(g.sibling=r.child,r.child=g):(e=c.last,e!==null?e.sibling=g:r.child=g,c.last=g)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=Ct(),e.sibling=null,l=Dn.current,X(Dn,p?l&1|2:l&1),Wt&&bs(r,c.treeForkCount),e):(Sn(r),null);case 22:case 23:return _r(r),Id(),c=r.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(l&536870912)!==0&&(r.flags&128)===0&&(Sn(r),r.subtreeFlags&6&&(r.flags|=8192)):Sn(r),l=r.updateQueue,l!==null&&zc(r,l.retryQueue),l=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==l&&(r.flags|=2048),e!==null&&Q(Bi),null;case 24:return l=null,e!==null&&(l=e.memoizedState.cache),r.memoizedState.cache!==l&&(r.flags|=2048),Ss(Ln),Sn(r),null;case 25:return null;case 30:return null}throw Error(a(156,r.tag))}function Sw(e,r){switch(jd(r),r.tag){case 1:return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return Ss(Ln),G(),e=r.flags,(e&65536)!==0&&(e&128)===0?(r.flags=e&-65537|128,r):null;case 26:case 27:case 5:return pe(r),null;case 31:if(r.memoizedState!==null){if(_r(r),r.alternate===null)throw Error(a(340));Ui()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 13:if(_r(r),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(a(340));Ui()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return Q(Dn),null;case 4:return G(),null;case 10:return Ss(r.type),null;case 22:case 23:return _r(r),Id(),e!==null&&Q(Bi),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 24:return Ss(Ln),null;case 25:return null;default:return null}}function Ig(e,r){switch(jd(r),r.tag){case 3:Ss(Ln),G();break;case 26:case 27:case 5:pe(r);break;case 4:G();break;case 31:r.memoizedState!==null&&_r(r);break;case 13:_r(r);break;case 19:Q(Dn);break;case 10:Ss(r.type);break;case 22:case 23:_r(r),Id(),e!==null&&Q(Bi);break;case 24:Ss(Ln)}}function Wl(e,r){try{var l=r.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var p=c.next;l=p;do{if((l.tag&e)===e){c=void 0;var g=l.create,S=l.inst;c=g(),S.destroy=c}l=l.next}while(l!==p)}}catch(A){hn(r,r.return,A)}}function oi(e,r,l){try{var c=r.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var g=p.next;c=g;do{if((c.tag&e)===e){var S=c.inst,A=S.destroy;if(A!==void 0){S.destroy=void 0,p=r;var W=l,me=A;try{me()}catch(Ne){hn(p,W,Ne)}}}c=c.next}while(c!==g)}}catch(Ne){hn(r,r.return,Ne)}}function Bg(e){var r=e.updateQueue;if(r!==null){var l=e.stateNode;try{Tm(r,l)}catch(c){hn(e,e.return,c)}}}function $g(e,r,l){l.props=Hi(e.type,e.memoizedProps),l.state=e.memoizedState;try{l.componentWillUnmount()}catch(c){hn(e,r,c)}}function Ql(e,r){try{var l=e.ref;if(l!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof l=="function"?e.refCleanup=l(c):l.current=c}}catch(p){hn(e,r,p)}}function fs(e,r){var l=e.ref,c=e.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(p){hn(e,r,p)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){hn(e,r,p)}else l.current=null}function Pg(e){var r=e.type,l=e.memoizedProps,c=e.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(p){hn(e,e.return,p)}}function gh(e,r,l){try{var c=e.stateNode;Hw(c,e.type,l,r),c[pt]=r}catch(p){hn(e,e.return,p)}}function qg(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&mi(e.type)||e.tag===4}function yh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||qg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&mi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function vh(e,r,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(e,r):(r=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,r.appendChild(e),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=zr));else if(c!==4&&(c===27&&mi(e.type)&&(l=e.stateNode,r=null),e=e.child,e!==null))for(vh(e,r,l),e=e.sibling;e!==null;)vh(e,r,l),e=e.sibling}function Uc(e,r,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?l.insertBefore(e,r):l.appendChild(e);else if(c!==4&&(c===27&&mi(e.type)&&(l=e.stateNode),e=e.child,e!==null))for(Uc(e,r,l),e=e.sibling;e!==null;)Uc(e,r,l),e=e.sibling}function Fg(e){var r=e.stateNode,l=e.memoizedProps;try{for(var c=e.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);er(r,c,l),r[He]=e,r[pt]=l}catch(g){hn(e,e.return,g)}}var Es=!1,$n=!1,xh=!1,Hg=typeof WeakSet=="function"?WeakSet:Set,Yn=null;function jw(e,r){if(e=e.containerInfo,$h=ru,e=nm(e),hd(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var p=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var S=0,A=-1,W=-1,me=0,Ne=0,Te=e,ge=null;t:for(;;){for(var Se;Te!==l||p!==0&&Te.nodeType!==3||(A=S+p),Te!==g||c!==0&&Te.nodeType!==3||(W=S+c),Te.nodeType===3&&(S+=Te.nodeValue.length),(Se=Te.firstChild)!==null;)ge=Te,Te=Se;for(;;){if(Te===e)break t;if(ge===l&&++me===p&&(A=S),ge===g&&++Ne===c&&(W=S),(Se=Te.nextSibling)!==null)break;Te=ge,ge=Te.parentNode}Te=Se}l=A===-1||W===-1?null:{start:A,end:W}}else l=null}l=l||{start:0,end:0}}else l=null;for(Ph={focusedElem:e,selectionRange:l},ru=!1,Yn=r;Yn!==null;)if(r=Yn,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,Yn=e;else for(;Yn!==null;){switch(r=Yn,g=r.alternate,e=r.flags,r.tag){case 0:if((e&4)!==0&&(e=r.updateQueue,e=e!==null?e.events:null,e!==null))for(l=0;l<e.length;l++)p=e[l],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,l=r,p=g.memoizedProps,g=g.memoizedState,c=l.stateNode;try{var it=Hi(l.type,p);e=c.getSnapshotBeforeUpdate(it,g),c.__reactInternalSnapshotBeforeUpdate=e}catch(wt){hn(l,l.return,wt)}}break;case 3:if((e&1024)!==0){if(e=r.stateNode.containerInfo,l=e.nodeType,l===9)Hh(e);else if(l===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Hh(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=r.sibling,e!==null){e.return=r.return,Yn=e;break}Yn=r.return}}function Gg(e,r,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:Ts(e,l),c&4&&Wl(5,l);break;case 1:if(Ts(e,l),c&4)if(e=l.stateNode,r===null)try{e.componentDidMount()}catch(S){hn(l,l.return,S)}else{var p=Hi(l.type,r.memoizedProps);r=r.memoizedState;try{e.componentDidUpdate(p,r,e.__reactInternalSnapshotBeforeUpdate)}catch(S){hn(l,l.return,S)}}c&64&&Bg(l),c&512&&Ql(l,l.return);break;case 3:if(Ts(e,l),c&64&&(e=l.updateQueue,e!==null)){if(r=null,l.child!==null)switch(l.child.tag){case 27:case 5:r=l.child.stateNode;break;case 1:r=l.child.stateNode}try{Tm(e,r)}catch(S){hn(l,l.return,S)}}break;case 27:r===null&&c&4&&Fg(l);case 26:case 5:Ts(e,l),r===null&&c&4&&Pg(l),c&512&&Ql(l,l.return);break;case 12:Ts(e,l);break;case 31:Ts(e,l),c&4&&Yg(e,l);break;case 13:Ts(e,l),c&4&&Wg(e,l),c&64&&(e=l.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(l=Ow.bind(null,l),Xw(e,l))));break;case 22:if(c=l.memoizedState!==null||Es,!c){r=r!==null&&r.memoizedState!==null||$n,p=Es;var g=$n;Es=c,($n=r)&&!g?Rs(e,l,(l.subtreeFlags&8772)!==0):Ts(e,l),Es=p,$n=g}break;case 30:break;default:Ts(e,l)}}function Vg(e){var r=e.alternate;r!==null&&(e.alternate=null,Vg(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&Je(r)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Nn=null,fr=!1;function ks(e,r,l){for(l=l.child;l!==null;)Kg(e,r,l),l=l.sibling}function Kg(e,r,l){if(dt&&typeof dt.onCommitFiberUnmount=="function")try{dt.onCommitFiberUnmount(Jt,l)}catch{}switch(l.tag){case 26:$n||fs(l,r),ks(e,r,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:$n||fs(l,r);var c=Nn,p=fr;mi(l.type)&&(Nn=l.stateNode,fr=!1),ks(e,r,l),io(l.stateNode),Nn=c,fr=p;break;case 5:$n||fs(l,r);case 6:if(c=Nn,p=fr,Nn=null,ks(e,r,l),Nn=c,fr=p,Nn!==null)if(fr)try{(Nn.nodeType===9?Nn.body:Nn.nodeName==="HTML"?Nn.ownerDocument.body:Nn).removeChild(l.stateNode)}catch(g){hn(l,r,g)}else try{Nn.removeChild(l.stateNode)}catch(g){hn(l,r,g)}break;case 18:Nn!==null&&(fr?(e=Nn,By(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,l.stateNode),Fa(e)):By(Nn,l.stateNode));break;case 4:c=Nn,p=fr,Nn=l.stateNode.containerInfo,fr=!0,ks(e,r,l),Nn=c,fr=p;break;case 0:case 11:case 14:case 15:oi(2,l,r),$n||oi(4,l,r),ks(e,r,l);break;case 1:$n||(fs(l,r),c=l.stateNode,typeof c.componentWillUnmount=="function"&&$g(l,r,c)),ks(e,r,l);break;case 21:ks(e,r,l);break;case 22:$n=(c=$n)||l.memoizedState!==null,ks(e,r,l),$n=c;break;default:ks(e,r,l)}}function Yg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Fa(e)}catch(l){hn(r,r.return,l)}}}function Wg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Fa(e)}catch(l){hn(r,r.return,l)}}function _w(e){switch(e.tag){case 31:case 13:case 19:var r=e.stateNode;return r===null&&(r=e.stateNode=new Hg),r;case 22:return e=e.stateNode,r=e._retryCache,r===null&&(r=e._retryCache=new Hg),r;default:throw Error(a(435,e.tag))}}function Lc(e,r){var l=_w(e);r.forEach(function(c){if(!l.has(c)){l.add(c);var p=Dw.bind(null,e,c);c.then(p,p)}})}function pr(e,r){var l=r.deletions;if(l!==null)for(var c=0;c<l.length;c++){var p=l[c],g=e,S=r,A=S;e:for(;A!==null;){switch(A.tag){case 27:if(mi(A.type)){Nn=A.stateNode,fr=!1;break e}break;case 5:Nn=A.stateNode,fr=!1;break e;case 3:case 4:Nn=A.stateNode.containerInfo,fr=!0;break e}A=A.return}if(Nn===null)throw Error(a(160));Kg(g,S,p),Nn=null,fr=!1,g=p.alternate,g!==null&&(g.return=null),p.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Qg(r,e),r=r.sibling}var ts=null;function Qg(e,r){var l=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:pr(r,e),mr(e),c&4&&(oi(3,e,e.return),Wl(3,e),oi(5,e,e.return));break;case 1:pr(r,e),mr(e),c&512&&($n||l===null||fs(l,l.return)),c&64&&Es&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(l=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var p=ts;if(pr(r,e),mr(e),c&512&&($n||l===null||fs(l,l.return)),c&4){var g=l!==null?l.memoizedState:null;if(c=e.memoizedState,l===null)if(c===null)if(e.stateNode===null){e:{c=e.type,l=e.memoizedProps,p=p.ownerDocument||p;t:switch(c){case"title":g=p.getElementsByTagName("title")[0],(!g||g[Me]||g[He]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=p.createElement(c),p.head.insertBefore(g,p.querySelector("head > title"))),er(g,c,l),g[He]=e,It(g),c=g;break e;case"link":var S=Qy("link","href",p).get(c+(l.href||""));if(S){for(var A=0;A<S.length;A++)if(g=S[A],g.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&g.getAttribute("rel")===(l.rel==null?null:l.rel)&&g.getAttribute("title")===(l.title==null?null:l.title)&&g.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){S.splice(A,1);break t}}g=p.createElement(c),er(g,c,l),p.head.appendChild(g);break;case"meta":if(S=Qy("meta","content",p).get(c+(l.content||""))){for(A=0;A<S.length;A++)if(g=S[A],g.getAttribute("content")===(l.content==null?null:""+l.content)&&g.getAttribute("name")===(l.name==null?null:l.name)&&g.getAttribute("property")===(l.property==null?null:l.property)&&g.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&g.getAttribute("charset")===(l.charSet==null?null:l.charSet)){S.splice(A,1);break t}}g=p.createElement(c),er(g,c,l),p.head.appendChild(g);break;default:throw Error(a(468,c))}g[He]=e,It(g),c=g}e.stateNode=c}else Jy(p,e.type,e.stateNode);else e.stateNode=Wy(p,c,e.memoizedProps);else g!==c?(g===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):g.count--,c===null?Jy(p,e.type,e.stateNode):Wy(p,c,e.memoizedProps)):c===null&&e.stateNode!==null&&gh(e,e.memoizedProps,l.memoizedProps)}break;case 27:pr(r,e),mr(e),c&512&&($n||l===null||fs(l,l.return)),l!==null&&c&4&&gh(e,e.memoizedProps,l.memoizedProps);break;case 5:if(pr(r,e),mr(e),c&512&&($n||l===null||fs(l,l.return)),e.flags&32){p=e.stateNode;try{Ks(p,"")}catch(it){hn(e,e.return,it)}}c&4&&e.stateNode!=null&&(p=e.memoizedProps,gh(e,p,l!==null?l.memoizedProps:p)),c&1024&&(xh=!0);break;case 6:if(pr(r,e),mr(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,l=e.stateNode;try{l.nodeValue=c}catch(it){hn(e,e.return,it)}}break;case 3:if(Zc=null,p=ts,ts=Jc(r.containerInfo),pr(r,e),ts=p,mr(e),c&4&&l!==null&&l.memoizedState.isDehydrated)try{Fa(r.containerInfo)}catch(it){hn(e,e.return,it)}xh&&(xh=!1,Jg(e));break;case 4:c=ts,ts=Jc(e.stateNode.containerInfo),pr(r,e),mr(e),ts=c;break;case 12:pr(r,e),mr(e);break;case 31:pr(r,e),mr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Lc(e,c)));break;case 13:pr(r,e),mr(e),e.child.flags&8192&&e.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Bc=Ct()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Lc(e,c)));break;case 22:p=e.memoizedState!==null;var W=l!==null&&l.memoizedState!==null,me=Es,Ne=$n;if(Es=me||p,$n=Ne||W,pr(r,e),$n=Ne,Es=me,mr(e),c&8192)e:for(r=e.stateNode,r._visibility=p?r._visibility&-2:r._visibility|1,p&&(l===null||W||Es||$n||Gi(e)),l=null,r=e;;){if(r.tag===5||r.tag===26){if(l===null){W=l=r;try{if(g=W.stateNode,p)S=g.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{A=W.stateNode;var Te=W.memoizedProps.style,ge=Te!=null&&Te.hasOwnProperty("display")?Te.display:null;A.style.display=ge==null||typeof ge=="boolean"?"":(""+ge).trim()}}catch(it){hn(W,W.return,it)}}}else if(r.tag===6){if(l===null){W=r;try{W.stateNode.nodeValue=p?"":W.memoizedProps}catch(it){hn(W,W.return,it)}}}else if(r.tag===18){if(l===null){W=r;try{var Se=W.stateNode;p?$y(Se,!0):$y(W.stateNode,!1)}catch(it){hn(W,W.return,it)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;l===r&&(l=null),r=r.return}l===r&&(l=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=e.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,Lc(e,l))));break;case 19:pr(r,e),mr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Lc(e,c)));break;case 30:break;case 21:break;default:pr(r,e),mr(e)}}function mr(e){var r=e.flags;if(r&2){try{for(var l,c=e.return;c!==null;){if(qg(c)){l=c;break}c=c.return}if(l==null)throw Error(a(160));switch(l.tag){case 27:var p=l.stateNode,g=yh(e);Uc(e,g,p);break;case 5:var S=l.stateNode;l.flags&32&&(Ks(S,""),l.flags&=-33);var A=yh(e);Uc(e,A,S);break;case 3:case 4:var W=l.stateNode.containerInfo,me=yh(e);vh(e,me,W);break;default:throw Error(a(161))}}catch(Ne){hn(e,e.return,Ne)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function Jg(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var r=e;Jg(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),e=e.sibling}}function Ts(e,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Gg(e,r.alternate,r),r=r.sibling}function Gi(e){for(e=e.child;e!==null;){var r=e;switch(r.tag){case 0:case 11:case 14:case 15:oi(4,r,r.return),Gi(r);break;case 1:fs(r,r.return);var l=r.stateNode;typeof l.componentWillUnmount=="function"&&$g(r,r.return,l),Gi(r);break;case 27:io(r.stateNode);case 26:case 5:fs(r,r.return),Gi(r);break;case 22:r.memoizedState===null&&Gi(r);break;case 30:Gi(r);break;default:Gi(r)}e=e.sibling}}function Rs(e,r,l){for(l=l&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,p=e,g=r,S=g.flags;switch(g.tag){case 0:case 11:case 15:Rs(p,g,l),Wl(4,g);break;case 1:if(Rs(p,g,l),c=g,p=c.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(me){hn(c,c.return,me)}if(c=g,p=c.updateQueue,p!==null){var A=c.stateNode;try{var W=p.shared.hiddenCallbacks;if(W!==null)for(p.shared.hiddenCallbacks=null,p=0;p<W.length;p++)km(W[p],A)}catch(me){hn(c,c.return,me)}}l&&S&64&&Bg(g),Ql(g,g.return);break;case 27:Fg(g);case 26:case 5:Rs(p,g,l),l&&c===null&&S&4&&Pg(g),Ql(g,g.return);break;case 12:Rs(p,g,l);break;case 31:Rs(p,g,l),l&&S&4&&Yg(p,g);break;case 13:Rs(p,g,l),l&&S&4&&Wg(p,g);break;case 22:g.memoizedState===null&&Rs(p,g,l),Ql(g,g.return);break;case 30:break;default:Rs(p,g,l)}r=r.sibling}}function bh(e,r){var l=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),e=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(e=r.memoizedState.cachePool.pool),e!==l&&(e!=null&&e.refCount++,l!=null&&Ul(l))}function wh(e,r){e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&Ul(e))}function ns(e,r,l,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Xg(e,r,l,c),r=r.sibling}function Xg(e,r,l,c){var p=r.flags;switch(r.tag){case 0:case 11:case 15:ns(e,r,l,c),p&2048&&Wl(9,r);break;case 1:ns(e,r,l,c);break;case 3:ns(e,r,l,c),p&2048&&(e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&Ul(e)));break;case 12:if(p&2048){ns(e,r,l,c),e=r.stateNode;try{var g=r.memoizedProps,S=g.id,A=g.onPostCommit;typeof A=="function"&&A(S,r.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(W){hn(r,r.return,W)}}else ns(e,r,l,c);break;case 31:ns(e,r,l,c);break;case 13:ns(e,r,l,c);break;case 23:break;case 22:g=r.stateNode,S=r.alternate,r.memoizedState!==null?g._visibility&2?ns(e,r,l,c):Jl(e,r):g._visibility&2?ns(e,r,l,c):(g._visibility|=2,Oa(e,r,l,c,(r.subtreeFlags&10256)!==0||!1)),p&2048&&bh(S,r);break;case 24:ns(e,r,l,c),p&2048&&wh(r.alternate,r);break;default:ns(e,r,l,c)}}function Oa(e,r,l,c,p){for(p=p&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var g=e,S=r,A=l,W=c,me=S.flags;switch(S.tag){case 0:case 11:case 15:Oa(g,S,A,W,p),Wl(8,S);break;case 23:break;case 22:var Ne=S.stateNode;S.memoizedState!==null?Ne._visibility&2?Oa(g,S,A,W,p):Jl(g,S):(Ne._visibility|=2,Oa(g,S,A,W,p)),p&&me&2048&&bh(S.alternate,S);break;case 24:Oa(g,S,A,W,p),p&&me&2048&&wh(S.alternate,S);break;default:Oa(g,S,A,W,p)}r=r.sibling}}function Jl(e,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var l=e,c=r,p=c.flags;switch(c.tag){case 22:Jl(l,c),p&2048&&bh(c.alternate,c);break;case 24:Jl(l,c),p&2048&&wh(c.alternate,c);break;default:Jl(l,c)}r=r.sibling}}var Xl=8192;function Da(e,r,l){if(e.subtreeFlags&Xl)for(e=e.child;e!==null;)Zg(e,r,l),e=e.sibling}function Zg(e,r,l){switch(e.tag){case 26:Da(e,r,l),e.flags&Xl&&e.memoizedState!==null&&uS(l,ts,e.memoizedState,e.memoizedProps);break;case 5:Da(e,r,l);break;case 3:case 4:var c=ts;ts=Jc(e.stateNode.containerInfo),Da(e,r,l),ts=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=Xl,Xl=16777216,Da(e,r,l),Xl=c):Da(e,r,l));break;default:Da(e,r,l)}}function ey(e){var r=e.alternate;if(r!==null&&(e=r.child,e!==null)){r.child=null;do r=e.sibling,e.sibling=null,e=r;while(e!==null)}}function Zl(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];Yn=c,ny(c,e)}ey(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)ty(e),e=e.sibling}function ty(e){switch(e.tag){case 0:case 11:case 15:Zl(e),e.flags&2048&&oi(9,e,e.return);break;case 3:Zl(e);break;case 12:Zl(e);break;case 22:var r=e.stateNode;e.memoizedState!==null&&r._visibility&2&&(e.return===null||e.return.tag!==13)?(r._visibility&=-3,Ic(e)):Zl(e);break;default:Zl(e)}}function Ic(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];Yn=c,ny(c,e)}ey(e)}for(e=e.child;e!==null;){switch(r=e,r.tag){case 0:case 11:case 15:oi(8,r,r.return),Ic(r);break;case 22:l=r.stateNode,l._visibility&2&&(l._visibility&=-3,Ic(r));break;default:Ic(r)}e=e.sibling}}function ny(e,r){for(;Yn!==null;){var l=Yn;switch(l.tag){case 0:case 11:case 15:oi(8,l,r);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Ul(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,Yn=c;else e:for(l=e;Yn!==null;){c=Yn;var p=c.sibling,g=c.return;if(Vg(c),c===l){Yn=null;break e}if(p!==null){p.return=g,Yn=p;break e}Yn=g}}}var Cw={getCacheForType:function(e){var r=Xn(Ln),l=r.data.get(e);return l===void 0&&(l=e(),r.data.set(e,l)),l},cacheSignal:function(){return Xn(Ln).controller.signal}},Nw=typeof WeakMap=="function"?WeakMap:Map,sn=0,gn=null,Ft=null,Kt=0,dn=0,Cr=null,ci=!1,Ma=!1,Sh=!1,As=0,An=0,ui=0,Vi=0,jh=0,Nr=0,za=0,eo=null,gr=null,_h=!1,Bc=0,ry=0,$c=1/0,Pc=null,di=null,Fn=0,hi=null,Ua=null,Os=0,Ch=0,Nh=null,sy=null,to=0,Eh=null;function Er(){return(sn&2)!==0&&Kt!==0?Kt&-Kt:R.T!==null?Dh():un()}function iy(){if(Nr===0)if((Kt&536870912)===0||Wt){var e=st;st<<=1,(st&3932160)===0&&(st=262144),Nr=e}else Nr=536870912;return e=jr.current,e!==null&&(e.flags|=32),Nr}function yr(e,r,l){(e===gn&&(dn===2||dn===9)||e.cancelPendingCommit!==null)&&(La(e,0),fi(e,Kt,Nr,!1)),Pt(e,l),((sn&2)===0||e!==gn)&&(e===gn&&((sn&2)===0&&(Vi|=l),An===4&&fi(e,Kt,Nr,!1)),ps(e))}function ay(e,r,l){if((sn&6)!==0)throw Error(a(327));var c=!l&&(r&127)===0&&(r&e.expiredLanes)===0||At(e,r),p=c?Tw(e,r):Th(e,r,!0),g=c;do{if(p===0){Ma&&!c&&fi(e,r,0,!1);break}else{if(l=e.current.alternate,g&&!Ew(l)){p=Th(e,r,!1),g=!1;continue}if(p===2){if(g=r,e.errorRecoveryDisabledLanes&g)var S=0;else S=e.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){r=S;e:{var A=e;p=eo;var W=A.current.memoizedState.isDehydrated;if(W&&(La(A,S).flags|=256),S=Th(A,S,!1),S!==2){if(Sh&&!W){A.errorRecoveryDisabledLanes|=g,Vi|=g,p=4;break e}g=gr,gr=p,g!==null&&(gr===null?gr=g:gr.push.apply(gr,g))}p=S}if(g=!1,p!==2)continue}}if(p===1){La(e,0),fi(e,r,0,!0);break}e:{switch(c=e,g=p,g){case 0:case 1:throw Error(a(345));case 4:if((r&4194048)!==r)break;case 6:fi(c,r,Nr,!ci);break e;case 2:gr=null;break;case 3:case 5:break;default:throw Error(a(329))}if((r&62914560)===r&&(p=Bc+300-Ct(),10<p)){if(fi(c,r,Nr,!ci),vt(c,0,!0)!==0)break e;Os=r,c.timeoutHandle=Ly(ly.bind(null,c,l,gr,Pc,_h,r,Nr,Vi,za,ci,g,"Throttled",-0,0),p);break e}ly(c,l,gr,Pc,_h,r,Nr,Vi,za,ci,g,null,-0,0)}}break}while(!0);ps(e)}function ly(e,r,l,c,p,g,S,A,W,me,Ne,Te,ge,Se){if(e.timeoutHandle=-1,Te=r.subtreeFlags,Te&8192||(Te&16785408)===16785408){Te={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zr},Zg(r,g,Te);var it=(g&62914560)===g?Bc-Ct():(g&4194048)===g?ry-Ct():0;if(it=dS(Te,it),it!==null){Os=g,e.cancelPendingCommit=it(my.bind(null,e,r,g,l,c,p,S,A,W,Ne,Te,null,ge,Se)),fi(e,g,S,!me);return}}my(e,r,g,l,c,p,S,A,W)}function Ew(e){for(var r=e;;){var l=r.tag;if((l===0||l===11||l===15)&&r.flags&16384&&(l=r.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var p=l[c],g=p.getSnapshot;p=p.value;try{if(!wr(g(),p))return!1}catch{return!1}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function fi(e,r,l,c){r&=~jh,r&=~Vi,e.suspendedLanes|=r,e.pingedLanes&=~r,c&&(e.warmLanes|=r),c=e.expirationTimes;for(var p=r;0<p;){var g=31-qt(p),S=1<<g;c[g]=-1,p&=~S}l!==0&&Xt(e,l,r)}function qc(){return(sn&6)===0?(no(0),!1):!0}function kh(){if(Ft!==null){if(dn===0)var e=Ft.return;else e=Ft,ws=Li=null,Hd(e),Ea=null,Il=0,e=Ft;for(;e!==null;)Ig(e.alternate,e),e=e.return;Ft=null}}function La(e,r){var l=e.timeoutHandle;l!==-1&&(e.timeoutHandle=-1,Kw(l)),l=e.cancelPendingCommit,l!==null&&(e.cancelPendingCommit=null,l()),Os=0,kh(),gn=e,Ft=l=xs(e.current,null),Kt=r,dn=0,Cr=null,ci=!1,Ma=At(e,r),Sh=!1,za=Nr=jh=Vi=ui=An=0,gr=eo=null,_h=!1,(r&8)!==0&&(r|=r&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=r;0<c;){var p=31-qt(c),g=1<<p;r|=e[p],c&=~g}return As=r,cc(),l}function oy(e,r){Bt=null,R.H=Vl,r===Na||r===yc?(r=_m(),dn=3):r===Od?(r=_m(),dn=4):dn=r===ah?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Cr=r,Ft===null&&(An=1,Ac(e,Ir(r,e.current)))}function cy(){var e=jr.current;return e===null?!0:(Kt&4194048)===Kt?qr===null:(Kt&62914560)===Kt||(Kt&536870912)!==0?e===qr:!1}function uy(){var e=R.H;return R.H=Vl,e===null?Vl:e}function dy(){var e=R.A;return R.A=Cw,e}function Fc(){An=4,ci||(Kt&4194048)!==Kt&&jr.current!==null||(Ma=!0),(ui&134217727)===0&&(Vi&134217727)===0||gn===null||fi(gn,Kt,Nr,!1)}function Th(e,r,l){var c=sn;sn|=2;var p=uy(),g=dy();(gn!==e||Kt!==r)&&(Pc=null,La(e,r)),r=!1;var S=An;e:do try{if(dn!==0&&Ft!==null){var A=Ft,W=Cr;switch(dn){case 8:kh(),S=6;break e;case 3:case 2:case 9:case 6:jr.current===null&&(r=!0);var me=dn;if(dn=0,Cr=null,Ia(e,A,W,me),l&&Ma){S=0;break e}break;default:me=dn,dn=0,Cr=null,Ia(e,A,W,me)}}kw(),S=An;break}catch(Ne){oy(e,Ne)}while(!0);return r&&e.shellSuspendCounter++,ws=Li=null,sn=c,R.H=p,R.A=g,Ft===null&&(gn=null,Kt=0,cc()),S}function kw(){for(;Ft!==null;)hy(Ft)}function Tw(e,r){var l=sn;sn|=2;var c=uy(),p=dy();gn!==e||Kt!==r?(Pc=null,$c=Ct()+500,La(e,r)):Ma=At(e,r);e:do try{if(dn!==0&&Ft!==null){r=Ft;var g=Cr;t:switch(dn){case 1:dn=0,Cr=null,Ia(e,r,g,1);break;case 2:case 9:if(Sm(g)){dn=0,Cr=null,fy(r);break}r=function(){dn!==2&&dn!==9||gn!==e||(dn=7),ps(e)},g.then(r,r);break e;case 3:dn=7;break e;case 4:dn=5;break e;case 7:Sm(g)?(dn=0,Cr=null,fy(r)):(dn=0,Cr=null,Ia(e,r,g,7));break;case 5:var S=null;switch(Ft.tag){case 26:S=Ft.memoizedState;case 5:case 27:var A=Ft;if(S?Xy(S):A.stateNode.complete){dn=0,Cr=null;var W=A.sibling;if(W!==null)Ft=W;else{var me=A.return;me!==null?(Ft=me,Hc(me)):Ft=null}break t}}dn=0,Cr=null,Ia(e,r,g,5);break;case 6:dn=0,Cr=null,Ia(e,r,g,6);break;case 8:kh(),An=6;break e;default:throw Error(a(462))}}Rw();break}catch(Ne){oy(e,Ne)}while(!0);return ws=Li=null,R.H=c,R.A=p,sn=l,Ft!==null?0:(gn=null,Kt=0,cc(),An)}function Rw(){for(;Ft!==null&&!We();)hy(Ft)}function hy(e){var r=Ug(e.alternate,e,As);e.memoizedProps=e.pendingProps,r===null?Hc(e):Ft=r}function fy(e){var r=e,l=r.alternate;switch(r.tag){case 15:case 0:r=Rg(l,r,r.pendingProps,r.type,void 0,Kt);break;case 11:r=Rg(l,r,r.pendingProps,r.type.render,r.ref,Kt);break;case 5:Hd(r);default:Ig(l,r),r=Ft=dm(r,As),r=Ug(l,r,As)}e.memoizedProps=e.pendingProps,r===null?Hc(e):Ft=r}function Ia(e,r,l,c){ws=Li=null,Hd(r),Ea=null,Il=0;var p=r.return;try{if(vw(e,p,r,l,Kt)){An=1,Ac(e,Ir(l,e.current)),Ft=null;return}}catch(g){if(p!==null)throw Ft=p,g;An=1,Ac(e,Ir(l,e.current)),Ft=null;return}r.flags&32768?(Wt||c===1?e=!0:Ma||(Kt&536870912)!==0?e=!1:(ci=e=!0,(c===2||c===9||c===3||c===6)&&(c=jr.current,c!==null&&c.tag===13&&(c.flags|=16384))),py(r,e)):Hc(r)}function Hc(e){var r=e;do{if((r.flags&32768)!==0){py(r,ci);return}e=r.return;var l=ww(r.alternate,r,As);if(l!==null){Ft=l;return}if(r=r.sibling,r!==null){Ft=r;return}Ft=r=e}while(r!==null);An===0&&(An=5)}function py(e,r){do{var l=Sw(e.alternate,e);if(l!==null){l.flags&=32767,Ft=l;return}if(l=e.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!r&&(e=e.sibling,e!==null)){Ft=e;return}Ft=e=l}while(e!==null);An=6,Ft=null}function my(e,r,l,c,p,g,S,A,W){e.cancelPendingCommit=null;do Gc();while(Fn!==0);if((sn&6)!==0)throw Error(a(327));if(r!==null){if(r===e.current)throw Error(a(177));if(g=r.lanes|r.childLanes,g|=yd,Nt(e,l,g,S,A,W),e===gn&&(Ft=gn=null,Kt=0),Ua=r,hi=e,Os=l,Ch=g,Nh=p,sy=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Mw(Ge,function(){return by(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=R.T,R.T=null,p=z.p,z.p=2,S=sn,sn|=4;try{jw(e,r,l)}finally{sn=S,z.p=p,R.T=c}}Fn=1,gy(),yy(),vy()}}function gy(){if(Fn===1){Fn=0;var e=hi,r=Ua,l=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||l){l=R.T,R.T=null;var c=z.p;z.p=2;var p=sn;sn|=4;try{Qg(r,e);var g=Ph,S=nm(e.containerInfo),A=g.focusedElem,W=g.selectionRange;if(S!==A&&A&&A.ownerDocument&&tm(A.ownerDocument.documentElement,A)){if(W!==null&&hd(A)){var me=W.start,Ne=W.end;if(Ne===void 0&&(Ne=me),"selectionStart"in A)A.selectionStart=me,A.selectionEnd=Math.min(Ne,A.value.length);else{var Te=A.ownerDocument||document,ge=Te&&Te.defaultView||window;if(ge.getSelection){var Se=ge.getSelection(),it=A.textContent.length,wt=Math.min(W.start,it),mn=W.end===void 0?wt:Math.min(W.end,it);!Se.extend&&wt>mn&&(S=mn,mn=wt,wt=S);var ie=em(A,wt),Z=em(A,mn);if(ie&&Z&&(Se.rangeCount!==1||Se.anchorNode!==ie.node||Se.anchorOffset!==ie.offset||Se.focusNode!==Z.node||Se.focusOffset!==Z.offset)){var he=Te.createRange();he.setStart(ie.node,ie.offset),Se.removeAllRanges(),wt>mn?(Se.addRange(he),Se.extend(Z.node,Z.offset)):(he.setEnd(Z.node,Z.offset),Se.addRange(he))}}}}for(Te=[],Se=A;Se=Se.parentNode;)Se.nodeType===1&&Te.push({element:Se,left:Se.scrollLeft,top:Se.scrollTop});for(typeof A.focus=="function"&&A.focus(),A=0;A<Te.length;A++){var Ee=Te[A];Ee.element.scrollLeft=Ee.left,Ee.element.scrollTop=Ee.top}}ru=!!$h,Ph=$h=null}finally{sn=p,z.p=c,R.T=l}}e.current=r,Fn=2}}function yy(){if(Fn===2){Fn=0;var e=hi,r=Ua,l=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||l){l=R.T,R.T=null;var c=z.p;z.p=2;var p=sn;sn|=4;try{Gg(e,r.alternate,r)}finally{sn=p,z.p=c,R.T=l}}Fn=3}}function vy(){if(Fn===4||Fn===3){Fn=0,Tt();var e=hi,r=Ua,l=Os,c=sy;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?Fn=5:(Fn=0,Ua=hi=null,xy(e,e.pendingLanes));var p=e.pendingLanes;if(p===0&&(di=null),en(l),r=r.stateNode,dt&&typeof dt.onCommitFiberRoot=="function")try{dt.onCommitFiberRoot(Jt,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=R.T,p=z.p,z.p=2,R.T=null;try{for(var g=e.onRecoverableError,S=0;S<c.length;S++){var A=c[S];g(A.value,{componentStack:A.stack})}}finally{R.T=r,z.p=p}}(Os&3)!==0&&Gc(),ps(e),p=e.pendingLanes,(l&261930)!==0&&(p&42)!==0?e===Eh?to++:(to=0,Eh=e):to=0,no(0)}}function xy(e,r){(e.pooledCacheLanes&=r)===0&&(r=e.pooledCache,r!=null&&(e.pooledCache=null,Ul(r)))}function Gc(){return gy(),yy(),vy(),by()}function by(){if(Fn!==5)return!1;var e=hi,r=Ch;Ch=0;var l=en(Os),c=R.T,p=z.p;try{z.p=32>l?32:l,R.T=null,l=Nh,Nh=null;var g=hi,S=Os;if(Fn=0,Ua=hi=null,Os=0,(sn&6)!==0)throw Error(a(331));var A=sn;if(sn|=4,ty(g.current),Xg(g,g.current,S,l),sn=A,no(0,!1),dt&&typeof dt.onPostCommitFiberRoot=="function")try{dt.onPostCommitFiberRoot(Jt,g)}catch{}return!0}finally{z.p=p,R.T=c,xy(e,r)}}function wy(e,r,l){r=Ir(l,r),r=ih(e.stateNode,r,2),e=ii(e,r,2),e!==null&&(Pt(e,2),ps(e))}function hn(e,r,l){if(e.tag===3)wy(e,e,l);else for(;r!==null;){if(r.tag===3){wy(r,e,l);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(di===null||!di.has(c))){e=Ir(l,e),l=Sg(2),c=ii(r,l,2),c!==null&&(jg(l,c,r,e),Pt(c,2),ps(c));break}}r=r.return}}function Rh(e,r,l){var c=e.pingCache;if(c===null){c=e.pingCache=new Nw;var p=new Set;c.set(r,p)}else p=c.get(r),p===void 0&&(p=new Set,c.set(r,p));p.has(l)||(Sh=!0,p.add(l),e=Aw.bind(null,e,r,l),r.then(e,e))}function Aw(e,r,l){var c=e.pingCache;c!==null&&c.delete(r),e.pingedLanes|=e.suspendedLanes&l,e.warmLanes&=~l,gn===e&&(Kt&l)===l&&(An===4||An===3&&(Kt&62914560)===Kt&&300>Ct()-Bc?(sn&2)===0&&La(e,0):jh|=l,za===Kt&&(za=0)),ps(e)}function Sy(e,r){r===0&&(r=Lt()),e=Mi(e,r),e!==null&&(Pt(e,r),ps(e))}function Ow(e){var r=e.memoizedState,l=0;r!==null&&(l=r.retryLane),Sy(e,l)}function Dw(e,r){var l=0;switch(e.tag){case 31:case 13:var c=e.stateNode,p=e.memoizedState;p!==null&&(l=p.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(r),Sy(e,l)}function Mw(e,r){return _e(e,r)}var Vc=null,Ba=null,Ah=!1,Kc=!1,Oh=!1,pi=0;function ps(e){e!==Ba&&e.next===null&&(Ba===null?Vc=Ba=e:Ba=Ba.next=e),Kc=!0,Ah||(Ah=!0,Uw())}function no(e,r){if(!Oh&&Kc){Oh=!0;do for(var l=!1,c=Vc;c!==null;){if(e!==0){var p=c.pendingLanes;if(p===0)var g=0;else{var S=c.suspendedLanes,A=c.pingedLanes;g=(1<<31-qt(42|e)+1)-1,g&=p&~(S&~A),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(l=!0,Ny(c,g))}else g=Kt,g=vt(c,c===gn?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||At(c,g)||(l=!0,Ny(c,g));c=c.next}while(l);Oh=!1}}function zw(){jy()}function jy(){Kc=Ah=!1;var e=0;pi!==0&&Vw()&&(e=pi);for(var r=Ct(),l=null,c=Vc;c!==null;){var p=c.next,g=_y(c,r);g===0?(c.next=null,l===null?Vc=p:l.next=p,p===null&&(Ba=l)):(l=c,(e!==0||(g&3)!==0)&&(Kc=!0)),c=p}Fn!==0&&Fn!==5||no(e),pi!==0&&(pi=0)}function _y(e,r){for(var l=e.suspendedLanes,c=e.pingedLanes,p=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var S=31-qt(g),A=1<<S,W=p[S];W===-1?((A&l)===0||(A&c)!==0)&&(p[S]=Et(A,r)):W<=r&&(e.expiredLanes|=A),g&=~A}if(r=gn,l=Kt,l=vt(e,e===r?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,l===0||e===r&&(dn===2||dn===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&te(c),e.callbackNode=null,e.callbackPriority=0;if((l&3)===0||At(e,l)){if(r=l&-l,r===e.callbackPriority)return r;switch(c!==null&&te(c),en(l)){case 2:case 8:l=Oe;break;case 32:l=Ge;break;case 268435456:l=St;break;default:l=Ge}return c=Cy.bind(null,e),l=_e(l,c),e.callbackPriority=r,e.callbackNode=l,r}return c!==null&&c!==null&&te(c),e.callbackPriority=2,e.callbackNode=null,2}function Cy(e,r){if(Fn!==0&&Fn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var l=e.callbackNode;if(Gc()&&e.callbackNode!==l)return null;var c=Kt;return c=vt(e,e===gn?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(ay(e,c,r),_y(e,Ct()),e.callbackNode!=null&&e.callbackNode===l?Cy.bind(null,e):null)}function Ny(e,r){if(Gc())return null;ay(e,r,!0)}function Uw(){Yw(function(){(sn&6)!==0?_e(Ae,zw):jy()})}function Dh(){if(pi===0){var e=_a;e===0&&(e=ve,ve<<=1,(ve&261888)===0&&(ve=256)),pi=e}return pi}function Ey(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:pa(""+e)}function ky(e,r){var l=r.ownerDocument.createElement("input");return l.name=r.name,l.value=r.value,e.id&&l.setAttribute("form",e.id),r.parentNode.insertBefore(l,r),e=new FormData(e),l.parentNode.removeChild(l),e}function Lw(e,r,l,c,p){if(r==="submit"&&l&&l.stateNode===p){var g=Ey((p[pt]||null).action),S=c.submitter;S&&(r=(r=S[pt]||null)?Ey(r.formAction):S.getAttribute("formAction"),r!==null&&(g=r,S=null));var A=new ut("action","action",null,c,p);e.push({event:A,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(pi!==0){var W=S?ky(p,S):new FormData(p);Zd(l,{pending:!0,data:W,method:p.method,action:g},null,W)}}else typeof g=="function"&&(A.preventDefault(),W=S?ky(p,S):new FormData(p),Zd(l,{pending:!0,data:W,method:p.method,action:g},g,W))},currentTarget:p}]})}}for(var Mh=0;Mh<gd.length;Mh++){var zh=gd[Mh],Iw=zh.toLowerCase(),Bw=zh[0].toUpperCase()+zh.slice(1);es(Iw,"on"+Bw)}es(im,"onAnimationEnd"),es(am,"onAnimationIteration"),es(lm,"onAnimationStart"),es("dblclick","onDoubleClick"),es("focusin","onFocus"),es("focusout","onBlur"),es(tw,"onTransitionRun"),es(nw,"onTransitionStart"),es(rw,"onTransitionCancel"),es(om,"onTransitionEnd"),cn("onMouseEnter",["mouseout","mouseover"]),cn("onMouseLeave",["mouseout","mouseover"]),cn("onPointerEnter",["pointerout","pointerover"]),cn("onPointerLeave",["pointerout","pointerover"]),Gt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ro="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$w=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ro));function Ty(e,r){r=(r&4)!==0;for(var l=0;l<e.length;l++){var c=e[l],p=c.event;c=c.listeners;e:{var g=void 0;if(r)for(var S=c.length-1;0<=S;S--){var A=c[S],W=A.instance,me=A.currentTarget;if(A=A.listener,W!==g&&p.isPropagationStopped())break e;g=A,p.currentTarget=me;try{g(p)}catch(Ne){oc(Ne)}p.currentTarget=null,g=W}else for(S=0;S<c.length;S++){if(A=c[S],W=A.instance,me=A.currentTarget,A=A.listener,W!==g&&p.isPropagationStopped())break e;g=A,p.currentTarget=me;try{g(p)}catch(Ne){oc(Ne)}p.currentTarget=null,g=W}}}}function Ht(e,r){var l=r[ne];l===void 0&&(l=r[ne]=new Set);var c=e+"__bubble";l.has(c)||(Ry(r,e,2,!1),l.add(c))}function Uh(e,r,l){var c=0;r&&(c|=4),Ry(l,e,c,r)}var Yc="_reactListening"+Math.random().toString(36).slice(2);function Lh(e){if(!e[Yc]){e[Yc]=!0,Ye.forEach(function(l){l!=="selectionchange"&&($w.has(l)||Uh(l,!1,e),Uh(l,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[Yc]||(r[Yc]=!0,Uh("selectionchange",!1,r))}}function Ry(e,r,l,c){switch(iv(r)){case 2:var p=pS;break;case 8:p=mS;break;default:p=Xh}l=p.bind(null,r,l,e),p=void 0,!M||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),c?p!==void 0?e.addEventListener(r,l,{capture:!0,passive:p}):e.addEventListener(r,l,!0):p!==void 0?e.addEventListener(r,l,{passive:p}):e.addEventListener(r,l,!1)}function Ih(e,r,l,c,p){var g=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var S=c.tag;if(S===3||S===4){var A=c.stateNode.containerInfo;if(A===p)break;if(S===4)for(S=c.return;S!==null;){var W=S.tag;if((W===3||W===4)&&S.stateNode.containerInfo===p)return;S=S.return}for(;A!==null;){if(S=Fe(A),S===null)return;if(W=S.tag,W===5||W===6||W===26||W===27){c=g=S;continue e}A=A.parentNode}}c=c.return}Ri(function(){var me=g,Ne=Cl(l),Te=[];e:{var ge=cm.get(e);if(ge!==void 0){var Se=ut,it=e;switch(e){case"keypress":if($e(l)===0)break e;case"keydown":case"keyup":Se=Db;break;case"focusin":it="focus",Se=En;break;case"focusout":it="blur",Se=En;break;case"beforeblur":case"afterblur":Se=En;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=ct;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=zt;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=Ub;break;case im:case am:case lm:Se=Vt;break;case om:Se=Ib;break;case"scroll":case"scrollend":Se=Ot;break;case"wheel":Se=$b;break;case"copy":case"cut":case"paste":Se=Un;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=$p;break;case"toggle":case"beforetoggle":Se=qb}var wt=(r&4)!==0,mn=!wt&&(e==="scroll"||e==="scrollend"),ie=wt?ge!==null?ge+"Capture":null:ge;wt=[];for(var Z=me,he;Z!==null;){var Ee=Z;if(he=Ee.stateNode,Ee=Ee.tag,Ee!==5&&Ee!==26&&Ee!==27||he===null||ie===null||(Ee=Qs(Z,ie),Ee!=null&&wt.push(so(Z,Ee,he))),mn)break;Z=Z.return}0<wt.length&&(ge=new Se(ge,it,null,l,Ne),Te.push({event:ge,listeners:wt}))}}if((r&7)===0){e:{if(ge=e==="mouseover"||e==="pointerover",Se=e==="mouseout"||e==="pointerout",ge&&l!==_l&&(it=l.relatedTarget||l.fromElement)&&(Fe(it)||it[Dt]))break e;if((Se||ge)&&(ge=Ne.window===Ne?Ne:(ge=Ne.ownerDocument)?ge.defaultView||ge.parentWindow:window,Se?(it=l.relatedTarget||l.toElement,Se=me,it=it?Fe(it):null,it!==null&&(mn=u(it),wt=it.tag,it!==mn||wt!==5&&wt!==27&&wt!==6)&&(it=null)):(Se=null,it=me),Se!==it)){if(wt=ct,Ee="onMouseLeave",ie="onMouseEnter",Z="mouse",(e==="pointerout"||e==="pointerover")&&(wt=$p,Ee="onPointerLeave",ie="onPointerEnter",Z="pointer"),mn=Se==null?ge:Mt(Se),he=it==null?ge:Mt(it),ge=new wt(Ee,Z+"leave",Se,l,Ne),ge.target=mn,ge.relatedTarget=he,Ee=null,Fe(Ne)===me&&(wt=new wt(ie,Z+"enter",it,l,Ne),wt.target=he,wt.relatedTarget=mn,Ee=wt),mn=Ee,Se&&it)t:{for(wt=Pw,ie=Se,Z=it,he=0,Ee=ie;Ee;Ee=wt(Ee))he++;Ee=0;for(var gt=Z;gt;gt=wt(gt))Ee++;for(;0<he-Ee;)ie=wt(ie),he--;for(;0<Ee-he;)Z=wt(Z),Ee--;for(;he--;){if(ie===Z||Z!==null&&ie===Z.alternate){wt=ie;break t}ie=wt(ie),Z=wt(Z)}wt=null}else wt=null;Se!==null&&Ay(Te,ge,Se,wt,!1),it!==null&&mn!==null&&Ay(Te,mn,it,wt,!0)}}e:{if(ge=me?Mt(me):window,Se=ge.nodeName&&ge.nodeName.toLowerCase(),Se==="select"||Se==="input"&&ge.type==="file")var nn=Yp;else if(Vp(ge))if(Wp)nn=Xb;else{nn=Qb;var ot=Wb}else Se=ge.nodeName,!Se||Se.toLowerCase()!=="input"||ge.type!=="checkbox"&&ge.type!=="radio"?me&&jl(me.elementType)&&(nn=Yp):nn=Jb;if(nn&&(nn=nn(e,me))){Kp(Te,nn,l,Ne);break e}ot&&ot(e,ge,me),e==="focusout"&&me&&ge.type==="number"&&me.memoizedProps.value!=null&&bl(ge,"number",ge.value)}switch(ot=me?Mt(me):window,e){case"focusin":(Vp(ot)||ot.contentEditable==="true")&&(ga=ot,fd=me,Dl=null);break;case"focusout":Dl=fd=ga=null;break;case"mousedown":pd=!0;break;case"contextmenu":case"mouseup":case"dragend":pd=!1,rm(Te,l,Ne);break;case"selectionchange":if(ew)break;case"keydown":case"keyup":rm(Te,l,Ne)}var $t;if(cd)e:{switch(e){case"compositionstart":var Yt="onCompositionStart";break e;case"compositionend":Yt="onCompositionEnd";break e;case"compositionupdate":Yt="onCompositionUpdate";break e}Yt=void 0}else ma?Hp(e,l)&&(Yt="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(Yt="onCompositionStart");Yt&&(Pp&&l.locale!=="ko"&&(ma||Yt!=="onCompositionStart"?Yt==="onCompositionEnd"&&ma&&($t=ze()):(ee=Ne,we="value"in ee?ee.value:ee.textContent,ma=!0)),ot=Wc(me,Yt),0<ot.length&&(Yt=new Zr(Yt,e,null,l,Ne),Te.push({event:Yt,listeners:ot}),$t?Yt.data=$t:($t=Gp(l),$t!==null&&(Yt.data=$t)))),($t=Hb?Gb(e,l):Vb(e,l))&&(Yt=Wc(me,"onBeforeInput"),0<Yt.length&&(ot=new Zr("onBeforeInput","beforeinput",null,l,Ne),Te.push({event:ot,listeners:Yt}),ot.data=$t)),Lw(Te,e,me,l,Ne)}Ty(Te,r)})}function so(e,r,l){return{instance:e,listener:r,currentTarget:l}}function Wc(e,r){for(var l=r+"Capture",c=[];e!==null;){var p=e,g=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||g===null||(p=Qs(e,l),p!=null&&c.unshift(so(e,p,g)),p=Qs(e,r),p!=null&&c.push(so(e,p,g))),e.tag===3)return c;e=e.return}return[]}function Pw(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Ay(e,r,l,c,p){for(var g=r._reactName,S=[];l!==null&&l!==c;){var A=l,W=A.alternate,me=A.stateNode;if(A=A.tag,W!==null&&W===c)break;A!==5&&A!==26&&A!==27||me===null||(W=me,p?(me=Qs(l,g),me!=null&&S.unshift(so(l,me,W))):p||(me=Qs(l,g),me!=null&&S.push(so(l,me,W)))),l=l.return}S.length!==0&&e.push({event:r,listeners:S})}var qw=/\r\n?/g,Fw=/\u0000|\uFFFD/g;function Oy(e){return(typeof e=="string"?e:""+e).replace(qw,`
`).replace(Fw,"")}function Dy(e,r){return r=Oy(r),Oy(e)===r}function pn(e,r,l,c,p,g){switch(l){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||Ks(e,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&Ks(e,""+c);break;case"className":Vs(e,"class",c);break;case"tabIndex":Vs(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Vs(e,l,c);break;case"style":Sl(e,c,g);break;case"data":if(r!=="object"){Vs(e,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||l!=="href")){e.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=pa(""+c),e.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(l==="formAction"?(r!=="input"&&pn(e,r,"name",p.name,p,null),pn(e,r,"formEncType",p.formEncType,p,null),pn(e,r,"formMethod",p.formMethod,p,null),pn(e,r,"formTarget",p.formTarget,p,null)):(pn(e,r,"encType",p.encType,p,null),pn(e,r,"method",p.method,p,null),pn(e,r,"target",p.target,p,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=pa(""+c),e.setAttribute(l,c);break;case"onClick":c!=null&&(e.onclick=zr);break;case"onScroll":c!=null&&Ht("scroll",e);break;case"onScrollEnd":c!=null&&Ht("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(p.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}l=pa(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""+c):e.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""):e.removeAttribute(l);break;case"capture":case"download":c===!0?e.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,c):e.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(l,c):e.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(l):e.setAttribute(l,c);break;case"popover":Ht("beforetoggle",e),Ht("toggle",e),Ei(e,"popover",c);break;case"xlinkActuate":Qr(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Qr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Qr(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Qr(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Qr(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Qr(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Qr(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Qr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Qr(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Ei(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=od.get(l)||l,Ei(e,l,c))}}function Bh(e,r,l,c,p,g){switch(l){case"style":Sl(e,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(p.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"children":typeof c=="string"?Ks(e,c):(typeof c=="number"||typeof c=="bigint")&&Ks(e,""+c);break;case"onScroll":c!=null&&Ht("scroll",e);break;case"onScrollEnd":c!=null&&Ht("scrollend",e);break;case"onClick":c!=null&&(e.onclick=zr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!bt.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),r=l.slice(2,p?l.length-7:void 0),g=e[pt]||null,g=g!=null?g[l]:null,typeof g=="function"&&e.removeEventListener(r,g,p),typeof c=="function")){typeof g!="function"&&g!==null&&(l in e?e[l]=null:e.hasAttribute(l)&&e.removeAttribute(l)),e.addEventListener(r,c,p);break e}l in e?e[l]=c:c===!0?e.setAttribute(l,""):Ei(e,l,c)}}}function er(e,r,l){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ht("error",e),Ht("load",e);var c=!1,p=!1,g;for(g in l)if(l.hasOwnProperty(g)){var S=l[g];if(S!=null)switch(g){case"src":c=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,r));default:pn(e,r,g,S,l,null)}}p&&pn(e,r,"srcSet",l.srcSet,l,null),c&&pn(e,r,"src",l.src,l,null);return;case"input":Ht("invalid",e);var A=g=S=p=null,W=null,me=null;for(c in l)if(l.hasOwnProperty(c)){var Ne=l[c];if(Ne!=null)switch(c){case"name":p=Ne;break;case"type":S=Ne;break;case"checked":W=Ne;break;case"defaultChecked":me=Ne;break;case"value":g=Ne;break;case"defaultValue":A=Ne;break;case"children":case"dangerouslySetInnerHTML":if(Ne!=null)throw Error(a(137,r));break;default:pn(e,r,c,Ne,l,null)}}rc(e,g,A,W,me,S,p,!1);return;case"select":Ht("invalid",e),c=S=g=null;for(p in l)if(l.hasOwnProperty(p)&&(A=l[p],A!=null))switch(p){case"value":g=A;break;case"defaultValue":S=A;break;case"multiple":c=A;default:pn(e,r,p,A,l,null)}r=g,l=S,e.multiple=!!c,r!=null?Mr(e,!!c,r,!1):l!=null&&Mr(e,!!c,l,!0);return;case"textarea":Ht("invalid",e),g=p=c=null;for(S in l)if(l.hasOwnProperty(S)&&(A=l[S],A!=null))switch(S){case"value":c=A;break;case"defaultValue":p=A;break;case"children":g=A;break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(a(91));break;default:pn(e,r,S,A,l,null)}ic(e,c,p,g);return;case"option":for(W in l)l.hasOwnProperty(W)&&(c=l[W],c!=null)&&(W==="selected"?e.selected=c&&typeof c!="function"&&typeof c!="symbol":pn(e,r,W,c,l,null));return;case"dialog":Ht("beforetoggle",e),Ht("toggle",e),Ht("cancel",e),Ht("close",e);break;case"iframe":case"object":Ht("load",e);break;case"video":case"audio":for(c=0;c<ro.length;c++)Ht(ro[c],e);break;case"image":Ht("error",e),Ht("load",e);break;case"details":Ht("toggle",e);break;case"embed":case"source":case"link":Ht("error",e),Ht("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in l)if(l.hasOwnProperty(me)&&(c=l[me],c!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,r));default:pn(e,r,me,c,l,null)}return;default:if(jl(r)){for(Ne in l)l.hasOwnProperty(Ne)&&(c=l[Ne],c!==void 0&&Bh(e,r,Ne,c,l,void 0));return}}for(A in l)l.hasOwnProperty(A)&&(c=l[A],c!=null&&pn(e,r,A,c,l,null))}function Hw(e,r,l,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,g=null,S=null,A=null,W=null,me=null,Ne=null;for(Se in l){var Te=l[Se];if(l.hasOwnProperty(Se)&&Te!=null)switch(Se){case"checked":break;case"value":break;case"defaultValue":W=Te;default:c.hasOwnProperty(Se)||pn(e,r,Se,null,c,Te)}}for(var ge in c){var Se=c[ge];if(Te=l[ge],c.hasOwnProperty(ge)&&(Se!=null||Te!=null))switch(ge){case"type":g=Se;break;case"name":p=Se;break;case"checked":me=Se;break;case"defaultChecked":Ne=Se;break;case"value":S=Se;break;case"defaultValue":A=Se;break;case"children":case"dangerouslySetInnerHTML":if(Se!=null)throw Error(a(137,r));break;default:Se!==Te&&pn(e,r,ge,Se,c,Te)}}Ti(e,S,A,W,me,Ne,g,p);return;case"select":Se=S=A=ge=null;for(g in l)if(W=l[g],l.hasOwnProperty(g)&&W!=null)switch(g){case"value":break;case"multiple":Se=W;default:c.hasOwnProperty(g)||pn(e,r,g,null,c,W)}for(p in c)if(g=c[p],W=l[p],c.hasOwnProperty(p)&&(g!=null||W!=null))switch(p){case"value":ge=g;break;case"defaultValue":A=g;break;case"multiple":S=g;default:g!==W&&pn(e,r,p,g,c,W)}r=A,l=S,c=Se,ge!=null?Mr(e,!!l,ge,!1):!!c!=!!l&&(r!=null?Mr(e,!!l,r,!0):Mr(e,!!l,l?[]:"",!1));return;case"textarea":Se=ge=null;for(A in l)if(p=l[A],l.hasOwnProperty(A)&&p!=null&&!c.hasOwnProperty(A))switch(A){case"value":break;case"children":break;default:pn(e,r,A,null,c,p)}for(S in c)if(p=c[S],g=l[S],c.hasOwnProperty(S)&&(p!=null||g!=null))switch(S){case"value":ge=p;break;case"defaultValue":Se=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(a(91));break;default:p!==g&&pn(e,r,S,p,c,g)}sc(e,ge,Se);return;case"option":for(var it in l)ge=l[it],l.hasOwnProperty(it)&&ge!=null&&!c.hasOwnProperty(it)&&(it==="selected"?e.selected=!1:pn(e,r,it,null,c,ge));for(W in c)ge=c[W],Se=l[W],c.hasOwnProperty(W)&&ge!==Se&&(ge!=null||Se!=null)&&(W==="selected"?e.selected=ge&&typeof ge!="function"&&typeof ge!="symbol":pn(e,r,W,ge,c,Se));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var wt in l)ge=l[wt],l.hasOwnProperty(wt)&&ge!=null&&!c.hasOwnProperty(wt)&&pn(e,r,wt,null,c,ge);for(me in c)if(ge=c[me],Se=l[me],c.hasOwnProperty(me)&&ge!==Se&&(ge!=null||Se!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(a(137,r));break;default:pn(e,r,me,ge,c,Se)}return;default:if(jl(r)){for(var mn in l)ge=l[mn],l.hasOwnProperty(mn)&&ge!==void 0&&!c.hasOwnProperty(mn)&&Bh(e,r,mn,void 0,c,ge);for(Ne in c)ge=c[Ne],Se=l[Ne],!c.hasOwnProperty(Ne)||ge===Se||ge===void 0&&Se===void 0||Bh(e,r,Ne,ge,c,Se);return}}for(var ie in l)ge=l[ie],l.hasOwnProperty(ie)&&ge!=null&&!c.hasOwnProperty(ie)&&pn(e,r,ie,null,c,ge);for(Te in c)ge=c[Te],Se=l[Te],!c.hasOwnProperty(Te)||ge===Se||ge==null&&Se==null||pn(e,r,Te,ge,c,Se)}function My(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Gw(){if(typeof performance.getEntriesByType=="function"){for(var e=0,r=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var p=l[c],g=p.transferSize,S=p.initiatorType,A=p.duration;if(g&&A&&My(S)){for(S=0,A=p.responseEnd,c+=1;c<l.length;c++){var W=l[c],me=W.startTime;if(me>A)break;var Ne=W.transferSize,Te=W.initiatorType;Ne&&My(Te)&&(W=W.responseEnd,S+=Ne*(W<A?1:(A-me)/(W-me)))}if(--c,r+=8*(g+S)/(p.duration/1e3),e++,10<e)break}}if(0<e)return r/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var $h=null,Ph=null;function Qc(e){return e.nodeType===9?e:e.ownerDocument}function zy(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Uy(e,r){if(e===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&r==="foreignObject"?0:e}function qh(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Fh=null;function Vw(){var e=window.event;return e&&e.type==="popstate"?e===Fh?!1:(Fh=e,!0):(Fh=null,!1)}var Ly=typeof setTimeout=="function"?setTimeout:void 0,Kw=typeof clearTimeout=="function"?clearTimeout:void 0,Iy=typeof Promise=="function"?Promise:void 0,Yw=typeof queueMicrotask=="function"?queueMicrotask:typeof Iy<"u"?function(e){return Iy.resolve(null).then(e).catch(Ww)}:Ly;function Ww(e){setTimeout(function(){throw e})}function mi(e){return e==="head"}function By(e,r){var l=r,c=0;do{var p=l.nextSibling;if(e.removeChild(l),p&&p.nodeType===8)if(l=p.data,l==="/$"||l==="/&"){if(c===0){e.removeChild(p),Fa(r);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")io(e.ownerDocument.documentElement);else if(l==="head"){l=e.ownerDocument.head,io(l);for(var g=l.firstChild;g;){var S=g.nextSibling,A=g.nodeName;g[Me]||A==="SCRIPT"||A==="STYLE"||A==="LINK"&&g.rel.toLowerCase()==="stylesheet"||l.removeChild(g),g=S}}else l==="body"&&io(e.ownerDocument.body);l=p}while(l);Fa(r)}function $y(e,r){var l=e;e=0;do{var c=l.nextSibling;if(l.nodeType===1?r?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(r?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(e===0)break;e--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||e++;l=c}while(l)}function Hh(e){var r=e.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var l=r;switch(r=r.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Hh(l),Je(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}e.removeChild(l)}}function Qw(e,r,l,c){for(;e.nodeType===1;){var p=l;if(e.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[Me])switch(r){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==p.rel||e.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||e.getAttribute("title")!==(p.title==null?null:p.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(p.src==null?null:p.src)||e.getAttribute("type")!==(p.type==null?null:p.type)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(r==="input"&&e.type==="hidden"){var g=p.name==null?null:""+p.name;if(p.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=Fr(e.nextSibling),e===null)break}return null}function Jw(e,r,l){if(r==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!l||(e=Fr(e.nextSibling),e===null))return null;return e}function Py(e,r){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=Fr(e.nextSibling),e===null))return null;return e}function Gh(e){return e.data==="$?"||e.data==="$~"}function Vh(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Xw(e,r){var l=e.ownerDocument;if(e.data==="$~")e._reactRetry=r;else if(e.data!=="$?"||l.readyState!=="loading")r();else{var c=function(){r(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function Fr(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return e}var Kh=null;function qy(e){e=e.nextSibling;for(var r=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"||l==="/&"){if(r===0)return Fr(e.nextSibling);r--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||r++}e=e.nextSibling}return null}function Fy(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(r===0)return e;r--}else l!=="/$"&&l!=="/&"||r++}e=e.previousSibling}return null}function Hy(e,r,l){switch(r=Qc(l),e){case"html":if(e=r.documentElement,!e)throw Error(a(452));return e;case"head":if(e=r.head,!e)throw Error(a(453));return e;case"body":if(e=r.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function io(e){for(var r=e.attributes;r.length;)e.removeAttributeNode(r[0]);Je(e)}var Hr=new Map,Gy=new Set;function Jc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ds=z.d;z.d={f:Zw,r:eS,D:tS,C:nS,L:rS,m:sS,X:aS,S:iS,M:lS};function Zw(){var e=Ds.f(),r=qc();return e||r}function eS(e){var r=Ke(e);r!==null&&r.tag===5&&r.type==="form"?og(r):Ds.r(e)}var $a=typeof document>"u"?null:document;function Vy(e,r,l){var c=$a;if(c&&typeof r=="string"&&r){var p=dr(r);p='link[rel="'+e+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),Gy.has(p)||(Gy.add(p),e={rel:e,crossOrigin:l,href:r},c.querySelector(p)===null&&(r=c.createElement("link"),er(r,"link",e),It(r),c.head.appendChild(r)))}}function tS(e){Ds.D(e),Vy("dns-prefetch",e,null)}function nS(e,r){Ds.C(e,r),Vy("preconnect",e,r)}function rS(e,r,l){Ds.L(e,r,l);var c=$a;if(c&&e&&r){var p='link[rel="preload"][as="'+dr(r)+'"]';r==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+dr(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+dr(l.imageSizes)+'"]')):p+='[href="'+dr(e)+'"]';var g=p;switch(r){case"style":g=Pa(e);break;case"script":g=qa(e)}Hr.has(g)||(e=v({rel:"preload",href:r==="image"&&l&&l.imageSrcSet?void 0:e,as:r},l),Hr.set(g,e),c.querySelector(p)!==null||r==="style"&&c.querySelector(ao(g))||r==="script"&&c.querySelector(lo(g))||(r=c.createElement("link"),er(r,"link",e),It(r),c.head.appendChild(r)))}}function sS(e,r){Ds.m(e,r);var l=$a;if(l&&e){var c=r&&typeof r.as=="string"?r.as:"script",p='link[rel="modulepreload"][as="'+dr(c)+'"][href="'+dr(e)+'"]',g=p;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=qa(e)}if(!Hr.has(g)&&(e=v({rel:"modulepreload",href:e},r),Hr.set(g,e),l.querySelector(p)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(lo(g)))return}c=l.createElement("link"),er(c,"link",e),It(c),l.head.appendChild(c)}}}function iS(e,r,l){Ds.S(e,r,l);var c=$a;if(c&&e){var p=xt(c).hoistableStyles,g=Pa(e);r=r||"default";var S=p.get(g);if(!S){var A={loading:0,preload:null};if(S=c.querySelector(ao(g)))A.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":r},l),(l=Hr.get(g))&&Yh(e,l);var W=S=c.createElement("link");It(W),er(W,"link",e),W._p=new Promise(function(me,Ne){W.onload=me,W.onerror=Ne}),W.addEventListener("load",function(){A.loading|=1}),W.addEventListener("error",function(){A.loading|=2}),A.loading|=4,Xc(S,r,c)}S={type:"stylesheet",instance:S,count:1,state:A},p.set(g,S)}}}function aS(e,r){Ds.X(e,r);var l=$a;if(l&&e){var c=xt(l).hoistableScripts,p=qa(e),g=c.get(p);g||(g=l.querySelector(lo(p)),g||(e=v({src:e,async:!0},r),(r=Hr.get(p))&&Wh(e,r),g=l.createElement("script"),It(g),er(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function lS(e,r){Ds.M(e,r);var l=$a;if(l&&e){var c=xt(l).hoistableScripts,p=qa(e),g=c.get(p);g||(g=l.querySelector(lo(p)),g||(e=v({src:e,async:!0,type:"module"},r),(r=Hr.get(p))&&Wh(e,r),g=l.createElement("script"),It(g),er(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function Ky(e,r,l,c){var p=(p=Ue.current)?Jc(p):null;if(!p)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(r=Pa(l.href),l=xt(p).hoistableStyles,c=l.get(r),c||(c={type:"style",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){e=Pa(l.href);var g=xt(p).hoistableStyles,S=g.get(e);if(S||(p=p.ownerDocument||p,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,S),(g=p.querySelector(ao(e)))&&!g._p&&(S.instance=g,S.state.loading=5),Hr.has(e)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Hr.set(e,l),g||oS(p,e,l,S.state))),r&&c===null)throw Error(a(528,""));return S}if(r&&c!==null)throw Error(a(529,""));return null;case"script":return r=l.async,l=l.src,typeof l=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=qa(l),l=xt(p).hoistableScripts,c=l.get(r),c||(c={type:"script",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Pa(e){return'href="'+dr(e)+'"'}function ao(e){return'link[rel="stylesheet"]['+e+"]"}function Yy(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function oS(e,r,l,c){e.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=e.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),er(r,"link",l),It(r),e.head.appendChild(r))}function qa(e){return'[src="'+dr(e)+'"]'}function lo(e){return"script[async]"+e}function Wy(e,r,l){if(r.count++,r.instance===null)switch(r.type){case"style":var c=e.querySelector('style[data-href~="'+dr(l.href)+'"]');if(c)return r.instance=c,It(c),c;var p=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),It(c),er(c,"style",p),Xc(c,l.precedence,e),r.instance=c;case"stylesheet":p=Pa(l.href);var g=e.querySelector(ao(p));if(g)return r.state.loading|=4,r.instance=g,It(g),g;c=Yy(l),(p=Hr.get(p))&&Yh(c,p),g=(e.ownerDocument||e).createElement("link"),It(g);var S=g;return S._p=new Promise(function(A,W){S.onload=A,S.onerror=W}),er(g,"link",c),r.state.loading|=4,Xc(g,l.precedence,e),r.instance=g;case"script":return g=qa(l.src),(p=e.querySelector(lo(g)))?(r.instance=p,It(p),p):(c=l,(p=Hr.get(g))&&(c=v({},l),Wh(c,p)),e=e.ownerDocument||e,p=e.createElement("script"),It(p),er(p,"link",c),e.head.appendChild(p),r.instance=p);case"void":return null;default:throw Error(a(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,Xc(c,l.precedence,e));return r.instance}function Xc(e,r,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=c.length?c[c.length-1]:null,g=p,S=0;S<c.length;S++){var A=c[S];if(A.dataset.precedence===r)g=A;else if(g!==p)break}g?g.parentNode.insertBefore(e,g.nextSibling):(r=l.nodeType===9?l.head:l,r.insertBefore(e,r.firstChild))}function Yh(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.title==null&&(e.title=r.title)}function Wh(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.integrity==null&&(e.integrity=r.integrity)}var Zc=null;function Qy(e,r,l){if(Zc===null){var c=new Map,p=Zc=new Map;p.set(l,c)}else p=Zc,c=p.get(l),c||(c=new Map,p.set(l,c));if(c.has(e))return c;for(c.set(e,null),l=l.getElementsByTagName(e),p=0;p<l.length;p++){var g=l[p];if(!(g[Me]||g[He]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var S=g.getAttribute(r)||"";S=e+S;var A=c.get(S);A?A.push(g):c.set(S,[g])}}return c}function Jy(e,r,l){e=e.ownerDocument||e,e.head.insertBefore(l,r==="title"?e.querySelector("head > title"):null)}function cS(e,r,l){if(l===1||r.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(e=r.disabled,typeof r.precedence=="string"&&e==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Xy(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function uS(e,r,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var p=Pa(c.href),g=r.querySelector(ao(p));if(g){r=g._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(e.count++,e=eu.bind(e),r.then(e,e)),l.state.loading|=4,l.instance=g,It(g);return}g=r.ownerDocument||r,c=Yy(c),(p=Hr.get(p))&&Yh(c,p),g=g.createElement("link"),It(g);var S=g;S._p=new Promise(function(A,W){S.onload=A,S.onerror=W}),er(g,"link",c),l.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(l,r),(r=l.state.preload)&&(l.state.loading&3)===0&&(e.count++,l=eu.bind(e),r.addEventListener("load",l),r.addEventListener("error",l))}}var Qh=0;function dS(e,r){return e.stylesheets&&e.count===0&&nu(e,e.stylesheets),0<e.count||0<e.imgCount?function(l){var c=setTimeout(function(){if(e.stylesheets&&nu(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+r);0<e.imgBytes&&Qh===0&&(Qh=62500*Gw());var p=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&nu(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>Qh?50:800)+r);return e.unsuspend=l,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(p)}}:null}function eu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)nu(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var tu=null;function nu(e,r){e.stylesheets=null,e.unsuspend!==null&&(e.count++,tu=new Map,r.forEach(hS,e),tu=null,eu.call(e))}function hS(e,r){if(!(r.state.loading&4)){var l=tu.get(e);if(l)var c=l.get(null);else{l=new Map,tu.set(e,l);for(var p=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<p.length;g++){var S=p[g];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(l.set(S.dataset.precedence,S),c=S)}c&&l.set(null,c)}p=r.instance,S=p.getAttribute("data-precedence"),g=l.get(S)||c,g===c&&l.set(null,p),l.set(S,p),this.count++,c=eu.bind(this),p.addEventListener("load",c),p.addEventListener("error",c),g?g.parentNode.insertBefore(p,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(p,e.firstChild)),r.state.loading|=4}}var oo={$$typeof:D,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function fS(e,r,l,c,p,g,S,A,W){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ht(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ht(0),this.hiddenUpdates=ht(null),this.identifierPrefix=c,this.onUncaughtError=p,this.onCaughtError=g,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function Zy(e,r,l,c,p,g,S,A,W,me,Ne,Te){return e=new fS(e,r,l,S,W,me,Ne,Te,A),r=1,g===!0&&(r|=24),g=Sr(3,null,null,r),e.current=g,g.stateNode=e,r=Td(),r.refCount++,e.pooledCache=r,r.refCount++,g.memoizedState={element:c,isDehydrated:l,cache:r},Dd(g),e}function ev(e){return e?(e=xa,e):xa}function tv(e,r,l,c,p,g){p=ev(p),c.context===null?c.context=p:c.pendingContext=p,c=si(r),c.payload={element:l},g=g===void 0?null:g,g!==null&&(c.callback=g),l=ii(e,c,r),l!==null&&(yr(l,e,r),$l(l,e,r))}function nv(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<r?l:r}}function Jh(e,r){nv(e,r),(e=e.alternate)&&nv(e,r)}function rv(e){if(e.tag===13||e.tag===31){var r=Mi(e,67108864);r!==null&&yr(r,e,67108864),Jh(e,67108864)}}function sv(e){if(e.tag===13||e.tag===31){var r=Er();r=Rt(r);var l=Mi(e,r);l!==null&&yr(l,e,r),Jh(e,r)}}var ru=!0;function pS(e,r,l,c){var p=R.T;R.T=null;var g=z.p;try{z.p=2,Xh(e,r,l,c)}finally{z.p=g,R.T=p}}function mS(e,r,l,c){var p=R.T;R.T=null;var g=z.p;try{z.p=8,Xh(e,r,l,c)}finally{z.p=g,R.T=p}}function Xh(e,r,l,c){if(ru){var p=Zh(c);if(p===null)Ih(e,r,c,su,l),av(e,c);else if(yS(p,e,r,l,c))c.stopPropagation();else if(av(e,c),r&4&&-1<gS.indexOf(e)){for(;p!==null;){var g=Ke(p);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var S=tt(g.pendingLanes);if(S!==0){var A=g;for(A.pendingLanes|=2,A.entangledLanes|=2;S;){var W=1<<31-qt(S);A.entanglements[1]|=W,S&=~W}ps(g),(sn&6)===0&&($c=Ct()+500,no(0))}}break;case 31:case 13:A=Mi(g,2),A!==null&&yr(A,g,2),qc(),Jh(g,2)}if(g=Zh(c),g===null&&Ih(e,r,c,su,l),g===p)break;p=g}p!==null&&c.stopPropagation()}else Ih(e,r,c,null,l)}}function Zh(e){return e=Cl(e),ef(e)}var su=null;function ef(e){if(su=null,e=Fe(e),e!==null){var r=u(e);if(r===null)e=null;else{var l=r.tag;if(l===13){if(e=d(r),e!==null)return e;e=null}else if(l===31){if(e=f(r),e!==null)return e;e=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null)}}return su=e,null}function iv(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(le()){case Ae:return 2;case Oe:return 8;case Ge:case nt:return 32;case St:return 268435456;default:return 32}default:return 32}}var tf=!1,gi=null,yi=null,vi=null,co=new Map,uo=new Map,xi=[],gS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function av(e,r){switch(e){case"focusin":case"focusout":gi=null;break;case"dragenter":case"dragleave":yi=null;break;case"mouseover":case"mouseout":vi=null;break;case"pointerover":case"pointerout":co.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":uo.delete(r.pointerId)}}function ho(e,r,l,c,p,g){return e===null||e.nativeEvent!==g?(e={blockedOn:r,domEventName:l,eventSystemFlags:c,nativeEvent:g,targetContainers:[p]},r!==null&&(r=Ke(r),r!==null&&rv(r)),e):(e.eventSystemFlags|=c,r=e.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),e)}function yS(e,r,l,c,p){switch(r){case"focusin":return gi=ho(gi,e,r,l,c,p),!0;case"dragenter":return yi=ho(yi,e,r,l,c,p),!0;case"mouseover":return vi=ho(vi,e,r,l,c,p),!0;case"pointerover":var g=p.pointerId;return co.set(g,ho(co.get(g)||null,e,r,l,c,p)),!0;case"gotpointercapture":return g=p.pointerId,uo.set(g,ho(uo.get(g)||null,e,r,l,c,p)),!0}return!1}function lv(e){var r=Fe(e.target);if(r!==null){var l=u(r);if(l!==null){if(r=l.tag,r===13){if(r=d(l),r!==null){e.blockedOn=r,ce(e.priority,function(){sv(l)});return}}else if(r===31){if(r=f(l),r!==null){e.blockedOn=r,ce(e.priority,function(){sv(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function iu(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var l=Zh(e.nativeEvent);if(l===null){l=e.nativeEvent;var c=new l.constructor(l.type,l);_l=c,l.target.dispatchEvent(c),_l=null}else return r=Ke(l),r!==null&&rv(r),e.blockedOn=l,!1;r.shift()}return!0}function ov(e,r,l){iu(e)&&l.delete(r)}function vS(){tf=!1,gi!==null&&iu(gi)&&(gi=null),yi!==null&&iu(yi)&&(yi=null),vi!==null&&iu(vi)&&(vi=null),co.forEach(ov),uo.forEach(ov)}function au(e,r){e.blockedOn===r&&(e.blockedOn=null,tf||(tf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,vS)))}var lu=null;function cv(e){lu!==e&&(lu=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){lu===e&&(lu=null);for(var r=0;r<e.length;r+=3){var l=e[r],c=e[r+1],p=e[r+2];if(typeof c!="function"){if(ef(c||l)===null)continue;break}var g=Ke(l);g!==null&&(e.splice(r,3),r-=3,Zd(g,{pending:!0,data:p,method:l.method,action:c},c,p))}}))}function Fa(e){function r(W){return au(W,e)}gi!==null&&au(gi,e),yi!==null&&au(yi,e),vi!==null&&au(vi,e),co.forEach(r),uo.forEach(r);for(var l=0;l<xi.length;l++){var c=xi[l];c.blockedOn===e&&(c.blockedOn=null)}for(;0<xi.length&&(l=xi[0],l.blockedOn===null);)lv(l),l.blockedOn===null&&xi.shift();if(l=(e.ownerDocument||e).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var p=l[c],g=l[c+1],S=p[pt]||null;if(typeof g=="function")S||cv(l);else if(S){var A=null;if(g&&g.hasAttribute("formAction")){if(p=g,S=g[pt]||null)A=S.formAction;else if(ef(p)!==null)continue}else A=S.action;typeof A=="function"?l[c+1]=A:(l.splice(c,3),c-=3),cv(l)}}}function uv(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(S){return p=S})},focusReset:"manual",scroll:"manual"})}function r(){p!==null&&(p(),p=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,p=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),p!==null&&(p(),p=null)}}}function nf(e){this._internalRoot=e}ou.prototype.render=nf.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(a(409));var l=r.current,c=Er();tv(l,c,e,r,null,null)},ou.prototype.unmount=nf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;tv(e.current,2,null,e,null,null),qc(),r[Dt]=null}};function ou(e){this._internalRoot=e}ou.prototype.unstable_scheduleHydration=function(e){if(e){var r=un();e={blockedOn:null,target:e,priority:r};for(var l=0;l<xi.length&&r!==0&&r<xi[l].priority;l++);xi.splice(l,0,e),l===0&&lv(e)}};var dv=t.version;if(dv!=="19.2.3")throw Error(a(527,dv,"19.2.3"));z.findDOMNode=function(e){var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=m(r),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var xS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cu.isDisabled&&cu.supportsFiber)try{Jt=cu.inject(xS),dt=cu}catch{}}return po.createRoot=function(e,r){if(!o(e))throw Error(a(299));var l=!1,c="",p=vg,g=xg,S=bg;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(g=r.onCaughtError),r.onRecoverableError!==void 0&&(S=r.onRecoverableError)),r=Zy(e,1,!1,null,null,l,c,null,p,g,S,uv),e[Dt]=r.current,Lh(e),new nf(r)},po.hydrateRoot=function(e,r,l){if(!o(e))throw Error(a(299));var c=!1,p="",g=vg,S=xg,A=bg,W=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(g=l.onUncaughtError),l.onCaughtError!==void 0&&(S=l.onCaughtError),l.onRecoverableError!==void 0&&(A=l.onRecoverableError),l.formState!==void 0&&(W=l.formState)),r=Zy(e,1,!0,r,l??null,c,p,W,g,S,A,uv),r.context=ev(null),l=r.current,c=Er(),c=Rt(c),p=si(c),p.callback=null,ii(l,p,c),l=c,r.current.lanes=l,Pt(r,l),ps(r),e[Dt]=r.current,Lh(e),new ou(r)},po.version="19.2.3",po}var wv;function kS(){if(wv)return af.exports;wv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),af.exports=ES(),af.exports}var TS=kS();var Sv="popstate";function RS(n={}){function t(a,o){let{pathname:u,search:d,hash:f}=a.location;return Wf("",{pathname:u,search:d,hash:f},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function i(a,o){return typeof o=="string"?o:Ao(o)}return OS(t,i,null,n)}function Vn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Kr(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function AS(){return Math.random().toString(36).substring(2,10)}function jv(n,t){return{usr:n.state,key:n.key,idx:t}}function Wf(n,t,i=null,a){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?Ho(t):t,state:i,key:t&&t.key||a||AS()}}function Ao({pathname:n="/",search:t="",hash:i=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(n+=i.charAt(0)==="#"?i:"#"+i),n}function Ho(n){let t={};if(n){let i=n.indexOf("#");i>=0&&(t.hash=n.substring(i),n=n.substring(0,i));let a=n.indexOf("?");a>=0&&(t.search=n.substring(a),n=n.substring(0,a)),n&&(t.pathname=n)}return t}function OS(n,t,i,a={}){let{window:o=document.defaultView,v5Compat:u=!1}=a,d=o.history,f="POP",h=null,m=y();m==null&&(m=0,d.replaceState({...d.state,idx:m},""));function y(){return(d.state||{idx:null}).idx}function v(){f="POP";let j=y(),k=j==null?null:j-m;m=j,h&&h({action:f,location:C.location,delta:k})}function x(j,k){f="PUSH";let E=Wf(C.location,j,k);m=y()+1;let D=jv(E,m),U=C.createHref(E);try{d.pushState(D,"",U)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;o.location.assign(U)}u&&h&&h({action:f,location:C.location,delta:1})}function b(j,k){f="REPLACE";let E=Wf(C.location,j,k);m=y();let D=jv(E,m),U=C.createHref(E);d.replaceState(D,"",U),u&&h&&h({action:f,location:C.location,delta:0})}function _(j){return DS(j)}let C={get action(){return f},get location(){return n(o,d)},listen(j){if(h)throw new Error("A history only accepts one active listener");return o.addEventListener(Sv,v),h=j,()=>{o.removeEventListener(Sv,v),h=null}},createHref(j){return t(o,j)},createURL:_,encodeLocation(j){let k=_(j);return{pathname:k.pathname,search:k.search,hash:k.hash}},push:x,replace:b,go(j){return d.go(j)}};return C}function DS(n,t=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Vn(i,"No window.location.(origin|href) available to create URL");let a=typeof n=="string"?n:Ao(n);return a=a.replace(/ $/,"%20"),!t&&a.startsWith("//")&&(a=i+a),new URL(a,i)}function n0(n,t,i="/"){return MS(n,t,i,!1)}function MS(n,t,i,a){let o=typeof t=="string"?Ho(t):t,u=Ps(o.pathname||"/",i);if(u==null)return null;let d=r0(n);zS(d);let f=null;for(let h=0;f==null&&h<d.length;++h){let m=VS(u);f=HS(d[h],m,a)}return f}function r0(n,t=[],i=[],a="",o=!1){let u=(d,f,h=o,m)=>{let y={relativePath:m===void 0?d.path||"":m,caseSensitive:d.caseSensitive===!0,childrenIndex:f,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(a)&&h)return;Vn(y.relativePath.startsWith(a),`Absolute route path "${y.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(a.length)}let v=$s([a,y.relativePath]),x=i.concat(y);d.children&&d.children.length>0&&(Vn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),r0(d.children,t,x,v,h)),!(d.path==null&&!d.index)&&t.push({path:v,score:qS(v,d.index),routesMeta:x})};return n.forEach((d,f)=>{if(d.path===""||!d.path?.includes("?"))u(d,f);else for(let h of s0(d.path))u(d,f,!0,h)}),t}function s0(n){let t=n.split("/");if(t.length===0)return[];let[i,...a]=t,o=i.endsWith("?"),u=i.replace(/\?$/,"");if(a.length===0)return o?[u,""]:[u];let d=s0(a.join("/")),f=[];return f.push(...d.map(h=>h===""?u:[u,h].join("/"))),o&&f.push(...d),f.map(h=>n.startsWith("/")&&h===""?"/":h)}function zS(n){n.sort((t,i)=>t.score!==i.score?i.score-t.score:FS(t.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}var US=/^:[\w-]+$/,LS=3,IS=2,BS=1,$S=10,PS=-2,_v=n=>n==="*";function qS(n,t){let i=n.split("/"),a=i.length;return i.some(_v)&&(a+=PS),t&&(a+=IS),i.filter(o=>!_v(o)).reduce((o,u)=>o+(US.test(u)?LS:u===""?BS:$S),a)}function FS(n,t){return n.length===t.length&&n.slice(0,-1).every((a,o)=>a===t[o])?n[n.length-1]-t[t.length-1]:0}function HS(n,t,i=!1){let{routesMeta:a}=n,o={},u="/",d=[];for(let f=0;f<a.length;++f){let h=a[f],m=f===a.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=Au({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},y),x=h.route;if(!v&&m&&i&&!a[a.length-1].route.index&&(v=Au({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},y)),!v)return null;Object.assign(o,v.params),d.push({params:o,pathname:$s([u,v.pathname]),pathnameBase:QS($s([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=$s([u,v.pathnameBase]))}return d}function Au(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[i,a]=GS(n.path,n.caseSensitive,n.end),o=t.match(i);if(!o)return null;let u=o[0],d=u.replace(/(.)\/+$/,"$1"),f=o.slice(1);return{params:a.reduce((m,{paramName:y,isOptional:v},x)=>{if(y==="*"){let _=f[x]||"";d=u.slice(0,u.length-_.length).replace(/(.)\/+$/,"$1")}const b=f[x];return v&&!b?m[y]=void 0:m[y]=(b||"").replace(/%2F/g,"/"),m},{}),pathname:u,pathnameBase:d,pattern:n}}function GS(n,t=!1,i=!0){Kr(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let a=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,f,h)=>(a.push({paramName:f,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(a.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),a]}function VS(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Kr(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Ps(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,a=n.charAt(i);return a&&a!=="/"?null:n.slice(i)||"/"}var i0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,KS=n=>i0.test(n);function YS(n,t="/"){let{pathname:i,search:a="",hash:o=""}=typeof n=="string"?Ho(n):n,u;if(i)if(KS(i))u=i;else{if(i.includes("//")){let d=i;i=i.replace(/\/\/+/g,"/"),Kr(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${i}`)}i.startsWith("/")?u=Cv(i.substring(1),"/"):u=Cv(i,t)}else u=t;return{pathname:u,search:JS(a),hash:XS(o)}}function Cv(n,t){let i=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?i.length>1&&i.pop():o!=="."&&i.push(o)}),i.length>1?i.join("/"):"/"}function uf(n,t,i,a){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function WS(n){return n.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function a0(n){let t=WS(n);return t.map((i,a)=>a===t.length-1?i.pathname:i.pathnameBase)}function l0(n,t,i,a=!1){let o;typeof n=="string"?o=Ho(n):(o={...n},Vn(!o.pathname||!o.pathname.includes("?"),uf("?","pathname","search",o)),Vn(!o.pathname||!o.pathname.includes("#"),uf("#","pathname","hash",o)),Vn(!o.search||!o.search.includes("#"),uf("#","search","hash",o)));let u=n===""||o.pathname==="",d=u?"/":o.pathname,f;if(d==null)f=i;else{let v=t.length-1;if(!a&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;o.pathname=x.join("/")}f=v>=0?t[v]:"/"}let h=YS(o,f),m=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&i.endsWith("/");return!h.pathname.endsWith("/")&&(m||y)&&(h.pathname+="/"),h}var $s=n=>n.join("/").replace(/\/\/+/g,"/"),QS=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),JS=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,XS=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,ZS=class{constructor(n,t,i,a=!1){this.status=n,this.statusText=t||"",this.internal=a,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}};function ej(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function tj(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var o0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function c0(n,t){let i=n;if(typeof i!="string"||!i0.test(i))return{absoluteURL:void 0,isExternal:!1,to:i};let a=i,o=!1;if(o0)try{let u=new URL(window.location.href),d=i.startsWith("//")?new URL(u.protocol+i):new URL(i),f=Ps(d.pathname,t);d.origin===u.origin&&f!=null?i=f+d.search+d.hash:o=!0}catch{Kr(!1,`<Link to="${i}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:o,to:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var u0=["POST","PUT","PATCH","DELETE"];new Set(u0);var nj=["GET",...u0];new Set(nj);var fl=w.createContext(null);fl.displayName="DataRouter";var Hu=w.createContext(null);Hu.displayName="DataRouterState";var rj=w.createContext(!1),d0=w.createContext({isTransitioning:!1});d0.displayName="ViewTransition";var sj=w.createContext(new Map);sj.displayName="Fetchers";var ij=w.createContext(null);ij.displayName="Await";var Yr=w.createContext(null);Yr.displayName="Navigation";var Gu=w.createContext(null);Gu.displayName="Location";var Fs=w.createContext({outlet:null,matches:[],isDataRoute:!1});Fs.displayName="Route";var xp=w.createContext(null);xp.displayName="RouteError";var h0="REACT_ROUTER_ERROR",aj="REDIRECT",lj="ROUTE_ERROR_RESPONSE";function oj(n){if(n.startsWith(`${h0}:${aj}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function cj(n){if(n.startsWith(`${h0}:${lj}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new ZS(t.status,t.statusText,t.data)}catch{}}function uj(n,{relative:t}={}){Vn(Go(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:a}=w.useContext(Yr),{hash:o,pathname:u,search:d}=Vo(n,{relative:t}),f=u;return i!=="/"&&(f=u==="/"?i:$s([i,u])),a.createHref({pathname:f,search:d,hash:o})}function Go(){return w.useContext(Gu)!=null}function Hs(){return Vn(Go(),"useLocation() may be used only in the context of a <Router> component."),w.useContext(Gu).location}var f0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function p0(n){w.useContext(Yr).static||w.useLayoutEffect(n)}function m0(){let{isDataRoute:n}=w.useContext(Fs);return n?jj():dj()}function dj(){Vn(Go(),"useNavigate() may be used only in the context of a <Router> component.");let n=w.useContext(fl),{basename:t,navigator:i}=w.useContext(Yr),{matches:a}=w.useContext(Fs),{pathname:o}=Hs(),u=JSON.stringify(a0(a)),d=w.useRef(!1);return p0(()=>{d.current=!0}),w.useCallback((h,m={})=>{if(Kr(d.current,f0),!d.current)return;if(typeof h=="number"){i.go(h);return}let y=l0(h,JSON.parse(u),o,m.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:$s([t,y.pathname])),(m.replace?i.replace:i.push)(y,m.state,m)},[t,i,u,o,n])}w.createContext(null);function Vo(n,{relative:t}={}){let{matches:i}=w.useContext(Fs),{pathname:a}=Hs(),o=JSON.stringify(a0(i));return w.useMemo(()=>l0(n,JSON.parse(o),a,t==="path"),[n,o,a,t])}function hj(n,t,i,a,o){Vn(Go(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=w.useContext(Yr),{matches:d}=w.useContext(Fs),f=d[d.length-1],h=f?f.params:{},m=f?f.pathname:"/",y=f?f.pathnameBase:"/",v=f&&f.route;{let E=v&&v.path||"";y0(m,!v||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let x=Hs(),b;b=x;let _=b.pathname||"/",C=_;if(y!=="/"){let E=y.replace(/^\//,"").split("/");C="/"+_.replace(/^\//,"").split("/").slice(E.length).join("/")}let j=n0(n,{pathname:C});return Kr(v||j!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),Kr(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),yj(j&&j.map(E=>Object.assign({},E,{params:Object.assign({},h,E.params),pathname:$s([y,u.encodeLocation?u.encodeLocation(E.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?y:$s([y,u.encodeLocation?u.encodeLocation(E.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathnameBase])})),d,i,a,o)}function fj(){let n=Sj(),t=ej(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),i=n instanceof Error?n.stack:null,a="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:a},u={padding:"2px 4px",backgroundColor:a},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=w.createElement(w.Fragment,null,w.createElement("p",null," Hey developer "),w.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",w.createElement("code",{style:u},"ErrorBoundary")," or"," ",w.createElement("code",{style:u},"errorElement")," prop on your route.")),w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},t),i?w.createElement("pre",{style:o},i):null,d)}var pj=w.createElement(fj,null),g0=class extends w.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const i=cj(n.digest);i&&(n=i)}let t=n!==void 0?w.createElement(Fs.Provider,{value:this.props.routeContext},w.createElement(xp.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?w.createElement(mj,{error:n},t):t}};g0.contextType=rj;var df=new WeakMap;function mj({children:n,error:t}){let{basename:i}=w.useContext(Yr);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let a=oj(t.digest);if(a){let o=df.get(t);if(o)throw o;let u=c0(a.location,i);if(o0&&!df.get(t))if(u.isExternal||a.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:a.replace}));throw df.set(t,d),d}return w.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function gj({routeContext:n,match:t,children:i}){let a=w.useContext(fl);return a&&a.static&&a.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=t.route.id),w.createElement(Fs.Provider,{value:n},i)}function yj(n,t=[],i=null,a=null,o=null){if(n==null){if(!i)return null;if(i.errors)n=i.matches;else if(t.length===0&&!i.initialized&&i.matches.length>0)n=i.matches;else return null}let u=n,d=i?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);Vn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let f=!1,h=-1;if(i)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(h=y),v.route.id){let{loaderData:x,errors:b}=i,_=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!b||b[v.route.id]===void 0);if(v.route.lazy||_){f=!0,h>=0?u=u.slice(0,h+1):u=[u[0]];break}}}let m=i&&a?(y,v)=>{a(y,{location:i.location,params:i.matches?.[0]?.params??{},unstable_pattern:tj(i.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let b,_=!1,C=null,j=null;i&&(b=d&&v.route.id?d[v.route.id]:void 0,C=v.route.errorElement||pj,f&&(h<0&&x===0?(y0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),_=!0,j=null):h===x&&(_=!0,j=v.route.hydrateFallbackElement||null)));let k=t.concat(u.slice(0,x+1)),E=()=>{let D;return b?D=C:_?D=j:v.route.Component?D=w.createElement(v.route.Component,null):v.route.element?D=v.route.element:D=y,w.createElement(gj,{match:v,routeContext:{outlet:y,matches:k,isDataRoute:i!=null},children:D})};return i&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?w.createElement(g0,{location:i.location,revalidation:i.revalidation,component:C,error:b,children:E(),routeContext:{outlet:null,matches:k,isDataRoute:!0},onError:m}):E()},null)}function bp(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function vj(n){let t=w.useContext(fl);return Vn(t,bp(n)),t}function xj(n){let t=w.useContext(Hu);return Vn(t,bp(n)),t}function bj(n){let t=w.useContext(Fs);return Vn(t,bp(n)),t}function wp(n){let t=bj(n),i=t.matches[t.matches.length-1];return Vn(i.route.id,`${n} can only be used on routes that contain a unique "id"`),i.route.id}function wj(){return wp("useRouteId")}function Sj(){let n=w.useContext(xp),t=xj("useRouteError"),i=wp("useRouteError");return n!==void 0?n:t.errors?.[i]}function jj(){let{router:n}=vj("useNavigate"),t=wp("useNavigate"),i=w.useRef(!1);return p0(()=>{i.current=!0}),w.useCallback(async(o,u={})=>{Kr(i.current,f0),i.current&&(typeof o=="number"?await n.navigate(o):await n.navigate(o,{fromRouteId:t,...u}))},[n,t])}var Nv={};function y0(n,t,i){!t&&!Nv[n]&&(Nv[n]=!0,Kr(!1,i))}w.memo(_j);function _j({routes:n,future:t,state:i,onError:a}){return hj(n,void 0,i,a,t)}function Cj({basename:n="/",children:t=null,location:i,navigationType:a="POP",navigator:o,static:u=!1,unstable_useTransitions:d}){Vn(!Go(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=n.replace(/^\/*/,"/"),h=w.useMemo(()=>({basename:f,navigator:o,static:u,unstable_useTransitions:d,future:{}}),[f,o,u,d]);typeof i=="string"&&(i=Ho(i));let{pathname:m="/",search:y="",hash:v="",state:x=null,key:b="default"}=i,_=w.useMemo(()=>{let C=Ps(m,f);return C==null?null:{location:{pathname:C,search:y,hash:v,state:x,key:b},navigationType:a}},[f,m,y,v,x,b,a]);return Kr(_!=null,`<Router basename="${f}"> is not able to match the URL "${m}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:w.createElement(Yr.Provider,{value:h},w.createElement(Gu.Provider,{children:t,value:_}))}var Cu="get",Nu="application/x-www-form-urlencoded";function Vu(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function Nj(n){return Vu(n)&&n.tagName.toLowerCase()==="button"}function Ej(n){return Vu(n)&&n.tagName.toLowerCase()==="form"}function kj(n){return Vu(n)&&n.tagName.toLowerCase()==="input"}function Tj(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Rj(n,t){return n.button===0&&(!t||t==="_self")&&!Tj(n)}function Qf(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,i)=>{let a=n[i];return t.concat(Array.isArray(a)?a.map(o=>[i,o]):[[i,a]])},[]))}function Aj(n,t){let i=Qf(n);return t&&t.forEach((a,o)=>{i.has(o)||t.getAll(o).forEach(u=>{i.append(o,u)})}),i}var uu=null;function Oj(){if(uu===null)try{new FormData(document.createElement("form"),0),uu=!1}catch{uu=!0}return uu}var Dj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function hf(n){return n!=null&&!Dj.has(n)?(Kr(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nu}"`),null):n}function Mj(n,t){let i,a,o,u,d;if(Ej(n)){let f=n.getAttribute("action");a=f?Ps(f,t):null,i=n.getAttribute("method")||Cu,o=hf(n.getAttribute("enctype"))||Nu,u=new FormData(n)}else if(Nj(n)||kj(n)&&(n.type==="submit"||n.type==="image")){let f=n.form;if(f==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=n.getAttribute("formaction")||f.getAttribute("action");if(a=h?Ps(h,t):null,i=n.getAttribute("formmethod")||f.getAttribute("method")||Cu,o=hf(n.getAttribute("formenctype"))||hf(f.getAttribute("enctype"))||Nu,u=new FormData(f,n),!Oj()){let{name:m,type:y,value:v}=n;if(y==="image"){let x=m?`${m}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else m&&u.append(m,v)}}else{if(Vu(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=Cu,a=null,o=Nu,d=n}return u&&o==="text/plain"&&(d=u,u=void 0),{action:a,method:i.toLowerCase(),encType:o,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Sp(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function zj(n,t,i){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return a.pathname==="/"?a.pathname=`_root.${i}`:t&&Ps(a.pathname,t)==="/"?a.pathname=`${t.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function Uj(n,t){if(n.id in t)return t[n.id];try{let i=await import(n.module);return t[n.id]=i,i}catch(i){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Lj(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Ij(n,t,i){let a=await Promise.all(n.map(async o=>{let u=t.routes[o.route.id];if(u){let d=await Uj(u,i);return d.links?d.links():[]}return[]}));return qj(a.flat(1).filter(Lj).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function Ev(n,t,i,a,o,u){let d=(h,m)=>i[m]?h.route.id!==i[m].route.id:!0,f=(h,m)=>i[m].pathname!==h.pathname||i[m].route.path?.endsWith("*")&&i[m].params["*"]!==h.params["*"];return u==="assets"?t.filter((h,m)=>d(h,m)||f(h,m)):u==="data"?t.filter((h,m)=>{let y=a.routes[h.route.id];if(!y||!y.hasLoader)return!1;if(d(h,m)||f(h,m))return!0;if(h.route.shouldRevalidate){let v=h.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:i[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function Bj(n,t,{includeHydrateFallback:i}={}){return $j(n.map(a=>{let o=t.routes[a.route.id];if(!o)return[];let u=[o.module];return o.clientActionModule&&(u=u.concat(o.clientActionModule)),o.clientLoaderModule&&(u=u.concat(o.clientLoaderModule)),i&&o.hydrateFallbackModule&&(u=u.concat(o.hydrateFallbackModule)),o.imports&&(u=u.concat(o.imports)),u}).flat(1))}function $j(n){return[...new Set(n)]}function Pj(n){let t={},i=Object.keys(n).sort();for(let a of i)t[a]=n[a];return t}function qj(n,t){let i=new Set;return new Set(t),n.reduce((a,o)=>{let u=JSON.stringify(Pj(o));return i.has(u)||(i.add(u),a.push({key:u,link:o})),a},[])}function v0(){let n=w.useContext(fl);return Sp(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function Fj(){let n=w.useContext(Hu);return Sp(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var jp=w.createContext(void 0);jp.displayName="FrameworkContext";function x0(){let n=w.useContext(jp);return Sp(n,"You must render this element inside a <HydratedRouter> element"),n}function Hj(n,t){let i=w.useContext(jp),[a,o]=w.useState(!1),[u,d]=w.useState(!1),{onFocus:f,onBlur:h,onMouseEnter:m,onMouseLeave:y,onTouchStart:v}=t,x=w.useRef(null);w.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let C=k=>{k.forEach(E=>{d(E.isIntersecting)})},j=new IntersectionObserver(C,{threshold:.5});return x.current&&j.observe(x.current),()=>{j.disconnect()}}},[n]),w.useEffect(()=>{if(a){let C=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(C)}}},[a]);let b=()=>{o(!0)},_=()=>{o(!1),d(!1)};return i?n!=="intent"?[u,x,{}]:[u,x,{onFocus:mo(f,b),onBlur:mo(h,_),onMouseEnter:mo(m,b),onMouseLeave:mo(y,_),onTouchStart:mo(v,b)}]:[!1,x,{}]}function mo(n,t){return i=>{n&&n(i),i.defaultPrevented||t(i)}}function Gj({page:n,...t}){let{router:i}=v0(),a=w.useMemo(()=>n0(i.routes,n,i.basename),[i.routes,n,i.basename]);return a?w.createElement(Kj,{page:n,matches:a,...t}):null}function Vj(n){let{manifest:t,routeModules:i}=x0(),[a,o]=w.useState([]);return w.useEffect(()=>{let u=!1;return Ij(n,t,i).then(d=>{u||o(d)}),()=>{u=!0}},[n,t,i]),a}function Kj({page:n,matches:t,...i}){let a=Hs(),{manifest:o,routeModules:u}=x0(),{basename:d}=v0(),{loaderData:f,matches:h}=Fj(),m=w.useMemo(()=>Ev(n,t,h,o,a,"data"),[n,t,h,o,a]),y=w.useMemo(()=>Ev(n,t,h,o,a,"assets"),[n,t,h,o,a]),v=w.useMemo(()=>{if(n===a.pathname+a.search+a.hash)return[];let _=new Set,C=!1;if(t.forEach(k=>{let E=o.routes[k.route.id];!E||!E.hasLoader||(!m.some(D=>D.route.id===k.route.id)&&k.route.id in f&&u[k.route.id]?.shouldRevalidate||E.hasClientLoader?C=!0:_.add(k.route.id))}),_.size===0)return[];let j=zj(n,d,"data");return C&&_.size>0&&j.searchParams.set("_routes",t.filter(k=>_.has(k.route.id)).map(k=>k.route.id).join(",")),[j.pathname+j.search]},[d,f,a,o,m,t,n,u]),x=w.useMemo(()=>Bj(y,o),[y,o]),b=Vj(y);return w.createElement(w.Fragment,null,v.map(_=>w.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...i})),x.map(_=>w.createElement("link",{key:_,rel:"modulepreload",href:_,...i})),b.map(({key:_,link:C})=>w.createElement("link",{key:_,nonce:i.nonce,...C})))}function Yj(...n){return t=>{n.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}var Wj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Wj&&(window.__reactRouterVersion="7.11.0")}catch{}function Qj({basename:n,children:t,unstable_useTransitions:i,window:a}){let o=w.useRef();o.current==null&&(o.current=RS({window:a,v5Compat:!0}));let u=o.current,[d,f]=w.useState({action:u.action,location:u.location}),h=w.useCallback(m=>{i===!1?f(m):w.startTransition(()=>f(m))},[i]);return w.useLayoutEffect(()=>u.listen(h),[u,h]),w.createElement(Cj,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:i})}var b0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,w0=w.forwardRef(function({onClick:t,discover:i="render",prefetch:a="none",relative:o,reloadDocument:u,replace:d,state:f,target:h,to:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...b},_){let{basename:C,unstable_useTransitions:j}=w.useContext(Yr),k=typeof m=="string"&&b0.test(m),E=c0(m,C);m=E.to;let D=uj(m,{relative:o}),[U,B,T]=Hj(a,b),N=e_(m,{replace:d,state:f,target:h,preventScrollReset:y,relative:o,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:j});function O(Y){t&&t(Y),Y.defaultPrevented||N(Y)}let L=w.createElement("a",{...b,...T,href:E.absoluteURL||D,onClick:E.isExternal||u?t:O,ref:Yj(_,B),target:h,"data-discover":!k&&i==="render"?"true":void 0});return U&&!k?w.createElement(w.Fragment,null,L,w.createElement(Gj,{page:D})):L});w0.displayName="Link";var Jj=w.forwardRef(function({"aria-current":t="page",caseSensitive:i=!1,className:a="",end:o=!1,style:u,to:d,viewTransition:f,children:h,...m},y){let v=Vo(d,{relative:m.relative}),x=Hs(),b=w.useContext(Hu),{navigator:_,basename:C}=w.useContext(Yr),j=b!=null&&i_(v)&&f===!0,k=_.encodeLocation?_.encodeLocation(v).pathname:v.pathname,E=x.pathname,D=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;i||(E=E.toLowerCase(),D=D?D.toLowerCase():null,k=k.toLowerCase()),D&&C&&(D=Ps(D,C)||D);const U=k!=="/"&&k.endsWith("/")?k.length-1:k.length;let B=E===k||!o&&E.startsWith(k)&&E.charAt(U)==="/",T=D!=null&&(D===k||!o&&D.startsWith(k)&&D.charAt(k.length)==="/"),N={isActive:B,isPending:T,isTransitioning:j},O=B?t:void 0,L;typeof a=="function"?L=a(N):L=[a,B?"active":null,T?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let Y=typeof u=="function"?u(N):u;return w.createElement(w0,{...m,"aria-current":O,className:L,ref:y,style:Y,to:d,viewTransition:f},typeof h=="function"?h(N):h)});Jj.displayName="NavLink";var Xj=w.forwardRef(({discover:n="render",fetcherKey:t,navigate:i,reloadDocument:a,replace:o,state:u,method:d=Cu,action:f,onSubmit:h,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...b},_)=>{let{unstable_useTransitions:C}=w.useContext(Yr),j=r_(),k=s_(f,{relative:m}),E=d.toLowerCase()==="get"?"get":"post",D=typeof f=="string"&&b0.test(f),U=B=>{if(h&&h(B),B.defaultPrevented)return;B.preventDefault();let T=B.nativeEvent.submitter,N=T?.getAttribute("formmethod")||d,O=()=>j(T||B.currentTarget,{fetcherKey:t,method:N,navigate:i,replace:o,state:u,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});C&&i!==!1?w.startTransition(()=>O()):O()};return w.createElement("form",{ref:_,method:E,action:k,onSubmit:a?h:U,...b,"data-discover":!D&&n==="render"?"true":void 0})});Xj.displayName="Form";function Zj(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function S0(n){let t=w.useContext(fl);return Vn(t,Zj(n)),t}function e_(n,{target:t,replace:i,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:h}={}){let m=m0(),y=Hs(),v=Vo(n,{relative:u});return w.useCallback(x=>{if(Rj(x,t)){x.preventDefault();let b=i!==void 0?i:Ao(y)===Ao(v),_=()=>m(n,{replace:b,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f});h?w.startTransition(()=>_()):_()}},[y,m,v,i,a,t,n,o,u,d,f,h])}function Ko(n){Kr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=w.useRef(Qf(n)),i=w.useRef(!1),a=Hs(),o=w.useMemo(()=>Aj(a.search,i.current?null:t.current),[a.search]),u=m0(),d=w.useCallback((f,h)=>{const m=Qf(typeof f=="function"?f(new URLSearchParams(o)):f);i.current=!0,u("?"+m,h)},[u,o]);return[o,d]}var t_=0,n_=()=>`__${String(++t_)}__`;function r_(){let{router:n}=S0("useSubmit"),{basename:t}=w.useContext(Yr),i=wj(),a=n.fetch,o=n.navigate;return w.useCallback(async(u,d={})=>{let{action:f,method:h,encType:m,formData:y,body:v}=Mj(u,t);if(d.navigate===!1){let x=d.fetcherKey||n_();await a(x,i,d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||h,formEncType:d.encType||m,flushSync:d.flushSync})}else await o(d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||h,formEncType:d.encType||m,replace:d.replace,state:d.state,fromRouteId:i,flushSync:d.flushSync,viewTransition:d.viewTransition})},[a,o,t,i])}function s_(n,{relative:t}={}){let{basename:i}=w.useContext(Yr),a=w.useContext(Fs);Vn(a,"useFormAction must be used inside a RouteContext");let[o]=a.matches.slice(-1),u={...Vo(n||".",{relative:t})},d=Hs();if(n==null){u.search=d.search;let f=new URLSearchParams(u.search),h=f.getAll("index");if(h.some(y=>y==="")){f.delete("index"),h.filter(v=>v).forEach(v=>f.append("index",v));let y=f.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&o.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(u.pathname=u.pathname==="/"?i:$s([i,u.pathname])),Ao(u)}function i_(n,{relative:t}={}){let i=w.useContext(d0);Vn(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=S0("useViewTransitionState"),o=Vo(n,{relative:t});if(!i.isTransitioning)return!1;let u=Ps(i.currentLocation.pathname,a)||i.currentLocation.pathname,d=Ps(i.nextLocation.pathname,a)||i.nextLocation.pathname;return Au(o.pathname,d)!=null||Au(o.pathname,u)!=null}var ra=t0();const a_=({children:n})=>(Hs(),s.jsxs("div",{className:"app-layout",children:[s.jsx("header",{className:"app-header",children:s.jsx("div",{className:"container app-header__content",children:s.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),s.jsx("main",{className:"container app-main",children:n}),s.jsx("footer",{className:"app-footer",children:s.jsx("div",{className:"container",children:s.jsx("p",{children:" 2026 recipe management"})})})]})),an=({children:n,className:t="",hoverable:i=!1,...a})=>s.jsx("div",{className:`glass-card ${i?"glass-card--hoverable":""} ${t}`,...a,children:n}),se=({children:n,variant:t="primary",size:i="md",isLoading:a,block:o,className:u="",...d})=>{const f=["btn",`btn--${t}`,`btn--${i}`,o?"btn--block":"",a?"btn--loading":"",u].filter(Boolean).join(" ");return s.jsxs("button",{className:f,disabled:a,...d,children:[a&&s.jsx("span",{className:"btn__spinner"}),s.jsx("span",{className:"btn__content",children:n})]})};function l_(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return w.useMemo(()=>a=>{t.forEach(o=>o(a))},t)}const Ku=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function pl(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function _p(n){return"nodeType"in n}function ur(n){var t,i;return n?pl(n)?n:_p(n)&&(t=(i=n.ownerDocument)==null?void 0:i.defaultView)!=null?t:window:window}function Cp(n){const{Document:t}=ur(n);return n instanceof t}function Yo(n){return pl(n)?!1:n instanceof ur(n).HTMLElement}function j0(n){return n instanceof ur(n).SVGElement}function ml(n){return n?pl(n)?n.document:_p(n)?Cp(n)?n:Yo(n)||j0(n)?n.ownerDocument:document:document:document}const os=Ku?w.useLayoutEffect:w.useEffect;function Yu(n){const t=w.useRef(n);return os(()=>{t.current=n}),w.useCallback(function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t.current==null?void 0:t.current(...a)},[])}function o_(){const n=w.useRef(null),t=w.useCallback((a,o)=>{n.current=setInterval(a,o)},[]),i=w.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,i]}function Oo(n,t){t===void 0&&(t=[n]);const i=w.useRef(n);return os(()=>{i.current!==n&&(i.current=n)},t),i}function Wo(n,t){const i=w.useRef();return w.useMemo(()=>{const a=n(i.current);return i.current=a,a},[...t])}function Ou(n){const t=Yu(n),i=w.useRef(null),a=w.useCallback(o=>{o!==i.current&&t?.(o,i.current),i.current=o},[]);return[i,a]}function Du(n){const t=w.useRef();return w.useEffect(()=>{t.current=n},[n]),t.current}let ff={};function Qo(n,t){return w.useMemo(()=>{if(t)return t;const i=ff[n]==null?0:ff[n]+1;return ff[n]=i,n+"-"+i},[n,t])}function _0(n){return function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return a.reduce((u,d)=>{const f=Object.entries(d);for(const[h,m]of f){const y=u[h];y!=null&&(u[h]=y+n*m)}return u},{...t})}}const ol=_0(1),Do=_0(-1);function c_(n){return"clientX"in n&&"clientY"in n}function Wu(n){if(!n)return!1;const{KeyboardEvent:t}=ur(n.target);return t&&n instanceof t}function u_(n){if(!n)return!1;const{TouchEvent:t}=ur(n.target);return t&&n instanceof t}function Mu(n){if(u_(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:i}=n.touches[0];return{x:t,y:i}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:i}=n.changedTouches[0];return{x:t,y:i}}}return c_(n)?{x:n.clientX,y:n.clientY}:null}const Or=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:i}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(i?Math.round(i):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:i}=n;return"scaleX("+t+") scaleY("+i+")"}},Transform:{toString(n){if(n)return[Or.Translate.toString(n),Or.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:i,easing:a}=n;return t+" "+i+"ms "+a}}}),kv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function d_(n){return n.matches(kv)?n:n.querySelector(kv)}const h_={display:"none"};function f_(n){let{id:t,value:i}=n;return Ce.createElement("div",{id:t,style:h_},i)}function p_(n){let{id:t,announcement:i,ariaLiveType:a="assertive"}=n;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ce.createElement("div",{id:t,style:o,role:"status","aria-live":a,"aria-atomic":!0},i)}function m_(){const[n,t]=w.useState("");return{announce:w.useCallback(a=>{a!=null&&t(a)},[]),announcement:n}}const C0=w.createContext(null);function g_(n){const t=w.useContext(C0);w.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function y_(){const[n]=w.useState(()=>new Set),t=w.useCallback(a=>(n.add(a),()=>n.delete(a)),[n]);return[w.useCallback(a=>{let{type:o,event:u}=a;n.forEach(d=>{var f;return(f=d[o])==null?void 0:f.call(d,u)})},[n]),t]}const v_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},x_={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:i}=n;return i?"Draggable item "+t.id+" was moved over droppable area "+i.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:i}=n;return i?"Draggable item "+t.id+" was dropped over droppable area "+i.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function b_(n){let{announcements:t=x_,container:i,hiddenTextDescribedById:a,screenReaderInstructions:o=v_}=n;const{announce:u,announcement:d}=m_(),f=Qo("DndLiveRegion"),[h,m]=w.useState(!1);if(w.useEffect(()=>{m(!0)},[]),g_(w.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:b}=v;t.onDragMove&&u(t.onDragMove({active:x,over:b}))},onDragOver(v){let{active:x,over:b}=v;u(t.onDragOver({active:x,over:b}))},onDragEnd(v){let{active:x,over:b}=v;u(t.onDragEnd({active:x,over:b}))},onDragCancel(v){let{active:x,over:b}=v;u(t.onDragCancel({active:x,over:b}))}}),[u,t])),!h)return null;const y=Ce.createElement(Ce.Fragment,null,Ce.createElement(f_,{id:a,value:o.draggable}),Ce.createElement(p_,{id:f,announcement:d}));return i?ra.createPortal(y,i):y}var Gn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Gn||(Gn={}));function zu(){}function vr(n,t){return w.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function gl(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return w.useMemo(()=>[...t].filter(a=>a!=null),[...t])}const cs=Object.freeze({x:0,y:0});function Np(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function w_(n,t){const i=Mu(n);if(!i)return"0 0";const a={x:(i.x-t.left)/t.width*100,y:(i.y-t.top)/t.height*100};return a.x+"% "+a.y+"%"}function Ep(n,t){let{data:{value:i}}=n,{data:{value:a}}=t;return i-a}function S_(n,t){let{data:{value:i}}=n,{data:{value:a}}=t;return a-i}function Jf(n){let{left:t,top:i,height:a,width:o}=n;return[{x:t,y:i},{x:t+o,y:i},{x:t,y:i+a},{x:t+o,y:i+a}]}function N0(n,t){if(!n||n.length===0)return null;const[i]=n;return i[t]}function Tv(n,t,i){return t===void 0&&(t=n.left),i===void 0&&(i=n.top),{x:t+n.width*.5,y:i+n.height*.5}}const Xf=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=Tv(t,t.left,t.top),u=[];for(const d of a){const{id:f}=d,h=i.get(f);if(h){const m=Np(Tv(h),o);u.push({id:f,data:{droppableContainer:d,value:m}})}}return u.sort(Ep)},j_=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=Jf(t),u=[];for(const d of a){const{id:f}=d,h=i.get(f);if(h){const m=Jf(h),y=o.reduce((x,b,_)=>x+Np(m[_],b),0),v=Number((y/4).toFixed(4));u.push({id:f,data:{droppableContainer:d,value:v}})}}return u.sort(Ep)};function __(n,t){const i=Math.max(t.top,n.top),a=Math.max(t.left,n.left),o=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=o-a,f=u-i;if(a<o&&i<u){const h=t.width*t.height,m=n.width*n.height,y=d*f,v=y/(h+m-y);return Number(v.toFixed(4))}return 0}const C_=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=[];for(const u of a){const{id:d}=u,f=i.get(d);if(f){const h=__(f,t);h>0&&o.push({id:d,data:{droppableContainer:u,value:h}})}}return o.sort(S_)};function N_(n,t){const{top:i,left:a,bottom:o,right:u}=t;return i<=n.y&&n.y<=o&&a<=n.x&&n.x<=u}const E0=n=>{let{droppableContainers:t,droppableRects:i,pointerCoordinates:a}=n;if(!a)return[];const o=[];for(const u of t){const{id:d}=u,f=i.get(d);if(f&&N_(a,f)){const m=Jf(f).reduce((v,x)=>v+Np(a,x),0),y=Number((m/4).toFixed(4));o.push({id:d,data:{droppableContainer:u,value:y}})}}return o.sort(Ep)};function E_(n,t,i){return{...n,scaleX:t&&i?t.width/i.width:1,scaleY:t&&i?t.height/i.height:1}}function k0(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:cs}function k_(n){return function(i){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];return o.reduce((d,f)=>({...d,top:d.top+n*f.y,bottom:d.bottom+n*f.y,left:d.left+n*f.x,right:d.right+n*f.x}),{...i})}}const T_=k_(1);function T0(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function R_(n,t,i){const a=T0(t);if(!a)return n;const{scaleX:o,scaleY:u,x:d,y:f}=a,h=n.left-d-(1-o)*parseFloat(i),m=n.top-f-(1-u)*parseFloat(i.slice(i.indexOf(" ")+1)),y=o?n.width/o:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:m,right:h+y,bottom:m+v,left:h}}const A_={ignoreTransform:!1};function yl(n,t){t===void 0&&(t=A_);let i=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:m,transformOrigin:y}=ur(n).getComputedStyle(n);m&&(i=R_(i,m,y))}const{top:a,left:o,width:u,height:d,bottom:f,right:h}=i;return{top:a,left:o,width:u,height:d,bottom:f,right:h}}function Rv(n){return yl(n,{ignoreTransform:!0})}function O_(n){const t=n.innerWidth,i=n.innerHeight;return{top:0,left:0,right:t,bottom:i,width:t,height:i}}function D_(n,t){return t===void 0&&(t=ur(n).getComputedStyle(n)),t.position==="fixed"}function M_(n,t){t===void 0&&(t=ur(n).getComputedStyle(n));const i=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const u=t[o];return typeof u=="string"?i.test(u):!1})}function Qu(n,t){const i=[];function a(o){if(t!=null&&i.length>=t||!o)return i;if(Cp(o)&&o.scrollingElement!=null&&!i.includes(o.scrollingElement))return i.push(o.scrollingElement),i;if(!Yo(o)||j0(o)||i.includes(o))return i;const u=ur(n).getComputedStyle(o);return o!==n&&M_(o,u)&&i.push(o),D_(o,u)?i:a(o.parentNode)}return n?a(n):i}function R0(n){const[t]=Qu(n,1);return t??null}function pf(n){return!Ku||!n?null:pl(n)?n:_p(n)?Cp(n)||n===ml(n).scrollingElement?window:Yo(n)?n:null:null}function A0(n){return pl(n)?n.scrollX:n.scrollLeft}function O0(n){return pl(n)?n.scrollY:n.scrollTop}function Zf(n){return{x:A0(n),y:O0(n)}}var Wn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Wn||(Wn={}));function D0(n){return!Ku||!n?!1:n===document.scrollingElement}function M0(n){const t={x:0,y:0},i=D0(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},a={x:n.scrollWidth-i.width,y:n.scrollHeight-i.height},o=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=a.y,f=n.scrollLeft>=a.x;return{isTop:o,isLeft:u,isBottom:d,isRight:f,maxScroll:a,minScroll:t}}const z_={x:.2,y:.2};function U_(n,t,i,a,o){let{top:u,left:d,right:f,bottom:h}=i;a===void 0&&(a=10),o===void 0&&(o=z_);const{isTop:m,isBottom:y,isLeft:v,isRight:x}=M0(n),b={x:0,y:0},_={x:0,y:0},C={height:t.height*o.y,width:t.width*o.x};return!m&&u<=t.top+C.height?(b.y=Wn.Backward,_.y=a*Math.abs((t.top+C.height-u)/C.height)):!y&&h>=t.bottom-C.height&&(b.y=Wn.Forward,_.y=a*Math.abs((t.bottom-C.height-h)/C.height)),!x&&f>=t.right-C.width?(b.x=Wn.Forward,_.x=a*Math.abs((t.right-C.width-f)/C.width)):!v&&d<=t.left+C.width&&(b.x=Wn.Backward,_.x=a*Math.abs((t.left+C.width-d)/C.width)),{direction:b,speed:_}}function L_(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:i,right:a,bottom:o}=n.getBoundingClientRect();return{top:t,left:i,right:a,bottom:o,width:n.clientWidth,height:n.clientHeight}}function z0(n){return n.reduce((t,i)=>ol(t,Zf(i)),cs)}function I_(n){return n.reduce((t,i)=>t+A0(i),0)}function B_(n){return n.reduce((t,i)=>t+O0(i),0)}function U0(n,t){if(t===void 0&&(t=yl),!n)return;const{top:i,left:a,bottom:o,right:u}=t(n);R0(n)&&(o<=0||u<=0||i>=window.innerHeight||a>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const $_=[["x",["left","right"],I_],["y",["top","bottom"],B_]];class kp{constructor(t,i){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=Qu(i),o=z0(a);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,f]of $_)for(const h of d)Object.defineProperty(this,h,{get:()=>{const m=f(a),y=o[u]-m;return this.rect[h]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class No{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(i=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...i)})},this.target=t}add(t,i,a){var o;(o=this.target)==null||o.addEventListener(t,i,a),this.listeners.push([t,i,a])}}function P_(n){const{EventTarget:t}=ur(n);return n instanceof t?n:ml(n)}function mf(n,t){const i=Math.abs(n.x),a=Math.abs(n.y);return typeof t=="number"?Math.sqrt(i**2+a**2)>t:"x"in t&&"y"in t?i>t.x&&a>t.y:"x"in t?i>t.x:"y"in t?a>t.y:!1}var Vr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Vr||(Vr={}));function Av(n){n.preventDefault()}function q_(n){n.stopPropagation()}var Qt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(Qt||(Qt={}));const L0={start:[Qt.Space,Qt.Enter],cancel:[Qt.Esc],end:[Qt.Space,Qt.Enter,Qt.Tab]},F_=(n,t)=>{let{currentCoordinates:i}=t;switch(n.code){case Qt.Right:return{...i,x:i.x+25};case Qt.Left:return{...i,x:i.x-25};case Qt.Down:return{...i,y:i.y+25};case Qt.Up:return{...i,y:i.y-25}}};class vl{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:i}}=t;this.props=t,this.listeners=new No(ml(i)),this.windowListeners=new No(ur(i)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Vr.Resize,this.handleCancel),this.windowListeners.add(Vr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Vr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:i}=this.props,a=t.node.current;a&&U0(a),i(cs)}handleKeyDown(t){if(Wu(t)){const{active:i,context:a,options:o}=this.props,{keyboardCodes:u=L0,coordinateGetter:d=F_,scrollBehavior:f="smooth"}=o,{code:h}=t;if(u.end.includes(h)){this.handleEnd(t);return}if(u.cancel.includes(h)){this.handleCancel(t);return}const{collisionRect:m}=a.current,y=m?{x:m.left,y:m.top}:cs;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:i,context:a.current,currentCoordinates:y});if(v){const x=Do(v,y),b={x:0,y:0},{scrollableAncestors:_}=a.current;for(const C of _){const j=t.code,{isTop:k,isRight:E,isLeft:D,isBottom:U,maxScroll:B,minScroll:T}=M0(C),N=L_(C),O={x:Math.min(j===Qt.Right?N.right-N.width/2:N.right,Math.max(j===Qt.Right?N.left:N.left+N.width/2,v.x)),y:Math.min(j===Qt.Down?N.bottom-N.height/2:N.bottom,Math.max(j===Qt.Down?N.top:N.top+N.height/2,v.y))},L=j===Qt.Right&&!E||j===Qt.Left&&!D,Y=j===Qt.Down&&!U||j===Qt.Up&&!k;if(L&&O.x!==v.x){const q=C.scrollLeft+x.x,V=j===Qt.Right&&q<=B.x||j===Qt.Left&&q>=T.x;if(V&&!x.y){C.scrollTo({left:q,behavior:f});return}V?b.x=C.scrollLeft-q:b.x=j===Qt.Right?C.scrollLeft-B.x:C.scrollLeft-T.x,b.x&&C.scrollBy({left:-b.x,behavior:f});break}else if(Y&&O.y!==v.y){const q=C.scrollTop+x.y,V=j===Qt.Down&&q<=B.y||j===Qt.Up&&q>=T.y;if(V&&!x.x){C.scrollTo({top:q,behavior:f});return}V?b.y=C.scrollTop-q:b.y=j===Qt.Down?C.scrollTop-B.y:C.scrollTop-T.y,b.y&&C.scrollBy({top:-b.y,behavior:f});break}}this.handleMove(t,ol(Do(v,this.referenceCoordinates),b))}}}handleMove(t,i){const{onMove:a}=this.props;t.preventDefault(),a(i)}handleEnd(t){const{onEnd:i}=this.props;t.preventDefault(),this.detach(),i()}handleCancel(t){const{onCancel:i}=this.props;t.preventDefault(),this.detach(),i()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}vl.activators=[{eventName:"onKeyDown",handler:(n,t,i)=>{let{keyboardCodes:a=L0,onActivation:o}=t,{active:u}=i;const{code:d}=n.nativeEvent;if(a.start.includes(d)){const f=u.activatorNode.current;return f&&n.target!==f?!1:(n.preventDefault(),o?.({event:n.nativeEvent}),!0)}return!1}}];function Ov(n){return!!(n&&"distance"in n)}function Dv(n){return!!(n&&"delay"in n)}class Tp{constructor(t,i,a){var o;a===void 0&&(a=P_(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=i;const{event:u}=t,{target:d}=u;this.props=t,this.events=i,this.document=ml(d),this.documentListeners=new No(this.document),this.listeners=new No(a),this.windowListeners=new No(ur(d)),this.initialCoordinates=(o=Mu(u))!=null?o:cs,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:i,bypassActivationConstraint:a}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Vr.Resize,this.handleCancel),this.windowListeners.add(Vr.DragStart,Av),this.windowListeners.add(Vr.VisibilityChange,this.handleCancel),this.windowListeners.add(Vr.ContextMenu,Av),this.documentListeners.add(Vr.Keydown,this.handleKeydown),i){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Dv(i)){this.timeoutId=setTimeout(this.handleStart,i.delay),this.handlePending(i);return}if(Ov(i)){this.handlePending(i);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,i){const{active:a,onPending:o}=this.props;o(a,t,this.initialCoordinates,i)}handleStart(){const{initialCoordinates:t}=this,{onStart:i}=this.props;t&&(this.activated=!0,this.documentListeners.add(Vr.Click,q_,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Vr.SelectionChange,this.removeTextSelection),i(t))}handleMove(t){var i;const{activated:a,initialCoordinates:o,props:u}=this,{onMove:d,options:{activationConstraint:f}}=u;if(!o)return;const h=(i=Mu(t))!=null?i:cs,m=Do(o,h);if(!a&&f){if(Ov(f)){if(f.tolerance!=null&&mf(m,f.tolerance))return this.handleCancel();if(mf(m,f.distance))return this.handleStart()}if(Dv(f)&&mf(m,f.tolerance))return this.handleCancel();this.handlePending(f,m);return}t.cancelable&&t.preventDefault(),d(h)}handleEnd(){const{onAbort:t,onEnd:i}=this.props;this.detach(),this.activated||t(this.props.active),i()}handleCancel(){const{onAbort:t,onCancel:i}=this.props;this.detach(),this.activated||t(this.props.active),i()}handleKeydown(t){t.code===Qt.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const H_={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ju extends Tp{constructor(t){const{event:i}=t,a=ml(i.target);super(t,H_,a)}}Ju.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;return!i.isPrimary||i.button!==0?!1:(a?.({event:i}),!0)}}];const G_={move:{name:"mousemove"},end:{name:"mouseup"}};var ep;(function(n){n[n.RightClick=2]="RightClick"})(ep||(ep={}));class Jo extends Tp{constructor(t){super(t,G_,ml(t.event.target))}}Jo.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;return i.button===ep.RightClick?!1:(a?.({event:i}),!0)}}];const gf={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Xo extends Tp{constructor(t){super(t,gf)}static setup(){return window.addEventListener(gf.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(gf.move.name,t)};function t(){}}}Xo.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;const{touches:o}=i;return o.length>1?!1:(a?.({event:i}),!0)}}];var Eo;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(Eo||(Eo={}));var Uu;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Uu||(Uu={}));function V_(n){let{acceleration:t,activator:i=Eo.Pointer,canScroll:a,draggingRect:o,enabled:u,interval:d=5,order:f=Uu.TreeOrder,pointerCoordinates:h,scrollableAncestors:m,scrollableAncestorRects:y,delta:v,threshold:x}=n;const b=Y_({delta:v,disabled:!u}),[_,C]=o_(),j=w.useRef({x:0,y:0}),k=w.useRef({x:0,y:0}),E=w.useMemo(()=>{switch(i){case Eo.Pointer:return h?{top:h.y,bottom:h.y,left:h.x,right:h.x}:null;case Eo.DraggableRect:return o}},[i,o,h]),D=w.useRef(null),U=w.useCallback(()=>{const T=D.current;if(!T)return;const N=j.current.x*k.current.x,O=j.current.y*k.current.y;T.scrollBy(N,O)},[]),B=w.useMemo(()=>f===Uu.TreeOrder?[...m].reverse():m,[f,m]);w.useEffect(()=>{if(!u||!m.length||!E){C();return}for(const T of B){if(a?.(T)===!1)continue;const N=m.indexOf(T),O=y[N];if(!O)continue;const{direction:L,speed:Y}=U_(T,O,E,t,x);for(const q of["x","y"])b[q][L[q]]||(Y[q]=0,L[q]=0);if(Y.x>0||Y.y>0){C(),D.current=T,_(U,d),j.current=Y,k.current=L;return}}j.current={x:0,y:0},k.current={x:0,y:0},C()},[t,U,a,C,u,d,JSON.stringify(E),JSON.stringify(b),_,m,B,y,JSON.stringify(x)])}const K_={x:{[Wn.Backward]:!1,[Wn.Forward]:!1},y:{[Wn.Backward]:!1,[Wn.Forward]:!1}};function Y_(n){let{delta:t,disabled:i}=n;const a=Du(t);return Wo(o=>{if(i||!a||!o)return K_;const u={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[Wn.Backward]:o.x[Wn.Backward]||u.x===-1,[Wn.Forward]:o.x[Wn.Forward]||u.x===1},y:{[Wn.Backward]:o.y[Wn.Backward]||u.y===-1,[Wn.Forward]:o.y[Wn.Forward]||u.y===1}}},[i,t,a])}function W_(n,t){const i=t!=null?n.get(t):void 0,a=i?i.node.current:null;return Wo(o=>{var u;return t==null?null:(u=a??o)!=null?u:null},[a,t])}function Q_(n,t){return w.useMemo(()=>n.reduce((i,a)=>{const{sensor:o}=a,u=o.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,a)}));return[...i,...u]},[]),[n,t])}var Mo;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Mo||(Mo={}));var tp;(function(n){n.Optimized="optimized"})(tp||(tp={}));const Mv=new Map;function J_(n,t){let{dragging:i,dependencies:a,config:o}=t;const[u,d]=w.useState(null),{frequency:f,measure:h,strategy:m}=o,y=w.useRef(n),v=j(),x=Oo(v),b=w.useCallback(function(k){k===void 0&&(k=[]),!x.current&&d(E=>E===null?k:E.concat(k.filter(D=>!E.includes(D))))},[x]),_=w.useRef(null),C=Wo(k=>{if(v&&!i)return Mv;if(!k||k===Mv||y.current!==n||u!=null){const E=new Map;for(let D of n){if(!D)continue;if(u&&u.length>0&&!u.includes(D.id)&&D.rect.current){E.set(D.id,D.rect.current);continue}const U=D.node.current,B=U?new kp(h(U),U):null;D.rect.current=B,B&&E.set(D.id,B)}return E}return k},[n,u,i,v,h]);return w.useEffect(()=>{y.current=n},[n]),w.useEffect(()=>{v||b()},[i,v]),w.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),w.useEffect(()=>{v||typeof f!="number"||_.current!==null||(_.current=setTimeout(()=>{b(),_.current=null},f))},[f,v,b,...a]),{droppableRects:C,measureDroppableContainers:b,measuringScheduled:u!=null};function j(){switch(m){case Mo.Always:return!1;case Mo.BeforeDragging:return i;default:return!i}}}function Rp(n,t){return Wo(i=>n?i||(typeof t=="function"?t(n):n):null,[t,n])}function X_(n,t){return Rp(n,t)}function Z_(n){let{callback:t,disabled:i}=n;const a=Yu(t),o=w.useMemo(()=>{if(i||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(a)},[a,i]);return w.useEffect(()=>()=>o?.disconnect(),[o]),o}function Xu(n){let{callback:t,disabled:i}=n;const a=Yu(t),o=w.useMemo(()=>{if(i||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(a)},[i]);return w.useEffect(()=>()=>o?.disconnect(),[o]),o}function e1(n){return new kp(yl(n),n)}function zv(n,t,i){t===void 0&&(t=e1);const[a,o]=w.useState(null);function u(){o(h=>{if(!n)return null;if(n.isConnected===!1){var m;return(m=h??i)!=null?m:null}const y=t(n);return JSON.stringify(h)===JSON.stringify(y)?h:y})}const d=Z_({callback(h){if(n)for(const m of h){const{type:y,target:v}=m;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),f=Xu({callback:u});return os(()=>{u(),n?(f?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(f?.disconnect(),d?.disconnect())},[n]),a}function t1(n){const t=Rp(n);return k0(n,t)}const Uv=[];function n1(n){const t=w.useRef(n),i=Wo(a=>n?a&&a!==Uv&&n&&t.current&&n.parentNode===t.current.parentNode?a:Qu(n):Uv,[n]);return w.useEffect(()=>{t.current=n},[n]),i}function r1(n){const[t,i]=w.useState(null),a=w.useRef(n),o=w.useCallback(u=>{const d=pf(u.target);d&&i(f=>f?(f.set(d,Zf(d)),new Map(f)):null)},[]);return w.useEffect(()=>{const u=a.current;if(n!==u){d(u);const f=n.map(h=>{const m=pf(h);return m?(m.addEventListener("scroll",o,{passive:!0}),[m,Zf(m)]):null}).filter(h=>h!=null);i(f.length?new Map(f):null),a.current=n}return()=>{d(n),d(u)};function d(f){f.forEach(h=>{const m=pf(h);m?.removeEventListener("scroll",o)})}},[o,n]),w.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>ol(u,d),cs):z0(n):cs,[n,t])}function Lv(n,t){t===void 0&&(t=[]);const i=w.useRef(null);return w.useEffect(()=>{i.current=null},t),w.useEffect(()=>{const a=n!==cs;a&&!i.current&&(i.current=n),!a&&i.current&&(i.current=null)},[n]),i.current?Do(n,i.current):cs}function s1(n){w.useEffect(()=>{if(!Ku)return;const t=n.map(i=>{let{sensor:a}=i;return a.setup==null?void 0:a.setup()});return()=>{for(const i of t)i?.()}},n.map(t=>{let{sensor:i}=t;return i}))}function i1(n,t){return w.useMemo(()=>n.reduce((i,a)=>{let{eventName:o,handler:u}=a;return i[o]=d=>{u(d,t)},i},{}),[n,t])}function I0(n){return w.useMemo(()=>n?O_(n):null,[n])}const Iv=[];function a1(n,t){t===void 0&&(t=yl);const[i]=n,a=I0(i?ur(i):null),[o,u]=w.useState(Iv);function d(){u(()=>n.length?n.map(h=>D0(h)?a:new kp(t(h),h)):Iv)}const f=Xu({callback:d});return os(()=>{f?.disconnect(),d(),n.forEach(h=>f?.observe(h))},[n]),o}function B0(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return Yo(t)?t:n}function l1(n){let{measure:t}=n;const[i,a]=w.useState(null),o=w.useCallback(m=>{for(const{target:y}of m)if(Yo(y)){a(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=Xu({callback:o}),d=w.useCallback(m=>{const y=B0(m);u?.disconnect(),y&&u?.observe(y),a(y?t(y):null)},[t,u]),[f,h]=Ou(d);return w.useMemo(()=>({nodeRef:f,rect:i,setRef:h}),[i,f,h])}const o1=[{sensor:Ju,options:{}},{sensor:vl,options:{}}],c1={current:{}},Eu={draggable:{measure:Rv},droppable:{measure:Rv,strategy:Mo.WhileDragging,frequency:tp.Optimized},dragOverlay:{measure:yl}};class ko extends Map{get(t){var i;return t!=null&&(i=super.get(t))!=null?i:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:i}=t;return!i})}getNodeFor(t){var i,a;return(i=(a=this.get(t))==null?void 0:a.node.current)!=null?i:void 0}}const u1={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new ko,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:zu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Eu,measureDroppableContainers:zu,windowRect:null,measuringScheduled:!1},$0={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:zu,draggableNodes:new Map,over:null,measureDroppableContainers:zu},Zo=w.createContext($0),P0=w.createContext(u1);function d1(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new ko}}}function h1(n,t){switch(t.type){case Gn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Gn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case Gn.DragEnd:case Gn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Gn.RegisterDroppable:{const{element:i}=t,{id:a}=i,o=new ko(n.droppable.containers);return o.set(a,i),{...n,droppable:{...n.droppable,containers:o}}}case Gn.SetDroppableDisabled:{const{id:i,key:a,disabled:o}=t,u=n.droppable.containers.get(i);if(!u||a!==u.key)return n;const d=new ko(n.droppable.containers);return d.set(i,{...u,disabled:o}),{...n,droppable:{...n.droppable,containers:d}}}case Gn.UnregisterDroppable:{const{id:i,key:a}=t,o=n.droppable.containers.get(i);if(!o||a!==o.key)return n;const u=new ko(n.droppable.containers);return u.delete(i),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function f1(n){let{disabled:t}=n;const{active:i,activatorEvent:a,draggableNodes:o}=w.useContext(Zo),u=Du(a),d=Du(i?.id);return w.useEffect(()=>{if(!t&&!a&&u&&d!=null){if(!Wu(u)||document.activeElement===u.target)return;const f=o.get(d);if(!f)return;const{activatorNode:h,node:m}=f;if(!h.current&&!m.current)return;requestAnimationFrame(()=>{for(const y of[h.current,m.current]){if(!y)continue;const v=d_(y);if(v){v.focus();break}}})}},[a,t,o,d,u]),null}function q0(n,t){let{transform:i,...a}=t;return n!=null&&n.length?n.reduce((o,u)=>u({transform:o,...a}),i):i}function p1(n){return w.useMemo(()=>({draggable:{...Eu.draggable,...n?.draggable},droppable:{...Eu.droppable,...n?.droppable},dragOverlay:{...Eu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function m1(n){let{activeNode:t,measure:i,initialRect:a,config:o=!0}=n;const u=w.useRef(!1),{x:d,y:f}=typeof o=="boolean"?{x:o,y:o}:o;os(()=>{if(!d&&!f||!t){u.current=!1;return}if(u.current||!a)return;const m=t?.node.current;if(!m||m.isConnected===!1)return;const y=i(m),v=k0(y,a);if(d||(v.x=0),f||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=R0(m);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,f,a,i])}const Zu=w.createContext({...cs,scaleX:1,scaleY:1});var wi;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(wi||(wi={}));const oa=w.memo(function(t){var i,a,o,u;let{id:d,accessibility:f,autoScroll:h=!0,children:m,sensors:y=o1,collisionDetection:v=C_,measuring:x,modifiers:b,..._}=t;const C=w.useReducer(h1,void 0,d1),[j,k]=C,[E,D]=y_(),[U,B]=w.useState(wi.Uninitialized),T=U===wi.Initialized,{draggable:{active:N,nodes:O,translate:L},droppable:{containers:Y}}=j,q=N!=null?O.get(N):null,V=w.useRef({initial:null,translated:null}),F=w.useMemo(()=>{var Ze;return N!=null?{id:N,data:(Ze=q?.data)!=null?Ze:c1,rect:V}:null},[N,q]),I=w.useRef(null),[P,R]=w.useState(null),[z,K]=w.useState(null),ue=Oo(_,Object.values(_)),ye=Qo("DndDescribedBy",d),$=w.useMemo(()=>Y.getEnabled(),[Y]),Q=p1(x),{droppableRects:X,measureDroppableContainers:fe,measuringScheduled:ke}=J_($,{dragging:T,dependencies:[L.x,L.y],config:Q.droppable}),Ue=W_(O,N),de=w.useMemo(()=>z?Mu(z):null,[z]),H=st(),G=X_(Ue,Q.draggable.measure);m1({activeNode:N!=null?O.get(N):null,config:H.layoutShiftCompensation,initialRect:G,measure:Q.draggable.measure});const oe=zv(Ue,Q.draggable.measure,G),pe=zv(Ue?Ue.parentElement:null),je=w.useRef({activatorEvent:null,active:null,activeNode:Ue,collisionRect:null,collisions:null,droppableRects:X,draggableNodes:O,draggingNode:null,draggingNodeRect:null,droppableContainers:Y,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ie=Y.getNodeFor((i=je.current.over)==null?void 0:i.id),Be=l1({measure:Q.dragOverlay.measure}),Pe=(a=Be.nodeRef.current)!=null?a:Ue,lt=T?(o=Be.rect)!=null?o:oe:null,rt=!!(Be.nodeRef.current&&Be.rect),qe=t1(rt?null:oe),xe=I0(Pe?ur(Pe):null),_e=n1(T?Ie??Ue:null),te=a1(_e),We=q0(b,{transform:{x:L.x-qe.x,y:L.y-qe.y,scaleX:1,scaleY:1},activatorEvent:z,active:F,activeNodeRect:oe,containerNodeRect:pe,draggingNodeRect:lt,over:je.current.over,overlayNodeRect:Be.rect,scrollableAncestors:_e,scrollableAncestorRects:te,windowRect:xe}),Tt=de?ol(de,L):null,Ct=r1(_e),le=Lv(Ct),Ae=Lv(Ct,[oe]),Oe=ol(We,le),Ge=lt?T_(lt,We):null,nt=F&&Ge?v({active:F,collisionRect:Ge,droppableRects:X,droppableContainers:$,pointerCoordinates:Tt}):null,St=N0(nt,"id"),[on,Tn]=w.useState(null),Jt=rt?We:ol(We,Ae),dt=E_(Jt,(u=on?.rect)!=null?u:null,oe),tn=w.useRef(null),qt=w.useCallback((Ze,tt)=>{let{sensor:vt,options:At}=tt;if(I.current==null)return;const Et=O.get(I.current);if(!Et)return;const Lt=Ze.nativeEvent,ht=new vt({active:I.current,activeNode:Et,event:Lt,options:At,context:je,onAbort(Nt){if(!O.get(Nt))return;const{onDragAbort:mt}=ue.current,Zt={id:Nt};mt?.(Zt),E({type:"onDragAbort",event:Zt})},onPending(Nt,Xt,mt,Zt){if(!O.get(Nt))return;const{onDragPending:en}=ue.current,un={id:Nt,constraint:Xt,initialCoordinates:mt,offset:Zt};en?.(un),E({type:"onDragPending",event:un})},onStart(Nt){const Xt=I.current;if(Xt==null)return;const mt=O.get(Xt);if(!mt)return;const{onDragStart:Zt}=ue.current,Rt={activatorEvent:Lt,active:{id:Xt,data:mt.data,rect:V}};ra.unstable_batchedUpdates(()=>{Zt?.(Rt),B(wi.Initializing),k({type:Gn.DragStart,initialCoordinates:Nt,active:Xt}),E({type:"onDragStart",event:Rt}),R(tn.current),K(Lt)})},onMove(Nt){k({type:Gn.DragMove,coordinates:Nt})},onEnd:Pt(Gn.DragEnd),onCancel:Pt(Gn.DragCancel)});tn.current=ht;function Pt(Nt){return async function(){const{active:mt,collisions:Zt,over:Rt,scrollAdjustedTranslate:en}=je.current;let un=null;if(mt&&en){const{cancelDrop:ce}=ue.current;un={activatorEvent:Lt,active:mt,collisions:Zt,delta:en,over:Rt},Nt===Gn.DragEnd&&typeof ce=="function"&&await Promise.resolve(ce(un))&&(Nt=Gn.DragCancel)}I.current=null,ra.unstable_batchedUpdates(()=>{k({type:Nt}),B(wi.Uninitialized),Tn(null),R(null),K(null),tn.current=null;const ce=Nt===Gn.DragEnd?"onDragEnd":"onDragCancel";if(un){const Le=ue.current[ce];Le?.(un),E({type:ce,event:un})}})}}},[O]),ir=w.useCallback((Ze,tt)=>(vt,At)=>{const Et=vt.nativeEvent,Lt=O.get(At);if(I.current!==null||!Lt||Et.dndKit||Et.defaultPrevented)return;const ht={active:Lt};Ze(vt,tt.options,ht)===!0&&(Et.dndKit={capturedBy:tt.sensor},I.current=At,qt(vt,tt))},[O,qt]),xr=Q_(y,ir);s1(y),os(()=>{oe&&U===wi.Initializing&&B(wi.Initialized)},[oe,U]),w.useEffect(()=>{const{onDragMove:Ze}=ue.current,{active:tt,activatorEvent:vt,collisions:At,over:Et}=je.current;if(!tt||!vt)return;const Lt={active:tt,activatorEvent:vt,collisions:At,delta:{x:Oe.x,y:Oe.y},over:Et};ra.unstable_batchedUpdates(()=>{Ze?.(Lt),E({type:"onDragMove",event:Lt})})},[Oe.x,Oe.y]),w.useEffect(()=>{const{active:Ze,activatorEvent:tt,collisions:vt,droppableContainers:At,scrollAdjustedTranslate:Et}=je.current;if(!Ze||I.current==null||!tt||!Et)return;const{onDragOver:Lt}=ue.current,ht=At.get(St),Pt=ht&&ht.rect.current?{id:ht.id,rect:ht.rect.current,data:ht.data,disabled:ht.disabled}:null,Nt={active:Ze,activatorEvent:tt,collisions:vt,delta:{x:Et.x,y:Et.y},over:Pt};ra.unstable_batchedUpdates(()=>{Tn(Pt),Lt?.(Nt),E({type:"onDragOver",event:Nt})})},[St]),os(()=>{je.current={activatorEvent:z,active:F,activeNode:Ue,collisionRect:Ge,collisions:nt,droppableRects:X,draggableNodes:O,draggingNode:Pe,draggingNodeRect:lt,droppableContainers:Y,over:on,scrollableAncestors:_e,scrollAdjustedTranslate:Oe},V.current={initial:lt,translated:Ge}},[F,Ue,nt,Ge,O,Pe,lt,X,Y,on,_e,Oe]),V_({...H,delta:L,draggingRect:Ge,pointerCoordinates:Tt,scrollableAncestors:_e,scrollableAncestorRects:te});const jn=w.useMemo(()=>({active:F,activeNode:Ue,activeNodeRect:oe,activatorEvent:z,collisions:nt,containerNodeRect:pe,dragOverlay:Be,draggableNodes:O,droppableContainers:Y,droppableRects:X,over:on,measureDroppableContainers:fe,scrollableAncestors:_e,scrollableAncestorRects:te,measuringConfiguration:Q,measuringScheduled:ke,windowRect:xe}),[F,Ue,oe,z,nt,pe,Be,O,Y,X,on,fe,_e,te,Q,ke,xe]),ve=w.useMemo(()=>({activatorEvent:z,activators:xr,active:F,activeNodeRect:oe,ariaDescribedById:{draggable:ye},dispatch:k,draggableNodes:O,over:on,measureDroppableContainers:fe}),[z,xr,F,oe,k,ye,O,on,fe]);return Ce.createElement(C0.Provider,{value:D},Ce.createElement(Zo.Provider,{value:ve},Ce.createElement(P0.Provider,{value:jn},Ce.createElement(Zu.Provider,{value:dt},m)),Ce.createElement(f1,{disabled:f?.restoreFocus===!1})),Ce.createElement(b_,{...f,hiddenTextDescribedById:ye}));function st(){const Ze=P?.autoScrollEnabled===!1,tt=typeof h=="object"?h.enabled===!1:h===!1,vt=T&&!Ze&&!tt;return typeof h=="object"?{...h,enabled:vt}:{enabled:vt}}}),g1=w.createContext(null),Bv="button",y1="Draggable";function Ap(n){let{id:t,data:i,disabled:a=!1,attributes:o}=n;const u=Qo(y1),{activators:d,activatorEvent:f,active:h,activeNodeRect:m,ariaDescribedById:y,draggableNodes:v,over:x}=w.useContext(Zo),{role:b=Bv,roleDescription:_="draggable",tabIndex:C=0}=o??{},j=h?.id===t,k=w.useContext(j?Zu:g1),[E,D]=Ou(),[U,B]=Ou(),T=i1(d,t),N=Oo(i);os(()=>(v.set(t,{id:t,key:u,node:E,activatorNode:U,data:N}),()=>{const L=v.get(t);L&&L.key===u&&v.delete(t)}),[v,t]);const O=w.useMemo(()=>({role:b,tabIndex:C,"aria-disabled":a,"aria-pressed":j&&b===Bv?!0:void 0,"aria-roledescription":_,"aria-describedby":y.draggable}),[a,b,C,j,_,y.draggable]);return{active:h,activatorEvent:f,activeNodeRect:m,attributes:O,isDragging:j,listeners:a?void 0:T,node:E,over:x,setNodeRef:D,setActivatorNodeRef:B,transform:k}}function F0(){return w.useContext(P0)}const v1="Droppable",x1={timeout:25};function ec(n){let{data:t,disabled:i=!1,id:a,resizeObserverConfig:o}=n;const u=Qo(v1),{active:d,dispatch:f,over:h,measureDroppableContainers:m}=w.useContext(Zo),y=w.useRef({disabled:i}),v=w.useRef(!1),x=w.useRef(null),b=w.useRef(null),{disabled:_,updateMeasurementsFor:C,timeout:j}={...x1,...o},k=Oo(C??a),E=w.useCallback(()=>{if(!v.current){v.current=!0;return}b.current!=null&&clearTimeout(b.current),b.current=setTimeout(()=>{m(Array.isArray(k.current)?k.current:[k.current]),b.current=null},j)},[j]),D=Xu({callback:E,disabled:_||!d}),U=w.useCallback((O,L)=>{D&&(L&&(D.unobserve(L),v.current=!1),O&&D.observe(O))},[D]),[B,T]=Ou(U),N=Oo(t);return w.useEffect(()=>{!D||!B.current||(D.disconnect(),v.current=!1,D.observe(B.current))},[B,D]),w.useEffect(()=>(f({type:Gn.RegisterDroppable,element:{id:a,key:u,disabled:i,node:B,rect:x,data:N}}),()=>f({type:Gn.UnregisterDroppable,key:u,id:a})),[a]),w.useEffect(()=>{i!==y.current.disabled&&(f({type:Gn.SetDroppableDisabled,id:a,key:u,disabled:i}),y.current.disabled=i)},[a,u,i,f]),{active:d,rect:x,isOver:h?.id===a,node:B,over:h,setNodeRef:T}}function b1(n){let{animation:t,children:i}=n;const[a,o]=w.useState(null),[u,d]=w.useState(null),f=Du(i);return!i&&!a&&f&&o(f),os(()=>{if(!u)return;const h=a?.key,m=a?.props.id;if(h==null||m==null){o(null);return}Promise.resolve(t(m,u)).then(()=>{o(null)})},[t,a,u]),Ce.createElement(Ce.Fragment,null,i,a?w.cloneElement(a,{ref:d}):null)}const w1={x:0,y:0,scaleX:1,scaleY:1};function S1(n){let{children:t}=n;return Ce.createElement(Zo.Provider,{value:$0},Ce.createElement(Zu.Provider,{value:w1},t))}const j1={position:"fixed",touchAction:"none"},_1=n=>Wu(n)?"transform 250ms ease":void 0,C1=w.forwardRef((n,t)=>{let{as:i,activatorEvent:a,adjustScale:o,children:u,className:d,rect:f,style:h,transform:m,transition:y=_1}=n;if(!f)return null;const v=o?m:{...m,scaleX:1,scaleY:1},x={...j1,width:f.width,height:f.height,top:f.top,left:f.left,transform:Or.Transform.toString(v),transformOrigin:o&&a?w_(a,f):void 0,transition:typeof y=="function"?y(a):y,...h};return Ce.createElement(i,{className:d,style:x,ref:t},u)}),Op=n=>t=>{let{active:i,dragOverlay:a}=t;const o={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[f,h]of Object.entries(u.active))h!==void 0&&(o[f]=i.node.style.getPropertyValue(f),i.node.style.setProperty(f,h));if(u!=null&&u.dragOverlay)for(const[f,h]of Object.entries(u.dragOverlay))h!==void 0&&a.node.style.setProperty(f,h);return d!=null&&d.active&&i.node.classList.add(d.active),d!=null&&d.dragOverlay&&a.node.classList.add(d.dragOverlay),function(){for(const[h,m]of Object.entries(o))i.node.style.setProperty(h,m);d!=null&&d.active&&i.node.classList.remove(d.active)}},N1=n=>{let{transform:{initial:t,final:i}}=n;return[{transform:Or.Transform.toString(t)},{transform:Or.Transform.toString(i)}]},E1={duration:250,easing:"ease",keyframes:N1,sideEffects:Op({styles:{active:{opacity:"0"}}})};function k1(n){let{config:t,draggableNodes:i,droppableContainers:a,measuringConfiguration:o}=n;return Yu((u,d)=>{if(t===null)return;const f=i.get(u);if(!f)return;const h=f.node.current;if(!h)return;const m=B0(d);if(!m)return;const{transform:y}=ur(d).getComputedStyle(d),v=T0(y);if(!v)return;const x=typeof t=="function"?t:T1(t);return U0(h,o.draggable.measure),x({active:{id:u,data:f.data,node:h,rect:o.draggable.measure(h)},draggableNodes:i,dragOverlay:{node:d,rect:o.dragOverlay.measure(m)},droppableContainers:a,measuringConfiguration:o,transform:v})})}function T1(n){const{duration:t,easing:i,sideEffects:a,keyframes:o}={...E1,...n};return u=>{let{active:d,dragOverlay:f,transform:h,...m}=u;if(!t)return;const y={x:f.rect.left-d.rect.left,y:f.rect.top-d.rect.top},v={scaleX:h.scaleX!==1?d.rect.width*h.scaleX/f.rect.width:1,scaleY:h.scaleY!==1?d.rect.height*h.scaleY/f.rect.height:1},x={x:h.x-y.x,y:h.y-y.y,...v},b=o({...m,active:d,dragOverlay:f,transform:{initial:h,final:x}}),[_]=b,C=b[b.length-1];if(JSON.stringify(_)===JSON.stringify(C))return;const j=a?.({active:d,dragOverlay:f,...m}),k=f.node.animate(b,{duration:t,easing:i,fill:"forwards"});return new Promise(E=>{k.onfinish=()=>{j?.(),E()}})}}let $v=0;function R1(n){return w.useMemo(()=>{if(n!=null)return $v++,$v},[n])}const H0=Ce.memo(n=>{let{adjustScale:t=!1,children:i,dropAnimation:a,style:o,transition:u,modifiers:d,wrapperElement:f="div",className:h,zIndex:m=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:b,draggableNodes:_,droppableContainers:C,dragOverlay:j,over:k,measuringConfiguration:E,scrollableAncestors:D,scrollableAncestorRects:U,windowRect:B}=F0(),T=w.useContext(Zu),N=R1(v?.id),O=q0(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:b,draggingNodeRect:j.rect,over:k,overlayNodeRect:j.rect,scrollableAncestors:D,scrollableAncestorRects:U,transform:T,windowRect:B}),L=Rp(x),Y=k1({config:a,draggableNodes:_,droppableContainers:C,measuringConfiguration:E}),q=L?j.setRef:void 0;return Ce.createElement(S1,null,Ce.createElement(b1,{animation:Y},v&&N?Ce.createElement(C1,{key:N,id:v.id,ref:q,as:f,activatorEvent:y,adjustScale:t,className:h,transition:u,rect:L,style:{zIndex:m,...o},transform:O},i):null))});function ca(n,t,i){const a=n.slice();return a.splice(i<0?a.length+i:i,0,a.splice(t,1)[0]),a}function A1(n,t){return n.reduce((i,a,o)=>{const u=t.get(a);return u&&(i[o]=u),i},Array(n.length))}function du(n){return n!==null&&n>=0}function O1(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(n[i]!==t[i])return!1;return!0}function D1(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const Dp=n=>{let{rects:t,activeIndex:i,overIndex:a,index:o}=n;const u=ca(t,a,i),d=t[o],f=u[o];return!f||!d?null:{x:f.left-d.left,y:f.top-d.top,scaleX:f.width/d.width,scaleY:f.height/d.height}},hu={scaleX:1,scaleY:1},zo=n=>{var t;let{activeIndex:i,activeNodeRect:a,index:o,rects:u,overIndex:d}=n;const f=(t=u[i])!=null?t:a;if(!f)return null;if(o===i){const m=u[d];return m?{x:0,y:i<d?m.top+m.height-(f.top+f.height):m.top-f.top,...hu}:null}const h=M1(u,o,i);return o>i&&o<=d?{x:0,y:-f.height-h,...hu}:o<i&&o>=d?{x:0,y:f.height+h,...hu}:{x:0,y:0,...hu}};function M1(n,t,i){const a=n[t],o=n[t-1],u=n[t+1];return a?i<t?o?a.top-(o.top+o.height):u?u.top-(a.top+a.height):0:u?u.top-(a.top+a.height):o?a.top-(o.top+o.height):0:0}const G0="Sortable",V0=Ce.createContext({activeIndex:-1,containerId:G0,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Dp,disabled:{draggable:!1,droppable:!1}});function ul(n){let{children:t,id:i,items:a,strategy:o=Dp,disabled:u=!1}=n;const{active:d,dragOverlay:f,droppableRects:h,over:m,measureDroppableContainers:y}=F0(),v=Qo(G0,i),x=f.rect!==null,b=w.useMemo(()=>a.map(T=>typeof T=="object"&&"id"in T?T.id:T),[a]),_=d!=null,C=d?b.indexOf(d.id):-1,j=m?b.indexOf(m.id):-1,k=w.useRef(b),E=!O1(b,k.current),D=j!==-1&&C===-1||E,U=D1(u);os(()=>{E&&_&&y(b)},[E,b,_,y]),w.useEffect(()=>{k.current=b},[b]);const B=w.useMemo(()=>({activeIndex:C,containerId:v,disabled:U,disableTransforms:D,items:b,overIndex:j,useDragOverlay:x,sortedRects:A1(b,h),strategy:o}),[C,v,U.draggable,U.droppable,D,b,j,h,x,o]);return Ce.createElement(V0.Provider,{value:B},t)}const z1=n=>{let{id:t,items:i,activeIndex:a,overIndex:o}=n;return ca(i,a,o).indexOf(t)},U1=n=>{let{containerId:t,isSorting:i,wasDragging:a,index:o,items:u,newIndex:d,previousItems:f,previousContainerId:h,transition:m}=n;return!m||!a||f!==u&&o===d?!1:i?!0:d!==o&&t===h},L1={duration:200,easing:"ease"},K0="transform",I1=Or.Transition.toString({property:K0,duration:0,easing:"linear"}),B1={roleDescription:"sortable"};function $1(n){let{disabled:t,index:i,node:a,rect:o}=n;const[u,d]=w.useState(null),f=w.useRef(i);return os(()=>{if(!t&&i!==f.current&&a.current){const h=o.current;if(h){const m=yl(a.current,{ignoreTransform:!0}),y={x:h.left-m.left,y:h.top-m.top,scaleX:h.width/m.width,scaleY:h.height/m.height};(y.x||y.y)&&d(y)}}i!==f.current&&(f.current=i)},[t,i,a,o]),w.useEffect(()=>{u&&d(null)},[u]),u}function xl(n){let{animateLayoutChanges:t=U1,attributes:i,disabled:a,data:o,getNewIndex:u=z1,id:d,strategy:f,resizeObserverConfig:h,transition:m=L1}=n;const{items:y,containerId:v,activeIndex:x,disabled:b,disableTransforms:_,sortedRects:C,overIndex:j,useDragOverlay:k,strategy:E}=w.useContext(V0),D=P1(a,b),U=y.indexOf(d),B=w.useMemo(()=>({sortable:{containerId:v,index:U,items:y},...o}),[v,o,U,y]),T=w.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:N,node:O,isOver:L,setNodeRef:Y}=ec({id:d,data:B,disabled:D.droppable,resizeObserverConfig:{updateMeasurementsFor:T,...h}}),{active:q,activatorEvent:V,activeNodeRect:F,attributes:I,setNodeRef:P,listeners:R,isDragging:z,over:K,setActivatorNodeRef:ue,transform:ye}=Ap({id:d,data:B,attributes:{...B1,...i},disabled:D.draggable}),$=l_(Y,P),Q=!!q,X=Q&&!_&&du(x)&&du(j),fe=!k&&z,ke=fe&&X?ye:null,de=X?ke??(f??E)({rects:C,activeNodeRect:F,activeIndex:x,overIndex:j,index:U}):null,H=du(x)&&du(j)?u({id:d,items:y,activeIndex:x,overIndex:j}):U,G=q?.id,oe=w.useRef({activeId:G,items:y,newIndex:H,containerId:v}),pe=y!==oe.current.items,je=t({active:q,containerId:v,isDragging:z,isSorting:Q,id:d,index:U,items:y,newIndex:oe.current.newIndex,previousItems:oe.current.items,previousContainerId:oe.current.containerId,transition:m,wasDragging:oe.current.activeId!=null}),Ie=$1({disabled:!je,index:U,node:O,rect:N});return w.useEffect(()=>{Q&&oe.current.newIndex!==H&&(oe.current.newIndex=H),v!==oe.current.containerId&&(oe.current.containerId=v),y!==oe.current.items&&(oe.current.items=y)},[Q,H,v,y]),w.useEffect(()=>{if(G===oe.current.activeId)return;if(G!=null&&oe.current.activeId==null){oe.current.activeId=G;return}const Pe=setTimeout(()=>{oe.current.activeId=G},50);return()=>clearTimeout(Pe)},[G]),{active:q,activeIndex:x,attributes:I,data:B,rect:N,index:U,newIndex:H,items:y,isOver:L,isSorting:Q,isDragging:z,listeners:R,node:O,overIndex:j,over:K,setNodeRef:$,setActivatorNodeRef:ue,setDroppableNodeRef:Y,setDraggableNodeRef:P,transform:Ie??de,transition:Be()};function Be(){if(Ie||pe&&oe.current.newIndex===U)return I1;if(!(fe&&!Wu(V)||!m)&&(Q||je))return Or.Transition.toString({...m,property:K0})}}function P1(n,t){var i,a;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(i=n?.draggable)!=null?i:t.draggable,droppable:(a=n?.droppable)!=null?a:t.droppable}}function Lu(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const q1=[Qt.Down,Qt.Right,Qt.Up,Qt.Left],ed=(n,t)=>{let{context:{active:i,collisionRect:a,droppableRects:o,droppableContainers:u,over:d,scrollableAncestors:f}}=t;if(q1.includes(n.code)){if(n.preventDefault(),!i||!a)return;const h=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=o.get(v.id);if(x)switch(n.code){case Qt.Down:a.top<x.top&&h.push(v);break;case Qt.Up:a.top>x.top&&h.push(v);break;case Qt.Left:a.left>x.left&&h.push(v);break;case Qt.Right:a.left<x.left&&h.push(v);break}});const m=j_({collisionRect:a,droppableRects:o,droppableContainers:h});let y=N0(m,"id");if(y===d?.id&&m.length>1&&(y=m[1].id),y!=null){const v=u.get(i.id),x=u.get(y),b=x?o.get(x.id):null,_=x?.node.current;if(_&&b&&v&&x){const j=Qu(_).some((T,N)=>f[N]!==T),k=Y0(v,x),E=F1(v,x),D=j||!k?{x:0,y:0}:{x:E?a.width-b.width:0,y:E?a.height-b.height:0},U={x:b.left,y:b.top};return D.x&&D.y?U:Do(U,D)}}}};function Y0(n,t){return!Lu(n)||!Lu(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function F1(n,t){return!Lu(n)||!Lu(t)||!Y0(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const H1=()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1,G1=(n,{mobile:t=!1}={})=>{if(!n||typeof n!="string"||n.startsWith("data:")||n.startsWith("blob:"))return n;if(n.includes("/storage/v1/object/public/")){const i=t?360:640,a=t?55:68,o=n.includes("?")?"&":"?";return`${n}${o}width=${i}&quality=${a}&resize=contain`}return n},Pv=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},Ni=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],V1=({recipe:n,isSelected:t,isSelectMode:i,onSelectRecipe:a,onToggleSelection:o,disableDrag:u,showOwner:d,ownerLabelFn:f,index:h=0,mobileView:m=!1})=>{const{attributes:y,listeners:v,setNodeRef:x,transform:b,transition:_,isDragging:C}=xl({id:n.id,disabled:u}),j={transform:Or.Transform.toString(b),transition:_,opacity:C?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"},k=m?4:8,E=h<k?"eager":"lazy",D=h<k?"high":"low",U=G1(n.image,{mobile:m});return s.jsx("div",{ref:x,style:j,...y,...v,children:s.jsxs(an,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some(B=>/|Dessert/i.test(B))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{i?o(n.id):a(n)},children:[s.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?s.jsx("img",{src:U,alt:n.title,className:"recipe-card__image",loading:E,decoding:"async",fetchPriority:D,sizes:m?"(max-width: 700px) 45vw, 320px":"(max-width: 1024px) 33vw, 280px"}):s.jsx("div",{className:"recipe-card__image placeholder"}),s.jsx("div",{className:"recipe-card__overlay"}),i&&s.jsx("div",{className:"recipe-card__selection-overlay",children:s.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),s.jsx("div",{className:"recipe-card__tags",children:(()=>{const B=Ni(n.tags);if(B.length===0)return null;const T=B.filter(L=>!L.startsWith("owner:"));return(T.includes("URL")?["URL"]:T).slice(0,1).map((L,Y)=>s.jsx("span",{className:"recipe-tag",children:L},`${L}-${Y}`))})()})]}),s.jsxs("div",{className:"recipe-card__content",children:[s.jsx("h3",{className:"recipe-title",children:n.title}),s.jsx("p",{className:"recipe-desc",children:n.description}),s.jsxs("div",{className:"recipe-meta",children:[n.storeName&&s.jsxs("span",{children:[" ",n.storeName]}),d&&typeof f=="function"&&s.jsxs("span",{className:"recipe-owner",children:[" ",f(n)]}),s.jsxs("div",{className:"recipe-dates",children:[s.jsxs("span",{className:"recipe-date",children:[" : ",Pv(n.created_at)]}),n.updated_at&&s.jsxs("span",{className:"recipe-date",children:[" : ",Pv(n.updated_at)]})]})]})]})]})})},qv=n=>{const t=Ni(n.tags);return n.type==="bread"||t.some(i=>/|Bread/i.test(i))},Fv=n=>{const t=a=>/|Dessert/i.test(a),i=Ni(n.tags);return/|Dessert/i.test(n.category||"")||i.some(t)},Hv=n=>{const t=Ni(n.tags);return/|Sauce/i.test(n.category||"")||t.some(i=>/|Sauce/i.test(i))},Gv=n=>{const t=Ni(n.tags);return/||Decor/i.test(n.category||"")||t.some(i=>/||Decor/i.test(i))},Vv=n=>{const t=n.category||"",i=Ni(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||i.some(a=>/|Dressing||Vinaigrette||Mayonnaise/i.test(a))},Kv=n=>{const t=n.filter(v=>qv(v)),i=n.filter(v=>!qv(v)),a=i.filter(v=>Hv(v)),o=i.filter(v=>!Hv(v)),u=o.filter(v=>Gv(v)),d=o.filter(v=>!Gv(v)),f=d.filter(v=>Vv(v)),h=d.filter(v=>!Vv(v)),m=h.filter(v=>Fv(v));return{cookingRecipes:h.filter(v=>!Fv(v)),breadRecipes:t,dessertRecipes:m,sauceRecipes:a,dressingRecipes:f,decorationRecipes:u}},Yv=({recipes:n,onSelectRecipe:t,isSelectMode:i,selectedIds:a,onToggleSelection:o,disableDrag:u,displayMode:d="normal",publicRecipeView:f="none",showOwner:h=!1,ownerLabelFn:m,currentUser:y=null})=>{const[v,x]=w.useState({}),[b,_]=w.useState(()=>H1());Ce.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const z=window.matchMedia("(max-width: 700px)"),K=()=>_(!!z.matches);return K(),z.addEventListener?z.addEventListener("change",K):z.addListener(K),()=>{z.removeEventListener?z.removeEventListener("change",K):z.removeListener(K)}},[]);const C=z=>{x(K=>({...K,[z]:!K[z]}))},j=z=>Ni(z?.tags).map(ue=>ue.toLowerCase()).includes("public"),k=z=>{if(!y)return!1;const K=Ni(z?.tags).filter(ye=>ye.startsWith("owner:"));if(K.length===0)return!1;const ue=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return K.some(ye=>ue.has(ye))},E=n.filter(z=>j(z)),D=E.filter(z=>k(z)),U=E.filter(z=>!k(z)),B=n.filter(z=>!j(z)),{cookingRecipes:T,breadRecipes:N,dessertRecipes:O,sauceRecipes:L,dressingRecipes:Y,decorationRecipes:q}=Kv(B),[V,F]=w.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);Ce.useEffect(()=>{const z=()=>{window.innerWidth>=1024?F(9):F(8)};return window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]);const I=(z,K,ue,ye,{showWhenEmpty:$=!1,emptyMessage:Q=""}={})=>{if(K.length===0&&!$)return null;const X=d==="all";let fe=K,ke=!1,Ue=!1;return X||(ke=v[ye],Ue=K.length>V,fe=ke?K:K.slice(0,V)),s.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[s.jsxs("h3",{onClick:()=>!X&&Ue&&C(ye),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!X&&Ue?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[s.jsx("span",{children:ue})," ",z,s.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",K.length,")"]}),!X&&Ue&&s.jsx("span",{className:"section-toggle-btn",children:ke?" ":" "})]}),s.jsx("div",{className:"recipe-grid",children:s.jsx(ul,{items:fe.map(de=>de.id),strategy:Dp,children:fe.map((de,H)=>{const G=a&&a.has(de.id);return s.jsx(V1,{recipe:de,isSelected:G,isSelectMode:i,onSelectRecipe:t,onToggleSelection:o,disableDrag:u,showOwner:h,ownerLabelFn:m,index:H,mobileView:b},de.id)})})}),K.length===0&&s.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:Q||`${z}`})]})},P=()=>{if(f!=="mine"&&f!=="others")return null;const z=f==="mine",K=z?"":"",ue=z?"":"",ye=z?"public-mine":"public-others",$=z?D:U,Q=z?"":"",X=Kv($);return s.jsxs("div",{className:"public-recipes-block",children:[s.jsxs("div",{className:"public-recipes-block__header",children:[s.jsx("span",{children:ue}),s.jsx("span",{children:K}),s.jsxs("span",{className:"public-recipes-block__count",children:["(",$.length,")"]})]}),$.length===0?s.jsx("div",{className:"public-recipes-block__empty",children:Q}):s.jsxs(s.Fragment,{children:[I("",X.cookingRecipes,"",`${ye}-cooking`),I("",X.breadRecipes,"",`${ye}-bread`),I("",X.dessertRecipes,"",`${ye}-dessert`),I("",X.sauceRecipes,"",`${ye}-sauce`),I("",X.dressingRecipes,"",`${ye}-dressing`),I("",X.decorationRecipes,"",`${ye}-decoration`)]})]})},R=f==="none"&&E.length>0&&B.length===0;return s.jsxs("div",{className:"recipe-list-container",children:[P(),R&&s.jsx("div",{className:"recipe-list-empty-hint",children:""}),I("",T,"","cooking"),I("",N,"","bread"),I("",O,"","dessert"),I("",L,"","sauce"),I("",Y,"","dressing"),I("",q,"","decoration"),n.length===0&&s.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},xn=({isOpen:n,onClose:t,title:i,children:a,size:o="medium",showCloseButton:u=!0})=>{if(w.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),w.useEffect(()=>{const f=h=>{h.key==="Escape"&&n&&t()};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[n,t]),!n)return null;const d=f=>{f.target===f.currentTarget&&t()};return s.jsx("div",{className:"modal-overlay",onClick:d,children:s.jsxs("div",{className:`modal-content modal-${o}`,children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{className:"modal-title",children:i}),u&&s.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),s.jsx("div",{className:"modal-body",children:a})]})})};function td(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(n);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(n,a[o])&&(i[a[o]]=n[a[o]]);return i}function K1(n,t,i,a){function o(u){return u instanceof i?u:new i(function(d){d(u)})}return new(i||(i=Promise))(function(u,d){function f(y){try{m(a.next(y))}catch(v){d(v)}}function h(y){try{m(a.throw(y))}catch(v){d(v)}}function m(y){y.done?u(y.value):o(y.value).then(f,h)}m((a=a.apply(n,t||[])).next())})}const Y1=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class Mp extends Error{constructor(t,i="FunctionsError",a){super(t),this.name=i,this.context=a}}class W1 extends Mp{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Wv extends Mp{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Qv extends Mp{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var np;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(np||(np={}));class Q1{constructor(t,{headers:i={},customFetch:a,region:o=np.Any}={}){this.url=t,this.headers=i,this.region=o,this.fetch=Y1(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return K1(this,arguments,void 0,function*(i,a={}){var o;let u,d;try{const{headers:f,method:h,body:m,signal:y,timeout:v}=a;let x={},{region:b}=a;b||(b=this.region);const _=new URL(`${this.url}/${i}`);b&&b!=="any"&&(x["x-region"]=b,_.searchParams.set("forceFunctionRegion",b));let C;m&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",C=m):typeof m=="string"?(x["Content-Type"]="text/plain",C=m):typeof FormData<"u"&&m instanceof FormData?C=m:(x["Content-Type"]="application/json",C=JSON.stringify(m)):C=m;let j=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(j=d.signal,y.addEventListener("abort",()=>d.abort())):j=d.signal);const k=yield this.fetch(_.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),f),body:C,signal:j}).catch(B=>{throw new W1(B)}),E=k.headers.get("x-relay-error");if(E&&E==="true")throw new Wv(k);if(!k.ok)throw new Qv(k);let D=((o=k.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),U;return D==="application/json"?U=yield k.json():D==="application/octet-stream"||D==="application/pdf"?U=yield k.blob():D==="text/event-stream"?U=k:D==="multipart/form-data"?U=yield k.formData():U=yield k.text(),{data:U,error:null,response:k}}catch(f){return{data:null,error:f,response:f instanceof Qv||f instanceof Wv?f.context:void 0}}finally{u&&clearTimeout(u)}})}}var J1=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},X1=class{constructor(n){var t,i;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(i=n.isMaybeSingle)!==null&&i!==void 0?i:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var i=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let o=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,f=null,h=null,m=u.status,y=u.statusText;if(u.ok){var v,x;if(i.method!=="HEAD"){var b;const k=await u.text();k===""||(i.headers.get("Accept")==="text/csv"||i.headers.get("Accept")&&(!((b=i.headers.get("Accept"))===null||b===void 0)&&b.includes("application/vnd.pgrst.plan+text"))?f=k:f=JSON.parse(k))}const C=(v=i.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),j=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");C&&j&&j.length>1&&(h=parseInt(j[1])),i.isMaybeSingle&&i.method==="GET"&&Array.isArray(f)&&(f.length>1?(d={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,m=406,y="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{var _;const C=await u.text();try{d=JSON.parse(C),Array.isArray(d)&&u.status===404&&(f=[],d=null,m=200,y="OK")}catch{u.status===404&&C===""?(m=204,y="No Content"):d={message:C}}if(d&&i.isMaybeSingle&&(!(d==null||(_=d.details)===null||_===void 0)&&_.includes("0 rows"))&&(d=null,m=200,y="OK"),d&&i.shouldThrowOnError)throw new J1(d)}return{error:d,data:f,count:h,status:m,statusText:y}});return this.shouldThrowOnError||(o=o.catch(u=>{var d;let f="";const h=u?.cause;if(h){var m,y,v,x;const _=(m=h?.message)!==null&&m!==void 0?m:"",C=(y=h?.code)!==null&&y!==void 0?y:"";f=`${(v=u?.name)!==null&&v!==void 0?v:"FetchError"}: ${u?.message}`,f+=`

Caused by: ${(x=h?.name)!==null&&x!==void 0?x:"Error"}: ${_}`,C&&(f+=` (${C})`),h?.stack&&(f+=`
${h.stack}`)}else{var b;f=(b=u?.stack)!==null&&b!==void 0?b:""}return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:f,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),o.then(n,t)}returns(){return this}overrideTypes(){return this}},Z1=class extends X1{select(n){let t=!1;const i=(n??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:i,foreignTable:a,referencedTable:o=a}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:i=t}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,t,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:i=!1,buffers:a=!1,wal:o=!1,format:u="text"}={}){var d;const f=[n?"analyze":null,t?"verbose":null,i?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),h=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${h}"; options=${f};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const Jv=new RegExp("[,()]");var nl=class extends Z1{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const i=Array.from(new Set(t)).map(a=>typeof a=="string"&&Jv.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`in.(${i})`),this}notIn(n,t){const i=Array.from(new Set(t)).map(a=>typeof a=="string"&&Jv.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`not.in.(${i})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:i,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const u=i===void 0?"":`(${i})`;return this.url.searchParams.append(n,`${o}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,i])=>{this.url.searchParams.append(t,`eq.${i}`)}),this}not(n,t,i){return this.url.searchParams.append(n,`not.${t}.${i}`),this}or(n,{foreignTable:t,referencedTable:i=t}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${n})`),this}filter(n,t,i){return this.url.searchParams.append(n,`${t}.${i}`),this}},eC=class{constructor(n,{headers:t={},schema:i,fetch:a}){this.url=n,this.headers=new Headers(t),this.schema=i,this.fetch=a}select(n,t){const{head:i=!1,count:a}=t??{},o=i?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(f=>/\s/.test(f)&&!u?"":(f==='"'&&(u=!u),f)).join("");return this.url.searchParams.set("select",d),a&&this.headers.append("Prefer",`count=${a}`),new nl({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:t,defaultToNull:i=!0}={}){var a;const o="POST";if(t&&this.headers.append("Prefer",`count=${t}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(u.length>0){const d=[...new Set(u)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new nl({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(n,{onConflict:t,ignoreDuplicates:i=!1,count:a,defaultToNull:o=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const f=n.reduce((h,m)=>h.concat(Object.keys(m)),[]);if(f.length>0){const h=[...new Set(f)].map(m=>`"${m}"`);this.url.searchParams.set("columns",h.join(","))}}return new nl({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(n,{count:t}={}){var i;const a="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new nl({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:n}={}){var t;const i="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new nl({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},tC=class W0{constructor(t,{headers:i={},schema:a,fetch:o}={}){this.url=t,this.headers=new Headers(i),this.schemaName=a,this.fetch=o}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new eC(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new W0(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,i={},{head:a=!1,get:o=!1,count:u}={}){var d;let f;const h=new URL(`${this.url}/rpc/${t}`);let m;a||o?(f=a?"HEAD":"GET",Object.entries(i).filter(([v,x])=>x!==void 0).map(([v,x])=>[v,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([v,x])=>{h.searchParams.append(v,x)})):(f="POST",m=i);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new nl({method:f,url:h,headers:y,schema:this.schemaName,body:m,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}};class nC{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const i=process.versions;if(i&&i.node){const a=i.node,o=parseInt(a.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let i=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(i+=`

Suggested solution: ${t.workaround}`),new Error(i)}static createWebSocket(t,i){const a=this.getWebSocketConstructor();return new a(t,i)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const rC="2.89.0",sC=`realtime-js/${rC}`,Q0="1.0.0",iC="2.0.0",Xv=Q0,rp=1e4,aC=1e3,lC=100;var Si;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Si||(Si={}));var Hn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Hn||(Hn={}));var as;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(as||(as={}));var sp;(function(n){n.websocket="websocket"})(sp||(sp={}));var ea;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(ea||(ea={}));class oC{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,i){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return i(this._binaryEncodeUserBroadcastPush(t));let a=[t.join_ref,t.ref,t.topic,t.event,t.payload];return i(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(t){var i;return this._isArrayBuffer((i=t.payload)===null||i===void 0?void 0:i.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var i,a;const o=(a=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var i,a;const o=(a=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&a!==void 0?a:{},d=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,i,a){var o,u;const d=t.topic,f=(o=t.ref)!==null&&o!==void 0?o:"",h=(u=t.join_ref)!==null&&u!==void 0?u:"",m=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(h.length>255)throw new Error(`joinRef length ${h.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`ref length ${f.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`userEvent length ${m.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+f.length+d.length+m.length+v.length,b=new ArrayBuffer(this.HEADER_LENGTH+x);let _=new DataView(b),C=0;_.setUint8(C++,this.KINDS.userBroadcastPush),_.setUint8(C++,h.length),_.setUint8(C++,f.length),_.setUint8(C++,d.length),_.setUint8(C++,m.length),_.setUint8(C++,v.length),_.setUint8(C++,i),Array.from(h,k=>_.setUint8(C++,k.charCodeAt(0))),Array.from(f,k=>_.setUint8(C++,k.charCodeAt(0))),Array.from(d,k=>_.setUint8(C++,k.charCodeAt(0))),Array.from(m,k=>_.setUint8(C++,k.charCodeAt(0))),Array.from(v,k=>_.setUint8(C++,k.charCodeAt(0)));var j=new Uint8Array(b.byteLength+a.byteLength);return j.set(new Uint8Array(b),0),j.set(new Uint8Array(a),b.byteLength),j.buffer}decode(t,i){if(this._isArrayBuffer(t)){let a=this._binaryDecode(t);return i(a)}if(typeof t=="string"){const a=JSON.parse(t),[o,u,d,f,h]=a;return i({join_ref:o,ref:u,topic:d,event:f,payload:h})}return i({})}_binaryDecode(t){const i=new DataView(t),a=i.getUint8(0),o=new TextDecoder;if(a===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,i,o)}_decodeUserBroadcast(t,i,a){const o=i.getUint8(1),u=i.getUint8(2),d=i.getUint8(3),f=i.getUint8(4);let h=this.HEADER_LENGTH+4;const m=a.decode(t.slice(h,h+o));h=h+o;const y=a.decode(t.slice(h,h+u));h=h+u;const v=a.decode(t.slice(h,h+d));h=h+d;const x=t.slice(h,t.byteLength),b=f===this.JSON_ENCODING?JSON.parse(a.decode(x)):x,_={type:this.BROADCAST_EVENT,event:y,payload:b};return d>0&&(_.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(t){var i;return t instanceof ArrayBuffer||((i=t?.constructor)===null||i===void 0?void 0:i.name)==="ArrayBuffer"}_pick(t,i){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([a])=>i.includes(a)))}}class J0{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var vn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(vn||(vn={}));const Zv=(n,t,i={})=>{var a;const o=(a=i.skipTypes)!==null&&a!==void 0?a:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=cC(d,n,t,o),u),{}):{}},cC=(n,t,i,a)=>{const o=t.find(f=>f.name===n),u=o?.type,d=i[n];return u&&!a.includes(u)?X0(u,d):ip(d)},X0=(n,t)=>{if(n.charAt(0)==="_"){const i=n.slice(1,n.length);return fC(t,i)}switch(n){case vn.bool:return uC(t);case vn.float4:case vn.float8:case vn.int2:case vn.int4:case vn.int8:case vn.numeric:case vn.oid:return dC(t);case vn.json:case vn.jsonb:return hC(t);case vn.timestamp:return pC(t);case vn.abstime:case vn.date:case vn.daterange:case vn.int4range:case vn.int8range:case vn.money:case vn.reltime:case vn.text:case vn.time:case vn.timestamptz:case vn.timetz:case vn.tsrange:case vn.tstzrange:return ip(t);default:return ip(t)}},ip=n=>n,uC=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},dC=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},hC=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},fC=(n,t)=>{if(typeof n!="string")return n;const i=n.length-1,a=n[i];if(n[0]==="{"&&a==="}"){let u;const d=n.slice(1,i);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(f=>X0(t,f))}return n},pC=n=>typeof n=="string"?n.replace(" ","T"):n,Z0=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class yf{constructor(t,i,a={},o=rp){this.channel=t,this.event=i,this.payload=a,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var a;return this._hasReceived(t)&&i((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var ex;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(ex||(ex={}));class To{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=i?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},o=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=To.syncState(this.state,o,u,d),this.pendingDiffs.forEach(h=>{this.state=To.syncDiff(this.state,h,u,d)}),this.pendingDiffs=[],f()}),this.channel._on(a.diff,{},o=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=To.syncDiff(this.state,o,u,d),f())}),this.onJoin((o,u,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:u,newPresences:d})}),this.onLeave((o,u,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,a,o){const u=this.cloneDeep(t),d=this.transformState(i),f={},h={};return this.map(u,(m,y)=>{d[m]||(h[m]=y)}),this.map(d,(m,y)=>{const v=u[m];if(v){const x=y.map(j=>j.presence_ref),b=v.map(j=>j.presence_ref),_=y.filter(j=>b.indexOf(j.presence_ref)<0),C=v.filter(j=>x.indexOf(j.presence_ref)<0);_.length>0&&(f[m]=_),C.length>0&&(h[m]=C)}else f[m]=y}),this.syncDiff(u,{joins:f,leaves:h},a,o)}static syncDiff(t,i,a,o){const{joins:u,leaves:d}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return a||(a=()=>{}),o||(o=()=>{}),this.map(u,(f,h)=>{var m;const y=(m=t[f])!==null&&m!==void 0?m:[];if(t[f]=this.cloneDeep(h),y.length>0){const v=t[f].map(b=>b.presence_ref),x=y.filter(b=>v.indexOf(b.presence_ref)<0);t[f].unshift(...x)}a(f,y,h)}),this.map(d,(f,h)=>{let m=t[f];if(!m)return;const y=h.map(v=>v.presence_ref);m=m.filter(v=>y.indexOf(v.presence_ref)<0),t[f]=m,o(f,m,h),m.length===0&&delete t[f]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(a=>i(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,a)=>{const o=t[a];return"metas"in o?i[a]=o.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):i[a]=o,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var tx;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(tx||(tx={}));var Ro;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ro||(Ro={}));var Is;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Is||(Is={}));class al{constructor(t,i={config:{}},a){var o,u;if(this.topic=t,this.params=i,this.socket=a,this.bindings={},this.state=Hn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new yf(this,as.join,this.params,this.timeout),this.rejoinTimer=new J0(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Hn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Hn.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Hn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Hn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Hn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(as.reply,{},(d,f)=>{this._trigger(this._replyEventName(f),d)}),this.presence=new To(this),this.broadcastEndpointURL=Z0(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,i=this.timeout){var a,o,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Hn.closed){const{config:{broadcast:d,presence:f,private:h}}=this.params,m=(o=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(b=>b.filter))!==null&&o!==void 0?o:[],y=!!this.bindings[Ro.PRESENCE]&&this.bindings[Ro.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},f),{enabled:y}),postgres_changes:m,private:h};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(b=>t?.(Is.CHANNEL_ERROR,b)),this._onClose(()=>t?.(Is.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:b})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),b===void 0){t?.(Is.SUBSCRIBED);return}else{const C=this.bindings.postgres_changes,j=(_=C?.length)!==null&&_!==void 0?_:0,k=[];for(let E=0;E<j;E++){const D=C[E],{filter:{event:U,schema:B,table:T,filter:N}}=D,O=b&&b[E];if(O&&O.event===U&&al.isFilterValueEqual(O.schema,B)&&al.isFilterValueEqual(O.table,T)&&al.isFilterValueEqual(O.filter,N))k.push(Object.assign(Object.assign({},D),{id:O.id}));else{this.unsubscribe(),this.state=Hn.errored,t?.(Is.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=k,t&&t(Is.SUBSCRIBED);return}}).receive("error",b=>{this.state=Hn.errored,t?.(Is.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{t?.(Is.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,a){return this.state===Hn.joined&&t===Ro.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,i,a)}async httpSend(t,i,a={}){var o;if(i==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:i,private:this.private}]})},f=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=a.timeout)!==null&&o!==void 0?o:this.timeout);if(f.status===202)return{success:!0};let h=f.statusText;try{const m=await f.json();h=m.error||m.message||h}catch{}return Promise.reject(new Error(h))}async send(t,i={}){var a,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,f={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(f.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:f,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(a=i.timeout)!==null&&a!==void 0?a:this.timeout);return await((o=m.body)===null||o===void 0?void 0:o.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,f,h;const m=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((h=(f=(d=this.params)===null||d===void 0?void 0:d.config)===null||f===void 0?void 0:f.broadcast)===null||h===void 0)&&h.ack)&&u("ok"),m.receive("ok",()=>u("ok")),m.receive("error",()=>u("error")),m.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Hn.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(as.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(o=>{a=new yf(this,as.leave,{},t),a.receive("ok",()=>{i(),o("ok")}).receive("timeout",()=>{i(),o("timed out")}).receive("error",()=>{o("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Hn.closed,this.bindings={}}async _fetchWithTimeout(t,i,a){const o=new AbortController,u=setTimeout(()=>o.abort(),a),d=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:o.signal}));return clearTimeout(u),d}_push(t,i,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new yf(this,t,i,a);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>lC){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(t,i,a){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,a){var o,u;const d=t.toLocaleLowerCase(),{close:f,error:h,leave:m,join:y}=as;if(a&&[f,h,m,y].indexOf(d)>=0&&a!==this._joinRef())return;let x=this._onMessage(d,i,a);if(i&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(b=>{var _,C,j;return((_=b.filter)===null||_===void 0?void 0:_.event)==="*"||((j=(C=b.filter)===null||C===void 0?void 0:C.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===d}).map(b=>b.callback(x,a)):(u=this.bindings[d])===null||u===void 0||u.filter(b=>{var _,C,j,k,E,D;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in b){const U=b.id,B=(_=b.filter)===null||_===void 0?void 0:_.event;return U&&((C=i.ids)===null||C===void 0?void 0:C.includes(U))&&(B==="*"||B?.toLocaleLowerCase()===((j=i.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const U=(E=(k=b?.filter)===null||k===void 0?void 0:k.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return U==="*"||U===((D=i?.event)===null||D===void 0?void 0:D.toLocaleLowerCase())}else return b.type.toLocaleLowerCase()===d}).map(b=>{if(typeof x=="object"&&"ids"in x){const _=x.data,{schema:C,table:j,commit_timestamp:k,type:E,errors:D}=_;x=Object.assign(Object.assign({},{schema:C,table:j,commit_timestamp:k,eventType:E,new:{},old:{},errors:D}),this._getPayloadRecords(_))}b.callback(x,a)})}_isClosed(){return this.state===Hn.closed}_isJoined(){return this.state===Hn.joined}_isJoining(){return this.state===Hn.joining}_isLeaving(){return this.state===Hn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,a){const o=t.toLocaleLowerCase(),u={type:o,filter:i,callback:a};return this.bindings[o]?this.bindings[o].push(u):this.bindings[o]=[u],this}_off(t,i){const a=t.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(o=>{var u;return!(((u=o.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===a&&al.isEqual(o.filter,i))})),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(t[a]!==i[a])return!1;return!0}static isFilterValueEqual(t,i){return(t??void 0)===(i??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(as.close,{},t)}_onError(t){this._on(as.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Hn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=Zv(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=Zv(t.columns,t.old_record)),i}}const vf=()=>{},fu={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},mC=[1e3,2e3,5e3,1e4],gC=1e4,yC=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class vC{constructor(t,i){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=rp,this.transport=null,this.heartbeatIntervalMs=fu.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=vf,this.ref=0,this.reconnectTimer=null,this.vsn=Xv,this.logger=vf,this.conn=null,this.sendBuffer=[],this.serializer=new oC,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...u)=>o(...u):(...u)=>fetch(...u),!(!((a=i?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${t}/${sp.websocket}`,this.httpEndpoint=Z0(t),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=nC.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const i=t.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,i??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,i,a){this.logger(t,i,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Si.connecting:return ea.Connecting;case Si.open:return ea.Open;case Si.closing:return ea.Closing;default:return ea.Closed}}isConnected(){return this.connectionState()===ea.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,i={config:{}}){const a=`realtime:${t}`,o=this.getChannels().find(u=>u.topic===a);if(o)return o;{const u=new al(`realtime:${t}`,i,this);return this.channels.push(u),u}}push(t){const{topic:i,event:a,payload:o,ref:u}=t,d=()=>{this.encode(t,f=>{var h;(h=this.conn)===null||h===void 0||h.send(f)})};this.log("push",`${i} ${a} (${u})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(aC,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},fu.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply")try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error")}catch(m){this.log("error","error in heartbeat callback",m)}i.ref&&i.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:a,event:o,payload:u,ref:d}=i,f=d?`(${d})`:"",h=u.status||"";this.log("receive",`${h} ${a} ${o} ${f}`.trim(),u),this.channels.filter(m=>m._isMember(a)).forEach(m=>m._trigger(o,u,d)),this._triggerStateCallbacks("message",i)})}_clearTimer(t){var i;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Si.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Si.open||this.conn.readyState===Si.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(i=>{this.log("error","error waiting for auth on connect",i),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this._terminateWorker()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var i;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(as.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const a=t.match(/\?/)?"&":"?",o=new URLSearchParams(i);return`${t}${a}${o}`}_workerObjectUrl(t){let i;if(t)i=t;else{const a=new Blob([yC],{type:"application/javascript"});i=URL.createObjectURL(a)}return i}_setConnectionState(t,i=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(t=null){let i,a=!1;if(t)i=t,a=!0;else if(this.accessToken)try{i=await this.accessToken()}catch(o){this.log("error","Error fetching access token from callback",o),i=this.accessTokenValue}else i=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(o=>{const u={access_token:i,version:sC};i&&o.updateJoinPayload(u),o.joinedOnce&&o._isJoined()&&o._push(as.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(i=>{this.log("error",`Error setting auth in ${t}`,i)})}_triggerStateCallbacks(t,i){try{this.stateChangeCallbacks[t].forEach(a=>{try{a(i)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(a){this.log("error",`error triggering ${t} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new J0(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},fu.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var i,a,o,u,d,f,h,m,y,v,x,b;switch(this.transport=(i=t?.transport)!==null&&i!==void 0?i:null,this.timeout=(a=t?.timeout)!==null&&a!==void 0?a:rp,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:fu.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(f=t?.heartbeatCallback)!==null&&f!==void 0?f:vf,this.vsn=(h=t?.vsn)!==null&&h!==void 0?h:Xv,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=t?.reconnectAfterMs)!==null&&m!==void 0?m:(_=>mC[_-1]||gC),this.vsn){case Q0:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((_,C)=>C(JSON.stringify(_))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((_,C)=>C(JSON.parse(_)));break;case iC:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(b=t?.decode)!==null&&b!==void 0?b:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var Uo=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function xC(n,t,i){const a=new URL(t,n);if(i)for(const[o,u]of Object.entries(i))u!==void 0&&a.searchParams.set(o,u);return a.toString()}async function bC(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function wC(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:i,path:a,query:o,body:u,headers:d}){const f=xC(n.baseUrl,a,o),h=await bC(n.auth),m=await t(f,{method:i,headers:{...u?{"Content-Type":"application/json"}:{},...h,...d},body:u?JSON.stringify(u):void 0}),y=await m.text(),v=(m.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!m.ok){const b=v?x:void 0,_=b?.error;throw new Uo(_?.message??`Request failed with status ${m.status}`,{status:m.status,icebergType:_?.type,icebergCode:_?.code,details:b})}return{status:m.status,headers:m.headers,data:x}}}}function pu(n){return n.join("")}var SC=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:pu(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(n,t){const i={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:i})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${pu(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${pu(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${pu(n.namespace)}`}),!0}catch(t){if(t instanceof Uo&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(i){if(i instanceof Uo&&i.status===409)return;throw i}}};function Ha(n){return n.join("")}var jC=class{constructor(n,t="",i){this.client=n,this.prefix=t,this.accessDelegation=i}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ha(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const i={};return this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ha(n.namespace)}/tables`,body:t,headers:i})).data.metadata}async updateTable(n,t){const i=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ha(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":i.data["metadata-location"],metadata:i.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ha(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ha(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ha(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(i){if(i instanceof Uo&&i.status===404)return!1;throw i}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(i){if(i instanceof Uo&&i.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw i}}},_C=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const i=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=wC({baseUrl:i,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new SC(this.client,t),this.tableOps=new jC(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},nd=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function kn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var CC=class extends nd{constructor(n,t,i){super(n),this.name="StorageApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ap=class extends nd{constructor(n,t){super(n),this.name="StorageUnknownError",this.originalError=t}};const zp=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),NC=()=>Response,lp=n=>{if(Array.isArray(n))return n.map(i=>lp(i));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([i,a])=>{const o=i.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[o]=lp(a)}),t},EC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},kC=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Lo(n){"@babel/helpers - typeof";return Lo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lo(n)}function TC(n,t){if(Lo(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(Lo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function RC(n){var t=TC(n,"string");return Lo(t)=="symbol"?t:t+""}function AC(n,t,i){return(t=RC(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function nx(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function _t(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?nx(Object(i),!0).forEach(function(a){AC(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):nx(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}const xf=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},OC=async(n,t,i)=>{n instanceof await NC()&&!i?.noResolveJson?n.json().then(a=>{const o=n.status||500,u=a?.statusCode||o+"";t(new CC(xf(a),o,u))}).catch(a=>{t(new ap(xf(a),a))}):t(new ap(xf(n),n))},DC=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"||!a?o:(EC(a)?(o.headers=_t({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,t?.duplex&&(o.duplex=t.duplex),_t(_t({},o),i))};async function tc(n,t,i,a,o,u){return new Promise((d,f)=>{n(i,DC(t,a,o,u)).then(h=>{if(!h.ok)throw h;return a?.noResolveJson?h:h.json()}).then(h=>d(h)).catch(h=>OC(h,f,a))})}async function Io(n,t,i,a){return tc(n,"GET",t,i,a)}async function is(n,t,i,a,o){return tc(n,"POST",t,a,o,i)}async function op(n,t,i,a,o){return tc(n,"PUT",t,a,o,i)}async function MC(n,t,i,a){return tc(n,"HEAD",t,_t(_t({},i),{},{noResolveJson:!0}),a)}async function Up(n,t,i,a,o){return tc(n,"DELETE",t,a,o,i)}var zC=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(kn(t))return{data:null,error:t};throw t}}};let eb;eb=Symbol.toStringTag;var UC=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[eb]="BlobDownloadBuilder",this.promise=null}asStream(){return new zC(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(kn(t))return{data:null,error:t};throw t}}};const LC={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},rx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var IC=class{constructor(n,t={},i,a){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.bucketId=i,this.fetch=zp(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,t,i,a){var o=this;try{let u;const d=_t(_t({},rx),a);let f=_t(_t({},o.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const h=d.metadata;typeof Blob<"u"&&i instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),h&&u.append("metadata",o.encodeMetadata(h)),u.append("",i)):typeof FormData<"u"&&i instanceof FormData?(u=i,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),h&&!u.has("metadata")&&u.append("metadata",o.encodeMetadata(h))):(u=i,f["cache-control"]=`max-age=${d.cacheControl}`,f["content-type"]=d.contentType,h&&(f["x-metadata"]=o.toBase64(o.encodeMetadata(h))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),a?.headers&&(f=_t(_t({},f),a.headers));const m=o._removeEmptyFolders(t),y=o._getFinalPath(m),v=await(n=="PUT"?op:is)(o.fetch,`${o.url}/object/${y}`,u,_t({headers:f},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:m,id:v.Id,fullPath:v.Key},error:null}}catch(u){if(o.shouldThrowOnError)throw u;if(kn(u))return{data:null,error:u};throw u}}async upload(n,t,i){return this.uploadOrUpdate("POST",n,t,i)}async uploadToSignedUrl(n,t,i,a){var o=this;const u=o._removeEmptyFolders(n),d=o._getFinalPath(u),f=new URL(o.url+`/object/upload/sign/${d}`);f.searchParams.set("token",t);try{let h;const m=_t({upsert:rx.upsert},a),y=_t(_t({},o.headers),{"x-upsert":String(m.upsert)});return typeof Blob<"u"&&i instanceof Blob?(h=new FormData,h.append("cacheControl",m.cacheControl),h.append("",i)):typeof FormData<"u"&&i instanceof FormData?(h=i,h.append("cacheControl",m.cacheControl)):(h=i,y["cache-control"]=`max-age=${m.cacheControl}`,y["content-type"]=m.contentType),{data:{path:u,fullPath:(await op(o.fetch,f.toString(),h,{headers:y})).Key},error:null}}catch(h){if(o.shouldThrowOnError)throw h;if(kn(h))return{data:null,error:h};throw h}}async createSignedUploadUrl(n,t){var i=this;try{let a=i._getFinalPath(n);const o=_t({},i.headers);t?.upsert&&(o["x-upsert"]="true");const u=await is(i.fetch,`${i.url}/object/upload/sign/${a}`,{},{headers:o}),d=new URL(i.url+u.url),f=d.searchParams.get("token");if(!f)throw new nd("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:f},error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(kn(a))return{data:null,error:a};throw a}}async update(n,t,i){return this.uploadOrUpdate("PUT",n,t,i)}async move(n,t,i){var a=this;try{return{data:await is(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:a.headers}),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(kn(o))return{data:null,error:o};throw o}}async copy(n,t,i){var a=this;try{return{data:{path:(await is(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:a.headers})).Key},error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(kn(o))return{data:null,error:o};throw o}}async createSignedUrl(n,t,i){var a=this;try{let o=a._getFinalPath(n),u=await is(a.fetch,`${a.url}/object/sign/${o}`,_t({expiresIn:t},i?.transform?{transform:i.transform}:{}),{headers:a.headers});const d=i?.download?`&download=${i.download===!0?"":i.download}`:"";return u={signedUrl:encodeURI(`${a.url}${u.signedURL}${d}`)},{data:u,error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(kn(o))return{data:null,error:o};throw o}}async createSignedUrls(n,t,i){var a=this;try{const o=await is(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:t,paths:n},{headers:a.headers}),u=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:o.map(d=>_t(_t({},d),{},{signedUrl:d.signedURL?encodeURI(`${a.url}${d.signedURL}${u}`):null})),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(kn(o))return{data:null,error:o};throw o}}download(n,t){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(t?.transform||{}),o=a?`?${a}`:"",u=this._getFinalPath(n),d=()=>Io(this.fetch,`${this.url}/${i}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new UC(d,this.shouldThrowOnError)}async info(n){var t=this;const i=t._getFinalPath(n);try{return{data:lp(await Io(t.fetch,`${t.url}/object/info/${i}`,{headers:t.headers})),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(kn(a))return{data:null,error:a};throw a}}async exists(n){var t=this;const i=t._getFinalPath(n);try{return await MC(t.fetch,`${t.url}/object/${i}`,{headers:t.headers}),{data:!0,error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(kn(a)&&a instanceof ap){const o=a.originalError;if([400,404].includes(o?.status))return{data:!1,error:a}}throw a}}getPublicUrl(n,t){const i=this._getFinalPath(n),a=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&a.push(o);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&a.push(d);let f=a.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${i}${f}`)}}}async remove(n){var t=this;try{return{data:await Up(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(kn(i))return{data:null,error:i};throw i}}async list(n,t,i){var a=this;try{const o=_t(_t(_t({},LC),t),{},{prefix:n||""});return{data:await is(a.fetch,`${a.url}/object/list/${a.bucketId}`,o,{headers:a.headers},i),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(kn(o))return{data:null,error:o};throw o}}async listV2(n,t){var i=this;try{const a=_t({},n);return{data:await is(i.fetch,`${i.url}/object/list-v2/${i.bucketId}`,a,{headers:i.headers},t),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(kn(a))return{data:null,error:a};throw a}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const tb="2.89.0",nb={"X-Client-Info":`storage-js/${tb}`};var BC=class{constructor(n,t={},i,a){this.shouldThrowOnError=!1;const o=new URL(n);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=_t(_t({},nb),t),this.fetch=zp(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var t=this;try{const i=t.listBucketOptionsToQueryString(n);return{data:await Io(t.fetch,`${t.url}/bucket${i}`,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(kn(i))return{data:null,error:i};throw i}}async getBucket(n){var t=this;try{return{data:await Io(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(kn(i))return{data:null,error:i};throw i}}async createBucket(n,t={public:!1}){var i=this;try{return{data:await is(i.fetch,`${i.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(kn(a))return{data:null,error:a};throw a}}async updateBucket(n,t){var i=this;try{return{data:await op(i.fetch,`${i.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(kn(a))return{data:null,error:a};throw a}}async emptyBucket(n){var t=this;try{return{data:await is(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(kn(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await Up(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(kn(i))return{data:null,error:i};throw i}}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},$C=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=_t(_t({},nb),t),this.fetch=zp(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await is(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(kn(i))return{data:null,error:i};throw i}}async listBuckets(n){var t=this;try{const i=new URLSearchParams;n?.limit!==void 0&&i.set("limit",n.limit.toString()),n?.offset!==void 0&&i.set("offset",n.offset.toString()),n?.sortColumn&&i.set("sortColumn",n.sortColumn),n?.sortOrder&&i.set("sortOrder",n.sortOrder),n?.search&&i.set("search",n.search);const a=i.toString(),o=a?`${t.url}/bucket?${a}`:`${t.url}/bucket`;return{data:await Io(t.fetch,o,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(kn(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await Up(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(kn(i))return{data:null,error:i};throw i}}from(n){var t=this;if(!kC(n))throw new nd("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const i=new _C({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(i,{get(o,u){const d=o[u];return typeof d!="function"?d:async(...f)=>{try{return{data:await d.apply(o,f),error:null}}catch(h){if(a)throw h;return{data:null,error:h}}}}})}};const Lp={"X-Client-Info":`storage-js/${tb}`,"Content-Type":"application/json"};var rb=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Rr(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var bf=class extends rb{constructor(n,t,i){super(n),this.name="StorageVectorsApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},PC=class extends rb{constructor(n,t){super(n),this.name="StorageVectorsUnknownError",this.originalError=t}};const Ip=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),qC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},sx=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),FC=async(n,t,i)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!i?.noResolveJson){const a=n.status||500,o=n;if(typeof o.json=="function")o.json().then(u=>{const d=u?.statusCode||u?.code||a+"";t(new bf(sx(u),a,d))}).catch(()=>{const u=a+"";t(new bf(o.statusText||`HTTP ${a} error`,a,u))});else{const u=a+"";t(new bf(o.statusText||`HTTP ${a} error`,a,u))}}else t(new PC(sx(n),n))},HC=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return a?(qC(a)?(o.headers=_t({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,_t(_t({},o),i)):o};async function GC(n,t,i,a,o,u){return new Promise((d,f)=>{n(i,HC(t,a,o,u)).then(h=>{if(!h.ok)throw h;if(a?.noResolveJson)return h;const m=h.headers.get("content-type");return!m||!m.includes("application/json")?{}:h.json()}).then(h=>d(h)).catch(h=>FC(h,f,a))})}async function Ar(n,t,i,a,o){return GC(n,"POST",t,a,o,i)}var VC=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=_t(_t({},Lp),t),this.fetch=Ip(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var t=this;try{return{data:await Ar(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async getIndex(n,t){var i=this;try{return{data:await Ar(i.fetch,`${i.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Rr(a))return{data:null,error:a};throw a}}async listIndexes(n){var t=this;try{return{data:await Ar(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async deleteIndex(n,t){var i=this;try{return{data:await Ar(i.fetch,`${i.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:i.headers})||{},error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Rr(a))return{data:null,error:a};throw a}}},KC=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=_t(_t({},Lp),t),this.fetch=Ip(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var t=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Ar(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async getVectors(n){var t=this;try{return{data:await Ar(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async listVectors(n){var t=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await Ar(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async queryVectors(n){var t=this;try{return{data:await Ar(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async deleteVectors(n){var t=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Ar(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}},YC=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=_t(_t({},Lp),t),this.fetch=Ip(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Ar(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async getBucket(n){var t=this;try{return{data:await Ar(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async listBuckets(n={}){var t=this;try{return{data:await Ar(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await Ar(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rr(i))return{data:null,error:i};throw i}}},WC=class extends YC{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new QC(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,i=this;return t().call(i,n)}async getBucket(n){var t=()=>super.getBucket,i=this;return t().call(i,n)}async listBuckets(n={}){var t=()=>super.listBuckets,i=this;return t().call(i,n)}async deleteBucket(n){var t=()=>super.deleteBucket,i=this;return t().call(i,n)}},QC=class extends VC{constructor(n,t,i,a){super(n,t,a),this.vectorBucketName=i}async createIndex(n){var t=()=>super.createIndex,i=this;return t().call(i,_t(_t({},n),{},{vectorBucketName:i.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,i=this;return t().call(i,_t(_t({},n),{},{vectorBucketName:i.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,i=this;return t().call(i,i.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,i=this;return t().call(i,i.vectorBucketName,n)}index(n){return new JC(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},JC=class extends KC{constructor(n,t,i,a,o){super(n,t,o),this.vectorBucketName=i,this.indexName=a}async putVectors(n){var t=()=>super.putVectors,i=this;return t().call(i,_t(_t({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async getVectors(n){var t=()=>super.getVectors,i=this;return t().call(i,_t(_t({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,i=this;return t().call(i,_t(_t({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,i=this;return t().call(i,_t(_t({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,i=this;return t().call(i,_t(_t({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}},XC=class extends BC{constructor(n,t={},i,a){super(n,t,i,a)}from(n){return new IC(this.url,this.headers,n,this.fetch)}get vectors(){return new WC(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new $C(this.url+"/iceberg",this.headers,this.fetch)}};const sb="2.89.0",rl=30*1e3,cp=3,wf=cp*rl,ZC="http://localhost:9999",eN="supabase.auth.token",tN={"X-Client-Info":`gotrue-js/${sb}`},up="X-Supabase-Api-Version",ib={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},nN=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,rN=600*1e3;class Bo extends Error{constructor(t,i,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=a}}function ft(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class sN extends Bo{constructor(t,i,a){super(t,i,a),this.name="AuthApiError",this.status=i,this.code=a}}function iN(n){return ft(n)&&n.name==="AuthApiError"}class ta extends Bo{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class Gs extends Bo{constructor(t,i,a,o){super(t,a,o),this.name=i,this.status=a}}class kr extends Gs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function aN(n){return ft(n)&&n.name==="AuthSessionMissingError"}class Ga extends Gs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class mu extends Gs{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class gu extends Gs{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function lN(n){return ft(n)&&n.name==="AuthImplicitGrantRedirectError"}class ix extends Gs{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class oN extends Gs{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class dp extends Gs{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function Sf(n){return ft(n)&&n.name==="AuthRetryableFetchError"}class ax extends Gs{constructor(t,i,a){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=a}}class hp extends Gs{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Iu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),lx=` 	
\r=`.split(""),cN=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<lx.length;t+=1)n[lx[t].charCodeAt(0)]=-2;for(let t=0;t<Iu.length;t+=1)n[Iu[t].charCodeAt(0)]=t;return n})();function ox(n,t,i){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;i(Iu[a]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;i(Iu[a]),t.queuedBits-=6}}function ab(n,t,i){const a=cN[n];if(a>-1)for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)i(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function cx(n){const t=[],i=d=>{t.push(String.fromCodePoint(d))},a={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},u=d=>{hN(d,a,i)};for(let d=0;d<n.length;d+=1)ab(n.charCodeAt(d),o,u);return t.join("")}function uN(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function dN(n,t){for(let i=0;i<n.length;i+=1){let a=n.charCodeAt(i);if(a>55295&&a<=56319){const o=(a-55296)*1024&65535;a=(n.charCodeAt(i+1)-56320&65535|o)+65536,i+=1}uN(a,t)}}function hN(n,t,i){if(t.utf8seq===0){if(n<=127){i(n);return}for(let a=1;a<6;a+=1)if((n>>7-a&1)===0){t.utf8seq=a;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&i(t.codepoint)}}function cl(n){const t=[],i={queue:0,queuedBits:0},a=o=>{t.push(o)};for(let o=0;o<n.length;o+=1)ab(n.charCodeAt(o),i,a);return new Uint8Array(t)}function fN(n){const t=[];return dN(n,i=>t.push(i)),new Uint8Array(t)}function sa(n){const t=[],i={queue:0,queuedBits:0},a=o=>{t.push(o)};return n.forEach(o=>ox(o,i,a)),ox(null,i,a),t.join("")}function pN(n){return Math.round(Date.now()/1e3)+n}function mN(){return Symbol("auth-callback")}const rr=()=>typeof window<"u"&&typeof document<"u",Ki={tested:!1,writable:!1},lb=()=>{if(!rr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ki.tested)return Ki.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ki.tested=!0,Ki.writable=!0}catch{Ki.tested=!0,Ki.writable=!1}return Ki.writable};function gN(n){const t={},i=new URL(n);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((o,u)=>{t[u]=o})}catch{}return i.searchParams.forEach((a,o)=>{t[o]=a}),t}const ob=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),yN=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",sl=async(n,t,i)=>{await n.setItem(t,JSON.stringify(i))},Yi=async(n,t)=>{const i=await n.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},tr=async(n,t)=>{await n.removeItem(t)};class rd{constructor(){this.promise=new rd.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}rd.promiseConstructor=Promise;function jf(n){const t=n.split(".");if(t.length!==3)throw new hp("Invalid JWT structure");for(let a=0;a<t.length;a++)if(!nN.test(t[a]))throw new hp("JWT not in base64url format");return{header:JSON.parse(cx(t[0])),payload:JSON.parse(cx(t[1])),signature:cl(t[2]),raw:{header:t[0],payload:t[1]}}}async function vN(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function xN(n,t){return new Promise((a,o)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){a(d);return}}catch(d){if(!t(u,d)){o(d);return}}})()})}function bN(n){return("0"+n.toString(16)).substr(-2)}function wN(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=i.length;let o="";for(let u=0;u<56;u++)o+=i.charAt(Math.floor(Math.random()*a));return o}return crypto.getRandomValues(t),Array.from(t,bN).join("")}async function SN(n){const i=new TextEncoder().encode(n),a=await crypto.subtle.digest("SHA-256",i),o=new Uint8Array(a);return Array.from(o).map(u=>String.fromCharCode(u)).join("")}async function jN(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const i=await SN(n);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Va(n,t,i=!1){const a=wN();let o=a;i&&(o+="/PASSWORD_RECOVERY"),await sl(n,`${t}-code-verifier`,o);const u=await jN(a);return[u,a===u?"plain":"s256"]}const _N=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function CN(n){const t=n.headers.get(up);if(!t||!t.match(_N))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function NN(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function EN(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const kN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ka(n){if(!kN.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function _f(){const n={};return new Proxy(n,{get:(t,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const a=i.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function TN(n,t){return new Proxy(n,{get:(i,a,o)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const u=a.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(i,a,o)}return!t.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(i,a,o)}})}function ux(n){return JSON.parse(JSON.stringify(n))}const Zi=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),RN=[502,503,504];async function dx(n){var t;if(!yN(n))throw new dp(Zi(n),0);if(RN.includes(n.status))throw new dp(Zi(n),n.status);let i;try{i=await n.json()}catch(u){throw new ta(Zi(u),u)}let a;const o=CN(n);if(o&&o.getTime()>=ib["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?a=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(a=i.error_code),a){if(a==="weak_password")throw new ax(Zi(i),n.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new kr}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new ax(Zi(i),n.status,i.weak_password.reasons);throw new sN(Zi(i),n.status||500,a)}const AN=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(a),Object.assign(Object.assign({},o),i))};async function jt(n,t,i,a){var o;const u=Object.assign({},a?.headers);u[up]||(u[up]=ib["2024-01-01"].name),a?.jwt&&(u.Authorization=`Bearer ${a.jwt}`);const d=(o=a?.query)!==null&&o!==void 0?o:{};a?.redirectTo&&(d.redirect_to=a.redirectTo);const f=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",h=await ON(n,t,i+f,{headers:u,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(h):{data:Object.assign({},h),error:null}}async function ON(n,t,i,a,o,u){const d=AN(t,a,o,u);let f;try{f=await n(i,Object.assign({},d))}catch(h){throw console.error(h),new dp(Zi(h),0)}if(f.ok||await dx(f),a?.noResolveJson)return f;try{return await f.json()}catch(h){await dx(h)}}function rs(n){var t;let i=null;zN(n)&&(i=Object.assign({},n),n.expires_at||(i.expires_at=pN(n.expires_in)));const a=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:i,user:a},error:null}}function hx(n){const t=rs(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0)&&(t.data.weak_password=n.weak_password),t}function _i(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function DN(n){return{data:n,error:null}}function MN(n){const{action_link:t,email_otp:i,hashed_token:a,redirect_to:o,verification_type:u}=n,d=td(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:t,email_otp:i,hashed_token:a,redirect_to:o,verification_type:u},h=Object.assign({},d);return{data:{properties:f,user:h},error:null}}function fx(n){return n}function zN(n){return n.access_token&&n.refresh_token&&n.expires_in}const Cf=["global","local","others"];class UN{constructor({url:t="",headers:i={},fetch:a}){this.url=t,this.headers=i,this.fetch=ob(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,i=Cf[0]){if(Cf.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Cf.join(", ")}`);try{return await jt(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(ft(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,i={}){try{return await jt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:_i})}catch(a){if(ft(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:i}=t,a=td(t,["options"]),o=Object.assign(Object.assign({},a),i);return"newEmail"in a&&(o.new_email=a?.newEmail,delete o.newEmail),await jt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:MN,redirectTo:i?.redirectTo})}catch(i){if(ft(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await jt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:_i})}catch(i){if(ft(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,a,o,u,d,f,h;try{const m={nextPage:null,lastPage:0,total:0},y=await jt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:fx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,b=(h=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&h!==void 0?h:[];return b.length>0&&(b.forEach(_=>{const C=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(_.split(";")[1].split("=")[1]);m[`${j}Page`]=C}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(ft(m))return{data:{users:[]},error:m};throw m}}async getUserById(t){Ka(t);try{return await jt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:_i})}catch(i){if(ft(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){Ka(t);try{return await jt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:_i})}catch(a){if(ft(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,i=!1){Ka(t);try{return await jt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:_i})}catch(a){if(ft(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){Ka(t.userId);try{const{data:i,error:a}=await jt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:i,error:a}}catch(i){if(ft(i))return{data:null,error:i};throw i}}async _deleteFactor(t){Ka(t.userId),Ka(t.id);try{return{data:await jt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}}async _listOAuthClients(t){var i,a,o,u,d,f,h;try{const m={nextPage:null,lastPage:0,total:0},y=await jt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:fx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,b=(h=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&h!==void 0?h:[];return b.length>0&&(b.forEach(_=>{const C=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(_.split(";")[1].split("=")[1]);m[`${j}Page`]=C}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(ft(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(t){try{return await jt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(ft(i))return{data:null,error:i};throw i}}async _getOAuthClient(t){try{return await jt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(ft(i))return{data:null,error:i};throw i}}async _updateOAuthClient(t,i){try{return await jt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:i,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(ft(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(t){try{return await jt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(i){if(ft(i))return{data:null,error:i};throw i}}async _regenerateOAuthClientSecret(t){try{return await jt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(ft(i))return{data:null,error:i};throw i}}}function px(n={}){return{getItem:t=>n[t]||null,setItem:(t,i)=>{n[t]=i},removeItem:t=>{delete n[t]}}}const Ya={debug:!!(globalThis&&lb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class cb extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class LN extends cb{}async function IN(n,t,i){Ya.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const a=new globalThis.AbortController;return t>0&&setTimeout(()=>{a.abort(),Ya.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async o=>{if(o){Ya.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await i()}finally{Ya.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(t===0)throw Ya.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new LN(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Ya.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}function BN(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function ub(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function $N(n){return parseInt(n,16)}function PN(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,a=>a.toString(16).padStart(2,"0")).join("")}function qN(n){var t;const{chainId:i,domain:a,expirationTime:o,issuedAt:u=new Date,nonce:d,notBefore:f,requestId:h,resources:m,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const b=ub(n.address),_=y?`${y}://${a}`:a,C=n.statement?`${n.statement}
`:"",j=`${_} wants you to sign in with your Ethereum account:
${b}

${C}`;let k=`URI: ${v}
Version: ${x}
Chain ID: ${i}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(o&&(k+=`
Expiration Time: ${o.toISOString()}`),f&&(k+=`
Not Before: ${f.toISOString()}`),h&&(k+=`
Request ID: ${h}`),m){let E=`
Resources:`;for(const D of m){if(!D||typeof D!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${D}`);E+=`
- ${D}`}k+=E}return`${j}
${k}`}class Pn extends Error{constructor({message:t,code:i,cause:a,name:o}){var u;super(t,{cause:a}),this.__isWebAuthnError=!0,this.name=(u=o??(a instanceof Error?a.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=i}}class Bu extends Pn{constructor(t,i){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i,message:t}),this.name="WebAuthnUnknownError",this.originalError=i}}function FN({error:n,options:t}){var i,a,o;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Pn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((i=u.authenticatorSelection)===null||i===void 0?void 0:i.requireResidentKey)===!0)return new Pn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((a=u.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new Pn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((o=u.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Pn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Pn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Pn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(f=>f.type==="public-key").length===0?new Pn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Pn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(db(d)){if(u.rp.id!==d)return new Pn({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Pn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Pn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Pn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Pn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function HN({error:n,options:t}){const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Pn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Pn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const a=window.location.hostname;if(db(a)){if(i.rpId!==a)return new Pn({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Pn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Pn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Pn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class GN{createNewAbortSignal(){if(this.controller){const i=new Error("Cancelling existing WebAuthn API call for new one");i.name="AbortError",this.controller.abort(i)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const VN=new GN;function KN(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:i,excludeCredentials:a}=n,o=td(n,["challenge","user","excludeCredentials"]),u=cl(t).buffer,d=Object.assign(Object.assign({},i),{id:cl(i.id).buffer}),f=Object.assign(Object.assign({},o),{challenge:u,user:d});if(a&&a.length>0){f.excludeCredentials=new Array(a.length);for(let h=0;h<a.length;h++){const m=a[h];f.excludeCredentials[h]=Object.assign(Object.assign({},m),{id:cl(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return f}function YN(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:i}=n,a=td(n,["challenge","allowCredentials"]),o=cl(t).buffer,u=Object.assign(Object.assign({},a),{challenge:o});if(i&&i.length>0){u.allowCredentials=new Array(i.length);for(let d=0;d<i.length;d++){const f=i[d];u.allowCredentials[d]=Object.assign(Object.assign({},f),{id:cl(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function WN(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const i=n;return{id:n.id,rawId:n.id,response:{attestationObject:sa(new Uint8Array(n.response.attestationObject)),clientDataJSON:sa(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function QN(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const i=n,a=n.getClientExtensionResults(),o=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:sa(new Uint8Array(o.authenticatorData)),clientDataJSON:sa(new Uint8Array(o.clientDataJSON)),signature:sa(new Uint8Array(o.signature)),userHandle:o.userHandle?sa(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function db(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function mx(){var n,t;return!!(rr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function JN(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Bu("Browser returned unexpected credential type",t)}:{data:null,error:new Bu("Empty credential response",t)}}catch(t){return{data:null,error:FN({error:t,options:n})}}}async function XN(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Bu("Browser returned unexpected credential type",t)}:{data:null,error:new Bu("Empty credential response",t)}}catch(t){return{data:null,error:HN({error:t,options:n})}}}const ZN={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},eE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function $u(...n){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),i=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),a={};for(const o of n)if(o)for(const u in o){const d=o[u];if(d!==void 0)if(Array.isArray(d))a[u]=d;else if(i(d))a[u]=d;else if(t(d)){const f=a[u];t(f)?a[u]=$u(f,d):a[u]=$u(d)}else a[u]=d}return a}function tE(n,t){return $u(ZN,n,t||{})}function nE(n,t){return $u(eE,n,t||{})}class rE{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:i,friendlyName:a,signal:o},u){try{const{data:d,error:f}=await this.client.mfa.challenge({factorId:t,webauthn:i});if(!d)return{data:null,error:f};const h=o??VN.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:m}=d.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${a}`),m.displayName||(m.displayName=m.name)}switch(d.webauthn.type){case"create":{const m=tE(d.webauthn.credential_options.publicKey,u?.create),{data:y,error:v}=await JN({publicKey:m,signal:h});return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}case"request":{const m=nE(d.webauthn.credential_options.publicKey,u?.request),{data:y,error:v}=await XN(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:m,signal:h}));return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}}}catch(d){return ft(d)?{data:null,error:d}:{data:null,error:new ta("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:i,webauthn:a}){return this.client.mfa.verify({factorId:i,challengeId:t,webauthn:a})}async _authenticate({factorId:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!i)return{data:null,error:new Bo("rpId is required for WebAuthn authentication")};try{if(!mx())return{data:null,error:new ta("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this.challenge({factorId:t,webauthn:{rpId:i,rpOrigins:a},signal:o},{request:u});if(!d)return{data:null,error:f};const{webauthn:h}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:h.type,rpId:i,rpOrigins:a,credential_response:h.credential_response}})}catch(d){return ft(d)?{data:null,error:d}:{data:null,error:new ta("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!i)return{data:null,error:new Bo("rpId is required for WebAuthn registration")};try{if(!mx())return{data:null,error:new ta("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:f};const{data:h,error:m}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:i,rpOrigins:a},signal:o},{create:u});return h?this._verify({factorId:d.id,challengeId:h.challengeId,webauthn:{rpId:i,rpOrigins:a,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:m}}catch(d){return ft(d)?{data:null,error:d}:{data:null,error:new ta("Unexpected error in register",d)}}}}BN();const sE={url:ZC,storageKey:eN,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:tN,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function gx(n,t,i){return await i()}const Wa={};class $o{get jwks(){var t,i;return(i=(t=Wa[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(t){Wa[this.storageKey]=Object.assign(Object.assign({},Wa[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,i;return(i=(t=Wa[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Wa[this.storageKey]=Object.assign(Object.assign({},Wa[this.storageKey]),{cachedAt:t})}constructor(t){var i,a,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},sE),t);if(this.storageKey=u.storageKey,this.instanceID=(i=$o.nextInstanceID[this.storageKey])!==null&&i!==void 0?i:0,$o.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&rr()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new UN({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=ob(u.fetch),this.lock=u.lock||gx,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:this.persistSession&&rr()&&(!((a=globalThis?.navigator)===null||a===void 0)&&a.locks)?this.lock=IN:this.lock=gx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new rE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:lb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=px(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=px(this.memoryStorage)),rr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${sb}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let i={},a="none";if(rr()&&(i=gN(window.location.href),this._isImplicitGrantCallback(i)?a="implicit":await this._isPKCECallback(i)&&(a="pkce")),rr()&&this.detectSessionInUrl&&a!=="none"){const{data:o,error:u}=await this._getSessionFromURL(i,a);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),lN(u)){const h=(t=u.details)===null||t===void 0?void 0:t.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:d,redirectType:f}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",f),await this._saveSession(d),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return ft(i)?this._returnResult({error:i}):this._returnResult({error:new ta("Unexpected error during initialization",i)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,a,o;try{const u=await jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(i=t?.options)===null||i===void 0?void 0:i.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:rs}),{data:d,error:f}=u;if(f||!d)return this._returnResult({data:{user:null,session:null},error:f});const h=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(u){if(ft(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var i,a,o;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let b=null,_=null;this.flowType==="pkce"&&([b,_]=await Va(this.storage,this.storageKey)),u=await jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(i=x?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:b,code_challenge_method:_},xform:rs})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await jt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(a=x?.data)!==null&&a!==void 0?a:{},channel:(o=x?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:rs})}else throw new mu("You must provide either an email or phone number and a password");const{data:d,error:f}=u;if(f||!d)return await tr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:f});const h=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(u){if(await tr(this.storage,`${this.storageKey}-code-verifier`),ft(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let i;if("email"in t){const{email:u,password:d,options:f}=t;i=await jt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:hx})}else if("phone"in t){const{phone:u,password:d,options:f}=t;i=await jt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:hx})}else throw new mu("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!a||!a.session||!a.user){const u=new Ga;return this._returnResult({data:{user:null,session:null},error:u})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:o})}catch(i){if(ft(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOAuth(t){var i,a,o,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:i}=t;switch(i){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(t){var i,a,o,u,d,f,h,m,y,v,x;let b,_;if("message"in t)b=t.message,_=t.signature;else{const{chain:C,wallet:j,statement:k,options:E}=t;let D;if(rr())if(typeof j=="object")D=j;else{const L=window;if("ethereum"in L&&typeof L.ethereum=="object"&&"request"in L.ethereum&&typeof L.ethereum.request=="function")D=L.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!E?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");D=j}const U=new URL((i=E?.url)!==null&&i!==void 0?i:window.location.href),B=await D.request({method:"eth_requestAccounts"}).then(L=>L).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!B||B.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const T=ub(B[0]);let N=(a=E?.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!N){const L=await D.request({method:"eth_chainId"});N=$N(L)}const O={domain:U.host,address:T,statement:k,uri:U.href,version:"1",chainId:N,nonce:(o=E?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(u=E?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(f=E?.signInWithEthereum)===null||f===void 0?void 0:f.expirationTime,notBefore:(h=E?.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(m=E?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(y=E?.signInWithEthereum)===null||y===void 0?void 0:y.resources};b=qN(O),_=await D.request({method:"personal_sign",params:[PN(b),T]})}try{const{data:C,error:j}=await jt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:b,signature:_},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:rs});if(j)throw j;if(!C||!C.session||!C.user){const k=new Ga;return this._returnResult({data:{user:null,session:null},error:k})}return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",C.session)),this._returnResult({data:Object.assign({},C),error:j})}catch(C){if(ft(C))return this._returnResult({data:{user:null,session:null},error:C});throw C}}async signInWithSolana(t){var i,a,o,u,d,f,h,m,y,v,x,b;let _,C;if("message"in t)_=t.message,C=t.signature;else{const{chain:j,wallet:k,statement:E,options:D}=t;let U;if(rr())if(typeof k=="object")U=k;else{const T=window;if("solana"in T&&typeof T.solana=="object"&&("signIn"in T.solana&&typeof T.solana.signIn=="function"||"signMessage"in T.solana&&typeof T.solana.signMessage=="function"))U=T.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof k!="object"||!D?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");U=k}const B=new URL((i=D?.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in U&&U.signIn){const T=await U.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},D?.signInWithSolana),{version:"1",domain:B.host,uri:B.href}),E?{statement:E}:null));let N;if(Array.isArray(T)&&T[0]&&typeof T[0]=="object")N=T[0];else if(T&&typeof T=="object"&&"signedMessage"in T&&"signature"in T)N=T;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in N&&"signature"in N&&(typeof N.signedMessage=="string"||N.signedMessage instanceof Uint8Array)&&N.signature instanceof Uint8Array)_=typeof N.signedMessage=="string"?N.signedMessage:new TextDecoder().decode(N.signedMessage),C=N.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in U)||typeof U.signMessage!="function"||!("publicKey"in U)||typeof U!="object"||!U.publicKey||!("toBase58"in U.publicKey)||typeof U.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${B.host} wants you to sign in with your Solana account:`,U.publicKey.toBase58(),...E?["",E,""]:[""],"Version: 1",`URI: ${B.href}`,`Issued At: ${(o=(a=D?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((u=D?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${D.signInWithSolana.notBefore}`]:[],...!((d=D?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${D.signInWithSolana.expirationTime}`]:[],...!((f=D?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${D.signInWithSolana.chainId}`]:[],...!((h=D?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${D.signInWithSolana.nonce}`]:[],...!((m=D?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${D.signInWithSolana.requestId}`]:[],...!((v=(y=D?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...D.signInWithSolana.resources.map(N=>`- ${N}`)]:[]].join(`
`);const T=await U.signMessage(new TextEncoder().encode(_),"utf8");if(!T||!(T instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");C=T}}try{const{data:j,error:k}=await jt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:sa(C)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(b=t.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:rs});if(k)throw k;if(!j||!j.session||!j.user){const E=new Ga;return this._returnResult({data:{user:null,session:null},error:E})}return j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),this._returnResult({data:Object.assign({},j),error:k})}catch(j){if(ft(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async _exchangeCodeForSession(t){const i=await Yi(this.storage,`${this.storageKey}-code-verifier`),[a,o]=(i??"").split("/");try{if(!a&&this.flowType==="pkce")throw new oN;const{data:u,error:d}=await jt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:rs});if(await tr(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const f=new Ga;return this._returnResult({data:{user:null,session:null,redirectType:null},error:f})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:o??null}),error:d})}catch(u){if(await tr(this.storage,`${this.storageKey}-code-verifier`),ft(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:i,provider:a,token:o,access_token:u,nonce:d}=t,f=await jt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:o,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:rs}),{data:h,error:m}=f;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!h||!h.session||!h.user){const y=new Ga;return this._returnResult({data:{user:null,session:null},error:y})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:m})}catch(i){if(ft(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOtp(t){var i,a,o,u,d;try{if("email"in t){const{email:f,options:h}=t;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await Va(this.storage,this.storageKey));const{error:v}=await jt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(i=h?.data)!==null&&i!==void 0?i:{},create_user:(a=h?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:m,code_challenge_method:y},redirectTo:h?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:f,options:h}=t,{data:m,error:y}=await jt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(o=h?.data)!==null&&o!==void 0?o:{},create_user:(u=h?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(d=h?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:y})}throw new mu("You must provide either an email or phone number.")}catch(f){if(await tr(this.storage,`${this.storageKey}-code-verifier`),ft(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async verifyOtp(t){var i,a;try{let o,u;"options"in t&&(o=(i=t.options)===null||i===void 0?void 0:i.redirectTo,u=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:d,error:f}=await jt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:o,xform:rs});if(f)throw f;if(!d)throw new Error("An error occurred on token verification.");const h=d.session,m=d.user;return h?.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(o){if(ft(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var i,a,o,u,d;try{let f=null,h=null;this.flowType==="pkce"&&([f,h]=await Va(this.storage,this.storageKey));const m=await jt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&a!==void 0?a:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:h}),headers:this.headers,xform:DN});return!((u=m.data)===null||u===void 0)&&u.url&&rr()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(f){if(await tr(this.storage,`${this.storageKey}-code-verifier`),ft(f))return this._returnResult({data:null,error:f});throw f}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;if(a)throw a;if(!i)throw new kr;const{error:o}=await jt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(ft(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:a,type:o,options:u}=t,{error:d}=await jt(this.fetch,"POST",i,{headers:this.headers,body:{email:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:a,type:o,options:u}=t,{data:d,error:f}=await jt(this.fetch,"POST",i,{headers:this.headers,body:{phone:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:f})}throw new mu("You must provide either an email or phone number and a type")}catch(i){if(ft(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await a,await i()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=i();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await Yi(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at*1e3-Date.now()<wf:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.userStorage){const d=await Yi(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=_f()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=TN(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const i=await this._acquireLock(-1,async()=>await this._getUser());return i.data.user&&(this.suppressGetSessionWarning=!0),i}async _getUser(t){try{return t?await jt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:_i}):await this._useSession(async i=>{var a,o,u;const{data:d,error:f}=i;if(f)throw f;return!(!((a=d.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new kr}:await jt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:void 0,xform:_i})})}catch(i){if(ft(i))return aN(i)&&(await this._removeSession(),await tr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:i});throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async a=>{const{data:o,error:u}=a;if(u)throw u;if(!o.session)throw new kr;const d=o.session;let f=null,h=null;this.flowType==="pkce"&&t.email!=null&&([f,h]=await Va(this.storage,this.storageKey));const{data:m,error:y}=await jt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:f,code_challenge_method:h}),jwt:d.access_token,xform:_i});if(y)throw y;return d.user=m.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(a){if(await tr(this.storage,`${this.storageKey}-code-verifier`),ft(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new kr;const i=Date.now()/1e3;let a=i,o=!0,u=null;const{payload:d}=jf(t.access_token);if(d.exp&&(a=d.exp,o=a<=i),o){const{data:f,error:h}=await this._callRefreshToken(t.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!f)return{data:{user:null,session:null},error:null};u=f}else{const{data:f,error:h}=await this._getUser(t.access_token);if(h)throw h;u={access_token:t.access_token,refresh_token:t.refresh_token,user:f.user,token_type:"bearer",expires_in:a-i,expires_at:a},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(i){if(ft(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var a;if(!t){const{data:d,error:f}=i;if(f)throw f;t=(a=d.session)!==null&&a!==void 0?a:void 0}if(!t?.refresh_token)throw new kr;const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(i){if(ft(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async _getSessionFromURL(t,i){try{if(!rr())throw new gu("No browser detected.");if(t.error||t.error_description||t.error_code)throw new gu(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new ix("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new gu("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new ix("No code detected.");const{data:E,error:D}=await this._exchangeCodeForSession(t.code);if(D)throw D;const U=new URL(window.location.href);return U.searchParams.delete("code"),window.history.replaceState(window.history.state,"",U.toString()),{data:{session:E.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:o,access_token:u,refresh_token:d,expires_in:f,expires_at:h,token_type:m}=t;if(!u||!f||!d||!m)throw new gu("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(f);let x=y+v;h&&(x=parseInt(h));const b=x-y;b*1e3<=rl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${b}s, should have been closer to ${v}s`);const _=x-v;y-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,x,y):y-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,x,y);const{data:C,error:j}=await this._getUser(u);if(j)throw j;const k={provider_token:a,provider_refresh_token:o,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:m,user:C.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:k,redirectType:t.type},error:null})}catch(a){if(ft(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await Yi(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({error:u});const d=(a=o.session)===null||a===void 0?void 0:a.access_token;if(d){const{error:f}=await this.admin.signOut(d,t);if(f&&!(iN(f)&&(f.status===404||f.status===401||f.status===403)))return this._returnResult({error:f})}return t!=="others"&&(await this._removeSession(),await tr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const i=mN(),a={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async i=>{var a,o;try{const{data:{session:u},error:d}=i;if(d)throw d;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,i={}){let a=null,o=null;this.flowType==="pkce"&&([a,o]=await Va(this.storage,this.storageKey,!0));try{return await jt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:o,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(u){if(await tr(this.storage,`${this.storageKey}-code-verifier`),ft(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:i,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(i){if(ft(i))return this._returnResult({data:null,error:i});throw i}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var i;try{const{data:a,error:o}=await this._useSession(async u=>{var d,f,h,m,y;const{data:v,error:x}=u;if(x)throw x;const b=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(f=t.options)===null||f===void 0?void 0:f.scopes,queryParams:(h=t.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await jt(this.fetch,"GET",b,{headers:this.headers,jwt:(y=(m=v.session)===null||m===void 0?void 0:m.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return rr()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(a?.url),this._returnResult({data:{provider:t.provider,url:a?.url},error:null})}catch(a){if(ft(a))return this._returnResult({data:{provider:t.provider,url:null},error:a});throw a}}async linkIdentityIdToken(t){return await this._useSession(async i=>{var a;try{const{error:o,data:{session:u}}=i;if(o)throw o;const{options:d,provider:f,token:h,access_token:m,nonce:y}=t,v=await jt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=u?.access_token)!==null&&a!==void 0?a:void 0,body:{provider:f,id_token:h,access_token:m,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:rs}),{data:x,error:b}=v;return b?this._returnResult({data:{user:null,session:null},error:b}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new Ga}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:b}))}catch(o){if(await tr(this.storage,`${this.storageKey}-code-verifier`),ft(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async i=>{var a,o;const{data:u,error:d}=i;if(d)throw d;return await jt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(a=u.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0})})}catch(i){if(ft(i))return this._returnResult({data:null,error:i});throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const a=Date.now();return await xN(async o=>(o>0&&await vN(200*Math.pow(2,o-1)),this._debug(i,"refreshing attempt",o),await jt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:rs})),(o,u)=>{const d=200*Math.pow(2,o);return u&&Sf(u)&&Date.now()+d-a<rl})}catch(a){if(this._debug(i,"error",a),ft(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",a),rr()&&!i.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t,i;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const o=await Yi(this.storage,this.storageKey);if(o&&this.userStorage){let d=await Yi(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await sl(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d?.user)!==null&&t!==void 0?t:_f()}else if(o&&!o.user&&!o.user){const d=await Yi(this.storage,this.storageKey+"-user");d&&d?.user?(o.user=d.user,await tr(this.storage,this.storageKey+"-user"),await sl(this.storage,this.storageKey,o)):o.user=_f()}if(this._debug(a,"session from storage",o),!this._isValidSession(o)){this._debug(a,"session is not valid"),o!==null&&await this._removeSession();return}const u=((i=o.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<wf;if(this._debug(a,`session has${u?"":" not"} expired with margin of ${wf}s`),u){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),Sf(d)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:f}=await this._getUser(o.access_token);!f&&d?.user?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(a,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(a,"error",o),console.error(o);return}finally{this._debug(a,"end")}}async _callRefreshToken(t){var i,a;if(!t)throw new kr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new rd;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new kr;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const f={data:u.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(u){if(this._debug(o,"error",u),ft(u)){const d={data:null,error:u};return Sf(u)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(d),d}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(u),u}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,i,a=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",i,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:i});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(t,i)}catch(h){u.push(h)}});if(await Promise.all(d),u.length>0){for(let f=0;f<u.length;f+=1)console.error(u[f]);throw u[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await tr(this.storage,`${this.storageKey}-code-verifier`);const i=Object.assign({},t),a=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&i.user&&await sl(this.userStorage,this.storageKey+"-user",{user:i.user});const o=Object.assign({},i);delete o.user;const u=ux(o);await sl(this.storage,this.storageKey,u)}else{const o=ux(i);await sl(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await tr(this.storage,this.storageKey),await tr(this.storage,this.storageKey+"-code-verifier"),await tr(this.storage,this.storageKey+"-user"),this.userStorage&&await tr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&rr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),rl);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:a}}=i;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((a.expires_at*1e3-t)/rl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${rl}ms, refresh threshold is ${cp} ticks`),o<=cp&&await this._callRefreshToken(a.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof cb)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!rr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,a){const o=[`provider=${encodeURIComponent(i)}`];if(a?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&o.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[u,d]=await Va(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(f.toString())}if(a?.queryParams){const u=new URLSearchParams(a.queryParams);o.push(u.toString())}return a?.skipBrowserRedirect&&o.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;return u?this._returnResult({data:null,error:u}):await jt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token})})}catch(i){if(ft(i))return this._returnResult({data:null,error:i});throw i}}async _enroll(t){try{return await this._useSession(async i=>{var a,o;const{data:u,error:d}=i;if(d)return this._returnResult({data:null,error:d});const f=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:h,error:m}=await jt(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(a=u?.session)===null||a===void 0?void 0:a.access_token});return m?this._returnResult({data:null,error:m}):(t.factorType==="totp"&&h.type==="totp"&&(!((o=h?.totp)===null||o===void 0)&&o.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(i){if(ft(i))return this._returnResult({data:null,error:i});throw i}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?WN(t.webauthn.credential_response):QN(t.webauthn.credential_response)})}:{code:t.code}),{data:f,error:h}=await jt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+f.expires_in},f)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",f),this._returnResult({data:f,error:h}))})}catch(i){if(ft(i))return this._returnResult({data:null,error:i});throw i}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({data:null,error:u});const d=await jt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});if(d.error)return d;const{data:f}=d;if(f.type!=="webauthn")return{data:f,error:null};switch(f.webauthn.type){case"create":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:KN(f.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:YN(f.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(i){if(ft(i))return this._returnResult({data:null,error:i});throw i}})}async _challengeAndVerify(t){const{data:i,error:a}=await this._challenge({factorId:t.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){var t;const{data:{user:i},error:a}=await this.getUser();if(a)return{data:null,error:a};const o={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=i?.factors)!==null&&t!==void 0?t:[])o.all.push(u),u.status==="verified"&&o[u.factor_type].push(u);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,i;const{data:{session:a},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=jf(a.access_token);let d=null;u.aal&&(d=u.aal);let f=d;((i=(t=a.user.factors)===null||t===void 0?void 0:t.filter(y=>y.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(f="aal2");const m=u.amr||[];return{data:{currentLevel:d,nextLevel:f,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;return o?this._returnResult({data:null,error:o}):a?await jt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:a.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new kr})})}catch(i){if(ft(i))return this._returnResult({data:null,error:i});throw i}}async _approveAuthorization(t,i){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new kr});const d=await jt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&rr()&&!i?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(ft(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(t,i){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new kr});const d=await jt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&rr()&&!i?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(ft(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;return a?this._returnResult({data:null,error:a}):i?await jt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new kr})})}catch(t){if(ft(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;return o?this._returnResult({data:null,error:o}):a?(await jt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new kr})})}catch(i){if(ft(i))return this._returnResult({data:null,error:i});throw i}}async fetchJwk(t,i={keys:[]}){let a=i.keys.find(f=>f.kid===t);if(a)return a;const o=Date.now();if(a=this.jwks.keys.find(f=>f.kid===t),a&&this.jwks_cached_at+rN>o)return a;const{data:u,error:d}=await jt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=o,a=u.keys.find(f=>f.kid===t),!a)?null:a}async getClaims(t,i={}){try{let a=t;if(!a){const{data:b,error:_}=await this.getSession();if(_||!b.session)return this._returnResult({data:null,error:_});a=b.session.access_token}const{header:o,payload:u,signature:d,raw:{header:f,payload:h}}=jf(a);i?.allowExpired||NN(u.exp);const m=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,i?.keys?{keys:i.keys}:i?.jwks);if(!m){const{error:b}=await this.getUser(a);if(b)throw b;return{data:{claims:u,header:o,signature:d},error:null}}const y=EN(o.alg),v=await crypto.subtle.importKey("jwk",m,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,fN(`${f}.${h}`)))throw new hp("Invalid JWT signature");return{data:{claims:u,header:o,signature:d},error:null}}catch(a){if(ft(a))return this._returnResult({data:null,error:a});throw a}}}$o.nextInstanceID={};const iE=$o,aE="2.89.0";let jo="";typeof Deno<"u"?jo="deno":typeof document<"u"?jo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?jo="react-native":jo="node";const lE={"X-Client-Info":`supabase-js-${jo}/${aE}`},oE={headers:lE},cE={schema:"public"},uE={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},dE={};function Po(n){"@babel/helpers - typeof";return Po=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Po(n)}function hE(n,t){if(Po(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(Po(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function fE(n){var t=hE(n,"string");return Po(t)=="symbol"?t:t+""}function pE(n,t,i){return(t=fE(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function yx(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function On(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?yx(Object(i),!0).forEach(function(a){pE(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):yx(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}const mE=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),gE=()=>Headers,yE=(n,t,i)=>{const a=mE(i),o=gE();return async(u,d)=>{var f;const h=(f=await t())!==null&&f!==void 0?f:n;let m=new o(d?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${h}`),a(u,On(On({},d),{},{headers:m}))}};function vE(n){return n.endsWith("/")?n:n+"/"}function xE(n,t){var i,a;const{db:o,auth:u,realtime:d,global:f}=n,{db:h,auth:m,realtime:y,global:v}=t,x={db:On(On({},h),o),auth:On(On({},m),u),realtime:On(On({},y),d),storage:{},global:On(On(On({},v),f),{},{headers:On(On({},(i=v?.headers)!==null&&i!==void 0?i:{}),(a=f?.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function bE(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(vE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var wE=class extends iE{constructor(n){super(n)}},SE=class{constructor(n,t,i){var a,o;this.supabaseUrl=n,this.supabaseKey=t;const u=bE(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,f={db:cE,realtime:dE,auth:On(On({},uE),{},{storageKey:d}),global:oE},h=xE(i??{},f);if(this.storageKey=(a=h.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken)this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var m;this.auth=this._initSupabaseAuthClient((m=h.auth)!==null&&m!==void 0?m:{},this.headers,h.global.fetch)}this.fetch=yE(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(On({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&this.accessToken().then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new tC(new URL("rest/v1",u).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new XC(this.storageUrl.href,this.headers,this.fetch,i?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new Q1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,i)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,i;if(n.accessToken)return await n.accessToken();const{data:a}=await n.auth.getSession();return(t=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:i,storage:a,userStorage:o,storageKey:u,flowType:d,lock:f,debug:h,throwOnError:m},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new wE({url:this.authUrl.href,headers:On(On({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:i,storage:a,userStorage:o,flowType:d,lock:f,debug:h,throwOnError:m,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new vC(this.realtimeUrl.href,On(On({},n),{},{params:On(On({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,i){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const jE=(n,t,i)=>new SE(n,t,i);function _E(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}_E()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Nf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var CE={};const hb=n=>{if(typeof import.meta<"u"&&Nf&&Nf[n])return Nf[n];const t=CE;return t&&t[n]?t[n]:null},fb=hb("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",NE=hb("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",EE=fb,Re=jE(fb,NE),kE=2,Ef=n=>{if(typeof n!="string")return!1;const t=n.trim();return t?!/^[\d-\s.,+\-/%~]+$/.test(t):!1},vx={async translateRecipe(n,t="EN-US"){const i=[],a=[],o=(h,m)=>{const y=typeof h=="string"?h:String(h??"");i.push(y),a.push((v,x)=>{m(x,v||y,y)})},u=h=>Array.isArray(h)?h.map(m=>m&&typeof m=="object"?{...m}:m):h,d={...n,ingredients:u(n.ingredients),flours:u(n.flours),breadIngredients:u(n.breadIngredients),steps:u(n.steps),ingredientGroups:u(n.ingredientGroups),stepGroups:u(n.stepGroups)};if(o(n.title||n.name||"",(h,m)=>{h.title=m,(h.name!==void 0||n.name!==void 0)&&(h.name=m)}),o(n.description||"",(h,m)=>{h.description=m}),n.course&&o(n.course,(h,m)=>{h.course=m}),n.category&&o(n.category,(h,m)=>{h.category=m}),n.storeName&&o(n.storeName,(h,m)=>{h.storeName=m}),Array.isArray(n.ingredientGroups)&&n.ingredientGroups.forEach((h,m)=>{const y=h?.name;y&&o(y,(v,x)=>{v.ingredientGroups?.[m]&&(v.ingredientGroups[m].name=x)})}),Array.isArray(n.stepGroups)&&n.stepGroups.forEach((h,m)=>{const y=h?.name;y&&o(y,(v,x)=>{v.stepGroups?.[m]&&(v.stepGroups[m].name=x)})}),n.type==="bread"?((n.flours||[]).forEach((h,m)=>{!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.flours?.[m]&&(y.flours[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.flours?.[m]&&(y.flours[m].unit=v)}),Ef(h.quantity)&&o(h.quantity,(y,v)=>{y.flours?.[m]&&(y.flours[m].quantity=v)}))}),(n.breadIngredients||[]).forEach((h,m)=>{!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].unit=v)}),Ef(h.quantity)&&o(h.quantity,(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].quantity=v)}))})):(n.ingredients||[]).forEach((h,m)=>{if(typeof h=="string"){o(h,(y,v)=>{Array.isArray(y.ingredients)&&(y.ingredients[m]=v)});return}!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].unit=v)}),Ef(h.quantity)&&o(h.quantity,(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].quantity=v)}))}),(n.steps||[]).forEach((h,m)=>{const y=typeof h=="object"&&h!==null?h.text||"":h||"";o(y,(v,x)=>{const b=v.steps?.[m];if(typeof b=="object"&&b!==null){b.text=x;return}Array.isArray(v.steps)&&(v.steps[m]=x)})}),!i.some(h=>String(h||"").trim().length>0))return n;try{const h=await this.translateList(i,t);return a.forEach((m,y)=>{m(h[y],d)}),d.__translationVersion=kE,d}catch(h){throw console.error("Translation failed:",h),h}},async translateList(n,t){const i=(n||[]).map(u=>typeof u=="string"?u:String(u??""));if(!i.some(u=>u.trim().length>0))return i;const{data:a,error:o}=await Re.functions.invoke("translate",{body:{text:i,target_lang:t}});if(o)throw console.error("Supabase Function Invocation Error:",o),new Error(`Translation Error: ${o.message}`);if(a&&a.error)throw console.error("Edge Function returned error:",a.error),new Error(`Translation Error: ${a.error}`);if(!Array.isArray(a?.translations))throw console.error("Edge Function returned invalid payload:",a),new Error("Translation Error: invalid response payload");return a.translations.map(u=>u.text)}},ln=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},yu=async(n,t,i)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${i||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},ku=n=>{if(Array.isArray(n))return n.map(i=>String(i)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const i=t.slice(1,-1);return i?i.split(",").map(a=>a.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},TE=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],i=Object.values(t)[0];return ku(i)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return ku(t)}return ku(n)},pb=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const i=ku(t);return i.length>0?i:t.split(",").map(a=>a.trim()).filter(Boolean)}return[]},xx=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),i=String(n.message||"").toLowerCase(),a=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||i.includes("row-level security")||i.includes("permission denied")||i.includes("violates row-level security")||i.includes("invalid input syntax")||i.includes("column")||a.includes("row-level security")?!1:i.includes("failed to fetch")||i.includes("network")||i.includes("timeout")||i.includes("timed out")||i.includes("load failed")},mb="recipe_list_cache",RE=300*1e3,kf=(n,t)=>{try{const i=(n||[]).map(a=>({id:a.id,title:a.title,description:a.description,image:a.image,servings:a.servings,course:a.course,category:a.category,storeName:a.storeName,store_name:a.store_name,tags:a.tags,created_at:a.created_at,updated_at:a.updated_at,type:a.type,sourceUrl:a.sourceUrl}));localStorage.setItem(mb,JSON.stringify({userId:t,updatedAt:Date.now(),recipes:i}))}catch{}},AE=n=>{try{const t=localStorage.getItem(mb);if(!t)return null;const i=JSON.parse(t);return i.userId!==n||Date.now()-i.updatedAt>RE?null:i.recipes||null}catch{return null}},yn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(n){return AE(n)},saveCachedRecipes(n,t){kf(n,t)},async _resolveShowMasterPreference(n,t=15e3){const i=n?.showMasterRecipes===!0,a=n?.id;if(!a)return i;const o=this._showMasterPrefCache.get(a),u=Date.now();if(o&&o.value!==i)return this._showMasterPrefCache.set(a,{value:i,updatedAt:u}),i;if(o&&u-o.updatedAt<3e4)return o.value;try{const{data:d,error:f}=await yu(Re.from("profiles").select("show_master_recipes").eq("id",a).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(f)throw f;const h=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(a,{value:h,updatedAt:u}),h}catch{return this._showMasterPrefCache.set(a,{value:i,updatedAt:u}),i}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:i,error:a}=await yu(Re.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(a)throw a;const o=TE(i),u=new Set(o.length>0?o:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const i=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:i,updatedAt:t},i}},async fetchRecipes(n,{timeoutMs:t=15e3,includeIngredients:i=!0,includeSources:a=!0,offset:o=0,limit:u=null,skipCacheSave:d=!1,returnMeta:f=!1}={}){if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const h=n.role==="admin",m=h?Promise.resolve(!1):this._resolveShowMasterPreference(n,t),y=Number.isInteger(o)&&o>=0?o:0,v=Number.isInteger(u)&&u>0?u:null;let x=0,b=[];const _=async(q,{withOrderIndex:V,queryTimeoutMs:F})=>{let I=Re.from("recipes").select(q);V?I=I.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):I=I.order("created_at",{ascending:!1}),v!=null&&(I=I.range(y,y+v-1));const{data:P,error:R}=await yu(I,F,"recipes.select(list)");if(R)throw R;return x=Array.isArray(P)?P.length:0,(P||[]).map(ss)},C=i?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`,j=i?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${a?",recipe_sources(url)":""}`,k=i?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",E=i?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let D=null;const U=`recipe_query_pattern:${i?"ing":"noing"}:${a?"src":"nosrc"}`,B=this._queryPatternCache.get(U),T=Math.max(2500,t);if(B)try{b=await _(B.spec,{withOrderIndex:B.withOrderIndex,queryTimeoutMs:T})}catch(q){console.warn("Cached query pattern failed, re-detecting...",q),this._queryPatternCache.delete(U),D=q}else{const V=Math.max(2500,Math.round(t/(i?[C,j,k,E]:[C,j,E]).length));try{b=await _(C,{withOrderIndex:!0,queryTimeoutMs:V}),this._queryPatternCache.set(U,{spec:C,withOrderIndex:!0})}catch(F){D=F;try{b=await _(j,{withOrderIndex:!1,queryTimeoutMs:V}),this._queryPatternCache.set(U,{spec:j,withOrderIndex:!1})}catch(I){D=I;try{b=await _(k,{withOrderIndex:!1,queryTimeoutMs:V}),this._queryPatternCache.set(U,{spec:k,withOrderIndex:!1})}catch(P){D=P;try{b=await _(E,{withOrderIndex:!1,queryTimeoutMs:V}),this._queryPatternCache.set(U,{spec:E,withOrderIndex:!1})}catch(R){D=R,b=[]}}}}}if(b.length===0&&D)try{const q=localStorage.getItem("local_recipes");if(q){const V=JSON.parse(q).map(F=>typeof ss=="function"?ss(F):F);b=v!=null?V.slice(y,y+v):V,x=b.length}else throw D}catch{throw D}if(h)return d||kf(b,n.id),f?{recipes:b,hasMoreRaw:v!=null?x===v:!1}:b;const N=[String(n.id)];n.displayId&&N.push(String(n.displayId));const O=await m,L=O?await this._resolveMasterOwnerTags(t):new Set,Y=b.filter(q=>{const V=pb(q.tags),F=V.filter(z=>z&&z.startsWith("owner:"));if(F.length===0)return!0;const I=F.some(z=>L.has(z));if(O&&I)return!0;const P=F.some(z=>N.some(K=>z===`owner:${K}`)),R=V.includes("public");return!!(P||R)});return d||kf(Y,n.id),f?{recipes:Y,hasMoreRaw:v!=null?x===v:!1}:Y},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),a=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:o}=await Re.storage.from("recipe-images").upload(a,n);if(o)throw o;const{data:u}=Re.storage.from("recipe-images").getPublicUrl(a);return u.publicUrl},async getRecipe(n){try{const{data:t,error:i}=await yu(Re.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(i)throw i;return ss(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const i=localStorage.getItem("local_recipes");if(i){const o=JSON.parse(i).find(u=>u.id==n);if(o)return ss(o)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:i,created_at:a,sourceUrl:o,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const h=(u.tags||[]).filter(m=>!m.startsWith("owner:"));u.tags=[...h,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=vu(u);try{const{data:f,error:h}=await Re.from("recipes").insert([d]).select().single();if(h)throw h;if(o){const{error:m}=await Re.from("recipe_sources").insert([{recipe_id:f.id,url:o}]);m&&console.error("Failed to save source URL:",m)}return ss({...f,recipe_sources:o?[{url:o}]:[]})}catch(f){if(!xx(f))throw f;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",f);const h=Date.now(),m={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=vu(m);y.id=h,y.created_at=m.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),f}return ss(y)}},async updateRecipe(n){const{id:t,created_at:i,sourceUrl:a,...o}=n;o.image instanceof File&&(o.image=await this.uploadImage(o.image));const u=vu(o);o.steps===void 0&&delete u.steps,o.tags===void 0&&delete u.tags,o.ingredients!==void 0||o.type!==void 0||o.ingredientGroups!==void 0||o.flours!==void 0||o.breadIngredients!==void 0||o.stepGroups!==void 0||delete u.ingredients;try{const{data:f,error:h}=await Re.from("recipes").update(u).eq("id",n.id).select().single();if(h)throw h;if(a!==void 0&&(await Re.from("recipe_sources").delete().eq("recipe_id",n.id),a)){const{error:m}=await Re.from("recipe_sources").insert([{recipe_id:n.id,url:a}]);m&&console.error("Failed to update source URL:",m)}return ss({...f,recipe_sources:a?[{url:a}]:[]})}catch(f){if(!xx(f))throw f;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",f);const h=localStorage.getItem("local_recipes");if(h){let m=JSON.parse(h);const y=m.findIndex(v=>v.id==n.id);if(y!==-1){const v={...m[y],...u,updated_at:new Date().toISOString()};return m[y]=v,localStorage.setItem("local_recipes",JSON.stringify(m)),ss(v)}}throw f}},async duplicateRecipe(n,t){const{id:i,created_at:a,updated_at:o,image:u,...d}=n;d.title=`${d.title} ()`;let f=null;if(u)try{const h=u.split("/").pop(),m=`copy-${Date.now()}-${h}`,{error:y}=await Re.storage.from("recipe-images").copy(h,m);if(y)console.warn("Image copy failed, using original URL:",y),f=u;else{const{data:v}=Re.storage.from("recipe-images").getPublicUrl(m);f=v.publicUrl}}catch(h){console.warn("Image copy logic error:",h),f=u}return d.image=f,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await Re.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(OE)},async getDeletedCount(){const{count:n,error:t}=await Re.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:i}=await Re.from("recipes").select("*").eq("id",n).single();if(i)throw i;const{error:a}=await Re.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Re.from("recipes").delete().eq("id",n);if(o)throw o;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const i=localStorage.getItem("local_recipes");if(i){let a=JSON.parse(i);const o=a.length;if(a=a.filter(u=>u.id!=n),a.length<o)return localStorage.setItem("local_recipes",JSON.stringify(a)),!0}throw t}},async restoreRecipe(n){const{data:t,error:i}=await Re.from("deleted_recipes").select("*").eq("id",n).single();if(i)throw i;const{error:a}=await Re.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Re.from("deleted_recipes").delete().eq("id",n);if(o)throw o;return!0},async hardDeleteRecipe(n){const{error:t}=await Re.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await Re.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(i=>i.recipe_id)},async addToHistory(n){const{error:t}=await Re.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(i=>Re.from("recipes").update({order_index:i.order_index}).eq("id",i.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,i=[];for(const a of n)try{await this.createRecipe(a),t++}catch(o){console.error("Import failed for recipe:",a.title,o),i.push({title:a.title,error:o.message})}return{success:!0,count:t,errors:i}},async updateRecipeCosts(n){const{data:t,error:i}=await Re.from("recipes").select("*");if(i)throw i;let a=0;const o=[];for(const u of t){const d=ss(u);let f=!1;const h=m=>m.map(y=>{if(!y.name)return y;const v=n.get(ln(y.name));if(v&&y.purchaseCost!==v.price){f=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const b=parseFloat(x.quantity)||0;x.cost=Math.round(b/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const b=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*b)}return x}return y});if(d.type==="bread"){const m=h(d.flours||[]),y=h(d.breadIngredients||[]);f&&(d.flours=m,d.breadIngredients=y)}else{const m=h(d.ingredients||[]);f&&(d.ingredients=m)}if(f){const m=vu(d);o.push(Re.from("recipes").update(m).eq("id",d.id)),a++}}return o.length>0&&await Promise.all(o),a}},vu=n=>{let t=n.ingredients||[];const i={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(i.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const o=n.steps||[],u=n.stepGroups.map(d=>({...d,count:o.filter(f=>f.groupId===d.id).length}));i.stepGroups=u}if(n.type==="bread"){const o=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[i,...o,...u]}else t=[i,...t];const a=(n.steps||[]).map(o=>typeof o=="string"?o:o.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:a,tags:n.tags||[]}},ss=n=>{const t=n.ingredients||[];let i="normal",a=[],o=[],u=[],d=[],f=t;const h=pb(n.tags);if(Array.isArray(t)&&t.length>0&&t[0]&&typeof t[0]=="object"&&t[0]._meta){const v=t[0];i=v.type||"normal",v.groups&&(u=v.groups),v.stepGroups&&(d=v.stepGroups);const x=t.slice(1);i==="bread"?(a=x.filter(b=>b._group==="flour").map(b=>{const{_group:_,...C}=b;return C}),o=x.filter(b=>b._group==="other").map(b=>{const{_group:_,...C}=b;return C}),f=[...a,...o]):f=x}else n.ingredients_meta&&(i=n.ingredients_meta.type||"normal",Array.isArray(n.ingredients_meta.groups)&&(u=n.ingredients_meta.groups),Array.isArray(n.ingredients_meta.stepGroups)&&(d=n.ingredients_meta.stepGroups),f=Array.isArray(t)?t:[]);let y=n.steps||[];if(d.length>0&&Array.isArray(y)){let v=0;y=y.map(b=>({text:b}));const x=[];for(d.forEach(b=>{const _=b.count||0;for(let C=0;C<_;C++)v<y.length&&(x.push({...y[v],text:y[v].text,groupId:b.id}),v++)});v<y.length;)x.push({...y[v],groupId:"default"}),v++;y=x}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:i,flours:a,breadIngredients:o,ingredientGroups:u,stepGroups:d,ingredients:f,steps:y.length>0&&typeof y[0]=="object"?y:n.steps,tags:h,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},OE=n=>({...ss(n),deletedAt:n.deleted_at,originalId:n.original_id}),Tf=Object.freeze(Object.defineProperty({__proto__:null,recipeService:yn},Symbol.toStringTag,{value:"Module"})),Rf="food",DE="food_alcohol",ME=new Set(["food","alcohol","soft_drink","supplies"]),xu=n=>{const t=String(n||"").trim();return!t||t===DE?Rf:ME.has(t)?t:Rf},qn={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,i,a=null,o=null,u=void 0,d=void 0){try{const f=await this._getCurrentUserId();if(!f)throw new Error("");const h={user_id:f,ingredient_name:n,packet_size:parseFloat(t),packet_unit:i,last_price:a?parseFloat(a):null,updated_at:new Date().toISOString()};if(o&&(h.item_category=xu(o)),u!==void 0){const x=String(u??"").trim();h.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let b=Number.isFinite(x)?x:100;b<=0&&(b=100),b>100&&(b=100),h.yield_percent=b}const m=async x=>Re.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await m(h);if(v){const x=String(v.message||""),b=!!h.item_category&&x.includes("item_category"),_=Object.prototype.hasOwnProperty.call(h,"vendor")&&x.includes("vendor"),C=Object.prototype.hasOwnProperty.call(h,"yield_percent")&&x.includes("yield_percent");if(b||_||C){const j={...h};b&&delete j.item_category,_&&delete j.vendor,C&&delete j.yield_percent,{data:y,error:v}=await m(j)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:xu(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(f){throw console.error("Error saving conversion:",f),f}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:i,error:a}=await Re.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return a?(a.code==="PGRST116"||console.warn("Error fetching conversion:",a),null):{ingredientName:i.ingredient_name,packetSize:i.packet_size,packetUnit:i.packet_unit,lastPrice:i.last_price,vendor:i.vendor||"",itemCategory:xu(i.item_category),yieldPercent:i.yield_percent===null||i.yield_percent===void 0?100:i.yield_percent,updatedAt:i.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:i}=await Re.from("unit_conversions").select("*").eq("user_id",n);if(i)throw i;const a=new Map;return t.forEach(o=>{a.set(o.ingredient_name,{ingredientName:o.ingredient_name,packetSize:o.packet_size,packetUnit:o.packet_unit,lastPrice:o.last_price,vendor:o.vendor||"",itemCategory:xu(o.item_category),yieldPercent:o.yield_percent===null||o.yield_percent===void 0?100:o.yield_percent,updatedAt:o.updated_at})}),a}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:i}=await Re.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(i)throw i;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(n,{overwrite:t=!1}={}){const i=String(n||"").trim();if(!i)throw new Error("");const{data:a,error:o}=await Re.rpc("admin_copy_ingredient_master",{target_profile_id:i,overwrite:t===!0});if(o)throw o;return a}},gb=w.createContext(null),us=()=>w.useContext(gb),yb=w.createContext(null),ua=()=>{const n=w.useContext(yb);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},Pu=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],zE=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var Qa={},Af={exports:{}},Of,bx;function UE(){if(bx)return Of;bx=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Of=n,Of}var Df,wx;function LE(){if(wx)return Df;wx=1;var n=UE();function t(){}function i(){}return i.resetWarningCache=t,Df=function(){function a(d,f,h,m,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}a.isRequired=a;function o(){return a}var u={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:o,element:a,elementType:a,instanceOf:o,node:a,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:i,resetWarningCache:t};return u.PropTypes=u,u},Df}var Sx;function vb(){return Sx||(Sx=1,Af.exports=LE()()),Af.exports}var Mf,jx;function xb(){return jx||(jx=1,Mf={L:1,M:0,Q:3,H:2}),Mf}var zf,_x;function bb(){return _x||(_x=1,zf={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),zf}var Uf,Cx;function IE(){if(Cx)return Uf;Cx=1;var n=bb();function t(i){this.mode=n.MODE_8BIT_BYTE,this.data=i}return t.prototype={getLength:function(i){return this.data.length},write:function(i){for(var a=0;a<this.data.length;a++)i.put(this.data.charCodeAt(a),8)}},Uf=t,Uf}var Lf,Nx;function BE(){if(Nx)return Lf;Nx=1;var n=xb();function t(i,a){this.totalCount=i,this.dataCount=a}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(i,a){var o=t.getRsBlockTable(i,a);if(o==null)throw new Error("bad rs block @ typeNumber:"+i+"/errorCorrectLevel:"+a);for(var u=o.length/3,d=new Array,f=0;f<u;f++)for(var h=o[f*3+0],m=o[f*3+1],y=o[f*3+2],v=0;v<h;v++)d.push(new t(m,y));return d},t.getRsBlockTable=function(i,a){switch(a){case n.L:return t.RS_BLOCK_TABLE[(i-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(i-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(i-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(i-1)*4+3];default:return}},Lf=t,Lf}var If,Ex;function $E(){if(Ex)return If;Ex=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var i=Math.floor(t/8);return(this.buffer[i]>>>7-t%8&1)==1},put:function(t,i){for(var a=0;a<i;a++)this.putBit((t>>>i-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var i=Math.floor(this.length/8);this.buffer.length<=i&&this.buffer.push(0),t&&(this.buffer[i]|=128>>>this.length%8),this.length++}},If=n,If}var Bf,kx;function wb(){if(kx)return Bf;kx=1;for(var n={glog:function(i){if(i<1)throw new Error("glog("+i+")");return n.LOG_TABLE[i]},gexp:function(i){for(;i<0;)i+=255;for(;i>=256;)i-=255;return n.EXP_TABLE[i]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return Bf=n,Bf}var $f,Tx;function Sb(){if(Tx)return $f;Tx=1;var n=wb();function t(i,a){if(i.length==null)throw new Error(i.length+"/"+a);for(var o=0;o<i.length&&i[o]==0;)o++;this.num=new Array(i.length-o+a);for(var u=0;u<i.length-o;u++)this.num[u]=i[u+o]}return t.prototype={get:function(i){return this.num[i]},getLength:function(){return this.num.length},multiply:function(i){for(var a=new Array(this.getLength()+i.getLength()-1),o=0;o<this.getLength();o++)for(var u=0;u<i.getLength();u++)a[o+u]^=n.gexp(n.glog(this.get(o))+n.glog(i.get(u)));return new t(a,0)},mod:function(i){if(this.getLength()-i.getLength()<0)return this;for(var a=n.glog(this.get(0))-n.glog(i.get(0)),o=new Array(this.getLength()),u=0;u<this.getLength();u++)o[u]=this.get(u);for(var u=0;u<i.getLength();u++)o[u]^=n.gexp(n.glog(i.get(u))+a);return new t(o,0).mod(i)}},$f=t,$f}var Pf,Rx;function PE(){if(Rx)return Pf;Rx=1;var n=bb(),t=Sb(),i=wb(),a={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;o.getBCHDigit(d)-o.getBCHDigit(o.G15)>=0;)d^=o.G15<<o.getBCHDigit(d)-o.getBCHDigit(o.G15);return(u<<10|d)^o.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;o.getBCHDigit(d)-o.getBCHDigit(o.G18)>=0;)d^=o.G18<<o.getBCHDigit(d)-o.getBCHDigit(o.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return o.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,f){switch(u){case a.PATTERN000:return(d+f)%2==0;case a.PATTERN001:return d%2==0;case a.PATTERN010:return f%3==0;case a.PATTERN011:return(d+f)%3==0;case a.PATTERN100:return(Math.floor(d/2)+Math.floor(f/3))%2==0;case a.PATTERN101:return d*f%2+d*f%3==0;case a.PATTERN110:return(d*f%2+d*f%3)%2==0;case a.PATTERN111:return(d*f%3+(d+f)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),f=0;f<u;f++)d=d.multiply(new t([1,i.gexp(f)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),f=0,h=0;h<d;h++)for(var m=0;m<d;m++){for(var y=0,v=u.isDark(h,m),x=-1;x<=1;x++)if(!(h+x<0||d<=h+x))for(var b=-1;b<=1;b++)m+b<0||d<=m+b||x==0&&b==0||v==u.isDark(h+x,m+b)&&y++;y>5&&(f+=3+y-5)}for(var h=0;h<d-1;h++)for(var m=0;m<d-1;m++){var _=0;u.isDark(h,m)&&_++,u.isDark(h+1,m)&&_++,u.isDark(h,m+1)&&_++,u.isDark(h+1,m+1)&&_++,(_==0||_==4)&&(f+=3)}for(var h=0;h<d;h++)for(var m=0;m<d-6;m++)u.isDark(h,m)&&!u.isDark(h,m+1)&&u.isDark(h,m+2)&&u.isDark(h,m+3)&&u.isDark(h,m+4)&&!u.isDark(h,m+5)&&u.isDark(h,m+6)&&(f+=40);for(var m=0;m<d;m++)for(var h=0;h<d-6;h++)u.isDark(h,m)&&!u.isDark(h+1,m)&&u.isDark(h+2,m)&&u.isDark(h+3,m)&&u.isDark(h+4,m)&&!u.isDark(h+5,m)&&u.isDark(h+6,m)&&(f+=40);for(var C=0,m=0;m<d;m++)for(var h=0;h<d;h++)u.isDark(h,m)&&C++;var j=Math.abs(100*C/d/d-50)/5;return f+=j*10,f}};return Pf=o,Pf}var qf,Ax;function qE(){if(Ax)return qf;Ax=1;var n=IE(),t=BE(),i=$E(),a=PE(),o=Sb();function u(f,h){this.typeNumber=f,this.errorCorrectLevel=h,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(f){var h=new n(f);this.dataList.push(h),this.dataCache=null},d.isDark=function(f,h){if(f<0||this.moduleCount<=f||h<0||this.moduleCount<=h)throw new Error(f+","+h);return this.modules[f][h]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var f=1;for(f=1;f<40;f++){for(var h=t.getRSBlocks(f,this.errorCorrectLevel),m=new i,y=0,v=0;v<h.length;v++)y+=h[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];m.put(x.mode,4),m.put(x.getLength(),a.getLengthInBits(x.mode,f)),x.write(m)}if(m.getLengthInBits()<=y*8)break}this.typeNumber=f}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(f,h){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++){this.modules[m]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[m][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(f,h),this.typeNumber>=7&&this.setupTypeNumber(f),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,h)},d.setupPositionProbePattern=function(f,h){for(var m=-1;m<=7;m++)if(!(f+m<=-1||this.moduleCount<=f+m))for(var y=-1;y<=7;y++)h+y<=-1||this.moduleCount<=h+y||(0<=m&&m<=6&&(y==0||y==6)||0<=y&&y<=6&&(m==0||m==6)||2<=m&&m<=4&&2<=y&&y<=4?this.modules[f+m][h+y]=!0:this.modules[f+m][h+y]=!1)},d.getBestMaskPattern=function(){for(var f=0,h=0,m=0;m<8;m++){this.makeImpl(!0,m);var y=a.getLostPoint(this);(m==0||f>y)&&(f=y,h=m)}return h},d.createMovieClip=function(f,h,m){var y=f.createEmptyMovieClip(h,m),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var b=x*v,_=0;_<this.modules[x].length;_++){var C=_*v,j=this.modules[x][_];j&&(y.beginFill(0,100),y.moveTo(C,b),y.lineTo(C+v,b),y.lineTo(C+v,b+v),y.lineTo(C,b+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var f=8;f<this.moduleCount-8;f++)this.modules[f][6]==null&&(this.modules[f][6]=f%2==0);for(var h=8;h<this.moduleCount-8;h++)this.modules[6][h]==null&&(this.modules[6][h]=h%2==0)},d.setupPositionAdjustPattern=function(){for(var f=a.getPatternPosition(this.typeNumber),h=0;h<f.length;h++)for(var m=0;m<f.length;m++){var y=f[h],v=f[m];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var b=-2;b<=2;b++)x==-2||x==2||b==-2||b==2||x==0&&b==0?this.modules[y+x][v+b]=!0:this.modules[y+x][v+b]=!1}},d.setupTypeNumber=function(f){for(var h=a.getBCHTypeNumber(this.typeNumber),m=0;m<18;m++){var y=!f&&(h>>m&1)==1;this.modules[Math.floor(m/3)][m%3+this.moduleCount-8-3]=y}for(var m=0;m<18;m++){var y=!f&&(h>>m&1)==1;this.modules[m%3+this.moduleCount-8-3][Math.floor(m/3)]=y}},d.setupTypeInfo=function(f,h){for(var m=this.errorCorrectLevel<<3|h,y=a.getBCHTypeInfo(m),v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!f},d.mapData=function(f,h){for(var m=-1,y=this.moduleCount-1,v=7,x=0,b=this.moduleCount-1;b>0;b-=2)for(b==6&&b--;;){for(var _=0;_<2;_++)if(this.modules[y][b-_]==null){var C=!1;x<f.length&&(C=(f[x]>>>v&1)==1);var j=a.getMask(h,y,b-_);j&&(C=!C),this.modules[y][b-_]=C,v--,v==-1&&(x++,v=7)}if(y+=m,y<0||this.moduleCount<=y){y-=m,m=-m;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(f,h,m){for(var y=t.getRSBlocks(f,h),v=new i,x=0;x<m.length;x++){var b=m[x];v.put(b.mode,4),v.put(b.getLength(),a.getLengthInBits(b.mode,f)),b.write(v)}for(var _=0,x=0;x<y.length;x++)_+=y[x].dataCount;if(v.getLengthInBits()>_*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+_*8+")");for(v.getLengthInBits()+4<=_*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=_*8||(v.put(u.PAD0,8),v.getLengthInBits()>=_*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(f,h){for(var m=0,y=0,v=0,x=new Array(h.length),b=new Array(h.length),_=0;_<h.length;_++){var C=h[_].dataCount,j=h[_].totalCount-C;y=Math.max(y,C),v=Math.max(v,j),x[_]=new Array(C);for(var k=0;k<x[_].length;k++)x[_][k]=255&f.buffer[k+m];m+=C;var E=a.getErrorCorrectPolynomial(j),D=new o(x[_],E.getLength()-1),U=D.mod(E);b[_]=new Array(E.getLength()-1);for(var k=0;k<b[_].length;k++){var B=k+U.getLength()-b[_].length;b[_][k]=B>=0?U.get(B):0}}for(var T=0,k=0;k<h.length;k++)T+=h[k].totalCount;for(var N=new Array(T),O=0,k=0;k<y;k++)for(var _=0;_<h.length;_++)k<x[_].length&&(N[O++]=x[_][k]);for(var k=0;k<v;k++)for(var _=0;_<h.length;_++)k<b[_].length&&(N[O++]=b[_][k]);return N},qf=u,qf}var bu={},Ox;function FE(){if(Ox)return bu;Ox=1,Object.defineProperty(bu,"__esModule",{value:!0});var n=Object.assign||function(m){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(m[x]=v[x])}return m},t=vb(),i=u(t),a=Fo(),o=u(a);function u(m){return m&&m.__esModule?m:{default:m}}function d(m,y){var v={};for(var x in m)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(m,x)&&(v[x]=m[x]);return v}var f={bgColor:i.default.oneOfType([i.default.object,i.default.string]).isRequired,bgD:i.default.string.isRequired,fgColor:i.default.oneOfType([i.default.object,i.default.string]).isRequired,fgD:i.default.string.isRequired,size:i.default.number.isRequired,title:i.default.string,viewBoxSize:i.default.number.isRequired,xmlns:i.default.string},h=(0,a.forwardRef)(function(m,y){var v=m.bgColor,x=m.bgD,b=m.fgD,_=m.fgColor,C=m.size,j=m.title,k=m.viewBoxSize,E=m.xmlns,D=E===void 0?"http://www.w3.org/2000/svg":E,U=d(m,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return o.default.createElement("svg",n({},U,{height:C,ref:y,viewBox:"0 0 "+k+" "+k,width:C,xmlns:D}),j?o.default.createElement("title",null,j):null,o.default.createElement("path",{d:x,fill:v}),o.default.createElement("path",{d:b,fill:_}))});return h.displayName="QRCodeSvg",h.propTypes=f,bu.default=h,bu}var Dx;function HE(){if(Dx)return Qa;Dx=1,Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.QRCode=void 0;var n=Object.assign||function(C){for(var j=1;j<arguments.length;j++){var k=arguments[j];for(var E in k)Object.prototype.hasOwnProperty.call(k,E)&&(C[E]=k[E])}return C},t=vb(),i=v(t),a=xb(),o=v(a),u=qE(),d=v(u),f=Fo(),h=v(f),m=FE(),y=v(m);function v(C){return C&&C.__esModule?C:{default:C}}function x(C,j){var k={};for(var E in C)j.indexOf(E)>=0||Object.prototype.hasOwnProperty.call(C,E)&&(k[E]=C[E]);return k}var b={bgColor:i.default.oneOfType([i.default.object,i.default.string]),fgColor:i.default.oneOfType([i.default.object,i.default.string]),level:i.default.string,size:i.default.number,value:i.default.string.isRequired},_=(0,f.forwardRef)(function(C,j){var k=C.bgColor,E=k===void 0?"#FFFFFF":k,D=C.fgColor,U=D===void 0?"#000000":D,B=C.level,T=B===void 0?"L":B,N=C.size,O=N===void 0?256:N,L=C.value,Y=x(C,["bgColor","fgColor","level","size","value"]),q=new d.default(-1,o.default[T]);q.addData(L),q.make();var V=q.modules;return h.default.createElement(y.default,n({},Y,{bgColor:E,bgD:V.map(function(F,I){return F.map(function(P,R){return P?"":"M "+R+" "+I+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:U,fgD:V.map(function(F,I){return F.map(function(P,R){return P?"M "+R+" "+I+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:j,size:O,viewBoxSize:V.length}))});return Qa.QRCode=_,_.displayName="QRCode",_.propTypes=b,Qa.default=_,Qa}var GE=HE();const Mx=e0(GE),zx=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},VE=n=>{if(n==null)return NaN;if(typeof n=="number")return Number.isFinite(n)?n:NaN;const t=String(n).trim().replace(/[,\s]/g,"");if(!t)return NaN;const i=parseFloat(t);return Number.isFinite(i)?i:NaN},ms=(n,{maximumFractionDigits:t=1}={})=>{const i=VE(n);return Number.isFinite(i)?`${i.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}`:null},KE=new Set(["food","alcohol","soft_drink","supplies"]),jb=new Set(["alcohol","supplies"]),_b=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":KE.has(t)?t:"":""},fp=n=>{const t=_b(n?.itemCategory??n?.item_category);return t?jb.has(t):!!n?.isAlcohol},Wi=n=>fp(n)?1.1:1.08,Ux=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),YE=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=Ux(t);if(!a)return null;for(const[o,u]of n.entries())if(Ux(o)===a)return u;return null},qs=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},WE=n=>{const t=qs(n);return!Number.isFinite(t)||t<=0||t>100?100:t},QE=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return WE(i)/100},JE=(n,t,i)=>{const a=qs(n),o=qs(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},Lx=(n,t,i,{defaultWeightWhenUnitEmpty:a=!1,forceWeightBased:o=!1,yieldRate:u=1}={})=>{const d=qs(n),f=qs(t);if(!Number.isFinite(d)||!Number.isFinite(f))return NaN;const h=Number.isFinite(u)&&u>0?u:1,m=String(i||"").trim().toLowerCase();return o||!m&&a||["g","","ml","","cc",""].includes(m)?d/1e3*f/h:d*f/h},XE=(n,t)=>{const i=qs(n?.purchaseCost),a=qs(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},ZE=2,il=Object.freeze({course:"",category:"",storeName:"",servings:"",ingredients:"",ingredientName:"",quantity:"",quantityGram:" (g)",unit:"",purchase:"",cost:"",totalCost:"",instructions:"",sourceRecipe:"",flourGroup:"",otherIngredients:"",scaleMultiplier:"",noSteps:"",print:"",close:""}),Ix=Object.keys(il),ek=({recipe:n,ownerLabel:t,onBack:i,onEdit:a,onDelete:o,onHardDelete:u,isDeleted:d,onView:f,onDuplicate:h,backLabel:m,onList:y})=>{const{user:v}=us(),x=ua(),[b,_]=Ce.useState(!1),[C,j]=Ce.useState(!1),[k,E]=Ce.useState(!1),[D,U]=Ce.useState(new Set),[B,T]=Ce.useState(new Set),[N,O]=Ce.useState(new Set),[L,Y]=Ce.useState({}),[q,V]=Ce.useState("ORIGINAL"),[F,I]=Ce.useState(!1),[P,R]=Ce.useState(!0),[z,K]=Ce.useState(!1),[ue,ye]=Ce.useState(new Map),[$,Q]=Ce.useState({}),[X,fe]=Ce.useState(""),[ke,Ue]=Ce.useState(1),[de,H]=Ce.useState(""),[G,oe]=Ce.useState(""),pe=Ce.useMemo(()=>{const ne=parseFloat(ke);return isNaN(ne)?1:ne},[ke]),je=(ne,ae)=>{if(!ne)return"";const re=parseFloat(ne);if(isNaN(re))return ne;const be=re*parseFloat(ae);return Number.isInteger(be)?be.toString():be.toFixed(1).replace(/\.0$/,"")},Ie=(ne,ae)=>{if(!ne)return"";const re=parseFloat(ne);return isNaN(re)?ne:(re*parseFloat(ae)).toFixed(2).replace(/\.00$/,"")},[Be,Pe]=Ce.useState(n),[lt,rt]=Ce.useState(!1),qe=Be||n,xe=q==="ORIGINAL"?Be:L[q]||Be,_e=q==="ORIGINAL"||q==="JA"?il:$[q]||il,te=ne=>_e[ne]||il[ne]||ne;Ce.useEffect(()=>{let ne=!0;return qn.getAllConversions().then(ae=>{ne&&ye(ae)}).catch(()=>{ne&&ye(new Map)}),()=>{ne=!1}},[]);const We=Ce.useMemo(()=>{const ne=(ae,re={})=>{if(!ae||typeof ae!="object")return ae;const be=YE(ue,ae.name),Me=_b(ae.itemCategory??ae.item_category??be?.itemCategory),Je=QE(ae,be);let Fe=ae;if(Me&&(Fe={...Fe,itemCategory:Me,isAlcohol:jb.has(Me)}),!be||!be.packetSize){const Ye=String(ae.unit||"").trim();if(re.forceWeightBased||re.defaultWeightWhenUnitEmpty&&!Ye){const Gt=Lx(ae.quantity,Fe.purchaseCost,ae.unit,{...re,yieldRate:Je}),cn=Number.isFinite(Gt)?Math.round(Gt*100)/100:NaN,Kn=qs(Fe.cost);if(Number.isFinite(cn)&&(!Number.isFinite(Kn)||Math.abs(Kn-cn)>.01))return{...Fe,cost:cn}}return Fe}const Mt=[be.lastPrice,ae.purchaseCostRef,ae.purchase_cost,ae.purchaseCost].find(Ye=>Number.isFinite(qs(Ye))),xt=JE(Mt,be.packetSize,be.packetUnit);if(!Number.isFinite(xt)||!XE(ae,xt))return Fe;const It=Lx(ae.quantity,xt,ae.unit,{...re,yieldRate:Je});return{...Fe,purchaseCost:Math.round(xt*100)/100,cost:Number.isFinite(It)?Math.round(It*100)/100:Fe.cost}};return{...xe,ingredients:(xe.ingredients||[]).map(ae=>ne(ae)),flours:(xe.flours||[]).map(ae=>ne(ae,{forceWeightBased:!0})),breadIngredients:(xe.breadIngredients||[]).map(ae=>ne(ae,{forceWeightBased:!0}))}},[ue,xe]);Ce.useEffect(()=>{Pe(n),!n.steps&&!d&&(rt(!0),yn.getRecipe(n.id).then(ne=>{Pe(ne)}).catch(ne=>{console.error("Failed to load details",ne)}).finally(()=>{rt(!1)}))},[n,d]);const[Tt,Ct]=Ce.useState(n.tags?.includes("public")||!1),le=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),Oe=!(n.tags&&n.tags.some(ne=>ne.startsWith("owner:")))||le,Ge=async()=>{const ne=!Tt;try{const ae=n.tags||[];let re;ne?re=[...ae,"public"]:re=ae.filter(be=>be!=="public"),Ct(ne),await yn.updateRecipe({id:n.id,tags:re})}catch(ae){console.error("Failed to toggle public",ae),x.error(""),Ct(!ne)}},nt=(ne,ae,re=!1)=>q==="ORIGINAL"||!P||!ae||ne===ae?ne:s.jsxs(s.Fragment,{children:[ne,re?s.jsx("br",{}):" ",s.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",ae,")"]})]}),St=(ne,ae)=>{const re=String(ne??"").trim(),be=String(ae??"").trim();return q==="ORIGINAL"||!P||!be||re===be?re||be:`${re}${be}`},on=ne=>!ne||!Array.isArray(ne.steps)?!1:ne.type==="bread"?Array.isArray(ne.flours)&&Array.isArray(ne.breadIngredients):Array.isArray(ne.ingredients),Tn=(ne,ae)=>!ne||!ae||ne.__translationVersion!==ZE||Array.isArray(ae.steps)&&!Array.isArray(ne.steps)?!1:ae.type==="bread"?!((ae.flours||[]).length>0&&(ne.flours||[]).length===0||(ae.breadIngredients||[]).length>0&&(ne.breadIngredients||[]).length===0):!((ae.ingredients||[]).length>0&&(ne.ingredients||[]).length===0),Jt=async ne=>{const ae=ne.target.value;if(V(ae),ae==="ORIGINAL")return;let re=Be||n;if(!d&&n?.id&&!on(re))try{rt(!0);const Je=await yn.getRecipe(n.id);Je&&(re=Je,Pe(Je))}catch(Je){console.error("Failed to load full recipe for translation",Je)}finally{rt(!1)}const be=L[ae]&&Tn(L[ae],re),Me=ae!=="JA"&&!$[ae];if(!(be&&!Me)){I(!0);try{let Je=null;if(await Promise.all([(async()=>{if(!be)try{const Fe=await vx.translateRecipe(re,ae);Y(Ke=>({...Ke,[ae]:Fe}))}catch(Fe){Je=Fe}})(),(async()=>{if(Me)try{const Fe=await vx.translateList(Ix.map(Mt=>il[Mt]),ae),Ke=Ix.reduce((Mt,xt,It)=>(Mt[xt]=Fe[It]||il[xt],Mt),{});Q(Mt=>({...Mt,[ae]:Ke}))}catch(Fe){console.error("Failed to translate UI labels",Fe)}})()]),Je)throw Je}catch(Je){console.error(Je),x.error(""),V("ORIGINAL")}finally{I(!1)}}},dt=ne=>{U(ae=>{const re=new Set(ae);return re.has(ne)?re.delete(ne):re.add(ne),re})},tn=ne=>{T(ae=>{const re=new Set(ae);return re.has(ne)?re.delete(ne):re.add(ne),re})},qt=ne=>{O(ae=>{const re=new Set(ae);return re.has(ne)?re.delete(ne):re.add(ne),re})};Ce.useEffect(()=>{window.scrollTo(0,0),f&&n&&!d&&f(n.id);const ne=document.title;return n&&n.title&&(document.title=n.title),Y({}),V("ORIGINAL"),U(new Set),T(new Set),O(new Set),Ct(n.tags?.includes("public")||!1),()=>{document.title=ne}},[n.id,n.title]),Ce.useEffect(()=>{n&&n.servings?oe(n.servings.toString()):oe(""),H("")},[n]);const ir=()=>{_(!0)},xr=()=>{_(!1),o(n)},jn=()=>{_(!1)},ve=()=>{E(!0)},st=()=>{E(!1),u(n)},Ze=()=>{E(!1)},tt=()=>{j(!0)},vt=async()=>{j(!1);try{const ne=await yn.duplicateRecipe(n,v);h&&h(ne)}catch(ne){console.error("Duplication failed",ne),x.error("")}},At=()=>{j(!1)},Et=Ce.useRef(null),Lt=Ce.useRef(null),ht=ne=>{Lt.current=null,Et.current=ne.targetTouches[0].clientX},Pt=ne=>{Lt.current=ne.targetTouches[0].clientX},Nt=()=>{if(!Et.current||!Lt.current)return;const ne=Et.current-Lt.current,ae=Et.current<50,re=ne<-100;ae&&re&&i()},Xt=ne=>{const ae=Math.round(parseFloat(ne)),re=parseFloat(de),be=parseFloat(G);let Me=null,Je=null,Fe=null;return!isNaN(ae)&&!isNaN(be)&&be>0&&(Fe=ae/be),!isNaN(ae)&&!isNaN(re)&&!isNaN(be)&&re>0&&be>0&&(Je=re*be,Me=ae/Je*100),s.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[s.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("span",{children:["  ",s.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),s.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[s.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),s.jsx("input",{type:"number",value:de,onChange:Ke=>H(Ke.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[s.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),s.jsx("input",{type:"number",value:G,onChange:Ke=>oe(Ke.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Fe!==null&&s.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Me!==null?Me>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Me!==null?Me>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Me!==null?"6px":"0"},children:["1(): ",s.jsxs("strong",{children:["",Fe.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Me!==null&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",Je.toLocaleString()]}),s.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(Je-ae).toLocaleString()]}),s.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Me>40?"#d32f2f":"#2e7d32"},children:[": ",Me.toFixed(1),"%"]})]})]})]})]})},mt=We.ingredients||[];let Zt=xe.steps||[];const Rt=ne=>String(ne||"").trim().toLowerCase(),en=ne=>{const ae=Rt(ne);return ae?["","","steps","method"].some(re=>ae===re||ae.includes(re)):!1};if(!Zt.length&&xe.ingredientGroups){const ne=xe.ingredientGroups.find(ae=>en(ae.name));if(ne)Zt=mt.filter(re=>re.groupId===ne.id).map(re=>typeof re=="string"?re:{...re,text:re.name||re.text||""});else{const ae=mt.filter(re=>en(re.group)||en(re.groupName));ae.length&&(Zt=ae.map(re=>typeof re=="string"?re:{...re,text:re.name||re.text||""}))}}const un=Zt,ce=Ce.useMemo(()=>{const ne=xe.ingredientGroups||[],ae=["","steps","method",""],re=Ke=>String(Ke||"").trim().toLowerCase(),be=new Set(ne.filter(Ke=>ae.includes(re(Ke.name))).map(Ke=>Ke.id)),Me=ne.filter(Ke=>!be.has(Ke.id));if(!Me.length)return[{id:"default",name:null,items:mt.filter(Ke=>!be.has(Ke.groupId))}];const Je=Me.map(Ke=>{const Mt=mt.filter(xt=>xt.groupId===Ke.id);return{id:Ke.id,name:Ke.name===""?null:Ke.name,items:Mt}}).filter(Ke=>Ke.items.length>0),Fe=mt.filter(Ke=>Ke.groupId?be.has(Ke.groupId)?!1:!Me.some(Mt=>Mt.id===Ke.groupId):!0);return Fe.length&&Je.push({id:"ungrouped",name:null,items:Fe}),Je.length?Je:[{id:"default",name:null,items:mt.filter(Ke=>!be.has(Ke.groupId))}]},[xe.ingredientGroups,mt]),Le=Ce.useMemo(()=>{if(xe.type!=="bread")return null;const ne=We.flours||[],ae=We.breadIngredients||[],re=ne.reduce((Ye,bt)=>Ye+(parseFloat(bt.quantity)||0),0),be=re+ae.reduce((Ye,bt)=>Ye+(parseFloat(bt.quantity)||0),0),Me=parseFloat(X),Je=Me&&be?Me/be:1,Fe=Ye=>re?((parseFloat(Ye)||0)/re*100).toFixed(1):"0.0",Ke=Ye=>Me?((parseFloat(Ye)||0)*Je).toFixed(1):Ye,Mt=Ye=>{const bt=parseFloat(Ye)||0;if(!Me)return bt;const Gt=bt*Je;return Math.round(Gt*100)/100},xt=Ye=>{const bt=Mt(Ye);return Number.isFinite(bt)?bt.toLocaleString(void 0,{maximumFractionDigits:2}):""},It=Ye=>Ye.reduce((bt,Gt)=>{const Kn=(parseFloat(Gt.cost)||0)*(Me?Je:1),br=Wi(Gt);return bt+Kn*br},0);return{flours:ne,others:ae,totalFlour:re,grandTotal:be,calcPercent:Fe,getScaledQtyValue:Ke,getScaledCostValue:Mt,formatCostValue:xt,scaleFactor:Je,totalTaxIncluded:It(ne)+It(ae)}},[We.breadIngredients,We.flours,xe.type,X]),He=Ce.useMemo(()=>xe.type==="bread"?0:mt.reduce((ne,ae)=>{const be=(parseFloat(ae.cost)||0)*pe,Me=Wi(ae);return ne+be*Me},0),[xe.type,mt,pe]),pt=xe.type==="bread"?Le?Math.round(Le.totalTaxIncluded).toLocaleString():"0":Math.round(He).toLocaleString(),Dt=xe.description||qe.description;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:ht,onTouchMove:Pt,onTouchEnd:Nt,children:[C&&s.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(an,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[s.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),s.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(se,{variant:"ghost",onClick:At,children:""}),s.jsx(se,{variant:"primary",onClick:vt,children:""})]})]})}),k&&s.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(an,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[s.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),s.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",s.jsx("br",{}),""]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(se,{variant:"ghost",onClick:Ze,children:""}),s.jsx(se,{variant:"danger",onClick:st,children:""})]})]})}),b&&s.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(an,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[s.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),s.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",s.jsx("br",{}),s.jsx("small",{style:{color:"#666"},children:""})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(se,{variant:"ghost",onClick:jn,children:""}),s.jsx(se,{variant:"danger",onClick:xr,children:""})]})]})}),s.jsxs("div",{className:"recipe-detail__header",children:[s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsx(se,{variant:"secondary",onClick:i,size:"sm",children:m||" "}),y&&s.jsx(se,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&s.jsxs("div",{className:"recipe-detail__actions",children:[Oe&&(v?.displayId==="yoshito"||v?.role==="admin")&&s.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:s.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:Tt,onChange:Ge,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),s.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:Tt?"#4CAF50":"#888"},children:Tt?"":""})]})}),!Oe&&s.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),s.jsxs("select",{className:"language-select",value:q,onChange:Jt,disabled:F,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[s.jsx("option",{value:"ORIGINAL",children:" Original ()"}),zE.map(ne=>s.jsx("option",{value:ne.code,children:ne.label},ne.code))]}),q!=="ORIGINAL"&&s.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[s.jsx("input",{type:"checkbox",checked:P,onChange:ne=>R(ne.target.checked),style:{marginRight:"4px"}}),""]}),s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>K(!0),children:" "}),s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),s.jsx(se,{variant:"secondary",size:"sm",onClick:tt,children:""}),Oe&&s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",size:"sm",onClick:a,children:""}),s.jsx(se,{variant:"danger",size:"sm",onClick:ir,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&s.jsxs("div",{className:"recipe-detail__actions",children:[s.jsx(se,{variant:"ghost",size:"sm",onClick:ve,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),s.jsx(se,{variant:"primary",size:"sm",onClick:()=>o(n,!0),children:""})]})]}),s.jsx("div",{className:"recipe-detail__hero",children:xe.image?s.jsx("img",{src:xe.image,alt:xe.title,className:"recipe-detail__image"}):s.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),s.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[s.jsx("h1",{children:nt(xe.title,qe.title)}),s.jsx("p",{className:"recipe-detail__desc",children:nt(xe.description,qe.description,!0)}),v?.role==="admin"&&t&&s.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),s.jsxs("div",{className:"recipe-detail__meta",children:[xe.course&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("course")}),s.jsx("span",{className:"meta-value",children:nt(xe.course,qe.course)})]}),xe.category&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("category")}),s.jsx("span",{className:"meta-value",children:nt(xe.category,qe.category)})]}),xe.storeName&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("storeName")}),s.jsx("span",{className:"meta-value",children:nt(xe.storeName,qe.storeName)})]}),s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("servings")}),s.jsxs("span",{className:"meta-value",children:[xe.servings,""]})]})]}),xe.sourceUrl&&s.jsxs("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[s.jsx("div",{style:{fontSize:"0.85rem"},children:s.jsxs("a",{href:xe.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",s.jsx("span",{className:"screen-only",children:te("sourceRecipe")}),s.jsx("span",{className:"print-only",children:te("sourceRecipe")})]})}),s.jsx("div",{style:{background:"white",padding:"4px",width:"fit-content"},children:s.jsx(Mx,{value:xe.sourceUrl,size:128,style:{display:"block"}})})]})]}),s.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[s.jsxs("span",{children:[" : ",zx(n.created_at)]}),n.updated_at&&s.jsxs("span",{children:[" : ",zx(n.updated_at)]})]}),s.jsx("div",{className:"recipe-detail__content",children:s.jsxs("div",{className:"recipe-detail__main",children:[s.jsxs("section",{className:"detail-section",children:[s.jsx("h2",{children:te("ingredients")}),s.jsx(an,{className:"ingredients-card",children:xe.type==="bread"?s.jsx("div",{className:"bread-detail-view",children:(()=>{const ne=We.flours||[],ae=We.breadIngredients||[],re=ne.reduce((Ye,bt)=>Ye+(parseFloat(bt.quantity)||0),0),be=re+ae.reduce((Ye,bt)=>Ye+(parseFloat(bt.quantity)||0),0),Me=re?(be/re*100).toFixed(1):"0.0",Je=Ye=>re?((parseFloat(Ye)||0)/re*100).toFixed(1):"0.0",Fe=parseFloat(X),Ke=Fe&&be?Fe/be:1,Mt=Ye=>Fe?((parseFloat(Ye)||0)*Ke).toFixed(1):Ye,xt=Ye=>{const bt=parseFloat(Ye)||0;if(!Fe)return bt;const Gt=bt*Ke;return Math.round(Gt*100)/100},It=Ye=>Number.isFinite(Ye)?Ye.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),s.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[be.toLocaleString(),"g"]}),s.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Me,"%)"]})]}),s.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx("input",{id:"target-total-input",type:"number",value:X,onChange:Ye=>fe(Ye.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),s.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),X&&s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>fe(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),X&&s.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",Ke.toFixed(3)," "]})]}),s.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[s.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[s.jsx("span",{children:te("flourGroup")}),s.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",X?Mt(re):re,"g (100%)"]})]}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantityGram")}),s.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("purchase")}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("cost")})]})}),s.jsx("tbody",{children:ne.map((Ye,bt)=>{const Gt=qe.flours?.[bt]||{};return s.jsxs("tr",{children:[s.jsx("td",{children:s.jsxs("div",{className:"ingredient-name",children:[s.jsx("input",{type:"checkbox",id:`flour-${bt}`}),s.jsx("label",{htmlFor:`flour-${bt}`,children:nt(Ye.name,Gt?.name)})]})}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:X?s.jsx("span",{style:{color:"var(--color-primary)"},children:Mt(Ye.quantity)}):Ye.quantity}),s.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[Je(Ye.quantity),"%"]}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ms(Ye.purchaseCost)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:Ye.cost?`${It(xt(Ye.cost))}`:"-"})]},bt)})})]})]}),s.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[s.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:te("otherIngredients")}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantityGram")}),s.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("purchase")}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("cost")})]})}),s.jsx("tbody",{children:ae.map((Ye,bt)=>{const Gt=qe.breadIngredients?.[bt]||{};return s.jsxs("tr",{children:[s.jsx("td",{children:s.jsxs("div",{className:"ingredient-name",children:[s.jsx("input",{type:"checkbox",id:`ingredient-${bt}`}),s.jsx("label",{htmlFor:`ingredient-${bt}`,children:nt(Ye.name,Gt?.name)})]})}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:X?s.jsx("span",{style:{color:"var(--color-primary)"},children:Mt(Ye.quantity)}):Ye.quantity}),s.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[Je(Ye.quantity),"%"]}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ms(Ye.purchaseCost)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:Ye.cost?`${It(xt(Ye.cost))}`:"-"})]},bt)})})]}),s.jsxs("div",{className:"cost-summary",children:[s.jsxs("span",{className:"cost-summary__label",children:[te("totalCost"),":"]}),s.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const Ye=Gt=>Gt.reduce((cn,Kn)=>{const br=parseFloat(Kn.cost)||0,Wr=Wi(Kn),Dr=br*Ke;return cn+Dr*Wr},0),bt=Ye(ne)+Ye(ae);return Math.round(bt).toLocaleString()})()]}),s.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const Ye=Gt=>Gt.reduce((cn,Kn)=>{const br=parseFloat(Kn.cost)||0,Wr=Wi(Kn),Dr=br*Ke;return cn+Dr*Wr},0),bt=Ye(ne)+Ye(ae);return Xt(bt)})()]})]})})()}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[s.jsxs("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:[te("scaleMultiplier"),":"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),s.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:ke,onChange:ne=>Ue(ne.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(ke)!==1&&s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>Ue("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const ne=xe.ingredientGroups&&xe.ingredientGroups.length>0?xe.ingredientGroups:null;return ne?ne.map(ae=>{const re=mt.filter(be=>be.groupId===ae.id);return re.length===0||["","Steps","Method",""].includes(ae.name)?null:s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(ae.name)?"none":"block"},children:ae.name}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40%"},children:te("ingredientName")}),s.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:te("quantity")}),s.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:te("unit")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("purchase")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("cost")})]})}),s.jsx("tbody",{children:re.map((be,Me)=>{const Je=mt.indexOf(be),Fe=qe.ingredients?.[Je],Ke=typeof be=="string"?be:be.name,Mt=Fe?typeof Fe=="string"?Fe:Fe.name:"",xt=typeof be=="object"?be.unit:"",It=Fe&&typeof Fe=="object"?Fe.unit:"",Ye=je(be.quantity,ke),bt=Ie(be.cost,ke),Gt=String(ke)!=="1";return s.jsxs("tr",{className:"ingredient-row",children:[s.jsx("td",{children:s.jsxs("div",{className:"ingredient-name",children:[s.jsx("input",{type:"checkbox",id:`ing-${ae.id}-${Me}`}),s.jsx("label",{htmlFor:`ing-${ae.id}-${Me}`,children:nt(Ke,Mt)})]})}),s.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Gt?"bold":"normal",color:Gt?"var(--color-primary)":"inherit"},children:Ye}),s.jsx("td",{style:{paddingLeft:"0.5rem"},children:nt(xt,It)}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ms(be.purchaseCost)??"-"}),s.jsxs("td",{style:{textAlign:"right"},children:[ms(bt)??"-",fp(be)&&s.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Me)})})]})]},ae.id)}):s.jsxs(s.Fragment,{children:[s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40%"},children:te("ingredientName")}),s.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:te("quantity")}),s.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:te("unit")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("purchase")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("cost")})]})}),s.jsx("tbody",{children:mt.map((ae,re)=>{const be=qe.ingredients?.[re],Me=typeof ae=="string"?ae:ae.name,Je=be?typeof be=="string"?be:be.name:"",Fe=typeof ae=="object"?ae.unit:"",Ke=be&&typeof be=="object"?be.unit:"",Mt=je(ae.quantity,ke),xt=Ie(ae.cost,ke),It=String(ke)!=="1";return s.jsxs("tr",{className:"ingredient-row",children:[s.jsx("td",{children:s.jsxs("div",{className:"ingredient-name",children:[s.jsx("input",{type:"checkbox",id:`ing-${re}`}),s.jsx("label",{htmlFor:`ing-${re}`,children:nt(Me,Je)})]})}),s.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:It?"bold":"normal",color:It?"var(--color-primary)":"inherit"},children:Mt}),s.jsx("td",{style:{paddingLeft:"0.5rem"},children:nt(Fe,Ke)}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ms(ae.purchaseCost)??"-"}),s.jsxs("td",{style:{textAlign:"right"},children:[ms(xt)??"-",fp(ae)&&s.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},re)})})]}),s.jsxs("div",{className:"cost-summary",children:[s.jsxs("span",{className:"cost-summary__label",children:[te("totalCost"),":"]}),s.jsxs("span",{className:"cost-summary__value",children:["",Math.round((re=>re.reduce((be,Me)=>{const Je=parseFloat(Me.cost)||0,Fe=Wi(Me),Ke=Ie(Je,ke),Mt=parseFloat(Ke)||0;return be+Mt*Fe},0))(mt)).toLocaleString()]})]})]})})(),s.jsx("div",{className:"screen-only no-print",children:s.jsxs("div",{className:"cost-summary",children:[s.jsxs("span",{className:"cost-summary__label",children:[te("totalCost"),":"]}),s.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ae=>ae.reduce((re,be)=>{const Me=parseFloat(be.cost)||0,Je=Wi(be),Fe=Ie(Me,ke),Ke=parseFloat(Fe)||0;return re+Ke*Je},0))(mt)).toLocaleString()]}),s.jsx("span",{className:"cost-summary__note",children:"()"})]})}),s.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const ae=(re=>re.reduce((be,Me)=>{const Je=parseFloat(Me.cost)||0,Fe=Wi(Me),Ke=parseFloat(Ie(Je,ke))||0;return be+Ke*Fe},0))(mt);return Xt(ae)})()]})})]}),s.jsxs("section",{className:"detail-section",children:[s.jsx("h2",{children:te("instructions")}),(()=>{const ne=xe.stepGroups&&xe.stepGroups.length>0?xe.stepGroups:null,ae=ne&&un.some(re=>!re||typeof re!="object"||!re.groupId?!1:ne.some(be=>be.id===re.groupId));return ne&&ae?s.jsx("div",{className:"steps-container",children:ne.map(re=>{const be=un.filter(Me=>(typeof Me=="object"?Me.groupId:null)===re.id);return be.length===0?null:s.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[re.name!==""&&re.name!=="Steps"&&s.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:re.name}),s.jsx("div",{className:"steps-list",children:be.map((Me,Je)=>{const Fe=un.indexOf(Me),Ke=typeof Me=="object"?Me.text:Me,Mt=qe.steps?.[Fe],xt=typeof Mt=="object"?Mt.text:Mt,It=Ye=>Ye?Ye.replace(/<[^>]*>?/gm,""):"";return s.jsxs(an,{className:`step-card ${D.has(Fe)?"is-completed":""}`,onClick:()=>dt(Fe),children:[s.jsx("div",{className:"step-number",children:Fe+1}),s.jsx("p",{className:"step-text",children:nt(It(Ke),It(xt),!0)})]},Je)})})]},re.id)})}):s.jsx("div",{className:"steps-list",children:un.map((re,be)=>{const Me=typeof re=="object"?re.text:re,Je=qe.steps?.[be],Fe=typeof Je=="object"?Je.text:Je;return s.jsxs(an,{className:`step-card ${D.has(be)?"is-completed":""}`,onClick:()=>dt(be),children:[s.jsx("div",{className:"step-number",children:be+1}),s.jsx("p",{className:"step-text",children:nt(Me,Fe,!0)})]},be)})})})()]})]})}),s.jsx(xn,{isOpen:z,onClose:()=>K(!1),title:" ",size:"large",children:s.jsxs("div",{className:"print-preview-recipe",children:[s.jsx("div",{className:"preview-header",children:s.jsx("h2",{children:xe.title})}),s.jsxs("div",{className:"preview-meta",children:[xe.course&&s.jsxs("div",{children:[s.jsx("strong",{children:":"})," ",xe.course]}),xe.category&&s.jsxs("div",{children:[s.jsx("strong",{children:":"})," ",xe.category]}),xe.storeName&&s.jsxs("div",{children:[s.jsx("strong",{children:":"})," ",xe.storeName]}),xe.servings&&s.jsxs("div",{children:[s.jsx("strong",{children:":"})," ",xe.servings,""]})]}),xe.description&&s.jsx("div",{className:"preview-description",children:s.jsx("p",{children:xe.description})}),s.jsx("div",{className:"preview-controls",children:xe.type==="bread"?s.jsxs("div",{className:"preview-control-row",children:[s.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),s.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:X,onChange:ne=>fe(ne.target.value),placeholder:"1000"}),X&&s.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>fe(""),children:""}),Le?.grandTotal?s.jsxs("span",{className:"preview-control-note",children:[": ",Le.grandTotal.toLocaleString(),"g"]}):null]}):s.jsxs("div",{className:"preview-control-row",children:[s.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:te("scaleMultiplier")}),s.jsx("span",{className:"preview-control-mult",children:""}),s.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:ke,onChange:ne=>Ue(ne.target.value),placeholder:"1"}),String(ke)!=="1"&&s.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>Ue("1"),children:""})]})}),s.jsxs("div",{className:"preview-section",children:[s.jsx("h3",{children:te("ingredients")}),xe.type==="bread"?s.jsxs("div",{className:"preview-ingredients-bread",children:[s.jsxs("div",{className:"bread-group",children:[s.jsx("h4",{children:te("flourGroup")}),s.jsxs("table",{className:"preview-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantity")})]})}),s.jsx("tbody",{children:(We.flours||[]).map((ne,ae)=>{const re=`flour-${ae}`,be=Le?Le.getScaledQtyValue(ne.quantity):ne.quantity;return s.jsxs("tr",{className:N.has(re)?"is-completed":"",onClick:()=>qt(re),role:"button",tabIndex:0,onKeyDown:Me=>{(Me.key==="Enter"||Me.key===" ")&&(Me.preventDefault(),qt(re))},children:[s.jsx("td",{children:ne.name}),s.jsxs("td",{style:{textAlign:"right"},children:[be,"g"]})]},ae)})})]})]}),s.jsxs("div",{className:"bread-group",children:[s.jsx("h4",{children:te("otherIngredients")}),s.jsxs("table",{className:"preview-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantity")})]})}),s.jsx("tbody",{children:(We.breadIngredients||[]).map((ne,ae)=>{const re=`bread-${ae}`,be=Le?Le.getScaledQtyValue(ne.quantity):ne.quantity;return s.jsxs("tr",{className:N.has(re)?"is-completed":"",onClick:()=>qt(re),role:"button",tabIndex:0,onKeyDown:Me=>{(Me.key==="Enter"||Me.key===" ")&&(Me.preventDefault(),qt(re))},children:[s.jsx("td",{children:ne.name}),s.jsxs("td",{style:{textAlign:"right"},children:[be,"g"]})]},ae)})})]})]})]}):s.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const ne=xe.ingredientGroups&&xe.ingredientGroups.length>0?xe.ingredientGroups:null;return ne?ne.map(ae=>{const re=mt.filter(be=>be.groupId===ae.id);return re.length===0||["","Steps","Method",""].includes(ae.name)?null:s.jsxs("div",{className:"ingredient-group",children:[s.jsx("h4",{children:ae.name}),s.jsxs("table",{className:"preview-table preview-table--normal",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantity")}),s.jsx("th",{children:te("unit")})]})}),s.jsx("tbody",{children:re.map((be,Me)=>{const Je=`${ae.id}-${Me}`,Fe=typeof be=="string"?be:be.name,Ke=typeof be=="object"?je(be.quantity,pe):"",Mt=typeof be=="object"?be.unit:"";return s.jsxs("tr",{className:N.has(Je)?"is-completed":"",onClick:()=>qt(Je),role:"button",tabIndex:0,onKeyDown:xt=>{(xt.key==="Enter"||xt.key===" ")&&(xt.preventDefault(),qt(Je))},children:[s.jsx("td",{children:Fe}),s.jsx("td",{style:{textAlign:"right"},children:Ke}),s.jsx("td",{children:Mt})]},Me)})})]})]},ae.id)}):s.jsxs("table",{className:"preview-table preview-table--normal",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantity")}),s.jsx("th",{children:te("unit")})]})}),s.jsx("tbody",{children:mt.map((ae,re)=>{const be=`ungrouped-${re}`,Me=typeof ae=="string"?ae:ae.name,Je=typeof ae=="object"?je(ae.quantity,pe):"",Fe=typeof ae=="object"?ae.unit:"";return s.jsxs("tr",{className:N.has(be)?"is-completed":"",onClick:()=>qt(be),role:"button",tabIndex:0,onKeyDown:Ke=>{(Ke.key==="Enter"||Ke.key===" ")&&(Ke.preventDefault(),qt(be))},children:[s.jsx("td",{children:Me}),s.jsx("td",{style:{textAlign:"right"},children:Je}),s.jsx("td",{children:Fe})]},re)})})]})})()})]}),un.length>0&&s.jsxs("div",{className:"preview-section",children:[s.jsx("h3",{children:te("instructions")}),s.jsx("ol",{className:"preview-steps",children:un.map((ne,ae)=>{const re=typeof ne=="object"?ne.text:ne;return s.jsx("li",{className:B.has(ae)?"is-completed":"",onClick:()=>tn(ae),role:"button",tabIndex:0,onKeyDown:be=>{(be.key==="Enter"||be.key===" ")&&(be.preventDefault(),tn(ae))},children:re},ae)})})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsxs(se,{variant:"primary",onClick:()=>window.print(),children:[" ",te("print")]}),s.jsx(se,{variant:"ghost",onClick:()=>K(!1),children:te("close")})]})]})})]}),s.jsxs("div",{className:"print-layout",children:[s.jsx("div",{className:"recipe-detail__hero",children:xe.image?s.jsx("img",{src:xe.image,alt:xe.title,className:"recipe-detail__image"}):s.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),s.jsxs("div",{className:"recipe-detail__title-card",children:[s.jsx("h1",{children:St(xe.title,qe.title)}),Dt&&s.jsx("p",{className:"recipe-detail__desc",children:St(Dt,qe.description)})]}),s.jsxs("div",{className:"recipe-detail__meta",children:[xe.category&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("category")}),s.jsx("span",{className:"meta-value",children:St(xe.category,qe.category)})]}),xe.storeName&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("storeName")}),s.jsx("span",{className:"meta-value meta-value--store",children:St(xe.storeName,qe.storeName)})]}),xe.course&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("course")}),s.jsx("span",{className:"meta-value",children:St(xe.course,qe.course)})]}),xe.servings&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("servings")}),s.jsx("span",{className:"meta-value",children:St(`${xe.servings}`,qe.servings?`${qe.servings}`:"")})]})]}),xe.sourceUrl&&s.jsxs("div",{className:"print-layout__source",children:[s.jsx("div",{className:"print-layout__source-label",children:te("sourceRecipe")}),s.jsx("div",{className:"print-layout__source-qr",children:s.jsx(Mx,{value:xe.sourceUrl,size:84,style:{display:"block"}})})]}),s.jsxs("div",{className:"recipe-detail__main",children:[s.jsxs("section",{className:"detail-section",children:[s.jsx("h2",{children:te("ingredients")}),xe.type==="bread"&&Le?s.jsxs("div",{children:[s.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:te("flourGroup")}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantityGram")}),s.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("purchase")}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("cost")})]})}),s.jsx("tbody",{children:Le.flours.map((ne,ae)=>{const re=qe.flours?.[ae]||{},be=Le.getScaledQtyValue(ne.quantity),Me=X?"":re.quantity;return s.jsxs("tr",{children:[s.jsx("td",{children:St(ne.name,re.name)}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:St(be,Me)}),s.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[Le.calcPercent(ne.quantity),"%"]}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ms(ne.purchaseCost)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:ne.cost?`${Le.formatCostValue(ne.cost)}`:"-"})]},`print-flour-${ae}`)})})]})]}),s.jsxs("div",{className:"bread-section",children:[s.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:te("otherIngredients")}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantityGram")}),s.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("purchase")}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("cost")})]})}),s.jsx("tbody",{children:Le.others.map((ne,ae)=>{const re=qe.breadIngredients?.[ae]||{},be=Le.getScaledQtyValue(ne.quantity),Me=X?"":re.quantity;return s.jsxs("tr",{children:[s.jsx("td",{children:St(ne.name,re.name)}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:St(be,Me)}),s.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[Le.calcPercent(ne.quantity),"%"]}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ms(ne.purchaseCost)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:ne.cost?`${Le.formatCostValue(ne.cost)}`:"-"})]},`print-others-${ae}`)})})]})]})]}):ce.map(ne=>{const ae=qe.ingredientGroups?.find(re=>re.id===ne.id)?.name||"";return s.jsxs("div",{style:{marginBottom:"1.2rem"},children:[ne.name&&s.jsx("div",{className:"print-group-heading",children:St(ne.name,ae)}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40%"},children:te("ingredientName")}),s.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:te("quantity")}),s.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:te("unit")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("purchase")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("cost")})]})}),s.jsx("tbody",{children:ne.items.map((re,be)=>{const Me=typeof re=="object"?re.quantity:"",Je=typeof re=="object"?re.unit:"",Fe=typeof re=="object"?re.purchaseCost:null,Ke=typeof re=="object"?re.cost:null,Mt=typeof re=="string"?re:re.name,xt=typeof re=="object"?je(re.quantity,pe):Me,It=mt.indexOf(re),Ye=qe.ingredients?.[It],bt=Ye?typeof Ye=="string"?Ye:Ye.name:"",Gt=Ye&&typeof Ye=="object"?Ye.unit:"",cn=String(pe)==="1"&&Ye&&typeof Ye=="object"?Ye.quantity:"";return s.jsxs("tr",{children:[s.jsx("td",{children:St(Mt,bt)}),s.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:St(xt,cn)}),s.jsx("td",{style:{paddingLeft:"0.5rem"},children:St(Je,Gt)}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ms(Fe)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:ms(Ke)??"-"})]},`print-ing-${ne.id}-${be}`)})})]})]},ne.id)}),s.jsxs("div",{className:"cost-summary",children:[s.jsxs("span",{className:"cost-summary__label",children:[te("totalCost"),":"]}),s.jsxs("span",{className:"cost-summary__value",children:["",pt]}),s.jsx("span",{className:"cost-summary__note",children:"()"})]}),s.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),s.jsxs("section",{className:"detail-section",children:[s.jsx("h2",{children:te("instructions")}),un.length>0?s.jsx("div",{className:"steps-list",children:un.map((ne,ae)=>{const re=typeof ne=="object"?ne.text:ne,be=qe.steps?.[ae],Me=typeof be=="object"?be?.text:be;return s.jsxs("div",{className:"step-card",children:[s.jsx("div",{className:"step-number",children:ae+1}),s.jsx("p",{className:"step-text",children:St(re,Me)})]},`print-step-${ae}`)})}):s.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:te("noSteps")})]})]})]})]})},Cb=n=>{if(n==null)return"";let t=String(n);return t=t.replace(/[-]/g,i=>String.fromCharCode(i.charCodeAt(0)-65248)),t=t.replace(/[--]/g,i=>String.fromCharCode(i.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},kt=({label:n,id:t,error:i,textarea:a,...o})=>{const u=a?"textarea":"input",d=o.type==="number"||o.inputMode==="decimal"||o.inputMode==="numeric",f=h=>{if(!o.onChange)return;if(!d){o.onChange(h);return}const m=h?.target?.value??"",y=Cb(m);if(y===m){o.onChange(h);return}o.onChange({target:{id:h?.target?.id,name:h?.target?.name,value:y}})};return s.jsxs("div",{className:`input-group ${i?"input-group--error":""} ${o.wrapperClassName||""}`,children:[n&&s.jsx("label",{htmlFor:t,className:"input-label",children:n}),s.jsx(u,{id:t,className:`input-field ${o.className||""}`,style:o.style,...o,onChange:f}),i&&s.jsx("span",{className:"input-error",children:i})]})},gs="app-data",sr={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const i=String(t||"").replace(/^\/+/,"");return`${n}/${i}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:i}=await Re.storage.from(gs).list(n);if(i)return console.warn("Failed to list price files:",i.message),[];if(!t||t.length===0)return[];const a=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:f,error:h}=await Re.storage.from(gs).download(d);if(h)return console.error(`Failed to download ${u.name}:`,h),null;const m=await f.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(m)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(m)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(a)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const i=this._cacheByUserId.get(t);if(i)return i;try{const a=new Map,o=await this._downloadAllCsvTexts(t);if(!o||o.length===0)return new Map;for(const{text:u}of o){if(!u)continue;const d=this.parseCSV(u);for(const[f,h]of d)if(a.has(f)){const m=a.get(f);(h?.dateStr||"")>(m?.dateStr||"")&&a.set(f,h)}else a.set(f,h)}return this._cacheByUserId.set(t,a),a}catch(a){return console.error("Error in fetchPriceList:",a),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:i,error:a}=await Re.storage.from(gs).list(t);if(a)throw a;return i.filter(o=>String(o?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=n.name;this.clearCache(i);const o=this._getUserScopedPath(i,a),{data:u,error:d}=await Re.storage.from(gs).upload(o,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(i){return console.error("Error uploading price list:",i),{success:!1,error:i}}},async deletePriceFile(n,t=null){try{const i=t||await this._getCurrentUserId();if(!i)throw new Error("");this.clearCache(i);const a=this._getUserScopedPath(i,n),{data:o,error:u}=await Re.storage.from(gs).remove([a]);if(u)throw u;if(!o||o.length===0)throw new Error("");return{success:!0,data:o}}catch(i){return console.error("Error deleting price file:",i),{success:!1,error:i}}},_splitFileName(n){const t=String(n||""),i=t.lastIndexOf(".");return i<=0?{base:t,ext:""}:{base:t.slice(0,i),ext:t.slice(i)}},_makeCopyFileName(n,t){const i=String(n||"");if(!t?.has?.(i))return i;const{base:a,ext:o}=this._splitFileName(i),u=a||i||"price";let d=1;for(;d<1e3;){const f=d===1?"_copy":`_copy${d}`,h=`${u}${f}${o}`;if(!t.has(h))return h;d++}return`${u}_copy_${Date.now()}${o}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:t=null,onProgress:i=null}={}){const a=t||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("");if(o===a)throw new Error("");const{data:u,error:d}=await Re.storage.from(gs).list(a);if(d)throw d;const f=(u||[]).map(b=>b?.name).filter(Boolean).filter(b=>String(b).toLowerCase().endsWith(".csv")),{data:h,error:m}=await Re.storage.from(gs).list(o);let y=new Set;if(m){const b=String(m?.message||"").toLowerCase();if(b.includes("not found")||b.includes("404"))y=new Set;else throw m}else y=new Set((h||[]).map(b=>b?.name).filter(Boolean));const v={sourceUserId:a,targetUserId:o,copied:[],skipped:[],failed:[]},x=f.length;i?.({phase:"start",total:x,done:0,current:""});for(let b=0;b<f.length;b++){const _=f[b],C=this._makeCopyFileName(_,y);y.add(C);const j=this._getUserScopedPath(a,_),k=this._getUserScopedPath(o,C);i?.({phase:"progress",total:x,done:b,current:`${_}  ${C}`,fromFile:_,toFile:C});try{const{data:E,error:D}=await Re.storage.from(gs).download(j);if(D)throw D;if(!E)throw new Error("");const{error:U}=await Re.storage.from(gs).upload(k,E,{upsert:!1,contentType:"text/csv"});if(U){const B=String(U?.message||"").toLowerCase();if(B.includes("already exists")||B.includes("exists")||B.includes("409")){let T=0,N=U;for(;T<5;){T++;const O=this._makeCopyFileName(_,y);y.add(O);const L=this._getUserScopedPath(o,O),{error:Y}=await Re.storage.from(gs).upload(L,E,{upsert:!1,contentType:"text/csv"});if(!Y){v.copied.push({fromFile:_,toFile:O}),N=null;break}N=Y}if(N)throw N;continue}throw U}v.copied.push({fromFile:_,toFile:C})}catch(E){console.error("copyPriceFilesToUser failed:",E),v.failed.push({file:_,errorMessage:String(E?.message||E)})}i?.({phase:"progress",total:x,done:b+1,current:`${_}  ${C}`,fromFile:_,toFile:C})}return i?.({phase:"done",total:x,done:x,current:"",result:v}),this.clearCache(o),v},parseCSV(n){const t=new Map,i=n.split(/\r?\n/).filter(o=>o.trim());if(i.length===0)return t;if(i.some(o=>o.startsWith("D,")||o.startsWith('"D",')))for(let o of i){const u=[];let d="",f=!1;for(let j=0;j<o.length;j++){const k=o[j];k==='"'?f=!f:k===","&&!f?(u.push(d),d=""):d+=k}u.push(d);const h=u.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j));if(h[0]!=="D")continue;const m=h[1],y=h[8],v=h[14],x=h[18],b=h[20],_=String(v??"").trim(),C=ln(_);if(C&&x){const j=parseFloat(x);if(!isNaN(j)){const k={price:j,vendor:y,unit:b,dateStr:m,displayName:_};if(t.has(C)){const E=t.get(C);(m||"")>=(E?.dateStr||"")&&t.set(C,k)}else t.set(C,k)}}}else{let o={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(i[0].split(",").map(h=>h.trim().replace(/^"|"$/g,"")).forEach((h,m)=>{["","","","","name","item"].some(y=>h.includes(y))&&(o.name=m),["","","","","price","cost"].some(y=>h.includes(y))&&(o.price=m),["","unit"].some(y=>h.includes(y))&&(o.unit=m),["","","","vendor","supplier"].some(y=>h.includes(y))&&(o.vendor=m)}),o.name===-1&&o.price===-1){o={name:0,price:1,unit:2,vendor:3};const h=i[0].split(",");isNaN(parseFloat(h[1]))&&(u=1)}else u=1;const f=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let h=u;h<i.length;h++){const m=i[h],y=[];let v="",x=!1;for(let U=0;U<m.length;U++){const B=m[U];B==='"'?x=!x:B===","&&!x?(y.push(v),v=""):v+=B}y.push(v);const b=y.map(U=>(U=U.trim(),U.startsWith('"')&&U.endsWith('"')?U.slice(1,-1):U)),_=o.name>-1?b[o.name]:null,C=o.price>-1?b[o.price]:null,j=o.unit>-1?b[o.unit]:"",k=o.vendor>-1?b[o.vendor]:"",E=String(_??"").trim(),D=ln(E);if(D&&C){const U=parseFloat(C.replace(/[^0-9.]/g,""));isNaN(U)||t.set(D,{price:U,vendor:k,unit:j,dateStr:f,displayName:E})}}}return t},parseCSVEntries(n,t=""){const i=[],a=n.split(/\r?\n/).filter(x=>x.trim());if(a.length===0)return i;const o=x=>{const b=String(x??"").trim();if(!b)return null;const _=parseFloat(b.replace(/[^0-9.]/g,""));return Number.isFinite(_)?_:null},u=x=>{const b=[];let _="",C=!1;for(let j=0;j<x.length;j++){const k=x[j];k==='"'?C=!C:k===","&&!C?(b.push(_),_=""):_+=k}return b.push(_),b.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j))},d=x=>{const b=String(x??"").trim();if(!b)return"";const _=b.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(_)return`${_[1]}/${String(_[2]).padStart(2,"0")}/${String(_[3]).padStart(2,"0")}`;const C=b.match(/^(\d{4})(\d{2})(\d{2})$/);return C?`${C[1]}/${C[2]}/${C[3]}`:b};if(a.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of a){const b=u(x);if(b[0]!=="D")continue;const _=d(b[1]),C=b[8],j=b[14],k=b[18],E=o(b[19]),D=b[20],U=String(j??"").trim(),B=ln(U);if(!B||!k)continue;const T=o(k);Number.isFinite(T)&&i.push({key:B,displayName:U,price:T,vendor:C,unit:D,dateStr:_,incomingQty:E,sourceFile:t})}return i}let h={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},m=0;if(a[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,b)=>{const _=String(x||"").toLowerCase();["","","","","name","item"].some(C=>_.includes(C))&&(h.name=b),["","","","","price","cost"].some(C=>_.includes(C))&&(h.price=b),["","unit"].some(C=>_.includes(C))&&(h.unit=b),["","","","vendor","supplier"].some(C=>_.includes(C))&&(h.vendor=b),["","","","date"].some(C=>_.includes(C))&&(h.date=b),["","","","","","qty","quantity"].some(C=>_.includes(C))&&(h.quantity=b)}),h.name===-1&&h.price===-1){h={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=a[0].split(",");isNaN(parseFloat(x[1]))&&(m=1)}else m=1;const v=d(new Date().toISOString().slice(0,10));for(let x=m;x<a.length;x++){const b=u(a[x]),_=h.name>-1?b[h.name]:null,C=h.price>-1?b[h.price]:null,j=h.unit>-1?b[h.unit]:"",k=h.vendor>-1?b[h.vendor]:"",E=h.date>-1?b[h.date]:"",D=h.quantity>-1?o(b[h.quantity]):null,U=String(_??"").trim(),B=ln(U);if(!B||!C)continue;const T=o(C);Number.isFinite(T)&&i.push({key:B,displayName:U,price:T,vendor:k,unit:j,dateStr:d(E)||v,incomingQty:D,sourceFile:t})}return i},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const i=this._historyCacheByUserId.get(t);if(i)return i;try{const a=await this._downloadAllCsvTexts(t);if(!a||a.length===0)return new Map;const o=new Map;for(const{fileName:u,text:d}of a){if(!d)continue;this.parseCSVEntries(d,u).forEach(h=>{const m=h?.key;m&&(o.has(m)||o.set(m,[]),o.get(m).push(h))})}for(const u of o.values())u.sort((d,f)=>{const h=String(d?.dateStr||""),m=String(f?.dateStr||"");if(h!==m)return h.localeCompare(m);const y=Number(d?.price),v=Number(f?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(f?.sourceFile||""))});return this._historyCacheByUserId.set(t,o),o}catch(a){return console.error("Error in fetchPriceHistory:",a),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),i=[];for(const[a,o]of t.entries())if(o&&typeof o=="object"){const{displayName:u,...d}=o;i.push({name:u||a,...d})}else i.push({name:a,price:o});return i.sort((a,o)=>a.dateStr&&o.dateStr?o.dateStr.localeCompare(a.dateStr):a.name.localeCompare(o.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(ln(n))||null}},qo={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:i}=await Re.rpc("search_ingredients",{search_query:n,max_results:15});return i?(console.warn(" Database search failed:",i),console.warn("Error message:",i.message),console.warn("Error code:",i.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){const t=String(n||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const i=t.toLowerCase(),a=ln(t);try{const o=await this._searchFromDatabase(i);if(o&&Array.isArray(o)){this._lastDbResults=o,this._lastDbQuery=i;const d=o.map(j=>({name:j.ingredient_name,price:j.last_price,size:j.packet_size,unit:j.packet_unit,itemCategory:j.item_category||null,source:"manual",displaySource:" "}));if(d.length===0)return await this._fallbackSearch(i);if(!this._csvCache){const j=await sr.getPriceListArray();this._csvCache=j.map(k=>({name:k.name,price:k.price,size:null,unit:k.unit,source:"csv",displaySource:" CSV"}))}const f=j=>{if(!a)return null;const k=String(j||"").indexOf(a);return k<0?null:{tier:j===a?0:k===0?1:2,idx:k,len:String(j||"").length}},h=(j,k)=>j.score.tier!==k.score.tier?j.score.tier-k.score.tier:j.score.idx!==k.score.idx?j.score.idx-k.score.idx:j.score.len!==k.score.len?j.score.len-k.score.len:j.name.localeCompare(k.name,"ja"),m=(j,k,E)=>{let D=0;for(;D<j.length&&h(j[D],k)<=0;)D++;j.splice(D,0,k),j.length>E&&j.pop()},v=Math.max(0,15-d.length),x=new Set(d.map(j=>ln(j.name))),b=[],_=new Set;if(v>0)for(const j of this._csvCache){const k=ln(j?.name);if(!k||x.has(k)||_.has(k))continue;const E=f(k);E&&(_.add(k),m(b,{...j,nameKey:k,score:E},v))}const C=b.map(j=>({name:j.name,price:j.price,size:j.size,unit:j.unit,source:j.source,displaySource:j.displaySource}));return[...d,...C]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",o);const u=await this._fallbackSearch(i);return console.log(" Fallback search returned:",u.length,"results"),u}catch(o){return console.error("Error searching ingredients:",o),[]}},async _fallbackSearch(n){try{const t=ln(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[h,m]=await Promise.all([sr.getPriceListArray(),qn.getAllConversions()]);console.log(" CSV Data rows:",h.length),console.log(" Manual Data items:",m.size);const y=Array.from(m.values()).map(_=>({name:_.ingredientName,price:_.lastPrice,size:_.packetSize,unit:_.packetUnit,itemCategory:_.itemCategory||null,source:"manual",displaySource:" "})),v=h.map(_=>({name:_.name,price:_.price,size:null,unit:_.unit,source:"csv",displaySource:" CSV"})),x=new Set(y.map(_=>_.name)),b=v.filter(_=>!x.has(_.name));this._csvCache=[...y,...b],console.log(" Cache built. Total items:",this._csvCache.length)}const i=h=>{if(!t)return null;const m=String(h||"").indexOf(t);return m<0?null:{tier:h===t?0:m===0?1:2,idx:m,len:String(h||"").length}},a=(h,m)=>h.score.tier!==m.score.tier?h.score.tier-m.score.tier:h.score.idx!==m.score.idx?h.score.idx-m.score.idx:h.score.len!==m.score.len?h.score.len-m.score.len:h.name.localeCompare(m.name,"ja"),o=(h,m,y)=>{let v=0;for(;v<h.length&&a(h[v],m)<=0;)v++;h.splice(v,0,m),h.length>y&&h.pop()},u=15,d=[],f=new Set;for(const h of this._csvCache){const m=ln(h?.name);if(!m||f.has(m))continue;const y=i(m);y&&(f.add(m),o(d,{...h,nameKey:m,score:y},u))}return d.map(h=>({name:h.name,price:h.price,size:h.size,unit:h.unit,itemCategory:h.itemCategory||null,source:h.source,displaySource:h.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},sd=({value:n,onChange:t,placeholder:i,disabled:a,onSelect:o,name:u,required:d=!1})=>{const[f,h]=w.useState([]),[m,y]=w.useState(!1),[v,x]=w.useState(-1),b=w.useRef(null),_=w.useRef(null),[C,j]=w.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),k=w.useCallback(()=>{if(b.current){const N=b.current.getBoundingClientRect(),O=8,L=4,Y=N.top-O,q=window.innerHeight-N.bottom-O,F=(Y>=180||Y>=q)&&Y>=110,I=Math.max(110,Math.min(280,F?Y-L:q-L)),P=N.left,R=Math.max(220,window.innerWidth-O*2),z=Math.min(Math.max(N.width,220),R),K=Math.min(Math.max(O,P),window.innerWidth-O-z);j({top:F?N.top-L:N.bottom+L,left:K,width:z,maxHeight:I,placeAbove:F})}},[]);w.useEffect(()=>{const N=Y=>{b.current&&!b.current.contains(Y.target)&&_.current&&!_.current.contains(Y.target)&&y(!1)},O=Y=>{_.current&&_.current.contains(Y.target)||y(!1)},L=()=>{m&&k()};return document.addEventListener("mousedown",N),window.addEventListener("scroll",O,{capture:!0}),window.addEventListener("resize",L),()=>{document.removeEventListener("mousedown",N),window.removeEventListener("scroll",O,{capture:!0}),window.removeEventListener("resize",L)}},[m,k]),w.useEffect(()=>{m&&k()},[m,f,k]);const E=w.useRef(0),D=w.useRef(null),U=async N=>{const O=N.target.value;if(t(N),D.current&&clearTimeout(D.current),O.length===0){y(!1);return}D.current=setTimeout(async()=>{if(O.length>0){const L=++E.current;console.log(" AutocompleteInput: Fetching suggestions for:",O);const Y=await qo.search(O);console.log(" AutocompleteInput: Got",Y.length,"suggestions"),L===E.current&&(h(Y),y(Y.length>0),x(-1))}},150)},B=N=>{const O={target:{value:N.name}};t(O),y(!1),o&&o(N)},T=N=>{m&&(N.key==="ArrowDown"?(N.preventDefault(),x(O=>O<f.length-1?O+1:O)):N.key==="ArrowUp"?(N.preventDefault(),x(O=>O>0?O-1:-1)):N.key==="Enter"?v>=0&&(N.preventDefault(),B(f[v])):N.key==="Escape"&&y(!1))};return s.jsxs("div",{className:"autocomplete-wrapper",ref:b,children:[s.jsx("input",{type:"text",className:"input-field autocomplete-input",name:u,value:n,onChange:U,onKeyDown:T,onFocus:async()=>{if(n&&n.length>0){k();const N=await qo.search(n);h(N),y(N.length>0)}else k()},placeholder:i,disabled:a,required:d}),m&&ra.createPortal(s.jsx("ul",{className:"suggestions-list",ref:_,style:{position:"fixed",top:`${C.top}px`,left:`${C.left}px`,width:`${C.width}px`,maxHeight:`${C.maxHeight}px`,transform:C.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:f.map((N,O)=>s.jsxs("li",{className:`suggestion-item ${O===v?"selected":""}`,onClick:()=>B(N),onMouseEnter:()=>x(O),children:[s.jsxs("div",{className:"suggestion-main",children:[s.jsx("span",{className:"suggestion-name",children:N.name}),N?.source&&N.source!=="manual"&&s.jsx("span",{className:"suggestion-source",children:N.displaySource})]}),s.jsxs("div",{className:"suggestion-details",children:[N.price&&`${Number(N.price).toLocaleString()}`,N.size&&` / ${N.size}${N.unit}`,!N.size&&N.unit&&` / ${N.unit}`]})]},`${N.source}-${O}`))}),document.body)]})},Nb=({isOpen:n,onClose:t,onApply:i,ingredientName:a,currentCost:o,currentQuantity:u,unit:d="g",initialPurchaseCost:f,initialContentAmount:h})=>{const[m,y]=w.useState(""),[v,x]=w.useState(""),[b,_]=w.useState(d),[C,j]=w.useState(""),[k,E]=w.useState(!1),[D,U]=w.useState(!1),B=w.useCallback(async()=>{if(U(!0),j(""),f&&h){y(f),x(h);const q=await qn.getConversion(a);if(q)_(q.packetUnit||d),j(q.vendor||"");else{_(d);try{const V=await sr.getPrice(a);j(V?.vendor||"")}catch{}}}else{const q=await qn.getConversion(a);if(q)x(q.packetSize),_(q.packetUnit||d),q.lastPrice&&y(q.lastPrice),j(q.vendor||"");else try{const V=await sr.getPrice(a);if(V)if(y(o||V.price),j(V.vendor||""),V.unit){const F=V.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(F){let I=F[1]?parseFloat(F[1]):1,P=F[2]?F[2].trim().toLowerCase():"";P==="kg"?(I*=1e3,P="g"):P==="l"?(I*=1e3,P="ml"):P==="pk"||P==="pack"?P="":P==="bag"?P="":(P==="pc"||P==="pcs")&&(P=""),x(I),_(P||d)}else x(1),_(V.unit)}else x(""),_(d);else x(""),y(o||""),_(d),j("")}catch(V){console.warn("Failed to load master price:",V),x(""),y(o||""),_(d),j("")}}U(!1)},[a,f,h,d,o]);w.useEffect(()=>{if(!n||!a)return;const q=setTimeout(()=>{B()},0);return()=>clearTimeout(q)},[n,a,B]);const T=()=>{const q=parseFloat(m),V=parseFloat(v);return!q||!V?0:["g","ml","cc"].includes(b)?q/V*1e3:q/V},N=async()=>{const q=T();if(k&&v)try{await qn.saveConversion(a,v,b,m,null,C)}catch(V){console.error("Failed to save default conversion:",V)}i(q,b,m,v,C),t()};if(!n)return null;const O=T(),L=u?O*(u/(["g","ml"].includes(d)?1e3:1)):0,Y=s.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:s.jsx("div",{className:"unit-conversion-modal__card",onClick:q=>q.stopPropagation(),children:s.jsxs("div",{className:"unit-conversion-modal__body",children:[s.jsx("h3",{className:"unit-conversion-modal__title",children:""}),s.jsxs("div",{className:"unit-conversion-modal__field",children:[s.jsx("span",{className:"unit-conversion-modal__label",children:""}),s.jsx("div",{className:"unit-conversion-modal__value",children:a||"()"})]}),s.jsxs("div",{className:"unit-conversion-modal__inputs",children:[s.jsxs("div",{children:[s.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),s.jsx("input",{type:"number",value:m,onChange:q=>y(q.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"unit-conversion-modal__label",children:""}),s.jsxs("div",{className:"unit-conversion-modal__row",children:[s.jsx("input",{type:"number",value:v,onChange:q=>x(q.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),s.jsxs("select",{value:b,onChange:q=>_(q.target.value),className:"unit-conversion-modal__select",children:[s.jsx("option",{value:"g",children:"g"}),s.jsx("option",{value:"ml",children:"ml"}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:"p"}),s.jsx("option",{value:"cc",children:"cc"}),!["g","ml","","","","","","cc"].includes(b)&&s.jsx("option",{value:b,children:b})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"unit-conversion-modal__label",children:""}),s.jsx("input",{type:"text",value:C,onChange:q=>j(q.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),s.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:D?s.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[s.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),s.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(O).toLocaleString()]})]}),u&&s.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[s.jsxs("span",{children:[" (",u,d,"):"]}),s.jsxs("span",{children:["",Math.round(L).toLocaleString()]})]})]})}),s.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[s.jsx("input",{type:"checkbox",id:"saveDefault",checked:k,onChange:q=>E(q.target.checked)}),s.jsxs("span",{children:["(",v,b,")"]})]}),s.jsxs("div",{className:"unit-conversion-modal__actions",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:t,disabled:D,children:""}),s.jsx(se,{type:"button",variant:"primary",onClick:N,disabled:!m||!v||D,children:""})]})]})})});return ra.createPortal(Y,document.body)},tk=new Set(["food","alcohol","soft_drink","supplies"]),nk=new Set(["alcohol","supplies"]),Eb={food:"",alcohol:"",soft_drink:"",supplies:""},Ci=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":tk.has(t)?t:"":""},id=n=>nk.has(n),Ff=(n,t)=>{const i=Ci(t);return i?{...n,itemCategory:i,isAlcohol:id(i)}:{...n,itemCategory:null}},Qn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},pp=n=>{const t=Qn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Qi=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return pp(i)/100},rk=(n,t,i)=>{const a=Qn(n),o=Qn(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},Bx=(n,t,i,a=!1,o=1)=>{const u=Qn(n),d=Qn(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const f=Number.isFinite(o)&&o>0?o:1;if(a)return u/1e3*d/f;const h=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(h)||!h?u/1e3*d/f:u*d/f},sk=(n,t)=>{const i=Qn(n?.purchaseCost),a=Qn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},$x=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Gr=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=$x(t);if(!a)return null;for(const[o,u]of n.entries())if($x(o)===a)return u;return null},ik=({formData:n,setFormData:t})=>{const[i,a]=w.useState(new Map),[o,u]=w.useState({isOpen:!1,type:null,index:null}),[d,f]=w.useState(new Map);w.useEffect(()=>{(async()=>{const[N,O]=await Promise.all([sr.fetchPriceList(),qn.getAllConversions()]);a(N),f(O)})()},[]);const m=(T=>T.reduce((N,O)=>N+(parseFloat(O.quantity)||0),0))(n.flours||[]),y=T=>!m||m===0?0:((parseFloat(T)||0)/m*100).toFixed(1);w.useEffect(()=>{if(d.size===0)return;const T=(L=[])=>{let Y=!1;return{adjusted:L.map(V=>{if(!V||typeof V!="object")return V;const F=Gr(d,V.name);let I=V;const P=Ci(V.itemCategory??V.item_category??F?.itemCategory);if(P){const ye=id(P);(Ci(V.itemCategory??V.item_category)!==P||!!V.isAlcohol!==ye)&&(I={...I,itemCategory:P,isAlcohol:ye})}const R=Qi(V,F),z=Bx(V.quantity,I.purchaseCost,V.unit,!0,R),K=Number.isFinite(z)?Math.round(z*100)/100:NaN,ue=Qn(I.cost);if(Number.isFinite(K)&&(!Number.isFinite(ue)||Math.abs(ue-K)>.01)&&(I={...I,cost:K}),F&&F.packetSize){const $=[F.lastPrice,V.purchaseCostRef,V.purchase_cost,V.purchaseCost].find(X=>Number.isFinite(Qn(X))),Q=rk($,F.packetSize,F.packetUnit);if(Number.isFinite(Q)&&sk(V,Q)){const X=Qi(V,F),fe=Math.round(Q*100)/100,ke=Bx(V.quantity,fe,V.unit,!0,X),Ue=Number.isFinite(ke)?Math.round(ke*100)/100:I.cost,de=Qn(I.purchaseCost),H=Qn(I.cost),G=!Number.isFinite(de)||Math.abs(de-fe)>.01,oe=Number.isFinite(Qn(Ue))&&(!Number.isFinite(H)||Math.abs(H-Ue)>.01);(G||oe)&&(I={...I,purchaseCost:fe,cost:Ue})}}return I!==V&&(Y=!0),I}),changed:Y}},N=T(n.flours||[]),O=T(n.breadIngredients||[]);!N.changed&&!O.changed||t(L=>({...L,flours:N.adjusted,breadIngredients:O.adjusted}))},[d,n.breadIngredients,n.flours,t]);const v=(T,N,O)=>{const L=[...n.flours||[]];if(L[T]={...L[T],[N]:O},N==="name"){const Y=i.get(ln(O));if(Y){const q=typeof Y=="object"?Y.price:Y,V=typeof Y=="object"?Y.vendor:null,F=typeof Y=="object"?Y.unit:null;L[T].purchaseCostRef=q,L[T].vendorRef=V;const I=Gr(d,O);if(I&&I.packetSize){let R=0;const z=I.lastPrice!==null&&I.lastPrice!==void 0&&I.lastPrice!==""?I.lastPrice:q,K=(I.packetUnit||"").trim().toLowerCase();["g",""].includes(K)?R=z/I.packetSize*1e3:["kg",""].includes(K)?R=z/I.packetSize:["ml","","cc",""].includes(K)?R=z/I.packetSize*1e3:(["l",""].includes(K),R=z/I.packetSize),L[T].purchaseCost=Math.round(R*100)/100,L[T].unit="g"}else L[T].purchaseCost||(L[T].purchaseCost=q,!L[T].unit&&F&&(L[T].unit=F));const P=Ci(I?.itemCategory);P?L[T]=Ff(L[T],P):L[T].itemCategory=null}else L[T].purchaseCostRef=null,L[T].vendorRef=null,L[T].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(N)||N==="name"){const Y=L[T],q=parseFloat(Y.quantity),V=parseFloat(Y.purchaseCost);if(!isNaN(q)&&!isNaN(V)){let F=0;const I=(Y.unit||"").trim().toLowerCase();I==="g"||I===""||I==="ml"||I===""||I==="cc"||I===""||!I?F=q/1e3*V:F=q*V;const P=Gr(d,Y.name),R=Qi(Y,P),z=Number.isFinite(R)&&R>0?R:1,K=Math.round(F/z*100)/100;K!==Y.cost&&(L[T].cost=K)}}t(Y=>({...Y,flours:L}))},x=(T,N,O)=>{const L=[...n.breadIngredients||[]];if(L[T]={...L[T],[N]:O},N==="name"){const Y=i.get(ln(O));if(Y){const q=typeof Y=="object"?Y.price:Y,V=typeof Y=="object"?Y.vendor:null,F=typeof Y=="object"?Y.unit:null;L[T].purchaseCostRef=q,L[T].vendorRef=V;const I=Gr(d,O);if(I&&I.packetSize){let R=0;const z=I.lastPrice!==null&&I.lastPrice!==void 0&&I.lastPrice!==""?I.lastPrice:q,K=(I.packetUnit||"").trim().toLowerCase();["g",""].includes(K)?(R=z/I.packetSize*1e3,L[T].unit="g"):["kg",""].includes(K)?(R=z/I.packetSize,L[T].unit="g"):["ml","","cc",""].includes(K)?(R=z/I.packetSize*1e3,L[T].unit="ml"):["l",""].includes(K)?(R=z/I.packetSize,L[T].unit="ml"):(R=z/I.packetSize,L[T].unit=I.packetUnit),L[T].purchaseCost=Math.round(R*100)/100}else L[T].purchaseCost||(L[T].purchaseCost=q,!L[T].unit&&F&&(L[T].unit=F));const P=Ci(I?.itemCategory);P?L[T]=Ff(L[T],P):L[T].itemCategory=null}else L[T].purchaseCostRef=null,L[T].vendorRef=null,L[T].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(N)||N==="name"){const Y=L[T],q=parseFloat(Y.quantity),V=parseFloat(Y.purchaseCost);if(!isNaN(q)&&!isNaN(V)){let F=0;const I=Y.unit?Y.unit.trim().toLowerCase():"g";I==="g"||I===""||I==="ml"||I===""||I==="cc"||I===""?F=q/1e3*V:F=q*V;const P=Gr(d,Y.name),R=Qi(Y,P),z=Number.isFinite(R)&&R>0?R:1,K=Math.round(F/z*100)/100;K!==Y.cost&&(L[T].cost=K)}}t(Y=>({...Y,breadIngredients:L}))},b=()=>{t(T=>({...T,flours:[...T.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},_=()=>{t(T=>({...T,breadIngredients:[...T.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},C=T=>{t(N=>({...N,flours:N.flours.filter((O,L)=>L!==T)}))},j=T=>{t(N=>({...N,breadIngredients:N.breadIngredients.filter((O,L)=>L!==T)}))},k=gl(vr(Jo,{activationConstraint:{distance:10}}),vr(Xo,{activationConstraint:{delay:250,tolerance:5}}),vr(vl,{coordinateGetter:ed})),E=T=>{const{active:N,over:O}=T;N.id!==O.id&&t(L=>{const q=L.flours.some(I=>I.id===N.id)?"flours":"breadIngredients",V=L[q].findIndex(I=>I.id===N.id),F=L[q].findIndex(I=>I.id===O.id);return V!==-1&&F!==-1?{...L,[q]:ca(L[q],V,F)}:L})};w.useEffect(()=>{if(!n.flours)t(T=>({...T,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const T=n.flours.map(N=>N.id?N:{...N,id:crypto.randomUUID()});JSON.stringify(T)!==JSON.stringify(n.flours)&&t(N=>({...N,flours:T}))}if(!n.breadIngredients)t(T=>({...T,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const T=n.breadIngredients.map(N=>N.id?N:{...N,id:crypto.randomUUID()});JSON.stringify(T)!==JSON.stringify(n.breadIngredients)&&t(N=>({...N,breadIngredients:T}))}},[]);const D=(T,N,O,L)=>{const{type:Y,index:q}=o;t(V=>{if(Y==="flour"){const F=[...V.flours],I={...F[q],purchaseCost:T,unit:N,purchase_cost:O,content_amount:L},P=parseFloat(I.quantity),R=parseFloat(T);if(!isNaN(P)&&!isNaN(R)){let z=0;N==="g"||N===""?z=P/1e3*R:z=P*R;const K=Gr(d,I.name),ue=Qi(I,K),ye=Number.isFinite(ue)&&ue>0?ue:1;I.cost=Math.round(z/ye*100)/100}return F[q]=I,qn.getAllConversions().then(z=>f(z)),qo.invalidateCache(),{...V,flours:F}}else if(Y==="ingredient"){const F=[...V.breadIngredients],I={...F[q],purchaseCost:T,unit:N,purchase_cost:O,content_amount:L},P=parseFloat(I.quantity),R=parseFloat(T);if(!isNaN(P)&&!isNaN(R)){let z=0;N==="g"||N===""?z=P/1e3*R:z=P*R;const K=Gr(d,I.name),ue=Qi(I,K),ye=Number.isFinite(ue)&&ue>0?ue:1;I.cost=Math.round(z/ye*100)/100}return F[q]=I,qn.getAllConversions().then(z=>f(z)),qo.invalidateCache(),{...V,breadIngredients:F}}return V})},U=(T,N,O)=>{O&&t(L=>{const Y=T==="flour"?"flours":"breadIngredients",q=[...L[Y]||[]],V={...q[N]};if(V.name=O.name,V.itemCategory=null,O.price!==void 0&&O.price!==null&&O.price!==""){V.purchaseCostRef=O.price,V.vendorRef=O.source==="csv"?"CSV":"Master";let R=O.price,z=O.unit;if(O.source==="manual")if(O.size&&O.size>0){const K=(O.unit||"").trim().toLowerCase();["g",""].includes(K)?(R=O.price/O.size*1e3,z="g"):["kg",""].includes(K)?(R=O.price/O.size,z="g"):["ml","","cc",""].includes(K)?(R=O.price/O.size*1e3,z="ml"):["l",""].includes(K)?(R=O.price/O.size,z="ml"):(R=O.price/O.size,z=O.unit)}else R=O.price,z=O.unit;else{const K=Gr(d,O.name);if(K&&K.packetSize){const ue=K.lastPrice!==null&&K.lastPrice!==void 0&&K.lastPrice!==""?K.lastPrice:O.price,ye=(K.packetUnit||"").trim().toLowerCase();["g",""].includes(ye)?(R=ue/K.packetSize*1e3,z="g"):["kg",""].includes(ye)?(R=ue/K.packetSize,z="g"):["ml","","cc",""].includes(ye)?(R=ue/K.packetSize*1e3,z="ml"):["l",""].includes(ye)?(R=ue/K.packetSize,z="ml"):(R=ue/K.packetSize,z=K.packetUnit)}else R=O.price,z=O.unit}V.purchaseCost=Math.round(R*100)/100,T==="flour"?V.unit="g":z&&(V.unit=z)}const F=Ci(O.itemCategory??O.item_category??Gr(d,O.name)?.itemCategory);if(F){const R=Ff(V,F);Object.assign(V,R)}const I=parseFloat(V.quantity),P=parseFloat(V.purchaseCost);if(!isNaN(I)&&!isNaN(P)){const R=Gr(d,V.name),z=Qi(V,R),K=Number.isFinite(z)&&z>0?z:1,ue=(V.unit||"").trim().toLowerCase();let ye=0;ue==="g"||ue===""||ue==="ml"||ue===""||ue==="cc"||ue===""?ye=I/1e3*P:ye=I*P,V.cost=Math.round(ye/K*100)/100}return q[N]=V,{...L,[Y]:q}})},B=o.isOpen&&o.index!==null?o.type==="flour"?n.flours[o.index]:n.breadIngredients[o.index]:null;return s.jsxs("div",{className:"bread-form",children:[s.jsxs(an,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[s.jsxs("div",{className:"bread-header",children:[s.jsxs("h3",{children:[" (Total: ",m,"g)"]}),s.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),s.jsxs("div",{className:"recipe-scroll-wrapper",children:[s.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[s.jsx("span",{})," ",s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{className:"text-center",children:"%"}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),s.jsx("span",{})]}),s.jsx("div",{className:"bread-grid-body",children:s.jsx(oa,{sensors:k,collisionDetection:Xf,onDragEnd:E,id:"flours-dnd",children:s.jsx(ul,{items:n.flours||[],strategy:zo,children:(n.flours||[]).map((T,N)=>{const O=Gr(d,T?.name),L=pp(O?.yieldPercent??O?.yield_percent??T?.yieldPercent??T?.yield_percent);return s.jsx(ak,{id:T.id,index:N,item:T,yieldPercentApplied:L,onChange:v,onRemove:C,onSelect:U,calculatePercentage:y,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:N})},T.id)})})})})]}),s.jsx(se,{type:"button",variant:"secondary",size:"sm",onClick:b,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),s.jsxs(an,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[s.jsxs("div",{className:"bread-header",children:[s.jsx("h3",{children:""}),s.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),s.jsxs("div",{className:"recipe-scroll-wrapper",children:[s.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[s.jsx("span",{})," ",s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{className:"text-center",children:"%"}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),s.jsx("span",{})]}),s.jsx("div",{className:"bread-grid-body",children:s.jsx(oa,{sensors:k,collisionDetection:Xf,onDragEnd:E,id:"breadIngredients-dnd",children:s.jsx(ul,{items:n.breadIngredients||[],strategy:zo,children:(n.breadIngredients||[]).map((T,N)=>{const O=Gr(d,T?.name),L=pp(O?.yieldPercent??O?.yield_percent??T?.yieldPercent??T?.yield_percent);return s.jsx(lk,{id:T.id,index:N,item:T,yieldPercentApplied:L,onChange:x,onRemove:j,onSelect:U,calculatePercentage:y,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:N})},T.id)})})})})]}),s.jsx(se,{type:"button",variant:"secondary",size:"sm",onClick:_,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),s.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:s.jsx(se,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),s.jsx(Nb,{isOpen:o.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:D,ingredientName:B?.name||"",currentCost:B?.purchaseCost,currentQuantity:B?.quantity,unit:B?.unit||"g",initialPurchaseCost:B?.purchase_cost,initialContentAmount:B?.content_amount})]})},ak=({id:n,index:t,item:i,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:f,floursLength:h,onOpenConversion:m})=>{const y=Ci(i.itemCategory??i.item_category),v=!!y,x=Eb[y]||"",b=v?`${x}${id(y)?"10%":"8%"}`:"",{attributes:_,listeners:C,setNodeRef:j,transform:k,transition:E,isDragging:D}=xl({id:n}),U={transform:Or.Transform.toString(k),transition:E,opacity:D?.5:1,position:"relative",zIndex:D?999:"auto"};return s.jsxs("div",{ref:j,style:U,className:"form-ingredient-row--bread",children:[s.jsx("div",{..._,...C,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),s.jsx("div",{className:"ingredient-name",children:s.jsx(sd,{value:i.name,onChange:B=>o(t,"name",B.target.value),onSelect:B=>d("flour",t,B),placeholder:": "})}),s.jsx("div",{className:"ingredient-qty",children:s.jsx(kt,{type:"number",step:"any",value:i.quantity,onChange:B=>o(t,"quantity",B.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),s.jsx("div",{className:"ingredient-unit",children:s.jsx(kt,{value:i.unit,onChange:B=>o(t,"unit",B.target.value),placeholder:"",style:{width:"100%",textAlign:"center"},wrapperClassName:"input-group--no-margin"})}),s.jsxs("div",{className:"bread-percent",children:[f(i.quantity),"%"]}),s.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[s.jsx(kt,{type:"number",step:"any",value:i.purchaseCost||"",onChange:B=>o(t,"purchaseCost",B.target.value),placeholder:i.purchaseCostRef?`Ref: ${i.purchaseCostRef}`:"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:i.purchaseCostRef?`: ${i.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),s.jsx("button",{type:"button",onClick:m,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&s.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",i.purchaseCostRef," ",i.vendorRef&&`(${i.vendorRef})`]})]}),s.jsxs("div",{className:"ingredient-cost",children:[s.jsx(kt,{type:"number",step:"any",value:i.cost||"",onChange:B=>o(t,"cost",B.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Qn(a))&&Qn(a)<99.999&&s.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const B=Qn(a),T=Math.round(B*10)/10;return`${Number.isInteger(T)?Math.round(T):T}%`})()]})]}),s.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx("input",{type:"checkbox",checked:i.isAlcohol||!1,onChange:B=>o(t,"isAlcohol",B.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${b}`:"10%"})}),s.jsx("div",{className:"remove-button-cell",children:h>1&&s.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},lk=({id:n,index:t,item:i,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:f,onOpenConversion:h})=>{const m=Ci(i.itemCategory??i.item_category),y=!!m,v=Eb[m]||"",x=y?`${v}${id(m)?"10%":"8%"}`:"",{attributes:b,listeners:_,setNodeRef:C,transform:j,transition:k,isDragging:E}=xl({id:n}),D={transform:Or.Transform.toString(j),transition:k,opacity:E?.5:1,position:"relative",zIndex:E?999:"auto"};return s.jsxs("div",{ref:C,style:D,className:"form-ingredient-row--bread",children:[s.jsx("div",{...b,..._,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),s.jsx("div",{className:"ingredient-name",children:s.jsx(sd,{value:i.name,onChange:U=>o(t,"name",U.target.value),onSelect:U=>d("ingredient",t,U),placeholder:": "})}),s.jsx("div",{className:"ingredient-qty",children:s.jsx(kt,{type:"number",step:"any",value:i.quantity,onChange:U=>o(t,"quantity",U.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),s.jsx("div",{className:"ingredient-unit",children:s.jsx(kt,{value:i.unit,onChange:U=>o(t,"unit",U.target.value),placeholder:"",style:{width:"100%",textAlign:"center"},wrapperClassName:"input-group--no-margin"})}),s.jsxs("div",{className:"bread-percent",children:[f(i.quantity),"%"]}),s.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[s.jsx(kt,{type:"number",step:"any",value:i.purchaseCost||"",onChange:U=>o(t,"purchaseCost",U.target.value),placeholder:i.purchaseCostRef?`Ref: ${i.purchaseCostRef}`:"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:i.purchaseCostRef?`: ${i.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),s.jsx("button",{type:"button",onClick:h,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&s.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",i.purchaseCostRef," ",i.vendorRef&&`(${i.vendorRef})`]})]}),s.jsxs("div",{className:"ingredient-cost",children:[s.jsx(kt,{type:"number",step:"any",value:i.cost||"",onChange:U=>o(t,"cost",U.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Qn(a))&&Qn(a)<99.999&&s.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const U=Qn(a),B=Math.round(U*10)/10;return`${Number.isInteger(B)?Math.round(B):B}%`})()]})]}),s.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx("input",{type:"checkbox",checked:i.isAlcohol||!1,onChange:U=>o(t,"isAlcohol",U.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),s.jsx("div",{className:"remove-button-cell",children:s.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},ok=new Set(["food","alcohol","soft_drink","supplies"]),ck=new Set(["alcohol","supplies"]),uk={food:"",alcohol:"",soft_drink:"",supplies:""},ll=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":ok.has(t)?t:"":""},qu=n=>ck.has(n),Px=(n,t)=>{const i=ll(t);return i?{...n,itemCategory:i,isAlcohol:qu(i)}:{...n,itemCategory:null}},qx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Ms=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=qx(t);if(!a)return null;for(const[o,u]of n.entries())if(qx(o)===a)return u;return null},or=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},kb=n=>{const t=or(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Ja=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return kb(i)/100},dk=(n,t,i)=>{const a=or(n),o=or(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},Hf=(n,t,i,a=1)=>{const o=or(n),u=or(t);if(!Number.isFinite(o)||!Number.isFinite(u))return NaN;const d=String(i||"").trim().toLowerCase();let f=0;["g","","ml","","cc",""].includes(d)?f=o/1e3*u:f=o*u;const h=Number.isFinite(a)&&a>0?a:1;return f/h},hk=(n,t)=>{const i=or(n?.purchaseCost),a=or(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},fk=Ce.memo(({id:n,index:t,item:i,groupId:a,yieldPercentApplied:o,onChange:u,onRemove:d,handleSuggestionSelect:f,onOpenConversion:h})=>{const m=ll(i.itemCategory??i.item_category),y=!!m,v=uk[m]||"",x=y?`${v}${qu(m)?"10%":"8%"}`:"",b=y?qu(m):!!i.isAlcohol,{attributes:_,listeners:C,setNodeRef:j,transform:k,transition:E,isDragging:D}=xl({id:n,data:{groupId:a,index:t}}),U={transform:Or.Translate.toString(k),transition:E,opacity:D?.3:1,position:"relative",zIndex:D?999:"auto"};return s.jsxs("div",{ref:j,style:U,className:"form-ingredient-row",children:[s.jsx("div",{..._,...C,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),s.jsx("div",{className:"ingredient-name",children:s.jsx(sd,{value:i.name,onChange:B=>u(a,t,"name",B.target.value),onSelect:B=>f(a,t,B),placeholder:""})}),s.jsx("div",{className:"ingredient-qty",children:s.jsx(kt,{value:i.quantity,onChange:B=>u(a,t,"quantity",B.target.value),placeholder:"0",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),s.jsx("div",{className:"ingredient-unit",children:s.jsx(kt,{value:i.unit,onChange:B=>u(a,t,"unit",B.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),s.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[s.jsx(kt,{type:"number",value:i.purchaseCost,onChange:B=>u(a,t,"purchaseCost",B.target.value),step:"0.01",placeholder:i.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},title:i.purchaseCostRef?`: ${i.purchaseCostRef}${i.vendorRef?` (${i.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),s.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:h,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&s.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",i.purchaseCostRef]})]}),s.jsxs("div",{className:"ingredient-cost","data-label":"",children:[s.jsx(kt,{type:"number",step:"0.01",value:i.cost,onChange:B=>u(a,t,"cost",B.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(or(o))&&or(o)<99.999&&s.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const B=or(o),T=Math.round(B*10)/10;return`${Number.isInteger(T)?Math.round(T):T}%`})()]})]}),s.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx("input",{type:"checkbox",checked:b,onChange:B=>u(a,t,"isAlcohol",B.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),s.jsx("div",{className:"remove-button-cell",children:s.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(a,t),children:""})})]})},(n,t)=>n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),pk=({section:n,sections:t,onSectionChange:i,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=ec({id:n.id});return s.jsxs(an,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[s.jsx(kt,{value:n.name,onChange:d=>i(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),s.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&s.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),s.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[s.jsx("span",{}),s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),s.jsx("span",{})]}),s.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&s.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},mk=({formData:n,setFormData:t,priceList:i})=>{const[a,o]=w.useState(new Map);w.useEffect(()=>{qn.getAllConversions().then(U=>o(U))},[]);const[u,d]=w.useState({isOpen:!1,groupId:null,index:null});w.useEffect(()=>{if(!n.ingredientSections){const U=n.ingredientGroups||[{id:"default",name:""}],B=n.ingredients||[],T=U.map(L=>({id:L.id,name:L.name,items:B.filter(Y=>L.id==="default"&&!Y.groupId?!0:Y.groupId===L.id)})),N=new Set(T.flatMap(L=>L.items.map(Y=>Y.id))),O=B.filter(L=>!N.has(L.id));O.length>0&&(T.length>0?T[0].items.push(...O):T.push({id:"default",name:"",items:O})),T.length===0&&T.push({id:crypto.randomUUID(),name:"",items:[]}),t(L=>({...L,ingredientSections:T}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const f=n.ingredientSections||[];w.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||a.size===0)return;let U=!1;const B=n.ingredientSections.map(T=>{const N=T.items.map(O=>{if(!O||typeof O!="object")return O;const L=Ms(a,O.name);let Y=O;const q=ll(O.itemCategory??O.item_category??L?.itemCategory);if(q){const F=qu(q);(ll(O.itemCategory??O.item_category)!==q||!!O.isAlcohol!==F)&&(Y={...Y,itemCategory:q,isAlcohol:F})}if(L&&L.packetSize){const I=[L.lastPrice,O.purchaseCostRef,O.purchase_cost,O.purchaseCost].find(R=>Number.isFinite(or(R))),P=dk(I,L.packetSize,L.packetUnit);if(Number.isFinite(P)&&hk(O,P)){const R=Ja(O,L),z=Math.round(P*100)/100,K=Hf(O.quantity,z,O.unit,R),ue=Number.isFinite(K)?Math.round(K*100)/100:Y.cost,ye=or(Y.purchaseCost),$=or(Y.cost),Q=!Number.isFinite(ye)||Math.abs(ye-z)>.01,X=Number.isFinite(or(ue))&&(!Number.isFinite($)||Math.abs($-ue)>.01);(Q||X)&&(Y={...Y,purchaseCost:z,cost:ue})}}const V=Ja(O,L);if(Number.isFinite(V)&&V>0&&Math.abs(V-1)>1e-4){const F=Hf(O.quantity,Y.purchaseCost,O.unit,V),I=Hf(O.quantity,Y.purchaseCost,O.unit,1),P=or(Y.cost);if(Number.isFinite(F)&&(!Number.isFinite(P)||Number.isFinite(I)&&Math.abs(P-I)<=.01)){const z=Math.round(F*100)/100,K=or(Y.cost);(!Number.isFinite(K)||Math.abs(K-z)>.01)&&(Y={...Y,cost:z})}}return Y!==O&&(U=!0),Y});return N!==T.items?{...T,items:N}:T});U&&t(T=>({...T,ingredientSections:B}))},[a,n.ingredientSections,t]);const h=gl(vr(Jo,{activationConstraint:{distance:10}}),vr(Xo,{activationConstraint:{delay:250,tolerance:5}}),vr(vl,{coordinateGetter:ed})),m=({active:U,over:B})=>{if(!B)return;const T=U.id,N=B.id,O=f.find(Y=>Y.items.some(q=>q.id===T)),L=f.find(Y=>Y.items.some(q=>q.id===N))||f.find(Y=>Y.id===N);!O||!L||O===L||t(Y=>{const q=O.items,V=L.items,F=q.findIndex(R=>R.id===T),I=V.findIndex(R=>R.id===N);let P;if(N===L.id)P=V.length+1;else{const z=B&&U.rect.current.translated&&U.rect.current.translated.top>B.rect.top+B.rect.height?1:0;P=I>=0?I+z:V.length+1}return{...Y,ingredientSections:Y.ingredientSections.map(R=>R.id===O.id?{...R,items:q.filter(z=>z.id!==T)}:R.id===L.id?{...R,items:[...V.slice(0,P),q[F],...V.slice(P,V.length)]}:R)}})},y=({active:U,over:B})=>{if(!B)return;const T=U.id,N=B.id,O=f.find(Y=>Y.items.some(q=>q.id===T)),L=f.find(Y=>Y.items.some(q=>q.id===N))||f.find(Y=>Y.id===N);if(O&&L&&O===L){const Y=O.items.findIndex(V=>V.id===T),q=L.items.findIndex(V=>V.id===N);Y!==q&&t(V=>({...V,ingredientSections:V.ingredientSections.map(F=>F.id===O.id?{...F,items:ca(F.items,Y,q)}:F)}))}},v=(U,B,T,N)=>{const{groupId:O,index:L}=u;O!==null&&L!==null&&t(Y=>{const q=Y.ingredientSections.map(V=>{if(V.id!==O)return V;const F=[...V.items],I={...F[L],purchaseCost:U,unit:B,purchase_cost:T,content_amount:N},P=parseFloat(I.quantity),R=parseFloat(U);if(!isNaN(P)&&!isNaN(R)){const z=Ms(a,I.name),K=Ja(I,z),ue=B?B.trim().toLowerCase():"";let ye=0;ue==="g"||ue===""||ue==="ml"||ue===""||ue==="cc"||ue===""?ye=P/1e3*R:ye=P*R;const $=Number.isFinite(K)&&K>0?K:1;I.cost=Math.round(ye/$*100)/100}return F[L]=I,{...V,items:F}});return qn.getAllConversions().then(V=>o(V)),qo.invalidateCache(),{...Y,ingredientSections:q}})},x=u.isOpen&&u.groupId!==null&&u.index!==null?f.find(U=>U.id===u.groupId)?.items[u.index]:null,b=Ce.useCallback((U,B,T,N)=>{t(O=>{const L=O.ingredientSections.map(Y=>{if(Y.id!==U)return Y;const q=[...Y.items],V={...q[B],[T]:N};if(q[B]=V,["quantity","purchaseCost","unit","name","isAlcohol"].includes(T)){const F=parseFloat(V.quantity),I=parseFloat(V.purchaseCost),P=Ms(a,V.name),R=Ja(V,P),z=Number.isFinite(R)&&R>0?R:1;if(!isNaN(F)&&!isNaN(I)){let K=0;const ue=V.unit?V.unit.trim().toLowerCase():"";ue==="g"||ue===""||ue==="ml"||ue===""||ue==="cc"||ue===""?K=F/1e3*I:K=F*I;const ye=Math.round(K/z*100)/100;ye!==V.cost&&(V.cost=ye,q[B]=V)}}if(T==="name"){const F=i.get(ln(N)),I=Ms(a,N),P=ll(I?.itemCategory);if(P){const R=Px(V,P);Object.assign(V,R)}else F||(V.itemCategory=null);if(F){const R=typeof F=="object"?F.price:F,z=typeof F=="object"?F.vendor:null,K=typeof F=="object"?F.unit:null,ue=typeof F=="object"?F.size:null;if(V.purchaseCostRef=R,V.vendorRef=z,I&&I.packetSize){const Q=I.lastPrice!==null&&I.lastPrice!==void 0&&I.lastPrice!==""?I.lastPrice:R;let X=0;const fe=(I.packetUnit||"").trim().toLowerCase();["g",""].includes(fe)?(X=Q/I.packetSize*1e3,V.unit="g"):["kg",""].includes(fe)?(X=Q/I.packetSize,V.unit="g"):["ml","","cc",""].includes(fe)?(X=Q/I.packetSize*1e3,V.unit="ml"):["l",""].includes(fe)?(X=Q/I.packetSize,V.unit="ml"):(X=Q/I.packetSize,V.unit=I.packetUnit),V.purchaseCost=Math.round(X*100)/100}else{let Q=R,X=K;ue&&ue>1&&(["g",""].includes((K||"").toLowerCase())?(Q=R/ue*1e3,X="g"):["ml","","cc",""].includes((K||"").toLowerCase())?(Q=R/ue*1e3,X="ml"):["kg",""].includes(K?K.toLowerCase():"")?(Q=R/ue,X="g"):["l",""].includes(K?K.toLowerCase():"")?(Q=R/ue,X="ml"):Q=R/ue),V.purchaseCost||(V.purchaseCost=Math.round(Q*100)/100),!V.unit&&X&&(V.unit=X)}const ye=parseFloat(V.quantity),$=parseFloat(V.purchaseCost);if(!isNaN(ye)&&!isNaN($)){const Q=Ms(a,V.name),X=Ja(V,Q),fe=Number.isFinite(X)&&X>0?X:1,ke=V.unit?V.unit.trim().toLowerCase():"";let Ue=0;ke==="g"||ke===""||ke==="ml"||ke===""||ke==="cc"||ke===""?Ue=ye/1e3*$:Ue=ye*$,V.cost=Math.round(Ue/fe*100)/100}}else V.purchaseCostRef=null,V.vendorRef=null;q[B]=V}return{...Y,items:q}});return{...O,ingredientSections:L}})},[a,i,t]),_=Ce.useCallback((U,B,T)=>{t(N=>{const O=N.ingredientSections.map(L=>{if(L.id!==U)return L;const Y=[...L.items],q={...Y[B]};if(q.name=T.name,q.itemCategory=null,T.price)if(q.purchaseCostRef=T.price,q.vendorRef=T.source==="csv"?"CSV":"Master",T.source==="manual")if(T.size&&T.size>0){const P=(T.unit||"").trim().toLowerCase();if(["g",""].includes(P)){const R=T.price/T.size*1e3;q.purchaseCost=Math.round(R*100)/100,q.unit="g"}else if(["kg",""].includes(P)){const R=T.price/T.size;q.purchaseCost=Math.round(R*100)/100,q.unit="g"}else if(["ml","","cc",""].includes(P)){const R=T.price/T.size*1e3;q.purchaseCost=Math.round(R*100)/100,q.unit="ml"}else if(["l",""].includes(P)){const R=T.price/T.size;q.purchaseCost=Math.round(R*100)/100,q.unit="ml"}else{const R=T.price/T.size;q.purchaseCost=Math.round(R*100)/100,q.unit=T.unit}}else q.purchaseCost=T.price,q.unit=T.unit;else{const P=Ms(a,T.name);if(P&&P.packetSize){const R=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:T.price;let z=0;const K=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(K)?(z=R/P.packetSize*1e3,q.unit="g"):["kg",""].includes(K)?(z=R/P.packetSize,q.unit="g"):["ml","","cc",""].includes(K)?(z=R/P.packetSize*1e3,q.unit="ml"):["l",""].includes(K)?(z=R/P.packetSize,q.unit="ml"):(z=R/P.packetSize,q.unit=P.packetUnit),q.purchaseCost=Math.round(z*100)/100}else q.purchaseCost=T.price,q.unit=T.unit}const V=ll(T.itemCategory??T.item_category??Ms(a,T.name)?.itemCategory);if(V){const P=Px(q,V);Object.assign(q,P)}const F=parseFloat(q.quantity),I=parseFloat(q.purchaseCost);if(!isNaN(F)&&!isNaN(I)){const P=Ms(a,q.name),R=Ja(q,P),z=Number.isFinite(R)&&R>0?R:1,K=q.unit?q.unit.trim().toLowerCase():"";let ue=0;K==="g"||K===""||K==="ml"||K===""||K==="cc"||K===""?ue=F/1e3*I:ue=F*I,q.cost=Math.round(ue/z*100)/100}return Y[B]=q,{...L,items:Y}});return{...N,ingredientSections:O}})},[a,t]),C=Ce.useCallback((U,B)=>{t(T=>({...T,ingredientSections:T.ingredientSections.map(N=>N.id===U?{...N,items:N.items.filter((O,L)=>L!==B)}:N)}))},[t]),j=U=>{const B={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(T=>({...T,ingredientSections:T.ingredientSections.map(N=>N.id===U?{...N,items:[...N.items,B]}:N)}))},k=()=>{t(U=>({...U,ingredientSections:[...U.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},E=U=>{t(B=>({...B,ingredientSections:B.ingredientSections.filter(T=>T.id!==U)}))},D=(U,B)=>{t(T=>({...T,ingredientSections:T.ingredientSections.map(N=>N.id===U?{...N,name:B}:N)}))};return s.jsxs(oa,{sensors:h,collisionDetection:E0,onDragOver:m,onDragEnd:y,children:[s.jsxs("div",{className:"recipe-form-ingredients",children:[f.map(U=>s.jsx(ul,{id:U.id,items:U.items.map(B=>B.id),strategy:zo,children:s.jsxs(pk,{section:U,sections:f,onSectionChange:D,onRemoveSection:E,children:[U.items.map((B,T)=>(()=>{const N=Ms(a,B?.name),O=kb(N?.yieldPercent??N?.yield_percent??B?.yieldPercent??B?.yield_percent);return s.jsx(fk,{id:B.id,index:T,item:B,groupId:U.id,yieldPercentApplied:O,onChange:b,onRemove:C,handleSuggestionSelect:_,onOpenConversion:()=>d({isOpen:!0,groupId:U.id,index:T})},B.id)})()),s.jsx(se,{type:"button",variant:"ghost",onClick:()=>j(U.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},U.id)),s.jsx(se,{type:"button",variant:"secondary",onClick:k,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),s.jsx(H0,{dropAnimation:{sideEffects:Op({styles:{active:{opacity:"0.5"}}})},children:null}),s.jsx(Nb,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,groupId:null,index:null}),onApply:v,ingredientName:x?.name||"",currentCost:x?.purchaseCost,currentQuantity:x?.quantity,unit:x?.unit||"g",initialPurchaseCost:x?.purchase_cost,initialContentAmount:x?.content_amount})]})},gk=({id:n,index:t,item:i,groupId:a,onChange:o,onRemove:u})=>{const{attributes:d,listeners:f,setNodeRef:h,transform:m,transition:y,isDragging:v}=xl({id:n,data:{groupId:a,index:t}}),x={transform:Or.Translate.toString(m),transition:y,opacity:v?.3:1,position:"relative",zIndex:v?999:"auto"};return s.jsxs("div",{ref:h,style:{...x,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[s.jsx("div",{...d,...f,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),s.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),s.jsx("div",{style:{flex:1},children:s.jsx(kt,{textarea:!0,value:i.text,onChange:b=>o(a,t,b.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}})}),s.jsx("div",{className:"remove-button-cell",children:s.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(a,t),title:"",children:""})})]})},yk=({section:n,sections:t,onSectionChange:i,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=ec({id:n.id});return s.jsxs(an,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[s.jsx(kt,{value:n.name,onChange:d=>i(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),s.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&s.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),s.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&s.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},vk=({formData:n,setFormData:t})=>{w.useEffect(()=>{if(!n.stepSections){const x=n.stepGroups||[{id:"default",name:""}],_=(n.steps||[]||[]).map(E=>typeof E=="string"?{id:crypto.randomUUID(),text:E}:E),C=x.map(E=>({id:E.id,name:E.name,items:_.filter(D=>E.id==="default"&&!D.groupId?!0:D.groupId===E.id)})),j=new Set(C.flatMap(E=>E.items.map(D=>D.id))),k=_.filter(E=>!j.has(E.id));k.length>0&&(C.length>0?C[0].items.push(...k):C.push({id:"default",name:"",items:k})),C.length===0&&C.push({id:crypto.randomUUID(),name:"",items:[]}),t(E=>({...E,stepSections:C}))}},[n.steps,n.stepGroups,n.stepSections,t]);const i=n.stepSections||[],a=gl(vr(Jo,{activationConstraint:{distance:10}}),vr(Xo,{activationConstraint:{delay:250,tolerance:5}}),vr(vl,{coordinateGetter:ed})),o=({active:x,over:b})=>{if(!b)return;const _=x.id,C=b.id,j=i.find(E=>E.items.some(D=>D.id===_)),k=i.find(E=>E.items.some(D=>D.id===C))||i.find(E=>E.id===C);!j||!k||j===k||t(E=>{const D=j.items,U=k.items,B=D.findIndex(O=>O.id===_),T=U.findIndex(O=>O.id===C);let N;if(C===k.id)N=U.length+1;else{const L=b&&x.rect.current.translated&&x.rect.current.translated.top>b.rect.top+b.rect.height?1:0;N=T>=0?T+L:U.length+1}return{...E,stepSections:E.stepSections.map(O=>O.id===j.id?{...O,items:D.filter(L=>L.id!==_)}:O.id===k.id?{...O,items:[...U.slice(0,N),D[B],...U.slice(N,U.length)]}:O)}})},u=({active:x,over:b})=>{if(!b)return;const _=x.id,C=b.id,j=i.find(E=>E.items.some(D=>D.id===_)),k=i.find(E=>E.items.some(D=>D.id===C))||i.find(E=>E.id===C);if(j&&k&&j===k){const E=j.items.findIndex(U=>U.id===_),D=k.items.findIndex(U=>U.id===C);E!==D&&t(U=>({...U,stepSections:U.stepSections.map(B=>B.id===j.id?{...B,items:ca(B.items,E,D)}:B)}))}},d=(x,b,_)=>{t(C=>({...C,stepSections:C.stepSections.map(j=>{if(j.id!==x)return j;const k=[...j.items];return k[b]={...k[b],text:_},{...j,items:k}})}))},f=(x,b)=>{t(_=>({..._,stepSections:_.stepSections.map(C=>C.id===x?{...C,items:C.items.filter((j,k)=>k!==b)}:C)}))},h=x=>{const b={id:crypto.randomUUID(),text:""};t(_=>({..._,stepSections:_.stepSections.map(C=>C.id===x?{...C,items:[...C.items,b]}:C)}))},m=()=>{t(x=>({...x,stepSections:[...x.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},y=x=>{t(b=>({...b,stepSections:b.stepSections.filter(_=>_.id!==x)}))},v=(x,b)=>{t(_=>({..._,stepSections:_.stepSections.map(C=>C.id===x?{...C,name:b}:C)}))};return s.jsxs(oa,{sensors:a,collisionDetection:E0,onDragOver:o,onDragEnd:u,children:[s.jsxs("div",{className:"recipe-form-steps",children:[i.map(x=>s.jsx(ul,{id:x.id,items:x.items.map(b=>b.id),strategy:zo,children:s.jsxs(yk,{section:x,sections:i,onSectionChange:v,onRemoveSection:y,children:[x.items.map((b,_)=>s.jsx(gk,{id:b.id,index:_,item:b,groupId:x.id,onChange:d,onRemove:f},b.id)),s.jsx(se,{type:"button",variant:"ghost",onClick:()=>h(x.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},x.id)),s.jsx(se,{type:"button",variant:"secondary",onClick:m,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),s.jsx(H0,{dropAnimation:{sideEffects:Op({styles:{active:{opacity:"0.5"}}})},children:null})]})},Tb=({onClose:n,onImport:t,initialMode:i="url"})=>{const a=ua(),[o,u]=w.useState(i),[d,f]=w.useState(null),[h,m]=w.useState(""),[y,v]=w.useState(""),[x,b]=w.useState(null),[_,C]=w.useState(null),[j,k]=w.useState(!1),[E,D]=w.useState(!1),[U,B]=w.useState(null),[T,N]=w.useState(!1),O=w.useRef(null),L=w.useRef(null),Y=w.useRef(null),q=w.useRef(null),V=()=>{q.current&&(clearTimeout(q.current),q.current=null)},F=(G="")=>{if(V(),Y.current){try{Y.current.abort()}catch{}Y.current=null}D(!1),G&&B(G)};w.useEffect(()=>()=>{if(V(),Y.current){try{Y.current.abort()}catch{}Y.current=null}},[]),w.useEffect(()=>{if(!x){C(null);return}const G=URL.createObjectURL(x);return C(G),()=>URL.revokeObjectURL(G)},[x]);const I=G=>new Promise(oe=>{if(!G||typeof G!="object")return oe(G);const pe=String(G.type||"").toLowerCase();if(!pe.startsWith("image/"))return oe(G);const je=2e6,Ie=2e3,Be=.9,Pe=String(G.name||"").toLowerCase(),lt=pe.includes("heic")||pe.includes("heif")||Pe.endsWith(".heic")||Pe.endsWith(".heif"),rt=URL.createObjectURL(G);let qe=!1;const xe=We=>{if(!qe){qe=!0;try{URL.revokeObjectURL(rt)}catch{}oe(We)}},_e=setTimeout(()=>xe(G),15e3),te=new Image;te.onload=()=>{const We=te.naturalWidth||te.width||0,Tt=te.naturalHeight||te.height||0;if(!We||!Tt)return clearTimeout(_e),xe(G);const Ct=Math.min(1,Ie/Math.max(We,Tt)),le=Math.max(1,Math.round(We*Ct)),Ae=Math.max(1,Math.round(Tt*Ct)),Oe=Ct<1,Ge=lt||G.size>je;if(!Oe&&!Ge)return clearTimeout(_e),xe(G);const nt=document.createElement("canvas");nt.width=le,nt.height=Ae;const St=nt.getContext("2d");if(!St)return clearTimeout(_e),xe(G);St.drawImage(te,0,0,le,Ae),nt.toBlob(on=>{if(clearTimeout(_e),!on)return xe(G);const Tn=String(G.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);xe(new File([on],`${Tn}.jpg`,{type:"image/jpeg"}))},"image/jpeg",Be)},te.onerror=()=>{clearTimeout(_e),xe(G)},te.src=rt}),P=async G=>{if(G){if(!String(G.type||"").startsWith("image/")){B("");return}B(null),k(!0);try{const oe=await I(G);b(oe||G)}finally{k(!1)}}},R=()=>O.current?.click?.(),z=()=>L.current?.click?.(),K=G=>{G.preventDefault(),G.stopPropagation(),G.type==="dragenter"||G.type==="dragover"?N(!0):G.type==="dragleave"&&N(!1)},ue=G=>{if(G.preventDefault(),G.stopPropagation(),N(!1),G.dataTransfer.files&&G.dataTransfer.files[0]){const oe=G.dataTransfer.files[0];oe.type.startsWith("image/")&&P(oe)}},ye=G=>/[---]/.test(G||""),$=G=>typeof G=="string"?G.trim():G&&typeof G=="object"?String(G.text||G.name||"").trim():"",Q=async G=>{try{const oe=[];oe.push((G.name||G.title||"").trim()),oe.push((G.description||"").trim());const pe=[];Array.isArray(G.ingredients)&&G.ingredients.forEach((xe,_e)=>{if(typeof xe=="string"){const We=xe.trim();if(!We)return;oe.push(We),pe.push(_e);return}const te=String(xe?.name||xe?.text||"").trim();te&&(oe.push(te),pe.push(_e))});const je=[];if(Array.isArray(G.steps)&&G.steps.forEach((xe,_e)=>{const te=$(xe);te&&(oe.push(te),je.push(_e))}),!oe.some(xe=>String(xe||"").trim()))return G;const{data:Ie,error:Be}=await Re.functions.invoke("translate",{body:{text:oe,target_lang:"JA"}});if(Be)throw Be;if(!Array.isArray(Ie?.translations))throw new Error("Invalid translation response payload");const Pe=Ie.translations.map(xe=>xe.text);let lt=0;const rt={...G},qe=Pe[lt++]||rt.name||rt.title||"";if(rt.name=qe,rt.title=qe,rt.description=Pe[lt++]||rt.description,pe.length>0){const xe=new Map;pe.forEach((_e,te)=>{xe.set(_e,Pe[lt+te])}),rt.ingredients=rt.ingredients.map((_e,te)=>{const We=xe.get(te);return We?typeof _e=="string"?We:_e&&typeof _e=="object"?{..._e,name:We}:_e:_e}),lt+=pe.length}if(je.length>0){const xe=new Map;je.forEach((_e,te)=>{xe.set(_e,Pe[lt+te])}),rt.steps=rt.steps.map((_e,te)=>{const We=xe.get(te);return We?_e&&typeof _e=="object"?{..._e,text:We}:We:_e})}return rt}catch(oe){return console.error("Translation failed:",oe),a.warning(""),G}},[X,fe]=w.useState([]),ke=async(G,oe)=>{const pe="REDACTED_GOOGLE_API_KEY";if(G.size>4e6)return null;const Ie=await G.arrayBuffer(),Be=btoa(new Uint8Array(Ie).reduce((te,We)=>te+String.fromCharCode(We),"")),Pe=G.type||"image/jpeg",rt=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${pe}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`


: 
- 
- 

JSONJSON
\`\`\`json
{
  "title": "",
  "description": "",
  "ingredients": [
    { "name": "", "quantity": "", "unit": "", "group": null }
  ],
  "steps": ["1...", "2..."]
}
\`\`\`


- 115ml, 15ml, 1200ml 
- 
- `},{inline_data:{mime_type:Pe,data:Be}}]}]}),signal:oe});if(!rt.ok){const te=await rt.text();throw console.error("Gemini API Error:",rt.status,te),new Error(`Gemini API Error: ${rt.status}`)}const xe=(await rt.json()).candidates?.[0]?.content?.parts?.[0]?.text;if(!xe)throw new Error("Gemini");let _e=xe;return _e.includes("```json")?_e=_e.split("```json")[1].split("```")[0]:_e.includes("```")&&(_e=_e.split("```")[1].split("```")[0]),{recipe:JSON.parse(_e.trim()),rawText:xe}},Ue=async()=>{D(!0),B(null),fe([]);try{let G,oe="";if(o==="url"){if(!y)return;oe=y;const{data:Be,error:Pe}=await Re.functions.invoke("scrape-recipe",{body:{url:y}});if(Pe)throw Pe;G=Be}else{if(!x)return;V();const Be=new AbortController;Y.current=Be;const Pe=12e4;q.current=setTimeout(()=>{F("")},Pe);const lt="REDACTED_GOOGLE_API_KEY";let rt=!1;if(lt){fe(qe=>[...qe," Gemini API..."]);try{const qe=await ke(x,Be.signal);qe&&qe.recipe&&qe.recipe.title&&(fe(xe=>[...xe," "]),G={recipe:qe.recipe,rawText:qe.rawText},rt=!0)}catch(qe){if(qe.name==="AbortError")throw qe;console.warn("Direct Gemini failed, falling back to Edge Function:",qe.message),fe(xe=>[...xe,` API: ${qe.message}`])}}if(!rt){fe(Ct=>[...Ct," ..."]);const qe=new FormData;qe.append("image",x);const{data:{session:xe}}=await Re.auth.getSession(),te=`${Re.supabaseUrl||"https://hocbnifuactbvmyjraxy.supabase.co"}/functions/v1/analyze-image`,We={Authorization:`Bearer ${xe?.access_token||void 0||Re.supabaseKey}`};let Tt;try{Tt=await fetch(te,{method:"POST",headers:We,body:qe,signal:Be.signal})}catch(Ct){throw console.error("Network Error:",Ct),new Error("")}if(!Tt.ok){const Ct=Tt.status;throw new Error(`Server Error: ${Tt.statusText} (${Ct})`)}if(!Tt.body)G=await Tt.json();else{const Ct=Tt.body.getReader(),le=new TextDecoder;let Ae=null,Oe="",Ge=!1;for(;;){const{done:nt,value:St}=await Ct.read();if(nt)break;Oe+=le.decode(St,{stream:!0});const on=Oe.split(`

`);Oe=on.pop()||"";for(const Tn of on){const Jt=Tn.trim();if(Jt.startsWith("data: "))try{const dt=JSON.parse(Jt.slice(6));if(dt.type==="log")fe(tn=>[...tn,dt.message]);else if(dt.type==="result")Ae=dt,Ge=!0;else if(dt.type==="error")throw new Error(dt.message)}catch(dt){if(dt.message&&!dt.message.includes("Failed to parse"))throw dt;console.warn("Failed to parse SSE event",dt)}}if(Ge)break}try{await Ct.cancel()}catch{}if(!Ae)throw new Error("");G=Ae}}}if(G.error)throw new Error(G.error);if(!G.recipe)throw new Error("No recipe found");let pe=G.recipe;if(pe.title=pe.title||pe.name||"",pe.name=pe.name||pe.title||"",pe.recipeYield=pe.recipeYield||pe.servings||"",pe.description=pe.description||"",!pe.ingredients&&pe.recipeIngredient&&(pe.ingredients=pe.recipeIngredient),Array.isArray(pe.ingredients)){const Be=["","","method","instructions","steps","preparation"],Pe=[],lt=[];pe.ingredients.forEach(rt=>{const qe=(rt.group||"").trim().toLowerCase();if(qe&&Be.some(xe=>qe===xe||qe.includes(xe))){const xe=rt.name||rt.text||"";xe&&lt.push(xe)}else Pe.push(rt)}),lt.length>0&&(console.log("Extracted steps from ingredients:",lt),pe.ingredients=Pe,pe.steps=Array.isArray(pe.steps)?pe.steps:[],pe.steps=[...pe.steps,...lt])}const je=Array.isArray(pe.steps)?pe.steps.slice(0,3).map(Be=>$(Be)).join(""):"",Ie=`${pe.name||pe.title||""}${je}`;if(Ie&&!ye(Ie)){f(pe),m(oe),u("confirm-translation"),D(!1);return}t(pe,oe),n()}catch(G){if(console.error("Import failed details:",G),G?.name==="AbortError")return;const oe=G.message||"Import failed. Please try again.";B(oe)}finally{V(),Y.current=null,o!=="confirm-translation"&&D(!1)}},de=async G=>{D(!0);try{let oe=d;G&&(oe=await Q(d)),t(oe,h),n()}catch(oe){console.error("Translation flow error:",oe),B("Translation failed. Importing original."),t(d,h),n()}finally{D(!1)}},H=G=>{const oe=G.target.files[0];oe&&P(oe),G.target.value=""};return s.jsxs("div",{className:"modal-overlay fade-in",children:[E&&s.jsxs("div",{className:"loading-overlay",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"..."}),X.length>0&&s.jsx("div",{className:"progress-log-container",children:s.jsxs("div",{className:"progress-log",children:[X.map((G,oe)=>s.jsx("div",{className:"log-entry",children:s.jsx("span",{className:"log-message",children:G})},oe)),s.jsx("div",{ref:G=>G?.scrollIntoView({behavior:"smooth"})})]})}),s.jsx("div",{style:{marginTop:"0.9rem",display:"flex",justifyContent:"center"},children:s.jsx(se,{type:"button",variant:"secondary",onClick:()=>F(),children:""})})]}),s.jsxs(an,{className:"import-modal-card",children:[s.jsx("h3",{className:"modal-title",children:o==="confirm-translation"?"":""}),o==="confirm-translation"?s.jsxs("div",{className:"translation-confirm-content",children:[s.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[s.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),s.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),s.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",s.jsx("br",{}),s.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),s.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[s.jsx(se,{type:"button",variant:"primary",onClick:()=>de(!0),isLoading:E,style:{width:"100%"},children:""}),s.jsx(se,{type:"button",variant:"secondary",onClick:()=>de(!1),disabled:E,style:{width:"100%"},children:""})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"import-mode-tabs",children:[s.jsx("button",{type:"button",onClick:()=>u("url"),className:`tab-btn tab-import-web ${o==="url"?"active":""}`,children:" Web URL"}),s.jsx("button",{type:"button",onClick:()=>u("image"),className:`tab-btn tab-import-image ${o==="image"?"active":""}`,children:"  (Best Effort)"})]}),o==="url"?s.jsxs(s.Fragment,{children:[s.jsx("p",{children:"URL"}),s.jsx("input",{type:"url",placeholder:"https://...",value:y,onChange:G=>v(G.target.value),className:"import-url-input",autoFocus:!0})]}):s.jsxs(s.Fragment,{children:[s.jsx("p",{children:""}),s.jsxs("div",{className:"image-upload-wrapper",children:[s.jsx("input",{ref:O,type:"file",accept:"image/*",capture:"environment",onChange:H,className:"image-upload-input"}),s.jsx("input",{ref:L,type:"file",accept:"image/*",onChange:H,className:"image-upload-input"}),s.jsx("div",{onDragEnter:K,onDragLeave:K,onDragOver:K,onDrop:ue,className:`image-upload-label ${T?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{E||j||z()},onKeyDown:G=>{E||j||(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),z())},children:_?s.jsx("img",{src:_,alt:"Preview",className:"image-upload-preview"}):T?"":""}),s.jsxs("div",{className:"image-upload-actions",children:[s.jsx(se,{type:"button",variant:"secondary",onClick:R,disabled:E||j,children:""}),s.jsx(se,{type:"button",variant:"secondary",onClick:z,disabled:E||j,children:""})]})]}),j&&s.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),U&&s.jsx("p",{className:"error-text",children:U}),s.jsxs("div",{className:"modal-actions",children:[s.jsx(se,{type:"button",variant:"ghost",onClick:n,disabled:E,children:""}),s.jsx(se,{type:"button",variant:"primary",onClick:Ue,isLoading:E,disabled:j||(o==="url"?!y:!x),children:""})]})]})]})]})},Fx=({onSave:n,onCancel:t,initialData:i})=>{const a=i||{},[o,u]=w.useState("ingredients"),[d,f]=w.useState(null),[h,m]=w.useState(new Map);Ce.useEffect(()=>{(async()=>{const I=await sr.fetchPriceList();m(I)})()},[]);const y=w.useMemo(()=>{const F=a.steps||[""];let I=a.stepGroups||[];const P=F.some(z=>typeof z=="object"&&z.group);if(I.length===0&&P){const z=new Map;F.forEach(K=>{typeof K=="object"&&K.group&&!z.has(K.group)&&z.set(K.group,crypto.randomUUID())}),I=Array.from(z.entries()).map(([K,ue])=>({id:ue,name:K}))}return{steps:F.map(z=>{const K=typeof z=="string"?z:z.text||"",ue=typeof z=="object"&&z.id?z.id:crypto.randomUUID();let ye=typeof z=="object"?z.groupId:void 0;const $=typeof z=="object"?z.group:void 0;if(!ye&&$&&I.length>0){const Q=I.find(X=>X.name===$);Q&&(ye=Q.id)}return{id:ue,text:K,groupId:ye}}),stepGroups:I}},[a]),v=y.steps,x=y.stepGroups,b=w.useMemo(()=>{const F=a.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let I=a.ingredientGroups||[];if(I.length===0&&F.some(R=>R.group)){const R=new Map;F.forEach(z=>{z.group&&!R.has(z.group)&&R.set(z.group,crypto.randomUUID())}),I=Array.from(R.entries()).map(([z,K])=>({id:K,name:z})),R.size>0&&F.some(z=>!z.group)}return{ingredients:F.map(R=>{const z=typeof R=="string"?{name:R,quantity:"",unit:"",cost:"",purchaseCost:""}:{...R,cost:R.cost||"",purchaseCost:R.purchaseCost||""};let K=z.groupId;if(!K&&z.group&&I.length>0){const ue=I.find(ye=>ye.name===z.group);ue&&(K=ue.id)}return{...z,id:z.id||crypto.randomUUID(),groupId:K}}),ingredientGroups:I}},[a]),_=b.ingredients,C=b.ingredientGroups,[j,k]=w.useState({title:a.title||"",description:a.description||"",image:a.image||"",imageFile:null,storeName:a.storeName||"",servings:a.servings||"",ingredients:_,ingredientGroups:C,steps:v,stepGroups:x,tags:a.tags||[""],course:a.course||"",category:a.category||"",type:a.type||"normal",flours:a.flours||[],breadIngredients:a.breadIngredients||[],sourceUrl:a.sourceUrl||""}),[E,D]=w.useState(!1),U=(F,I="")=>{const P=new Map,R=F.ingredients||[];R.forEach(X=>{let fe=X.group||"";fe==="Main"&&(fe=""),P.has(fe)||P.set(fe,crypto.randomUUID())});const z=Array.from(P.entries()).map(([X,fe])=>({id:fe,name:X})),K=R.map(X=>{let fe=X.group||"";fe==="Main"&&(fe="");let ke;return P.has(fe)&&(ke=P.get(fe)),{id:crypto.randomUUID(),name:X.name||"",quantity:X.quantity||"",unit:X.unit||"",cost:"",purchaseCost:"",groupId:ke}}),ue=new Map,ye=F.steps||[];ye.forEach(X=>{typeof X=="object"&&X.group&&X.group!=="Main"&&(ue.has(X.group)||ue.set(X.group,crypto.randomUUID()))});const $=Array.from(ue.entries()).map(([X,fe])=>({id:fe,name:X})),Q=ye.map(X=>{const fe=typeof X=="object",ke=fe?X.text||"":X,Ue=fe?X.group:null;let de;return Ue&&ue.has(Ue)&&(de=ue.get(Ue)),{id:crypto.randomUUID(),text:ke,groupId:de}});k(X=>({...X,title:F.name||F.title||X.title,description:F.description||X.description,category:I?"URL":F.category||X.category,image:F.image||X.image,servings:F.recipeYield||F.servings||X.servings,ingredients:K,ingredientGroups:z,steps:Q,stepGroups:$,ingredientSections:void 0,stepSections:void 0,sourceUrl:I||X.sourceUrl})),f(null),u("ingredients")},B=F=>{F.preventDefault(),F.stopPropagation(),F.type==="dragenter"||F.type==="dragover"?D(!0):F.type==="dragleave"&&D(!1)},T=F=>{if(F.preventDefault(),F.stopPropagation(),D(!1),F.dataTransfer.files&&F.dataTransfer.files[0]){const I=F.dataTransfer.files[0];I.type.startsWith("image/")&&k(P=>({...P,imageFile:I,image:URL.createObjectURL(I)}))}},N=F=>{const{id:I,value:P}=F.target;k(R=>({...R,[I]:P}))},O=F=>{const I=F.target.files[0];I&&k(P=>({...P,imageFile:I,image:URL.createObjectURL(I)}))},L=w.useMemo(()=>{if(j.type==="bread")return(j.flours?.length||0)+(j.breadIngredients?.length||0);const F=j.ingredientSections||[];return F.length>0?F.reduce((I,P)=>I+(P?.items?.length||0),0):j.ingredients?.length||0},[j.breadIngredients,j.flours,j.ingredientSections,j.ingredients,j.type]),Y=w.useMemo(()=>{const F=j.stepSections||[];return F.length>0?F.reduce((I,P)=>I+(P?.items?.length||0),0):j.steps?.length||0},[j.stepSections,j.steps]),q=F=>{F.preventDefault();let I=[],P=[];if(j.type==="bread")I=j.ingredients.map($=>{const{id:Q,...X}=$;return X});else{const $=j.ingredientSections||[];$.length===0&&j.ingredients.length>0?I=j.ingredients.map(Q=>{const{id:X,...fe}=Q;return fe}):(I=$.flatMap(Q=>Q.items.map(X=>({...X,groupId:Q.id}))).map(Q=>{const{id:X,...fe}=Q;return fe}),P=$.map(Q=>({id:Q.id,name:Q.name})))}const R=new Set(j.tags||[]);j.course&&R.add(j.course),j.category&&R.add(j.category),j.type==="bread"&&R.add("");const z=Array.from(R).filter(Boolean);let K=[],ue=[];const ye=j.stepSections||[];ye.length===0&&j.steps.length>0?K=j.steps.map($=>typeof $=="string"?{text:$}:$):(K=ye.flatMap($=>$.items.map(Q=>({text:Q.text,groupId:$.id}))),ue=ye.map($=>({id:$.id,name:$.name}))),n({...j,ingredients:I,ingredientGroups:P,steps:K,stepGroups:ue,image:j.imageFile||j.image,id:a.id||Date.now(),tags:z,ingredientSections:void 0,stepSections:void 0})},V=!!a?.id;return s.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:q,children:[d&&s.jsx(Tb,{onClose:()=>f(null),onImport:U,initialMode:d}),s.jsxs("div",{className:"recipe-form-mock__page",children:[s.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:s.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[s.jsxs("div",{className:"recipe-form-mock__crumb",children:[s.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),s.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),s.jsx("span",{className:"recipe-form-mock__crumb-page",children:V?"":""})]}),s.jsxs("div",{className:"recipe-form-mock__actions",children:[s.jsx(se,{type:"button",variant:"ghost",onClick:t,children:""}),s.jsx(se,{type:"submit",variant:"primary",children:""})]})]})}),s.jsxs("div",{className:"recipe-form-mock__sheet",children:[s.jsxs("header",{className:"recipe-form-mock__doc",children:[s.jsxs("div",{className:"recipe-form-mock__doc-title",children:[s.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:j.title,onChange:N,placeholder:"",required:!0}),s.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),s.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[s.jsxs("div",{className:"recipe-form-mock__meta-field",children:[s.jsx(kt,{label:"",id:"course",value:j.course,onChange:N,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),s.jsxs("datalist",{id:"course-options",children:[s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""})]})]}),s.jsxs("div",{className:"recipe-form-mock__meta-field",children:[s.jsx(kt,{label:"",id:"category",value:j.category,onChange:N,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),s.jsxs("datalist",{id:"category-options",children:[s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""})]})]}),s.jsxs("div",{className:"recipe-form-mock__meta-field",children:[s.jsx(kt,{label:"",id:"storeName",value:j.storeName,onChange:N,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),s.jsx("datalist",{id:"store-options",children:Pu.map(F=>s.jsx("option",{value:F},F))})]}),s.jsx("div",{className:"recipe-form-mock__meta-field",children:s.jsx(kt,{label:"",id:"servings",value:j.servings,onChange:N,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),s.jsxs("div",{className:"recipe-form-mock__grid",children:[s.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[s.jsxs(an,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[s.jsx("div",{className:"recipe-form-mock__card-title",children:""}),s.jsx(kt,{label:"",id:"description",textarea:!0,value:j.description,onChange:N,placeholder:"..."}),s.jsx(kt,{label:"URL",id:"sourceUrl",value:j.sourceUrl||"",onChange:N,placeholder:"https://example.com/recipe/..."})]}),s.jsxs(an,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[s.jsx("div",{className:"recipe-form-mock__card-title",children:""}),s.jsxs("div",{className:`recipe-form-mock__image-drop ${E?"is-active":""}`,onDragEnter:B,onDragLeave:B,onDragOver:B,onDrop:T,children:[j.image?s.jsxs("div",{className:"recipe-form-mock__image-preview",children:[s.jsx("img",{src:j.image,alt:"",onError:F=>{F.target.style.display="none"}}),s.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>k(F=>({...F,image:"",imageFile:null})),title:"",children:""})]}):s.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",s.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),s.jsx("input",{type:"file",accept:"image/*",onChange:O,className:"recipe-form-mock__image-input"})]})]}),!a?.id&&s.jsxs(an,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[s.jsx("div",{className:"recipe-form-mock__card-title",children:""}),s.jsxs("div",{className:"recipe-form-mock__import-actions",children:[s.jsx(se,{variant:"secondary",type:"button",onClick:()=>f("url"),children:"URL"}),s.jsx(se,{variant:"secondary",type:"button",onClick:()=>f("image"),children:""})]}),s.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),s.jsxs(an,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[s.jsx("div",{className:"recipe-form-mock__card-title",children:""}),s.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[s.jsx("li",{children:""}),s.jsx("li",{children:""}),s.jsx("li",{children:""})]})]})]}),s.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:s.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[s.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[s.jsxs("div",{className:"recipe-form-mock__nav",children:[s.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",s.jsx("span",{className:"recipe-form-mock__nav-count",children:L.toLocaleString()})]}),s.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${o==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",s.jsx("span",{className:"recipe-form-mock__nav-count",children:Y.toLocaleString()})]})]}),s.jsx("div",{className:"recipe-form-mock__workspace-right",children:o==="ingredients"?s.jsxs("div",{className:"recipe-form-mock__segmented",children:[s.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="normal"?"active":""}`,onClick:()=>k(F=>({...F,type:"normal"})),children:""}),s.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="bread"?"active":""}`,onClick:()=>k(F=>({...F,type:"bread"})),children:""})]}):s.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),s.jsx("div",{className:"recipe-form-mock__workspace-body",children:o==="ingredients"?s.jsx("div",{className:"recipe-form-mock__editor-surface",children:j.type==="bread"?s.jsx(ik,{formData:j,setFormData:k}):s.jsx(mk,{formData:j,setFormData:k,priceList:h})}):s.jsx("div",{className:"recipe-form-mock__editor-surface",children:s.jsx(vk,{formData:j,setFormData:k})})})]})})]})]})]})]})},xk="modulepreload",bk=function(n){return"/app/"+n},Hx={},Tu=function(t,i,a){let o=Promise.resolve();if(i&&i.length>0){let h=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");o=h(i.map(m=>{if(m=bk(m),m in Hx)return;Hx[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":xk,y||(x.as="script"),x.crossOrigin="",x.href=m,f&&x.setAttribute("nonce",f),document.head.appendChild(x),y)return new Promise((b,_)=>{x.addEventListener("load",b),x.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return o.then(d=>{for(const f of d||[])f.status==="rejected"&&u(f.reason);return t().catch(u)})},wk=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},ia={async fetchAllProfiles(){try{const{data:t,error:i}=await Re.rpc("admin_list_profiles");if(!i&&Array.isArray(t))return t;i&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",i)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const n=await Re.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await Re.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const a=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let o=null;if(a)try{const{data:d,error:f}=await Re.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(f)throw f;if(d){const h=wk(d);if(h)return h}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),o=d}const u=await Re.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(o&&a)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${o.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await Re.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminResetPassword(n,t){const{data:i,error:a}=await Re.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(a)throw a;if(i?.error)throw new Error(i.error);return i},async sendPasswordResetEmail(n){const{error:t}=await Re.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(t)throw t;return!0}},Gx="csv_unit_overrides",Vx=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),Fu={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:i,error:a}=await Re.from(Gx).select("ingredient_name,csv_unit").eq("user_id",t);if(a){if(Vx(a))return new Map;throw a}const o=new Map;return(i||[]).forEach(u=>{u?.ingredient_name&&o.set(String(u.ingredient_name),String(u.csv_unit||""))}),o}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim(),u=String(t||"").trim();if(!o)throw new Error("");if(!u)throw new Error("");const{data:d,error:f}=await Re.from(Gx).upsert({user_id:a,ingredient_name:o,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(f)throw Vx(f)?new Error("DB csv_unit_overrides "):f;return d}},Sk=()=>{const n=ua(),{user:t}=us(),[i,a]=w.useState([]),[o,u]=w.useState(""),[d,f]=w.useState("all"),[h,m]=w.useState(null),[y,v]=w.useState(!1),[x,b]=w.useState(new Map),[_,C]=w.useState(new Map),[j,k]=w.useState({}),[E,D]=w.useState(!1),[U,B]=w.useState([]),[T,N]=w.useState(!1),[O,L]=w.useState(""),[Y,q]=w.useState(""),[V,F]=w.useState(!1),[I,P]=w.useState(!1),[R,z]=w.useState(null),[K,ue]=w.useState(!1),ye="manual",$=le=>{const Ae=String(le||"").trim();return!Ae||Ae==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(Ae)?Ae:"food"},Q=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:ye,label:""}],X=w.useCallback(le=>{const Ae=ln(le);return Ae?x?.has(Ae):!1},[x]),fe=Ce.useMemo(()=>{const le={all:i.length,food:0,alcohol:0,soft_drink:0,supplies:0,[ye]:0};return i.forEach(Ae=>{const Oe=$(Ae?.itemCategory);le[Oe]=(le[Oe]||0)+1,X(Ae?.ingredientName)||(le[ye]=(le[ye]||0)+1)}),le},[i,X]),ke=w.useCallback(async()=>{v(!0);try{const[le,Ae,Oe]=await Promise.all([qn.getAllConversions(),sr.fetchPriceList(),Fu.getAll()]),Ge=Array.from(le.values()).map(nt=>({...nt,clientId:nt.ingredientName,isNew:!1,isEditing:!1}));b(Ae||new Map),C(Oe||new Map),a(Ge.sort((nt,St)=>nt.ingredientName.localeCompare(St.ingredientName,"ja")))}catch(le){n.error(""),console.error("Failed to load ingredients:",le)}v(!1)},[n]);w.useEffect(()=>{const le=setTimeout(()=>{ke()},0);return()=>clearTimeout(le)},[ke]);const Ue=()=>{const le=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,Ae=["food","alcohol","soft_drink","supplies"].includes(d)?d:"food",Oe={clientId:le,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:Ae,isNew:!0,isEditing:!0};a(Ge=>[Oe,...Ge.map(nt=>({...nt,isEditing:!1}))]),m(le)},de=w.useCallback(le=>i.findIndex(Ae=>Ae?.clientId===le),[i]),H=async le=>{const Ae=de(le);if(Ae<0)return;const Oe=i[Ae];if(!Oe.ingredientName||!Oe.packetSize||!Oe.lastPrice){n.warning("");return}const Ge=parseFloat(Oe.yieldPercent),nt=Number.isFinite(Ge)?Ge:100;if(nt<=0||nt>100){n.warning("% 1100 ");return}try{await qn.saveConversion(Oe.ingredientName,Oe.packetSize,Oe.packetUnit,Oe.lastPrice,Oe.itemCategory,Oe.vendor,nt),n.success(""),ke(),m(null)}catch(St){n.error(""),console.error("Save error:",St)}},G=async le=>{const Ae=de(le);if(Ae<0)return;const Oe=i[Ae],Ge=Oe?.ingredientName;if(Oe.isNew){a(nt=>nt.filter(St=>St?.clientId!==le)),m(null);return}try{await qn.deleteConversion(Ge),n.success(""),ke()}catch(nt){n.error(""),console.error("Delete error:",nt)}},oe=le=>{m(le),a(Ae=>Ae.map(Oe=>({...Oe,isEditing:Oe?.clientId===le})))},pe=le=>{const Ae=de(le);Ae<0||(i[Ae].isNew?a(Oe=>Oe.filter(Ge=>Ge?.clientId!==le)):ke(),m(null))},je=(le,Ae,Oe)=>{a(Ge=>Ge.map(nt=>nt?.clientId!==le?nt:{...nt,[Ae]:Oe}))},Ie=le=>{const Ae=parseFloat(le.lastPrice),Oe=parseFloat(le.packetSize);if(!Ae||!Oe)return"-";const Ge=le.packetUnit?le.packetUnit.trim().toLowerCase():"";return Ge==="g"||Ge===""?`${Math.round(Ae/Oe*1e3).toLocaleString()}/kg`:Ge==="ml"||Ge==="cc"||Ge===""||Ge===""?`${Math.round(Ae/Oe*1e3).toLocaleString()}/L`:`${Math.round(Ae/Oe).toLocaleString()}/${le.packetUnit}`},Be=i.filter(le=>{const Ae=String(le?.ingredientName||"");return Ae.toLowerCase().includes(o.toLowerCase())?d==="all"?!0:d===ye?!X(Ae):$(le?.itemCategory)===d:!1}),Pe=d!=="all"||String(o||"").trim()!=="",lt=le=>{const Ae=ln(le);if(!Ae)return"-";const Ge=(x?.get(Ae)||null)?.unit;return Ge?String(Ge):"-"},rt=le=>{const Ae=ln(le);if(!Ae)return"";const Ge=(x?.get(Ae)||null)?.vendor;return Ge?String(Ge):""},qe=le=>{const Ae=String(le?.vendor||"").trim();return Ae||rt(le?.ingredientName)},xe=le=>{const Ae=(le??"").toString().trim();if(!Ae)return"";if(Object.prototype.hasOwnProperty.call(j,Ae))return j[Ae];const Oe=_?.get(Ae);if(Oe)return String(Oe);const Ge=lt(Ae);return Ge==="-"?"":Ge},_e=le=>{const Ae=(le??"").toString().trim();if(!Ae)return"-";const Oe=_?.get(Ae);return Oe?String(Oe):lt(Ae)},te=async(le,Ae)=>{const Oe=(le??"").toString().trim(),Ge=(Ae??"").toString().trim();if(Oe){if(!Ge){k(nt=>{const St={...nt};return delete St[Oe],St});return}try{await Fu.upsert(Oe,Ge),C(nt=>{const St=new Map(nt);return St.set(Oe,Ge),St}),n.success("CSV")}catch(nt){console.error(nt),n.error(nt?.message||"")}}},We=async()=>{if(t?.role==="admin"){D(!0),L(""),B([]),q(""),F(!1),z(null),ue(!1),N(!0);try{const le=await ia.fetchAllProfiles();B(le||[])}catch(le){console.error(le),L("")}finally{N(!1)}}},Tt=()=>{I||(ue(!1),D(!1))},Ct=async()=>{if(!(!Y||I)){P(!0),z({type:"info",message:"..."});try{const le=await qn.adminCopyIngredientMasterToUser(Y,{overwrite:V}),Ae=le?.unit_conversions||{},Oe=le?.csv_unit_overrides||{},Ge=`: ${Number(Ae.source_total||0).toLocaleString()}   ${Number(Ae.copied||0).toLocaleString()} /  ${Number(Ae.updated||0).toLocaleString()} /  ${Number(Ae.skipped||0).toLocaleString()}`,nt=`(CSV): ${Number(Oe.source_total||0).toLocaleString()}   ${Number(Oe.copied||0).toLocaleString()} /  ${Number(Oe.updated||0).toLocaleString()} /  ${Number(Oe.skipped||0).toLocaleString()}`;z({type:"success",message:`
${Ge}
${nt}`}),n.success("")}catch(le){console.error(le),z({type:"error",message:`: ${String(le?.message||le)}`}),n.error("")}finally{P(!1)}}};return s.jsxs("div",{className:"ingredient-master-container",children:[s.jsxs("div",{className:"master-header",children:[s.jsx("h3",{children:" "}),s.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[t?.role==="admin"&&s.jsx(se,{variant:"secondary",onClick:We,disabled:h!==null||y||I,title:h!==null?"":void 0,children:""}),s.jsx(se,{variant:"primary",onClick:Ue,disabled:h!==null,children:"+ "})]})]}),s.jsx("div",{className:"master-search",children:s.jsx(kt,{placeholder:"...",value:o,onChange:le=>u(le.target.value)})}),s.jsxs("div",{className:"ingredient-master-stats",children:[s.jsxs("span",{children:[": ",s.jsx("strong",{children:(i.length||0).toLocaleString()})," "]}),Pe&&s.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",s.jsx("strong",{children:(Be.length||0).toLocaleString()})," "]})]}),s.jsx("div",{className:"ingredient-category-tabs",children:Q.map(le=>s.jsxs("button",{type:"button",className:`ingredient-category-tab ${d===le.key?"active":""}`,onClick:()=>f(le.key),disabled:h!==null,title:h!==null?"":void 0,children:[le.label," (",(fe[le.key]??0).toLocaleString(),")"]},le.key))}),y?s.jsx("div",{className:"master-loading",children:"..."}):s.jsx("div",{className:"master-table-wrapper",children:s.jsxs("table",{className:"master-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:"CSV"}),s.jsx("th",{children:""}),s.jsx("th",{children:"%"}),s.jsx("th",{children:""})]})}),s.jsx("tbody",{children:Be.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"8",style:{textAlign:"center",color:"#999"},children:Pe?"":""})}):Be.map((le,Ae)=>{const Oe=le?.clientId??le?.ingredientName??String(Ae),Ge=rt(le?.ingredientName),nt=String(le?.vendor||"").trim(),St=le?.isEditing&&!!Ge&&Ge!==nt,on=qe(le),Jt=$(le?.itemCategory)==="food";return s.jsxs("tr",{className:le.isEditing?"editing":"",children:[s.jsx("td",{children:le.isEditing?s.jsxs("div",{className:"ingredient-name-cell",children:[s.jsx(kt,{value:le.ingredientName,onChange:dt=>je(Oe,"ingredientName",dt.target.value),placeholder:": ",disabled:!le.isNew,wrapperClassName:"input-group--no-margin"}),s.jsx(kt,{value:le.vendor||"",onChange:dt=>je(Oe,"vendor",dt.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),St&&s.jsxs("div",{className:"ingredient-subtext",children:["CSV: ",Ge]})]}):s.jsxs("div",{className:"ingredient-name-cell",children:[s.jsx("div",{children:le.ingredientName}),on&&s.jsx("div",{className:"ingredient-subtext",children:on})]})}),s.jsx("td",{children:le.isEditing?s.jsx(kt,{type:"number",value:le.lastPrice,onChange:dt=>je(Oe,"lastPrice",dt.target.value),placeholder:": 500"}):`${parseFloat(le.lastPrice||0).toLocaleString()}`}),s.jsx("td",{children:le.isEditing?s.jsxs("div",{className:"input-with-hint",children:[s.jsx(kt,{type:"number",value:le.packetSize,onChange:dt=>je(Oe,"packetSize",dt.target.value),placeholder:["","","","PC","","",""].includes(le.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(le.packetUnit)&&s.jsxs("span",{className:"unit-hint",children:["1",le.packetUnit,"1"]})]}):le.packetSize}),s.jsx("td",{children:le.isEditing?s.jsxs("select",{value:le.packetUnit,onChange:dt=>je(Oe,"packetUnit",dt.target.value),className:"unit-select",children:[s.jsx("option",{value:"g",children:"g"}),s.jsx("option",{value:"ml",children:"ml"}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"cc",children:"cc"})]}):le.packetUnit}),s.jsx("td",{className:"csv-unit-cell",children:le.isEditing?s.jsx(kt,{value:xe(le.ingredientName),onChange:dt=>{const tn=(le.ingredientName??"").toString().trim(),qt=dt.target.value;k(ir=>({...ir,[tn]:qt}))},onBlur:dt=>te(le.ingredientName,dt.target.value),placeholder:lt(le.ingredientName)==="-"?"":`CSV: ${lt(le.ingredientName)}`}):s.jsx("span",{children:_e(le.ingredientName)})}),s.jsx("td",{className:"normalized-cost",children:Ie(le)}),s.jsx("td",{children:Jt?le.isEditing?s.jsx(kt,{type:"number",value:le.yieldPercent??"",onChange:dt=>je(Oe,"yieldPercent",dt.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const dt=parseFloat(le.yieldPercent);if(!Number.isFinite(dt)||dt<=0)return"-";const tn=Math.round(dt*10)/10;return`${Number.isInteger(tn)?Math.round(tn):tn}%`})():s.jsx("span",{style:{color:"#999"},children:"-"})}),s.jsx("td",{children:s.jsx("div",{className:"action-buttons",children:le.isEditing?s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"primary",size:"sm",onClick:()=>H(Oe),children:""}),s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>pe(Oe),children:""})]}):s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>oe(Oe),disabled:h!==null,children:""}),s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>G(Oe),disabled:h!==null,children:""})]})})})]},Oe)})})]})}),s.jsx("div",{className:"master-info",children:s.jsx("p",{children:" "})}),s.jsx(xn,{isOpen:E,onClose:Tt,title:"",size:"medium",showCloseButton:!I,children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",s.jsx("br",{}),s.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),K?s.jsxs(s.Fragment,{children:[(()=>{const le=U.find(Oe=>String(Oe?.id)===String(Y)),Ae=le?`${le.display_id}${le.email?` (${le.email})`:""}`:Y?String(Y).slice(0,8):"-";return s.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),s.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",s.jsx("strong",{children:Ae}),s.jsx("br",{}),": ",s.jsx("strong",{children:V?"":""})]})]})})(),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>ue(!1),disabled:I,children:""}),s.jsx(se,{variant:"primary",onClick:Ct,disabled:!Y||I,children:I?"...":""})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),T?s.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):s.jsxs("select",{value:Y,onChange:le=>q(le.target.value),disabled:I||!!O,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:I?"#f3f4f6":"white"},children:[s.jsx("option",{value:"",children:"..."}),U.filter(le=>String(le?.id)&&String(le?.id)!==String(t?.id)).map(le=>s.jsxs("option",{value:le.id,children:[le.display_id,le.email?` (${le.email})`:"",le.role==="admin"?" []":""]},le.id))]}),O&&s.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:O})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[s.jsx("input",{type:"checkbox",checked:V,onChange:le=>F(le.target.checked),disabled:I}),""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[s.jsx(se,{variant:"ghost",onClick:Tt,disabled:I,children:""}),s.jsx(se,{variant:"primary",onClick:()=>ue(!0),disabled:!Y||I||T||!!O,children:""})]})]}),I&&s.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:s.jsxs("div",{className:"bulk-progress-head",children:[s.jsx("div",{className:"bulk-progress-spinner"}),s.jsxs("div",{children:[s.jsx("div",{className:"bulk-progress-title",children:"..."}),s.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),R?.message&&s.jsx("div",{className:`status-msg ${R.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:R.message})]})})]})},wu="__all_vendors__",Rb="__unknown_vendor__",go="__all_categories__",Gf="food",Ru=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],mp=Ru.reduce((n,t)=>(n[t.value]=t.label,n),{}),jk=new Set(["","","","","PC","","",""]),Ji=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const i=Number(t);return Number.isFinite(i)?i:null},Kx=n=>(typeof n=="string"?n.trim():"")||Rb,Xa=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?Gf:mp[t]?t:Gf},_k=()=>{const[n,t]=w.useState([]),[i,a]=w.useState(!0),[o,u]=w.useState(null),[d,f]=w.useState(null),[h,m]=w.useState("all"),[y,v]=w.useState({key:null,direction:"asc"}),[x,b]=w.useState(""),[_,C]=w.useState(go),[j,k]=w.useState(wu),[E,D]=w.useState(!1),[U,B]=w.useState(null),T=w.useRef(null),N=ua(),[O,L]=w.useState({isOpen:!1,title:"",message:"",onConfirm:null}),Y=()=>{f(H=>!H||H.phase==="running"?H:null)};w.useEffect(()=>{q()},[]);const q=async()=>{a(!0),B(null);try{console.log("Starting data load for CsvToMasterImporter...");const[H,G]=await Promise.all([sr.getPriceListArray().catch(pe=>(console.error("Error fetching price list:",pe),[])),qn.getAllConversions().catch(pe=>(console.error("Error fetching conversions:",pe),new Map))]);if(console.log("Data fetched:",{csvCount:H?.length,masterSize:G?.size}),!Array.isArray(H))throw new Error("CSV");if(!(G instanceof Map))throw new Error("Map");const oe=[];for(const pe of H){if(!pe||!pe.name)continue;const je=G.get(pe.name),Ie=Xa(je?.itemCategory),Be=je?.packetSize??"",Pe=je?.packetUnit||pe.unit||"",lt=je?.lastPrice??"",rt=je?Be:jk.has(Pe)?1:"";oe.push({name:pe.name,csvPrice:pe.price,csvUnit:pe.unit,csvVendor:pe.vendor,masterCategory:Ie,masterSize:Be,masterUnit:Pe,masterPrice:lt,isRegistered:!!je,inputSize:rt,inputUnit:Pe,inputPrice:je?lt:pe.price??"",inputCategory:Ie,isModified:!1})}console.log("Merge completed. Items:",oe.length),t(oe)}catch(H){console.error("Failed to load data for importer:",H),B(H.message||"")}finally{a(!1)}},V=async H=>{u(H.name);try{const G=Ji(H.inputSize),oe=Ji(H.inputPrice);if(G===null||G<=0){N.error("");return}if(!H.inputUnit){N.error("");return}if(!H.inputCategory){N.error("");return}await qn.saveConversion(H.name,G,H.inputUnit,oe,H.inputCategory),t(pe=>pe.map(je=>je.name===H.name?{...je,isRegistered:!0,isModified:!1,masterSize:G,masterUnit:H.inputUnit,masterPrice:oe??"",masterCategory:H.inputCategory,inputCategory:H.inputCategory}:je)),N.success("")}catch(G){console.error("Failed to save ingredient:",G),N.error("")}finally{u(null)}},F=async H=>{L(G=>({...G,isOpen:!1}));try{const G=H.filter(le=>{const Ae=Ji(le.inputSize);return!(Ae!==null&&Ae>0)||!le.inputUnit||!le.inputCategory});if(G.length>0){const le=G.slice(0,5).map(Oe=>Oe.name).join(""),Ae=G.length>5?` ${G.length-5}`:"";N.error(`: ${le}${Ae}`);return}u("bulk");const oe=H.length;f({phase:"running",total:oe,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const pe=5,je=120;let Ie=0,Be=0,Pe=0,lt=0;const rt=[],qe=[],xe=(le=!1,Ae="")=>{const Oe=Date.now();!le&&Oe-lt<je||(lt=Oe,f(Ge=>!Ge||Ge.phase!=="running"?Ge:{...Ge,processed:Ie,success:Be,failed:Pe,currentName:Ae||Ge.currentName}))};let _e=0;const te=async()=>{for(;;){const le=_e++;if(le>=H.length)return;const Ae=H[le],Oe=Ae?.name?String(Ae.name):"";try{const Ge=Ji(Ae.inputSize),nt=Ji(Ae.inputPrice);if(Ge===null||Ge<=0)throw new Error("Invalid size");if(!Ae.inputUnit)throw new Error("Invalid unit");if(!Ae.inputCategory)throw new Error("Invalid category");await qn.saveConversion(Ae.name,Ge,Ae.inputUnit,nt,Ae.inputCategory),Be++,rt.push(Ae)}catch(Ge){Pe++,qe.push(Oe||`#${le+1}`),console.error(`Failed to save ${Oe}:`,Ge)}finally{Ie++,xe(!1,Oe)}}},We=Math.min(pe,H.length);await Promise.all(Array.from({length:We},()=>te())),xe(!0);const Tt=new Set(rt.map(le=>le.name)),Ct=new Map(H.map(le=>[le.name,le]));t(le=>le.map(Ae=>{if(Tt.has(Ae.name)){const Oe=Ct.get(Ae.name);return{...Ae,isRegistered:!0,isModified:!1,masterSize:Ji(Oe.inputSize)??"",masterUnit:Oe.inputUnit,masterPrice:Ji(Oe.inputPrice)??"",masterCategory:Oe.inputCategory,inputCategory:Oe.inputCategory}}return Ae})),Pe===0?N.success(`${Be} `):N.warning(`:  ${Be}  /  ${Pe} `),f({phase:"done",total:oe,processed:Ie,success:Be,failed:Pe,currentName:"",failedNames:qe.slice(0,10)})}catch(G){console.error("Bulk save error:",G),N.error(""),f(oe=>({phase:"error",total:oe?.total??H.length,processed:oe?.processed??0,success:oe?.success??0,failed:oe?.failed??0,currentName:"",failedNames:oe?.failedNames??[],errorMessage:G?.message?String(G.message):""}))}finally{u(null)}},I=()=>{const H=n.filter(G=>G.isModified);H.length!==0&&L({isOpen:!0,title:"",message:`${H.length} `,onConfirm:()=>F(H)})},P=(H,G,oe)=>{t(pe=>pe.map(je=>je.name===H?{...je,[G]:oe,isModified:!0}:je))},R=H=>{(H.key==="ArrowUp"||H.key==="ArrowDown")&&H.preventDefault()},z=H=>{v(G=>G.key===H?{key:H,direction:G.direction==="asc"?"desc":"asc"}:{key:H,direction:"asc"})},K=H=>y.key!==H?"":y.direction==="asc"?" ":" ",ue=w.useMemo(()=>{const H=new Map;n.forEach(oe=>{const pe=Kx(oe.csvVendor),je=pe===Rb?"":pe,Ie=H.get(pe);Ie?Ie.count+=1:H.set(pe,{key:pe,label:je,count:1})});const G=Array.from(H.values()).sort((oe,pe)=>oe.label.localeCompare(pe.label,"ja"));return[{key:wu,label:"",count:n.length},...G]},[n]);w.useEffect(()=>{ue.some(G=>G.key===j)||k(wu)},[ue,j]),w.useEffect(()=>{if(!E)return;const H=oe=>{T.current&&!T.current.contains(oe.target)&&D(!1)},G=oe=>{oe.key==="Escape"&&D(!1)};return document.addEventListener("mousedown",H),document.addEventListener("touchstart",H),document.addEventListener("keydown",G),()=>{document.removeEventListener("mousedown",H),document.removeEventListener("touchstart",H),document.removeEventListener("keydown",G)}},[E]);const ye=w.useMemo(()=>j===wu?n:n.filter(H=>Kx(H.csvVendor)===j),[n,j]),$=w.useMemo(()=>{const H={[go]:ye.length};return Ru.forEach(G=>{H[G.value]=0}),ye.forEach(G=>{const oe=Xa(G.inputCategory);H[oe]=(H[oe]||0)+1}),H},[ye]),Q=w.useMemo(()=>_===go?ye:ye.filter(H=>Xa(H.inputCategory)===_),[ye,_]),X=w.useMemo(()=>({all:Q.length,unregistered:Q.filter(H=>!H.isRegistered).length,registered:Q.filter(H=>H.isRegistered).length}),[Q]),fe=w.useMemo(()=>ue.find(H=>H.key===j)||ue[0],[ue,j]),ke=w.useMemo(()=>Q.filter(H=>!(h==="unregistered"&&H.isRegistered||h==="registered"&&!H.isRegistered||x&&!H.name.includes(x))),[Q,h,x]),Ue=w.useMemo(()=>{if(!y.key)return ke;const H=pe=>String(pe??""),G=pe=>{const je=parseFloat(pe);return Number.isFinite(je)?je:Number.NEGATIVE_INFINITY},oe=[...ke];return oe.sort((pe,je)=>{let Ie=0;switch(y.key){case"name":Ie=H(pe.name).localeCompare(H(je.name),"ja");break;case"csvPrice":Ie=G(pe.csvPrice)-G(je.csvPrice);break;case"inputCategory":{const Be=mp[Xa(pe.inputCategory)]||"",Pe=mp[Xa(je.inputCategory)]||"";Ie=Be.localeCompare(Pe,"ja");break}case"inputSize":Ie=G(pe.inputSize)-G(je.inputSize);break;case"inputUnit":Ie=H(pe.inputUnit).localeCompare(H(je.inputUnit),"ja");break;case"inputPrice":Ie=G(pe.inputPrice)-G(je.inputPrice);break;default:Ie=0;break}return Ie===0&&(Ie=H(pe.name).localeCompare(H(je.name),"ja")),y.direction==="asc"?Ie:-Ie}),oe},[ke,y]),de=n.filter(H=>H.isModified).length;return i?s.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):U?s.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[s.jsx("h3",{children:""}),s.jsx("p",{children:U}),s.jsx(se,{variant:"secondary",onClick:q,children:""})]}):s.jsxs("div",{className:"csv-importer",children:[s.jsxs("div",{className:"importer-header",children:[s.jsx(kt,{placeholder:"...",value:x,onChange:H=>b(H.target.value),style:{maxWidth:"300px"}}),s.jsxs("div",{className:"filter-buttons",children:[s.jsxs(se,{variant:h==="all"?"primary":"secondary",onClick:()=>m("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",X.all,")"]}),s.jsxs(se,{variant:h==="unregistered"?"primary":"secondary",onClick:()=>m("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",X.unregistered,")"]}),s.jsxs(se,{variant:h==="registered"?"primary":"secondary",onClick:()=>m("registered"),size:"sm",children:[" (",X.registered,")"]})]}),s.jsxs("div",{className:"vendor-dropdown",ref:T,children:[s.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>D(H=>!H),"aria-haspopup":"listbox","aria-expanded":E,children:[s.jsxs("span",{children:[": ",fe?.label," (",fe?.count??0,")"]}),s.jsx("span",{className:`vendor-dropdown-chevron ${E?"open":""}`,children:""})]}),E&&s.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:ue.map(H=>s.jsxs("button",{type:"button",className:`vendor-tab ${j===H.key?"active":""}`,onClick:()=>{k(H.key),D(!1)},role:"option","aria-selected":j===H.key,children:[H.label," (",H.count,")"]},H.key))})]}),s.jsxs("div",{className:"category-filter-row",children:[s.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),s.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:_,onChange:H=>C(H.target.value),children:[s.jsxs("option",{value:go,children:[" (",$[go]||0,")"]}),Ru.map(H=>s.jsxs("option",{value:H.value,children:[H.label," (",$[H.value]||0,")"]},H.value))]})]}),s.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[de>0&&s.jsx(se,{variant:"primary",size:"sm",onClick:I,disabled:o!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o==="bulk"?"...":`(${de})`}),s.jsx(se,{variant:"secondary",size:"sm",onClick:q,children:" "})]})]}),s.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:s.jsxs("table",{className:"enterprise-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{style:{width:"22%"},onClick:()=>z("name"),children:[" (CSV)",K("name")]}),s.jsxs("th",{style:{width:"14%"},onClick:()=>z("csvPrice"),children:[" (CSV)",K("csvPrice")]}),s.jsxs("th",{style:{width:"14%"},onClick:()=>z("inputCategory"),children:[" ",s.jsx("span",{style:{color:"red"},children:"*"}),K("inputCategory")]}),s.jsxs("th",{style:{width:"18%"},onClick:()=>z("inputSize"),children:[" () ",s.jsx("span",{style:{color:"red"},children:"*"}),K("inputSize")]}),s.jsxs("th",{style:{width:"13%"},onClick:()=>z("inputUnit"),children:[" () ",s.jsx("span",{style:{color:"red"},children:"*"}),K("inputUnit")]}),s.jsxs("th",{style:{width:"12%"},onClick:()=>z("inputPrice"),children:[" ()",K("inputPrice")]}),s.jsx("th",{style:{width:"7%"},children:""})]})}),s.jsx("tbody",{children:Ue.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"7",className:"no-data",children:""})}):Ue.map(H=>s.jsxs("tr",{style:{backgroundColor:H.isModified?"#fff8e1":H.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[s.jsxs("td",{style:{fontWeight:"500"},children:[H.name,H.csvVendor&&s.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:H.csvVendor})]}),s.jsxs("td",{children:[H.csvPrice?`${H.csvPrice.toLocaleString()} `:"-",H.csvUnit&&s.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",H.csvUnit]})]}),s.jsx("td",{children:s.jsx("select",{className:"input-field",value:Xa(H.inputCategory),onChange:G=>P(H.name,"inputCategory",G.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:Ru.map(G=>s.jsx("option",{value:G.value,children:G.label},G.value))})}),s.jsx("td",{children:s.jsx(kt,{type:"number",value:H.inputSize,onChange:G=>P(H.name,"inputSize",G.target.value),onKeyDown:R,placeholder:["","","","PC","","",""].includes(H.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),s.jsx("td",{children:s.jsxs("select",{className:"input-field",value:H.inputUnit,onChange:G=>P(H.name,"inputUnit",G.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","","","","","PC","","",""].includes(H.inputUnit)&&H.inputUnit&&s.jsxs("option",{value:H.inputUnit,children:[H.inputUnit," (CSV)"]}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"g",children:"g"}),s.jsx("option",{value:"kg",children:"kg"}),s.jsx("option",{value:"ml",children:"ml"}),s.jsx("option",{value:"L",children:"L"}),s.jsx("option",{value:"cc",children:"cc"}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"PC",children:"PC"}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""})]})}),s.jsx("td",{children:s.jsx(kt,{type:"number",value:H.inputPrice,onChange:G=>P(H.name,"inputPrice",G.target.value),placeholder:"",style:{width:"100%"}})}),s.jsx("td",{children:s.jsx(se,{variant:H.isRegistered?"secondary":"primary",size:"sm",onClick:()=>V(H),disabled:o===H.name||o==="bulk",block:!0,children:o===H.name?"...":H.isRegistered?"":""})})]},H.name))})]})}),s.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[s.jsx("p",{children:" CSV"}),s.jsx("p",{children:" "})]}),s.jsxs(xn,{isOpen:O.isOpen,onClose:()=>L({...O,isOpen:!1}),title:O.title,size:"small",children:[s.jsx("div",{style:{marginBottom:"1.5rem"},children:O.message}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[s.jsx(se,{variant:"secondary",onClick:()=>L({...O,isOpen:!1}),children:""}),s.jsx(se,{variant:"primary",onClick:O.onConfirm,children:""})]})]}),s.jsx(xn,{isOpen:!!d,onClose:Y,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?s.jsxs("div",{className:"bulk-progress",children:[s.jsxs("div",{className:"bulk-progress-head",children:[s.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("div",{className:"bulk-progress-title",children:""}),s.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),s.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:s.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),s.jsxs("div",{className:"bulk-progress-meta",children:[s.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&s.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?s.jsxs("div",{className:"bulk-progress",children:[s.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&s.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),s.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[s.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),s.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:s.jsx(se,{variant:"primary",onClick:Y,children:""})})]}):s.jsxs("div",{className:"bulk-progress",children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),s.jsxs("div",{className:"bulk-progress-meta",children:[s.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&s.jsxs("div",{className:"bulk-progress-failures",children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),s.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),s.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:s.jsx(se,{variant:"primary",onClick:Y,children:""})})]})})]})},Yx=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},Ck=({onBack:n})=>{const[t,i]=Ko(),{user:a}=us(),[o,u]=w.useState("price"),[d,f]=w.useState(null),[h,m]=w.useState({type:"",message:""}),[y,v]=w.useState(!1),[x,b]=w.useState([]),[_,C]=w.useState(!1),[j,k]=w.useState(null),[E,D]=w.useState({type:"",message:""}),[U,B]=w.useState(null),[T,N]=w.useState(!1),[O,L]=w.useState(!1),[Y,q]=w.useState(!1),[V,F]=w.useState([]),[I,P]=w.useState(!1),[R,z]=w.useState(""),[K,ue]=w.useState(""),[ye,$]=w.useState(!1),[Q,X]=w.useState({total:0,done:0,current:""}),[fe,ke]=w.useState(null),[Ue,de]=w.useState(!1),[H,G]=w.useState(!1),[oe,pe]=w.useState(new Map),[je,Ie]=w.useState([]),[Be,Pe]=w.useState(""),[lt,rt]=w.useState(""),[qe,xe]=w.useState(""),_e=Ce.useMemo(()=>{if(!Be)return[];const ve=oe.get(Be)||[],st=new Set;return ve.forEach(Ze=>{const tt=Yx(Ze?.dateStr);tt&&st.add(tt)}),Array.from(st).sort((Ze,tt)=>tt.localeCompare(Ze))},[oe,Be]);w.useEffect(()=>{if(qe){if(!Be){xe("");return}_e.length>0&&!_e.includes(qe)&&xe("")}},[_e,qe,Be]);const[te,We]=w.useState({key:"dateStr",direction:"desc"}),[Tt,Ct]=w.useState("");w.useEffect(()=>{const ve=t.get("tab");(ve==="price"||ve==="ingredients"||ve==="csv-import"||ve==="duplicates")&&u(ve)},[]);const le=ve=>{let st="asc";te.key===ve&&te.direction==="asc"&&(st="desc"),We({key:ve,direction:st})},Ae=Ce.useMemo(()=>{let ve=[...x];if(Tt){const st=Tt.toLowerCase().trim();ve=ve.filter(Ze=>Ze.name&&Ze.name.toLowerCase().includes(st)||Ze.vendor&&Ze.vendor.toLowerCase().includes(st)||Ze.dateStr&&Ze.dateStr.includes(st))}return te.key&&ve.sort((st,Ze)=>{let tt=st[te.key]||"",vt=Ze[te.key]||"";return tt<vt?te.direction==="asc"?-1:1:tt>vt?te.direction==="asc"?1:-1:0}),ve},[x,te,Tt]),[Oe,Ge]=w.useState([]);w.useEffect(()=>{St()},[]);const nt=async()=>{G(!0);try{const st=await sr.fetchPriceHistory()||new Map;pe(st);const Ze=[];for(const[tt,vt]of st.entries()){const At=new Set,Et=[];if((vt||[]).forEach(Rt=>{const en=[String(Rt?.dateStr||""),String(Rt?.price??""),String(Rt?.incomingQty??""),String(Rt?.unit||""),String(Rt?.vendor||""),String(Rt?.displayName||"")].join("|");At.has(en)||(At.add(en),Et.push(Rt))}),Et.length<2)continue;Et.sort((Rt,en)=>String(Rt?.dateStr||"").localeCompare(String(en?.dateStr||"")));const Lt=Et[Et.length-1]||{},ht=Et.map(Rt=>Number(Rt?.price)).filter(Rt=>Number.isFinite(Rt)),Pt=ht.length?Math.min(...ht):null,Nt=ht.length?Math.max(...ht):null,Xt=new Set(Et.map(Rt=>String(Rt?.dateStr||""))).size,mt=new Set(Et.map(Rt=>String(Rt?.displayName||""))).size;let Zt=0;for(let Rt=1;Rt<Et.length;Rt++){const en=Number(Et[Rt-1]?.price),un=Number(Et[Rt]?.price);Number.isFinite(en)&&Number.isFinite(un)&&en!==un&&Zt++}Ze.push({key:tt,name:Lt?.displayName||tt,lastDate:Lt?.dateStr||"",lastPrice:Number.isFinite(Number(Lt?.price))?Number(Lt?.price):null,lastIncomingQty:Number.isFinite(Number(Lt?.incomingQty))?Number(Lt?.incomingQty):null,unit:Lt?.unit||"",vendor:Lt?.vendor||"",rows:Et.length,dates:Xt,nameVariants:mt,minPrice:Pt,maxPrice:Nt,changes:Zt})}Ze.sort((tt,vt)=>{const At=String(tt?.lastDate||""),Et=String(vt?.lastDate||"");return At!==Et?Et.localeCompare(At):(vt?.changes||0)!==(tt?.changes||0)?(vt?.changes||0)-(tt?.changes||0):(vt?.rows||0)!==(tt?.rows||0)?(vt?.rows||0)-(tt?.rows||0):String(tt?.name||"").localeCompare(String(vt?.name||""),"ja")}),Ie(Ze),Be&&!st.has(Be)&&Pe("")}catch(ve){console.error(ve)}finally{G(!1)}};w.useEffect(()=>{o==="duplicates"&&nt()},[o]);const St=async()=>{C(!0);try{const ve=await sr.getPriceListArray();b(ve);const st=await sr.getFileList();Ge(st)}catch(ve){console.error("Failed to load price data",ve)}finally{C(!1)}},on=ve=>{ve.target.files&&ve.target.files[0]&&(f(ve.target.files[0]),m({type:"",message:""}))},Tn=async()=>{if(!d)return;v(!0),m({type:"info",message:"..."});const ve=await sr.uploadPriceList(d);if(ve.success){m({type:"success",message:"..."});try{const{recipeService:Ze}=await Tu(async()=>{const{recipeService:At}=await Promise.resolve().then(()=>Tf);return{recipeService:At}},[]),tt=await sr.fetchPriceList(),vt=await Ze.updateRecipeCosts(tt);m({type:"success",message:`${vt}`})}catch(Ze){console.error("Cost update failed",Ze),m({type:"warning",message:""})}f(null);const st=document.getElementById("csv-upload-input");st&&(st.value=""),St()}else m({type:"error",message:`: ${ve.error.message}`});v(!1)},Jt=ve=>{k({message:`${ve}
`,onConfirm:async()=>{v(!0);const st=await sr.deletePriceFile(ve);v(!1),st.success?(m({type:"success",message:""}),St()):m({type:"error",message:`: ${st.error.message}`})}})},dt=ve=>{ve&&(B(ve),N(!0),D({type:"",message:""}))},tn=()=>{if(O)return;N(!1),B(null);const ve=document.getElementById("backup-upload-input");ve&&(ve.value="")},qt=async()=>{const ve=U;if(!(!ve||O)){L(!0),D({type:"info",message:"..."});try{const st=await ve.text(),Ze=JSON.parse(st),{recipeService:tt}=await Tu(async()=>{const{recipeService:Lt}=await Promise.resolve().then(()=>Tf);return{recipeService:Lt}},void 0),vt=await tt.importRecipes(Ze),At=Number(vt?.count||0),Et=Array.isArray(vt?.errors)?vt.errors.length:0;D({type:Et>0?"warning":"success",message:`: ${At}${Et>0?` / : ${Et}`:""}`}),N(!1),B(null)}catch(st){console.error(st),D({type:"error",message:""})}finally{L(!1);const st=document.getElementById("backup-upload-input");st&&(st.value="")}}},ir=async()=>{q(!0),ke(null),X({total:0,done:0,current:""}),ue(""),z(""),de(!1),P(!0);try{const ve=await ia.fetchAllProfiles();F(ve||[])}catch(ve){console.error(ve),F([]),z("")}finally{P(!1)}},xr=()=>{ye||(de(!1),q(!1))},jn=async()=>{if(!(!K||ye)){$(!0),ke({type:"info",message:"..."}),X({total:0,done:0,current:""});try{const ve=await sr.copyPriceFilesToUser({targetUserId:K,onProgress:({total:tt,done:vt,current:At})=>{X({total:tt||0,done:vt||0,current:At||""})}}),st=ve?.copied?.length??0,Ze=ve?.failed?.length??0;ke({type:Ze>0?"error":"success",message:`: ${st}${Ze>0?` / : ${Ze}`:""}`,failed:ve?.failed||[]})}catch(ve){console.error(ve),ke({type:"error",message:`: ${String(ve?.message||ve)}`})}finally{$(!1)}}};return s.jsxs("div",{className:["dashboard-container","fade-in",o==="ingredients"||o==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[s.jsxs("div",{className:"dashboard-header",children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[s.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),s.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),s.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[o==="csv-import"&&s.jsx(se,{variant:"secondary",onClick:()=>i({view:"inventory"}),title:"",children:" "}),s.jsx(se,{variant:"ghost",onClick:n,children:" "})]})]}),s.jsx("div",{className:"tabs-container",children:s.jsxs("div",{className:"tabs",children:[s.jsx("button",{className:`tab ${o==="price"?"active":""}`,onClick:()=>u("price"),children:" "}),s.jsx("button",{className:`tab ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:" "}),s.jsx("button",{className:`tab ${o==="csv-import"?"active":""}`,onClick:()=>u("csv-import"),children:" CSV"}),s.jsx("button",{className:`tab ${o==="duplicates"?"active":""}`,onClick:()=>u("duplicates"),children:" "})]})}),o==="ingredients"?s.jsx(Sk,{}):o==="csv-import"?s.jsx(_k,{}):o==="duplicates"?s.jsxs("div",{className:"dashboard-content",children:[s.jsxs("aside",{className:"dashboard-sidebar",children:[s.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[s.jsxs("div",{className:"sidebar-title",children:[s.jsx("span",{children:""})," ",s.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[je.length.toLocaleString(),""]})]}),s.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[s.jsx(kt,{placeholder:"...",value:lt,onChange:ve=>rt(ve.target.value),style:{flex:1,fontSize:"0.9rem"}}),s.jsx(se,{variant:"secondary",size:"sm",onClick:nt,disabled:H,title:"",children:""})]}),s.jsx("div",{className:"dup-list",children:H?s.jsx("div",{className:"dup-empty",children:"..."}):je.length===0?s.jsx("div",{className:"dup-empty",children:"2"}):je.filter(ve=>{const st=String(lt||"").trim();return st?String(ve?.name||"").includes(st):!0}).map(ve=>{const st=ve.key===Be,Ze=ve.minPrice!==null&&ve.maxPrice!==null&&ve.minPrice!==ve.maxPrice;return s.jsxs("button",{type:"button",className:`dup-item ${st?"active":""}`,onClick:()=>Pe(ve.key),children:[s.jsxs("div",{className:"dup-item-top",children:[s.jsx("div",{className:"dup-item-name",title:ve.name,children:ve.name}),Ze&&s.jsx("span",{className:"dup-badge",children:""})]}),s.jsxs("div",{className:"dup-item-meta",children:[s.jsxs("span",{children:[": ",ve.lastDate||"-"]}),s.jsxs("span",{children:[": ",ve.rows,""]}),s.jsxs("span",{children:[": ",ve.dates,""]})]}),s.jsxs("div",{className:"dup-item-meta",children:[s.jsxs("span",{children:[ve.lastPrice!==null?`${Math.round(ve.lastPrice).toLocaleString()}`:"-",ve.unit?` / ${ve.unit}`:""]}),s.jsxs("span",{children:[": ",ve.lastIncomingQty!==null?Math.round(ve.lastIncomingQty).toLocaleString():"-"]}),ve.vendor?s.jsxs("span",{title:ve.vendor,children:[": ",ve.vendor]}):s.jsx("span",{children:": -"})]}),ve.nameVariants>1&&s.jsxs("div",{className:"dup-item-note",children:[": ",ve.nameVariants,""]})]},ve.key)})})]}),s.jsxs("div",{className:"sidebar-card",children:[s.jsx("div",{className:"sidebar-title",children:" "}),s.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[s.jsx("li",{style:{marginBottom:"4px"},children:""}),s.jsx("li",{style:{marginBottom:"4px"},children:""}),s.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),s.jsxs("main",{className:"dashboard-main",children:[s.jsxs("div",{className:"main-toolbar",children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:s.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:Be?"":""})}),s.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[s.jsxs("select",{value:qe,onChange:ve=>xe(ve.target.value),disabled:!Be,title:Be?"":"",className:"dup-month-select",children:[s.jsx("option",{value:"",children:""}),_e.map(ve=>s.jsx("option",{value:ve,children:ve.replace("-","/")},ve))]}),s.jsx(se,{variant:"secondary",size:"sm",onClick:nt,disabled:H,children:" "})]})]}),s.jsx("div",{className:"table-wrapper",children:(()=>{if(!Be)return s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const ve=oe.get(Be)||[],st=new Set,Ze=[];ve.forEach(ht=>{const Pt=[String(ht?.dateStr||""),String(ht?.price??""),String(ht?.incomingQty??""),String(ht?.unit||""),String(ht?.vendor||""),String(ht?.displayName||""),String(ht?.sourceFile||"")].join("|");st.has(Pt)||(st.add(Pt),Ze.push(ht))}),Ze.sort((ht,Pt)=>String(ht?.dateStr||"").localeCompare(String(Pt?.dateStr||"")));const tt=qe?Ze.filter(ht=>Yx(ht?.dateStr)===qe):Ze,vt=tt.map((ht,Pt)=>{const Nt=Pt>0?tt[Pt-1]:null,Xt=Nt?Number(Nt?.price):NaN,mt=Number(ht?.price);let Zt=null,Rt=null;return Number.isFinite(Xt)&&Number.isFinite(mt)&&(Zt=mt-Xt,Rt=Xt!==0?Zt/Xt*100:null),{...ht,_diff:Zt,_pct:Rt}}),At=tt.reduce((ht,Pt)=>{const Nt=Number(Pt?.incomingQty);return ht+(Number.isFinite(Nt)?Nt:0)},0),Et=tt.reduce((ht,Pt)=>{const Nt=Number(Pt?.incomingQty),Xt=Number(Pt?.price);return!Number.isFinite(Nt)||!Number.isFinite(Xt)?ht:ht+Nt*Xt},0),Lt=[...vt].reverse();return s.jsxs("table",{className:"enterprise-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"120px"},children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:"CSV"}),s.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),s.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),s.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),s.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),s.jsx("tbody",{children:Lt.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"7",className:"no-data",children:qe?`${qe}`:""})}):Lt.map((ht,Pt)=>{const Nt=ht?._diff,Xt=ht?._pct,mt=Nt==null||!Number.isFinite(Nt)?"-":`${Nt>=0?"+":""}${Math.round(Nt).toLocaleString()}`,Zt=Xt==null||!Number.isFinite(Xt)?"":` (${Xt>=0?"+":""}${Xt.toFixed(1)}%)`,Rt=Nt==null||!Number.isFinite(Nt)?"#888":Nt>0?"#c92a2a":Nt<0?"#2b8a3e":"#666",en=Number(ht?.price),un=Number.isFinite(en)?`${Math.round(en).toLocaleString()}`:"-",ce=Number(ht?.incomingQty),Le=Number.isFinite(ce)?Math.round(ce).toLocaleString():"-",He=Number.isFinite(ce)&&Number.isFinite(en)?ce*en:NaN,pt=Number.isFinite(He)?`${Math.round(He).toLocaleString()}`:"-";return s.jsxs("tr",{children:[s.jsx("td",{className:"col-date",children:ht?.dateStr||"-"}),s.jsx("td",{children:ht?.vendor||"-"}),s.jsx("td",{style:{fontWeight:500},children:ht?.displayName||"-"}),s.jsx("td",{className:"col-number",children:Le}),s.jsxs("td",{className:"col-number",children:[un,ht?.unit&&s.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",ht.unit]})]}),s.jsx("td",{className:"col-number",children:pt}),s.jsxs("td",{className:"col-number",style:{color:Rt},children:[mt,Zt]})]},`${ht?.dateStr||"d"}-${Pt}`)})}),Lt.length>0&&s.jsx("tfoot",{children:s.jsxs("tr",{children:[s.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",qe?`${qe}`:""]}),s.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(At).toLocaleString()}),s.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),s.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(Et).toLocaleString()]}),s.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):s.jsxs("div",{className:"dashboard-content",children:[s.jsxs("aside",{className:"dashboard-sidebar",children:[s.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[s.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[s.jsx("span",{children:""})," "]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),s.jsx(se,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const ve=await Tu(()=>Promise.resolve().then(()=>Tf),void 0).then(vt=>vt.recipeService.exportAllRecipes()),st=new Blob([JSON.stringify(ve,null,2)],{type:"application/json"}),Ze=URL.createObjectURL(st),tt=document.createElement("a");tt.href=Ze,tt.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(tt),tt.click(),document.body.removeChild(tt),URL.revokeObjectURL(Ze)}catch(ve){D({type:"error",message:""}),console.error(ve)}},children:" JSON"})]}),s.jsxs("div",{children:[s.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),s.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:ve=>{const st=ve.target.files?.[0];st&&dt(st)}}),s.jsx(se,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:y||O,children:" "}),E.message&&s.jsx("div",{className:`status-msg ${E.type}`,style:{marginTop:"10px"},children:E.message})]})]}),s.jsxs("div",{className:"sidebar-card",children:[s.jsxs("div",{className:"sidebar-title",children:[s.jsx("span",{children:""})," "]}),s.jsxs("div",{className:"upload-area",children:[s.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",s.jsx("br",{}),s.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",s.jsx("br",{})," 2: "]})]}),s.jsx("input",{type:"file",accept:".csv",onChange:on,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),s.jsx(se,{variant:"primary",onClick:Tn,disabled:!d||y,className:"upload-btn",size:"sm",block:!0,children:y?"...":""})]}),h.message&&s.jsx("div",{className:`status-msg ${h.type}`,children:h.message})]}),a?.role==="admin"&&s.jsxs("div",{className:"sidebar-card",children:[s.jsxs("div",{className:"sidebar-title",children:[s.jsx("span",{children:""})," "]}),s.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",s.jsx("br",{}),s.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),s.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",Oe.length,""]}),s.jsx("div",{style:{marginTop:"0.75rem"},children:s.jsx(se,{variant:"secondary",size:"sm",block:!0,onClick:ir,disabled:ye||y,title:"",children:""})})]}),s.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[s.jsxs("div",{className:"sidebar-title",children:[s.jsx("span",{children:""})," ",s.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Oe.length,""]})]}),Oe.length===0?s.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):s.jsx("div",{className:"file-list",children:Oe.map(ve=>s.jsxs("div",{className:"file-list-item",children:[s.jsx("span",{className:"file-name",title:ve.name,children:ve.name}),s.jsx(se,{variant:"danger",size:"sm",onClick:()=>Jt(ve.name),disabled:y,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},ve.name))})]}),s.jsxs("div",{className:"sidebar-card",children:[s.jsx("div",{className:"sidebar-title",children:" "}),s.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[s.jsx("li",{style:{marginBottom:"4px"},children:""}),s.jsx("li",{style:{marginBottom:"4px"},children:" "}),s.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),s.jsxs("main",{className:"dashboard-main",children:[s.jsxs("div",{className:"main-toolbar",children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[s.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),s.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",Ae.length.toLocaleString()," "]})]}),s.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[s.jsx(kt,{placeholder:" (, , )...",value:Tt,onChange:ve=>Ct(ve.target.value),style:{width:"250px",fontSize:"0.9rem"}}),s.jsx(se,{variant:"secondary",size:"sm",onClick:St,children:" "})]})]}),s.jsx("div",{className:"table-wrapper",children:_?s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):s.jsxs("table",{className:"enterprise-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{onClick:()=>le("dateStr"),style:{width:"120px"},children:[" ",te.key==="dateStr"&&(te.direction==="asc"?"":"")]}),s.jsxs("th",{onClick:()=>le("vendor"),children:[" ",te.key==="vendor"&&(te.direction==="asc"?"":"")]}),s.jsxs("th",{onClick:()=>le("name"),children:[" ",te.key==="name"&&(te.direction==="asc"?"":"")]}),s.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),s.jsx("tbody",{children:Ae.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"4",className:"no-data",children:""})}):Ae.map((ve,st)=>s.jsxs("tr",{children:[s.jsx("td",{className:"col-date",children:ve.dateStr||"-"}),s.jsx("td",{children:ve.vendor||"-"}),s.jsx("td",{style:{fontWeight:"500"},children:ve.name}),s.jsxs("td",{className:"col-number",children:[ve.price?ve.price.toLocaleString():"-",ve.unit&&s.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",ve.unit]})]})]},st))})]})})]})]}),s.jsx(xn,{isOpen:T,onClose:tn,title:" / ",size:"medium",showCloseButton:!O,children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",s.jsx("br",{}),s.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),s.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),s.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:U?.name||"-"})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[s.jsx(se,{variant:"ghost",onClick:tn,disabled:O,children:""}),s.jsx(se,{variant:"primary",onClick:qt,disabled:!U||O,children:O?"...":""})]}),O&&s.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:s.jsxs("div",{className:"bulk-progress-head",children:[s.jsx("div",{className:"bulk-progress-spinner"}),s.jsxs("div",{children:[s.jsx("div",{className:"bulk-progress-title",children:"..."}),s.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),E.message&&s.jsx("div",{className:`status-msg ${E.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:E.message})]})}),s.jsx(xn,{isOpen:Y,onClose:xr,title:"",size:"medium",showCloseButton:!ye,children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",s.jsx("br",{}),s.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",s.jsx("code",{children:"_copy"})," "]})]}),s.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",s.jsx("strong",{style:{color:"#111827"},children:a?.displayId||""})," / : ",Oe.length,""]}),Ue?s.jsxs(s.Fragment,{children:[(()=>{const ve=V.find(Ze=>String(Ze?.id)===String(K)),st=ve?`${ve.display_id}${ve.email?` (${ve.email})`:""}`:K?String(K).slice(0,8):"-";return s.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),s.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",s.jsx("strong",{children:st}),s.jsx("br",{}),": ",s.jsx("strong",{children:Oe.length.toLocaleString()})," CSV",s.jsx("br",{}),": ",s.jsx("code",{children:"_copy"})," "]})]})})(),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>de(!1),disabled:ye,children:""}),s.jsx(se,{variant:"primary",onClick:jn,disabled:!K||ye,children:ye?"...":""})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),I?s.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):s.jsxs("select",{value:K,onChange:ve=>ue(ve.target.value),disabled:ye||!!R,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:ye?"#f3f4f6":"white"},children:[s.jsx("option",{value:"",children:"..."}),V.filter(ve=>String(ve?.id)&&String(ve?.id)!==String(a?.id)).map(ve=>s.jsxs("option",{value:ve.id,children:[ve.display_id,ve.email?` (${ve.email})`:"",ve.role==="admin"?" []":""]},ve.id))]}),R&&s.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:R})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[s.jsx(se,{variant:"ghost",onClick:xr,disabled:ye,children:""}),s.jsx(se,{variant:"primary",onClick:()=>de(!0),disabled:!K||ye||I||!!R,children:""})]})]}),ye&&s.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[s.jsxs("div",{className:"bulk-progress-head",children:[s.jsx("div",{className:"bulk-progress-spinner"}),s.jsxs("div",{children:[s.jsx("div",{className:"bulk-progress-title",children:"..."}),s.jsx("div",{className:"bulk-progress-subtitle",children:Q.total?`${Q.done} / ${Q.total}`:"..."})]})]}),s.jsx("div",{className:"bulk-progress-bar",children:s.jsx("div",{className:"bulk-progress-bar-inner",style:{width:Q.total?`${Math.round(Q.done/Q.total*100)}%`:"0%"}})}),s.jsx("div",{className:"bulk-progress-current",title:Q.current,children:Q.current})]}),fe?.message&&s.jsx("div",{className:`status-msg ${fe.type||"info"}`,children:fe.message}),Array.isArray(fe?.failed)&&fe.failed.length>0&&s.jsxs("div",{className:"bulk-progress-failures",children:[s.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",fe.failed.length,""]}),s.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:fe.failed.slice(0,10).map((ve,st)=>s.jsxs("li",{children:[ve?.file||"-",": ",ve?.errorMessage||"unknown error"]},`${ve?.file||"f"}-${st}`))}),fe.failed.length>10&&s.jsxs("div",{style:{marginTop:"6px"},children:["... ",fe.failed.length-10,""]})]})]})}),j&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>k(null),children:s.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:ve=>ve.stopPropagation(),children:[s.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),s.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:j.message}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>k(null),children:""}),s.jsx(se,{variant:"danger",onClick:()=>{j.onConfirm(),k(null)},children:""})]})]})})]})},Nk=({recipes:n,recentIds:t,onSelect:i})=>{if(!t||t.length===0)return null;const a=t.map(o=>n.find(u=>u.id===o)).filter(Boolean).slice(0,7);return a.length===0?null:s.jsxs("div",{className:"recent-recipes",children:[s.jsx("h3",{className:"recent-header",children:""}),s.jsx("div",{className:"recent-list",children:a.map(o=>s.jsxs("div",{className:"recent-item",onClick:()=>i(o),children:[s.jsx("div",{className:"recent-thumbnail",children:o.image?s.jsx("img",{src:o.image,alt:o.title}):s.jsx("div",{className:"recent-placeholder"})}),s.jsx("div",{className:"recent-info",children:s.jsx("div",{className:"recent-title",children:o.title})})]},o.id))})]})},Ek=({onBack:n})=>(w.useEffect(()=>{window.scrollTo(0,0)},[]),s.jsxs("div",{className:"levain-guide-container",children:[s.jsxs("header",{className:"levain-guide-header",children:[s.jsx("h1",{children:"LEVAIN GUIDE"}),s.jsx("p",{className:"subtitle",children:" "}),s.jsx("p",{className:"subtitle",children:""}),s.jsx("div",{className:"divider"})]}),s.jsxs("main",{className:"levain-guide-main",children:[s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("p",{children:"Levain"}),s.jsx("h3",{children:""}),s.jsx("p",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",s.jsx("br",{}),s.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",s.jsx("br",{}),s.jsx("strong",{children:""})," Acetobacter aceti "]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"science-box",children:["",s.jsx("br",{}),s.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",s.jsx("br",{}),"(   +  + )"]}),"",s.jsx("br",{}),s.jsxs("div",{className:"formula",children:["CHO  2CHO",s.jsx("br",{}),"(  )"]})]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[" ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," "]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:"- 7-10"}),s.jsxs("div",{className:"timeline",children:[s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),s.jsx("p",{children:"100g + 100ml 20-22"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""})," "]})]}),s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),s.jsx("p",{children:"50%50g + 50ml "}),s.jsx("p",{children:"100g  50g50g + 50ml"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),s.jsx("p",{children:"50%50g + 50ml "}),s.jsxs("div",{className:"success-box",children:[" ",s.jsx("br",{})," ",s.jsx("br",{})," "]})]}),s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),s.jsx("p",{children:"1150%1:1"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""}),s.jsx("br",{})," 15",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," pH 3.5-4.0"]})]})]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:"(g)"}),s.jsx("th",{children:"(ml)"}),s.jsx("th",{children:"(g)"}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"0"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"2"}),s.jsx("td",{children:"1"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"0"}),s.jsx("td",{children:""})]})]})]})})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"5-8"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"2-4"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"15-18"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"1-2"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"20-22"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"3-5"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"25-28"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"2-3"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"30"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"1-2"})]})]})]})}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"step-list",children:[s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:"1"}),s.jsx("br",{}),"100g50g + 50ml"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""}),s.jsx("br",{}),"8-12"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""}),s.jsx("br",{}),""]})]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"science-box",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""})," "]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:"2%100ml2g"}),s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," "]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:"2"}),s.jsxs("div",{className:"step-list",children:[s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:"Day 12 8:00"}),s.jsx("br",{}),"50g25g + 25ml "]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:"Day 1  14:00"}),s.jsx("br",{}),"25g + 25ml 2"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:"Day 1  20:00"}),s.jsx("br",{}),""]})]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"warning-box",children:[s.jsx("strong",{children:" "})," ",s.jsx("br",{}),"",s.jsx("br",{}),s.jsx("br",{}),s.jsx("strong",{children:" "})," pH",s.jsx("br",{}),"pH 3.5-4.0pH"]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"18"}),s.jsx("td",{children:"16-24"}),s.jsx("td",{children:"1"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"20-22"}),s.jsx("td",{children:"12-16"}),s.jsx("td",{children:"2"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"24-26"}),s.jsx("td",{children:"8-12"}),s.jsx("td",{children:"2"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"28"}),s.jsx("td",{children:"4-8"}),s.jsx("td",{children:"2"})]})]})]})})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:"1"}),s.jsxs("div",{className:"warning-box",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{}),"1. 22",s.jsx("br",{}),"2. 12",s.jsx("br",{}),"3. 1",s.jsx("br",{}),"4. 1-2"]}),s.jsx("h3",{children:"2"}),s.jsxs("div",{className:"warning-box",children:[s.jsx("strong",{children:""})," pH",s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{})," ",s.jsx("br",{})," "]}),s.jsx("h3",{children:"3"}),s.jsxs("div",{className:"warning-box",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{}),"1. ",s.jsx("br",{}),"2. 15",s.jsx("br",{}),"3. 80%"]}),s.jsx("h3",{children:"4"}),s.jsxs("div",{className:"success-box",children:["",s.jsx("br",{}),s.jsx("br",{}),s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""})," "]}),s.jsx("h3",{children:"5"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{}),"1. 1:0.8",s.jsx("br",{}),"2. ",s.jsx("br",{}),"3. "]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:"pH"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:"pH4-8.0"}),s.jsx("br",{}),s.jsx("br",{})," pH 7.0",s.jsx("br",{})," pH 4.5-5.5",s.jsx("br",{})," pH 3.5-4.0",s.jsx("br",{})," pH 3.0"]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]})]})]})}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"science-box",children:[s.jsx("strong",{children:"pH 3.8-4.0"})," ",s.jsx("br",{}),s.jsx("strong",{children:"pH 3.5"})," ",s.jsx("br",{}),s.jsx("strong",{children:"pH 4.5"})," "]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""}),s.jsx("br",{})," 1",s.jsx("br",{})," ",s.jsx("br",{})," -203"]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"15-20"}),s.jsx("td",{children:"18-20"}),s.jsx("td",{children:"1-2"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"25+"}),s.jsx("td",{children:"22-24"}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"18-22"}),s.jsx("td",{children:"20-22"}),s.jsx("td",{children:"1-2"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"5-15"}),s.jsx("td",{children:"18"}),s.jsx("td",{children:"2-3"}),s.jsx("td",{children:""})]})]})]})}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""}),s.jsx("br",{})," ",s.jsx("br",{})," 24",s.jsx("br",{})," ",s.jsx("br",{}),s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{})," ",s.jsx("br",{})," 18",s.jsx("br",{})," "]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"step-list",children:[s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""}),s.jsx("br",{}),"100g + 50g + 150ml 12-24",s.jsx("br",{}),"11-2"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""}),s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," "]})]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:"100ml"}),s.jsx("br",{})," 110 to 110 CFU/ml",s.jsx("br",{})," 110 to 110 CFU/ml",s.jsx("br",{})," pH3.5-4.0",s.jsx("br",{})," 0.5-1.5%",s.jsx("br",{})," 0.3-0.8%"]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"15-25% ()"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"5-15%"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"20-30%"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"30-50%"}),s.jsx("td",{children:""})]})]})]})}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"formula",children:[" 18   - 8",s.jsx("br",{}),s.jsx("br",{}),"",s.jsx("br",{})," 2018  (20-8) = 1.5",s.jsx("br",{})," 2418  (24-8) = 1.125",s.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),s.jsxs("footer",{className:"levain-footer",children:[s.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),s.jsx("p",{children:""})]}),s.jsxs("button",{className:"levain-back-button",onClick:n,children:[s.jsx("span",{children:""})," "]})]})),kk=({onBack:n})=>{const{user:t,patchCurrentUserProfile:i}=us(),[a,o]=w.useState([]),[u,d]=w.useState(!0),[f,h]=w.useState(null),[m,y]=w.useState(null),[v,x]=w.useState(""),[b,_]=w.useState(""),[C,j]=w.useState(""),[k,E]=w.useState(""),[D,U]=w.useState(!1),[B,T]=w.useState(!1),[N,O]=w.useState(new Set);w.useEffect(()=>{L()},[]);const L=async()=>{try{d(!0);const P=await ia.fetchAllProfiles();o(P)}catch(P){console.error(P),h("")}finally{d(!1)}},Y=a.filter(P=>P.role==="admin"),q=a.filter(P=>P.role!=="admin"),V=(P,R)=>{O(z=>{const K=new Set(z);return R?K.add(P):K.delete(P),K})},F=async(P,R)=>{const z=!!P.show_master_recipes;h(null),o(K=>K.map(ue=>ue.id===P.id?{...ue,show_master_recipes:R}:ue)),P.id===t?.id&&i?.({showMasterRecipes:R}),V(P.id,!0);try{const ue=!!(await ia.updateProfile(P.id,{show_master_recipes:R}))?.show_master_recipes;o(ye=>ye.map($=>$.id===P.id?{...$,show_master_recipes:ue}:$)),P.id===t?.id&&i?.({showMasterRecipes:ue})}catch(K){console.error(K),o(ue=>ue.map(ye=>ye.id===P.id?{...ye,show_master_recipes:z}:ye)),P.id===t?.id&&i?.({showMasterRecipes:z}),h("RLS")}finally{V(P.id,!1)}},I=({user:P,isAdmin:R})=>s.jsxs(an,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[s.jsxs("div",{children:[s.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[P.display_id," ",R&&s.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),P.email&&s.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:P.email}),s.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date(P.created_at).toLocaleString()]}),s.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",P.updated_at?new Date(P.updated_at).toLocaleString():"---"]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[s.jsx("input",{type:"checkbox",checked:P.show_master_recipes||!1,disabled:N.has(P.id),onChange:z=>F(P,z.target.checked)}),""]}),s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>{y({id:P.id,display_id:P.display_id,email:P.email}),x(""),_(""),j(""),E("")},style:{whiteSpace:"nowrap"},children:""})]})]},P.id);return s.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",height:"100%",overflowY:"auto"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[s.jsx("h2",{children:""}),s.jsx(se,{variant:"ghost",onClick:n,children:""})]}),f&&s.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:f}),u?s.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[Y.length>0&&s.jsxs("div",{children:[s.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Y.map(P=>s.jsx(I,{user:P,isAdmin:!0},P.id))})]}),s.jsxs("div",{children:[s.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:q.length>0?q.map(P=>s.jsx(I,{user:P,isAdmin:!1},P.id)):s.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),s.jsx(xn,{isOpen:!!m,onClose:()=>{D||y(null)},title:": ",size:"small",children:s.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[s.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",m?.display_id||m?.email||m?.id]}),m?.email&&s.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:m.email}),s.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),C&&s.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:C}),k&&s.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:k}),s.jsxs("div",{style:{display:"grid",gap:"10px"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),s.jsx("input",{type:"password",value:v,onChange:P=>x(P.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),s.jsx("input",{type:"password",value:b,onChange:P=>_(P.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),s.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>y(null),disabled:D,children:""}),s.jsx(se,{variant:"secondary",isLoading:B,disabled:!m?.email||D,onClick:async()=>{if(j(""),E(""),!m?.email){j("");return}T(!0);try{await ia.sendPasswordResetEmail(m.email),E("")}catch(P){console.error(P),j(P?.message||"")}finally{T(!1)}},style:{whiteSpace:"nowrap"},children:""}),s.jsx(se,{variant:"danger",isLoading:D,onClick:async()=>{if(j(""),E(""),!!m?.id){if(!v||v.length<8){j("8");return}if(v!==b){j("");return}U(!0);try{await ia.adminResetPassword(m.id,v),E(""),x(""),_("")}catch(P){console.error(P);const R=P?.message||"";/FunctionsHttpError|not found|404/i.test(R)||/admin-reset-password/i.test(R)?j(""):j(R)}finally{U(!1)}}},children:""})]})]})})]})},zs="inventory_items",Xi="inventory_snapshots",yo="deleted_inventory_snapshots",Za=(n,t)=>{const i=String(n?.message||"");return String(n?.code||"")==="42703"?i.toLowerCase().includes(String(t).toLowerCase()):i.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&i.toLowerCase().includes("does not exist")},nr={getAll:async n=>{if(!n)return[];const{data:t,error:i}=await Re.from(zs).select("*").eq("user_id",n).order("created_at",{ascending:!0});return i?(console.error("Error fetching inventory:",i),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:i,isPhantom:a,_master:o,_csv:u,...d}=t,f=t?.tax10_override??t?.tax10Override,h={...d,user_id:n,tax10:!!t.tax10,tax10_override:!!f,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0},m=async x=>Re.from(zs).insert([x]).select().single();let{data:y,error:v}=await m(h);if(v){const x=Za(v,"tax10"),b=Za(v,"tax10_override");if(x||b){const _={...h};x&&delete _.tax10,b&&delete _.tax10_override,{data:y,error:v}=await m(_)}}if(v)throw console.error("Error adding item:",v),v;return y},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:i,isPhantom:a,created_at:o,_master:u,_csv:d,...f}=t,h=t?.tax10_override??t?.tax10Override,m={...f,tax10:!!t.tax10,tax10_override:!!h,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()},y=async b=>Re.from(zs).update(b).eq("id",t.id).eq("user_id",n).select().single();let{data:v,error:x}=await y(m);if(x){const b=Za(x,"tax10"),_=Za(x,"tax10_override");if(b||_){const C={...m};b&&delete C.tax10,_&&delete C.tax10_override,{data:v,error:x}=await y(C)}}if(x)throw console.error("Error updating item:",x),x;return v},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:i}=await Re.from(zs).delete().eq("id",t).eq("user_id",n);if(i)throw console.error("Error deleting item:",i),i},adjustStock:async(n,t,i)=>{if(!n)throw new Error("User ID is required");const{data:a,error:o}=await Re.from(zs).select("quantity").eq("id",t).eq("user_id",n).single();if(o||!a)throw new Error("Item not found");const u=Math.max(0,(a.quantity||0)+i),{data:d,error:f}=await Re.from(zs).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(f)throw f;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await Re.from(zs).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:i}=await Re.from("ignored_items").select("name").eq("user_id",n);return i?(console.error("Error fetching ignored items:",i),new Set):new Set(t.map(a=>a.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:i}=await Re.from("ignored_items").insert([{user_id:n,name:t}]).select();if(i&&i.code!=="23505")throw console.error("Error ignoring item:",i),i},getSnapshots:async n=>{if(!n)return[];const{data:t,error:i}=await Re.from(Xi).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return i?(console.error("Error fetching snapshots:",i),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:i}=await Re.from(yo).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return i?(console.error("Error fetching deleted snapshots:",i),[]):t||[]},createSnapshot:async(n,t,i,a)=>{if(!n)throw new Error("User ID is required");let o=null,u=null;const d=await Re.from(Xi).insert([{user_id:n,title:t,items:i,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();if(o=d.data??null,u=d.error??null,u&&Za(u,"user_id")){const f=await Re.from(Xi).insert([{title:t,items:i,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();o=f.data??null,u=f.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return o},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:i,error:a}=await Re.from(Xi).select("*").eq("id",t).eq("user_id",n).single();if(a||!i)throw console.error("Error fetching snapshot for delete:",a),a||new Error("Snapshot not found");const{error:o}=await Re.from(yo).insert([{original_id:i.id,user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at,deleted_at:new Date().toISOString()}]);if(o)throw console.error("Error moving snapshot to trash:",o),o;const{error:u}=await Re.from(Xi).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:i,error:a}=await Re.from(yo).select("*").eq("id",t).eq("user_id",n).single();if(a||!i)throw console.error("Error fetching deleted snapshot:",a),a||new Error("Deleted snapshot not found");let o=null;{const{error:d}=await Re.from(Xi).insert([{id:i.original_id,user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at}]);o=d}if(o){const{error:d}=await Re.from(Xi).insert([{user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await Re.from(yo).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:i}=await Re.from(yo).delete().eq("id",t).eq("user_id",n);if(i)throw console.error("Error hard deleting snapshot from trash:",i),i;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await Re.from(zs).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(Za(t.error,"user_id")){const i=await Re.from(zs).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(i.error)throw console.error("Error resetting quantities (fallback):",i.error),i.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},na=n=>{const t=String(n??"").trim();if(!t)return"";const i=t.toLowerCase();return i===""?"g":i===""?"ml":i===""?"cc":i===""?"kg":i===""?"l":i},Tk=(n,t)=>{const i=na(n),a=na(t);if(!i||!a)return null;if(i===a)return 1;if(i==="kg"&&a==="g")return 1e3;if(i==="g"&&a==="kg")return 1/1e3;const o=i==="cc"?"ml":i,u=a==="cc"?"ml":a;return o==="l"&&u==="ml"?1e3:o==="ml"&&u==="l"?1/1e3:null},Rk=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},vo=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},Ak=({item:n,isLowStock:t,onUpdateQuantity:i,onDelete:a,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const[f,h]=Ce.useState(n.quantity===""?"":parseFloat(n.quantity)||0),m=F=>{const I=String(F||"").trim();return I?I==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(I)?I:"":""},y={food:"",alcohol:"",soft_drink:"",supplies:""};Ce.useEffect(()=>{h(n.quantity===""?"":parseFloat(n.quantity)||0)},[n.quantity]);const v=parseFloat(n.price)||0,x=(()=>{if(!Number.isFinite(v)||v<=0)return"-";const F=n?._csv?.unit,I=String(F||"").trim(),P=String(n?.unit||"").trim();if(!I)return`${vo(v)}`;const R=na(P),z=na(I);if(z===R)return`${vo(v)}/${I}`;const K=Tk(z,R);if(K!==null)return`${vo(v*K)}/${I}`;const ue=parseFloat(n?._master?.packetSize),ye=String(n?._master?.packetUnit||"").trim(),$=na(ye);return Rk(I)&&Number.isFinite(ue)&&ue>0&&$===R?`${vo(v*ue)}/${I}`:`${vo(v)}/${P||"-"}`})(),b=m(n?._master?.itemCategory),_=b==="alcohol"||b==="supplies",C=n?.tax10_override===!0||n?.tax10_override===1||n?.tax10_override==="1"||n?.tax10_override==="true",j=b?C?n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true":_:n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true",k=b?C?`${y[b]||b}: ${_?"10%":"8%"}/ `:`${y[b]||b}${j?"10%":"8%"}`:"10%",E=j?1.1:1.08,D=f===""?0:parseFloat(f),U=v*D*E,B=Ce.useMemo(()=>{const F=n?._master?.packetSize,I=n?._master?.packetUnit,P=parseFloat(F);return!Number.isFinite(P)||P<=0?"-":`${Number.isInteger(P)?P.toLocaleString():P.toLocaleString(void 0,{maximumFractionDigits:3})}${I?String(I):""}`},[n?._master?.packetSize,n?._master?.packetUnit]),T=()=>{const F=parseFloat(f);!isNaN(F)&&F!==n.quantity&&i(n.id,F)},N=F=>{F&&setTimeout(()=>{try{F.select()}catch{}},0)},O=F=>{const P=F?.closest?.("table")||document;return Array.from(P.querySelectorAll("input.inventory-quantity-input"))},L=(F,I)=>{const P=O(F).filter(K=>!K.disabled),R=P.indexOf(F);if(R<0)return!1;const z=P[R+I];return z?(requestAnimationFrame(()=>{try{z.scrollIntoView({block:"nearest"})}catch{}z.focus(),N(z)}),!0):!1},Y=F=>{if(F.key==="Enter"){F.preventDefault(),L(F.currentTarget,F.shiftKey?-1:1),F.currentTarget.blur();return}F.key==="Tab"&&L(F.currentTarget,F.shiftKey?-1:1)&&(F.preventDefault(),F.currentTarget.blur())},q=n?._master?.packetUnit||"",V=!!q&&na(q)!==na(n?.unit);return s.jsxs("tr",{className:t(n)?"low-stock":"",children:[s.jsx("td",{style:{textAlign:"center"},children:s.jsx("input",{type:"checkbox",checked:j,onChange:F=>o&&o(n,F.target.checked),title:k,className:"inventory-tax-checkbox"})}),s.jsxs("td",{children:[n.name,t(n)&&s.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),s.jsx("td",{style:{textAlign:"right"},children:x}),s.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:B}),s.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[s.jsx("input",{type:"text",inputMode:"decimal",value:f,onChange:F=>h(Cb(F.target.value)),className:"inventory-quantity-input no-print",onBlur:T,onKeyDown:Y,onFocus:F=>N(F.target),onClick:F=>N(F.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),s.jsx("span",{className:"print-only",style:{display:"none"},children:f})]}),s.jsx("td",{children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx("span",{children:n.unit}),V&&typeof d=="function"&&s.jsx("button",{type:"button",onClick:()=>d(n),title:`${q}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),s.jsx("td",{style:{textAlign:"right"},children:U>0?`${Math.round(U).toLocaleString()}`:"-"}),s.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:n.vendor||"-"}),s.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof u=="function"&&s.jsx("button",{type:"button",onClick:()=>u(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),s.jsx("button",{onClick:()=>a(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},Ok=({items:n,loading:t,onDelete:i,onUpdateQuantity:a,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:f,isOver:h}=ec({id:"inventory-list-droppable"}),m=_=>_.threshold>0&&_.quantity<=_.threshold,[y,v]=Ce.useState({key:null,direction:"asc"}),x=_=>{v(C=>C.key===_?{key:_,direction:C.direction==="asc"?"desc":"asc"}:{key:_,direction:"asc"})},b=Ce.useMemo(()=>{if(!y.key)return n;const _=[...n];return y.key==="vendor"&&_.sort((C,j)=>{const k=(C?.vendor||"").toString(),E=(j?.vendor||"").toString(),D=k.localeCompare(E,"ja");if(D!==0)return y.direction==="asc"?D:-D;const U=(C?.name||"").toString(),B=(j?.name||"").toString(),T=U.localeCompare(B,"ja");return y.direction==="asc"?T:-T}),_},[n,y]);return s.jsxs("div",{ref:f,className:`inventory-list-droppable ${h?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:h?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[s.jsx("div",{className:"inventory-table-container",children:t?s.jsx("p",{children:"Loading..."}):s.jsxs("table",{className:"inventory-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:"()"}),s.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),s.jsx("th",{style:{width:"40px"}})]})}),s.jsxs("tbody",{children:[b.map(_=>s.jsx(Ak,{item:_,isLowStock:m,onUpdateQuantity:a,onEdit:u,onDelete:i,onToggleTax:o,onRequestUnitSync:d},_.id)),b.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:"9",style:{textAlign:"center",color:"#888",padding:"2rem"},children:h?"":""})})]}),s.jsx("tfoot",{children:(()=>{const _=n.reduce((C,j)=>{const k=parseFloat(j.price)||0,E=j.quantity===""?0:parseFloat(j.quantity)||0,D=j?.tax10===!0||j?.tax10===1||j?.tax10==="1"||j?.tax10==="true"?1.1:1.08,U=k*E;return C.net+=U,C.taxed+=U*D,C},{net:0,taxed:0});return s.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[s.jsx("td",{colSpan:"6",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),s.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(_.net).toLocaleString()," / ",Math.round(_.taxed).toLocaleString()]}),s.jsx("td",{colSpan:"2"})]})})()})]})}),h&&s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},Dk=({onBack:n})=>{const{user:t}=us(),i=t?.id,[,a]=Ko(),[o,u]=w.useState([]),[d,f]=w.useState([]),[h,m]=w.useState([]),[y,v]=w.useState([]),[x,b]=w.useState(new Map),[_,C]=w.useState(new Map),[j,k]=w.useState(new Set),[E,D]=w.useState(!0),[U,B]=w.useState(""),[T,N]=w.useState(!1),[O,L]=w.useState(null),[Y,q]=w.useState(""),[V,F]=w.useState(!1),[I,P]=w.useState(null),[R,z]=w.useState(!1),[K,ue]=w.useState(!1),[ye,$]=w.useState(""),[Q,X]=w.useState(!1),[fe,ke]=w.useState(!0),[Ue,de]=w.useState(!1),[H,G]=w.useState(null),[oe,pe]=w.useState("history"),[je,Ie]=w.useState(null),[Be,Pe]=w.useState(""),[lt,rt]=w.useState(!1),[qe,xe]=w.useState(null),[_e,te]=w.useState(!0),[We,Tt]=w.useState({key:"name",direction:"asc"}),[Ct,le]=w.useState(!1),[Ae,Oe]=w.useState(null),[Ge,nt]=w.useState(new Set),[St,on]=w.useState(!1),[Tn,Jt]=w.useState(null),[dt,tn]=w.useState(null),[qt,ir]=w.useState(!1),xr=gl(vr(Ju,{activationConstraint:{distance:8}})),[jn,ve]=w.useState("all"),[st,Ze]=w.useState(new Set),[tt,vt]=w.useState(""),[At,Et]=w.useState(""),[Lt,ht]=w.useState({});w.useEffect(()=>{q(O&&O.name||"")},[O]);const[Pt,Nt]=w.useState(""),Xt=({row:M,onVendorClick:J,isSelected:ee})=>{const{attributes:we,listeners:De,setNodeRef:ze,setActivatorNodeRef:$e,transform:Ve,transition:Qe,isDragging:et}=xl({id:M.vendor,data:{type:"summary-row"}}),at={transform:Or.Transform.toString(Ve),transition:Qe,opacity:et?.6:1};return s.jsxs("tr",{ref:ze,style:at,...we,className:ee?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[s.jsx("td",{className:"inventory-summary__drag",children:s.jsx("span",{ref:$e,...De,className:"inventory-summary__drag-handle",title:"",children:""})}),s.jsx("td",{children:s.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>J?.(M.vendor),"aria-expanded":!!ee,children:[s.jsx("span",{children:M.vendor}),s.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:ee?"":""})]})}),s.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(M.total||0).toLocaleString()]})]})};w.useEffect(()=>{i&&(ve("all"),B(""),mt())},[i]);const mt=async(M=!1)=>{M||D(!0);try{const[J,ee,we,De,ze,$e,Ve]=await Promise.all([nr.getAll(i),sr.getPriceListArray(),nr.getIgnoredItems(i),nr.getSnapshots(i),nr.getDeletedSnapshots(i),qn.getAllConversions(),Fu.getAll(i)]);u(J),v(ee),k(we),f(De||[]),m(ze||[]),b($e||new Map),C(Ve||new Map);const Qe=Xe=>{if(!Xe)return-1;const _n=new Date(Xe).getTime();return Number.isFinite(_n)?_n:-1},et=(Xe,Ot)=>{const _n=Math.max(Qe(Xe?.updated_at),Qe(Xe?.updatedAt),Qe(Xe?.created_at),Qe(Xe?.createdAt)),Cn=Math.max(Qe(Ot?.updated_at),Qe(Ot?.updatedAt),Qe(Ot?.created_at),Qe(Ot?.createdAt));return _n!==Cn&&Cn>_n?Ot:Xe},at=new Map;(J||[]).forEach(Xe=>{const Ot=String(Xe?.vendor??"").trim()||"__no_vendor__",_n=ln(Xe?.name)||String(Xe?.name??"").trim();if(!_n)return;const Cn=`${Ot}@@${_n}`,Ur=at.get(Cn);if(!Ur){at.set(Cn,Xe);return}at.set(Cn,et(Ur,Xe))});const ut=new Set(Array.from(at.values()).map(Xe=>Xe.id));Ze(ut)}catch(J){console.error("Failed to load data:",J)}finally{M||D(!1)}},Zt=M=>{if(!M)return"-";const J=new Date(M);if(Number.isNaN(J.getTime()))return String(M);const ee=J.getFullYear(),we=String(J.getMonth()+1).padStart(2,"0"),De=String(J.getDate()).padStart(2,"0"),ze=String(J.getHours()).padStart(2,"0"),$e=String(J.getMinutes()).padStart(2,"0");return`${ee}/${we}/${De} ${ze}:${$e}`},Rt=M=>{const J=M?.items;return Array.isArray(J)?J:J?[]:[]},en=M=>{const J=M?.snapshot_date||M?.created_at;if(!J)return null;const ee=new Date(J);return Number.isNaN(ee.getTime())?null:ee},un=Ce.useMemo(()=>new Set([""]),[]),ce=M=>{const J=String(M??"").trim();return un.has(J)},Le=M=>M===!0||M===1||M==="1"||M==="true",He=M=>{const J=String(M??"").trim();if(!J)return"";const ee=J.toLowerCase();return ee===""?"g":ee===""?"ml":ee===""?"cc":ee===""?"kg":ee===""?"l":ee},pt=(M,J)=>{const ee=parseFloat(M?.lastPrice),we=parseFloat(M?.packetSize),De=He(M?.packetUnit),ze=He(J||De);if(!Number.isFinite(ee)||!Number.isFinite(we)||we<=0||!De)return null;const $e=ee/we;if(ze===De)return $e;if(De==="g"&&ze==="kg")return $e*1e3;if(De==="kg"&&ze==="g")return $e/1e3;const Ve=De==="cc"?"ml":De,Qe=ze==="cc"?"ml":ze;return Ve==="ml"&&Qe==="l"?$e*1e3:Ve==="l"&&Qe==="ml"?$e/1e3:null},Dt=(M,J)=>{const ee=He(M),we=He(J);if(!ee||!we)return null;if(ee===we)return 1;if(ee==="kg"&&we==="g")return 1e3;if(ee==="g"&&we==="kg")return 1/1e3;const De=ee==="cc"?"ml":ee,ze=we==="cc"?"ml":we;return De==="l"&&ze==="ml"?1e3:De==="ml"&&ze==="l"?1/1e3:null},ne=M=>{const J=String(M||"").trim();return J?J==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(J)?J:"":""},ae=M=>{const J=ne(M);return J==="alcohol"||J==="supplies"},re=M=>{const J=ne(M);return J==="food"?"":J==="alcohol"||J==="soft_drink"?"":J==="supplies"?"":""},be=M=>{const J=ne(M);return J==="food"?"food":J==="alcohol"||J==="soft_drink"?"drink":J==="supplies"?"supplies":"unknown"},Me=M=>M==="food"?"":M==="drink"?"":M==="supplies"?"":"",Je=M=>Le(M?.tax10)?1.1:1.08,Fe=M=>M?`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}`:"",Ke=M=>{if(!M)return-1;const ee=new Date(M).getTime();return Number.isFinite(ee)?ee:-1},Mt=M=>{const J=[M?.updated_at,M?.updatedAt,M?.created_at,M?.createdAt];for(const ee of J){const we=Ke(ee);if(we>=0)return we}return-1},xt=Ce.useMemo(()=>{const M=new Map;return d.forEach(J=>{const ee=en(J);if(!ee)return;const we=Fe(ee);M.has(we)||M.set(we,{key:we,year:ee.getFullYear(),month:ee.getMonth()+1})}),Array.from(M.values()).sort((J,ee)=>ee.key.localeCompare(J.key)).map(J=>({...J,label:`${J.year}${J.month}`}))},[d]);w.useEffect(()=>{if(xt.length===0){tt&&vt("");return}if(tt&&xt.some(ee=>ee.key===tt))return;const M=Fe(new Date),J=xt.find(ee=>ee.key===M)?.key||xt[0].key;vt(J)},[xt,tt]),w.useEffect(()=>{if(xt.length===0){At&&Et("");return}if(At&&xt.some(ee=>ee.key===At))return;const M=Fe(new Date),J=xt.find(ee=>ee.key===M)?.key||xt[0].key;Et(J)},[xt,At]);const It=Ce.useMemo(()=>{if(!At)return null;const[M,J]=At.split("-"),ee=parseInt(M,10),we=parseInt(J,10);if(!Number.isFinite(ee)||!Number.isFinite(we))return null;const De=Ve=>String(Ve).padStart(2,"0"),ze=new Date(ee,we-1,1),$e=new Date(ee,we,0);return{year:ee,month:we,start:ze,end:$e,rangeLabel:`${ee}/${De(we)}/01${ee}/${De(we)}/${De($e.getDate())}`}},[At]),Ye=Ce.useMemo(()=>At?d.map(M=>({snapshot:M,date:en(M)})).filter(M=>M.date&&Fe(M.date)===At).sort((M,J)=>J.date-M.date).map(M=>M.snapshot):d,[d,At]),bt=Ce.useMemo(()=>{if(!tt)return null;const[M,J]=tt.split("-"),ee=parseInt(M,10),we=parseInt(J,10);if(!Number.isFinite(ee)||!Number.isFinite(we))return null;const De=Ve=>String(Ve).padStart(2,"0"),ze=new Date(ee,we-1,1),$e=new Date(ee,we,0);return{year:ee,month:we,start:ze,end:$e,rangeLabel:`${ee}/${De(we)}/01${ee}/${De(we)}/${De($e.getDate())}`}},[tt]),Gt=Ce.useMemo(()=>tt?d.map(M=>({snapshot:M,date:en(M)})).filter(M=>M.date&&Fe(M.date)===tt).sort((M,J)=>J.date-M.date).map(M=>M.snapshot):[],[d,tt]),cn=Gt[0]||null,Kn=tt||(cn?.id?`snapshot:${cn.id}`:""),br=Ce.useMemo(()=>{const M=new Map;return Gt.forEach(J=>{const ee=en(J)?.getTime()||-1;Rt(J).forEach((De,ze)=>{const $e=(De?.vendor||"").toString().trim();if(ce($e))return;const Ve=$e||"",Qe=String(De?.name||"").trim();if(!Qe)return;const et=`${Ve}::${Qe}`,at={item:{...De,vendor:Ve},snapshotMs:ee,itemUpdatedMs:Mt(De),rowIndex:ze},ut=M.get(et);if(!ut){M.set(et,at);return}if(at.snapshotMs!==ut.snapshotMs){at.snapshotMs>ut.snapshotMs&&M.set(et,at);return}if(at.itemUpdatedMs!==ut.itemUpdatedMs){at.itemUpdatedMs>ut.itemUpdatedMs&&M.set(et,at);return}at.rowIndex>=ut.rowIndex&&M.set(et,at)})}),Array.from(M.values()).map(J=>J.item)},[Gt,ce]),Wr=Ce.useMemo(()=>{const M=new Map;return br.forEach(J=>{const ee=(J?.vendor||"").toString().trim(),we=ee||"";if(ce(ee))return;const De=parseFloat(J?.price)||0,ze=J?.quantity===""?0:parseFloat(J?.quantity)||0,$e=De*ze,Ve=$e*Je(J),Qe=M.get(we)||{vendor:we,net:0,taxed:0};Qe.net+=$e,Qe.taxed+=Ve,M.set(we,Qe)}),Array.from(M.values()).map(J=>({vendor:J.vendor,net:J.net,taxed:J.taxed,total:J.taxed}))},[br,ce,Je]),Dr=Ce.useMemo(()=>{const M=new Map;return Wr.forEach(J=>{M.set(J.vendor,J)}),M},[Wr]),Ei=Ce.useMemo(()=>{const M=new Map;try{for(const[J,ee]of(x||new Map).entries()){const we=String(J??"").trim();we&&M.set(we,ee)}}catch{}return M},[x]),Vs=Ce.useCallback(M=>{const J=ne(M?.itemCategory??M?.item_category);if(J)return J;const ee=String(M?.name??"").trim();if(!ee)return"";const we=Ei.get(ee);return ne(we?.itemCategory??we?.item_category)},[Ei]),Qr=Ce.useMemo(()=>{const M=new Map;br.forEach((J,ee)=>{const we=(J?.vendor||"").toString().trim(),De=we||"";if(ce(we))return;const ze=parseFloat(J?.price)||0,$e=J?.quantity===""?0:parseFloat(J?.quantity)||0,Ve=ze*$e,Qe=Ve*Je(J),et=Vs(J),at=be(et),ut=M.get(De)||{vendor:De,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};ut.totals[at]+=Qe,ut.totals.net+=Ve,ut.totals.taxed+=Qe,ut.rows.push({id:J?.id||`${De}-${J?.name||"item"}-${ee}`,name:J?.name||"",unit:J?.unit||"",quantity:$e,price:ze,taxed:Qe,itemCategory:et,breakdownKey:at}),M.set(De,ut)});for(const J of M.values())J.rows.sort((ee,we)=>{const De={food:0,drink:1,unknown:2,supplies:3},ze=De[ee?.breakdownKey]??2,$e=De[we?.breakdownKey]??2;if(ze!==$e)return ze-$e;const Ve=(ee?.name||"").toString(),Qe=(we?.name||"").toString();return Ve.localeCompare(Qe,"ja")});return M},[br,ce,Je,Vs]),ar=Ce.useMemo(()=>Wr.slice().sort((M,J)=>J.taxed!==M.taxed?J.taxed-M.taxed:M.vendor.localeCompare(J.vendor,"ja")).map(M=>M.vendor),[Wr]),ki=Ce.useMemo(()=>{if(!Kn)return ar;const M=Lt[Kn],J=new Set(Dr.keys()),ee=Array.isArray(M)?M.filter(De=>J.has(De)):[],we=ar.filter(De=>!ee.includes(De));return[...ee,...we]},[Lt,Kn,ar,Dr]),da=Ce.useMemo(()=>ki.map(M=>Dr.get(M)).filter(Boolean),[ki,Dr]),ha=da.reduce((M,J)=>(M.net+=J.net||0,M.taxed+=J.taxed||0,M),{net:0,taxed:0});w.useEffect(()=>{Pt&&(Dr.has(Pt)||Nt(""))},[Pt,Dr]);const nc=M=>{Nt(J=>J===M?"":M)},fa=M=>{M?.id&&i&&(rt(!1),xe(null),Pe(""),Ie({title:"",message:`${M.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{rt(!0),xe({type:"move",id:M.id});try{await nr.deleteSnapshotToTrash(i,M.id),await mt(!0),Jt({title:"",message:"",type:"success"})}catch(J){console.error(J),Jt({title:"",message:"()",type:"error"})}finally{rt(!1),xe(null),Ie(null)}}}))},ad=M=>{M?.id&&i&&(rt(!1),xe(null),Pe(""),Ie({title:"",message:`${M.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{rt(!0),xe({type:"restore",id:M.id});try{await nr.restoreSnapshotFromTrash(i,M.id),await mt(!0),Jt({title:"",message:"",type:"success"})}catch(J){console.error(J),Jt({title:"",message:"",type:"error"})}finally{rt(!1),xe(null),Ie(null)}}}))},dr=M=>{M?.id&&i&&(rt(!1),xe(null),Pe(""),Ie({title:" ",message:`${M.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{rt(!0),xe({type:"hard-delete",id:M.id});try{await nr.hardDeleteSnapshotFromTrash(i,M.id),await mt(!0),Jt({title:"",message:"",type:"success"})}catch(J){console.error(J),Jt({title:"",message:"",type:"error"})}finally{rt(!1),xe(null),Ie(null)}}}))},Ti=M=>{if(!M)return;const J=Rt(M).filter(Xe=>!ce(Xe?.vendor)),ee=["","","","","()",""],we=J.map(Xe=>{const Ot=parseFloat(Xe?.price)||0,_n=Xe?.quantity===""?0:parseFloat(Xe?.quantity)||0,Cn=Math.round(Ot*_n*Je(Xe));return[Xe?.name??"",Ot||"",Xe?.unit??"",Xe?.quantity??"",Cn||"",Xe?.vendor??""]}),De=Xe=>{const Ot=String(Xe??"");return Ot.includes(",")||Ot.includes('"')||Ot.includes(`
`)||Ot.includes("\r")?`"${Ot.replace(/"/g,'""')}"`:Ot},ze=[ee.map(De).join(","),...we.map(Xe=>Xe.map(De).join(","))].join(`
`),$e=new Uint8Array([239,187,191]),Ve=new Blob([$e,ze],{type:"text/csv"}),Qe=URL.createObjectURL(Ve),et=(M.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),at=(M.snapshot_date?new Date(M.snapshot_date):new Date).toISOString().slice(0,10),ut=document.createElement("a");ut.href=Qe,ut.download=`InventorySnapshot_${at}_${et}.csv`,document.body.appendChild(ut),ut.click(),document.body.removeChild(ut),URL.revokeObjectURL(Qe)},rc=()=>{if(!cn)return;const M=["","()"],J=da.map(Xe=>[Xe.vendor,Math.round(Xe.total||0)]),ee=Xe=>{const Ot=String(Xe??"");return Ot.includes(",")||Ot.includes('"')||Ot.includes(`
`)||Ot.includes("\r")?`"${Ot.replace(/"/g,'""')}"`:Ot},we=[M.map(ee).join(","),...J.map(Xe=>Xe.map(ee).join(","))].join(`
`),De=new Uint8Array([239,187,191]),ze=new Blob([De,we],{type:"text/csv"}),$e=URL.createObjectURL(ze),Ve=(cn.snapshot_date?new Date(cn.snapshot_date):new Date).toISOString().slice(0,10),Qe=cn.title||"inventory_summary",et=bt?`${bt.year}${String(bt.month).padStart(2,"0")}`:Ve,at=Qe.toString().replace(/[\\/:*?"<>|]/g,"_"),ut=document.createElement("a");ut.href=$e,ut.download=`InventorySummary_${et}_${at}.csv`,document.body.appendChild(ut),ut.click(),document.body.removeChild(ut),URL.revokeObjectURL($e)},bl=M=>{if(!M?.vendor)return;const J=["","","","","","()",""],ee=(M.rows||[]).map(Xe=>{const Ot=Xe.itemCategory?re(Xe.itemCategory):Me(Xe.breakdownKey);return[Xe.name||"",Ot,Math.round(Xe.price||0),Xe.unit||"",Number(Xe.quantity||0),Math.round(Xe.taxed||0),M.vendor]}),we=Xe=>{const Ot=String(Xe??"");return Ot.includes(",")||Ot.includes('"')||Ot.includes(`
`)||Ot.includes("\r")?`"${Ot.replace(/"/g,'""')}"`:Ot},De=[J.map(we).join(","),...ee.map(Xe=>Xe.map(we).join(","))].join(`
`),ze=new Uint8Array([239,187,191]),$e=new Blob([ze,De],{type:"text/csv"}),Ve=URL.createObjectURL($e),Qe=(cn?.snapshot_date?new Date(cn.snapshot_date):new Date).toISOString().slice(0,10),et=bt?`${bt.year}${String(bt.month).padStart(2,"0")}`:Qe,at=M.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),ut=document.createElement("a");ut.href=Ve,ut.download=`InventorySummary_${et}_${at}.csv`,document.body.appendChild(ut),ut.click(),document.body.removeChild(ut),URL.revokeObjectURL(Ve)},Mr=Ce.useMemo(()=>{const M=ct=>ct?ct.toString().trim():"",J=ct=>ln(ct),ee=new Set;try{for(const ct of(j||new Set).values()){const yt=J(ct);yt&&ee.add(yt)}}catch{}const we=new Set;try{for(const ct of(Ge||new Set).values()){const yt=J(ct);yt&&we.add(yt)}}catch{}const De=new Map;try{for(const[ct,yt]of(x||new Map).entries()){const zt=J(ct);zt&&De.set(zt,yt)}}catch{}const ze=new Map;try{(y||[]).forEach(ct=>{const yt=J(ct?.name);yt&&ze.set(yt,ct)})}catch{}const $e=new Map;try{for(const[ct,yt]of(_||new Map).entries()){const zt=J(ct);zt&&$e.set(zt,yt)}}catch{}const Ve=ct=>{const yt=String(ct??"").trim();if(!yt)return"";const zt=yt.toLowerCase();return zt===""?"g":zt===""?"ml":zt===""?"cc":zt===""?"kg":zt===""?"l":zt},Qe=(ct,yt)=>{const zt=parseFloat(ct?.lastPrice),bn=parseFloat(ct?.packetSize),En=Ve(ct?.packetUnit),zn=Ve(yt||En);if(!Number.isFinite(zt)||!Number.isFinite(bn)||bn<=0||!En)return null;const Vt=zt/bn;if(zn===En)return Vt;if(En==="g"&&zn==="kg")return Vt*1e3;if(En==="kg"&&zn==="g")return Vt/1e3;const hr=En==="cc"?"ml":En,Un=zn==="cc"?"ml":zn;return hr==="ml"&&Un==="l"?Vt*1e3:hr==="l"&&Un==="ml"?Vt/1e3:null},et=ct=>{const yt=String(ct??"").trim();return yt?["","","","","","","","pc","PC",""].includes(yt):!1},at=ct=>{const yt=J(ct?.name),zt=yt?De.get(yt):null,bn=yt?ze.get(yt):null,En=yt&&$e.has(yt)?String($e.get(yt)||""):String(bn?.unit||""),zn={...ct};if(zn.name=M(zn.name),zn.vendor=M(zn.vendor),zn._csv={unit:En,price:bn?.price??null,vendor:M(bn?.vendor)||null,dateStr:bn?.dateStr??null},!zt)return zn;const Vt={...zn},hr=ne(zt?.itemCategory),Un=zt.packetUnit||"",ys=parseFloat(zt.packetSize),Zr=Un?Qe(zt,Un):null;if(Vt.isPhantom)Un&&Zr!==null&&(Vt.unit=Un,Vt.price=Zr);else{if(!!Un&&Number.isFinite(ys)&&ys>0&&(et(Vt.unit)||!Vt.unit)&&Zr!==null){const vs=Vt.quantity;if(vs!==""&&vs!==null&&vs!==void 0){const Ai=parseFloat(vs);Number.isFinite(Ai)&&(Vt.quantity=Ai*ys)}const Xs=Vt.threshold;if(Xs!==""&&Xs!==null&&Xs!==void 0){const Ai=parseFloat(Xs);Number.isFinite(Ai)&&(Vt.threshold=Ai*ys)}Vt.unit=Un}else(Un&&Zr!==null||!Vt.unit&&Un)&&(Vt.unit=Un);if(Zr!==null&&Ve(Vt.unit)===Ve(Un))Vt.price=Zr;else{const vs=Qe(zt,Vt.unit||Un);vs!==null&&(Vt.price=vs)}}const Js=Le(Vt?.tax10_override??Vt?.tax10Override),kl=hr?ae(hr):null;return Vt._master={packetSize:zt.packetSize,packetUnit:zt.packetUnit,lastPrice:zt.lastPrice,itemCategory:hr||null,tax10Auto:kl,tax10Override:Js,updatedAt:zt.updatedAt},hr&&(Vt.tax10_override=Js,!Js&&kl!==null&&(Vt.tax10=kl)),Vt},ut=o.map(at),Xe=new Map;ut.forEach(ct=>{const yt=J(ct?.name);yt&&Xe.set(yt,ct)});const Ot=[...ut];y.forEach((ct,yt)=>{const zt=String(ct?.name??""),bn=M(zt),En=J(zt);if(En&&!(j.has(zt)||bn&&j.has(bn)||ee.has(En))&&!Xe.has(En)){const zn={id:`phantom-${yt}`,isPhantom:!0,name:bn,quantity:"",unit:ct.unit||"",category:"",price:ct.price,vendor:M(ct.vendor),threshold:0,tax10:!1,tax10_override:!1};Ot.push(at(zn))}});const _n=Ot.filter(ct=>{const yt=String(ct?.name??""),zt=M(yt),bn=J(yt);return!(j.has(yt)||zt&&j.has(zt)||bn&&ee.has(bn)||Ge.has(yt)||zt&&Ge.has(zt)||bn&&we.has(bn)||ce(ct.vendor))}),Cn=ct=>{if(!ct)return-1;const zt=new Date(ct).getTime();return Number.isFinite(zt)?zt:-1},Ur=(ct,yt)=>{const zt=!!ct?.isPhantom,bn=!!yt?.isPhantom;if(zt!==bn)return zt?yt:ct;const En=Math.max(Cn(ct?.updated_at),Cn(ct?.updatedAt),Cn(ct?.created_at),Cn(ct?.createdAt)),zn=Math.max(Cn(yt?.updated_at),Cn(yt?.updatedAt),Cn(yt?.created_at),Cn(yt?.createdAt));if(En!==zn)return zn>En?yt:ct;const Vt=ct?.quantity,hr=yt?.quantity,Un=Vt===""||Vt===null||Vt===void 0?null:parseFloat(Vt),ys=hr===""||hr===null||hr===void 0?null:parseFloat(hr),Zr=Un!==null&&Number.isFinite(Un),Js=ys!==null&&Number.isFinite(ys);return Zr!==Js&&Js?yt:ct},Xr=new Map;return _n.forEach(ct=>{const yt=J(ct?.name)||M(ct?.name);if(!yt)return;const bn=`${M(ct?.vendor)||"__no_vendor__"}@@${yt}`,En=Xr.get(bn);if(!En){Xr.set(bn,ct);return}Xr.set(bn,Ur(En,ct))}),Array.from(Xr.values())},[o,y,j,Ge,x,_,ce]),sc=M=>{const{active:J,over:ee}=M;if(!ee)return;if(J?.data?.current?.type==="summary-row"){if(!Kn)return;const De=J.id,ze=ee.id;if(!De||!ze||De===ze)return;const $e=ki,Ve=$e.indexOf(De),Qe=$e.indexOf(ze);if(Ve<0||Qe<0)return;const et=ca($e,Ve,Qe);ht(at=>({...at,[Kn]:et}));return}if(ee.id==="inventory-list-droppable"){const De=J.data.current.item;if(J.data.current.type==="csv-item"){const ze=String(De?.name??"").trim(),$e=ln(ze);let Ve=null;if(x&&x.size>0&&$e&&(Ve=x.get(ze)||null,!Ve)){for(const[ut,Xe]of x.entries())if(ln(ut)===$e){Ve=Xe;break}}const Qe=Ve?.packetUnit||De.unit,et=Ve?pt(Ve,Qe):null,at=et!==null?et:Ve?.lastPrice!==null&&Ve?.lastPrice!==void 0&&Ve?.lastPrice!==""?Ve.lastPrice:De.price;L({name:De.name,price:at,unit:Qe,category:"",threshold:0,quantity:0,vendor:De.vendor,tax10:Le(De?.tax10),isNewFromCsv:!0}),N(!0),q(De.name||"")}}},ic=async M=>{if(M.preventDefault(),!i)return;const J=new FormData(M.target),ee=J.get("name"),we=parseFloat(J.get("quantity")),De=J.get("unit"),ze=J.get("category"),$e=parseFloat(J.get("threshold")),Ve=J.get("vendor"),Qe=parseFloat(J.get("price")),et=J.get("packetSize"),at=J.get("packetUnit"),ut={name:ee,quantity:Number.isFinite(we)?we:0,unit:De,category:ze,threshold:Number.isFinite($e)?$e:0,vendor:Ve||O?.vendor||"",price:Number.isFinite(Qe)?Qe:O?.price||0,tax10:Le(O?.tax10)};try{if(et&&at){const Xe=parseFloat(et);Number.isFinite(Xe)&&Xe>0&&await qn.saveConversion(ee,Xe,at,Number.isFinite(Qe)?Qe:null,ze,Ve)}O?.id&&!O.isPhantom?await nr.update(i,{...O,...ut}):await nr.add(i,ut),N(!1),L(null),mt()}catch(Xe){console.error("Failed to save item:",Xe),Jt({title:"",message:"",type:"error"})}},Ks=M=>{Oe(M),le(!0)},ld=M=>{!M||M.isPhantom||!M?._master?.packetUnit||(P(M),F(!0))},wl=()=>{R||(F(!1),P(null))},Sl=async({convertQuantity:M})=>{if(!i)return;const J=I;if(!J||J.isPhantom)return;const ee=J?._master?.packetUnit;if(!ee)return;const we=ee,De=pt(J?._master,we);if(De===null){Jt({title:"",message:"/",type:"error"});return}let ze=J.quantity,$e=J.threshold;if(M){const Ve=Dt(J.unit,we);if(!Ve){Jt({title:"",message:"kgg / lml ",type:"error"});return}const Qe=J.quantity===""?null:parseFloat(J.quantity);Qe!==null&&Number.isFinite(Qe)&&(ze=Qe*Ve);const et=J.threshold===""?null:parseFloat(J.threshold);et!==null&&Number.isFinite(et)&&($e=et*Ve)}z(!0);try{await nr.update(i,{id:J.id,unit:we,price:De,quantity:ze===""?0:parseFloat(ze)||0,threshold:$e===""?0:parseFloat($e)||0,tax10:Le(J?.tax10)}),await mt(!0),F(!1),P(null)}catch(Ve){console.error("Failed to sync unit:",Ve),Jt({title:"",message:"",type:"error"})}finally{z(!1)}},jl=async()=>{if(Ae)try{const J=(ee=>ee?ee.toString().trim():"")(Ae?.name);J&&nt(ee=>{const we=new Set(ee);return we.add(J),we}),le(!1),Oe(null)}catch(M){console.error("Failed to delete/ignore item:",M)}},od=async(M,J)=>{try{if(!i)return;const ee=Mr.find(we=>we.id===M);if(!ee)return;if(ee.isPhantom){const we={name:ee.name.trim(),quantity:J,unit:ee.unit,category:ee.category||"",price:ee.price,vendor:ee.vendor,threshold:0,tax10:Le(ee?.tax10)},De=await nr.add(i,we);await mt(!0),Ze(ze=>{const $e=new Set(ze);return $e.add(De.id),$e})}else u(we=>we.map(De=>De.id!==M?De:{...De,quantity:J,unit:ee.unit??De.unit,price:ee.price??De.price,threshold:ee.threshold??De.threshold})),Ze(we=>{const De=new Set(we);return De.add(M),De}),await nr.update(i,{...ee,quantity:J})}catch(ee){console.error(ee);const we=ee?.message||ee?.error_description||(typeof ee=="string"?ee:null)||(()=>{try{return JSON.stringify(ee)}catch{return null}})()||"";Jt({title:"",message:`
${we}`,type:"error"}),mt()}},ac=async(M,J)=>{try{if(!i||!M)return;const ee=!!J;if(M.isPhantom){const we={name:M.name.trim(),quantity:M.quantity===""?0:parseFloat(M.quantity)||0,unit:M.unit,category:M.category||"",price:M.price,vendor:M.vendor,threshold:0,tax10:ee,tax10_override:!0};await nr.add(i,we),await mt(!0)}else u(we=>we.map(De=>De.id===M.id?{...De,tax10:ee,tax10_override:!0}:De)),await nr.update(i,{...M,tax10:ee,tax10_override:!0})}catch(ee){console.error(ee);const we=ee?.message||ee?.error_description||(typeof ee=="string"?ee:null)||(()=>{try{return JSON.stringify(ee)}catch{return null}})()||"";Jt({title:"",message:`
${we}`,type:"error"}),mt()}},pa=(M,J)=>{if(J===!0){tn({item:M});return}ac(M,J)},zr=()=>{qt||tn(null)},_l=async()=>{const M=dt?.item;if(M){ir(!0);try{await ac(M,!0),tn(null)}finally{ir(!1)}}},Cl=async()=>{if(!Q&&ye&&i){X(!0);try{const M=Mr.filter(ee=>!ee.isPhantom).map(ee=>{const we={...ee};return delete we.isPhantom,delete we._master,delete we._csv,we}),J=M.reduce((ee,we)=>{const De=parseFloat(we.price)||0,ze=we.quantity===""?0:parseFloat(we.quantity)||0;return ee+De*ze*Je(we)},0);await nr.createSnapshot(i,ye,M,J),fe?(await nr.resetStockQuantities(i),await mt(),Ze(new Set)):await mt(!0),ue(!1),on(!0)}catch(M){console.error("Failed to complete inventory:",M);const J=M?.message||M?.error_description||(typeof M=="string"?M:null)||(()=>{try{return JSON.stringify(M)}catch{return null}})()||"";Jt({title:"",message:`
${J}`,type:"error"})}finally{X(!1)}}},Ys=()=>{const M=["","","","","()",""],J=Qs.map(Qe=>{const et=parseFloat(Qe.price)||0,at=Qe.quantity===""?0:parseFloat(Qe.quantity)||0,ut=Math.round(et*at*Je(Qe));return[Qe.name,et,Qe.unit,Qe.quantity,ut,Qe.vendor||""]}),ee=[M.join(","),...J.map(Qe=>Qe.map(et=>{const at=String(et??"");return at.includes(",")||at.includes('"')||at.includes(`
`)?`"${at.replace(/"/g,'""')}"`:at}).join(","))].join(`
`),we=new Uint8Array([239,187,191]),De=new Blob([we,ee],{type:"text/csv"}),ze=document.createElement("a"),$e=URL.createObjectURL(De),Ve=new Date().toISOString().split("T")[0];ze.href=$e,ze.download=`Inventory_${Ve}.csv`,document.body.appendChild(ze),ze.click(),document.body.removeChild(ze),URL.revokeObjectURL($e)},Ws=["","","","","","","","","","","",""],Nl=[...new Set(Mr.map(M=>M.vendor).filter(M=>M&&!ce(M)))].sort(),El=Mr.some(M=>!M.vendor),Ri=jn==="summary",Qs=Mr.filter(M=>M.name.toLowerCase().includes(U.toLowerCase())?jn==="all"||jn==="summary"?!0:jn==="inventory-check"?st.has(M.id)||!M.isPhantom:jn==="other"?!M.vendor:M.vendor===jn:!1),Jr=M=>{if(!M)return;const J=ln(M.name);let ee=null;if(x&&x.size>0&&J&&(ee=x.get(M.name)||null,!ee)){for(const[we,De]of x.entries())if(ln(we)===J){ee=De;break}}if(ee){const we=ee.packetUnit||O?.unit||"",De=ee.packetUnit?pt(ee,we):null,ze=De!==null?De:ee.lastPrice||O?.price||0;L($e=>({...$e,name:M.name,price:ze,unit:we,vendor:ee.vendor||$e?.vendor||"",_master:{packetSize:ee.packetSize,packetUnit:ee.packetUnit,lastPrice:ee.lastPrice,itemCategory:ee.itemCategory,updatedAt:ee.updatedAt}}))}else L(we=>({...we,name:M.name}))};if(T){const M=O?._master?.packetSize||"",J=O?._master?.packetUnit||"";return s.jsxs("div",{className:"inventory-edit-container fade-in",children:[s.jsx("div",{className:"container-header",children:s.jsx("h2",{className:"section-title",children:O&&!O.isNewFromCsv?"":""})}),s.jsx(an,{className:"edit-form-card",children:s.jsxs("form",{onSubmit:ic,children:[s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:[" ",s.jsx("span",{className:"badge-required",children:""})]}),s.jsx(sd,{name:"name",required:!0,value:Y,onChange:ee=>q(ee.target.value),onSelect:Jr,placeholder:": "})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:""}),s.jsx(kt,{name:"vendor",defaultValue:O?.vendor,list:"vendor-list",placeholder:": "}),s.jsx("datalist",{id:"vendor-list",children:Nl.filter(ee=>ee!=="").map(ee=>s.jsx("option",{value:ee},ee))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:" ()"}),s.jsx(kt,{name:"price",type:"number",step:"1",defaultValue:O?.price,placeholder:"0"})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:[" ",s.jsx("span",{className:"badge-required",children:""})]}),s.jsx(kt,{name:"quantity",type:"number",step:"0.01",defaultValue:O?.quantity,required:!0})]}),s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:[" ",s.jsx("span",{className:"badge-required",children:""})]}),s.jsx(kt,{name:"unit",defaultValue:O?.unit||"pc",required:!0,placeholder:"g, ml, , pc..."})]})]}),s.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px",color:"#495057"},children:["  ()",s.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",marginLeft:"8px",color:"#868e96"},children:" 1pc = 400g "})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{style:{fontSize:"0.85rem"},children:" (1)"}),s.jsx(kt,{name:"packetSize",type:"number",step:"0.01",defaultValue:M,placeholder:": 400"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{style:{fontSize:"0.85rem"},children:""}),s.jsx(kt,{name:"packetUnit",defaultValue:J,placeholder:": g"})]})]})]}),s.jsxs("div",{className:"form-row",style:{marginTop:"16px"},children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:""}),s.jsx(kt,{name:"category",defaultValue:O?.category,list:"category-list",placeholder:"",autoComplete:"off"}),s.jsx("datalist",{id:"category-list",children:Ws.map(ee=>s.jsx("option",{value:ee},ee))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:" ()"}),s.jsx(kt,{name:"threshold",type:"number",step:"0.01",defaultValue:O?.threshold||0})]})]}),s.jsxs("div",{className:"form-actions",children:[s.jsx(se,{variant:"ghost",type:"button",onClick:()=>{N(!1),L(null)},children:""}),s.jsx(se,{variant:"primary",type:"submit",children:""})]})]})})]})}return s.jsx(oa,{onDragEnd:sc,sensors:xr,autoScroll:!1,children:s.jsxs("div",{className:"inventory-container fade-in",children:[s.jsxs("div",{className:"container-header",children:[s.jsx("h2",{className:"section-title",children:" "}),s.jsxs("div",{className:"header-actions inventory-header-actions",children:[s.jsx(se,{variant:"ghost",onClick:n,children:" "}),s.jsx(se,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>a({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),s.jsx(se,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const M=new Date;$(`${M.getFullYear()}${M.getMonth()+1} `),ke(!0),ue(!0)},children:" "}),s.jsx(se,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{G(null),pe("history"),de(!0)},title:"",children:" "}),s.jsx(se,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{L(null),q(""),N(!0)},children:"+ "})]})]}),s.jsx("div",{className:"inventory-split-layout",children:s.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[s.jsxs("div",{className:"inventory-controls",children:[Ri?s.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[s.jsxs("div",{className:"inventory-controls__field",children:[s.jsx("label",{className:"inventory-controls__label",children:":"}),s.jsx("select",{className:"inventory-controls__select",value:tt,onChange:M=>vt(M.target.value),disabled:xt.length===0,children:xt.length===0?s.jsx("option",{value:"",children:""}):xt.map(M=>s.jsx("option",{value:M.key,children:M.label},M.key))})]}),bt&&s.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",bt.rangeLabel]})]}):s.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[s.jsxs("div",{className:"inventory-controls__field",children:[s.jsx("label",{className:"inventory-controls__label",children:":"}),s.jsxs("select",{className:"inventory-controls__select",value:jn==="inventory-check"?"":jn,onChange:M=>{M.target.value&&ve(M.target.value)},children:[s.jsx("option",{value:"all",children:""}),s.jsx("option",{value:"",disabled:!0,children:""}),s.jsxs("optgroup",{label:"",children:[Nl.map(M=>s.jsx("option",{value:M,children:M},M)),El&&s.jsx("option",{value:"other",children:""})]})]})]}),s.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:U,onChange:M=>B(M.target.value)})]}),s.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[s.jsxs("button",{className:"inventory-controls__btn",onClick:()=>ve("inventory-check"),"data-active":jn==="inventory-check"?"true":"false",children:["  (",st.size,")"]}),s.jsx("button",{className:"inventory-controls__btn",onClick:()=>ve("summary"),"data-active":jn==="summary"?"true":"false",children:" "}),!Ri&&s.jsx("button",{className:"inventory-controls__btn",onClick:Ys,title:"CSV",children:" CSV (.csv)"}),!Ri&&jn==="inventory-check"&&s.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),Ri?s.jsxs("div",{className:"inventory-summary",children:[s.jsx("div",{className:"inventory-summary__header",children:s.jsxs("div",{children:[s.jsx("div",{className:"inventory-summary__title",children:""}),bt&&s.jsxs("div",{className:"inventory-summary__meta",children:[": ",bt.rangeLabel]}),cn?s.jsxs("div",{className:"inventory-summary__meta",children:[": ",cn.title||"","",Zt(cn.snapshot_date),""]}):s.jsx("div",{className:"inventory-summary__meta",children:""}),Gt.length>1&&s.jsxs("div",{className:"inventory-summary__note",children:[" ",Gt.length," "]})]})}),cn?s.jsxs("div",{className:"inventory-summary__table-wrap",children:[s.jsx("div",{className:"inventory-summary__actions",children:s.jsx(se,{variant:"secondary",size:"sm",onClick:rc,children:" CSV (.csv)"})}),s.jsxs("table",{className:"inventory-summary__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40px"}}),s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),s.jsx(ul,{items:ki,strategy:zo,children:s.jsxs("tbody",{children:[da.map(M=>{const J=Pt===M.vendor,ee=Qr.get(M.vendor)||null;return s.jsxs(Ce.Fragment,{children:[s.jsx(Xt,{row:M,onVendorClick:nc,isSelected:J}),J&&ee&&s.jsxs("tr",{className:"inventory-summary__detail-row",children:[s.jsx("td",{}),s.jsx("td",{colSpan:"2",children:s.jsxs("div",{className:"inventory-summary__inline-detail",children:[s.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[s.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[ee.vendor," "]}),s.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>bl(ee),disabled:!ee.rows||ee.rows.length===0,children:" CSV"}),s.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(ee.totals.taxed||0).toLocaleString()]})]})]}),s.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(we=>s.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[s.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:Me(we)}),s.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ee.totals[we]||0).toLocaleString()]})]},we)),ee.totals.unknown>0&&s.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[s.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),s.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ee.totals.unknown).toLocaleString()]})]})]}),s.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(ee.totals.net||0).toLocaleString()]}),s.jsx("div",{className:"inventory-summary__inline-items-wrap",children:s.jsxs("table",{className:"inventory-summary__inline-items-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),s.jsx("tbody",{children:ee.rows.map((we,De)=>{const ze=we.itemCategory?re(we.itemCategory):Me(we.breakdownKey),$e=De>0?ee.rows[De-1]:null,Ve=!!$e&&$e.breakdownKey!==we.breakdownKey;return s.jsxs("tr",{className:Ve?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[s.jsx("td",{children:we.name||"-"}),s.jsx("td",{children:ze}),s.jsxs("td",{style:{textAlign:"right"},children:["",Number(we.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),s.jsxs("td",{style:{textAlign:"right"},children:[Number(we.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),we.unit?` ${we.unit}`:""]}),s.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(we.taxed||0).toLocaleString()]})]},we.id)})})]})})]})})]})]},M.vendor)}),da.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),s.jsx("tfoot",{children:s.jsxs("tr",{children:[s.jsx("td",{}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),s.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(ha.net).toLocaleString()," / ",Math.round(ha.taxed).toLocaleString()]})]})})]})]}):s.jsx("div",{className:"inventory-summary__empty",children:""})]}):s.jsx(Ok,{items:Qs,loading:E,onSearch:B,searchQuery:U,onEdit:M=>{L(M),q(M?.name||""),N(!0)},onDelete:Ks,onUpdateQuantity:od,onToggleTax:pa,onRequestUnitSync:ld})]})}),s.jsx(xn,{isOpen:!!dt,onClose:zr,title:"10%",size:"small",showCloseButton:!qt,children:s.jsxs("div",{style:{color:"#333"},children:[s.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",dt?.item?.name||"","",s.jsx("strong",{children:"10%"}),""]}),s.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[s.jsx(se,{variant:"secondary",onClick:zr,disabled:qt,children:""}),s.jsx(se,{variant:"primary",onClick:_l,disabled:qt,children:qt?"...":""})]})]})}),s.jsx(xn,{isOpen:K,onClose:()=>{Q||ue(!1)},title:" ",size:"small",children:s.jsxs("div",{style:{color:"#333"},children:[s.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),s.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[s.jsx("strong",{children:":"}),s.jsx("br",{}),"1. ",s.jsx("br",{}),"2. ",fe?s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:"()0"}),""]}):s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:""}),""]}),s.jsx("br",{}),""]}),s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[s.jsx("input",{type:"radio",name:"inventory-reset",checked:fe,disabled:Q,onChange:()=>ke(!0)}),s.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",s.jsx("strong",{children:"0"}),""]})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[s.jsx("input",{type:"radio",name:"inventory-reset",checked:!fe,disabled:Q,onChange:()=>ke(!1)}),s.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",s.jsx("strong",{children:""}),""]})]}),s.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),s.jsx("input",{type:"text",value:ye,onChange:M=>$(M.target.value),disabled:Q,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[s.jsx("button",{onClick:()=>{Q||ue(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:Q?"not-allowed":"pointer",opacity:Q?.6:1,fontSize:"0.9rem"},children:""}),s.jsx("button",{onClick:Cl,disabled:Q,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:Q?"#94a3b8":"#2ecc71",color:"white",cursor:Q?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:Q?"...":fe?"":""})]}),Q&&s.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),s.jsxs(xn,{isOpen:Ue,onClose:()=>de(!1),title:" ",size:"large",children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:oe==="history"?s.jsxs(s.Fragment,{children:[": ",s.jsx("strong",{children:Ye.length})," "]}):s.jsxs(s.Fragment,{children:[": ",s.jsx("strong",{children:h.length})," "]})}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[s.jsxs("div",{style:{display:"flex",gap:"6px"},children:[s.jsx("button",{type:"button",onClick:()=>pe("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:oe==="history"?"#111":"#fff",color:oe==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),s.jsx("button",{type:"button",onClick:()=>pe("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:oe==="trash"?"#111":"#fff",color:oe==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>mt(!0),title:"",children:" "})]})]}),oe==="history"&&s.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),s.jsx("select",{value:At,onChange:M=>Et(M.target.value),disabled:xt.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:xt.length===0?s.jsx("option",{value:"",children:""}):xt.map(M=>s.jsx("option",{value:M.key,children:M.label},M.key))})]}),It&&s.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",It.rangeLabel]})]}),oe==="history"&&Ye.length===0?s.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):oe==="trash"&&h.length===0?s.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):s.jsx("div",{style:{overflowX:"auto"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{background:"#f0f0f0"},children:[s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:oe==="trash"?"":""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),s.jsx("tbody",{children:(oe==="history"?Ye:h).map(M=>{const J=Rt(M).filter(at=>!ce(at?.vendor)),ee=J.length,we=Math.round(J.reduce((at,ut)=>{const Xe=parseFloat(ut?.price)||0,Ot=ut?.quantity===""?0:parseFloat(ut?.quantity)||0;return at+Xe*Ot*Je(ut)},0)),De=oe==="trash"?`trash-${M.id}`:M.id,ze=Zt(oe==="trash"?M.deleted_at:M.snapshot_date),$e=qe?.type==="move"&&qe?.id===M.id,Ve=qe?.type==="restore"&&qe?.id===M.id,Qe=qe?.type==="hard-delete"&&qe?.id===M.id,et=$e||Ve||Qe;return s.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[s.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:ze}),s.jsx("td",{style:{padding:"10px"},children:M.title||"-"}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:ee.toLocaleString()}),s.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",we.toLocaleString()]}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:oe==="history"?s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>Ti(M),disabled:ee===0||et,title:ee===0?"items CSV":"CSV",children:" CSV"}),s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>G(M),disabled:et,children:""}),s.jsx(se,{variant:"danger",size:"sm",onClick:()=>fa(M),disabled:et,title:"",children:$e?"...":""})]}):s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>Ti(M),disabled:ee===0||et,children:" CSV"}),s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>G(M),disabled:et,children:""}),s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>ad(M),disabled:et,title:"",children:Ve?"...":""}),s.jsx(se,{variant:"danger",size:"sm",onClick:()=>dr(M),disabled:et,title:"",children:Qe?"...":""})]})})]},De)})})]})})]}),s.jsx(xn,{isOpen:!!je,onClose:()=>{lt||Ie(null)},title:je?.title||"",size:"small",children:s.jsxs("div",{style:{color:"#333"},children:[s.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:je?.message}),je?.requireText&&s.jsxs("div",{style:{marginTop:"14px"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",s.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:je.requireText})," "]}),s.jsx("input",{type:"text",value:Be,onChange:M=>Pe(M.target.value),placeholder:je.requireText,disabled:lt,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[s.jsx(se,{variant:"ghost",disabled:lt,onClick:()=>{lt||Ie(null)},children:""}),s.jsx(se,{variant:"danger",disabled:lt||!!je?.requireText&&Be!==je.requireText,onClick:()=>je?.onConfirm&&je.onConfirm(),children:lt?je?.loadingLabel||"...":je?.confirmLabel||""})]})]})}),s.jsx(xn,{isOpen:!!H,onClose:()=>G(null),title:H?` ${H.title||""}`:" ",size:"large",children:(()=>{const M=H;if(!M)return null;const we=[...Rt(M).filter(ze=>ce(ze?.vendor)?!1:_e?(ze?.quantity===""?0:parseFloat(ze?.quantity)||0)!==0:!0)].sort((ze,$e)=>{const Ve=We.direction==="desc"?-1:1;if(We.key==="vendor"){const Ot=(ze?.vendor||"").toString(),_n=($e?.vendor||"").toString(),Cn=Ot.localeCompare(_n,"ja");if(Cn!==0)return Cn*Ve;const Ur=(ze?.name||"").toString(),Xr=($e?.name||"").toString();return Ur.localeCompare(Xr,"ja")*Ve}const Qe=(ze?.name||"").toString(),et=($e?.name||"").toString(),at=Qe.localeCompare(et,"ja");if(at!==0)return at*Ve;const ut=(ze?.vendor||"").toString(),Xe=($e?.vendor||"").toString();return ut.localeCompare(Xe,"ja")*Ve}),De=we.reduce((ze,$e)=>{const Ve=parseFloat($e?.price)||0,Qe=$e?.quantity===""?0:parseFloat($e?.quantity)||0,et=Ve*Qe;return ze.net+=et,ze.taxed+=et*Je($e),ze},{net:0,taxed:0});return s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[s.jsxs("div",{children:[": ",s.jsx("strong",{children:Zt(M.snapshot_date)})]}),s.jsxs("div",{children:[": ",s.jsx("strong",{children:we.length.toLocaleString()})]}),s.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",s.jsxs("strong",{children:["",Math.round(De.net).toLocaleString()," / ",Math.round(De.taxed).toLocaleString()]})]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[s.jsx("input",{type:"checkbox",checked:_e,onChange:ze=>te(ze.target.checked)}),"0"]}),s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>Ti(M),children:" CSV (.csv)"})]}),we.length===0?s.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):s.jsx("div",{style:{overflowX:"auto"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{background:"#f0f0f0"},children:[s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),s.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{Tt(ze=>ze.key==="vendor"?{key:"vendor",direction:ze.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",We.key==="vendor"&&(We.direction==="asc"?"":"")]})]})}),s.jsx("tbody",{children:we.map((ze,$e)=>{const Ve=parseFloat(ze?.price)||0,Qe=ze?.quantity===""?0:parseFloat(ze?.quantity)||0,et=Math.round(Ve*Qe*Je(ze)),at=Vs(ze),ut=re(at);return s.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[s.jsxs("td",{style:{padding:"10px"},children:[ze?.name||"-",Le(ze?.tax10)&&s.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),s.jsx("td",{style:{padding:"10px"},children:ut}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Ve?`${Number(Ve).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),s.jsx("td",{style:{padding:"10px"},children:ze?.unit||"-"}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Qe?Qe.toLocaleString():"0"}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:et?`${et.toLocaleString()}`:"-"}),s.jsx("td",{style:{padding:"10px"},children:ze?.vendor||"-"})]},ze?.id||`${ze?.name||"item"}-${$e}`)})})]})})]})})()}),s.jsx(xn,{isOpen:V,onClose:wl,title:"",size:"small",children:(()=>{const M=I,J=M?._master?.packetUnit||"",ee=M?.unit||"",we=Dt(ee,J),De=we!==null&&we!==1,ze=parseFloat(M?.price)||0,$e=M?.quantity===""?0:parseFloat(M?.quantity)||0,Ve=M?Je(M):1.08,Qe=ze*$e*Ve,et=J?pt(M?._master,J):null,at=et===null?null:et*$e*Ve,ut=et===null||!De?null:et*($e*we)*Ve,Xe=_n=>`${Math.round(_n).toLocaleString()}`,Ot=_n=>Number.isInteger(_n)?_n.toLocaleString():_n.toLocaleString(void 0,{maximumFractionDigits:3});return s.jsxs("div",{style:{color:"#333"},children:[s.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[s.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:M?.name||"-"}),s.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",Ot($e)," ",ee," /  ",ze.toLocaleString()," /  ",Xe(Qe)]}),!!J&&s.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",J]})]}),s.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:s.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",s.jsx("br",{}),""]})}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[s.jsx(se,{variant:"ghost",type:"button",onClick:wl,disabled:R,children:""}),s.jsx(se,{variant:"secondary",type:"button",onClick:()=>Sl({convertQuantity:!1}),isLoading:R,disabled:R||!J||et===null,title:at===null?"":`:  ${Xe(at)}`,children:""}),De&&s.jsx(se,{variant:"primary",type:"button",onClick:()=>Sl({convertQuantity:!0}),isLoading:R,disabled:R||!J||et===null,title:ut===null?"":`:  ${Xe(ut)}`,children:""})]})]})})()}),s.jsx(xn,{isOpen:Ct,onClose:()=>le(!1),title:"",size:"small",children:s.jsxs("div",{style:{color:"#333"},children:[s.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",s.jsx("strong",{children:Ae?.name}),""]}),s.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",s.jsx("strong",{children:""}),"",s.jsx("br",{}),"CSV"]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[s.jsx("button",{onClick:()=>le(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),s.jsx("button",{onClick:jl,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),s.jsx(xn,{isOpen:St,onClose:()=>on(!1),title:" ",size:"small",children:s.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[s.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),s.jsxs("h3",{style:{marginBottom:"1rem"},children:[ye," "]}),s.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",s.jsx("br",{}),""]}),s.jsx("button",{onClick:()=>on(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),s.jsx(xn,{isOpen:!!Tn,onClose:()=>Jt(null),title:Tn?.title||"",size:"small",children:s.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[Tn?.type==="success"&&s.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),Tn?.type==="error"&&s.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),s.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:Tn?.message}),s.jsx("button",{onClick:()=>Jt(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:Tn?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},xo="app-data",Mk="incoming-deliveries",zk=n=>{const t=String(n||"").trim();return t&&t.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},Uk=n=>{const t=String(n),i=t.lastIndexOf(".");return i<=0?t:t.slice(0,i)},Lk=async n=>{if(!n)return"";const t=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},ls={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${Mk}`},_filePath(n,t){const i=this._folderPath(n),a=String(t||"").replace(/^\/+/,"");return`${i}/${a}`},async listJsonFiles(n=null){const t=n||await this._getCurrentUserId();if(!t)return[];const i=this._folderPath(t),{data:a,error:o}=await Re.storage.from(xo).list(i,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return o?(console.error("Failed to list incoming deliveries:",o),[]):(a||[]).filter(u=>String(u?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._filePath(i,n),{data:o,error:u}=await Re.storage.from(xo).download(a);if(u)throw u;const d=await Lk(o);return JSON.parse(d)},async saveDeliverySet({pdfFile:n,parsed:t},i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");if(!n)throw new Error("PDF");if(!t)throw new Error("");const o=new Date,u=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}_${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,d=zk(Uk(n.name||"delivery")),f=`${u}_${d}`,h=this._filePath(a,`${f}.pdf`),m=this._filePath(a,`${f}.json`),y={...t,_meta:{savedAt:o.toISOString(),originalFileName:n.name||null}},[v,x]=await Promise.all([Re.storage.from(xo).upload(h,n,{upsert:!1,contentType:"application/pdf"}),Re.storage.from(xo).upload(m,new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(v.error)throw v.error;if(x.error)throw x.error;return{baseName:f,pdfPath:h,jsonPath:m}},async deleteDeliverySet(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=String(n||"").trim();if(!a)throw new Error("baseName ");const o=this._filePath(i,`${a}.pdf`),u=this._filePath(i,`${a}.json`),{data:d,error:f}=await Re.storage.from(xo).remove([o,u]);if(f)throw f;return d}},Ik="/app/assets/pdf.worker-DU8cYlj-.js",Bk=n=>typeof n=="string"&&n.trim().length>0,Bs=n=>String(n??"").replace(/\u0000/g,"").trim(),_o=n=>{const t=String(n??"").trim();if(!t)return null;const i=t.replace(/[,\s]/g,""),a=Number(i);return Number.isFinite(a)?a:null},bo=n=>{const t=String(n??"").trim();if(!t)return null;const i=t.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return i?i[2]?`${i[1]} ${i[2]}`:i[1]:null},$k=n=>{const t=String(n??"").trim();return!!(!t||t==="/"||t.startsWith("")||t.includes(""))},Pk=(n,t)=>{const i=String(n??"").trim(),a=i.match(/^No\.?\s*(\d{3,})\s*$/);if(a?.[1])return{slipNo:a[1],consumeNext:!1};if(/^No\.?\s*$/.test(i)){const o=String(t??"").trim();if(/^\d{3,}$/.test(o))return{slipNo:o,consumeNext:!0}}return null},gp=n=>{const t=String(n??"").trim();return t?!!/^No\.?\s*(\d{3,})?\s*$/.test(t):!1},qk=(n,t)=>{const i=Bs(n[t]);if(!i||gp(i)||i===""||i===""||i===""||i==="No"||i===""||i===""||i===""||i===""||i===""||i==="")return null;let a=t+1;const o=_o(n[a]);if(o==null)return null;a+=1;const u=_o(n[a]);if(u==null)return null;a+=1;const d=Bs(n[a]);if(!d)return null;a+=1;let f=null,h=null,m=null;const y=_o(n[a]);for(y!=null?(h=y,a+=1,m=Bs(n[a]),a+=1):(f=Bs(n[a])||null,a+=1,h=_o(n[a]),a+=1,m=Bs(n[a]),a+=1);a<n.length;){const b=Bs(n[a]);if(b===""||b===""){a+=1;continue}break}let v=null;const x=Bs(n[a]);return/^\d+$/.test(x)&&(v=parseInt(x,10),a+=1),{item:{no:v,code:null,name:i,unitPrice:o,deliveryQty:u,deliveryUnit:d,spec:f,orderQty:h,orderUnit:m},nextIndex:a}},Fk=n=>{const t=(n||[]).map(Bs).filter(f=>!$k(f)),i={title:t.find(f=>f.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let f=0;f<t.length;f+=1){const h=t[f],m=h.match(/^?\s*(.+)$/);if(m?.[1]&&!i.outputAt){i.outputAt=bo(m[1])||m[1].trim();continue}const y=h.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);y&&!i.rangeFrom&&(i.rangeFrom=y[1],i.rangeTo=y[2])}const a=new Map;let o=null,u=null;for(let f=0;f<t.length;f+=1){const h=t[f],m=t[f+1],y=Pk(h,m);if(y?.slipNo){const v=y.slipNo;y.consumeNext&&(f+=1);const x=a.get(v);x?o=x:(o={slipNo:v,vendor:u||null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},a.set(v,o));continue}if(/^(||)/.test(h)&&!h.includes("")&&!h.includes("")&&!h.includes("")){let v=3;(h.startsWith("")||h.startsWith("")||h.startsWith(""))&&(v=4);let x=h.slice(v).trim();(x.startsWith(":")||x.startsWith(""))&&(x=x.slice(1).trim());let b=null;if(!x)Bk(m)&&!/^\d+$/.test(m)&&!m.includes("")&&(b=m.trim());else{const _=x.match(/^(\d+)\s+(.+)$/);_&&(x=_[2].trim()),b=x}b&&(o?o.vendor||(o.vendor=b):u=b);continue}if(o){if(h===""||h.startsWith("")){const v=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.slipDate=v[1]:bo(m)&&(o.slipDate=bo(m));continue}if(h===""){const v=_o(m);v!=null&&(o.total=v);continue}if(h===""||h.startsWith("")){const v=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.deliveryDate=v[1]:bo(m)&&(o.deliveryDate=bo(m)?.slice(0,10));continue}if(h.startsWith("")){const x=h.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(x&&x!=="No"){o.comment=x;continue}const b=[];for(let C=f+1;C<t.length;C+=1){const j=t[C];if(j){if(gp(j)||j==="No"||j===""||j===""||j===""||j===""||j===""||j===""||j==="")break;b.push(j)}}const _=b.join(" ").trim();_&&_!=="No"&&(o.comment=_);continue}if(h===""||h===""){let v=f+1;for(;v<t.length;){const x=t[v];if(gp(x)||x==="")break;const b=qk(t,v);if(!b){v+=1;continue}o.items.push(b.item),v=b.nextIndex}f=v-1}}}const d=Array.from(a.values()).sort((f,h)=>String(f.slipNo).localeCompare(String(h.slipNo),"ja"));return{report:i,slips:d}},Wx=async n=>{if(!n)throw new Error("PDF");const t=await n.arrayBuffer(),i=await Tu(()=>import("./pdf-BbmjRGLv.js").then(f=>f.p),[]),a=i?.default&&i.default.getDocument?i.default:i;if(!a?.getDocument)throw new Error("PDF");a?.GlobalWorkerOptions&&(a.GlobalWorkerOptions.workerSrc=Ik);const o=await a.getDocument({data:new Uint8Array(t)}).promise,u=[];for(let f=1;f<=o.numPages;f+=1){const m=await(await o.getPage(f)).getTextContent();for(const y of m.items||[]){const v=Bs(y?.str);v&&u.push(v)}}const d=Fk(u);if(!d?.slips||d.slips.length===0)throw new Error("PDFPDF");return d},Vf=n=>String(n||"").replace(/\.json$/i,""),Qx=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${i}/${a}/${o} ${u}:${d}`},Hk=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},Gk=n=>String(n||"").trim(),Vk=({onBack:n})=>{const[t,i]=Ko(),[a,o]=Ce.useState(!0),[u,d]=Ce.useState([]),[f,h]=Ce.useState(null),[m,y]=Ce.useState(!1),[v,x]=Ce.useState(!1),[b,_]=Ce.useState(null),[C,j]=Ce.useState(!1),[k,E]=Ce.useState(""),[D,U]=Ce.useState(null),[B,T]=Ce.useState(!1),[N,O]=Ce.useState(null),[L,Y]=Ce.useState(!1),[q,V]=Ce.useState(!1),[F,I]=Ce.useState(null),P=Ce.useCallback(async()=>{o(!0),E("");try{const de=await ls.listJsonFiles();d(de||[])}catch(de){console.error(de),E(""),d([])}finally{o(!1)}},[]);Ce.useEffect(()=>{P()},[P]);const R=de=>{de.preventDefault(),y(!0)},z=de=>{de.preventDefault(),y(!1)},K=de=>{de.preventDefault(),y(!1);const H=de.dataTransfer.files?.[0];H&&H.type==="application/pdf"?(h(H),_(null),I(null),E(""),ue(H)):H&&E("PDF")},ue=async de=>{if(de){E(""),x(!0),_(null),I(null);try{const H=await Wx(de);_(H||null)}catch(H){console.error(H),E(`PDF:
${H?.message||String(H)}`)}finally{x(!1)}}},ye=async()=>{if(f){E(""),x(!0),_(null),I(null);try{const de=await Wx(f);_(de||null)}catch(de){console.error(de),E(`PDF:
${de?.message||String(de)}`)}finally{x(!1)}}},$=async()=>{if(!(!f||!b)){E(""),j(!0);try{await ls.saveDeliverySet({pdfFile:f,parsed:b}),h(null),_(null),await P()}catch(de){console.error(de),E(`: ${de?.message||String(de)}`)}finally{j(!1)}}},Q=async de=>{const H=Vf(de);T(!0),E("");try{const G=await ls.downloadJson(de);U({baseName:H,data:G})}catch(G){console.error(G),E(`: ${G?.message||String(G)}`)}finally{T(!1)}},X=async()=>{if(N?.baseName){Y(!0),E("");try{await ls.deleteDeliverySet(N.baseName),O(null),await P()}catch(de){console.error(de),E(`: ${de?.message||String(de)}`)}finally{Y(!1)}}},fe=de=>{const H=new Map,G=(pe,je)=>{const Ie=String(pe?.name||"").trim();if(!Ie)return;const Be=Gk(pe?.deliveryUnit||pe?.unit||pe?.unitName||""),Pe=Hk(pe?.deliveryQty??pe?.quantity??pe?.qty);if(!Number.isFinite(Pe)||Pe===null)return;const lt=String(je||"").trim(),rt=`${lt}@@${ln(Ie)}@@${Be||""}`,qe=H.get(rt);qe?qe.qty+=Pe:H.set(rt,{vendor:lt,name:Ie,unit:Be,qty:Pe})};return(de?.slips||de?.receipts||[]).forEach(pe=>{const je=pe?.vendor||"";(pe?.items||[]).forEach(Be=>G(Be,je))}),Array.from(H.values()).sort((pe,je)=>pe.vendor!==je.vendor?pe.vendor.localeCompare(je.vendor,"ja"):pe.name!==je.name?pe.name.localeCompare(je.name,"ja"):String(pe.unit||"").localeCompare(String(je.unit||""),"ja"))},ke=async()=>{V(!0),E(""),I(null);try{const de=await ls.listJsonFiles();if(!de||de.length===0){I([]);return}const H=[];for(const pe of de){const je=pe?.name;if(je)try{const Ie=await ls.downloadJson(je);H.push(Ie)}catch(Ie){console.warn("Failed to download:",je,Ie)}}const G=new Map;H.forEach(pe=>{fe(pe).forEach(Ie=>{const Be=`${Ie.vendor}@@${ln(Ie.name)}@@${Ie.unit||""}`,Pe=G.get(Be);Pe?Pe.qty+=Ie.qty:G.set(Be,{...Ie})})});const oe=Array.from(G.values()).sort((pe,je)=>pe.vendor!==je.vendor?pe.vendor.localeCompare(je.vendor,"ja"):pe.name!==je.name?pe.name.localeCompare(je.name,"ja"):String(pe.unit||"").localeCompare(String(je.unit||""),"ja"));I(oe)}catch(de){console.error(de),E(`: ${de?.message||String(de)}`)}finally{V(!1)}},Ue=b?.slips||b?.receipts||[];return s.jsxs("div",{className:"incoming-deliveries",children:[s.jsxs("div",{className:"incoming-deliveries__header",children:[s.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),s.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[s.jsx(se,{variant:"secondary",onClick:()=>i({view:"incoming-stock"}),children:" "}),s.jsx(se,{variant:"ghost",onClick:n,children:" "})]})]}),k&&s.jsx(an,{className:"incoming-deliveries__error",children:k}),s.jsxs(an,{className:"incoming-deliveries__card",children:[s.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),s.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",EE]}),s.jsxs("div",{className:"incoming-deliveries__upload",children:[s.jsxs("div",{className:`incoming-deliveries__upload-zone ${m?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:R,onDragLeave:z,onDrop:K,children:[s.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:m?"var(--color-primary)":"inherit"},children:m?"":"PDF"}),s.jsx("input",{type:"file",accept:"application/pdf",onChange:de=>{const H=de.target.files?.[0]||null;h(H),_(null),I(null),E("")},style:{width:"100%"}})]}),s.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[s.jsx(se,{variant:"secondary",onClick:ye,disabled:!f||v||C,children:v?"":""}),s.jsx(se,{variant:"primary",onClick:$,disabled:!f||!b||C||v,children:C?"":""})]})]}),b&&s.jsxs("div",{className:"incoming-deliveries__preview",children:[s.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",s.jsx("strong",{children:b?.report?.outputAt||b?.report?.outputDate||"-"})]}),s.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",s.jsx("strong",{children:Ue.length})]}),Ue.slice(0,3).map((de,H)=>s.jsxs("div",{className:"incoming-deliveries__slip",children:[s.jsxs("div",{className:"incoming-deliveries__slip-head",children:[s.jsx("div",{style:{fontWeight:700},children:de?.vendor||""}),s.jsxs("div",{style:{opacity:.85},children:["No: ",de?.slipNo||"-"," / : ",de?.deliveryDate||"-"]})]}),s.jsxs("table",{className:"incoming-deliveries__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"52%"},children:""}),s.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"16%"},children:""})]})}),s.jsx("tbody",{children:(de?.items||[]).slice(0,6).map((G,oe)=>s.jsxs("tr",{children:[s.jsx("td",{children:G?.name||"-"}),s.jsx("td",{style:{textAlign:"right"},children:G?.unitPrice!=null?`${Math.round(G.unitPrice).toLocaleString()}`:"-"}),s.jsx("td",{style:{textAlign:"right"},children:G?.deliveryQty!=null?G.deliveryQty:"-"}),s.jsx("td",{children:G?.deliveryUnit||"-"})]},`${G?.no||oe}`))})]}),(de?.items||[]).length>6&&s.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(de?.items||[]).length-6)," "]})]},`${de?.slipNo||de?.id||H}`)),Ue.length>3&&s.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),s.jsxs(an,{className:"incoming-deliveries__card",children:[s.jsxs("div",{className:"incoming-deliveries__list-head",children:[s.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),s.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[s.jsx(se,{variant:"secondary",onClick:P,disabled:a||q,children:""}),s.jsx(se,{variant:"secondary",onClick:ke,disabled:a||q,children:q?"":""})]})]}),a?s.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):u.length===0?s.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):s.jsx("div",{className:"incoming-deliveries__file-list",children:u.map(de=>s.jsxs("div",{className:"incoming-deliveries__file-row",children:[s.jsxs("div",{className:"incoming-deliveries__file-info",children:[s.jsx("div",{style:{fontWeight:700},children:Vf(de.name)}),s.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",Qx(de.updated_at||de.created_at)]})]}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>Q(de.name),disabled:B||L,children:B?"":""}),s.jsx(se,{variant:"ghost",size:"sm",onClick:()=>O({baseName:Vf(de.name)}),disabled:L,children:""})]})]},de.name))}),F&&s.jsxs("div",{className:"incoming-deliveries__aggregate",children:[s.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),F.length===0?s.jsx("div",{style:{opacity:.85},children:""}):s.jsxs("table",{className:"incoming-deliveries__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:"/"}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{children:""})]})}),s.jsx("tbody",{children:F.slice(0,60).map(de=>s.jsxs("tr",{children:[s.jsx("td",{children:de.vendor||"-"}),s.jsx("td",{children:de.name}),s.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(de.qty)?de.qty:"-"}),s.jsx("td",{children:de.unit||"-"})]},`${de.vendor}@@${de.name}@@${de.unit||""}`))})]}),F.length>60&&s.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),s.jsx(xn,{isOpen:!!D,onClose:()=>U(null),title:"PDF ",size:"large",children:D?.data?s.jsxs("div",{children:[s.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",Qx(D.data?._meta?.savedAt),D.data?._meta?.originalFileName?` / : ${D.data._meta.originalFileName}`:""]}),(D.data?.slips||D.data?.receipts||[]).map((de,H)=>s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[de?.vendor||"","No: ",de?.slipNo||"-"," / : ",de?.deliveryDate||"-",""]}),s.jsxs("table",{className:"incoming-deliveries__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"52%"},children:""}),s.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"16%"},children:""})]})}),s.jsx("tbody",{children:(de?.items||[]).map((G,oe)=>s.jsxs("tr",{children:[s.jsx("td",{children:G?.name||"-"}),s.jsx("td",{style:{textAlign:"right"},children:G?.unitPrice!=null?`${Math.round(G.unitPrice).toLocaleString()}`:"-"}),s.jsx("td",{style:{textAlign:"right"},children:G?.deliveryQty!=null?G.deliveryQty:"-"}),s.jsx("td",{children:G?.deliveryUnit||"-"})]},`${G?.no||oe}`))})]})]},`${de?.slipNo||H}`))]}):s.jsx("div",{style:{opacity:.8},children:""})}),s.jsx(xn,{isOpen:!!N,onClose:()=>O(null),title:"",size:"small",children:s.jsxs("div",{style:{lineHeight:1.6},children:[s.jsxs("p",{style:{marginTop:0},children:["",N?.baseName,""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>O(null),disabled:L,children:""}),s.jsx(se,{variant:"danger",onClick:X,disabled:L,children:L?"":""})]})]})})]})},Us="app-data",Kk="incoming-stock",Yk="stock.json",Wk="applied",aa=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},dl=n=>String(n||"").trim(),la=(n,t,i)=>`${String(i||"").trim()}@@${ln(n)}@@${dl(t)}`,Kf=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===404)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("not found")||a.includes("object not found")},Qk=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===409)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("already exists")||a.includes("duplicate")||a.includes("409")},Jk=n=>{const t=new Map;return(n?.slips||n?.receipts||[]).forEach(a=>{const o=String(a?.vendor||"").trim();(a?.items||[]).forEach(u=>{const d=String(u?.name||"").trim();if(!d)return;const f=dl(u?.deliveryUnit||u?.unit||u?.unitName||""),h=aa(u?.deliveryQty??u?.quantity??u?.qty);if(h==null)return;const m=la(d,f,o),y=t.get(m);y?y.quantity+=h:t.set(m,{vendor:o,name:d,unit:f,quantity:h})})}),Array.from(t.values()).filter(a=>Number.isFinite(a.quantity))},Xk=(n,t,i)=>{const a=new Map;return(n||[]).forEach(o=>{const u=String(o?.name||"").trim();if(!u)return;const d=dl(o?.unit||""),f=String(o?.vendor||"").trim(),h=aa(o?.quantity)??0;a.set(la(u,d,f),{vendor:f,name:u,unit:d,quantity:h,updatedAt:o?.updatedAt||null})}),t.forEach(o=>{const u=la(o.name,o.unit,o.vendor),d=a.get(u);d?(d.quantity=Math.max(0,(aa(d.quantity)??0)+(aa(o.quantity)??0)),d.updatedAt=i):a.set(u,{vendor:o.vendor,name:o.name,unit:dl(o.unit),quantity:Math.max(0,aa(o.quantity)??0),updatedAt:i})}),Array.from(a.values()).sort((o,u)=>o.vendor!==u.vendor?o.vendor.localeCompare(u.vendor,"ja"):o.name!==u.name?o.name.localeCompare(u.name,"ja"):String(o.unit||"").localeCompare(String(u.unit||""),"ja"))},Ls={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${Kk}`},_stockPath(n){return`${this._folderPath(n)}/${Yk}`},_appliedFolder(n){return`${this._folderPath(n)}/${Wk}`},_appliedMarkerPath(n,t){const i=this._appliedFolder(n),a=String(t||"").trim();if(!a)throw new Error("baseName is required");return`${i}/${a}.json`},async listAppliedBaseNames(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Set;const i=this._appliedFolder(t),{data:a,error:o}=await Re.storage.from(Us).list(i,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(o)return Kf(o)?new Set:(console.error("Failed to list applied markers:",o),new Set);const u=new Set;return(a||[]).forEach(d=>{const f=String(d?.name||"");f.toLowerCase().endsWith(".json")&&u.add(f.replace(/\.json$/i,""))}),u},async loadStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const i=this._stockPath(t),{data:a,error:o}=await Re.storage.from(Us).createSignedUrl(i,60);if(o){if(Kf(o))return{_meta:{version:1,updatedAt:null},items:[]};throw o}try{const u=await fetch(a.signedUrl,{cache:"no-store"});if(!u.ok){if(u.status===404)return{_meta:{version:1,updatedAt:null},items:[]};throw new Error(`Failed to fetch stock: ${u.status} ${u.statusText}`)}const d=await u.text(),f=JSON.parse(d||"{}"),h=Array.isArray(f?.items)?f.items:[];return{_meta:{version:1,updatedAt:f?._meta?.updatedAt||null},items:h}}catch(u){throw console.warn("loadStock fetch failed",u),u}},async saveStock(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._stockPath(i),o={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(n?.items)?n.items:[]},{error:u}=await Re.storage.from(Us).upload(a,new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(u)throw u;return o},async applyDeliverySet({baseName:n,parsed:t},i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("baseName ");if(!t)throw new Error("");const u=Jk(t),d=new Date().toISOString(),f=this._appliedMarkerPath(a,o),h={baseName:o,appliedAt:d,slipCount:(t?.slips||t?.receipts||[]).length||0,itemCount:u.length},m=await Re.storage.from(Us).upload(f,new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(m.error){if(Qk(m.error))return{status:"already_applied"};throw m.error}try{const y=await this.loadStock(a),v=Xk(y.items||[],u,d);return await this.saveStock({items:v},a),{status:"applied",addedCount:u.length}}catch(y){try{await Re.storage.from(Us).remove([f])}catch{}throw y}},async updateStockItem({name:n,unit:t,vendor:i,delta:a},o=null){const u=o||await this._getCurrentUserId();if(!u)throw new Error("");const d=String(n||"").trim();if(!d)throw new Error("");const f=dl(t),h=String(i||"").trim(),m=la(d,f,h),y=aa(a);if(y===null||!Number.isFinite(y))throw new Error("");const x=(await this.loadStock(u)).items||[],b=new Date().toISOString();let _=!1;const C=x.map(j=>{if(la(j.name,j.unit,j.vendor)===m){_=!0;const E=Math.max(0,(aa(j.quantity)??0)+y);return{...j,quantity:E,updatedAt:b}}return j});if(!_)throw new Error("");return await this.saveStock({items:C},u),{status:"updated",name:d,unit:f}},async deleteStockItem({name:n,unit:t,vendor:i},a=null){const o=a||await this._getCurrentUserId();if(!o)throw new Error("");const u=String(n||"").trim();if(!u)throw new Error("");const d=dl(t),f=String(i||"").trim(),h=la(u,d,f),y=(await this.loadStock(o)).items||[],v=y.filter(x=>la(x.name,x.unit,x.vendor)!==h);return v.length,y.length,await this.saveStock({items:v},o),{status:"deleted",name:u}},async clearStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const i=this._stockPath(t),a={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await Re.storage.from(Us).upload(i,new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const o=this._appliedFolder(t),{data:u}=await Re.storage.from(Us).list(o,{limit:1e3});if(u?.length){const d=u.map(f=>`${o}/${f.name}`);await Re.storage.from(Us).remove(d)}return{status:"cleared"}},async deleteAppliedMarker(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._appliedMarkerPath(i,n),{error:o}=await Re.storage.from(Us).remove([a]);if(o){if(Kf(o))return{status:"not_found"};throw o}return{status:"deleted"}}},Ab=n=>`planner_data_${n}`,el=n=>{try{if(!n)return{};let t=localStorage.getItem(Ab(n));return t?JSON.parse(t):{}}catch{return{}}},wo=(n,t)=>{n&&localStorage.setItem(Ab(n),JSON.stringify(t))},ji={getAll:async n=>el(n),cleanupInvalidPlans:async(n,t)=>{const i=el(n);let a=!1;const o=new Set(t);return Object.keys(i).forEach(u=>{const d=i[u].length;i[u]=i[u].filter(f=>o.has(f.recipeId)),i[u].length!==d&&(a=!0),i[u].length===0&&(delete i[u],a=!0)}),a&&wo(n,i),i},addMeal:async(n,t,i,a,o={})=>{const u=el(n);u[t]||(u[t]=[]);const d={id:Date.now().toString(),recipeId:i,type:a,note:"",multiplier:o?.multiplier||1,totalWeight:o?.totalWeight||null};return u[t].push(d),wo(n,u),d},removeMeal:async(n,t,i)=>{const a=el(n);a[t]&&(a[t]=a[t].filter(o=>o.id!==i),a[t].length===0&&delete a[t],wo(n,a))},updateMeal:async(n,t,i,a)=>{const o=el(n);if(o[t]){const u=o[t].findIndex(d=>d.id===i);u!==-1&&(o[t][u]={...o[t][u],...a},wo(n,o))}},clearPeriod:async(n,t,i)=>{const a=el(n);let o=!1;Object.keys(a).forEach(u=>{u>=t&&u<=i&&(delete a[u],o=!0)}),o&&wo(n,a)}},hl=n=>(n??"").toString().trim(),Ob=n=>{const t=hl(n);if(!t)return"";const i=t.toLowerCase();return i===""?"g":i===""?"ml":i===""?"cc":i===""?"kg":i===""?"l":i},Zk=n=>{const t=hl(n);return t?["","","","","","","","PC","pc",""].includes(t):!1},Co=(n,t)=>{const i=parseFloat(n)||0,a=Ob(t);return a==="kg"?{qty:i*1e3,unit:"g"}:a==="g"?{qty:i,unit:"g"}:a==="l"?{qty:i*1e3,unit:"ml"}:a==="cc"?{qty:i,unit:"ml"}:a==="ml"?{qty:i,unit:"ml"}:{qty:i,unit:hl(t)||""}},Jx=(n,t,i,a)=>{const o=hl(i),u=parseFloat(t)||0;if(!a)return Co(u,o);const d=parseFloat(a.packetSize),f=Ob(a.packetUnit);if(!Number.isFinite(d)||d<=0||!f)return Co(u,o);if(["g","kg","ml","cc","l"].includes(f)&&Zk(o)){const m=u*d;return Co(m,f)}return Co(u,o)},yp={async calculateShortages(n,t,i){if(!n?.id)throw new Error("User required");const a=await ji.getAll(n.id),o=new Date(t),u=new Date(i);u.setHours(23,59,59,999);const d=[];if(Object.keys(a).forEach(E=>{const D=new Date(E);D>=o&&D<=u&&a[E].forEach(U=>{d.push(U)})}),d.length===0)return[];const[f,h,m,y,v]=await Promise.all([yn.fetchRecipes(n),qn.getAllConversions(),sr.fetchPriceList(n.id),nr.getAll(n.id),Fu.getAll(n.id)]),x=new Map;f.forEach(E=>x.set(E.id,E));const b=new Map;try{for(const[E,D]of(h||new Map).entries()){const U=ln(E);U&&(b.has(U)||b.set(U,D))}}catch{}const _=new Map;try{for(const[E,D]of(v||new Map).entries()){const U=ln(E);U&&(_.has(U)||_.set(U,D))}}catch{}const C=new Map;try{(y||[]).forEach(E=>{const D=ln(E?.name);D&&(C.has(D)||C.set(D,E))})}catch{}const j={};return d.forEach(E=>{const D=x.get(E.recipeId);if(!D)return;let U=1;if(E.totalWeight&&E.totalWeight>0){let N=0;(D.ingredients||[]).forEach(O=>{const{qty:L,unit:Y}=Co(O.quantity,O.unit);(Y==="g"||Y==="ml")&&(N+=L)}),N>0&&(U=E.totalWeight/N)}else E.multiplier&&E.multiplier>0&&(U=E.multiplier);[...D.ingredients||[]].forEach(N=>{if(!N.name)return;const O=hl(N.name),L=ln(O),Y=(L?b.get(L):null)||h?.get(O)||null,q=(parseFloat(N.quantity)||0)*U,V=Jx(O,q,N.unit,Y),F=V.qty||0,I=V.unit||"";j[O]||(j[O]={quantity:0,unit:I,count:0}),j[O].quantity+=F})}),Object.keys(j).map(E=>{const D=j[E],U=ln(E),B=(U?b.get(U):null)||h?.get(E)||null,T=U&&m?.get(U)||null,N=U&&C.get(U)||null,O=Jx(E,N?.quantity??0,N?.unit??D.unit,B),L=D.quantity||0,Y=O.qty||0,q=D.unit||O.unit||"",V=Y-L,F=parseFloat(B?.packetSize),I=hl(B?.packetUnit),P=Number.isFinite(F)&&F>0&&!!I,R=P?F*.2:0,z=P?V<R:!1,K=T?.unit?String(T.unit).trim():"",ue=U&&_.has(U)?String(_.get(U)).trim():"",ye=ue||""||K||""||"",$=(B?.lastPrice!==null&&B?.lastPrice!==void 0&&B?.lastPrice!==""?parseFloat(B.lastPrice):null)??(T?.price!==null&&T?.price!==void 0?parseFloat(T.price):null);let Q=null,X=0,fe=q;if(P){const Ue=Math.max(0,R-V);Q=Math.ceil(Ue/F),z&&Q<1&&(Q=1),X=Q,fe=ye}else X=Math.max(0,L-Y),fe=q;const ke=P?z:X>.01;return{name:E,required:L,stock:Y,remaining:V,unit:q,shouldShow:ke,toOrder:X,orderUnit:fe,orderPacks:Q,packSize:P?F:null,packUnit:P?I:null,packPrice:Number.isFinite($)?$:null,vendor:T?.vendor||N?.vendor||""}}).filter(E=>E.shouldShow)}},Su=n=>String(n||"").replace(/\.json$/i,""),eT=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${i}/${a}/${o} ${u}:${d}`},tT=({onBack:n})=>{const{user:t}=us(),[i,a]=Ko(),[o,u]=Ce.useState(!0),[d,f]=Ce.useState(""),[h,m]=Ce.useState([]),[y,v]=Ce.useState(new Set),[x,b]=Ce.useState({items:[]}),[_,C]=Ce.useState([]),[j,k]=Ce.useState(null),[E,D]=Ce.useState("need_order"),[U,B]=Ce.useState(!1),[T,N]=Ce.useState(null),[O,L]=Ce.useState(""),[Y,q]=Ce.useState(!1),V=Ce.useCallback(async()=>{u(!0),f("");try{const _e=new Date,te=new Date(_e);te.setDate(_e.getDate()+7);const[We,Tt,Ct,le]=await Promise.all([ls.listJsonFiles(),Ls.listAppliedBaseNames(),Ls.loadStock(),t?.id?yp.calculateShortages(t,_e.toISOString(),te.toISOString()):Promise.resolve([])]);m(We||[]),v(Tt||new Set),b(Ct||{items:[]}),C(le||[])}catch(_e){console.error(_e),f(_e?.message||String(_e))}finally{u(!1)}},[t]);Ce.useEffect(()=>{V()},[V]);const F=Ce.useMemo(()=>{const _e=new Map;return(_||[]).forEach(te=>{const We=`${te.vendor||""}@@${te.name}@@${te.unit||""}`;_e.set(We,{...te,quantity:te.stock,isShortage:!0,reason:` (: ${te.required.toFixed(1)}${te.unit})`})}),(x?.items||[]).forEach(te=>{if((te.quantity||0)<=0){const We=`${te.vendor||""}@@${te.name}@@${te.unit||""}`;_e.has(We)||_e.set(We,{...te,isShortage:!1})}}),Array.from(_e.values()).sort((te,We)=>te.isShortage!==We.isShortage?te.isShortage?-1:1:(te.vendor||"").localeCompare(We.vendor||""))},[_,x]),I=async _e=>{const te=Su(_e);k(te),f("");try{const We=await ls.downloadJson(_e);(await Ls.applyDeliverySet({baseName:te,parsed:We}))?.status==="already_applied"&&f("PDF"),await V()}catch(We){console.error(We),f(We?.message||String(We))}finally{k(null)}},P=async()=>{k("all"),f("");try{const _e=await ls.listJsonFiles(),te=await Ls.listAppliedBaseNames();for(const We of _e||[]){const Tt=We?.name;if(!Tt)continue;const Ct=Su(Tt);if(te.has(Ct))continue;const le=await ls.downloadJson(Tt);(await Ls.applyDeliverySet({baseName:Ct,parsed:le}))?.status==="applied"&&te.add(Ct)}await V()}catch(_e){console.error(_e),f(_e?.message||String(_e))}finally{k(null)}},R=_e=>{N(_e),L(""),B(!0),f("")},z=_e=>{L(te=>{const Tt=(parseFloat(te)||0)+_e;return String(Math.round(Tt*1e3)/1e3)})},K=async()=>{if(!T)return;const _e=Number(O);if(!O||isNaN(_e)||_e<=0){f("");return}q(!0),f("");try{await Ls.updateStockItem({name:T.name,unit:T.unit,vendor:T.vendor,delta:-_e}),await V(),B(!1),N(null)}catch(te){console.error(te),f(te?.message||String(te))}finally{q(!1)}},[ue,ye]=Ce.useState(!1),[$,Q]=Ce.useState(null),[X,fe]=Ce.useState(!1),[ke,Ue]=Ce.useState(!1),[de,H]=Ce.useState(!1),G=_e=>{Q(_e),ye(!0),f("")},oe=async()=>{if($){fe(!0),f("");try{await Ls.deleteStockItem({name:$.name,unit:$.unit,vendor:$.vendor}),await V(),ye(!1),Q(null)}catch(_e){console.error(_e),f(": "+(_e.message||String(_e)))}finally{fe(!1)}}},[pe,je]=Ce.useState(!1),[Ie,Be]=Ce.useState(null),[Pe,lt]=Ce.useState(!1),rt=_e=>{const te=Su(_e.name);Be({name:_e.name,baseName:te}),je(!0),f("")},qe=async()=>{if(Ie){lt(!0),f("");try{await ls.deleteDeliverySet(Ie.baseName),await Ls.deleteAppliedMarker(Ie.baseName),await V(),je(!1),Be(null)}catch(_e){console.error(_e),f("PDF: "+(_e.message||String(_e)))}finally{lt(!1)}}},xe=async()=>{H(!0),f("");try{await Ls.clearStock(),await V(),Ue(!1)}catch(_e){console.error(_e),f(": "+(_e.message||String(_e)))}finally{H(!1)}};return s.jsxs("div",{className:"incoming-stock",children:[s.jsxs("div",{className:"incoming-stock__header",children:[s.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),s.jsxs("div",{style:{display:"flex",gap:"10px"},children:[s.jsx(se,{variant:"secondary",onClick:()=>a({view:"incoming-deliveries"}),children:" PDF"}),s.jsx(se,{variant:"ghost",onClick:n,children:" "})]})]}),d&&s.jsx(an,{className:"incoming-stock__error",children:d}),s.jsxs(an,{className:"incoming-stock__card",children:[s.jsxs("div",{className:"incoming-stock__card-head",children:[s.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),s.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[s.jsx(se,{variant:"secondary",onClick:V,disabled:o||!!j,children:""}),s.jsx(se,{variant:"primary",onClick:P,disabled:o||!!j,children:j==="all"?"":""}),s.jsx(se,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:()=>Ue(!0),disabled:o||!!j||!x?.items?.length,children:" "})]})]}),o?s.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):h.length===0?s.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):s.jsx("div",{className:"incoming-stock__file-list",children:h.map(_e=>{const te=Su(_e?.name),We=y.has(te);return s.jsxs("div",{className:"incoming-stock__file-row",children:[s.jsxs("div",{className:"incoming-stock__file-info",children:[s.jsx("div",{style:{fontWeight:700},children:te}),s.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",eT(_e.updated_at||_e.created_at)]})]}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[We?s.jsx("span",{className:"incoming-stock__badge",children:""}):s.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),s.jsx(se,{variant:We?"secondary":"primary",size:"sm",onClick:()=>I(_e.name),disabled:!!j||We,children:j===te?"":We?"":""}),s.jsx(se,{variant:"ghost",size:"sm",style:{color:"#d32f2f",marginLeft:"4px"},onClick:()=>rt(_e),disabled:!!j,title:"PDF",children:""})]})]},_e.name)})}),!o&&s.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",s.jsx("strong",{children:y.size}),"  / PDF: ",s.jsx("strong",{children:h.length})," "]})]}),s.jsxs(an,{className:"incoming-stock__card",children:[s.jsx("div",{className:"incoming-stock__card-head",children:s.jsx("h3",{className:"incoming-stock__section-title",children:""})}),s.jsxs("div",{className:"incoming-stock__tabs",children:[s.jsxs("button",{className:`incoming-stock__tab-button ${E==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>D("need_order"),children:[" ",s.jsx("span",{className:"incoming-stock__tab-count",children:F.length})]}),Array.from(new Set((x?.items||[]).map(_e=>_e.vendor||""))).sort().map(_e=>s.jsx("button",{className:`incoming-stock__tab-button ${E===_e?"incoming-stock__tab-button--active":""}`,onClick:()=>D(_e),children:_e},_e))]}),(()=>{let _e=[];if(E==="need_order")_e=F;else{const te=E===""?"":E;_e=(x?.items||[]).filter(We=>(We.vendor||"")===te)}return _e.length===0?s.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:E==="need_order"?"0":""}):s.jsx("div",{className:"incoming-stock__table-wrap",children:s.jsxs("table",{className:"incoming-stock__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"45%"},children:"/"}),s.jsx("th",{style:{width:"25%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"10%"},children:""}),s.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),s.jsx("tbody",{children:_e.map(te=>s.jsxs("tr",{style:te.isShortage?{backgroundColor:"#fff5f5"}:{},children:[s.jsxs("td",{children:[s.jsxs("div",{style:{fontWeight:500},children:[te.name,te.isShortage&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#d32f2f",border:"1px solid #d32f2f",borderRadius:"4px",padding:"1px 4px",verticalAlign:"middle"},children:""})]}),te.reason&&s.jsxs("div",{style:{fontSize:"0.8rem",color:"#d32f2f",marginTop:"2px"},children:[te.reason,"  : ",te.toOrder,te.orderUnit]}),!te.reason&&E==="need_order"&&te.vendor&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:te.vendor})]}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(te.quantity||0)<=0||te.isShortage?"#d32f2f":"inherit"},children:Number.isFinite(te.quantity)?te.quantity:"-"}),s.jsx("td",{children:te.unit||"-"}),s.jsx("td",{style:{textAlign:"center"},children:s.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[s.jsx(se,{variant:"secondary",size:"sm",onClick:()=>R(te),children:"/"}),s.jsx(se,{variant:"ghost",size:"sm",style:{color:"#d32f2f"},onClick:()=>G(te),children:""})]})})]},`${te.vendor}@@${te.name}@@${te.unit||""}`))})]})})})()]}),s.jsx(xn,{isOpen:U,onClose:()=>B(!1),title:"",children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),s.jsx("div",{style:{fontWeight:"bold"},children:T?.name})]}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),s.jsxs("div",{children:[T?.quantity," ",T?.unit]})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[s.jsx(kt,{type:"text",inputMode:"decimal",value:O,onChange:_e=>L(_e.target.value),readOnly:!0,placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px",textAlign:"center",backgroundColor:"#f9f9f9",cursor:"default"}}),s.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:T?.unit})]}),s.jsxs("div",{className:"incoming-stock__calc-grid",children:[s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(.001),children:"+0.001"}),s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(.01),children:"+0.01"}),s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(.1),children:"+0.1"}),s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(.5),children:"+0.5"}),s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(1),children:"+1"}),s.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>L(""),children:""})]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>B(!1),disabled:Y,children:""}),s.jsx(se,{variant:"primary",onClick:K,disabled:Y||!O,children:Y?"":""})]})]})}),s.jsx(xn,{isOpen:ue,onClose:()=>ye(!1),title:"",size:"small",children:s.jsxs("div",{style:{lineHeight:1.6},children:[s.jsxs("p",{style:{marginTop:0},children:["",$?.name,"",s.jsx("br",{}),s.jsx("span",{style:{fontSize:"0.85rem",color:"#666"},children:""})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>ye(!1),disabled:X,children:""}),s.jsx(se,{variant:"danger",onClick:oe,disabled:X,children:X?"":""})]})]})}),s.jsx(xn,{isOpen:pe,onClose:()=>je(!1),title:"PDF",size:"small",children:s.jsxs("div",{style:{lineHeight:1.6},children:[s.jsxs("p",{style:{marginTop:0},children:["",Ie?.baseName,""]}),s.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["",s.jsx("strong",{children:""}),"",s.jsx("br",{}),""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>je(!1),disabled:Pe,children:""}),s.jsx(se,{variant:"danger",onClick:qe,disabled:Pe,children:Pe?"":""})]})]})}),s.jsx(xn,{isOpen:ke,onClose:()=>Ue(!1),title:"",size:"small",children:s.jsxs("div",{style:{lineHeight:1.6},children:[s.jsx("p",{style:{marginTop:0,fontWeight:"bold",color:"#d32f2f"},children:""}),s.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["PDF",s.jsx("br",{}),""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>Ue(!1),disabled:de,children:""}),s.jsx(se,{variant:"danger",onClick:xe,disabled:de,children:de?"":""})]})]})}),s.jsx(xn,{isOpen:!!j,onClose:()=>{},title:"",size:"small",showCloseButton:!1,children:s.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[s.jsx("div",{className:"incoming-stock__spinner"}),s.jsx("p",{style:{margin:"0 0 8px",fontWeight:"bold"},children:"PDF..."}),s.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",margin:0},children:[j==="all"?"":"",s.jsx("br",{}),""]})]})})]})},nT=({recipe:n})=>{const{attributes:t,listeners:i,setNodeRef:a,transform:o}=Ap({id:`recipe-${n.id}`,data:{recipe:n}}),u=o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,position:"relative",zIndex:999}:void 0;return s.jsx("div",{ref:a,style:u,...i,...t,className:"draggable-recipe",children:n.title})},rT=({meal:n,dateStr:t,children:i})=>{const{attributes:a,listeners:o,setNodeRef:u,transform:d}=Ap({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),f=d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0,{type:h,totalWeight:m,multiplier:y}=n;let v="";return m?v=`${m}g`:y&&y!==1&&(v=`x${y}`),s.jsxs("div",{ref:u,style:f,...o,...a,className:"draggable-meal-wrapper",children:[i,v&&s.jsx("div",{style:{position:"absolute",bottom:"2px",right:"4px",fontSize:"0.75rem",fontWeight:"bold",color:"#666",backgroundColor:"rgba(255,255,255,0.8)",padding:"0 2px",borderRadius:"2px",pointerEvents:"none"},children:v})]})},sT=({dateStr:n,dayNum:t,isToday:i,isOutside:a,children:o})=>{const{setNodeRef:u,isOver:d}=ec({id:`date-${n}`,data:{dateStr:n}});return s.jsxs("div",{ref:u,className:`calendar-cell ${i?"today":""} ${a?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[s.jsx("div",{className:"day-number",children:t}),o]})},tl=n=>`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,iT=({onBack:n,onSelectRecipe:t,onNavigateToOrderList:i})=>{const{user:a}=us(),o=ua(),[u,d]=w.useState([]),[f,h]=w.useState({}),[m,y]=w.useState(new Date),[v,x]=w.useState(""),[b,_]=w.useState(!1),[C,j]=w.useState(null),[k,E]=w.useState(!1),[D,U]=w.useState(null),[B,T]=w.useState(1),[N,O]=w.useState(""),[L,Y]=w.useState(!1),[q,V]=w.useState(tl(new Date)),[F,I]=w.useState(tl(new Date)),P=gl(vr(Ju,{activationConstraint:{distance:8}})),R=w.useCallback(async()=>{const H=await yn.fetchRecipes(a);if(d(H),a?.id){const G=H.map(pe=>pe.id),oe=await ji.cleanupInvalidPlans(a.id,G);h(oe)}},[a]);w.useEffect(()=>{const H=setTimeout(()=>{R()},0);return()=>clearTimeout(H)},[R]);const z=async H=>{const{active:G,over:oe}=H;if(oe&&oe.id.startsWith("date-")){const pe=oe.data.current.dateStr;if(G.id.startsWith("recipe-")){const je=G.data.current.recipe;U({type:"new",recipe:je,targetDateStr:pe}),T(1),O(""),E(!0)}else if(G.id.startsWith("meal-")){const{meal:je,dateStr:Ie}=G.data.current;if(Ie===pe)return;const Be={multiplier:je.multiplier,totalWeight:je.totalWeight};await ji.addMeal(a.id,pe,je.recipeId,je.type||"dinner",Be),await ji.removeMeal(a.id,Ie,je.id),R()}}},K=async()=>{if(!D)return;const{type:H,recipe:G,targetDateStr:oe}=D;if(H==="new"){const pe={};if(G.type==="bread"){const je=parseFloat(N);pe.totalWeight=Number.isFinite(je)?je:null,pe.multiplier=1}else{const je=parseFloat(B);pe.multiplier=Number.isFinite(je)?je:1,pe.totalWeight=null}await ji.addMeal(a.id,oe,G.id,"dinner",pe)}E(!1),U(null),R()},ue=()=>{E(!1),U(null)},ye=async(H,G,oe)=>{oe&&oe.stopPropagation(),j({dateStr:H,mealId:G}),_(!0)},$=async()=>{if(!C)return;const{dateStr:H,mealId:G}=C;_(!1),j(null);try{await ji.removeMeal(a.id,H,G),await R(),o.success("")}catch(oe){o.error(""),console.error("Delete meal error:",oe)}},Q=()=>{_(!1),j(null)},X=()=>{V(tl(new Date)),I(tl(new Date)),Y(!0)},fe=async()=>{if(a?.id)try{await ji.clearPeriod(a.id,q,F),await R(),Y(!1),o.success(`${q}${F}`)}catch(H){console.error(H),o.error("")}},ke=()=>{const H=m.getFullYear(),G=m.getMonth(),oe=new Date(H,G,1),pe=new Date(H,G+1,0),je=[],Ie=oe.getDay();for(let Pe=Ie-1;Pe>=0;Pe--){const lt=new Date(H,G,-Pe);je.push({date:lt,isOutside:!0})}for(let Pe=1;Pe<=pe.getDate();Pe++){const lt=new Date(H,G,Pe);je.push({date:lt,isOutside:!1})}const Be=42-je.length;for(let Pe=1;Pe<=Be;Pe++){const lt=new Date(H,G+1,Pe);je.push({date:lt,isOutside:!0})}return je},Ue=u.filter(H=>H.title.toLowerCase().includes(v.toLowerCase())),de=H=>{y(new Date(m.getFullYear(),m.getMonth()+H,1))};return s.jsxs("div",{className:"planner-container fade-in",children:[b&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(an,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[s.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:""})," "]}),s.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",s.jsx("br",{}),s.jsx("strong",{children:""})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(se,{variant:"ghost",onClick:Q,children:""}),s.jsx(se,{variant:"danger",onClick:$,children:""})]})]})}),L&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(an,{style:{width:"90%",maxWidth:"500px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[s.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:""})," "]}),s.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",s.jsx("br",{}),s.jsx("strong",{children:""})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1.5rem"},children:[s.jsxs("div",{style:{flex:1},children:[s.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),s.jsx(kt,{type:"date",value:q,onChange:H=>V(H.target.value)})]}),s.jsx("span",{style:{paddingTop:"24px"},children:""}),s.jsxs("div",{style:{flex:1},children:[s.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),s.jsx(kt,{type:"date",value:F,onChange:H=>I(H.target.value)})]})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[s.jsx(se,{variant:"ghost",onClick:()=>Y(!1),children:""}),s.jsx(se,{variant:"danger",onClick:fe,children:""})]})]})}),k&&D&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(an,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",backgroundColor:"white"},children:[s.jsx("h3",{style:{marginTop:0},children:D.recipe.type==="bread"?"":""}),s.jsx("p",{style:{margin:"1rem 0",color:"#666"},children:D.recipe.title}),s.jsx("div",{style:{marginBottom:"1.5rem"},children:D.recipe.type==="bread"?s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:" (g)"}),s.jsx(kt,{type:"number",value:N,onChange:H=>O(H.target.value),placeholder:": 1200",autoFocus:!0}),s.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:" "})]}):s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:""}),s.jsx(kt,{type:"number",step:"0.1",value:B,onChange:H=>T(H.target.value),placeholder:": 1, 1.5, 2",autoFocus:!0}),s.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:"  (1 = )"})]})}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[s.jsx(se,{variant:"ghost",onClick:ue,children:""}),s.jsx(se,{variant:"primary",onClick:K,children:""})]})]})}),s.jsxs("div",{className:"container-header",children:[s.jsx("h2",{className:"section-title",children:" "}),s.jsxs("div",{className:"header-actions",children:[s.jsx(se,{variant:"secondary",onClick:i,style:{marginRight:"8px"},children:" "}),s.jsx(se,{variant:"danger",onClick:X,style:{marginRight:"8px"},children:" "}),s.jsx(se,{variant:"ghost",onClick:n,children:" "})]})]}),s.jsx(oa,{onDragEnd:z,sensors:P,children:s.jsxs("div",{className:"planner-layout",children:[s.jsxs("div",{className:"recipe-sidebar",children:[s.jsx("div",{className:"sidebar-search",children:s.jsx(kt,{placeholder:"...",value:v,onChange:H=>x(H.target.value)})}),s.jsx("div",{className:"draggable-list",children:Ue.map(H=>s.jsx(nT,{recipe:H},H.id))})]}),s.jsxs("div",{className:"planner-calendar",children:[s.jsxs("div",{className:"calendar-header",children:[s.jsx(se,{variant:"ghost",onClick:()=>de(-1),children:" "}),s.jsxs("h3",{style:{margin:0},children:[m.getFullYear()," ",m.getMonth()+1,""]}),s.jsx(se,{variant:"ghost",onClick:()=>de(1),children:" "})]}),s.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(H=>s.jsx("div",{className:"calendar-day-header",children:H},H)),ke().map((H,G)=>{const oe=tl(H.date),pe=f[oe]||[],je=oe===tl(new Date);return s.jsx(sT,{dateStr:oe,dayNum:H.date.getDate(),isToday:je,isOutside:H.isOutside,children:pe.map(Ie=>{const Be=u.find(Pe=>Pe.id===Ie.recipeId);return s.jsx(rT,{meal:Ie,dateStr:oe,children:s.jsxs("div",{className:"planned-meal",title:Be?.title,onClick:()=>Be&&t&&t(Be),children:[s.jsx("span",{children:Be?.title||"Unknown"}),s.jsx("span",{className:"delete-meal-btn",onPointerDown:Pe=>{Pe.stopPropagation()},onClick:Pe=>ye(oe,Ie.id,Pe),children:""})]})},Ie.id)})},G)})]})]})]})})]})},aT=({onBack:n,onNavigateToPlanner:t})=>{const{user:i}=us(),a=ua(),[o,u]=w.useState(new Date().toISOString().slice(0,10)),[d,f]=w.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[h,m]=w.useState([]),[y,v]=w.useState(!1),[x,b]=w.useState(!1),[_,C]=w.useState(!1),[j,k]=w.useState(!1);Ce.useEffect(()=>{window.plannerService=ji,window.shortageService=yp,window.recipeService=yn},[]);const E=async()=>{v(!0);try{if(!i?.id){a.error(""),v(!1);return}const N=await yp.calculateShortages(i,o,d);N.length,m(N),b(!0)}catch(N){console.error(N),a.error(": "+(N.message||String(N)))}finally{v(!1)}},D=()=>{C(!0)},U=()=>{k(!0)},B=()=>h.map(N=>{if(Number.isFinite(N.orderPacks)&&N.orderPacks!==null){const O=N.packSize&&N.packUnit?`1${N.orderUnit}=${N.packSize}${N.packUnit}`:"";return`${N.name}: ${N.orderPacks}${N.orderUnit}${O}`}return`${N.name}: ${Number(N.toOrder||0).toFixed(1)}${N.unit}`}).join(`
`),T=async()=>{const N=document.getElementById("copy-textarea");if(N){N.select();try{await navigator.clipboard.writeText(N.value),a.success("")}catch{document.execCommand("copy"),a.success("")}}};return s.jsxs("div",{className:"order-list-container fade-in",children:[s.jsxs("div",{className:"container-header",children:[s.jsx("h2",{className:"section-title",children:" "}),s.jsxs("div",{className:"header-actions",children:[s.jsx(se,{variant:"secondary",onClick:t,style:{marginRight:"8px"},children:" "}),s.jsx(se,{variant:"ghost",onClick:n,children:" "})]})]}),s.jsx("div",{className:"filter-card",children:s.jsxs("div",{className:"date-range-inputs",children:[s.jsxs("div",{children:[s.jsx("label",{children:""}),s.jsx("input",{type:"date",value:o,onChange:N=>u(N.target.value)})]}),s.jsx("span",{children:""}),s.jsxs("div",{children:[s.jsx("label",{children:""}),s.jsx("input",{type:"date",value:d,onChange:N=>f(N.target.value)})]}),s.jsx(se,{variant:"primary",onClick:E,disabled:y,children:y?"...":""})]})}),x&&s.jsxs("div",{className:"order-results",children:[s.jsxs("div",{className:"results-header",children:[s.jsxs("h3",{children:[" (",h.length,")"]}),s.jsxs("div",{className:"result-actions",children:[s.jsx(se,{variant:"secondary",onClick:D,children:" "}),s.jsx(se,{variant:"secondary",onClick:U,children:" "})]})]}),s.jsxs("table",{className:"order-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""})]})}),s.jsx("tbody",{children:h.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):h.map((N,O)=>s.jsxs("tr",{children:[s.jsx("td",{children:N.name}),s.jsxs("td",{style:{textAlign:"right"},children:[N.required.toFixed(1)," ",N.unit]}),s.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,N.remaining??0).toFixed(1)," ",N.unit]}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(N.orderPacks)&&N.orderPacks!==null?s.jsxs(s.Fragment,{children:[N.orderPacks,N.orderUnit,N.packSize&&N.packUnit&&s.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",N.orderUnit," = ",Number(N.packSize).toLocaleString(),N.packUnit,N.packPrice?` / ${Math.round(N.packPrice).toLocaleString()}`:""]})]}):s.jsxs(s.Fragment,{children:[N.toOrder.toFixed(1)," ",s.jsx("span",{style:{fontSize:"0.8em"},children:N.unit})]})})]},O))})]})]}),s.jsx(xn,{isOpen:_,onClose:()=>C(!1),title:" ",size:"medium",children:s.jsxs("div",{className:"copy-modal-content",children:[s.jsx("p",{className:"copy-instructions",children:""}),s.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:B(),onClick:N=>N.target.select()}),s.jsxs("div",{className:"modal-actions",children:[s.jsx(se,{variant:"primary",onClick:T,children:" "}),s.jsx(se,{variant:"ghost",onClick:()=>C(!1),children:""})]})]})}),s.jsx(xn,{isOpen:j,onClose:()=>k(!1),title:" ",size:"large",children:s.jsxs("div",{className:"print-preview-content",children:[s.jsxs("div",{className:"print-preview-header",children:[s.jsx("h3",{children:""}),s.jsxs("p",{className:"print-period",children:[": ",o,"  ",d]})]}),s.jsxs("table",{className:"print-preview-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""})]})}),s.jsx("tbody",{children:h.map((N,O)=>s.jsxs("tr",{children:[s.jsx("td",{children:N.name}),s.jsxs("td",{style:{textAlign:"right"},children:[N.required.toFixed(1)," ",N.unit]}),s.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,N.remaining??0).toFixed(1)," ",N.unit]}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(N.orderPacks)&&N.orderPacks!==null?`${N.orderPacks}${N.orderUnit}`:`${N.toOrder.toFixed(1)} ${N.unit}`})]},O))})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx(se,{variant:"primary",onClick:()=>window.print(),children:" "}),s.jsx(se,{variant:"ghost",onClick:()=>k(!1),children:""})]})]})})]})},So=async(n,t,i)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${i||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},Xx=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},lT=({children:n})=>{const[t,i]=w.useState(null),[a,o]=w.useState(!0),[u,d]=w.useState(!1),f=w.useCallback(async j=>{if(!j){i(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const k=j.id,E=j.email||"";try{const q=localStorage.getItem("auth_user_cache");if(q){const V=JSON.parse(q);V&&V.id===k&&i(V)}}catch(q){console.warn("[Auth] Failed to load cache",q)}let D=null,U=0;const B=3;for(;U<B;)try{const[q,V]=await Promise.all([So(Re.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",k).single().then(P=>({data:P,error:null})).catch(P=>({data:null,error:P})),2500,"profiles.select(with_email)").catch(P=>({data:null,error:P})),So(Re.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",k).single().then(P=>({data:P,error:null})).catch(P=>({data:null,error:P})),2500,"profiles.select").catch(P=>({data:null,error:P}))]);let F=null,I=null;if(q?.data?.data?(F=q.data.data,I=null):V?.data?.data?(F=V.data.data,I=null):I=q?.error??V?.error??new Error("Profile fetch failed"),I)if(I.code==="PGRST116"){const P=j.user_metadata&&j.user_metadata.display_id?String(j.user_metadata.display_id):Xx(E)||k.slice(0,8);let R=null,z=null;const K=await So(Re.from("profiles").insert([{id:k,display_id:P,email:E||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),8e3,"profiles.insert(with_email)");if(R=K?.data??null,z=K?.error??null,z&&String(z.message||"").toLowerCase().includes("email")){const ue=await So(Re.from("profiles").insert([{id:k,display_id:P,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),8e3,"profiles.insert");R=ue?.data??null,z=ue?.error??null}if(z)throw z;D=R}else throw I;else D=F;if(D&&Object.prototype.hasOwnProperty.call(D,"email")&&E&&!D.email)try{await Re.from("profiles").update({email:E}).eq("id",k)}catch(P){console.warn("Failed to backfill profile email",P)}break}catch(q){console.error(`Failed to load/create profile (Attempt ${U+1}/${B}):`,q),U++,U<B&&await new Promise(V=>setTimeout(V,500*U))}const T=D?.display_id||Xx(E)||k.slice(0,8),N=D?.role||"user",O=String(N).trim().toLowerCase(),L=D?.show_master_recipes===!0,Y={id:k,email:E,displayId:T,role:O,showMasterRecipes:L};i(Y);try{localStorage.setItem("auth_user_cache",JSON.stringify(Y))}catch(q){console.warn("[Auth] Failed to save cache",q)}},[]);w.useEffect(()=>{let j=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:k}=Re.auth.onAuthStateChange(async(D,U)=>{D==="PASSWORD_RECOVERY"&&d(!0);try{await f(U?.user||null)}catch(B){console.error("Auth state change handler failed:",B)}});return j=k?.subscription,(async()=>{try{const{data:D}=await So(Re.auth.getSession(),5e3,"auth.getSession");await f(D?.session?.user||null)}catch(D){console.error("Auth init failed:",D)}finally{o(!1)}})(),()=>{try{j?.unsubscribe?.()}catch{}}},[f]);const h=w.useCallback(async(j,k)=>{const{error:E}=await Re.auth.signInWithPassword({email:j,password:k});if(E)throw console.error("Login error:",E),new Error("")},[]),m=w.useCallback(async(j,k,E)=>{const{data:D,error:U}=await Re.auth.signUp({email:j,password:k,options:{data:{display_id:E}}});if(U)throw console.error("SignUp error:",U),new Error(U.message||"");const B=D?.user;if(B?.id){let T=null;T=(await Re.from("profiles").insert([{id:B.id,display_id:E,email:j||null,role:"user",show_master_recipes:!1}]))?.error??null,T&&String(T.message||"").toLowerCase().includes("email")&&(T=(await Re.from("profiles").insert([{id:B.id,display_id:E,role:"user",show_master_recipes:!1}]))?.error??null),T&&T.code!=="23505"&&console.error("Profile create error:",T)}return{needsEmailConfirmation:!D?.session}},[]),y=w.useCallback(async()=>{await Re.auth.signOut(),i(null),d(!1)},[]),v=w.useCallback(j=>{!j||typeof j!="object"||i(k=>k&&{...k,...j})},[]),x=w.useCallback(async j=>{const{error:k}=await Re.auth.resetPasswordForEmail(j,{redirectTo:window.location.origin});if(k)throw console.error("Password reset email error:",k),new Error("");return!0},[]),b=w.useCallback(async j=>{const{error:k}=await Re.auth.updateUser({password:j});if(k)throw console.error("Update password error:",k),new Error("");return!0},[]),_=w.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),C=w.useMemo(()=>({user:t,loading:a,login:h,register:m,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:b,finishPasswordRecovery:_}),[t,a,h,m,y,v,x,u,b,_]);return s.jsx(gb.Provider,{value:C,children:n})},oT=({id:n,message:t,type:i="info",onClose:a})=>{w.useEffect(()=>{const u=setTimeout(()=>{a(n)},3e3);return()=>clearTimeout(u)},[n,a]);const o=()=>{switch(i){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return s.jsxs("div",{className:`toast toast-${i}`,children:[s.jsx("div",{className:"toast-icon",children:o()}),s.jsx("div",{className:"toast-message",children:t}),s.jsx("button",{className:"toast-close",onClick:()=>a(n),"aria-label":"",children:""})]})},cT=({toasts:n,onRemove:t})=>n.length===0?null:s.jsx("div",{className:"toast-container",children:n.map(i=>s.jsx(oT,{id:i.id,message:i.message,type:i.type,onClose:t},i.id))}),uT=({children:n})=>{const[t,i]=w.useState([]),a=w.useCallback((d,f="info")=>{const h=Date.now()+Math.random();i(m=>[...m,{id:h,message:d,type:f}].slice(-5))},[]),o=w.useCallback(d=>{i(f=>f.filter(h=>h.id!==d))},[]),u={showToast:a,success:d=>a(d,"success"),error:d=>a(d,"error"),warning:d=>a(d,"warning"),info:d=>a(d,"info")};return s.jsxs(yb.Provider,{value:u,children:[n,s.jsx(cT,{toasts:t,onRemove:o})]})},dT=()=>{const[n,t]=w.useState(!0),[i,a]=w.useState(!1),[o,u]=w.useState(""),[d,f]=w.useState(""),[h,m]=w.useState(""),[y,v]=w.useState(""),[x,b]=w.useState(""),[_,C]=w.useState(!1),[j,k]=w.useState(!1);Ce.useEffect(()=>{const O=localStorage.getItem("savedEmail"),L=localStorage.getItem("savedPassword");O&&(u(O),L&&f(L),k(!0))},[]);const{login:E,register:D,sendPasswordResetEmail:U}=us(),B=async O=>{O.preventDefault(),v(""),b(""),C(!0);try{await E(o.trim(),d),j?(localStorage.setItem("savedEmail",o.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(L){v(L.message||"")}finally{C(!1)}},T=async O=>{O.preventDefault(),v(""),b(""),C(!0);try{if(!h.trim()){v("ID: yoshito");return}(await D(o.trim(),d,h.trim()))?.needsEmailConfirmation?b(""):b(""),t(!0),f("")}catch(L){v(L.message||"")}finally{C(!1)}},N=async O=>{O.preventDefault(),v(""),b(""),C(!0);try{await U(o.trim()),b(""),a(!1)}catch(L){v(L.message||"")}finally{C(!1)}};return s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:s.jsxs(an,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[s.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[s.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",s.jsx("br",{}),"Management"]}),s.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:i?"":n?"":""})]}),y&&s.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&s.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),s.jsxs("form",{onSubmit:i?N:n?B:T,children:[s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),s.jsx("input",{type:"email",value:o,onChange:O=>u(O.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!i&&s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),s.jsx("input",{type:"password",value:d,onChange:O=>f(O.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!i&&!n&&s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",s.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),s.jsx("input",{type:"text",value:h,onChange:O=>m(O.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),s.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!i&&s.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[s.jsx("input",{type:"checkbox",id:"rememberMe",checked:j,onChange:O=>k(O.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),s.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),s.jsx(se,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:_,children:i?"":n?"":""})]}),s.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i?s.jsx("button",{type:"button",onClick:()=>{a(!1),v(""),b("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):s.jsx("button",{type:"button",onClick:()=>{a(!0),v(""),b("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!i&&s.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),b("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},hT=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:i}=us(),[a,o]=Ce.useState(""),[u,d]=Ce.useState(""),[f,h]=Ce.useState(""),[m,y]=Ce.useState(""),[v,x]=Ce.useState(!1),b=async _=>{if(_.preventDefault(),h(""),y(""),!a||a.length<8){h("8");return}if(a!==u){h("");return}x(!0);try{await n(a),y(""),t()}catch(C){console.error(C),h(C.message||"")}finally{x(!1)}};return s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:s.jsxs(an,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[s.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),s.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),f&&s.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:f}),m&&s.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),s.jsxs("form",{onSubmit:b,children:[s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),s.jsx("input",{type:"password",value:a,onChange:_=>o(_.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),s.jsx("input",{type:"password",value:u,onChange:_=>d(_.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),s.jsx(se,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),s.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),s.jsx(se,{variant:"ghost",onClick:i,style:{flex:1},children:""})]})]})})},Yf=({label:n,subLabel:t,variant:i="screen",showLogo:a=!0})=>s.jsxs("div",{className:i==="screen"?"loading-screen":"loading-inline",children:[a&&s.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),s.jsxs("div",{className:"loading-text",children:[n,s.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[s.jsx("span",{children:"."}),s.jsx("span",{children:"."}),s.jsx("span",{children:"."})]})]}),s.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&s.jsx("div",{className:"loading-subtext",children:t})]}),fT=24,pT=120,mT=64,gT=180,ju="__NO_STORE__",_u="__OTHER_STORE__",yT=(n,t)=>{const i=new Set((n||[]).map(o=>String(o.id))),a=[...n||[]];for(const o of t||[]){const u=String(o.id);i.has(u)||(i.add(u),a.push(o))}return a},vp=n=>(n||"").toString().replace(/\s+/g," ").trim(),Tr=n=>vp(n).toLowerCase(),Zx=new Set(Pu.map(n=>Tr(n)).filter(Boolean));function vT(){const{user:n,logout:t,loading:i,isPasswordRecovery:a}=us(),o=ua(),[u,d]=Ko(),[f,h]=w.useState([]),[m,y]=w.useState(!0),[v,x]=w.useState(0),[b,_]=w.useState([]),[C,j]=w.useState(!1),[k,E]=w.useState({}),[D,U]=w.useState({}),[B,T]=w.useState(!1),N=w.useRef(0),O=u.get("view"),L=(O==="create-mock"?"create":O)||"list",Y=u.get("id"),q=f.find(ce=>String(ce.id)===Y)||null,[V,F]=w.useState(null),[I,P]=w.useState(!1),[R,z]=w.useState(""),[K,ue]=w.useState(null),[ye,$]=w.useState(null),[Q,X]=w.useState(""),[fe,ke]=w.useState("none"),[Ue,de]=w.useState(!1),[H,G]=w.useState(!1),[oe,pe]=w.useState(new Set),[je,Ie]=w.useState("normal"),[Be,Pe]=w.useState(!1),[lt,rt]=w.useState(!1),[qe,xe]=w.useState(null),[_e,te]=w.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),We={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};w.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const ce=window.matchMedia("(max-width: 700px)"),Le=()=>te(!!ce.matches);return Le(),ce.addEventListener?ce.addEventListener("change",Le):ce.addListener(Le),()=>{ce.removeEventListener?ce.removeEventListener("change",Le):ce.removeListener(Le)}},[]),w.useEffect(()=>{if(!_e||!We[L]||typeof window>"u")return;const ce=`pc-recommend-shown:${L}`;try{if(window.sessionStorage.getItem(ce)==="1")return;window.sessionStorage.setItem(ce,"1")}catch{}xe(L)},[L,_e]),w.useEffect(()=>{L!=="list"&&ke("none")},[L]),w.useEffect(()=>{if(typeof document>"u"||!Ue)return;const ce=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=ce}},[Ue]),w.useEffect(()=>{if(!i){j(!1);return}const ce=setTimeout(()=>j(!0),3500);return()=>clearTimeout(ce)},[i]),w.useEffect(()=>{if(f.length>0||L==="trash")return;let ce=n?.id;if(!ce)try{ce=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!ce)return;const Le=yn.getCachedRecipes(ce);Le&&Le.length>0&&(h(Le),T(!0),y(!1))},[n?.id]),w.useEffect(()=>{i||n&&(Ge(),Ae())},[i,n?.id]),w.useEffect(()=>{if(i)return;if(!n||n.role!=="admin"){E({}),U({});return}let ce=!1;return(async()=>{try{const Le=await ia.fetchAllProfiles();if(ce)return;const He={},pt={};for(const Dt of Le||[])Dt?.id&&(He[String(Dt.id)]=Dt),Dt?.display_id&&(pt[String(Dt.display_id)]=Dt);E(He),U(pt)}catch(Le){console.warn("Failed to load profiles for admin owner labels",Le)}})(),()=>{ce=!0}},[i,n?.id,n?.role]);const Tt=ce=>{const He=(ce?.tags||[]).find(ne=>ne&&ne.startsWith("owner:"));if(!He)return"/";const pt=String(He.slice(6)),Dt=k[pt]||D[pt]||null;return Dt?Dt.display_id||Dt.email||pt:pt.length>12?`${pt.slice(0,8)}`:pt},Ct=gl(vr(Jo,{activationConstraint:{distance:10}}),vr(Xo,{activationConstraint:{delay:1e3,tolerance:5}}),vr(vl,{coordinateGetter:ed})),le=ce=>{const{active:Le,over:He}=ce;Le.id!==He.id&&h(pt=>{const Dt=pt.findIndex(be=>be.id===Le.id),ne=pt.findIndex(be=>be.id===He.id);if(Dt===-1||ne===-1)return pt;const ae=ca(pt,Dt,ne),re=ae.map((be,Me)=>({id:be.id,order_index:Me}));return yn.updateOrder(re).catch(be=>console.error("Order update failed",be)),ae})},Ae=async()=>{try{const ce=await yn.fetchRecentRecipes();_(ce||[])}catch(ce){console.error("Failed to load history:",ce)}},Oe=async ce=>{const Le=[ce,...b.filter(He=>He!==ce)].slice(0,20);_(Le);try{await yn.addToHistory(ce)}catch(He){console.error("Failed to sync history",He)}},Ge=async()=>{try{const ce=await yn.getDeletedCount();x(ce||0)}catch(ce){console.error("Failed to load trash count:",ce)}},nt=async()=>{if(!n)return;const ce=N.current+1;N.current=ce;const Le=()=>N.current!==ce,He=_e?fT:pT,pt=_e?mT:gT;try{B||y(!0);const Dt=await yn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:0,limit:He,skipCacheSave:!0,returnMeta:!0});if(Le())return;let ne=Dt?.recipes||[],ae=Dt?.hasMoreRaw===!0,re=He;h(ne);let be=!1;for(!B&&(ne.length>0||!ae)&&(y(!1),be=!0);ae;){const Me=await yn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:re,limit:pt,skipCacheSave:!0,returnMeta:!0});if(Le())return;const Je=Me?.recipes||[];if(Je.length>0&&(ne=yT(ne,Je),h(ne),!B&&!be&&(y(!1),be=!0)),re+=pt,ae=Me?.hasMoreRaw===!0,Je.length===0&&!ae)break}if(Le())return;yn.saveCachedRecipes(ne,n.id)}catch(Dt){if(Le())return;console.error("Failed to fetch recipes:",Dt),o.error(`

(${Dt?.message||"unknown error"})`)}finally{Le()||(y(!1),T(!1))}},{allCourses:St,allCategories:on,storeCounts:Tn,noStoreCount:Jt,otherStoreCount:dt,courseCounts:tn,categoryCounts:qt}=w.useMemo(()=>{const ce=[...new Set(f.map(re=>vp(re.course)).filter(Boolean))],Le=[...new Set(f.map(re=>vp(re.category)).filter(Boolean))],He=f.reduce((re,be)=>{const Me=Tr(be.storeName);return Me&&(re[Me]=(re[Me]||0)+1),re},{}),pt=f.reduce((re,be)=>Tr(be.storeName)?re:re+1,0),Dt=f.reduce((re,be)=>{const Me=Tr(be.storeName);return Me?Zx.has(Me)?re:re+1:re},0),ne=f.reduce((re,be)=>{const Me=Tr(be.course);return Me&&(re[Me]=(re[Me]||0)+1),re},{}),ae=f.reduce((re,be)=>{const Me=Tr(be.category);return Me&&(re[Me]=(re[Me]||0)+1),re},{});return{allCourses:ce,allCategories:Le,storeCounts:He,noStoreCount:pt,otherStoreCount:Dt,courseCounts:ne,categoryCounts:ae}},[f]),ir=w.useMemo(()=>{const ce=Tr(R),Le=Q.toLowerCase().trim();return f.filter(He=>{const pt=Tr(He.storeName);return R===""||R==="recent"&&b.includes(He.id)||He.tags&&He.tags.includes(R)||R===ju&&!pt||R===_u&&pt&&!Zx.has(pt)||He.category&&Tr(He.category)===ce||He.course&&Tr(He.course)===ce||He.storeName&&pt===ce?Le?(He.title||"").toLowerCase().includes(Le)||He.description&&He.description.toLowerCase().includes(Le)||Array.isArray(He.ingredients)&&He.ingredients.some(ne=>(ne?.name||"").toLowerCase().includes(Le)):!0:!1})},[f,R,b,Q]),xr=R===""&&!Q.trim()&&L==="list",jn=(ce,Le={})=>{d({view:"detail",id:ce.id,...Le})},ve=async(ce,Le=!1)=>{try{if(ce.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&ce.tags.some(pt=>pt==="owner:yoshito")){o.warning("");return}Le?(await yn.restoreRecipe(ce.id),(L==="trash"||L==="detail")&&(d({view:"trash"}),Ze()),o.success("")):(await yn.deleteRecipe(ce.id),h(f.filter(He=>He.id!==ce.id)),d({view:"list"}),Ge())}catch(He){console.error("Failed to delete/restore recipe:",He),o.error("")}finally{Ge()}},st=async ce=>{try{await yn.hardDeleteRecipe(ce.id),h(f.filter(Le=>Le.id!==ce.id)),d({view:"trash"}),o.success(""),Ze(),Ge()}catch(Le){console.error("Failed to hard delete recipe:",Le),o.error("")}},Ze=async()=>{try{N.current+=1,y(!0);const ce=await yn.fetchDeletedRecipes();h(ce||[]),z("")}catch(ce){console.error("Failed to fetch deleted recipes:",ce)}finally{y(!1)}},tt=()=>{d({view:"trash"})},vt=()=>{d({view:"list"})},At=async(ce,Le)=>{try{let He,pt=Le;if(Le&&n.role!=="admin"){const Dt=ce.tags?.find(ae=>ae.startsWith("owner:"));Dt===`owner:${n.id}`||n.displayId&&Dt===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${Dt||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),pt=!1)}pt?(He=await yn.updateRecipe(ce,n),h(f.map(Dt=>Dt.id===He.id?He:Dt))):(He=await yn.createRecipe(ce,n),h([He,...f])),d(pt?{view:"detail",id:He.id}:{view:"detail",id:He.id})}catch(He){console.error("Failed to save recipe:",He),o.error(`
: ${He.message||He.error_description||JSON.stringify(He)}`)}};w.useEffect(()=>{let ce=!1;return(async()=>{if(L!=="edit"||!Y){F(null),P(!1);return}P(!0);try{const He=await yn.getRecipe(Y);if(ce)return;F(He)}catch(He){if(console.error("Failed to load edit recipe details",He),ce)return;F(q),o.warning("")}finally{ce||P(!1)}})(),()=>{ce=!0}},[L,Y]);const Et=(ce,Le="")=>{const He=["","baker","","","","dough","fermentation"],pt=ce.title||ce.name||"",Dt=He.some(Fe=>pt.toLowerCase().includes(Fe)),ne=["flour","","","","","","","","",""],ae=["yeast","","",""],re=ce.ingredients||[],be=re.some(Fe=>ae.some(Ke=>(Fe.name||"").toLowerCase().includes(Ke))),Me=re.some(Fe=>ne.some(Ke=>(Fe.name||"").toLowerCase().includes(Ke))&&!Fe.name.includes(""));if(re.some(Fe=>Fe.quantity&&String(Fe.quantity).includes("%")||Fe.unit&&String(Fe.unit).includes("%"))||be||Dt&&Me){ce.type="bread",ce.flours=[],ce.breadIngredients=[];const Fe=["flour","","","","","","","",""];if(re.forEach(Ke=>{Fe.some(xt=>(Ke.name||"").includes(xt))?ce.flours.push(Ke):ce.breadIngredients.push(Ke)}),ce.flours.length===0&&re.length>0){const Ke=re[0];(Ke.name||"").includes("")&&(ce.flours.push(Ke),ce.breadIngredients=ce.breadIngredients.filter(Mt=>Mt!==Ke))}}ce.sourceUrl=Le,Le&&(ce.category="URL"),$(ce),d({view:"create"})},Lt=()=>{G(!H),pe(new Set)},ht=ce=>{const Le=new Set(oe);Le.has(ce)?Le.delete(ce):Le.add(ce),pe(Le)},Pt=()=>{Pe(!0)},Nt=()=>{Pe(!1)},Xt=async()=>{Pe(!1);try{y(!0),L==="trash"?(await Promise.all(Array.from(oe).map(ce=>yn.hardDeleteRecipe(ce))),Ze()):(await Promise.all(Array.from(oe).map(ce=>yn.deleteRecipe(ce))),h(f.filter(ce=>!oe.has(ce.id))),Ge()),pe(new Set),G(!1),o.success("")}catch(ce){console.error("Bulk delete failed",ce),o.warning(""),L==="trash"?Ze():nt()}finally{y(!1)}},mt=()=>{oe.size!==0&&rt(!0)},Zt=()=>{rt(!1)},Rt=async()=>{rt(!1);try{y(!0);for(const ce of oe)await yn.restoreRecipe(ce);h(f.filter(ce=>!oe.has(ce.id))),Ge(),G(!1),pe(new Set),o.success(""),Ze()}catch(ce){console.error("Bulk restore failed",ce),o.warning(""),Ze()}finally{y(!1)}},en=()=>{const ce=ir.map(Le=>Le.id);pe(new Set(ce))},un=ce=>{h([ce,...f]),d({view:"edit",id:ce.id})};if(w.useEffect(()=>{i||n&&(L==="trash"?Ze():L==="list"&&nt())},[L,i,n?.id]),i&&!C){let ce=!1;try{const Le=JSON.parse(localStorage.getItem("auth_user_cache")||"null");Le?.id&&(ce=!!yn.getCachedRecipes(Le.id))}catch{}if(!ce)return s.jsx(Yf,{label:"",subLabel:""})}return n?a?s.jsx(hT,{}):s.jsxs(a_,{children:[Be&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(an,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[s.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:""})," ",oe.size,"",L==="trash"?"":""]}),s.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:L==="trash"?"":""}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(se,{variant:"ghost",onClick:Nt,children:""}),s.jsx(se,{variant:"danger",onClick:Xt,children:L==="trash"?"":""})]})]})}),lt&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(an,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[s.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:""})," ",oe.size,""]}),s.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(se,{variant:"ghost",onClick:Zt,children:""}),s.jsx(se,{variant:"secondary",onClick:Rt,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),s.jsx(xn,{isOpen:!!qe,onClose:()=>xe(null),title:"PC",size:"small",children:s.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[s.jsx("p",{style:{marginTop:0},children:We[qe]?s.jsxs(s.Fragment,{children:["",s.jsx("strong",{children:We[qe]}),"/"]}):s.jsx(s.Fragment,{children:"/"})}),s.jsxs("p",{style:{marginBottom:0},children:["",s.jsx("strong",{children:"PC"}),""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[s.jsx(se,{variant:"ghost",onClick:()=>{xe(null),d({view:"list"})},children:""}),s.jsx(se,{variant:"primary",onClick:()=>xe(null),children:"OK"})]})]})}),(L==="list"||L==="trash")&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"container-header",children:[s.jsxs("h2",{className:"section-title",children:[L==="trash"?" ()":"",L==="list"&&s.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",f.length,")"]})]}),s.jsx("div",{className:"header-actions",children:L==="list"||L==="trash"?s.jsxs(s.Fragment,{children:[H?s.jsxs(s.Fragment,{children:[s.jsx(se,{variant:"ghost",onClick:Lt,children:""}),s.jsx(se,{variant:"secondary",onClick:en,children:""}),L==="trash"&&s.jsxs(se,{variant:"secondary",onClick:mt,disabled:oe.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",oe.size,")"]}),s.jsxs(se,{variant:"danger",onClick:Pt,disabled:oe.size===0,children:[L==="trash"?"":""," (",oe.size,")"]})]}):s.jsx(s.Fragment,{children:L==="list"?s.jsx(s.Fragment,{children:s.jsx(se,{onClick:()=>{$(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):s.jsx(se,{variant:"ghost",onClick:vt,children:" "})}),s.jsx("button",{className:"mobile-menu-toggle",onClick:()=>de(!Ue),"aria-label":"",children:""}),s.jsxs("div",{className:`secondary-actions ${Ue?"open":""}`,children:[s.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>de(!1),"aria-label":"",children:""}),s.jsxs("div",{className:"secondary-actions-content",children:[s.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[s.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&s.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&s.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),s.jsxs(se,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),s.jsxs(se,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),L==="list"&&s.jsxs(s.Fragment,{children:[s.jsxs(se,{variant:"secondary",onClick:()=>{ue("url"),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),s.jsxs(se,{variant:"secondary",onClick:()=>{ue("image"),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),s.jsx("div",{className:"pc-recommend-note",children:s.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),s.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"inventory"}),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"incoming-deliveries"}),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),s.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"incoming-stock"}),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"planner"}),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),s.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"data"}),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&s.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"users"}),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),s.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"order-list"}),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"})]}),!H&&s.jsxs(se,{variant:"ghost",onClick:()=>{Lt(),de(!1)},className:"danger-text",children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," ",L==="trash"?"":""]}),L==="list"&&s.jsxs(se,{variant:"ghost",onClick:()=>{tt(),de(!1)},style:{position:"relative"},children:[s.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&s.jsx("span",{className:"trash-badge",children:v})]}),s.jsxs(se,{variant:"ghost",onClick:()=>{vt(),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),s.jsxs(se,{variant:"ghost",onClick:()=>{t(),de(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]})]}),s.jsx("div",{className:`menu-backdrop ${Ue?"open":""}`,onClick:()=>de(!1),"aria-hidden":"true"})]}):null})]}),L==="list"&&s.jsxs("div",{className:"list-toolbar",children:[s.jsxs("div",{className:"search-container search-container--compact",children:[s.jsx("span",{className:"search-icon",children:""}),s.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:Q,onChange:ce=>X(ce.target.value)})]}),s.jsxs("div",{className:"public-recipe-toggles",children:[s.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${fe==="mine"?"active":""}`,"aria-pressed":fe==="mine",onClick:()=>ke("mine"),children:" "}),s.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${fe==="others"?"active":""}`,"aria-pressed":fe==="others",onClick:()=>ke("others"),children:" "}),fe!=="none"&&s.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>ke("none"),children:" "})]})]}),s.jsxs("div",{className:"tag-filter-container",children:[s.jsxs("select",{className:"store-filter-select",value:R===ju?ju:R===_u?_u:Pu.includes(R)?R:"",onChange:ce=>z(ce.target.value||""),children:[s.jsx("option",{value:"",children:""}),Pu.map(ce=>s.jsxs("option",{value:ce,children:[ce," (",Tn[Tr(ce)]||0,")"]},ce)),s.jsxs("option",{value:ju,children:[" (",Jt,")"]}),s.jsxs("option",{value:_u,children:[" (",dt,")"]})]}),s.jsxs("select",{className:"store-filter-select",value:St.includes(R)?R:"",onChange:ce=>z(ce.target.value||""),children:[s.jsx("option",{value:"",children:""}),St.sort().map(ce=>s.jsxs("option",{value:ce,children:[ce," (",tn[Tr(ce)]||0,")"]},ce))]}),s.jsxs("select",{className:"store-filter-select",value:on.includes(R)?R:"",onChange:ce=>z(ce.target.value||""),children:[s.jsx("option",{value:"",children:""}),on.sort().map(ce=>s.jsxs("option",{value:ce,children:[ce," (",qt[Tr(ce)]||0,")"]},ce))]}),s.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[s.jsx("button",{className:`tag-filter-btn ${je==="normal"?"active":""}`,onClick:()=>Ie("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),s.jsx("button",{className:`tag-filter-btn ${je==="all"?"active":""}`,onClick:()=>Ie("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),m?s.jsx(Yf,{label:B?"":"",subLabel:B?void 0:"",variant:"inline",showLogo:!1}):f.length===0?s.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[L==="trash"?"":"",R!==""&&s.jsx("p",{children:""})]}):s.jsxs("div",{className:"main-content-wrapper",children:[L==="list"&&s.jsx("div",{className:"recent-list-wrapper",children:s.jsx(Nk,{recipes:f,recentIds:b,onSelect:jn})}),s.jsx("div",{className:"recipe-list-container",children:L==="list"?s.jsx(oa,{sensors:Ct,collisionDetection:Xf,onDragEnd:le,children:s.jsx(Yv,{recipes:ir,onSelectRecipe:jn,isSelectMode:H,selectedIds:oe,onToggleSelection:ht,disableDrag:!xr,displayMode:je,publicRecipeView:fe,showOwner:n?.role==="admin",ownerLabelFn:Tt,currentUser:n})}):s.jsx(Yv,{recipes:ir,onSelectRecipe:jn,isSelectMode:H,selectedIds:oe,onToggleSelection:ht,disableDrag:!0,displayMode:je,publicRecipeView:fe,showOwner:n?.role==="admin",ownerLabelFn:Tt,currentUser:n})})]})]}),L==="detail"&&q&&s.jsx(ek,{recipe:q,ownerLabel:n?.role==="admin"?Tt(q):void 0,isDeleted:!!q.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):q.deletedAt?tt():vt()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?vt:void 0,onEdit:()=>d({view:"edit",id:q.id,from:u.get("from")}),onDelete:ve,onView:Oe,onHardDelete:st,onDuplicate:un}),L==="edit"&&Y&&(I?s.jsx(Yf,{label:"",subLabel:"URL"}):V&&s.jsx(Fx,{initialData:V,onCancel:()=>d({view:"detail",id:Y}),onSave:ce=>At(ce,!0)},`edit-${Y}`)),L==="create"&&s.jsx(Fx,{initialData:ye,onCancel:()=>{d({view:"list"}),$(null)},onSave:ce=>At(ce,!1)},ye?"create-form-imported":"create-form"),K&&s.jsx(Tb,{initialMode:K,onClose:()=>ue(null),onImport:Et}),(L==="data"||L==="data-management")&&s.jsx(Ck,{onBack:()=>d({view:"list"})}),L==="levain-guide"&&s.jsx(Ek,{onBack:()=>d({view:"list"})}),L==="users"&&n?.role==="admin"&&s.jsx(kk,{onBack:()=>d({view:"list"})}),L==="inventory"&&s.jsx(Dk,{onBack:()=>d({view:"list"})}),L==="incoming-deliveries"&&s.jsx(Vk,{onBack:()=>d({view:"list"})}),L==="incoming-stock"&&s.jsx(tT,{onBack:()=>d({view:"list"})}),L==="planner"&&s.jsx(iT,{onBack:()=>d({view:"list"}),onSelectRecipe:ce=>jn(ce,{from:"planner"}),onNavigateToOrderList:()=>d({view:"order-list"})}),L==="order-list"&&s.jsx(aT,{onBack:()=>d({view:"list"}),onNavigateToPlanner:()=>d({view:"planner"})})]}):s.jsx(dT,{})}function xT(){return s.jsx(uT,{children:s.jsx(lT,{children:s.jsx(vT,{})})})}class bT extends Ce.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,i){console.error("Uncaught error:",t,i),this.setState({error:t,errorInfo:i})}render(){return this.state.hasError?s.jsxs("div",{style:{padding:"2rem",color:"red"},children:[s.jsx("h1",{children:""}),s.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),s.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),s.jsx("br",{}),s.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}TS.createRoot(document.getElementById("root")).render(s.jsx(w.StrictMode,{children:s.jsx(bT,{children:s.jsx(Qj,{children:s.jsx(xT,{})})})}));export{e0 as a,wT as c,ST as g};
