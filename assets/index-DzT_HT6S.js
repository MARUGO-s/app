(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function s(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(c){if(c.ep)return;c.ep=!0;const u=s(c);fetch(c.href,u)}})();function x0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Mh={exports:{}},Ql={};var Iy;function Iw(){if(Iy)return Ql;Iy=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(l,c,u){var d=null;if(u!==void 0&&(d=""+u),c.key!==void 0&&(d=""+c.key),"key"in c){u={};for(var p in c)p!=="key"&&(u[p]=c[p])}else u=c;return c=u.ref,{$$typeof:n,type:l,key:d,ref:c!==void 0?c:null,props:u}}return Ql.Fragment=t,Ql.jsx=s,Ql.jsxs=s,Ql}var By;function Bw(){return By||(By=1,Mh.exports=Iw()),Mh.exports}var i=Bw(),zh={exports:{}},Et={};var $y;function $w(){if($y)return Et;$y=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function S(U){return U===null||typeof U!="object"?null:(U=x&&U[x]||U["@@iterator"],typeof U=="function"?U:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,j={};function N(U,W,Z){this.props=U,this.context=W,this.refs=j,this.updater=Z||C}N.prototype.isReactComponent={},N.prototype.setState=function(U,W){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,W,"setState")},N.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function A(){}A.prototype=N.prototype;function z(U,W,Z){this.props=U,this.context=W,this.refs=j,this.updater=Z||C}var B=z.prototype=new A;B.constructor=z,E(B,N.prototype),B.isPureReactComponent=!0;var L=Array.isArray;function _(){}var M={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function G(U,W,Z){var ce=Z.ref;return{$$typeof:n,type:U,key:W,ref:ce!==void 0?ce:null,props:Z}}function V(U,W){return G(U.type,W,U.props)}function Q(U){return typeof U=="object"&&U!==null&&U.$$typeof===n}function P(U){var W={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(Z){return W[Z]})}var F=/\/+/g;function q(U,W){return typeof U=="object"&&U!==null&&U.key!=null?P(""+U.key):W.toString(36)}function $(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(_,_):(U.status="pending",U.then(function(W){U.status==="pending"&&(U.status="fulfilled",U.value=W)},function(W){U.status==="pending"&&(U.status="rejected",U.reason=W)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function T(U,W,Z,ce,Oe){var Se=typeof U;(Se==="undefined"||Se==="boolean")&&(U=null);var Re=!1;if(U===null)Re=!0;else switch(Se){case"bigint":case"string":case"number":Re=!0;break;case"object":switch(U.$$typeof){case n:case t:Re=!0;break;case y:return Re=U._init,T(Re(U._payload),W,Z,ce,Oe)}}if(Re)return Oe=Oe(U),Re=ce===""?"."+q(U,0):ce,L(Oe)?(Z="",Re!=null&&(Z=Re.replace(F,"$&/")+"/"),T(Oe,W,Z,"",function(de){return de})):Oe!=null&&(Q(Oe)&&(Oe=V(Oe,Z+(Oe.key==null||U&&U.key===Oe.key?"":(""+Oe.key).replace(F,"$&/")+"/")+Re)),W.push(Oe)),1;Re=0;var O=ce===""?".":ce+":";if(L(U))for(var ie=0;ie<U.length;ie++)ce=U[ie],Se=O+q(ce,ie),Re+=T(ce,W,Z,Se,Oe);else if(ie=S(U),typeof ie=="function")for(U=ie.call(U),ie=0;!(ce=U.next()).done;)ce=ce.value,Se=O+q(ce,ie++),Re+=T(ce,W,Z,Se,Oe);else if(Se==="object"){if(typeof U.then=="function")return T($(U),W,Z,ce,Oe);throw W=String(U),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return Re}function I(U,W,Z){if(U==null)return U;var ce=[],Oe=0;return T(U,ce,"","",function(Se){return W.call(Z,Se,Oe++)}),ce}function Y(U){if(U._status===-1){var W=U._result;W=W(),W.then(function(Z){(U._status===0||U._status===-1)&&(U._status=1,U._result=Z)},function(Z){(U._status===0||U._status===-1)&&(U._status=2,U._result=Z)}),U._status===-1&&(U._status=0,U._result=W)}if(U._status===1)return U._result.default;throw U._result}var ae=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)},ye={map:I,forEach:function(U,W,Z){I(U,function(){W.apply(this,arguments)},Z)},count:function(U){var W=0;return I(U,function(){W++}),W},toArray:function(U){return I(U,function(W){return W})||[]},only:function(U){if(!Q(U))throw Error("React.Children.only expected to receive a single React element child.");return U}};return Et.Activity=v,Et.Children=ye,Et.Component=N,Et.Fragment=s,Et.Profiler=c,Et.PureComponent=z,Et.StrictMode=l,Et.Suspense=f,Et.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,Et.__COMPILER_RUNTIME={__proto__:null,c:function(U){return M.H.useMemoCache(U)}},Et.cache=function(U){return function(){return U.apply(null,arguments)}},Et.cacheSignal=function(){return null},Et.cloneElement=function(U,W,Z){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var ce=E({},U.props),Oe=U.key;if(W!=null)for(Se in W.key!==void 0&&(Oe=""+W.key),W)!k.call(W,Se)||Se==="key"||Se==="__self"||Se==="__source"||Se==="ref"&&W.ref===void 0||(ce[Se]=W[Se]);var Se=arguments.length-2;if(Se===1)ce.children=Z;else if(1<Se){for(var Re=Array(Se),O=0;O<Se;O++)Re[O]=arguments[O+2];ce.children=Re}return G(U.type,Oe,ce)},Et.createContext=function(U){return U={$$typeof:d,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:u,_context:U},U},Et.createElement=function(U,W,Z){var ce,Oe={},Se=null;if(W!=null)for(ce in W.key!==void 0&&(Se=""+W.key),W)k.call(W,ce)&&ce!=="key"&&ce!=="__self"&&ce!=="__source"&&(Oe[ce]=W[ce]);var Re=arguments.length-2;if(Re===1)Oe.children=Z;else if(1<Re){for(var O=Array(Re),ie=0;ie<Re;ie++)O[ie]=arguments[ie+2];Oe.children=O}if(U&&U.defaultProps)for(ce in Re=U.defaultProps,Re)Oe[ce]===void 0&&(Oe[ce]=Re[ce]);return G(U,Se,Oe)},Et.createRef=function(){return{current:null}},Et.forwardRef=function(U){return{$$typeof:p,render:U}},Et.isValidElement=Q,Et.lazy=function(U){return{$$typeof:y,_payload:{_status:-1,_result:U},_init:Y}},Et.memo=function(U,W){return{$$typeof:m,type:U,compare:W===void 0?null:W}},Et.startTransition=function(U){var W=M.T,Z={};M.T=Z;try{var ce=U(),Oe=M.S;Oe!==null&&Oe(Z,ce),typeof ce=="object"&&ce!==null&&typeof ce.then=="function"&&ce.then(_,ae)}catch(Se){ae(Se)}finally{W!==null&&Z.types!==null&&(W.types=Z.types),M.T=W}},Et.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},Et.use=function(U){return M.H.use(U)},Et.useActionState=function(U,W,Z){return M.H.useActionState(U,W,Z)},Et.useCallback=function(U,W){return M.H.useCallback(U,W)},Et.useContext=function(U){return M.H.useContext(U)},Et.useDebugValue=function(){},Et.useDeferredValue=function(U,W){return M.H.useDeferredValue(U,W)},Et.useEffect=function(U,W){return M.H.useEffect(U,W)},Et.useEffectEvent=function(U){return M.H.useEffectEvent(U)},Et.useId=function(){return M.H.useId()},Et.useImperativeHandle=function(U,W,Z){return M.H.useImperativeHandle(U,W,Z)},Et.useInsertionEffect=function(U,W){return M.H.useInsertionEffect(U,W)},Et.useLayoutEffect=function(U,W){return M.H.useLayoutEffect(U,W)},Et.useMemo=function(U,W){return M.H.useMemo(U,W)},Et.useOptimistic=function(U,W){return M.H.useOptimistic(U,W)},Et.useReducer=function(U,W,Z){return M.H.useReducer(U,W,Z)},Et.useRef=function(U){return M.H.useRef(U)},Et.useState=function(U){return M.H.useState(U)},Et.useSyncExternalStore=function(U,W,Z){return M.H.useSyncExternalStore(U,W,Z)},Et.useTransition=function(){return M.H.useTransition()},Et.version="19.2.3",Et}var qy;function So(){return qy||(qy=1,zh.exports=$w()),zh.exports}var b=So();const Ue=x0(b);var Uh={exports:{}},Wl={},Lh={exports:{}},Ih={};var Py;function qw(){return Py||(Py=1,(function(n){function t(T,I){var Y=T.length;T.push(I);e:for(;0<Y;){var ae=Y-1>>>1,ye=T[ae];if(0<c(ye,I))T[ae]=I,T[Y]=ye,Y=ae;else break e}}function s(T){return T.length===0?null:T[0]}function l(T){if(T.length===0)return null;var I=T[0],Y=T.pop();if(Y!==I){T[0]=Y;e:for(var ae=0,ye=T.length,U=ye>>>1;ae<U;){var W=2*(ae+1)-1,Z=T[W],ce=W+1,Oe=T[ce];if(0>c(Z,Y))ce<ye&&0>c(Oe,Z)?(T[ae]=Oe,T[ce]=Y,ae=ce):(T[ae]=Z,T[W]=Y,ae=W);else if(ce<ye&&0>c(Oe,Y))T[ae]=Oe,T[ce]=Y,ae=ce;else break e}}return I}function c(T,I){var Y=T.sortIndex-I.sortIndex;return Y!==0?Y:T.id-I.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,p=d.now();n.unstable_now=function(){return d.now()-p}}var f=[],m=[],y=1,v=null,x=3,S=!1,C=!1,E=!1,j=!1,N=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;function B(T){for(var I=s(m);I!==null;){if(I.callback===null)l(m);else if(I.startTime<=T)l(m),I.sortIndex=I.expirationTime,t(f,I);else break;I=s(m)}}function L(T){if(E=!1,B(T),!C)if(s(f)!==null)C=!0,_||(_=!0,P());else{var I=s(m);I!==null&&$(L,I.startTime-T)}}var _=!1,M=-1,k=5,G=-1;function V(){return j?!0:!(n.unstable_now()-G<k)}function Q(){if(j=!1,_){var T=n.unstable_now();G=T;var I=!0;try{e:{C=!1,E&&(E=!1,A(M),M=-1),S=!0;var Y=x;try{t:{for(B(T),v=s(f);v!==null&&!(v.expirationTime>T&&V());){var ae=v.callback;if(typeof ae=="function"){v.callback=null,x=v.priorityLevel;var ye=ae(v.expirationTime<=T);if(T=n.unstable_now(),typeof ye=="function"){v.callback=ye,B(T),I=!0;break t}v===s(f)&&l(f),B(T)}else l(f);v=s(f)}if(v!==null)I=!0;else{var U=s(m);U!==null&&$(L,U.startTime-T),I=!1}}break e}finally{v=null,x=Y,S=!1}I=void 0}}finally{I?P():_=!1}}}var P;if(typeof z=="function")P=function(){z(Q)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,q=F.port2;F.port1.onmessage=Q,P=function(){q.postMessage(null)}}else P=function(){N(Q,0)};function $(T,I){M=N(function(){T(n.unstable_now())},I)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(T){T.callback=null},n.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<T?Math.floor(1e3/T):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(T){switch(x){case 1:case 2:case 3:var I=3;break;default:I=x}var Y=x;x=I;try{return T()}finally{x=Y}},n.unstable_requestPaint=function(){j=!0},n.unstable_runWithPriority=function(T,I){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var Y=x;x=T;try{return I()}finally{x=Y}},n.unstable_scheduleCallback=function(T,I,Y){var ae=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ae+Y:ae):Y=ae,T){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=Y+ye,T={id:y++,callback:I,priorityLevel:T,startTime:Y,expirationTime:ye,sortIndex:-1},Y>ae?(T.sortIndex=Y,t(m,T),s(f)===null&&T===s(m)&&(E?(A(M),M=-1):E=!0,$(L,Y-ae))):(T.sortIndex=ye,t(f,T),C||S||(C=!0,_||(_=!0,P()))),T},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(T){var I=x;return function(){var Y=x;x=I;try{return T.apply(this,arguments)}finally{x=Y}}}})(Ih)),Ih}var Hy;function Pw(){return Hy||(Hy=1,Lh.exports=qw()),Lh.exports}var Bh={exports:{}},rr={};var Fy;function Hw(){if(Fy)return rr;Fy=1;var n=So();function t(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var l={d:{f:s,r:function(){throw Error(t(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},c=Symbol.for("react.portal");function u(f,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:v==null?null:""+v,children:f,containerInfo:m,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return rr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,rr.createPortal=function(f,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return u(f,m,null,y)},rr.flushSync=function(f){var m=d.T,y=l.p;try{if(d.T=null,l.p=2,f)return f()}finally{d.T=m,l.p=y,l.d.f()}},rr.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,l.d.C(f,m))},rr.prefetchDNS=function(f){typeof f=="string"&&l.d.D(f)},rr.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var y=m.as,v=p(y,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,S=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?l.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:S}):y==="script"&&l.d.X(f,{crossOrigin:v,integrity:x,fetchPriority:S,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},rr.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=p(m.as,m.crossOrigin);l.d.M(f,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&l.d.M(f)},rr.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=p(y,m.crossOrigin);l.d.L(f,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},rr.preloadModule=function(f,m){if(typeof f=="string")if(m){var y=p(m.as,m.crossOrigin);l.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else l.d.m(f)},rr.requestFormReset=function(f){l.d.r(f)},rr.unstable_batchedUpdates=function(f,m){return f(m)},rr.useFormState=function(f,m,y){return d.H.useFormState(f,m,y)},rr.useFormStatus=function(){return d.H.useHostTransitionStatus()},rr.version="19.2.3",rr}var Gy;function b0(){if(Gy)return Bh.exports;Gy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Bh.exports=Hw(),Bh.exports}var Vy;function Fw(){if(Vy)return Wl;Vy=1;var n=Pw(),t=So(),s=b0();function l(e){var r="https://react.dev/errors/"+e;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var r=e,a=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,(r.flags&4098)!==0&&(a=r.return),e=r.return;while(e)}return r.tag===3?a:null}function d(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function p(e){if(e.tag===31){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function f(e){if(u(e)!==e)throw Error(l(188))}function m(e){var r=e.alternate;if(!r){if(r=u(e),r===null)throw Error(l(188));return r!==e?null:e}for(var a=e,o=r;;){var h=a.return;if(h===null)break;var g=h.alternate;if(g===null){if(o=h.return,o!==null){a=o;continue}break}if(h.child===g.child){for(g=h.child;g;){if(g===a)return f(h),e;if(g===o)return f(h),r;g=g.sibling}throw Error(l(188))}if(a.return!==o.return)a=h,o=g;else{for(var w=!1,R=h.child;R;){if(R===a){w=!0,a=h,o=g;break}if(R===o){w=!0,o=h,a=g;break}R=R.sibling}if(!w){for(R=g.child;R;){if(R===a){w=!0,a=g,o=h;break}if(R===o){w=!0,o=g,a=h;break}R=R.sibling}if(!w)throw Error(l(189))}}if(a.alternate!==o)throw Error(l(190))}if(a.tag!==3)throw Error(l(188));return a.stateNode.current===a?e:r}function y(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e;for(e=e.child;e!==null;){if(r=y(e),r!==null)return r;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),z=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),Q=Symbol.iterator;function P(e){return e===null||typeof e!="object"?null:(e=Q&&e[Q]||e["@@iterator"],typeof e=="function"?e:null)}var F=Symbol.for("react.client.reference");function q(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===F?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case E:return"Fragment";case N:return"Profiler";case j:return"StrictMode";case L:return"Suspense";case _:return"SuspenseList";case G:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case C:return"Portal";case z:return e.displayName||"Context";case A:return(e._context.displayName||"Context")+".Consumer";case B:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case M:return r=e.displayName||null,r!==null?r:q(e.type)||"Memo";case k:r=e._payload,e=e._init;try{return q(e(r))}catch{}}return null}var $=Array.isArray,T=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},ae=[],ye=-1;function U(e){return{current:e}}function W(e){0>ye||(e.current=ae[ye],ae[ye]=null,ye--)}function Z(e,r){ye++,ae[ye]=e.current,e.current=r}var ce=U(null),Oe=U(null),Se=U(null),Re=U(null);function O(e,r){switch(Z(Se,r),Z(Oe,e),Z(ce,null),r.nodeType){case 9:case 11:e=(e=r.documentElement)&&(e=e.namespaceURI)?ly(e):0;break;default:if(e=r.tagName,r=r.namespaceURI)r=ly(r),e=oy(r,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(ce),Z(ce,e)}function ie(){W(ce),W(Oe),W(Se)}function de(e){e.memoizedState!==null&&Z(Re,e);var r=ce.current,a=oy(r,e.type);r!==a&&(Z(Oe,e),Z(ce,a))}function Me(e){Oe.current===e&&(W(ce),W(Oe)),Re.current===e&&(W(Re),Gl._currentValue=Y)}var Le,Ke;function $e(e){if(Le===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);Le=r&&r[1]||"",Ke=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Le+e+Ke}var We=!1;function me(e,r){if(!e||We)return"";We=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(r){var Ne=function(){throw Error()};if(Object.defineProperty(Ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ne,[])}catch(ge){var he=ge}Reflect.construct(e,[],Ne)}else{try{Ne.call()}catch(ge){he=ge}e.call(Ne.prototype)}}else{try{throw Error()}catch(ge){he=ge}(Ne=e())&&typeof Ne.catch=="function"&&Ne.catch(function(){})}}catch(ge){if(ge&&he&&typeof ge.stack=="string")return[ge.stack,he.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var h=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");h&&h.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=o.DetermineComponentFrameRoot(),w=g[0],R=g[1];if(w&&R){var K=w.split(`
`),oe=R.split(`
`);for(h=o=0;o<K.length&&!K[o].includes("DetermineComponentFrameRoot");)o++;for(;h<oe.length&&!oe[h].includes("DetermineComponentFrameRoot");)h++;if(o===K.length||h===oe.length)for(o=K.length-1,h=oe.length-1;1<=o&&0<=h&&K[o]!==oe[h];)h--;for(;1<=o&&0<=h;o--,h--)if(K[o]!==oe[h]){if(o!==1||h!==1)do if(o--,h--,0>h||K[o]!==oe[h]){var be=`
`+K[o].replace(" at new "," at ");return e.displayName&&be.includes("<anonymous>")&&(be=be.replace("<anonymous>",e.displayName)),be}while(1<=o&&0<=h);break}}}finally{We=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?$e(a):""}function Qe(e,r){switch(e.tag){case 26:case 27:case 5:return $e(e.type);case 16:return $e("Lazy");case 13:return e.child!==r&&r!==null?$e("Suspense Fallback"):$e("Suspense");case 19:return $e("SuspenseList");case 0:case 15:return me(e.type,!1);case 11:return me(e.type.render,!1);case 1:return me(e.type,!0);case 31:return $e("Activity");default:return""}}function ot(e){try{var r="",a=null;do r+=Qe(e,a),a=e,e=e.return;while(e);return r}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}var ct=Object.prototype.hasOwnProperty,mt=n.unstable_scheduleCallback,ht=n.unstable_cancelCallback,zt=n.unstable_shouldYield,Gt=n.unstable_requestPaint,vt=n.unstable_now,ne=n.unstable_getCurrentPriorityLevel,we=n.unstable_ImmediatePriority,Ee=n.unstable_UserBlockingPriority,Te=n.unstable_NormalPriority,tt=n.unstable_LowPriority,_t=n.unstable_IdlePriority,Tt=n.log,en=n.unstable_setDisableYieldValue,jn=null,bt=null;function tn(e){if(typeof Tt=="function"&&en(e),bt&&typeof bt.setStrictMode=="function")try{bt.setStrictMode(jn,e)}catch{}}var ln=Math.clz32?Math.clz32:Vn,yn=Math.log,Un=Math.LN2;function Vn(e){return e>>>=0,e===0?32:31-(yn(e)/Un|0)|0}var pe=256,He=262144,Xe=4194304;function Ve(e){var r=e&42;if(r!==0)return r;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ge(e,r,a){var o=e.pendingLanes;if(o===0)return 0;var h=0,g=e.suspendedLanes,w=e.pingedLanes;e=e.warmLanes;var R=o&134217727;return R!==0?(o=R&~g,o!==0?h=Ve(o):(w&=R,w!==0?h=Ve(w):a||(a=R&~e,a!==0&&(h=Ve(a))))):(R=o&~g,R!==0?h=Ve(R):w!==0?h=Ve(w):a||(a=o&~e,a!==0&&(h=Ve(a)))),h===0?0:r!==0&&r!==h&&(r&g)===0&&(g=h&-h,a=r&-r,g>=a||g===32&&(a&4194048)!==0)?r:h}function At(e,r){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&r)===0}function Ct(e,r){switch(e){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nt(){var e=Xe;return Xe<<=1,(Xe&62914560)===0&&(Xe=4194304),e}function Je(e){for(var r=[],a=0;31>a;a++)r.push(e);return r}function Ut(e,r){e.pendingLanes|=r,r!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Fe(e,r,a,o,h,g){var w=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var R=e.entanglements,K=e.expirationTimes,oe=e.hiddenUpdates;for(a=w&~a;0<a;){var be=31-ln(a),Ne=1<<be;R[be]=0,K[be]=-1;var he=oe[be];if(he!==null)for(oe[be]=null,be=0;be<he.length;be++){var ge=he[be];ge!==null&&(ge.lane&=-536870913)}a&=~Ne}o!==0&&Lt(e,o,0),g!==0&&h===0&&e.tag!==0&&(e.suspendedLanes|=g&~(w&~r))}function Lt(e,r,a){e.pendingLanes|=r,e.suspendedLanes&=~r;var o=31-ln(r);e.entangledLanes|=r,e.entanglements[o]=e.entanglements[o]|1073741824|a&261930}function Xt(e,r){var a=e.entangledLanes|=r;for(e=e.entanglements;a;){var o=31-ln(a),h=1<<o;h&r|e[o]&r&&(e[o]|=r),a&=~h}}function Kt(e,r){var a=r&-r;return a=(a&42)!==0?1:te(a),(a&(e.suspendedLanes|r))!==0?0:a}function te(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ee(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function ue(){var e=I.p;return e!==0?e:(e=window.event,e===void 0?32:Ay(e.type))}function je(e,r){var a=I.p;try{return I.p=e,r()}finally{I.p=a}}var Ie=Math.random().toString(36).slice(2),H="__reactFiber$"+Ie,xe="__reactProps$"+Ie,_e="__reactContainer$"+Ie,et="__reactEvents$"+Ie,wt="__reactListeners$"+Ie,Qt="__reactHandles$"+Ie,ze="__reactResources$"+Ie,xt="__reactMarker$"+Ie;function Ft(e){delete e[H],delete e[xe],delete e[et],delete e[wt],delete e[Qt]}function Rn(e){var r=e[H];if(r)return r;for(var a=e.parentNode;a;){if(r=a[_e]||a[H]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(e=my(e);e!==null;){if(a=e[H])return a;e=my(e)}return r}e=a,a=e.parentNode}return null}function St(e){if(e=e[H]||e[_e]){var r=e.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return e}return null}function on(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e.stateNode;throw Error(l(33))}function Yn(e){var r=e[ze];return r||(r=e[ze]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function qt(e){e[xt]=!0}var Ms=new Set,ar={};function yr(e,r){qr(e,r),qr(e+"Capture",r)}function qr(e,r){for(ar[e]=r,e=0;e<r.length;e++)Ms.add(r[e])}var Yi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),as={},nl={};function rl(e){return ct.call(nl,e)?!0:ct.call(as,e)?!1:Yi.test(e)?nl[e]=!0:(as[e]=!0,!1)}function Ki(e,r,a){if(rl(r))if(a===null)e.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(r);return;case"boolean":var o=r.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(r);return}}e.setAttribute(r,""+a)}}function zs(e,r,a){if(a===null)e.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttribute(r,""+a)}}function cr(e,r,a,o){if(o===null)e.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(r,a,""+o)}}function Kn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function sl(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Uu(e,r,a){var o=Object.getOwnPropertyDescriptor(e.constructor.prototype,r);if(!e.hasOwnProperty(r)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var h=o.get,g=o.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return h.call(this)},set:function(w){a=""+w,g.call(this,w)}}),Object.defineProperty(e,r,{enumerable:o.enumerable}),{getValue:function(){return a},setValue:function(w){a=""+w},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function il(e){if(!e._valueTracker){var r=sl(e)?"checked":"value";e._valueTracker=Uu(e,r,""+e[r])}}function Mo(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var a=r.getValue(),o="";return e&&(o=sl(e)?e.checked?"true":"false":e.value),e=o,e!==a?(r.setValue(e),!0):!1}function Qi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var al=/[\n"\\]/g;function ur(e){return e.replace(al,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function ll(e,r,a,o,h,g,w,R){e.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?e.type=w:e.removeAttribute("type"),r!=null?w==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+Kn(r)):e.value!==""+Kn(r)&&(e.value=""+Kn(r)):w!=="submit"&&w!=="reset"||e.removeAttribute("value"),r!=null?ol(e,w,Kn(r)):a!=null?ol(e,w,Kn(a)):o!=null&&e.removeAttribute("value"),h==null&&g!=null&&(e.defaultChecked=!!g),h!=null&&(e.checked=h&&typeof h!="function"&&typeof h!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?e.name=""+Kn(R):e.removeAttribute("name")}function Us(e,r,a,o,h,g,w,R){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),r!=null||a!=null){if(!(g!=="submit"&&g!=="reset"||r!=null)){il(e);return}a=a!=null?""+Kn(a):"",r=r!=null?""+Kn(r):a,R||r===e.value||(e.value=r),e.defaultValue=r}o=o??h,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=R?e.checked:!!o,e.defaultChecked=!!o,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(e.name=w),il(e)}function ol(e,r,a){r==="number"&&Qi(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function Ls(e,r,a,o){if(e=e.options,r){r={};for(var h=0;h<a.length;h++)r["$"+a[h]]=!0;for(a=0;a<e.length;a++)h=r.hasOwnProperty("$"+e[a].value),e[a].selected!==h&&(e[a].selected=h),h&&o&&(e[a].defaultSelected=!0)}else{for(a=""+Kn(a),r=null,h=0;h<e.length;h++){if(e[h].value===a){e[h].selected=!0,o&&(e[h].defaultSelected=!0);return}r!==null||e[h].disabled||(r=e[h])}r!==null&&(r.selected=!0)}}function zo(e,r,a){if(r!=null&&(r=""+Kn(r),r!==e.value&&(e.value=r),a==null)){e.defaultValue!==r&&(e.defaultValue=r);return}e.defaultValue=a!=null?""+Kn(a):""}function Uo(e,r,a,o){if(r==null){if(o!=null){if(a!=null)throw Error(l(92));if($(o)){if(1<o.length)throw Error(l(93));o=o[0]}a=o}a==null&&(a=""),r=a}a=Kn(r),e.defaultValue=a,o=e.textContent,o===a&&o!==""&&o!==null&&(e.value=o),il(e)}function ls(e,r){if(r){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=r;return}}e.textContent=r}var Lo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Io(e,r,a){var o=r.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?o?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="":o?e.setProperty(r,a):typeof a!="number"||a===0||Lo.has(r)?r==="float"?e.cssFloat=a:e[r]=(""+a).trim():e[r]=a+"px"}function Bo(e,r,a){if(r!=null&&typeof r!="object")throw Error(l(62));if(e=e.style,a!=null){for(var o in a)!a.hasOwnProperty(o)||r!=null&&r.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var h in r)o=r[h],r.hasOwnProperty(h)&&a[h]!==o&&Io(e,h,o)}else for(var g in r)r.hasOwnProperty(g)&&Io(e,g,r[g])}function Wi(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$o=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xi(e){return $o.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Pr(){}var cl=null;function ul(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Is=null,Bs=null;function mi(e){var r=St(e);if(r&&(e=r.stateNode)){var a=e[xe]||null;e:switch(e=r.stateNode,r.type){case"input":if(ll(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),r=a.name,a.type==="radio"&&r!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ur(""+r)+'"][type="radio"]'),r=0;r<a.length;r++){var o=a[r];if(o!==e&&o.form===e.form){var h=o[xe]||null;if(!h)throw Error(l(90));ll(o,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name)}}for(r=0;r<a.length;r++)o=a[r],o.form===e.form&&Mo(o)}break e;case"textarea":zo(e,a.value,a.defaultValue);break e;case"select":r=a.value,r!=null&&Ls(e,!!a.multiple,r,!1)}}}var Ji=!1;function D(e,r,a){if(Ji)return e(r,a);Ji=!0;try{var o=e(r);return o}finally{if(Ji=!1,(Is!==null||Bs!==null)&&(Sc(),Is&&(r=Is,e=Bs,Bs=Is=null,mi(r),e)))for(r=0;r<e.length;r++)mi(e[r])}}function X(e,r){var a=e.stateNode;if(a===null)return null;var o=a[xe]||null;if(o===null)return null;a=o[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(l(231,r,typeof a));return a}var se=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ve=!1;if(se)try{var ke={};Object.defineProperty(ke,"passive",{get:function(){ve=!0}}),window.addEventListener("test",ke,ke),window.removeEventListener("test",ke,ke)}catch{ve=!1}var Ae=null,Be=null,Pe=null;function Ye(){if(Pe)return Pe;var e,r=Be,a=r.length,o,h="value"in Ae?Ae.value:Ae.textContent,g=h.length;for(e=0;e<a&&r[e]===h[e];e++);var w=a-e;for(o=1;o<=w&&r[a-o]===h[g-o];o++);return Pe=h.slice(e,1<o?1-o:void 0)}function nt(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function lt(){return!0}function dt(){return!1}function qe(e){function r(a,o,h,g,w){this._reactName=a,this._targetInst=h,this.type=o,this.nativeEvent=g,this.target=w,this.currentTarget=null;for(var R in e)e.hasOwnProperty(R)&&(a=e[R],this[R]=a?a(g):g[R]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?lt:dt,this.isPropagationStopped=dt,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=lt)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=lt)},persist:function(){},isPersistent:lt}),r}var ft={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fn=qe(ft),cn=v({},ft,{view:0,detail:0}),$s=qe(cn),Jr,rt,it,jt=v({},cn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==it&&(it&&e.type==="mousemove"?(Jr=e.screenX-it.screenX,rt=e.screenY-it.screenY):rt=Jr=0,it=e),Jr)},movementY:function(e){return"movementY"in e?e.movementY:rt}}),un=qe(jt),_n=v({},jt,{dataTransfer:0}),Tn=qe(_n),It=v({},cn,{relatedTarget:0}),nr=qe(It),kn=v({},ft,{animationName:0,elapsedTime:0,pseudoElement:0}),os=qe(kn),Zr=v({},ft,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),qs=qe(Zr),dl=v({},ft,{data:0}),Iu=qe(dl),cs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Zi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Kx(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=gi[e])?!!r[e]:!1}function Bu(){return Kx}var Qx=v({},cn,{key:function(e){if(e.key){var r=cs[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=nt(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Zi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bu,charCode:function(e){return e.type==="keypress"?nt(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?nt(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Wx=qe(Qx),Xx=v({},jt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hp=qe(Xx),Jx=v({},cn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bu}),Zx=qe(Jx),eb=v({},ft,{propertyName:0,elapsedTime:0,pseudoElement:0}),tb=qe(eb),nb=v({},jt,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),rb=qe(nb),sb=v({},ft,{newState:0,oldState:0}),ib=qe(sb),ab=[9,13,27,32],$u=se&&"CompositionEvent"in window,hl=null;se&&"documentMode"in document&&(hl=document.documentMode);var lb=se&&"TextEvent"in window&&!hl,fp=se&&(!$u||hl&&8<hl&&11>=hl),pp=" ",mp=!1;function gp(e,r){switch(e){case"keyup":return ab.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ea=!1;function ob(e,r){switch(e){case"compositionend":return yp(r);case"keypress":return r.which!==32?null:(mp=!0,pp);case"textInput":return e=r.data,e===pp&&mp?null:e;default:return null}}function cb(e,r){if(ea)return e==="compositionend"||!$u&&gp(e,r)?(e=Ye(),Pe=Be=Ae=null,ea=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return fp&&r.locale!=="ko"?null:r.data;default:return null}}var ub={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vp(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!ub[e.type]:r==="textarea"}function xp(e,r,a,o){Is?Bs?Bs.push(o):Bs=[o]:Is=o,r=Tc(r,"onChange"),0<r.length&&(a=new fn("onChange","change",null,a,o),e.push({event:a,listeners:r}))}var fl=null,pl=null;function db(e){ty(e,0)}function qo(e){var r=on(e);if(Mo(r))return e}function bp(e,r){if(e==="change")return r}var wp=!1;if(se){var qu;if(se){var Pu="oninput"in document;if(!Pu){var Sp=document.createElement("div");Sp.setAttribute("oninput","return;"),Pu=typeof Sp.oninput=="function"}qu=Pu}else qu=!1;wp=qu&&(!document.documentMode||9<document.documentMode)}function jp(){fl&&(fl.detachEvent("onpropertychange",_p),pl=fl=null)}function _p(e){if(e.propertyName==="value"&&qo(pl)){var r=[];xp(r,pl,e,ul(e)),D(db,r)}}function hb(e,r,a){e==="focusin"?(jp(),fl=r,pl=a,fl.attachEvent("onpropertychange",_p)):e==="focusout"&&jp()}function fb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return qo(pl)}function pb(e,r){if(e==="click")return qo(r)}function mb(e,r){if(e==="input"||e==="change")return qo(r)}function gb(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var vr=typeof Object.is=="function"?Object.is:gb;function ml(e,r){if(vr(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var a=Object.keys(e),o=Object.keys(r);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var h=a[o];if(!ct.call(r,h)||!vr(e[h],r[h]))return!1}return!0}function Cp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ep(e,r){var a=Cp(e);e=0;for(var o;a;){if(a.nodeType===3){if(o=e+a.textContent.length,e<=r&&o>=r)return{node:a,offset:r-e};e=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Cp(a)}}function Np(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?Np(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function Rp(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var r=Qi(e.document);r instanceof e.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)e=r.contentWindow;else break;r=Qi(e.document)}return r}function Hu(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}var yb=se&&"documentMode"in document&&11>=document.documentMode,ta=null,Fu=null,gl=null,Gu=!1;function Tp(e,r,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Gu||ta==null||ta!==Qi(o)||(o=ta,"selectionStart"in o&&Hu(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),gl&&ml(gl,o)||(gl=o,o=Tc(Fu,"onSelect"),0<o.length&&(r=new fn("onSelect","select",null,r,a),e.push({event:r,listeners:o}),r.target=ta)))}function yi(e,r){var a={};return a[e.toLowerCase()]=r.toLowerCase(),a["Webkit"+e]="webkit"+r,a["Moz"+e]="moz"+r,a}var na={animationend:yi("Animation","AnimationEnd"),animationiteration:yi("Animation","AnimationIteration"),animationstart:yi("Animation","AnimationStart"),transitionrun:yi("Transition","TransitionRun"),transitionstart:yi("Transition","TransitionStart"),transitioncancel:yi("Transition","TransitionCancel"),transitionend:yi("Transition","TransitionEnd")},Vu={},kp={};se&&(kp=document.createElement("div").style,"AnimationEvent"in window||(delete na.animationend.animation,delete na.animationiteration.animation,delete na.animationstart.animation),"TransitionEvent"in window||delete na.transitionend.transition);function vi(e){if(Vu[e])return Vu[e];if(!na[e])return e;var r=na[e],a;for(a in r)if(r.hasOwnProperty(a)&&a in kp)return Vu[e]=r[a];return e}var Ap=vi("animationend"),Op=vi("animationiteration"),Dp=vi("animationstart"),vb=vi("transitionrun"),xb=vi("transitionstart"),bb=vi("transitioncancel"),Mp=vi("transitionend"),zp=new Map,Yu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yu.push("scrollEnd");function Hr(e,r){zp.set(e,r),yr(r,[e])}var Po=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Tr=[],ra=0,Ku=0;function Ho(){for(var e=ra,r=Ku=ra=0;r<e;){var a=Tr[r];Tr[r++]=null;var o=Tr[r];Tr[r++]=null;var h=Tr[r];Tr[r++]=null;var g=Tr[r];if(Tr[r++]=null,o!==null&&h!==null){var w=o.pending;w===null?h.next=h:(h.next=w.next,w.next=h),o.pending=h}g!==0&&Up(a,h,g)}}function Fo(e,r,a,o){Tr[ra++]=e,Tr[ra++]=r,Tr[ra++]=a,Tr[ra++]=o,Ku|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function Qu(e,r,a,o){return Fo(e,r,a,o),Go(e)}function xi(e,r){return Fo(e,null,null,r),Go(e)}function Up(e,r,a){e.lanes|=a;var o=e.alternate;o!==null&&(o.lanes|=a);for(var h=!1,g=e.return;g!==null;)g.childLanes|=a,o=g.alternate,o!==null&&(o.childLanes|=a),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(h=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,h&&r!==null&&(h=31-ln(a),e=g.hiddenUpdates,o=e[h],o===null?e[h]=[r]:o.push(r),r.lane=a|536870912),g):null}function Go(e){if(50<Il)throw Il=0,sh=null,Error(l(185));for(var r=e.return;r!==null;)e=r,r=e.return;return e.tag===3?e.stateNode:null}var sa={};function wb(e,r,a,o){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(e,r,a,o){return new wb(e,r,a,o)}function Wu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function us(e,r){var a=e.alternate;return a===null?(a=xr(e.tag,r,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=r,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,r=e.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Lp(e,r){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=r,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,r=a.dependencies,e.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e}function Vo(e,r,a,o,h,g){var w=0;if(o=e,typeof e=="function")Wu(e)&&(w=1);else if(typeof e=="string")w=Ew(e,a,ce.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case G:return e=xr(31,a,r,h),e.elementType=G,e.lanes=g,e;case E:return bi(a.children,h,g,r);case j:w=8,h|=24;break;case N:return e=xr(12,a,r,h|2),e.elementType=N,e.lanes=g,e;case L:return e=xr(13,a,r,h),e.elementType=L,e.lanes=g,e;case _:return e=xr(19,a,r,h),e.elementType=_,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case z:w=10;break e;case A:w=9;break e;case B:w=11;break e;case M:w=14;break e;case k:w=16,o=null;break e}w=29,a=Error(l(130,e===null?"null":typeof e,"")),o=null}return r=xr(w,a,r,h),r.elementType=e,r.type=o,r.lanes=g,r}function bi(e,r,a,o){return e=xr(7,e,o,r),e.lanes=a,e}function Xu(e,r,a){return e=xr(6,e,null,r),e.lanes=a,e}function Ip(e){var r=xr(18,null,null,0);return r.stateNode=e,r}function Ju(e,r,a){return r=xr(4,e.children!==null?e.children:[],e.key,r),r.lanes=a,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}var Bp=new WeakMap;function kr(e,r){if(typeof e=="object"&&e!==null){var a=Bp.get(e);return a!==void 0?a:(r={value:e,source:r,stack:ot(r)},Bp.set(e,r),r)}return{value:e,source:r,stack:ot(r)}}var ia=[],aa=0,Yo=null,yl=0,Ar=[],Or=0,Ps=null,es=1,ts="";function ds(e,r){ia[aa++]=yl,ia[aa++]=Yo,Yo=e,yl=r}function $p(e,r,a){Ar[Or++]=es,Ar[Or++]=ts,Ar[Or++]=Ps,Ps=e;var o=es;e=ts;var h=32-ln(o)-1;o&=~(1<<h),a+=1;var g=32-ln(r)+h;if(30<g){var w=h-h%5;g=(o&(1<<w)-1).toString(32),o>>=w,h-=w,es=1<<32-ln(r)+h|a<<h|o,ts=g+e}else es=1<<g|a<<h|o,ts=e}function Zu(e){e.return!==null&&(ds(e,1),$p(e,1,0))}function ed(e){for(;e===Yo;)Yo=ia[--aa],ia[aa]=null,yl=ia[--aa],ia[aa]=null;for(;e===Ps;)Ps=Ar[--Or],Ar[Or]=null,ts=Ar[--Or],Ar[Or]=null,es=Ar[--Or],Ar[Or]=null}function qp(e,r){Ar[Or++]=es,Ar[Or++]=ts,Ar[Or++]=Ps,es=r.id,ts=r.overflow,Ps=e}var Qn=null,pn=null,Pt=!1,Hs=null,Dr=!1,td=Error(l(519));function Fs(e){var r=Error(l(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw vl(kr(r,e)),td}function Pp(e){var r=e.stateNode,a=e.type,o=e.memoizedProps;switch(r[H]=e,r[xe]=o,a){case"dialog":Dt("cancel",r),Dt("close",r);break;case"iframe":case"object":case"embed":Dt("load",r);break;case"video":case"audio":for(a=0;a<$l.length;a++)Dt($l[a],r);break;case"source":Dt("error",r);break;case"img":case"image":case"link":Dt("error",r),Dt("load",r);break;case"details":Dt("toggle",r);break;case"input":Dt("invalid",r),Us(r,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0);break;case"select":Dt("invalid",r);break;case"textarea":Dt("invalid",r),Uo(r,o.value,o.defaultValue,o.children)}a=o.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||r.textContent===""+a||o.suppressHydrationWarning===!0||iy(r.textContent,a)?(o.popover!=null&&(Dt("beforetoggle",r),Dt("toggle",r)),o.onScroll!=null&&Dt("scroll",r),o.onScrollEnd!=null&&Dt("scrollend",r),o.onClick!=null&&(r.onclick=Pr),r=!0):r=!1,r||Fs(e,!0)}function Hp(e){for(Qn=e.return;Qn;)switch(Qn.tag){case 5:case 31:case 13:Dr=!1;return;case 27:case 3:Dr=!0;return;default:Qn=Qn.return}}function la(e){if(e!==Qn)return!1;if(!Pt)return Hp(e),Pt=!0,!1;var r=e.tag,a;if((a=r!==3&&r!==27)&&((a=r===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||xh(e.type,e.memoizedProps)),a=!a),a&&pn&&Fs(e),Hp(e),r===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));pn=py(e)}else if(r===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));pn=py(e)}else r===27?(r=pn,si(e.type)?(e=_h,_h=null,pn=e):pn=r):pn=Qn?zr(e.stateNode.nextSibling):null;return!0}function wi(){pn=Qn=null,Pt=!1}function nd(){var e=Hs;return e!==null&&(pr===null?pr=e:pr.push.apply(pr,e),Hs=null),e}function vl(e){Hs===null?Hs=[e]:Hs.push(e)}var rd=U(null),Si=null,hs=null;function Gs(e,r,a){Z(rd,r._currentValue),r._currentValue=a}function fs(e){e._currentValue=rd.current,W(rd)}function sd(e,r,a){for(;e!==null;){var o=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,o!==null&&(o.childLanes|=r)):o!==null&&(o.childLanes&r)!==r&&(o.childLanes|=r),e===a)break;e=e.return}}function id(e,r,a,o){var h=e.child;for(h!==null&&(h.return=e);h!==null;){var g=h.dependencies;if(g!==null){var w=h.child;g=g.firstContext;e:for(;g!==null;){var R=g;g=h;for(var K=0;K<r.length;K++)if(R.context===r[K]){g.lanes|=a,R=g.alternate,R!==null&&(R.lanes|=a),sd(g.return,a,e),o||(w=null);break e}g=R.next}}else if(h.tag===18){if(w=h.return,w===null)throw Error(l(341));w.lanes|=a,g=w.alternate,g!==null&&(g.lanes|=a),sd(w,a,e),w=null}else w=h.child;if(w!==null)w.return=h;else for(w=h;w!==null;){if(w===e){w=null;break}if(h=w.sibling,h!==null){h.return=w.return,w=h;break}w=w.return}h=w}}function oa(e,r,a,o){e=null;for(var h=r,g=!1;h!==null;){if(!g){if((h.flags&524288)!==0)g=!0;else if((h.flags&262144)!==0)break}if(h.tag===10){var w=h.alternate;if(w===null)throw Error(l(387));if(w=w.memoizedProps,w!==null){var R=h.type;vr(h.pendingProps.value,w.value)||(e!==null?e.push(R):e=[R])}}else if(h===Re.current){if(w=h.alternate,w===null)throw Error(l(387));w.memoizedState.memoizedState!==h.memoizedState.memoizedState&&(e!==null?e.push(Gl):e=[Gl])}h=h.return}e!==null&&id(r,e,a,o),r.flags|=262144}function Ko(e){for(e=e.firstContext;e!==null;){if(!vr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ji(e){Si=e,hs=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Wn(e){return Fp(Si,e)}function Qo(e,r){return Si===null&&ji(e),Fp(e,r)}function Fp(e,r){var a=r._currentValue;if(r={context:r,memoizedValue:a,next:null},hs===null){if(e===null)throw Error(l(308));hs=r,e.dependencies={lanes:0,firstContext:r},e.flags|=524288}else hs=hs.next=r;return a}var Sb=typeof AbortController<"u"?AbortController:function(){var e=[],r=this.signal={aborted:!1,addEventListener:function(a,o){e.push(o)}};this.abort=function(){r.aborted=!0,e.forEach(function(a){return a()})}},jb=n.unstable_scheduleCallback,_b=n.unstable_NormalPriority,An={$$typeof:z,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ad(){return{controller:new Sb,data:new Map,refCount:0}}function xl(e){e.refCount--,e.refCount===0&&jb(_b,function(){e.controller.abort()})}var bl=null,ld=0,ca=0,ua=null;function Cb(e,r){if(bl===null){var a=bl=[];ld=0,ca=uh(),ua={status:"pending",value:void 0,then:function(o){a.push(o)}}}return ld++,r.then(Gp,Gp),r}function Gp(){if(--ld===0&&bl!==null){ua!==null&&(ua.status="fulfilled");var e=bl;bl=null,ca=0,ua=null;for(var r=0;r<e.length;r++)(0,e[r])()}}function Eb(e,r){var a=[],o={status:"pending",value:null,reason:null,then:function(h){a.push(h)}};return e.then(function(){o.status="fulfilled",o.value=r;for(var h=0;h<a.length;h++)(0,a[h])(r)},function(h){for(o.status="rejected",o.reason=h,h=0;h<a.length;h++)(0,a[h])(void 0)}),o}var Vp=T.S;T.S=function(e,r){Tg=vt(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&Cb(e,r),Vp!==null&&Vp(e,r)};var _i=U(null);function od(){var e=_i.current;return e!==null?e:an.pooledCache}function Wo(e,r){r===null?Z(_i,_i.current):Z(_i,r.pool)}function Yp(){var e=od();return e===null?null:{parent:An._currentValue,pool:e}}var da=Error(l(460)),cd=Error(l(474)),Xo=Error(l(542)),Jo={then:function(){}};function Kp(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Qp(e,r,a){switch(a=e[a],a===void 0?e.push(r):a!==r&&(r.then(Pr,Pr),r=a),r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,Xp(e),e;default:if(typeof r.status=="string")r.then(Pr,Pr);else{if(e=an,e!==null&&100<e.shellSuspendCounter)throw Error(l(482));e=r,e.status="pending",e.then(function(o){if(r.status==="pending"){var h=r;h.status="fulfilled",h.value=o}},function(o){if(r.status==="pending"){var h=r;h.status="rejected",h.reason=o}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,Xp(e),e}throw Ei=r,da}}function Ci(e){try{var r=e._init;return r(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(Ei=a,da):a}}var Ei=null;function Wp(){if(Ei===null)throw Error(l(459));var e=Ei;return Ei=null,e}function Xp(e){if(e===da||e===Xo)throw Error(l(483))}var ha=null,wl=0;function Zo(e){var r=wl;return wl+=1,ha===null&&(ha=[]),Qp(ha,e,r)}function Sl(e,r){r=r.props.ref,e.ref=r!==void 0?r:null}function ec(e,r){throw r.$$typeof===x?Error(l(525)):(e=Object.prototype.toString.call(r),Error(l(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)))}function Jp(e){function r(re,J){if(e){var le=re.deletions;le===null?(re.deletions=[J],re.flags|=16):le.push(J)}}function a(re,J){if(!e)return null;for(;J!==null;)r(re,J),J=J.sibling;return null}function o(re){for(var J=new Map;re!==null;)re.key!==null?J.set(re.key,re):J.set(re.index,re),re=re.sibling;return J}function h(re,J){return re=us(re,J),re.index=0,re.sibling=null,re}function g(re,J,le){return re.index=le,e?(le=re.alternate,le!==null?(le=le.index,le<J?(re.flags|=67108866,J):le):(re.flags|=67108866,J)):(re.flags|=1048576,J)}function w(re){return e&&re.alternate===null&&(re.flags|=67108866),re}function R(re,J,le,Ce){return J===null||J.tag!==6?(J=Xu(le,re.mode,Ce),J.return=re,J):(J=h(J,le),J.return=re,J)}function K(re,J,le,Ce){var ut=le.type;return ut===E?be(re,J,le.props.children,Ce,le.key):J!==null&&(J.elementType===ut||typeof ut=="object"&&ut!==null&&ut.$$typeof===k&&Ci(ut)===J.type)?(J=h(J,le.props),Sl(J,le),J.return=re,J):(J=Vo(le.type,le.key,le.props,null,re.mode,Ce),Sl(J,le),J.return=re,J)}function oe(re,J,le,Ce){return J===null||J.tag!==4||J.stateNode.containerInfo!==le.containerInfo||J.stateNode.implementation!==le.implementation?(J=Ju(le,re.mode,Ce),J.return=re,J):(J=h(J,le.children||[]),J.return=re,J)}function be(re,J,le,Ce,ut){return J===null||J.tag!==7?(J=bi(le,re.mode,Ce,ut),J.return=re,J):(J=h(J,le),J.return=re,J)}function Ne(re,J,le){if(typeof J=="string"&&J!==""||typeof J=="number"||typeof J=="bigint")return J=Xu(""+J,re.mode,le),J.return=re,J;if(typeof J=="object"&&J!==null){switch(J.$$typeof){case S:return le=Vo(J.type,J.key,J.props,null,re.mode,le),Sl(le,J),le.return=re,le;case C:return J=Ju(J,re.mode,le),J.return=re,J;case k:return J=Ci(J),Ne(re,J,le)}if($(J)||P(J))return J=bi(J,re.mode,le,null),J.return=re,J;if(typeof J.then=="function")return Ne(re,Zo(J),le);if(J.$$typeof===z)return Ne(re,Qo(re,J),le);ec(re,J)}return null}function he(re,J,le,Ce){var ut=J!==null?J.key:null;if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return ut!==null?null:R(re,J,""+le,Ce);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case S:return le.key===ut?K(re,J,le,Ce):null;case C:return le.key===ut?oe(re,J,le,Ce):null;case k:return le=Ci(le),he(re,J,le,Ce)}if($(le)||P(le))return ut!==null?null:be(re,J,le,Ce,null);if(typeof le.then=="function")return he(re,J,Zo(le),Ce);if(le.$$typeof===z)return he(re,J,Qo(re,le),Ce);ec(re,le)}return null}function ge(re,J,le,Ce,ut){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return re=re.get(le)||null,R(J,re,""+Ce,ut);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case S:return re=re.get(Ce.key===null?le:Ce.key)||null,K(J,re,Ce,ut);case C:return re=re.get(Ce.key===null?le:Ce.key)||null,oe(J,re,Ce,ut);case k:return Ce=Ci(Ce),ge(re,J,le,Ce,ut)}if($(Ce)||P(Ce))return re=re.get(le)||null,be(J,re,Ce,ut,null);if(typeof Ce.then=="function")return ge(re,J,le,Zo(Ce),ut);if(Ce.$$typeof===z)return ge(re,J,le,Qo(J,Ce),ut);ec(J,Ce)}return null}function Ze(re,J,le,Ce){for(var ut=null,Vt=null,st=J,kt=J=0,$t=null;st!==null&&kt<le.length;kt++){st.index>kt?($t=st,st=null):$t=st.sibling;var Yt=he(re,st,le[kt],Ce);if(Yt===null){st===null&&(st=$t);break}e&&st&&Yt.alternate===null&&r(re,st),J=g(Yt,J,kt),Vt===null?ut=Yt:Vt.sibling=Yt,Vt=Yt,st=$t}if(kt===le.length)return a(re,st),Pt&&ds(re,kt),ut;if(st===null){for(;kt<le.length;kt++)st=Ne(re,le[kt],Ce),st!==null&&(J=g(st,J,kt),Vt===null?ut=st:Vt.sibling=st,Vt=st);return Pt&&ds(re,kt),ut}for(st=o(st);kt<le.length;kt++)$t=ge(st,re,kt,le[kt],Ce),$t!==null&&(e&&$t.alternate!==null&&st.delete($t.key===null?kt:$t.key),J=g($t,J,kt),Vt===null?ut=$t:Vt.sibling=$t,Vt=$t);return e&&st.forEach(function(ci){return r(re,ci)}),Pt&&ds(re,kt),ut}function pt(re,J,le,Ce){if(le==null)throw Error(l(151));for(var ut=null,Vt=null,st=J,kt=J=0,$t=null,Yt=le.next();st!==null&&!Yt.done;kt++,Yt=le.next()){st.index>kt?($t=st,st=null):$t=st.sibling;var ci=he(re,st,Yt.value,Ce);if(ci===null){st===null&&(st=$t);break}e&&st&&ci.alternate===null&&r(re,st),J=g(ci,J,kt),Vt===null?ut=ci:Vt.sibling=ci,Vt=ci,st=$t}if(Yt.done)return a(re,st),Pt&&ds(re,kt),ut;if(st===null){for(;!Yt.done;kt++,Yt=le.next())Yt=Ne(re,Yt.value,Ce),Yt!==null&&(J=g(Yt,J,kt),Vt===null?ut=Yt:Vt.sibling=Yt,Vt=Yt);return Pt&&ds(re,kt),ut}for(st=o(st);!Yt.done;kt++,Yt=le.next())Yt=ge(st,re,kt,Yt.value,Ce),Yt!==null&&(e&&Yt.alternate!==null&&st.delete(Yt.key===null?kt:Yt.key),J=g(Yt,J,kt),Vt===null?ut=Yt:Vt.sibling=Yt,Vt=Yt);return e&&st.forEach(function(Lw){return r(re,Lw)}),Pt&&ds(re,kt),ut}function sn(re,J,le,Ce){if(typeof le=="object"&&le!==null&&le.type===E&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case S:e:{for(var ut=le.key;J!==null;){if(J.key===ut){if(ut=le.type,ut===E){if(J.tag===7){a(re,J.sibling),Ce=h(J,le.props.children),Ce.return=re,re=Ce;break e}}else if(J.elementType===ut||typeof ut=="object"&&ut!==null&&ut.$$typeof===k&&Ci(ut)===J.type){a(re,J.sibling),Ce=h(J,le.props),Sl(Ce,le),Ce.return=re,re=Ce;break e}a(re,J);break}else r(re,J);J=J.sibling}le.type===E?(Ce=bi(le.props.children,re.mode,Ce,le.key),Ce.return=re,re=Ce):(Ce=Vo(le.type,le.key,le.props,null,re.mode,Ce),Sl(Ce,le),Ce.return=re,re=Ce)}return w(re);case C:e:{for(ut=le.key;J!==null;){if(J.key===ut)if(J.tag===4&&J.stateNode.containerInfo===le.containerInfo&&J.stateNode.implementation===le.implementation){a(re,J.sibling),Ce=h(J,le.children||[]),Ce.return=re,re=Ce;break e}else{a(re,J);break}else r(re,J);J=J.sibling}Ce=Ju(le,re.mode,Ce),Ce.return=re,re=Ce}return w(re);case k:return le=Ci(le),sn(re,J,le,Ce)}if($(le))return Ze(re,J,le,Ce);if(P(le)){if(ut=P(le),typeof ut!="function")throw Error(l(150));return le=ut.call(le),pt(re,J,le,Ce)}if(typeof le.then=="function")return sn(re,J,Zo(le),Ce);if(le.$$typeof===z)return sn(re,J,Qo(re,le),Ce);ec(re,le)}return typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint"?(le=""+le,J!==null&&J.tag===6?(a(re,J.sibling),Ce=h(J,le),Ce.return=re,re=Ce):(a(re,J),Ce=Xu(le,re.mode,Ce),Ce.return=re,re=Ce),w(re)):a(re,J)}return function(re,J,le,Ce){try{wl=0;var ut=sn(re,J,le,Ce);return ha=null,ut}catch(st){if(st===da||st===Xo)throw st;var Vt=xr(29,st,null,re.mode);return Vt.lanes=Ce,Vt.return=re,Vt}}}var Ni=Jp(!0),Zp=Jp(!1),Vs=!1;function ud(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function dd(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ys(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ks(e,r,a){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(Wt&2)!==0){var h=o.pending;return h===null?r.next=r:(r.next=h.next,h.next=r),o.pending=r,r=Go(e),Up(e,null,a),r}return Fo(e,o,r,a),Go(e)}function jl(e,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194048)!==0)){var o=r.lanes;o&=e.pendingLanes,a|=o,r.lanes=a,Xt(e,a)}}function hd(e,r){var a=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var h=null,g=null;if(a=a.firstBaseUpdate,a!==null){do{var w={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};g===null?h=g=w:g=g.next=w,a=a.next}while(a!==null);g===null?h=g=r:g=g.next=r}else h=g=r;a={baseState:o.baseState,firstBaseUpdate:h,lastBaseUpdate:g,shared:o.shared,callbacks:o.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=r:e.next=r,a.lastBaseUpdate=r}var fd=!1;function _l(){if(fd){var e=ua;if(e!==null)throw e}}function Cl(e,r,a,o){fd=!1;var h=e.updateQueue;Vs=!1;var g=h.firstBaseUpdate,w=h.lastBaseUpdate,R=h.shared.pending;if(R!==null){h.shared.pending=null;var K=R,oe=K.next;K.next=null,w===null?g=oe:w.next=oe,w=K;var be=e.alternate;be!==null&&(be=be.updateQueue,R=be.lastBaseUpdate,R!==w&&(R===null?be.firstBaseUpdate=oe:R.next=oe,be.lastBaseUpdate=K))}if(g!==null){var Ne=h.baseState;w=0,be=oe=K=null,R=g;do{var he=R.lane&-536870913,ge=he!==R.lane;if(ge?(Bt&he)===he:(o&he)===he){he!==0&&he===ca&&(fd=!0),be!==null&&(be=be.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});e:{var Ze=e,pt=R;he=r;var sn=a;switch(pt.tag){case 1:if(Ze=pt.payload,typeof Ze=="function"){Ne=Ze.call(sn,Ne,he);break e}Ne=Ze;break e;case 3:Ze.flags=Ze.flags&-65537|128;case 0:if(Ze=pt.payload,he=typeof Ze=="function"?Ze.call(sn,Ne,he):Ze,he==null)break e;Ne=v({},Ne,he);break e;case 2:Vs=!0}}he=R.callback,he!==null&&(e.flags|=64,ge&&(e.flags|=8192),ge=h.callbacks,ge===null?h.callbacks=[he]:ge.push(he))}else ge={lane:he,tag:R.tag,payload:R.payload,callback:R.callback,next:null},be===null?(oe=be=ge,K=Ne):be=be.next=ge,w|=he;if(R=R.next,R===null){if(R=h.shared.pending,R===null)break;ge=R,R=ge.next,ge.next=null,h.lastBaseUpdate=ge,h.shared.pending=null}}while(!0);be===null&&(K=Ne),h.baseState=K,h.firstBaseUpdate=oe,h.lastBaseUpdate=be,g===null&&(h.shared.lanes=0),Zs|=w,e.lanes=w,e.memoizedState=Ne}}function em(e,r){if(typeof e!="function")throw Error(l(191,e));e.call(r)}function tm(e,r){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)em(a[e],r)}var fa=U(null),tc=U(0);function nm(e,r){e=Ss,Z(tc,e),Z(fa,r),Ss=e|r.baseLanes}function pd(){Z(tc,Ss),Z(fa,fa.current)}function md(){Ss=tc.current,W(fa),W(tc)}var br=U(null),Mr=null;function Qs(e){var r=e.alternate;Z(Cn,Cn.current&1),Z(br,e),Mr===null&&(r===null||fa.current!==null||r.memoizedState!==null)&&(Mr=e)}function gd(e){Z(Cn,Cn.current),Z(br,e),Mr===null&&(Mr=e)}function rm(e){e.tag===22?(Z(Cn,Cn.current),Z(br,e),Mr===null&&(Mr=e)):Ws()}function Ws(){Z(Cn,Cn.current),Z(br,br.current)}function wr(e){W(br),Mr===e&&(Mr=null),W(Cn)}var Cn=U(0);function nc(e){for(var r=e;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Sh(a)||jh(a)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var ps=0,Rt=null,nn=null,On=null,rc=!1,pa=!1,Ri=!1,sc=0,El=0,ma=null,Nb=0;function bn(){throw Error(l(321))}function yd(e,r){if(r===null)return!1;for(var a=0;a<r.length&&a<e.length;a++)if(!vr(e[a],r[a]))return!1;return!0}function vd(e,r,a,o,h,g){return ps=g,Rt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,T.H=e===null||e.memoizedState===null?$m:Dd,Ri=!1,g=a(o,h),Ri=!1,pa&&(g=im(r,a,o,h)),sm(e),g}function sm(e){T.H=Tl;var r=nn!==null&&nn.next!==null;if(ps=0,On=nn=Rt=null,rc=!1,El=0,ma=null,r)throw Error(l(300));e===null||Dn||(e=e.dependencies,e!==null&&Ko(e)&&(Dn=!0))}function im(e,r,a,o){Rt=e;var h=0;do{if(pa&&(ma=null),El=0,pa=!1,25<=h)throw Error(l(301));if(h+=1,On=nn=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}T.H=qm,g=r(a,o)}while(pa);return g}function Rb(){var e=T.H,r=e.useState()[0];return r=typeof r.then=="function"?Nl(r):r,e=e.useState()[0],(nn!==null?nn.memoizedState:null)!==e&&(Rt.flags|=1024),r}function xd(){var e=sc!==0;return sc=0,e}function bd(e,r,a){r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~a}function wd(e){if(rc){for(e=e.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}rc=!1}ps=0,On=nn=Rt=null,pa=!1,El=sc=0,ma=null}function lr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return On===null?Rt.memoizedState=On=e:On=On.next=e,On}function En(){if(nn===null){var e=Rt.alternate;e=e!==null?e.memoizedState:null}else e=nn.next;var r=On===null?Rt.memoizedState:On.next;if(r!==null)On=r,nn=e;else{if(e===null)throw Rt.alternate===null?Error(l(467)):Error(l(310));nn=e,e={memoizedState:nn.memoizedState,baseState:nn.baseState,baseQueue:nn.baseQueue,queue:nn.queue,next:null},On===null?Rt.memoizedState=On=e:On=On.next=e}return On}function ic(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Nl(e){var r=El;return El+=1,ma===null&&(ma=[]),e=Qp(ma,e,r),r=Rt,(On===null?r.memoizedState:On.next)===null&&(r=r.alternate,T.H=r===null||r.memoizedState===null?$m:Dd),e}function ac(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Nl(e);if(e.$$typeof===z)return Wn(e)}throw Error(l(438,String(e)))}function Sd(e){var r=null,a=Rt.updateQueue;if(a!==null&&(r=a.memoCache),r==null){var o=Rt.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(r={data:o.data.map(function(h){return h.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),a===null&&(a=ic(),Rt.updateQueue=a),a.memoCache=r,a=r.data[r.index],a===void 0)for(a=r.data[r.index]=Array(e),o=0;o<e;o++)a[o]=V;return r.index++,a}function ms(e,r){return typeof r=="function"?r(e):r}function lc(e){var r=En();return jd(r,nn,e)}function jd(e,r,a){var o=e.queue;if(o===null)throw Error(l(311));o.lastRenderedReducer=a;var h=e.baseQueue,g=o.pending;if(g!==null){if(h!==null){var w=h.next;h.next=g.next,g.next=w}r.baseQueue=h=g,o.pending=null}if(g=e.baseState,h===null)e.memoizedState=g;else{r=h.next;var R=w=null,K=null,oe=r,be=!1;do{var Ne=oe.lane&-536870913;if(Ne!==oe.lane?(Bt&Ne)===Ne:(ps&Ne)===Ne){var he=oe.revertLane;if(he===0)K!==null&&(K=K.next={lane:0,revertLane:0,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),Ne===ca&&(be=!0);else if((ps&he)===he){oe=oe.next,he===ca&&(be=!0);continue}else Ne={lane:0,revertLane:oe.revertLane,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},K===null?(R=K=Ne,w=g):K=K.next=Ne,Rt.lanes|=he,Zs|=he;Ne=oe.action,Ri&&a(g,Ne),g=oe.hasEagerState?oe.eagerState:a(g,Ne)}else he={lane:Ne,revertLane:oe.revertLane,gesture:oe.gesture,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},K===null?(R=K=he,w=g):K=K.next=he,Rt.lanes|=Ne,Zs|=Ne;oe=oe.next}while(oe!==null&&oe!==r);if(K===null?w=g:K.next=R,!vr(g,e.memoizedState)&&(Dn=!0,be&&(a=ua,a!==null)))throw a;e.memoizedState=g,e.baseState=w,e.baseQueue=K,o.lastRenderedState=g}return h===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function _d(e){var r=En(),a=r.queue;if(a===null)throw Error(l(311));a.lastRenderedReducer=e;var o=a.dispatch,h=a.pending,g=r.memoizedState;if(h!==null){a.pending=null;var w=h=h.next;do g=e(g,w.action),w=w.next;while(w!==h);vr(g,r.memoizedState)||(Dn=!0),r.memoizedState=g,r.baseQueue===null&&(r.baseState=g),a.lastRenderedState=g}return[g,o]}function am(e,r,a){var o=Rt,h=En(),g=Pt;if(g){if(a===void 0)throw Error(l(407));a=a()}else a=r();var w=!vr((nn||h).memoizedState,a);if(w&&(h.memoizedState=a,Dn=!0),h=h.queue,Nd(cm.bind(null,o,h,e),[e]),h.getSnapshot!==r||w||On!==null&&On.memoizedState.tag&1){if(o.flags|=2048,ga(9,{destroy:void 0},om.bind(null,o,h,a,r),null),an===null)throw Error(l(349));g||(ps&127)!==0||lm(o,r,a)}return a}function lm(e,r,a){e.flags|=16384,e={getSnapshot:r,value:a},r=Rt.updateQueue,r===null?(r=ic(),Rt.updateQueue=r,r.stores=[e]):(a=r.stores,a===null?r.stores=[e]:a.push(e))}function om(e,r,a,o){r.value=a,r.getSnapshot=o,um(r)&&dm(e)}function cm(e,r,a){return a(function(){um(r)&&dm(e)})}function um(e){var r=e.getSnapshot;e=e.value;try{var a=r();return!vr(e,a)}catch{return!0}}function dm(e){var r=xi(e,2);r!==null&&mr(r,e,2)}function Cd(e){var r=lr();if(typeof e=="function"){var a=e;if(e=a(),Ri){tn(!0);try{a()}finally{tn(!1)}}}return r.memoizedState=r.baseState=e,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ms,lastRenderedState:e},r}function hm(e,r,a,o){return e.baseState=a,jd(e,nn,typeof o=="function"?o:ms)}function Tb(e,r,a,o,h){if(uc(e))throw Error(l(485));if(e=r.action,e!==null){var g={payload:h,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){g.listeners.push(w)}};T.T!==null?a(!0):g.isTransition=!1,o(g),a=r.pending,a===null?(g.next=r.pending=g,fm(r,g)):(g.next=a.next,r.pending=a.next=g)}}function fm(e,r){var a=r.action,o=r.payload,h=e.state;if(r.isTransition){var g=T.T,w={};T.T=w;try{var R=a(h,o),K=T.S;K!==null&&K(w,R),pm(e,r,R)}catch(oe){Ed(e,r,oe)}finally{g!==null&&w.types!==null&&(g.types=w.types),T.T=g}}else try{g=a(h,o),pm(e,r,g)}catch(oe){Ed(e,r,oe)}}function pm(e,r,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(o){mm(e,r,o)},function(o){return Ed(e,r,o)}):mm(e,r,a)}function mm(e,r,a){r.status="fulfilled",r.value=a,gm(r),e.state=a,r=e.pending,r!==null&&(a=r.next,a===r?e.pending=null:(a=a.next,r.next=a,fm(e,a)))}function Ed(e,r,a){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do r.status="rejected",r.reason=a,gm(r),r=r.next;while(r!==o)}e.action=null}function gm(e){e=e.listeners;for(var r=0;r<e.length;r++)(0,e[r])()}function ym(e,r){return r}function vm(e,r){if(Pt){var a=an.formState;if(a!==null){e:{var o=Rt;if(Pt){if(pn){t:{for(var h=pn,g=Dr;h.nodeType!==8;){if(!g){h=null;break t}if(h=zr(h.nextSibling),h===null){h=null;break t}}g=h.data,h=g==="F!"||g==="F"?h:null}if(h){pn=zr(h.nextSibling),o=h.data==="F!";break e}}Fs(o)}o=!1}o&&(r=a[0])}}return a=lr(),a.memoizedState=a.baseState=r,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ym,lastRenderedState:r},a.queue=o,a=Lm.bind(null,Rt,o),o.dispatch=a,o=Cd(!1),g=Od.bind(null,Rt,!1,o.queue),o=lr(),h={state:r,dispatch:null,action:e,pending:null},o.queue=h,a=Tb.bind(null,Rt,h,g,a),h.dispatch=a,o.memoizedState=e,[r,a,!1]}function xm(e){var r=En();return bm(r,nn,e)}function bm(e,r,a){if(r=jd(e,r,ym)[0],e=lc(ms)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var o=Nl(r)}catch(w){throw w===da?Xo:w}else o=r;r=En();var h=r.queue,g=h.dispatch;return a!==r.memoizedState&&(Rt.flags|=2048,ga(9,{destroy:void 0},kb.bind(null,h,a),null)),[o,g,e]}function kb(e,r){e.action=r}function wm(e){var r=En(),a=nn;if(a!==null)return bm(r,a,e);En(),r=r.memoizedState,a=En();var o=a.queue.dispatch;return a.memoizedState=e,[r,o,!1]}function ga(e,r,a,o){return e={tag:e,create:a,deps:o,inst:r,next:null},r=Rt.updateQueue,r===null&&(r=ic(),Rt.updateQueue=r),a=r.lastEffect,a===null?r.lastEffect=e.next=e:(o=a.next,a.next=e,e.next=o,r.lastEffect=e),e}function Sm(){return En().memoizedState}function oc(e,r,a,o){var h=lr();Rt.flags|=e,h.memoizedState=ga(1|r,{destroy:void 0},a,o===void 0?null:o)}function cc(e,r,a,o){var h=En();o=o===void 0?null:o;var g=h.memoizedState.inst;nn!==null&&o!==null&&yd(o,nn.memoizedState.deps)?h.memoizedState=ga(r,g,a,o):(Rt.flags|=e,h.memoizedState=ga(1|r,g,a,o))}function jm(e,r){oc(8390656,8,e,r)}function Nd(e,r){cc(2048,8,e,r)}function Ab(e){Rt.flags|=4;var r=Rt.updateQueue;if(r===null)r=ic(),Rt.updateQueue=r,r.events=[e];else{var a=r.events;a===null?r.events=[e]:a.push(e)}}function _m(e){var r=En().memoizedState;return Ab({ref:r,nextImpl:e}),function(){if((Wt&2)!==0)throw Error(l(440));return r.impl.apply(void 0,arguments)}}function Cm(e,r){return cc(4,2,e,r)}function Em(e,r){return cc(4,4,e,r)}function Nm(e,r){if(typeof r=="function"){e=e();var a=r(e);return function(){typeof a=="function"?a():r(null)}}if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function Rm(e,r,a){a=a!=null?a.concat([e]):null,cc(4,4,Nm.bind(null,r,e),a)}function Rd(){}function Tm(e,r){var a=En();r=r===void 0?null:r;var o=a.memoizedState;return r!==null&&yd(r,o[1])?o[0]:(a.memoizedState=[e,r],e)}function km(e,r){var a=En();r=r===void 0?null:r;var o=a.memoizedState;if(r!==null&&yd(r,o[1]))return o[0];if(o=e(),Ri){tn(!0);try{e()}finally{tn(!1)}}return a.memoizedState=[o,r],o}function Td(e,r,a){return a===void 0||(ps&1073741824)!==0&&(Bt&261930)===0?e.memoizedState=r:(e.memoizedState=a,e=Ag(),Rt.lanes|=e,Zs|=e,a)}function Am(e,r,a,o){return vr(a,r)?a:fa.current!==null?(e=Td(e,a,o),vr(e,r)||(Dn=!0),e):(ps&42)===0||(ps&1073741824)!==0&&(Bt&261930)===0?(Dn=!0,e.memoizedState=a):(e=Ag(),Rt.lanes|=e,Zs|=e,r)}function Om(e,r,a,o,h){var g=I.p;I.p=g!==0&&8>g?g:8;var w=T.T,R={};T.T=R,Od(e,!1,r,a);try{var K=h(),oe=T.S;if(oe!==null&&oe(R,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var be=Eb(K,o);Rl(e,r,be,_r(e))}else Rl(e,r,o,_r(e))}catch(Ne){Rl(e,r,{then:function(){},status:"rejected",reason:Ne},_r())}finally{I.p=g,w!==null&&R.types!==null&&(w.types=R.types),T.T=w}}function Ob(){}function kd(e,r,a,o){if(e.tag!==5)throw Error(l(476));var h=Dm(e).queue;Om(e,h,r,Y,a===null?Ob:function(){return Mm(e),a(o)})}function Dm(e){var r=e.memoizedState;if(r!==null)return r;r={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ms,lastRenderedState:Y},next:null};var a={};return r.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ms,lastRenderedState:a},next:null},e.memoizedState=r,e=e.alternate,e!==null&&(e.memoizedState=r),r}function Mm(e){var r=Dm(e);r.next===null&&(r=e.alternate.memoizedState),Rl(e,r.next.queue,{},_r())}function Ad(){return Wn(Gl)}function zm(){return En().memoizedState}function Um(){return En().memoizedState}function Db(e){for(var r=e.return;r!==null;){switch(r.tag){case 24:case 3:var a=_r();e=Ys(a);var o=Ks(r,e,a);o!==null&&(mr(o,r,a),jl(o,r,a)),r={cache:ad()},e.payload=r;return}r=r.return}}function Mb(e,r,a){var o=_r();a={lane:o,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},uc(e)?Im(r,a):(a=Qu(e,r,a,o),a!==null&&(mr(a,e,o),Bm(a,r,o)))}function Lm(e,r,a){var o=_r();Rl(e,r,a,o)}function Rl(e,r,a,o){var h={lane:o,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(uc(e))Im(r,h);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=r.lastRenderedReducer,g!==null))try{var w=r.lastRenderedState,R=g(w,a);if(h.hasEagerState=!0,h.eagerState=R,vr(R,w))return Fo(e,r,h,0),an===null&&Ho(),!1}catch{}if(a=Qu(e,r,h,o),a!==null)return mr(a,e,o),Bm(a,r,o),!0}return!1}function Od(e,r,a,o){if(o={lane:2,revertLane:uh(),gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},uc(e)){if(r)throw Error(l(479))}else r=Qu(e,a,o,2),r!==null&&mr(r,e,2)}function uc(e){var r=e.alternate;return e===Rt||r!==null&&r===Rt}function Im(e,r){pa=rc=!0;var a=e.pending;a===null?r.next=r:(r.next=a.next,a.next=r),e.pending=r}function Bm(e,r,a){if((a&4194048)!==0){var o=r.lanes;o&=e.pendingLanes,a|=o,r.lanes=a,Xt(e,a)}}var Tl={readContext:Wn,use:ac,useCallback:bn,useContext:bn,useEffect:bn,useImperativeHandle:bn,useLayoutEffect:bn,useInsertionEffect:bn,useMemo:bn,useReducer:bn,useRef:bn,useState:bn,useDebugValue:bn,useDeferredValue:bn,useTransition:bn,useSyncExternalStore:bn,useId:bn,useHostTransitionStatus:bn,useFormState:bn,useActionState:bn,useOptimistic:bn,useMemoCache:bn,useCacheRefresh:bn};Tl.useEffectEvent=bn;var $m={readContext:Wn,use:ac,useCallback:function(e,r){return lr().memoizedState=[e,r===void 0?null:r],e},useContext:Wn,useEffect:jm,useImperativeHandle:function(e,r,a){a=a!=null?a.concat([e]):null,oc(4194308,4,Nm.bind(null,r,e),a)},useLayoutEffect:function(e,r){return oc(4194308,4,e,r)},useInsertionEffect:function(e,r){oc(4,2,e,r)},useMemo:function(e,r){var a=lr();r=r===void 0?null:r;var o=e();if(Ri){tn(!0);try{e()}finally{tn(!1)}}return a.memoizedState=[o,r],o},useReducer:function(e,r,a){var o=lr();if(a!==void 0){var h=a(r);if(Ri){tn(!0);try{a(r)}finally{tn(!1)}}}else h=r;return o.memoizedState=o.baseState=h,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:h},o.queue=e,e=e.dispatch=Mb.bind(null,Rt,e),[o.memoizedState,e]},useRef:function(e){var r=lr();return e={current:e},r.memoizedState=e},useState:function(e){e=Cd(e);var r=e.queue,a=Lm.bind(null,Rt,r);return r.dispatch=a,[e.memoizedState,a]},useDebugValue:Rd,useDeferredValue:function(e,r){var a=lr();return Td(a,e,r)},useTransition:function(){var e=Cd(!1);return e=Om.bind(null,Rt,e.queue,!0,!1),lr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,r,a){var o=Rt,h=lr();if(Pt){if(a===void 0)throw Error(l(407));a=a()}else{if(a=r(),an===null)throw Error(l(349));(Bt&127)!==0||lm(o,r,a)}h.memoizedState=a;var g={value:a,getSnapshot:r};return h.queue=g,jm(cm.bind(null,o,g,e),[e]),o.flags|=2048,ga(9,{destroy:void 0},om.bind(null,o,g,a,r),null),a},useId:function(){var e=lr(),r=an.identifierPrefix;if(Pt){var a=ts,o=es;a=(o&~(1<<32-ln(o)-1)).toString(32)+a,r="_"+r+"R_"+a,a=sc++,0<a&&(r+="H"+a.toString(32)),r+="_"}else a=Nb++,r="_"+r+"r_"+a.toString(32)+"_";return e.memoizedState=r},useHostTransitionStatus:Ad,useFormState:vm,useActionState:vm,useOptimistic:function(e){var r=lr();r.memoizedState=r.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=a,r=Od.bind(null,Rt,!0,a),a.dispatch=r,[e,r]},useMemoCache:Sd,useCacheRefresh:function(){return lr().memoizedState=Db.bind(null,Rt)},useEffectEvent:function(e){var r=lr(),a={impl:e};return r.memoizedState=a,function(){if((Wt&2)!==0)throw Error(l(440));return a.impl.apply(void 0,arguments)}}},Dd={readContext:Wn,use:ac,useCallback:Tm,useContext:Wn,useEffect:Nd,useImperativeHandle:Rm,useInsertionEffect:Cm,useLayoutEffect:Em,useMemo:km,useReducer:lc,useRef:Sm,useState:function(){return lc(ms)},useDebugValue:Rd,useDeferredValue:function(e,r){var a=En();return Am(a,nn.memoizedState,e,r)},useTransition:function(){var e=lc(ms)[0],r=En().memoizedState;return[typeof e=="boolean"?e:Nl(e),r]},useSyncExternalStore:am,useId:zm,useHostTransitionStatus:Ad,useFormState:xm,useActionState:xm,useOptimistic:function(e,r){var a=En();return hm(a,nn,e,r)},useMemoCache:Sd,useCacheRefresh:Um};Dd.useEffectEvent=_m;var qm={readContext:Wn,use:ac,useCallback:Tm,useContext:Wn,useEffect:Nd,useImperativeHandle:Rm,useInsertionEffect:Cm,useLayoutEffect:Em,useMemo:km,useReducer:_d,useRef:Sm,useState:function(){return _d(ms)},useDebugValue:Rd,useDeferredValue:function(e,r){var a=En();return nn===null?Td(a,e,r):Am(a,nn.memoizedState,e,r)},useTransition:function(){var e=_d(ms)[0],r=En().memoizedState;return[typeof e=="boolean"?e:Nl(e),r]},useSyncExternalStore:am,useId:zm,useHostTransitionStatus:Ad,useFormState:wm,useActionState:wm,useOptimistic:function(e,r){var a=En();return nn!==null?hm(a,nn,e,r):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:Sd,useCacheRefresh:Um};qm.useEffectEvent=_m;function Md(e,r,a,o){r=e.memoizedState,a=a(o,r),a=a==null?r:v({},r,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var zd={enqueueSetState:function(e,r,a){e=e._reactInternals;var o=_r(),h=Ys(o);h.payload=r,a!=null&&(h.callback=a),r=Ks(e,h,o),r!==null&&(mr(r,e,o),jl(r,e,o))},enqueueReplaceState:function(e,r,a){e=e._reactInternals;var o=_r(),h=Ys(o);h.tag=1,h.payload=r,a!=null&&(h.callback=a),r=Ks(e,h,o),r!==null&&(mr(r,e,o),jl(r,e,o))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var a=_r(),o=Ys(a);o.tag=2,r!=null&&(o.callback=r),r=Ks(e,o,a),r!==null&&(mr(r,e,a),jl(r,e,a))}};function Pm(e,r,a,o,h,g,w){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,g,w):r.prototype&&r.prototype.isPureReactComponent?!ml(a,o)||!ml(h,g):!0}function Hm(e,r,a,o){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,o),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,o),r.state!==e&&zd.enqueueReplaceState(r,r.state,null)}function Ti(e,r){var a=r;if("ref"in r){a={};for(var o in r)o!=="ref"&&(a[o]=r[o])}if(e=e.defaultProps){a===r&&(a=v({},a));for(var h in e)a[h]===void 0&&(a[h]=e[h])}return a}function Fm(e){Po(e)}function Gm(e){console.error(e)}function Vm(e){Po(e)}function dc(e,r){try{var a=e.onUncaughtError;a(r.value,{componentStack:r.stack})}catch(o){setTimeout(function(){throw o})}}function Ym(e,r,a){try{var o=e.onCaughtError;o(a.value,{componentStack:a.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(h){setTimeout(function(){throw h})}}function Ud(e,r,a){return a=Ys(a),a.tag=3,a.payload={element:null},a.callback=function(){dc(e,r)},a}function Km(e){return e=Ys(e),e.tag=3,e}function Qm(e,r,a,o){var h=a.type.getDerivedStateFromError;if(typeof h=="function"){var g=o.value;e.payload=function(){return h(g)},e.callback=function(){Ym(r,a,o)}}var w=a.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(e.callback=function(){Ym(r,a,o),typeof h!="function"&&(ei===null?ei=new Set([this]):ei.add(this));var R=o.stack;this.componentDidCatch(o.value,{componentStack:R!==null?R:""})})}function zb(e,r,a,o,h){if(a.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(r=a.alternate,r!==null&&oa(r,a,h,!0),a=br.current,a!==null){switch(a.tag){case 31:case 13:return Mr===null?jc():a.alternate===null&&wn===0&&(wn=3),a.flags&=-257,a.flags|=65536,a.lanes=h,o===Jo?a.flags|=16384:(r=a.updateQueue,r===null?a.updateQueue=new Set([o]):r.add(o),lh(e,o,h)),!1;case 22:return a.flags|=65536,o===Jo?a.flags|=16384:(r=a.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([o])},a.updateQueue=r):(a=r.retryQueue,a===null?r.retryQueue=new Set([o]):a.add(o)),lh(e,o,h)),!1}throw Error(l(435,a.tag))}return lh(e,o,h),jc(),!1}if(Pt)return r=br.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=h,o!==td&&(e=Error(l(422),{cause:o}),vl(kr(e,a)))):(o!==td&&(r=Error(l(423),{cause:o}),vl(kr(r,a))),e=e.current.alternate,e.flags|=65536,h&=-h,e.lanes|=h,o=kr(o,a),h=Ud(e.stateNode,o,h),hd(e,h),wn!==4&&(wn=2)),!1;var g=Error(l(520),{cause:o});if(g=kr(g,a),Ll===null?Ll=[g]:Ll.push(g),wn!==4&&(wn=2),r===null)return!0;o=kr(o,a),a=r;do{switch(a.tag){case 3:return a.flags|=65536,e=h&-h,a.lanes|=e,e=Ud(a.stateNode,o,e),hd(a,e),!1;case 1:if(r=a.type,g=a.stateNode,(a.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ei===null||!ei.has(g))))return a.flags|=65536,h&=-h,a.lanes|=h,h=Km(h),Qm(h,e,a,o),hd(a,h),!1}a=a.return}while(a!==null);return!1}var Ld=Error(l(461)),Dn=!1;function Xn(e,r,a,o){r.child=e===null?Zp(r,null,a,o):Ni(r,e.child,a,o)}function Wm(e,r,a,o,h){a=a.render;var g=r.ref;if("ref"in o){var w={};for(var R in o)R!=="ref"&&(w[R]=o[R])}else w=o;return ji(r),o=vd(e,r,a,w,g,h),R=xd(),e!==null&&!Dn?(bd(e,r,h),gs(e,r,h)):(Pt&&R&&Zu(r),r.flags|=1,Xn(e,r,o,h),r.child)}function Xm(e,r,a,o,h){if(e===null){var g=a.type;return typeof g=="function"&&!Wu(g)&&g.defaultProps===void 0&&a.compare===null?(r.tag=15,r.type=g,Jm(e,r,g,o,h)):(e=Vo(a.type,null,o,r,r.mode,h),e.ref=r.ref,e.return=r,r.child=e)}if(g=e.child,!Gd(e,h)){var w=g.memoizedProps;if(a=a.compare,a=a!==null?a:ml,a(w,o)&&e.ref===r.ref)return gs(e,r,h)}return r.flags|=1,e=us(g,o),e.ref=r.ref,e.return=r,r.child=e}function Jm(e,r,a,o,h){if(e!==null){var g=e.memoizedProps;if(ml(g,o)&&e.ref===r.ref)if(Dn=!1,r.pendingProps=o=g,Gd(e,h))(e.flags&131072)!==0&&(Dn=!0);else return r.lanes=e.lanes,gs(e,r,h)}return Id(e,r,a,o,h)}function Zm(e,r,a,o){var h=o.children,g=e!==null?e.memoizedState:null;if(e===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.mode==="hidden"){if((r.flags&128)!==0){if(g=g!==null?g.baseLanes|a:a,e!==null){for(o=r.child=e.child,h=0;o!==null;)h=h|o.lanes|o.childLanes,o=o.sibling;o=h&~g}else o=0,r.child=null;return eg(e,r,g,a,o)}if((a&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},e!==null&&Wo(r,g!==null?g.cachePool:null),g!==null?nm(r,g):pd(),rm(r);else return o=r.lanes=536870912,eg(e,r,g!==null?g.baseLanes|a:a,a,o)}else g!==null?(Wo(r,g.cachePool),nm(r,g),Ws(),r.memoizedState=null):(e!==null&&Wo(r,null),pd(),Ws());return Xn(e,r,h,a),r.child}function kl(e,r){return e!==null&&e.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function eg(e,r,a,o,h){var g=od();return g=g===null?null:{parent:An._currentValue,pool:g},r.memoizedState={baseLanes:a,cachePool:g},e!==null&&Wo(r,null),pd(),rm(r),e!==null&&oa(e,r,o,!0),r.childLanes=h,null}function hc(e,r){return r=pc({mode:r.mode,children:r.children},e.mode),r.ref=e.ref,e.child=r,r.return=e,r}function tg(e,r,a){return Ni(r,e.child,null,a),e=hc(r,r.pendingProps),e.flags|=2,wr(r),r.memoizedState=null,e}function Ub(e,r,a){var o=r.pendingProps,h=(r.flags&128)!==0;if(r.flags&=-129,e===null){if(Pt){if(o.mode==="hidden")return e=hc(r,o),r.lanes=536870912,kl(null,e);if(gd(r),(e=pn)?(e=fy(e,Dr),e=e!==null&&e.data==="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Ps!==null?{id:es,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},a=Ip(e),a.return=r,r.child=a,Qn=r,pn=null)):e=null,e===null)throw Fs(r);return r.lanes=536870912,null}return hc(r,o)}var g=e.memoizedState;if(g!==null){var w=g.dehydrated;if(gd(r),h)if(r.flags&256)r.flags&=-257,r=tg(e,r,a);else if(r.memoizedState!==null)r.child=e.child,r.flags|=128,r=null;else throw Error(l(558));else if(Dn||oa(e,r,a,!1),h=(a&e.childLanes)!==0,Dn||h){if(o=an,o!==null&&(w=Kt(o,a),w!==0&&w!==g.retryLane))throw g.retryLane=w,xi(e,w),mr(o,e,w),Ld;jc(),r=tg(e,r,a)}else e=g.treeContext,pn=zr(w.nextSibling),Qn=r,Pt=!0,Hs=null,Dr=!1,e!==null&&qp(r,e),r=hc(r,o),r.flags|=4096;return r}return e=us(e.child,{mode:o.mode,children:o.children}),e.ref=r.ref,r.child=e,e.return=r,e}function fc(e,r){var a=r.ref;if(a===null)e!==null&&e.ref!==null&&(r.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(l(284));(e===null||e.ref!==a)&&(r.flags|=4194816)}}function Id(e,r,a,o,h){return ji(r),a=vd(e,r,a,o,void 0,h),o=xd(),e!==null&&!Dn?(bd(e,r,h),gs(e,r,h)):(Pt&&o&&Zu(r),r.flags|=1,Xn(e,r,a,h),r.child)}function ng(e,r,a,o,h,g){return ji(r),r.updateQueue=null,a=im(r,o,a,h),sm(e),o=xd(),e!==null&&!Dn?(bd(e,r,g),gs(e,r,g)):(Pt&&o&&Zu(r),r.flags|=1,Xn(e,r,a,g),r.child)}function rg(e,r,a,o,h){if(ji(r),r.stateNode===null){var g=sa,w=a.contextType;typeof w=="object"&&w!==null&&(g=Wn(w)),g=new a(o,g),r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=zd,r.stateNode=g,g._reactInternals=r,g=r.stateNode,g.props=o,g.state=r.memoizedState,g.refs={},ud(r),w=a.contextType,g.context=typeof w=="object"&&w!==null?Wn(w):sa,g.state=r.memoizedState,w=a.getDerivedStateFromProps,typeof w=="function"&&(Md(r,a,w,o),g.state=r.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(w=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),w!==g.state&&zd.enqueueReplaceState(g,g.state,null),Cl(r,o,g,h),_l(),g.state=r.memoizedState),typeof g.componentDidMount=="function"&&(r.flags|=4194308),o=!0}else if(e===null){g=r.stateNode;var R=r.memoizedProps,K=Ti(a,R);g.props=K;var oe=g.context,be=a.contextType;w=sa,typeof be=="object"&&be!==null&&(w=Wn(be));var Ne=a.getDerivedStateFromProps;be=typeof Ne=="function"||typeof g.getSnapshotBeforeUpdate=="function",R=r.pendingProps!==R,be||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(R||oe!==w)&&Hm(r,g,o,w),Vs=!1;var he=r.memoizedState;g.state=he,Cl(r,o,g,h),_l(),oe=r.memoizedState,R||he!==oe||Vs?(typeof Ne=="function"&&(Md(r,a,Ne,o),oe=r.memoizedState),(K=Vs||Pm(r,a,K,o,he,oe,w))?(be||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=o,r.memoizedState=oe),g.props=o,g.state=oe,g.context=w,o=K):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),o=!1)}else{g=r.stateNode,dd(e,r),w=r.memoizedProps,be=Ti(a,w),g.props=be,Ne=r.pendingProps,he=g.context,oe=a.contextType,K=sa,typeof oe=="object"&&oe!==null&&(K=Wn(oe)),R=a.getDerivedStateFromProps,(oe=typeof R=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(w!==Ne||he!==K)&&Hm(r,g,o,K),Vs=!1,he=r.memoizedState,g.state=he,Cl(r,o,g,h),_l();var ge=r.memoizedState;w!==Ne||he!==ge||Vs||e!==null&&e.dependencies!==null&&Ko(e.dependencies)?(typeof R=="function"&&(Md(r,a,R,o),ge=r.memoizedState),(be=Vs||Pm(r,a,be,o,he,ge,K)||e!==null&&e.dependencies!==null&&Ko(e.dependencies))?(oe||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(o,ge,K),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(o,ge,K)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||w===e.memoizedProps&&he===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||w===e.memoizedProps&&he===e.memoizedState||(r.flags|=1024),r.memoizedProps=o,r.memoizedState=ge),g.props=o,g.state=ge,g.context=K,o=be):(typeof g.componentDidUpdate!="function"||w===e.memoizedProps&&he===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||w===e.memoizedProps&&he===e.memoizedState||(r.flags|=1024),o=!1)}return g=o,fc(e,r),o=(r.flags&128)!==0,g||o?(g=r.stateNode,a=o&&typeof a.getDerivedStateFromError!="function"?null:g.render(),r.flags|=1,e!==null&&o?(r.child=Ni(r,e.child,null,h),r.child=Ni(r,null,a,h)):Xn(e,r,a,h),r.memoizedState=g.state,e=r.child):e=gs(e,r,h),e}function sg(e,r,a,o){return wi(),r.flags|=256,Xn(e,r,a,o),r.child}var Bd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $d(e){return{baseLanes:e,cachePool:Yp()}}function qd(e,r,a){return e=e!==null?e.childLanes&~a:0,r&&(e|=jr),e}function ig(e,r,a){var o=r.pendingProps,h=!1,g=(r.flags&128)!==0,w;if((w=g)||(w=e!==null&&e.memoizedState===null?!1:(Cn.current&2)!==0),w&&(h=!0,r.flags&=-129),w=(r.flags&32)!==0,r.flags&=-33,e===null){if(Pt){if(h?Qs(r):Ws(),(e=pn)?(e=fy(e,Dr),e=e!==null&&e.data!=="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Ps!==null?{id:es,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},a=Ip(e),a.return=r,r.child=a,Qn=r,pn=null)):e=null,e===null)throw Fs(r);return jh(e)?r.lanes=32:r.lanes=536870912,null}var R=o.children;return o=o.fallback,h?(Ws(),h=r.mode,R=pc({mode:"hidden",children:R},h),o=bi(o,h,a,null),R.return=r,o.return=r,R.sibling=o,r.child=R,o=r.child,o.memoizedState=$d(a),o.childLanes=qd(e,w,a),r.memoizedState=Bd,kl(null,o)):(Qs(r),Pd(r,R))}var K=e.memoizedState;if(K!==null&&(R=K.dehydrated,R!==null)){if(g)r.flags&256?(Qs(r),r.flags&=-257,r=Hd(e,r,a)):r.memoizedState!==null?(Ws(),r.child=e.child,r.flags|=128,r=null):(Ws(),R=o.fallback,h=r.mode,o=pc({mode:"visible",children:o.children},h),R=bi(R,h,a,null),R.flags|=2,o.return=r,R.return=r,o.sibling=R,r.child=o,Ni(r,e.child,null,a),o=r.child,o.memoizedState=$d(a),o.childLanes=qd(e,w,a),r.memoizedState=Bd,r=kl(null,o));else if(Qs(r),jh(R)){if(w=R.nextSibling&&R.nextSibling.dataset,w)var oe=w.dgst;w=oe,o=Error(l(419)),o.stack="",o.digest=w,vl({value:o,source:null,stack:null}),r=Hd(e,r,a)}else if(Dn||oa(e,r,a,!1),w=(a&e.childLanes)!==0,Dn||w){if(w=an,w!==null&&(o=Kt(w,a),o!==0&&o!==K.retryLane))throw K.retryLane=o,xi(e,o),mr(w,e,o),Ld;Sh(R)||jc(),r=Hd(e,r,a)}else Sh(R)?(r.flags|=192,r.child=e.child,r=null):(e=K.treeContext,pn=zr(R.nextSibling),Qn=r,Pt=!0,Hs=null,Dr=!1,e!==null&&qp(r,e),r=Pd(r,o.children),r.flags|=4096);return r}return h?(Ws(),R=o.fallback,h=r.mode,K=e.child,oe=K.sibling,o=us(K,{mode:"hidden",children:o.children}),o.subtreeFlags=K.subtreeFlags&65011712,oe!==null?R=us(oe,R):(R=bi(R,h,a,null),R.flags|=2),R.return=r,o.return=r,o.sibling=R,r.child=o,kl(null,o),o=r.child,R=e.child.memoizedState,R===null?R=$d(a):(h=R.cachePool,h!==null?(K=An._currentValue,h=h.parent!==K?{parent:K,pool:K}:h):h=Yp(),R={baseLanes:R.baseLanes|a,cachePool:h}),o.memoizedState=R,o.childLanes=qd(e,w,a),r.memoizedState=Bd,kl(e.child,o)):(Qs(r),a=e.child,e=a.sibling,a=us(a,{mode:"visible",children:o.children}),a.return=r,a.sibling=null,e!==null&&(w=r.deletions,w===null?(r.deletions=[e],r.flags|=16):w.push(e)),r.child=a,r.memoizedState=null,a)}function Pd(e,r){return r=pc({mode:"visible",children:r},e.mode),r.return=e,e.child=r}function pc(e,r){return e=xr(22,e,null,r),e.lanes=0,e}function Hd(e,r,a){return Ni(r,e.child,null,a),e=Pd(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function ag(e,r,a){e.lanes|=r;var o=e.alternate;o!==null&&(o.lanes|=r),sd(e.return,r,a)}function Fd(e,r,a,o,h,g){var w=e.memoizedState;w===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:h,treeForkCount:g}:(w.isBackwards=r,w.rendering=null,w.renderingStartTime=0,w.last=o,w.tail=a,w.tailMode=h,w.treeForkCount=g)}function lg(e,r,a){var o=r.pendingProps,h=o.revealOrder,g=o.tail;o=o.children;var w=Cn.current,R=(w&2)!==0;if(R?(w=w&1|2,r.flags|=128):w&=1,Z(Cn,w),Xn(e,r,o,a),o=Pt?yl:0,!R&&e!==null&&(e.flags&128)!==0)e:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ag(e,a,r);else if(e.tag===19)ag(e,a,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break e;for(;e.sibling===null;){if(e.return===null||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(h){case"forwards":for(a=r.child,h=null;a!==null;)e=a.alternate,e!==null&&nc(e)===null&&(h=a),a=a.sibling;a=h,a===null?(h=r.child,r.child=null):(h=a.sibling,a.sibling=null),Fd(r,!1,h,a,g,o);break;case"backwards":case"unstable_legacy-backwards":for(a=null,h=r.child,r.child=null;h!==null;){if(e=h.alternate,e!==null&&nc(e)===null){r.child=h;break}e=h.sibling,h.sibling=a,a=h,h=e}Fd(r,!0,a,null,g,o);break;case"together":Fd(r,!1,null,null,void 0,o);break;default:r.memoizedState=null}return r.child}function gs(e,r,a){if(e!==null&&(r.dependencies=e.dependencies),Zs|=r.lanes,(a&r.childLanes)===0)if(e!==null){if(oa(e,r,a,!1),(a&r.childLanes)===0)return null}else return null;if(e!==null&&r.child!==e.child)throw Error(l(153));if(r.child!==null){for(e=r.child,a=us(e,e.pendingProps),r.child=a,a.return=r;e.sibling!==null;)e=e.sibling,a=a.sibling=us(e,e.pendingProps),a.return=r;a.sibling=null}return r.child}function Gd(e,r){return(e.lanes&r)!==0?!0:(e=e.dependencies,!!(e!==null&&Ko(e)))}function Lb(e,r,a){switch(r.tag){case 3:O(r,r.stateNode.containerInfo),Gs(r,An,e.memoizedState.cache),wi();break;case 27:case 5:de(r);break;case 4:O(r,r.stateNode.containerInfo);break;case 10:Gs(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,gd(r),null;break;case 13:var o=r.memoizedState;if(o!==null)return o.dehydrated!==null?(Qs(r),r.flags|=128,null):(a&r.child.childLanes)!==0?ig(e,r,a):(Qs(r),e=gs(e,r,a),e!==null?e.sibling:null);Qs(r);break;case 19:var h=(e.flags&128)!==0;if(o=(a&r.childLanes)!==0,o||(oa(e,r,a,!1),o=(a&r.childLanes)!==0),h){if(o)return lg(e,r,a);r.flags|=128}if(h=r.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),Z(Cn,Cn.current),o)break;return null;case 22:return r.lanes=0,Zm(e,r,a,r.pendingProps);case 24:Gs(r,An,e.memoizedState.cache)}return gs(e,r,a)}function og(e,r,a){if(e!==null)if(e.memoizedProps!==r.pendingProps)Dn=!0;else{if(!Gd(e,a)&&(r.flags&128)===0)return Dn=!1,Lb(e,r,a);Dn=(e.flags&131072)!==0}else Dn=!1,Pt&&(r.flags&1048576)!==0&&$p(r,yl,r.index);switch(r.lanes=0,r.tag){case 16:e:{var o=r.pendingProps;if(e=Ci(r.elementType),r.type=e,typeof e=="function")Wu(e)?(o=Ti(e,o),r.tag=1,r=rg(null,r,e,o,a)):(r.tag=0,r=Id(null,r,e,o,a));else{if(e!=null){var h=e.$$typeof;if(h===B){r.tag=11,r=Wm(null,r,e,o,a);break e}else if(h===M){r.tag=14,r=Xm(null,r,e,o,a);break e}}throw r=q(e)||e,Error(l(306,r,""))}}return r;case 0:return Id(e,r,r.type,r.pendingProps,a);case 1:return o=r.type,h=Ti(o,r.pendingProps),rg(e,r,o,h,a);case 3:e:{if(O(r,r.stateNode.containerInfo),e===null)throw Error(l(387));o=r.pendingProps;var g=r.memoizedState;h=g.element,dd(e,r),Cl(r,o,null,a);var w=r.memoizedState;if(o=w.cache,Gs(r,An,o),o!==g.cache&&id(r,[An],a,!0),_l(),o=w.element,g.isDehydrated)if(g={element:o,isDehydrated:!1,cache:w.cache},r.updateQueue.baseState=g,r.memoizedState=g,r.flags&256){r=sg(e,r,o,a);break e}else if(o!==h){h=kr(Error(l(424)),r),vl(h),r=sg(e,r,o,a);break e}else for(e=r.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,pn=zr(e.firstChild),Qn=r,Pt=!0,Hs=null,Dr=!0,a=Zp(r,null,o,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(wi(),o===h){r=gs(e,r,a);break e}Xn(e,r,o,a)}r=r.child}return r;case 26:return fc(e,r),e===null?(a=xy(r.type,null,r.pendingProps,null))?r.memoizedState=a:Pt||(a=r.type,e=r.pendingProps,o=kc(Se.current).createElement(a),o[H]=r,o[xe]=e,Jn(o,a,e),qt(o),r.stateNode=o):r.memoizedState=xy(r.type,e.memoizedProps,r.pendingProps,e.memoizedState),null;case 27:return de(r),e===null&&Pt&&(o=r.stateNode=gy(r.type,r.pendingProps,Se.current),Qn=r,Dr=!0,h=pn,si(r.type)?(_h=h,pn=zr(o.firstChild)):pn=h),Xn(e,r,r.pendingProps.children,a),fc(e,r),e===null&&(r.flags|=4194304),r.child;case 5:return e===null&&Pt&&((h=o=pn)&&(o=fw(o,r.type,r.pendingProps,Dr),o!==null?(r.stateNode=o,Qn=r,pn=zr(o.firstChild),Dr=!1,h=!0):h=!1),h||Fs(r)),de(r),h=r.type,g=r.pendingProps,w=e!==null?e.memoizedProps:null,o=g.children,xh(h,g)?o=null:w!==null&&xh(h,w)&&(r.flags|=32),r.memoizedState!==null&&(h=vd(e,r,Rb,null,null,a),Gl._currentValue=h),fc(e,r),Xn(e,r,o,a),r.child;case 6:return e===null&&Pt&&((e=a=pn)&&(a=pw(a,r.pendingProps,Dr),a!==null?(r.stateNode=a,Qn=r,pn=null,e=!0):e=!1),e||Fs(r)),null;case 13:return ig(e,r,a);case 4:return O(r,r.stateNode.containerInfo),o=r.pendingProps,e===null?r.child=Ni(r,null,o,a):Xn(e,r,o,a),r.child;case 11:return Wm(e,r,r.type,r.pendingProps,a);case 7:return Xn(e,r,r.pendingProps,a),r.child;case 8:return Xn(e,r,r.pendingProps.children,a),r.child;case 12:return Xn(e,r,r.pendingProps.children,a),r.child;case 10:return o=r.pendingProps,Gs(r,r.type,o.value),Xn(e,r,o.children,a),r.child;case 9:return h=r.type._context,o=r.pendingProps.children,ji(r),h=Wn(h),o=o(h),r.flags|=1,Xn(e,r,o,a),r.child;case 14:return Xm(e,r,r.type,r.pendingProps,a);case 15:return Jm(e,r,r.type,r.pendingProps,a);case 19:return lg(e,r,a);case 31:return Ub(e,r,a);case 22:return Zm(e,r,a,r.pendingProps);case 24:return ji(r),o=Wn(An),e===null?(h=od(),h===null&&(h=an,g=ad(),h.pooledCache=g,g.refCount++,g!==null&&(h.pooledCacheLanes|=a),h=g),r.memoizedState={parent:o,cache:h},ud(r),Gs(r,An,h)):((e.lanes&a)!==0&&(dd(e,r),Cl(r,null,null,a),_l()),h=e.memoizedState,g=r.memoizedState,h.parent!==o?(h={parent:o,cache:o},r.memoizedState=h,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=h),Gs(r,An,o)):(o=g.cache,Gs(r,An,o),o!==h.cache&&id(r,[An],a,!0))),Xn(e,r,r.pendingProps.children,a),r.child;case 29:throw r.pendingProps}throw Error(l(156,r.tag))}function ys(e){e.flags|=4}function Vd(e,r,a,o,h){if((r=(e.mode&32)!==0)&&(r=!1),r){if(e.flags|=16777216,(h&335544128)===h)if(e.stateNode.complete)e.flags|=8192;else if(zg())e.flags|=8192;else throw Ei=Jo,cd}else e.flags&=-16777217}function cg(e,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!_y(r))if(zg())e.flags|=8192;else throw Ei=Jo,cd}function mc(e,r){r!==null&&(e.flags|=4),e.flags&16384&&(r=e.tag!==22?Nt():536870912,e.lanes|=r,ba|=r)}function Al(e,r){if(!Pt)switch(e.tailMode){case"hidden":r=e.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function mn(e){var r=e.alternate!==null&&e.alternate.child===e.child,a=0,o=0;if(r)for(var h=e.child;h!==null;)a|=h.lanes|h.childLanes,o|=h.subtreeFlags&65011712,o|=h.flags&65011712,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)a|=h.lanes|h.childLanes,o|=h.subtreeFlags,o|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=o,e.childLanes=a,r}function Ib(e,r,a){var o=r.pendingProps;switch(ed(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mn(r),null;case 1:return mn(r),null;case 3:return a=r.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),r.memoizedState.cache!==o&&(r.flags|=2048),fs(An),ie(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(la(r)?ys(r):e===null||e.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,nd())),mn(r),null;case 26:var h=r.type,g=r.memoizedState;return e===null?(ys(r),g!==null?(mn(r),cg(r,g)):(mn(r),Vd(r,h,null,o,a))):g?g!==e.memoizedState?(ys(r),mn(r),cg(r,g)):(mn(r),r.flags&=-16777217):(e=e.memoizedProps,e!==o&&ys(r),mn(r),Vd(r,h,e,o,a)),null;case 27:if(Me(r),a=Se.current,h=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==o&&ys(r);else{if(!o){if(r.stateNode===null)throw Error(l(166));return mn(r),null}e=ce.current,la(r)?Pp(r):(e=gy(h,o,a),r.stateNode=e,ys(r))}return mn(r),null;case 5:if(Me(r),h=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==o&&ys(r);else{if(!o){if(r.stateNode===null)throw Error(l(166));return mn(r),null}if(g=ce.current,la(r))Pp(r);else{var w=kc(Se.current);switch(g){case 1:g=w.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:g=w.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":g=w.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":g=w.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":g=w.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof o.is=="string"?w.createElement("select",{is:o.is}):w.createElement("select"),o.multiple?g.multiple=!0:o.size&&(g.size=o.size);break;default:g=typeof o.is=="string"?w.createElement(h,{is:o.is}):w.createElement(h)}}g[H]=r,g[xe]=o;e:for(w=r.child;w!==null;){if(w.tag===5||w.tag===6)g.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===r)break e;for(;w.sibling===null;){if(w.return===null||w.return===r)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}r.stateNode=g;e:switch(Jn(g,h,o),h){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&ys(r)}}return mn(r),Vd(r,r.type,e===null?null:e.memoizedProps,r.pendingProps,a),null;case 6:if(e&&r.stateNode!=null)e.memoizedProps!==o&&ys(r);else{if(typeof o!="string"&&r.stateNode===null)throw Error(l(166));if(e=Se.current,la(r)){if(e=r.stateNode,a=r.memoizedProps,o=null,h=Qn,h!==null)switch(h.tag){case 27:case 5:o=h.memoizedProps}e[H]=r,e=!!(e.nodeValue===a||o!==null&&o.suppressHydrationWarning===!0||iy(e.nodeValue,a)),e||Fs(r,!0)}else e=kc(e).createTextNode(o),e[H]=r,r.stateNode=e}return mn(r),null;case 31:if(a=r.memoizedState,e===null||e.memoizedState!==null){if(o=la(r),a!==null){if(e===null){if(!o)throw Error(l(318));if(e=r.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(557));e[H]=r}else wi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;mn(r),e=!1}else a=nd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return r.flags&256?(wr(r),r):(wr(r),null);if((r.flags&128)!==0)throw Error(l(558))}return mn(r),null;case 13:if(o=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(h=la(r),o!==null&&o.dehydrated!==null){if(e===null){if(!h)throw Error(l(318));if(h=r.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(l(317));h[H]=r}else wi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;mn(r),h=!1}else h=nd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=h),h=!0;if(!h)return r.flags&256?(wr(r),r):(wr(r),null)}return wr(r),(r.flags&128)!==0?(r.lanes=a,r):(a=o!==null,e=e!==null&&e.memoizedState!==null,a&&(o=r.child,h=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(h=o.alternate.memoizedState.cachePool.pool),g=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(g=o.memoizedState.cachePool.pool),g!==h&&(o.flags|=2048)),a!==e&&a&&(r.child.flags|=8192),mc(r,r.updateQueue),mn(r),null);case 4:return ie(),e===null&&ph(r.stateNode.containerInfo),mn(r),null;case 10:return fs(r.type),mn(r),null;case 19:if(W(Cn),o=r.memoizedState,o===null)return mn(r),null;if(h=(r.flags&128)!==0,g=o.rendering,g===null)if(h)Al(o,!1);else{if(wn!==0||e!==null&&(e.flags&128)!==0)for(e=r.child;e!==null;){if(g=nc(e),g!==null){for(r.flags|=128,Al(o,!1),e=g.updateQueue,r.updateQueue=e,mc(r,e),r.subtreeFlags=0,e=a,a=r.child;a!==null;)Lp(a,e),a=a.sibling;return Z(Cn,Cn.current&1|2),Pt&&ds(r,o.treeForkCount),r.child}e=e.sibling}o.tail!==null&&vt()>bc&&(r.flags|=128,h=!0,Al(o,!1),r.lanes=4194304)}else{if(!h)if(e=nc(g),e!==null){if(r.flags|=128,h=!0,e=e.updateQueue,r.updateQueue=e,mc(r,e),Al(o,!0),o.tail===null&&o.tailMode==="hidden"&&!g.alternate&&!Pt)return mn(r),null}else 2*vt()-o.renderingStartTime>bc&&a!==536870912&&(r.flags|=128,h=!0,Al(o,!1),r.lanes=4194304);o.isBackwards?(g.sibling=r.child,r.child=g):(e=o.last,e!==null?e.sibling=g:r.child=g,o.last=g)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=vt(),e.sibling=null,a=Cn.current,Z(Cn,h?a&1|2:a&1),Pt&&ds(r,o.treeForkCount),e):(mn(r),null);case 22:case 23:return wr(r),md(),o=r.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(r.flags|=8192):o&&(r.flags|=8192),o?(a&536870912)!==0&&(r.flags&128)===0&&(mn(r),r.subtreeFlags&6&&(r.flags|=8192)):mn(r),a=r.updateQueue,a!==null&&mc(r,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),o=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(o=r.memoizedState.cachePool.pool),o!==a&&(r.flags|=2048),e!==null&&W(_i),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),r.memoizedState.cache!==a&&(r.flags|=2048),fs(An),mn(r),null;case 25:return null;case 30:return null}throw Error(l(156,r.tag))}function Bb(e,r){switch(ed(r),r.tag){case 1:return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return fs(An),ie(),e=r.flags,(e&65536)!==0&&(e&128)===0?(r.flags=e&-65537|128,r):null;case 26:case 27:case 5:return Me(r),null;case 31:if(r.memoizedState!==null){if(wr(r),r.alternate===null)throw Error(l(340));wi()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 13:if(wr(r),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(l(340));wi()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return W(Cn),null;case 4:return ie(),null;case 10:return fs(r.type),null;case 22:case 23:return wr(r),md(),e!==null&&W(_i),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 24:return fs(An),null;case 25:return null;default:return null}}function ug(e,r){switch(ed(r),r.tag){case 3:fs(An),ie();break;case 26:case 27:case 5:Me(r);break;case 4:ie();break;case 31:r.memoizedState!==null&&wr(r);break;case 13:wr(r);break;case 19:W(Cn);break;case 10:fs(r.type);break;case 22:case 23:wr(r),md(),e!==null&&W(_i);break;case 24:fs(An)}}function Ol(e,r){try{var a=r.updateQueue,o=a!==null?a.lastEffect:null;if(o!==null){var h=o.next;a=h;do{if((a.tag&e)===e){o=void 0;var g=a.create,w=a.inst;o=g(),w.destroy=o}a=a.next}while(a!==h)}}catch(R){Zt(r,r.return,R)}}function Xs(e,r,a){try{var o=r.updateQueue,h=o!==null?o.lastEffect:null;if(h!==null){var g=h.next;o=g;do{if((o.tag&e)===e){var w=o.inst,R=w.destroy;if(R!==void 0){w.destroy=void 0,h=r;var K=a,oe=R;try{oe()}catch(be){Zt(h,K,be)}}}o=o.next}while(o!==g)}}catch(be){Zt(r,r.return,be)}}function dg(e){var r=e.updateQueue;if(r!==null){var a=e.stateNode;try{tm(r,a)}catch(o){Zt(e,e.return,o)}}}function hg(e,r,a){a.props=Ti(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(o){Zt(e,r,o)}}function Dl(e,r){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof a=="function"?e.refCleanup=a(o):a.current=o}}catch(h){Zt(e,r,h)}}function ns(e,r){var a=e.ref,o=e.refCleanup;if(a!==null)if(typeof o=="function")try{o()}catch(h){Zt(e,r,h)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(h){Zt(e,r,h)}else a.current=null}function fg(e){var r=e.type,a=e.memoizedProps,o=e.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":a.autoFocus&&o.focus();break e;case"img":a.src?o.src=a.src:a.srcSet&&(o.srcset=a.srcSet)}}catch(h){Zt(e,e.return,h)}}function Yd(e,r,a){try{var o=e.stateNode;lw(o,e.type,a,r),o[xe]=r}catch(h){Zt(e,e.return,h)}}function pg(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&si(e.type)||e.tag===4}function Kd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||pg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&si(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Qd(e,r,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,r?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,r):(r=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,r.appendChild(e),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=Pr));else if(o!==4&&(o===27&&si(e.type)&&(a=e.stateNode,r=null),e=e.child,e!==null))for(Qd(e,r,a),e=e.sibling;e!==null;)Qd(e,r,a),e=e.sibling}function gc(e,r,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,r?a.insertBefore(e,r):a.appendChild(e);else if(o!==4&&(o===27&&si(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(gc(e,r,a),e=e.sibling;e!==null;)gc(e,r,a),e=e.sibling}function mg(e){var r=e.stateNode,a=e.memoizedProps;try{for(var o=e.type,h=r.attributes;h.length;)r.removeAttributeNode(h[0]);Jn(r,o,a),r[H]=e,r[xe]=a}catch(g){Zt(e,e.return,g)}}var vs=!1,Mn=!1,Wd=!1,gg=typeof WeakSet=="function"?WeakSet:Set,Hn=null;function $b(e,r){if(e=e.containerInfo,yh=Lc,e=Rp(e),Hu(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var h=o.anchorOffset,g=o.focusNode;o=o.focusOffset;try{a.nodeType,g.nodeType}catch{a=null;break e}var w=0,R=-1,K=-1,oe=0,be=0,Ne=e,he=null;t:for(;;){for(var ge;Ne!==a||h!==0&&Ne.nodeType!==3||(R=w+h),Ne!==g||o!==0&&Ne.nodeType!==3||(K=w+o),Ne.nodeType===3&&(w+=Ne.nodeValue.length),(ge=Ne.firstChild)!==null;)he=Ne,Ne=ge;for(;;){if(Ne===e)break t;if(he===a&&++oe===h&&(R=w),he===g&&++be===o&&(K=w),(ge=Ne.nextSibling)!==null)break;Ne=he,he=Ne.parentNode}Ne=ge}a=R===-1||K===-1?null:{start:R,end:K}}else a=null}a=a||{start:0,end:0}}else a=null;for(vh={focusedElem:e,selectionRange:a},Lc=!1,Hn=r;Hn!==null;)if(r=Hn,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,Hn=e;else for(;Hn!==null;){switch(r=Hn,g=r.alternate,e=r.flags,r.tag){case 0:if((e&4)!==0&&(e=r.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)h=e[a],h.ref.impl=h.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,a=r,h=g.memoizedProps,g=g.memoizedState,o=a.stateNode;try{var Ze=Ti(a.type,h);e=o.getSnapshotBeforeUpdate(Ze,g),o.__reactInternalSnapshotBeforeUpdate=e}catch(pt){Zt(a,a.return,pt)}}break;case 3:if((e&1024)!==0){if(e=r.stateNode.containerInfo,a=e.nodeType,a===9)wh(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":wh(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(l(163))}if(e=r.sibling,e!==null){e.return=r.return,Hn=e;break}Hn=r.return}}function yg(e,r,a){var o=a.flags;switch(a.tag){case 0:case 11:case 15:bs(e,a),o&4&&Ol(5,a);break;case 1:if(bs(e,a),o&4)if(e=a.stateNode,r===null)try{e.componentDidMount()}catch(w){Zt(a,a.return,w)}else{var h=Ti(a.type,r.memoizedProps);r=r.memoizedState;try{e.componentDidUpdate(h,r,e.__reactInternalSnapshotBeforeUpdate)}catch(w){Zt(a,a.return,w)}}o&64&&dg(a),o&512&&Dl(a,a.return);break;case 3:if(bs(e,a),o&64&&(e=a.updateQueue,e!==null)){if(r=null,a.child!==null)switch(a.child.tag){case 27:case 5:r=a.child.stateNode;break;case 1:r=a.child.stateNode}try{tm(e,r)}catch(w){Zt(a,a.return,w)}}break;case 27:r===null&&o&4&&mg(a);case 26:case 5:bs(e,a),r===null&&o&4&&fg(a),o&512&&Dl(a,a.return);break;case 12:bs(e,a);break;case 31:bs(e,a),o&4&&bg(e,a);break;case 13:bs(e,a),o&4&&wg(e,a),o&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Qb.bind(null,a),mw(e,a))));break;case 22:if(o=a.memoizedState!==null||vs,!o){r=r!==null&&r.memoizedState!==null||Mn,h=vs;var g=Mn;vs=o,(Mn=r)&&!g?ws(e,a,(a.subtreeFlags&8772)!==0):bs(e,a),vs=h,Mn=g}break;case 30:break;default:bs(e,a)}}function vg(e){var r=e.alternate;r!==null&&(e.alternate=null,vg(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&Ft(r)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var gn=null,dr=!1;function xs(e,r,a){for(a=a.child;a!==null;)xg(e,r,a),a=a.sibling}function xg(e,r,a){if(bt&&typeof bt.onCommitFiberUnmount=="function")try{bt.onCommitFiberUnmount(jn,a)}catch{}switch(a.tag){case 26:Mn||ns(a,r),xs(e,r,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:Mn||ns(a,r);var o=gn,h=dr;si(a.type)&&(gn=a.stateNode,dr=!1),xs(e,r,a),Pl(a.stateNode),gn=o,dr=h;break;case 5:Mn||ns(a,r);case 6:if(o=gn,h=dr,gn=null,xs(e,r,a),gn=o,dr=h,gn!==null)if(dr)try{(gn.nodeType===9?gn.body:gn.nodeName==="HTML"?gn.ownerDocument.body:gn).removeChild(a.stateNode)}catch(g){Zt(a,r,g)}else try{gn.removeChild(a.stateNode)}catch(g){Zt(a,r,g)}break;case 18:gn!==null&&(dr?(e=gn,dy(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),Ra(e)):dy(gn,a.stateNode));break;case 4:o=gn,h=dr,gn=a.stateNode.containerInfo,dr=!0,xs(e,r,a),gn=o,dr=h;break;case 0:case 11:case 14:case 15:Xs(2,a,r),Mn||Xs(4,a,r),xs(e,r,a);break;case 1:Mn||(ns(a,r),o=a.stateNode,typeof o.componentWillUnmount=="function"&&hg(a,r,o)),xs(e,r,a);break;case 21:xs(e,r,a);break;case 22:Mn=(o=Mn)||a.memoizedState!==null,xs(e,r,a),Mn=o;break;default:xs(e,r,a)}}function bg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Ra(e)}catch(a){Zt(r,r.return,a)}}}function wg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ra(e)}catch(a){Zt(r,r.return,a)}}function qb(e){switch(e.tag){case 31:case 13:case 19:var r=e.stateNode;return r===null&&(r=e.stateNode=new gg),r;case 22:return e=e.stateNode,r=e._retryCache,r===null&&(r=e._retryCache=new gg),r;default:throw Error(l(435,e.tag))}}function yc(e,r){var a=qb(e);r.forEach(function(o){if(!a.has(o)){a.add(o);var h=Wb.bind(null,e,o);o.then(h,h)}})}function hr(e,r){var a=r.deletions;if(a!==null)for(var o=0;o<a.length;o++){var h=a[o],g=e,w=r,R=w;e:for(;R!==null;){switch(R.tag){case 27:if(si(R.type)){gn=R.stateNode,dr=!1;break e}break;case 5:gn=R.stateNode,dr=!1;break e;case 3:case 4:gn=R.stateNode.containerInfo,dr=!0;break e}R=R.return}if(gn===null)throw Error(l(160));xg(g,w,h),gn=null,dr=!1,g=h.alternate,g!==null&&(g.return=null),h.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Sg(r,e),r=r.sibling}var Fr=null;function Sg(e,r){var a=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:hr(r,e),fr(e),o&4&&(Xs(3,e,e.return),Ol(3,e),Xs(5,e,e.return));break;case 1:hr(r,e),fr(e),o&512&&(Mn||a===null||ns(a,a.return)),o&64&&vs&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?o:a.concat(o))));break;case 26:var h=Fr;if(hr(r,e),fr(e),o&512&&(Mn||a===null||ns(a,a.return)),o&4){var g=a!==null?a.memoizedState:null;if(o=e.memoizedState,a===null)if(o===null)if(e.stateNode===null){e:{o=e.type,a=e.memoizedProps,h=h.ownerDocument||h;t:switch(o){case"title":g=h.getElementsByTagName("title")[0],(!g||g[xt]||g[H]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=h.createElement(o),h.head.insertBefore(g,h.querySelector("head > title"))),Jn(g,o,a),g[H]=e,qt(g),o=g;break e;case"link":var w=Sy("link","href",h).get(o+(a.href||""));if(w){for(var R=0;R<w.length;R++)if(g=w[R],g.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&g.getAttribute("rel")===(a.rel==null?null:a.rel)&&g.getAttribute("title")===(a.title==null?null:a.title)&&g.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){w.splice(R,1);break t}}g=h.createElement(o),Jn(g,o,a),h.head.appendChild(g);break;case"meta":if(w=Sy("meta","content",h).get(o+(a.content||""))){for(R=0;R<w.length;R++)if(g=w[R],g.getAttribute("content")===(a.content==null?null:""+a.content)&&g.getAttribute("name")===(a.name==null?null:a.name)&&g.getAttribute("property")===(a.property==null?null:a.property)&&g.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&g.getAttribute("charset")===(a.charSet==null?null:a.charSet)){w.splice(R,1);break t}}g=h.createElement(o),Jn(g,o,a),h.head.appendChild(g);break;default:throw Error(l(468,o))}g[H]=e,qt(g),o=g}e.stateNode=o}else jy(h,e.type,e.stateNode);else e.stateNode=wy(h,o,e.memoizedProps);else g!==o?(g===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):g.count--,o===null?jy(h,e.type,e.stateNode):wy(h,o,e.memoizedProps)):o===null&&e.stateNode!==null&&Yd(e,e.memoizedProps,a.memoizedProps)}break;case 27:hr(r,e),fr(e),o&512&&(Mn||a===null||ns(a,a.return)),a!==null&&o&4&&Yd(e,e.memoizedProps,a.memoizedProps);break;case 5:if(hr(r,e),fr(e),o&512&&(Mn||a===null||ns(a,a.return)),e.flags&32){h=e.stateNode;try{ls(h,"")}catch(Ze){Zt(e,e.return,Ze)}}o&4&&e.stateNode!=null&&(h=e.memoizedProps,Yd(e,h,a!==null?a.memoizedProps:h)),o&1024&&(Wd=!0);break;case 6:if(hr(r,e),fr(e),o&4){if(e.stateNode===null)throw Error(l(162));o=e.memoizedProps,a=e.stateNode;try{a.nodeValue=o}catch(Ze){Zt(e,e.return,Ze)}}break;case 3:if(Dc=null,h=Fr,Fr=Ac(r.containerInfo),hr(r,e),Fr=h,fr(e),o&4&&a!==null&&a.memoizedState.isDehydrated)try{Ra(r.containerInfo)}catch(Ze){Zt(e,e.return,Ze)}Wd&&(Wd=!1,jg(e));break;case 4:o=Fr,Fr=Ac(e.stateNode.containerInfo),hr(r,e),fr(e),Fr=o;break;case 12:hr(r,e),fr(e);break;case 31:hr(r,e),fr(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,yc(e,o)));break;case 13:hr(r,e),fr(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(xc=vt()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,yc(e,o)));break;case 22:h=e.memoizedState!==null;var K=a!==null&&a.memoizedState!==null,oe=vs,be=Mn;if(vs=oe||h,Mn=be||K,hr(r,e),Mn=be,vs=oe,fr(e),o&8192)e:for(r=e.stateNode,r._visibility=h?r._visibility&-2:r._visibility|1,h&&(a===null||K||vs||Mn||ki(e)),a=null,r=e;;){if(r.tag===5||r.tag===26){if(a===null){K=a=r;try{if(g=K.stateNode,h)w=g.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none";else{R=K.stateNode;var Ne=K.memoizedProps.style,he=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null;R.style.display=he==null||typeof he=="boolean"?"":(""+he).trim()}}catch(Ze){Zt(K,K.return,Ze)}}}else if(r.tag===6){if(a===null){K=r;try{K.stateNode.nodeValue=h?"":K.memoizedProps}catch(Ze){Zt(K,K.return,Ze)}}}else if(r.tag===18){if(a===null){K=r;try{var ge=K.stateNode;h?hy(ge,!0):hy(K.stateNode,!1)}catch(Ze){Zt(K,K.return,Ze)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;a===r&&(a=null),r=r.return}a===r&&(a=null),r.sibling.return=r.return,r=r.sibling}o&4&&(o=e.updateQueue,o!==null&&(a=o.retryQueue,a!==null&&(o.retryQueue=null,yc(e,a))));break;case 19:hr(r,e),fr(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,yc(e,o)));break;case 30:break;case 21:break;default:hr(r,e),fr(e)}}function fr(e){var r=e.flags;if(r&2){try{for(var a,o=e.return;o!==null;){if(pg(o)){a=o;break}o=o.return}if(a==null)throw Error(l(160));switch(a.tag){case 27:var h=a.stateNode,g=Kd(e);gc(e,g,h);break;case 5:var w=a.stateNode;a.flags&32&&(ls(w,""),a.flags&=-33);var R=Kd(e);gc(e,R,w);break;case 3:case 4:var K=a.stateNode.containerInfo,oe=Kd(e);Qd(e,oe,K);break;default:throw Error(l(161))}}catch(be){Zt(e,e.return,be)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function jg(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var r=e;jg(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),e=e.sibling}}function bs(e,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)yg(e,r.alternate,r),r=r.sibling}function ki(e){for(e=e.child;e!==null;){var r=e;switch(r.tag){case 0:case 11:case 14:case 15:Xs(4,r,r.return),ki(r);break;case 1:ns(r,r.return);var a=r.stateNode;typeof a.componentWillUnmount=="function"&&hg(r,r.return,a),ki(r);break;case 27:Pl(r.stateNode);case 26:case 5:ns(r,r.return),ki(r);break;case 22:r.memoizedState===null&&ki(r);break;case 30:ki(r);break;default:ki(r)}e=e.sibling}}function ws(e,r,a){for(a=a&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var o=r.alternate,h=e,g=r,w=g.flags;switch(g.tag){case 0:case 11:case 15:ws(h,g,a),Ol(4,g);break;case 1:if(ws(h,g,a),o=g,h=o.stateNode,typeof h.componentDidMount=="function")try{h.componentDidMount()}catch(oe){Zt(o,o.return,oe)}if(o=g,h=o.updateQueue,h!==null){var R=o.stateNode;try{var K=h.shared.hiddenCallbacks;if(K!==null)for(h.shared.hiddenCallbacks=null,h=0;h<K.length;h++)em(K[h],R)}catch(oe){Zt(o,o.return,oe)}}a&&w&64&&dg(g),Dl(g,g.return);break;case 27:mg(g);case 26:case 5:ws(h,g,a),a&&o===null&&w&4&&fg(g),Dl(g,g.return);break;case 12:ws(h,g,a);break;case 31:ws(h,g,a),a&&w&4&&bg(h,g);break;case 13:ws(h,g,a),a&&w&4&&wg(h,g);break;case 22:g.memoizedState===null&&ws(h,g,a),Dl(g,g.return);break;case 30:break;default:ws(h,g,a)}r=r.sibling}}function Xd(e,r){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(e=r.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&xl(a))}function Jd(e,r){e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&xl(e))}function Gr(e,r,a,o){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)_g(e,r,a,o),r=r.sibling}function _g(e,r,a,o){var h=r.flags;switch(r.tag){case 0:case 11:case 15:Gr(e,r,a,o),h&2048&&Ol(9,r);break;case 1:Gr(e,r,a,o);break;case 3:Gr(e,r,a,o),h&2048&&(e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&xl(e)));break;case 12:if(h&2048){Gr(e,r,a,o),e=r.stateNode;try{var g=r.memoizedProps,w=g.id,R=g.onPostCommit;typeof R=="function"&&R(w,r.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(K){Zt(r,r.return,K)}}else Gr(e,r,a,o);break;case 31:Gr(e,r,a,o);break;case 13:Gr(e,r,a,o);break;case 23:break;case 22:g=r.stateNode,w=r.alternate,r.memoizedState!==null?g._visibility&2?Gr(e,r,a,o):Ml(e,r):g._visibility&2?Gr(e,r,a,o):(g._visibility|=2,ya(e,r,a,o,(r.subtreeFlags&10256)!==0||!1)),h&2048&&Xd(w,r);break;case 24:Gr(e,r,a,o),h&2048&&Jd(r.alternate,r);break;default:Gr(e,r,a,o)}}function ya(e,r,a,o,h){for(h=h&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var g=e,w=r,R=a,K=o,oe=w.flags;switch(w.tag){case 0:case 11:case 15:ya(g,w,R,K,h),Ol(8,w);break;case 23:break;case 22:var be=w.stateNode;w.memoizedState!==null?be._visibility&2?ya(g,w,R,K,h):Ml(g,w):(be._visibility|=2,ya(g,w,R,K,h)),h&&oe&2048&&Xd(w.alternate,w);break;case 24:ya(g,w,R,K,h),h&&oe&2048&&Jd(w.alternate,w);break;default:ya(g,w,R,K,h)}r=r.sibling}}function Ml(e,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var a=e,o=r,h=o.flags;switch(o.tag){case 22:Ml(a,o),h&2048&&Xd(o.alternate,o);break;case 24:Ml(a,o),h&2048&&Jd(o.alternate,o);break;default:Ml(a,o)}r=r.sibling}}var zl=8192;function va(e,r,a){if(e.subtreeFlags&zl)for(e=e.child;e!==null;)Cg(e,r,a),e=e.sibling}function Cg(e,r,a){switch(e.tag){case 26:va(e,r,a),e.flags&zl&&e.memoizedState!==null&&Nw(a,Fr,e.memoizedState,e.memoizedProps);break;case 5:va(e,r,a);break;case 3:case 4:var o=Fr;Fr=Ac(e.stateNode.containerInfo),va(e,r,a),Fr=o;break;case 22:e.memoizedState===null&&(o=e.alternate,o!==null&&o.memoizedState!==null?(o=zl,zl=16777216,va(e,r,a),zl=o):va(e,r,a));break;default:va(e,r,a)}}function Eg(e){var r=e.alternate;if(r!==null&&(e=r.child,e!==null)){r.child=null;do r=e.sibling,e.sibling=null,e=r;while(e!==null)}}function Ul(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var o=r[a];Hn=o,Rg(o,e)}Eg(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Ng(e),e=e.sibling}function Ng(e){switch(e.tag){case 0:case 11:case 15:Ul(e),e.flags&2048&&Xs(9,e,e.return);break;case 3:Ul(e);break;case 12:Ul(e);break;case 22:var r=e.stateNode;e.memoizedState!==null&&r._visibility&2&&(e.return===null||e.return.tag!==13)?(r._visibility&=-3,vc(e)):Ul(e);break;default:Ul(e)}}function vc(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var o=r[a];Hn=o,Rg(o,e)}Eg(e)}for(e=e.child;e!==null;){switch(r=e,r.tag){case 0:case 11:case 15:Xs(8,r,r.return),vc(r);break;case 22:a=r.stateNode,a._visibility&2&&(a._visibility&=-3,vc(r));break;default:vc(r)}e=e.sibling}}function Rg(e,r){for(;Hn!==null;){var a=Hn;switch(a.tag){case 0:case 11:case 15:Xs(8,a,r);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var o=a.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:xl(a.memoizedState.cache)}if(o=a.child,o!==null)o.return=a,Hn=o;else e:for(a=e;Hn!==null;){o=Hn;var h=o.sibling,g=o.return;if(vg(o),o===a){Hn=null;break e}if(h!==null){h.return=g,Hn=h;break e}Hn=g}}}var Pb={getCacheForType:function(e){var r=Wn(An),a=r.data.get(e);return a===void 0&&(a=e(),r.data.set(e,a)),a},cacheSignal:function(){return Wn(An).controller.signal}},Hb=typeof WeakMap=="function"?WeakMap:Map,Wt=0,an=null,Ot=null,Bt=0,Jt=0,Sr=null,Js=!1,xa=!1,Zd=!1,Ss=0,wn=0,Zs=0,Ai=0,eh=0,jr=0,ba=0,Ll=null,pr=null,th=!1,xc=0,Tg=0,bc=1/0,wc=null,ei=null,Ln=0,ti=null,wa=null,js=0,nh=0,rh=null,kg=null,Il=0,sh=null;function _r(){return(Wt&2)!==0&&Bt!==0?Bt&-Bt:T.T!==null?uh():ue()}function Ag(){if(jr===0)if((Bt&536870912)===0||Pt){var e=He;He<<=1,(He&3932160)===0&&(He=262144),jr=e}else jr=536870912;return e=br.current,e!==null&&(e.flags|=32),jr}function mr(e,r,a){(e===an&&(Jt===2||Jt===9)||e.cancelPendingCommit!==null)&&(Sa(e,0),ni(e,Bt,jr,!1)),Ut(e,a),((Wt&2)===0||e!==an)&&(e===an&&((Wt&2)===0&&(Ai|=a),wn===4&&ni(e,Bt,jr,!1)),rs(e))}function Og(e,r,a){if((Wt&6)!==0)throw Error(l(327));var o=!a&&(r&127)===0&&(r&e.expiredLanes)===0||At(e,r),h=o?Vb(e,r):ah(e,r,!0),g=o;do{if(h===0){xa&&!o&&ni(e,r,0,!1);break}else{if(a=e.current.alternate,g&&!Fb(a)){h=ah(e,r,!1),g=!1;continue}if(h===2){if(g=r,e.errorRecoveryDisabledLanes&g)var w=0;else w=e.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){r=w;e:{var R=e;h=Ll;var K=R.current.memoizedState.isDehydrated;if(K&&(Sa(R,w).flags|=256),w=ah(R,w,!1),w!==2){if(Zd&&!K){R.errorRecoveryDisabledLanes|=g,Ai|=g,h=4;break e}g=pr,pr=h,g!==null&&(pr===null?pr=g:pr.push.apply(pr,g))}h=w}if(g=!1,h!==2)continue}}if(h===1){Sa(e,0),ni(e,r,0,!0);break}e:{switch(o=e,g=h,g){case 0:case 1:throw Error(l(345));case 4:if((r&4194048)!==r)break;case 6:ni(o,r,jr,!Js);break e;case 2:pr=null;break;case 3:case 5:break;default:throw Error(l(329))}if((r&62914560)===r&&(h=xc+300-vt(),10<h)){if(ni(o,r,jr,!Js),Ge(o,0,!0)!==0)break e;js=r,o.timeoutHandle=cy(Dg.bind(null,o,a,pr,wc,th,r,jr,Ai,ba,Js,g,"Throttled",-0,0),h);break e}Dg(o,a,pr,wc,th,r,jr,Ai,ba,Js,g,null,-0,0)}}break}while(!0);rs(e)}function Dg(e,r,a,o,h,g,w,R,K,oe,be,Ne,he,ge){if(e.timeoutHandle=-1,Ne=r.subtreeFlags,Ne&8192||(Ne&16785408)===16785408){Ne={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Pr},Cg(r,g,Ne);var Ze=(g&62914560)===g?xc-vt():(g&4194048)===g?Tg-vt():0;if(Ze=Rw(Ne,Ze),Ze!==null){js=g,e.cancelPendingCommit=Ze(qg.bind(null,e,r,g,a,o,h,w,R,K,be,Ne,null,he,ge)),ni(e,g,w,!oe);return}}qg(e,r,g,a,o,h,w,R,K)}function Fb(e){for(var r=e;;){var a=r.tag;if((a===0||a===11||a===15)&&r.flags&16384&&(a=r.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var o=0;o<a.length;o++){var h=a[o],g=h.getSnapshot;h=h.value;try{if(!vr(g(),h))return!1}catch{return!1}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ni(e,r,a,o){r&=~eh,r&=~Ai,e.suspendedLanes|=r,e.pingedLanes&=~r,o&&(e.warmLanes|=r),o=e.expirationTimes;for(var h=r;0<h;){var g=31-ln(h),w=1<<g;o[g]=-1,h&=~w}a!==0&&Lt(e,a,r)}function Sc(){return(Wt&6)===0?(Bl(0),!1):!0}function ih(){if(Ot!==null){if(Jt===0)var e=Ot.return;else e=Ot,hs=Si=null,wd(e),ha=null,wl=0,e=Ot;for(;e!==null;)ug(e.alternate,e),e=e.return;Ot=null}}function Sa(e,r){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,uw(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),js=0,ih(),an=e,Ot=a=us(e.current,null),Bt=r,Jt=0,Sr=null,Js=!1,xa=At(e,r),Zd=!1,ba=jr=eh=Ai=Zs=wn=0,pr=Ll=null,th=!1,(r&8)!==0&&(r|=r&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=r;0<o;){var h=31-ln(o),g=1<<h;r|=e[h],o&=~g}return Ss=r,Ho(),a}function Mg(e,r){Rt=null,T.H=Tl,r===da||r===Xo?(r=Wp(),Jt=3):r===cd?(r=Wp(),Jt=4):Jt=r===Ld?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Sr=r,Ot===null&&(wn=1,dc(e,kr(r,e.current)))}function zg(){var e=br.current;return e===null?!0:(Bt&4194048)===Bt?Mr===null:(Bt&62914560)===Bt||(Bt&536870912)!==0?e===Mr:!1}function Ug(){var e=T.H;return T.H=Tl,e===null?Tl:e}function Lg(){var e=T.A;return T.A=Pb,e}function jc(){wn=4,Js||(Bt&4194048)!==Bt&&br.current!==null||(xa=!0),(Zs&134217727)===0&&(Ai&134217727)===0||an===null||ni(an,Bt,jr,!1)}function ah(e,r,a){var o=Wt;Wt|=2;var h=Ug(),g=Lg();(an!==e||Bt!==r)&&(wc=null,Sa(e,r)),r=!1;var w=wn;e:do try{if(Jt!==0&&Ot!==null){var R=Ot,K=Sr;switch(Jt){case 8:ih(),w=6;break e;case 3:case 2:case 9:case 6:br.current===null&&(r=!0);var oe=Jt;if(Jt=0,Sr=null,ja(e,R,K,oe),a&&xa){w=0;break e}break;default:oe=Jt,Jt=0,Sr=null,ja(e,R,K,oe)}}Gb(),w=wn;break}catch(be){Mg(e,be)}while(!0);return r&&e.shellSuspendCounter++,hs=Si=null,Wt=o,T.H=h,T.A=g,Ot===null&&(an=null,Bt=0,Ho()),w}function Gb(){for(;Ot!==null;)Ig(Ot)}function Vb(e,r){var a=Wt;Wt|=2;var o=Ug(),h=Lg();an!==e||Bt!==r?(wc=null,bc=vt()+500,Sa(e,r)):xa=At(e,r);e:do try{if(Jt!==0&&Ot!==null){r=Ot;var g=Sr;t:switch(Jt){case 1:Jt=0,Sr=null,ja(e,r,g,1);break;case 2:case 9:if(Kp(g)){Jt=0,Sr=null,Bg(r);break}r=function(){Jt!==2&&Jt!==9||an!==e||(Jt=7),rs(e)},g.then(r,r);break e;case 3:Jt=7;break e;case 4:Jt=5;break e;case 7:Kp(g)?(Jt=0,Sr=null,Bg(r)):(Jt=0,Sr=null,ja(e,r,g,7));break;case 5:var w=null;switch(Ot.tag){case 26:w=Ot.memoizedState;case 5:case 27:var R=Ot;if(w?_y(w):R.stateNode.complete){Jt=0,Sr=null;var K=R.sibling;if(K!==null)Ot=K;else{var oe=R.return;oe!==null?(Ot=oe,_c(oe)):Ot=null}break t}}Jt=0,Sr=null,ja(e,r,g,5);break;case 6:Jt=0,Sr=null,ja(e,r,g,6);break;case 8:ih(),wn=6;break e;default:throw Error(l(462))}}Yb();break}catch(be){Mg(e,be)}while(!0);return hs=Si=null,T.H=o,T.A=h,Wt=a,Ot!==null?0:(an=null,Bt=0,Ho(),wn)}function Yb(){for(;Ot!==null&&!zt();)Ig(Ot)}function Ig(e){var r=og(e.alternate,e,Ss);e.memoizedProps=e.pendingProps,r===null?_c(e):Ot=r}function Bg(e){var r=e,a=r.alternate;switch(r.tag){case 15:case 0:r=ng(a,r,r.pendingProps,r.type,void 0,Bt);break;case 11:r=ng(a,r,r.pendingProps,r.type.render,r.ref,Bt);break;case 5:wd(r);default:ug(a,r),r=Ot=Lp(r,Ss),r=og(a,r,Ss)}e.memoizedProps=e.pendingProps,r===null?_c(e):Ot=r}function ja(e,r,a,o){hs=Si=null,wd(r),ha=null,wl=0;var h=r.return;try{if(zb(e,h,r,a,Bt)){wn=1,dc(e,kr(a,e.current)),Ot=null;return}}catch(g){if(h!==null)throw Ot=h,g;wn=1,dc(e,kr(a,e.current)),Ot=null;return}r.flags&32768?(Pt||o===1?e=!0:xa||(Bt&536870912)!==0?e=!1:(Js=e=!0,(o===2||o===9||o===3||o===6)&&(o=br.current,o!==null&&o.tag===13&&(o.flags|=16384))),$g(r,e)):_c(r)}function _c(e){var r=e;do{if((r.flags&32768)!==0){$g(r,Js);return}e=r.return;var a=Ib(r.alternate,r,Ss);if(a!==null){Ot=a;return}if(r=r.sibling,r!==null){Ot=r;return}Ot=r=e}while(r!==null);wn===0&&(wn=5)}function $g(e,r){do{var a=Bb(e.alternate,e);if(a!==null){a.flags&=32767,Ot=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!r&&(e=e.sibling,e!==null)){Ot=e;return}Ot=e=a}while(e!==null);wn=6,Ot=null}function qg(e,r,a,o,h,g,w,R,K){e.cancelPendingCommit=null;do Cc();while(Ln!==0);if((Wt&6)!==0)throw Error(l(327));if(r!==null){if(r===e.current)throw Error(l(177));if(g=r.lanes|r.childLanes,g|=Ku,Fe(e,a,g,w,R,K),e===an&&(Ot=an=null,Bt=0),wa=r,ti=e,js=a,nh=g,rh=h,kg=o,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Xb(Te,function(){return Vg(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||o){o=T.T,T.T=null,h=I.p,I.p=2,w=Wt,Wt|=4;try{$b(e,r,a)}finally{Wt=w,I.p=h,T.T=o}}Ln=1,Pg(),Hg(),Fg()}}function Pg(){if(Ln===1){Ln=0;var e=ti,r=wa,a=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||a){a=T.T,T.T=null;var o=I.p;I.p=2;var h=Wt;Wt|=4;try{Sg(r,e);var g=vh,w=Rp(e.containerInfo),R=g.focusedElem,K=g.selectionRange;if(w!==R&&R&&R.ownerDocument&&Np(R.ownerDocument.documentElement,R)){if(K!==null&&Hu(R)){var oe=K.start,be=K.end;if(be===void 0&&(be=oe),"selectionStart"in R)R.selectionStart=oe,R.selectionEnd=Math.min(be,R.value.length);else{var Ne=R.ownerDocument||document,he=Ne&&Ne.defaultView||window;if(he.getSelection){var ge=he.getSelection(),Ze=R.textContent.length,pt=Math.min(K.start,Ze),sn=K.end===void 0?pt:Math.min(K.end,Ze);!ge.extend&&pt>sn&&(w=sn,sn=pt,pt=w);var re=Ep(R,pt),J=Ep(R,sn);if(re&&J&&(ge.rangeCount!==1||ge.anchorNode!==re.node||ge.anchorOffset!==re.offset||ge.focusNode!==J.node||ge.focusOffset!==J.offset)){var le=Ne.createRange();le.setStart(re.node,re.offset),ge.removeAllRanges(),pt>sn?(ge.addRange(le),ge.extend(J.node,J.offset)):(le.setEnd(J.node,J.offset),ge.addRange(le))}}}}for(Ne=[],ge=R;ge=ge.parentNode;)ge.nodeType===1&&Ne.push({element:ge,left:ge.scrollLeft,top:ge.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<Ne.length;R++){var Ce=Ne[R];Ce.element.scrollLeft=Ce.left,Ce.element.scrollTop=Ce.top}}Lc=!!yh,vh=yh=null}finally{Wt=h,I.p=o,T.T=a}}e.current=r,Ln=2}}function Hg(){if(Ln===2){Ln=0;var e=ti,r=wa,a=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||a){a=T.T,T.T=null;var o=I.p;I.p=2;var h=Wt;Wt|=4;try{yg(e,r.alternate,r)}finally{Wt=h,I.p=o,T.T=a}}Ln=3}}function Fg(){if(Ln===4||Ln===3){Ln=0,Gt();var e=ti,r=wa,a=js,o=kg;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?Ln=5:(Ln=0,wa=ti=null,Gg(e,e.pendingLanes));var h=e.pendingLanes;if(h===0&&(ei=null),ee(a),r=r.stateNode,bt&&typeof bt.onCommitFiberRoot=="function")try{bt.onCommitFiberRoot(jn,r,void 0,(r.current.flags&128)===128)}catch{}if(o!==null){r=T.T,h=I.p,I.p=2,T.T=null;try{for(var g=e.onRecoverableError,w=0;w<o.length;w++){var R=o[w];g(R.value,{componentStack:R.stack})}}finally{T.T=r,I.p=h}}(js&3)!==0&&Cc(),rs(e),h=e.pendingLanes,(a&261930)!==0&&(h&42)!==0?e===sh?Il++:(Il=0,sh=e):Il=0,Bl(0)}}function Gg(e,r){(e.pooledCacheLanes&=r)===0&&(r=e.pooledCache,r!=null&&(e.pooledCache=null,xl(r)))}function Cc(){return Pg(),Hg(),Fg(),Vg()}function Vg(){if(Ln!==5)return!1;var e=ti,r=nh;nh=0;var a=ee(js),o=T.T,h=I.p;try{I.p=32>a?32:a,T.T=null,a=rh,rh=null;var g=ti,w=js;if(Ln=0,wa=ti=null,js=0,(Wt&6)!==0)throw Error(l(331));var R=Wt;if(Wt|=4,Ng(g.current),_g(g,g.current,w,a),Wt=R,Bl(0,!1),bt&&typeof bt.onPostCommitFiberRoot=="function")try{bt.onPostCommitFiberRoot(jn,g)}catch{}return!0}finally{I.p=h,T.T=o,Gg(e,r)}}function Yg(e,r,a){r=kr(a,r),r=Ud(e.stateNode,r,2),e=Ks(e,r,2),e!==null&&(Ut(e,2),rs(e))}function Zt(e,r,a){if(e.tag===3)Yg(e,e,a);else for(;r!==null;){if(r.tag===3){Yg(r,e,a);break}else if(r.tag===1){var o=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(ei===null||!ei.has(o))){e=kr(a,e),a=Km(2),o=Ks(r,a,2),o!==null&&(Qm(a,o,r,e),Ut(o,2),rs(o));break}}r=r.return}}function lh(e,r,a){var o=e.pingCache;if(o===null){o=e.pingCache=new Hb;var h=new Set;o.set(r,h)}else h=o.get(r),h===void 0&&(h=new Set,o.set(r,h));h.has(a)||(Zd=!0,h.add(a),e=Kb.bind(null,e,r,a),r.then(e,e))}function Kb(e,r,a){var o=e.pingCache;o!==null&&o.delete(r),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,an===e&&(Bt&a)===a&&(wn===4||wn===3&&(Bt&62914560)===Bt&&300>vt()-xc?(Wt&2)===0&&Sa(e,0):eh|=a,ba===Bt&&(ba=0)),rs(e)}function Kg(e,r){r===0&&(r=Nt()),e=xi(e,r),e!==null&&(Ut(e,r),rs(e))}function Qb(e){var r=e.memoizedState,a=0;r!==null&&(a=r.retryLane),Kg(e,a)}function Wb(e,r){var a=0;switch(e.tag){case 31:case 13:var o=e.stateNode,h=e.memoizedState;h!==null&&(a=h.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(l(314))}o!==null&&o.delete(r),Kg(e,a)}function Xb(e,r){return mt(e,r)}var Ec=null,_a=null,oh=!1,Nc=!1,ch=!1,ri=0;function rs(e){e!==_a&&e.next===null&&(_a===null?Ec=_a=e:_a=_a.next=e),Nc=!0,oh||(oh=!0,Zb())}function Bl(e,r){if(!ch&&Nc){ch=!0;do for(var a=!1,o=Ec;o!==null;){if(e!==0){var h=o.pendingLanes;if(h===0)var g=0;else{var w=o.suspendedLanes,R=o.pingedLanes;g=(1<<31-ln(42|e)+1)-1,g&=h&~(w&~R),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(a=!0,Jg(o,g))}else g=Bt,g=Ge(o,o===an?g:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(g&3)===0||At(o,g)||(a=!0,Jg(o,g));o=o.next}while(a);ch=!1}}function Jb(){Qg()}function Qg(){Nc=oh=!1;var e=0;ri!==0&&cw()&&(e=ri);for(var r=vt(),a=null,o=Ec;o!==null;){var h=o.next,g=Wg(o,r);g===0?(o.next=null,a===null?Ec=h:a.next=h,h===null&&(_a=a)):(a=o,(e!==0||(g&3)!==0)&&(Nc=!0)),o=h}Ln!==0&&Ln!==5||Bl(e),ri!==0&&(ri=0)}function Wg(e,r){for(var a=e.suspendedLanes,o=e.pingedLanes,h=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var w=31-ln(g),R=1<<w,K=h[w];K===-1?((R&a)===0||(R&o)!==0)&&(h[w]=Ct(R,r)):K<=r&&(e.expiredLanes|=R),g&=~R}if(r=an,a=Bt,a=Ge(e,e===r?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,a===0||e===r&&(Jt===2||Jt===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&ht(o),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||At(e,a)){if(r=a&-a,r===e.callbackPriority)return r;switch(o!==null&&ht(o),ee(a)){case 2:case 8:a=Ee;break;case 32:a=Te;break;case 268435456:a=_t;break;default:a=Te}return o=Xg.bind(null,e),a=mt(a,o),e.callbackPriority=r,e.callbackNode=a,r}return o!==null&&o!==null&&ht(o),e.callbackPriority=2,e.callbackNode=null,2}function Xg(e,r){if(Ln!==0&&Ln!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Cc()&&e.callbackNode!==a)return null;var o=Bt;return o=Ge(e,e===an?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(Og(e,o,r),Wg(e,vt()),e.callbackNode!=null&&e.callbackNode===a?Xg.bind(null,e):null)}function Jg(e,r){if(Cc())return null;Og(e,r,!0)}function Zb(){dw(function(){(Wt&6)!==0?mt(we,Jb):Qg()})}function uh(){if(ri===0){var e=ca;e===0&&(e=pe,pe<<=1,(pe&261888)===0&&(pe=256)),ri=e}return ri}function Zg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Xi(""+e)}function ey(e,r){var a=r.ownerDocument.createElement("input");return a.name=r.name,a.value=r.value,e.id&&a.setAttribute("form",e.id),r.parentNode.insertBefore(a,r),e=new FormData(e),a.parentNode.removeChild(a),e}function ew(e,r,a,o,h){if(r==="submit"&&a&&a.stateNode===h){var g=Zg((h[xe]||null).action),w=o.submitter;w&&(r=(r=w[xe]||null)?Zg(r.formAction):w.getAttribute("formAction"),r!==null&&(g=r,w=null));var R=new fn("action","action",null,o,h);e.push({event:R,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(ri!==0){var K=w?ey(h,w):new FormData(h);kd(a,{pending:!0,data:K,method:h.method,action:g},null,K)}}else typeof g=="function"&&(R.preventDefault(),K=w?ey(h,w):new FormData(h),kd(a,{pending:!0,data:K,method:h.method,action:g},g,K))},currentTarget:h}]})}}for(var dh=0;dh<Yu.length;dh++){var hh=Yu[dh],tw=hh.toLowerCase(),nw=hh[0].toUpperCase()+hh.slice(1);Hr(tw,"on"+nw)}Hr(Ap,"onAnimationEnd"),Hr(Op,"onAnimationIteration"),Hr(Dp,"onAnimationStart"),Hr("dblclick","onDoubleClick"),Hr("focusin","onFocus"),Hr("focusout","onBlur"),Hr(vb,"onTransitionRun"),Hr(xb,"onTransitionStart"),Hr(bb,"onTransitionCancel"),Hr(Mp,"onTransitionEnd"),qr("onMouseEnter",["mouseout","mouseover"]),qr("onMouseLeave",["mouseout","mouseover"]),qr("onPointerEnter",["pointerout","pointerover"]),qr("onPointerLeave",["pointerout","pointerover"]),yr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),yr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),yr("onBeforeInput",["compositionend","keypress","textInput","paste"]),yr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $l="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat($l));function ty(e,r){r=(r&4)!==0;for(var a=0;a<e.length;a++){var o=e[a],h=o.event;o=o.listeners;e:{var g=void 0;if(r)for(var w=o.length-1;0<=w;w--){var R=o[w],K=R.instance,oe=R.currentTarget;if(R=R.listener,K!==g&&h.isPropagationStopped())break e;g=R,h.currentTarget=oe;try{g(h)}catch(be){Po(be)}h.currentTarget=null,g=K}else for(w=0;w<o.length;w++){if(R=o[w],K=R.instance,oe=R.currentTarget,R=R.listener,K!==g&&h.isPropagationStopped())break e;g=R,h.currentTarget=oe;try{g(h)}catch(be){Po(be)}h.currentTarget=null,g=K}}}}function Dt(e,r){var a=r[et];a===void 0&&(a=r[et]=new Set);var o=e+"__bubble";a.has(o)||(ny(r,e,2,!1),a.add(o))}function fh(e,r,a){var o=0;r&&(o|=4),ny(a,e,o,r)}var Rc="_reactListening"+Math.random().toString(36).slice(2);function ph(e){if(!e[Rc]){e[Rc]=!0,Ms.forEach(function(a){a!=="selectionchange"&&(rw.has(a)||fh(a,!1,e),fh(a,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[Rc]||(r[Rc]=!0,fh("selectionchange",!1,r))}}function ny(e,r,a,o){switch(Ay(r)){case 2:var h=Aw;break;case 8:h=Ow;break;default:h=Th}a=h.bind(null,r,a,e),h=void 0,!ve||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(h=!0),o?h!==void 0?e.addEventListener(r,a,{capture:!0,passive:h}):e.addEventListener(r,a,!0):h!==void 0?e.addEventListener(r,a,{passive:h}):e.addEventListener(r,a,!1)}function mh(e,r,a,o,h){var g=o;if((r&1)===0&&(r&2)===0&&o!==null)e:for(;;){if(o===null)return;var w=o.tag;if(w===3||w===4){var R=o.stateNode.containerInfo;if(R===h)break;if(w===4)for(w=o.return;w!==null;){var K=w.tag;if((K===3||K===4)&&w.stateNode.containerInfo===h)return;w=w.return}for(;R!==null;){if(w=Rn(R),w===null)return;if(K=w.tag,K===5||K===6||K===26||K===27){o=g=w;continue e}R=R.parentNode}}o=o.return}D(function(){var oe=g,be=ul(a),Ne=[];e:{var he=zp.get(e);if(he!==void 0){var ge=fn,Ze=e;switch(e){case"keypress":if(nt(a)===0)break e;case"keydown":case"keyup":ge=Wx;break;case"focusin":Ze="focus",ge=nr;break;case"focusout":Ze="blur",ge=nr;break;case"beforeblur":case"afterblur":ge=nr;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=un;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=Tn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=Zx;break;case Ap:case Op:case Dp:ge=os;break;case Mp:ge=tb;break;case"scroll":case"scrollend":ge=$s;break;case"wheel":ge=rb;break;case"copy":case"cut":case"paste":ge=qs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=hp;break;case"toggle":case"beforetoggle":ge=ib}var pt=(r&4)!==0,sn=!pt&&(e==="scroll"||e==="scrollend"),re=pt?he!==null?he+"Capture":null:he;pt=[];for(var J=oe,le;J!==null;){var Ce=J;if(le=Ce.stateNode,Ce=Ce.tag,Ce!==5&&Ce!==26&&Ce!==27||le===null||re===null||(Ce=X(J,re),Ce!=null&&pt.push(ql(J,Ce,le))),sn)break;J=J.return}0<pt.length&&(he=new ge(he,Ze,null,a,be),Ne.push({event:he,listeners:pt}))}}if((r&7)===0){e:{if(he=e==="mouseover"||e==="pointerover",ge=e==="mouseout"||e==="pointerout",he&&a!==cl&&(Ze=a.relatedTarget||a.fromElement)&&(Rn(Ze)||Ze[_e]))break e;if((ge||he)&&(he=be.window===be?be:(he=be.ownerDocument)?he.defaultView||he.parentWindow:window,ge?(Ze=a.relatedTarget||a.toElement,ge=oe,Ze=Ze?Rn(Ze):null,Ze!==null&&(sn=u(Ze),pt=Ze.tag,Ze!==sn||pt!==5&&pt!==27&&pt!==6)&&(Ze=null)):(ge=null,Ze=oe),ge!==Ze)){if(pt=un,Ce="onMouseLeave",re="onMouseEnter",J="mouse",(e==="pointerout"||e==="pointerover")&&(pt=hp,Ce="onPointerLeave",re="onPointerEnter",J="pointer"),sn=ge==null?he:on(ge),le=Ze==null?he:on(Ze),he=new pt(Ce,J+"leave",ge,a,be),he.target=sn,he.relatedTarget=le,Ce=null,Rn(be)===oe&&(pt=new pt(re,J+"enter",Ze,a,be),pt.target=le,pt.relatedTarget=sn,Ce=pt),sn=Ce,ge&&Ze)t:{for(pt=sw,re=ge,J=Ze,le=0,Ce=re;Ce;Ce=pt(Ce))le++;Ce=0;for(var ut=J;ut;ut=pt(ut))Ce++;for(;0<le-Ce;)re=pt(re),le--;for(;0<Ce-le;)J=pt(J),Ce--;for(;le--;){if(re===J||J!==null&&re===J.alternate){pt=re;break t}re=pt(re),J=pt(J)}pt=null}else pt=null;ge!==null&&ry(Ne,he,ge,pt,!1),Ze!==null&&sn!==null&&ry(Ne,sn,Ze,pt,!0)}}e:{if(he=oe?on(oe):window,ge=he.nodeName&&he.nodeName.toLowerCase(),ge==="select"||ge==="input"&&he.type==="file")var Vt=bp;else if(vp(he))if(wp)Vt=mb;else{Vt=fb;var st=hb}else ge=he.nodeName,!ge||ge.toLowerCase()!=="input"||he.type!=="checkbox"&&he.type!=="radio"?oe&&Wi(oe.elementType)&&(Vt=bp):Vt=pb;if(Vt&&(Vt=Vt(e,oe))){xp(Ne,Vt,a,be);break e}st&&st(e,he,oe),e==="focusout"&&oe&&he.type==="number"&&oe.memoizedProps.value!=null&&ol(he,"number",he.value)}switch(st=oe?on(oe):window,e){case"focusin":(vp(st)||st.contentEditable==="true")&&(ta=st,Fu=oe,gl=null);break;case"focusout":gl=Fu=ta=null;break;case"mousedown":Gu=!0;break;case"contextmenu":case"mouseup":case"dragend":Gu=!1,Tp(Ne,a,be);break;case"selectionchange":if(yb)break;case"keydown":case"keyup":Tp(Ne,a,be)}var kt;if($u)e:{switch(e){case"compositionstart":var $t="onCompositionStart";break e;case"compositionend":$t="onCompositionEnd";break e;case"compositionupdate":$t="onCompositionUpdate";break e}$t=void 0}else ea?gp(e,a)&&($t="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&($t="onCompositionStart");$t&&(fp&&a.locale!=="ko"&&(ea||$t!=="onCompositionStart"?$t==="onCompositionEnd"&&ea&&(kt=Ye()):(Ae=be,Be="value"in Ae?Ae.value:Ae.textContent,ea=!0)),st=Tc(oe,$t),0<st.length&&($t=new Iu($t,e,null,a,be),Ne.push({event:$t,listeners:st}),kt?$t.data=kt:(kt=yp(a),kt!==null&&($t.data=kt)))),(kt=lb?ob(e,a):cb(e,a))&&($t=Tc(oe,"onBeforeInput"),0<$t.length&&(st=new Iu("onBeforeInput","beforeinput",null,a,be),Ne.push({event:st,listeners:$t}),st.data=kt)),ew(Ne,e,oe,a,be)}ty(Ne,r)})}function ql(e,r,a){return{instance:e,listener:r,currentTarget:a}}function Tc(e,r){for(var a=r+"Capture",o=[];e!==null;){var h=e,g=h.stateNode;if(h=h.tag,h!==5&&h!==26&&h!==27||g===null||(h=X(e,a),h!=null&&o.unshift(ql(e,h,g)),h=X(e,r),h!=null&&o.push(ql(e,h,g))),e.tag===3)return o;e=e.return}return[]}function sw(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function ry(e,r,a,o,h){for(var g=r._reactName,w=[];a!==null&&a!==o;){var R=a,K=R.alternate,oe=R.stateNode;if(R=R.tag,K!==null&&K===o)break;R!==5&&R!==26&&R!==27||oe===null||(K=oe,h?(oe=X(a,g),oe!=null&&w.unshift(ql(a,oe,K))):h||(oe=X(a,g),oe!=null&&w.push(ql(a,oe,K)))),a=a.return}w.length!==0&&e.push({event:r,listeners:w})}var iw=/\r\n?/g,aw=/\u0000|\uFFFD/g;function sy(e){return(typeof e=="string"?e:""+e).replace(iw,`
`).replace(aw,"")}function iy(e,r){return r=sy(r),sy(e)===r}function rn(e,r,a,o,h,g){switch(a){case"children":typeof o=="string"?r==="body"||r==="textarea"&&o===""||ls(e,o):(typeof o=="number"||typeof o=="bigint")&&r!=="body"&&ls(e,""+o);break;case"className":zs(e,"class",o);break;case"tabIndex":zs(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":zs(e,a,o);break;case"style":Bo(e,o,g);break;case"data":if(r!=="object"){zs(e,"data",o);break}case"src":case"href":if(o===""&&(r!=="a"||a!=="href")){e.removeAttribute(a);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(a);break}o=Xi(""+o),e.setAttribute(a,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(a==="formAction"?(r!=="input"&&rn(e,r,"name",h.name,h,null),rn(e,r,"formEncType",h.formEncType,h,null),rn(e,r,"formMethod",h.formMethod,h,null),rn(e,r,"formTarget",h.formTarget,h,null)):(rn(e,r,"encType",h.encType,h,null),rn(e,r,"method",h.method,h,null),rn(e,r,"target",h.target,h,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(a);break}o=Xi(""+o),e.setAttribute(a,o);break;case"onClick":o!=null&&(e.onclick=Pr);break;case"onScroll":o!=null&&Dt("scroll",e);break;case"onScrollEnd":o!=null&&Dt("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(l(61));if(a=o.__html,a!=null){if(h.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}a=Xi(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,""+o):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":o===!0?e.setAttribute(a,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,o):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(a,o):e.removeAttribute(a);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(a):e.setAttribute(a,o);break;case"popover":Dt("beforetoggle",e),Dt("toggle",e),Ki(e,"popover",o);break;case"xlinkActuate":cr(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":cr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":cr(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":cr(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":cr(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":cr(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":cr(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":cr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":cr(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":Ki(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Lu.get(a)||a,Ki(e,a,o))}}function gh(e,r,a,o,h,g){switch(a){case"style":Bo(e,o,g);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(l(61));if(a=o.__html,a!=null){if(h.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"children":typeof o=="string"?ls(e,o):(typeof o=="number"||typeof o=="bigint")&&ls(e,""+o);break;case"onScroll":o!=null&&Dt("scroll",e);break;case"onScrollEnd":o!=null&&Dt("scrollend",e);break;case"onClick":o!=null&&(e.onclick=Pr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ar.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(h=a.endsWith("Capture"),r=a.slice(2,h?a.length-7:void 0),g=e[xe]||null,g=g!=null?g[a]:null,typeof g=="function"&&e.removeEventListener(r,g,h),typeof o=="function")){typeof g!="function"&&g!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(r,o,h);break e}a in e?e[a]=o:o===!0?e.setAttribute(a,""):Ki(e,a,o)}}}function Jn(e,r,a){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Dt("error",e),Dt("load",e);var o=!1,h=!1,g;for(g in a)if(a.hasOwnProperty(g)){var w=a[g];if(w!=null)switch(g){case"src":o=!0;break;case"srcSet":h=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:rn(e,r,g,w,a,null)}}h&&rn(e,r,"srcSet",a.srcSet,a,null),o&&rn(e,r,"src",a.src,a,null);return;case"input":Dt("invalid",e);var R=g=w=h=null,K=null,oe=null;for(o in a)if(a.hasOwnProperty(o)){var be=a[o];if(be!=null)switch(o){case"name":h=be;break;case"type":w=be;break;case"checked":K=be;break;case"defaultChecked":oe=be;break;case"value":g=be;break;case"defaultValue":R=be;break;case"children":case"dangerouslySetInnerHTML":if(be!=null)throw Error(l(137,r));break;default:rn(e,r,o,be,a,null)}}Us(e,g,R,K,oe,w,h,!1);return;case"select":Dt("invalid",e),o=w=g=null;for(h in a)if(a.hasOwnProperty(h)&&(R=a[h],R!=null))switch(h){case"value":g=R;break;case"defaultValue":w=R;break;case"multiple":o=R;default:rn(e,r,h,R,a,null)}r=g,a=w,e.multiple=!!o,r!=null?Ls(e,!!o,r,!1):a!=null&&Ls(e,!!o,a,!0);return;case"textarea":Dt("invalid",e),g=h=o=null;for(w in a)if(a.hasOwnProperty(w)&&(R=a[w],R!=null))switch(w){case"value":o=R;break;case"defaultValue":h=R;break;case"children":g=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(l(91));break;default:rn(e,r,w,R,a,null)}Uo(e,o,h,g);return;case"option":for(K in a)a.hasOwnProperty(K)&&(o=a[K],o!=null)&&(K==="selected"?e.selected=o&&typeof o!="function"&&typeof o!="symbol":rn(e,r,K,o,a,null));return;case"dialog":Dt("beforetoggle",e),Dt("toggle",e),Dt("cancel",e),Dt("close",e);break;case"iframe":case"object":Dt("load",e);break;case"video":case"audio":for(o=0;o<$l.length;o++)Dt($l[o],e);break;case"image":Dt("error",e),Dt("load",e);break;case"details":Dt("toggle",e);break;case"embed":case"source":case"link":Dt("error",e),Dt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(oe in a)if(a.hasOwnProperty(oe)&&(o=a[oe],o!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:rn(e,r,oe,o,a,null)}return;default:if(Wi(r)){for(be in a)a.hasOwnProperty(be)&&(o=a[be],o!==void 0&&gh(e,r,be,o,a,void 0));return}}for(R in a)a.hasOwnProperty(R)&&(o=a[R],o!=null&&rn(e,r,R,o,a,null))}function lw(e,r,a,o){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var h=null,g=null,w=null,R=null,K=null,oe=null,be=null;for(ge in a){var Ne=a[ge];if(a.hasOwnProperty(ge)&&Ne!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":K=Ne;default:o.hasOwnProperty(ge)||rn(e,r,ge,null,o,Ne)}}for(var he in o){var ge=o[he];if(Ne=a[he],o.hasOwnProperty(he)&&(ge!=null||Ne!=null))switch(he){case"type":g=ge;break;case"name":h=ge;break;case"checked":oe=ge;break;case"defaultChecked":be=ge;break;case"value":w=ge;break;case"defaultValue":R=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(l(137,r));break;default:ge!==Ne&&rn(e,r,he,ge,o,Ne)}}ll(e,w,R,K,oe,be,g,h);return;case"select":ge=w=R=he=null;for(g in a)if(K=a[g],a.hasOwnProperty(g)&&K!=null)switch(g){case"value":break;case"multiple":ge=K;default:o.hasOwnProperty(g)||rn(e,r,g,null,o,K)}for(h in o)if(g=o[h],K=a[h],o.hasOwnProperty(h)&&(g!=null||K!=null))switch(h){case"value":he=g;break;case"defaultValue":R=g;break;case"multiple":w=g;default:g!==K&&rn(e,r,h,g,o,K)}r=R,a=w,o=ge,he!=null?Ls(e,!!a,he,!1):!!o!=!!a&&(r!=null?Ls(e,!!a,r,!0):Ls(e,!!a,a?[]:"",!1));return;case"textarea":ge=he=null;for(R in a)if(h=a[R],a.hasOwnProperty(R)&&h!=null&&!o.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:rn(e,r,R,null,o,h)}for(w in o)if(h=o[w],g=a[w],o.hasOwnProperty(w)&&(h!=null||g!=null))switch(w){case"value":he=h;break;case"defaultValue":ge=h;break;case"children":break;case"dangerouslySetInnerHTML":if(h!=null)throw Error(l(91));break;default:h!==g&&rn(e,r,w,h,o,g)}zo(e,he,ge);return;case"option":for(var Ze in a)he=a[Ze],a.hasOwnProperty(Ze)&&he!=null&&!o.hasOwnProperty(Ze)&&(Ze==="selected"?e.selected=!1:rn(e,r,Ze,null,o,he));for(K in o)he=o[K],ge=a[K],o.hasOwnProperty(K)&&he!==ge&&(he!=null||ge!=null)&&(K==="selected"?e.selected=he&&typeof he!="function"&&typeof he!="symbol":rn(e,r,K,he,o,ge));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pt in a)he=a[pt],a.hasOwnProperty(pt)&&he!=null&&!o.hasOwnProperty(pt)&&rn(e,r,pt,null,o,he);for(oe in o)if(he=o[oe],ge=a[oe],o.hasOwnProperty(oe)&&he!==ge&&(he!=null||ge!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(l(137,r));break;default:rn(e,r,oe,he,o,ge)}return;default:if(Wi(r)){for(var sn in a)he=a[sn],a.hasOwnProperty(sn)&&he!==void 0&&!o.hasOwnProperty(sn)&&gh(e,r,sn,void 0,o,he);for(be in o)he=o[be],ge=a[be],!o.hasOwnProperty(be)||he===ge||he===void 0&&ge===void 0||gh(e,r,be,he,o,ge);return}}for(var re in a)he=a[re],a.hasOwnProperty(re)&&he!=null&&!o.hasOwnProperty(re)&&rn(e,r,re,null,o,he);for(Ne in o)he=o[Ne],ge=a[Ne],!o.hasOwnProperty(Ne)||he===ge||he==null&&ge==null||rn(e,r,Ne,he,o,ge)}function ay(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ow(){if(typeof performance.getEntriesByType=="function"){for(var e=0,r=0,a=performance.getEntriesByType("resource"),o=0;o<a.length;o++){var h=a[o],g=h.transferSize,w=h.initiatorType,R=h.duration;if(g&&R&&ay(w)){for(w=0,R=h.responseEnd,o+=1;o<a.length;o++){var K=a[o],oe=K.startTime;if(oe>R)break;var be=K.transferSize,Ne=K.initiatorType;be&&ay(Ne)&&(K=K.responseEnd,w+=be*(K<R?1:(R-oe)/(K-oe)))}if(--o,r+=8*(g+w)/(h.duration/1e3),e++,10<e)break}}if(0<e)return r/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var yh=null,vh=null;function kc(e){return e.nodeType===9?e:e.ownerDocument}function ly(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function oy(e,r){if(e===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&r==="foreignObject"?0:e}function xh(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var bh=null;function cw(){var e=window.event;return e&&e.type==="popstate"?e===bh?!1:(bh=e,!0):(bh=null,!1)}var cy=typeof setTimeout=="function"?setTimeout:void 0,uw=typeof clearTimeout=="function"?clearTimeout:void 0,uy=typeof Promise=="function"?Promise:void 0,dw=typeof queueMicrotask=="function"?queueMicrotask:typeof uy<"u"?function(e){return uy.resolve(null).then(e).catch(hw)}:cy;function hw(e){setTimeout(function(){throw e})}function si(e){return e==="head"}function dy(e,r){var a=r,o=0;do{var h=a.nextSibling;if(e.removeChild(a),h&&h.nodeType===8)if(a=h.data,a==="/$"||a==="/&"){if(o===0){e.removeChild(h),Ra(r);return}o--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")o++;else if(a==="html")Pl(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,Pl(a);for(var g=a.firstChild;g;){var w=g.nextSibling,R=g.nodeName;g[xt]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&g.rel.toLowerCase()==="stylesheet"||a.removeChild(g),g=w}}else a==="body"&&Pl(e.ownerDocument.body);a=h}while(a);Ra(r)}function hy(e,r){var a=e;e=0;do{var o=a.nextSibling;if(a.nodeType===1?r?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(r?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),o&&o.nodeType===8)if(a=o.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=o}while(a)}function wh(e){var r=e.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var a=r;switch(r=r.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":wh(a),Ft(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function fw(e,r,a,o){for(;e.nodeType===1;){var h=a;if(e.nodeName.toLowerCase()!==r.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[xt])switch(r){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==h.rel||e.getAttribute("href")!==(h.href==null||h.href===""?null:h.href)||e.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin)||e.getAttribute("title")!==(h.title==null?null:h.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(h.src==null?null:h.src)||e.getAttribute("type")!==(h.type==null?null:h.type)||e.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(r==="input"&&e.type==="hidden"){var g=h.name==null?null:""+h.name;if(h.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=zr(e.nextSibling),e===null)break}return null}function pw(e,r,a){if(r==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=zr(e.nextSibling),e===null))return null;return e}function fy(e,r){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=zr(e.nextSibling),e===null))return null;return e}function Sh(e){return e.data==="$?"||e.data==="$~"}function jh(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function mw(e,r){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=r;else if(e.data!=="$?"||a.readyState!=="loading")r();else{var o=function(){r(),a.removeEventListener("DOMContentLoaded",o)};a.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function zr(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return e}var _h=null;function py(e){e=e.nextSibling;for(var r=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(r===0)return zr(e.nextSibling);r--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||r++}e=e.nextSibling}return null}function my(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(r===0)return e;r--}else a!=="/$"&&a!=="/&"||r++}e=e.previousSibling}return null}function gy(e,r,a){switch(r=kc(a),e){case"html":if(e=r.documentElement,!e)throw Error(l(452));return e;case"head":if(e=r.head,!e)throw Error(l(453));return e;case"body":if(e=r.body,!e)throw Error(l(454));return e;default:throw Error(l(451))}}function Pl(e){for(var r=e.attributes;r.length;)e.removeAttributeNode(r[0]);Ft(e)}var Ur=new Map,yy=new Set;function Ac(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var _s=I.d;I.d={f:gw,r:yw,D:vw,C:xw,L:bw,m:ww,X:jw,S:Sw,M:_w};function gw(){var e=_s.f(),r=Sc();return e||r}function yw(e){var r=St(e);r!==null&&r.tag===5&&r.type==="form"?Mm(r):_s.r(e)}var Ca=typeof document>"u"?null:document;function vy(e,r,a){var o=Ca;if(o&&typeof r=="string"&&r){var h=ur(r);h='link[rel="'+e+'"][href="'+h+'"]',typeof a=="string"&&(h+='[crossorigin="'+a+'"]'),yy.has(h)||(yy.add(h),e={rel:e,crossOrigin:a,href:r},o.querySelector(h)===null&&(r=o.createElement("link"),Jn(r,"link",e),qt(r),o.head.appendChild(r)))}}function vw(e){_s.D(e),vy("dns-prefetch",e,null)}function xw(e,r){_s.C(e,r),vy("preconnect",e,r)}function bw(e,r,a){_s.L(e,r,a);var o=Ca;if(o&&e&&r){var h='link[rel="preload"][as="'+ur(r)+'"]';r==="image"&&a&&a.imageSrcSet?(h+='[imagesrcset="'+ur(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(h+='[imagesizes="'+ur(a.imageSizes)+'"]')):h+='[href="'+ur(e)+'"]';var g=h;switch(r){case"style":g=Ea(e);break;case"script":g=Na(e)}Ur.has(g)||(e=v({rel:"preload",href:r==="image"&&a&&a.imageSrcSet?void 0:e,as:r},a),Ur.set(g,e),o.querySelector(h)!==null||r==="style"&&o.querySelector(Hl(g))||r==="script"&&o.querySelector(Fl(g))||(r=o.createElement("link"),Jn(r,"link",e),qt(r),o.head.appendChild(r)))}}function ww(e,r){_s.m(e,r);var a=Ca;if(a&&e){var o=r&&typeof r.as=="string"?r.as:"script",h='link[rel="modulepreload"][as="'+ur(o)+'"][href="'+ur(e)+'"]',g=h;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Na(e)}if(!Ur.has(g)&&(e=v({rel:"modulepreload",href:e},r),Ur.set(g,e),a.querySelector(h)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Fl(g)))return}o=a.createElement("link"),Jn(o,"link",e),qt(o),a.head.appendChild(o)}}}function Sw(e,r,a){_s.S(e,r,a);var o=Ca;if(o&&e){var h=Yn(o).hoistableStyles,g=Ea(e);r=r||"default";var w=h.get(g);if(!w){var R={loading:0,preload:null};if(w=o.querySelector(Hl(g)))R.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":r},a),(a=Ur.get(g))&&Ch(e,a);var K=w=o.createElement("link");qt(K),Jn(K,"link",e),K._p=new Promise(function(oe,be){K.onload=oe,K.onerror=be}),K.addEventListener("load",function(){R.loading|=1}),K.addEventListener("error",function(){R.loading|=2}),R.loading|=4,Oc(w,r,o)}w={type:"stylesheet",instance:w,count:1,state:R},h.set(g,w)}}}function jw(e,r){_s.X(e,r);var a=Ca;if(a&&e){var o=Yn(a).hoistableScripts,h=Na(e),g=o.get(h);g||(g=a.querySelector(Fl(h)),g||(e=v({src:e,async:!0},r),(r=Ur.get(h))&&Eh(e,r),g=a.createElement("script"),qt(g),Jn(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},o.set(h,g))}}function _w(e,r){_s.M(e,r);var a=Ca;if(a&&e){var o=Yn(a).hoistableScripts,h=Na(e),g=o.get(h);g||(g=a.querySelector(Fl(h)),g||(e=v({src:e,async:!0,type:"module"},r),(r=Ur.get(h))&&Eh(e,r),g=a.createElement("script"),qt(g),Jn(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},o.set(h,g))}}function xy(e,r,a,o){var h=(h=Se.current)?Ac(h):null;if(!h)throw Error(l(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(r=Ea(a.href),a=Yn(h).hoistableStyles,o=a.get(r),o||(o={type:"style",instance:null,count:0,state:null},a.set(r,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=Ea(a.href);var g=Yn(h).hoistableStyles,w=g.get(e);if(w||(h=h.ownerDocument||h,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,w),(g=h.querySelector(Hl(e)))&&!g._p&&(w.instance=g,w.state.loading=5),Ur.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Ur.set(e,a),g||Cw(h,e,a,w.state))),r&&o===null)throw Error(l(528,""));return w}if(r&&o!==null)throw Error(l(529,""));return null;case"script":return r=a.async,a=a.src,typeof a=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Na(a),a=Yn(h).hoistableScripts,o=a.get(r),o||(o={type:"script",instance:null,count:0,state:null},a.set(r,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,e))}}function Ea(e){return'href="'+ur(e)+'"'}function Hl(e){return'link[rel="stylesheet"]['+e+"]"}function by(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function Cw(e,r,a,o){e.querySelector('link[rel="preload"][as="style"]['+r+"]")?o.loading=1:(r=e.createElement("link"),o.preload=r,r.addEventListener("load",function(){return o.loading|=1}),r.addEventListener("error",function(){return o.loading|=2}),Jn(r,"link",a),qt(r),e.head.appendChild(r))}function Na(e){return'[src="'+ur(e)+'"]'}function Fl(e){return"script[async]"+e}function wy(e,r,a){if(r.count++,r.instance===null)switch(r.type){case"style":var o=e.querySelector('style[data-href~="'+ur(a.href)+'"]');if(o)return r.instance=o,qt(o),o;var h=v({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),qt(o),Jn(o,"style",h),Oc(o,a.precedence,e),r.instance=o;case"stylesheet":h=Ea(a.href);var g=e.querySelector(Hl(h));if(g)return r.state.loading|=4,r.instance=g,qt(g),g;o=by(a),(h=Ur.get(h))&&Ch(o,h),g=(e.ownerDocument||e).createElement("link"),qt(g);var w=g;return w._p=new Promise(function(R,K){w.onload=R,w.onerror=K}),Jn(g,"link",o),r.state.loading|=4,Oc(g,a.precedence,e),r.instance=g;case"script":return g=Na(a.src),(h=e.querySelector(Fl(g)))?(r.instance=h,qt(h),h):(o=a,(h=Ur.get(g))&&(o=v({},a),Eh(o,h)),e=e.ownerDocument||e,h=e.createElement("script"),qt(h),Jn(h,"link",o),e.head.appendChild(h),r.instance=h);case"void":return null;default:throw Error(l(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(o=r.instance,r.state.loading|=4,Oc(o,a.precedence,e));return r.instance}function Oc(e,r,a){for(var o=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),h=o.length?o[o.length-1]:null,g=h,w=0;w<o.length;w++){var R=o[w];if(R.dataset.precedence===r)g=R;else if(g!==h)break}g?g.parentNode.insertBefore(e,g.nextSibling):(r=a.nodeType===9?a.head:a,r.insertBefore(e,r.firstChild))}function Ch(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.title==null&&(e.title=r.title)}function Eh(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.integrity==null&&(e.integrity=r.integrity)}var Dc=null;function Sy(e,r,a){if(Dc===null){var o=new Map,h=Dc=new Map;h.set(a,o)}else h=Dc,o=h.get(a),o||(o=new Map,h.set(a,o));if(o.has(e))return o;for(o.set(e,null),a=a.getElementsByTagName(e),h=0;h<a.length;h++){var g=a[h];if(!(g[xt]||g[H]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var w=g.getAttribute(r)||"";w=e+w;var R=o.get(w);R?R.push(g):o.set(w,[g])}}return o}function jy(e,r,a){e=e.ownerDocument||e,e.head.insertBefore(a,r==="title"?e.querySelector("head > title"):null)}function Ew(e,r,a){if(a===1||r.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(e=r.disabled,typeof r.precedence=="string"&&e==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function _y(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function Nw(e,r,a,o){if(a.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var h=Ea(o.href),g=r.querySelector(Hl(h));if(g){r=g._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(e.count++,e=Mc.bind(e),r.then(e,e)),a.state.loading|=4,a.instance=g,qt(g);return}g=r.ownerDocument||r,o=by(o),(h=Ur.get(h))&&Ch(o,h),g=g.createElement("link"),qt(g);var w=g;w._p=new Promise(function(R,K){w.onload=R,w.onerror=K}),Jn(g,"link",o),a.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,r),(r=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=Mc.bind(e),r.addEventListener("load",a),r.addEventListener("error",a))}}var Nh=0;function Rw(e,r){return e.stylesheets&&e.count===0&&Uc(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var o=setTimeout(function(){if(e.stylesheets&&Uc(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+r);0<e.imgBytes&&Nh===0&&(Nh=62500*ow());var h=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Uc(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>Nh?50:800)+r);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(o),clearTimeout(h)}}:null}function Mc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Uc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var zc=null;function Uc(e,r){e.stylesheets=null,e.unsuspend!==null&&(e.count++,zc=new Map,r.forEach(Tw,e),zc=null,Mc.call(e))}function Tw(e,r){if(!(r.state.loading&4)){var a=zc.get(e);if(a)var o=a.get(null);else{a=new Map,zc.set(e,a);for(var h=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<h.length;g++){var w=h[g];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(a.set(w.dataset.precedence,w),o=w)}o&&a.set(null,o)}h=r.instance,w=h.getAttribute("data-precedence"),g=a.get(w)||o,g===o&&a.set(null,h),a.set(w,h),this.count++,o=Mc.bind(this),h.addEventListener("load",o),h.addEventListener("error",o),g?g.parentNode.insertBefore(h,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(h,e.firstChild)),r.state.loading|=4}}var Gl={$$typeof:z,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function kw(e,r,a,o,h,g,w,R,K){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Je(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Je(0),this.hiddenUpdates=Je(null),this.identifierPrefix=o,this.onUncaughtError=h,this.onCaughtError=g,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function Cy(e,r,a,o,h,g,w,R,K,oe,be,Ne){return e=new kw(e,r,a,w,K,oe,be,Ne,R),r=1,g===!0&&(r|=24),g=xr(3,null,null,r),e.current=g,g.stateNode=e,r=ad(),r.refCount++,e.pooledCache=r,r.refCount++,g.memoizedState={element:o,isDehydrated:a,cache:r},ud(g),e}function Ey(e){return e?(e=sa,e):sa}function Ny(e,r,a,o,h,g){h=Ey(h),o.context===null?o.context=h:o.pendingContext=h,o=Ys(r),o.payload={element:a},g=g===void 0?null:g,g!==null&&(o.callback=g),a=Ks(e,o,r),a!==null&&(mr(a,e,r),jl(a,e,r))}function Ry(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<r?a:r}}function Rh(e,r){Ry(e,r),(e=e.alternate)&&Ry(e,r)}function Ty(e){if(e.tag===13||e.tag===31){var r=xi(e,67108864);r!==null&&mr(r,e,67108864),Rh(e,67108864)}}function ky(e){if(e.tag===13||e.tag===31){var r=_r();r=te(r);var a=xi(e,r);a!==null&&mr(a,e,r),Rh(e,r)}}var Lc=!0;function Aw(e,r,a,o){var h=T.T;T.T=null;var g=I.p;try{I.p=2,Th(e,r,a,o)}finally{I.p=g,T.T=h}}function Ow(e,r,a,o){var h=T.T;T.T=null;var g=I.p;try{I.p=8,Th(e,r,a,o)}finally{I.p=g,T.T=h}}function Th(e,r,a,o){if(Lc){var h=kh(o);if(h===null)mh(e,r,o,Ic,a),Oy(e,o);else if(Mw(h,e,r,a,o))o.stopPropagation();else if(Oy(e,o),r&4&&-1<Dw.indexOf(e)){for(;h!==null;){var g=St(h);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var w=Ve(g.pendingLanes);if(w!==0){var R=g;for(R.pendingLanes|=2,R.entangledLanes|=2;w;){var K=1<<31-ln(w);R.entanglements[1]|=K,w&=~K}rs(g),(Wt&6)===0&&(bc=vt()+500,Bl(0))}}break;case 31:case 13:R=xi(g,2),R!==null&&mr(R,g,2),Sc(),Rh(g,2)}if(g=kh(o),g===null&&mh(e,r,o,Ic,a),g===h)break;h=g}h!==null&&o.stopPropagation()}else mh(e,r,o,null,a)}}function kh(e){return e=ul(e),Ah(e)}var Ic=null;function Ah(e){if(Ic=null,e=Rn(e),e!==null){var r=u(e);if(r===null)e=null;else{var a=r.tag;if(a===13){if(e=d(r),e!==null)return e;e=null}else if(a===31){if(e=p(r),e!==null)return e;e=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null)}}return Ic=e,null}function Ay(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case we:return 2;case Ee:return 8;case Te:case tt:return 32;case _t:return 268435456;default:return 32}default:return 32}}var Oh=!1,ii=null,ai=null,li=null,Vl=new Map,Yl=new Map,oi=[],Dw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Oy(e,r){switch(e){case"focusin":case"focusout":ii=null;break;case"dragenter":case"dragleave":ai=null;break;case"mouseover":case"mouseout":li=null;break;case"pointerover":case"pointerout":Vl.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yl.delete(r.pointerId)}}function Kl(e,r,a,o,h,g){return e===null||e.nativeEvent!==g?(e={blockedOn:r,domEventName:a,eventSystemFlags:o,nativeEvent:g,targetContainers:[h]},r!==null&&(r=St(r),r!==null&&Ty(r)),e):(e.eventSystemFlags|=o,r=e.targetContainers,h!==null&&r.indexOf(h)===-1&&r.push(h),e)}function Mw(e,r,a,o,h){switch(r){case"focusin":return ii=Kl(ii,e,r,a,o,h),!0;case"dragenter":return ai=Kl(ai,e,r,a,o,h),!0;case"mouseover":return li=Kl(li,e,r,a,o,h),!0;case"pointerover":var g=h.pointerId;return Vl.set(g,Kl(Vl.get(g)||null,e,r,a,o,h)),!0;case"gotpointercapture":return g=h.pointerId,Yl.set(g,Kl(Yl.get(g)||null,e,r,a,o,h)),!0}return!1}function Dy(e){var r=Rn(e.target);if(r!==null){var a=u(r);if(a!==null){if(r=a.tag,r===13){if(r=d(a),r!==null){e.blockedOn=r,je(e.priority,function(){ky(a)});return}}else if(r===31){if(r=p(a),r!==null){e.blockedOn=r,je(e.priority,function(){ky(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Bc(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var a=kh(e.nativeEvent);if(a===null){a=e.nativeEvent;var o=new a.constructor(a.type,a);cl=o,a.target.dispatchEvent(o),cl=null}else return r=St(a),r!==null&&Ty(r),e.blockedOn=a,!1;r.shift()}return!0}function My(e,r,a){Bc(e)&&a.delete(r)}function zw(){Oh=!1,ii!==null&&Bc(ii)&&(ii=null),ai!==null&&Bc(ai)&&(ai=null),li!==null&&Bc(li)&&(li=null),Vl.forEach(My),Yl.forEach(My)}function $c(e,r){e.blockedOn===r&&(e.blockedOn=null,Oh||(Oh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,zw)))}var qc=null;function zy(e){qc!==e&&(qc=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){qc===e&&(qc=null);for(var r=0;r<e.length;r+=3){var a=e[r],o=e[r+1],h=e[r+2];if(typeof o!="function"){if(Ah(o||a)===null)continue;break}var g=St(a);g!==null&&(e.splice(r,3),r-=3,kd(g,{pending:!0,data:h,method:a.method,action:o},o,h))}}))}function Ra(e){function r(K){return $c(K,e)}ii!==null&&$c(ii,e),ai!==null&&$c(ai,e),li!==null&&$c(li,e),Vl.forEach(r),Yl.forEach(r);for(var a=0;a<oi.length;a++){var o=oi[a];o.blockedOn===e&&(o.blockedOn=null)}for(;0<oi.length&&(a=oi[0],a.blockedOn===null);)Dy(a),a.blockedOn===null&&oi.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(o=0;o<a.length;o+=3){var h=a[o],g=a[o+1],w=h[xe]||null;if(typeof g=="function")w||zy(a);else if(w){var R=null;if(g&&g.hasAttribute("formAction")){if(h=g,w=g[xe]||null)R=w.formAction;else if(Ah(h)!==null)continue}else R=w.action;typeof R=="function"?a[o+1]=R:(a.splice(o,3),o-=3),zy(a)}}}function Uy(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(w){return h=w})},focusReset:"manual",scroll:"manual"})}function r(){h!==null&&(h(),h=null),o||setTimeout(a,20)}function a(){if(!o&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var o=!1,h=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(a,100),function(){o=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),h!==null&&(h(),h=null)}}}function Dh(e){this._internalRoot=e}Pc.prototype.render=Dh.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(l(409));var a=r.current,o=_r();Ny(a,o,e,r,null,null)},Pc.prototype.unmount=Dh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;Ny(e.current,2,null,e,null,null),Sc(),r[_e]=null}};function Pc(e){this._internalRoot=e}Pc.prototype.unstable_scheduleHydration=function(e){if(e){var r=ue();e={blockedOn:null,target:e,priority:r};for(var a=0;a<oi.length&&r!==0&&r<oi[a].priority;a++);oi.splice(a,0,e),a===0&&Dy(e)}};var Ly=t.version;if(Ly!=="19.2.3")throw Error(l(527,Ly,"19.2.3"));I.findDOMNode=function(e){var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(l(188)):(e=Object.keys(e).join(","),Error(l(268,e)));return e=m(r),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var Uw={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hc.isDisabled&&Hc.supportsFiber)try{jn=Hc.inject(Uw),bt=Hc}catch{}}return Wl.createRoot=function(e,r){if(!c(e))throw Error(l(299));var a=!1,o="",h=Fm,g=Gm,w=Vm;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onUncaughtError!==void 0&&(h=r.onUncaughtError),r.onCaughtError!==void 0&&(g=r.onCaughtError),r.onRecoverableError!==void 0&&(w=r.onRecoverableError)),r=Cy(e,1,!1,null,null,a,o,null,h,g,w,Uy),e[_e]=r.current,ph(e),new Dh(r)},Wl.hydrateRoot=function(e,r,a){if(!c(e))throw Error(l(299));var o=!1,h="",g=Fm,w=Gm,R=Vm,K=null;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(h=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(R=a.onRecoverableError),a.formState!==void 0&&(K=a.formState)),r=Cy(e,1,!0,r,a??null,o,h,K,g,w,R,Uy),r.context=Ey(null),a=r.current,o=_r(),o=te(o),h=Ys(o),h.callback=null,Ks(a,h,o),a=o,r.current.lanes=a,Ut(r,a),rs(r),e[_e]=r.current,ph(e),new Pc(r)},Wl.version="19.2.3",Wl}var Yy;function Gw(){if(Yy)return Uh.exports;Yy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Uh.exports=Fw(),Uh.exports}var Vw=Gw();var Ky="popstate";function Yw(n={}){function t(l,c){let{pathname:u,search:d,hash:p}=l.location;return jf("",{pathname:u,search:d,hash:p},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function s(l,c){return typeof c=="string"?c:co(c)}return Qw(t,s,null,n)}function Pn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Br(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Kw(){return Math.random().toString(36).substring(2,10)}function Qy(n,t){return{usr:n.state,key:n.key,idx:t}}function jf(n,t,s=null,l){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?jo(t):t,state:s,key:t&&t.key||l||Kw()}}function co({pathname:n="/",search:t="",hash:s=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function jo(n){let t={};if(n){let s=n.indexOf("#");s>=0&&(t.hash=n.substring(s),n=n.substring(0,s));let l=n.indexOf("?");l>=0&&(t.search=n.substring(l),n=n.substring(0,l)),n&&(t.pathname=n)}return t}function Qw(n,t,s,l={}){let{window:c=document.defaultView,v5Compat:u=!1}=l,d=c.history,p="POP",f=null,m=y();m==null&&(m=0,d.replaceState({...d.state,idx:m},""));function y(){return(d.state||{idx:null}).idx}function v(){p="POP";let j=y(),N=j==null?null:j-m;m=j,f&&f({action:p,location:E.location,delta:N})}function x(j,N){p="PUSH";let A=jf(E.location,j,N);m=y()+1;let z=Qy(A,m),B=E.createHref(A);try{d.pushState(z,"",B)}catch(L){if(L instanceof DOMException&&L.name==="DataCloneError")throw L;c.location.assign(B)}u&&f&&f({action:p,location:E.location,delta:1})}function S(j,N){p="REPLACE";let A=jf(E.location,j,N);m=y();let z=Qy(A,m),B=E.createHref(A);d.replaceState(z,"",B),u&&f&&f({action:p,location:E.location,delta:0})}function C(j){return Ww(j)}let E={get action(){return p},get location(){return n(c,d)},listen(j){if(f)throw new Error("A history only accepts one active listener");return c.addEventListener(Ky,v),f=j,()=>{c.removeEventListener(Ky,v),f=null}},createHref(j){return t(c,j)},createURL:C,encodeLocation(j){let N=C(j);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:x,replace:S,go(j){return d.go(j)}};return E}function Ww(n,t=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),Pn(s,"No window.location.(origin|href) available to create URL");let l=typeof n=="string"?n:co(n);return l=l.replace(/ $/,"%20"),!t&&l.startsWith("//")&&(l=s+l),new URL(l,s)}function w0(n,t,s="/"){return Xw(n,t,s,!1)}function Xw(n,t,s,l){let c=typeof t=="string"?jo(t):t,u=Ts(c.pathname||"/",s);if(u==null)return null;let d=S0(n);Jw(d);let p=null;for(let f=0;p==null&&f<d.length;++f){let m=cS(u);p=lS(d[f],m,l)}return p}function S0(n,t=[],s=[],l="",c=!1){let u=(d,p,f=c,m)=>{let y={relativePath:m===void 0?d.path||"":m,caseSensitive:d.caseSensitive===!0,childrenIndex:p,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(l)&&f)return;Pn(y.relativePath.startsWith(l),`Absolute route path "${y.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(l.length)}let v=Rs([l,y.relativePath]),x=s.concat(y);d.children&&d.children.length>0&&(Pn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),S0(d.children,t,x,v,f)),!(d.path==null&&!d.index)&&t.push({path:v,score:iS(v,d.index),routesMeta:x})};return n.forEach((d,p)=>{if(d.path===""||!d.path?.includes("?"))u(d,p);else for(let f of j0(d.path))u(d,p,!0,f)}),t}function j0(n){let t=n.split("/");if(t.length===0)return[];let[s,...l]=t,c=s.endsWith("?"),u=s.replace(/\?$/,"");if(l.length===0)return c?[u,""]:[u];let d=j0(l.join("/")),p=[];return p.push(...d.map(f=>f===""?u:[u,f].join("/"))),c&&p.push(...d),p.map(f=>n.startsWith("/")&&f===""?"/":f)}function Jw(n){n.sort((t,s)=>t.score!==s.score?s.score-t.score:aS(t.routesMeta.map(l=>l.childrenIndex),s.routesMeta.map(l=>l.childrenIndex)))}var Zw=/^:[\w-]+$/,eS=3,tS=2,nS=1,rS=10,sS=-2,Wy=n=>n==="*";function iS(n,t){let s=n.split("/"),l=s.length;return s.some(Wy)&&(l+=sS),t&&(l+=tS),s.filter(c=>!Wy(c)).reduce((c,u)=>c+(Zw.test(u)?eS:u===""?nS:rS),l)}function aS(n,t){return n.length===t.length&&n.slice(0,-1).every((l,c)=>l===t[c])?n[n.length-1]-t[t.length-1]:0}function lS(n,t,s=!1){let{routesMeta:l}=n,c={},u="/",d=[];for(let p=0;p<l.length;++p){let f=l[p],m=p===l.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=cu({path:f.relativePath,caseSensitive:f.caseSensitive,end:m},y),x=f.route;if(!v&&m&&s&&!l[l.length-1].route.index&&(v=cu({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},y)),!v)return null;Object.assign(c,v.params),d.push({params:c,pathname:Rs([u,v.pathname]),pathnameBase:fS(Rs([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=Rs([u,v.pathnameBase]))}return d}function cu(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,l]=oS(n.path,n.caseSensitive,n.end),c=t.match(s);if(!c)return null;let u=c[0],d=u.replace(/(.)\/+$/,"$1"),p=c.slice(1);return{params:l.reduce((m,{paramName:y,isOptional:v},x)=>{if(y==="*"){let C=p[x]||"";d=u.slice(0,u.length-C.length).replace(/(.)\/+$/,"$1")}const S=p[x];return v&&!S?m[y]=void 0:m[y]=(S||"").replace(/%2F/g,"/"),m},{}),pathname:u,pathnameBase:d,pattern:n}}function oS(n,t=!1,s=!0){Br(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let l=[],c="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,p,f)=>(l.push({paramName:p,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(l.push({paramName:"*"}),c+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?c+="\\/*$":n!==""&&n!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,t?void 0:"i"),l]}function cS(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Br(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Ts(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,l=n.charAt(s);return l&&l!=="/"?null:n.slice(s)||"/"}var _0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,uS=n=>_0.test(n);function dS(n,t="/"){let{pathname:s,search:l="",hash:c=""}=typeof n=="string"?jo(n):n,u;if(s)if(uS(s))u=s;else{if(s.includes("//")){let d=s;s=s.replace(/\/\/+/g,"/"),Br(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${s}`)}s.startsWith("/")?u=Xy(s.substring(1),"/"):u=Xy(s,t)}else u=t;return{pathname:u,search:pS(l),hash:mS(c)}}function Xy(n,t){let s=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(c=>{c===".."?s.length>1&&s.pop():c!=="."&&s.push(c)}),s.length>1?s.join("/"):"/"}function $h(n,t,s,l){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function hS(n){return n.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function C0(n){let t=hS(n);return t.map((s,l)=>l===t.length-1?s.pathname:s.pathnameBase)}function E0(n,t,s,l=!1){let c;typeof n=="string"?c=jo(n):(c={...n},Pn(!c.pathname||!c.pathname.includes("?"),$h("?","pathname","search",c)),Pn(!c.pathname||!c.pathname.includes("#"),$h("#","pathname","hash",c)),Pn(!c.search||!c.search.includes("#"),$h("#","search","hash",c)));let u=n===""||c.pathname==="",d=u?"/":c.pathname,p;if(d==null)p=s;else{let v=t.length-1;if(!l&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;c.pathname=x.join("/")}p=v>=0?t[v]:"/"}let f=dS(c,p),m=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&s.endsWith("/");return!f.pathname.endsWith("/")&&(m||y)&&(f.pathname+="/"),f}var Rs=n=>n.join("/").replace(/\/\/+/g,"/"),fS=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),pS=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,mS=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,gS=class{constructor(n,t,s,l=!1){this.status=n,this.statusText=t||"",this.internal=l,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function yS(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function vS(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var N0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function R0(n,t){let s=n;if(typeof s!="string"||!_0.test(s))return{absoluteURL:void 0,isExternal:!1,to:s};let l=s,c=!1;if(N0)try{let u=new URL(window.location.href),d=s.startsWith("//")?new URL(u.protocol+s):new URL(s),p=Ts(d.pathname,t);d.origin===u.origin&&p!=null?s=p+d.search+d.hash:c=!0}catch{Br(!1,`<Link to="${s}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:l,isExternal:c,to:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var T0=["POST","PUT","PATCH","DELETE"];new Set(T0);var xS=["GET",...T0];new Set(xS);var Qa=b.createContext(null);Qa.displayName="DataRouter";var wu=b.createContext(null);wu.displayName="DataRouterState";var bS=b.createContext(!1),k0=b.createContext({isTransitioning:!1});k0.displayName="ViewTransition";var wS=b.createContext(new Map);wS.displayName="Fetchers";var SS=b.createContext(null);SS.displayName="Await";var $r=b.createContext(null);$r.displayName="Navigation";var Su=b.createContext(null);Su.displayName="Location";var As=b.createContext({outlet:null,matches:[],isDataRoute:!1});As.displayName="Route";var Ff=b.createContext(null);Ff.displayName="RouteError";var A0="REACT_ROUTER_ERROR",jS="REDIRECT",_S="ROUTE_ERROR_RESPONSE";function CS(n){if(n.startsWith(`${A0}:${jS}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function ES(n){if(n.startsWith(`${A0}:${_S}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new gS(t.status,t.statusText,t.data)}catch{}}function NS(n,{relative:t}={}){Pn(_o(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:l}=b.useContext($r),{hash:c,pathname:u,search:d}=Co(n,{relative:t}),p=u;return s!=="/"&&(p=u==="/"?s:Rs([s,u])),l.createHref({pathname:p,search:d,hash:c})}function _o(){return b.useContext(Su)!=null}function Os(){return Pn(_o(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(Su).location}var O0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function D0(n){b.useContext($r).static||b.useLayoutEffect(n)}function M0(){let{isDataRoute:n}=b.useContext(As);return n?$S():RS()}function RS(){Pn(_o(),"useNavigate() may be used only in the context of a <Router> component.");let n=b.useContext(Qa),{basename:t,navigator:s}=b.useContext($r),{matches:l}=b.useContext(As),{pathname:c}=Os(),u=JSON.stringify(C0(l)),d=b.useRef(!1);return D0(()=>{d.current=!0}),b.useCallback((f,m={})=>{if(Br(d.current,O0),!d.current)return;if(typeof f=="number"){s.go(f);return}let y=E0(f,JSON.parse(u),c,m.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Rs([t,y.pathname])),(m.replace?s.replace:s.push)(y,m.state,m)},[t,s,u,c,n])}b.createContext(null);function Co(n,{relative:t}={}){let{matches:s}=b.useContext(As),{pathname:l}=Os(),c=JSON.stringify(C0(s));return b.useMemo(()=>E0(n,JSON.parse(c),l,t==="path"),[n,c,l,t])}function TS(n,t,s,l,c){Pn(_o(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=b.useContext($r),{matches:d}=b.useContext(As),p=d[d.length-1],f=p?p.params:{},m=p?p.pathname:"/",y=p?p.pathnameBase:"/",v=p&&p.route;{let A=v&&v.path||"";U0(m,!v||A.endsWith("*")||A.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${A}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${A}"> to <Route path="${A==="/"?"*":`${A}/*`}">.`)}let x=Os(),S;S=x;let C=S.pathname||"/",E=C;if(y!=="/"){let A=y.replace(/^\//,"").split("/");E="/"+C.replace(/^\//,"").split("/").slice(A.length).join("/")}let j=w0(n,{pathname:E});return Br(v||j!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),Br(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),MS(j&&j.map(A=>Object.assign({},A,{params:Object.assign({},f,A.params),pathname:Rs([y,u.encodeLocation?u.encodeLocation(A.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?y:Rs([y,u.encodeLocation?u.encodeLocation(A.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:A.pathnameBase])})),d,s,l,c)}function kS(){let n=BS(),t=yS(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,l="rgba(200,200,200, 0.5)",c={padding:"0.5rem",backgroundColor:l},u={padding:"2px 4px",backgroundColor:l},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:u},"ErrorBoundary")," or"," ",b.createElement("code",{style:u},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},t),s?b.createElement("pre",{style:c},s):null,d)}var AS=b.createElement(kS,null),z0=class extends b.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const s=ES(n.digest);s&&(n=s)}let t=n!==void 0?b.createElement(As.Provider,{value:this.props.routeContext},b.createElement(Ff.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?b.createElement(OS,{error:n},t):t}};z0.contextType=bS;var qh=new WeakMap;function OS({children:n,error:t}){let{basename:s}=b.useContext($r);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let l=CS(t.digest);if(l){let c=qh.get(t);if(c)throw c;let u=R0(l.location,s);if(N0&&!qh.get(t))if(u.isExternal||l.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:l.replace}));throw qh.set(t,d),d}return b.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function DS({routeContext:n,match:t,children:s}){let l=b.useContext(Qa);return l&&l.static&&l.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=t.route.id),b.createElement(As.Provider,{value:n},s)}function MS(n,t=[],s=null,l=null,c=null){if(n==null){if(!s)return null;if(s.errors)n=s.matches;else if(t.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let u=n,d=s?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);Pn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let p=!1,f=-1;if(s)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(f=y),v.route.id){let{loaderData:x,errors:S}=s,C=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!S||S[v.route.id]===void 0);if(v.route.lazy||C){p=!0,f>=0?u=u.slice(0,f+1):u=[u[0]];break}}}let m=s&&l?(y,v)=>{l(y,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:vS(s.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let S,C=!1,E=null,j=null;s&&(S=d&&v.route.id?d[v.route.id]:void 0,E=v.route.errorElement||AS,p&&(f<0&&x===0?(U0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),C=!0,j=null):f===x&&(C=!0,j=v.route.hydrateFallbackElement||null)));let N=t.concat(u.slice(0,x+1)),A=()=>{let z;return S?z=E:C?z=j:v.route.Component?z=b.createElement(v.route.Component,null):v.route.element?z=v.route.element:z=y,b.createElement(DS,{match:v,routeContext:{outlet:y,matches:N,isDataRoute:s!=null},children:z})};return s&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?b.createElement(z0,{location:s.location,revalidation:s.revalidation,component:E,error:S,children:A(),routeContext:{outlet:null,matches:N,isDataRoute:!0},onError:m}):A()},null)}function Gf(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function zS(n){let t=b.useContext(Qa);return Pn(t,Gf(n)),t}function US(n){let t=b.useContext(wu);return Pn(t,Gf(n)),t}function LS(n){let t=b.useContext(As);return Pn(t,Gf(n)),t}function Vf(n){let t=LS(n),s=t.matches[t.matches.length-1];return Pn(s.route.id,`${n} can only be used on routes that contain a unique "id"`),s.route.id}function IS(){return Vf("useRouteId")}function BS(){let n=b.useContext(Ff),t=US("useRouteError"),s=Vf("useRouteError");return n!==void 0?n:t.errors?.[s]}function $S(){let{router:n}=zS("useNavigate"),t=Vf("useNavigate"),s=b.useRef(!1);return D0(()=>{s.current=!0}),b.useCallback(async(c,u={})=>{Br(s.current,O0),s.current&&(typeof c=="number"?await n.navigate(c):await n.navigate(c,{fromRouteId:t,...u}))},[n,t])}var Jy={};function U0(n,t,s){!t&&!Jy[n]&&(Jy[n]=!0,Br(!1,s))}b.memo(qS);function qS({routes:n,future:t,state:s,onError:l}){return TS(n,void 0,s,l,t)}function PS({basename:n="/",children:t=null,location:s,navigationType:l="POP",navigator:c,static:u=!1,unstable_useTransitions:d}){Pn(!_o(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let p=n.replace(/^\/*/,"/"),f=b.useMemo(()=>({basename:p,navigator:c,static:u,unstable_useTransitions:d,future:{}}),[p,c,u,d]);typeof s=="string"&&(s=jo(s));let{pathname:m="/",search:y="",hash:v="",state:x=null,key:S="default"}=s,C=b.useMemo(()=>{let E=Ts(m,p);return E==null?null:{location:{pathname:E,search:y,hash:v,state:x,key:S},navigationType:l}},[p,m,y,v,x,S,l]);return Br(C!=null,`<Router basename="${p}"> is not able to match the URL "${m}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),C==null?null:b.createElement($r.Provider,{value:f},b.createElement(Su.Provider,{children:t,value:C}))}var ru="get",su="application/x-www-form-urlencoded";function ju(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function HS(n){return ju(n)&&n.tagName.toLowerCase()==="button"}function FS(n){return ju(n)&&n.tagName.toLowerCase()==="form"}function GS(n){return ju(n)&&n.tagName.toLowerCase()==="input"}function VS(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function YS(n,t){return n.button===0&&(!t||t==="_self")&&!VS(n)}function _f(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,s)=>{let l=n[s];return t.concat(Array.isArray(l)?l.map(c=>[s,c]):[[s,l]])},[]))}function KS(n,t){let s=_f(n);return t&&t.forEach((l,c)=>{s.has(c)||t.getAll(c).forEach(u=>{s.append(c,u)})}),s}var Fc=null;function QS(){if(Fc===null)try{new FormData(document.createElement("form"),0),Fc=!1}catch{Fc=!0}return Fc}var WS=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ph(n){return n!=null&&!WS.has(n)?(Br(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${su}"`),null):n}function XS(n,t){let s,l,c,u,d;if(FS(n)){let p=n.getAttribute("action");l=p?Ts(p,t):null,s=n.getAttribute("method")||ru,c=Ph(n.getAttribute("enctype"))||su,u=new FormData(n)}else if(HS(n)||GS(n)&&(n.type==="submit"||n.type==="image")){let p=n.form;if(p==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=n.getAttribute("formaction")||p.getAttribute("action");if(l=f?Ts(f,t):null,s=n.getAttribute("formmethod")||p.getAttribute("method")||ru,c=Ph(n.getAttribute("formenctype"))||Ph(p.getAttribute("enctype"))||su,u=new FormData(p,n),!QS()){let{name:m,type:y,value:v}=n;if(y==="image"){let x=m?`${m}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else m&&u.append(m,v)}}else{if(ju(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=ru,l=null,c=su,d=n}return u&&c==="text/plain"&&(d=u,u=void 0),{action:l,method:s.toLowerCase(),encType:c,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Yf(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function JS(n,t,s){let l=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return l.pathname==="/"?l.pathname=`_root.${s}`:t&&Ts(l.pathname,t)==="/"?l.pathname=`${t.replace(/\/$/,"")}/_root.${s}`:l.pathname=`${l.pathname.replace(/\/$/,"")}.${s}`,l}async function ZS(n,t){if(n.id in t)return t[n.id];try{let s=await import(n.module);return t[n.id]=s,s}catch(s){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ej(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function tj(n,t,s){let l=await Promise.all(n.map(async c=>{let u=t.routes[c.route.id];if(u){let d=await ZS(u,s);return d.links?d.links():[]}return[]}));return ij(l.flat(1).filter(ej).filter(c=>c.rel==="stylesheet"||c.rel==="preload").map(c=>c.rel==="stylesheet"?{...c,rel:"prefetch",as:"style"}:{...c,rel:"prefetch"}))}function Zy(n,t,s,l,c,u){let d=(f,m)=>s[m]?f.route.id!==s[m].route.id:!0,p=(f,m)=>s[m].pathname!==f.pathname||s[m].route.path?.endsWith("*")&&s[m].params["*"]!==f.params["*"];return u==="assets"?t.filter((f,m)=>d(f,m)||p(f,m)):u==="data"?t.filter((f,m)=>{let y=l.routes[f.route.id];if(!y||!y.hasLoader)return!1;if(d(f,m)||p(f,m))return!0;if(f.route.shouldRevalidate){let v=f.route.shouldRevalidate({currentUrl:new URL(c.pathname+c.search+c.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function nj(n,t,{includeHydrateFallback:s}={}){return rj(n.map(l=>{let c=t.routes[l.route.id];if(!c)return[];let u=[c.module];return c.clientActionModule&&(u=u.concat(c.clientActionModule)),c.clientLoaderModule&&(u=u.concat(c.clientLoaderModule)),s&&c.hydrateFallbackModule&&(u=u.concat(c.hydrateFallbackModule)),c.imports&&(u=u.concat(c.imports)),u}).flat(1))}function rj(n){return[...new Set(n)]}function sj(n){let t={},s=Object.keys(n).sort();for(let l of s)t[l]=n[l];return t}function ij(n,t){let s=new Set;return new Set(t),n.reduce((l,c)=>{let u=JSON.stringify(sj(c));return s.has(u)||(s.add(u),l.push({key:u,link:c})),l},[])}function L0(){let n=b.useContext(Qa);return Yf(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function aj(){let n=b.useContext(wu);return Yf(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Kf=b.createContext(void 0);Kf.displayName="FrameworkContext";function I0(){let n=b.useContext(Kf);return Yf(n,"You must render this element inside a <HydratedRouter> element"),n}function lj(n,t){let s=b.useContext(Kf),[l,c]=b.useState(!1),[u,d]=b.useState(!1),{onFocus:p,onBlur:f,onMouseEnter:m,onMouseLeave:y,onTouchStart:v}=t,x=b.useRef(null);b.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let E=N=>{N.forEach(A=>{d(A.isIntersecting)})},j=new IntersectionObserver(E,{threshold:.5});return x.current&&j.observe(x.current),()=>{j.disconnect()}}},[n]),b.useEffect(()=>{if(l){let E=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(E)}}},[l]);let S=()=>{c(!0)},C=()=>{c(!1),d(!1)};return s?n!=="intent"?[u,x,{}]:[u,x,{onFocus:Xl(p,S),onBlur:Xl(f,C),onMouseEnter:Xl(m,S),onMouseLeave:Xl(y,C),onTouchStart:Xl(v,S)}]:[!1,x,{}]}function Xl(n,t){return s=>{n&&n(s),s.defaultPrevented||t(s)}}function oj({page:n,...t}){let{router:s}=L0(),l=b.useMemo(()=>w0(s.routes,n,s.basename),[s.routes,n,s.basename]);return l?b.createElement(uj,{page:n,matches:l,...t}):null}function cj(n){let{manifest:t,routeModules:s}=I0(),[l,c]=b.useState([]);return b.useEffect(()=>{let u=!1;return tj(n,t,s).then(d=>{u||c(d)}),()=>{u=!0}},[n,t,s]),l}function uj({page:n,matches:t,...s}){let l=Os(),{manifest:c,routeModules:u}=I0(),{basename:d}=L0(),{loaderData:p,matches:f}=aj(),m=b.useMemo(()=>Zy(n,t,f,c,l,"data"),[n,t,f,c,l]),y=b.useMemo(()=>Zy(n,t,f,c,l,"assets"),[n,t,f,c,l]),v=b.useMemo(()=>{if(n===l.pathname+l.search+l.hash)return[];let C=new Set,E=!1;if(t.forEach(N=>{let A=c.routes[N.route.id];!A||!A.hasLoader||(!m.some(z=>z.route.id===N.route.id)&&N.route.id in p&&u[N.route.id]?.shouldRevalidate||A.hasClientLoader?E=!0:C.add(N.route.id))}),C.size===0)return[];let j=JS(n,d,"data");return E&&C.size>0&&j.searchParams.set("_routes",t.filter(N=>C.has(N.route.id)).map(N=>N.route.id).join(",")),[j.pathname+j.search]},[d,p,l,c,m,t,n,u]),x=b.useMemo(()=>nj(y,c),[y,c]),S=cj(y);return b.createElement(b.Fragment,null,v.map(C=>b.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...s})),x.map(C=>b.createElement("link",{key:C,rel:"modulepreload",href:C,...s})),S.map(({key:C,link:E})=>b.createElement("link",{key:C,nonce:s.nonce,...E})))}function dj(...n){return t=>{n.forEach(s=>{typeof s=="function"?s(t):s!=null&&(s.current=t)})}}var hj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{hj&&(window.__reactRouterVersion="7.11.0")}catch{}function fj({basename:n,children:t,unstable_useTransitions:s,window:l}){let c=b.useRef();c.current==null&&(c.current=Yw({window:l,v5Compat:!0}));let u=c.current,[d,p]=b.useState({action:u.action,location:u.location}),f=b.useCallback(m=>{s===!1?p(m):b.startTransition(()=>p(m))},[s]);return b.useLayoutEffect(()=>u.listen(f),[u,f]),b.createElement(PS,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:s})}var B0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$0=b.forwardRef(function({onClick:t,discover:s="render",prefetch:l="none",relative:c,reloadDocument:u,replace:d,state:p,target:f,to:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...S},C){let{basename:E,unstable_useTransitions:j}=b.useContext($r),N=typeof m=="string"&&B0.test(m),A=R0(m,E);m=A.to;let z=NS(m,{relative:c}),[B,L,_]=lj(l,S),M=yj(m,{replace:d,state:p,target:f,preventScrollReset:y,relative:c,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:j});function k(V){t&&t(V),V.defaultPrevented||M(V)}let G=b.createElement("a",{...S,..._,href:A.absoluteURL||z,onClick:A.isExternal||u?t:k,ref:dj(C,L),target:f,"data-discover":!N&&s==="render"?"true":void 0});return B&&!N?b.createElement(b.Fragment,null,G,b.createElement(oj,{page:z})):G});$0.displayName="Link";var pj=b.forwardRef(function({"aria-current":t="page",caseSensitive:s=!1,className:l="",end:c=!1,style:u,to:d,viewTransition:p,children:f,...m},y){let v=Co(d,{relative:m.relative}),x=Os(),S=b.useContext(wu),{navigator:C,basename:E}=b.useContext($r),j=S!=null&&Sj(v)&&p===!0,N=C.encodeLocation?C.encodeLocation(v).pathname:v.pathname,A=x.pathname,z=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;s||(A=A.toLowerCase(),z=z?z.toLowerCase():null,N=N.toLowerCase()),z&&E&&(z=Ts(z,E)||z);const B=N!=="/"&&N.endsWith("/")?N.length-1:N.length;let L=A===N||!c&&A.startsWith(N)&&A.charAt(B)==="/",_=z!=null&&(z===N||!c&&z.startsWith(N)&&z.charAt(N.length)==="/"),M={isActive:L,isPending:_,isTransitioning:j},k=L?t:void 0,G;typeof l=="function"?G=l(M):G=[l,L?"active":null,_?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let V=typeof u=="function"?u(M):u;return b.createElement($0,{...m,"aria-current":k,className:G,ref:y,style:V,to:d,viewTransition:p},typeof f=="function"?f(M):f)});pj.displayName="NavLink";var mj=b.forwardRef(({discover:n="render",fetcherKey:t,navigate:s,reloadDocument:l,replace:c,state:u,method:d=ru,action:p,onSubmit:f,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...S},C)=>{let{unstable_useTransitions:E}=b.useContext($r),j=bj(),N=wj(p,{relative:m}),A=d.toLowerCase()==="get"?"get":"post",z=typeof p=="string"&&B0.test(p),B=L=>{if(f&&f(L),L.defaultPrevented)return;L.preventDefault();let _=L.nativeEvent.submitter,M=_?.getAttribute("formmethod")||d,k=()=>j(_||L.currentTarget,{fetcherKey:t,method:M,navigate:s,replace:c,state:u,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});E&&s!==!1?b.startTransition(()=>k()):k()};return b.createElement("form",{ref:C,method:A,action:N,onSubmit:l?f:B,...S,"data-discover":!z&&n==="render"?"true":void 0})});mj.displayName="Form";function gj(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function q0(n){let t=b.useContext(Qa);return Pn(t,gj(n)),t}function yj(n,{target:t,replace:s,state:l,preventScrollReset:c,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:p,unstable_useTransitions:f}={}){let m=M0(),y=Os(),v=Co(n,{relative:u});return b.useCallback(x=>{if(YS(x,t)){x.preventDefault();let S=s!==void 0?s:co(y)===co(v),C=()=>m(n,{replace:S,state:l,preventScrollReset:c,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:p});f?b.startTransition(()=>C()):C()}},[y,m,v,s,l,t,n,c,u,d,p,f])}function Qf(n){Br(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=b.useRef(_f(n)),s=b.useRef(!1),l=Os(),c=b.useMemo(()=>KS(l.search,s.current?null:t.current),[l.search]),u=M0(),d=b.useCallback((p,f)=>{const m=_f(typeof p=="function"?p(new URLSearchParams(c)):p);s.current=!0,u("?"+m,f)},[u,c]);return[c,d]}var vj=0,xj=()=>`__${String(++vj)}__`;function bj(){let{router:n}=q0("useSubmit"),{basename:t}=b.useContext($r),s=IS(),l=n.fetch,c=n.navigate;return b.useCallback(async(u,d={})=>{let{action:p,method:f,encType:m,formData:y,body:v}=XS(u,t);if(d.navigate===!1){let x=d.fetcherKey||xj();await l(x,s,d.action||p,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||f,formEncType:d.encType||m,flushSync:d.flushSync})}else await c(d.action||p,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||f,formEncType:d.encType||m,replace:d.replace,state:d.state,fromRouteId:s,flushSync:d.flushSync,viewTransition:d.viewTransition})},[l,c,t,s])}function wj(n,{relative:t}={}){let{basename:s}=b.useContext($r),l=b.useContext(As);Pn(l,"useFormAction must be used inside a RouteContext");let[c]=l.matches.slice(-1),u={...Co(n||".",{relative:t})},d=Os();if(n==null){u.search=d.search;let p=new URLSearchParams(u.search),f=p.getAll("index");if(f.some(y=>y==="")){p.delete("index"),f.filter(v=>v).forEach(v=>p.append("index",v));let y=p.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&c.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(u.pathname=u.pathname==="/"?s:Rs([s,u.pathname])),co(u)}function Sj(n,{relative:t}={}){let s=b.useContext(k0);Pn(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=q0("useViewTransitionState"),c=Co(n,{relative:t});if(!s.isTransitioning)return!1;let u=Ts(s.currentLocation.pathname,l)||s.currentLocation.pathname,d=Ts(s.nextLocation.pathname,l)||s.nextLocation.pathname;return cu(c.pathname,d)!=null||cu(c.pathname,u)!=null}var Ha=b0();const jj=({children:n})=>(Os(),i.jsxs("div",{className:"app-layout",children:[i.jsx("header",{className:"app-header",children:i.jsx("div",{className:"container app-header__content",children:i.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),i.jsx("main",{className:"container app-main",children:n}),i.jsx("footer",{className:"app-footer",children:i.jsx("div",{className:"container",children:i.jsx("p",{children:" 2026 recipe management"})})})]})),xn=({children:n,className:t="",hoverable:s=!1,...l})=>i.jsx("div",{className:`glass-card ${s?"glass-card--hoverable":""} ${t}`,...l,children:n}),fe=({children:n,variant:t="primary",size:s="md",isLoading:l,block:c,className:u="",...d})=>{const p=["btn",`btn--${t}`,`btn--${s}`,c?"btn--block":"",l?"btn--loading":"",u].filter(Boolean).join(" ");return i.jsxs("button",{className:p,disabled:l,...d,children:[l&&i.jsx("span",{className:"btn__spinner"}),i.jsx("span",{className:"btn__content",children:n})]})};function _j(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return b.useMemo(()=>l=>{t.forEach(c=>c(l))},t)}const _u=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Wa(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function Wf(n){return"nodeType"in n}function or(n){var t,s;return n?Wa(n)?n:Wf(n)&&(t=(s=n.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function Xf(n){const{Document:t}=or(n);return n instanceof t}function Eo(n){return Wa(n)?!1:n instanceof or(n).HTMLElement}function P0(n){return n instanceof or(n).SVGElement}function Xa(n){return n?Wa(n)?n.document:Wf(n)?Xf(n)?n:Eo(n)||P0(n)?n.ownerDocument:document:document:document}const Wr=_u?b.useLayoutEffect:b.useEffect;function Cu(n){const t=b.useRef(n);return Wr(()=>{t.current=n}),b.useCallback(function(){for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];return t.current==null?void 0:t.current(...l)},[])}function Cj(){const n=b.useRef(null),t=b.useCallback((l,c)=>{n.current=setInterval(l,c)},[]),s=b.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,s]}function uo(n,t){t===void 0&&(t=[n]);const s=b.useRef(n);return Wr(()=>{s.current!==n&&(s.current=n)},t),s}function No(n,t){const s=b.useRef();return b.useMemo(()=>{const l=n(s.current);return s.current=l,l},[...t])}function uu(n){const t=Cu(n),s=b.useRef(null),l=b.useCallback(c=>{c!==s.current&&t?.(c,s.current),s.current=c},[]);return[s,l]}function du(n){const t=b.useRef();return b.useEffect(()=>{t.current=n},[n]),t.current}let Hh={};function Ro(n,t){return b.useMemo(()=>{if(t)return t;const s=Hh[n]==null?0:Hh[n]+1;return Hh[n]=s,n+"-"+s},[n,t])}function H0(n){return function(t){for(var s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];return l.reduce((u,d)=>{const p=Object.entries(d);for(const[f,m]of p){const y=u[f];y!=null&&(u[f]=y+n*m)}return u},{...t})}}const Va=H0(1),ho=H0(-1);function Ej(n){return"clientX"in n&&"clientY"in n}function Eu(n){if(!n)return!1;const{KeyboardEvent:t}=or(n.target);return t&&n instanceof t}function Nj(n){if(!n)return!1;const{TouchEvent:t}=or(n.target);return t&&n instanceof t}function hu(n){if(Nj(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:s}=n.touches[0];return{x:t,y:s}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:s}=n.changedTouches[0];return{x:t,y:s}}}return Ej(n)?{x:n.clientX,y:n.clientY}:null}const Rr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:s}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:s}=n;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(n){if(n)return[Rr.Translate.toString(n),Rr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:s,easing:l}=n;return t+" "+s+"ms "+l}}}),ev="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Rj(n){return n.matches(ev)?n:n.querySelector(ev)}const Tj={display:"none"};function kj(n){let{id:t,value:s}=n;return Ue.createElement("div",{id:t,style:Tj},s)}function Aj(n){let{id:t,announcement:s,ariaLiveType:l="assertive"}=n;const c={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ue.createElement("div",{id:t,style:c,role:"status","aria-live":l,"aria-atomic":!0},s)}function Oj(){const[n,t]=b.useState("");return{announce:b.useCallback(l=>{l!=null&&t(l)},[]),announcement:n}}const F0=b.createContext(null);function Dj(n){const t=b.useContext(F0);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function Mj(){const[n]=b.useState(()=>new Set),t=b.useCallback(l=>(n.add(l),()=>n.delete(l)),[n]);return[b.useCallback(l=>{let{type:c,event:u}=l;n.forEach(d=>{var p;return(p=d[c])==null?void 0:p.call(d,u)})},[n]),t]}const zj={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Uj={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Lj(n){let{announcements:t=Uj,container:s,hiddenTextDescribedById:l,screenReaderInstructions:c=zj}=n;const{announce:u,announcement:d}=Oj(),p=Ro("DndLiveRegion"),[f,m]=b.useState(!1);if(b.useEffect(()=>{m(!0)},[]),Dj(b.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:S}=v;t.onDragMove&&u(t.onDragMove({active:x,over:S}))},onDragOver(v){let{active:x,over:S}=v;u(t.onDragOver({active:x,over:S}))},onDragEnd(v){let{active:x,over:S}=v;u(t.onDragEnd({active:x,over:S}))},onDragCancel(v){let{active:x,over:S}=v;u(t.onDragCancel({active:x,over:S}))}}),[u,t])),!f)return null;const y=Ue.createElement(Ue.Fragment,null,Ue.createElement(kj,{id:l,value:c.draggable}),Ue.createElement(Aj,{id:p,announcement:d}));return s?Ha.createPortal(y,s):y}var $n;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})($n||($n={}));function fu(){}function gr(n,t){return b.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function Ja(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return b.useMemo(()=>[...t].filter(l=>l!=null),[...t])}const Xr=Object.freeze({x:0,y:0});function Jf(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function Ij(n,t){const s=hu(n);if(!s)return"0 0";const l={x:(s.x-t.left)/t.width*100,y:(s.y-t.top)/t.height*100};return l.x+"% "+l.y+"%"}function Zf(n,t){let{data:{value:s}}=n,{data:{value:l}}=t;return s-l}function Bj(n,t){let{data:{value:s}}=n,{data:{value:l}}=t;return l-s}function Cf(n){let{left:t,top:s,height:l,width:c}=n;return[{x:t,y:s},{x:t+c,y:s},{x:t,y:s+l},{x:t+c,y:s+l}]}function G0(n,t){if(!n||n.length===0)return null;const[s]=n;return s[t]}function tv(n,t,s){return t===void 0&&(t=n.left),s===void 0&&(s=n.top),{x:t+n.width*.5,y:s+n.height*.5}}const Ef=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const c=tv(t,t.left,t.top),u=[];for(const d of l){const{id:p}=d,f=s.get(p);if(f){const m=Jf(tv(f),c);u.push({id:p,data:{droppableContainer:d,value:m}})}}return u.sort(Zf)},$j=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const c=Cf(t),u=[];for(const d of l){const{id:p}=d,f=s.get(p);if(f){const m=Cf(f),y=c.reduce((x,S,C)=>x+Jf(m[C],S),0),v=Number((y/4).toFixed(4));u.push({id:p,data:{droppableContainer:d,value:v}})}}return u.sort(Zf)};function qj(n,t){const s=Math.max(t.top,n.top),l=Math.max(t.left,n.left),c=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=c-l,p=u-s;if(l<c&&s<u){const f=t.width*t.height,m=n.width*n.height,y=d*p,v=y/(f+m-y);return Number(v.toFixed(4))}return 0}const Pj=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const c=[];for(const u of l){const{id:d}=u,p=s.get(d);if(p){const f=qj(p,t);f>0&&c.push({id:d,data:{droppableContainer:u,value:f}})}}return c.sort(Bj)};function Hj(n,t){const{top:s,left:l,bottom:c,right:u}=t;return s<=n.y&&n.y<=c&&l<=n.x&&n.x<=u}const V0=n=>{let{droppableContainers:t,droppableRects:s,pointerCoordinates:l}=n;if(!l)return[];const c=[];for(const u of t){const{id:d}=u,p=s.get(d);if(p&&Hj(l,p)){const m=Cf(p).reduce((v,x)=>v+Jf(l,x),0),y=Number((m/4).toFixed(4));c.push({id:d,data:{droppableContainer:u,value:y}})}}return c.sort(Zf)};function Fj(n,t,s){return{...n,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function Y0(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:Xr}function Gj(n){return function(s){for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];return c.reduce((d,p)=>({...d,top:d.top+n*p.y,bottom:d.bottom+n*p.y,left:d.left+n*p.x,right:d.right+n*p.x}),{...s})}}const Vj=Gj(1);function K0(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Yj(n,t,s){const l=K0(t);if(!l)return n;const{scaleX:c,scaleY:u,x:d,y:p}=l,f=n.left-d-(1-c)*parseFloat(s),m=n.top-p-(1-u)*parseFloat(s.slice(s.indexOf(" ")+1)),y=c?n.width/c:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:m,right:f+y,bottom:m+v,left:f}}const Kj={ignoreTransform:!1};function Za(n,t){t===void 0&&(t=Kj);let s=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:m,transformOrigin:y}=or(n).getComputedStyle(n);m&&(s=Yj(s,m,y))}const{top:l,left:c,width:u,height:d,bottom:p,right:f}=s;return{top:l,left:c,width:u,height:d,bottom:p,right:f}}function nv(n){return Za(n,{ignoreTransform:!0})}function Qj(n){const t=n.innerWidth,s=n.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function Wj(n,t){return t===void 0&&(t=or(n).getComputedStyle(n)),t.position==="fixed"}function Xj(n,t){t===void 0&&(t=or(n).getComputedStyle(n));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(c=>{const u=t[c];return typeof u=="string"?s.test(u):!1})}function Nu(n,t){const s=[];function l(c){if(t!=null&&s.length>=t||!c)return s;if(Xf(c)&&c.scrollingElement!=null&&!s.includes(c.scrollingElement))return s.push(c.scrollingElement),s;if(!Eo(c)||P0(c)||s.includes(c))return s;const u=or(n).getComputedStyle(c);return c!==n&&Xj(c,u)&&s.push(c),Wj(c,u)?s:l(c.parentNode)}return n?l(n):s}function Q0(n){const[t]=Nu(n,1);return t??null}function Fh(n){return!_u||!n?null:Wa(n)?n:Wf(n)?Xf(n)||n===Xa(n).scrollingElement?window:Eo(n)?n:null:null}function W0(n){return Wa(n)?n.scrollX:n.scrollLeft}function X0(n){return Wa(n)?n.scrollY:n.scrollTop}function Nf(n){return{x:W0(n),y:X0(n)}}var Fn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Fn||(Fn={}));function J0(n){return!_u||!n?!1:n===document.scrollingElement}function Z0(n){const t={x:0,y:0},s=J0(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},l={x:n.scrollWidth-s.width,y:n.scrollHeight-s.height},c=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=l.y,p=n.scrollLeft>=l.x;return{isTop:c,isLeft:u,isBottom:d,isRight:p,maxScroll:l,minScroll:t}}const Jj={x:.2,y:.2};function Zj(n,t,s,l,c){let{top:u,left:d,right:p,bottom:f}=s;l===void 0&&(l=10),c===void 0&&(c=Jj);const{isTop:m,isBottom:y,isLeft:v,isRight:x}=Z0(n),S={x:0,y:0},C={x:0,y:0},E={height:t.height*c.y,width:t.width*c.x};return!m&&u<=t.top+E.height?(S.y=Fn.Backward,C.y=l*Math.abs((t.top+E.height-u)/E.height)):!y&&f>=t.bottom-E.height&&(S.y=Fn.Forward,C.y=l*Math.abs((t.bottom-E.height-f)/E.height)),!x&&p>=t.right-E.width?(S.x=Fn.Forward,C.x=l*Math.abs((t.right-E.width-p)/E.width)):!v&&d<=t.left+E.width&&(S.x=Fn.Backward,C.x=l*Math.abs((t.left+E.width-d)/E.width)),{direction:S,speed:C}}function e_(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:s,right:l,bottom:c}=n.getBoundingClientRect();return{top:t,left:s,right:l,bottom:c,width:n.clientWidth,height:n.clientHeight}}function ex(n){return n.reduce((t,s)=>Va(t,Nf(s)),Xr)}function t_(n){return n.reduce((t,s)=>t+W0(s),0)}function n_(n){return n.reduce((t,s)=>t+X0(s),0)}function tx(n,t){if(t===void 0&&(t=Za),!n)return;const{top:s,left:l,bottom:c,right:u}=t(n);Q0(n)&&(c<=0||u<=0||s>=window.innerHeight||l>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const r_=[["x",["left","right"],t_],["y",["top","bottom"],n_]];class ep{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const l=Nu(s),c=ex(l);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,p]of r_)for(const f of d)Object.defineProperty(this,f,{get:()=>{const m=p(l),y=c[u]-m;return this.rect[f]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class so{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var l;return(l=this.target)==null?void 0:l.removeEventListener(...s)})},this.target=t}add(t,s,l){var c;(c=this.target)==null||c.addEventListener(t,s,l),this.listeners.push([t,s,l])}}function s_(n){const{EventTarget:t}=or(n);return n instanceof t?n:Xa(n)}function Gh(n,t){const s=Math.abs(n.x),l=Math.abs(n.y);return typeof t=="number"?Math.sqrt(s**2+l**2)>t:"x"in t&&"y"in t?s>t.x&&l>t.y:"x"in t?s>t.x:"y"in t?l>t.y:!1}var Ir;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Ir||(Ir={}));function rv(n){n.preventDefault()}function i_(n){n.stopPropagation()}var Ht;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(Ht||(Ht={}));const nx={start:[Ht.Space,Ht.Enter],cancel:[Ht.Esc],end:[Ht.Space,Ht.Enter,Ht.Tab]},a_=(n,t)=>{let{currentCoordinates:s}=t;switch(n.code){case Ht.Right:return{...s,x:s.x+25};case Ht.Left:return{...s,x:s.x-25};case Ht.Down:return{...s,y:s.y+25};case Ht.Up:return{...s,y:s.y-25}}};class el{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new so(Xa(s)),this.windowListeners=new so(or(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ir.Resize,this.handleCancel),this.windowListeners.add(Ir.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ir.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,l=t.node.current;l&&tx(l),s(Xr)}handleKeyDown(t){if(Eu(t)){const{active:s,context:l,options:c}=this.props,{keyboardCodes:u=nx,coordinateGetter:d=a_,scrollBehavior:p="smooth"}=c,{code:f}=t;if(u.end.includes(f)){this.handleEnd(t);return}if(u.cancel.includes(f)){this.handleCancel(t);return}const{collisionRect:m}=l.current,y=m?{x:m.left,y:m.top}:Xr;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:s,context:l.current,currentCoordinates:y});if(v){const x=ho(v,y),S={x:0,y:0},{scrollableAncestors:C}=l.current;for(const E of C){const j=t.code,{isTop:N,isRight:A,isLeft:z,isBottom:B,maxScroll:L,minScroll:_}=Z0(E),M=e_(E),k={x:Math.min(j===Ht.Right?M.right-M.width/2:M.right,Math.max(j===Ht.Right?M.left:M.left+M.width/2,v.x)),y:Math.min(j===Ht.Down?M.bottom-M.height/2:M.bottom,Math.max(j===Ht.Down?M.top:M.top+M.height/2,v.y))},G=j===Ht.Right&&!A||j===Ht.Left&&!z,V=j===Ht.Down&&!B||j===Ht.Up&&!N;if(G&&k.x!==v.x){const Q=E.scrollLeft+x.x,P=j===Ht.Right&&Q<=L.x||j===Ht.Left&&Q>=_.x;if(P&&!x.y){E.scrollTo({left:Q,behavior:p});return}P?S.x=E.scrollLeft-Q:S.x=j===Ht.Right?E.scrollLeft-L.x:E.scrollLeft-_.x,S.x&&E.scrollBy({left:-S.x,behavior:p});break}else if(V&&k.y!==v.y){const Q=E.scrollTop+x.y,P=j===Ht.Down&&Q<=L.y||j===Ht.Up&&Q>=_.y;if(P&&!x.x){E.scrollTo({top:Q,behavior:p});return}P?S.y=E.scrollTop-Q:S.y=j===Ht.Down?E.scrollTop-L.y:E.scrollTop-_.y,S.y&&E.scrollBy({top:-S.y,behavior:p});break}}this.handleMove(t,Va(ho(v,this.referenceCoordinates),S))}}}handleMove(t,s){const{onMove:l}=this.props;t.preventDefault(),l(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}el.activators=[{eventName:"onKeyDown",handler:(n,t,s)=>{let{keyboardCodes:l=nx,onActivation:c}=t,{active:u}=s;const{code:d}=n.nativeEvent;if(l.start.includes(d)){const p=u.activatorNode.current;return p&&n.target!==p?!1:(n.preventDefault(),c?.({event:n.nativeEvent}),!0)}return!1}}];function sv(n){return!!(n&&"distance"in n)}function iv(n){return!!(n&&"delay"in n)}class tp{constructor(t,s,l){var c;l===void 0&&(l=s_(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:u}=t,{target:d}=u;this.props=t,this.events=s,this.document=Xa(d),this.documentListeners=new so(this.document),this.listeners=new so(l),this.windowListeners=new so(or(d)),this.initialCoordinates=(c=hu(u))!=null?c:Xr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:l}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ir.Resize,this.handleCancel),this.windowListeners.add(Ir.DragStart,rv),this.windowListeners.add(Ir.VisibilityChange,this.handleCancel),this.windowListeners.add(Ir.ContextMenu,rv),this.documentListeners.add(Ir.Keydown,this.handleKeydown),s){if(l!=null&&l({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(iv(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(sv(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:l,onPending:c}=this.props;c(l,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ir.Click,i_,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ir.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:l,initialCoordinates:c,props:u}=this,{onMove:d,options:{activationConstraint:p}}=u;if(!c)return;const f=(s=hu(t))!=null?s:Xr,m=ho(c,f);if(!l&&p){if(sv(p)){if(p.tolerance!=null&&Gh(m,p.tolerance))return this.handleCancel();if(Gh(m,p.distance))return this.handleStart()}if(iv(p)&&Gh(m,p.tolerance))return this.handleCancel();this.handlePending(p,m);return}t.cancelable&&t.preventDefault(),d(f)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===Ht.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const l_={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ru extends tp{constructor(t){const{event:s}=t,l=Xa(s.target);super(t,l_,l)}}Ru.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;return!s.isPrimary||s.button!==0?!1:(l?.({event:s}),!0)}}];const o_={move:{name:"mousemove"},end:{name:"mouseup"}};var Rf;(function(n){n[n.RightClick=2]="RightClick"})(Rf||(Rf={}));class To extends tp{constructor(t){super(t,o_,Xa(t.event.target))}}To.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;return s.button===Rf.RightClick?!1:(l?.({event:s}),!0)}}];const Vh={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class ko extends tp{constructor(t){super(t,Vh)}static setup(){return window.addEventListener(Vh.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Vh.move.name,t)};function t(){}}}ko.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;const{touches:c}=s;return c.length>1?!1:(l?.({event:s}),!0)}}];var io;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(io||(io={}));var pu;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(pu||(pu={}));function c_(n){let{acceleration:t,activator:s=io.Pointer,canScroll:l,draggingRect:c,enabled:u,interval:d=5,order:p=pu.TreeOrder,pointerCoordinates:f,scrollableAncestors:m,scrollableAncestorRects:y,delta:v,threshold:x}=n;const S=d_({delta:v,disabled:!u}),[C,E]=Cj(),j=b.useRef({x:0,y:0}),N=b.useRef({x:0,y:0}),A=b.useMemo(()=>{switch(s){case io.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case io.DraggableRect:return c}},[s,c,f]),z=b.useRef(null),B=b.useCallback(()=>{const _=z.current;if(!_)return;const M=j.current.x*N.current.x,k=j.current.y*N.current.y;_.scrollBy(M,k)},[]),L=b.useMemo(()=>p===pu.TreeOrder?[...m].reverse():m,[p,m]);b.useEffect(()=>{if(!u||!m.length||!A){E();return}for(const _ of L){if(l?.(_)===!1)continue;const M=m.indexOf(_),k=y[M];if(!k)continue;const{direction:G,speed:V}=Zj(_,k,A,t,x);for(const Q of["x","y"])S[Q][G[Q]]||(V[Q]=0,G[Q]=0);if(V.x>0||V.y>0){E(),z.current=_,C(B,d),j.current=V,N.current=G;return}}j.current={x:0,y:0},N.current={x:0,y:0},E()},[t,B,l,E,u,d,JSON.stringify(A),JSON.stringify(S),C,m,L,y,JSON.stringify(x)])}const u_={x:{[Fn.Backward]:!1,[Fn.Forward]:!1},y:{[Fn.Backward]:!1,[Fn.Forward]:!1}};function d_(n){let{delta:t,disabled:s}=n;const l=du(t);return No(c=>{if(s||!l||!c)return u_;const u={x:Math.sign(t.x-l.x),y:Math.sign(t.y-l.y)};return{x:{[Fn.Backward]:c.x[Fn.Backward]||u.x===-1,[Fn.Forward]:c.x[Fn.Forward]||u.x===1},y:{[Fn.Backward]:c.y[Fn.Backward]||u.y===-1,[Fn.Forward]:c.y[Fn.Forward]||u.y===1}}},[s,t,l])}function h_(n,t){const s=t!=null?n.get(t):void 0,l=s?s.node.current:null;return No(c=>{var u;return t==null?null:(u=l??c)!=null?u:null},[l,t])}function f_(n,t){return b.useMemo(()=>n.reduce((s,l)=>{const{sensor:c}=l,u=c.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,l)}));return[...s,...u]},[]),[n,t])}var fo;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(fo||(fo={}));var Tf;(function(n){n.Optimized="optimized"})(Tf||(Tf={}));const av=new Map;function p_(n,t){let{dragging:s,dependencies:l,config:c}=t;const[u,d]=b.useState(null),{frequency:p,measure:f,strategy:m}=c,y=b.useRef(n),v=j(),x=uo(v),S=b.useCallback(function(N){N===void 0&&(N=[]),!x.current&&d(A=>A===null?N:A.concat(N.filter(z=>!A.includes(z))))},[x]),C=b.useRef(null),E=No(N=>{if(v&&!s)return av;if(!N||N===av||y.current!==n||u!=null){const A=new Map;for(let z of n){if(!z)continue;if(u&&u.length>0&&!u.includes(z.id)&&z.rect.current){A.set(z.id,z.rect.current);continue}const B=z.node.current,L=B?new ep(f(B),B):null;z.rect.current=L,L&&A.set(z.id,L)}return A}return N},[n,u,s,v,f]);return b.useEffect(()=>{y.current=n},[n]),b.useEffect(()=>{v||S()},[s,v]),b.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),b.useEffect(()=>{v||typeof p!="number"||C.current!==null||(C.current=setTimeout(()=>{S(),C.current=null},p))},[p,v,S,...l]),{droppableRects:E,measureDroppableContainers:S,measuringScheduled:u!=null};function j(){switch(m){case fo.Always:return!1;case fo.BeforeDragging:return s;default:return!s}}}function np(n,t){return No(s=>n?s||(typeof t=="function"?t(n):n):null,[t,n])}function m_(n,t){return np(n,t)}function g_(n){let{callback:t,disabled:s}=n;const l=Cu(t),c=b.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(l)},[l,s]);return b.useEffect(()=>()=>c?.disconnect(),[c]),c}function Tu(n){let{callback:t,disabled:s}=n;const l=Cu(t),c=b.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(l)},[s]);return b.useEffect(()=>()=>c?.disconnect(),[c]),c}function y_(n){return new ep(Za(n),n)}function lv(n,t,s){t===void 0&&(t=y_);const[l,c]=b.useState(null);function u(){c(f=>{if(!n)return null;if(n.isConnected===!1){var m;return(m=f??s)!=null?m:null}const y=t(n);return JSON.stringify(f)===JSON.stringify(y)?f:y})}const d=g_({callback(f){if(n)for(const m of f){const{type:y,target:v}=m;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),p=Tu({callback:u});return Wr(()=>{u(),n?(p?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(p?.disconnect(),d?.disconnect())},[n]),l}function v_(n){const t=np(n);return Y0(n,t)}const ov=[];function x_(n){const t=b.useRef(n),s=No(l=>n?l&&l!==ov&&n&&t.current&&n.parentNode===t.current.parentNode?l:Nu(n):ov,[n]);return b.useEffect(()=>{t.current=n},[n]),s}function b_(n){const[t,s]=b.useState(null),l=b.useRef(n),c=b.useCallback(u=>{const d=Fh(u.target);d&&s(p=>p?(p.set(d,Nf(d)),new Map(p)):null)},[]);return b.useEffect(()=>{const u=l.current;if(n!==u){d(u);const p=n.map(f=>{const m=Fh(f);return m?(m.addEventListener("scroll",c,{passive:!0}),[m,Nf(m)]):null}).filter(f=>f!=null);s(p.length?new Map(p):null),l.current=n}return()=>{d(n),d(u)};function d(p){p.forEach(f=>{const m=Fh(f);m?.removeEventListener("scroll",c)})}},[c,n]),b.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>Va(u,d),Xr):ex(n):Xr,[n,t])}function cv(n,t){t===void 0&&(t=[]);const s=b.useRef(null);return b.useEffect(()=>{s.current=null},t),b.useEffect(()=>{const l=n!==Xr;l&&!s.current&&(s.current=n),!l&&s.current&&(s.current=null)},[n]),s.current?ho(n,s.current):Xr}function w_(n){b.useEffect(()=>{if(!_u)return;const t=n.map(s=>{let{sensor:l}=s;return l.setup==null?void 0:l.setup()});return()=>{for(const s of t)s?.()}},n.map(t=>{let{sensor:s}=t;return s}))}function S_(n,t){return b.useMemo(()=>n.reduce((s,l)=>{let{eventName:c,handler:u}=l;return s[c]=d=>{u(d,t)},s},{}),[n,t])}function rx(n){return b.useMemo(()=>n?Qj(n):null,[n])}const uv=[];function j_(n,t){t===void 0&&(t=Za);const[s]=n,l=rx(s?or(s):null),[c,u]=b.useState(uv);function d(){u(()=>n.length?n.map(f=>J0(f)?l:new ep(t(f),f)):uv)}const p=Tu({callback:d});return Wr(()=>{p?.disconnect(),d(),n.forEach(f=>p?.observe(f))},[n]),c}function sx(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return Eo(t)?t:n}function __(n){let{measure:t}=n;const[s,l]=b.useState(null),c=b.useCallback(m=>{for(const{target:y}of m)if(Eo(y)){l(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=Tu({callback:c}),d=b.useCallback(m=>{const y=sx(m);u?.disconnect(),y&&u?.observe(y),l(y?t(y):null)},[t,u]),[p,f]=uu(d);return b.useMemo(()=>({nodeRef:p,rect:s,setRef:f}),[s,p,f])}const C_=[{sensor:Ru,options:{}},{sensor:el,options:{}}],E_={current:{}},iu={draggable:{measure:nv},droppable:{measure:nv,strategy:fo.WhileDragging,frequency:Tf.Optimized},dragOverlay:{measure:Za}};class ao extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,l;return(s=(l=this.get(t))==null?void 0:l.node.current)!=null?s:void 0}}const N_={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new ao,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:fu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:iu,measureDroppableContainers:fu,windowRect:null,measuringScheduled:!1},ix={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:fu,draggableNodes:new Map,over:null,measureDroppableContainers:fu},Ao=b.createContext(ix),ax=b.createContext(N_);function R_(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new ao}}}function T_(n,t){switch(t.type){case $n.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case $n.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case $n.DragEnd:case $n.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $n.RegisterDroppable:{const{element:s}=t,{id:l}=s,c=new ao(n.droppable.containers);return c.set(l,s),{...n,droppable:{...n.droppable,containers:c}}}case $n.SetDroppableDisabled:{const{id:s,key:l,disabled:c}=t,u=n.droppable.containers.get(s);if(!u||l!==u.key)return n;const d=new ao(n.droppable.containers);return d.set(s,{...u,disabled:c}),{...n,droppable:{...n.droppable,containers:d}}}case $n.UnregisterDroppable:{const{id:s,key:l}=t,c=n.droppable.containers.get(s);if(!c||l!==c.key)return n;const u=new ao(n.droppable.containers);return u.delete(s),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function k_(n){let{disabled:t}=n;const{active:s,activatorEvent:l,draggableNodes:c}=b.useContext(Ao),u=du(l),d=du(s?.id);return b.useEffect(()=>{if(!t&&!l&&u&&d!=null){if(!Eu(u)||document.activeElement===u.target)return;const p=c.get(d);if(!p)return;const{activatorNode:f,node:m}=p;if(!f.current&&!m.current)return;requestAnimationFrame(()=>{for(const y of[f.current,m.current]){if(!y)continue;const v=Rj(y);if(v){v.focus();break}}})}},[l,t,c,d,u]),null}function lx(n,t){let{transform:s,...l}=t;return n!=null&&n.length?n.reduce((c,u)=>u({transform:c,...l}),s):s}function A_(n){return b.useMemo(()=>({draggable:{...iu.draggable,...n?.draggable},droppable:{...iu.droppable,...n?.droppable},dragOverlay:{...iu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function O_(n){let{activeNode:t,measure:s,initialRect:l,config:c=!0}=n;const u=b.useRef(!1),{x:d,y:p}=typeof c=="boolean"?{x:c,y:c}:c;Wr(()=>{if(!d&&!p||!t){u.current=!1;return}if(u.current||!l)return;const m=t?.node.current;if(!m||m.isConnected===!1)return;const y=s(m),v=Y0(y,l);if(d||(v.x=0),p||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=Q0(m);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,p,l,s])}const ku=b.createContext({...Xr,scaleX:1,scaleY:1});var ui;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(ui||(ui={}));const Fi=b.memo(function(t){var s,l,c,u;let{id:d,accessibility:p,autoScroll:f=!0,children:m,sensors:y=C_,collisionDetection:v=Pj,measuring:x,modifiers:S,...C}=t;const E=b.useReducer(T_,void 0,R_),[j,N]=E,[A,z]=Mj(),[B,L]=b.useState(ui.Uninitialized),_=B===ui.Initialized,{draggable:{active:M,nodes:k,translate:G},droppable:{containers:V}}=j,Q=M!=null?k.get(M):null,P=b.useRef({initial:null,translated:null}),F=b.useMemo(()=>{var Xe;return M!=null?{id:M,data:(Xe=Q?.data)!=null?Xe:E_,rect:P}:null},[M,Q]),q=b.useRef(null),[$,T]=b.useState(null),[I,Y]=b.useState(null),ae=uo(C,Object.values(C)),ye=Ro("DndDescribedBy",d),U=b.useMemo(()=>V.getEnabled(),[V]),W=A_(x),{droppableRects:Z,measureDroppableContainers:ce,measuringScheduled:Oe}=p_(U,{dragging:_,dependencies:[G.x,G.y],config:W.droppable}),Se=h_(k,M),Re=b.useMemo(()=>I?hu(I):null,[I]),O=He(),ie=m_(Se,W.draggable.measure);O_({activeNode:M!=null?k.get(M):null,config:O.layoutShiftCompensation,initialRect:ie,measure:W.draggable.measure});const de=lv(Se,W.draggable.measure,ie),Me=lv(Se?Se.parentElement:null),Le=b.useRef({activatorEvent:null,active:null,activeNode:Se,collisionRect:null,collisions:null,droppableRects:Z,draggableNodes:k,draggingNode:null,draggingNodeRect:null,droppableContainers:V,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ke=V.getNodeFor((s=Le.current.over)==null?void 0:s.id),$e=__({measure:W.dragOverlay.measure}),We=(l=$e.nodeRef.current)!=null?l:Se,me=_?(c=$e.rect)!=null?c:de:null,Qe=!!($e.nodeRef.current&&$e.rect),ot=v_(Qe?null:de),ct=rx(We?or(We):null),mt=x_(_?Ke??Se:null),ht=j_(mt),zt=lx(S,{transform:{x:G.x-ot.x,y:G.y-ot.y,scaleX:1,scaleY:1},activatorEvent:I,active:F,activeNodeRect:de,containerNodeRect:Me,draggingNodeRect:me,over:Le.current.over,overlayNodeRect:$e.rect,scrollableAncestors:mt,scrollableAncestorRects:ht,windowRect:ct}),Gt=Re?Va(Re,G):null,vt=b_(mt),ne=cv(vt),we=cv(vt,[de]),Ee=Va(zt,ne),Te=me?Vj(me,zt):null,tt=F&&Te?v({active:F,collisionRect:Te,droppableRects:Z,droppableContainers:U,pointerCoordinates:Gt}):null,_t=G0(tt,"id"),[Tt,en]=b.useState(null),jn=Qe?zt:Va(zt,we),bt=Fj(jn,(u=Tt?.rect)!=null?u:null,de),tn=b.useRef(null),ln=b.useCallback((Xe,Ve)=>{let{sensor:Ge,options:At}=Ve;if(q.current==null)return;const Ct=k.get(q.current);if(!Ct)return;const Nt=Xe.nativeEvent,Je=new Ge({active:q.current,activeNode:Ct,event:Nt,options:At,context:Le,onAbort(Fe){if(!k.get(Fe))return;const{onDragAbort:Xt}=ae.current,Kt={id:Fe};Xt?.(Kt),A({type:"onDragAbort",event:Kt})},onPending(Fe,Lt,Xt,Kt){if(!k.get(Fe))return;const{onDragPending:ee}=ae.current,ue={id:Fe,constraint:Lt,initialCoordinates:Xt,offset:Kt};ee?.(ue),A({type:"onDragPending",event:ue})},onStart(Fe){const Lt=q.current;if(Lt==null)return;const Xt=k.get(Lt);if(!Xt)return;const{onDragStart:Kt}=ae.current,te={activatorEvent:Nt,active:{id:Lt,data:Xt.data,rect:P}};Ha.unstable_batchedUpdates(()=>{Kt?.(te),L(ui.Initializing),N({type:$n.DragStart,initialCoordinates:Fe,active:Lt}),A({type:"onDragStart",event:te}),T(tn.current),Y(Nt)})},onMove(Fe){N({type:$n.DragMove,coordinates:Fe})},onEnd:Ut($n.DragEnd),onCancel:Ut($n.DragCancel)});tn.current=Je;function Ut(Fe){return async function(){const{active:Xt,collisions:Kt,over:te,scrollAdjustedTranslate:ee}=Le.current;let ue=null;if(Xt&&ee){const{cancelDrop:je}=ae.current;ue={activatorEvent:Nt,active:Xt,collisions:Kt,delta:ee,over:te},Fe===$n.DragEnd&&typeof je=="function"&&await Promise.resolve(je(ue))&&(Fe=$n.DragCancel)}q.current=null,Ha.unstable_batchedUpdates(()=>{N({type:Fe}),L(ui.Uninitialized),en(null),T(null),Y(null),tn.current=null;const je=Fe===$n.DragEnd?"onDragEnd":"onDragCancel";if(ue){const Ie=ae.current[je];Ie?.(ue),A({type:je,event:ue})}})}}},[k]),yn=b.useCallback((Xe,Ve)=>(Ge,At)=>{const Ct=Ge.nativeEvent,Nt=k.get(At);if(q.current!==null||!Nt||Ct.dndKit||Ct.defaultPrevented)return;const Je={active:Nt};Xe(Ge,Ve.options,Je)===!0&&(Ct.dndKit={capturedBy:Ve.sensor},q.current=At,ln(Ge,Ve))},[k,ln]),Un=f_(y,yn);w_(y),Wr(()=>{de&&B===ui.Initializing&&L(ui.Initialized)},[de,B]),b.useEffect(()=>{const{onDragMove:Xe}=ae.current,{active:Ve,activatorEvent:Ge,collisions:At,over:Ct}=Le.current;if(!Ve||!Ge)return;const Nt={active:Ve,activatorEvent:Ge,collisions:At,delta:{x:Ee.x,y:Ee.y},over:Ct};Ha.unstable_batchedUpdates(()=>{Xe?.(Nt),A({type:"onDragMove",event:Nt})})},[Ee.x,Ee.y]),b.useEffect(()=>{const{active:Xe,activatorEvent:Ve,collisions:Ge,droppableContainers:At,scrollAdjustedTranslate:Ct}=Le.current;if(!Xe||q.current==null||!Ve||!Ct)return;const{onDragOver:Nt}=ae.current,Je=At.get(_t),Ut=Je&&Je.rect.current?{id:Je.id,rect:Je.rect.current,data:Je.data,disabled:Je.disabled}:null,Fe={active:Xe,activatorEvent:Ve,collisions:Ge,delta:{x:Ct.x,y:Ct.y},over:Ut};Ha.unstable_batchedUpdates(()=>{en(Ut),Nt?.(Fe),A({type:"onDragOver",event:Fe})})},[_t]),Wr(()=>{Le.current={activatorEvent:I,active:F,activeNode:Se,collisionRect:Te,collisions:tt,droppableRects:Z,draggableNodes:k,draggingNode:We,draggingNodeRect:me,droppableContainers:V,over:Tt,scrollableAncestors:mt,scrollAdjustedTranslate:Ee},P.current={initial:me,translated:Te}},[F,Se,tt,Te,k,We,me,Z,V,Tt,mt,Ee]),c_({...O,delta:G,draggingRect:Te,pointerCoordinates:Gt,scrollableAncestors:mt,scrollableAncestorRects:ht});const Vn=b.useMemo(()=>({active:F,activeNode:Se,activeNodeRect:de,activatorEvent:I,collisions:tt,containerNodeRect:Me,dragOverlay:$e,draggableNodes:k,droppableContainers:V,droppableRects:Z,over:Tt,measureDroppableContainers:ce,scrollableAncestors:mt,scrollableAncestorRects:ht,measuringConfiguration:W,measuringScheduled:Oe,windowRect:ct}),[F,Se,de,I,tt,Me,$e,k,V,Z,Tt,ce,mt,ht,W,Oe,ct]),pe=b.useMemo(()=>({activatorEvent:I,activators:Un,active:F,activeNodeRect:de,ariaDescribedById:{draggable:ye},dispatch:N,draggableNodes:k,over:Tt,measureDroppableContainers:ce}),[I,Un,F,de,N,ye,k,Tt,ce]);return Ue.createElement(F0.Provider,{value:z},Ue.createElement(Ao.Provider,{value:pe},Ue.createElement(ax.Provider,{value:Vn},Ue.createElement(ku.Provider,{value:bt},m)),Ue.createElement(k_,{disabled:p?.restoreFocus===!1})),Ue.createElement(Lj,{...p,hiddenTextDescribedById:ye}));function He(){const Xe=$?.autoScrollEnabled===!1,Ve=typeof f=="object"?f.enabled===!1:f===!1,Ge=_&&!Xe&&!Ve;return typeof f=="object"?{...f,enabled:Ge}:{enabled:Ge}}}),D_=b.createContext(null),dv="button",M_="Draggable";function rp(n){let{id:t,data:s,disabled:l=!1,attributes:c}=n;const u=Ro(M_),{activators:d,activatorEvent:p,active:f,activeNodeRect:m,ariaDescribedById:y,draggableNodes:v,over:x}=b.useContext(Ao),{role:S=dv,roleDescription:C="draggable",tabIndex:E=0}=c??{},j=f?.id===t,N=b.useContext(j?ku:D_),[A,z]=uu(),[B,L]=uu(),_=S_(d,t),M=uo(s);Wr(()=>(v.set(t,{id:t,key:u,node:A,activatorNode:B,data:M}),()=>{const G=v.get(t);G&&G.key===u&&v.delete(t)}),[v,t]);const k=b.useMemo(()=>({role:S,tabIndex:E,"aria-disabled":l,"aria-pressed":j&&S===dv?!0:void 0,"aria-roledescription":C,"aria-describedby":y.draggable}),[l,S,E,j,C,y.draggable]);return{active:f,activatorEvent:p,activeNodeRect:m,attributes:k,isDragging:j,listeners:l?void 0:_,node:A,over:x,setNodeRef:z,setActivatorNodeRef:L,transform:N}}function ox(){return b.useContext(ax)}const z_="Droppable",U_={timeout:25};function Oo(n){let{data:t,disabled:s=!1,id:l,resizeObserverConfig:c}=n;const u=Ro(z_),{active:d,dispatch:p,over:f,measureDroppableContainers:m}=b.useContext(Ao),y=b.useRef({disabled:s}),v=b.useRef(!1),x=b.useRef(null),S=b.useRef(null),{disabled:C,updateMeasurementsFor:E,timeout:j}={...U_,...c},N=uo(E??l),A=b.useCallback(()=>{if(!v.current){v.current=!0;return}S.current!=null&&clearTimeout(S.current),S.current=setTimeout(()=>{m(Array.isArray(N.current)?N.current:[N.current]),S.current=null},j)},[j]),z=Tu({callback:A,disabled:C||!d}),B=b.useCallback((k,G)=>{z&&(G&&(z.unobserve(G),v.current=!1),k&&z.observe(k))},[z]),[L,_]=uu(B),M=uo(t);return b.useEffect(()=>{!z||!L.current||(z.disconnect(),v.current=!1,z.observe(L.current))},[L,z]),b.useEffect(()=>(p({type:$n.RegisterDroppable,element:{id:l,key:u,disabled:s,node:L,rect:x,data:M}}),()=>p({type:$n.UnregisterDroppable,key:u,id:l})),[l]),b.useEffect(()=>{s!==y.current.disabled&&(p({type:$n.SetDroppableDisabled,id:l,key:u,disabled:s}),y.current.disabled=s)},[l,u,s,p]),{active:d,rect:x,isOver:f?.id===l,node:L,over:f,setNodeRef:_}}function L_(n){let{animation:t,children:s}=n;const[l,c]=b.useState(null),[u,d]=b.useState(null),p=du(s);return!s&&!l&&p&&c(p),Wr(()=>{if(!u)return;const f=l?.key,m=l?.props.id;if(f==null||m==null){c(null);return}Promise.resolve(t(m,u)).then(()=>{c(null)})},[t,l,u]),Ue.createElement(Ue.Fragment,null,s,l?b.cloneElement(l,{ref:d}):null)}const I_={x:0,y:0,scaleX:1,scaleY:1};function B_(n){let{children:t}=n;return Ue.createElement(Ao.Provider,{value:ix},Ue.createElement(ku.Provider,{value:I_},t))}const $_={position:"fixed",touchAction:"none"},q_=n=>Eu(n)?"transform 250ms ease":void 0,P_=b.forwardRef((n,t)=>{let{as:s,activatorEvent:l,adjustScale:c,children:u,className:d,rect:p,style:f,transform:m,transition:y=q_}=n;if(!p)return null;const v=c?m:{...m,scaleX:1,scaleY:1},x={...$_,width:p.width,height:p.height,top:p.top,left:p.left,transform:Rr.Transform.toString(v),transformOrigin:c&&l?Ij(l,p):void 0,transition:typeof y=="function"?y(l):y,...f};return Ue.createElement(s,{className:d,style:x,ref:t},u)}),sp=n=>t=>{let{active:s,dragOverlay:l}=t;const c={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[p,f]of Object.entries(u.active))f!==void 0&&(c[p]=s.node.style.getPropertyValue(p),s.node.style.setProperty(p,f));if(u!=null&&u.dragOverlay)for(const[p,f]of Object.entries(u.dragOverlay))f!==void 0&&l.node.style.setProperty(p,f);return d!=null&&d.active&&s.node.classList.add(d.active),d!=null&&d.dragOverlay&&l.node.classList.add(d.dragOverlay),function(){for(const[f,m]of Object.entries(c))s.node.style.setProperty(f,m);d!=null&&d.active&&s.node.classList.remove(d.active)}},H_=n=>{let{transform:{initial:t,final:s}}=n;return[{transform:Rr.Transform.toString(t)},{transform:Rr.Transform.toString(s)}]},F_={duration:250,easing:"ease",keyframes:H_,sideEffects:sp({styles:{active:{opacity:"0"}}})};function G_(n){let{config:t,draggableNodes:s,droppableContainers:l,measuringConfiguration:c}=n;return Cu((u,d)=>{if(t===null)return;const p=s.get(u);if(!p)return;const f=p.node.current;if(!f)return;const m=sx(d);if(!m)return;const{transform:y}=or(d).getComputedStyle(d),v=K0(y);if(!v)return;const x=typeof t=="function"?t:V_(t);return tx(f,c.draggable.measure),x({active:{id:u,data:p.data,node:f,rect:c.draggable.measure(f)},draggableNodes:s,dragOverlay:{node:d,rect:c.dragOverlay.measure(m)},droppableContainers:l,measuringConfiguration:c,transform:v})})}function V_(n){const{duration:t,easing:s,sideEffects:l,keyframes:c}={...F_,...n};return u=>{let{active:d,dragOverlay:p,transform:f,...m}=u;if(!t)return;const y={x:p.rect.left-d.rect.left,y:p.rect.top-d.rect.top},v={scaleX:f.scaleX!==1?d.rect.width*f.scaleX/p.rect.width:1,scaleY:f.scaleY!==1?d.rect.height*f.scaleY/p.rect.height:1},x={x:f.x-y.x,y:f.y-y.y,...v},S=c({...m,active:d,dragOverlay:p,transform:{initial:f,final:x}}),[C]=S,E=S[S.length-1];if(JSON.stringify(C)===JSON.stringify(E))return;const j=l?.({active:d,dragOverlay:p,...m}),N=p.node.animate(S,{duration:t,easing:s,fill:"forwards"});return new Promise(A=>{N.onfinish=()=>{j?.(),A()}})}}let hv=0;function Y_(n){return b.useMemo(()=>{if(n!=null)return hv++,hv},[n])}const cx=Ue.memo(n=>{let{adjustScale:t=!1,children:s,dropAnimation:l,style:c,transition:u,modifiers:d,wrapperElement:p="div",className:f,zIndex:m=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:S,draggableNodes:C,droppableContainers:E,dragOverlay:j,over:N,measuringConfiguration:A,scrollableAncestors:z,scrollableAncestorRects:B,windowRect:L}=ox(),_=b.useContext(ku),M=Y_(v?.id),k=lx(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:S,draggingNodeRect:j.rect,over:N,overlayNodeRect:j.rect,scrollableAncestors:z,scrollableAncestorRects:B,transform:_,windowRect:L}),G=np(x),V=G_({config:l,draggableNodes:C,droppableContainers:E,measuringConfiguration:A}),Q=G?j.setRef:void 0;return Ue.createElement(B_,null,Ue.createElement(L_,{animation:V},v&&M?Ue.createElement(P_,{key:M,id:v.id,ref:Q,as:p,activatorEvent:y,adjustScale:t,className:f,transition:u,rect:G,style:{zIndex:m,...c},transform:k},s):null))});function Gi(n,t,s){const l=n.slice();return l.splice(s<0?l.length+s:s,0,l.splice(t,1)[0]),l}function K_(n,t){return n.reduce((s,l,c)=>{const u=t.get(l);return u&&(s[c]=u),s},Array(n.length))}function Gc(n){return n!==null&&n>=0}function Q_(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==t[s])return!1;return!0}function W_(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const ip=n=>{let{rects:t,activeIndex:s,overIndex:l,index:c}=n;const u=Gi(t,l,s),d=t[c],p=u[c];return!p||!d?null:{x:p.left-d.left,y:p.top-d.top,scaleX:p.width/d.width,scaleY:p.height/d.height}},Vc={scaleX:1,scaleY:1},po=n=>{var t;let{activeIndex:s,activeNodeRect:l,index:c,rects:u,overIndex:d}=n;const p=(t=u[s])!=null?t:l;if(!p)return null;if(c===s){const m=u[d];return m?{x:0,y:s<d?m.top+m.height-(p.top+p.height):m.top-p.top,...Vc}:null}const f=X_(u,c,s);return c>s&&c<=d?{x:0,y:-p.height-f,...Vc}:c<s&&c>=d?{x:0,y:p.height+f,...Vc}:{x:0,y:0,...Vc}};function X_(n,t,s){const l=n[t],c=n[t-1],u=n[t+1];return l?s<t?c?l.top-(c.top+c.height):u?u.top-(l.top+l.height):0:u?u.top-(l.top+l.height):c?l.top-(c.top+c.height):0:0}const ux="Sortable",dx=Ue.createContext({activeIndex:-1,containerId:ux,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:ip,disabled:{draggable:!1,droppable:!1}});function Ka(n){let{children:t,id:s,items:l,strategy:c=ip,disabled:u=!1}=n;const{active:d,dragOverlay:p,droppableRects:f,over:m,measureDroppableContainers:y}=ox(),v=Ro(ux,s),x=p.rect!==null,S=b.useMemo(()=>l.map(_=>typeof _=="object"&&"id"in _?_.id:_),[l]),C=d!=null,E=d?S.indexOf(d.id):-1,j=m?S.indexOf(m.id):-1,N=b.useRef(S),A=!Q_(S,N.current),z=j!==-1&&E===-1||A,B=W_(u);Wr(()=>{A&&C&&y(S)},[A,S,C,y]),b.useEffect(()=>{N.current=S},[S]);const L=b.useMemo(()=>({activeIndex:E,containerId:v,disabled:B,disableTransforms:z,items:S,overIndex:j,useDragOverlay:x,sortedRects:K_(S,f),strategy:c}),[E,v,B.draggable,B.droppable,z,S,j,f,x,c]);return Ue.createElement(dx.Provider,{value:L},t)}const J_=n=>{let{id:t,items:s,activeIndex:l,overIndex:c}=n;return Gi(s,l,c).indexOf(t)},Z_=n=>{let{containerId:t,isSorting:s,wasDragging:l,index:c,items:u,newIndex:d,previousItems:p,previousContainerId:f,transition:m}=n;return!m||!l||p!==u&&c===d?!1:s?!0:d!==c&&t===f},e1={duration:200,easing:"ease"},hx="transform",t1=Rr.Transition.toString({property:hx,duration:0,easing:"linear"}),n1={roleDescription:"sortable"};function r1(n){let{disabled:t,index:s,node:l,rect:c}=n;const[u,d]=b.useState(null),p=b.useRef(s);return Wr(()=>{if(!t&&s!==p.current&&l.current){const f=c.current;if(f){const m=Za(l.current,{ignoreTransform:!0}),y={x:f.left-m.left,y:f.top-m.top,scaleX:f.width/m.width,scaleY:f.height/m.height};(y.x||y.y)&&d(y)}}s!==p.current&&(p.current=s)},[t,s,l,c]),b.useEffect(()=>{u&&d(null)},[u]),u}function tl(n){let{animateLayoutChanges:t=Z_,attributes:s,disabled:l,data:c,getNewIndex:u=J_,id:d,strategy:p,resizeObserverConfig:f,transition:m=e1}=n;const{items:y,containerId:v,activeIndex:x,disabled:S,disableTransforms:C,sortedRects:E,overIndex:j,useDragOverlay:N,strategy:A}=b.useContext(dx),z=s1(l,S),B=y.indexOf(d),L=b.useMemo(()=>({sortable:{containerId:v,index:B,items:y},...c}),[v,c,B,y]),_=b.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:M,node:k,isOver:G,setNodeRef:V}=Oo({id:d,data:L,disabled:z.droppable,resizeObserverConfig:{updateMeasurementsFor:_,...f}}),{active:Q,activatorEvent:P,activeNodeRect:F,attributes:q,setNodeRef:$,listeners:T,isDragging:I,over:Y,setActivatorNodeRef:ae,transform:ye}=rp({id:d,data:L,attributes:{...n1,...s},disabled:z.draggable}),U=_j(V,$),W=!!Q,Z=W&&!C&&Gc(x)&&Gc(j),ce=!N&&I,Oe=ce&&Z?ye:null,Re=Z?Oe??(p??A)({rects:E,activeNodeRect:F,activeIndex:x,overIndex:j,index:B}):null,O=Gc(x)&&Gc(j)?u({id:d,items:y,activeIndex:x,overIndex:j}):B,ie=Q?.id,de=b.useRef({activeId:ie,items:y,newIndex:O,containerId:v}),Me=y!==de.current.items,Le=t({active:Q,containerId:v,isDragging:I,isSorting:W,id:d,index:B,items:y,newIndex:de.current.newIndex,previousItems:de.current.items,previousContainerId:de.current.containerId,transition:m,wasDragging:de.current.activeId!=null}),Ke=r1({disabled:!Le,index:B,node:k,rect:M});return b.useEffect(()=>{W&&de.current.newIndex!==O&&(de.current.newIndex=O),v!==de.current.containerId&&(de.current.containerId=v),y!==de.current.items&&(de.current.items=y)},[W,O,v,y]),b.useEffect(()=>{if(ie===de.current.activeId)return;if(ie!=null&&de.current.activeId==null){de.current.activeId=ie;return}const We=setTimeout(()=>{de.current.activeId=ie},50);return()=>clearTimeout(We)},[ie]),{active:Q,activeIndex:x,attributes:q,data:L,rect:M,index:B,newIndex:O,items:y,isOver:G,isSorting:W,isDragging:I,listeners:T,node:k,overIndex:j,over:Y,setNodeRef:U,setActivatorNodeRef:ae,setDroppableNodeRef:V,setDraggableNodeRef:$,transform:Ke??Re,transition:$e()};function $e(){if(Ke||Me&&de.current.newIndex===B)return t1;if(!(ce&&!Eu(P)||!m)&&(W||Le))return Rr.Transition.toString({...m,property:hx})}}function s1(n,t){var s,l;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(s=n?.draggable)!=null?s:t.draggable,droppable:(l=n?.droppable)!=null?l:t.droppable}}function mu(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const i1=[Ht.Down,Ht.Right,Ht.Up,Ht.Left],Au=(n,t)=>{let{context:{active:s,collisionRect:l,droppableRects:c,droppableContainers:u,over:d,scrollableAncestors:p}}=t;if(i1.includes(n.code)){if(n.preventDefault(),!s||!l)return;const f=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=c.get(v.id);if(x)switch(n.code){case Ht.Down:l.top<x.top&&f.push(v);break;case Ht.Up:l.top>x.top&&f.push(v);break;case Ht.Left:l.left>x.left&&f.push(v);break;case Ht.Right:l.left<x.left&&f.push(v);break}});const m=$j({collisionRect:l,droppableRects:c,droppableContainers:f});let y=G0(m,"id");if(y===d?.id&&m.length>1&&(y=m[1].id),y!=null){const v=u.get(s.id),x=u.get(y),S=x?c.get(x.id):null,C=x?.node.current;if(C&&S&&v&&x){const j=Nu(C).some((_,M)=>p[M]!==_),N=fx(v,x),A=a1(v,x),z=j||!N?{x:0,y:0}:{x:A?l.width-S.width:0,y:A?l.height-S.height:0},B={x:S.left,y:S.top};return z.x&&z.y?B:ho(B,z)}}}};function fx(n,t){return!mu(n)||!mu(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function a1(n,t){return!mu(n)||!mu(t)||!fx(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const fv=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},pi=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],l1=({recipe:n,isSelected:t,isSelectMode:s,onSelectRecipe:l,onToggleSelection:c,disableDrag:u,showOwner:d,ownerLabelFn:p})=>{const{attributes:f,listeners:m,setNodeRef:y,transform:v,transition:x,isDragging:S}=tl({id:n.id,disabled:u}),C={transform:Rr.Transform.toString(v),transition:x,opacity:S?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"};return i.jsx("div",{ref:y,style:C,...f,...m,children:i.jsxs(xn,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some(E=>/|Dessert/i.test(E))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{s?c(n.id):l(n)},children:[i.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?i.jsx("img",{src:n.image,alt:n.title,className:"recipe-card__image",loading:"lazy",decoding:"async"}):i.jsx("div",{className:"recipe-card__image placeholder"}),i.jsx("div",{className:"recipe-card__overlay"}),s&&i.jsx("div",{className:"recipe-card__selection-overlay",children:i.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),i.jsx("div",{className:"recipe-card__tags",children:(()=>{const E=pi(n.tags);if(E.length===0)return null;const j=E.filter(z=>!z.startsWith("owner:"));return(j.includes("URL")?["URL"]:j).slice(0,1).map((z,B)=>i.jsx("span",{className:"recipe-tag",children:z},`${z}-${B}`))})()})]}),i.jsxs("div",{className:"recipe-card__content",children:[i.jsx("h3",{className:"recipe-title",children:n.title}),i.jsx("p",{className:"recipe-desc",children:n.description}),i.jsxs("div",{className:"recipe-meta",children:[n.storeName&&i.jsxs("span",{children:[" ",n.storeName]}),d&&typeof p=="function"&&i.jsxs("span",{className:"recipe-owner",children:[" ",p(n)]}),i.jsxs("div",{className:"recipe-dates",children:[i.jsxs("span",{className:"recipe-date",children:[" : ",fv(n.created_at)]}),n.updated_at&&i.jsxs("span",{className:"recipe-date",children:[" : ",fv(n.updated_at)]})]})]})]})]})})},pv=n=>{const t=pi(n.tags);return n.type==="bread"||t.some(s=>/|Bread/i.test(s))},mv=n=>{const t=l=>/|Dessert/i.test(l),s=pi(n.tags);return/|Dessert/i.test(n.category||"")||s.some(t)},gv=n=>{const t=pi(n.tags);return/|Sauce/i.test(n.category||"")||t.some(s=>/|Sauce/i.test(s))},yv=n=>{const t=pi(n.tags);return/||Decor/i.test(n.category||"")||t.some(s=>/||Decor/i.test(s))},vv=n=>{const t=n.category||"",s=pi(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||s.some(l=>/|Dressing||Vinaigrette||Mayonnaise/i.test(l))},xv=n=>{const t=n.filter(v=>pv(v)),s=n.filter(v=>!pv(v)),l=s.filter(v=>gv(v)),c=s.filter(v=>!gv(v)),u=c.filter(v=>yv(v)),d=c.filter(v=>!yv(v)),p=d.filter(v=>vv(v)),f=d.filter(v=>!vv(v)),m=f.filter(v=>mv(v));return{cookingRecipes:f.filter(v=>!mv(v)),breadRecipes:t,dessertRecipes:m,sauceRecipes:l,dressingRecipes:p,decorationRecipes:u}},bv=({recipes:n,onSelectRecipe:t,isSelectMode:s,selectedIds:l,onToggleSelection:c,disableDrag:u,displayMode:d="normal",publicRecipeView:p="none",showOwner:f=!1,ownerLabelFn:m,currentUser:y=null})=>{const[v,x]=b.useState({}),S=$=>{x(T=>({...T,[$]:!T[$]}))},C=$=>pi($?.tags).map(I=>I.toLowerCase()).includes("public"),E=$=>{if(!y)return!1;const T=pi($?.tags).filter(Y=>Y.startsWith("owner:"));if(T.length===0)return!1;const I=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return T.some(Y=>I.has(Y))},j=n.filter($=>C($)),N=j.filter($=>E($)),A=j.filter($=>!E($)),z=n.filter($=>!C($)),{cookingRecipes:B,breadRecipes:L,dessertRecipes:_,sauceRecipes:M,dressingRecipes:k,decorationRecipes:G}=xv(z),[V,Q]=b.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);Ue.useEffect(()=>{const $=()=>{window.innerWidth>=1024?Q(9):Q(8)};return window.addEventListener("resize",$),()=>window.removeEventListener("resize",$)},[]);const P=($,T,I,Y,{showWhenEmpty:ae=!1,emptyMessage:ye=""}={})=>{if(T.length===0&&!ae)return null;const U=d==="all";let W=T,Z=!1,ce=!1;return U||(Z=v[Y],ce=T.length>V,W=Z?T:T.slice(0,V)),i.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{onClick:()=>!U&&ce&&S(Y),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!U&&ce?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[i.jsx("span",{children:I})," ",$,i.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",T.length,")"]}),!U&&ce&&i.jsx("span",{className:"section-toggle-btn",children:Z?" ":" "})]}),i.jsx("div",{className:"recipe-grid",children:i.jsx(Ka,{items:W.map(Oe=>Oe.id),strategy:ip,children:W.map(Oe=>{const Se=l&&l.has(Oe.id);return i.jsx(l1,{recipe:Oe,isSelected:Se,isSelectMode:s,onSelectRecipe:t,onToggleSelection:c,disableDrag:u,showOwner:f,ownerLabelFn:m},Oe.id)})})}),T.length===0&&i.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:ye||`${$}`})]})},F=()=>{if(p!=="mine"&&p!=="others")return null;const $=p==="mine",T=$?"":"",I=$?"":"",Y=$?"public-mine":"public-others",ae=$?N:A,ye=$?"":"",U=xv(ae);return i.jsxs("div",{className:"public-recipes-block",children:[i.jsxs("div",{className:"public-recipes-block__header",children:[i.jsx("span",{children:I}),i.jsx("span",{children:T}),i.jsxs("span",{className:"public-recipes-block__count",children:["(",ae.length,")"]})]}),ae.length===0?i.jsx("div",{className:"public-recipes-block__empty",children:ye}):i.jsxs(i.Fragment,{children:[P("",U.cookingRecipes,"",`${Y}-cooking`),P("",U.breadRecipes,"",`${Y}-bread`),P("",U.dessertRecipes,"",`${Y}-dessert`),P("",U.sauceRecipes,"",`${Y}-sauce`),P("",U.dressingRecipes,"",`${Y}-dressing`),P("",U.decorationRecipes,"",`${Y}-decoration`)]})]})},q=p==="none"&&j.length>0&&z.length===0;return i.jsxs("div",{className:"recipe-list-container",children:[F(),q&&i.jsx("div",{className:"recipe-list-empty-hint",children:""}),P("",B,"","cooking"),P("",L,"","bread"),P("",_,"","dessert"),P("",M,"","sauce"),P("",k,"","dressing"),P("",G,"","decoration"),n.length===0&&i.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},Bn=({isOpen:n,onClose:t,title:s,children:l,size:c="medium",showCloseButton:u=!0})=>{if(b.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),b.useEffect(()=>{const p=f=>{f.key==="Escape"&&n&&t()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[n,t]),!n)return null;const d=p=>{p.target===p.currentTarget&&t()};return i.jsx("div",{className:"modal-overlay",onClick:d,children:i.jsxs("div",{className:`modal-content modal-${c}`,children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h3",{className:"modal-title",children:s}),u&&i.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),i.jsx("div",{className:"modal-body",children:l})]})})};function Ou(n,t){var s={};for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&t.indexOf(l)<0&&(s[l]=n[l]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(n);c<l.length;c++)t.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(n,l[c])&&(s[l[c]]=n[l[c]]);return s}function o1(n,t,s,l){function c(u){return u instanceof s?u:new s(function(d){d(u)})}return new(s||(s=Promise))(function(u,d){function p(y){try{m(l.next(y))}catch(v){d(v)}}function f(y){try{m(l.throw(y))}catch(v){d(v)}}function m(y){y.done?u(y.value):c(y.value).then(p,f)}m((l=l.apply(n,t||[])).next())})}const c1=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class ap extends Error{constructor(t,s="FunctionsError",l){super(t),this.name=s,this.context=l}}class u1 extends ap{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class wv extends ap{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Sv extends ap{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var kf;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(kf||(kf={}));class d1{constructor(t,{headers:s={},customFetch:l,region:c=kf.Any}={}){this.url=t,this.headers=s,this.region=c,this.fetch=c1(l)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return o1(this,arguments,void 0,function*(s,l={}){var c;let u,d;try{const{headers:p,method:f,body:m,signal:y,timeout:v}=l;let x={},{region:S}=l;S||(S=this.region);const C=new URL(`${this.url}/${s}`);S&&S!=="any"&&(x["x-region"]=S,C.searchParams.set("forceFunctionRegion",S));let E;m&&(p&&!Object.prototype.hasOwnProperty.call(p,"Content-Type")||!p)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",E=m):typeof m=="string"?(x["Content-Type"]="text/plain",E=m):typeof FormData<"u"&&m instanceof FormData?E=m:(x["Content-Type"]="application/json",E=JSON.stringify(m)):E=m;let j=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(j=d.signal,y.addEventListener("abort",()=>d.abort())):j=d.signal);const N=yield this.fetch(C.toString(),{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),p),body:E,signal:j}).catch(L=>{throw new u1(L)}),A=N.headers.get("x-relay-error");if(A&&A==="true")throw new wv(N);if(!N.ok)throw new Sv(N);let z=((c=N.headers.get("Content-Type"))!==null&&c!==void 0?c:"text/plain").split(";")[0].trim(),B;return z==="application/json"?B=yield N.json():z==="application/octet-stream"||z==="application/pdf"?B=yield N.blob():z==="text/event-stream"?B=N:z==="multipart/form-data"?B=yield N.formData():B=yield N.text(),{data:B,error:null,response:N}}catch(p){return{data:null,error:p,response:p instanceof Sv||p instanceof wv?p.context:void 0}}finally{u&&clearTimeout(u)}})}}var h1=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},f1=class{constructor(n){var t,s;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(s=n.isMaybeSingle)!==null&&s!==void 0?s:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const l=this.fetch;let c=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,p=null,f=null,m=u.status,y=u.statusText;if(u.ok){var v,x;if(s.method!=="HEAD"){var S;const N=await u.text();N===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((S=s.headers.get("Accept"))===null||S===void 0)&&S.includes("application/vnd.pgrst.plan+text"))?p=N:p=JSON.parse(N))}const E=(v=s.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),j=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");E&&j&&j.length>1&&(f=parseInt(j[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(p)&&(p.length>1?(d={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,f=null,m=406,y="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{var C;const E=await u.text();try{d=JSON.parse(E),Array.isArray(d)&&u.status===404&&(p=[],d=null,m=200,y="OK")}catch{u.status===404&&E===""?(m=204,y="No Content"):d={message:E}}if(d&&s.isMaybeSingle&&(!(d==null||(C=d.details)===null||C===void 0)&&C.includes("0 rows"))&&(d=null,m=200,y="OK"),d&&s.shouldThrowOnError)throw new h1(d)}return{error:d,data:p,count:f,status:m,statusText:y}});return this.shouldThrowOnError||(c=c.catch(u=>{var d;let p="";const f=u?.cause;if(f){var m,y,v,x;const C=(m=f?.message)!==null&&m!==void 0?m:"",E=(y=f?.code)!==null&&y!==void 0?y:"";p=`${(v=u?.name)!==null&&v!==void 0?v:"FetchError"}: ${u?.message}`,p+=`

Caused by: ${(x=f?.name)!==null&&x!==void 0?x:"Error"}: ${C}`,E&&(p+=` (${E})`),f?.stack&&(p+=`
${f.stack}`)}else{var S;p=(S=u?.stack)!==null&&S!==void 0?S:""}return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:p,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),c.then(n,t)}returns(){return this}overrideTypes(){return this}},p1=class extends f1{select(n){let t=!1;const s=(n??"*").split("").map(l=>/\s/.test(l)&&!t?"":(l==='"'&&(t=!t),l)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:s,foreignTable:l,referencedTable:c=l}={}){const u=c?`${c}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:s=t}={}){const l=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(l,`${n}`),this}range(n,t,{foreignTable:s,referencedTable:l=s}={}){const c=typeof l>"u"?"offset":`${l}.offset`,u=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(c,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:s=!1,buffers:l=!1,wal:c=!1,format:u="text"}={}){var d;const p=[n?"analyze":null,t?"verbose":null,s?"settings":null,l?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${f}"; options=${p};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const jv=new RegExp("[,()]");var Ba=class extends p1{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const s=Array.from(new Set(t)).map(l=>typeof l=="string"&&jv.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`in.(${s})`),this}notIn(n,t){const s=Array.from(new Set(t)).map(l=>typeof l=="string"&&jv.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`not.in.(${s})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:s,type:l}={}){let c="";l==="plain"?c="pl":l==="phrase"?c="ph":l==="websearch"&&(c="w");const u=s===void 0?"":`(${s})`;return this.url.searchParams.append(n,`${c}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(n,t,s){return this.url.searchParams.append(n,`not.${t}.${s}`),this}or(n,{foreignTable:t,referencedTable:s=t}={}){const l=s?`${s}.or`:"or";return this.url.searchParams.append(l,`(${n})`),this}filter(n,t,s){return this.url.searchParams.append(n,`${t}.${s}`),this}},m1=class{constructor(n,{headers:t={},schema:s,fetch:l}){this.url=n,this.headers=new Headers(t),this.schema=s,this.fetch=l}select(n,t){const{head:s=!1,count:l}=t??{},c=s?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(p=>/\s/.test(p)&&!u?"":(p==='"'&&(u=!u),p)).join("");return this.url.searchParams.set("select",d),l&&this.headers.append("Prefer",`count=${l}`),new Ba({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:t,defaultToNull:s=!0}={}){var l;const c="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((d,p)=>d.concat(Object.keys(p)),[]);if(u.length>0){const d=[...new Set(u)].map(p=>`"${p}"`);this.url.searchParams.set("columns",d.join(","))}}return new Ba({method:c,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(n,{onConflict:t,ignoreDuplicates:s=!1,count:l,defaultToNull:c=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const p=n.reduce((f,m)=>f.concat(Object.keys(m)),[]);if(p.length>0){const f=[...new Set(p)].map(m=>`"${m}"`);this.url.searchParams.set("columns",f.join(","))}}return new Ba({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(n,{count:t}={}){var s;const l="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Ba({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:n}={}){var t;const s="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new Ba({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},g1=class px{constructor(t,{headers:s={},schema:l,fetch:c}={}){this.url=t,this.headers=new Headers(s),this.schemaName=l,this.fetch=c}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new m1(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new px(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:l=!1,get:c=!1,count:u}={}){var d;let p;const f=new URL(`${this.url}/rpc/${t}`);let m;l||c?(p=l?"HEAD":"GET",Object.entries(s).filter(([v,x])=>x!==void 0).map(([v,x])=>[v,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([v,x])=>{f.searchParams.append(v,x)})):(p="POST",m=s);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new Ba({method:p,url:f,headers:y,schema:this.schemaName,body:m,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}};class y1{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const s=process.versions;if(s&&s.node){const l=s.node,c=parseInt(l.replace(/^v/,"").split(".")[0]);return c>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${c} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${c} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const l=this.getWebSocketConstructor();return new l(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const v1="2.89.0",x1=`realtime-js/${v1}`,mx="1.0.0",b1="2.0.0",_v=mx,Af=1e4,w1=1e3,S1=100;var di;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(di||(di={}));var In;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(In||(In={}));var Qr;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Qr||(Qr={}));var Of;(function(n){n.websocket="websocket"})(Of||(Of={}));var Bi;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Bi||(Bi={}));class j1{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,s){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return s(this._binaryEncodeUserBroadcastPush(t));let l=[t.join_ref,t.ref,t.topic,t.event,t.payload];return s(JSON.stringify(l))}_binaryEncodeUserBroadcastPush(t){var s;return this._isArrayBuffer((s=t.payload)===null||s===void 0?void 0:s.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var s,l;const c=(l=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&l!==void 0?l:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,c)}_encodeJsonUserBroadcastPush(t){var s,l;const c=(l=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&l!==void 0?l:{},d=new TextEncoder().encode(JSON.stringify(c)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,s,l){var c,u;const d=t.topic,p=(c=t.ref)!==null&&c!==void 0?c:"",f=(u=t.join_ref)!==null&&u!==void 0?u:"",m=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(f.length>255)throw new Error(`joinRef length ${f.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`ref length ${p.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`userEvent length ${m.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+f.length+p.length+d.length+m.length+v.length,S=new ArrayBuffer(this.HEADER_LENGTH+x);let C=new DataView(S),E=0;C.setUint8(E++,this.KINDS.userBroadcastPush),C.setUint8(E++,f.length),C.setUint8(E++,p.length),C.setUint8(E++,d.length),C.setUint8(E++,m.length),C.setUint8(E++,v.length),C.setUint8(E++,s),Array.from(f,N=>C.setUint8(E++,N.charCodeAt(0))),Array.from(p,N=>C.setUint8(E++,N.charCodeAt(0))),Array.from(d,N=>C.setUint8(E++,N.charCodeAt(0))),Array.from(m,N=>C.setUint8(E++,N.charCodeAt(0))),Array.from(v,N=>C.setUint8(E++,N.charCodeAt(0)));var j=new Uint8Array(S.byteLength+l.byteLength);return j.set(new Uint8Array(S),0),j.set(new Uint8Array(l),S.byteLength),j.buffer}decode(t,s){if(this._isArrayBuffer(t)){let l=this._binaryDecode(t);return s(l)}if(typeof t=="string"){const l=JSON.parse(t),[c,u,d,p,f]=l;return s({join_ref:c,ref:u,topic:d,event:p,payload:f})}return s({})}_binaryDecode(t){const s=new DataView(t),l=s.getUint8(0),c=new TextDecoder;if(l===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,s,c)}_decodeUserBroadcast(t,s,l){const c=s.getUint8(1),u=s.getUint8(2),d=s.getUint8(3),p=s.getUint8(4);let f=this.HEADER_LENGTH+4;const m=l.decode(t.slice(f,f+c));f=f+c;const y=l.decode(t.slice(f,f+u));f=f+u;const v=l.decode(t.slice(f,f+d));f=f+d;const x=t.slice(f,t.byteLength),S=p===this.JSON_ENCODING?JSON.parse(l.decode(x)):x,C={type:this.BROADCAST_EVENT,event:y,payload:S};return d>0&&(C.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST_EVENT,payload:C}}_isArrayBuffer(t){var s;return t instanceof ArrayBuffer||((s=t?.constructor)===null||s===void 0?void 0:s.name)==="ArrayBuffer"}_pick(t,s){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([l])=>s.includes(l)))}}class gx{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var dn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(dn||(dn={}));const Cv=(n,t,s={})=>{var l;const c=(l=s.skipTypes)!==null&&l!==void 0?l:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=_1(d,n,t,c),u),{}):{}},_1=(n,t,s,l)=>{const c=t.find(p=>p.name===n),u=c?.type,d=s[n];return u&&!l.includes(u)?yx(u,d):Df(d)},yx=(n,t)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return R1(t,s)}switch(n){case dn.bool:return C1(t);case dn.float4:case dn.float8:case dn.int2:case dn.int4:case dn.int8:case dn.numeric:case dn.oid:return E1(t);case dn.json:case dn.jsonb:return N1(t);case dn.timestamp:return T1(t);case dn.abstime:case dn.date:case dn.daterange:case dn.int4range:case dn.int8range:case dn.money:case dn.reltime:case dn.text:case dn.time:case dn.timestamptz:case dn.timetz:case dn.tsrange:case dn.tstzrange:return Df(t);default:return Df(t)}},Df=n=>n,C1=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},E1=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},N1=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},R1=(n,t)=>{if(typeof n!="string")return n;const s=n.length-1,l=n[s];if(n[0]==="{"&&l==="}"){let u;const d=n.slice(1,s);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(p=>yx(t,p))}return n},T1=n=>typeof n=="string"?n.replace(" ","T"):n,vx=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Yh{constructor(t,s,l={},c=Af){this.channel=t,this.event=s,this.payload=l,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var l;return this._hasReceived(t)&&s((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(l=>l.status===t).forEach(l=>l.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Ev;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Ev||(Ev={}));class lo{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},c=>{const{onJoin:u,onLeave:d,onSync:p}=this.caller;this.joinRef=this.channel._joinRef(),this.state=lo.syncState(this.state,c,u,d),this.pendingDiffs.forEach(f=>{this.state=lo.syncDiff(this.state,f,u,d)}),this.pendingDiffs=[],p()}),this.channel._on(l.diff,{},c=>{const{onJoin:u,onLeave:d,onSync:p}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=lo.syncDiff(this.state,c,u,d),p())}),this.onJoin((c,u,d)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:u,newPresences:d})}),this.onLeave((c,u,d)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,l,c){const u=this.cloneDeep(t),d=this.transformState(s),p={},f={};return this.map(u,(m,y)=>{d[m]||(f[m]=y)}),this.map(d,(m,y)=>{const v=u[m];if(v){const x=y.map(j=>j.presence_ref),S=v.map(j=>j.presence_ref),C=y.filter(j=>S.indexOf(j.presence_ref)<0),E=v.filter(j=>x.indexOf(j.presence_ref)<0);C.length>0&&(p[m]=C),E.length>0&&(f[m]=E)}else p[m]=y}),this.syncDiff(u,{joins:p,leaves:f},l,c)}static syncDiff(t,s,l,c){const{joins:u,leaves:d}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return l||(l=()=>{}),c||(c=()=>{}),this.map(u,(p,f)=>{var m;const y=(m=t[p])!==null&&m!==void 0?m:[];if(t[p]=this.cloneDeep(f),y.length>0){const v=t[p].map(S=>S.presence_ref),x=y.filter(S=>v.indexOf(S.presence_ref)<0);t[p].unshift(...x)}l(p,y,f)}),this.map(d,(p,f)=>{let m=t[p];if(!m)return;const y=f.map(v=>v.presence_ref);m=m.filter(v=>y.indexOf(v.presence_ref)<0),t[p]=m,c(p,m,f),m.length===0&&delete t[p]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(l=>s(l,t[l]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,l)=>{const c=t[l];return"metas"in c?s[l]=c.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):s[l]=c,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Nv;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Nv||(Nv={}));var oo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(oo||(oo={}));var Ns;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Ns||(Ns={}));class Fa{constructor(t,s={config:{}},l){var c,u;if(this.topic=t,this.params=s,this.socket=l,this.bindings={},this.state=In.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new Yh(this,Qr.join,this.params,this.timeout),this.rejoinTimer=new gx(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=In.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=In.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=In.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=In.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=In.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Qr.reply,{},(d,p)=>{this._trigger(this._replyEventName(p),d)}),this.presence=new lo(this),this.broadcastEndpointURL=vx(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(c=this.params.config)===null||c===void 0?void 0:c.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,s=this.timeout){var l,c,u;if(this.socket.isConnected()||this.socket.connect(),this.state==In.closed){const{config:{broadcast:d,presence:p,private:f}}=this.params,m=(c=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(S=>S.filter))!==null&&c!==void 0?c:[],y=!!this.bindings[oo.PRESENCE]&&this.bindings[oo.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},p),{enabled:y}),postgres_changes:m,private:f};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(S=>t?.(Ns.CHANNEL_ERROR,S)),this._onClose(()=>t?.(Ns.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:S})=>{var C;if(this.socket._isManualToken()||this.socket.setAuth(),S===void 0){t?.(Ns.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,j=(C=E?.length)!==null&&C!==void 0?C:0,N=[];for(let A=0;A<j;A++){const z=E[A],{filter:{event:B,schema:L,table:_,filter:M}}=z,k=S&&S[A];if(k&&k.event===B&&Fa.isFilterValueEqual(k.schema,L)&&Fa.isFilterValueEqual(k.table,_)&&Fa.isFilterValueEqual(k.filter,M))N.push(Object.assign(Object.assign({},z),{id:k.id}));else{this.unsubscribe(),this.state=In.errored,t?.(Ns.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=N,t&&t(Ns.SUBSCRIBED);return}}).receive("error",S=>{this.state=In.errored,t?.(Ns.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{t?.(Ns.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,l){return this.state===In.joined&&t===oo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,s,l)}async httpSend(t,s,l={}){var c;if(s==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:s,private:this.private}]})},p=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(c=l.timeout)!==null&&c!==void 0?c:this.timeout);if(p.status===202)return{success:!0};let f=p.statusText;try{const m=await p.json();f=m.error||m.message||f}catch{}return Promise.reject(new Error(f))}async send(t,s={}){var l,c;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,p={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(p.Authorization=`Bearer ${this.socket.accessTokenValue}`);const f={method:"POST",headers:p,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(l=s.timeout)!==null&&l!==void 0?l:this.timeout);return await((c=m.body)===null||c===void 0?void 0:c.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,p,f;const m=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((f=(p=(d=this.params)===null||d===void 0?void 0:d.config)===null||p===void 0?void 0:p.broadcast)===null||f===void 0)&&f.ack)&&u("ok"),m.receive("ok",()=>u("ok")),m.receive("error",()=>u("error")),m.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=In.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Qr.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(c=>{l=new Yh(this,Qr.leave,{},t),l.receive("ok",()=>{s(),c("ok")}).receive("timeout",()=>{s(),c("timed out")}).receive("error",()=>{c("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=In.closed,this.bindings={}}async _fetchWithTimeout(t,s,l){const c=new AbortController,u=setTimeout(()=>c.abort(),l),d=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:c.signal}));return clearTimeout(u),d}_push(t,s,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new Yh(this,t,s,l);return this._canPush()?c.send():this._addToPushBuffer(c),c}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>S1){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,l){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,l){var c,u;const d=t.toLocaleLowerCase(),{close:p,error:f,leave:m,join:y}=Qr;if(l&&[p,f,m,y].indexOf(d)>=0&&l!==this._joinRef())return;let x=this._onMessage(d,s,l);if(s&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(S=>{var C,E,j;return((C=S.filter)===null||C===void 0?void 0:C.event)==="*"||((j=(E=S.filter)===null||E===void 0?void 0:E.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===d}).map(S=>S.callback(x,l)):(u=this.bindings[d])===null||u===void 0||u.filter(S=>{var C,E,j,N,A,z;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in S){const B=S.id,L=(C=S.filter)===null||C===void 0?void 0:C.event;return B&&((E=s.ids)===null||E===void 0?void 0:E.includes(B))&&(L==="*"||L?.toLocaleLowerCase()===((j=s.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const B=(A=(N=S?.filter)===null||N===void 0?void 0:N.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return B==="*"||B===((z=s?.event)===null||z===void 0?void 0:z.toLocaleLowerCase())}else return S.type.toLocaleLowerCase()===d}).map(S=>{if(typeof x=="object"&&"ids"in x){const C=x.data,{schema:E,table:j,commit_timestamp:N,type:A,errors:z}=C;x=Object.assign(Object.assign({},{schema:E,table:j,commit_timestamp:N,eventType:A,new:{},old:{},errors:z}),this._getPayloadRecords(C))}S.callback(x,l)})}_isClosed(){return this.state===In.closed}_isJoined(){return this.state===In.joined}_isJoining(){return this.state===In.joining}_isLeaving(){return this.state===In.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,l){const c=t.toLocaleLowerCase(),u={type:c,filter:s,callback:l};return this.bindings[c]?this.bindings[c].push(u):this.bindings[c]=[u],this}_off(t,s){const l=t.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(c=>{var u;return!(((u=c.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===l&&Fa.isEqual(c.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(t[l]!==s[l])return!1;return!0}static isFilterValueEqual(t,s){return(t??void 0)===(s??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Qr.close,{},t)}_onError(t){this._on(Qr.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=In.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=Cv(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=Cv(t.columns,t.old_record)),s}}const Kh=()=>{},Yc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},k1=[1e3,2e3,5e3,1e4],A1=1e4,O1=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class D1{constructor(t,s){var l;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Af,this.transport=null,this.heartbeatIntervalMs=Yc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Kh,this.ref=0,this.reconnectTimer=null,this.vsn=_v,this.logger=Kh,this.conn=null,this.sendBuffer=[],this.serializer=new j1,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=c=>c?(...u)=>c(...u):(...u)=>fetch(...u),!(!((l=s?.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${Of.websocket}`,this.httpEndpoint=vx(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=y1.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,s??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,l){this.logger(t,s,l)}connectionState(){switch(this.conn&&this.conn.readyState){case di.connecting:return Bi.Connecting;case di.open:return Bi.Open;case di.closing:return Bi.Closing;default:return Bi.Closed}}isConnected(){return this.connectionState()===Bi.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const l=`realtime:${t}`,c=this.getChannels().find(u=>u.topic===l);if(c)return c;{const u=new Fa(`realtime:${t}`,s,this);return this.channels.push(u),u}}push(t){const{topic:s,event:l,payload:c,ref:u}=t,d=()=>{this.encode(t,p=>{var f;(f=this.conn)===null||f===void 0||f.send(p)})};this.log("push",`${s} ${l} (${u})`,c),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(w1,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Yc.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(l=>l.topic===t&&(l._isJoined()||l._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(m){this.log("error","error in heartbeat callback",m)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:l,event:c,payload:u,ref:d}=s,p=d?`(${d})`:"",f=u.status||"";this.log("receive",`${f} ${l} ${c} ${p}`.trim(),u),this.channels.filter(m=>m._isMember(l)).forEach(m=>m._trigger(c,u,d)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===di.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===di.open||this.conn.readyState===di.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(s=>{this.log("error","error waiting for auth on connect",s),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this._terminateWorker()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Qr.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const l=t.match(/\?/)?"&":"?",c=new URLSearchParams(s);return`${t}${l}${c}`}_workerObjectUrl(t){let s;if(t)s=t;else{const l=new Blob([O1],{type:"application/javascript"});s=URL.createObjectURL(l)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s,l=!1;if(t)s=t,l=!0;else if(this.accessToken)try{s=await this.accessToken()}catch(c){this.log("error","Error fetching access token from callback",c),s=this.accessTokenValue}else s=this.accessTokenValue;l?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(c=>{const u={access_token:s,version:x1};s&&c.updateJoinPayload(u),c.joinedOnce&&c._isJoined()&&c._push(Qr.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(s=>{this.log("error",`Error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(l=>{try{l(s)}catch(c){this.log("error",`error in ${t} callback`,c)}})}catch(l){this.log("error",`error triggering ${t} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new gx(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Yc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,l,c,u,d,p,f,m,y,v,x,S;switch(this.transport=(s=t?.transport)!==null&&s!==void 0?s:null,this.timeout=(l=t?.timeout)!==null&&l!==void 0?l:Af,this.heartbeatIntervalMs=(c=t?.heartbeatIntervalMs)!==null&&c!==void 0?c:Yc.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(p=t?.heartbeatCallback)!==null&&p!==void 0?p:Kh,this.vsn=(f=t?.vsn)!==null&&f!==void 0?f:_v,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=t?.reconnectAfterMs)!==null&&m!==void 0?m:(C=>k1[C-1]||A1),this.vsn){case mx:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((C,E)=>E(JSON.stringify(C))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((C,E)=>E(JSON.parse(C)));break;case b1:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(S=t?.decode)!==null&&S!==void 0?S:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var mo=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function M1(n,t,s){const l=new URL(t,n);if(s)for(const[c,u]of Object.entries(s))u!==void 0&&l.searchParams.set(c,u);return l.toString()}async function z1(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function U1(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:s,path:l,query:c,body:u,headers:d}){const p=M1(n.baseUrl,l,c),f=await z1(n.auth),m=await t(p,{method:s,headers:{...u?{"Content-Type":"application/json"}:{},...f,...d},body:u?JSON.stringify(u):void 0}),y=await m.text(),v=(m.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!m.ok){const S=v?x:void 0,C=S?.error;throw new mo(C?.message??`Request failed with status ${m.status}`,{status:m.status,icebergType:C?.type,icebergCode:C?.code,details:S})}return{status:m.status,headers:m.headers,data:x}}}}function Kc(n){return n.join("")}var L1=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:Kc(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(l=>({namespace:l}))}async createNamespace(n,t){const s={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Kc(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Kc(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Kc(n.namespace)}`}),!0}catch(t){if(t instanceof mo&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(s){if(s instanceof mo&&s.status===409)return;throw s}}};function Ta(n){return n.join("")}var I1=class{constructor(n,t="",s){this.client=n,this.prefix=t,this.accessDelegation=s}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ta(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ta(n.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(n,t){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ta(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ta(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ta(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ta(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(s){if(s instanceof mo&&s.status===404)return!1;throw s}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(s){if(s instanceof mo&&s.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw s}}},B1=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const s=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=U1({baseUrl:s,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new L1(this.client,t),this.tableOps=new I1(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},Du=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function vn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var $1=class extends Du{constructor(n,t,s){super(n),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Mf=class extends Du{constructor(n,t){super(n),this.name="StorageUnknownError",this.originalError=t}};const lp=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),q1=()=>Response,zf=n=>{if(Array.isArray(n))return n.map(s=>zf(s));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([s,l])=>{const c=s.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[c]=zf(l)}),t},P1=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},H1=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function go(n){"@babel/helpers - typeof";return go=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},go(n)}function F1(n,t){if(go(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var l=s.call(n,t);if(go(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function G1(n){var t=F1(n,"string");return go(t)=="symbol"?t:t+""}function V1(n,t,s){return(t=G1(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function Rv(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable})),s.push.apply(s,l)}return s}function yt(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Rv(Object(s),!0).forEach(function(l){V1(n,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Rv(Object(s)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(s,l))})}return n}const Qh=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},Y1=async(n,t,s)=>{n instanceof await q1()&&!s?.noResolveJson?n.json().then(l=>{const c=n.status||500,u=l?.statusCode||c+"";t(new $1(Qh(l),c,u))}).catch(l=>{t(new Mf(Qh(l),l))}):t(new Mf(Qh(n),n))},K1=(n,t,s,l)=>{const c={method:n,headers:t?.headers||{}};return n==="GET"||!l?c:(P1(l)?(c.headers=yt({"Content-Type":"application/json"},t?.headers),c.body=JSON.stringify(l)):c.body=l,t?.duplex&&(c.duplex=t.duplex),yt(yt({},c),s))};async function Do(n,t,s,l,c,u){return new Promise((d,p)=>{n(s,K1(t,l,c,u)).then(f=>{if(!f.ok)throw f;return l?.noResolveJson?f:f.json()}).then(f=>d(f)).catch(f=>Y1(f,p,l))})}async function yo(n,t,s,l){return Do(n,"GET",t,s,l)}async function Kr(n,t,s,l,c){return Do(n,"POST",t,l,c,s)}async function Uf(n,t,s,l,c){return Do(n,"PUT",t,l,c,s)}async function Q1(n,t,s,l){return Do(n,"HEAD",t,yt(yt({},s),{},{noResolveJson:!0}),l)}async function op(n,t,s,l,c){return Do(n,"DELETE",t,l,c,s)}var W1=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(vn(t))return{data:null,error:t};throw t}}};let xx;xx=Symbol.toStringTag;var X1=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[xx]="BlobDownloadBuilder",this.promise=null}asStream(){return new W1(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(vn(t))return{data:null,error:t};throw t}}};const J1={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Tv={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Z1=class{constructor(n,t={},s,l){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.bucketId=s,this.fetch=lp(l)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,t,s,l){var c=this;try{let u;const d=yt(yt({},Tv),l);let p=yt(yt({},c.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const f=d.metadata;typeof Blob<"u"&&s instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),f&&u.append("metadata",c.encodeMetadata(f)),u.append("",s)):typeof FormData<"u"&&s instanceof FormData?(u=s,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),f&&!u.has("metadata")&&u.append("metadata",c.encodeMetadata(f))):(u=s,p["cache-control"]=`max-age=${d.cacheControl}`,p["content-type"]=d.contentType,f&&(p["x-metadata"]=c.toBase64(c.encodeMetadata(f))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),l?.headers&&(p=yt(yt({},p),l.headers));const m=c._removeEmptyFolders(t),y=c._getFinalPath(m),v=await(n=="PUT"?Uf:Kr)(c.fetch,`${c.url}/object/${y}`,u,yt({headers:p},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:m,id:v.Id,fullPath:v.Key},error:null}}catch(u){if(c.shouldThrowOnError)throw u;if(vn(u))return{data:null,error:u};throw u}}async upload(n,t,s){return this.uploadOrUpdate("POST",n,t,s)}async uploadToSignedUrl(n,t,s,l){var c=this;const u=c._removeEmptyFolders(n),d=c._getFinalPath(u),p=new URL(c.url+`/object/upload/sign/${d}`);p.searchParams.set("token",t);try{let f;const m=yt({upsert:Tv.upsert},l),y=yt(yt({},c.headers),{"x-upsert":String(m.upsert)});return typeof Blob<"u"&&s instanceof Blob?(f=new FormData,f.append("cacheControl",m.cacheControl),f.append("",s)):typeof FormData<"u"&&s instanceof FormData?(f=s,f.append("cacheControl",m.cacheControl)):(f=s,y["cache-control"]=`max-age=${m.cacheControl}`,y["content-type"]=m.contentType),{data:{path:u,fullPath:(await Uf(c.fetch,p.toString(),f,{headers:y})).Key},error:null}}catch(f){if(c.shouldThrowOnError)throw f;if(vn(f))return{data:null,error:f};throw f}}async createSignedUploadUrl(n,t){var s=this;try{let l=s._getFinalPath(n);const c=yt({},s.headers);t?.upsert&&(c["x-upsert"]="true");const u=await Kr(s.fetch,`${s.url}/object/upload/sign/${l}`,{},{headers:c}),d=new URL(s.url+u.url),p=d.searchParams.get("token");if(!p)throw new Du("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:p},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(vn(l))return{data:null,error:l};throw l}}async update(n,t,s){return this.uploadOrUpdate("PUT",n,t,s)}async move(n,t,s){var l=this;try{return{data:await Kr(l.fetch,`${l.url}/object/move`,{bucketId:l.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:l.headers}),error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(vn(c))return{data:null,error:c};throw c}}async copy(n,t,s){var l=this;try{return{data:{path:(await Kr(l.fetch,`${l.url}/object/copy`,{bucketId:l.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:l.headers})).Key},error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(vn(c))return{data:null,error:c};throw c}}async createSignedUrl(n,t,s){var l=this;try{let c=l._getFinalPath(n),u=await Kr(l.fetch,`${l.url}/object/sign/${c}`,yt({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:l.headers});const d=s?.download?`&download=${s.download===!0?"":s.download}`:"";return u={signedUrl:encodeURI(`${l.url}${u.signedURL}${d}`)},{data:u,error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(vn(c))return{data:null,error:c};throw c}}async createSignedUrls(n,t,s){var l=this;try{const c=await Kr(l.fetch,`${l.url}/object/sign/${l.bucketId}`,{expiresIn:t,paths:n},{headers:l.headers}),u=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:c.map(d=>yt(yt({},d),{},{signedUrl:d.signedURL?encodeURI(`${l.url}${d.signedURL}${u}`):null})),error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(vn(c))return{data:null,error:c};throw c}}download(n,t){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),c=l?`?${l}`:"",u=this._getFinalPath(n),d=()=>yo(this.fetch,`${this.url}/${s}/${u}${c}`,{headers:this.headers,noResolveJson:!0});return new X1(d,this.shouldThrowOnError)}async info(n){var t=this;const s=t._getFinalPath(n);try{return{data:zf(await yo(t.fetch,`${t.url}/object/info/${s}`,{headers:t.headers})),error:null}}catch(l){if(t.shouldThrowOnError)throw l;if(vn(l))return{data:null,error:l};throw l}}async exists(n){var t=this;const s=t._getFinalPath(n);try{return await Q1(t.fetch,`${t.url}/object/${s}`,{headers:t.headers}),{data:!0,error:null}}catch(l){if(t.shouldThrowOnError)throw l;if(vn(l)&&l instanceof Mf){const c=l.originalError;if([400,404].includes(c?.status))return{data:!1,error:l}}throw l}}getPublicUrl(n,t){const s=this._getFinalPath(n),l=[],c=t?.download?`download=${t.download===!0?"":t.download}`:"";c!==""&&l.push(c);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&l.push(d);let p=l.join("&");return p!==""&&(p=`?${p}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${s}${p}`)}}}async remove(n){var t=this;try{return{data:await op(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(vn(s))return{data:null,error:s};throw s}}async list(n,t,s){var l=this;try{const c=yt(yt(yt({},J1),t),{},{prefix:n||""});return{data:await Kr(l.fetch,`${l.url}/object/list/${l.bucketId}`,c,{headers:l.headers},s),error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(vn(c))return{data:null,error:c};throw c}}async listV2(n,t){var s=this;try{const l=yt({},n);return{data:await Kr(s.fetch,`${s.url}/object/list-v2/${s.bucketId}`,l,{headers:s.headers},t),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(vn(l))return{data:null,error:l};throw l}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const bx="2.89.0",wx={"X-Client-Info":`storage-js/${bx}`};var eC=class{constructor(n,t={},s,l){this.shouldThrowOnError=!1;const c=new URL(n);l?.useNewHostname&&/supabase\.(co|in|red)$/.test(c.hostname)&&!c.hostname.includes("storage.supabase.")&&(c.hostname=c.hostname.replace("supabase.","storage.supabase.")),this.url=c.href.replace(/\/$/,""),this.headers=yt(yt({},wx),t),this.fetch=lp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var t=this;try{const s=t.listBucketOptionsToQueryString(n);return{data:await yo(t.fetch,`${t.url}/bucket${s}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(vn(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await yo(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(vn(s))return{data:null,error:s};throw s}}async createBucket(n,t={public:!1}){var s=this;try{return{data:await Kr(s.fetch,`${s.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(vn(l))return{data:null,error:l};throw l}}async updateBucket(n,t){var s=this;try{return{data:await Uf(s.fetch,`${s.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(vn(l))return{data:null,error:l};throw l}}async emptyBucket(n){var t=this;try{return{data:await Kr(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(vn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await op(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(vn(s))return{data:null,error:s};throw s}}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},tC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=yt(yt({},wx),t),this.fetch=lp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Kr(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(vn(s))return{data:null,error:s};throw s}}async listBuckets(n){var t=this;try{const s=new URLSearchParams;n?.limit!==void 0&&s.set("limit",n.limit.toString()),n?.offset!==void 0&&s.set("offset",n.offset.toString()),n?.sortColumn&&s.set("sortColumn",n.sortColumn),n?.sortOrder&&s.set("sortOrder",n.sortOrder),n?.search&&s.set("search",n.search);const l=s.toString(),c=l?`${t.url}/bucket?${l}`:`${t.url}/bucket`;return{data:await yo(t.fetch,c,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(vn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await op(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(vn(s))return{data:null,error:s};throw s}}from(n){var t=this;if(!H1(n))throw new Du("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const s=new B1({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),l=this.shouldThrowOnError;return new Proxy(s,{get(c,u){const d=c[u];return typeof d!="function"?d:async(...p)=>{try{return{data:await d.apply(c,p),error:null}}catch(f){if(l)throw f;return{data:null,error:f}}}}})}};const cp={"X-Client-Info":`storage-js/${bx}`,"Content-Type":"application/json"};var Sx=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Er(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var Wh=class extends Sx{constructor(n,t,s){super(n),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},nC=class extends Sx{constructor(n,t){super(n),this.name="StorageVectorsUnknownError",this.originalError=t}};const up=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),rC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},kv=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),sC=async(n,t,s)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!s?.noResolveJson){const l=n.status||500,c=n;if(typeof c.json=="function")c.json().then(u=>{const d=u?.statusCode||u?.code||l+"";t(new Wh(kv(u),l,d))}).catch(()=>{const u=l+"";t(new Wh(c.statusText||`HTTP ${l} error`,l,u))});else{const u=l+"";t(new Wh(c.statusText||`HTTP ${l} error`,l,u))}}else t(new nC(kv(n),n))},iC=(n,t,s,l)=>{const c={method:n,headers:t?.headers||{}};return l?(rC(l)?(c.headers=yt({"Content-Type":"application/json"},t?.headers),c.body=JSON.stringify(l)):c.body=l,yt(yt({},c),s)):c};async function aC(n,t,s,l,c,u){return new Promise((d,p)=>{n(s,iC(t,l,c,u)).then(f=>{if(!f.ok)throw f;if(l?.noResolveJson)return f;const m=f.headers.get("content-type");return!m||!m.includes("application/json")?{}:f.json()}).then(f=>d(f)).catch(f=>sC(f,p,l))})}async function Nr(n,t,s,l,c){return aC(n,"POST",t,l,c,s)}var lC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=yt(yt({},cp),t),this.fetch=up(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async getIndex(n,t){var s=this;try{return{data:await Nr(s.fetch,`${s.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Er(l))return{data:null,error:l};throw l}}async listIndexes(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async deleteIndex(n,t){var s=this;try{return{data:await Nr(s.fetch,`${s.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers})||{},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Er(l))return{data:null,error:l};throw l}}},oC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=yt(yt({},cp),t),this.fetch=up(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var t=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Nr(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async getVectors(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async listVectors(n){var t=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await Nr(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async queryVectors(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async deleteVectors(n){var t=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Nr(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}},cC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=yt(yt({},cp),t),this.fetch=up(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async listBuckets(n={}){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}},uC=class extends cC{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new dC(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,s=this;return t().call(s,n)}async getBucket(n){var t=()=>super.getBucket,s=this;return t().call(s,n)}async listBuckets(n={}){var t=()=>super.listBuckets,s=this;return t().call(s,n)}async deleteBucket(n){var t=()=>super.deleteBucket,s=this;return t().call(s,n)}},dC=class extends lC{constructor(n,t,s,l){super(n,t,l),this.vectorBucketName=s}async createIndex(n){var t=()=>super.createIndex,s=this;return t().call(s,yt(yt({},n),{},{vectorBucketName:s.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,s=this;return t().call(s,yt(yt({},n),{},{vectorBucketName:s.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,s=this;return t().call(s,s.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,s=this;return t().call(s,s.vectorBucketName,n)}index(n){return new hC(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},hC=class extends oC{constructor(n,t,s,l,c){super(n,t,c),this.vectorBucketName=s,this.indexName=l}async putVectors(n){var t=()=>super.putVectors,s=this;return t().call(s,yt(yt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async getVectors(n){var t=()=>super.getVectors,s=this;return t().call(s,yt(yt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,s=this;return t().call(s,yt(yt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,s=this;return t().call(s,yt(yt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,s=this;return t().call(s,yt(yt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}},fC=class extends eC{constructor(n,t={},s,l){super(n,t,s,l)}from(n){return new Z1(this.url,this.headers,n,this.fetch)}get vectors(){return new uC(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new tC(this.url+"/iceberg",this.headers,this.fetch)}};const jx="2.89.0",$a=30*1e3,Lf=3,Xh=Lf*$a,pC="http://localhost:9999",mC="supabase.auth.token",gC={"X-Client-Info":`gotrue-js/${jx}`},If="X-Supabase-Api-Version",_x={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},yC=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,vC=600*1e3;class vo extends Error{constructor(t,s,l){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=l}}function at(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class xC extends vo{constructor(t,s,l){super(t,s,l),this.name="AuthApiError",this.status=s,this.code=l}}function bC(n){return at(n)&&n.name==="AuthApiError"}class $i extends vo{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class Ds extends vo{constructor(t,s,l,c){super(t,l,c),this.name=s,this.status=l}}class Cr extends Ds{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function wC(n){return at(n)&&n.name==="AuthSessionMissingError"}class ka extends Ds{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Qc extends Ds{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Wc extends Ds{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function SC(n){return at(n)&&n.name==="AuthImplicitGrantRedirectError"}class Av extends Ds{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class jC extends Ds{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Bf extends Ds{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function Jh(n){return at(n)&&n.name==="AuthRetryableFetchError"}class Ov extends Ds{constructor(t,s,l){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=l}}class $f extends Ds{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const gu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Dv=` 	
\r=`.split(""),_C=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<Dv.length;t+=1)n[Dv[t].charCodeAt(0)]=-2;for(let t=0;t<gu.length;t+=1)n[gu[t].charCodeAt(0)]=t;return n})();function Mv(n,t,s){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;s(gu[l]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;s(gu[l]),t.queuedBits-=6}}function Cx(n,t,s){const l=_C[n];if(l>-1)for(t.queue=t.queue<<6|l,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function zv(n){const t=[],s=d=>{t.push(String.fromCodePoint(d))},l={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},u=d=>{NC(d,l,s)};for(let d=0;d<n.length;d+=1)Cx(n.charCodeAt(d),c,u);return t.join("")}function CC(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function EC(n,t){for(let s=0;s<n.length;s+=1){let l=n.charCodeAt(s);if(l>55295&&l<=56319){const c=(l-55296)*1024&65535;l=(n.charCodeAt(s+1)-56320&65535|c)+65536,s+=1}CC(l,t)}}function NC(n,t,s){if(t.utf8seq===0){if(n<=127){s(n);return}for(let l=1;l<6;l+=1)if((n>>7-l&1)===0){t.utf8seq=l;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function Ya(n){const t=[],s={queue:0,queuedBits:0},l=c=>{t.push(c)};for(let c=0;c<n.length;c+=1)Cx(n.charCodeAt(c),s,l);return new Uint8Array(t)}function RC(n){const t=[];return EC(n,s=>t.push(s)),new Uint8Array(t)}function Pi(n){const t=[],s={queue:0,queuedBits:0},l=c=>{t.push(c)};return n.forEach(c=>Mv(c,s,l)),Mv(null,s,l),t.join("")}function TC(n){return Math.round(Date.now()/1e3)+n}function kC(){return Symbol("auth-callback")}const tr=()=>typeof window<"u"&&typeof document<"u",Oi={tested:!1,writable:!1},Ex=()=>{if(!tr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Oi.tested)return Oi.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Oi.tested=!0,Oi.writable=!0}catch{Oi.tested=!0,Oi.writable=!1}return Oi.writable};function AC(n){const t={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((c,u)=>{t[u]=c})}catch{}return s.searchParams.forEach((l,c)=>{t[c]=l}),t}const Nx=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),OC=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",qa=async(n,t,s)=>{await n.setItem(t,JSON.stringify(s))},Di=async(n,t)=>{const s=await n.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Zn=async(n,t)=>{await n.removeItem(t)};class Mu{constructor(){this.promise=new Mu.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}Mu.promiseConstructor=Promise;function Zh(n){const t=n.split(".");if(t.length!==3)throw new $f("Invalid JWT structure");for(let l=0;l<t.length;l++)if(!yC.test(t[l]))throw new $f("JWT not in base64url format");return{header:JSON.parse(zv(t[0])),payload:JSON.parse(zv(t[1])),signature:Ya(t[2]),raw:{header:t[0],payload:t[1]}}}async function DC(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function MC(n,t){return new Promise((l,c)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){l(d);return}}catch(d){if(!t(u,d)){c(d);return}}})()})}function zC(n){return("0"+n.toString(16)).substr(-2)}function UC(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=s.length;let c="";for(let u=0;u<56;u++)c+=s.charAt(Math.floor(Math.random()*l));return c}return crypto.getRandomValues(t),Array.from(t,zC).join("")}async function LC(n){const s=new TextEncoder().encode(n),l=await crypto.subtle.digest("SHA-256",s),c=new Uint8Array(l);return Array.from(c).map(u=>String.fromCharCode(u)).join("")}async function IC(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await LC(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Aa(n,t,s=!1){const l=UC();let c=l;s&&(c+="/PASSWORD_RECOVERY"),await qa(n,`${t}-code-verifier`,c);const u=await IC(l);return[u,l===u?"plain":"s256"]}const BC=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $C(n){const t=n.headers.get(If);if(!t||!t.match(BC))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function qC(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function PC(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const HC=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Oa(n){if(!HC.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ef(){const n={};return new Proxy(n,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const l=s.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function FC(n,t){return new Proxy(n,{get:(s,l,c)=>{if(l==="__isInsecureUserWarningProxy")return!0;if(typeof l=="symbol"){const u=l.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(s,l,c)}return!t.value&&typeof l=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(s,l,c)}})}function Uv(n){return JSON.parse(JSON.stringify(n))}const Ii=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),GC=[502,503,504];async function Lv(n){var t;if(!OC(n))throw new Bf(Ii(n),0);if(GC.includes(n.status))throw new Bf(Ii(n),n.status);let s;try{s=await n.json()}catch(u){throw new $i(Ii(u),u)}let l;const c=$C(n);if(c&&c.getTime()>=_x["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?l=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(l=s.error_code),l){if(l==="weak_password")throw new Ov(Ii(s),n.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(l==="session_not_found")throw new Cr}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new Ov(Ii(s),n.status,s.weak_password.reasons);throw new xC(Ii(s),n.status||500,l)}const VC=(n,t,s,l)=>{const c={method:n,headers:t?.headers||{}};return n==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),c.body=JSON.stringify(l),Object.assign(Object.assign({},c),s))};async function gt(n,t,s,l){var c;const u=Object.assign({},l?.headers);u[If]||(u[If]=_x["2024-01-01"].name),l?.jwt&&(u.Authorization=`Bearer ${l.jwt}`);const d=(c=l?.query)!==null&&c!==void 0?c:{};l?.redirectTo&&(d.redirect_to=l.redirectTo);const p=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",f=await YC(n,t,s+p,{headers:u,noResolveJson:l?.noResolveJson},{},l?.body);return l?.xform?l?.xform(f):{data:Object.assign({},f),error:null}}async function YC(n,t,s,l,c,u){const d=VC(t,l,c,u);let p;try{p=await n(s,Object.assign({},d))}catch(f){throw console.error(f),new Bf(Ii(f),0)}if(p.ok||await Lv(p),l?.noResolveJson)return p;try{return await p.json()}catch(f){await Lv(f)}}function Vr(n){var t;let s=null;WC(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=TC(n.expires_in)));const l=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:s,user:l},error:null}}function Iv(n){const t=Vr(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,l)=>s&&typeof l=="string",!0)&&(t.data.weak_password=n.weak_password),t}function hi(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function KC(n){return{data:n,error:null}}function QC(n){const{action_link:t,email_otp:s,hashed_token:l,redirect_to:c,verification_type:u}=n,d=Ou(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),p={action_link:t,email_otp:s,hashed_token:l,redirect_to:c,verification_type:u},f=Object.assign({},d);return{data:{properties:p,user:f},error:null}}function Bv(n){return n}function WC(n){return n.access_token&&n.refresh_token&&n.expires_in}const tf=["global","local","others"];class XC{constructor({url:t="",headers:s={},fetch:l}){this.url=t,this.headers=s,this.fetch=Nx(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,s=tf[0]){if(tf.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${tf.join(", ")}`);try{return await gt(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(l){if(at(l))return{data:null,error:l};throw l}}async inviteUserByEmail(t,s={}){try{return await gt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:hi})}catch(l){if(at(l))return{data:{user:null},error:l};throw l}}async generateLink(t){try{const{options:s}=t,l=Ou(t,["options"]),c=Object.assign(Object.assign({},l),s);return"newEmail"in l&&(c.new_email=l?.newEmail,delete c.newEmail),await gt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:QC,redirectTo:s?.redirectTo})}catch(s){if(at(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await gt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:hi})}catch(s){if(at(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,l,c,u,d,p,f;try{const m={nextPage:null,lastPage:0,total:0},y=await gt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:"",per_page:(u=(c=t?.perPage)===null||c===void 0?void 0:c.toString())!==null&&u!==void 0?u:""},xform:Bv});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,S=(f=(p=y.headers.get("link"))===null||p===void 0?void 0:p.split(","))!==null&&f!==void 0?f:[];return S.length>0&&(S.forEach(C=>{const E=parseInt(C.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(C.split(";")[1].split("=")[1]);m[`${j}Page`]=E}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(at(m))return{data:{users:[]},error:m};throw m}}async getUserById(t){Oa(t);try{return await gt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:hi})}catch(s){if(at(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){Oa(t);try{return await gt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:hi})}catch(l){if(at(l))return{data:{user:null},error:l};throw l}}async deleteUser(t,s=!1){Oa(t);try{return await gt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:hi})}catch(l){if(at(l))return{data:{user:null},error:l};throw l}}async _listFactors(t){Oa(t.userId);try{const{data:s,error:l}=await gt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:s,error:l}}catch(s){if(at(s))return{data:null,error:s};throw s}}async _deleteFactor(t){Oa(t.userId),Oa(t.id);try{return{data:await gt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(at(s))return{data:null,error:s};throw s}}async _listOAuthClients(t){var s,l,c,u,d,p,f;try{const m={nextPage:null,lastPage:0,total:0},y=await gt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:"",per_page:(u=(c=t?.perPage)===null||c===void 0?void 0:c.toString())!==null&&u!==void 0?u:""},xform:Bv});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,S=(f=(p=y.headers.get("link"))===null||p===void 0?void 0:p.split(","))!==null&&f!==void 0?f:[];return S.length>0&&(S.forEach(C=>{const E=parseInt(C.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(C.split(";")[1].split("=")[1]);m[`${j}Page`]=E}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(at(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(t){try{return await gt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(at(s))return{data:null,error:s};throw s}}async _getOAuthClient(t){try{return await gt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(at(s))return{data:null,error:s};throw s}}async _updateOAuthClient(t,s){try{return await gt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:s,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(at(l))return{data:null,error:l};throw l}}async _deleteOAuthClient(t){try{return await gt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(s){if(at(s))return{data:null,error:s};throw s}}async _regenerateOAuthClientSecret(t){try{return await gt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(at(s))return{data:null,error:s};throw s}}}function $v(n={}){return{getItem:t=>n[t]||null,setItem:(t,s)=>{n[t]=s},removeItem:t=>{delete n[t]}}}const Da={debug:!!(globalThis&&Ex()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Rx extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class JC extends Rx{}async function ZC(n,t,s){Da.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const l=new globalThis.AbortController;return t>0&&setTimeout(()=>{l.abort(),Da.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async c=>{if(c){Da.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,c.name);try{return await s()}finally{Da.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,c.name)}}else{if(t===0)throw Da.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new JC(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Da.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}function eE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Tx(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function tE(n){return parseInt(n,16)}function nE(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,l=>l.toString(16).padStart(2,"0")).join("")}function rE(n){var t;const{chainId:s,domain:l,expirationTime:c,issuedAt:u=new Date,nonce:d,notBefore:p,requestId:f,resources:m,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const S=Tx(n.address),C=y?`${y}://${l}`:l,E=n.statement?`${n.statement}
`:"",j=`${C} wants you to sign in with your Ethereum account:
${S}

${E}`;let N=`URI: ${v}
Version: ${x}
Chain ID: ${s}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(c&&(N+=`
Expiration Time: ${c.toISOString()}`),p&&(N+=`
Not Before: ${p.toISOString()}`),f&&(N+=`
Request ID: ${f}`),m){let A=`
Resources:`;for(const z of m){if(!z||typeof z!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${z}`);A+=`
- ${z}`}N+=A}return`${j}
${N}`}class zn extends Error{constructor({message:t,code:s,cause:l,name:c}){var u;super(t,{cause:l}),this.__isWebAuthnError=!0,this.name=(u=c??(l instanceof Error?l.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=s}}class yu extends zn{constructor(t,s){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s,message:t}),this.name="WebAuthnUnknownError",this.originalError=s}}function sE({error:n,options:t}){var s,l,c;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new zn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((s=u.authenticatorSelection)===null||s===void 0?void 0:s.requireResidentKey)===!0)return new zn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((l=u.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new zn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((c=u.authenticatorSelection)===null||c===void 0?void 0:c.userVerification)==="required")return new zn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new zn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new zn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(p=>p.type==="public-key").length===0?new zn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new zn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(kx(d)){if(u.rp.id!==d)return new zn({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new zn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new zn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new zn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new zn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function iE({error:n,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new zn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new zn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const l=window.location.hostname;if(kx(l)){if(s.rpId!==l)return new zn({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new zn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new zn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new zn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class aE{createNewAbortSignal(){if(this.controller){const s=new Error("Cancelling existing WebAuthn API call for new one");s.name="AbortError",this.controller.abort(s)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const lE=new aE;function oE(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:s,excludeCredentials:l}=n,c=Ou(n,["challenge","user","excludeCredentials"]),u=Ya(t).buffer,d=Object.assign(Object.assign({},s),{id:Ya(s.id).buffer}),p=Object.assign(Object.assign({},c),{challenge:u,user:d});if(l&&l.length>0){p.excludeCredentials=new Array(l.length);for(let f=0;f<l.length;f++){const m=l[f];p.excludeCredentials[f]=Object.assign(Object.assign({},m),{id:Ya(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return p}function cE(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:s}=n,l=Ou(n,["challenge","allowCredentials"]),c=Ya(t).buffer,u=Object.assign(Object.assign({},l),{challenge:c});if(s&&s.length>0){u.allowCredentials=new Array(s.length);for(let d=0;d<s.length;d++){const p=s[d];u.allowCredentials[d]=Object.assign(Object.assign({},p),{id:Ya(p.id).buffer,type:p.type||"public-key",transports:p.transports})}}return u}function uE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n;return{id:n.id,rawId:n.id,response:{attestationObject:Pi(new Uint8Array(n.response.attestationObject)),clientDataJSON:Pi(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function dE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n,l=n.getClientExtensionResults(),c=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:Pi(new Uint8Array(c.authenticatorData)),clientDataJSON:Pi(new Uint8Array(c.clientDataJSON)),signature:Pi(new Uint8Array(c.signature)),userHandle:c.userHandle?Pi(new Uint8Array(c.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function kx(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function qv(){var n,t;return!!(tr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function hE(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new yu("Browser returned unexpected credential type",t)}:{data:null,error:new yu("Empty credential response",t)}}catch(t){return{data:null,error:sE({error:t,options:n})}}}async function fE(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new yu("Browser returned unexpected credential type",t)}:{data:null,error:new yu("Empty credential response",t)}}catch(t){return{data:null,error:iE({error:t,options:n})}}}const pE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},mE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function vu(...n){const t=c=>c!==null&&typeof c=="object"&&!Array.isArray(c),s=c=>c instanceof ArrayBuffer||ArrayBuffer.isView(c),l={};for(const c of n)if(c)for(const u in c){const d=c[u];if(d!==void 0)if(Array.isArray(d))l[u]=d;else if(s(d))l[u]=d;else if(t(d)){const p=l[u];t(p)?l[u]=vu(p,d):l[u]=vu(d)}else l[u]=d}return l}function gE(n,t){return vu(pE,n,t||{})}function yE(n,t){return vu(mE,n,t||{})}class vE{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:s,friendlyName:l,signal:c},u){try{const{data:d,error:p}=await this.client.mfa.challenge({factorId:t,webauthn:s});if(!d)return{data:null,error:p};const f=c??lE.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:m}=d.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${l}`),m.displayName||(m.displayName=m.name)}switch(d.webauthn.type){case"create":{const m=gE(d.webauthn.credential_options.publicKey,u?.create),{data:y,error:v}=await hE({publicKey:m,signal:f});return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}case"request":{const m=yE(d.webauthn.credential_options.publicKey,u?.request),{data:y,error:v}=await fE(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:m,signal:f}));return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}}}catch(d){return at(d)?{data:null,error:d}:{data:null,error:new $i("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:s,webauthn:l}){return this.client.mfa.verify({factorId:s,challengeId:t,webauthn:l})}async _authenticate({factorId:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:c}={}},u){if(!s)return{data:null,error:new vo("rpId is required for WebAuthn authentication")};try{if(!qv())return{data:null,error:new $i("Browser does not support WebAuthn",null)};const{data:d,error:p}=await this.challenge({factorId:t,webauthn:{rpId:s,rpOrigins:l},signal:c},{request:u});if(!d)return{data:null,error:p};const{webauthn:f}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:f.type,rpId:s,rpOrigins:l,credential_response:f.credential_response}})}catch(d){return at(d)?{data:null,error:d}:{data:null,error:new $i("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:c}={}},u){if(!s)return{data:null,error:new vo("rpId is required for WebAuthn registration")};try{if(!qv())return{data:null,error:new $i("Browser does not support WebAuthn",null)};const{data:d,error:p}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:p};const{data:f,error:m}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:s,rpOrigins:l},signal:c},{create:u});return f?this._verify({factorId:d.id,challengeId:f.challengeId,webauthn:{rpId:s,rpOrigins:l,type:f.webauthn.type,credential_response:f.webauthn.credential_response}}):{data:null,error:m}}catch(d){return at(d)?{data:null,error:d}:{data:null,error:new $i("Unexpected error in register",d)}}}}eE();const xE={url:pC,storageKey:mC,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:gC,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Pv(n,t,s){return await s()}const Ma={};class xo{get jwks(){var t,s;return(s=(t=Ma[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){Ma[this.storageKey]=Object.assign(Object.assign({},Ma[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=Ma[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Ma[this.storageKey]=Object.assign(Object.assign({},Ma[this.storageKey]),{cachedAt:t})}constructor(t){var s,l,c;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},xE),t);if(this.storageKey=u.storageKey,this.instanceID=(s=xo.nextInstanceID[this.storageKey])!==null&&s!==void 0?s:0,xo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&tr()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new XC({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=Nx(u.fetch),this.lock=u.lock||Pv,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:this.persistSession&&tr()&&(!((l=globalThis?.navigator)===null||l===void 0)&&l.locks)?this.lock=ZC:this.lock=Pv,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new vE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:Ex()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=$v(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=$v(this.memoryStorage)),tr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(c=this.broadcastChannel)===null||c===void 0||c.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${jx}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let s={},l="none";if(tr()&&(s=AC(window.location.href),this._isImplicitGrantCallback(s)?l="implicit":await this._isPKCECallback(s)&&(l="pkce")),tr()&&this.detectSessionInUrl&&l!=="none"){const{data:c,error:u}=await this._getSessionFromURL(s,l);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),SC(u)){const f=(t=u.details)===null||t===void 0?void 0:t.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:d,redirectType:p}=c;return this._debug("#_initialize()","detected session in URL",d,"redirect type",p),await this._saveSession(d),setTimeout(async()=>{p==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return at(s)?this._returnResult({error:s}):this._returnResult({error:new $i("Unexpected error during initialization",s)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,l,c;try{const u=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(c=t?.options)===null||c===void 0?void 0:c.captchaToken}},xform:Vr}),{data:d,error:p}=u;if(p||!d)return this._returnResult({data:{user:null,session:null},error:p});const f=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(u){if(at(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var s,l,c;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let S=null,C=null;this.flowType==="pkce"&&([S,C]=await Aa(this.storage,this.storageKey)),u=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(s=x?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:S,code_challenge_method:C},xform:Vr})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(l=x?.data)!==null&&l!==void 0?l:{},channel:(c=x?.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:Vr})}else throw new Qc("You must provide either an email or phone number and a password");const{data:d,error:p}=u;if(p||!d)return await Zn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:p});const f=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),at(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let s;if("email"in t){const{email:u,password:d,options:p}=t;s=await gt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:Iv})}else if("phone"in t){const{phone:u,password:d,options:p}=t;s=await gt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:Iv})}else throw new Qc("You must provide either an email or phone number and a password");const{data:l,error:c}=s;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new ka;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:c})}catch(s){if(at(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOAuth(t){var s,l,c,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;switch(s){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(t){var s,l,c,u,d,p,f,m,y,v,x;let S,C;if("message"in t)S=t.message,C=t.signature;else{const{chain:E,wallet:j,statement:N,options:A}=t;let z;if(tr())if(typeof j=="object")z=j;else{const G=window;if("ethereum"in G&&typeof G.ethereum=="object"&&"request"in G.ethereum&&typeof G.ethereum.request=="function")z=G.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!A?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=j}const B=new URL((s=A?.url)!==null&&s!==void 0?s:window.location.href),L=await z.request({method:"eth_requestAccounts"}).then(G=>G).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!L||L.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const _=Tx(L[0]);let M=(l=A?.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!M){const G=await z.request({method:"eth_chainId"});M=tE(G)}const k={domain:B.host,address:_,statement:N,uri:B.href,version:"1",chainId:M,nonce:(c=A?.signInWithEthereum)===null||c===void 0?void 0:c.nonce,issuedAt:(d=(u=A?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(p=A?.signInWithEthereum)===null||p===void 0?void 0:p.expirationTime,notBefore:(f=A?.signInWithEthereum)===null||f===void 0?void 0:f.notBefore,requestId:(m=A?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(y=A?.signInWithEthereum)===null||y===void 0?void 0:y.resources};S=rE(k),C=await z.request({method:"personal_sign",params:[nE(S),_]})}try{const{data:E,error:j}=await gt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:S,signature:C},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Vr});if(j)throw j;if(!E||!E.session||!E.user){const N=new ka;return this._returnResult({data:{user:null,session:null},error:N})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:Object.assign({},E),error:j})}catch(E){if(at(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async signInWithSolana(t){var s,l,c,u,d,p,f,m,y,v,x,S;let C,E;if("message"in t)C=t.message,E=t.signature;else{const{chain:j,wallet:N,statement:A,options:z}=t;let B;if(tr())if(typeof N=="object")B=N;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))B=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!z?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");B=N}const L=new URL((s=z?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in B&&B.signIn){const _=await B.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},z?.signInWithSolana),{version:"1",domain:L.host,uri:L.href}),A?{statement:A}:null));let M;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")M=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)M=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)C=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),E=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in B)||typeof B.signMessage!="function"||!("publicKey"in B)||typeof B!="object"||!B.publicKey||!("toBase58"in B.publicKey)||typeof B.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");C=[`${L.host} wants you to sign in with your Solana account:`,B.publicKey.toBase58(),...A?["",A,""]:[""],"Version: 1",`URI: ${L.href}`,`Issued At: ${(c=(l=z?.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((u=z?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${z.signInWithSolana.notBefore}`]:[],...!((d=z?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${z.signInWithSolana.expirationTime}`]:[],...!((p=z?.signInWithSolana)===null||p===void 0)&&p.chainId?[`Chain ID: ${z.signInWithSolana.chainId}`]:[],...!((f=z?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${z.signInWithSolana.nonce}`]:[],...!((m=z?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${z.signInWithSolana.requestId}`]:[],...!((v=(y=z?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...z.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const _=await B.signMessage(new TextEncoder().encode(C),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");E=_}}try{const{data:j,error:N}=await gt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:C,signature:Pi(E)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(S=t.options)===null||S===void 0?void 0:S.captchaToken}}:null),xform:Vr});if(N)throw N;if(!j||!j.session||!j.user){const A=new ka;return this._returnResult({data:{user:null,session:null},error:A})}return j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),this._returnResult({data:Object.assign({},j),error:N})}catch(j){if(at(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async _exchangeCodeForSession(t){const s=await Di(this.storage,`${this.storageKey}-code-verifier`),[l,c]=(s??"").split("/");try{if(!l&&this.flowType==="pkce")throw new jC;const{data:u,error:d}=await gt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:l},xform:Vr});if(await Zn(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const p=new ka;return this._returnResult({data:{user:null,session:null,redirectType:null},error:p})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:c??null}),error:d})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),at(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:s,provider:l,token:c,access_token:u,nonce:d}=t,p=await gt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:c,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Vr}),{data:f,error:m}=p;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!f||!f.session||!f.user){const y=new ka;return this._returnResult({data:{user:null,session:null},error:y})}return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),this._returnResult({data:f,error:m})}catch(s){if(at(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOtp(t){var s,l,c,u,d;try{if("email"in t){const{email:p,options:f}=t;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await Aa(this.storage,this.storageKey));const{error:v}=await gt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:p,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(l=f?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:y},redirectTo:f?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:p,options:f}=t,{data:m,error:y}=await gt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:p,data:(c=f?.data)!==null&&c!==void 0?c:{},create_user:(u=f?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(d=f?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:y})}throw new Qc("You must provide either an email or phone number.")}catch(p){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),at(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async verifyOtp(t){var s,l;try{let c,u;"options"in t&&(c=(s=t.options)===null||s===void 0?void 0:s.redirectTo,u=(l=t.options)===null||l===void 0?void 0:l.captchaToken);const{data:d,error:p}=await gt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:c,xform:Vr});if(p)throw p;if(!d)throw new Error("An error occurred on token verification.");const f=d.session,m=d.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(c){if(at(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signInWithSSO(t){var s,l,c,u,d;try{let p=null,f=null;this.flowType==="pkce"&&([p,f]=await Aa(this.storage,this.storageKey));const m=await gt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(l=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&l!==void 0?l:void 0}),!((c=t?.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:p,code_challenge_method:f}),headers:this.headers,xform:KC});return!((u=m.data)===null||u===void 0)&&u.url&&tr()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(p){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),at(p))return this._returnResult({data:null,error:p});throw p}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:l}=t;if(l)throw l;if(!s)throw new Cr;const{error:c}=await gt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return this._returnResult({data:{user:null,session:null},error:c})})}catch(t){if(at(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:l,type:c,options:u}=t,{error:d}=await gt(this.fetch,"POST",s,{headers:this.headers,body:{email:l,type:c,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:l,type:c,options:u}=t,{data:d,error:p}=await gt(this.fetch,"POST",s,{headers:this.headers,body:{phone:l,type:c,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:p})}throw new Qc("You must provide either an email or phone number and a type")}catch(s){if(at(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await l,await s()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=s();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Di(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const l=t.expires_at?t.expires_at*1e3-Date.now()<Xh:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",t.expires_at),!l){if(this.userStorage){const d=await Di(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=ef()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=FC(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:c,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:c},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const s=await this._acquireLock(-1,async()=>await this._getUser());return s.data.user&&(this.suppressGetSessionWarning=!0),s}async _getUser(t){try{return t?await gt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:hi}):await this._useSession(async s=>{var l,c,u;const{data:d,error:p}=s;if(p)throw p;return!(!((l=d.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Cr}:await gt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0,xform:hi})})}catch(s){if(at(s))return wC(s)&&(await this._removeSession(),await Zn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:s});throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async l=>{const{data:c,error:u}=l;if(u)throw u;if(!c.session)throw new Cr;const d=c.session;let p=null,f=null;this.flowType==="pkce"&&t.email!=null&&([p,f]=await Aa(this.storage,this.storageKey));const{data:m,error:y}=await gt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:p,code_challenge_method:f}),jwt:d.access_token,xform:hi});if(y)throw y;return d.user=m.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(l){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),at(l))return this._returnResult({data:{user:null},error:l});throw l}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Cr;const s=Date.now()/1e3;let l=s,c=!0,u=null;const{payload:d}=Zh(t.access_token);if(d.exp&&(l=d.exp,c=l<=s),c){const{data:p,error:f}=await this._callRefreshToken(t.refresh_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!p)return{data:{user:null,session:null},error:null};u=p}else{const{data:p,error:f}=await this._getUser(t.access_token);if(f)throw f;u={access_token:t.access_token,refresh_token:t.refresh_token,user:p.user,token_type:"bearer",expires_in:l-s,expires_at:l},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(s){if(at(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var l;if(!t){const{data:d,error:p}=s;if(p)throw p;t=(l=d.session)!==null&&l!==void 0?l:void 0}if(!t?.refresh_token)throw new Cr;const{data:c,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):c?this._returnResult({data:{user:c.user,session:c},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(s){if(at(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async _getSessionFromURL(t,s){try{if(!tr())throw new Wc("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Wc(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new Av("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Wc("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Av("No code detected.");const{data:A,error:z}=await this._exchangeCodeForSession(t.code);if(z)throw z;const B=new URL(window.location.href);return B.searchParams.delete("code"),window.history.replaceState(window.history.state,"",B.toString()),{data:{session:A.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:c,access_token:u,refresh_token:d,expires_in:p,expires_at:f,token_type:m}=t;if(!u||!p||!d||!m)throw new Wc("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(p);let x=y+v;f&&(x=parseInt(f));const S=x-y;S*1e3<=$a&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${S}s, should have been closer to ${v}s`);const C=x-v;y-C>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",C,x,y):y-C<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",C,x,y);const{data:E,error:j}=await this._getUser(u);if(j)throw j;const N={provider_token:l,provider_refresh_token:c,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:m,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:N,redirectType:t.type},error:null})}catch(l){if(at(l))return this._returnResult({data:{session:null,redirectType:null},error:l});throw l}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Di(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var l;const{data:c,error:u}=s;if(u)return this._returnResult({error:u});const d=(l=c.session)===null||l===void 0?void 0:l.access_token;if(d){const{error:p}=await this.admin.signOut(d,t);if(p&&!(bC(p)&&(p.status===404||p.status===401||p.status===403)))return this._returnResult({error:p})}return t!=="others"&&(await this._removeSession(),await Zn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const s=kC(),l={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:l}}}async _emitInitialSession(t){return await this._useSession(async s=>{var l,c;try{const{data:{session:u},error:d}=s;if(d)throw d;await((l=this.stateChangeEmitters.get(t))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((c=this.stateChangeEmitters.get(t))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,s={}){let l=null,c=null;this.flowType==="pkce"&&([l,c]=await Aa(this.storage,this.storageKey,!0));try{return await gt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:l,code_challenge_method:c,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),at(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:s,error:l}=await this.getUser();if(l)throw l;return this._returnResult({data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(s){if(at(s))return this._returnResult({data:null,error:s});throw s}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var s;try{const{data:l,error:c}=await this._useSession(async u=>{var d,p,f,m,y;const{data:v,error:x}=u;if(x)throw x;const S=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(p=t.options)===null||p===void 0?void 0:p.scopes,queryParams:(f=t.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await gt(this.fetch,"GET",S,{headers:this.headers,jwt:(y=(m=v.session)===null||m===void 0?void 0:m.access_token)!==null&&y!==void 0?y:void 0})});if(c)throw c;return tr()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(l?.url),this._returnResult({data:{provider:t.provider,url:l?.url},error:null})}catch(l){if(at(l))return this._returnResult({data:{provider:t.provider,url:null},error:l});throw l}}async linkIdentityIdToken(t){return await this._useSession(async s=>{var l;try{const{error:c,data:{session:u}}=s;if(c)throw c;const{options:d,provider:p,token:f,access_token:m,nonce:y}=t,v=await gt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=u?.access_token)!==null&&l!==void 0?l:void 0,body:{provider:p,id_token:f,access_token:m,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Vr}),{data:x,error:S}=v;return S?this._returnResult({data:{user:null,session:null},error:S}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new ka}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:S}))}catch(c){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),at(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}})}async unlinkIdentity(t){try{return await this._useSession(async s=>{var l,c;const{data:u,error:d}=s;if(d)throw d;return await gt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(c=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&c!==void 0?c:void 0})})}catch(s){if(at(s))return this._returnResult({data:null,error:s});throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const l=Date.now();return await MC(async c=>(c>0&&await DC(200*Math.pow(2,c-1)),this._debug(s,"refreshing attempt",c),await gt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Vr})),(c,u)=>{const d=200*Math.pow(2,c);return u&&Jh(u)&&Date.now()+d-l<$a})}catch(l){if(this._debug(s,"error",l),at(l))return this._returnResult({data:{session:null,user:null},error:l});throw l}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const l=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",l),tr()&&!s.skipBrowserRedirect&&window.location.assign(l),{data:{provider:t,url:l},error:null}}async _recoverAndRefresh(){var t,s;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const c=await Di(this.storage,this.storageKey);if(c&&this.userStorage){let d=await Di(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:c.user},await qa(this.userStorage,this.storageKey+"-user",d)),c.user=(t=d?.user)!==null&&t!==void 0?t:ef()}else if(c&&!c.user&&!c.user){const d=await Di(this.storage,this.storageKey+"-user");d&&d?.user?(c.user=d.user,await Zn(this.storage,this.storageKey+"-user"),await qa(this.storage,this.storageKey,c)):c.user=ef()}if(this._debug(l,"session from storage",c),!this._isValidSession(c)){this._debug(l,"session is not valid"),c!==null&&await this._removeSession();return}const u=((s=c.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Xh;if(this._debug(l,`session has${u?"":" not"} expired with margin of ${Xh}s`),u){if(this.autoRefreshToken&&c.refresh_token){const{error:d}=await this._callRefreshToken(c.refresh_token);d&&(console.error(d),Jh(d)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(c.user&&c.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:p}=await this._getUser(c.access_token);!p&&d?.user?(c.user=d.user,await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(l,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",c)}catch(c){this._debug(l,"error",c),console.error(c);return}finally{this._debug(l,"end")}}async _callRefreshToken(t){var s,l;if(!t)throw new Cr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new Mu;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new Cr;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const p={data:u.session,error:null};return this.refreshingDeferred.resolve(p),p}catch(u){if(this._debug(c,"error",u),at(u)){const d={data:null,error:u};return Jh(u)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(d),d}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(u),u}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(t,s,l=!0){const c=`#_notifyAllSubscribers(${t})`;this._debug(c,"begin",s,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:t,session:s});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async p=>{try{await p.callback(t,s)}catch(f){u.push(f)}});if(await Promise.all(d),u.length>0){for(let p=0;p<u.length;p+=1)console.error(u[p]);throw u[0]}}finally{this._debug(c,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Zn(this.storage,`${this.storageKey}-code-verifier`);const s=Object.assign({},t),l=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&s.user&&await qa(this.userStorage,this.storageKey+"-user",{user:s.user});const c=Object.assign({},s);delete c.user;const u=Uv(c);await qa(this.storage,this.storageKey,u)}else{const c=Uv(s);await qa(this.storage,this.storageKey,c)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Zn(this.storage,this.storageKey),await Zn(this.storage,this.storageKey+"-code-verifier"),await Zn(this.storage,this.storageKey+"-user"),this.userStorage&&await Zn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&tr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),$a);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:l}}=s;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((l.expires_at*1e3-t)/$a);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${$a}ms, refresh threshold is ${Lf} ticks`),c<=Lf&&await this._callRefreshToken(l.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Rx)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,l){const c=[`provider=${encodeURIComponent(s)}`];if(l?.redirectTo&&c.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l?.scopes&&c.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[u,d]=await Aa(this.storage,this.storageKey),p=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});c.push(p.toString())}if(l?.queryParams){const u=new URLSearchParams(l.queryParams);c.push(u.toString())}return l?.skipBrowserRedirect&&c.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${t}?${c.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var l;const{data:c,error:u}=s;return u?this._returnResult({data:null,error:u}):await gt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token})})}catch(s){if(at(s))return this._returnResult({data:null,error:s});throw s}}async _enroll(t){try{return await this._useSession(async s=>{var l,c;const{data:u,error:d}=s;if(d)return this._returnResult({data:null,error:d});const p=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:f,error:m}=await gt(this.fetch,"POST",`${this.url}/factors`,{body:p,headers:this.headers,jwt:(l=u?.session)===null||l===void 0?void 0:l.access_token});return m?this._returnResult({data:null,error:m}):(t.factorType==="totp"&&f.type==="totp"&&(!((c=f?.totp)===null||c===void 0)&&c.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),this._returnResult({data:f,error:null}))})}catch(s){if(at(s))return this._returnResult({data:null,error:s});throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var l;const{data:c,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?uE(t.webauthn.credential_response):dE(t.webauthn.credential_response)})}:{code:t.code}),{data:p,error:f}=await gt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token});return f?this._returnResult({data:null,error:f}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+p.expires_in},p)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",p),this._returnResult({data:p,error:f}))})}catch(s){if(at(s))return this._returnResult({data:null,error:s});throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var l;const{data:c,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=await gt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token});if(d.error)return d;const{data:p}=d;if(p.type!=="webauthn")return{data:p,error:null};switch(p.webauthn.type){case"create":return{data:Object.assign(Object.assign({},p),{webauthn:Object.assign(Object.assign({},p.webauthn),{credential_options:Object.assign(Object.assign({},p.webauthn.credential_options),{publicKey:oE(p.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},p),{webauthn:Object.assign(Object.assign({},p.webauthn),{credential_options:Object.assign(Object.assign({},p.webauthn.credential_options),{publicKey:cE(p.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(s){if(at(s))return this._returnResult({data:null,error:s});throw s}})}async _challengeAndVerify(t){const{data:s,error:l}=await this._challenge({factorId:t.factorId});return l?this._returnResult({data:null,error:l}):await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){var t;const{data:{user:s},error:l}=await this.getUser();if(l)return{data:null,error:l};const c={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=s?.factors)!==null&&t!==void 0?t:[])c.all.push(u),u.status==="verified"&&c[u.factor_type].push(u);return{data:c,error:null}}async _getAuthenticatorAssuranceLevel(){var t,s;const{data:{session:l},error:c}=await this.getSession();if(c)return this._returnResult({data:null,error:c});if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=Zh(l.access_token);let d=null;u.aal&&(d=u.aal);let p=d;((s=(t=l.user.factors)===null||t===void 0?void 0:t.filter(y=>y.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(p="aal2");const m=u.amr||[];return{data:{currentLevel:d,nextLevel:p,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async s=>{const{data:{session:l},error:c}=s;return c?this._returnResult({data:null,error:c}):l?await gt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:l.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Cr})})}catch(s){if(at(s))return this._returnResult({data:null,error:s});throw s}}async _approveAuthorization(t,s){try{return await this._useSession(async l=>{const{data:{session:c},error:u}=l;if(u)return this._returnResult({data:null,error:u});if(!c)return this._returnResult({data:null,error:new Cr});const d=await gt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"approve"},xform:p=>({data:p,error:null})});return d.data&&d.data.redirect_url&&tr()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(l){if(at(l))return this._returnResult({data:null,error:l});throw l}}async _denyAuthorization(t,s){try{return await this._useSession(async l=>{const{data:{session:c},error:u}=l;if(u)return this._returnResult({data:null,error:u});if(!c)return this._returnResult({data:null,error:new Cr});const d=await gt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"deny"},xform:p=>({data:p,error:null})});return d.data&&d.data.redirect_url&&tr()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(l){if(at(l))return this._returnResult({data:null,error:l});throw l}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:s},error:l}=t;return l?this._returnResult({data:null,error:l}):s?await gt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,xform:c=>({data:c,error:null})}):this._returnResult({data:null,error:new Cr})})}catch(t){if(at(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async s=>{const{data:{session:l},error:c}=s;return c?this._returnResult({data:null,error:c}):l?(await gt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:l.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Cr})})}catch(s){if(at(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(t,s={keys:[]}){let l=s.keys.find(p=>p.kid===t);if(l)return l;const c=Date.now();if(l=this.jwks.keys.find(p=>p.kid===t),l&&this.jwks_cached_at+vC>c)return l;const{data:u,error:d}=await gt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=c,l=u.keys.find(p=>p.kid===t),!l)?null:l}async getClaims(t,s={}){try{let l=t;if(!l){const{data:S,error:C}=await this.getSession();if(C||!S.session)return this._returnResult({data:null,error:C});l=S.session.access_token}const{header:c,payload:u,signature:d,raw:{header:p,payload:f}}=Zh(l);s?.allowExpired||qC(u.exp);const m=!c.alg||c.alg.startsWith("HS")||!c.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(c.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!m){const{error:S}=await this.getUser(l);if(S)throw S;return{data:{claims:u,header:c,signature:d},error:null}}const y=PC(c.alg),v=await crypto.subtle.importKey("jwk",m,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,RC(`${p}.${f}`)))throw new $f("Invalid JWT signature");return{data:{claims:u,header:c,signature:d},error:null}}catch(l){if(at(l))return this._returnResult({data:null,error:l});throw l}}}xo.nextInstanceID={};const bE=xo,wE="2.89.0";let ro="";typeof Deno<"u"?ro="deno":typeof document<"u"?ro="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ro="react-native":ro="node";const SE={"X-Client-Info":`supabase-js-${ro}/${wE}`},jE={headers:SE},_E={schema:"public"},CE={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},EE={};function bo(n){"@babel/helpers - typeof";return bo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bo(n)}function NE(n,t){if(bo(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var l=s.call(n,t);if(bo(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function RE(n){var t=NE(n,"string");return bo(t)=="symbol"?t:t+""}function TE(n,t,s){return(t=RE(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function Hv(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable})),s.push.apply(s,l)}return s}function Sn(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Hv(Object(s),!0).forEach(function(l){TE(n,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Hv(Object(s)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(s,l))})}return n}const kE=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),AE=()=>Headers,OE=(n,t,s)=>{const l=kE(s),c=AE();return async(u,d)=>{var p;const f=(p=await t())!==null&&p!==void 0?p:n;let m=new c(d?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${f}`),l(u,Sn(Sn({},d),{},{headers:m}))}};function DE(n){return n.endsWith("/")?n:n+"/"}function ME(n,t){var s,l;const{db:c,auth:u,realtime:d,global:p}=n,{db:f,auth:m,realtime:y,global:v}=t,x={db:Sn(Sn({},f),c),auth:Sn(Sn({},m),u),realtime:Sn(Sn({},y),d),storage:{},global:Sn(Sn(Sn({},v),p),{},{headers:Sn(Sn({},(s=v?.headers)!==null&&s!==void 0?s:{}),(l=p?.headers)!==null&&l!==void 0?l:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function zE(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(DE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var UE=class extends bE{constructor(n){super(n)}},LE=class{constructor(n,t,s){var l,c;this.supabaseUrl=n,this.supabaseKey=t;const u=zE(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,p={db:_E,realtime:EE,auth:Sn(Sn({},CE),{},{storageKey:d}),global:jE},f=ME(s??{},p);if(this.storageKey=(l=f.auth.storageKey)!==null&&l!==void 0?l:"",this.headers=(c=f.global.headers)!==null&&c!==void 0?c:{},f.accessToken)this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var m;this.auth=this._initSupabaseAuthClient((m=f.auth)!==null&&m!==void 0?m:{},this.headers,f.global.fetch)}this.fetch=OE(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Sn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.accessToken&&this.accessToken().then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new g1(new URL("rest/v1",u).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this.storage=new fC(this.storageUrl.href,this.headers,this.fetch,s?.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new d1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,s)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,s;if(n.accessToken)return await n.accessToken();const{data:l}=await n.auth.getSession();return(t=(s=l.session)===null||s===void 0?void 0:s.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:l,userStorage:c,storageKey:u,flowType:d,lock:p,debug:f,throwOnError:m},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new UE({url:this.authUrl.href,headers:Sn(Sn({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:l,userStorage:c,flowType:d,lock:p,debug:f,throwOnError:m,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(S=>S.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new D1(this.realtimeUrl.href,Sn(Sn({},n),{},{params:Sn(Sn({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,s){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const IE=(n,t,s)=>new LE(n,t,s);function BE(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}BE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const nf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_API_KEY:"REDACTED_GOOGLE_API_KEY",VITE_SUPABASE_ANON_KEY:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",VITE_SUPABASE_URL:"http://127.0.0.1:54321"};var $E={};const Ax=n=>{if(typeof import.meta<"u"&&nf&&nf[n])return nf[n];const t=$E;return t&&t[n]?t[n]:null},qE=Ax("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",PE=Ax("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",De=IE(qE,PE),HE={async translateRecipe(n,t="EN-US"){const s=[];s.push(n.title||""),s.push(n.description||"");let l=2,c=2;if(n.type==="bread"){const d=n.flours||[],p=n.breadIngredients||[];d.forEach(f=>s.push(f.name||"")),p.forEach(f=>s.push(f.name||"")),c=l+d.length+p.length}else{const d=n.ingredients||[];d.forEach(p=>{const f=typeof p=="string"?p:p.name||"";s.push(f)}),c=l+d.length}const u=n.steps||[];if(u.forEach(d=>{const p=typeof d=="object"&&d!==null?d.text||"":d||"";s.push(p)}),s.length===0)return n;try{const d=await this.translateList(s,t),p={...n};if(p.title=d[0],p.description=d[1],n.type==="bread"){const f=(n.flours||[]).length;p.flours=(n.flours||[]).map((m,y)=>({...m,name:d[l+y]})),p.breadIngredients=(n.breadIngredients||[]).map((m,y)=>({...m,name:d[l+f+y]}))}else p.ingredients=(n.ingredients||[]).map((f,m)=>{const y=d[l+m];return typeof f=="string"?y:{...f,name:y}});return p.steps=u.map((f,m)=>{const y=d[c+m];return typeof f=="object"&&f!==null?{...f,text:y}:y}),p}catch(d){throw console.error("Translation failed:",d),d}},async translateList(n,t){const{data:s,error:l}=await De.functions.invoke("translate",{body:{text:n,target_lang:t}});if(l)throw console.error("Supabase Function Invocation Error:",l),new Error(`Translation Error: ${l.message}`);if(s&&s.error)throw console.error("Edge Function returned error:",s.error),new Error(`Translation Error: ${s.error}`);return s.translations.map(c=>c.text)}},hn=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},Xc=async(n,t,s)=>{let l=null;try{const c=new Promise((u,d)=>{l=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,c])}finally{l&&clearTimeout(l)}},au=n=>{if(Array.isArray(n))return n.map(s=>String(s)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const s=t.slice(1,-1);return s?s.split(",").map(l=>l.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},FE=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],s=Object.values(t)[0];return au(s)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return au(t)}return au(n)},GE=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const s=au(t);return s.length>0?s:t.split(",").map(l=>l.trim()).filter(Boolean)}return[]},Fv=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),s=String(n.message||"").toLowerCase(),l=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||s.includes("row-level security")||s.includes("permission denied")||s.includes("violates row-level security")||s.includes("invalid input syntax")||s.includes("column")||l.includes("row-level security")?!1:s.includes("failed to fetch")||s.includes("network")||s.includes("timeout")||s.includes("timed out")||s.includes("load failed")},Nn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},async _resolveShowMasterPreference(n,t=15e3){const s=n?.showMasterRecipes===!0,l=n?.id;if(!l)return s;const c=this._showMasterPrefCache.get(l),u=Date.now();if(c&&c.value!==s)return this._showMasterPrefCache.set(l,{value:s,updatedAt:u}),s;if(c&&u-c.updatedAt<3e4)return c.value;try{const{data:d,error:p}=await Xc(De.from("profiles").select("show_master_recipes").eq("id",l).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(p)throw p;const f=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(l,{value:f,updatedAt:u}),f}catch{return this._showMasterPrefCache.set(l,{value:s,updatedAt:u}),s}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:s,error:l}=await Xc(De.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(l)throw l;const c=FE(s),u=new Set(c.length>0?c:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const s=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:s,updatedAt:t},s}},async fetchRecipes(n,{timeoutMs:t=15e3}={}){let s=[];const l=async(j,{withOrderIndex:N})=>{let A=De.from("recipes").select(j);N?A=A.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):A=A.order("created_at",{ascending:!1});const{data:z,error:B}=await Xc(A,t/4,"recipes.select(list)");if(B)throw B;return(z||[]).map(Yr)},c="id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index,recipe_sources(url)",u="id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,recipe_sources(url)",d="id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at",p="id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at";let f=null;const m="recipe_query_pattern",y=this._queryPatternCache.get(m);if(y)try{s=await l(y.spec,{withOrderIndex:y.withOrderIndex})}catch(j){console.warn("Cached query pattern failed, re-detecting...",j),this._queryPatternCache.delete(m),f=j}else try{s=await l(c,{withOrderIndex:!0}),this._queryPatternCache.set(m,{spec:c,withOrderIndex:!0})}catch(j){f=j;try{s=await l(u,{withOrderIndex:!1}),this._queryPatternCache.set(m,{spec:u,withOrderIndex:!1})}catch(N){f=N;try{s=await l(d,{withOrderIndex:!1}),this._queryPatternCache.set(m,{spec:d,withOrderIndex:!1})}catch(A){f=A;try{s=await l(p,{withOrderIndex:!1}),this._queryPatternCache.set(m,{spec:p,withOrderIndex:!1})}catch(z){f=z,s=[]}}}}if(s.length===0&&f)try{const j=localStorage.getItem("local_recipes");if(j)s=JSON.parse(j).map(N=>typeof Yr=="function"?Yr(N):N);else throw f}catch{throw f}if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const v=await this._resolveShowMasterPreference(n,t),x=await this._resolveMasterOwnerTags(t),S=n.role==="admin",C=[String(n.id)];return n.displayId&&C.push(String(n.displayId)),s.filter(j=>{if(S)return!0;const N=GE(j.tags),A=N.filter(_=>_&&_.startsWith("owner:"));if(A.length===0)return!0;const z=A.some(_=>x.has(_));if(v&&z)return!0;const B=A.some(_=>C.some(M=>_===`owner:${M}`)),L=N.includes("public");return!!(B||L)})},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),l=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:c}=await De.storage.from("recipe-images").upload(l,n);if(c)throw c;const{data:u}=De.storage.from("recipe-images").getPublicUrl(l);return u.publicUrl},async getRecipe(n){try{const{data:t,error:s}=await Xc(De.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(s)throw s;return Yr(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const s=localStorage.getItem("local_recipes");if(s){const c=JSON.parse(s).find(u=>u.id==n);if(c)return Yr(c)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:s,created_at:l,sourceUrl:c,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const f=(u.tags||[]).filter(m=>!m.startsWith("owner:"));u.tags=[...f,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=Jc(u);try{const{data:p,error:f}=await De.from("recipes").insert([d]).select().single();if(f)throw f;if(c){const{error:m}=await De.from("recipe_sources").insert([{recipe_id:p.id,url:c}]);m&&console.error("Failed to save source URL:",m)}return Yr({...p,recipe_sources:c?[{url:c}]:[]})}catch(p){if(!Fv(p))throw p;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",p);const f=Date.now(),m={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=Jc(m);y.id=f,y.created_at=m.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),p}return Yr(y)}},async updateRecipe(n){const{id:t,created_at:s,sourceUrl:l,...c}=n;c.image instanceof File&&(c.image=await this.uploadImage(c.image));const u=Jc(c);c.steps===void 0&&delete u.steps,c.tags===void 0&&delete u.tags,c.ingredients!==void 0||c.type!==void 0||c.ingredientGroups!==void 0||c.flours!==void 0||c.breadIngredients!==void 0||c.stepGroups!==void 0||delete u.ingredients;try{const{data:p,error:f}=await De.from("recipes").update(u).eq("id",n.id).select().single();if(f)throw f;if(l!==void 0&&(await De.from("recipe_sources").delete().eq("recipe_id",n.id),l)){const{error:m}=await De.from("recipe_sources").insert([{recipe_id:n.id,url:l}]);m&&console.error("Failed to update source URL:",m)}return Yr({...p,recipe_sources:l?[{url:l}]:[]})}catch(p){if(!Fv(p))throw p;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",p);const f=localStorage.getItem("local_recipes");if(f){let m=JSON.parse(f);const y=m.findIndex(v=>v.id==n.id);if(y!==-1){const v={...m[y],...u,updated_at:new Date().toISOString()};return m[y]=v,localStorage.setItem("local_recipes",JSON.stringify(m)),Yr(v)}}throw p}},async duplicateRecipe(n,t){const{id:s,created_at:l,updated_at:c,image:u,...d}=n;d.title=`${d.title} ()`;let p=null;if(u)try{const f=u.split("/").pop(),m=`copy-${Date.now()}-${f}`,{error:y}=await De.storage.from("recipe-images").copy(f,m);if(y)console.warn("Image copy failed, using original URL:",y),p=u;else{const{data:v}=De.storage.from("recipe-images").getPublicUrl(m);p=v.publicUrl}}catch(f){console.warn("Image copy logic error:",f),p=u}return d.image=p,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await De.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(VE)},async getDeletedCount(){const{count:n,error:t}=await De.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:s}=await De.from("recipes").select("*").eq("id",n).single();if(s)throw s;const{error:l}=await De.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(l)throw l;const{error:c}=await De.from("recipes").delete().eq("id",n);if(c)throw c;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const s=localStorage.getItem("local_recipes");if(s){let l=JSON.parse(s);const c=l.length;if(l=l.filter(u=>u.id!=n),l.length<c)return localStorage.setItem("local_recipes",JSON.stringify(l)),!0}throw t}},async restoreRecipe(n){const{data:t,error:s}=await De.from("deleted_recipes").select("*").eq("id",n).single();if(s)throw s;const{error:l}=await De.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(l)throw l;const{error:c}=await De.from("deleted_recipes").delete().eq("id",n);if(c)throw c;return!0},async hardDeleteRecipe(n){const{error:t}=await De.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await De.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(s=>s.recipe_id)},async addToHistory(n){const{error:t}=await De.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(s=>De.from("recipes").update({order_index:s.order_index}).eq("id",s.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,s=[];for(const l of n)try{await this.createRecipe(l),t++}catch(c){console.error("Import failed for recipe:",l.title,c),s.push({title:l.title,error:c.message})}return{success:!0,count:t,errors:s}},async updateRecipeCosts(n){const{data:t,error:s}=await De.from("recipes").select("*");if(s)throw s;let l=0;const c=[];for(const u of t){const d=Yr(u);let p=!1;const f=m=>m.map(y=>{if(!y.name)return y;const v=n.get(hn(y.name));if(v&&y.purchaseCost!==v.price){p=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const S=parseFloat(x.quantity)||0;x.cost=Math.round(S/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const S=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*S)}return x}return y});if(d.type==="bread"){const m=f(d.flours||[]),y=f(d.breadIngredients||[]);p&&(d.flours=m,d.breadIngredients=y)}else{const m=f(d.ingredients||[]);p&&(d.ingredients=m)}if(p){const m=Jc(d);c.push(De.from("recipes").update(m).eq("id",d.id)),l++}}return c.length>0&&await Promise.all(c),l}},Jc=n=>{let t=n.ingredients||[];const s={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(s.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const c=n.steps||[],u=n.stepGroups.map(d=>({...d,count:c.filter(p=>p.groupId===d.id).length}));s.stepGroups=u}if(n.type==="bread"){const c=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[s,...c,...u]}else t=[s,...t];const l=(n.steps||[]).map(c=>typeof c=="string"?c:c.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:l,tags:n.tags||[]}},Yr=n=>{const t=n.ingredients||[];let s="normal",l=[],c=[],u=[],d=[],p=t;if(n.ingredients_meta)s=n.ingredients_meta.type||"normal",p=[];else if(Array.isArray(t)&&t.length>0&&t[0]._meta){const m=t[0];s=m.type||"normal",m.groups&&(u=m.groups),m.stepGroups&&(d=m.stepGroups);const y=t.slice(1);s==="bread"?(l=y.filter(v=>v._group==="flour").map(v=>{const{_group:x,...S}=v;return S}),c=y.filter(v=>v._group==="other").map(v=>{const{_group:x,...S}=v;return S}),p=[...l,...c]):p=y}let f=n.steps||[];if(d.length>0&&Array.isArray(f)){let m=0;f=f.map(v=>({text:v}));const y=[];for(d.forEach(v=>{const x=v.count||0;for(let S=0;S<x;S++)m<f.length&&(y.push({...f[m],text:f[m].text,groupId:v.id}),m++)});m<f.length;)y.push({...f[m],groupId:"default"}),m++;f=y}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:s,flours:l,breadIngredients:c,ingredientGroups:u,stepGroups:d,ingredients:p,steps:f.length>0&&typeof f[0]=="object"?f:n.steps,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},VE=n=>({...Yr(n),deletedAt:n.deleted_at,originalId:n.original_id}),rf=Object.freeze(Object.defineProperty({__proto__:null,recipeService:Nn},Symbol.toStringTag,{value:"Module"})),sf="food",YE="food_alcohol",KE=new Set(["food","alcohol","soft_drink","supplies"]),Zc=n=>{const t=String(n||"").trim();return!t||t===YE?sf:KE.has(t)?t:sf},qn={async _getCurrentUserId(){const{data:n,error:t}=await De.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,s,l=null,c=null,u=void 0,d=void 0){try{const p=await this._getCurrentUserId();if(!p)throw new Error("");const f={user_id:p,ingredient_name:n,packet_size:parseFloat(t),packet_unit:s,last_price:l?parseFloat(l):null,updated_at:new Date().toISOString()};if(c&&(f.item_category=Zc(c)),u!==void 0){const x=String(u??"").trim();f.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let S=Number.isFinite(x)?x:100;S<=0&&(S=100),S>100&&(S=100),f.yield_percent=S}const m=async x=>De.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await m(f);if(v){const x=String(v.message||""),S=!!f.item_category&&x.includes("item_category"),C=Object.prototype.hasOwnProperty.call(f,"vendor")&&x.includes("vendor"),E=Object.prototype.hasOwnProperty.call(f,"yield_percent")&&x.includes("yield_percent");if(S||C||E){const j={...f};S&&delete j.item_category,C&&delete j.vendor,E&&delete j.yield_percent,{data:y,error:v}=await m(j)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:Zc(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(p){throw console.error("Error saving conversion:",p),p}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:s,error:l}=await De.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return l?(l.code==="PGRST116"||console.warn("Error fetching conversion:",l),null):{ingredientName:s.ingredient_name,packetSize:s.packet_size,packetUnit:s.packet_unit,lastPrice:s.last_price,vendor:s.vendor||"",itemCategory:Zc(s.item_category),yieldPercent:s.yield_percent===null||s.yield_percent===void 0?100:s.yield_percent,updatedAt:s.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:s}=await De.from("unit_conversions").select("*").eq("user_id",n);if(s)throw s;const l=new Map;return t.forEach(c=>{l.set(c.ingredient_name,{ingredientName:c.ingredient_name,packetSize:c.packet_size,packetUnit:c.packet_unit,lastPrice:c.last_price,vendor:c.vendor||"",itemCategory:Zc(c.item_category),yieldPercent:c.yield_percent===null||c.yield_percent===void 0?100:c.yield_percent,updatedAt:c.updated_at})}),l}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:s}=await De.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(s)throw s;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(n,{overwrite:t=!1}={}){const s=String(n||"").trim();if(!s)throw new Error("");const{data:l,error:c}=await De.rpc("admin_copy_ingredient_master",{target_profile_id:s,overwrite:t===!0});if(c)throw c;return l}},Ox=b.createContext(null),is=()=>b.useContext(Ox),Dx=b.createContext(null),Vi=()=>{const n=b.useContext(Dx);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},lu=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],QE=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var za={},af={exports:{}},lf,Gv;function WE(){if(Gv)return lf;Gv=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return lf=n,lf}var of,Vv;function XE(){if(Vv)return of;Vv=1;var n=WE();function t(){}function s(){}return s.resetWarningCache=t,of=function(){function l(d,p,f,m,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}l.isRequired=l;function c(){return l}var u={array:l,bigint:l,bool:l,func:l,number:l,object:l,string:l,symbol:l,any:l,arrayOf:c,element:l,elementType:l,instanceOf:c,node:l,objectOf:c,oneOf:c,oneOfType:c,shape:c,exact:c,checkPropTypes:s,resetWarningCache:t};return u.PropTypes=u,u},of}var Yv;function Mx(){return Yv||(Yv=1,af.exports=XE()()),af.exports}var cf,Kv;function zx(){return Kv||(Kv=1,cf={L:1,M:0,Q:3,H:2}),cf}var uf,Qv;function Ux(){return Qv||(Qv=1,uf={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),uf}var df,Wv;function JE(){if(Wv)return df;Wv=1;var n=Ux();function t(s){this.mode=n.MODE_8BIT_BYTE,this.data=s}return t.prototype={getLength:function(s){return this.data.length},write:function(s){for(var l=0;l<this.data.length;l++)s.put(this.data.charCodeAt(l),8)}},df=t,df}var hf,Xv;function ZE(){if(Xv)return hf;Xv=1;var n=zx();function t(s,l){this.totalCount=s,this.dataCount=l}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(s,l){var c=t.getRsBlockTable(s,l);if(c==null)throw new Error("bad rs block @ typeNumber:"+s+"/errorCorrectLevel:"+l);for(var u=c.length/3,d=new Array,p=0;p<u;p++)for(var f=c[p*3+0],m=c[p*3+1],y=c[p*3+2],v=0;v<f;v++)d.push(new t(m,y));return d},t.getRsBlockTable=function(s,l){switch(l){case n.L:return t.RS_BLOCK_TABLE[(s-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(s-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(s-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(s-1)*4+3];default:return}},hf=t,hf}var ff,Jv;function eN(){if(Jv)return ff;Jv=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var s=Math.floor(t/8);return(this.buffer[s]>>>7-t%8&1)==1},put:function(t,s){for(var l=0;l<s;l++)this.putBit((t>>>s-l-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),t&&(this.buffer[s]|=128>>>this.length%8),this.length++}},ff=n,ff}var pf,Zv;function Lx(){if(Zv)return pf;Zv=1;for(var n={glog:function(s){if(s<1)throw new Error("glog("+s+")");return n.LOG_TABLE[s]},gexp:function(s){for(;s<0;)s+=255;for(;s>=256;)s-=255;return n.EXP_TABLE[s]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return pf=n,pf}var mf,e0;function Ix(){if(e0)return mf;e0=1;var n=Lx();function t(s,l){if(s.length==null)throw new Error(s.length+"/"+l);for(var c=0;c<s.length&&s[c]==0;)c++;this.num=new Array(s.length-c+l);for(var u=0;u<s.length-c;u++)this.num[u]=s[u+c]}return t.prototype={get:function(s){return this.num[s]},getLength:function(){return this.num.length},multiply:function(s){for(var l=new Array(this.getLength()+s.getLength()-1),c=0;c<this.getLength();c++)for(var u=0;u<s.getLength();u++)l[c+u]^=n.gexp(n.glog(this.get(c))+n.glog(s.get(u)));return new t(l,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var l=n.glog(this.get(0))-n.glog(s.get(0)),c=new Array(this.getLength()),u=0;u<this.getLength();u++)c[u]=this.get(u);for(var u=0;u<s.getLength();u++)c[u]^=n.gexp(n.glog(s.get(u))+l);return new t(c,0).mod(s)}},mf=t,mf}var gf,t0;function tN(){if(t0)return gf;t0=1;var n=Ux(),t=Ix(),s=Lx(),l={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},c={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;c.getBCHDigit(d)-c.getBCHDigit(c.G15)>=0;)d^=c.G15<<c.getBCHDigit(d)-c.getBCHDigit(c.G15);return(u<<10|d)^c.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;c.getBCHDigit(d)-c.getBCHDigit(c.G18)>=0;)d^=c.G18<<c.getBCHDigit(d)-c.getBCHDigit(c.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return c.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,p){switch(u){case l.PATTERN000:return(d+p)%2==0;case l.PATTERN001:return d%2==0;case l.PATTERN010:return p%3==0;case l.PATTERN011:return(d+p)%3==0;case l.PATTERN100:return(Math.floor(d/2)+Math.floor(p/3))%2==0;case l.PATTERN101:return d*p%2+d*p%3==0;case l.PATTERN110:return(d*p%2+d*p%3)%2==0;case l.PATTERN111:return(d*p%3+(d+p)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),p=0;p<u;p++)d=d.multiply(new t([1,s.gexp(p)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),p=0,f=0;f<d;f++)for(var m=0;m<d;m++){for(var y=0,v=u.isDark(f,m),x=-1;x<=1;x++)if(!(f+x<0||d<=f+x))for(var S=-1;S<=1;S++)m+S<0||d<=m+S||x==0&&S==0||v==u.isDark(f+x,m+S)&&y++;y>5&&(p+=3+y-5)}for(var f=0;f<d-1;f++)for(var m=0;m<d-1;m++){var C=0;u.isDark(f,m)&&C++,u.isDark(f+1,m)&&C++,u.isDark(f,m+1)&&C++,u.isDark(f+1,m+1)&&C++,(C==0||C==4)&&(p+=3)}for(var f=0;f<d;f++)for(var m=0;m<d-6;m++)u.isDark(f,m)&&!u.isDark(f,m+1)&&u.isDark(f,m+2)&&u.isDark(f,m+3)&&u.isDark(f,m+4)&&!u.isDark(f,m+5)&&u.isDark(f,m+6)&&(p+=40);for(var m=0;m<d;m++)for(var f=0;f<d-6;f++)u.isDark(f,m)&&!u.isDark(f+1,m)&&u.isDark(f+2,m)&&u.isDark(f+3,m)&&u.isDark(f+4,m)&&!u.isDark(f+5,m)&&u.isDark(f+6,m)&&(p+=40);for(var E=0,m=0;m<d;m++)for(var f=0;f<d;f++)u.isDark(f,m)&&E++;var j=Math.abs(100*E/d/d-50)/5;return p+=j*10,p}};return gf=c,gf}var yf,n0;function nN(){if(n0)return yf;n0=1;var n=JE(),t=ZE(),s=eN(),l=tN(),c=Ix();function u(p,f){this.typeNumber=p,this.errorCorrectLevel=f,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(p){var f=new n(p);this.dataList.push(f),this.dataCache=null},d.isDark=function(p,f){if(p<0||this.moduleCount<=p||f<0||this.moduleCount<=f)throw new Error(p+","+f);return this.modules[p][f]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var p=1;for(p=1;p<40;p++){for(var f=t.getRSBlocks(p,this.errorCorrectLevel),m=new s,y=0,v=0;v<f.length;v++)y+=f[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];m.put(x.mode,4),m.put(x.getLength(),l.getLengthInBits(x.mode,p)),x.write(m)}if(m.getLengthInBits()<=y*8)break}this.typeNumber=p}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(p,f){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++){this.modules[m]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[m][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(p,f),this.typeNumber>=7&&this.setupTypeNumber(p),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,f)},d.setupPositionProbePattern=function(p,f){for(var m=-1;m<=7;m++)if(!(p+m<=-1||this.moduleCount<=p+m))for(var y=-1;y<=7;y++)f+y<=-1||this.moduleCount<=f+y||(0<=m&&m<=6&&(y==0||y==6)||0<=y&&y<=6&&(m==0||m==6)||2<=m&&m<=4&&2<=y&&y<=4?this.modules[p+m][f+y]=!0:this.modules[p+m][f+y]=!1)},d.getBestMaskPattern=function(){for(var p=0,f=0,m=0;m<8;m++){this.makeImpl(!0,m);var y=l.getLostPoint(this);(m==0||p>y)&&(p=y,f=m)}return f},d.createMovieClip=function(p,f,m){var y=p.createEmptyMovieClip(f,m),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var S=x*v,C=0;C<this.modules[x].length;C++){var E=C*v,j=this.modules[x][C];j&&(y.beginFill(0,100),y.moveTo(E,S),y.lineTo(E+v,S),y.lineTo(E+v,S+v),y.lineTo(E,S+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var p=8;p<this.moduleCount-8;p++)this.modules[p][6]==null&&(this.modules[p][6]=p%2==0);for(var f=8;f<this.moduleCount-8;f++)this.modules[6][f]==null&&(this.modules[6][f]=f%2==0)},d.setupPositionAdjustPattern=function(){for(var p=l.getPatternPosition(this.typeNumber),f=0;f<p.length;f++)for(var m=0;m<p.length;m++){var y=p[f],v=p[m];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var S=-2;S<=2;S++)x==-2||x==2||S==-2||S==2||x==0&&S==0?this.modules[y+x][v+S]=!0:this.modules[y+x][v+S]=!1}},d.setupTypeNumber=function(p){for(var f=l.getBCHTypeNumber(this.typeNumber),m=0;m<18;m++){var y=!p&&(f>>m&1)==1;this.modules[Math.floor(m/3)][m%3+this.moduleCount-8-3]=y}for(var m=0;m<18;m++){var y=!p&&(f>>m&1)==1;this.modules[m%3+this.moduleCount-8-3][Math.floor(m/3)]=y}},d.setupTypeInfo=function(p,f){for(var m=this.errorCorrectLevel<<3|f,y=l.getBCHTypeInfo(m),v=0;v<15;v++){var x=!p&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!p&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!p},d.mapData=function(p,f){for(var m=-1,y=this.moduleCount-1,v=7,x=0,S=this.moduleCount-1;S>0;S-=2)for(S==6&&S--;;){for(var C=0;C<2;C++)if(this.modules[y][S-C]==null){var E=!1;x<p.length&&(E=(p[x]>>>v&1)==1);var j=l.getMask(f,y,S-C);j&&(E=!E),this.modules[y][S-C]=E,v--,v==-1&&(x++,v=7)}if(y+=m,y<0||this.moduleCount<=y){y-=m,m=-m;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(p,f,m){for(var y=t.getRSBlocks(p,f),v=new s,x=0;x<m.length;x++){var S=m[x];v.put(S.mode,4),v.put(S.getLength(),l.getLengthInBits(S.mode,p)),S.write(v)}for(var C=0,x=0;x<y.length;x++)C+=y[x].dataCount;if(v.getLengthInBits()>C*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+C*8+")");for(v.getLengthInBits()+4<=C*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=C*8||(v.put(u.PAD0,8),v.getLengthInBits()>=C*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(p,f){for(var m=0,y=0,v=0,x=new Array(f.length),S=new Array(f.length),C=0;C<f.length;C++){var E=f[C].dataCount,j=f[C].totalCount-E;y=Math.max(y,E),v=Math.max(v,j),x[C]=new Array(E);for(var N=0;N<x[C].length;N++)x[C][N]=255&p.buffer[N+m];m+=E;var A=l.getErrorCorrectPolynomial(j),z=new c(x[C],A.getLength()-1),B=z.mod(A);S[C]=new Array(A.getLength()-1);for(var N=0;N<S[C].length;N++){var L=N+B.getLength()-S[C].length;S[C][N]=L>=0?B.get(L):0}}for(var _=0,N=0;N<f.length;N++)_+=f[N].totalCount;for(var M=new Array(_),k=0,N=0;N<y;N++)for(var C=0;C<f.length;C++)N<x[C].length&&(M[k++]=x[C][N]);for(var N=0;N<v;N++)for(var C=0;C<f.length;C++)N<S[C].length&&(M[k++]=S[C][N]);return M},yf=u,yf}var eu={},r0;function rN(){if(r0)return eu;r0=1,Object.defineProperty(eu,"__esModule",{value:!0});var n=Object.assign||function(m){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(m[x]=v[x])}return m},t=Mx(),s=u(t),l=So(),c=u(l);function u(m){return m&&m.__esModule?m:{default:m}}function d(m,y){var v={};for(var x in m)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(m,x)&&(v[x]=m[x]);return v}var p={bgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,bgD:s.default.string.isRequired,fgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,fgD:s.default.string.isRequired,size:s.default.number.isRequired,title:s.default.string,viewBoxSize:s.default.number.isRequired,xmlns:s.default.string},f=(0,l.forwardRef)(function(m,y){var v=m.bgColor,x=m.bgD,S=m.fgD,C=m.fgColor,E=m.size,j=m.title,N=m.viewBoxSize,A=m.xmlns,z=A===void 0?"http://www.w3.org/2000/svg":A,B=d(m,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return c.default.createElement("svg",n({},B,{height:E,ref:y,viewBox:"0 0 "+N+" "+N,width:E,xmlns:z}),j?c.default.createElement("title",null,j):null,c.default.createElement("path",{d:x,fill:v}),c.default.createElement("path",{d:S,fill:C}))});return f.displayName="QRCodeSvg",f.propTypes=p,eu.default=f,eu}var s0;function sN(){if(s0)return za;s0=1,Object.defineProperty(za,"__esModule",{value:!0}),za.QRCode=void 0;var n=Object.assign||function(E){for(var j=1;j<arguments.length;j++){var N=arguments[j];for(var A in N)Object.prototype.hasOwnProperty.call(N,A)&&(E[A]=N[A])}return E},t=Mx(),s=v(t),l=zx(),c=v(l),u=nN(),d=v(u),p=So(),f=v(p),m=rN(),y=v(m);function v(E){return E&&E.__esModule?E:{default:E}}function x(E,j){var N={};for(var A in E)j.indexOf(A)>=0||Object.prototype.hasOwnProperty.call(E,A)&&(N[A]=E[A]);return N}var S={bgColor:s.default.oneOfType([s.default.object,s.default.string]),fgColor:s.default.oneOfType([s.default.object,s.default.string]),level:s.default.string,size:s.default.number,value:s.default.string.isRequired},C=(0,p.forwardRef)(function(E,j){var N=E.bgColor,A=N===void 0?"#FFFFFF":N,z=E.fgColor,B=z===void 0?"#000000":z,L=E.level,_=L===void 0?"L":L,M=E.size,k=M===void 0?256:M,G=E.value,V=x(E,["bgColor","fgColor","level","size","value"]),Q=new d.default(-1,c.default[_]);Q.addData(G),Q.make();var P=Q.modules;return f.default.createElement(y.default,n({},V,{bgColor:A,bgD:P.map(function(F,q){return F.map(function($,T){return $?"":"M "+T+" "+q+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:B,fgD:P.map(function(F,q){return F.map(function($,T){return $?"M "+T+" "+q+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:j,size:k,viewBoxSize:P.length}))});return za.QRCode=C,C.displayName="QRCode",C.propTypes=S,za.default=C,za}var iN=sN();const aN=x0(iN),i0=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},lN=new Set(["food","alcohol","soft_drink","supplies"]),Bx=new Set(["alcohol","supplies"]),$x=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":lN.has(t)?t:"":""},qf=n=>{const t=$x(n?.itemCategory??n?.item_category);return t?Bx.has(t):!!n?.isAlcohol},Mi=n=>qf(n)?1.1:1.08,a0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),oN=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=a0(t);if(!l)return null;for(const[c,u]of n.entries())if(a0(c)===l)return u;return null},ks=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},cN=n=>{const t=ks(n);return!Number.isFinite(t)||t<=0||t>100?100:t},uN=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return cN(s)/100},dN=(n,t,s)=>{const l=ks(n),c=ks(t);if(!Number.isFinite(l)||!Number.isFinite(c)||c<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/c*1e3:(["kg","","l",""].includes(u),l/c)},l0=(n,t,s,{defaultWeightWhenUnitEmpty:l=!1,forceWeightBased:c=!1,yieldRate:u=1}={})=>{const d=ks(n),p=ks(t);if(!Number.isFinite(d)||!Number.isFinite(p))return NaN;const f=Number.isFinite(u)&&u>0?u:1,m=String(s||"").trim().toLowerCase();return c||!m&&l||["g","","ml","","cc",""].includes(m)?d/1e3*p/f:d*p/f},hN=(n,t)=>{const s=ks(n?.purchaseCost),l=ks(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},fN=({recipe:n,ownerLabel:t,onBack:s,onEdit:l,onDelete:c,onHardDelete:u,isDeleted:d,onView:p,onDuplicate:f,backLabel:m,onList:y})=>{const{user:v}=is(),x=Vi(),[S,C]=Ue.useState(!1),[E,j]=Ue.useState(!1),[N,A]=Ue.useState(!1),[z,B]=Ue.useState(new Set),[L,_]=Ue.useState(new Set),[M,k]=Ue.useState(new Set),[G,V]=Ue.useState({}),[Q,P]=Ue.useState("ORIGINAL"),[F,q]=Ue.useState(!1),[$,T]=Ue.useState(!0),[I,Y]=Ue.useState(!1),[ae,ye]=Ue.useState(new Map),[U,W]=Ue.useState(""),[Z,ce]=Ue.useState(1),[Oe,Se]=Ue.useState(""),[Re,O]=Ue.useState(""),ie=Ue.useMemo(()=>{const te=parseFloat(Z);return isNaN(te)?1:te},[Z]),de=(te,ee)=>{if(!te)return"";const ue=parseFloat(te);if(isNaN(ue))return te;const je=ue*parseFloat(ee);return Number.isInteger(je)?je.toString():je.toFixed(1).replace(/\.0$/,"")},Me=(te,ee)=>{if(!te)return"";const ue=parseFloat(te);return isNaN(ue)?te:(ue*parseFloat(ee)).toFixed(2).replace(/\.00$/,"")},[Le,Ke]=Ue.useState(n),[$e,We]=Ue.useState(!1),me=Q==="ORIGINAL"?Le:G[Q]||Le;Ue.useEffect(()=>{let te=!0;return qn.getAllConversions().then(ee=>{te&&ye(ee)}).catch(()=>{te&&ye(new Map)}),()=>{te=!1}},[]);const Qe=Ue.useMemo(()=>{const te=(ee,ue={})=>{if(!ee||typeof ee!="object")return ee;const je=oN(ae,ee.name),Ie=$x(ee.itemCategory??ee.item_category??je?.itemCategory),H=uN(ee,je);let xe=ee;if(Ie&&(xe={...xe,itemCategory:Ie,isAlcohol:Bx.has(Ie)}),!je||!je.packetSize){const ze=String(ee.unit||"").trim();if(ue.forceWeightBased||ue.defaultWeightWhenUnitEmpty&&!ze){const Ft=l0(ee.quantity,xe.purchaseCost,ee.unit,{...ue,yieldRate:H}),Rn=Number.isFinite(Ft)?Math.round(Ft*100)/100:NaN,St=ks(xe.cost);if(Number.isFinite(Rn)&&(!Number.isFinite(St)||Math.abs(St-Rn)>.01))return{...xe,cost:Rn}}return xe}const et=[je.lastPrice,ee.purchaseCostRef,ee.purchase_cost,ee.purchaseCost].find(ze=>Number.isFinite(ks(ze))),wt=dN(et,je.packetSize,je.packetUnit);if(!Number.isFinite(wt)||!hN(ee,wt))return xe;const Qt=l0(ee.quantity,wt,ee.unit,{...ue,yieldRate:H});return{...xe,purchaseCost:Math.round(wt*100)/100,cost:Number.isFinite(Qt)?Math.round(Qt*100)/100:xe.cost}};return{...me,ingredients:(me.ingredients||[]).map(ee=>te(ee)),flours:(me.flours||[]).map(ee=>te(ee,{forceWeightBased:!0})),breadIngredients:(me.breadIngredients||[]).map(ee=>te(ee,{forceWeightBased:!0}))}},[ae,me]);Ue.useEffect(()=>{Ke(n),!n.steps&&!d&&(We(!0),Nn.getRecipe(n.id).then(te=>{Ke(te)}).catch(te=>{console.error("Failed to load details",te)}).finally(()=>{We(!1)}))},[n,d]);const[ot,ct]=Ue.useState(n.tags?.includes("public")||!1),mt=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),zt=!(n.tags&&n.tags.some(te=>te.startsWith("owner:")))||mt,Gt=async()=>{const te=!ot;try{const ee=n.tags||[];let ue;te?ue=[...ee,"public"]:ue=ee.filter(je=>je!=="public"),ct(te),await Nn.updateRecipe({id:n.id,tags:ue})}catch(ee){console.error("Failed to toggle public",ee),x.error(""),ct(!te)}},vt=(te,ee,ue=!1)=>Q==="ORIGINAL"||!$||!ee||te===ee?te:i.jsxs(i.Fragment,{children:[te,ue?i.jsx("br",{}):" ",i.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",ee,")"]})]}),ne=async te=>{const ee=te.target.value;if(P(ee),ee!=="ORIGINAL"&&!G[ee]){q(!0);try{const ue=await HE.translateRecipe(n,ee);V(je=>({...je,[ee]:ue}))}catch(ue){console.error(ue),x.error(""),P("ORIGINAL")}finally{q(!1)}}},we=te=>{B(ee=>{const ue=new Set(ee);return ue.has(te)?ue.delete(te):ue.add(te),ue})},Ee=te=>{_(ee=>{const ue=new Set(ee);return ue.has(te)?ue.delete(te):ue.add(te),ue})},Te=te=>{k(ee=>{const ue=new Set(ee);return ue.has(te)?ue.delete(te):ue.add(te),ue})};Ue.useEffect(()=>{window.scrollTo(0,0),p&&n&&!d&&p(n.id);const te=document.title;return n&&n.title&&(document.title=n.title),V({}),P("ORIGINAL"),B(new Set),_(new Set),k(new Set),ct(n.tags?.includes("public")||!1),()=>{document.title=te}},[n.id,n.title]),Ue.useEffect(()=>{n&&n.servings?O(n.servings.toString()):O(""),Se("")},[n]);const tt=()=>{C(!0)},_t=()=>{C(!1),c(n)},Tt=()=>{C(!1)},en=()=>{A(!0)},jn=()=>{A(!1),u(n)},bt=()=>{A(!1)},tn=()=>{j(!0)},ln=async()=>{j(!1);try{const te=await Nn.duplicateRecipe(n,v);f&&f(te)}catch(te){console.error("Duplication failed",te),x.error("")}},yn=()=>{j(!1)},Un=Ue.useRef(null),Vn=Ue.useRef(null),pe=te=>{Vn.current=null,Un.current=te.targetTouches[0].clientX},He=te=>{Vn.current=te.targetTouches[0].clientX},Xe=()=>{if(!Un.current||!Vn.current)return;const te=Un.current-Vn.current,ee=Un.current<50,ue=te<-100;ee&&ue&&s()},Ve=te=>{const ee=Math.round(parseFloat(te)),ue=parseFloat(Oe),je=parseFloat(Re);let Ie=null,H=null,xe=null;return!isNaN(ee)&&!isNaN(je)&&je>0&&(xe=ee/je),!isNaN(ee)&&!isNaN(ue)&&!isNaN(je)&&ue>0&&je>0&&(H=ue*je,Ie=ee/H*100),i.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[i.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("span",{children:["  ",i.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),i.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),i.jsx("input",{type:"number",value:Oe,onChange:_e=>Se(_e.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),i.jsx("input",{type:"number",value:Re,onChange:_e=>O(_e.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),xe!==null&&i.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Ie!==null?Ie>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Ie!==null?Ie>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Ie!==null?"6px":"0"},children:["1(): ",i.jsxs("strong",{children:["",xe.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Ie!==null&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",H.toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(H-ee).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Ie>40?"#d32f2f":"#2e7d32"},children:[": ",Ie.toFixed(1),"%"]})]})]})]})]})},Ge=Qe.ingredients||[];let At=me.steps||[];const Ct=te=>String(te||"").trim().toLowerCase(),Nt=te=>{const ee=Ct(te);return ee?["","","steps","method"].some(ue=>ee===ue||ee.includes(ue)):!1};if(!At.length&&me.ingredientGroups){const te=me.ingredientGroups.find(ee=>Nt(ee.name));if(te)At=Ge.filter(ue=>ue.groupId===te.id).map(ue=>typeof ue=="string"?ue:{...ue,text:ue.name||ue.text||""});else{const ee=Ge.filter(ue=>Nt(ue.group)||Nt(ue.groupName));ee.length&&(At=ee.map(ue=>typeof ue=="string"?ue:{...ue,text:ue.name||ue.text||""}))}}const Je=At,Ut=Ue.useMemo(()=>{const te=me.ingredientGroups||[],ee=["","steps","method",""],ue=_e=>String(_e||"").trim().toLowerCase(),je=new Set(te.filter(_e=>ee.includes(ue(_e.name))).map(_e=>_e.id)),Ie=te.filter(_e=>!je.has(_e.id));if(!Ie.length)return[{id:"default",name:null,items:Ge.filter(_e=>!je.has(_e.groupId))}];const H=Ie.map(_e=>{const et=Ge.filter(wt=>wt.groupId===_e.id);return{id:_e.id,name:_e.name===""?null:_e.name,items:et}}).filter(_e=>_e.items.length>0),xe=Ge.filter(_e=>_e.groupId?je.has(_e.groupId)?!1:!Ie.some(et=>et.id===_e.groupId):!0);return xe.length&&H.push({id:"ungrouped",name:null,items:xe}),H.length?H:[{id:"default",name:null,items:Ge.filter(_e=>!je.has(_e.groupId))}]},[me.ingredientGroups,Ge]),Fe=Ue.useMemo(()=>{if(me.type!=="bread")return null;const te=Qe.flours||[],ee=Qe.breadIngredients||[],ue=te.reduce((ze,xt)=>ze+(parseFloat(xt.quantity)||0),0),je=ue+ee.reduce((ze,xt)=>ze+(parseFloat(xt.quantity)||0),0),Ie=parseFloat(U),H=Ie&&je?Ie/je:1,xe=ze=>ue?((parseFloat(ze)||0)/ue*100).toFixed(1):"0.0",_e=ze=>Ie?((parseFloat(ze)||0)*H).toFixed(1):ze,et=ze=>{const xt=parseFloat(ze)||0;if(!Ie)return xt;const Ft=xt*H;return Math.round(Ft*100)/100},wt=ze=>{const xt=et(ze);return Number.isFinite(xt)?xt.toLocaleString(void 0,{maximumFractionDigits:2}):""},Qt=ze=>ze.reduce((xt,Ft)=>{const St=(parseFloat(Ft.cost)||0)*(Ie?H:1),on=Mi(Ft);return xt+St*on},0);return{flours:te,others:ee,totalFlour:ue,grandTotal:je,calcPercent:xe,getScaledQtyValue:_e,getScaledCostValue:et,formatCostValue:wt,scaleFactor:H,totalTaxIncluded:Qt(te)+Qt(ee)}},[Qe.breadIngredients,Qe.flours,me.type,U]),Lt=Ue.useMemo(()=>me.type==="bread"?0:Ge.reduce((te,ee)=>{const je=(parseFloat(ee.cost)||0)*ie,Ie=Mi(ee);return te+je*Ie},0),[me.type,Ge,ie]),Xt=me.type==="bread"?Fe?Math.round(Fe.totalTaxIncluded).toLocaleString():"0":Math.round(Lt).toLocaleString(),Kt=me.description||n.description;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:pe,onTouchMove:He,onTouchEnd:Xe,children:[E&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(xn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(fe,{variant:"ghost",onClick:yn,children:""}),i.jsx(fe,{variant:"primary",onClick:ln,children:""})]})]})}),N&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(xn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(fe,{variant:"ghost",onClick:bt,children:""}),i.jsx(fe,{variant:"danger",onClick:jn,children:""})]})]})}),S&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(xn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("small",{style:{color:"#666"},children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(fe,{variant:"ghost",onClick:Tt,children:""}),i.jsx(fe,{variant:"danger",onClick:_t,children:""})]})]})}),i.jsxs("div",{className:"recipe-detail__header",children:[i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx(fe,{variant:"secondary",onClick:s,size:"sm",children:m||" "}),y&&i.jsx(fe,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&i.jsxs("div",{className:"recipe-detail__actions",children:[zt&&(v?.displayId==="yoshito"||v?.role==="admin")&&i.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:i.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:ot,onChange:Gt,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),i.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:ot?"#4CAF50":"#888"},children:ot?"":""})]})}),!zt&&i.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),i.jsxs("select",{className:"language-select",value:Q,onChange:ne,disabled:F,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[i.jsx("option",{value:"ORIGINAL",children:" Original ()"}),QE.map(te=>i.jsx("option",{value:te.code,children:te.label},te.code))]}),Q!=="ORIGINAL"&&i.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[i.jsx("input",{type:"checkbox",checked:$,onChange:te=>T(te.target.checked),style:{marginRight:"4px"}}),""]}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>Y(!0),children:" "}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:tn,children:""}),zt&&i.jsxs(i.Fragment,{children:[i.jsx(fe,{variant:"secondary",size:"sm",onClick:l,children:""}),i.jsx(fe,{variant:"danger",size:"sm",onClick:tt,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&i.jsxs("div",{className:"recipe-detail__actions",children:[i.jsx(fe,{variant:"ghost",size:"sm",onClick:en,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),i.jsx(fe,{variant:"primary",size:"sm",onClick:()=>c(n,!0),children:""})]})]}),i.jsx("div",{className:"recipe-detail__hero",children:me.image?i.jsx("img",{src:me.image,alt:me.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),i.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[i.jsx("h1",{children:vt(me.title,n.title)}),i.jsx("p",{className:"recipe-detail__desc",children:vt(me.description,n.description,!0)}),v?.role==="admin"&&t&&i.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),i.jsxs("div",{className:"recipe-detail__meta",children:[me.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:vt(me.course,n.course)})]}),me.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:vt(me.category,n.category)})]}),me.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:vt(me.storeName,n.storeName)})]}),i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[me.servings,""]})]})]}),me.sourceUrl&&i.jsxs("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsx("div",{style:{fontSize:"0.85rem"},children:i.jsxs("a",{href:me.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",i.jsx("span",{className:"screen-only",children:""}),i.jsx("span",{className:"print-only",children:""})]})}),i.jsx("div",{style:{background:"white",padding:"4px",width:"fit-content"},children:i.jsx(aN,{value:me.sourceUrl,size:128,style:{display:"block"}})})]})]}),i.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[i.jsxs("span",{children:[" : ",i0(n.created_at)]}),n.updated_at&&i.jsxs("span",{children:[" : ",i0(n.updated_at)]})]}),i.jsx("div",{className:"recipe-detail__content",children:i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),i.jsx(xn,{className:"ingredients-card",children:me.type==="bread"?i.jsx("div",{className:"bread-detail-view",children:(()=>{const te=Qe.flours||[],ee=Qe.breadIngredients||[],ue=te.reduce((ze,xt)=>ze+(parseFloat(xt.quantity)||0),0),je=ue+ee.reduce((ze,xt)=>ze+(parseFloat(xt.quantity)||0),0),Ie=ue?(je/ue*100).toFixed(1):"0.0",H=ze=>ue?((parseFloat(ze)||0)/ue*100).toFixed(1):"0.0",xe=parseFloat(U),_e=xe&&je?xe/je:1,et=ze=>xe?((parseFloat(ze)||0)*_e).toFixed(1):ze,wt=ze=>{const xt=parseFloat(ze)||0;if(!xe)return xt;const Ft=xt*_e;return Math.round(Ft*100)/100},Qt=ze=>Number.isFinite(ze)?ze.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[je.toLocaleString(),"g"]}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Ie,"%)"]})]}),i.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("input",{id:"target-total-input",type:"number",value:U,onChange:ze=>W(ze.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),i.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),U&&i.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>W(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),U&&i.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",_e.toFixed(3)," "]})]}),i.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[i.jsx("span",{children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",U?et(ue):ue,"g (100%)"]})]}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:te.map((ze,xt)=>{const Ft=n.flours?.[xt]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`flour-${xt}`}),i.jsx("label",{htmlFor:`flour-${xt}`,children:vt(ze.name,Ft?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:U?i.jsx("span",{style:{color:"var(--color-primary)"},children:et(ze.quantity)}):ze.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[H(ze.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ze.purchaseCost?`${ze.purchaseCost}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:ze.cost?`${Qt(wt(ze.cost))}`:"-"})]},xt)})})]})]}),i.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[i.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:ee.map((ze,xt)=>{const Ft=n.breadIngredients?.[xt]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ingredient-${xt}`}),i.jsx("label",{htmlFor:`ingredient-${xt}`,children:vt(ze.name,Ft?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:U?i.jsx("span",{style:{color:"var(--color-primary)"},children:et(ze.quantity)}):ze.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[H(ze.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ze.purchaseCost?`${ze.purchaseCost}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:ze.cost?`${Qt(wt(ze.cost))}`:"-"})]},xt)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const ze=Ft=>Ft.reduce((Rn,St)=>{const on=parseFloat(St.cost)||0,Yn=Mi(St),qt=on*_e;return Rn+qt*Yn},0),xt=ze(te)+ze(ee);return Math.round(xt).toLocaleString()})()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const ze=Ft=>Ft.reduce((Rn,St)=>{const on=parseFloat(St.cost)||0,Yn=Mi(St),qt=on*_e;return Rn+qt*Yn},0),xt=ze(te)+ze(ee);return Ve(xt)})()]})]})})()}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[i.jsx("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:":"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),i.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:Z,onChange:te=>ce(te.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(Z)!==1&&i.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>ce("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const te=me.ingredientGroups&&me.ingredientGroups.length>0?me.ingredientGroups:null;return te?te.map(ee=>{const ue=Ge.filter(je=>je.groupId===ee.id);return ue.length===0||["","Steps","Method",""].includes(ee.name)?null:i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(ee.name)?"none":"block"},children:ee.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:ue.map((je,Ie)=>{const H=Ge.indexOf(je),xe=n.ingredients?.[H],_e=typeof je=="string"?je:je.name,et=xe?typeof xe=="string"?xe:xe.name:"",wt=de(je.quantity,Z),Qt=Me(je.cost,Z),ze=String(Z)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${ee.id}-${Ie}`}),i.jsx("label",{htmlFor:`ing-${ee.id}-${Ie}`,children:vt(_e,et)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:ze?"bold":"normal",color:ze?"var(--color-primary)":"inherit"},children:wt}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:je.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:je.purchaseCost?`${je.purchaseCost}`:"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[Qt?`${Qt}`:"-",qf(je)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Ie)})})]})]},ee.id)}):i.jsxs(i.Fragment,{children:[i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:Ge.map((ee,ue)=>{const je=n.ingredients?.[ue],Ie=typeof ee=="string"?ee:ee.name,H=je?typeof je=="string"?je:je.name:"",xe=de(ee.quantity,Z),_e=Me(ee.cost,Z),et=String(Z)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${ue}`}),i.jsx("label",{htmlFor:`ing-${ue}`,children:vt(Ie,H)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:et?"bold":"normal",color:et?"var(--color-primary)":"inherit"},children:xe}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:ee.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ee.purchaseCost?`${ee.purchaseCost}`:"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[_e?`${_e}`:"-",qf(ee)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},ue)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ue=>ue.reduce((je,Ie)=>{const H=parseFloat(Ie.cost)||0,xe=Mi(Ie),_e=Me(H,Z),et=parseFloat(_e)||0;return je+et*xe},0))(Ge)).toLocaleString()]})]})]})})(),i.jsx("div",{className:"screen-only no-print",children:i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ee=>ee.reduce((ue,je)=>{const Ie=parseFloat(je.cost)||0,H=Mi(je),xe=Me(Ie,Z),_e=parseFloat(xe)||0;return ue+_e*H},0))(Ge)).toLocaleString()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]})}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const ee=(ue=>ue.reduce((je,Ie)=>{const H=parseFloat(Ie.cost)||0,xe=Mi(Ie),_e=parseFloat(Me(H,Z))||0;return je+_e*xe},0))(Ge);return Ve(ee)})()]})})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),(()=>{const te=me.stepGroups&&me.stepGroups.length>0?me.stepGroups:null,ee=te&&Je.some(ue=>!ue||typeof ue!="object"||!ue.groupId?!1:te.some(je=>je.id===ue.groupId));return te&&ee?i.jsx("div",{className:"steps-container",children:te.map(ue=>{const je=Je.filter(Ie=>(typeof Ie=="object"?Ie.groupId:null)===ue.id);return je.length===0?null:i.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[ue.name!==""&&ue.name!=="Steps"&&i.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:ue.name}),i.jsx("div",{className:"steps-list",children:je.map((Ie,H)=>{const xe=Je.indexOf(Ie),_e=typeof Ie=="object"?Ie.text:Ie,et=n.steps?.[xe],wt=typeof et=="object"?et.text:et,Qt=ze=>ze?ze.replace(/<[^>]*>?/gm,""):"";return i.jsxs(xn,{className:`step-card ${z.has(xe)?"is-completed":""}`,onClick:()=>we(xe),children:[i.jsx("div",{className:"step-number",children:xe+1}),i.jsx("p",{className:"step-text",children:vt(Qt(_e),Qt(wt),!0)})]},H)})})]},ue.id)})}):i.jsx("div",{className:"steps-list",children:Je.map((ue,je)=>{const Ie=typeof ue=="object"?ue.text:ue,H=n.steps?.[je],xe=typeof H=="object"?H.text:H;return i.jsxs(xn,{className:`step-card ${z.has(je)?"is-completed":""}`,onClick:()=>we(je),children:[i.jsx("div",{className:"step-number",children:je+1}),i.jsx("p",{className:"step-text",children:vt(Ie,xe,!0)})]},je)})})})()]})]})}),i.jsx(Bn,{isOpen:I,onClose:()=>Y(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-recipe",children:[i.jsx("div",{className:"preview-header",children:i.jsx("h2",{children:me.title})}),i.jsxs("div",{className:"preview-meta",children:[me.course&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",me.course]}),me.category&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",me.category]}),me.storeName&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",me.storeName]}),me.servings&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",me.servings,""]})]}),me.description&&i.jsx("div",{className:"preview-description",children:i.jsx("p",{children:me.description})}),i.jsx("div",{className:"preview-controls",children:me.type==="bread"?i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),i.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:U,onChange:te=>W(te.target.value),placeholder:"1000"}),U&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>W(""),children:""}),Fe?.grandTotal?i.jsxs("span",{className:"preview-control-note",children:[": ",Fe.grandTotal.toLocaleString(),"g"]}):null]}):i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:""}),i.jsx("span",{className:"preview-control-mult",children:""}),i.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:Z,onChange:te=>ce(te.target.value),placeholder:"1"}),String(Z)!=="1"&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>ce("1"),children:""})]})}),i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),me.type==="bread"?i.jsxs("div",{className:"preview-ingredients-bread",children:[i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Qe.flours||[]).map((te,ee)=>{const ue=`flour-${ee}`,je=Fe?Fe.getScaledQtyValue(te.quantity):te.quantity;return i.jsxs("tr",{className:M.has(ue)?"is-completed":"",onClick:()=>Te(ue),role:"button",tabIndex:0,onKeyDown:Ie=>{(Ie.key==="Enter"||Ie.key===" ")&&(Ie.preventDefault(),Te(ue))},children:[i.jsx("td",{children:te.name}),i.jsxs("td",{style:{textAlign:"right"},children:[je,"g"]})]},ee)})})]})]}),i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Qe.breadIngredients||[]).map((te,ee)=>{const ue=`bread-${ee}`,je=Fe?Fe.getScaledQtyValue(te.quantity):te.quantity;return i.jsxs("tr",{className:M.has(ue)?"is-completed":"",onClick:()=>Te(ue),role:"button",tabIndex:0,onKeyDown:Ie=>{(Ie.key==="Enter"||Ie.key===" ")&&(Ie.preventDefault(),Te(ue))},children:[i.jsx("td",{children:te.name}),i.jsxs("td",{style:{textAlign:"right"},children:[je,"g"]})]},ee)})})]})]})]}):i.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const te=me.ingredientGroups&&me.ingredientGroups.length>0?me.ingredientGroups:null;return te?te.map(ee=>{const ue=Ge.filter(je=>je.groupId===ee.id);return ue.length===0||["","Steps","Method",""].includes(ee.name)?null:i.jsxs("div",{className:"ingredient-group",children:[i.jsx("h4",{children:ee.name}),i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:ue.map((je,Ie)=>{const H=`${ee.id}-${Ie}`,xe=typeof je=="string"?je:je.name,_e=typeof je=="object"?de(je.quantity,ie):"",et=typeof je=="object"?je.unit:"";return i.jsxs("tr",{className:M.has(H)?"is-completed":"",onClick:()=>Te(H),role:"button",tabIndex:0,onKeyDown:wt=>{(wt.key==="Enter"||wt.key===" ")&&(wt.preventDefault(),Te(H))},children:[i.jsx("td",{children:xe}),i.jsx("td",{style:{textAlign:"right"},children:_e}),i.jsx("td",{children:et})]},Ie)})})]})]},ee.id)}):i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:Ge.map((ee,ue)=>{const je=`ungrouped-${ue}`,Ie=typeof ee=="string"?ee:ee.name,H=typeof ee=="object"?de(ee.quantity,ie):"",xe=typeof ee=="object"?ee.unit:"";return i.jsxs("tr",{className:M.has(je)?"is-completed":"",onClick:()=>Te(je),role:"button",tabIndex:0,onKeyDown:_e=>{(_e.key==="Enter"||_e.key===" ")&&(_e.preventDefault(),Te(je))},children:[i.jsx("td",{children:Ie}),i.jsx("td",{style:{textAlign:"right"},children:H}),i.jsx("td",{children:xe})]},ue)})})]})})()})]}),Je.length>0&&i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),i.jsx("ol",{className:"preview-steps",children:Je.map((te,ee)=>{const ue=typeof te=="object"?te.text:te;return i.jsx("li",{className:L.has(ee)?"is-completed":"",onClick:()=>Ee(ee),role:"button",tabIndex:0,onKeyDown:je=>{(je.key==="Enter"||je.key===" ")&&(je.preventDefault(),Ee(ee))},children:ue},ee)})})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(fe,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(fe,{variant:"ghost",onClick:()=>Y(!1),children:""})]})]})})]}),i.jsxs("div",{className:"print-layout",children:[i.jsx("div",{className:"recipe-detail__hero",children:me.image?i.jsx("img",{src:me.image,alt:me.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),i.jsxs("div",{className:"recipe-detail__title-card",children:[i.jsx("h1",{children:me.title}),Kt&&i.jsx("p",{className:"recipe-detail__desc",children:Kt})]}),i.jsxs("div",{className:"recipe-detail__meta",children:[me.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:me.category})]}),me.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value meta-value--store",children:me.storeName})]}),me.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:me.course})]}),me.servings&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[me.servings,""]})]})]}),i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),me.type==="bread"&&Fe?i.jsxs("div",{children:[i.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:Fe.flours.map((te,ee)=>i.jsxs("tr",{children:[i.jsx("td",{children:te.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Fe.getScaledQtyValue(te.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[Fe.calcPercent(te.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:te.purchaseCost?`${te.purchaseCost}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:te.cost?`${Fe.formatCostValue(te.cost)}`:"-"})]},`print-flour-${ee}`))})]})]}),i.jsxs("div",{className:"bread-section",children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:Fe.others.map((te,ee)=>i.jsxs("tr",{children:[i.jsx("td",{children:te.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Fe.getScaledQtyValue(te.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[Fe.calcPercent(te.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:te.purchaseCost?`${te.purchaseCost}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:te.cost?`${Fe.formatCostValue(te.cost)}`:"-"})]},`print-others-${ee}`))})]})]})]}):Ut.map(te=>i.jsxs("div",{style:{marginBottom:"1.2rem"},children:[te.name&&i.jsx("div",{className:"print-group-heading",children:te.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:te.items.map((ee,ue)=>{const je=typeof ee=="object"?ee.quantity:"",Ie=typeof ee=="object"?ee.unit:"",H=typeof ee=="object"?ee.purchaseCost:null,xe=typeof ee=="object"?ee.cost:null,_e=typeof ee=="string"?ee:ee.name,et=typeof ee=="object"?de(ee.quantity,ie):je;return i.jsxs("tr",{children:[i.jsx("td",{children:_e}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:et}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:Ie}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:H?`${H}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:xe?`${xe}`:"-"})]},`print-ing-${te.id}-${ue}`)})})]})]},te.id)),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Xt]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),Je.length>0?i.jsx("div",{className:"steps-list",children:Je.map((te,ee)=>{const ue=typeof te=="object"?te.text:te;return i.jsxs("div",{className:"step-card",children:[i.jsx("div",{className:"step-number",children:ee+1}),i.jsx("p",{className:"step-text",children:ue})]},`print-step-${ee}`)})}):i.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:""})]})]})]})]})},qx=n=>{if(n==null)return"";let t=String(n);return t=t.replace(/[-]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[--]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},Mt=({label:n,id:t,error:s,textarea:l,...c})=>{const u=l?"textarea":"input",d=c.type==="number"||c.inputMode==="decimal"||c.inputMode==="numeric",p=f=>{if(!c.onChange)return;if(!d){c.onChange(f);return}const m=f?.target?.value??"",y=qx(m);if(y===m){c.onChange(f);return}c.onChange({target:{id:f?.target?.id,name:f?.target?.name,value:y}})};return i.jsxs("div",{className:`input-group ${s?"input-group--error":""} ${c.wrapperClassName||""}`,children:[n&&i.jsx("label",{htmlFor:t,className:"input-label",children:n}),i.jsx(u,{id:t,className:`input-field ${c.className||""}`,style:c.style,...c,onChange:p}),s&&i.jsx("span",{className:"input-error",children:s})]})},ss="app-data",sr={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await De.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const s=String(t||"").replace(/^\/+/,"");return`${n}/${s}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:s}=await De.storage.from(ss).list(n);if(s)return console.warn("Failed to list price files:",s.message),[];if(!t||t.length===0)return[];const l=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:p,error:f}=await De.storage.from(ss).download(d);if(f)return console.error(`Failed to download ${u.name}:`,f),null;const m=await p.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(m)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(m)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(l)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._cacheByUserId.get(t);if(s)return s;try{const l=new Map,c=await this._downloadAllCsvTexts(t);if(!c||c.length===0)return new Map;for(const{text:u}of c){if(!u)continue;const d=this.parseCSV(u);for(const[p,f]of d)if(l.has(p)){const m=l.get(p);(f?.dateStr||"")>(m?.dateStr||"")&&l.set(p,f)}else l.set(p,f)}return this._cacheByUserId.set(t,l),l}catch(l){return console.error("Error in fetchPriceList:",l),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:s,error:l}=await De.storage.from(ss).list(t);if(l)throw l;return s.filter(c=>String(c?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=n.name;this.clearCache(s);const c=this._getUserScopedPath(s,l),{data:u,error:d}=await De.storage.from(ss).upload(c,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(s){return console.error("Error uploading price list:",s),{success:!1,error:s}}},async deletePriceFile(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");this.clearCache(s);const l=this._getUserScopedPath(s,n),{data:c,error:u}=await De.storage.from(ss).remove([l]);if(u)throw u;if(!c||c.length===0)throw new Error("");return{success:!0,data:c}}catch(s){return console.error("Error deleting price file:",s),{success:!1,error:s}}},_splitFileName(n){const t=String(n||""),s=t.lastIndexOf(".");return s<=0?{base:t,ext:""}:{base:t.slice(0,s),ext:t.slice(s)}},_makeCopyFileName(n,t){const s=String(n||"");if(!t?.has?.(s))return s;const{base:l,ext:c}=this._splitFileName(s),u=l||s||"price";let d=1;for(;d<1e3;){const p=d===1?"_copy":`_copy${d}`,f=`${u}${p}${c}`;if(!t.has(f))return f;d++}return`${u}_copy_${Date.now()}${c}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:t=null,onProgress:s=null}={}){const l=t||await this._getCurrentUserId();if(!l)throw new Error("");const c=String(n||"").trim();if(!c)throw new Error("");if(c===l)throw new Error("");const{data:u,error:d}=await De.storage.from(ss).list(l);if(d)throw d;const p=(u||[]).map(S=>S?.name).filter(Boolean).filter(S=>String(S).toLowerCase().endsWith(".csv")),{data:f,error:m}=await De.storage.from(ss).list(c);let y=new Set;if(m){const S=String(m?.message||"").toLowerCase();if(S.includes("not found")||S.includes("404"))y=new Set;else throw m}else y=new Set((f||[]).map(S=>S?.name).filter(Boolean));const v={sourceUserId:l,targetUserId:c,copied:[],skipped:[],failed:[]},x=p.length;s?.({phase:"start",total:x,done:0,current:""});for(let S=0;S<p.length;S++){const C=p[S],E=this._makeCopyFileName(C,y);y.add(E);const j=this._getUserScopedPath(l,C),N=this._getUserScopedPath(c,E);s?.({phase:"progress",total:x,done:S,current:`${C}  ${E}`,fromFile:C,toFile:E});try{const{data:A,error:z}=await De.storage.from(ss).download(j);if(z)throw z;if(!A)throw new Error("");const{error:B}=await De.storage.from(ss).upload(N,A,{upsert:!1,contentType:"text/csv"});if(B){const L=String(B?.message||"").toLowerCase();if(L.includes("already exists")||L.includes("exists")||L.includes("409")){let _=0,M=B;for(;_<5;){_++;const k=this._makeCopyFileName(C,y);y.add(k);const G=this._getUserScopedPath(c,k),{error:V}=await De.storage.from(ss).upload(G,A,{upsert:!1,contentType:"text/csv"});if(!V){v.copied.push({fromFile:C,toFile:k}),M=null;break}M=V}if(M)throw M;continue}throw B}v.copied.push({fromFile:C,toFile:E})}catch(A){console.error("copyPriceFilesToUser failed:",A),v.failed.push({file:C,errorMessage:String(A?.message||A)})}s?.({phase:"progress",total:x,done:S+1,current:`${C}  ${E}`,fromFile:C,toFile:E})}return s?.({phase:"done",total:x,done:x,current:"",result:v}),this.clearCache(c),v},parseCSV(n){const t=new Map,s=n.split(/\r?\n/).filter(c=>c.trim());if(s.length===0)return t;if(s.some(c=>c.startsWith("D,")||c.startsWith('"D",')))for(let c of s){const u=[];let d="",p=!1;for(let j=0;j<c.length;j++){const N=c[j];N==='"'?p=!p:N===","&&!p?(u.push(d),d=""):d+=N}u.push(d);const f=u.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j));if(f[0]!=="D")continue;const m=f[1],y=f[8],v=f[14],x=f[18],S=f[20],C=String(v??"").trim(),E=hn(C);if(E&&x){const j=parseFloat(x);if(!isNaN(j)){const N={price:j,vendor:y,unit:S,dateStr:m,displayName:C};if(t.has(E)){const A=t.get(E);(m||"")>=(A?.dateStr||"")&&t.set(E,N)}else t.set(E,N)}}}else{let c={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(s[0].split(",").map(f=>f.trim().replace(/^"|"$/g,"")).forEach((f,m)=>{["","","","","name","item"].some(y=>f.includes(y))&&(c.name=m),["","","","","price","cost"].some(y=>f.includes(y))&&(c.price=m),["","unit"].some(y=>f.includes(y))&&(c.unit=m),["","","","vendor","supplier"].some(y=>f.includes(y))&&(c.vendor=m)}),c.name===-1&&c.price===-1){c={name:0,price:1,unit:2,vendor:3};const f=s[0].split(",");isNaN(parseFloat(f[1]))&&(u=1)}else u=1;const p=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let f=u;f<s.length;f++){const m=s[f],y=[];let v="",x=!1;for(let B=0;B<m.length;B++){const L=m[B];L==='"'?x=!x:L===","&&!x?(y.push(v),v=""):v+=L}y.push(v);const S=y.map(B=>(B=B.trim(),B.startsWith('"')&&B.endsWith('"')?B.slice(1,-1):B)),C=c.name>-1?S[c.name]:null,E=c.price>-1?S[c.price]:null,j=c.unit>-1?S[c.unit]:"",N=c.vendor>-1?S[c.vendor]:"",A=String(C??"").trim(),z=hn(A);if(z&&E){const B=parseFloat(E.replace(/[^0-9.]/g,""));isNaN(B)||t.set(z,{price:B,vendor:N,unit:j,dateStr:p,displayName:A})}}}return t},parseCSVEntries(n,t=""){const s=[],l=n.split(/\r?\n/).filter(x=>x.trim());if(l.length===0)return s;const c=x=>{const S=String(x??"").trim();if(!S)return null;const C=parseFloat(S.replace(/[^0-9.]/g,""));return Number.isFinite(C)?C:null},u=x=>{const S=[];let C="",E=!1;for(let j=0;j<x.length;j++){const N=x[j];N==='"'?E=!E:N===","&&!E?(S.push(C),C=""):C+=N}return S.push(C),S.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j))},d=x=>{const S=String(x??"").trim();if(!S)return"";const C=S.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(C)return`${C[1]}/${String(C[2]).padStart(2,"0")}/${String(C[3]).padStart(2,"0")}`;const E=S.match(/^(\d{4})(\d{2})(\d{2})$/);return E?`${E[1]}/${E[2]}/${E[3]}`:S};if(l.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of l){const S=u(x);if(S[0]!=="D")continue;const C=d(S[1]),E=S[8],j=S[14],N=S[18],A=c(S[19]),z=S[20],B=String(j??"").trim(),L=hn(B);if(!L||!N)continue;const _=c(N);Number.isFinite(_)&&s.push({key:L,displayName:B,price:_,vendor:E,unit:z,dateStr:C,incomingQty:A,sourceFile:t})}return s}let f={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},m=0;if(l[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,S)=>{const C=String(x||"").toLowerCase();["","","","","name","item"].some(E=>C.includes(E))&&(f.name=S),["","","","","price","cost"].some(E=>C.includes(E))&&(f.price=S),["","unit"].some(E=>C.includes(E))&&(f.unit=S),["","","","vendor","supplier"].some(E=>C.includes(E))&&(f.vendor=S),["","","","date"].some(E=>C.includes(E))&&(f.date=S),["","","","","","qty","quantity"].some(E=>C.includes(E))&&(f.quantity=S)}),f.name===-1&&f.price===-1){f={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=l[0].split(",");isNaN(parseFloat(x[1]))&&(m=1)}else m=1;const v=d(new Date().toISOString().slice(0,10));for(let x=m;x<l.length;x++){const S=u(l[x]),C=f.name>-1?S[f.name]:null,E=f.price>-1?S[f.price]:null,j=f.unit>-1?S[f.unit]:"",N=f.vendor>-1?S[f.vendor]:"",A=f.date>-1?S[f.date]:"",z=f.quantity>-1?c(S[f.quantity]):null,B=String(C??"").trim(),L=hn(B);if(!L||!E)continue;const _=c(E);Number.isFinite(_)&&s.push({key:L,displayName:B,price:_,vendor:N,unit:j,dateStr:d(A)||v,incomingQty:z,sourceFile:t})}return s},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._historyCacheByUserId.get(t);if(s)return s;try{const l=await this._downloadAllCsvTexts(t);if(!l||l.length===0)return new Map;const c=new Map;for(const{fileName:u,text:d}of l){if(!d)continue;this.parseCSVEntries(d,u).forEach(f=>{const m=f?.key;m&&(c.has(m)||c.set(m,[]),c.get(m).push(f))})}for(const u of c.values())u.sort((d,p)=>{const f=String(d?.dateStr||""),m=String(p?.dateStr||"");if(f!==m)return f.localeCompare(m);const y=Number(d?.price),v=Number(p?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(p?.sourceFile||""))});return this._historyCacheByUserId.set(t,c),c}catch(l){return console.error("Error in fetchPriceHistory:",l),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),s=[];for(const[l,c]of t.entries())if(c&&typeof c=="object"){const{displayName:u,...d}=c;s.push({name:u||l,...d})}else s.push({name:l,price:c});return s.sort((l,c)=>l.dateStr&&c.dateStr?c.dateStr.localeCompare(l.dateStr):l.name.localeCompare(c.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(hn(n))||null}},wo={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:s}=await De.rpc("search_ingredients",{search_query:n,max_results:15});return s?(console.warn(" Database search failed:",s),console.warn("Error message:",s.message),console.warn("Error code:",s.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){const t=String(n||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const s=t.toLowerCase(),l=hn(t);try{const c=await this._searchFromDatabase(s);if(c&&Array.isArray(c)){this._lastDbResults=c,this._lastDbQuery=s;const d=c.map(j=>({name:j.ingredient_name,price:j.last_price,size:j.packet_size,unit:j.packet_unit,itemCategory:j.item_category||null,source:"manual",displaySource:" "}));if(d.length===0)return await this._fallbackSearch(s);if(!this._csvCache){const j=await sr.getPriceListArray();this._csvCache=j.map(N=>({name:N.name,price:N.price,size:null,unit:N.unit,source:"csv",displaySource:" CSV"}))}const p=j=>{if(!l)return null;const N=String(j||"").indexOf(l);return N<0?null:{tier:j===l?0:N===0?1:2,idx:N,len:String(j||"").length}},f=(j,N)=>j.score.tier!==N.score.tier?j.score.tier-N.score.tier:j.score.idx!==N.score.idx?j.score.idx-N.score.idx:j.score.len!==N.score.len?j.score.len-N.score.len:j.name.localeCompare(N.name,"ja"),m=(j,N,A)=>{let z=0;for(;z<j.length&&f(j[z],N)<=0;)z++;j.splice(z,0,N),j.length>A&&j.pop()},v=Math.max(0,15-d.length),x=new Set(d.map(j=>hn(j.name))),S=[],C=new Set;if(v>0)for(const j of this._csvCache){const N=hn(j?.name);if(!N||x.has(N)||C.has(N))continue;const A=p(N);A&&(C.add(N),m(S,{...j,nameKey:N,score:A},v))}const E=S.map(j=>({name:j.name,price:j.price,size:j.size,unit:j.unit,source:j.source,displaySource:j.displaySource}));return[...d,...E]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",c);const u=await this._fallbackSearch(s);return console.log(" Fallback search returned:",u.length,"results"),u}catch(c){return console.error("Error searching ingredients:",c),[]}},async _fallbackSearch(n){try{const t=hn(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[f,m]=await Promise.all([sr.getPriceListArray(),qn.getAllConversions()]);console.log(" CSV Data rows:",f.length),console.log(" Manual Data items:",m.size);const y=Array.from(m.values()).map(C=>({name:C.ingredientName,price:C.lastPrice,size:C.packetSize,unit:C.packetUnit,itemCategory:C.itemCategory||null,source:"manual",displaySource:" "})),v=f.map(C=>({name:C.name,price:C.price,size:null,unit:C.unit,source:"csv",displaySource:" CSV"})),x=new Set(y.map(C=>C.name)),S=v.filter(C=>!x.has(C.name));this._csvCache=[...y,...S],console.log(" Cache built. Total items:",this._csvCache.length)}const s=f=>{if(!t)return null;const m=String(f||"").indexOf(t);return m<0?null:{tier:f===t?0:m===0?1:2,idx:m,len:String(f||"").length}},l=(f,m)=>f.score.tier!==m.score.tier?f.score.tier-m.score.tier:f.score.idx!==m.score.idx?f.score.idx-m.score.idx:f.score.len!==m.score.len?f.score.len-m.score.len:f.name.localeCompare(m.name,"ja"),c=(f,m,y)=>{let v=0;for(;v<f.length&&l(f[v],m)<=0;)v++;f.splice(v,0,m),f.length>y&&f.pop()},u=15,d=[],p=new Set;for(const f of this._csvCache){const m=hn(f?.name);if(!m||p.has(m))continue;const y=s(m);y&&(p.add(m),c(d,{...f,nameKey:m,score:y},u))}return d.map(f=>({name:f.name,price:f.price,size:f.size,unit:f.unit,itemCategory:f.itemCategory||null,source:f.source,displaySource:f.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},dp=({value:n,onChange:t,placeholder:s,disabled:l,onSelect:c})=>{const[u,d]=b.useState([]),[p,f]=b.useState(!1),[m,y]=b.useState(-1),v=b.useRef(null),x=b.useRef(null),[S,C]=b.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),E=b.useCallback(()=>{if(v.current){const L=v.current.getBoundingClientRect(),_=8,M=4,k=L.top-_,G=window.innerHeight-L.bottom-_,Q=(k>=180||k>=G)&&k>=110,P=Math.max(110,Math.min(280,Q?k-M:G-M)),F=L.left,q=Math.max(220,window.innerWidth-_*2),$=Math.min(Math.max(L.width,220),q),T=Math.min(Math.max(_,F),window.innerWidth-_-$);C({top:Q?L.top-M:L.bottom+M,left:T,width:$,maxHeight:P,placeAbove:Q})}},[]);b.useEffect(()=>{const L=k=>{v.current&&!v.current.contains(k.target)&&x.current&&!x.current.contains(k.target)&&f(!1)},_=k=>{x.current&&x.current.contains(k.target)||f(!1)},M=()=>{p&&E()};return document.addEventListener("mousedown",L),window.addEventListener("scroll",_,{capture:!0}),window.addEventListener("resize",M),()=>{document.removeEventListener("mousedown",L),window.removeEventListener("scroll",_,{capture:!0}),window.removeEventListener("resize",M)}},[p,E]),b.useEffect(()=>{p&&E()},[p,u,E]);const j=b.useRef(0),N=b.useRef(null),A=async L=>{const _=L.target.value;if(t(L),N.current&&clearTimeout(N.current),_.length===0){f(!1);return}N.current=setTimeout(async()=>{if(_.length>0){const M=++j.current;console.log(" AutocompleteInput: Fetching suggestions for:",_);const k=await wo.search(_);console.log(" AutocompleteInput: Got",k.length,"suggestions"),M===j.current&&(d(k),f(k.length>0),y(-1))}},150)},z=L=>{const _={target:{value:L.name}};t(_),f(!1),c&&c(L)},B=L=>{p&&(L.key==="ArrowDown"?(L.preventDefault(),y(_=>_<u.length-1?_+1:_)):L.key==="ArrowUp"?(L.preventDefault(),y(_=>_>0?_-1:-1)):L.key==="Enter"?m>=0&&(L.preventDefault(),z(u[m])):L.key==="Escape"&&f(!1))};return i.jsxs("div",{className:"autocomplete-wrapper",ref:v,children:[i.jsx("input",{type:"text",className:"input-field autocomplete-input",value:n,onChange:A,onKeyDown:B,onFocus:async()=>{if(n&&n.length>0){E();const L=await wo.search(n);d(L),f(L.length>0)}else E()},placeholder:s,disabled:l}),p&&Ha.createPortal(i.jsx("ul",{className:"suggestions-list",ref:x,style:{position:"fixed",top:`${S.top}px`,left:`${S.left}px`,width:`${S.width}px`,maxHeight:`${S.maxHeight}px`,transform:S.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:u.map((L,_)=>i.jsxs("li",{className:`suggestion-item ${_===m?"selected":""}`,onClick:()=>z(L),onMouseEnter:()=>y(_),children:[i.jsxs("div",{className:"suggestion-main",children:[i.jsx("span",{className:"suggestion-name",children:L.name}),L?.source&&L.source!=="manual"&&i.jsx("span",{className:"suggestion-source",children:L.displaySource})]}),i.jsxs("div",{className:"suggestion-details",children:[L.price&&`${Number(L.price).toLocaleString()}`,L.size&&` / ${L.size}${L.unit}`,!L.size&&L.unit&&` / ${L.unit}`]})]},`${L.source}-${_}`))}),document.body)]})},Px=({isOpen:n,onClose:t,onApply:s,ingredientName:l,currentCost:c,currentQuantity:u,unit:d="g",initialPurchaseCost:p,initialContentAmount:f})=>{const[m,y]=b.useState(""),[v,x]=b.useState(""),[S,C]=b.useState(d),[E,j]=b.useState(!1),[N,A]=b.useState(!1),z=b.useCallback(async()=>{if(A(!0),p&&f){y(p),x(f);const k=await qn.getConversion(l);C(k&&k.packetUnit||d)}else{const k=await qn.getConversion(l);if(k)x(k.packetSize),C(k.packetUnit||d),k.lastPrice&&y(k.lastPrice);else try{const G=await sr.getPrice(l);if(G)if(y(c||G.price),G.unit){const V=G.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(V){let Q=V[1]?parseFloat(V[1]):1,P=V[2]?V[2].trim().toLowerCase():"";P==="kg"?(Q*=1e3,P="g"):P==="l"?(Q*=1e3,P="ml"):P==="pk"||P==="pack"?P="":P==="bag"?P="":(P==="pc"||P==="pcs")&&(P=""),x(Q),C(P||d)}else x(1),C(G.unit)}else x(""),C(d);else x(""),y(c||""),C(d)}catch(G){console.warn("Failed to load master price:",G),x(""),y(c||""),C(d)}}A(!1)},[l,p,f,d,c]);b.useEffect(()=>{if(!n||!l)return;const k=setTimeout(()=>{z()},0);return()=>clearTimeout(k)},[n,l,z]);const B=()=>{const k=parseFloat(m),G=parseFloat(v);return!k||!G?0:["g","ml","cc"].includes(S)?k/G*1e3:k/G},L=async()=>{const k=B();if(E&&v)try{await qn.saveConversion(l,v,S,m)}catch(G){console.error("Failed to save default conversion:",G)}s(k,S,m,v),t()};if(!n)return null;const _=B(),M=u?_*(u/(["g","ml"].includes(d)?1e3:1)):0;return i.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:i.jsx("div",{className:"unit-conversion-modal__card",onClick:k=>k.stopPropagation(),children:i.jsxs("div",{className:"unit-conversion-modal__body",children:[i.jsx("h3",{className:"unit-conversion-modal__title",children:""}),i.jsxs("div",{className:"unit-conversion-modal__field",children:[i.jsx("span",{className:"unit-conversion-modal__label",children:""}),i.jsx("div",{className:"unit-conversion-modal__value",children:l||"()"})]}),i.jsxs("div",{className:"unit-conversion-modal__inputs",children:[i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),i.jsx("input",{type:"number",value:m,onChange:k=>y(k.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:""}),i.jsxs("div",{className:"unit-conversion-modal__row",children:[i.jsx("input",{type:"number",value:v,onChange:k=>x(k.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),i.jsxs("select",{value:S,onChange:k=>C(k.target.value),className:"unit-conversion-modal__select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:"p"}),i.jsx("option",{value:"cc",children:"cc"}),!["g","ml","","","","","","cc"].includes(S)&&i.jsx("option",{value:S,children:S})]})]})]})]}),i.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:N?i.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[i.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),i.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(_).toLocaleString()]})]}),u&&i.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[i.jsxs("span",{children:[" (",u,d,"):"]}),i.jsxs("span",{children:["",Math.round(M).toLocaleString()]})]})]})}),i.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[i.jsx("input",{type:"checkbox",id:"saveDefault",checked:E,onChange:k=>j(k.target.checked)}),i.jsxs("span",{children:["(",v,S,")"]})]}),i.jsxs("div",{className:"unit-conversion-modal__actions",children:[i.jsx(fe,{type:"button",variant:"secondary",onClick:t,disabled:N,children:""}),i.jsx(fe,{type:"button",variant:"primary",onClick:L,disabled:!m||!v||N,children:""})]})]})})})},pN=new Set(["food","alcohol","soft_drink","supplies"]),mN=new Set(["alcohol","supplies"]),Hx={food:"",alcohol:"",soft_drink:"",supplies:""},fi=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":pN.has(t)?t:"":""},zu=n=>mN.has(n),vf=(n,t)=>{const s=fi(t);return s?{...n,itemCategory:s,isAlcohol:zu(s)}:{...n,itemCategory:null}},Gn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},Pf=n=>{const t=Gn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},zi=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return Pf(s)/100},gN=(n,t,s)=>{const l=Gn(n),c=Gn(t);if(!Number.isFinite(l)||!Number.isFinite(c)||c<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/c*1e3:(["kg","","l",""].includes(u),l/c)},o0=(n,t,s,l=!1,c=1)=>{const u=Gn(n),d=Gn(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const p=Number.isFinite(c)&&c>0?c:1;if(l)return u/1e3*d/p;const f=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(f)||!f?u/1e3*d/p:u*d/p},yN=(n,t)=>{const s=Gn(n?.purchaseCost),l=Gn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},c0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Lr=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=c0(t);if(!l)return null;for(const[c,u]of n.entries())if(c0(c)===l)return u;return null},vN=({formData:n,setFormData:t})=>{const[s,l]=b.useState(new Map),[c,u]=b.useState({isOpen:!1,type:null,index:null}),[d,p]=b.useState(new Map);b.useEffect(()=>{(async()=>{const[M,k]=await Promise.all([sr.fetchPriceList(),qn.getAllConversions()]);l(M),p(k)})()},[]);const m=(_=>_.reduce((M,k)=>M+(parseFloat(k.quantity)||0),0))(n.flours||[]),y=_=>!m||m===0?0:((parseFloat(_)||0)/m*100).toFixed(1);b.useEffect(()=>{if(d.size===0)return;const _=(G=[])=>{let V=!1;return{adjusted:G.map(P=>{if(!P||typeof P!="object")return P;const F=Lr(d,P.name);let q=P;const $=fi(P.itemCategory??P.item_category??F?.itemCategory);if($){const ye=zu($);(fi(P.itemCategory??P.item_category)!==$||!!P.isAlcohol!==ye)&&(q={...q,itemCategory:$,isAlcohol:ye})}const T=zi(P,F),I=o0(P.quantity,q.purchaseCost,P.unit,!0,T),Y=Number.isFinite(I)?Math.round(I*100)/100:NaN,ae=Gn(q.cost);if(Number.isFinite(Y)&&(!Number.isFinite(ae)||Math.abs(ae-Y)>.01)&&(q={...q,cost:Y}),F&&F.packetSize){const U=[F.lastPrice,P.purchaseCostRef,P.purchase_cost,P.purchaseCost].find(Z=>Number.isFinite(Gn(Z))),W=gN(U,F.packetSize,F.packetUnit);if(Number.isFinite(W)&&yN(P,W)){const Z=zi(P,F),ce=Math.round(W*100)/100,Oe=o0(P.quantity,ce,P.unit,!0,Z),Se=Number.isFinite(Oe)?Math.round(Oe*100)/100:q.cost,Re=Gn(q.purchaseCost),O=Gn(q.cost),ie=!Number.isFinite(Re)||Math.abs(Re-ce)>.01,de=Number.isFinite(Gn(Se))&&(!Number.isFinite(O)||Math.abs(O-Se)>.01);(ie||de)&&(q={...q,purchaseCost:ce,cost:Se})}}return q!==P&&(V=!0),q}),changed:V}},M=_(n.flours||[]),k=_(n.breadIngredients||[]);!M.changed&&!k.changed||t(G=>({...G,flours:M.adjusted,breadIngredients:k.adjusted}))},[d,n.breadIngredients,n.flours,t]);const v=(_,M,k)=>{const G=[...n.flours||[]];if(G[_]={...G[_],[M]:k},M==="name"){const V=s.get(hn(k));if(V){const Q=typeof V=="object"?V.price:V,P=typeof V=="object"?V.vendor:null,F=typeof V=="object"?V.unit:null;G[_].purchaseCostRef=Q,G[_].vendorRef=P;const q=Lr(d,k);if(q&&q.packetSize){let T=0;const I=q.lastPrice!==null&&q.lastPrice!==void 0&&q.lastPrice!==""?q.lastPrice:Q,Y=(q.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?T=I/q.packetSize*1e3:["kg",""].includes(Y)?T=I/q.packetSize:["ml","","cc",""].includes(Y)?T=I/q.packetSize*1e3:(["l",""].includes(Y),T=I/q.packetSize),G[_].purchaseCost=Math.round(T*100)/100,G[_].unit="g"}else G[_].purchaseCost||(G[_].purchaseCost=Q,!G[_].unit&&F&&(G[_].unit=F));const $=fi(q?.itemCategory);$?G[_]=vf(G[_],$):G[_].itemCategory=null}else G[_].purchaseCostRef=null,G[_].vendorRef=null,G[_].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(M)||M==="name"){const V=G[_],Q=parseFloat(V.quantity),P=parseFloat(V.purchaseCost);if(!isNaN(Q)&&!isNaN(P)){let F=0;const q=(V.unit||"").trim().toLowerCase();q==="g"||q===""||q==="ml"||q===""||q==="cc"||q===""||!q?F=Q/1e3*P:F=Q*P;const $=Lr(d,V.name),T=zi(V,$),I=Number.isFinite(T)&&T>0?T:1,Y=Math.round(F/I*100)/100;Y!==V.cost&&(G[_].cost=Y)}}t(V=>({...V,flours:G}))},x=(_,M,k)=>{const G=[...n.breadIngredients||[]];if(G[_]={...G[_],[M]:k},M==="name"){const V=s.get(hn(k));if(V){const Q=typeof V=="object"?V.price:V,P=typeof V=="object"?V.vendor:null,F=typeof V=="object"?V.unit:null;G[_].purchaseCostRef=Q,G[_].vendorRef=P;const q=Lr(d,k);if(q&&q.packetSize){let T=0;const I=q.lastPrice!==null&&q.lastPrice!==void 0&&q.lastPrice!==""?q.lastPrice:Q,Y=(q.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?(T=I/q.packetSize*1e3,G[_].unit="g"):["kg",""].includes(Y)?(T=I/q.packetSize,G[_].unit="g"):["ml","","cc",""].includes(Y)?(T=I/q.packetSize*1e3,G[_].unit="ml"):["l",""].includes(Y)?(T=I/q.packetSize,G[_].unit="ml"):(T=I/q.packetSize,G[_].unit=q.packetUnit),G[_].purchaseCost=Math.round(T*100)/100}else G[_].purchaseCost||(G[_].purchaseCost=Q,!G[_].unit&&F&&(G[_].unit=F));const $=fi(q?.itemCategory);$?G[_]=vf(G[_],$):G[_].itemCategory=null}else G[_].purchaseCostRef=null,G[_].vendorRef=null,G[_].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(M)||M==="name"){const V=G[_],Q=parseFloat(V.quantity),P=parseFloat(V.purchaseCost);if(!isNaN(Q)&&!isNaN(P)){let F=0;const q=V.unit?V.unit.trim().toLowerCase():"g";q==="g"||q===""||q==="ml"||q===""||q==="cc"||q===""?F=Q/1e3*P:F=Q*P;const $=Lr(d,V.name),T=zi(V,$),I=Number.isFinite(T)&&T>0?T:1,Y=Math.round(F/I*100)/100;Y!==V.cost&&(G[_].cost=Y)}}t(V=>({...V,breadIngredients:G}))},S=()=>{t(_=>({..._,flours:[..._.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},C=()=>{t(_=>({..._,breadIngredients:[..._.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},E=_=>{t(M=>({...M,flours:M.flours.filter((k,G)=>G!==_)}))},j=_=>{t(M=>({...M,breadIngredients:M.breadIngredients.filter((k,G)=>G!==_)}))},N=Ja(gr(To,{activationConstraint:{distance:10}}),gr(ko,{activationConstraint:{delay:250,tolerance:5}}),gr(el,{coordinateGetter:Au})),A=_=>{const{active:M,over:k}=_;M.id!==k.id&&t(G=>{const Q=G.flours.some(q=>q.id===M.id)?"flours":"breadIngredients",P=G[Q].findIndex(q=>q.id===M.id),F=G[Q].findIndex(q=>q.id===k.id);return P!==-1&&F!==-1?{...G,[Q]:Gi(G[Q],P,F)}:G})};b.useEffect(()=>{if(!n.flours)t(_=>({..._,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const _=n.flours.map(M=>M.id?M:{...M,id:crypto.randomUUID()});JSON.stringify(_)!==JSON.stringify(n.flours)&&t(M=>({...M,flours:_}))}if(!n.breadIngredients)t(_=>({..._,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const _=n.breadIngredients.map(M=>M.id?M:{...M,id:crypto.randomUUID()});JSON.stringify(_)!==JSON.stringify(n.breadIngredients)&&t(M=>({...M,breadIngredients:_}))}},[]);const z=(_,M,k,G)=>{const{type:V,index:Q}=c;t(P=>{if(V==="flour"){const F=[...P.flours],q={...F[Q],purchaseCost:_,unit:M,purchase_cost:k,content_amount:G},$=parseFloat(q.quantity),T=parseFloat(_);if(!isNaN($)&&!isNaN(T)){let I=0;M==="g"||M===""?I=$/1e3*T:I=$*T;const Y=Lr(d,q.name),ae=zi(q,Y),ye=Number.isFinite(ae)&&ae>0?ae:1;q.cost=Math.round(I/ye*100)/100}return F[Q]=q,qn.getAllConversions().then(I=>p(I)),wo.invalidateCache(),{...P,flours:F}}else if(V==="ingredient"){const F=[...P.breadIngredients],q={...F[Q],purchaseCost:_,unit:M,purchase_cost:k,content_amount:G},$=parseFloat(q.quantity),T=parseFloat(_);if(!isNaN($)&&!isNaN(T)){let I=0;M==="g"||M===""?I=$/1e3*T:I=$*T;const Y=Lr(d,q.name),ae=zi(q,Y),ye=Number.isFinite(ae)&&ae>0?ae:1;q.cost=Math.round(I/ye*100)/100}return F[Q]=q,qn.getAllConversions().then(I=>p(I)),wo.invalidateCache(),{...P,breadIngredients:F}}return P})},B=(_,M,k)=>{k&&t(G=>{const V=_==="flour"?"flours":"breadIngredients",Q=[...G[V]||[]],P={...Q[M]};if(P.name=k.name,P.itemCategory=null,k.price!==void 0&&k.price!==null&&k.price!==""){P.purchaseCostRef=k.price,P.vendorRef=k.source==="csv"?"CSV":"Master";let T=k.price,I=k.unit;if(k.source==="manual")if(k.size&&k.size>0){const Y=(k.unit||"").trim().toLowerCase();["g",""].includes(Y)?(T=k.price/k.size*1e3,I="g"):["kg",""].includes(Y)?(T=k.price/k.size,I="g"):["ml","","cc",""].includes(Y)?(T=k.price/k.size*1e3,I="ml"):["l",""].includes(Y)?(T=k.price/k.size,I="ml"):(T=k.price/k.size,I=k.unit)}else T=k.price,I=k.unit;else{const Y=Lr(d,k.name);if(Y&&Y.packetSize){const ae=Y.lastPrice!==null&&Y.lastPrice!==void 0&&Y.lastPrice!==""?Y.lastPrice:k.price,ye=(Y.packetUnit||"").trim().toLowerCase();["g",""].includes(ye)?(T=ae/Y.packetSize*1e3,I="g"):["kg",""].includes(ye)?(T=ae/Y.packetSize,I="g"):["ml","","cc",""].includes(ye)?(T=ae/Y.packetSize*1e3,I="ml"):["l",""].includes(ye)?(T=ae/Y.packetSize,I="ml"):(T=ae/Y.packetSize,I=Y.packetUnit)}else T=k.price,I=k.unit}P.purchaseCost=Math.round(T*100)/100,_==="flour"?P.unit="g":I&&(P.unit=I)}const F=fi(k.itemCategory??k.item_category??Lr(d,k.name)?.itemCategory);if(F){const T=vf(P,F);Object.assign(P,T)}const q=parseFloat(P.quantity),$=parseFloat(P.purchaseCost);if(!isNaN(q)&&!isNaN($)){const T=Lr(d,P.name),I=zi(P,T),Y=Number.isFinite(I)&&I>0?I:1,ae=(P.unit||"").trim().toLowerCase();let ye=0;ae==="g"||ae===""||ae==="ml"||ae===""||ae==="cc"||ae===""?ye=q/1e3*$:ye=q*$,P.cost=Math.round(ye/Y*100)/100}return Q[M]=P,{...G,[V]:Q}})},L=c.isOpen&&c.index!==null?c.type==="flour"?n.flours[c.index]:n.breadIngredients[c.index]:null;return i.jsxs("div",{className:"bread-form",children:[i.jsxs(xn,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[i.jsxs("div",{className:"bread-header",children:[i.jsxs("h3",{children:[" (Total: ",m,"g)"]}),i.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Fi,{sensors:N,collisionDetection:Ef,onDragEnd:A,id:"flours-dnd",children:i.jsx(Ka,{items:n.flours||[],strategy:po,children:(n.flours||[]).map((_,M)=>{const k=Lr(d,_?.name),G=Pf(k?.yieldPercent??k?.yield_percent??_?.yieldPercent??_?.yield_percent);return i.jsx(xN,{id:_.id,index:M,item:_,yieldPercentApplied:G,onChange:v,onRemove:E,onSelect:B,calculatePercentage:y,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:M})},_.id)})})})})]}),i.jsx(fe,{type:"button",variant:"secondary",size:"sm",onClick:S,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsxs(xn,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[i.jsxs("div",{className:"bread-header",children:[i.jsx("h3",{children:""}),i.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Fi,{sensors:N,collisionDetection:Ef,onDragEnd:A,id:"breadIngredients-dnd",children:i.jsx(Ka,{items:n.breadIngredients||[],strategy:po,children:(n.breadIngredients||[]).map((_,M)=>{const k=Lr(d,_?.name),G=Pf(k?.yieldPercent??k?.yield_percent??_?.yieldPercent??_?.yield_percent);return i.jsx(bN,{id:_.id,index:M,item:_,yieldPercentApplied:G,onChange:x,onRemove:j,onSelect:B,calculatePercentage:y,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:M})},_.id)})})})})]}),i.jsx(fe,{type:"button",variant:"secondary",size:"sm",onClick:C,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:i.jsx(fe,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),i.jsx(Px,{isOpen:c.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:z,ingredientName:L?.name||"",currentCost:L?.purchaseCost,currentQuantity:L?.quantity,unit:L?.unit||"g",initialPurchaseCost:L?.purchase_cost,initialContentAmount:L?.content_amount})]})},xN=({id:n,index:t,item:s,yieldPercentApplied:l,onChange:c,onRemove:u,onSelect:d,calculatePercentage:p,floursLength:f,onOpenConversion:m})=>{const y=fi(s.itemCategory??s.item_category),v=!!y,x=Hx[y]||"",S=v?`${x}${zu(y)?"10%":"8%"}`:"",{attributes:C,listeners:E,setNodeRef:j,transform:N,transition:A,isDragging:z}=tl({id:n}),B={transform:Rr.Transform.toString(N),transition:A,opacity:z?.5:1,position:"relative",zIndex:z?999:"auto"};return i.jsxs("div",{ref:j,style:B,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{...C,...E,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(dp,{value:s.name,onChange:L=>c(t,"name",L.target.value),onSelect:L=>d("flour",t,L),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(Mt,{type:"number",step:"any",value:s.quantity,onChange:L=>c(t,"quantity",L.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[p(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(Mt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:L=>c(t,"purchaseCost",L.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:m,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(Mt,{type:"number",step:"any",value:s.cost||"",onChange:L=>c(t,"cost",L.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Gn(l))&&Gn(l)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const L=Gn(l),_=Math.round(L*10)/10;return`${Number.isInteger(_)?Math.round(_):_}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:L=>c(t,"isAlcohol",L.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${S}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:f>1&&i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},bN=({id:n,index:t,item:s,yieldPercentApplied:l,onChange:c,onRemove:u,onSelect:d,calculatePercentage:p,onOpenConversion:f})=>{const m=fi(s.itemCategory??s.item_category),y=!!m,v=Hx[m]||"",x=y?`${v}${zu(m)?"10%":"8%"}`:"",{attributes:S,listeners:C,setNodeRef:E,transform:j,transition:N,isDragging:A}=tl({id:n}),z={transform:Rr.Transform.toString(j),transition:N,opacity:A?.5:1,position:"relative",zIndex:A?999:"auto"};return i.jsxs("div",{ref:E,style:z,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{...S,...C,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(dp,{value:s.name,onChange:B=>c(t,"name",B.target.value),onSelect:B=>d("ingredient",t,B),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(Mt,{type:"number",step:"any",value:s.quantity,onChange:B=>c(t,"quantity",B.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[p(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(Mt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:B=>c(t,"purchaseCost",B.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(Mt,{type:"number",step:"any",value:s.cost||"",onChange:B=>c(t,"cost",B.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Gn(l))&&Gn(l)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const B=Gn(l),L=Math.round(B*10)/10;return`${Number.isInteger(L)?Math.round(L):L}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:B=>c(t,"isAlcohol",B.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},wN=new Set(["food","alcohol","soft_drink","supplies"]),SN=new Set(["alcohol","supplies"]),jN={food:"",alcohol:"",soft_drink:"",supplies:""},Ga=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":wN.has(t)?t:"":""},xu=n=>SN.has(n),u0=(n,t)=>{const s=Ga(t);return s?{...n,itemCategory:s,isAlcohol:xu(s)}:{...n,itemCategory:null}},d0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Cs=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=d0(t);if(!l)return null;for(const[c,u]of n.entries())if(d0(c)===l)return u;return null},ir=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},Fx=n=>{const t=ir(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Ua=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return Fx(s)/100},_N=(n,t,s)=>{const l=ir(n),c=ir(t);if(!Number.isFinite(l)||!Number.isFinite(c)||c<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/c*1e3:(["kg","","l",""].includes(u),l/c)},xf=(n,t,s,l=1)=>{const c=ir(n),u=ir(t);if(!Number.isFinite(c)||!Number.isFinite(u))return NaN;const d=String(s||"").trim().toLowerCase();let p=0;["g","","ml","","cc",""].includes(d)?p=c/1e3*u:p=c*u;const f=Number.isFinite(l)&&l>0?l:1;return p/f},CN=(n,t)=>{const s=ir(n?.purchaseCost),l=ir(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},EN=Ue.memo(({id:n,index:t,item:s,groupId:l,yieldPercentApplied:c,onChange:u,onRemove:d,handleSuggestionSelect:p,onOpenConversion:f})=>{const m=Ga(s.itemCategory??s.item_category),y=!!m,v=jN[m]||"",x=y?`${v}${xu(m)?"10%":"8%"}`:"",S=y?xu(m):!!s.isAlcohol,{attributes:C,listeners:E,setNodeRef:j,transform:N,transition:A,isDragging:z}=tl({id:n,data:{groupId:l,index:t}}),B={transform:Rr.Translate.toString(N),transition:A,opacity:z?.3:1,position:"relative",zIndex:z?999:"auto"};return i.jsxs("div",{ref:j,style:B,className:"form-ingredient-row",children:[i.jsx("div",{...C,...E,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(dp,{value:s.name,onChange:L=>u(l,t,"name",L.target.value),onSelect:L=>p(l,t,L),placeholder:""})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(Mt,{value:s.quantity,onChange:L=>u(l,t,"quantity",L.target.value),placeholder:"0",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsx("div",{className:"ingredient-unit",children:i.jsx(Mt,{value:s.unit,onChange:L=>u(l,t,"unit",L.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(Mt,{type:"number",value:s.purchaseCost,onChange:L=>u(l,t,"purchaseCost",L.target.value),step:"0.01",placeholder:s.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},title:s.purchaseCostRef?`: ${s.purchaseCostRef}${s.vendorRef?` (${s.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",s.purchaseCostRef]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(Mt,{type:"number",step:"0.01",value:s.cost,onChange:L=>u(l,t,"cost",L.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(ir(c))&&ir(c)<99.999&&i.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const L=ir(c),_=Math.round(L*10)/10;return`${Number.isInteger(_)?Math.round(_):_}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:S,onChange:L=>u(l,t,"isAlcohol",L.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(l,t),children:""})})]})},(n,t)=>n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),NN=({section:n,sections:t,onSectionChange:s,onRemoveSection:l,children:c})=>{const{setNodeRef:u}=Oo({id:n.id});return i.jsxs(xn,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(Mt,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>l(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[i.jsx("span",{}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[c,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},RN=({formData:n,setFormData:t,priceList:s})=>{const[l,c]=b.useState(new Map);b.useEffect(()=>{qn.getAllConversions().then(B=>c(B))},[]);const[u,d]=b.useState({isOpen:!1,groupId:null,index:null});b.useEffect(()=>{if(!n.ingredientSections){const B=n.ingredientGroups||[{id:"default",name:""}],L=n.ingredients||[],_=B.map(G=>({id:G.id,name:G.name,items:L.filter(V=>G.id==="default"&&!V.groupId?!0:V.groupId===G.id)})),M=new Set(_.flatMap(G=>G.items.map(V=>V.id))),k=L.filter(G=>!M.has(G.id));k.length>0&&(_.length>0?_[0].items.push(...k):_.push({id:"default",name:"",items:k})),_.length===0&&_.push({id:crypto.randomUUID(),name:"",items:[]}),t(G=>({...G,ingredientSections:_}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const p=n.ingredientSections||[];b.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||l.size===0)return;let B=!1;const L=n.ingredientSections.map(_=>{const M=_.items.map(k=>{if(!k||typeof k!="object")return k;const G=Cs(l,k.name);let V=k;const Q=Ga(k.itemCategory??k.item_category??G?.itemCategory);if(Q){const F=xu(Q);(Ga(k.itemCategory??k.item_category)!==Q||!!k.isAlcohol!==F)&&(V={...V,itemCategory:Q,isAlcohol:F})}if(G&&G.packetSize){const q=[G.lastPrice,k.purchaseCostRef,k.purchase_cost,k.purchaseCost].find(T=>Number.isFinite(ir(T))),$=_N(q,G.packetSize,G.packetUnit);if(Number.isFinite($)&&CN(k,$)){const T=Ua(k,G),I=Math.round($*100)/100,Y=xf(k.quantity,I,k.unit,T),ae=Number.isFinite(Y)?Math.round(Y*100)/100:V.cost,ye=ir(V.purchaseCost),U=ir(V.cost),W=!Number.isFinite(ye)||Math.abs(ye-I)>.01,Z=Number.isFinite(ir(ae))&&(!Number.isFinite(U)||Math.abs(U-ae)>.01);(W||Z)&&(V={...V,purchaseCost:I,cost:ae})}}const P=Ua(k,G);if(Number.isFinite(P)&&P>0&&Math.abs(P-1)>1e-4){const F=xf(k.quantity,V.purchaseCost,k.unit,P),q=xf(k.quantity,V.purchaseCost,k.unit,1),$=ir(V.cost);if(Number.isFinite(F)&&(!Number.isFinite($)||Number.isFinite(q)&&Math.abs($-q)<=.01)){const I=Math.round(F*100)/100,Y=ir(V.cost);(!Number.isFinite(Y)||Math.abs(Y-I)>.01)&&(V={...V,cost:I})}}return V!==k&&(B=!0),V});return M!==_.items?{..._,items:M}:_});B&&t(_=>({..._,ingredientSections:L}))},[l,n.ingredientSections,t]);const f=Ja(gr(To,{activationConstraint:{distance:10}}),gr(ko,{activationConstraint:{delay:250,tolerance:5}}),gr(el,{coordinateGetter:Au})),m=({active:B,over:L})=>{if(!L)return;const _=B.id,M=L.id,k=p.find(V=>V.items.some(Q=>Q.id===_)),G=p.find(V=>V.items.some(Q=>Q.id===M))||p.find(V=>V.id===M);!k||!G||k===G||t(V=>{const Q=k.items,P=G.items,F=Q.findIndex(T=>T.id===_),q=P.findIndex(T=>T.id===M);let $;if(M===G.id)$=P.length+1;else{const I=L&&B.rect.current.translated&&B.rect.current.translated.top>L.rect.top+L.rect.height?1:0;$=q>=0?q+I:P.length+1}return{...V,ingredientSections:V.ingredientSections.map(T=>T.id===k.id?{...T,items:Q.filter(I=>I.id!==_)}:T.id===G.id?{...T,items:[...P.slice(0,$),Q[F],...P.slice($,P.length)]}:T)}})},y=({active:B,over:L})=>{if(!L)return;const _=B.id,M=L.id,k=p.find(V=>V.items.some(Q=>Q.id===_)),G=p.find(V=>V.items.some(Q=>Q.id===M))||p.find(V=>V.id===M);if(k&&G&&k===G){const V=k.items.findIndex(P=>P.id===_),Q=G.items.findIndex(P=>P.id===M);V!==Q&&t(P=>({...P,ingredientSections:P.ingredientSections.map(F=>F.id===k.id?{...F,items:Gi(F.items,V,Q)}:F)}))}},v=(B,L,_,M)=>{const{groupId:k,index:G}=u;k!==null&&G!==null&&t(V=>{const Q=V.ingredientSections.map(P=>{if(P.id!==k)return P;const F=[...P.items],q={...F[G],purchaseCost:B,unit:L,purchase_cost:_,content_amount:M},$=parseFloat(q.quantity),T=parseFloat(B);if(!isNaN($)&&!isNaN(T)){const I=Cs(l,q.name),Y=Ua(q,I),ae=L?L.trim().toLowerCase():"";let ye=0;ae==="g"||ae===""||ae==="ml"||ae===""||ae==="cc"||ae===""?ye=$/1e3*T:ye=$*T;const U=Number.isFinite(Y)&&Y>0?Y:1;q.cost=Math.round(ye/U*100)/100}return F[G]=q,{...P,items:F}});return qn.getAllConversions().then(P=>c(P)),wo.invalidateCache(),{...V,ingredientSections:Q}})},x=u.isOpen&&u.groupId!==null&&u.index!==null?p.find(B=>B.id===u.groupId)?.items[u.index]:null,S=Ue.useCallback((B,L,_,M)=>{t(k=>{const G=k.ingredientSections.map(V=>{if(V.id!==B)return V;const Q=[...V.items],P={...Q[L],[_]:M};if(Q[L]=P,["quantity","purchaseCost","unit","name","isAlcohol"].includes(_)){const F=parseFloat(P.quantity),q=parseFloat(P.purchaseCost),$=Cs(l,P.name),T=Ua(P,$),I=Number.isFinite(T)&&T>0?T:1;if(!isNaN(F)&&!isNaN(q)){let Y=0;const ae=P.unit?P.unit.trim().toLowerCase():"";ae==="g"||ae===""||ae==="ml"||ae===""||ae==="cc"||ae===""?Y=F/1e3*q:Y=F*q;const ye=Math.round(Y/I*100)/100;ye!==P.cost&&(P.cost=ye,Q[L]=P)}}if(_==="name"){const F=s.get(hn(M)),q=Cs(l,M),$=Ga(q?.itemCategory);if($){const T=u0(P,$);Object.assign(P,T)}else F||(P.itemCategory=null);if(F){const T=typeof F=="object"?F.price:F,I=typeof F=="object"?F.vendor:null,Y=typeof F=="object"?F.unit:null,ae=typeof F=="object"?F.size:null;if(P.purchaseCostRef=T,P.vendorRef=I,q&&q.packetSize){const W=q.lastPrice!==null&&q.lastPrice!==void 0&&q.lastPrice!==""?q.lastPrice:T;let Z=0;const ce=(q.packetUnit||"").trim().toLowerCase();["g",""].includes(ce)?(Z=W/q.packetSize*1e3,P.unit="g"):["kg",""].includes(ce)?(Z=W/q.packetSize,P.unit="g"):["ml","","cc",""].includes(ce)?(Z=W/q.packetSize*1e3,P.unit="ml"):["l",""].includes(ce)?(Z=W/q.packetSize,P.unit="ml"):(Z=W/q.packetSize,P.unit=q.packetUnit),P.purchaseCost=Math.round(Z*100)/100}else{let W=T,Z=Y;ae&&ae>1&&(["g",""].includes((Y||"").toLowerCase())?(W=T/ae*1e3,Z="g"):["ml","","cc",""].includes((Y||"").toLowerCase())?(W=T/ae*1e3,Z="ml"):["kg",""].includes(Y?Y.toLowerCase():"")?(W=T/ae,Z="g"):["l",""].includes(Y?Y.toLowerCase():"")?(W=T/ae,Z="ml"):W=T/ae),P.purchaseCost||(P.purchaseCost=Math.round(W*100)/100),!P.unit&&Z&&(P.unit=Z)}const ye=parseFloat(P.quantity),U=parseFloat(P.purchaseCost);if(!isNaN(ye)&&!isNaN(U)){const W=Cs(l,P.name),Z=Ua(P,W),ce=Number.isFinite(Z)&&Z>0?Z:1,Oe=P.unit?P.unit.trim().toLowerCase():"";let Se=0;Oe==="g"||Oe===""||Oe==="ml"||Oe===""||Oe==="cc"||Oe===""?Se=ye/1e3*U:Se=ye*U,P.cost=Math.round(Se/ce*100)/100}}else P.purchaseCostRef=null,P.vendorRef=null;Q[L]=P}return{...V,items:Q}});return{...k,ingredientSections:G}})},[l,s,t]),C=Ue.useCallback((B,L,_)=>{t(M=>{const k=M.ingredientSections.map(G=>{if(G.id!==B)return G;const V=[...G.items],Q={...V[L]};if(Q.name=_.name,Q.itemCategory=null,_.price)if(Q.purchaseCostRef=_.price,Q.vendorRef=_.source==="csv"?"CSV":"Master",_.source==="manual")if(_.size&&_.size>0){const $=(_.unit||"").trim().toLowerCase();if(["g",""].includes($)){const T=_.price/_.size*1e3;Q.purchaseCost=Math.round(T*100)/100,Q.unit="g"}else if(["kg",""].includes($)){const T=_.price/_.size;Q.purchaseCost=Math.round(T*100)/100,Q.unit="g"}else if(["ml","","cc",""].includes($)){const T=_.price/_.size*1e3;Q.purchaseCost=Math.round(T*100)/100,Q.unit="ml"}else if(["l",""].includes($)){const T=_.price/_.size;Q.purchaseCost=Math.round(T*100)/100,Q.unit="ml"}else{const T=_.price/_.size;Q.purchaseCost=Math.round(T*100)/100,Q.unit=_.unit}}else Q.purchaseCost=_.price,Q.unit=_.unit;else{const $=Cs(l,_.name);if($&&$.packetSize){const T=$.lastPrice!==null&&$.lastPrice!==void 0&&$.lastPrice!==""?$.lastPrice:_.price;let I=0;const Y=($.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?(I=T/$.packetSize*1e3,Q.unit="g"):["kg",""].includes(Y)?(I=T/$.packetSize,Q.unit="g"):["ml","","cc",""].includes(Y)?(I=T/$.packetSize*1e3,Q.unit="ml"):["l",""].includes(Y)?(I=T/$.packetSize,Q.unit="ml"):(I=T/$.packetSize,Q.unit=$.packetUnit),Q.purchaseCost=Math.round(I*100)/100}else Q.purchaseCost=_.price,Q.unit=_.unit}const P=Ga(_.itemCategory??_.item_category??Cs(l,_.name)?.itemCategory);if(P){const $=u0(Q,P);Object.assign(Q,$)}const F=parseFloat(Q.quantity),q=parseFloat(Q.purchaseCost);if(!isNaN(F)&&!isNaN(q)){const $=Cs(l,Q.name),T=Ua(Q,$),I=Number.isFinite(T)&&T>0?T:1,Y=Q.unit?Q.unit.trim().toLowerCase():"";let ae=0;Y==="g"||Y===""||Y==="ml"||Y===""||Y==="cc"||Y===""?ae=F/1e3*q:ae=F*q,Q.cost=Math.round(ae/I*100)/100}return V[L]=Q,{...G,items:V}});return{...M,ingredientSections:k}})},[l,t]),E=Ue.useCallback((B,L)=>{t(_=>({..._,ingredientSections:_.ingredientSections.map(M=>M.id===B?{...M,items:M.items.filter((k,G)=>G!==L)}:M)}))},[t]),j=B=>{const L={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(_=>({..._,ingredientSections:_.ingredientSections.map(M=>M.id===B?{...M,items:[...M.items,L]}:M)}))},N=()=>{t(B=>({...B,ingredientSections:[...B.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},A=B=>{t(L=>({...L,ingredientSections:L.ingredientSections.filter(_=>_.id!==B)}))},z=(B,L)=>{t(_=>({..._,ingredientSections:_.ingredientSections.map(M=>M.id===B?{...M,name:L}:M)}))};return i.jsxs(Fi,{sensors:f,collisionDetection:V0,onDragOver:m,onDragEnd:y,children:[i.jsxs("div",{className:"recipe-form-ingredients",children:[p.map(B=>i.jsx(Ka,{id:B.id,items:B.items.map(L=>L.id),strategy:po,children:i.jsxs(NN,{section:B,sections:p,onSectionChange:z,onRemoveSection:A,children:[B.items.map((L,_)=>(()=>{const M=Cs(l,L?.name),k=Fx(M?.yieldPercent??M?.yield_percent??L?.yieldPercent??L?.yield_percent);return i.jsx(EN,{id:L.id,index:_,item:L,groupId:B.id,yieldPercentApplied:k,onChange:S,onRemove:E,handleSuggestionSelect:C,onOpenConversion:()=>d({isOpen:!0,groupId:B.id,index:_})},L.id)})()),i.jsx(fe,{type:"button",variant:"ghost",onClick:()=>j(B.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},B.id)),i.jsx(fe,{type:"button",variant:"secondary",onClick:N,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(cx,{dropAnimation:{sideEffects:sp({styles:{active:{opacity:"0.5"}}})},children:null}),i.jsx(Px,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,groupId:null,index:null}),onApply:v,ingredientName:x?.name||"",currentCost:x?.purchaseCost,currentQuantity:x?.quantity,unit:x?.unit||"g",initialPurchaseCost:x?.purchase_cost,initialContentAmount:x?.content_amount})]})},TN=({id:n,index:t,item:s,groupId:l,onChange:c,onRemove:u})=>{const{attributes:d,listeners:p,setNodeRef:f,transform:m,transition:y,isDragging:v}=tl({id:n,data:{groupId:l,index:t}}),x={transform:Rr.Translate.toString(m),transition:y,opacity:v?.3:1,position:"relative",zIndex:v?999:"auto"};return i.jsxs("div",{ref:f,style:{...x,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[i.jsx("div",{...d,...p,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),i.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),i.jsx("div",{style:{flex:1},children:i.jsx(Mt,{textarea:!0,value:s.text,onChange:S=>c(l,t,S.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(l,t),title:"",children:""})})]})},kN=({section:n,sections:t,onSectionChange:s,onRemoveSection:l,children:c})=>{const{setNodeRef:u}=Oo({id:n.id});return i.jsxs(xn,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(Mt,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>l(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[c,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},AN=({formData:n,setFormData:t})=>{b.useEffect(()=>{if(!n.stepSections){const x=n.stepGroups||[{id:"default",name:""}],C=(n.steps||[]||[]).map(A=>typeof A=="string"?{id:crypto.randomUUID(),text:A}:A),E=x.map(A=>({id:A.id,name:A.name,items:C.filter(z=>A.id==="default"&&!z.groupId?!0:z.groupId===A.id)})),j=new Set(E.flatMap(A=>A.items.map(z=>z.id))),N=C.filter(A=>!j.has(A.id));N.length>0&&(E.length>0?E[0].items.push(...N):E.push({id:"default",name:"",items:N})),E.length===0&&E.push({id:crypto.randomUUID(),name:"",items:[]}),t(A=>({...A,stepSections:E}))}},[n.steps,n.stepGroups,n.stepSections,t]);const s=n.stepSections||[],l=Ja(gr(To,{activationConstraint:{distance:10}}),gr(ko,{activationConstraint:{delay:250,tolerance:5}}),gr(el,{coordinateGetter:Au})),c=({active:x,over:S})=>{if(!S)return;const C=x.id,E=S.id,j=s.find(A=>A.items.some(z=>z.id===C)),N=s.find(A=>A.items.some(z=>z.id===E))||s.find(A=>A.id===E);!j||!N||j===N||t(A=>{const z=j.items,B=N.items,L=z.findIndex(k=>k.id===C),_=B.findIndex(k=>k.id===E);let M;if(E===N.id)M=B.length+1;else{const G=S&&x.rect.current.translated&&x.rect.current.translated.top>S.rect.top+S.rect.height?1:0;M=_>=0?_+G:B.length+1}return{...A,stepSections:A.stepSections.map(k=>k.id===j.id?{...k,items:z.filter(G=>G.id!==C)}:k.id===N.id?{...k,items:[...B.slice(0,M),z[L],...B.slice(M,B.length)]}:k)}})},u=({active:x,over:S})=>{if(!S)return;const C=x.id,E=S.id,j=s.find(A=>A.items.some(z=>z.id===C)),N=s.find(A=>A.items.some(z=>z.id===E))||s.find(A=>A.id===E);if(j&&N&&j===N){const A=j.items.findIndex(B=>B.id===C),z=N.items.findIndex(B=>B.id===E);A!==z&&t(B=>({...B,stepSections:B.stepSections.map(L=>L.id===j.id?{...L,items:Gi(L.items,A,z)}:L)}))}},d=(x,S,C)=>{t(E=>({...E,stepSections:E.stepSections.map(j=>{if(j.id!==x)return j;const N=[...j.items];return N[S]={...N[S],text:C},{...j,items:N}})}))},p=(x,S)=>{t(C=>({...C,stepSections:C.stepSections.map(E=>E.id===x?{...E,items:E.items.filter((j,N)=>N!==S)}:E)}))},f=x=>{const S={id:crypto.randomUUID(),text:""};t(C=>({...C,stepSections:C.stepSections.map(E=>E.id===x?{...E,items:[...E.items,S]}:E)}))},m=()=>{t(x=>({...x,stepSections:[...x.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},y=x=>{t(S=>({...S,stepSections:S.stepSections.filter(C=>C.id!==x)}))},v=(x,S)=>{t(C=>({...C,stepSections:C.stepSections.map(E=>E.id===x?{...E,name:S}:E)}))};return i.jsxs(Fi,{sensors:l,collisionDetection:V0,onDragOver:c,onDragEnd:u,children:[i.jsxs("div",{className:"recipe-form-steps",children:[s.map(x=>i.jsx(Ka,{id:x.id,items:x.items.map(S=>S.id),strategy:po,children:i.jsxs(kN,{section:x,sections:s,onSectionChange:v,onRemoveSection:y,children:[x.items.map((S,C)=>i.jsx(TN,{id:S.id,index:C,item:S,groupId:x.id,onChange:d,onRemove:p},S.id)),i.jsx(fe,{type:"button",variant:"ghost",onClick:()=>f(x.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},x.id)),i.jsx(fe,{type:"button",variant:"secondary",onClick:m,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(cx,{dropAnimation:{sideEffects:sp({styles:{active:{opacity:"0.5"}}})},children:null})]})},Gx=({onClose:n,onImport:t,initialMode:s="url"})=>{const l=Vi(),[c,u]=b.useState(s),[d,p]=b.useState(null),[f,m]=b.useState(""),[y,v]=b.useState(""),[x,S]=b.useState(null),[C,E]=b.useState(null),[j,N]=b.useState(!1),[A,z]=b.useState(!1),[B,L]=b.useState(null),[_,M]=b.useState(!1),k=b.useRef(null),G=b.useRef(null),V=b.useRef(null),Q=b.useRef(null),P=()=>{Q.current&&(clearTimeout(Q.current),Q.current=null)},F=(O="")=>{if(P(),V.current){try{V.current.abort()}catch{}V.current=null}z(!1),O&&L(O)};b.useEffect(()=>()=>{if(P(),V.current){try{V.current.abort()}catch{}V.current=null}},[]),b.useEffect(()=>{if(!x){E(null);return}const O=URL.createObjectURL(x);return E(O),()=>URL.revokeObjectURL(O)},[x]);const q=O=>new Promise(ie=>{if(!O||typeof O!="object")return ie(O);const de=String(O.type||"").toLowerCase();if(!de.startsWith("image/"))return ie(O);const Me=2e6,Le=2e3,Ke=.9,$e=String(O.name||"").toLowerCase(),We=de.includes("heic")||de.includes("heif")||$e.endsWith(".heic")||$e.endsWith(".heif"),me=URL.createObjectURL(O);let Qe=!1;const ot=ht=>{if(!Qe){Qe=!0;try{URL.revokeObjectURL(me)}catch{}ie(ht)}},ct=setTimeout(()=>ot(O),15e3),mt=new Image;mt.onload=()=>{const ht=mt.naturalWidth||mt.width||0,zt=mt.naturalHeight||mt.height||0;if(!ht||!zt)return clearTimeout(ct),ot(O);const Gt=Math.min(1,Le/Math.max(ht,zt)),vt=Math.max(1,Math.round(ht*Gt)),ne=Math.max(1,Math.round(zt*Gt)),we=Gt<1,Ee=We||O.size>Me;if(!we&&!Ee)return clearTimeout(ct),ot(O);const Te=document.createElement("canvas");Te.width=vt,Te.height=ne;const tt=Te.getContext("2d");if(!tt)return clearTimeout(ct),ot(O);tt.drawImage(mt,0,0,vt,ne),Te.toBlob(_t=>{if(clearTimeout(ct),!_t)return ot(O);const Tt=String(O.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);ot(new File([_t],`${Tt}.jpg`,{type:"image/jpeg"}))},"image/jpeg",Ke)},mt.onerror=()=>{clearTimeout(ct),ot(O)},mt.src=me}),$=async O=>{if(O){if(!String(O.type||"").startsWith("image/")){L("");return}L(null),N(!0);try{const ie=await q(O);S(ie||O)}finally{N(!1)}}},T=()=>k.current?.click?.(),I=()=>G.current?.click?.(),Y=O=>{O.preventDefault(),O.stopPropagation(),O.type==="dragenter"||O.type==="dragover"?M(!0):O.type==="dragleave"&&M(!1)},ae=O=>{if(O.preventDefault(),O.stopPropagation(),M(!1),O.dataTransfer.files&&O.dataTransfer.files[0]){const ie=O.dataTransfer.files[0];ie.type.startsWith("image/")&&$(ie)}},ye=O=>/[---]/.test(O||""),U=async O=>{try{const ie=[];ie.push(O.name||""),ie.push(O.description||"");const de=[];Array.isArray(O.ingredients)&&O.ingredients.forEach((Qe,ot)=>{Qe.name&&(ie.push(Qe.name),de.push(ot))});const Me=[];if(Array.isArray(O.steps)&&O.steps.forEach((Qe,ot)=>{ie.push(Qe),Me.push(ot)}),ie.length===0)return O;const{data:Le,error:Ke}=await De.functions.invoke("translate",{body:{text:ie,target_lang:"JA"}});if(Ke)throw Ke;const $e=Le.translations.map(Qe=>Qe.text);let We=0;const me={...O};return me.name=$e[We++]||me.name,me.description=$e[We++]||me.description,de.length>0&&(me.ingredients=me.ingredients.map((Qe,ot)=>{const ct=de.indexOf(ot);return ct!==-1?{...Qe,name:$e[We+ct]}:Qe}),We+=de.length),Me.length>0&&(me.steps=me.steps.map((Qe,ot)=>{const ct=Me.indexOf(ot);return ct!==-1?$e[We+ct]:Qe})),me}catch(ie){return console.error("Translation failed:",ie),l.warning(""),O}},[W,Z]=b.useState([]),ce=async(O,ie)=>{const de="REDACTED_GOOGLE_API_KEY";if(O.size>4e6)return null;const Le=await O.arrayBuffer(),Ke=btoa(new Uint8Array(Le).reduce((mt,ht)=>mt+String.fromCharCode(ht),"")),$e=O.type||"image/jpeg",me=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${de}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`


: 
- 
- 

JSONJSON
\`\`\`json
{
  "title": "",
  "description": "",
  "ingredients": [
    { "name": "", "quantity": "", "unit": "", "group": null }
  ],
  "steps": ["1...", "2..."]
}
\`\`\`


- 115ml, 15ml, 1200ml 
- 
- `},{inline_data:{mime_type:$e,data:Ke}}]}]}),signal:ie});if(!me.ok){const mt=await me.text();throw console.error("Gemini API Error:",me.status,mt),new Error(`Gemini API Error: ${me.status}`)}const ot=(await me.json()).candidates?.[0]?.content?.parts?.[0]?.text;if(!ot)throw new Error("Gemini");let ct=ot;return ct.includes("```json")?ct=ct.split("```json")[1].split("```")[0]:ct.includes("```")&&(ct=ct.split("```")[1].split("```")[0]),{recipe:JSON.parse(ct.trim()),rawText:ot}},Oe=async()=>{z(!0),L(null),Z([]);try{let O,ie="";if(c==="url"){if(!y)return;ie=y;const{data:Le,error:Ke}=await De.functions.invoke("scrape-recipe",{body:{url:y}});if(Ke)throw Ke;O=Le}else{if(!x)return;P();const Le=new AbortController;V.current=Le;const Ke=12e4;Q.current=setTimeout(()=>{F("")},Ke);const $e="REDACTED_GOOGLE_API_KEY";let We=!1;if($e){Z(me=>[...me," Gemini API..."]);try{const me=await ce(x,Le.signal);me&&me.recipe&&me.recipe.title&&(Z(Qe=>[...Qe," "]),O={recipe:me.recipe,rawText:me.rawText},We=!0)}catch(me){if(me.name==="AbortError")throw me;console.warn("Direct Gemini failed, falling back to Edge Function:",me.message),Z(Qe=>[...Qe,` API: ${me.message}`])}}if(!We){Z(zt=>[...zt," ..."]);const me=new FormData;me.append("image",x);const{data:{session:Qe}}=await De.auth.getSession(),ct="http://127.0.0.1:54321/functions/v1/analyze-image",mt={Authorization:`Bearer ${Qe?.access_token||"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH"}`};let ht;try{ht=await fetch(ct,{method:"POST",headers:mt,body:me,signal:Le.signal})}catch(zt){throw console.error("Network Error:",zt),new Error("")}if(!ht.ok){const zt=ht.status;throw new Error(`Server Error: ${ht.statusText} (${zt})`)}if(!ht.body)O=await ht.json();else{const zt=ht.body.getReader(),Gt=new TextDecoder;let vt=null,ne="",we=!1;for(;;){const{done:Ee,value:Te}=await zt.read();if(Ee)break;ne+=Gt.decode(Te,{stream:!0});const tt=ne.split(`

`);ne=tt.pop()||"";for(const _t of tt){const Tt=_t.trim();if(Tt.startsWith("data: "))try{const en=JSON.parse(Tt.slice(6));if(en.type==="log")Z(jn=>[...jn,en.message]);else if(en.type==="result")vt=en,we=!0;else if(en.type==="error")throw new Error(en.message)}catch(en){if(en.message&&!en.message.includes("Failed to parse"))throw en;console.warn("Failed to parse SSE event",en)}}if(we)break}try{await zt.cancel()}catch{}if(!vt)throw new Error("");O=vt}}}if(O.error)throw new Error(O.error);if(!O.recipe)throw new Error("No recipe found");let de=O.recipe;if(de.name=de.name||de.title||"",de.recipeYield=de.recipeYield||de.servings||"",de.description=de.description||"",!de.ingredients&&de.recipeIngredient&&(de.ingredients=de.recipeIngredient),Array.isArray(de.ingredients)){const Le=["","","method","instructions","steps","preparation"],Ke=[],$e=[];de.ingredients.forEach(We=>{const me=(We.group||"").trim().toLowerCase();if(me&&Le.some(Qe=>me===Qe||me.includes(Qe))){const Qe=We.name||We.text||"";Qe&&$e.push(Qe)}else Ke.push(We)}),$e.length>0&&(console.log("Extracted steps from ingredients:",$e),de.ingredients=Ke,de.steps=Array.isArray(de.steps)?de.steps:[],de.steps=[...de.steps,...$e])}const Me=(de.name||"")+(de.steps?de.steps.slice(0,3).join(""):"");if(Me&&!ye(Me)){p(de),m(ie),u("confirm-translation"),z(!1);return}t(de,ie),n()}catch(O){if(console.error("Import failed details:",O),O?.name==="AbortError")return;const ie=O.message||"Import failed. Please try again.";L(ie)}finally{P(),V.current=null,c!=="confirm-translation"&&z(!1)}},Se=async O=>{z(!0);try{let ie=d;O&&(ie=await U(d)),t(ie,f),n()}catch(ie){console.error("Translation flow error:",ie),L("Translation failed. Importing original."),t(d,f),n()}finally{z(!1)}},Re=O=>{const ie=O.target.files[0];ie&&$(ie),O.target.value=""};return i.jsxs("div",{className:"modal-overlay fade-in",children:[A&&i.jsxs("div",{className:"loading-overlay",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"..."}),W.length>0&&i.jsx("div",{className:"progress-log-container",children:i.jsxs("div",{className:"progress-log",children:[W.map((O,ie)=>i.jsx("div",{className:"log-entry",children:i.jsx("span",{className:"log-message",children:O})},ie)),i.jsx("div",{ref:O=>O?.scrollIntoView({behavior:"smooth"})})]})}),i.jsx("div",{style:{marginTop:"0.9rem",display:"flex",justifyContent:"center"},children:i.jsx(fe,{type:"button",variant:"secondary",onClick:()=>F(),children:""})})]}),i.jsxs(xn,{className:"import-modal-card",children:[i.jsx("h3",{className:"modal-title",children:c==="confirm-translation"?"":""}),c==="confirm-translation"?i.jsxs("div",{className:"translation-confirm-content",children:[i.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),i.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),i.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[i.jsx(fe,{type:"button",variant:"primary",onClick:()=>Se(!0),isLoading:A,style:{width:"100%"},children:""}),i.jsx(fe,{type:"button",variant:"secondary",onClick:()=>Se(!1),disabled:A,style:{width:"100%"},children:""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"import-mode-tabs",children:[i.jsx("button",{type:"button",onClick:()=>u("url"),className:`tab-btn tab-import-web ${c==="url"?"active":""}`,children:" Web URL"}),i.jsx("button",{type:"button",onClick:()=>u("image"),className:`tab-btn tab-import-image ${c==="image"?"active":""}`,children:"  (Best Effort)"})]}),c==="url"?i.jsxs(i.Fragment,{children:[i.jsx("p",{children:"URL"}),i.jsx("input",{type:"url",placeholder:"https://...",value:y,onChange:O=>v(O.target.value),className:"import-url-input",autoFocus:!0})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{children:""}),i.jsxs("div",{className:"image-upload-wrapper",children:[i.jsx("input",{ref:k,type:"file",accept:"image/*",capture:"environment",onChange:Re,className:"image-upload-input"}),i.jsx("input",{ref:G,type:"file",accept:"image/*",onChange:Re,className:"image-upload-input"}),i.jsx("div",{onDragEnter:Y,onDragLeave:Y,onDragOver:Y,onDrop:ae,className:`image-upload-label ${_?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{A||j||I()},onKeyDown:O=>{A||j||(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),I())},children:C?i.jsx("img",{src:C,alt:"Preview",className:"image-upload-preview"}):_?"":""}),i.jsxs("div",{className:"image-upload-actions",children:[i.jsx(fe,{type:"button",variant:"secondary",onClick:T,disabled:A||j,children:""}),i.jsx(fe,{type:"button",variant:"secondary",onClick:I,disabled:A||j,children:""})]})]}),j&&i.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),B&&i.jsx("p",{className:"error-text",children:B}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(fe,{type:"button",variant:"ghost",onClick:n,disabled:A,children:""}),i.jsx(fe,{type:"button",variant:"primary",onClick:Oe,isLoading:A,disabled:j||(c==="url"?!y:!x),children:""})]})]})]})]})},h0=({onSave:n,onCancel:t,initialData:s})=>{const l=s||{},[c,u]=b.useState("ingredients"),[d,p]=b.useState(null),[f,m]=b.useState(new Map);Ue.useEffect(()=>{(async()=>{const q=await sr.fetchPriceList();m(q)})()},[]);const y=b.useMemo(()=>{const F=l.steps||[""];let q=l.stepGroups||[];const $=F.some(I=>typeof I=="object"&&I.group);if(q.length===0&&$){const I=new Map;F.forEach(Y=>{typeof Y=="object"&&Y.group&&!I.has(Y.group)&&I.set(Y.group,crypto.randomUUID())}),q=Array.from(I.entries()).map(([Y,ae])=>({id:ae,name:Y}))}return{steps:F.map(I=>{const Y=typeof I=="string"?I:I.text||"",ae=typeof I=="object"&&I.id?I.id:crypto.randomUUID();let ye=typeof I=="object"?I.groupId:void 0;const U=typeof I=="object"?I.group:void 0;if(!ye&&U&&q.length>0){const W=q.find(Z=>Z.name===U);W&&(ye=W.id)}return{id:ae,text:Y,groupId:ye}}),stepGroups:q}},[l]),v=y.steps,x=y.stepGroups,S=b.useMemo(()=>{const F=l.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let q=l.ingredientGroups||[];if(q.length===0&&F.some(T=>T.group)){const T=new Map;F.forEach(I=>{I.group&&!T.has(I.group)&&T.set(I.group,crypto.randomUUID())}),q=Array.from(T.entries()).map(([I,Y])=>({id:Y,name:I})),T.size>0&&F.some(I=>!I.group)}return{ingredients:F.map(T=>{const I=typeof T=="string"?{name:T,quantity:"",unit:"",cost:"",purchaseCost:""}:{...T,cost:T.cost||"",purchaseCost:T.purchaseCost||""};let Y=I.groupId;if(!Y&&I.group&&q.length>0){const ae=q.find(ye=>ye.name===I.group);ae&&(Y=ae.id)}return{...I,id:I.id||crypto.randomUUID(),groupId:Y}}),ingredientGroups:q}},[l]),C=S.ingredients,E=S.ingredientGroups,[j,N]=b.useState({title:l.title||"",description:l.description||"",image:l.image||"",imageFile:null,storeName:l.storeName||"",servings:l.servings||"",ingredients:C,ingredientGroups:E,steps:v,stepGroups:x,tags:l.tags||[""],course:l.course||"",category:l.category||"",type:l.type||"normal",flours:l.flours||[],breadIngredients:l.breadIngredients||[],sourceUrl:l.sourceUrl||""}),[A,z]=b.useState(!1),B=(F,q="")=>{const $=new Map,T=F.ingredients||[];T.forEach(Z=>{let ce=Z.group||"";ce==="Main"&&(ce=""),$.has(ce)||$.set(ce,crypto.randomUUID())});const I=Array.from($.entries()).map(([Z,ce])=>({id:ce,name:Z})),Y=T.map(Z=>{let ce=Z.group||"";ce==="Main"&&(ce="");let Oe;return $.has(ce)&&(Oe=$.get(ce)),{id:crypto.randomUUID(),name:Z.name||"",quantity:Z.quantity||"",unit:Z.unit||"",cost:"",purchaseCost:"",groupId:Oe}}),ae=new Map,ye=F.steps||[];ye.forEach(Z=>{typeof Z=="object"&&Z.group&&Z.group!=="Main"&&(ae.has(Z.group)||ae.set(Z.group,crypto.randomUUID()))});const U=Array.from(ae.entries()).map(([Z,ce])=>({id:ce,name:Z})),W=ye.map(Z=>{const ce=typeof Z=="object",Oe=ce?Z.text||"":Z,Se=ce?Z.group:null;let Re;return Se&&ae.has(Se)&&(Re=ae.get(Se)),{id:crypto.randomUUID(),text:Oe,groupId:Re}});N(Z=>({...Z,title:F.name||Z.title,description:F.description||Z.description,category:q?"URL":F.category||Z.category,image:F.image||Z.image,servings:F.recipeYield||Z.servings,ingredients:Y,ingredientGroups:I,steps:W,stepGroups:U,ingredientSections:void 0,stepSections:void 0,sourceUrl:q||Z.sourceUrl})),p(null),u("ingredients")},L=F=>{F.preventDefault(),F.stopPropagation(),F.type==="dragenter"||F.type==="dragover"?z(!0):F.type==="dragleave"&&z(!1)},_=F=>{if(F.preventDefault(),F.stopPropagation(),z(!1),F.dataTransfer.files&&F.dataTransfer.files[0]){const q=F.dataTransfer.files[0];q.type.startsWith("image/")&&N($=>({...$,imageFile:q,image:URL.createObjectURL(q)}))}},M=F=>{const{id:q,value:$}=F.target;N(T=>({...T,[q]:$}))},k=F=>{const q=F.target.files[0];q&&N($=>({...$,imageFile:q,image:URL.createObjectURL(q)}))},G=b.useMemo(()=>{if(j.type==="bread")return(j.flours?.length||0)+(j.breadIngredients?.length||0);const F=j.ingredientSections||[];return F.length>0?F.reduce((q,$)=>q+($?.items?.length||0),0):j.ingredients?.length||0},[j.breadIngredients,j.flours,j.ingredientSections,j.ingredients,j.type]),V=b.useMemo(()=>{const F=j.stepSections||[];return F.length>0?F.reduce((q,$)=>q+($?.items?.length||0),0):j.steps?.length||0},[j.stepSections,j.steps]),Q=F=>{F.preventDefault();let q=[],$=[];if(j.type==="bread")q=j.ingredients.map(U=>{const{id:W,...Z}=U;return Z});else{const U=j.ingredientSections||[];U.length===0&&j.ingredients.length>0?q=j.ingredients.map(W=>{const{id:Z,...ce}=W;return ce}):(q=U.flatMap(W=>W.items.map(Z=>({...Z,groupId:W.id}))).map(W=>{const{id:Z,...ce}=W;return ce}),$=U.map(W=>({id:W.id,name:W.name})))}const T=new Set(j.tags||[]);j.course&&T.add(j.course),j.category&&T.add(j.category),j.type==="bread"&&T.add("");const I=Array.from(T).filter(Boolean);let Y=[],ae=[];const ye=j.stepSections||[];ye.length===0&&j.steps.length>0?Y=j.steps.map(U=>typeof U=="string"?{text:U}:U):(Y=ye.flatMap(U=>U.items.map(W=>({text:W.text,groupId:U.id}))),ae=ye.map(U=>({id:U.id,name:U.name}))),n({...j,ingredients:q,ingredientGroups:$,steps:Y,stepGroups:ae,image:j.imageFile||j.image,id:l.id||Date.now(),tags:I,ingredientSections:void 0,stepSections:void 0})},P=!!l?.id;return i.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:Q,children:[d&&i.jsx(Gx,{onClose:()=>p(null),onImport:B,initialMode:d}),i.jsxs("div",{className:"recipe-form-mock__page",children:[i.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:i.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[i.jsxs("div",{className:"recipe-form-mock__crumb",children:[i.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),i.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),i.jsx("span",{className:"recipe-form-mock__crumb-page",children:P?"":""})]}),i.jsxs("div",{className:"recipe-form-mock__actions",children:[i.jsx(fe,{type:"button",variant:"ghost",onClick:t,children:""}),i.jsx(fe,{type:"submit",variant:"primary",children:""})]})]})}),i.jsxs("div",{className:"recipe-form-mock__sheet",children:[i.jsxs("header",{className:"recipe-form-mock__doc",children:[i.jsxs("div",{className:"recipe-form-mock__doc-title",children:[i.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:j.title,onChange:M,placeholder:"",required:!0}),i.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),i.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(Mt,{label:"",id:"course",value:j.course,onChange:M,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"course-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(Mt,{label:"",id:"category",value:j.category,onChange:M,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"category-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(Mt,{label:"",id:"storeName",value:j.storeName,onChange:M,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),i.jsx("datalist",{id:"store-options",children:lu.map(F=>i.jsx("option",{value:F},F))})]}),i.jsx("div",{className:"recipe-form-mock__meta-field",children:i.jsx(Mt,{label:"",id:"servings",value:j.servings,onChange:M,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),i.jsxs("div",{className:"recipe-form-mock__grid",children:[i.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[i.jsxs(xn,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsx(Mt,{label:"",id:"description",textarea:!0,value:j.description,onChange:M,placeholder:"..."}),i.jsx(Mt,{label:"URL",id:"sourceUrl",value:j.sourceUrl||"",onChange:M,placeholder:"https://example.com/recipe/..."})]}),i.jsxs(xn,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:`recipe-form-mock__image-drop ${A?"is-active":""}`,onDragEnter:L,onDragLeave:L,onDragOver:L,onDrop:_,children:[j.image?i.jsxs("div",{className:"recipe-form-mock__image-preview",children:[i.jsx("img",{src:j.image,alt:"",onError:F=>{F.target.style.display="none"}}),i.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>N(F=>({...F,image:"",imageFile:null})),title:"",children:""})]}):i.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",i.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),i.jsx("input",{type:"file",accept:"image/*",onChange:k,className:"recipe-form-mock__image-input"})]})]}),!l?.id&&i.jsxs(xn,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:"recipe-form-mock__import-actions",children:[i.jsx(fe,{variant:"secondary",type:"button",onClick:()=>p("url"),children:"URL"}),i.jsx(fe,{variant:"secondary",type:"button",onClick:()=>p("image"),children:""})]}),i.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),i.jsxs(xn,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[i.jsx("li",{children:""}),i.jsx("li",{children:""}),i.jsx("li",{children:""})]})]})]}),i.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:i.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[i.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[i.jsxs("div",{className:"recipe-form-mock__nav",children:[i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${c==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:G.toLocaleString()})]}),i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${c==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:V.toLocaleString()})]})]}),i.jsx("div",{className:"recipe-form-mock__workspace-right",children:c==="ingredients"?i.jsxs("div",{className:"recipe-form-mock__segmented",children:[i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="normal"?"active":""}`,onClick:()=>N(F=>({...F,type:"normal"})),children:""}),i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="bread"?"active":""}`,onClick:()=>N(F=>({...F,type:"bread"})),children:""})]}):i.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),i.jsx("div",{className:"recipe-form-mock__workspace-body",children:c==="ingredients"?i.jsx("div",{className:"recipe-form-mock__editor-surface",children:j.type==="bread"?i.jsx(vN,{formData:j,setFormData:N}):i.jsx(RN,{formData:j,setFormData:N,priceList:f})}):i.jsx("div",{className:"recipe-form-mock__editor-surface",children:i.jsx(AN,{formData:j,setFormData:N})})})]})})]})]})]})]})},ON="modulepreload",DN=function(n){return"/app/"+n},f0={},bf=function(t,s,l){let c=Promise.resolve();if(s&&s.length>0){let f=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),p=d?.nonce||d?.getAttribute("nonce");c=f(s.map(m=>{if(m=DN(m),m in f0)return;f0[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":ON,y||(x.as="script"),x.crossOrigin="",x.href=m,p&&x.setAttribute("nonce",p),document.head.appendChild(x),y)return new Promise((S,C)=>{x.addEventListener("load",S),x.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(d){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=d,window.dispatchEvent(p),!p.defaultPrevented)throw d}return c.then(d=>{for(const p of d||[])p.status==="rejected"&&u(p.reason);return t().catch(u)})},MN=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},Hi={async fetchAllProfiles(){try{const{data:t,error:s}=await De.rpc("admin_list_profiles");if(!s&&Array.isArray(t))return t;s&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",s)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const n=await De.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await De.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const l=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let c=null;if(l)try{const{data:d,error:p}=await De.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(p)throw p;if(d){const f=MN(d);if(f)return f}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),c=d}const u=await De.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(c&&l)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${c.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await De.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminResetPassword(n,t){const{data:s,error:l}=await De.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(l)throw l;if(s?.error)throw new Error(s.error);return s},async sendPasswordResetEmail(n){const{error:t}=await De.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(t)throw t;return!0}},p0="csv_unit_overrides",m0=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),bu={async _getCurrentUserId(){const{data:n,error:t}=await De.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:s,error:l}=await De.from(p0).select("ingredient_name,csv_unit").eq("user_id",t);if(l){if(m0(l))return new Map;throw l}const c=new Map;return(s||[]).forEach(u=>{u?.ingredient_name&&c.set(String(u.ingredient_name),String(u.csv_unit||""))}),c}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,s=null){const l=s||await this._getCurrentUserId();if(!l)throw new Error("");const c=String(n||"").trim(),u=String(t||"").trim();if(!c)throw new Error("");if(!u)throw new Error("");const{data:d,error:p}=await De.from(p0).upsert({user_id:l,ingredient_name:c,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(p)throw m0(p)?new Error("DB csv_unit_overrides "):p;return d}},zN=()=>{const n=Vi(),{user:t}=is(),[s,l]=b.useState([]),[c,u]=b.useState(""),[d,p]=b.useState("all"),[f,m]=b.useState(null),[y,v]=b.useState(!1),[x,S]=b.useState(new Map),[C,E]=b.useState(new Map),[j,N]=b.useState({}),[A,z]=b.useState(!1),[B,L]=b.useState([]),[_,M]=b.useState(!1),[k,G]=b.useState(""),[V,Q]=b.useState(""),[P,F]=b.useState(!1),[q,$]=b.useState(!1),[T,I]=b.useState(null),[Y,ae]=b.useState(!1),ye="manual",U=ne=>{const we=String(ne||"").trim();return!we||we==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(we)?we:"food"},W=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:ye,label:""}],Z=b.useCallback(ne=>{const we=hn(ne);return we?x?.has(we):!1},[x]),ce=Ue.useMemo(()=>{const ne={all:s.length,food:0,alcohol:0,soft_drink:0,supplies:0,[ye]:0};return s.forEach(we=>{const Ee=U(we?.itemCategory);ne[Ee]=(ne[Ee]||0)+1,Z(we?.ingredientName)||(ne[ye]=(ne[ye]||0)+1)}),ne},[s,Z]),Oe=b.useCallback(async()=>{v(!0);try{const[ne,we,Ee]=await Promise.all([qn.getAllConversions(),sr.fetchPriceList(),bu.getAll()]),Te=Array.from(ne.values()).map(tt=>({...tt,clientId:tt.ingredientName,isNew:!1,isEditing:!1}));S(we||new Map),E(Ee||new Map),l(Te.sort((tt,_t)=>tt.ingredientName.localeCompare(_t.ingredientName,"ja")))}catch(ne){n.error(""),console.error("Failed to load ingredients:",ne)}v(!1)},[n]);b.useEffect(()=>{const ne=setTimeout(()=>{Oe()},0);return()=>clearTimeout(ne)},[Oe]);const Se=()=>{const ne=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,we=["food","alcohol","soft_drink","supplies"].includes(d)?d:"food",Ee={clientId:ne,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:we,isNew:!0,isEditing:!0};l(Te=>[Ee,...Te.map(tt=>({...tt,isEditing:!1}))]),m(ne)},Re=b.useCallback(ne=>s.findIndex(we=>we?.clientId===ne),[s]),O=async ne=>{const we=Re(ne);if(we<0)return;const Ee=s[we];if(!Ee.ingredientName||!Ee.packetSize||!Ee.lastPrice){n.warning("");return}const Te=parseFloat(Ee.yieldPercent),tt=Number.isFinite(Te)?Te:100;if(tt<=0||tt>100){n.warning("% 1100 ");return}try{await qn.saveConversion(Ee.ingredientName,Ee.packetSize,Ee.packetUnit,Ee.lastPrice,Ee.itemCategory,Ee.vendor,tt),n.success(""),Oe(),m(null)}catch(_t){n.error(""),console.error("Save error:",_t)}},ie=async ne=>{const we=Re(ne);if(we<0)return;const Ee=s[we],Te=Ee?.ingredientName;if(Ee.isNew){l(tt=>tt.filter(_t=>_t?.clientId!==ne)),m(null);return}try{await qn.deleteConversion(Te),n.success(""),Oe()}catch(tt){n.error(""),console.error("Delete error:",tt)}},de=ne=>{m(ne),l(we=>we.map(Ee=>({...Ee,isEditing:Ee?.clientId===ne})))},Me=ne=>{const we=Re(ne);we<0||(s[we].isNew?l(Ee=>Ee.filter(Te=>Te?.clientId!==ne)):Oe(),m(null))},Le=(ne,we,Ee)=>{l(Te=>Te.map(tt=>tt?.clientId!==ne?tt:{...tt,[we]:Ee}))},Ke=ne=>{const we=parseFloat(ne.lastPrice),Ee=parseFloat(ne.packetSize);if(!we||!Ee)return"-";const Te=ne.packetUnit?ne.packetUnit.trim().toLowerCase():"";return Te==="g"||Te===""?`${Math.round(we/Ee*1e3).toLocaleString()}/kg`:Te==="ml"||Te==="cc"||Te===""||Te===""?`${Math.round(we/Ee*1e3).toLocaleString()}/L`:`${Math.round(we/Ee).toLocaleString()}/${ne.packetUnit}`},$e=s.filter(ne=>{const we=String(ne?.ingredientName||"");return we.toLowerCase().includes(c.toLowerCase())?d==="all"?!0:d===ye?!Z(we):U(ne?.itemCategory)===d:!1}),We=d!=="all"||String(c||"").trim()!=="",me=ne=>{const we=hn(ne);if(!we)return"-";const Te=(x?.get(we)||null)?.unit;return Te?String(Te):"-"},Qe=ne=>{const we=hn(ne);if(!we)return"";const Te=(x?.get(we)||null)?.vendor;return Te?String(Te):""},ot=ne=>{const we=String(ne?.vendor||"").trim();return we||Qe(ne?.ingredientName)},ct=ne=>{const we=(ne??"").toString().trim();if(!we)return"";if(Object.prototype.hasOwnProperty.call(j,we))return j[we];const Ee=C?.get(we);if(Ee)return String(Ee);const Te=me(we);return Te==="-"?"":Te},mt=ne=>{const we=(ne??"").toString().trim();if(!we)return"-";const Ee=C?.get(we);return Ee?String(Ee):me(we)},ht=async(ne,we)=>{const Ee=(ne??"").toString().trim(),Te=(we??"").toString().trim();if(Ee){if(!Te){N(tt=>{const _t={...tt};return delete _t[Ee],_t});return}try{await bu.upsert(Ee,Te),E(tt=>{const _t=new Map(tt);return _t.set(Ee,Te),_t}),n.success("CSV")}catch(tt){console.error(tt),n.error(tt?.message||"")}}},zt=async()=>{if(t?.role==="admin"){z(!0),G(""),L([]),Q(""),F(!1),I(null),ae(!1),M(!0);try{const ne=await Hi.fetchAllProfiles();L(ne||[])}catch(ne){console.error(ne),G("")}finally{M(!1)}}},Gt=()=>{q||(ae(!1),z(!1))},vt=async()=>{if(!(!V||q)){$(!0),I({type:"info",message:"..."});try{const ne=await qn.adminCopyIngredientMasterToUser(V,{overwrite:P}),we=ne?.unit_conversions||{},Ee=ne?.csv_unit_overrides||{},Te=`: ${Number(we.source_total||0).toLocaleString()}   ${Number(we.copied||0).toLocaleString()} /  ${Number(we.updated||0).toLocaleString()} /  ${Number(we.skipped||0).toLocaleString()}`,tt=`(CSV): ${Number(Ee.source_total||0).toLocaleString()}   ${Number(Ee.copied||0).toLocaleString()} /  ${Number(Ee.updated||0).toLocaleString()} /  ${Number(Ee.skipped||0).toLocaleString()}`;I({type:"success",message:`
${Te}
${tt}`}),n.success("")}catch(ne){console.error(ne),I({type:"error",message:`: ${String(ne?.message||ne)}`}),n.error("")}finally{$(!1)}}};return i.jsxs("div",{className:"ingredient-master-container",children:[i.jsxs("div",{className:"master-header",children:[i.jsx("h3",{children:" "}),i.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[t?.role==="admin"&&i.jsx(fe,{variant:"secondary",onClick:zt,disabled:f!==null||y||q,title:f!==null?"":void 0,children:""}),i.jsx(fe,{variant:"primary",onClick:Se,disabled:f!==null,children:"+ "})]})]}),i.jsx("div",{className:"master-search",children:i.jsx(Mt,{placeholder:"...",value:c,onChange:ne=>u(ne.target.value)})}),i.jsxs("div",{className:"ingredient-master-stats",children:[i.jsxs("span",{children:[": ",i.jsx("strong",{children:(s.length||0).toLocaleString()})," "]}),We&&i.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",i.jsx("strong",{children:($e.length||0).toLocaleString()})," "]})]}),i.jsx("div",{className:"ingredient-category-tabs",children:W.map(ne=>i.jsxs("button",{type:"button",className:`ingredient-category-tab ${d===ne.key?"active":""}`,onClick:()=>p(ne.key),disabled:f!==null,title:f!==null?"":void 0,children:[ne.label," (",(ce[ne.key]??0).toLocaleString(),")"]},ne.key))}),y?i.jsx("div",{className:"master-loading",children:"..."}):i.jsx("div",{className:"master-table-wrapper",children:i.jsxs("table",{className:"master-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{children:""}),i.jsx("th",{children:"%"}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:$e.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"8",style:{textAlign:"center",color:"#999"},children:We?"":""})}):$e.map((ne,we)=>{const Ee=ne?.clientId??ne?.ingredientName??String(we),Te=Qe(ne?.ingredientName),tt=String(ne?.vendor||"").trim(),_t=ne?.isEditing&&!!Te&&Te!==tt,Tt=ot(ne),jn=U(ne?.itemCategory)==="food";return i.jsxs("tr",{className:ne.isEditing?"editing":"",children:[i.jsx("td",{children:ne.isEditing?i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx(Mt,{value:ne.ingredientName,onChange:bt=>Le(Ee,"ingredientName",bt.target.value),placeholder:": ",disabled:!ne.isNew,wrapperClassName:"input-group--no-margin"}),i.jsx(Mt,{value:ne.vendor||"",onChange:bt=>Le(Ee,"vendor",bt.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),_t&&i.jsxs("div",{className:"ingredient-subtext",children:["CSV: ",Te]})]}):i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx("div",{children:ne.ingredientName}),Tt&&i.jsx("div",{className:"ingredient-subtext",children:Tt})]})}),i.jsx("td",{children:ne.isEditing?i.jsx(Mt,{type:"number",value:ne.lastPrice,onChange:bt=>Le(Ee,"lastPrice",bt.target.value),placeholder:": 500"}):`${parseFloat(ne.lastPrice||0).toLocaleString()}`}),i.jsx("td",{children:ne.isEditing?i.jsxs("div",{className:"input-with-hint",children:[i.jsx(Mt,{type:"number",value:ne.packetSize,onChange:bt=>Le(Ee,"packetSize",bt.target.value),placeholder:["","","","PC","","",""].includes(ne.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(ne.packetUnit)&&i.jsxs("span",{className:"unit-hint",children:["1",ne.packetUnit,"1"]})]}):ne.packetSize}),i.jsx("td",{children:ne.isEditing?i.jsxs("select",{value:ne.packetUnit,onChange:bt=>Le(Ee,"packetUnit",bt.target.value),className:"unit-select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"cc",children:"cc"})]}):ne.packetUnit}),i.jsx("td",{className:"csv-unit-cell",children:ne.isEditing?i.jsx(Mt,{value:ct(ne.ingredientName),onChange:bt=>{const tn=(ne.ingredientName??"").toString().trim(),ln=bt.target.value;N(yn=>({...yn,[tn]:ln}))},onBlur:bt=>ht(ne.ingredientName,bt.target.value),placeholder:me(ne.ingredientName)==="-"?"":`CSV: ${me(ne.ingredientName)}`}):i.jsx("span",{children:mt(ne.ingredientName)})}),i.jsx("td",{className:"normalized-cost",children:Ke(ne)}),i.jsx("td",{children:jn?ne.isEditing?i.jsx(Mt,{type:"number",value:ne.yieldPercent??"",onChange:bt=>Le(Ee,"yieldPercent",bt.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const bt=parseFloat(ne.yieldPercent);if(!Number.isFinite(bt)||bt<=0)return"-";const tn=Math.round(bt*10)/10;return`${Number.isInteger(tn)?Math.round(tn):tn}%`})():i.jsx("span",{style:{color:"#999"},children:"-"})}),i.jsx("td",{children:i.jsx("div",{className:"action-buttons",children:ne.isEditing?i.jsxs(i.Fragment,{children:[i.jsx(fe,{variant:"primary",size:"sm",onClick:()=>O(Ee),children:""}),i.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>Me(Ee),children:""})]}):i.jsxs(i.Fragment,{children:[i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>de(Ee),disabled:f!==null,children:""}),i.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>ie(Ee),disabled:f!==null,children:""})]})})})]},Ee)})})]})}),i.jsx("div",{className:"master-info",children:i.jsx("p",{children:" "})}),i.jsx(Bn,{isOpen:A,onClose:Gt,title:"",size:"medium",showCloseButton:!q,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",i.jsx("br",{}),i.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),Y?i.jsxs(i.Fragment,{children:[(()=>{const ne=B.find(Ee=>String(Ee?.id)===String(V)),we=ne?`${ne.display_id}${ne.email?` (${ne.email})`:""}`:V?String(V).slice(0,8):"-";return i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",i.jsx("strong",{children:we}),i.jsx("br",{}),": ",i.jsx("strong",{children:P?"":""})]})]})})(),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(fe,{variant:"ghost",onClick:()=>ae(!1),disabled:q,children:""}),i.jsx(fe,{variant:"primary",onClick:vt,disabled:!V||q,children:q?"...":""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),_?i.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):i.jsxs("select",{value:V,onChange:ne=>Q(ne.target.value),disabled:q||!!k,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:q?"#f3f4f6":"white"},children:[i.jsx("option",{value:"",children:"..."}),B.filter(ne=>String(ne?.id)&&String(ne?.id)!==String(t?.id)).map(ne=>i.jsxs("option",{value:ne.id,children:[ne.display_id,ne.email?` (${ne.email})`:"",ne.role==="admin"?" []":""]},ne.id))]}),k&&i.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:k})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[i.jsx("input",{type:"checkbox",checked:P,onChange:ne=>F(ne.target.checked),disabled:q}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(fe,{variant:"ghost",onClick:Gt,disabled:q,children:""}),i.jsx(fe,{variant:"primary",onClick:()=>ae(!0),disabled:!V||q||_||!!k,children:""})]})]}),q&&i.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),T?.message&&i.jsx("div",{className:`status-msg ${T.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:T.message})]})})]})},tu="__all_vendors__",Vx="__unknown_vendor__",Jl="__all_categories__",wf="food",ou=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],Hf=ou.reduce((n,t)=>(n[t.value]=t.label,n),{}),UN=new Set(["","","","","PC","","",""]),Ui=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const s=Number(t);return Number.isFinite(s)?s:null},g0=n=>(typeof n=="string"?n.trim():"")||Vx,La=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?wf:Hf[t]?t:wf},LN=()=>{const[n,t]=b.useState([]),[s,l]=b.useState(!0),[c,u]=b.useState(null),[d,p]=b.useState(null),[f,m]=b.useState("all"),[y,v]=b.useState({key:null,direction:"asc"}),[x,S]=b.useState(""),[C,E]=b.useState(Jl),[j,N]=b.useState(tu),[A,z]=b.useState(!1),[B,L]=b.useState(null),_=b.useRef(null),M=Vi(),[k,G]=b.useState({isOpen:!1,title:"",message:"",onConfirm:null}),V=()=>{p(O=>!O||O.phase==="running"?O:null)};b.useEffect(()=>{Q()},[]);const Q=async()=>{l(!0),L(null);try{console.log("Starting data load for CsvToMasterImporter...");const[O,ie]=await Promise.all([sr.getPriceListArray().catch(Me=>(console.error("Error fetching price list:",Me),[])),qn.getAllConversions().catch(Me=>(console.error("Error fetching conversions:",Me),new Map))]);if(console.log("Data fetched:",{csvCount:O?.length,masterSize:ie?.size}),!Array.isArray(O))throw new Error("CSV");if(!(ie instanceof Map))throw new Error("Map");const de=[];for(const Me of O){if(!Me||!Me.name)continue;const Le=ie.get(Me.name),Ke=La(Le?.itemCategory),$e=Le?.packetSize??"",We=Le?.packetUnit||Me.unit||"",me=Le?.lastPrice??"",Qe=Le?$e:UN.has(We)?1:"";de.push({name:Me.name,csvPrice:Me.price,csvUnit:Me.unit,csvVendor:Me.vendor,masterCategory:Ke,masterSize:$e,masterUnit:We,masterPrice:me,isRegistered:!!Le,inputSize:Qe,inputUnit:We,inputPrice:Le?me:Me.price??"",inputCategory:Ke,isModified:!1})}console.log("Merge completed. Items:",de.length),t(de)}catch(O){console.error("Failed to load data for importer:",O),L(O.message||"")}finally{l(!1)}},P=async O=>{u(O.name);try{const ie=Ui(O.inputSize),de=Ui(O.inputPrice);if(ie===null||ie<=0){M.error("");return}if(!O.inputUnit){M.error("");return}if(!O.inputCategory){M.error("");return}await qn.saveConversion(O.name,ie,O.inputUnit,de,O.inputCategory),t(Me=>Me.map(Le=>Le.name===O.name?{...Le,isRegistered:!0,isModified:!1,masterSize:ie,masterUnit:O.inputUnit,masterPrice:de??"",masterCategory:O.inputCategory,inputCategory:O.inputCategory}:Le)),M.success("")}catch(ie){console.error("Failed to save ingredient:",ie),M.error("")}finally{u(null)}},F=async O=>{G(ie=>({...ie,isOpen:!1}));try{const ie=O.filter(ne=>{const we=Ui(ne.inputSize);return!(we!==null&&we>0)||!ne.inputUnit||!ne.inputCategory});if(ie.length>0){const ne=ie.slice(0,5).map(Ee=>Ee.name).join(""),we=ie.length>5?` ${ie.length-5}`:"";M.error(`: ${ne}${we}`);return}u("bulk");const de=O.length;p({phase:"running",total:de,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const Me=5,Le=120;let Ke=0,$e=0,We=0,me=0;const Qe=[],ot=[],ct=(ne=!1,we="")=>{const Ee=Date.now();!ne&&Ee-me<Le||(me=Ee,p(Te=>!Te||Te.phase!=="running"?Te:{...Te,processed:Ke,success:$e,failed:We,currentName:we||Te.currentName}))};let mt=0;const ht=async()=>{for(;;){const ne=mt++;if(ne>=O.length)return;const we=O[ne],Ee=we?.name?String(we.name):"";try{const Te=Ui(we.inputSize),tt=Ui(we.inputPrice);if(Te===null||Te<=0)throw new Error("Invalid size");if(!we.inputUnit)throw new Error("Invalid unit");if(!we.inputCategory)throw new Error("Invalid category");await qn.saveConversion(we.name,Te,we.inputUnit,tt,we.inputCategory),$e++,Qe.push(we)}catch(Te){We++,ot.push(Ee||`#${ne+1}`),console.error(`Failed to save ${Ee}:`,Te)}finally{Ke++,ct(!1,Ee)}}},zt=Math.min(Me,O.length);await Promise.all(Array.from({length:zt},()=>ht())),ct(!0);const Gt=new Set(Qe.map(ne=>ne.name)),vt=new Map(O.map(ne=>[ne.name,ne]));t(ne=>ne.map(we=>{if(Gt.has(we.name)){const Ee=vt.get(we.name);return{...we,isRegistered:!0,isModified:!1,masterSize:Ui(Ee.inputSize)??"",masterUnit:Ee.inputUnit,masterPrice:Ui(Ee.inputPrice)??"",masterCategory:Ee.inputCategory,inputCategory:Ee.inputCategory}}return we})),We===0?M.success(`${$e} `):M.warning(`:  ${$e}  /  ${We} `),p({phase:"done",total:de,processed:Ke,success:$e,failed:We,currentName:"",failedNames:ot.slice(0,10)})}catch(ie){console.error("Bulk save error:",ie),M.error(""),p(de=>({phase:"error",total:de?.total??O.length,processed:de?.processed??0,success:de?.success??0,failed:de?.failed??0,currentName:"",failedNames:de?.failedNames??[],errorMessage:ie?.message?String(ie.message):""}))}finally{u(null)}},q=()=>{const O=n.filter(ie=>ie.isModified);O.length!==0&&G({isOpen:!0,title:"",message:`${O.length} `,onConfirm:()=>F(O)})},$=(O,ie,de)=>{t(Me=>Me.map(Le=>Le.name===O?{...Le,[ie]:de,isModified:!0}:Le))},T=O=>{(O.key==="ArrowUp"||O.key==="ArrowDown")&&O.preventDefault()},I=O=>{v(ie=>ie.key===O?{key:O,direction:ie.direction==="asc"?"desc":"asc"}:{key:O,direction:"asc"})},Y=O=>y.key!==O?"":y.direction==="asc"?" ":" ",ae=b.useMemo(()=>{const O=new Map;n.forEach(de=>{const Me=g0(de.csvVendor),Le=Me===Vx?"":Me,Ke=O.get(Me);Ke?Ke.count+=1:O.set(Me,{key:Me,label:Le,count:1})});const ie=Array.from(O.values()).sort((de,Me)=>de.label.localeCompare(Me.label,"ja"));return[{key:tu,label:"",count:n.length},...ie]},[n]);b.useEffect(()=>{ae.some(ie=>ie.key===j)||N(tu)},[ae,j]),b.useEffect(()=>{if(!A)return;const O=de=>{_.current&&!_.current.contains(de.target)&&z(!1)},ie=de=>{de.key==="Escape"&&z(!1)};return document.addEventListener("mousedown",O),document.addEventListener("touchstart",O),document.addEventListener("keydown",ie),()=>{document.removeEventListener("mousedown",O),document.removeEventListener("touchstart",O),document.removeEventListener("keydown",ie)}},[A]);const ye=b.useMemo(()=>j===tu?n:n.filter(O=>g0(O.csvVendor)===j),[n,j]),U=b.useMemo(()=>{const O={[Jl]:ye.length};return ou.forEach(ie=>{O[ie.value]=0}),ye.forEach(ie=>{const de=La(ie.inputCategory);O[de]=(O[de]||0)+1}),O},[ye]),W=b.useMemo(()=>C===Jl?ye:ye.filter(O=>La(O.inputCategory)===C),[ye,C]),Z=b.useMemo(()=>({all:W.length,unregistered:W.filter(O=>!O.isRegistered).length,registered:W.filter(O=>O.isRegistered).length}),[W]),ce=b.useMemo(()=>ae.find(O=>O.key===j)||ae[0],[ae,j]),Oe=b.useMemo(()=>W.filter(O=>!(f==="unregistered"&&O.isRegistered||f==="registered"&&!O.isRegistered||x&&!O.name.includes(x))),[W,f,x]),Se=b.useMemo(()=>{if(!y.key)return Oe;const O=Me=>String(Me??""),ie=Me=>{const Le=parseFloat(Me);return Number.isFinite(Le)?Le:Number.NEGATIVE_INFINITY},de=[...Oe];return de.sort((Me,Le)=>{let Ke=0;switch(y.key){case"name":Ke=O(Me.name).localeCompare(O(Le.name),"ja");break;case"csvPrice":Ke=ie(Me.csvPrice)-ie(Le.csvPrice);break;case"inputCategory":{const $e=Hf[La(Me.inputCategory)]||"",We=Hf[La(Le.inputCategory)]||"";Ke=$e.localeCompare(We,"ja");break}case"inputSize":Ke=ie(Me.inputSize)-ie(Le.inputSize);break;case"inputUnit":Ke=O(Me.inputUnit).localeCompare(O(Le.inputUnit),"ja");break;case"inputPrice":Ke=ie(Me.inputPrice)-ie(Le.inputPrice);break;default:Ke=0;break}return Ke===0&&(Ke=O(Me.name).localeCompare(O(Le.name),"ja")),y.direction==="asc"?Ke:-Ke}),de},[Oe,y]),Re=n.filter(O=>O.isModified).length;return s?i.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):B?i.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[i.jsx("h3",{children:""}),i.jsx("p",{children:B}),i.jsx(fe,{variant:"secondary",onClick:Q,children:""})]}):i.jsxs("div",{className:"csv-importer",children:[i.jsxs("div",{className:"importer-header",children:[i.jsx(Mt,{placeholder:"...",value:x,onChange:O=>S(O.target.value),style:{maxWidth:"300px"}}),i.jsxs("div",{className:"filter-buttons",children:[i.jsxs(fe,{variant:f==="all"?"primary":"secondary",onClick:()=>m("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",Z.all,")"]}),i.jsxs(fe,{variant:f==="unregistered"?"primary":"secondary",onClick:()=>m("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",Z.unregistered,")"]}),i.jsxs(fe,{variant:f==="registered"?"primary":"secondary",onClick:()=>m("registered"),size:"sm",children:[" (",Z.registered,")"]})]}),i.jsxs("div",{className:"vendor-dropdown",ref:_,children:[i.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>z(O=>!O),"aria-haspopup":"listbox","aria-expanded":A,children:[i.jsxs("span",{children:[": ",ce?.label," (",ce?.count??0,")"]}),i.jsx("span",{className:`vendor-dropdown-chevron ${A?"open":""}`,children:""})]}),A&&i.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:ae.map(O=>i.jsxs("button",{type:"button",className:`vendor-tab ${j===O.key?"active":""}`,onClick:()=>{N(O.key),z(!1)},role:"option","aria-selected":j===O.key,children:[O.label," (",O.count,")"]},O.key))})]}),i.jsxs("div",{className:"category-filter-row",children:[i.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),i.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:C,onChange:O=>E(O.target.value),children:[i.jsxs("option",{value:Jl,children:[" (",U[Jl]||0,")"]}),ou.map(O=>i.jsxs("option",{value:O.value,children:[O.label," (",U[O.value]||0,")"]},O.value))]})]}),i.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[Re>0&&i.jsx(fe,{variant:"primary",size:"sm",onClick:q,disabled:c!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:c==="bulk"?"...":`(${Re})`}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:Q,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{style:{width:"22%"},onClick:()=>I("name"),children:[" (CSV)",Y("name")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>I("csvPrice"),children:[" (CSV)",Y("csvPrice")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>I("inputCategory"),children:[" ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputCategory")]}),i.jsxs("th",{style:{width:"18%"},onClick:()=>I("inputSize"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputSize")]}),i.jsxs("th",{style:{width:"13%"},onClick:()=>I("inputUnit"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputUnit")]}),i.jsxs("th",{style:{width:"12%"},onClick:()=>I("inputPrice"),children:[" ()",Y("inputPrice")]}),i.jsx("th",{style:{width:"7%"},children:""})]})}),i.jsx("tbody",{children:Se.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:""})}):Se.map(O=>i.jsxs("tr",{style:{backgroundColor:O.isModified?"#fff8e1":O.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[i.jsxs("td",{style:{fontWeight:"500"},children:[O.name,O.csvVendor&&i.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:O.csvVendor})]}),i.jsxs("td",{children:[O.csvPrice?`${O.csvPrice.toLocaleString()} `:"-",O.csvUnit&&i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",O.csvUnit]})]}),i.jsx("td",{children:i.jsx("select",{className:"input-field",value:La(O.inputCategory),onChange:ie=>$(O.name,"inputCategory",ie.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:ou.map(ie=>i.jsx("option",{value:ie.value,children:ie.label},ie.value))})}),i.jsx("td",{children:i.jsx(Mt,{type:"number",value:O.inputSize,onChange:ie=>$(O.name,"inputSize",ie.target.value),onKeyDown:T,placeholder:["","","","PC","","",""].includes(O.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),i.jsx("td",{children:i.jsxs("select",{className:"input-field",value:O.inputUnit,onChange:ie=>$(O.name,"inputUnit",ie.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","","","","","PC","","",""].includes(O.inputUnit)&&O.inputUnit&&i.jsxs("option",{value:O.inputUnit,children:[O.inputUnit," (CSV)"]}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"kg",children:"kg"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"L",children:"L"}),i.jsx("option",{value:"cc",children:"cc"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"PC",children:"PC"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""})]})}),i.jsx("td",{children:i.jsx(Mt,{type:"number",value:O.inputPrice,onChange:ie=>$(O.name,"inputPrice",ie.target.value),placeholder:"",style:{width:"100%"}})}),i.jsx("td",{children:i.jsx(fe,{variant:O.isRegistered?"secondary":"primary",size:"sm",onClick:()=>P(O),disabled:c===O.name||c==="bulk",block:!0,children:c===O.name?"...":O.isRegistered?"":""})})]},O.name))})]})}),i.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[i.jsx("p",{children:" CSV"}),i.jsx("p",{children:" "})]}),i.jsxs(Bn,{isOpen:k.isOpen,onClose:()=>G({...k,isOpen:!1}),title:k.title,size:"small",children:[i.jsx("div",{style:{marginBottom:"1.5rem"},children:k.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[i.jsx(fe,{variant:"secondary",onClick:()=>G({...k,isOpen:!1}),children:""}),i.jsx(fe,{variant:"primary",onClick:k.onConfirm,children:""})]})]}),i.jsx(Bn,{isOpen:!!d,onClose:V,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?i.jsxs("div",{className:"bulk-progress",children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:""}),i.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),i.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&i.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&i.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),i.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[i.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(fe,{variant:"primary",onClick:V,children:""})})]}):i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),i.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(fe,{variant:"primary",onClick:V,children:""})})]})})]})},y0=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},IN=({onBack:n})=>{const[t,s]=Qf(),{user:l}=is(),[c,u]=b.useState("price"),[d,p]=b.useState(null),[f,m]=b.useState({type:"",message:""}),[y,v]=b.useState(!1),[x,S]=b.useState([]),[C,E]=b.useState(!1),[j,N]=b.useState(null),[A,z]=b.useState({type:"",message:""}),[B,L]=b.useState(null),[_,M]=b.useState(!1),[k,G]=b.useState(!1),[V,Q]=b.useState(!1),[P,F]=b.useState([]),[q,$]=b.useState(!1),[T,I]=b.useState(""),[Y,ae]=b.useState(""),[ye,U]=b.useState(!1),[W,Z]=b.useState({total:0,done:0,current:""}),[ce,Oe]=b.useState(null),[Se,Re]=b.useState(!1),[O,ie]=b.useState(!1),[de,Me]=b.useState(new Map),[Le,Ke]=b.useState([]),[$e,We]=b.useState(""),[me,Qe]=b.useState(""),[ot,ct]=b.useState(""),mt=Ue.useMemo(()=>{if(!$e)return[];const pe=de.get($e)||[],He=new Set;return pe.forEach(Xe=>{const Ve=y0(Xe?.dateStr);Ve&&He.add(Ve)}),Array.from(He).sort((Xe,Ve)=>Ve.localeCompare(Xe))},[de,$e]);b.useEffect(()=>{if(ot){if(!$e){ct("");return}mt.length>0&&!mt.includes(ot)&&ct("")}},[mt,ot,$e]);const[ht,zt]=b.useState({key:"dateStr",direction:"desc"}),[Gt,vt]=b.useState("");b.useEffect(()=>{const pe=t.get("tab");(pe==="price"||pe==="ingredients"||pe==="csv-import"||pe==="duplicates")&&u(pe)},[]);const ne=pe=>{let He="asc";ht.key===pe&&ht.direction==="asc"&&(He="desc"),zt({key:pe,direction:He})},we=Ue.useMemo(()=>{let pe=[...x];if(Gt){const He=Gt.toLowerCase().trim();pe=pe.filter(Xe=>Xe.name&&Xe.name.toLowerCase().includes(He)||Xe.vendor&&Xe.vendor.toLowerCase().includes(He)||Xe.dateStr&&Xe.dateStr.includes(He))}return ht.key&&pe.sort((He,Xe)=>{let Ve=He[ht.key]||"",Ge=Xe[ht.key]||"";return Ve<Ge?ht.direction==="asc"?-1:1:Ve>Ge?ht.direction==="asc"?1:-1:0}),pe},[x,ht,Gt]),[Ee,Te]=b.useState([]);b.useEffect(()=>{_t()},[]);const tt=async()=>{ie(!0);try{const He=await sr.fetchPriceHistory()||new Map;Me(He);const Xe=[];for(const[Ve,Ge]of He.entries()){const At=new Set,Ct=[];if((Ge||[]).forEach(te=>{const ee=[String(te?.dateStr||""),String(te?.price??""),String(te?.incomingQty??""),String(te?.unit||""),String(te?.vendor||""),String(te?.displayName||"")].join("|");At.has(ee)||(At.add(ee),Ct.push(te))}),Ct.length<2)continue;Ct.sort((te,ee)=>String(te?.dateStr||"").localeCompare(String(ee?.dateStr||"")));const Nt=Ct[Ct.length-1]||{},Je=Ct.map(te=>Number(te?.price)).filter(te=>Number.isFinite(te)),Ut=Je.length?Math.min(...Je):null,Fe=Je.length?Math.max(...Je):null,Lt=new Set(Ct.map(te=>String(te?.dateStr||""))).size,Xt=new Set(Ct.map(te=>String(te?.displayName||""))).size;let Kt=0;for(let te=1;te<Ct.length;te++){const ee=Number(Ct[te-1]?.price),ue=Number(Ct[te]?.price);Number.isFinite(ee)&&Number.isFinite(ue)&&ee!==ue&&Kt++}Xe.push({key:Ve,name:Nt?.displayName||Ve,lastDate:Nt?.dateStr||"",lastPrice:Number.isFinite(Number(Nt?.price))?Number(Nt?.price):null,lastIncomingQty:Number.isFinite(Number(Nt?.incomingQty))?Number(Nt?.incomingQty):null,unit:Nt?.unit||"",vendor:Nt?.vendor||"",rows:Ct.length,dates:Lt,nameVariants:Xt,minPrice:Ut,maxPrice:Fe,changes:Kt})}Xe.sort((Ve,Ge)=>{const At=String(Ve?.lastDate||""),Ct=String(Ge?.lastDate||"");return At!==Ct?Ct.localeCompare(At):(Ge?.changes||0)!==(Ve?.changes||0)?(Ge?.changes||0)-(Ve?.changes||0):(Ge?.rows||0)!==(Ve?.rows||0)?(Ge?.rows||0)-(Ve?.rows||0):String(Ve?.name||"").localeCompare(String(Ge?.name||""),"ja")}),Ke(Xe),$e&&!He.has($e)&&We("")}catch(pe){console.error(pe)}finally{ie(!1)}};b.useEffect(()=>{c==="duplicates"&&tt()},[c]);const _t=async()=>{E(!0);try{const pe=await sr.getPriceListArray();S(pe);const He=await sr.getFileList();Te(He)}catch(pe){console.error("Failed to load price data",pe)}finally{E(!1)}},Tt=pe=>{pe.target.files&&pe.target.files[0]&&(p(pe.target.files[0]),m({type:"",message:""}))},en=async()=>{if(!d)return;v(!0),m({type:"info",message:"..."});const pe=await sr.uploadPriceList(d);if(pe.success){m({type:"success",message:"..."});try{const{recipeService:Xe}=await bf(async()=>{const{recipeService:At}=await Promise.resolve().then(()=>rf);return{recipeService:At}},[]),Ve=await sr.fetchPriceList(),Ge=await Xe.updateRecipeCosts(Ve);m({type:"success",message:`${Ge}`})}catch(Xe){console.error("Cost update failed",Xe),m({type:"warning",message:""})}p(null);const He=document.getElementById("csv-upload-input");He&&(He.value=""),_t()}else m({type:"error",message:`: ${pe.error.message}`});v(!1)},jn=pe=>{N({message:`${pe}
`,onConfirm:async()=>{v(!0);const He=await sr.deletePriceFile(pe);v(!1),He.success?(m({type:"success",message:""}),_t()):m({type:"error",message:`: ${He.error.message}`})}})},bt=pe=>{pe&&(L(pe),M(!0),z({type:"",message:""}))},tn=()=>{if(k)return;M(!1),L(null);const pe=document.getElementById("backup-upload-input");pe&&(pe.value="")},ln=async()=>{const pe=B;if(!(!pe||k)){G(!0),z({type:"info",message:"..."});try{const He=await pe.text(),Xe=JSON.parse(He),{recipeService:Ve}=await bf(async()=>{const{recipeService:Nt}=await Promise.resolve().then(()=>rf);return{recipeService:Nt}},void 0),Ge=await Ve.importRecipes(Xe),At=Number(Ge?.count||0),Ct=Array.isArray(Ge?.errors)?Ge.errors.length:0;z({type:Ct>0?"warning":"success",message:`: ${At}${Ct>0?` / : ${Ct}`:""}`}),M(!1),L(null)}catch(He){console.error(He),z({type:"error",message:""})}finally{G(!1);const He=document.getElementById("backup-upload-input");He&&(He.value="")}}},yn=async()=>{Q(!0),Oe(null),Z({total:0,done:0,current:""}),ae(""),I(""),Re(!1),$(!0);try{const pe=await Hi.fetchAllProfiles();F(pe||[])}catch(pe){console.error(pe),F([]),I("")}finally{$(!1)}},Un=()=>{ye||(Re(!1),Q(!1))},Vn=async()=>{if(!(!Y||ye)){U(!0),Oe({type:"info",message:"..."}),Z({total:0,done:0,current:""});try{const pe=await sr.copyPriceFilesToUser({targetUserId:Y,onProgress:({total:Ve,done:Ge,current:At})=>{Z({total:Ve||0,done:Ge||0,current:At||""})}}),He=pe?.copied?.length??0,Xe=pe?.failed?.length??0;Oe({type:Xe>0?"error":"success",message:`: ${He}${Xe>0?` / : ${Xe}`:""}`,failed:pe?.failed||[]})}catch(pe){console.error(pe),Oe({type:"error",message:`: ${String(pe?.message||pe)}`})}finally{U(!1)}}};return i.jsxs("div",{className:["dashboard-container","fade-in",c==="ingredients"||c==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[i.jsxs("div",{className:"dashboard-header",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),i.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[c==="csv-import"&&i.jsx(fe,{variant:"secondary",onClick:()=>s({view:"inventory"}),title:"",children:" "}),i.jsx(fe,{variant:"ghost",onClick:n,children:" "})]})]}),i.jsx("div",{className:"tabs-container",children:i.jsxs("div",{className:"tabs",children:[i.jsx("button",{className:`tab ${c==="price"?"active":""}`,onClick:()=>u("price"),children:" "}),i.jsx("button",{className:`tab ${c==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:" "}),i.jsx("button",{className:`tab ${c==="csv-import"?"active":""}`,onClick:()=>u("csv-import"),children:" CSV"}),i.jsx("button",{className:`tab ${c==="duplicates"?"active":""}`,onClick:()=>u("duplicates"),children:" "})]})}),c==="ingredients"?i.jsx(zN,{}):c==="csv-import"?i.jsx(LN,{}):c==="duplicates"?i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Le.length.toLocaleString(),""]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[i.jsx(Mt,{placeholder:"...",value:me,onChange:pe=>Qe(pe.target.value),style:{flex:1,fontSize:"0.9rem"}}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:tt,disabled:O,title:"",children:""})]}),i.jsx("div",{className:"dup-list",children:O?i.jsx("div",{className:"dup-empty",children:"..."}):Le.length===0?i.jsx("div",{className:"dup-empty",children:"2"}):Le.filter(pe=>{const He=String(me||"").trim();return He?String(pe?.name||"").includes(He):!0}).map(pe=>{const He=pe.key===$e,Xe=pe.minPrice!==null&&pe.maxPrice!==null&&pe.minPrice!==pe.maxPrice;return i.jsxs("button",{type:"button",className:`dup-item ${He?"active":""}`,onClick:()=>We(pe.key),children:[i.jsxs("div",{className:"dup-item-top",children:[i.jsx("div",{className:"dup-item-name",title:pe.name,children:pe.name}),Xe&&i.jsx("span",{className:"dup-badge",children:""})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[": ",pe.lastDate||"-"]}),i.jsxs("span",{children:[": ",pe.rows,""]}),i.jsxs("span",{children:[": ",pe.dates,""]})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[pe.lastPrice!==null?`${Math.round(pe.lastPrice).toLocaleString()}`:"-",pe.unit?` / ${pe.unit}`:""]}),i.jsxs("span",{children:[": ",pe.lastIncomingQty!==null?Math.round(pe.lastIncomingQty).toLocaleString():"-"]}),pe.vendor?i.jsxs("span",{title:pe.vendor,children:[": ",pe.vendor]}):i.jsx("span",{children:": -"})]}),pe.nameVariants>1&&i.jsxs("div",{className:"dup-item-note",children:[": ",pe.nameVariants,""]})]},pe.key)})})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:$e?"":""})}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsxs("select",{value:ot,onChange:pe=>ct(pe.target.value),disabled:!$e,title:$e?"":"",className:"dup-month-select",children:[i.jsx("option",{value:"",children:""}),mt.map(pe=>i.jsx("option",{value:pe,children:pe.replace("-","/")},pe))]}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:tt,disabled:O,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:(()=>{if(!$e)return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const pe=de.get($e)||[],He=new Set,Xe=[];pe.forEach(Je=>{const Ut=[String(Je?.dateStr||""),String(Je?.price??""),String(Je?.incomingQty??""),String(Je?.unit||""),String(Je?.vendor||""),String(Je?.displayName||""),String(Je?.sourceFile||"")].join("|");He.has(Ut)||(He.add(Ut),Xe.push(Je))}),Xe.sort((Je,Ut)=>String(Je?.dateStr||"").localeCompare(String(Ut?.dateStr||"")));const Ve=ot?Xe.filter(Je=>y0(Je?.dateStr)===ot):Xe,Ge=Ve.map((Je,Ut)=>{const Fe=Ut>0?Ve[Ut-1]:null,Lt=Fe?Number(Fe?.price):NaN,Xt=Number(Je?.price);let Kt=null,te=null;return Number.isFinite(Lt)&&Number.isFinite(Xt)&&(Kt=Xt-Lt,te=Lt!==0?Kt/Lt*100:null),{...Je,_diff:Kt,_pct:te}}),At=Ve.reduce((Je,Ut)=>{const Fe=Number(Ut?.incomingQty);return Je+(Number.isFinite(Fe)?Fe:0)},0),Ct=Ve.reduce((Je,Ut)=>{const Fe=Number(Ut?.incomingQty),Lt=Number(Ut?.price);return!Number.isFinite(Fe)||!Number.isFinite(Lt)?Je:Je+Fe*Lt},0),Nt=[...Ge].reverse();return i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"120px"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),i.jsx("tbody",{children:Nt.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:ot?`${ot}`:""})}):Nt.map((Je,Ut)=>{const Fe=Je?._diff,Lt=Je?._pct,Xt=Fe==null||!Number.isFinite(Fe)?"-":`${Fe>=0?"+":""}${Math.round(Fe).toLocaleString()}`,Kt=Lt==null||!Number.isFinite(Lt)?"":` (${Lt>=0?"+":""}${Lt.toFixed(1)}%)`,te=Fe==null||!Number.isFinite(Fe)?"#888":Fe>0?"#c92a2a":Fe<0?"#2b8a3e":"#666",ee=Number(Je?.price),ue=Number.isFinite(ee)?`${Math.round(ee).toLocaleString()}`:"-",je=Number(Je?.incomingQty),Ie=Number.isFinite(je)?Math.round(je).toLocaleString():"-",H=Number.isFinite(je)&&Number.isFinite(ee)?je*ee:NaN,xe=Number.isFinite(H)?`${Math.round(H).toLocaleString()}`:"-";return i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:Je?.dateStr||"-"}),i.jsx("td",{children:Je?.vendor||"-"}),i.jsx("td",{style:{fontWeight:500},children:Je?.displayName||"-"}),i.jsx("td",{className:"col-number",children:Ie}),i.jsxs("td",{className:"col-number",children:[ue,Je?.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",Je.unit]})]}),i.jsx("td",{className:"col-number",children:xe}),i.jsxs("td",{className:"col-number",style:{color:te},children:[Xt,Kt]})]},`${Je?.dateStr||"d"}-${Ut}`)})}),Nt.length>0&&i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",ot?`${ot}`:""]}),i.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(At).toLocaleString()}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),i.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(Ct).toLocaleString()]}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[i.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),i.jsx(fe,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const pe=await bf(()=>Promise.resolve().then(()=>rf),void 0).then(Ge=>Ge.recipeService.exportAllRecipes()),He=new Blob([JSON.stringify(pe,null,2)],{type:"application/json"}),Xe=URL.createObjectURL(He),Ve=document.createElement("a");Ve.href=Xe,Ve.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Ve),Ve.click(),document.body.removeChild(Ve),URL.revokeObjectURL(Xe)}catch(pe){z({type:"error",message:""}),console.error(pe)}},children:" JSON"})]}),i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),i.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:pe=>{const He=pe.target.files?.[0];He&&bt(He)}}),i.jsx(fe,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:y||k,children:" "}),A.message&&i.jsx("div",{className:`status-msg ${A.type}`,style:{marginTop:"10px"},children:A.message})]})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{className:"upload-area",children:[i.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",i.jsx("br",{}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",i.jsx("br",{})," 2: "]})]}),i.jsx("input",{type:"file",accept:".csv",onChange:Tt,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),i.jsx(fe,{variant:"primary",onClick:en,disabled:!d||y,className:"upload-btn",size:"sm",block:!0,children:y?"...":""})]}),f.message&&i.jsx("div",{className:`status-msg ${f.type}`,children:f.message})]}),l?.role==="admin"&&i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),i.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",Ee.length,""]}),i.jsx("div",{style:{marginTop:"0.75rem"},children:i.jsx(fe,{variant:"secondary",size:"sm",block:!0,onClick:yn,disabled:ye||y,title:"",children:""})})]}),i.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Ee.length,""]})]}),Ee.length===0?i.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):i.jsx("div",{className:"file-list",children:Ee.map(pe=>i.jsxs("div",{className:"file-list-item",children:[i.jsx("span",{className:"file-name",title:pe.name,children:pe.name}),i.jsx(fe,{variant:"danger",size:"sm",onClick:()=>jn(pe.name),disabled:y,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},pe.name))})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:" "}),i.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",we.length.toLocaleString()," "]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsx(Mt,{placeholder:" (, , )...",value:Gt,onChange:pe=>vt(pe.target.value),style:{width:"250px",fontSize:"0.9rem"}}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:_t,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:C?i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{onClick:()=>ne("dateStr"),style:{width:"120px"},children:[" ",ht.key==="dateStr"&&(ht.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>ne("vendor"),children:[" ",ht.key==="vendor"&&(ht.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>ne("name"),children:[" ",ht.key==="name"&&(ht.direction==="asc"?"":"")]}),i.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),i.jsx("tbody",{children:we.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",className:"no-data",children:""})}):we.map((pe,He)=>i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:pe.dateStr||"-"}),i.jsx("td",{children:pe.vendor||"-"}),i.jsx("td",{style:{fontWeight:"500"},children:pe.name}),i.jsxs("td",{className:"col-number",children:[pe.price?pe.price.toLocaleString():"-",pe.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",pe.unit]})]})]},He))})]})})]})]}),i.jsx(Bn,{isOpen:_,onClose:tn,title:" / ",size:"medium",showCloseButton:!k,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",i.jsx("br",{}),i.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:B?.name||"-"})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(fe,{variant:"ghost",onClick:tn,disabled:k,children:""}),i.jsx(fe,{variant:"primary",onClick:ln,disabled:!B||k,children:k?"...":""})]}),k&&i.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),A.message&&i.jsx("div",{className:`status-msg ${A.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:A.message})]})}),i.jsx(Bn,{isOpen:V,onClose:Un,title:"",size:"medium",showCloseButton:!ye,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",i.jsx("br",{}),i.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",i.jsx("code",{children:"_copy"})," "]})]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",i.jsx("strong",{style:{color:"#111827"},children:l?.displayId||""})," / : ",Ee.length,""]}),Se?i.jsxs(i.Fragment,{children:[(()=>{const pe=P.find(Xe=>String(Xe?.id)===String(Y)),He=pe?`${pe.display_id}${pe.email?` (${pe.email})`:""}`:Y?String(Y).slice(0,8):"-";return i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",i.jsx("strong",{children:He}),i.jsx("br",{}),": ",i.jsx("strong",{children:Ee.length.toLocaleString()})," CSV",i.jsx("br",{}),": ",i.jsx("code",{children:"_copy"})," "]})]})})(),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(fe,{variant:"ghost",onClick:()=>Re(!1),disabled:ye,children:""}),i.jsx(fe,{variant:"primary",onClick:Vn,disabled:!Y||ye,children:ye?"...":""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),q?i.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):i.jsxs("select",{value:Y,onChange:pe=>ae(pe.target.value),disabled:ye||!!T,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:ye?"#f3f4f6":"white"},children:[i.jsx("option",{value:"",children:"..."}),P.filter(pe=>String(pe?.id)&&String(pe?.id)!==String(l?.id)).map(pe=>i.jsxs("option",{value:pe.id,children:[pe.display_id,pe.email?` (${pe.email})`:"",pe.role==="admin"?" []":""]},pe.id))]}),T&&i.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:T})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(fe,{variant:"ghost",onClick:Un,disabled:ye,children:""}),i.jsx(fe,{variant:"primary",onClick:()=>Re(!0),disabled:!Y||ye||q||!!T,children:""})]})]}),ye&&i.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:W.total?`${W.done} / ${W.total}`:"..."})]})]}),i.jsx("div",{className:"bulk-progress-bar",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:W.total?`${Math.round(W.done/W.total*100)}%`:"0%"}})}),i.jsx("div",{className:"bulk-progress-current",title:W.current,children:W.current})]}),ce?.message&&i.jsx("div",{className:`status-msg ${ce.type||"info"}`,children:ce.message}),Array.isArray(ce?.failed)&&ce.failed.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",ce.failed.length,""]}),i.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:ce.failed.slice(0,10).map((pe,He)=>i.jsxs("li",{children:[pe?.file||"-",": ",pe?.errorMessage||"unknown error"]},`${pe?.file||"f"}-${He}`))}),ce.failed.length>10&&i.jsxs("div",{style:{marginTop:"6px"},children:["... ",ce.failed.length-10,""]})]})]})}),j&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>N(null),children:i.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:pe=>pe.stopPropagation(),children:[i.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),i.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:j.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx(fe,{variant:"ghost",onClick:()=>N(null),children:""}),i.jsx(fe,{variant:"danger",onClick:()=>{j.onConfirm(),N(null)},children:""})]})]})})]})},BN=({recipes:n,recentIds:t,onSelect:s})=>{if(!t||t.length===0)return null;const l=t.map(c=>n.find(u=>u.id===c)).filter(Boolean).slice(0,7);return l.length===0?null:i.jsxs("div",{className:"recent-recipes",children:[i.jsx("h3",{className:"recent-header",children:""}),i.jsx("div",{className:"recent-list",children:l.map(c=>i.jsxs("div",{className:"recent-item",onClick:()=>s(c),children:[i.jsx("div",{className:"recent-thumbnail",children:c.image?i.jsx("img",{src:c.image,alt:c.title}):i.jsx("div",{className:"recent-placeholder"})}),i.jsx("div",{className:"recent-info",children:i.jsx("div",{className:"recent-title",children:c.title})})]},c.id))})]})},$N=({onBack:n})=>(b.useEffect(()=>{window.scrollTo(0,0)},[]),i.jsxs("div",{className:"levain-guide-container",children:[i.jsxs("header",{className:"levain-guide-header",children:[i.jsx("h1",{children:"LEVAIN GUIDE"}),i.jsx("p",{className:"subtitle",children:" "}),i.jsx("p",{className:"subtitle",children:""}),i.jsx("div",{className:"divider"})]}),i.jsxs("main",{className:"levain-guide-main",children:[i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("p",{children:"Levain"}),i.jsx("h3",{children:""}),i.jsx("p",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",i.jsx("br",{}),i.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",i.jsx("br",{}),i.jsx("strong",{children:""})," Acetobacter aceti "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:["",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",i.jsx("br",{}),"(   +  + )"]}),"",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHO",i.jsx("br",{}),"(  )"]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"- 7-10"}),i.jsxs("div",{className:"timeline",children:[i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),i.jsx("p",{children:"100g + 100ml 20-22"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsx("p",{children:"100g  50g50g + 50ml"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsxs("div",{className:"success-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),i.jsx("p",{children:"1150%1:1"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 15",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," pH 3.5-4.0"]})]})]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:"(ml)"}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"2"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"5-8"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-4"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"15-18"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"3-5"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25-28"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-3"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"30"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"1"}),i.jsx("br",{}),"100g50g + 50ml"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"8-12"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"2%100ml2g"}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 12 8:00"}),i.jsx("br",{}),"50g25g + 25ml "]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  14:00"}),i.jsx("br",{}),"25g + 25ml 2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  20:00"}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:" "})," ",i.jsx("br",{}),"",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:" "})," pH",i.jsx("br",{}),"pH 3.5-4.0pH"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"18"}),i.jsx("td",{children:"16-24"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"12-16"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"24-26"}),i.jsx("td",{children:"8-12"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"28"}),i.jsx("td",{children:"4-8"}),i.jsx("td",{children:"2"})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"1"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 22",i.jsx("br",{}),"2. 12",i.jsx("br",{}),"3. 1",i.jsx("br",{}),"4. 1-2"]}),i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," pH",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," "]}),i.jsx("h3",{children:"3"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. 15",i.jsx("br",{}),"3. 80%"]}),i.jsx("h3",{children:"4"}),i.jsxs("div",{className:"success-box",children:["",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:"5"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 1:0.8",i.jsx("br",{}),"2. ",i.jsx("br",{}),"3. "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"pH"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"pH4-8.0"}),i.jsx("br",{}),i.jsx("br",{})," pH 7.0",i.jsx("br",{})," pH 4.5-5.5",i.jsx("br",{})," pH 3.5-4.0",i.jsx("br",{})," pH 3.0"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:"pH 3.8-4.0"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 3.5"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 4.5"})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 1",i.jsx("br",{})," ",i.jsx("br",{})," -203"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"15-20"}),i.jsx("td",{children:"18-20"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25+"}),i.jsx("td",{children:"22-24"}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"18-22"}),i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"5-15"}),i.jsx("td",{children:"18"}),i.jsx("td",{children:"2-3"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 24",i.jsx("br",{})," ",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 18",i.jsx("br",{})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"100g + 50g + 150ml 12-24",i.jsx("br",{}),"11-2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"100ml"}),i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," pH3.5-4.0",i.jsx("br",{})," 0.5-1.5%",i.jsx("br",{})," 0.3-0.8%"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"15-25% ()"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"5-15%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"20-30%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"30-50%"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"formula",children:[" 18   - 8",i.jsx("br",{}),i.jsx("br",{}),"",i.jsx("br",{})," 2018  (20-8) = 1.5",i.jsx("br",{})," 2418  (24-8) = 1.125",i.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),i.jsxs("footer",{className:"levain-footer",children:[i.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),i.jsx("p",{children:""})]}),i.jsxs("button",{className:"levain-back-button",onClick:n,children:[i.jsx("span",{children:""})," "]})]})),qN=({onBack:n})=>{const{user:t,patchCurrentUserProfile:s}=is(),[l,c]=b.useState([]),[u,d]=b.useState(!0),[p,f]=b.useState(null),[m,y]=b.useState(null),[v,x]=b.useState(""),[S,C]=b.useState(""),[E,j]=b.useState(""),[N,A]=b.useState(""),[z,B]=b.useState(!1),[L,_]=b.useState(!1),[M,k]=b.useState(new Set);b.useEffect(()=>{G()},[]);const G=async()=>{try{d(!0);const $=await Hi.fetchAllProfiles();c($)}catch($){console.error($),f("")}finally{d(!1)}},V=l.filter($=>$.role==="admin"),Q=l.filter($=>$.role!=="admin"),P=($,T)=>{k(I=>{const Y=new Set(I);return T?Y.add($):Y.delete($),Y})},F=async($,T)=>{const I=!!$.show_master_recipes;f(null),c(Y=>Y.map(ae=>ae.id===$.id?{...ae,show_master_recipes:T}:ae)),$.id===t?.id&&s?.({showMasterRecipes:T}),P($.id,!0);try{const ae=!!(await Hi.updateProfile($.id,{show_master_recipes:T}))?.show_master_recipes;c(ye=>ye.map(U=>U.id===$.id?{...U,show_master_recipes:ae}:U)),$.id===t?.id&&s?.({showMasterRecipes:ae})}catch(Y){console.error(Y),c(ae=>ae.map(ye=>ye.id===$.id?{...ye,show_master_recipes:I}:ye)),$.id===t?.id&&s?.({showMasterRecipes:I}),f("RLS")}finally{P($.id,!1)}},q=({user:$,isAdmin:T})=>i.jsxs(xn,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[$.display_id," ",T&&i.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),$.email&&i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:$.email}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date($.created_at).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",$.updated_at?new Date($.updated_at).toLocaleString():"---"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:$.show_master_recipes||!1,disabled:M.has($.id),onChange:I=>F($,I.target.checked)}),""]}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>{y({id:$.id,display_id:$.display_id,email:$.email}),x(""),C(""),j(""),A("")},style:{whiteSpace:"nowrap"},children:""})]})]},$.id);return i.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",height:"100%",overflowY:"auto"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[i.jsx("h2",{children:""}),i.jsx(fe,{variant:"ghost",onClick:n,children:""})]}),p&&i.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:p}),u?i.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[V.length>0&&i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:V.map($=>i.jsx(q,{user:$,isAdmin:!0},$.id))})]}),i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Q.length>0?Q.map($=>i.jsx(q,{user:$,isAdmin:!1},$.id)):i.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),i.jsx(Bn,{isOpen:!!m,onClose:()=>{z||y(null)},title:": ",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[i.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",m?.display_id||m?.email||m?.id]}),m?.email&&i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:m.email}),i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),E&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:E}),N&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:N}),i.jsxs("div",{style:{display:"grid",gap:"10px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:v,onChange:$=>x($.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:S,onChange:$=>C($.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[i.jsx(fe,{variant:"ghost",onClick:()=>y(null),disabled:z,children:""}),i.jsx(fe,{variant:"secondary",isLoading:L,disabled:!m?.email||z,onClick:async()=>{if(j(""),A(""),!m?.email){j("");return}_(!0);try{await Hi.sendPasswordResetEmail(m.email),A("")}catch($){console.error($),j($?.message||"")}finally{_(!1)}},style:{whiteSpace:"nowrap"},children:""}),i.jsx(fe,{variant:"danger",isLoading:z,onClick:async()=>{if(j(""),A(""),!!m?.id){if(!v||v.length<8){j("8");return}if(v!==S){j("");return}B(!0);try{await Hi.adminResetPassword(m.id,v),A(""),x(""),C("")}catch($){console.error($);const T=$?.message||"";/FunctionsHttpError|not found|404/i.test(T)||/admin-reset-password/i.test(T)?j(""):j(T)}finally{B(!1)}}},children:""})]})]})})]})},Es="inventory_items",Li="inventory_snapshots",Zl="deleted_inventory_snapshots",Ia=(n,t)=>{const s=String(n?.message||"");return String(n?.code||"")==="42703"?s.toLowerCase().includes(String(t).toLowerCase()):s.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&s.toLowerCase().includes("does not exist")},er={getAll:async n=>{if(!n)return[];const{data:t,error:s}=await De.from(Es).select("*").eq("user_id",n).order("created_at",{ascending:!0});return s?(console.error("Error fetching inventory:",s),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:s,isPhantom:l,_master:c,_csv:u,...d}=t,p=t?.tax10_override??t?.tax10Override,f={...d,user_id:n,tax10:!!t.tax10,tax10_override:!!p,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0},m=async x=>De.from(Es).insert([x]).select().single();let{data:y,error:v}=await m(f);if(v){const x=Ia(v,"tax10"),S=Ia(v,"tax10_override");if(x||S){const C={...f};x&&delete C.tax10,S&&delete C.tax10_override,{data:y,error:v}=await m(C)}}if(v)throw console.error("Error adding item:",v),v;return y},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:s,isPhantom:l,created_at:c,_master:u,_csv:d,...p}=t,f=t?.tax10_override??t?.tax10Override,m={...p,tax10:!!t.tax10,tax10_override:!!f,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()},y=async S=>De.from(Es).update(S).eq("id",t.id).eq("user_id",n).select().single();let{data:v,error:x}=await y(m);if(x){const S=Ia(x,"tax10"),C=Ia(x,"tax10_override");if(S||C){const E={...m};S&&delete E.tax10,C&&delete E.tax10_override,{data:v,error:x}=await y(E)}}if(x)throw console.error("Error updating item:",x),x;return v},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:s}=await De.from(Es).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error deleting item:",s),s},adjustStock:async(n,t,s)=>{if(!n)throw new Error("User ID is required");const{data:l,error:c}=await De.from(Es).select("quantity").eq("id",t).eq("user_id",n).single();if(c||!l)throw new Error("Item not found");const u=Math.max(0,(l.quantity||0)+s),{data:d,error:p}=await De.from(Es).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(p)throw p;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await De.from(Es).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:s}=await De.from("ignored_items").select("name").eq("user_id",n);return s?(console.error("Error fetching ignored items:",s),new Set):new Set(t.map(l=>l.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:s}=await De.from("ignored_items").insert([{user_id:n,name:t}]).select();if(s&&s.code!=="23505")throw console.error("Error ignoring item:",s),s},getSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await De.from(Li).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return s?(console.error("Error fetching snapshots:",s),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await De.from(Zl).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return s?(console.error("Error fetching deleted snapshots:",s),[]):t||[]},createSnapshot:async(n,t,s,l)=>{if(!n)throw new Error("User ID is required");let c=null,u=null;const d=await De.from(Li).insert([{user_id:n,title:t,items:s,total_value:l,snapshot_date:new Date().toISOString()}]).select().single();if(c=d.data??null,u=d.error??null,u&&Ia(u,"user_id")){const p=await De.from(Li).insert([{title:t,items:s,total_value:l,snapshot_date:new Date().toISOString()}]).select().single();c=p.data??null,u=p.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return c},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:s,error:l}=await De.from(Li).select("*").eq("id",t).eq("user_id",n).single();if(l||!s)throw console.error("Error fetching snapshot for delete:",l),l||new Error("Snapshot not found");const{error:c}=await De.from(Zl).insert([{original_id:s.id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at,deleted_at:new Date().toISOString()}]);if(c)throw console.error("Error moving snapshot to trash:",c),c;const{error:u}=await De.from(Li).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:s,error:l}=await De.from(Zl).select("*").eq("id",t).eq("user_id",n).single();if(l||!s)throw console.error("Error fetching deleted snapshot:",l),l||new Error("Deleted snapshot not found");let c=null;{const{error:d}=await De.from(Li).insert([{id:s.original_id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);c=d}if(c){const{error:d}=await De.from(Li).insert([{user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await De.from(Zl).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:s}=await De.from(Zl).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error hard deleting snapshot from trash:",s),s;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await De.from(Es).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(Ia(t.error,"user_id")){const s=await De.from(Es).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(s.error)throw console.error("Error resetting quantities (fallback):",s.error),s.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},qi=n=>{const t=String(n??"").trim();if(!t)return"";const s=t.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s},PN=(n,t)=>{const s=qi(n),l=qi(t);if(!s||!l)return null;if(s===l)return 1;if(s==="kg"&&l==="g")return 1e3;if(s==="g"&&l==="kg")return 1/1e3;const c=s==="cc"?"ml":s,u=l==="cc"?"ml":l;return c==="l"&&u==="ml"?1e3:c==="ml"&&u==="l"?1/1e3:null},HN=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},eo=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},FN=({item:n,isLowStock:t,onUpdateQuantity:s,onDelete:l,onToggleTax:c,onEdit:u,onRequestUnitSync:d})=>{const[p,f]=Ue.useState(n.quantity===""?"":parseFloat(n.quantity)||0),m=F=>{const q=String(F||"").trim();return q?q==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(q)?q:"":""},y={food:"",alcohol:"",soft_drink:"",supplies:""};Ue.useEffect(()=>{f(n.quantity===""?"":parseFloat(n.quantity)||0)},[n.quantity]);const v=parseFloat(n.price)||0,x=(()=>{if(!Number.isFinite(v)||v<=0)return"-";const F=n?._csv?.unit,q=String(F||"").trim(),$=String(n?.unit||"").trim();if(!q)return`${eo(v)}`;const T=qi($),I=qi(q);if(I===T)return`${eo(v)}/${q}`;const Y=PN(I,T);if(Y!==null)return`${eo(v*Y)}/${q}`;const ae=parseFloat(n?._master?.packetSize),ye=String(n?._master?.packetUnit||"").trim(),U=qi(ye);return HN(q)&&Number.isFinite(ae)&&ae>0&&U===T?`${eo(v*ae)}/${q}`:`${eo(v)}/${$||"-"}`})(),S=m(n?._master?.itemCategory),C=S==="alcohol"||S==="supplies",E=n?.tax10_override===!0||n?.tax10_override===1||n?.tax10_override==="1"||n?.tax10_override==="true",j=S?E?n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true":C:n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true",N=S?E?`${y[S]||S}: ${C?"10%":"8%"}/ `:`${y[S]||S}${j?"10%":"8%"}`:"10%",A=j?1.1:1.08,z=p===""?0:parseFloat(p),B=v*z*A,L=Ue.useMemo(()=>{const F=n?._master?.packetSize,q=n?._master?.packetUnit,$=parseFloat(F);return!Number.isFinite($)||$<=0?"-":`${Number.isInteger($)?$.toLocaleString():$.toLocaleString(void 0,{maximumFractionDigits:3})}${q?String(q):""}`},[n?._master?.packetSize,n?._master?.packetUnit]),_=()=>{const F=parseFloat(p);!isNaN(F)&&F!==n.quantity&&s(n.id,F)},M=F=>{F&&setTimeout(()=>{try{F.select()}catch{}},0)},k=F=>{const $=F?.closest?.("table")||document;return Array.from($.querySelectorAll("input.inventory-quantity-input"))},G=(F,q)=>{const $=k(F).filter(Y=>!Y.disabled),T=$.indexOf(F);if(T<0)return!1;const I=$[T+q];return I?(requestAnimationFrame(()=>{try{I.scrollIntoView({block:"nearest"})}catch{}I.focus(),M(I)}),!0):!1},V=F=>{if(F.key==="Enter"){F.preventDefault(),G(F.currentTarget,F.shiftKey?-1:1),F.currentTarget.blur();return}F.key==="Tab"&&G(F.currentTarget,F.shiftKey?-1:1)&&(F.preventDefault(),F.currentTarget.blur())},Q=n?._master?.packetUnit||"",P=!!Q&&qi(Q)!==qi(n?.unit);return i.jsxs("tr",{className:t(n)?"low-stock":"",children:[i.jsx("td",{style:{textAlign:"center"},children:i.jsx("input",{type:"checkbox",checked:j,onChange:F=>c&&c(n,F.target.checked),title:N,className:"inventory-tax-checkbox"})}),i.jsxs("td",{children:[n.name,t(n)&&i.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),i.jsx("td",{style:{textAlign:"right"},children:x}),i.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:L}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[i.jsx("input",{type:"text",inputMode:"decimal",value:p,onChange:F=>f(qx(F.target.value)),className:"inventory-quantity-input no-print",onBlur:_,onKeyDown:V,onFocus:F=>M(F.target),onClick:F=>M(F.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),i.jsx("span",{className:"print-only",style:{display:"none"},children:p})]}),i.jsx("td",{children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:n.unit}),P&&typeof d=="function"&&i.jsx("button",{type:"button",onClick:()=>d(n),title:`${Q}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),i.jsx("td",{style:{textAlign:"right"},children:B>0?`${Math.round(B).toLocaleString()}`:"-"}),i.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:n.vendor||"-"}),i.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof u=="function"&&i.jsx("button",{type:"button",onClick:()=>u(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),i.jsx("button",{onClick:()=>l(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},GN=({items:n,loading:t,onDelete:s,onUpdateQuantity:l,onToggleTax:c,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:p,isOver:f}=Oo({id:"inventory-list-droppable"}),m=C=>C.threshold>0&&C.quantity<=C.threshold,[y,v]=Ue.useState({key:null,direction:"asc"}),x=C=>{v(E=>E.key===C?{key:C,direction:E.direction==="asc"?"desc":"asc"}:{key:C,direction:"asc"})},S=Ue.useMemo(()=>{if(!y.key)return n;const C=[...n];return y.key==="vendor"&&C.sort((E,j)=>{const N=(E?.vendor||"").toString(),A=(j?.vendor||"").toString(),z=N.localeCompare(A,"ja");if(z!==0)return y.direction==="asc"?z:-z;const B=(E?.name||"").toString(),L=(j?.name||"").toString(),_=B.localeCompare(L,"ja");return y.direction==="asc"?_:-_}),C},[n,y]);return i.jsxs("div",{ref:p,className:`inventory-list-droppable ${f?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:f?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[i.jsx("div",{className:"inventory-table-container",children:t?i.jsx("p",{children:"Loading..."}):i.jsxs("table",{className:"inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"}),i.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),i.jsx("th",{style:{width:"40px"}})]})}),i.jsxs("tbody",{children:[S.map(C=>i.jsx(FN,{item:C,isLowStock:m,onUpdateQuantity:l,onEdit:u,onDelete:s,onToggleTax:c,onRequestUnitSync:d},C.id)),S.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"9",style:{textAlign:"center",color:"#888",padding:"2rem"},children:f?"":""})})]}),i.jsx("tfoot",{children:(()=>{const C=n.reduce((E,j)=>{const N=parseFloat(j.price)||0,A=j.quantity===""?0:parseFloat(j.quantity)||0,z=j?.tax10===!0||j?.tax10===1||j?.tax10==="1"||j?.tax10==="true"?1.1:1.08,B=N*A;return E.net+=B,E.taxed+=B*z,E},{net:0,taxed:0});return i.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[i.jsx("td",{colSpan:"6",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(C.net).toLocaleString()," / ",Math.round(C.taxed).toLocaleString()]}),i.jsx("td",{colSpan:"2"})]})})()})]})}),f&&i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},VN=({onBack:n})=>{const{user:t}=is(),s=t?.id,[,l]=Qf(),[c,u]=b.useState([]),[d,p]=b.useState([]),[f,m]=b.useState([]),[y,v]=b.useState([]),[x,S]=b.useState(new Map),[C,E]=b.useState(new Map),[j,N]=b.useState(new Set),[A,z]=b.useState(!0),[B,L]=b.useState(""),[_,M]=b.useState(!1),[k,G]=b.useState(null),[V,Q]=b.useState(!1),[P,F]=b.useState(null),[q,$]=b.useState(!1),[T,I]=b.useState(!1),[Y,ae]=b.useState(""),[ye,U]=b.useState(!1),[W,Z]=b.useState(!0),[ce,Oe]=b.useState(!1),[Se,Re]=b.useState(null),[O,ie]=b.useState("history"),[de,Me]=b.useState(null),[Le,Ke]=b.useState(""),[$e,We]=b.useState(!1),[me,Qe]=b.useState(null),[ot,ct]=b.useState(!0),[mt,ht]=b.useState({key:"name",direction:"asc"}),[zt,Gt]=b.useState(!1),[vt,ne]=b.useState(null),[we,Ee]=b.useState(new Set),[Te,tt]=b.useState(!1),[_t,Tt]=b.useState(null),[en,jn]=b.useState(null),[bt,tn]=b.useState(!1),ln=Ja(gr(Ru,{activationConstraint:{distance:8}})),[yn,Un]=b.useState("all"),[Vn,pe]=b.useState(new Set),[He,Xe]=b.useState(""),[Ve,Ge]=b.useState(""),[At,Ct]=b.useState({}),[Nt,Je]=b.useState(""),Ut=({row:D,onVendorClick:X,isSelected:se})=>{const{attributes:ve,listeners:ke,setNodeRef:Ae,setActivatorNodeRef:Be,transform:Pe,transition:Ye,isDragging:nt}=tl({id:D.vendor,data:{type:"summary-row"}}),lt={transform:Rr.Transform.toString(Pe),transition:Ye,opacity:nt?.6:1};return i.jsxs("tr",{ref:Ae,style:lt,...ve,className:se?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[i.jsx("td",{className:"inventory-summary__drag",children:i.jsx("span",{ref:Be,...ke,className:"inventory-summary__drag-handle",title:"",children:""})}),i.jsx("td",{children:i.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>X?.(D.vendor),"aria-expanded":!!se,children:[i.jsx("span",{children:D.vendor}),i.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:se?"":""})]})}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(D.total||0).toLocaleString()]})]})};b.useEffect(()=>{s&&(Un("all"),L(""),Fe())},[s]);const Fe=async(D=!1)=>{D||z(!0);try{const[X,se,ve,ke,Ae,Be,Pe]=await Promise.all([er.getAll(s),sr.getPriceListArray(),er.getIgnoredItems(s),er.getSnapshots(s),er.getDeletedSnapshots(s),qn.getAllConversions(),bu.getAll(s)]);u(X),v(se),N(ve),p(ke||[]),m(Ae||[]),S(Be||new Map),E(Pe||new Map);const Ye=qe=>{if(!qe)return-1;const fn=new Date(qe).getTime();return Number.isFinite(fn)?fn:-1},nt=(qe,ft)=>{const fn=Math.max(Ye(qe?.updated_at),Ye(qe?.updatedAt),Ye(qe?.created_at),Ye(qe?.createdAt)),cn=Math.max(Ye(ft?.updated_at),Ye(ft?.updatedAt),Ye(ft?.created_at),Ye(ft?.createdAt));return fn!==cn&&cn>fn?ft:qe},lt=new Map;(X||[]).forEach(qe=>{const ft=String(qe?.vendor??"").trim()||"__no_vendor__",fn=hn(qe?.name)||String(qe?.name??"").trim();if(!fn)return;const cn=`${ft}@@${fn}`,$s=lt.get(cn);if(!$s){lt.set(cn,qe);return}lt.set(cn,nt($s,qe))});const dt=new Set(Array.from(lt.values()).map(qe=>qe.id));pe(dt)}catch(X){console.error("Failed to load data:",X)}finally{D||z(!1)}},Lt=D=>{if(!D)return"-";const X=new Date(D);if(Number.isNaN(X.getTime()))return String(D);const se=X.getFullYear(),ve=String(X.getMonth()+1).padStart(2,"0"),ke=String(X.getDate()).padStart(2,"0"),Ae=String(X.getHours()).padStart(2,"0"),Be=String(X.getMinutes()).padStart(2,"0");return`${se}/${ve}/${ke} ${Ae}:${Be}`},Xt=D=>{const X=D?.items;return Array.isArray(X)?X:X?[]:[]},Kt=D=>{const X=D?.snapshot_date||D?.created_at;if(!X)return null;const se=new Date(X);return Number.isNaN(se.getTime())?null:se},te=Ue.useMemo(()=>new Set([""]),[]),ee=D=>{const X=String(D??"").trim();return te.has(X)},ue=D=>D===!0||D===1||D==="1"||D==="true",je=D=>{const X=String(D??"").trim();if(!X)return"";const se=X.toLowerCase();return se===""?"g":se===""?"ml":se===""?"cc":se===""?"kg":se===""?"l":se},Ie=(D,X)=>{const se=parseFloat(D?.lastPrice),ve=parseFloat(D?.packetSize),ke=je(D?.packetUnit),Ae=je(X||ke);if(!Number.isFinite(se)||!Number.isFinite(ve)||ve<=0||!ke)return null;const Be=se/ve;if(Ae===ke)return Be;if(ke==="g"&&Ae==="kg")return Be*1e3;if(ke==="kg"&&Ae==="g")return Be/1e3;const Pe=ke==="cc"?"ml":ke,Ye=Ae==="cc"?"ml":Ae;return Pe==="ml"&&Ye==="l"?Be*1e3:Pe==="l"&&Ye==="ml"?Be/1e3:null},H=(D,X)=>{const se=je(D),ve=je(X);if(!se||!ve)return null;if(se===ve)return 1;if(se==="kg"&&ve==="g")return 1e3;if(se==="g"&&ve==="kg")return 1/1e3;const ke=se==="cc"?"ml":se,Ae=ve==="cc"?"ml":ve;return ke==="l"&&Ae==="ml"?1e3:ke==="ml"&&Ae==="l"?1/1e3:null},xe=D=>{const X=String(D||"").trim();return X?X==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(X)?X:"":""},_e=D=>{const X=xe(D);return X==="alcohol"||X==="supplies"},et=D=>{const X=xe(D);return X==="food"?"":X==="alcohol"||X==="soft_drink"?"":X==="supplies"?"":""},wt=D=>{const X=xe(D);return X==="food"?"food":X==="alcohol"||X==="soft_drink"?"drink":X==="supplies"?"supplies":"unknown"},Qt=D=>D==="food"?"":D==="drink"?"":D==="supplies"?"":"",ze=D=>ue(D?.tax10)?1.1:1.08,xt=D=>D?`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}`:"",Ft=D=>{if(!D)return-1;const se=new Date(D).getTime();return Number.isFinite(se)?se:-1},Rn=D=>{const X=[D?.updated_at,D?.updatedAt,D?.created_at,D?.createdAt];for(const se of X){const ve=Ft(se);if(ve>=0)return ve}return-1},St=Ue.useMemo(()=>{const D=new Map;return d.forEach(X=>{const se=Kt(X);if(!se)return;const ve=xt(se);D.has(ve)||D.set(ve,{key:ve,year:se.getFullYear(),month:se.getMonth()+1})}),Array.from(D.values()).sort((X,se)=>se.key.localeCompare(X.key)).map(X=>({...X,label:`${X.year}${X.month}`}))},[d]);b.useEffect(()=>{if(St.length===0){He&&Xe("");return}if(He&&St.some(se=>se.key===He))return;const D=xt(new Date),X=St.find(se=>se.key===D)?.key||St[0].key;Xe(X)},[St,He]),b.useEffect(()=>{if(St.length===0){Ve&&Ge("");return}if(Ve&&St.some(se=>se.key===Ve))return;const D=xt(new Date),X=St.find(se=>se.key===D)?.key||St[0].key;Ge(X)},[St,Ve]);const on=Ue.useMemo(()=>{if(!Ve)return null;const[D,X]=Ve.split("-"),se=parseInt(D,10),ve=parseInt(X,10);if(!Number.isFinite(se)||!Number.isFinite(ve))return null;const ke=Pe=>String(Pe).padStart(2,"0"),Ae=new Date(se,ve-1,1),Be=new Date(se,ve,0);return{year:se,month:ve,start:Ae,end:Be,rangeLabel:`${se}/${ke(ve)}/01${se}/${ke(ve)}/${ke(Be.getDate())}`}},[Ve]),Yn=Ue.useMemo(()=>Ve?d.map(D=>({snapshot:D,date:Kt(D)})).filter(D=>D.date&&xt(D.date)===Ve).sort((D,X)=>X.date-D.date).map(D=>D.snapshot):d,[d,Ve]),qt=Ue.useMemo(()=>{if(!He)return null;const[D,X]=He.split("-"),se=parseInt(D,10),ve=parseInt(X,10);if(!Number.isFinite(se)||!Number.isFinite(ve))return null;const ke=Pe=>String(Pe).padStart(2,"0"),Ae=new Date(se,ve-1,1),Be=new Date(se,ve,0);return{year:se,month:ve,start:Ae,end:Be,rangeLabel:`${se}/${ke(ve)}/01${se}/${ke(ve)}/${ke(Be.getDate())}`}},[He]),Ms=Ue.useMemo(()=>He?d.map(D=>({snapshot:D,date:Kt(D)})).filter(D=>D.date&&xt(D.date)===He).sort((D,X)=>X.date-D.date).map(D=>D.snapshot):[],[d,He]),ar=Ms[0]||null,yr=He||(ar?.id?`snapshot:${ar.id}`:""),qr=Ue.useMemo(()=>{const D=new Map;return Ms.forEach(X=>{const se=Kt(X)?.getTime()||-1;Xt(X).forEach((ke,Ae)=>{const Be=(ke?.vendor||"").toString().trim();if(ee(Be))return;const Pe=Be||"",Ye=String(ke?.name||"").trim();if(!Ye)return;const nt=`${Pe}::${Ye}`,lt={item:{...ke,vendor:Pe},snapshotMs:se,itemUpdatedMs:Rn(ke),rowIndex:Ae},dt=D.get(nt);if(!dt){D.set(nt,lt);return}if(lt.snapshotMs!==dt.snapshotMs){lt.snapshotMs>dt.snapshotMs&&D.set(nt,lt);return}if(lt.itemUpdatedMs!==dt.itemUpdatedMs){lt.itemUpdatedMs>dt.itemUpdatedMs&&D.set(nt,lt);return}lt.rowIndex>=dt.rowIndex&&D.set(nt,lt)})}),Array.from(D.values()).map(X=>X.item)},[Ms,ee]),Yi=Ue.useMemo(()=>{const D=new Map;return qr.forEach(X=>{const se=(X?.vendor||"").toString().trim(),ve=se||"";if(ee(se))return;const ke=parseFloat(X?.price)||0,Ae=X?.quantity===""?0:parseFloat(X?.quantity)||0,Be=ke*Ae,Pe=Be*ze(X),Ye=D.get(ve)||{vendor:ve,net:0,taxed:0};Ye.net+=Be,Ye.taxed+=Pe,D.set(ve,Ye)}),Array.from(D.values()).map(X=>({vendor:X.vendor,net:X.net,taxed:X.taxed,total:X.taxed}))},[qr,ee,ze]),as=Ue.useMemo(()=>{const D=new Map;return Yi.forEach(X=>{D.set(X.vendor,X)}),D},[Yi]),nl=Ue.useMemo(()=>{const D=new Map;try{for(const[X,se]of(x||new Map).entries()){const ve=String(X??"").trim();ve&&D.set(ve,se)}}catch{}return D},[x]),rl=Ue.useCallback(D=>{const X=xe(D?.itemCategory??D?.item_category);if(X)return X;const se=String(D?.name??"").trim();if(!se)return"";const ve=nl.get(se);return xe(ve?.itemCategory??ve?.item_category)},[nl]),Ki=Ue.useMemo(()=>{const D=new Map;qr.forEach((X,se)=>{const ve=(X?.vendor||"").toString().trim(),ke=ve||"";if(ee(ve))return;const Ae=parseFloat(X?.price)||0,Be=X?.quantity===""?0:parseFloat(X?.quantity)||0,Pe=Ae*Be,Ye=Pe*ze(X),nt=rl(X),lt=wt(nt),dt=D.get(ke)||{vendor:ke,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};dt.totals[lt]+=Ye,dt.totals.net+=Pe,dt.totals.taxed+=Ye,dt.rows.push({id:X?.id||`${ke}-${X?.name||"item"}-${se}`,name:X?.name||"",unit:X?.unit||"",quantity:Be,price:Ae,taxed:Ye,itemCategory:nt,breakdownKey:lt}),D.set(ke,dt)});for(const X of D.values())X.rows.sort((se,ve)=>{const ke={food:0,drink:1,unknown:2,supplies:3},Ae=ke[se?.breakdownKey]??2,Be=ke[ve?.breakdownKey]??2;if(Ae!==Be)return Ae-Be;const Pe=(se?.name||"").toString(),Ye=(ve?.name||"").toString();return Pe.localeCompare(Ye,"ja")});return D},[qr,ee,ze,rl]),zs=Ue.useMemo(()=>Yi.slice().sort((D,X)=>X.taxed!==D.taxed?X.taxed-D.taxed:D.vendor.localeCompare(X.vendor,"ja")).map(D=>D.vendor),[Yi]),cr=Ue.useMemo(()=>{if(!yr)return zs;const D=At[yr],X=new Set(as.keys()),se=Array.isArray(D)?D.filter(ke=>X.has(ke)):[],ve=zs.filter(ke=>!se.includes(ke));return[...se,...ve]},[At,yr,zs,as]),Kn=Ue.useMemo(()=>cr.map(D=>as.get(D)).filter(Boolean),[cr,as]),sl=Kn.reduce((D,X)=>(D.net+=X.net||0,D.taxed+=X.taxed||0,D),{net:0,taxed:0});b.useEffect(()=>{Nt&&(as.has(Nt)||Je(""))},[Nt,as]);const Uu=D=>{Je(X=>X===D?"":D)},il=D=>{D?.id&&s&&(We(!1),Qe(null),Ke(""),Me({title:"",message:`${D.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{We(!0),Qe({type:"move",id:D.id});try{await er.deleteSnapshotToTrash(s,D.id),await Fe(!0),Tt({title:"",message:"",type:"success"})}catch(X){console.error(X),Tt({title:"",message:"()",type:"error"})}finally{We(!1),Qe(null),Me(null)}}}))},Mo=D=>{D?.id&&s&&(We(!1),Qe(null),Ke(""),Me({title:"",message:`${D.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{We(!0),Qe({type:"restore",id:D.id});try{await er.restoreSnapshotFromTrash(s,D.id),await Fe(!0),Tt({title:"",message:"",type:"success"})}catch(X){console.error(X),Tt({title:"",message:"",type:"error"})}finally{We(!1),Qe(null),Me(null)}}}))},Qi=D=>{D?.id&&s&&(We(!1),Qe(null),Ke(""),Me({title:" ",message:`${D.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{We(!0),Qe({type:"hard-delete",id:D.id});try{await er.hardDeleteSnapshotFromTrash(s,D.id),await Fe(!0),Tt({title:"",message:"",type:"success"})}catch(X){console.error(X),Tt({title:"",message:"",type:"error"})}finally{We(!1),Qe(null),Me(null)}}}))},al=D=>{if(!D)return;const X=Xt(D).filter(qe=>!ee(qe?.vendor)),se=["","","","","()",""],ve=X.map(qe=>{const ft=parseFloat(qe?.price)||0,fn=qe?.quantity===""?0:parseFloat(qe?.quantity)||0,cn=Math.round(ft*fn*ze(qe));return[qe?.name??"",ft||"",qe?.unit??"",qe?.quantity??"",cn||"",qe?.vendor??""]}),ke=qe=>{const ft=String(qe??"");return ft.includes(",")||ft.includes('"')||ft.includes(`
`)||ft.includes("\r")?`"${ft.replace(/"/g,'""')}"`:ft},Ae=[se.map(ke).join(","),...ve.map(qe=>qe.map(ke).join(","))].join(`
`),Be=new Uint8Array([239,187,191]),Pe=new Blob([Be,Ae],{type:"text/csv"}),Ye=URL.createObjectURL(Pe),nt=(D.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),lt=(D.snapshot_date?new Date(D.snapshot_date):new Date).toISOString().slice(0,10),dt=document.createElement("a");dt.href=Ye,dt.download=`InventorySnapshot_${lt}_${nt}.csv`,document.body.appendChild(dt),dt.click(),document.body.removeChild(dt),URL.revokeObjectURL(Ye)},ur=()=>{if(!ar)return;const D=["","()"],X=Kn.map(qe=>[qe.vendor,Math.round(qe.total||0)]),se=qe=>{const ft=String(qe??"");return ft.includes(",")||ft.includes('"')||ft.includes(`
`)||ft.includes("\r")?`"${ft.replace(/"/g,'""')}"`:ft},ve=[D.map(se).join(","),...X.map(qe=>qe.map(se).join(","))].join(`
`),ke=new Uint8Array([239,187,191]),Ae=new Blob([ke,ve],{type:"text/csv"}),Be=URL.createObjectURL(Ae),Pe=(ar.snapshot_date?new Date(ar.snapshot_date):new Date).toISOString().slice(0,10),Ye=ar.title||"inventory_summary",nt=qt?`${qt.year}${String(qt.month).padStart(2,"0")}`:Pe,lt=Ye.toString().replace(/[\\/:*?"<>|]/g,"_"),dt=document.createElement("a");dt.href=Be,dt.download=`InventorySummary_${nt}_${lt}.csv`,document.body.appendChild(dt),dt.click(),document.body.removeChild(dt),URL.revokeObjectURL(Be)},ll=D=>{if(!D?.vendor)return;const X=["","","","","","()",""],se=(D.rows||[]).map(qe=>{const ft=qe.itemCategory?et(qe.itemCategory):Qt(qe.breakdownKey);return[qe.name||"",ft,Math.round(qe.price||0),qe.unit||"",Number(qe.quantity||0),Math.round(qe.taxed||0),D.vendor]}),ve=qe=>{const ft=String(qe??"");return ft.includes(",")||ft.includes('"')||ft.includes(`
`)||ft.includes("\r")?`"${ft.replace(/"/g,'""')}"`:ft},ke=[X.map(ve).join(","),...se.map(qe=>qe.map(ve).join(","))].join(`
`),Ae=new Uint8Array([239,187,191]),Be=new Blob([Ae,ke],{type:"text/csv"}),Pe=URL.createObjectURL(Be),Ye=(ar?.snapshot_date?new Date(ar.snapshot_date):new Date).toISOString().slice(0,10),nt=qt?`${qt.year}${String(qt.month).padStart(2,"0")}`:Ye,lt=D.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),dt=document.createElement("a");dt.href=Pe,dt.download=`InventorySummary_${nt}_${lt}.csv`,document.body.appendChild(dt),dt.click(),document.body.removeChild(dt),URL.revokeObjectURL(Pe)},Us=Ue.useMemo(()=>{const D=rt=>rt?rt.toString().trim():"",X=rt=>hn(rt),se=new Set;try{for(const rt of(j||new Set).values()){const it=X(rt);it&&se.add(it)}}catch{}const ve=new Set;try{for(const rt of(we||new Set).values()){const it=X(rt);it&&ve.add(it)}}catch{}const ke=new Map;try{for(const[rt,it]of(x||new Map).entries()){const jt=X(rt);jt&&ke.set(jt,it)}}catch{}const Ae=new Map;try{(y||[]).forEach(rt=>{const it=X(rt?.name);it&&Ae.set(it,rt)})}catch{}const Be=new Map;try{for(const[rt,it]of(C||new Map).entries()){const jt=X(rt);jt&&Be.set(jt,it)}}catch{}const Pe=rt=>{const it=String(rt??"").trim();if(!it)return"";const jt=it.toLowerCase();return jt===""?"g":jt===""?"ml":jt===""?"cc":jt===""?"kg":jt===""?"l":jt},Ye=(rt,it)=>{const jt=parseFloat(rt?.lastPrice),un=parseFloat(rt?.packetSize),_n=Pe(rt?.packetUnit),Tn=Pe(it||_n);if(!Number.isFinite(jt)||!Number.isFinite(un)||un<=0||!_n)return null;const It=jt/un;if(Tn===_n)return It;if(_n==="g"&&Tn==="kg")return It*1e3;if(_n==="kg"&&Tn==="g")return It/1e3;const nr=_n==="cc"?"ml":_n,kn=Tn==="cc"?"ml":Tn;return nr==="ml"&&kn==="l"?It*1e3:nr==="l"&&kn==="ml"?It/1e3:null},nt=rt=>{const it=String(rt??"").trim();return it?["","","","","","","","pc","PC",""].includes(it):!1},lt=rt=>{const it=X(rt?.name),jt=it?ke.get(it):null,un=it?Ae.get(it):null,_n=it&&Be.has(it)?String(Be.get(it)||""):String(un?.unit||""),Tn={...rt};if(Tn.name=D(Tn.name),Tn.vendor=D(Tn.vendor),Tn._csv={unit:_n,price:un?.price??null,vendor:D(un?.vendor)||null,dateStr:un?.dateStr??null},!jt)return Tn;const It={...Tn},nr=xe(jt?.itemCategory),kn=jt.packetUnit||"",os=parseFloat(jt.packetSize),Zr=kn?Ye(jt,kn):null;if(It.isPhantom)kn&&Zr!==null&&(It.unit=kn,It.price=Zr);else{if(!!kn&&Number.isFinite(os)&&os>0&&(nt(It.unit)||!It.unit)&&Zr!==null){const cs=It.quantity;if(cs!==""&&cs!==null&&cs!==void 0){const gi=parseFloat(cs);Number.isFinite(gi)&&(It.quantity=gi*os)}const Zi=It.threshold;if(Zi!==""&&Zi!==null&&Zi!==void 0){const gi=parseFloat(Zi);Number.isFinite(gi)&&(It.threshold=gi*os)}It.unit=kn}else(kn&&Zr!==null||!It.unit&&kn)&&(It.unit=kn);if(Zr!==null&&Pe(It.unit)===Pe(kn))It.price=Zr;else{const cs=Ye(jt,It.unit||kn);cs!==null&&(It.price=cs)}}const qs=ue(It?.tax10_override??It?.tax10Override),dl=nr?_e(nr):null;return It._master={packetSize:jt.packetSize,packetUnit:jt.packetUnit,lastPrice:jt.lastPrice,itemCategory:nr||null,tax10Auto:dl,tax10Override:qs,updatedAt:jt.updatedAt},nr&&(It.tax10_override=qs,!qs&&dl!==null&&(It.tax10=dl)),It},dt=c.map(lt),qe=new Map;dt.forEach(rt=>{const it=X(rt?.name);it&&qe.set(it,rt)});const ft=[...dt];y.forEach((rt,it)=>{const jt=String(rt?.name??""),un=D(jt),_n=X(jt);if(_n&&!(j.has(jt)||un&&j.has(un)||se.has(_n))&&!qe.has(_n)){const Tn={id:`phantom-${it}`,isPhantom:!0,name:un,quantity:"",unit:rt.unit||"",category:"",price:rt.price,vendor:D(rt.vendor),threshold:0,tax10:!1,tax10_override:!1};ft.push(lt(Tn))}});const fn=ft.filter(rt=>{const it=String(rt?.name??""),jt=D(it),un=X(it);return!(j.has(it)||jt&&j.has(jt)||un&&se.has(un)||we.has(it)||jt&&we.has(jt)||un&&ve.has(un)||ee(rt.vendor))}),cn=rt=>{if(!rt)return-1;const jt=new Date(rt).getTime();return Number.isFinite(jt)?jt:-1},$s=(rt,it)=>{const jt=!!rt?.isPhantom,un=!!it?.isPhantom;if(jt!==un)return jt?it:rt;const _n=Math.max(cn(rt?.updated_at),cn(rt?.updatedAt),cn(rt?.created_at),cn(rt?.createdAt)),Tn=Math.max(cn(it?.updated_at),cn(it?.updatedAt),cn(it?.created_at),cn(it?.createdAt));if(_n!==Tn)return Tn>_n?it:rt;const It=rt?.quantity,nr=it?.quantity,kn=It===""||It===null||It===void 0?null:parseFloat(It),os=nr===""||nr===null||nr===void 0?null:parseFloat(nr),Zr=kn!==null&&Number.isFinite(kn),qs=os!==null&&Number.isFinite(os);return Zr!==qs&&qs?it:rt},Jr=new Map;return fn.forEach(rt=>{const it=X(rt?.name)||D(rt?.name);if(!it)return;const un=`${D(rt?.vendor)||"__no_vendor__"}@@${it}`,_n=Jr.get(un);if(!_n){Jr.set(un,rt);return}Jr.set(un,$s(_n,rt))}),Array.from(Jr.values())},[c,y,j,we,x,C,ee]),ol=D=>{const{active:X,over:se}=D;if(!se)return;if(X?.data?.current?.type==="summary-row"){if(!yr)return;const ke=X.id,Ae=se.id;if(!ke||!Ae||ke===Ae)return;const Be=cr,Pe=Be.indexOf(ke),Ye=Be.indexOf(Ae);if(Pe<0||Ye<0)return;const nt=Gi(Be,Pe,Ye);Ct(lt=>({...lt,[yr]:nt}));return}if(se.id==="inventory-list-droppable"){const ke=X.data.current.item;if(X.data.current.type==="csv-item"){const Ae=String(ke?.name??"").trim(),Be=hn(Ae);let Pe=null;if(x&&x.size>0&&Be&&(Pe=x.get(Ae)||null,!Pe)){for(const[dt,qe]of x.entries())if(hn(dt)===Be){Pe=qe;break}}const Ye=Pe?.packetUnit||ke.unit,nt=Pe?Ie(Pe,Ye):null,lt=nt!==null?nt:Pe?.lastPrice!==null&&Pe?.lastPrice!==void 0&&Pe?.lastPrice!==""?Pe.lastPrice:ke.price;G({name:ke.name,price:lt,unit:Ye,category:"",threshold:0,quantity:0,vendor:ke.vendor,tax10:ue(ke?.tax10),isNewFromCsv:!0}),M(!0)}}},Ls=async D=>{if(D.preventDefault(),!s)return;const X=new FormData(D.target),se={name:X.get("name"),quantity:parseFloat(X.get("quantity")),unit:X.get("unit"),category:X.get("category"),threshold:parseFloat(X.get("threshold")),vendor:k.vendor||"",price:k.price||0,tax10:ue(k?.tax10)};try{k.id&&!k.isPhantom?await er.update(s,{...k,...se}):await er.add(s,se),M(!1),G(null),Fe()}catch(ve){console.error("Failed to save item:",ve),Tt({title:"",message:"",type:"error"})}},zo=D=>{ne(D),Gt(!0)},Uo=D=>{!D||D.isPhantom||!D?._master?.packetUnit||(F(D),Q(!0))},ls=()=>{q||(Q(!1),F(null))},Lo=async({convertQuantity:D})=>{if(!s)return;const X=P;if(!X||X.isPhantom)return;const se=X?._master?.packetUnit;if(!se)return;const ve=se,ke=Ie(X?._master,ve);if(ke===null){Tt({title:"",message:"/",type:"error"});return}let Ae=X.quantity,Be=X.threshold;if(D){const Pe=H(X.unit,ve);if(!Pe){Tt({title:"",message:"kgg / lml ",type:"error"});return}const Ye=X.quantity===""?null:parseFloat(X.quantity);Ye!==null&&Number.isFinite(Ye)&&(Ae=Ye*Pe);const nt=X.threshold===""?null:parseFloat(X.threshold);nt!==null&&Number.isFinite(nt)&&(Be=nt*Pe)}$(!0);try{await er.update(s,{id:X.id,unit:ve,price:ke,quantity:Ae===""?0:parseFloat(Ae)||0,threshold:Be===""?0:parseFloat(Be)||0,tax10:ue(X?.tax10)}),await Fe(!0),Q(!1),F(null)}catch(Pe){console.error("Failed to sync unit:",Pe),Tt({title:"",message:"",type:"error"})}finally{$(!1)}},Io=async()=>{if(vt)try{const X=(se=>se?se.toString().trim():"")(vt?.name);X&&Ee(se=>{const ve=new Set(se);return ve.add(X),ve}),Gt(!1),ne(null)}catch(D){console.error("Failed to delete/ignore item:",D)}},Bo=async(D,X)=>{try{if(!s)return;const se=Us.find(ve=>ve.id===D);if(!se)return;if(se.isPhantom){const ve={name:se.name.trim(),quantity:X,unit:se.unit,category:se.category||"",price:se.price,vendor:se.vendor,threshold:0,tax10:ue(se?.tax10)},ke=await er.add(s,ve);await Fe(!0),pe(Ae=>{const Be=new Set(Ae);return Be.add(ke.id),Be})}else u(ve=>ve.map(ke=>ke.id!==D?ke:{...ke,quantity:X,unit:se.unit??ke.unit,price:se.price??ke.price,threshold:se.threshold??ke.threshold})),pe(ve=>{const ke=new Set(ve);return ke.add(D),ke}),await er.update(s,{...se,quantity:X})}catch(se){console.error(se);const ve=se?.message||se?.error_description||(typeof se=="string"?se:null)||(()=>{try{return JSON.stringify(se)}catch{return null}})()||"";Tt({title:"",message:`
${ve}`,type:"error"}),Fe()}},Wi=async(D,X)=>{try{if(!s||!D)return;const se=!!X;if(D.isPhantom){const ve={name:D.name.trim(),quantity:D.quantity===""?0:parseFloat(D.quantity)||0,unit:D.unit,category:D.category||"",price:D.price,vendor:D.vendor,threshold:0,tax10:se,tax10_override:!0};await er.add(s,ve),await Fe(!0)}else u(ve=>ve.map(ke=>ke.id===D.id?{...ke,tax10:se,tax10_override:!0}:ke)),await er.update(s,{...D,tax10:se,tax10_override:!0})}catch(se){console.error(se);const ve=se?.message||se?.error_description||(typeof se=="string"?se:null)||(()=>{try{return JSON.stringify(se)}catch{return null}})()||"";Tt({title:"",message:`
${ve}`,type:"error"}),Fe()}},Lu=(D,X)=>{if(X===!0){jn({item:D});return}Wi(D,X)},$o=()=>{bt||jn(null)},Xi=async()=>{const D=en?.item;if(D){tn(!0);try{await Wi(D,!0),jn(null)}finally{tn(!1)}}},Pr=async()=>{if(!ye&&Y&&s){U(!0);try{const D=Us.filter(se=>!se.isPhantom).map(se=>{const ve={...se};return delete ve.isPhantom,delete ve._master,delete ve._csv,ve}),X=D.reduce((se,ve)=>{const ke=parseFloat(ve.price)||0,Ae=ve.quantity===""?0:parseFloat(ve.quantity)||0;return se+ke*Ae*ze(ve)},0);await er.createSnapshot(s,Y,D,X),W?(await er.resetStockQuantities(s),await Fe(),pe(new Set)):await Fe(!0),I(!1),tt(!0)}catch(D){console.error("Failed to complete inventory:",D);const X=D?.message||D?.error_description||(typeof D=="string"?D:null)||(()=>{try{return JSON.stringify(D)}catch{return null}})()||"";Tt({title:"",message:`
${X}`,type:"error"})}finally{U(!1)}}},cl=()=>{const D=["","","","","()",""],X=Ji.map(Ye=>{const nt=parseFloat(Ye.price)||0,lt=Ye.quantity===""?0:parseFloat(Ye.quantity)||0,dt=Math.round(nt*lt*ze(Ye));return[Ye.name,nt,Ye.unit,Ye.quantity,dt,Ye.vendor||""]}),se=[D.join(","),...X.map(Ye=>Ye.map(nt=>{const lt=String(nt??"");return lt.includes(",")||lt.includes('"')||lt.includes(`
`)?`"${lt.replace(/"/g,'""')}"`:lt}).join(","))].join(`
`),ve=new Uint8Array([239,187,191]),ke=new Blob([ve,se],{type:"text/csv"}),Ae=document.createElement("a"),Be=URL.createObjectURL(ke),Pe=new Date().toISOString().split("T")[0];Ae.href=Be,Ae.download=`Inventory_${Pe}.csv`,document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae),URL.revokeObjectURL(Be)},ul=["","","","","","","","","","","",""],Is=[...new Set(Us.map(D=>D.vendor).filter(D=>D&&!ee(D)))].sort(),Bs=Us.some(D=>!D.vendor),mi=yn==="summary",Ji=Us.filter(D=>D.name.toLowerCase().includes(B.toLowerCase())?yn==="all"||yn==="summary"?!0:yn==="inventory-check"?Vn.has(D.id)||!D.isPhantom:yn==="other"?!D.vendor:D.vendor===yn:!1);return _?i.jsxs("div",{className:"inventory-edit-container fade-in",children:[i.jsx("div",{className:"container-header",children:i.jsx("h2",{className:"section-title",children:k&&!k.isNewFromCsv?"":""})}),i.jsx(xn,{className:"edit-form-card",children:i.jsxs("form",{onSubmit:Ls,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(Mt,{name:"name",defaultValue:k?.name,required:!0,placeholder:": "})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(Mt,{name:"quantity",type:"number",step:"0.01",defaultValue:k?.quantity,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(Mt,{name:"unit",defaultValue:k?.unit||"g",required:!0,placeholder:"g, ml, ..."})]})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(Mt,{name:"category",defaultValue:k?.category,list:"category-list",placeholder:"",autoComplete:"off"}),i.jsx("datalist",{id:"category-list",children:ul.map(D=>i.jsx("option",{value:D},D))})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" ()"}),i.jsx(Mt,{name:"threshold",type:"number",step:"0.01",defaultValue:k?.threshold||0})]})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx(fe,{variant:"ghost",type:"button",onClick:()=>{M(!1),G(null)},children:""}),i.jsx(fe,{variant:"primary",type:"submit",children:""})]})]})})]}):i.jsx(Fi,{onDragEnd:ol,sensors:ln,autoScroll:!1,children:i.jsxs("div",{className:"inventory-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsxs("div",{className:"header-actions inventory-header-actions",children:[i.jsx(fe,{variant:"ghost",onClick:n,children:" "}),i.jsx(fe,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>l({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),i.jsx(fe,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const D=new Date;ae(`${D.getFullYear()}${D.getMonth()+1} `),Z(!0),I(!0)},children:" "}),i.jsx(fe,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{Re(null),ie("history"),Oe(!0)},title:"",children:" "}),i.jsx(fe,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{G(null),M(!0)},children:"+ "})]})]}),i.jsx("div",{className:"inventory-split-layout",children:i.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[i.jsxs("div",{className:"inventory-controls",children:[mi?i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsx("select",{className:"inventory-controls__select",value:He,onChange:D=>Xe(D.target.value),disabled:St.length===0,children:St.length===0?i.jsx("option",{value:"",children:""}):St.map(D=>i.jsx("option",{value:D.key,children:D.label},D.key))})]}),qt&&i.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",qt.rangeLabel]})]}):i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsxs("select",{className:"inventory-controls__select",value:yn==="inventory-check"?"":yn,onChange:D=>{D.target.value&&Un(D.target.value)},children:[i.jsx("option",{value:"all",children:""}),i.jsx("option",{value:"",disabled:!0,children:""}),i.jsxs("optgroup",{label:"",children:[Is.map(D=>i.jsx("option",{value:D,children:D},D)),Bs&&i.jsx("option",{value:"other",children:""})]})]})]}),i.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:B,onChange:D=>L(D.target.value)})]}),i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[i.jsxs("button",{className:"inventory-controls__btn",onClick:()=>Un("inventory-check"),"data-active":yn==="inventory-check"?"true":"false",children:["  (",Vn.size,")"]}),i.jsx("button",{className:"inventory-controls__btn",onClick:()=>Un("summary"),"data-active":yn==="summary"?"true":"false",children:" "}),!mi&&i.jsx("button",{className:"inventory-controls__btn",onClick:cl,title:"CSV",children:" CSV (.csv)"}),!mi&&yn==="inventory-check"&&i.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),mi?i.jsxs("div",{className:"inventory-summary",children:[i.jsx("div",{className:"inventory-summary__header",children:i.jsxs("div",{children:[i.jsx("div",{className:"inventory-summary__title",children:""}),qt&&i.jsxs("div",{className:"inventory-summary__meta",children:[": ",qt.rangeLabel]}),ar?i.jsxs("div",{className:"inventory-summary__meta",children:[": ",ar.title||"","",Lt(ar.snapshot_date),""]}):i.jsx("div",{className:"inventory-summary__meta",children:""}),Ms.length>1&&i.jsxs("div",{className:"inventory-summary__note",children:[" ",Ms.length," "]})]})}),ar?i.jsxs("div",{className:"inventory-summary__table-wrap",children:[i.jsx("div",{className:"inventory-summary__actions",children:i.jsx(fe,{variant:"secondary",size:"sm",onClick:ur,children:" CSV (.csv)"})}),i.jsxs("table",{className:"inventory-summary__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40px"}}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx(Ka,{items:cr,strategy:po,children:i.jsxs("tbody",{children:[Kn.map(D=>{const X=Nt===D.vendor,se=Ki.get(D.vendor)||null;return i.jsxs(Ue.Fragment,{children:[i.jsx(Ut,{row:D,onVendorClick:Uu,isSelected:X}),X&&se&&i.jsxs("tr",{className:"inventory-summary__detail-row",children:[i.jsx("td",{}),i.jsx("td",{colSpan:"2",children:i.jsxs("div",{className:"inventory-summary__inline-detail",children:[i.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[i.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[se.vendor," "]}),i.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>ll(se),disabled:!se.rows||se.rows.length===0,children:" CSV"}),i.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(se.totals.taxed||0).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(ve=>i.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:Qt(ve)}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(se.totals[ve]||0).toLocaleString()]})]},ve)),se.totals.unknown>0&&i.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(se.totals.unknown).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(se.totals.net||0).toLocaleString()]}),i.jsx("div",{className:"inventory-summary__inline-items-wrap",children:i.jsxs("table",{className:"inventory-summary__inline-items-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx("tbody",{children:se.rows.map((ve,ke)=>{const Ae=ve.itemCategory?et(ve.itemCategory):Qt(ve.breakdownKey),Be=ke>0?se.rows[ke-1]:null,Pe=!!Be&&Be.breakdownKey!==ve.breakdownKey;return i.jsxs("tr",{className:Pe?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[i.jsx("td",{children:ve.name||"-"}),i.jsx("td",{children:Ae}),i.jsxs("td",{style:{textAlign:"right"},children:["",Number(ve.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),i.jsxs("td",{style:{textAlign:"right"},children:[Number(ve.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),ve.unit?` ${ve.unit}`:""]}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(ve.taxed||0).toLocaleString()]})]},ve.id)})})]})})]})})]})]},D.vendor)}),Kn.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsx("td",{}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(sl.net).toLocaleString()," / ",Math.round(sl.taxed).toLocaleString()]})]})})]})]}):i.jsx("div",{className:"inventory-summary__empty",children:""})]}):i.jsx(GN,{items:Ji,loading:A,onSearch:L,searchQuery:B,onEdit:D=>{G(D),M(!0)},onDelete:zo,onUpdateQuantity:Bo,onToggleTax:Lu,onRequestUnitSync:Uo})]})}),i.jsx(Bn,{isOpen:!!en,onClose:$o,title:"10%",size:"small",showCloseButton:!bt,children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",en?.item?.name||"","",i.jsx("strong",{children:"10%"}),""]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[i.jsx(fe,{variant:"secondary",onClick:$o,disabled:bt,children:""}),i.jsx(fe,{variant:"primary",onClick:Xi,disabled:bt,children:bt?"...":""})]})]})}),i.jsx(Bn,{isOpen:T,onClose:()=>{ye||I(!1)},title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),i.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[i.jsx("strong",{children:":"}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. ",W?i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:"()0"}),""]}):i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:""}),""]}),i.jsx("br",{}),""]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:W,disabled:ye,onChange:()=>Z(!0)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:"0"}),""]})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:!W,disabled:ye,onChange:()=>Z(!1)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:""}),""]})]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),i.jsx("input",{type:"text",value:Y,onChange:D=>ae(D.target.value),disabled:ye,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx("button",{onClick:()=>{ye||I(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:ye?"not-allowed":"pointer",opacity:ye?.6:1,fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Pr,disabled:ye,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:ye?"#94a3b8":"#2ecc71",color:"white",cursor:ye?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:ye?"...":W?"":""})]}),ye&&i.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),i.jsxs(Bn,{isOpen:ce,onClose:()=>Oe(!1),title:" ",size:"large",children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:O==="history"?i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:Yn.length})," "]}):i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:f.length})," "]})}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",gap:"6px"},children:[i.jsx("button",{type:"button",onClick:()=>ie("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:O==="history"?"#111":"#fff",color:O==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),i.jsx("button",{type:"button",onClick:()=>ie("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:O==="trash"?"#111":"#fff",color:O==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>Fe(!0),title:"",children:" "})]})]}),O==="history"&&i.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),i.jsx("select",{value:Ve,onChange:D=>Ge(D.target.value),disabled:St.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:St.length===0?i.jsx("option",{value:"",children:""}):St.map(D=>i.jsx("option",{value:D.key,children:D.label},D.key))})]}),on&&i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",on.rangeLabel]})]}),O==="history"&&Yn.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):O==="trash"&&f.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:O==="trash"?"":""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),i.jsx("tbody",{children:(O==="history"?Yn:f).map(D=>{const X=Xt(D).filter(lt=>!ee(lt?.vendor)),se=X.length,ve=Math.round(X.reduce((lt,dt)=>{const qe=parseFloat(dt?.price)||0,ft=dt?.quantity===""?0:parseFloat(dt?.quantity)||0;return lt+qe*ft*ze(dt)},0)),ke=O==="trash"?`trash-${D.id}`:D.id,Ae=Lt(O==="trash"?D.deleted_at:D.snapshot_date),Be=me?.type==="move"&&me?.id===D.id,Pe=me?.type==="restore"&&me?.id===D.id,Ye=me?.type==="hard-delete"&&me?.id===D.id,nt=Be||Pe||Ye;return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Ae}),i.jsx("td",{style:{padding:"10px"},children:D.title||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:se.toLocaleString()}),i.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",ve.toLocaleString()]}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:O==="history"?i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>al(D),disabled:se===0||nt,title:se===0?"items CSV":"CSV",children:" CSV"}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>Re(D),disabled:nt,children:""}),i.jsx(fe,{variant:"danger",size:"sm",onClick:()=>il(D),disabled:nt,title:"",children:Be?"...":""})]}):i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>al(D),disabled:se===0||nt,children:" CSV"}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>Re(D),disabled:nt,children:""}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>Mo(D),disabled:nt,title:"",children:Pe?"...":""}),i.jsx(fe,{variant:"danger",size:"sm",onClick:()=>Qi(D),disabled:nt,title:"",children:Ye?"...":""})]})})]},ke)})})]})})]}),i.jsx(Bn,{isOpen:!!de,onClose:()=>{$e||Me(null)},title:de?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:de?.message}),de?.requireText&&i.jsxs("div",{style:{marginTop:"14px"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",i.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:de.requireText})," "]}),i.jsx("input",{type:"text",value:Le,onChange:D=>Ke(D.target.value),placeholder:de.requireText,disabled:$e,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(fe,{variant:"ghost",disabled:$e,onClick:()=>{$e||Me(null)},children:""}),i.jsx(fe,{variant:"danger",disabled:$e||!!de?.requireText&&Le!==de.requireText,onClick:()=>de?.onConfirm&&de.onConfirm(),children:$e?de?.loadingLabel||"...":de?.confirmLabel||""})]})]})}),i.jsx(Bn,{isOpen:!!Se,onClose:()=>Re(null),title:Se?` ${Se.title||""}`:" ",size:"large",children:(()=>{const D=Se;if(!D)return null;const ve=[...Xt(D).filter(Ae=>ee(Ae?.vendor)?!1:ot?(Ae?.quantity===""?0:parseFloat(Ae?.quantity)||0)!==0:!0)].sort((Ae,Be)=>{const Pe=mt.direction==="desc"?-1:1;if(mt.key==="vendor"){const ft=(Ae?.vendor||"").toString(),fn=(Be?.vendor||"").toString(),cn=ft.localeCompare(fn,"ja");if(cn!==0)return cn*Pe;const $s=(Ae?.name||"").toString(),Jr=(Be?.name||"").toString();return $s.localeCompare(Jr,"ja")*Pe}const Ye=(Ae?.name||"").toString(),nt=(Be?.name||"").toString(),lt=Ye.localeCompare(nt,"ja");if(lt!==0)return lt*Pe;const dt=(Ae?.vendor||"").toString(),qe=(Be?.vendor||"").toString();return dt.localeCompare(qe,"ja")*Pe}),ke=ve.reduce((Ae,Be)=>{const Pe=parseFloat(Be?.price)||0,Ye=Be?.quantity===""?0:parseFloat(Be?.quantity)||0,nt=Pe*Ye;return Ae.net+=nt,Ae.taxed+=nt*ze(Be),Ae},{net:0,taxed:0});return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[i.jsxs("div",{children:[": ",i.jsx("strong",{children:Lt(D.snapshot_date)})]}),i.jsxs("div",{children:[": ",i.jsx("strong",{children:ve.length.toLocaleString()})]}),i.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",i.jsxs("strong",{children:["",Math.round(ke.net).toLocaleString()," / ",Math.round(ke.taxed).toLocaleString()]})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:ot,onChange:Ae=>ct(Ae.target.checked)}),"0"]}),i.jsx(fe,{variant:"secondary",size:"sm",onClick:()=>al(D),children:" CSV (.csv)"})]}),ve.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{ht(Ae=>Ae.key==="vendor"?{key:"vendor",direction:Ae.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",mt.key==="vendor"&&(mt.direction==="asc"?"":"")]})]})}),i.jsx("tbody",{children:ve.map((Ae,Be)=>{const Pe=parseFloat(Ae?.price)||0,Ye=Ae?.quantity===""?0:parseFloat(Ae?.quantity)||0,nt=Math.round(Pe*Ye*ze(Ae)),lt=rl(Ae),dt=et(lt);return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsxs("td",{style:{padding:"10px"},children:[Ae?.name||"-",ue(Ae?.tax10)&&i.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),i.jsx("td",{style:{padding:"10px"},children:dt}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Pe?`${Number(Pe).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:Ae?.unit||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Ye?Ye.toLocaleString():"0"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:nt?`${nt.toLocaleString()}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:Ae?.vendor||"-"})]},Ae?.id||`${Ae?.name||"item"}-${Be}`)})})]})})]})})()}),i.jsx(Bn,{isOpen:V,onClose:ls,title:"",size:"small",children:(()=>{const D=P,X=D?._master?.packetUnit||"",se=D?.unit||"",ve=H(se,X),ke=ve!==null&&ve!==1,Ae=parseFloat(D?.price)||0,Be=D?.quantity===""?0:parseFloat(D?.quantity)||0,Pe=D?ze(D):1.08,Ye=Ae*Be*Pe,nt=X?Ie(D?._master,X):null,lt=nt===null?null:nt*Be*Pe,dt=nt===null||!ke?null:nt*(Be*ve)*Pe,qe=fn=>`${Math.round(fn).toLocaleString()}`,ft=fn=>Number.isInteger(fn)?fn.toLocaleString():fn.toLocaleString(void 0,{maximumFractionDigits:3});return i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[i.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:D?.name||"-"}),i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",ft(Be)," ",se," /  ",Ae.toLocaleString()," /  ",qe(Ye)]}),!!X&&i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",X]})]}),i.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",i.jsx("br",{}),""]})}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[i.jsx(fe,{variant:"ghost",type:"button",onClick:ls,disabled:q,children:""}),i.jsx(fe,{variant:"secondary",type:"button",onClick:()=>Lo({convertQuantity:!1}),isLoading:q,disabled:q||!X||nt===null,title:lt===null?"":`:  ${qe(lt)}`,children:""}),ke&&i.jsx(fe,{variant:"primary",type:"button",onClick:()=>Lo({convertQuantity:!0}),isLoading:q,disabled:q||!X||nt===null,title:dt===null?"":`:  ${qe(dt)}`,children:""})]})]})})()}),i.jsx(Bn,{isOpen:zt,onClose:()=>Gt(!1),title:"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",i.jsx("strong",{children:vt?.name}),""]}),i.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",i.jsx("strong",{children:""}),"",i.jsx("br",{}),"CSV"]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx("button",{onClick:()=>Gt(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Io,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),i.jsx(Bn,{isOpen:Te,onClose:()=>tt(!1),title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),i.jsxs("h3",{style:{marginBottom:"1rem"},children:[Y," "]}),i.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",i.jsx("br",{}),""]}),i.jsx("button",{onClick:()=>tt(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),i.jsx(Bn,{isOpen:!!_t,onClose:()=>Tt(null),title:_t?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[_t?.type==="success"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),_t?.type==="error"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),i.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:_t?.message}),i.jsx("button",{onClick:()=>Tt(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:_t?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},Yx=n=>`planner_data_${n}`,to=n=>{try{if(!n)return{};let t=localStorage.getItem(Yx(n));return t?JSON.parse(t):{}}catch{return{}}},nu=(n,t)=>{n&&localStorage.setItem(Yx(n),JSON.stringify(t))},Pa={getAll:async n=>to(n),cleanupInvalidPlans:async(n,t)=>{const s=to(n);let l=!1;const c=new Set(t);return Object.keys(s).forEach(u=>{const d=s[u].length;s[u]=s[u].filter(p=>c.has(p.recipeId)),s[u].length!==d&&(l=!0),s[u].length===0&&(delete s[u],l=!0)}),l&&nu(n,s),s},addMeal:async(n,t,s,l)=>{const c=to(n);c[t]||(c[t]=[]);const u={id:Date.now().toString(),recipeId:s,type:l,note:""};return c[t].push(u),nu(n,c),u},removeMeal:async(n,t,s)=>{const l=to(n);l[t]&&(l[t]=l[t].filter(c=>c.id!==s),l[t].length===0&&delete l[t],nu(n,l))},updateMeal:async(n,t,s,l)=>{const c=to(n);if(c[t]){const u=c[t].findIndex(d=>d.id===s);u!==-1&&(c[t][u]={...c[t][u],...l},nu(n,c))}}},YN=({recipe:n})=>{const{attributes:t,listeners:s,setNodeRef:l,transform:c}=rp({id:`recipe-${n.id}`,data:{recipe:n}}),u=c?{transform:`translate3d(${c.x}px, ${c.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:l,style:u,...s,...t,className:"draggable-recipe",children:n.title})},KN=({meal:n,dateStr:t,children:s})=>{const{attributes:l,listeners:c,setNodeRef:u,transform:d}=rp({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),p=d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:u,style:p,...c,...l,className:"draggable-meal-wrapper",children:s})},QN=({dateStr:n,dayNum:t,isToday:s,isOutside:l,children:c})=>{const{setNodeRef:u,isOver:d}=Oo({id:`date-${n}`,data:{dateStr:n}});return i.jsxs("div",{ref:u,className:`calendar-cell ${s?"today":""} ${l?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[i.jsx("div",{className:"day-number",children:t}),c]})},WN=({onBack:n,onSelectRecipe:t})=>{const{user:s}=is(),l=Vi(),[c,u]=b.useState([]),[d,p]=b.useState({}),[f,m]=b.useState(new Date),[y,v]=b.useState(""),[x,S]=b.useState(!1),[C,E]=b.useState(null),j=Ja(gr(Ru,{activationConstraint:{distance:8}})),N=b.useCallback(async()=>{const V=await Nn.fetchRecipes(s);if(u(V),s?.id){const Q=V.map(F=>F.id),P=await Pa.cleanupInvalidPlans(s.id,Q);p(P)}},[s]);b.useEffect(()=>{const V=setTimeout(()=>{N()},0);return()=>clearTimeout(V)},[N]);const A=async V=>{const{active:Q,over:P}=V;if(P&&P.id.startsWith("date-")){const F=P.data.current.dateStr;if(Q.id.startsWith("recipe-")){const q=Q.data.current.recipe;await Pa.addMeal(s.id,F,q.id,"dinner"),N()}else if(Q.id.startsWith("meal-")){const{meal:q,dateStr:$}=Q.data.current;if($===F)return;await Pa.addMeal(s.id,F,q.recipeId,q.type||"dinner"),await Pa.removeMeal(s.id,$,q.id),N()}}},z=async(V,Q,P)=>{P&&P.stopPropagation(),E({dateStr:V,mealId:Q}),S(!0)},B=async()=>{if(!C)return;const{dateStr:V,mealId:Q}=C;S(!1),E(null);try{await Pa.removeMeal(s.id,V,Q),await N(),l.success("")}catch(P){l.error(""),console.error("Delete meal error:",P)}},L=()=>{S(!1),E(null)},_=()=>{const V=f.getFullYear(),Q=f.getMonth(),P=new Date(V,Q,1),F=new Date(V,Q+1,0),q=[],$=P.getDay();for(let I=$-1;I>=0;I--){const Y=new Date(V,Q,-I);q.push({date:Y,isOutside:!0})}for(let I=1;I<=F.getDate();I++){const Y=new Date(V,Q,I);q.push({date:Y,isOutside:!1})}const T=42-q.length;for(let I=1;I<=T;I++){const Y=new Date(V,Q+1,I);q.push({date:Y,isOutside:!0})}return q},M=V=>`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}-${String(V.getDate()).padStart(2,"0")}`,k=c.filter(V=>V.title.toLowerCase().includes(y.toLowerCase())),G=V=>{m(new Date(f.getFullYear(),f.getMonth()+V,1))};return i.jsxs("div",{className:"planner-container fade-in",children:[x&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(xn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("strong",{children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(fe,{variant:"ghost",onClick:L,children:""}),i.jsx(fe,{variant:"danger",onClick:B,children:""})]})]})}),i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(fe,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx(Fi,{onDragEnd:A,sensors:j,children:i.jsxs("div",{className:"planner-layout",children:[i.jsxs("div",{className:"recipe-sidebar",children:[i.jsx("div",{className:"sidebar-search",children:i.jsx(Mt,{placeholder:"...",value:y,onChange:V=>v(V.target.value)})}),i.jsx("div",{className:"draggable-list",children:k.map(V=>i.jsx(YN,{recipe:V},V.id))})]}),i.jsxs("div",{className:"planner-calendar",children:[i.jsxs("div",{className:"calendar-header",children:[i.jsx(fe,{variant:"ghost",onClick:()=>G(-1),children:" "}),i.jsxs("h3",{style:{margin:0},children:[f.getFullYear()," ",f.getMonth()+1,""]}),i.jsx(fe,{variant:"ghost",onClick:()=>G(1),children:" "})]}),i.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(V=>i.jsx("div",{className:"calendar-day-header",children:V},V)),_().map((V,Q)=>{const P=M(V.date),F=d[P]||[],q=P===M(new Date);return i.jsx(QN,{dateStr:P,dayNum:V.date.getDate(),isToday:q,isOutside:V.isOutside,children:F.map($=>{const T=c.find(I=>I.id===$.recipeId);return i.jsx(KN,{meal:$,dateStr:P,children:i.jsxs("div",{className:"planned-meal",title:T?.title,onClick:()=>T&&t&&t(T),children:[i.jsx("span",{children:T?.title||"Unknown"}),i.jsx("span",{className:"delete-meal-btn",onPointerDown:I=>{I.stopPropagation()},onClick:I=>z(P,$.id,I),children:""})]})},$.id)})},Q)})]})]})]})})]})},XN=({onBack:n})=>{const{user:t}=is(),s=Vi(),[l,c]=b.useState(new Date().toISOString().slice(0,10)),[u,d]=b.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[p,f]=b.useState([]),[m,y]=b.useState(!1),[v,x]=b.useState(!1),[S,C]=b.useState(!1),[E,j]=b.useState(!1),N=async()=>{y(!0);try{if(!t?.id){s.error(""),y(!1);return}const _=await Pa.getAll(t.id),M=new Date(l),k=new Date(u);k.setHours(23,59,59,999);const G=[];if(Object.keys(_).forEach(Se=>{const Re=new Date(Se);Re>=M&&Re<=k&&_[Se].forEach(O=>{G.push(O.recipeId)})}),G.length===0){s.info(""),x(!1);return}const V=await Nn.fetchRecipes(t),Q=G.map(Se=>V.find(Re=>Re.id===Se)).filter(Boolean),P=Se=>(Se??"").toString().trim(),F=Se=>{const Re=P(Se);if(!Re)return"";const O=Re.toLowerCase();return O===""?"g":O===""?"ml":O===""?"cc":O===""?"kg":O===""?"l":O},q=Se=>{const Re=P(Se);return Re?["","","","","","","","PC","pc",""].includes(Re):!1},$=(Se,Re)=>{const O=parseFloat(Se)||0,ie=F(Re);return ie==="kg"?{qty:O*1e3,unit:"g"}:ie==="g"?{qty:O,unit:"g"}:ie==="l"?{qty:O*1e3,unit:"ml"}:ie==="cc"?{qty:O,unit:"ml"}:ie==="ml"?{qty:O,unit:"ml"}:{qty:O,unit:P(Re)||""}},T=(Se,Re,O,ie)=>{const de=P(O),Me=parseFloat(Re)||0;if(!ie)return $(Me,de);const Le=parseFloat(ie.packetSize),Ke=F(ie.packetUnit);if(!Number.isFinite(Le)||Le<=0||!Ke)return $(Me,de);if(["g","kg","ml","cc","l"].includes(Ke)&&q(de)){const We=Me*Le;return $(We,Ke)}return $(Me,de)},[I,Y,ae,ye]=await Promise.all([qn.getAllConversions(),sr.fetchPriceList(t.id),er.getAll(t.id),bu.getAll(t.id)]),U=new Map;try{for(const[Se,Re]of(I||new Map).entries()){const O=hn(Se);O&&(U.has(O)||U.set(O,Re))}}catch{}const W=new Map;try{for(const[Se,Re]of(ye||new Map).entries()){const O=hn(Se);O&&(W.has(O)||W.set(O,Re))}}catch{}const Z=new Map;try{(ae||[]).forEach(Se=>{const Re=hn(Se?.name);Re&&(Z.has(Re)||Z.set(Re,Se))})}catch{}const ce={};Q.forEach(Se=>{[...Se.ingredients||[],...Se.flours||[],...Se.breadIngredients||[]].forEach(ie=>{if(!ie.name)return;const de=P(ie.name),Me=hn(de),Le=(Me?U.get(Me):null)||I?.get(de)||null,Ke=T(de,ie.quantity,ie.unit,Le),$e=Ke.qty||0,We=Ke.unit||"";ce[de]||(ce[de]={quantity:0,unit:We,count:0}),ce[de].quantity+=$e})});const Oe=Object.keys(ce).map(Se=>{const Re=ce[Se],O=hn(Se),ie=(O?U.get(O):null)||I?.get(Se)||null,de=O&&Y?.get(O)||null,Me=O&&Z.get(O)||null,Le=T(Se,Me?.quantity??0,Me?.unit??Re.unit,ie),Ke=Re.quantity||0,$e=Le.qty||0,We=Re.unit||Le.unit||"",me=$e-Ke,Qe=parseFloat(ie?.packetSize),ot=P(ie?.packetUnit),ct=Number.isFinite(Qe)&&Qe>0&&!!ot,mt=ct?Qe*.2:0,ht=ct?me<mt:!1,zt=de?.unit?String(de.unit).trim():"",Gt=O&&W.has(O)?String(W.get(O)).trim():"",vt=Gt||""||zt||""||"",ne=(ie?.lastPrice!==null&&ie?.lastPrice!==void 0&&ie?.lastPrice!==""?parseFloat(ie.lastPrice):null)??(de?.price!==null&&de?.price!==void 0?parseFloat(de.price):null);let we=null,Ee=0,Te=We;if(ct){const _t=Math.max(0,mt-me);we=Math.ceil(_t/Qe),ht&&we<1&&(we=1),Ee=we,Te=vt}else Ee=Math.max(0,Ke-$e),Te=We;const tt=ct?ht:Ee>.01;return{name:Se,required:Ke,stock:$e,remaining:me,unit:We,shouldShow:tt,toOrder:Ee,orderUnit:Te,orderPacks:we,packSize:ct?Qe:null,packUnit:ct?ot:null,packPrice:Number.isFinite(ne)?ne:null,vendor:de?.vendor||Me?.vendor||""}}).filter(Se=>Se.shouldShow);f(Oe),x(!0)}catch(_){console.error(_),s.error("")}finally{y(!1)}},A=()=>{C(!0)},z=()=>{j(!0)},B=()=>p.map(_=>{if(Number.isFinite(_.orderPacks)&&_.orderPacks!==null){const M=_.packSize&&_.packUnit?`1${_.orderUnit}=${_.packSize}${_.packUnit}`:"";return`${_.name}: ${_.orderPacks}${_.orderUnit}${M}`}return`${_.name}: ${Number(_.toOrder||0).toFixed(1)}${_.unit}`}).join(`
`),L=async()=>{const _=document.getElementById("copy-textarea");if(_){_.select();try{await navigator.clipboard.writeText(_.value),s.success("")}catch{document.execCommand("copy"),s.success("")}}};return i.jsxs("div",{className:"order-list-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(fe,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx("div",{className:"filter-card",children:i.jsxs("div",{className:"date-range-inputs",children:[i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:l,onChange:_=>c(_.target.value)})]}),i.jsx("span",{children:""}),i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:u,onChange:_=>d(_.target.value)})]}),i.jsx(fe,{variant:"primary",onClick:N,disabled:m,children:m?"...":""})]})}),v&&i.jsxs("div",{className:"order-results",children:[i.jsxs("div",{className:"results-header",children:[i.jsxs("h3",{children:[" (",p.length,")"]}),i.jsxs("div",{className:"result-actions",children:[i.jsx(fe,{variant:"secondary",onClick:A,children:" "}),i.jsx(fe,{variant:"secondary",onClick:z,children:" "})]})]}),i.jsxs("table",{className:"order-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:p.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):p.map((_,M)=>i.jsxs("tr",{children:[i.jsx("td",{children:_.name}),i.jsxs("td",{style:{textAlign:"right"},children:[_.required.toFixed(1)," ",_.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,_.remaining??0).toFixed(1)," ",_.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(_.orderPacks)&&_.orderPacks!==null?i.jsxs(i.Fragment,{children:[_.orderPacks,_.orderUnit,_.packSize&&_.packUnit&&i.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",_.orderUnit," = ",Number(_.packSize).toLocaleString(),_.packUnit,_.packPrice?` / ${Math.round(_.packPrice).toLocaleString()}`:""]})]}):i.jsxs(i.Fragment,{children:[_.toOrder.toFixed(1)," ",i.jsx("span",{style:{fontSize:"0.8em"},children:_.unit})]})})]},M))})]})]}),i.jsx(Bn,{isOpen:S,onClose:()=>C(!1),title:" ",size:"medium",children:i.jsxs("div",{className:"copy-modal-content",children:[i.jsx("p",{className:"copy-instructions",children:""}),i.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:B(),onClick:_=>_.target.select()}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(fe,{variant:"primary",onClick:L,children:" "}),i.jsx(fe,{variant:"ghost",onClick:()=>C(!1),children:""})]})]})}),i.jsx(Bn,{isOpen:E,onClose:()=>j(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-content",children:[i.jsxs("div",{className:"print-preview-header",children:[i.jsx("h3",{children:""}),i.jsxs("p",{className:"print-period",children:[": ",l,"  ",u]})]}),i.jsxs("table",{className:"print-preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:p.map((_,M)=>i.jsxs("tr",{children:[i.jsx("td",{children:_.name}),i.jsxs("td",{style:{textAlign:"right"},children:[_.required.toFixed(1)," ",_.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,_.remaining??0).toFixed(1)," ",_.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(_.orderPacks)&&_.orderPacks!==null?`${_.orderPacks}${_.orderUnit}`:`${_.toOrder.toFixed(1)} ${_.unit}`})]},M))})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(fe,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(fe,{variant:"ghost",onClick:()=>j(!1),children:""})]})]})})]})},no=async(n,t,s)=>{let l=null;try{const c=new Promise((u,d)=>{l=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,c])}finally{l&&clearTimeout(l)}},v0=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},JN=({children:n})=>{const[t,s]=b.useState(null),[l,c]=b.useState(!0),[u,d]=b.useState(!1),p=b.useCallback(async j=>{if(!j){s(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const N=j.id,A=j.email||"";try{const Q=localStorage.getItem("auth_user_cache");if(Q){const P=JSON.parse(Q);P&&P.id===N&&s(P)}}catch(Q){console.warn("[Auth] Failed to load cache",Q)}let z=null,B=0;const L=3;for(;B<L;)try{const[Q,P]=await Promise.all([no(De.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",N).single().then($=>({data:$,error:null})).catch($=>({data:null,error:$})),4e3,"profiles.select(with_email)").catch($=>({data:null,error:$})),no(De.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",N).single().then($=>({data:$,error:null})).catch($=>({data:null,error:$})),4e3,"profiles.select").catch($=>({data:null,error:$}))]);let F=null,q=null;if(Q?.data?.data?(F=Q.data.data,q=null):P?.data?.data?(F=P.data.data,q=null):q=Q?.error??P?.error??new Error("Profile fetch failed"),q)if(q.code==="PGRST116"){const $=j.user_metadata&&j.user_metadata.display_id?String(j.user_metadata.display_id):v0(A)||N.slice(0,8);let T=null,I=null;const Y=await no(De.from("profiles").insert([{id:N,display_id:$,email:A||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),8e3,"profiles.insert(with_email)");if(T=Y?.data??null,I=Y?.error??null,I&&String(I.message||"").toLowerCase().includes("email")){const ae=await no(De.from("profiles").insert([{id:N,display_id:$,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),8e3,"profiles.insert");T=ae?.data??null,I=ae?.error??null}if(I)throw I;z=T}else throw q;else z=F;if(z&&Object.prototype.hasOwnProperty.call(z,"email")&&A&&!z.email)try{await De.from("profiles").update({email:A}).eq("id",N)}catch($){console.warn("Failed to backfill profile email",$)}break}catch(Q){console.error(`Failed to load/create profile (Attempt ${B+1}/${L}):`,Q),B++,B<L&&await new Promise(P=>setTimeout(P,500*B))}const _=z?.display_id||v0(A)||N.slice(0,8),M=z?.role||"user",k=String(M).trim().toLowerCase(),G=z?.show_master_recipes===!0,V={id:N,email:A,displayId:_,role:k,showMasterRecipes:G};s(V);try{localStorage.setItem("auth_user_cache",JSON.stringify(V))}catch(Q){console.warn("[Auth] Failed to save cache",Q)}},[]);b.useEffect(()=>{let j=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:N}=De.auth.onAuthStateChange(async(z,B)=>{z==="PASSWORD_RECOVERY"&&d(!0);try{await p(B?.user||null)}catch(L){console.error("Auth state change handler failed:",L)}});return j=N?.subscription,(async()=>{try{const{data:z}=await no(De.auth.getSession(),8e3,"auth.getSession");await p(z?.session?.user||null)}catch(z){console.error("Auth init failed:",z)}finally{c(!1)}})(),()=>{try{j?.unsubscribe?.()}catch{}}},[p]);const f=b.useCallback(async(j,N)=>{const{error:A}=await De.auth.signInWithPassword({email:j,password:N});if(A)throw console.error("Login error:",A),new Error("")},[]),m=b.useCallback(async(j,N,A)=>{const{data:z,error:B}=await De.auth.signUp({email:j,password:N,options:{data:{display_id:A}}});if(B)throw console.error("SignUp error:",B),new Error(B.message||"");const L=z?.user;if(L?.id){let _=null;_=(await De.from("profiles").insert([{id:L.id,display_id:A,email:j||null,role:"user",show_master_recipes:!1}]))?.error??null,_&&String(_.message||"").toLowerCase().includes("email")&&(_=(await De.from("profiles").insert([{id:L.id,display_id:A,role:"user",show_master_recipes:!1}]))?.error??null),_&&_.code!=="23505"&&console.error("Profile create error:",_)}return{needsEmailConfirmation:!z?.session}},[]),y=b.useCallback(async()=>{await De.auth.signOut(),s(null),d(!1)},[]),v=b.useCallback(j=>{!j||typeof j!="object"||s(N=>N&&{...N,...j})},[]),x=b.useCallback(async j=>{const{error:N}=await De.auth.resetPasswordForEmail(j,{redirectTo:window.location.origin});if(N)throw console.error("Password reset email error:",N),new Error("");return!0},[]),S=b.useCallback(async j=>{const{error:N}=await De.auth.updateUser({password:j});if(N)throw console.error("Update password error:",N),new Error("");return!0},[]),C=b.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),E=b.useMemo(()=>({user:t,loading:l,login:f,register:m,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:S,finishPasswordRecovery:C}),[t,l,f,m,y,v,x,u,S,C]);return i.jsx(Ox.Provider,{value:E,children:n})},ZN=({id:n,message:t,type:s="info",onClose:l})=>{b.useEffect(()=>{const u=setTimeout(()=>{l(n)},3e3);return()=>clearTimeout(u)},[n,l]);const c=()=>{switch(s){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return i.jsxs("div",{className:`toast toast-${s}`,children:[i.jsx("div",{className:"toast-icon",children:c()}),i.jsx("div",{className:"toast-message",children:t}),i.jsx("button",{className:"toast-close",onClick:()=>l(n),"aria-label":"",children:""})]})},eR=({toasts:n,onRemove:t})=>n.length===0?null:i.jsx("div",{className:"toast-container",children:n.map(s=>i.jsx(ZN,{id:s.id,message:s.message,type:s.type,onClose:t},s.id))}),tR=({children:n})=>{const[t,s]=b.useState([]),l=b.useCallback((d,p="info")=>{const f=Date.now()+Math.random();s(m=>[...m,{id:f,message:d,type:p}].slice(-5))},[]),c=b.useCallback(d=>{s(p=>p.filter(f=>f.id!==d))},[]),u={showToast:l,success:d=>l(d,"success"),error:d=>l(d,"error"),warning:d=>l(d,"warning"),info:d=>l(d,"info")};return i.jsxs(Dx.Provider,{value:u,children:[n,i.jsx(eR,{toasts:t,onRemove:c})]})},nR=()=>{const[n,t]=b.useState(!0),[s,l]=b.useState(!1),[c,u]=b.useState(""),[d,p]=b.useState(""),[f,m]=b.useState(""),[y,v]=b.useState(""),[x,S]=b.useState(""),[C,E]=b.useState(!1),[j,N]=b.useState(!1);Ue.useEffect(()=>{const k=localStorage.getItem("savedEmail"),G=localStorage.getItem("savedPassword");k&&(u(k),G&&p(G),N(!0))},[]);const{login:A,register:z,sendPasswordResetEmail:B}=is(),L=async k=>{k.preventDefault(),v(""),S(""),E(!0);try{await A(c.trim(),d),j?(localStorage.setItem("savedEmail",c.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(G){v(G.message||"")}finally{E(!1)}},_=async k=>{k.preventDefault(),v(""),S(""),E(!0);try{if(!f.trim()){v("ID: yoshito");return}(await z(c.trim(),d,f.trim()))?.needsEmailConfirmation?S(""):S(""),t(!0),p("")}catch(G){v(G.message||"")}finally{E(!1)}},M=async k=>{k.preventDefault(),v(""),S(""),E(!0);try{await B(c.trim()),S(""),l(!1)}catch(G){v(G.message||"")}finally{E(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(xn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[i.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",i.jsx("br",{}),"Management"]}),i.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:s?"":n?"":""})]}),y&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),i.jsxs("form",{onSubmit:s?M:n?L:_,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"email",value:c,onChange:k=>u(k.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:d,onChange:k=>p(k.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&!n&&i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",i.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),i.jsx("input",{type:"text",value:f,onChange:k=>m(k.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!s&&i.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[i.jsx("input",{type:"checkbox",id:"rememberMe",checked:j,onChange:k=>N(k.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),i.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),i.jsx(fe,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:C,children:s?"":n?"":""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s?i.jsx("button",{type:"button",onClick:()=>{l(!1),v(""),S("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):i.jsx("button",{type:"button",onClick:()=>{l(!0),v(""),S("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!s&&i.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),S("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},rR=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:s}=is(),[l,c]=Ue.useState(""),[u,d]=Ue.useState(""),[p,f]=Ue.useState(""),[m,y]=Ue.useState(""),[v,x]=Ue.useState(!1),S=async C=>{if(C.preventDefault(),f(""),y(""),!l||l.length<8){f("8");return}if(l!==u){f("");return}x(!0);try{await n(l),y(""),t()}catch(E){console.error(E),f(E.message||"")}finally{x(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(xn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),i.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),p&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:p}),m&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),i.jsxs("form",{onSubmit:S,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:l,onChange:C=>c(C.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:u,onChange:C=>d(C.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsx(fe,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[i.jsx(fe,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),i.jsx(fe,{variant:"ghost",onClick:s,style:{flex:1},children:""})]})]})})},Sf=({label:n,subLabel:t,variant:s="screen",showLogo:l=!0})=>i.jsxs("div",{className:s==="screen"?"loading-screen":"loading-inline",children:[l&&i.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),i.jsxs("div",{className:"loading-text",children:[n,i.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[i.jsx("span",{children:"."}),i.jsx("span",{children:"."}),i.jsx("span",{children:"."})]})]}),i.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&i.jsx("div",{className:"loading-subtext",children:t})]});function sR(){const{user:n,logout:t,loading:s,isPasswordRecovery:l}=is(),c=Vi(),[u,d]=Qf(),[p,f]=b.useState([]),[m,y]=b.useState(!0),[v,x]=b.useState(0),[S,C]=b.useState([]),[E,j]=b.useState(!1),[N,A]=b.useState({}),[z,B]=b.useState({}),L=u.get("view"),_=(L==="create-mock"?"create":L)||"list",M=u.get("id"),k=p.find(H=>String(H.id)===M)||null,[G,V]=b.useState(null),[Q,P]=b.useState(!1),[F,q]=b.useState(""),[$,T]=b.useState(null),[I,Y]=b.useState(null),[ae,ye]=b.useState(""),[U,W]=b.useState("none"),[Z,ce]=b.useState(!1),[Oe,Se]=b.useState(!1),[Re,O]=b.useState(new Set),[ie,de]=b.useState("normal"),[Me,Le]=b.useState(!1),[Ke,$e]=b.useState(!1),[We,me]=b.useState(null),[Qe,ot]=b.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),ct={inventory:"",planner:"",data:"",users:"","order-list":""};b.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const H=window.matchMedia("(max-width: 700px)"),xe=()=>ot(!!H.matches);return xe(),H.addEventListener?H.addEventListener("change",xe):H.addListener(xe),()=>{H.removeEventListener?H.removeEventListener("change",xe):H.removeListener(xe)}},[]),b.useEffect(()=>{if(!Qe||!ct[_]||typeof window>"u")return;const H=`pc-recommend-shown:${_}`;try{if(window.sessionStorage.getItem(H)==="1")return;window.sessionStorage.setItem(H,"1")}catch{}me(_)},[_,Qe]),b.useEffect(()=>{_!=="list"&&W("none")},[_]),b.useEffect(()=>{if(!s){j(!1);return}const H=setTimeout(()=>j(!0),3500);return()=>clearTimeout(H)},[s]),b.useEffect(()=>{s||n&&(async()=>{try{const H=_==="trash"?Ge():we();await Promise.all([H,ne(),Gt()])}catch(H){console.error("Error during initial data load:",H)}})()},[s,n?.id]),b.useEffect(()=>{if(s)return;if(!n||n.role!=="admin"){A({}),B({});return}let H=!1;return(async()=>{try{const xe=await Hi.fetchAllProfiles();if(H)return;const _e={},et={};for(const wt of xe||[])wt?.id&&(_e[String(wt.id)]=wt),wt?.display_id&&(et[String(wt.display_id)]=wt);A(_e),B(et)}catch(xe){console.warn("Failed to load profiles for admin owner labels",xe)}})(),()=>{H=!0}},[s,n?.id,n?.role]);const mt=H=>{const _e=(H?.tags||[]).find(Qt=>Qt&&Qt.startsWith("owner:"));if(!_e)return"/";const et=String(_e.slice(6)),wt=N[et]||z[et]||null;return wt?wt.display_id||wt.email||et:et.length>12?`${et.slice(0,8)}`:et},ht=Ja(gr(To,{activationConstraint:{distance:10}}),gr(ko,{activationConstraint:{delay:1e3,tolerance:5}}),gr(el,{coordinateGetter:Au})),zt=H=>{const{active:xe,over:_e}=H;xe.id!==_e.id&&f(et=>{const wt=et.findIndex(Ft=>Ft.id===xe.id),Qt=et.findIndex(Ft=>Ft.id===_e.id);if(wt===-1||Qt===-1)return et;const ze=Gi(et,wt,Qt),xt=ze.map((Ft,Rn)=>({id:Ft.id,order_index:Rn}));return Nn.updateOrder(xt).catch(Ft=>console.error("Order update failed",Ft)),ze})},Gt=async()=>{try{const H=await Nn.fetchRecentRecipes();C(H||[])}catch(H){console.error("Failed to load history:",H)}},vt=async H=>{const xe=[H,...S.filter(_e=>_e!==H)].slice(0,20);C(xe);try{await Nn.addToHistory(H)}catch(_e){console.error("Failed to sync history",_e)}},ne=async()=>{try{const H=await Nn.getDeletedCount();x(H||0)}catch(H){console.error("Failed to load trash count:",H)}},we=async()=>{try{y(!0);const H=await Nn.fetchRecipes(n,{timeoutMs:15e3});f(H||[])}catch(H){console.error("Failed to fetch recipes:",H),c.error(`

(${H?.message||"unknown error"})`)}finally{y(!1)}},Ee=H=>(H||"").toString().replace(/\s+/g," ").trim(),Te=H=>Ee(H).toLowerCase(),tt="__NO_STORE__",_t="__OTHER_STORE__",Tt=[...new Set(p.map(H=>Ee(H.course)).filter(Boolean))],en=[...new Set(p.map(H=>Ee(H.category)).filter(Boolean))],jn=p.reduce((H,xe)=>{const _e=Te(xe.storeName);return _e&&(H[_e]=(H[_e]||0)+1),H},{}),bt=new Set(lu.map(H=>Te(H)).filter(Boolean)),tn=p.reduce((H,xe)=>Te(xe.storeName)?H:H+1,0),ln=p.reduce((H,xe)=>{const _e=Te(xe.storeName);return _e?bt.has(_e)?H:H+1:H},0),yn=p.reduce((H,xe)=>{const _e=Te(xe.course);return _e&&(H[_e]=(H[_e]||0)+1),H},{}),Un=p.reduce((H,xe)=>{const _e=Te(xe.category);return _e&&(H[_e]=(H[_e]||0)+1),H},{}),Vn=p.filter(H=>{const xe=Te(F),_e=F===""||F==="recent"&&S.includes(H.id)||H.tags&&H.tags.includes(F)||F===tt&&!Te(H.storeName)||F===_t&&Te(H.storeName)&&!bt.has(Te(H.storeName))||H.category&&Te(H.category)===xe||H.course&&Te(H.course)===xe||H.storeName&&Te(H.storeName)===xe,et=ae.toLowerCase().trim(),wt=!et||H.title.toLowerCase().includes(et)||H.description&&H.description.toLowerCase().includes(et)||H.ingredients&&H.ingredients.some(Qt=>Qt.name.toLowerCase().includes(et));return _e&&wt}),pe=F===""&&!ae.trim()&&_==="list",He=(H,xe={})=>{d({view:"detail",id:H.id,...xe})},Xe=async(H,xe=!1)=>{try{if(H.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&H.tags.some(et=>et==="owner:yoshito")){c.warning("");return}xe?(await Nn.restoreRecipe(H.id),(_==="trash"||_==="detail")&&(d({view:"trash"}),Ge()),c.success("")):(await Nn.deleteRecipe(H.id),f(p.filter(_e=>_e.id!==H.id)),d({view:"list"}),ne())}catch(_e){console.error("Failed to delete/restore recipe:",_e),c.error("")}finally{ne()}},Ve=async H=>{try{await Nn.hardDeleteRecipe(H.id),f(p.filter(xe=>xe.id!==H.id)),d({view:"trash"}),c.success(""),Ge(),ne()}catch(xe){console.error("Failed to hard delete recipe:",xe),c.error("")}},Ge=async()=>{try{y(!0);const H=await Nn.fetchDeletedRecipes();f(H||[]),q("")}catch(H){console.error("Failed to fetch deleted recipes:",H)}finally{y(!1)}},At=()=>{d({view:"trash"}),Ge()},Ct=()=>{d({view:"list"}),we()},Nt=async(H,xe)=>{try{let _e,et=xe;if(xe&&n.role!=="admin"){const wt=H.tags?.find(ze=>ze.startsWith("owner:"));wt===`owner:${n.id}`||n.displayId&&wt===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${wt||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),et=!1)}et?(_e=await Nn.updateRecipe(H,n),f(p.map(wt=>wt.id===_e.id?_e:wt))):(_e=await Nn.createRecipe(H,n),f([_e,...p])),d(et?{view:"detail",id:_e.id}:{view:"detail",id:_e.id})}catch(_e){console.error("Failed to save recipe:",_e),c.error(`
: ${_e.message||_e.error_description||JSON.stringify(_e)}`)}};b.useEffect(()=>{let H=!1;return(async()=>{if(_!=="edit"||!M){V(null),P(!1);return}P(!0);try{const _e=await Nn.getRecipe(M);if(H)return;V(_e)}catch(_e){if(console.error("Failed to load edit recipe details",_e),H)return;V(k),c.warning("")}finally{H||P(!1)}})(),()=>{H=!0}},[_,M]);const Je=(H,xe="")=>{const et=["","baker","","","","dough","fermentation"].some(St=>(H.title||"").toLowerCase().includes(St)),wt=["flour","","","","","","","","",""],Qt=["yeast","","",""],ze=H.ingredients||[],xt=ze.some(St=>Qt.some(on=>(St.name||"").toLowerCase().includes(on))),Ft=ze.some(St=>wt.some(on=>(St.name||"").toLowerCase().includes(on))&&!St.name.includes(""));if(ze.some(St=>St.quantity&&String(St.quantity).includes("%")||St.unit&&String(St.unit).includes("%"))||xt||et&&Ft){H.type="bread",H.flours=[],H.breadIngredients=[];const St=["flour","","","","","","","",""];if(ze.forEach(on=>{St.some(qt=>(on.name||"").includes(qt))?H.flours.push(on):H.breadIngredients.push(on)}),H.flours.length===0&&ze.length>0){const on=ze[0];(on.name||"").includes("")&&(H.flours.push(on),H.breadIngredients=H.breadIngredients.filter(Yn=>Yn!==on))}}H.sourceUrl=xe,xe&&(H.category="URL"),Y(H),d({view:"create"})},Ut=()=>{Se(!Oe),O(new Set)},Fe=H=>{const xe=new Set(Re);xe.has(H)?xe.delete(H):xe.add(H),O(xe)},Lt=()=>{Le(!0)},Xt=()=>{Le(!1)},Kt=async()=>{Le(!1);try{y(!0),_==="trash"?(await Promise.all(Array.from(Re).map(H=>Nn.hardDeleteRecipe(H))),Ge()):(await Promise.all(Array.from(Re).map(H=>Nn.deleteRecipe(H))),f(p.filter(H=>!Re.has(H.id))),ne()),O(new Set),Se(!1),c.success("")}catch(H){console.error("Bulk delete failed",H),c.warning(""),_==="trash"?Ge():we()}finally{y(!1)}},te=()=>{Re.size!==0&&$e(!0)},ee=()=>{$e(!1)},ue=async()=>{$e(!1);try{y(!0);for(const H of Re)await Nn.restoreRecipe(H);f(p.filter(H=>!Re.has(H.id))),ne(),Se(!1),O(new Set),c.success(""),Ge()}catch(H){console.error("Bulk restore failed",H),c.warning(""),Ge()}finally{y(!1)}},je=()=>{const H=Vn.map(xe=>xe.id);O(new Set(H))},Ie=H=>{f([H,...p]),d({view:"edit",id:H.id})};return b.useEffect(()=>{s||n&&(_==="trash"?Ge():_==="list"&&we())},[_,s,n?.id]),s&&!E?i.jsx(Sf,{label:"",subLabel:""}):n?l?i.jsx(rR,{}):i.jsxs(jj,{children:[Me&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(xn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",Re.size,"",_==="trash"?"":""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:_==="trash"?"":""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(fe,{variant:"ghost",onClick:Xt,children:""}),i.jsx(fe,{variant:"danger",onClick:Kt,children:_==="trash"?"":""})]})]})}),Ke&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(xn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",Re.size,""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(fe,{variant:"ghost",onClick:ee,children:""}),i.jsx(fe,{variant:"secondary",onClick:ue,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),i.jsx(Bn,{isOpen:!!We,onClose:()=>me(null),title:"PC",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[i.jsx("p",{style:{marginTop:0},children:ct[We]?i.jsxs(i.Fragment,{children:["",i.jsx("strong",{children:ct[We]}),"/"]}):i.jsx(i.Fragment,{children:"/"})}),i.jsxs("p",{style:{marginBottom:0},children:["",i.jsx("strong",{children:"PC"}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[i.jsx(fe,{variant:"ghost",onClick:()=>{me(null),d({view:"list"})},children:""}),i.jsx(fe,{variant:"primary",onClick:()=>me(null),children:"OK"})]})]})}),(_==="list"||_==="trash")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"container-header",children:[i.jsxs("h2",{className:"section-title",children:[_==="trash"?" ()":"",_==="list"&&i.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",p.length,")"]})]}),i.jsx("div",{className:"header-actions",children:_==="list"||_==="trash"?i.jsxs(i.Fragment,{children:[Oe?i.jsxs(i.Fragment,{children:[i.jsx(fe,{variant:"ghost",onClick:Ut,children:""}),i.jsx(fe,{variant:"secondary",onClick:je,children:""}),_==="trash"&&i.jsxs(fe,{variant:"secondary",onClick:te,disabled:Re.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",Re.size,")"]}),i.jsxs(fe,{variant:"danger",onClick:Lt,disabled:Re.size===0,children:[_==="trash"?"":""," (",Re.size,")"]})]}):i.jsx(i.Fragment,{children:_==="list"?i.jsx(i.Fragment,{children:i.jsx(fe,{onClick:()=>{Y(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):i.jsx(fe,{variant:"ghost",onClick:Ct,children:" "})}),i.jsx("button",{className:"mobile-menu-toggle",onClick:()=>ce(!Z),"aria-label":"",children:""}),i.jsxs("div",{className:`secondary-actions ${Z?"open":""}`,children:[i.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>ce(!1),"aria-label":"",children:""}),i.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[i.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&i.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&i.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),i.jsxs(fe,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),i.jsxs(fe,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),_==="list"&&i.jsxs(i.Fragment,{children:[i.jsxs(fe,{variant:"secondary",onClick:()=>{T("url"),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),i.jsxs(fe,{variant:"secondary",onClick:()=>{T("image"),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsx("div",{className:"pc-recommend-note",children:i.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),i.jsxs(fe,{variant:"secondary",onClick:()=>{d({view:"inventory"}),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsxs(fe,{variant:"secondary",onClick:()=>{d({view:"planner"}),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(fe,{variant:"secondary",onClick:()=>{d({view:"data"}),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&i.jsxs(fe,{variant:"secondary",onClick:()=>{d({view:"users"}),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(fe,{variant:"secondary",onClick:()=>{d({view:"order-list"}),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"})]}),!Oe&&i.jsxs(fe,{variant:"ghost",onClick:()=>{Ut(),ce(!1)},className:"danger-text",children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," ",_==="trash"?"":""]}),_==="list"&&i.jsxs(fe,{variant:"ghost",onClick:()=>{At(),ce(!1)},style:{position:"relative"},children:[i.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&i.jsx("span",{className:"trash-badge",children:v})]}),i.jsxs(fe,{variant:"ghost",onClick:()=>{Ct(),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(fe,{variant:"ghost",onClick:()=>{t(),ce(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]}),i.jsx("div",{className:`menu-backdrop ${Z?"open":""}`,onClick:()=>ce(!1),"aria-hidden":"true"})]}):null})]}),_==="list"&&i.jsxs("div",{className:"list-toolbar",children:[i.jsxs("div",{className:"search-container search-container--compact",children:[i.jsx("span",{className:"search-icon",children:""}),i.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:ae,onChange:H=>ye(H.target.value)})]}),i.jsxs("div",{className:"public-recipe-toggles",children:[i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${U==="mine"?"active":""}`,"aria-pressed":U==="mine",onClick:()=>W("mine"),children:" "}),i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${U==="others"?"active":""}`,"aria-pressed":U==="others",onClick:()=>W("others"),children:" "}),U!=="none"&&i.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>W("none"),children:" "})]})]}),i.jsxs("div",{className:"tag-filter-container",children:[i.jsxs("select",{className:"store-filter-select",value:F===tt?tt:F===_t?_t:lu.includes(F)?F:"",onChange:H=>q(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),lu.map(H=>i.jsxs("option",{value:H,children:[H," (",jn[Te(H)]||0,")"]},H)),i.jsxs("option",{value:tt,children:[" (",tn,")"]}),i.jsxs("option",{value:_t,children:[" (",ln,")"]})]}),i.jsxs("select",{className:"store-filter-select",value:Tt.includes(F)?F:"",onChange:H=>q(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),Tt.sort().map(H=>i.jsxs("option",{value:H,children:[H," (",yn[Te(H)]||0,")"]},H))]}),i.jsxs("select",{className:"store-filter-select",value:en.includes(F)?F:"",onChange:H=>q(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),en.sort().map(H=>i.jsxs("option",{value:H,children:[H," (",Un[Te(H)]||0,")"]},H))]}),i.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[i.jsx("button",{className:`tag-filter-btn ${ie==="normal"?"active":""}`,onClick:()=>de("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),i.jsx("button",{className:`tag-filter-btn ${ie==="all"?"active":""}`,onClick:()=>de("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),m?i.jsx(Sf,{label:"",variant:"inline",showLogo:!1}):p.length===0?i.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[_==="trash"?"":"",F!==""&&i.jsx("p",{children:""})]}):i.jsxs("div",{className:"main-content-wrapper",children:[_==="list"&&i.jsx("div",{className:"recent-list-wrapper",children:i.jsx(BN,{recipes:p,recentIds:S,onSelect:He})}),i.jsx("div",{className:"recipe-list-container",children:_==="list"?i.jsx(Fi,{sensors:ht,collisionDetection:Ef,onDragEnd:zt,children:i.jsx(bv,{recipes:Vn,onSelectRecipe:He,isSelectMode:Oe,selectedIds:Re,onToggleSelection:Fe,disableDrag:!pe,displayMode:ie,publicRecipeView:U,showOwner:n?.role==="admin",ownerLabelFn:mt,currentUser:n})}):i.jsx(bv,{recipes:Vn,onSelectRecipe:He,isSelectMode:Oe,selectedIds:Re,onToggleSelection:Fe,disableDrag:!0,displayMode:ie,publicRecipeView:U,showOwner:n?.role==="admin",ownerLabelFn:mt,currentUser:n})})]})]}),_==="detail"&&k&&i.jsx(fN,{recipe:k,ownerLabel:n?.role==="admin"?mt(k):void 0,isDeleted:!!k.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):k.deletedAt?At():Ct()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?Ct:void 0,onEdit:()=>d({view:"edit",id:k.id,from:u.get("from")}),onDelete:Xe,onView:vt,onHardDelete:Ve,onDuplicate:Ie}),_==="edit"&&M&&(Q?i.jsx(Sf,{label:"",subLabel:"URL"}):G&&i.jsx(h0,{initialData:G,onCancel:()=>d({view:"detail",id:M}),onSave:H=>Nt(H,!0)},`edit-${M}`)),_==="create"&&i.jsx(h0,{initialData:I,onCancel:()=>{d({view:"list"}),Y(null)},onSave:H=>Nt(H,!1)},I?"create-form-imported":"create-form"),$&&i.jsx(Gx,{initialMode:$,onClose:()=>T(null),onImport:Je}),(_==="data"||_==="data-management")&&i.jsx(IN,{onBack:()=>d({view:"list"})}),_==="levain-guide"&&i.jsx($N,{onBack:()=>d({view:"list"})}),_==="users"&&n?.role==="admin"&&i.jsx(qN,{onBack:()=>d({view:"list"})}),_==="inventory"&&i.jsx(VN,{onBack:()=>d({view:"list"})}),_==="planner"&&i.jsx(WN,{onBack:()=>d({view:"list"}),onSelectRecipe:H=>He(H,{from:"planner"})}),_==="order-list"&&i.jsx(XN,{onBack:()=>d({view:"list"})})]}):i.jsx(nR,{})}function iR(){return i.jsx(tR,{children:i.jsx(JN,{children:i.jsx(sR,{})})})}class aR extends Ue.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,s){console.error("Uncaught error:",t,s),this.setState({error:t,errorInfo:s})}render(){return this.state.hasError?i.jsxs("div",{style:{padding:"2rem",color:"red"},children:[i.jsx("h1",{children:""}),i.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),i.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),i.jsx("br",{}),i.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}Vw.createRoot(document.getElementById("root")).render(i.jsx(b.StrictMode,{children:i.jsx(aR,{children:i.jsx(fj,{children:i.jsx(iR,{})})})}));
