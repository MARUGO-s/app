(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function s(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(c){if(c.ep)return;c.ep=!0;const u=s(c);fetch(c.href,u)}})();function x0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Mh={exports:{}},Vl={};var Ly;function Lw(){if(Ly)return Vl;Ly=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(l,c,u){var d=null;if(u!==void 0&&(d=""+u),c.key!==void 0&&(d=""+c.key),"key"in c){u={};for(var f in c)f!=="key"&&(u[f]=c[f])}else u=c;return c=u.ref,{$$typeof:n,type:l,key:d,ref:c!==void 0?c:null,props:u}}return Vl.Fragment=t,Vl.jsx=s,Vl.jsxs=s,Vl}var By;function Bw(){return By||(By=1,Mh.exports=Lw()),Mh.exports}var i=Bw(),zh={exports:{}},dt={};var Iy;function Iw(){if(Iy)return dt;Iy=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function S(U){return U===null||typeof U!="object"?null:(U=x&&U[x]||U["@@iterator"],typeof U=="function"?U:null)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,_={};function T(U,V,k){this.props=U,this.context=V,this.refs=_,this.updater=k||C}T.prototype.isReactComponent={},T.prototype.setState=function(U,V){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,V,"setState")},T.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function D(){}D.prototype=T.prototype;function B(U,V,k){this.props=U,this.context=V,this.refs=_,this.updater=k||C}var P=B.prototype=new D;P.constructor=B,E(P,T.prototype),P.isPureReactComponent=!0;var $=Array.isArray;function j(){}var M={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function F(U,V,k){var te=k.ref;return{$$typeof:n,type:U,key:V,ref:te!==void 0?te:null,props:k}}function Q(U,V){return F(U.type,V,U.props)}function G(U){return typeof U=="object"&&U!==null&&U.$$typeof===n}function H(U){var V={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(k){return V[k]})}var W=/\/+/g;function z(U,V){return typeof U=="object"&&U!==null&&U.key!=null?H(""+U.key):V.toString(36)}function I(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(j,j):(U.status="pending",U.then(function(V){U.status==="pending"&&(U.status="fulfilled",U.value=V)},function(V){U.status==="pending"&&(U.status="rejected",U.reason=V)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function N(U,V,k,te,de){var fe=typeof U;(fe==="undefined"||fe==="boolean")&&(U=null);var J=!1;if(U===null)J=!0;else switch(fe){case"bigint":case"string":case"number":J=!0;break;case"object":switch(U.$$typeof){case n:case t:J=!0;break;case y:return J=U._init,N(J(U._payload),V,k,te,de)}}if(J)return de=de(U),J=te===""?"."+z(U,0):te,$(de)?(k="",J!=null&&(k=J.replace(W,"$&/")+"/"),N(de,V,k,"",function(ge){return ge})):de!=null&&(G(de)&&(de=Q(de,k+(de.key==null||U&&U.key===de.key?"":(""+de.key).replace(W,"$&/")+"/")+J)),V.push(de)),1;J=0;var q=te===""?".":te+":";if($(U))for(var le=0;le<U.length;le++)te=U[le],fe=q+z(te,le),J+=N(te,V,k,fe,de);else if(le=S(U),typeof le=="function")for(U=le.call(U),le=0;!(te=U.next()).done;)te=te.value,fe=q+z(te,le++),J+=N(te,V,k,fe,de);else if(fe==="object"){if(typeof U.then=="function")return N(I(U),V,k,te,de);throw V=String(U),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return J}function L(U,V,k){if(U==null)return U;var te=[],de=0;return N(U,te,"","",function(fe){return V.call(k,fe,de++)}),te}function K(U){if(U._status===-1){var V=U._result;V=V(),V.then(function(k){(U._status===0||U._status===-1)&&(U._status=1,U._result=k)},function(k){(U._status===0||U._status===-1)&&(U._status=2,U._result=k)}),U._status===-1&&(U._status=0,U._result=V)}if(U._status===1)return U._result.default;throw U._result}var oe=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)},he={map:L,forEach:function(U,V,k){L(U,function(){V.apply(this,arguments)},k)},count:function(U){var V=0;return L(U,function(){V++}),V},toArray:function(U){return L(U,function(V){return V})||[]},only:function(U){if(!G(U))throw Error("React.Children.only expected to receive a single React element child.");return U}};return dt.Activity=v,dt.Children=he,dt.Component=T,dt.Fragment=s,dt.Profiler=c,dt.PureComponent=B,dt.StrictMode=l,dt.Suspense=p,dt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,dt.__COMPILER_RUNTIME={__proto__:null,c:function(U){return M.H.useMemoCache(U)}},dt.cache=function(U){return function(){return U.apply(null,arguments)}},dt.cacheSignal=function(){return null},dt.cloneElement=function(U,V,k){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var te=E({},U.props),de=U.key;if(V!=null)for(fe in V.key!==void 0&&(de=""+V.key),V)!A.call(V,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&V.ref===void 0||(te[fe]=V[fe]);var fe=arguments.length-2;if(fe===1)te.children=k;else if(1<fe){for(var J=Array(fe),q=0;q<fe;q++)J[q]=arguments[q+2];te.children=J}return F(U.type,de,te)},dt.createContext=function(U){return U={$$typeof:d,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:u,_context:U},U},dt.createElement=function(U,V,k){var te,de={},fe=null;if(V!=null)for(te in V.key!==void 0&&(fe=""+V.key),V)A.call(V,te)&&te!=="key"&&te!=="__self"&&te!=="__source"&&(de[te]=V[te]);var J=arguments.length-2;if(J===1)de.children=k;else if(1<J){for(var q=Array(J),le=0;le<J;le++)q[le]=arguments[le+2];de.children=q}if(U&&U.defaultProps)for(te in J=U.defaultProps,J)de[te]===void 0&&(de[te]=J[te]);return F(U,fe,de)},dt.createRef=function(){return{current:null}},dt.forwardRef=function(U){return{$$typeof:f,render:U}},dt.isValidElement=G,dt.lazy=function(U){return{$$typeof:y,_payload:{_status:-1,_result:U},_init:K}},dt.memo=function(U,V){return{$$typeof:g,type:U,compare:V===void 0?null:V}},dt.startTransition=function(U){var V=M.T,k={};M.T=k;try{var te=U(),de=M.S;de!==null&&de(k,te),typeof te=="object"&&te!==null&&typeof te.then=="function"&&te.then(j,oe)}catch(fe){oe(fe)}finally{V!==null&&k.types!==null&&(V.types=k.types),M.T=V}},dt.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},dt.use=function(U){return M.H.use(U)},dt.useActionState=function(U,V,k){return M.H.useActionState(U,V,k)},dt.useCallback=function(U,V){return M.H.useCallback(U,V)},dt.useContext=function(U){return M.H.useContext(U)},dt.useDebugValue=function(){},dt.useDeferredValue=function(U,V){return M.H.useDeferredValue(U,V)},dt.useEffect=function(U,V){return M.H.useEffect(U,V)},dt.useEffectEvent=function(U){return M.H.useEffectEvent(U)},dt.useId=function(){return M.H.useId()},dt.useImperativeHandle=function(U,V,k){return M.H.useImperativeHandle(U,V,k)},dt.useInsertionEffect=function(U,V){return M.H.useInsertionEffect(U,V)},dt.useLayoutEffect=function(U,V){return M.H.useLayoutEffect(U,V)},dt.useMemo=function(U,V){return M.H.useMemo(U,V)},dt.useOptimistic=function(U,V){return M.H.useOptimistic(U,V)},dt.useReducer=function(U,V,k){return M.H.useReducer(U,V,k)},dt.useRef=function(U){return M.H.useRef(U)},dt.useState=function(U){return M.H.useState(U)},dt.useSyncExternalStore=function(U,V,k){return M.H.useSyncExternalStore(U,V,k)},dt.useTransition=function(){return M.H.useTransition()},dt.version="19.2.3",dt}var $y;function wo(){return $y||($y=1,zh.exports=Iw()),zh.exports}var w=wo();const Ae=x0(w);var Uh={exports:{}},Yl={},Lh={exports:{}},Bh={};var qy;function $w(){return qy||(qy=1,(function(n){function t(N,L){var K=N.length;N.push(L);e:for(;0<K;){var oe=K-1>>>1,he=N[oe];if(0<c(he,L))N[oe]=L,N[K]=he,K=oe;else break e}}function s(N){return N.length===0?null:N[0]}function l(N){if(N.length===0)return null;var L=N[0],K=N.pop();if(K!==L){N[0]=K;e:for(var oe=0,he=N.length,U=he>>>1;oe<U;){var V=2*(oe+1)-1,k=N[V],te=V+1,de=N[te];if(0>c(k,K))te<he&&0>c(de,k)?(N[oe]=de,N[te]=K,oe=te):(N[oe]=k,N[V]=K,oe=V);else if(te<he&&0>c(de,K))N[oe]=de,N[te]=K,oe=te;else break e}}return L}function c(N,L){var K=N.sortIndex-L.sortIndex;return K!==0?K:N.id-L.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,f=d.now();n.unstable_now=function(){return d.now()-f}}var p=[],g=[],y=1,v=null,x=3,S=!1,C=!1,E=!1,_=!1,T=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function P(N){for(var L=s(g);L!==null;){if(L.callback===null)l(g);else if(L.startTime<=N)l(g),L.sortIndex=L.expirationTime,t(p,L);else break;L=s(g)}}function $(N){if(E=!1,P(N),!C)if(s(p)!==null)C=!0,j||(j=!0,H());else{var L=s(g);L!==null&&I($,L.startTime-N)}}var j=!1,M=-1,A=5,F=-1;function Q(){return _?!0:!(n.unstable_now()-F<A)}function G(){if(_=!1,j){var N=n.unstable_now();F=N;var L=!0;try{e:{C=!1,E&&(E=!1,D(M),M=-1),S=!0;var K=x;try{t:{for(P(N),v=s(p);v!==null&&!(v.expirationTime>N&&Q());){var oe=v.callback;if(typeof oe=="function"){v.callback=null,x=v.priorityLevel;var he=oe(v.expirationTime<=N);if(N=n.unstable_now(),typeof he=="function"){v.callback=he,P(N),L=!0;break t}v===s(p)&&l(p),P(N)}else l(p);v=s(p)}if(v!==null)L=!0;else{var U=s(g);U!==null&&I($,U.startTime-N),L=!1}}break e}finally{v=null,x=K,S=!1}L=void 0}}finally{L?H():j=!1}}}var H;if(typeof B=="function")H=function(){B(G)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,z=W.port2;W.port1.onmessage=G,H=function(){z.postMessage(null)}}else H=function(){T(G,0)};function I(N,L){M=T(function(){N(n.unstable_now())},L)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(N){N.callback=null},n.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<N?Math.floor(1e3/N):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(N){switch(x){case 1:case 2:case 3:var L=3;break;default:L=x}var K=x;x=L;try{return N()}finally{x=K}},n.unstable_requestPaint=function(){_=!0},n.unstable_runWithPriority=function(N,L){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var K=x;x=N;try{return L()}finally{x=K}},n.unstable_scheduleCallback=function(N,L,K){var oe=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?oe+K:oe):K=oe,N){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=K+he,N={id:y++,callback:L,priorityLevel:N,startTime:K,expirationTime:he,sortIndex:-1},K>oe?(N.sortIndex=K,t(g,N),s(p)===null&&N===s(g)&&(E?(D(M),M=-1):E=!0,I($,K-oe))):(N.sortIndex=he,t(p,N),C||S||(C=!0,j||(j=!0,H()))),N},n.unstable_shouldYield=Q,n.unstable_wrapCallback=function(N){var L=x;return function(){var K=x;x=L;try{return N.apply(this,arguments)}finally{x=K}}}})(Bh)),Bh}var Py;function qw(){return Py||(Py=1,Lh.exports=$w()),Lh.exports}var Ih={exports:{}},Xn={};var Hy;function Pw(){if(Hy)return Xn;Hy=1;var n=wo();function t(p){var g="https://react.dev/errors/"+p;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)g+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var l={d:{f:s,r:function(){throw Error(t(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},c=Symbol.for("react.portal");function u(p,g,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:v==null?null:""+v,children:p,containerInfo:g,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(p,g){if(p==="font")return"";if(typeof g=="string")return g==="use-credentials"?g:""}return Xn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,Xn.createPortal=function(p,g){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)throw Error(t(299));return u(p,g,null,y)},Xn.flushSync=function(p){var g=d.T,y=l.p;try{if(d.T=null,l.p=2,p)return p()}finally{d.T=g,l.p=y,l.d.f()}},Xn.preconnect=function(p,g){typeof p=="string"&&(g?(g=g.crossOrigin,g=typeof g=="string"?g==="use-credentials"?g:"":void 0):g=null,l.d.C(p,g))},Xn.prefetchDNS=function(p){typeof p=="string"&&l.d.D(p)},Xn.preinit=function(p,g){if(typeof p=="string"&&g&&typeof g.as=="string"){var y=g.as,v=f(y,g.crossOrigin),x=typeof g.integrity=="string"?g.integrity:void 0,S=typeof g.fetchPriority=="string"?g.fetchPriority:void 0;y==="style"?l.d.S(p,typeof g.precedence=="string"?g.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:S}):y==="script"&&l.d.X(p,{crossOrigin:v,integrity:x,fetchPriority:S,nonce:typeof g.nonce=="string"?g.nonce:void 0})}},Xn.preinitModule=function(p,g){if(typeof p=="string")if(typeof g=="object"&&g!==null){if(g.as==null||g.as==="script"){var y=f(g.as,g.crossOrigin);l.d.M(p,{crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0})}}else g==null&&l.d.M(p)},Xn.preload=function(p,g){if(typeof p=="string"&&typeof g=="object"&&g!==null&&typeof g.as=="string"){var y=g.as,v=f(y,g.crossOrigin);l.d.L(p,y,{crossOrigin:v,integrity:typeof g.integrity=="string"?g.integrity:void 0,nonce:typeof g.nonce=="string"?g.nonce:void 0,type:typeof g.type=="string"?g.type:void 0,fetchPriority:typeof g.fetchPriority=="string"?g.fetchPriority:void 0,referrerPolicy:typeof g.referrerPolicy=="string"?g.referrerPolicy:void 0,imageSrcSet:typeof g.imageSrcSet=="string"?g.imageSrcSet:void 0,imageSizes:typeof g.imageSizes=="string"?g.imageSizes:void 0,media:typeof g.media=="string"?g.media:void 0})}},Xn.preloadModule=function(p,g){if(typeof p=="string")if(g){var y=f(g.as,g.crossOrigin);l.d.m(p,{as:typeof g.as=="string"&&g.as!=="script"?g.as:void 0,crossOrigin:y,integrity:typeof g.integrity=="string"?g.integrity:void 0})}else l.d.m(p)},Xn.requestFormReset=function(p){l.d.r(p)},Xn.unstable_batchedUpdates=function(p,g){return p(g)},Xn.useFormState=function(p,g,y){return d.H.useFormState(p,g,y)},Xn.useFormStatus=function(){return d.H.useHostTransitionStatus()},Xn.version="19.2.3",Xn}var Fy;function b0(){if(Fy)return Ih.exports;Fy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Ih.exports=Pw(),Ih.exports}var Gy;function Hw(){if(Gy)return Yl;Gy=1;var n=qw(),t=wo(),s=b0();function l(e){var r="https://react.dev/errors/"+e;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var r=e,a=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,(r.flags&4098)!==0&&(a=r.return),e=r.return;while(e)}return r.tag===3?a:null}function d(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function f(e){if(e.tag===31){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function p(e){if(u(e)!==e)throw Error(l(188))}function g(e){var r=e.alternate;if(!r){if(r=u(e),r===null)throw Error(l(188));return r!==e?null:e}for(var a=e,o=r;;){var h=a.return;if(h===null)break;var m=h.alternate;if(m===null){if(o=h.return,o!==null){a=o;continue}break}if(h.child===m.child){for(m=h.child;m;){if(m===a)return p(h),e;if(m===o)return p(h),r;m=m.sibling}throw Error(l(188))}if(a.return!==o.return)a=h,o=m;else{for(var b=!1,R=h.child;R;){if(R===a){b=!0,a=h,o=m;break}if(R===o){b=!0,o=h,a=m;break}R=R.sibling}if(!b){for(R=m.child;R;){if(R===a){b=!0,a=m,o=h;break}if(R===o){b=!0,o=m,a=h;break}R=R.sibling}if(!b)throw Error(l(189))}}if(a.alternate!==o)throw Error(l(190))}if(a.tag!==3)throw Error(l(188));return a.stateNode.current===a?e:r}function y(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e;for(e=e.child;e!==null;){if(r=y(e),r!==null)return r;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),B=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),Q=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function H(e){return e===null||typeof e!="object"?null:(e=G&&e[G]||e["@@iterator"],typeof e=="function"?e:null)}var W=Symbol.for("react.client.reference");function z(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===W?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case E:return"Fragment";case T:return"Profiler";case _:return"StrictMode";case $:return"Suspense";case j:return"SuspenseList";case F:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case C:return"Portal";case B:return e.displayName||"Context";case D:return(e._context.displayName||"Context")+".Consumer";case P:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case M:return r=e.displayName||null,r!==null?r:z(e.type)||"Memo";case A:r=e._payload,e=e._init;try{return z(e(r))}catch{}}return null}var I=Array.isArray,N=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},oe=[],he=-1;function U(e){return{current:e}}function V(e){0>he||(e.current=oe[he],oe[he]=null,he--)}function k(e,r){he++,oe[he]=e.current,e.current=r}var te=U(null),de=U(null),fe=U(null),J=U(null);function q(e,r){switch(k(fe,r),k(de,e),k(te,null),r.nodeType){case 9:case 11:e=(e=r.documentElement)&&(e=e.namespaceURI)?ay(e):0;break;default:if(e=r.tagName,r=r.namespaceURI)r=ay(r),e=ly(r,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}V(te),k(te,e)}function le(){V(te),V(de),V(fe)}function ge(e){e.memoizedState!==null&&k(J,e);var r=te.current,a=ly(r,e.type);r!==a&&(k(de,e),k(te,a))}function Ne(e){de.current===e&&(V(te),V(de)),J.current===e&&(V(J),Pl._currentValue=K)}var _e,Me;function Pe(e){if(_e===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);_e=r&&r[1]||"",Me=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+_e+e+Me}var me=!1;function Qe(e,r){if(!e||me)return"";me=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(r){var je=function(){throw Error()};if(Object.defineProperty(je.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(je,[])}catch(ye){var pe=ye}Reflect.construct(e,[],je)}else{try{je.call()}catch(ye){pe=ye}e.call(je.prototype)}}else{try{throw Error()}catch(ye){pe=ye}(je=e())&&typeof je.catch=="function"&&je.catch(function(){})}}catch(ye){if(ye&&pe&&typeof ye.stack=="string")return[ye.stack,pe.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var h=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");h&&h.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=o.DetermineComponentFrameRoot(),b=m[0],R=m[1];if(b&&R){var Y=b.split(`
`),ue=R.split(`
`);for(h=o=0;o<Y.length&&!Y[o].includes("DetermineComponentFrameRoot");)o++;for(;h<ue.length&&!ue[h].includes("DetermineComponentFrameRoot");)h++;if(o===Y.length||h===ue.length)for(o=Y.length-1,h=ue.length-1;1<=o&&0<=h&&Y[o]!==ue[h];)h--;for(;1<=o&&0<=h;o--,h--)if(Y[o]!==ue[h]){if(o!==1||h!==1)do if(o--,h--,0>h||Y[o]!==ue[h]){var we=`
`+Y[o].replace(" at new "," at ");return e.displayName&&we.includes("<anonymous>")&&(we=we.replace("<anonymous>",e.displayName)),we}while(1<=o&&0<=h);break}}}finally{me=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Pe(a):""}function Xe(e,r){switch(e.tag){case 26:case 27:case 5:return Pe(e.type);case 16:return Pe("Lazy");case 13:return e.child!==r&&r!==null?Pe("Suspense Fallback"):Pe("Suspense");case 19:return Pe("SuspenseList");case 0:case 15:return Qe(e.type,!1);case 11:return Qe(e.type.render,!1);case 1:return Qe(e.type,!0);case 31:return Pe("Activity");default:return""}}function bt(e){try{var r="",a=null;do r+=Xe(e,a),a=e,e=e.return;while(e);return r}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}var Nt=Object.prototype.hasOwnProperty,mt=n.unstable_scheduleCallback,et=n.unstable_cancelCallback,ct=n.unstable_shouldYield,wt=n.unstable_requestPaint,St=n.unstable_now,jt=n.unstable_getCurrentPriorityLevel,lt=n.unstable_ImmediatePriority,ut=n.unstable_UserBlockingPriority,Rt=n.unstable_NormalPriority,Tn=n.unstable_LowPriority,zn=n.unstable_IdlePriority,Ut=n.log,Er=n.unstable_setDisableYieldValue,qn=null,Xt=null;function an(e){if(typeof Ut=="function"&&Er(e),Xt&&typeof Xt.setStrictMode=="function")try{Xt.setStrictMode(qn,e)}catch{}}var ln=Math.clz32?Math.clz32:$r,on=Math.log,tn=Math.LN2;function $r(e){return e>>>=0,e===0?32:31-(on(e)/tn|0)|0}var Un=256,nn=262144,Lt=4194304;function Je(e){var r=e&42;if(r!==0)return r;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Bt(e,r,a){var o=e.pendingLanes;if(o===0)return 0;var h=0,m=e.suspendedLanes,b=e.pingedLanes;e=e.warmLanes;var R=o&134217727;return R!==0?(o=R&~m,o!==0?h=Je(o):(b&=R,b!==0?h=Je(b):a||(a=R&~e,a!==0&&(h=Je(a))))):(R=o&~m,R!==0?h=Je(R):b!==0?h=Je(b):a||(a=o&~e,a!==0&&(h=Je(a)))),h===0?0:r!==0&&r!==h&&(r&m)===0&&(m=h&-h,a=r&-r,m>=a||m===32&&(a&4194048)!==0)?r:h}function pn(e,r){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&r)===0}function cn(e,r){switch(e){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ot(){var e=Lt;return Lt<<=1,(Lt&62914560)===0&&(Lt=4194304),e}function mn(e){for(var r=[],a=0;31>a;a++)r.push(e);return r}function kt(e,r){e.pendingLanes|=r,r!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function gt(e,r,a,o,h,m){var b=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var R=e.entanglements,Y=e.expirationTimes,ue=e.hiddenUpdates;for(a=b&~a;0<a;){var we=31-ln(a),je=1<<we;R[we]=0,Y[we]=-1;var pe=ue[we];if(pe!==null)for(ue[we]=null,we=0;we<pe.length;we++){var ye=pe[we];ye!==null&&(ye.lane&=-536870913)}a&=~je}o!==0&&ne(e,o,0),m!==0&&h===0&&e.tag!==0&&(e.suspendedLanes|=m&~(b&~r))}function ne(e,r,a){e.pendingLanes|=r,e.suspendedLanes&=~r;var o=31-ln(r);e.entangledLanes|=r,e.entanglements[o]=e.entanglements[o]|1073741824|a&261930}function Be(e,r){var a=e.entangledLanes|=r;for(e=e.entanglements;a;){var o=31-ln(a),h=1<<o;h&r|e[o]&r&&(e[o]|=r),a&=~h}}function X(e,r){var a=r&-r;return a=(a&42)!==0?1:re(a),(a&(e.suspendedLanes|r))!==0?0:a}function re(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ae(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function xe(){var e=L.p;return e!==0?e:(e=window.event,e===void 0?32:Ay(e.type))}function Re(e,r){var a=L.p;try{return L.p=e,r()}finally{L.p=a}}var $e=Math.random().toString(36).slice(2),Oe="__reactFiber$"+$e,De="__reactProps$"+$e,rt="__reactContainer$"+$e,pt="__reactEvents$"+$e,gn="__reactListeners$"+$e,Ie="__reactHandles$"+$e,at="__reactResources$"+$e,It="__reactMarker$"+$e;function sr(e){delete e[Oe],delete e[De],delete e[pt],delete e[gn],delete e[Ie]}function An(e){var r=e[Oe];if(r)return r;for(var a=e.parentNode;a;){if(r=a[rt]||a[Oe]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(e=py(e);e!==null;){if(a=e[Oe])return a;e=py(e)}return r}e=a,a=e.parentNode}return null}function $t(e){if(e=e[Oe]||e[rt]){var r=e.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return e}return null}function Nr(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e.stateNode;throw Error(l(33))}function ir(e){var r=e[at];return r||(r=e[at]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function qt(e){e[It]=!0}var Os=new Set,er={};function pr(e,r){qr(e,r),qr(e+"Capture",r)}function qr(e,r){for(er[e]=r,e=0;e<r.length;e++)Os.add(r[e])}var Fi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ss={},Za={};function el(e){return Nt.call(Za,e)?!0:Nt.call(ss,e)?!1:Fi.test(e)?Za[e]=!0:(ss[e]=!0,!1)}function Gi(e,r,a){if(el(r))if(a===null)e.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(r);return;case"boolean":var o=r.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){e.removeAttribute(r);return}}e.setAttribute(r,""+a)}}function Ds(e,r,a){if(a===null)e.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttribute(r,""+a)}}function ar(e,r,a,o){if(o===null)e.removeAttribute(a);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(r,a,""+o)}}function Pn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function tl(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Uu(e,r,a){var o=Object.getOwnPropertyDescriptor(e.constructor.prototype,r);if(!e.hasOwnProperty(r)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var h=o.get,m=o.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return h.call(this)},set:function(b){a=""+b,m.call(this,b)}}),Object.defineProperty(e,r,{enumerable:o.enumerable}),{getValue:function(){return a},setValue:function(b){a=""+b},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function nl(e){if(!e._valueTracker){var r=tl(e)?"checked":"value";e._valueTracker=Uu(e,r,""+e[r])}}function Mo(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var a=r.getValue(),o="";return e&&(o=tl(e)?e.checked?"true":"false":e.value),e=o,e!==a?(r.setValue(e),!0):!1}function Vi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var rl=/[\n"\\]/g;function lr(e){return e.replace(rl,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function sl(e,r,a,o,h,m,b,R){e.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?e.type=b:e.removeAttribute("type"),r!=null?b==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+Pn(r)):e.value!==""+Pn(r)&&(e.value=""+Pn(r)):b!=="submit"&&b!=="reset"||e.removeAttribute("value"),r!=null?il(e,b,Pn(r)):a!=null?il(e,b,Pn(a)):o!=null&&e.removeAttribute("value"),h==null&&m!=null&&(e.defaultChecked=!!m),h!=null&&(e.checked=h&&typeof h!="function"&&typeof h!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?e.name=""+Pn(R):e.removeAttribute("name")}function Ms(e,r,a,o,h,m,b,R){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(e.type=m),r!=null||a!=null){if(!(m!=="submit"&&m!=="reset"||r!=null)){nl(e);return}a=a!=null?""+Pn(a):"",r=r!=null?""+Pn(r):a,R||r===e.value||(e.value=r),e.defaultValue=r}o=o??h,o=typeof o!="function"&&typeof o!="symbol"&&!!o,e.checked=R?e.checked:!!o,e.defaultChecked=!!o,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(e.name=b),nl(e)}function il(e,r,a){r==="number"&&Vi(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function zs(e,r,a,o){if(e=e.options,r){r={};for(var h=0;h<a.length;h++)r["$"+a[h]]=!0;for(a=0;a<e.length;a++)h=r.hasOwnProperty("$"+e[a].value),e[a].selected!==h&&(e[a].selected=h),h&&o&&(e[a].defaultSelected=!0)}else{for(a=""+Pn(a),r=null,h=0;h<e.length;h++){if(e[h].value===a){e[h].selected=!0,o&&(e[h].defaultSelected=!0);return}r!==null||e[h].disabled||(r=e[h])}r!==null&&(r.selected=!0)}}function zo(e,r,a){if(r!=null&&(r=""+Pn(r),r!==e.value&&(e.value=r),a==null)){e.defaultValue!==r&&(e.defaultValue=r);return}e.defaultValue=a!=null?""+Pn(a):""}function Uo(e,r,a,o){if(r==null){if(o!=null){if(a!=null)throw Error(l(92));if(I(o)){if(1<o.length)throw Error(l(93));o=o[0]}a=o}a==null&&(a=""),r=a}a=Pn(r),e.defaultValue=a,o=e.textContent,o===a&&o!==""&&o!==null&&(e.value=o),nl(e)}function is(e,r){if(r){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=r;return}}e.textContent=r}var Lo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Bo(e,r,a){var o=r.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?o?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="":o?e.setProperty(r,a):typeof a!="number"||a===0||Lo.has(r)?r==="float"?e.cssFloat=a:e[r]=(""+a).trim():e[r]=a+"px"}function Io(e,r,a){if(r!=null&&typeof r!="object")throw Error(l(62));if(e=e.style,a!=null){for(var o in a)!a.hasOwnProperty(o)||r!=null&&r.hasOwnProperty(o)||(o.indexOf("--")===0?e.setProperty(o,""):o==="float"?e.cssFloat="":e[o]="");for(var h in r)o=r[h],r.hasOwnProperty(h)&&a[h]!==o&&Bo(e,h,o)}else for(var m in r)r.hasOwnProperty(m)&&Bo(e,m,r[m])}function Yi(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),$o=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ki(e){return $o.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Pr(){}var al=null;function ll(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Us=null,Ls=null;function pi(e){var r=$t(e);if(r&&(e=r.stateNode)){var a=e[De]||null;e:switch(e=r.stateNode,r.type){case"input":if(sl(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),r=a.name,a.type==="radio"&&r!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+lr(""+r)+'"][type="radio"]'),r=0;r<a.length;r++){var o=a[r];if(o!==e&&o.form===e.form){var h=o[De]||null;if(!h)throw Error(l(90));sl(o,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name)}}for(r=0;r<a.length;r++)o=a[r],o.form===e.form&&Mo(o)}break e;case"textarea":zo(e,a.value,a.defaultValue);break e;case"select":r=a.value,r!=null&&zs(e,!!a.multiple,r,!1)}}}var Qi=!1;function O(e,r,a){if(Qi)return e(r,a);Qi=!0;try{var o=e(r);return o}finally{if(Qi=!1,(Us!==null||Ls!==null)&&(Sc(),Us&&(r=Us,e=Ls,Ls=Us=null,pi(r),e)))for(r=0;r<e.length;r++)pi(e[r])}}function Z(e,r){var a=e.stateNode;if(a===null)return null;var o=a[De]||null;if(o===null)return null;a=o[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(l(231,r,typeof a));return a}var ie=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ve=!1;if(ie)try{var Ce={};Object.defineProperty(Ce,"passive",{get:function(){ve=!0}}),window.addEventListener("test",Ce,Ce),window.removeEventListener("test",Ce,Ce)}catch{ve=!1}var Ee=null,ke=null,Ue=null;function Le(){if(Ue)return Ue;var e,r=ke,a=r.length,o,h="value"in Ee?Ee.value:Ee.textContent,m=h.length;for(e=0;e<a&&r[e]===h[e];e++);var b=a-e;for(o=1;o<=b&&r[a-o]===h[m-o];o++);return Ue=h.slice(e,1<o?1-o:void 0)}function He(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function Ke(){return!0}function Ze(){return!1}function ze(e){function r(a,o,h,m,b){this._reactName=a,this._targetInst=h,this.type=o,this.nativeEvent=m,this.target=b,this.currentTarget=null;for(var R in e)e.hasOwnProperty(R)&&(a=e[R],this[R]=a?a(m):m[R]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Ke:Ze,this.isPropagationStopped=Ze,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Ke)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Ke)},persist:function(){},isPersistent:Ke}),r}var tt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jt=ze(tt),Kt=v({},tt,{view:0,detail:0}),Bs=ze(Kt),Jr,Fe,Ve,ot=v({},Kt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Iu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ve&&(Ve&&e.type==="mousemove"?(Jr=e.screenX-Ve.screenX,Fe=e.screenY-Ve.screenY):Fe=Jr=0,Ve=e),Jr)},movementY:function(e){return"movementY"in e?e.movementY:Fe}}),Qt=ze(ot),yn=v({},ot,{dataTransfer:0}),wn=ze(yn),_t=v({},Kt,{relatedTarget:0}),Wn=ze(_t),Sn=v({},tt,{animationName:0,elapsedTime:0,pseudoElement:0}),as=ze(Sn),Zr=v({},tt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Is=ze(Zr),ol=v({},tt,{data:0}),Bu=ze(ol),ls={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yx(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=mi[e])?!!r[e]:!1}function Iu(){return Yx}var Kx=v({},Kt,{key:function(e){if(e.key){var r=ls[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=He(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Wi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Iu,charCode:function(e){return e.type==="keypress"?He(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?He(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Qx=ze(Kx),Wx=v({},ot,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dp=ze(Wx),Xx=v({},Kt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Iu}),Jx=ze(Xx),Zx=v({},tt,{propertyName:0,elapsedTime:0,pseudoElement:0}),eb=ze(Zx),tb=v({},ot,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),nb=ze(tb),rb=v({},tt,{newState:0,oldState:0}),sb=ze(rb),ib=[9,13,27,32],$u=ie&&"CompositionEvent"in window,cl=null;ie&&"documentMode"in document&&(cl=document.documentMode);var ab=ie&&"TextEvent"in window&&!cl,hp=ie&&(!$u||cl&&8<cl&&11>=cl),fp=" ",pp=!1;function mp(e,r){switch(e){case"keyup":return ib.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Xi=!1;function lb(e,r){switch(e){case"compositionend":return gp(r);case"keypress":return r.which!==32?null:(pp=!0,fp);case"textInput":return e=r.data,e===fp&&pp?null:e;default:return null}}function ob(e,r){if(Xi)return e==="compositionend"||!$u&&mp(e,r)?(e=Le(),Ue=ke=Ee=null,Xi=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return hp&&r.locale!=="ko"?null:r.data;default:return null}}var cb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yp(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!cb[e.type]:r==="textarea"}function vp(e,r,a,o){Us?Ls?Ls.push(o):Ls=[o]:Us=o,r=Tc(r,"onChange"),0<r.length&&(a=new Jt("onChange","change",null,a,o),e.push({event:a,listeners:r}))}var ul=null,dl=null;function ub(e){ey(e,0)}function qo(e){var r=Nr(e);if(Mo(r))return e}function xp(e,r){if(e==="change")return r}var bp=!1;if(ie){var qu;if(ie){var Pu="oninput"in document;if(!Pu){var wp=document.createElement("div");wp.setAttribute("oninput","return;"),Pu=typeof wp.oninput=="function"}qu=Pu}else qu=!1;bp=qu&&(!document.documentMode||9<document.documentMode)}function Sp(){ul&&(ul.detachEvent("onpropertychange",jp),dl=ul=null)}function jp(e){if(e.propertyName==="value"&&qo(dl)){var r=[];vp(r,dl,e,ll(e)),O(ub,r)}}function db(e,r,a){e==="focusin"?(Sp(),ul=r,dl=a,ul.attachEvent("onpropertychange",jp)):e==="focusout"&&Sp()}function hb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return qo(dl)}function fb(e,r){if(e==="click")return qo(r)}function pb(e,r){if(e==="input"||e==="change")return qo(r)}function mb(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var mr=typeof Object.is=="function"?Object.is:mb;function hl(e,r){if(mr(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var a=Object.keys(e),o=Object.keys(r);if(a.length!==o.length)return!1;for(o=0;o<a.length;o++){var h=a[o];if(!Nt.call(r,h)||!mr(e[h],r[h]))return!1}return!0}function _p(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Cp(e,r){var a=_p(e);e=0;for(var o;a;){if(a.nodeType===3){if(o=e+a.textContent.length,e<=r&&o>=r)return{node:a,offset:r-e};e=o}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=_p(a)}}function Ep(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?Ep(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function Np(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var r=Vi(e.document);r instanceof e.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)e=r.contentWindow;else break;r=Vi(e.document)}return r}function Hu(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}var gb=ie&&"documentMode"in document&&11>=document.documentMode,Ji=null,Fu=null,fl=null,Gu=!1;function Rp(e,r,a){var o=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Gu||Ji==null||Ji!==Vi(o)||(o=Ji,"selectionStart"in o&&Hu(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),fl&&hl(fl,o)||(fl=o,o=Tc(Fu,"onSelect"),0<o.length&&(r=new Jt("onSelect","select",null,r,a),e.push({event:r,listeners:o}),r.target=Ji)))}function gi(e,r){var a={};return a[e.toLowerCase()]=r.toLowerCase(),a["Webkit"+e]="webkit"+r,a["Moz"+e]="moz"+r,a}var Zi={animationend:gi("Animation","AnimationEnd"),animationiteration:gi("Animation","AnimationIteration"),animationstart:gi("Animation","AnimationStart"),transitionrun:gi("Transition","TransitionRun"),transitionstart:gi("Transition","TransitionStart"),transitioncancel:gi("Transition","TransitionCancel"),transitionend:gi("Transition","TransitionEnd")},Vu={},Tp={};ie&&(Tp=document.createElement("div").style,"AnimationEvent"in window||(delete Zi.animationend.animation,delete Zi.animationiteration.animation,delete Zi.animationstart.animation),"TransitionEvent"in window||delete Zi.transitionend.transition);function yi(e){if(Vu[e])return Vu[e];if(!Zi[e])return e;var r=Zi[e],a;for(a in r)if(r.hasOwnProperty(a)&&a in Tp)return Vu[e]=r[a];return e}var Ap=yi("animationend"),kp=yi("animationiteration"),Op=yi("animationstart"),yb=yi("transitionrun"),vb=yi("transitionstart"),xb=yi("transitioncancel"),Dp=yi("transitionend"),Mp=new Map,Yu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yu.push("scrollEnd");function Hr(e,r){Mp.set(e,r),pr(r,[e])}var Po=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Rr=[],ea=0,Ku=0;function Ho(){for(var e=ea,r=Ku=ea=0;r<e;){var a=Rr[r];Rr[r++]=null;var o=Rr[r];Rr[r++]=null;var h=Rr[r];Rr[r++]=null;var m=Rr[r];if(Rr[r++]=null,o!==null&&h!==null){var b=o.pending;b===null?h.next=h:(h.next=b.next,b.next=h),o.pending=h}m!==0&&zp(a,h,m)}}function Fo(e,r,a,o){Rr[ea++]=e,Rr[ea++]=r,Rr[ea++]=a,Rr[ea++]=o,Ku|=o,e.lanes|=o,e=e.alternate,e!==null&&(e.lanes|=o)}function Qu(e,r,a,o){return Fo(e,r,a,o),Go(e)}function vi(e,r){return Fo(e,null,null,r),Go(e)}function zp(e,r,a){e.lanes|=a;var o=e.alternate;o!==null&&(o.lanes|=a);for(var h=!1,m=e.return;m!==null;)m.childLanes|=a,o=m.alternate,o!==null&&(o.childLanes|=a),m.tag===22&&(e=m.stateNode,e===null||e._visibility&1||(h=!0)),e=m,m=m.return;return e.tag===3?(m=e.stateNode,h&&r!==null&&(h=31-ln(a),e=m.hiddenUpdates,o=e[h],o===null?e[h]=[r]:o.push(r),r.lane=a|536870912),m):null}function Go(e){if(50<zl)throw zl=0,sh=null,Error(l(185));for(var r=e.return;r!==null;)e=r,r=e.return;return e.tag===3?e.stateNode:null}var ta={};function bb(e,r,a,o){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gr(e,r,a,o){return new bb(e,r,a,o)}function Wu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function os(e,r){var a=e.alternate;return a===null?(a=gr(e.tag,r,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=r,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,r=e.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Up(e,r){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=r,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,r=a.dependencies,e.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e}function Vo(e,r,a,o,h,m){var b=0;if(o=e,typeof e=="function")Wu(e)&&(b=1);else if(typeof e=="string")b=Cw(e,a,te.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case F:return e=gr(31,a,r,h),e.elementType=F,e.lanes=m,e;case E:return xi(a.children,h,m,r);case _:b=8,h|=24;break;case T:return e=gr(12,a,r,h|2),e.elementType=T,e.lanes=m,e;case $:return e=gr(13,a,r,h),e.elementType=$,e.lanes=m,e;case j:return e=gr(19,a,r,h),e.elementType=j,e.lanes=m,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case B:b=10;break e;case D:b=9;break e;case P:b=11;break e;case M:b=14;break e;case A:b=16,o=null;break e}b=29,a=Error(l(130,e===null?"null":typeof e,"")),o=null}return r=gr(b,a,r,h),r.elementType=e,r.type=o,r.lanes=m,r}function xi(e,r,a,o){return e=gr(7,e,o,r),e.lanes=a,e}function Xu(e,r,a){return e=gr(6,e,null,r),e.lanes=a,e}function Lp(e){var r=gr(18,null,null,0);return r.stateNode=e,r}function Ju(e,r,a){return r=gr(4,e.children!==null?e.children:[],e.key,r),r.lanes=a,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}var Bp=new WeakMap;function Tr(e,r){if(typeof e=="object"&&e!==null){var a=Bp.get(e);return a!==void 0?a:(r={value:e,source:r,stack:bt(r)},Bp.set(e,r),r)}return{value:e,source:r,stack:bt(r)}}var na=[],ra=0,Yo=null,pl=0,Ar=[],kr=0,$s=null,es=1,ts="";function cs(e,r){na[ra++]=pl,na[ra++]=Yo,Yo=e,pl=r}function Ip(e,r,a){Ar[kr++]=es,Ar[kr++]=ts,Ar[kr++]=$s,$s=e;var o=es;e=ts;var h=32-ln(o)-1;o&=~(1<<h),a+=1;var m=32-ln(r)+h;if(30<m){var b=h-h%5;m=(o&(1<<b)-1).toString(32),o>>=b,h-=b,es=1<<32-ln(r)+h|a<<h|o,ts=m+e}else es=1<<m|a<<h|o,ts=e}function Zu(e){e.return!==null&&(cs(e,1),Ip(e,1,0))}function ed(e){for(;e===Yo;)Yo=na[--ra],na[ra]=null,pl=na[--ra],na[ra]=null;for(;e===$s;)$s=Ar[--kr],Ar[kr]=null,ts=Ar[--kr],Ar[kr]=null,es=Ar[--kr],Ar[kr]=null}function $p(e,r){Ar[kr++]=es,Ar[kr++]=ts,Ar[kr++]=$s,es=r.id,ts=r.overflow,$s=e}var Hn=null,Zt=null,Tt=!1,qs=null,Or=!1,td=Error(l(519));function Ps(e){var r=Error(l(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ml(Tr(r,e)),td}function qp(e){var r=e.stateNode,a=e.type,o=e.memoizedProps;switch(r[Oe]=e,r[De]=o,a){case"dialog":vt("cancel",r),vt("close",r);break;case"iframe":case"object":case"embed":vt("load",r);break;case"video":case"audio":for(a=0;a<Ll.length;a++)vt(Ll[a],r);break;case"source":vt("error",r);break;case"img":case"image":case"link":vt("error",r),vt("load",r);break;case"details":vt("toggle",r);break;case"input":vt("invalid",r),Ms(r,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0);break;case"select":vt("invalid",r);break;case"textarea":vt("invalid",r),Uo(r,o.value,o.defaultValue,o.children)}a=o.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||r.textContent===""+a||o.suppressHydrationWarning===!0||sy(r.textContent,a)?(o.popover!=null&&(vt("beforetoggle",r),vt("toggle",r)),o.onScroll!=null&&vt("scroll",r),o.onScrollEnd!=null&&vt("scrollend",r),o.onClick!=null&&(r.onclick=Pr),r=!0):r=!1,r||Ps(e,!0)}function Pp(e){for(Hn=e.return;Hn;)switch(Hn.tag){case 5:case 31:case 13:Or=!1;return;case 27:case 3:Or=!0;return;default:Hn=Hn.return}}function sa(e){if(e!==Hn)return!1;if(!Tt)return Pp(e),Tt=!0,!1;var r=e.tag,a;if((a=r!==3&&r!==27)&&((a=r===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||xh(e.type,e.memoizedProps)),a=!a),a&&Zt&&Ps(e),Pp(e),r===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));Zt=fy(e)}else if(r===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));Zt=fy(e)}else r===27?(r=Zt,ni(e.type)?(e=_h,_h=null,Zt=e):Zt=r):Zt=Hn?Mr(e.stateNode.nextSibling):null;return!0}function bi(){Zt=Hn=null,Tt=!1}function nd(){var e=qs;return e!==null&&(dr===null?dr=e:dr.push.apply(dr,e),qs=null),e}function ml(e){qs===null?qs=[e]:qs.push(e)}var rd=U(null),wi=null,us=null;function Hs(e,r,a){k(rd,r._currentValue),r._currentValue=a}function ds(e){e._currentValue=rd.current,V(rd)}function sd(e,r,a){for(;e!==null;){var o=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,o!==null&&(o.childLanes|=r)):o!==null&&(o.childLanes&r)!==r&&(o.childLanes|=r),e===a)break;e=e.return}}function id(e,r,a,o){var h=e.child;for(h!==null&&(h.return=e);h!==null;){var m=h.dependencies;if(m!==null){var b=h.child;m=m.firstContext;e:for(;m!==null;){var R=m;m=h;for(var Y=0;Y<r.length;Y++)if(R.context===r[Y]){m.lanes|=a,R=m.alternate,R!==null&&(R.lanes|=a),sd(m.return,a,e),o||(b=null);break e}m=R.next}}else if(h.tag===18){if(b=h.return,b===null)throw Error(l(341));b.lanes|=a,m=b.alternate,m!==null&&(m.lanes|=a),sd(b,a,e),b=null}else b=h.child;if(b!==null)b.return=h;else for(b=h;b!==null;){if(b===e){b=null;break}if(h=b.sibling,h!==null){h.return=b.return,b=h;break}b=b.return}h=b}}function ia(e,r,a,o){e=null;for(var h=r,m=!1;h!==null;){if(!m){if((h.flags&524288)!==0)m=!0;else if((h.flags&262144)!==0)break}if(h.tag===10){var b=h.alternate;if(b===null)throw Error(l(387));if(b=b.memoizedProps,b!==null){var R=h.type;mr(h.pendingProps.value,b.value)||(e!==null?e.push(R):e=[R])}}else if(h===J.current){if(b=h.alternate,b===null)throw Error(l(387));b.memoizedState.memoizedState!==h.memoizedState.memoizedState&&(e!==null?e.push(Pl):e=[Pl])}h=h.return}e!==null&&id(r,e,a,o),r.flags|=262144}function Ko(e){for(e=e.firstContext;e!==null;){if(!mr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Si(e){wi=e,us=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Fn(e){return Hp(wi,e)}function Qo(e,r){return wi===null&&Si(e),Hp(e,r)}function Hp(e,r){var a=r._currentValue;if(r={context:r,memoizedValue:a,next:null},us===null){if(e===null)throw Error(l(308));us=r,e.dependencies={lanes:0,firstContext:r},e.flags|=524288}else us=us.next=r;return a}var wb=typeof AbortController<"u"?AbortController:function(){var e=[],r=this.signal={aborted:!1,addEventListener:function(a,o){e.push(o)}};this.abort=function(){r.aborted=!0,e.forEach(function(a){return a()})}},Sb=n.unstable_scheduleCallback,jb=n.unstable_NormalPriority,jn={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ad(){return{controller:new wb,data:new Map,refCount:0}}function gl(e){e.refCount--,e.refCount===0&&Sb(jb,function(){e.controller.abort()})}var yl=null,ld=0,aa=0,la=null;function _b(e,r){if(yl===null){var a=yl=[];ld=0,aa=uh(),la={status:"pending",value:void 0,then:function(o){a.push(o)}}}return ld++,r.then(Fp,Fp),r}function Fp(){if(--ld===0&&yl!==null){la!==null&&(la.status="fulfilled");var e=yl;yl=null,aa=0,la=null;for(var r=0;r<e.length;r++)(0,e[r])()}}function Cb(e,r){var a=[],o={status:"pending",value:null,reason:null,then:function(h){a.push(h)}};return e.then(function(){o.status="fulfilled",o.value=r;for(var h=0;h<a.length;h++)(0,a[h])(r)},function(h){for(o.status="rejected",o.reason=h,h=0;h<a.length;h++)(0,a[h])(void 0)}),o}var Gp=N.S;N.S=function(e,r){Rg=St(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&_b(e,r),Gp!==null&&Gp(e,r)};var ji=U(null);function od(){var e=ji.current;return e!==null?e:Yt.pooledCache}function Wo(e,r){r===null?k(ji,ji.current):k(ji,r.pool)}function Vp(){var e=od();return e===null?null:{parent:jn._currentValue,pool:e}}var oa=Error(l(460)),cd=Error(l(474)),Xo=Error(l(542)),Jo={then:function(){}};function Yp(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Kp(e,r,a){switch(a=e[a],a===void 0?e.push(r):a!==r&&(r.then(Pr,Pr),r=a),r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,Wp(e),e;default:if(typeof r.status=="string")r.then(Pr,Pr);else{if(e=Yt,e!==null&&100<e.shellSuspendCounter)throw Error(l(482));e=r,e.status="pending",e.then(function(o){if(r.status==="pending"){var h=r;h.status="fulfilled",h.value=o}},function(o){if(r.status==="pending"){var h=r;h.status="rejected",h.reason=o}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,Wp(e),e}throw Ci=r,oa}}function _i(e){try{var r=e._init;return r(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(Ci=a,oa):a}}var Ci=null;function Qp(){if(Ci===null)throw Error(l(459));var e=Ci;return Ci=null,e}function Wp(e){if(e===oa||e===Xo)throw Error(l(483))}var ca=null,vl=0;function Zo(e){var r=vl;return vl+=1,ca===null&&(ca=[]),Kp(ca,e,r)}function xl(e,r){r=r.props.ref,e.ref=r!==void 0?r:null}function ec(e,r){throw r.$$typeof===x?Error(l(525)):(e=Object.prototype.toString.call(r),Error(l(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)))}function Xp(e){function r(se,ee){if(e){var ce=se.deletions;ce===null?(se.deletions=[ee],se.flags|=16):ce.push(ee)}}function a(se,ee){if(!e)return null;for(;ee!==null;)r(se,ee),ee=ee.sibling;return null}function o(se){for(var ee=new Map;se!==null;)se.key!==null?ee.set(se.key,se):ee.set(se.index,se),se=se.sibling;return ee}function h(se,ee){return se=os(se,ee),se.index=0,se.sibling=null,se}function m(se,ee,ce){return se.index=ce,e?(ce=se.alternate,ce!==null?(ce=ce.index,ce<ee?(se.flags|=67108866,ee):ce):(se.flags|=67108866,ee)):(se.flags|=1048576,ee)}function b(se){return e&&se.alternate===null&&(se.flags|=67108866),se}function R(se,ee,ce,Se){return ee===null||ee.tag!==6?(ee=Xu(ce,se.mode,Se),ee.return=se,ee):(ee=h(ee,ce),ee.return=se,ee)}function Y(se,ee,ce,Se){var We=ce.type;return We===E?we(se,ee,ce.props.children,Se,ce.key):ee!==null&&(ee.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===A&&_i(We)===ee.type)?(ee=h(ee,ce.props),xl(ee,ce),ee.return=se,ee):(ee=Vo(ce.type,ce.key,ce.props,null,se.mode,Se),xl(ee,ce),ee.return=se,ee)}function ue(se,ee,ce,Se){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ce.containerInfo||ee.stateNode.implementation!==ce.implementation?(ee=Ju(ce,se.mode,Se),ee.return=se,ee):(ee=h(ee,ce.children||[]),ee.return=se,ee)}function we(se,ee,ce,Se,We){return ee===null||ee.tag!==7?(ee=xi(ce,se.mode,Se,We),ee.return=se,ee):(ee=h(ee,ce),ee.return=se,ee)}function je(se,ee,ce){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return ee=Xu(""+ee,se.mode,ce),ee.return=se,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case S:return ce=Vo(ee.type,ee.key,ee.props,null,se.mode,ce),xl(ce,ee),ce.return=se,ce;case C:return ee=Ju(ee,se.mode,ce),ee.return=se,ee;case A:return ee=_i(ee),je(se,ee,ce)}if(I(ee)||H(ee))return ee=xi(ee,se.mode,ce,null),ee.return=se,ee;if(typeof ee.then=="function")return je(se,Zo(ee),ce);if(ee.$$typeof===B)return je(se,Qo(se,ee),ce);ec(se,ee)}return null}function pe(se,ee,ce,Se){var We=ee!==null?ee.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return We!==null?null:R(se,ee,""+ce,Se);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case S:return ce.key===We?Y(se,ee,ce,Se):null;case C:return ce.key===We?ue(se,ee,ce,Se):null;case A:return ce=_i(ce),pe(se,ee,ce,Se)}if(I(ce)||H(ce))return We!==null?null:we(se,ee,ce,Se,null);if(typeof ce.then=="function")return pe(se,ee,Zo(ce),Se);if(ce.$$typeof===B)return pe(se,ee,Qo(se,ce),Se);ec(se,ce)}return null}function ye(se,ee,ce,Se,We){if(typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint")return se=se.get(ce)||null,R(ee,se,""+Se,We);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case S:return se=se.get(Se.key===null?ce:Se.key)||null,Y(ee,se,Se,We);case C:return se=se.get(Se.key===null?ce:Se.key)||null,ue(ee,se,Se,We);case A:return Se=_i(Se),ye(se,ee,ce,Se,We)}if(I(Se)||H(Se))return se=se.get(ce)||null,we(ee,se,Se,We,null);if(typeof Se.then=="function")return ye(se,ee,ce,Zo(Se),We);if(Se.$$typeof===B)return ye(se,ee,ce,Qo(ee,Se),We);ec(ee,Se)}return null}function qe(se,ee,ce,Se){for(var We=null,Dt=null,Ge=ee,ft=ee=0,Et=null;Ge!==null&&ft<ce.length;ft++){Ge.index>ft?(Et=Ge,Ge=null):Et=Ge.sibling;var Mt=pe(se,Ge,ce[ft],Se);if(Mt===null){Ge===null&&(Ge=Et);break}e&&Ge&&Mt.alternate===null&&r(se,Ge),ee=m(Mt,ee,ft),Dt===null?We=Mt:Dt.sibling=Mt,Dt=Mt,Ge=Et}if(ft===ce.length)return a(se,Ge),Tt&&cs(se,ft),We;if(Ge===null){for(;ft<ce.length;ft++)Ge=je(se,ce[ft],Se),Ge!==null&&(ee=m(Ge,ee,ft),Dt===null?We=Ge:Dt.sibling=Ge,Dt=Ge);return Tt&&cs(se,ft),We}for(Ge=o(Ge);ft<ce.length;ft++)Et=ye(Ge,se,ft,ce[ft],Se),Et!==null&&(e&&Et.alternate!==null&&Ge.delete(Et.key===null?ft:Et.key),ee=m(Et,ee,ft),Dt===null?We=Et:Dt.sibling=Et,Dt=Et);return e&&Ge.forEach(function(li){return r(se,li)}),Tt&&cs(se,ft),We}function nt(se,ee,ce,Se){if(ce==null)throw Error(l(151));for(var We=null,Dt=null,Ge=ee,ft=ee=0,Et=null,Mt=ce.next();Ge!==null&&!Mt.done;ft++,Mt=ce.next()){Ge.index>ft?(Et=Ge,Ge=null):Et=Ge.sibling;var li=pe(se,Ge,Mt.value,Se);if(li===null){Ge===null&&(Ge=Et);break}e&&Ge&&li.alternate===null&&r(se,Ge),ee=m(li,ee,ft),Dt===null?We=li:Dt.sibling=li,Dt=li,Ge=Et}if(Mt.done)return a(se,Ge),Tt&&cs(se,ft),We;if(Ge===null){for(;!Mt.done;ft++,Mt=ce.next())Mt=je(se,Mt.value,Se),Mt!==null&&(ee=m(Mt,ee,ft),Dt===null?We=Mt:Dt.sibling=Mt,Dt=Mt);return Tt&&cs(se,ft),We}for(Ge=o(Ge);!Mt.done;ft++,Mt=ce.next())Mt=ye(Ge,se,ft,Mt.value,Se),Mt!==null&&(e&&Mt.alternate!==null&&Ge.delete(Mt.key===null?ft:Mt.key),ee=m(Mt,ee,ft),Dt===null?We=Mt:Dt.sibling=Mt,Dt=Mt);return e&&Ge.forEach(function(Uw){return r(se,Uw)}),Tt&&cs(se,ft),We}function Vt(se,ee,ce,Se){if(typeof ce=="object"&&ce!==null&&ce.type===E&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case S:e:{for(var We=ce.key;ee!==null;){if(ee.key===We){if(We=ce.type,We===E){if(ee.tag===7){a(se,ee.sibling),Se=h(ee,ce.props.children),Se.return=se,se=Se;break e}}else if(ee.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===A&&_i(We)===ee.type){a(se,ee.sibling),Se=h(ee,ce.props),xl(Se,ce),Se.return=se,se=Se;break e}a(se,ee);break}else r(se,ee);ee=ee.sibling}ce.type===E?(Se=xi(ce.props.children,se.mode,Se,ce.key),Se.return=se,se=Se):(Se=Vo(ce.type,ce.key,ce.props,null,se.mode,Se),xl(Se,ce),Se.return=se,se=Se)}return b(se);case C:e:{for(We=ce.key;ee!==null;){if(ee.key===We)if(ee.tag===4&&ee.stateNode.containerInfo===ce.containerInfo&&ee.stateNode.implementation===ce.implementation){a(se,ee.sibling),Se=h(ee,ce.children||[]),Se.return=se,se=Se;break e}else{a(se,ee);break}else r(se,ee);ee=ee.sibling}Se=Ju(ce,se.mode,Se),Se.return=se,se=Se}return b(se);case A:return ce=_i(ce),Vt(se,ee,ce,Se)}if(I(ce))return qe(se,ee,ce,Se);if(H(ce)){if(We=H(ce),typeof We!="function")throw Error(l(150));return ce=We.call(ce),nt(se,ee,ce,Se)}if(typeof ce.then=="function")return Vt(se,ee,Zo(ce),Se);if(ce.$$typeof===B)return Vt(se,ee,Qo(se,ce),Se);ec(se,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint"?(ce=""+ce,ee!==null&&ee.tag===6?(a(se,ee.sibling),Se=h(ee,ce),Se.return=se,se=Se):(a(se,ee),Se=Xu(ce,se.mode,Se),Se.return=se,se=Se),b(se)):a(se,ee)}return function(se,ee,ce,Se){try{vl=0;var We=Vt(se,ee,ce,Se);return ca=null,We}catch(Ge){if(Ge===oa||Ge===Xo)throw Ge;var Dt=gr(29,Ge,null,se.mode);return Dt.lanes=Se,Dt.return=se,Dt}}}var Ei=Xp(!0),Jp=Xp(!1),Fs=!1;function ud(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function dd(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Gs(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Vs(e,r,a){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(zt&2)!==0){var h=o.pending;return h===null?r.next=r:(r.next=h.next,h.next=r),o.pending=r,r=Go(e),zp(e,null,a),r}return Fo(e,o,r,a),Go(e)}function bl(e,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194048)!==0)){var o=r.lanes;o&=e.pendingLanes,a|=o,r.lanes=a,Be(e,a)}}function hd(e,r){var a=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,a===o)){var h=null,m=null;if(a=a.firstBaseUpdate,a!==null){do{var b={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};m===null?h=m=b:m=m.next=b,a=a.next}while(a!==null);m===null?h=m=r:m=m.next=r}else h=m=r;a={baseState:o.baseState,firstBaseUpdate:h,lastBaseUpdate:m,shared:o.shared,callbacks:o.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=r:e.next=r,a.lastBaseUpdate=r}var fd=!1;function wl(){if(fd){var e=la;if(e!==null)throw e}}function Sl(e,r,a,o){fd=!1;var h=e.updateQueue;Fs=!1;var m=h.firstBaseUpdate,b=h.lastBaseUpdate,R=h.shared.pending;if(R!==null){h.shared.pending=null;var Y=R,ue=Y.next;Y.next=null,b===null?m=ue:b.next=ue,b=Y;var we=e.alternate;we!==null&&(we=we.updateQueue,R=we.lastBaseUpdate,R!==b&&(R===null?we.firstBaseUpdate=ue:R.next=ue,we.lastBaseUpdate=Y))}if(m!==null){var je=h.baseState;b=0,we=ue=Y=null,R=m;do{var pe=R.lane&-536870913,ye=pe!==R.lane;if(ye?(Ct&pe)===pe:(o&pe)===pe){pe!==0&&pe===aa&&(fd=!0),we!==null&&(we=we.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});e:{var qe=e,nt=R;pe=r;var Vt=a;switch(nt.tag){case 1:if(qe=nt.payload,typeof qe=="function"){je=qe.call(Vt,je,pe);break e}je=qe;break e;case 3:qe.flags=qe.flags&-65537|128;case 0:if(qe=nt.payload,pe=typeof qe=="function"?qe.call(Vt,je,pe):qe,pe==null)break e;je=v({},je,pe);break e;case 2:Fs=!0}}pe=R.callback,pe!==null&&(e.flags|=64,ye&&(e.flags|=8192),ye=h.callbacks,ye===null?h.callbacks=[pe]:ye.push(pe))}else ye={lane:pe,tag:R.tag,payload:R.payload,callback:R.callback,next:null},we===null?(ue=we=ye,Y=je):we=we.next=ye,b|=pe;if(R=R.next,R===null){if(R=h.shared.pending,R===null)break;ye=R,R=ye.next,ye.next=null,h.lastBaseUpdate=ye,h.shared.pending=null}}while(!0);we===null&&(Y=je),h.baseState=Y,h.firstBaseUpdate=ue,h.lastBaseUpdate=we,m===null&&(h.shared.lanes=0),Xs|=b,e.lanes=b,e.memoizedState=je}}function Zp(e,r){if(typeof e!="function")throw Error(l(191,e));e.call(r)}function em(e,r){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)Zp(a[e],r)}var ua=U(null),tc=U(0);function tm(e,r){e=bs,k(tc,e),k(ua,r),bs=e|r.baseLanes}function pd(){k(tc,bs),k(ua,ua.current)}function md(){bs=tc.current,V(ua),V(tc)}var yr=U(null),Dr=null;function Ys(e){var r=e.alternate;k(vn,vn.current&1),k(yr,e),Dr===null&&(r===null||ua.current!==null||r.memoizedState!==null)&&(Dr=e)}function gd(e){k(vn,vn.current),k(yr,e),Dr===null&&(Dr=e)}function nm(e){e.tag===22?(k(vn,vn.current),k(yr,e),Dr===null&&(Dr=e)):Ks()}function Ks(){k(vn,vn.current),k(yr,yr.current)}function vr(e){V(yr),Dr===e&&(Dr=null),V(vn)}var vn=U(0);function nc(e){for(var r=e;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Sh(a)||jh(a)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var hs=0,ht=null,Ft=null,_n=null,rc=!1,da=!1,Ni=!1,sc=0,jl=0,ha=null,Eb=0;function un(){throw Error(l(321))}function yd(e,r){if(r===null)return!1;for(var a=0;a<r.length&&a<e.length;a++)if(!mr(e[a],r[a]))return!1;return!0}function vd(e,r,a,o,h,m){return hs=m,ht=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,N.H=e===null||e.memoizedState===null?Im:Dd,Ni=!1,m=a(o,h),Ni=!1,da&&(m=sm(r,a,o,h)),rm(e),m}function rm(e){N.H=El;var r=Ft!==null&&Ft.next!==null;if(hs=0,_n=Ft=ht=null,rc=!1,jl=0,ha=null,r)throw Error(l(300));e===null||Cn||(e=e.dependencies,e!==null&&Ko(e)&&(Cn=!0))}function sm(e,r,a,o){ht=e;var h=0;do{if(da&&(ha=null),jl=0,da=!1,25<=h)throw Error(l(301));if(h+=1,_n=Ft=null,e.updateQueue!=null){var m=e.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}N.H=$m,m=r(a,o)}while(da);return m}function Nb(){var e=N.H,r=e.useState()[0];return r=typeof r.then=="function"?_l(r):r,e=e.useState()[0],(Ft!==null?Ft.memoizedState:null)!==e&&(ht.flags|=1024),r}function xd(){var e=sc!==0;return sc=0,e}function bd(e,r,a){r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~a}function wd(e){if(rc){for(e=e.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}rc=!1}hs=0,_n=Ft=ht=null,da=!1,jl=sc=0,ha=null}function tr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _n===null?ht.memoizedState=_n=e:_n=_n.next=e,_n}function xn(){if(Ft===null){var e=ht.alternate;e=e!==null?e.memoizedState:null}else e=Ft.next;var r=_n===null?ht.memoizedState:_n.next;if(r!==null)_n=r,Ft=e;else{if(e===null)throw ht.alternate===null?Error(l(467)):Error(l(310));Ft=e,e={memoizedState:Ft.memoizedState,baseState:Ft.baseState,baseQueue:Ft.baseQueue,queue:Ft.queue,next:null},_n===null?ht.memoizedState=_n=e:_n=_n.next=e}return _n}function ic(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function _l(e){var r=jl;return jl+=1,ha===null&&(ha=[]),e=Kp(ha,e,r),r=ht,(_n===null?r.memoizedState:_n.next)===null&&(r=r.alternate,N.H=r===null||r.memoizedState===null?Im:Dd),e}function ac(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return _l(e);if(e.$$typeof===B)return Fn(e)}throw Error(l(438,String(e)))}function Sd(e){var r=null,a=ht.updateQueue;if(a!==null&&(r=a.memoCache),r==null){var o=ht.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(r={data:o.data.map(function(h){return h.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),a===null&&(a=ic(),ht.updateQueue=a),a.memoCache=r,a=r.data[r.index],a===void 0)for(a=r.data[r.index]=Array(e),o=0;o<e;o++)a[o]=Q;return r.index++,a}function fs(e,r){return typeof r=="function"?r(e):r}function lc(e){var r=xn();return jd(r,Ft,e)}function jd(e,r,a){var o=e.queue;if(o===null)throw Error(l(311));o.lastRenderedReducer=a;var h=e.baseQueue,m=o.pending;if(m!==null){if(h!==null){var b=h.next;h.next=m.next,m.next=b}r.baseQueue=h=m,o.pending=null}if(m=e.baseState,h===null)e.memoizedState=m;else{r=h.next;var R=b=null,Y=null,ue=r,we=!1;do{var je=ue.lane&-536870913;if(je!==ue.lane?(Ct&je)===je:(hs&je)===je){var pe=ue.revertLane;if(pe===0)Y!==null&&(Y=Y.next={lane:0,revertLane:0,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),je===aa&&(we=!0);else if((hs&pe)===pe){ue=ue.next,pe===aa&&(we=!0);continue}else je={lane:0,revertLane:ue.revertLane,gesture:null,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},Y===null?(R=Y=je,b=m):Y=Y.next=je,ht.lanes|=pe,Xs|=pe;je=ue.action,Ni&&a(m,je),m=ue.hasEagerState?ue.eagerState:a(m,je)}else pe={lane:je,revertLane:ue.revertLane,gesture:ue.gesture,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null},Y===null?(R=Y=pe,b=m):Y=Y.next=pe,ht.lanes|=je,Xs|=je;ue=ue.next}while(ue!==null&&ue!==r);if(Y===null?b=m:Y.next=R,!mr(m,e.memoizedState)&&(Cn=!0,we&&(a=la,a!==null)))throw a;e.memoizedState=m,e.baseState=b,e.baseQueue=Y,o.lastRenderedState=m}return h===null&&(o.lanes=0),[e.memoizedState,o.dispatch]}function _d(e){var r=xn(),a=r.queue;if(a===null)throw Error(l(311));a.lastRenderedReducer=e;var o=a.dispatch,h=a.pending,m=r.memoizedState;if(h!==null){a.pending=null;var b=h=h.next;do m=e(m,b.action),b=b.next;while(b!==h);mr(m,r.memoizedState)||(Cn=!0),r.memoizedState=m,r.baseQueue===null&&(r.baseState=m),a.lastRenderedState=m}return[m,o]}function im(e,r,a){var o=ht,h=xn(),m=Tt;if(m){if(a===void 0)throw Error(l(407));a=a()}else a=r();var b=!mr((Ft||h).memoizedState,a);if(b&&(h.memoizedState=a,Cn=!0),h=h.queue,Nd(om.bind(null,o,h,e),[e]),h.getSnapshot!==r||b||_n!==null&&_n.memoizedState.tag&1){if(o.flags|=2048,fa(9,{destroy:void 0},lm.bind(null,o,h,a,r),null),Yt===null)throw Error(l(349));m||(hs&127)!==0||am(o,r,a)}return a}function am(e,r,a){e.flags|=16384,e={getSnapshot:r,value:a},r=ht.updateQueue,r===null?(r=ic(),ht.updateQueue=r,r.stores=[e]):(a=r.stores,a===null?r.stores=[e]:a.push(e))}function lm(e,r,a,o){r.value=a,r.getSnapshot=o,cm(r)&&um(e)}function om(e,r,a){return a(function(){cm(r)&&um(e)})}function cm(e){var r=e.getSnapshot;e=e.value;try{var a=r();return!mr(e,a)}catch{return!0}}function um(e){var r=vi(e,2);r!==null&&hr(r,e,2)}function Cd(e){var r=tr();if(typeof e=="function"){var a=e;if(e=a(),Ni){an(!0);try{a()}finally{an(!1)}}}return r.memoizedState=r.baseState=e,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:e},r}function dm(e,r,a,o){return e.baseState=a,jd(e,Ft,typeof o=="function"?o:fs)}function Rb(e,r,a,o,h){if(uc(e))throw Error(l(485));if(e=r.action,e!==null){var m={payload:h,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){m.listeners.push(b)}};N.T!==null?a(!0):m.isTransition=!1,o(m),a=r.pending,a===null?(m.next=r.pending=m,hm(r,m)):(m.next=a.next,r.pending=a.next=m)}}function hm(e,r){var a=r.action,o=r.payload,h=e.state;if(r.isTransition){var m=N.T,b={};N.T=b;try{var R=a(h,o),Y=N.S;Y!==null&&Y(b,R),fm(e,r,R)}catch(ue){Ed(e,r,ue)}finally{m!==null&&b.types!==null&&(m.types=b.types),N.T=m}}else try{m=a(h,o),fm(e,r,m)}catch(ue){Ed(e,r,ue)}}function fm(e,r,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(o){pm(e,r,o)},function(o){return Ed(e,r,o)}):pm(e,r,a)}function pm(e,r,a){r.status="fulfilled",r.value=a,mm(r),e.state=a,r=e.pending,r!==null&&(a=r.next,a===r?e.pending=null:(a=a.next,r.next=a,hm(e,a)))}function Ed(e,r,a){var o=e.pending;if(e.pending=null,o!==null){o=o.next;do r.status="rejected",r.reason=a,mm(r),r=r.next;while(r!==o)}e.action=null}function mm(e){e=e.listeners;for(var r=0;r<e.length;r++)(0,e[r])()}function gm(e,r){return r}function ym(e,r){if(Tt){var a=Yt.formState;if(a!==null){e:{var o=ht;if(Tt){if(Zt){t:{for(var h=Zt,m=Or;h.nodeType!==8;){if(!m){h=null;break t}if(h=Mr(h.nextSibling),h===null){h=null;break t}}m=h.data,h=m==="F!"||m==="F"?h:null}if(h){Zt=Mr(h.nextSibling),o=h.data==="F!";break e}}Ps(o)}o=!1}o&&(r=a[0])}}return a=tr(),a.memoizedState=a.baseState=r,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gm,lastRenderedState:r},a.queue=o,a=Um.bind(null,ht,o),o.dispatch=a,o=Cd(!1),m=Od.bind(null,ht,!1,o.queue),o=tr(),h={state:r,dispatch:null,action:e,pending:null},o.queue=h,a=Rb.bind(null,ht,h,m,a),h.dispatch=a,o.memoizedState=e,[r,a,!1]}function vm(e){var r=xn();return xm(r,Ft,e)}function xm(e,r,a){if(r=jd(e,r,gm)[0],e=lc(fs)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var o=_l(r)}catch(b){throw b===oa?Xo:b}else o=r;r=xn();var h=r.queue,m=h.dispatch;return a!==r.memoizedState&&(ht.flags|=2048,fa(9,{destroy:void 0},Tb.bind(null,h,a),null)),[o,m,e]}function Tb(e,r){e.action=r}function bm(e){var r=xn(),a=Ft;if(a!==null)return xm(r,a,e);xn(),r=r.memoizedState,a=xn();var o=a.queue.dispatch;return a.memoizedState=e,[r,o,!1]}function fa(e,r,a,o){return e={tag:e,create:a,deps:o,inst:r,next:null},r=ht.updateQueue,r===null&&(r=ic(),ht.updateQueue=r),a=r.lastEffect,a===null?r.lastEffect=e.next=e:(o=a.next,a.next=e,e.next=o,r.lastEffect=e),e}function wm(){return xn().memoizedState}function oc(e,r,a,o){var h=tr();ht.flags|=e,h.memoizedState=fa(1|r,{destroy:void 0},a,o===void 0?null:o)}function cc(e,r,a,o){var h=xn();o=o===void 0?null:o;var m=h.memoizedState.inst;Ft!==null&&o!==null&&yd(o,Ft.memoizedState.deps)?h.memoizedState=fa(r,m,a,o):(ht.flags|=e,h.memoizedState=fa(1|r,m,a,o))}function Sm(e,r){oc(8390656,8,e,r)}function Nd(e,r){cc(2048,8,e,r)}function Ab(e){ht.flags|=4;var r=ht.updateQueue;if(r===null)r=ic(),ht.updateQueue=r,r.events=[e];else{var a=r.events;a===null?r.events=[e]:a.push(e)}}function jm(e){var r=xn().memoizedState;return Ab({ref:r,nextImpl:e}),function(){if((zt&2)!==0)throw Error(l(440));return r.impl.apply(void 0,arguments)}}function _m(e,r){return cc(4,2,e,r)}function Cm(e,r){return cc(4,4,e,r)}function Em(e,r){if(typeof r=="function"){e=e();var a=r(e);return function(){typeof a=="function"?a():r(null)}}if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function Nm(e,r,a){a=a!=null?a.concat([e]):null,cc(4,4,Em.bind(null,r,e),a)}function Rd(){}function Rm(e,r){var a=xn();r=r===void 0?null:r;var o=a.memoizedState;return r!==null&&yd(r,o[1])?o[0]:(a.memoizedState=[e,r],e)}function Tm(e,r){var a=xn();r=r===void 0?null:r;var o=a.memoizedState;if(r!==null&&yd(r,o[1]))return o[0];if(o=e(),Ni){an(!0);try{e()}finally{an(!1)}}return a.memoizedState=[o,r],o}function Td(e,r,a){return a===void 0||(hs&1073741824)!==0&&(Ct&261930)===0?e.memoizedState=r:(e.memoizedState=a,e=Ag(),ht.lanes|=e,Xs|=e,a)}function Am(e,r,a,o){return mr(a,r)?a:ua.current!==null?(e=Td(e,a,o),mr(e,r)||(Cn=!0),e):(hs&42)===0||(hs&1073741824)!==0&&(Ct&261930)===0?(Cn=!0,e.memoizedState=a):(e=Ag(),ht.lanes|=e,Xs|=e,r)}function km(e,r,a,o,h){var m=L.p;L.p=m!==0&&8>m?m:8;var b=N.T,R={};N.T=R,Od(e,!1,r,a);try{var Y=h(),ue=N.S;if(ue!==null&&ue(R,Y),Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var we=Cb(Y,o);Cl(e,r,we,wr(e))}else Cl(e,r,o,wr(e))}catch(je){Cl(e,r,{then:function(){},status:"rejected",reason:je},wr())}finally{L.p=m,b!==null&&R.types!==null&&(b.types=R.types),N.T=b}}function kb(){}function Ad(e,r,a,o){if(e.tag!==5)throw Error(l(476));var h=Om(e).queue;km(e,h,r,K,a===null?kb:function(){return Dm(e),a(o)})}function Om(e){var r=e.memoizedState;if(r!==null)return r;r={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:K},next:null};var a={};return r.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fs,lastRenderedState:a},next:null},e.memoizedState=r,e=e.alternate,e!==null&&(e.memoizedState=r),r}function Dm(e){var r=Om(e);r.next===null&&(r=e.alternate.memoizedState),Cl(e,r.next.queue,{},wr())}function kd(){return Fn(Pl)}function Mm(){return xn().memoizedState}function zm(){return xn().memoizedState}function Ob(e){for(var r=e.return;r!==null;){switch(r.tag){case 24:case 3:var a=wr();e=Gs(a);var o=Vs(r,e,a);o!==null&&(hr(o,r,a),bl(o,r,a)),r={cache:ad()},e.payload=r;return}r=r.return}}function Db(e,r,a){var o=wr();a={lane:o,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},uc(e)?Lm(r,a):(a=Qu(e,r,a,o),a!==null&&(hr(a,e,o),Bm(a,r,o)))}function Um(e,r,a){var o=wr();Cl(e,r,a,o)}function Cl(e,r,a,o){var h={lane:o,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(uc(e))Lm(r,h);else{var m=e.alternate;if(e.lanes===0&&(m===null||m.lanes===0)&&(m=r.lastRenderedReducer,m!==null))try{var b=r.lastRenderedState,R=m(b,a);if(h.hasEagerState=!0,h.eagerState=R,mr(R,b))return Fo(e,r,h,0),Yt===null&&Ho(),!1}catch{}if(a=Qu(e,r,h,o),a!==null)return hr(a,e,o),Bm(a,r,o),!0}return!1}function Od(e,r,a,o){if(o={lane:2,revertLane:uh(),gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},uc(e)){if(r)throw Error(l(479))}else r=Qu(e,a,o,2),r!==null&&hr(r,e,2)}function uc(e){var r=e.alternate;return e===ht||r!==null&&r===ht}function Lm(e,r){da=rc=!0;var a=e.pending;a===null?r.next=r:(r.next=a.next,a.next=r),e.pending=r}function Bm(e,r,a){if((a&4194048)!==0){var o=r.lanes;o&=e.pendingLanes,a|=o,r.lanes=a,Be(e,a)}}var El={readContext:Fn,use:ac,useCallback:un,useContext:un,useEffect:un,useImperativeHandle:un,useLayoutEffect:un,useInsertionEffect:un,useMemo:un,useReducer:un,useRef:un,useState:un,useDebugValue:un,useDeferredValue:un,useTransition:un,useSyncExternalStore:un,useId:un,useHostTransitionStatus:un,useFormState:un,useActionState:un,useOptimistic:un,useMemoCache:un,useCacheRefresh:un};El.useEffectEvent=un;var Im={readContext:Fn,use:ac,useCallback:function(e,r){return tr().memoizedState=[e,r===void 0?null:r],e},useContext:Fn,useEffect:Sm,useImperativeHandle:function(e,r,a){a=a!=null?a.concat([e]):null,oc(4194308,4,Em.bind(null,r,e),a)},useLayoutEffect:function(e,r){return oc(4194308,4,e,r)},useInsertionEffect:function(e,r){oc(4,2,e,r)},useMemo:function(e,r){var a=tr();r=r===void 0?null:r;var o=e();if(Ni){an(!0);try{e()}finally{an(!1)}}return a.memoizedState=[o,r],o},useReducer:function(e,r,a){var o=tr();if(a!==void 0){var h=a(r);if(Ni){an(!0);try{a(r)}finally{an(!1)}}}else h=r;return o.memoizedState=o.baseState=h,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:h},o.queue=e,e=e.dispatch=Db.bind(null,ht,e),[o.memoizedState,e]},useRef:function(e){var r=tr();return e={current:e},r.memoizedState=e},useState:function(e){e=Cd(e);var r=e.queue,a=Um.bind(null,ht,r);return r.dispatch=a,[e.memoizedState,a]},useDebugValue:Rd,useDeferredValue:function(e,r){var a=tr();return Td(a,e,r)},useTransition:function(){var e=Cd(!1);return e=km.bind(null,ht,e.queue,!0,!1),tr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,r,a){var o=ht,h=tr();if(Tt){if(a===void 0)throw Error(l(407));a=a()}else{if(a=r(),Yt===null)throw Error(l(349));(Ct&127)!==0||am(o,r,a)}h.memoizedState=a;var m={value:a,getSnapshot:r};return h.queue=m,Sm(om.bind(null,o,m,e),[e]),o.flags|=2048,fa(9,{destroy:void 0},lm.bind(null,o,m,a,r),null),a},useId:function(){var e=tr(),r=Yt.identifierPrefix;if(Tt){var a=ts,o=es;a=(o&~(1<<32-ln(o)-1)).toString(32)+a,r="_"+r+"R_"+a,a=sc++,0<a&&(r+="H"+a.toString(32)),r+="_"}else a=Eb++,r="_"+r+"r_"+a.toString(32)+"_";return e.memoizedState=r},useHostTransitionStatus:kd,useFormState:ym,useActionState:ym,useOptimistic:function(e){var r=tr();r.memoizedState=r.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=a,r=Od.bind(null,ht,!0,a),a.dispatch=r,[e,r]},useMemoCache:Sd,useCacheRefresh:function(){return tr().memoizedState=Ob.bind(null,ht)},useEffectEvent:function(e){var r=tr(),a={impl:e};return r.memoizedState=a,function(){if((zt&2)!==0)throw Error(l(440));return a.impl.apply(void 0,arguments)}}},Dd={readContext:Fn,use:ac,useCallback:Rm,useContext:Fn,useEffect:Nd,useImperativeHandle:Nm,useInsertionEffect:_m,useLayoutEffect:Cm,useMemo:Tm,useReducer:lc,useRef:wm,useState:function(){return lc(fs)},useDebugValue:Rd,useDeferredValue:function(e,r){var a=xn();return Am(a,Ft.memoizedState,e,r)},useTransition:function(){var e=lc(fs)[0],r=xn().memoizedState;return[typeof e=="boolean"?e:_l(e),r]},useSyncExternalStore:im,useId:Mm,useHostTransitionStatus:kd,useFormState:vm,useActionState:vm,useOptimistic:function(e,r){var a=xn();return dm(a,Ft,e,r)},useMemoCache:Sd,useCacheRefresh:zm};Dd.useEffectEvent=jm;var $m={readContext:Fn,use:ac,useCallback:Rm,useContext:Fn,useEffect:Nd,useImperativeHandle:Nm,useInsertionEffect:_m,useLayoutEffect:Cm,useMemo:Tm,useReducer:_d,useRef:wm,useState:function(){return _d(fs)},useDebugValue:Rd,useDeferredValue:function(e,r){var a=xn();return Ft===null?Td(a,e,r):Am(a,Ft.memoizedState,e,r)},useTransition:function(){var e=_d(fs)[0],r=xn().memoizedState;return[typeof e=="boolean"?e:_l(e),r]},useSyncExternalStore:im,useId:Mm,useHostTransitionStatus:kd,useFormState:bm,useActionState:bm,useOptimistic:function(e,r){var a=xn();return Ft!==null?dm(a,Ft,e,r):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:Sd,useCacheRefresh:zm};$m.useEffectEvent=jm;function Md(e,r,a,o){r=e.memoizedState,a=a(o,r),a=a==null?r:v({},r,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var zd={enqueueSetState:function(e,r,a){e=e._reactInternals;var o=wr(),h=Gs(o);h.payload=r,a!=null&&(h.callback=a),r=Vs(e,h,o),r!==null&&(hr(r,e,o),bl(r,e,o))},enqueueReplaceState:function(e,r,a){e=e._reactInternals;var o=wr(),h=Gs(o);h.tag=1,h.payload=r,a!=null&&(h.callback=a),r=Vs(e,h,o),r!==null&&(hr(r,e,o),bl(r,e,o))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var a=wr(),o=Gs(a);o.tag=2,r!=null&&(o.callback=r),r=Vs(e,o,a),r!==null&&(hr(r,e,a),bl(r,e,a))}};function qm(e,r,a,o,h,m,b){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,m,b):r.prototype&&r.prototype.isPureReactComponent?!hl(a,o)||!hl(h,m):!0}function Pm(e,r,a,o){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,o),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,o),r.state!==e&&zd.enqueueReplaceState(r,r.state,null)}function Ri(e,r){var a=r;if("ref"in r){a={};for(var o in r)o!=="ref"&&(a[o]=r[o])}if(e=e.defaultProps){a===r&&(a=v({},a));for(var h in e)a[h]===void 0&&(a[h]=e[h])}return a}function Hm(e){Po(e)}function Fm(e){console.error(e)}function Gm(e){Po(e)}function dc(e,r){try{var a=e.onUncaughtError;a(r.value,{componentStack:r.stack})}catch(o){setTimeout(function(){throw o})}}function Vm(e,r,a){try{var o=e.onCaughtError;o(a.value,{componentStack:a.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(h){setTimeout(function(){throw h})}}function Ud(e,r,a){return a=Gs(a),a.tag=3,a.payload={element:null},a.callback=function(){dc(e,r)},a}function Ym(e){return e=Gs(e),e.tag=3,e}function Km(e,r,a,o){var h=a.type.getDerivedStateFromError;if(typeof h=="function"){var m=o.value;e.payload=function(){return h(m)},e.callback=function(){Vm(r,a,o)}}var b=a.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(e.callback=function(){Vm(r,a,o),typeof h!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var R=o.stack;this.componentDidCatch(o.value,{componentStack:R!==null?R:""})})}function Mb(e,r,a,o,h){if(a.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(r=a.alternate,r!==null&&ia(r,a,h,!0),a=yr.current,a!==null){switch(a.tag){case 31:case 13:return Dr===null?jc():a.alternate===null&&dn===0&&(dn=3),a.flags&=-257,a.flags|=65536,a.lanes=h,o===Jo?a.flags|=16384:(r=a.updateQueue,r===null?a.updateQueue=new Set([o]):r.add(o),lh(e,o,h)),!1;case 22:return a.flags|=65536,o===Jo?a.flags|=16384:(r=a.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([o])},a.updateQueue=r):(a=r.retryQueue,a===null?r.retryQueue=new Set([o]):a.add(o)),lh(e,o,h)),!1}throw Error(l(435,a.tag))}return lh(e,o,h),jc(),!1}if(Tt)return r=yr.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=h,o!==td&&(e=Error(l(422),{cause:o}),ml(Tr(e,a)))):(o!==td&&(r=Error(l(423),{cause:o}),ml(Tr(r,a))),e=e.current.alternate,e.flags|=65536,h&=-h,e.lanes|=h,o=Tr(o,a),h=Ud(e.stateNode,o,h),hd(e,h),dn!==4&&(dn=2)),!1;var m=Error(l(520),{cause:o});if(m=Tr(m,a),Ml===null?Ml=[m]:Ml.push(m),dn!==4&&(dn=2),r===null)return!0;o=Tr(o,a),a=r;do{switch(a.tag){case 3:return a.flags|=65536,e=h&-h,a.lanes|=e,e=Ud(a.stateNode,o,e),hd(a,e),!1;case 1:if(r=a.type,m=a.stateNode,(a.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Js===null||!Js.has(m))))return a.flags|=65536,h&=-h,a.lanes|=h,h=Ym(h),Km(h,e,a,o),hd(a,h),!1}a=a.return}while(a!==null);return!1}var Ld=Error(l(461)),Cn=!1;function Gn(e,r,a,o){r.child=e===null?Jp(r,null,a,o):Ei(r,e.child,a,o)}function Qm(e,r,a,o,h){a=a.render;var m=r.ref;if("ref"in o){var b={};for(var R in o)R!=="ref"&&(b[R]=o[R])}else b=o;return Si(r),o=vd(e,r,a,b,m,h),R=xd(),e!==null&&!Cn?(bd(e,r,h),ps(e,r,h)):(Tt&&R&&Zu(r),r.flags|=1,Gn(e,r,o,h),r.child)}function Wm(e,r,a,o,h){if(e===null){var m=a.type;return typeof m=="function"&&!Wu(m)&&m.defaultProps===void 0&&a.compare===null?(r.tag=15,r.type=m,Xm(e,r,m,o,h)):(e=Vo(a.type,null,o,r,r.mode,h),e.ref=r.ref,e.return=r,r.child=e)}if(m=e.child,!Gd(e,h)){var b=m.memoizedProps;if(a=a.compare,a=a!==null?a:hl,a(b,o)&&e.ref===r.ref)return ps(e,r,h)}return r.flags|=1,e=os(m,o),e.ref=r.ref,e.return=r,r.child=e}function Xm(e,r,a,o,h){if(e!==null){var m=e.memoizedProps;if(hl(m,o)&&e.ref===r.ref)if(Cn=!1,r.pendingProps=o=m,Gd(e,h))(e.flags&131072)!==0&&(Cn=!0);else return r.lanes=e.lanes,ps(e,r,h)}return Bd(e,r,a,o,h)}function Jm(e,r,a,o){var h=o.children,m=e!==null?e.memoizedState:null;if(e===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.mode==="hidden"){if((r.flags&128)!==0){if(m=m!==null?m.baseLanes|a:a,e!==null){for(o=r.child=e.child,h=0;o!==null;)h=h|o.lanes|o.childLanes,o=o.sibling;o=h&~m}else o=0,r.child=null;return Zm(e,r,m,a,o)}if((a&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},e!==null&&Wo(r,m!==null?m.cachePool:null),m!==null?tm(r,m):pd(),nm(r);else return o=r.lanes=536870912,Zm(e,r,m!==null?m.baseLanes|a:a,a,o)}else m!==null?(Wo(r,m.cachePool),tm(r,m),Ks(),r.memoizedState=null):(e!==null&&Wo(r,null),pd(),Ks());return Gn(e,r,h,a),r.child}function Nl(e,r){return e!==null&&e.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function Zm(e,r,a,o,h){var m=od();return m=m===null?null:{parent:jn._currentValue,pool:m},r.memoizedState={baseLanes:a,cachePool:m},e!==null&&Wo(r,null),pd(),nm(r),e!==null&&ia(e,r,o,!0),r.childLanes=h,null}function hc(e,r){return r=pc({mode:r.mode,children:r.children},e.mode),r.ref=e.ref,e.child=r,r.return=e,r}function eg(e,r,a){return Ei(r,e.child,null,a),e=hc(r,r.pendingProps),e.flags|=2,vr(r),r.memoizedState=null,e}function zb(e,r,a){var o=r.pendingProps,h=(r.flags&128)!==0;if(r.flags&=-129,e===null){if(Tt){if(o.mode==="hidden")return e=hc(r,o),r.lanes=536870912,Nl(null,e);if(gd(r),(e=Zt)?(e=hy(e,Or),e=e!==null&&e.data==="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:$s!==null?{id:es,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},a=Lp(e),a.return=r,r.child=a,Hn=r,Zt=null)):e=null,e===null)throw Ps(r);return r.lanes=536870912,null}return hc(r,o)}var m=e.memoizedState;if(m!==null){var b=m.dehydrated;if(gd(r),h)if(r.flags&256)r.flags&=-257,r=eg(e,r,a);else if(r.memoizedState!==null)r.child=e.child,r.flags|=128,r=null;else throw Error(l(558));else if(Cn||ia(e,r,a,!1),h=(a&e.childLanes)!==0,Cn||h){if(o=Yt,o!==null&&(b=X(o,a),b!==0&&b!==m.retryLane))throw m.retryLane=b,vi(e,b),hr(o,e,b),Ld;jc(),r=eg(e,r,a)}else e=m.treeContext,Zt=Mr(b.nextSibling),Hn=r,Tt=!0,qs=null,Or=!1,e!==null&&$p(r,e),r=hc(r,o),r.flags|=4096;return r}return e=os(e.child,{mode:o.mode,children:o.children}),e.ref=r.ref,r.child=e,e.return=r,e}function fc(e,r){var a=r.ref;if(a===null)e!==null&&e.ref!==null&&(r.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(l(284));(e===null||e.ref!==a)&&(r.flags|=4194816)}}function Bd(e,r,a,o,h){return Si(r),a=vd(e,r,a,o,void 0,h),o=xd(),e!==null&&!Cn?(bd(e,r,h),ps(e,r,h)):(Tt&&o&&Zu(r),r.flags|=1,Gn(e,r,a,h),r.child)}function tg(e,r,a,o,h,m){return Si(r),r.updateQueue=null,a=sm(r,o,a,h),rm(e),o=xd(),e!==null&&!Cn?(bd(e,r,m),ps(e,r,m)):(Tt&&o&&Zu(r),r.flags|=1,Gn(e,r,a,m),r.child)}function ng(e,r,a,o,h){if(Si(r),r.stateNode===null){var m=ta,b=a.contextType;typeof b=="object"&&b!==null&&(m=Fn(b)),m=new a(o,m),r.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=zd,r.stateNode=m,m._reactInternals=r,m=r.stateNode,m.props=o,m.state=r.memoizedState,m.refs={},ud(r),b=a.contextType,m.context=typeof b=="object"&&b!==null?Fn(b):ta,m.state=r.memoizedState,b=a.getDerivedStateFromProps,typeof b=="function"&&(Md(r,a,b,o),m.state=r.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(b=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),b!==m.state&&zd.enqueueReplaceState(m,m.state,null),Sl(r,o,m,h),wl(),m.state=r.memoizedState),typeof m.componentDidMount=="function"&&(r.flags|=4194308),o=!0}else if(e===null){m=r.stateNode;var R=r.memoizedProps,Y=Ri(a,R);m.props=Y;var ue=m.context,we=a.contextType;b=ta,typeof we=="object"&&we!==null&&(b=Fn(we));var je=a.getDerivedStateFromProps;we=typeof je=="function"||typeof m.getSnapshotBeforeUpdate=="function",R=r.pendingProps!==R,we||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(R||ue!==b)&&Pm(r,m,o,b),Fs=!1;var pe=r.memoizedState;m.state=pe,Sl(r,o,m,h),wl(),ue=r.memoizedState,R||pe!==ue||Fs?(typeof je=="function"&&(Md(r,a,je,o),ue=r.memoizedState),(Y=Fs||qm(r,a,Y,o,pe,ue,b))?(we||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(r.flags|=4194308)):(typeof m.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=o,r.memoizedState=ue),m.props=o,m.state=ue,m.context=b,o=Y):(typeof m.componentDidMount=="function"&&(r.flags|=4194308),o=!1)}else{m=r.stateNode,dd(e,r),b=r.memoizedProps,we=Ri(a,b),m.props=we,je=r.pendingProps,pe=m.context,ue=a.contextType,Y=ta,typeof ue=="object"&&ue!==null&&(Y=Fn(ue)),R=a.getDerivedStateFromProps,(ue=typeof R=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(b!==je||pe!==Y)&&Pm(r,m,o,Y),Fs=!1,pe=r.memoizedState,m.state=pe,Sl(r,o,m,h),wl();var ye=r.memoizedState;b!==je||pe!==ye||Fs||e!==null&&e.dependencies!==null&&Ko(e.dependencies)?(typeof R=="function"&&(Md(r,a,R,o),ye=r.memoizedState),(we=Fs||qm(r,a,we,o,pe,ye,Y)||e!==null&&e.dependencies!==null&&Ko(e.dependencies))?(ue||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(o,ye,Y),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(o,ye,Y)),typeof m.componentDidUpdate=="function"&&(r.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof m.componentDidUpdate!="function"||b===e.memoizedProps&&pe===e.memoizedState||(r.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&pe===e.memoizedState||(r.flags|=1024),r.memoizedProps=o,r.memoizedState=ye),m.props=o,m.state=ye,m.context=Y,o=we):(typeof m.componentDidUpdate!="function"||b===e.memoizedProps&&pe===e.memoizedState||(r.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&pe===e.memoizedState||(r.flags|=1024),o=!1)}return m=o,fc(e,r),o=(r.flags&128)!==0,m||o?(m=r.stateNode,a=o&&typeof a.getDerivedStateFromError!="function"?null:m.render(),r.flags|=1,e!==null&&o?(r.child=Ei(r,e.child,null,h),r.child=Ei(r,null,a,h)):Gn(e,r,a,h),r.memoizedState=m.state,e=r.child):e=ps(e,r,h),e}function rg(e,r,a,o){return bi(),r.flags|=256,Gn(e,r,a,o),r.child}var Id={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $d(e){return{baseLanes:e,cachePool:Vp()}}function qd(e,r,a){return e=e!==null?e.childLanes&~a:0,r&&(e|=br),e}function sg(e,r,a){var o=r.pendingProps,h=!1,m=(r.flags&128)!==0,b;if((b=m)||(b=e!==null&&e.memoizedState===null?!1:(vn.current&2)!==0),b&&(h=!0,r.flags&=-129),b=(r.flags&32)!==0,r.flags&=-33,e===null){if(Tt){if(h?Ys(r):Ks(),(e=Zt)?(e=hy(e,Or),e=e!==null&&e.data!=="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:$s!==null?{id:es,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},a=Lp(e),a.return=r,r.child=a,Hn=r,Zt=null)):e=null,e===null)throw Ps(r);return jh(e)?r.lanes=32:r.lanes=536870912,null}var R=o.children;return o=o.fallback,h?(Ks(),h=r.mode,R=pc({mode:"hidden",children:R},h),o=xi(o,h,a,null),R.return=r,o.return=r,R.sibling=o,r.child=R,o=r.child,o.memoizedState=$d(a),o.childLanes=qd(e,b,a),r.memoizedState=Id,Nl(null,o)):(Ys(r),Pd(r,R))}var Y=e.memoizedState;if(Y!==null&&(R=Y.dehydrated,R!==null)){if(m)r.flags&256?(Ys(r),r.flags&=-257,r=Hd(e,r,a)):r.memoizedState!==null?(Ks(),r.child=e.child,r.flags|=128,r=null):(Ks(),R=o.fallback,h=r.mode,o=pc({mode:"visible",children:o.children},h),R=xi(R,h,a,null),R.flags|=2,o.return=r,R.return=r,o.sibling=R,r.child=o,Ei(r,e.child,null,a),o=r.child,o.memoizedState=$d(a),o.childLanes=qd(e,b,a),r.memoizedState=Id,r=Nl(null,o));else if(Ys(r),jh(R)){if(b=R.nextSibling&&R.nextSibling.dataset,b)var ue=b.dgst;b=ue,o=Error(l(419)),o.stack="",o.digest=b,ml({value:o,source:null,stack:null}),r=Hd(e,r,a)}else if(Cn||ia(e,r,a,!1),b=(a&e.childLanes)!==0,Cn||b){if(b=Yt,b!==null&&(o=X(b,a),o!==0&&o!==Y.retryLane))throw Y.retryLane=o,vi(e,o),hr(b,e,o),Ld;Sh(R)||jc(),r=Hd(e,r,a)}else Sh(R)?(r.flags|=192,r.child=e.child,r=null):(e=Y.treeContext,Zt=Mr(R.nextSibling),Hn=r,Tt=!0,qs=null,Or=!1,e!==null&&$p(r,e),r=Pd(r,o.children),r.flags|=4096);return r}return h?(Ks(),R=o.fallback,h=r.mode,Y=e.child,ue=Y.sibling,o=os(Y,{mode:"hidden",children:o.children}),o.subtreeFlags=Y.subtreeFlags&65011712,ue!==null?R=os(ue,R):(R=xi(R,h,a,null),R.flags|=2),R.return=r,o.return=r,o.sibling=R,r.child=o,Nl(null,o),o=r.child,R=e.child.memoizedState,R===null?R=$d(a):(h=R.cachePool,h!==null?(Y=jn._currentValue,h=h.parent!==Y?{parent:Y,pool:Y}:h):h=Vp(),R={baseLanes:R.baseLanes|a,cachePool:h}),o.memoizedState=R,o.childLanes=qd(e,b,a),r.memoizedState=Id,Nl(e.child,o)):(Ys(r),a=e.child,e=a.sibling,a=os(a,{mode:"visible",children:o.children}),a.return=r,a.sibling=null,e!==null&&(b=r.deletions,b===null?(r.deletions=[e],r.flags|=16):b.push(e)),r.child=a,r.memoizedState=null,a)}function Pd(e,r){return r=pc({mode:"visible",children:r},e.mode),r.return=e,e.child=r}function pc(e,r){return e=gr(22,e,null,r),e.lanes=0,e}function Hd(e,r,a){return Ei(r,e.child,null,a),e=Pd(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function ig(e,r,a){e.lanes|=r;var o=e.alternate;o!==null&&(o.lanes|=r),sd(e.return,r,a)}function Fd(e,r,a,o,h,m){var b=e.memoizedState;b===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:o,tail:a,tailMode:h,treeForkCount:m}:(b.isBackwards=r,b.rendering=null,b.renderingStartTime=0,b.last=o,b.tail=a,b.tailMode=h,b.treeForkCount=m)}function ag(e,r,a){var o=r.pendingProps,h=o.revealOrder,m=o.tail;o=o.children;var b=vn.current,R=(b&2)!==0;if(R?(b=b&1|2,r.flags|=128):b&=1,k(vn,b),Gn(e,r,o,a),o=Tt?pl:0,!R&&e!==null&&(e.flags&128)!==0)e:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ig(e,a,r);else if(e.tag===19)ig(e,a,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break e;for(;e.sibling===null;){if(e.return===null||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(h){case"forwards":for(a=r.child,h=null;a!==null;)e=a.alternate,e!==null&&nc(e)===null&&(h=a),a=a.sibling;a=h,a===null?(h=r.child,r.child=null):(h=a.sibling,a.sibling=null),Fd(r,!1,h,a,m,o);break;case"backwards":case"unstable_legacy-backwards":for(a=null,h=r.child,r.child=null;h!==null;){if(e=h.alternate,e!==null&&nc(e)===null){r.child=h;break}e=h.sibling,h.sibling=a,a=h,h=e}Fd(r,!0,a,null,m,o);break;case"together":Fd(r,!1,null,null,void 0,o);break;default:r.memoizedState=null}return r.child}function ps(e,r,a){if(e!==null&&(r.dependencies=e.dependencies),Xs|=r.lanes,(a&r.childLanes)===0)if(e!==null){if(ia(e,r,a,!1),(a&r.childLanes)===0)return null}else return null;if(e!==null&&r.child!==e.child)throw Error(l(153));if(r.child!==null){for(e=r.child,a=os(e,e.pendingProps),r.child=a,a.return=r;e.sibling!==null;)e=e.sibling,a=a.sibling=os(e,e.pendingProps),a.return=r;a.sibling=null}return r.child}function Gd(e,r){return(e.lanes&r)!==0?!0:(e=e.dependencies,!!(e!==null&&Ko(e)))}function Ub(e,r,a){switch(r.tag){case 3:q(r,r.stateNode.containerInfo),Hs(r,jn,e.memoizedState.cache),bi();break;case 27:case 5:ge(r);break;case 4:q(r,r.stateNode.containerInfo);break;case 10:Hs(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,gd(r),null;break;case 13:var o=r.memoizedState;if(o!==null)return o.dehydrated!==null?(Ys(r),r.flags|=128,null):(a&r.child.childLanes)!==0?sg(e,r,a):(Ys(r),e=ps(e,r,a),e!==null?e.sibling:null);Ys(r);break;case 19:var h=(e.flags&128)!==0;if(o=(a&r.childLanes)!==0,o||(ia(e,r,a,!1),o=(a&r.childLanes)!==0),h){if(o)return ag(e,r,a);r.flags|=128}if(h=r.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),k(vn,vn.current),o)break;return null;case 22:return r.lanes=0,Jm(e,r,a,r.pendingProps);case 24:Hs(r,jn,e.memoizedState.cache)}return ps(e,r,a)}function lg(e,r,a){if(e!==null)if(e.memoizedProps!==r.pendingProps)Cn=!0;else{if(!Gd(e,a)&&(r.flags&128)===0)return Cn=!1,Ub(e,r,a);Cn=(e.flags&131072)!==0}else Cn=!1,Tt&&(r.flags&1048576)!==0&&Ip(r,pl,r.index);switch(r.lanes=0,r.tag){case 16:e:{var o=r.pendingProps;if(e=_i(r.elementType),r.type=e,typeof e=="function")Wu(e)?(o=Ri(e,o),r.tag=1,r=ng(null,r,e,o,a)):(r.tag=0,r=Bd(null,r,e,o,a));else{if(e!=null){var h=e.$$typeof;if(h===P){r.tag=11,r=Qm(null,r,e,o,a);break e}else if(h===M){r.tag=14,r=Wm(null,r,e,o,a);break e}}throw r=z(e)||e,Error(l(306,r,""))}}return r;case 0:return Bd(e,r,r.type,r.pendingProps,a);case 1:return o=r.type,h=Ri(o,r.pendingProps),ng(e,r,o,h,a);case 3:e:{if(q(r,r.stateNode.containerInfo),e===null)throw Error(l(387));o=r.pendingProps;var m=r.memoizedState;h=m.element,dd(e,r),Sl(r,o,null,a);var b=r.memoizedState;if(o=b.cache,Hs(r,jn,o),o!==m.cache&&id(r,[jn],a,!0),wl(),o=b.element,m.isDehydrated)if(m={element:o,isDehydrated:!1,cache:b.cache},r.updateQueue.baseState=m,r.memoizedState=m,r.flags&256){r=rg(e,r,o,a);break e}else if(o!==h){h=Tr(Error(l(424)),r),ml(h),r=rg(e,r,o,a);break e}else for(e=r.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,Zt=Mr(e.firstChild),Hn=r,Tt=!0,qs=null,Or=!0,a=Jp(r,null,o,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(bi(),o===h){r=ps(e,r,a);break e}Gn(e,r,o,a)}r=r.child}return r;case 26:return fc(e,r),e===null?(a=vy(r.type,null,r.pendingProps,null))?r.memoizedState=a:Tt||(a=r.type,e=r.pendingProps,o=Ac(fe.current).createElement(a),o[Oe]=r,o[De]=e,Vn(o,a,e),qt(o),r.stateNode=o):r.memoizedState=vy(r.type,e.memoizedProps,r.pendingProps,e.memoizedState),null;case 27:return ge(r),e===null&&Tt&&(o=r.stateNode=my(r.type,r.pendingProps,fe.current),Hn=r,Or=!0,h=Zt,ni(r.type)?(_h=h,Zt=Mr(o.firstChild)):Zt=h),Gn(e,r,r.pendingProps.children,a),fc(e,r),e===null&&(r.flags|=4194304),r.child;case 5:return e===null&&Tt&&((h=o=Zt)&&(o=hw(o,r.type,r.pendingProps,Or),o!==null?(r.stateNode=o,Hn=r,Zt=Mr(o.firstChild),Or=!1,h=!0):h=!1),h||Ps(r)),ge(r),h=r.type,m=r.pendingProps,b=e!==null?e.memoizedProps:null,o=m.children,xh(h,m)?o=null:b!==null&&xh(h,b)&&(r.flags|=32),r.memoizedState!==null&&(h=vd(e,r,Nb,null,null,a),Pl._currentValue=h),fc(e,r),Gn(e,r,o,a),r.child;case 6:return e===null&&Tt&&((e=a=Zt)&&(a=fw(a,r.pendingProps,Or),a!==null?(r.stateNode=a,Hn=r,Zt=null,e=!0):e=!1),e||Ps(r)),null;case 13:return sg(e,r,a);case 4:return q(r,r.stateNode.containerInfo),o=r.pendingProps,e===null?r.child=Ei(r,null,o,a):Gn(e,r,o,a),r.child;case 11:return Qm(e,r,r.type,r.pendingProps,a);case 7:return Gn(e,r,r.pendingProps,a),r.child;case 8:return Gn(e,r,r.pendingProps.children,a),r.child;case 12:return Gn(e,r,r.pendingProps.children,a),r.child;case 10:return o=r.pendingProps,Hs(r,r.type,o.value),Gn(e,r,o.children,a),r.child;case 9:return h=r.type._context,o=r.pendingProps.children,Si(r),h=Fn(h),o=o(h),r.flags|=1,Gn(e,r,o,a),r.child;case 14:return Wm(e,r,r.type,r.pendingProps,a);case 15:return Xm(e,r,r.type,r.pendingProps,a);case 19:return ag(e,r,a);case 31:return zb(e,r,a);case 22:return Jm(e,r,a,r.pendingProps);case 24:return Si(r),o=Fn(jn),e===null?(h=od(),h===null&&(h=Yt,m=ad(),h.pooledCache=m,m.refCount++,m!==null&&(h.pooledCacheLanes|=a),h=m),r.memoizedState={parent:o,cache:h},ud(r),Hs(r,jn,h)):((e.lanes&a)!==0&&(dd(e,r),Sl(r,null,null,a),wl()),h=e.memoizedState,m=r.memoizedState,h.parent!==o?(h={parent:o,cache:o},r.memoizedState=h,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=h),Hs(r,jn,o)):(o=m.cache,Hs(r,jn,o),o!==h.cache&&id(r,[jn],a,!0))),Gn(e,r,r.pendingProps.children,a),r.child;case 29:throw r.pendingProps}throw Error(l(156,r.tag))}function ms(e){e.flags|=4}function Vd(e,r,a,o,h){if((r=(e.mode&32)!==0)&&(r=!1),r){if(e.flags|=16777216,(h&335544128)===h)if(e.stateNode.complete)e.flags|=8192;else if(Mg())e.flags|=8192;else throw Ci=Jo,cd}else e.flags&=-16777217}function og(e,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!jy(r))if(Mg())e.flags|=8192;else throw Ci=Jo,cd}function mc(e,r){r!==null&&(e.flags|=4),e.flags&16384&&(r=e.tag!==22?Ot():536870912,e.lanes|=r,ya|=r)}function Rl(e,r){if(!Tt)switch(e.tailMode){case"hidden":r=e.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function en(e){var r=e.alternate!==null&&e.alternate.child===e.child,a=0,o=0;if(r)for(var h=e.child;h!==null;)a|=h.lanes|h.childLanes,o|=h.subtreeFlags&65011712,o|=h.flags&65011712,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)a|=h.lanes|h.childLanes,o|=h.subtreeFlags,o|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=o,e.childLanes=a,r}function Lb(e,r,a){var o=r.pendingProps;switch(ed(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(r),null;case 1:return en(r),null;case 3:return a=r.stateNode,o=null,e!==null&&(o=e.memoizedState.cache),r.memoizedState.cache!==o&&(r.flags|=2048),ds(jn),le(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(sa(r)?ms(r):e===null||e.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,nd())),en(r),null;case 26:var h=r.type,m=r.memoizedState;return e===null?(ms(r),m!==null?(en(r),og(r,m)):(en(r),Vd(r,h,null,o,a))):m?m!==e.memoizedState?(ms(r),en(r),og(r,m)):(en(r),r.flags&=-16777217):(e=e.memoizedProps,e!==o&&ms(r),en(r),Vd(r,h,e,o,a)),null;case 27:if(Ne(r),a=fe.current,h=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==o&&ms(r);else{if(!o){if(r.stateNode===null)throw Error(l(166));return en(r),null}e=te.current,sa(r)?qp(r):(e=my(h,o,a),r.stateNode=e,ms(r))}return en(r),null;case 5:if(Ne(r),h=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==o&&ms(r);else{if(!o){if(r.stateNode===null)throw Error(l(166));return en(r),null}if(m=te.current,sa(r))qp(r);else{var b=Ac(fe.current);switch(m){case 1:m=b.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:m=b.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":m=b.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":m=b.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":m=b.createElement("div"),m.innerHTML="<script><\/script>",m=m.removeChild(m.firstChild);break;case"select":m=typeof o.is=="string"?b.createElement("select",{is:o.is}):b.createElement("select"),o.multiple?m.multiple=!0:o.size&&(m.size=o.size);break;default:m=typeof o.is=="string"?b.createElement(h,{is:o.is}):b.createElement(h)}}m[Oe]=r,m[De]=o;e:for(b=r.child;b!==null;){if(b.tag===5||b.tag===6)m.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===r)break e;for(;b.sibling===null;){if(b.return===null||b.return===r)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}r.stateNode=m;e:switch(Vn(m,h,o),h){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&ms(r)}}return en(r),Vd(r,r.type,e===null?null:e.memoizedProps,r.pendingProps,a),null;case 6:if(e&&r.stateNode!=null)e.memoizedProps!==o&&ms(r);else{if(typeof o!="string"&&r.stateNode===null)throw Error(l(166));if(e=fe.current,sa(r)){if(e=r.stateNode,a=r.memoizedProps,o=null,h=Hn,h!==null)switch(h.tag){case 27:case 5:o=h.memoizedProps}e[Oe]=r,e=!!(e.nodeValue===a||o!==null&&o.suppressHydrationWarning===!0||sy(e.nodeValue,a)),e||Ps(r,!0)}else e=Ac(e).createTextNode(o),e[Oe]=r,r.stateNode=e}return en(r),null;case 31:if(a=r.memoizedState,e===null||e.memoizedState!==null){if(o=sa(r),a!==null){if(e===null){if(!o)throw Error(l(318));if(e=r.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(557));e[Oe]=r}else bi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;en(r),e=!1}else a=nd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return r.flags&256?(vr(r),r):(vr(r),null);if((r.flags&128)!==0)throw Error(l(558))}return en(r),null;case 13:if(o=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(h=sa(r),o!==null&&o.dehydrated!==null){if(e===null){if(!h)throw Error(l(318));if(h=r.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(l(317));h[Oe]=r}else bi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;en(r),h=!1}else h=nd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=h),h=!0;if(!h)return r.flags&256?(vr(r),r):(vr(r),null)}return vr(r),(r.flags&128)!==0?(r.lanes=a,r):(a=o!==null,e=e!==null&&e.memoizedState!==null,a&&(o=r.child,h=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(h=o.alternate.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==h&&(o.flags|=2048)),a!==e&&a&&(r.child.flags|=8192),mc(r,r.updateQueue),en(r),null);case 4:return le(),e===null&&ph(r.stateNode.containerInfo),en(r),null;case 10:return ds(r.type),en(r),null;case 19:if(V(vn),o=r.memoizedState,o===null)return en(r),null;if(h=(r.flags&128)!==0,m=o.rendering,m===null)if(h)Rl(o,!1);else{if(dn!==0||e!==null&&(e.flags&128)!==0)for(e=r.child;e!==null;){if(m=nc(e),m!==null){for(r.flags|=128,Rl(o,!1),e=m.updateQueue,r.updateQueue=e,mc(r,e),r.subtreeFlags=0,e=a,a=r.child;a!==null;)Up(a,e),a=a.sibling;return k(vn,vn.current&1|2),Tt&&cs(r,o.treeForkCount),r.child}e=e.sibling}o.tail!==null&&St()>bc&&(r.flags|=128,h=!0,Rl(o,!1),r.lanes=4194304)}else{if(!h)if(e=nc(m),e!==null){if(r.flags|=128,h=!0,e=e.updateQueue,r.updateQueue=e,mc(r,e),Rl(o,!0),o.tail===null&&o.tailMode==="hidden"&&!m.alternate&&!Tt)return en(r),null}else 2*St()-o.renderingStartTime>bc&&a!==536870912&&(r.flags|=128,h=!0,Rl(o,!1),r.lanes=4194304);o.isBackwards?(m.sibling=r.child,r.child=m):(e=o.last,e!==null?e.sibling=m:r.child=m,o.last=m)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=St(),e.sibling=null,a=vn.current,k(vn,h?a&1|2:a&1),Tt&&cs(r,o.treeForkCount),e):(en(r),null);case 22:case 23:return vr(r),md(),o=r.memoizedState!==null,e!==null?e.memoizedState!==null!==o&&(r.flags|=8192):o&&(r.flags|=8192),o?(a&536870912)!==0&&(r.flags&128)===0&&(en(r),r.subtreeFlags&6&&(r.flags|=8192)):en(r),a=r.updateQueue,a!==null&&mc(r,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),o=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(o=r.memoizedState.cachePool.pool),o!==a&&(r.flags|=2048),e!==null&&V(ji),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),r.memoizedState.cache!==a&&(r.flags|=2048),ds(jn),en(r),null;case 25:return null;case 30:return null}throw Error(l(156,r.tag))}function Bb(e,r){switch(ed(r),r.tag){case 1:return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return ds(jn),le(),e=r.flags,(e&65536)!==0&&(e&128)===0?(r.flags=e&-65537|128,r):null;case 26:case 27:case 5:return Ne(r),null;case 31:if(r.memoizedState!==null){if(vr(r),r.alternate===null)throw Error(l(340));bi()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 13:if(vr(r),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(l(340));bi()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return V(vn),null;case 4:return le(),null;case 10:return ds(r.type),null;case 22:case 23:return vr(r),md(),e!==null&&V(ji),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 24:return ds(jn),null;case 25:return null;default:return null}}function cg(e,r){switch(ed(r),r.tag){case 3:ds(jn),le();break;case 26:case 27:case 5:Ne(r);break;case 4:le();break;case 31:r.memoizedState!==null&&vr(r);break;case 13:vr(r);break;case 19:V(vn);break;case 10:ds(r.type);break;case 22:case 23:vr(r),md(),e!==null&&V(ji);break;case 24:ds(jn)}}function Tl(e,r){try{var a=r.updateQueue,o=a!==null?a.lastEffect:null;if(o!==null){var h=o.next;a=h;do{if((a.tag&e)===e){o=void 0;var m=a.create,b=a.inst;o=m(),b.destroy=o}a=a.next}while(a!==h)}}catch(R){Ht(r,r.return,R)}}function Qs(e,r,a){try{var o=r.updateQueue,h=o!==null?o.lastEffect:null;if(h!==null){var m=h.next;o=m;do{if((o.tag&e)===e){var b=o.inst,R=b.destroy;if(R!==void 0){b.destroy=void 0,h=r;var Y=a,ue=R;try{ue()}catch(we){Ht(h,Y,we)}}}o=o.next}while(o!==m)}}catch(we){Ht(r,r.return,we)}}function ug(e){var r=e.updateQueue;if(r!==null){var a=e.stateNode;try{em(r,a)}catch(o){Ht(e,e.return,o)}}}function dg(e,r,a){a.props=Ri(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(o){Ht(e,r,o)}}function Al(e,r){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var o=e.stateNode;break;case 30:o=e.stateNode;break;default:o=e.stateNode}typeof a=="function"?e.refCleanup=a(o):a.current=o}}catch(h){Ht(e,r,h)}}function ns(e,r){var a=e.ref,o=e.refCleanup;if(a!==null)if(typeof o=="function")try{o()}catch(h){Ht(e,r,h)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(h){Ht(e,r,h)}else a.current=null}function hg(e){var r=e.type,a=e.memoizedProps,o=e.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":a.autoFocus&&o.focus();break e;case"img":a.src?o.src=a.src:a.srcSet&&(o.srcset=a.srcSet)}}catch(h){Ht(e,e.return,h)}}function Yd(e,r,a){try{var o=e.stateNode;aw(o,e.type,a,r),o[De]=r}catch(h){Ht(e,e.return,h)}}function fg(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&ni(e.type)||e.tag===4}function Kd(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||fg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&ni(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Qd(e,r,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,r?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,r):(r=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,r.appendChild(e),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=Pr));else if(o!==4&&(o===27&&ni(e.type)&&(a=e.stateNode,r=null),e=e.child,e!==null))for(Qd(e,r,a),e=e.sibling;e!==null;)Qd(e,r,a),e=e.sibling}function gc(e,r,a){var o=e.tag;if(o===5||o===6)e=e.stateNode,r?a.insertBefore(e,r):a.appendChild(e);else if(o!==4&&(o===27&&ni(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(gc(e,r,a),e=e.sibling;e!==null;)gc(e,r,a),e=e.sibling}function pg(e){var r=e.stateNode,a=e.memoizedProps;try{for(var o=e.type,h=r.attributes;h.length;)r.removeAttributeNode(h[0]);Vn(r,o,a),r[Oe]=e,r[De]=a}catch(m){Ht(e,e.return,m)}}var gs=!1,En=!1,Wd=!1,mg=typeof WeakSet=="function"?WeakSet:Set,Ln=null;function Ib(e,r){if(e=e.containerInfo,yh=Lc,e=Np(e),Hu(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var o=a.getSelection&&a.getSelection();if(o&&o.rangeCount!==0){a=o.anchorNode;var h=o.anchorOffset,m=o.focusNode;o=o.focusOffset;try{a.nodeType,m.nodeType}catch{a=null;break e}var b=0,R=-1,Y=-1,ue=0,we=0,je=e,pe=null;t:for(;;){for(var ye;je!==a||h!==0&&je.nodeType!==3||(R=b+h),je!==m||o!==0&&je.nodeType!==3||(Y=b+o),je.nodeType===3&&(b+=je.nodeValue.length),(ye=je.firstChild)!==null;)pe=je,je=ye;for(;;){if(je===e)break t;if(pe===a&&++ue===h&&(R=b),pe===m&&++we===o&&(Y=b),(ye=je.nextSibling)!==null)break;je=pe,pe=je.parentNode}je=ye}a=R===-1||Y===-1?null:{start:R,end:Y}}else a=null}a=a||{start:0,end:0}}else a=null;for(vh={focusedElem:e,selectionRange:a},Lc=!1,Ln=r;Ln!==null;)if(r=Ln,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,Ln=e;else for(;Ln!==null;){switch(r=Ln,m=r.alternate,e=r.flags,r.tag){case 0:if((e&4)!==0&&(e=r.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)h=e[a],h.ref.impl=h.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&m!==null){e=void 0,a=r,h=m.memoizedProps,m=m.memoizedState,o=a.stateNode;try{var qe=Ri(a.type,h);e=o.getSnapshotBeforeUpdate(qe,m),o.__reactInternalSnapshotBeforeUpdate=e}catch(nt){Ht(a,a.return,nt)}}break;case 3:if((e&1024)!==0){if(e=r.stateNode.containerInfo,a=e.nodeType,a===9)wh(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":wh(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(l(163))}if(e=r.sibling,e!==null){e.return=r.return,Ln=e;break}Ln=r.return}}function gg(e,r,a){var o=a.flags;switch(a.tag){case 0:case 11:case 15:vs(e,a),o&4&&Tl(5,a);break;case 1:if(vs(e,a),o&4)if(e=a.stateNode,r===null)try{e.componentDidMount()}catch(b){Ht(a,a.return,b)}else{var h=Ri(a.type,r.memoizedProps);r=r.memoizedState;try{e.componentDidUpdate(h,r,e.__reactInternalSnapshotBeforeUpdate)}catch(b){Ht(a,a.return,b)}}o&64&&ug(a),o&512&&Al(a,a.return);break;case 3:if(vs(e,a),o&64&&(e=a.updateQueue,e!==null)){if(r=null,a.child!==null)switch(a.child.tag){case 27:case 5:r=a.child.stateNode;break;case 1:r=a.child.stateNode}try{em(e,r)}catch(b){Ht(a,a.return,b)}}break;case 27:r===null&&o&4&&pg(a);case 26:case 5:vs(e,a),r===null&&o&4&&hg(a),o&512&&Al(a,a.return);break;case 12:vs(e,a);break;case 31:vs(e,a),o&4&&xg(e,a);break;case 13:vs(e,a),o&4&&bg(e,a),o&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Kb.bind(null,a),pw(e,a))));break;case 22:if(o=a.memoizedState!==null||gs,!o){r=r!==null&&r.memoizedState!==null||En,h=gs;var m=En;gs=o,(En=r)&&!m?xs(e,a,(a.subtreeFlags&8772)!==0):vs(e,a),gs=h,En=m}break;case 30:break;default:vs(e,a)}}function yg(e){var r=e.alternate;r!==null&&(e.alternate=null,yg(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&sr(r)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var rn=null,or=!1;function ys(e,r,a){for(a=a.child;a!==null;)vg(e,r,a),a=a.sibling}function vg(e,r,a){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(qn,a)}catch{}switch(a.tag){case 26:En||ns(a,r),ys(e,r,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:En||ns(a,r);var o=rn,h=or;ni(a.type)&&(rn=a.stateNode,or=!1),ys(e,r,a),Il(a.stateNode),rn=o,or=h;break;case 5:En||ns(a,r);case 6:if(o=rn,h=or,rn=null,ys(e,r,a),rn=o,or=h,rn!==null)if(or)try{(rn.nodeType===9?rn.body:rn.nodeName==="HTML"?rn.ownerDocument.body:rn).removeChild(a.stateNode)}catch(m){Ht(a,r,m)}else try{rn.removeChild(a.stateNode)}catch(m){Ht(a,r,m)}break;case 18:rn!==null&&(or?(e=rn,uy(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),Ca(e)):uy(rn,a.stateNode));break;case 4:o=rn,h=or,rn=a.stateNode.containerInfo,or=!0,ys(e,r,a),rn=o,or=h;break;case 0:case 11:case 14:case 15:Qs(2,a,r),En||Qs(4,a,r),ys(e,r,a);break;case 1:En||(ns(a,r),o=a.stateNode,typeof o.componentWillUnmount=="function"&&dg(a,r,o)),ys(e,r,a);break;case 21:ys(e,r,a);break;case 22:En=(o=En)||a.memoizedState!==null,ys(e,r,a),En=o;break;default:ys(e,r,a)}}function xg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Ca(e)}catch(a){Ht(r,r.return,a)}}}function bg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ca(e)}catch(a){Ht(r,r.return,a)}}function $b(e){switch(e.tag){case 31:case 13:case 19:var r=e.stateNode;return r===null&&(r=e.stateNode=new mg),r;case 22:return e=e.stateNode,r=e._retryCache,r===null&&(r=e._retryCache=new mg),r;default:throw Error(l(435,e.tag))}}function yc(e,r){var a=$b(e);r.forEach(function(o){if(!a.has(o)){a.add(o);var h=Qb.bind(null,e,o);o.then(h,h)}})}function cr(e,r){var a=r.deletions;if(a!==null)for(var o=0;o<a.length;o++){var h=a[o],m=e,b=r,R=b;e:for(;R!==null;){switch(R.tag){case 27:if(ni(R.type)){rn=R.stateNode,or=!1;break e}break;case 5:rn=R.stateNode,or=!1;break e;case 3:case 4:rn=R.stateNode.containerInfo,or=!0;break e}R=R.return}if(rn===null)throw Error(l(160));vg(m,b,h),rn=null,or=!1,m=h.alternate,m!==null&&(m.return=null),h.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)wg(r,e),r=r.sibling}var Fr=null;function wg(e,r){var a=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:cr(r,e),ur(e),o&4&&(Qs(3,e,e.return),Tl(3,e),Qs(5,e,e.return));break;case 1:cr(r,e),ur(e),o&512&&(En||a===null||ns(a,a.return)),o&64&&gs&&(e=e.updateQueue,e!==null&&(o=e.callbacks,o!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?o:a.concat(o))));break;case 26:var h=Fr;if(cr(r,e),ur(e),o&512&&(En||a===null||ns(a,a.return)),o&4){var m=a!==null?a.memoizedState:null;if(o=e.memoizedState,a===null)if(o===null)if(e.stateNode===null){e:{o=e.type,a=e.memoizedProps,h=h.ownerDocument||h;t:switch(o){case"title":m=h.getElementsByTagName("title")[0],(!m||m[It]||m[Oe]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=h.createElement(o),h.head.insertBefore(m,h.querySelector("head > title"))),Vn(m,o,a),m[Oe]=e,qt(m),o=m;break e;case"link":var b=wy("link","href",h).get(o+(a.href||""));if(b){for(var R=0;R<b.length;R++)if(m=b[R],m.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&m.getAttribute("rel")===(a.rel==null?null:a.rel)&&m.getAttribute("title")===(a.title==null?null:a.title)&&m.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){b.splice(R,1);break t}}m=h.createElement(o),Vn(m,o,a),h.head.appendChild(m);break;case"meta":if(b=wy("meta","content",h).get(o+(a.content||""))){for(R=0;R<b.length;R++)if(m=b[R],m.getAttribute("content")===(a.content==null?null:""+a.content)&&m.getAttribute("name")===(a.name==null?null:a.name)&&m.getAttribute("property")===(a.property==null?null:a.property)&&m.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&m.getAttribute("charset")===(a.charSet==null?null:a.charSet)){b.splice(R,1);break t}}m=h.createElement(o),Vn(m,o,a),h.head.appendChild(m);break;default:throw Error(l(468,o))}m[Oe]=e,qt(m),o=m}e.stateNode=o}else Sy(h,e.type,e.stateNode);else e.stateNode=by(h,o,e.memoizedProps);else m!==o?(m===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):m.count--,o===null?Sy(h,e.type,e.stateNode):by(h,o,e.memoizedProps)):o===null&&e.stateNode!==null&&Yd(e,e.memoizedProps,a.memoizedProps)}break;case 27:cr(r,e),ur(e),o&512&&(En||a===null||ns(a,a.return)),a!==null&&o&4&&Yd(e,e.memoizedProps,a.memoizedProps);break;case 5:if(cr(r,e),ur(e),o&512&&(En||a===null||ns(a,a.return)),e.flags&32){h=e.stateNode;try{is(h,"")}catch(qe){Ht(e,e.return,qe)}}o&4&&e.stateNode!=null&&(h=e.memoizedProps,Yd(e,h,a!==null?a.memoizedProps:h)),o&1024&&(Wd=!0);break;case 6:if(cr(r,e),ur(e),o&4){if(e.stateNode===null)throw Error(l(162));o=e.memoizedProps,a=e.stateNode;try{a.nodeValue=o}catch(qe){Ht(e,e.return,qe)}}break;case 3:if(Dc=null,h=Fr,Fr=kc(r.containerInfo),cr(r,e),Fr=h,ur(e),o&4&&a!==null&&a.memoizedState.isDehydrated)try{Ca(r.containerInfo)}catch(qe){Ht(e,e.return,qe)}Wd&&(Wd=!1,Sg(e));break;case 4:o=Fr,Fr=kc(e.stateNode.containerInfo),cr(r,e),ur(e),Fr=o;break;case 12:cr(r,e),ur(e);break;case 31:cr(r,e),ur(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,yc(e,o)));break;case 13:cr(r,e),ur(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(xc=St()),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,yc(e,o)));break;case 22:h=e.memoizedState!==null;var Y=a!==null&&a.memoizedState!==null,ue=gs,we=En;if(gs=ue||h,En=we||Y,cr(r,e),En=we,gs=ue,ur(e),o&8192)e:for(r=e.stateNode,r._visibility=h?r._visibility&-2:r._visibility|1,h&&(a===null||Y||gs||En||Ti(e)),a=null,r=e;;){if(r.tag===5||r.tag===26){if(a===null){Y=a=r;try{if(m=Y.stateNode,h)b=m.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{R=Y.stateNode;var je=Y.memoizedProps.style,pe=je!=null&&je.hasOwnProperty("display")?je.display:null;R.style.display=pe==null||typeof pe=="boolean"?"":(""+pe).trim()}}catch(qe){Ht(Y,Y.return,qe)}}}else if(r.tag===6){if(a===null){Y=r;try{Y.stateNode.nodeValue=h?"":Y.memoizedProps}catch(qe){Ht(Y,Y.return,qe)}}}else if(r.tag===18){if(a===null){Y=r;try{var ye=Y.stateNode;h?dy(ye,!0):dy(Y.stateNode,!1)}catch(qe){Ht(Y,Y.return,qe)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;a===r&&(a=null),r=r.return}a===r&&(a=null),r.sibling.return=r.return,r=r.sibling}o&4&&(o=e.updateQueue,o!==null&&(a=o.retryQueue,a!==null&&(o.retryQueue=null,yc(e,a))));break;case 19:cr(r,e),ur(e),o&4&&(o=e.updateQueue,o!==null&&(e.updateQueue=null,yc(e,o)));break;case 30:break;case 21:break;default:cr(r,e),ur(e)}}function ur(e){var r=e.flags;if(r&2){try{for(var a,o=e.return;o!==null;){if(fg(o)){a=o;break}o=o.return}if(a==null)throw Error(l(160));switch(a.tag){case 27:var h=a.stateNode,m=Kd(e);gc(e,m,h);break;case 5:var b=a.stateNode;a.flags&32&&(is(b,""),a.flags&=-33);var R=Kd(e);gc(e,R,b);break;case 3:case 4:var Y=a.stateNode.containerInfo,ue=Kd(e);Qd(e,ue,Y);break;default:throw Error(l(161))}}catch(we){Ht(e,e.return,we)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function Sg(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var r=e;Sg(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),e=e.sibling}}function vs(e,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)gg(e,r.alternate,r),r=r.sibling}function Ti(e){for(e=e.child;e!==null;){var r=e;switch(r.tag){case 0:case 11:case 14:case 15:Qs(4,r,r.return),Ti(r);break;case 1:ns(r,r.return);var a=r.stateNode;typeof a.componentWillUnmount=="function"&&dg(r,r.return,a),Ti(r);break;case 27:Il(r.stateNode);case 26:case 5:ns(r,r.return),Ti(r);break;case 22:r.memoizedState===null&&Ti(r);break;case 30:Ti(r);break;default:Ti(r)}e=e.sibling}}function xs(e,r,a){for(a=a&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var o=r.alternate,h=e,m=r,b=m.flags;switch(m.tag){case 0:case 11:case 15:xs(h,m,a),Tl(4,m);break;case 1:if(xs(h,m,a),o=m,h=o.stateNode,typeof h.componentDidMount=="function")try{h.componentDidMount()}catch(ue){Ht(o,o.return,ue)}if(o=m,h=o.updateQueue,h!==null){var R=o.stateNode;try{var Y=h.shared.hiddenCallbacks;if(Y!==null)for(h.shared.hiddenCallbacks=null,h=0;h<Y.length;h++)Zp(Y[h],R)}catch(ue){Ht(o,o.return,ue)}}a&&b&64&&ug(m),Al(m,m.return);break;case 27:pg(m);case 26:case 5:xs(h,m,a),a&&o===null&&b&4&&hg(m),Al(m,m.return);break;case 12:xs(h,m,a);break;case 31:xs(h,m,a),a&&b&4&&xg(h,m);break;case 13:xs(h,m,a),a&&b&4&&bg(h,m);break;case 22:m.memoizedState===null&&xs(h,m,a),Al(m,m.return);break;case 30:break;default:xs(h,m,a)}r=r.sibling}}function Xd(e,r){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(e=r.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&gl(a))}function Jd(e,r){e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&gl(e))}function Gr(e,r,a,o){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)jg(e,r,a,o),r=r.sibling}function jg(e,r,a,o){var h=r.flags;switch(r.tag){case 0:case 11:case 15:Gr(e,r,a,o),h&2048&&Tl(9,r);break;case 1:Gr(e,r,a,o);break;case 3:Gr(e,r,a,o),h&2048&&(e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&gl(e)));break;case 12:if(h&2048){Gr(e,r,a,o),e=r.stateNode;try{var m=r.memoizedProps,b=m.id,R=m.onPostCommit;typeof R=="function"&&R(b,r.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(Y){Ht(r,r.return,Y)}}else Gr(e,r,a,o);break;case 31:Gr(e,r,a,o);break;case 13:Gr(e,r,a,o);break;case 23:break;case 22:m=r.stateNode,b=r.alternate,r.memoizedState!==null?m._visibility&2?Gr(e,r,a,o):kl(e,r):m._visibility&2?Gr(e,r,a,o):(m._visibility|=2,pa(e,r,a,o,(r.subtreeFlags&10256)!==0||!1)),h&2048&&Xd(b,r);break;case 24:Gr(e,r,a,o),h&2048&&Jd(r.alternate,r);break;default:Gr(e,r,a,o)}}function pa(e,r,a,o,h){for(h=h&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var m=e,b=r,R=a,Y=o,ue=b.flags;switch(b.tag){case 0:case 11:case 15:pa(m,b,R,Y,h),Tl(8,b);break;case 23:break;case 22:var we=b.stateNode;b.memoizedState!==null?we._visibility&2?pa(m,b,R,Y,h):kl(m,b):(we._visibility|=2,pa(m,b,R,Y,h)),h&&ue&2048&&Xd(b.alternate,b);break;case 24:pa(m,b,R,Y,h),h&&ue&2048&&Jd(b.alternate,b);break;default:pa(m,b,R,Y,h)}r=r.sibling}}function kl(e,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var a=e,o=r,h=o.flags;switch(o.tag){case 22:kl(a,o),h&2048&&Xd(o.alternate,o);break;case 24:kl(a,o),h&2048&&Jd(o.alternate,o);break;default:kl(a,o)}r=r.sibling}}var Ol=8192;function ma(e,r,a){if(e.subtreeFlags&Ol)for(e=e.child;e!==null;)_g(e,r,a),e=e.sibling}function _g(e,r,a){switch(e.tag){case 26:ma(e,r,a),e.flags&Ol&&e.memoizedState!==null&&Ew(a,Fr,e.memoizedState,e.memoizedProps);break;case 5:ma(e,r,a);break;case 3:case 4:var o=Fr;Fr=kc(e.stateNode.containerInfo),ma(e,r,a),Fr=o;break;case 22:e.memoizedState===null&&(o=e.alternate,o!==null&&o.memoizedState!==null?(o=Ol,Ol=16777216,ma(e,r,a),Ol=o):ma(e,r,a));break;default:ma(e,r,a)}}function Cg(e){var r=e.alternate;if(r!==null&&(e=r.child,e!==null)){r.child=null;do r=e.sibling,e.sibling=null,e=r;while(e!==null)}}function Dl(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var o=r[a];Ln=o,Ng(o,e)}Cg(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Eg(e),e=e.sibling}function Eg(e){switch(e.tag){case 0:case 11:case 15:Dl(e),e.flags&2048&&Qs(9,e,e.return);break;case 3:Dl(e);break;case 12:Dl(e);break;case 22:var r=e.stateNode;e.memoizedState!==null&&r._visibility&2&&(e.return===null||e.return.tag!==13)?(r._visibility&=-3,vc(e)):Dl(e);break;default:Dl(e)}}function vc(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var o=r[a];Ln=o,Ng(o,e)}Cg(e)}for(e=e.child;e!==null;){switch(r=e,r.tag){case 0:case 11:case 15:Qs(8,r,r.return),vc(r);break;case 22:a=r.stateNode,a._visibility&2&&(a._visibility&=-3,vc(r));break;default:vc(r)}e=e.sibling}}function Ng(e,r){for(;Ln!==null;){var a=Ln;switch(a.tag){case 0:case 11:case 15:Qs(8,a,r);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var o=a.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:gl(a.memoizedState.cache)}if(o=a.child,o!==null)o.return=a,Ln=o;else e:for(a=e;Ln!==null;){o=Ln;var h=o.sibling,m=o.return;if(yg(o),o===a){Ln=null;break e}if(h!==null){h.return=m,Ln=h;break e}Ln=m}}}var qb={getCacheForType:function(e){var r=Fn(jn),a=r.data.get(e);return a===void 0&&(a=e(),r.data.set(e,a)),a},cacheSignal:function(){return Fn(jn).controller.signal}},Pb=typeof WeakMap=="function"?WeakMap:Map,zt=0,Yt=null,yt=null,Ct=0,Pt=0,xr=null,Ws=!1,ga=!1,Zd=!1,bs=0,dn=0,Xs=0,Ai=0,eh=0,br=0,ya=0,Ml=null,dr=null,th=!1,xc=0,Rg=0,bc=1/0,wc=null,Js=null,kn=0,Zs=null,va=null,ws=0,nh=0,rh=null,Tg=null,zl=0,sh=null;function wr(){return(zt&2)!==0&&Ct!==0?Ct&-Ct:N.T!==null?uh():xe()}function Ag(){if(br===0)if((Ct&536870912)===0||Tt){var e=nn;nn<<=1,(nn&3932160)===0&&(nn=262144),br=e}else br=536870912;return e=yr.current,e!==null&&(e.flags|=32),br}function hr(e,r,a){(e===Yt&&(Pt===2||Pt===9)||e.cancelPendingCommit!==null)&&(xa(e,0),ei(e,Ct,br,!1)),kt(e,a),((zt&2)===0||e!==Yt)&&(e===Yt&&((zt&2)===0&&(Ai|=a),dn===4&&ei(e,Ct,br,!1)),rs(e))}function kg(e,r,a){if((zt&6)!==0)throw Error(l(327));var o=!a&&(r&127)===0&&(r&e.expiredLanes)===0||pn(e,r),h=o?Gb(e,r):ah(e,r,!0),m=o;do{if(h===0){ga&&!o&&ei(e,r,0,!1);break}else{if(a=e.current.alternate,m&&!Hb(a)){h=ah(e,r,!1),m=!1;continue}if(h===2){if(m=r,e.errorRecoveryDisabledLanes&m)var b=0;else b=e.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){r=b;e:{var R=e;h=Ml;var Y=R.current.memoizedState.isDehydrated;if(Y&&(xa(R,b).flags|=256),b=ah(R,b,!1),b!==2){if(Zd&&!Y){R.errorRecoveryDisabledLanes|=m,Ai|=m,h=4;break e}m=dr,dr=h,m!==null&&(dr===null?dr=m:dr.push.apply(dr,m))}h=b}if(m=!1,h!==2)continue}}if(h===1){xa(e,0),ei(e,r,0,!0);break}e:{switch(o=e,m=h,m){case 0:case 1:throw Error(l(345));case 4:if((r&4194048)!==r)break;case 6:ei(o,r,br,!Ws);break e;case 2:dr=null;break;case 3:case 5:break;default:throw Error(l(329))}if((r&62914560)===r&&(h=xc+300-St(),10<h)){if(ei(o,r,br,!Ws),Bt(o,0,!0)!==0)break e;ws=r,o.timeoutHandle=oy(Og.bind(null,o,a,dr,wc,th,r,br,Ai,ya,Ws,m,"Throttled",-0,0),h);break e}Og(o,a,dr,wc,th,r,br,Ai,ya,Ws,m,null,-0,0)}}break}while(!0);rs(e)}function Og(e,r,a,o,h,m,b,R,Y,ue,we,je,pe,ye){if(e.timeoutHandle=-1,je=r.subtreeFlags,je&8192||(je&16785408)===16785408){je={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Pr},_g(r,m,je);var qe=(m&62914560)===m?xc-St():(m&4194048)===m?Rg-St():0;if(qe=Nw(je,qe),qe!==null){ws=m,e.cancelPendingCommit=qe($g.bind(null,e,r,m,a,o,h,b,R,Y,we,je,null,pe,ye)),ei(e,m,b,!ue);return}}$g(e,r,m,a,o,h,b,R,Y)}function Hb(e){for(var r=e;;){var a=r.tag;if((a===0||a===11||a===15)&&r.flags&16384&&(a=r.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var o=0;o<a.length;o++){var h=a[o],m=h.getSnapshot;h=h.value;try{if(!mr(m(),h))return!1}catch{return!1}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ei(e,r,a,o){r&=~eh,r&=~Ai,e.suspendedLanes|=r,e.pingedLanes&=~r,o&&(e.warmLanes|=r),o=e.expirationTimes;for(var h=r;0<h;){var m=31-ln(h),b=1<<m;o[m]=-1,h&=~b}a!==0&&ne(e,a,r)}function Sc(){return(zt&6)===0?(Ul(0),!1):!0}function ih(){if(yt!==null){if(Pt===0)var e=yt.return;else e=yt,us=wi=null,wd(e),ca=null,vl=0,e=yt;for(;e!==null;)cg(e.alternate,e),e=e.return;yt=null}}function xa(e,r){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,cw(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),ws=0,ih(),Yt=e,yt=a=os(e.current,null),Ct=r,Pt=0,xr=null,Ws=!1,ga=pn(e,r),Zd=!1,ya=br=eh=Ai=Xs=dn=0,dr=Ml=null,th=!1,(r&8)!==0&&(r|=r&32);var o=e.entangledLanes;if(o!==0)for(e=e.entanglements,o&=r;0<o;){var h=31-ln(o),m=1<<h;r|=e[h],o&=~m}return bs=r,Ho(),a}function Dg(e,r){ht=null,N.H=El,r===oa||r===Xo?(r=Qp(),Pt=3):r===cd?(r=Qp(),Pt=4):Pt=r===Ld?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,xr=r,yt===null&&(dn=1,dc(e,Tr(r,e.current)))}function Mg(){var e=yr.current;return e===null?!0:(Ct&4194048)===Ct?Dr===null:(Ct&62914560)===Ct||(Ct&536870912)!==0?e===Dr:!1}function zg(){var e=N.H;return N.H=El,e===null?El:e}function Ug(){var e=N.A;return N.A=qb,e}function jc(){dn=4,Ws||(Ct&4194048)!==Ct&&yr.current!==null||(ga=!0),(Xs&134217727)===0&&(Ai&134217727)===0||Yt===null||ei(Yt,Ct,br,!1)}function ah(e,r,a){var o=zt;zt|=2;var h=zg(),m=Ug();(Yt!==e||Ct!==r)&&(wc=null,xa(e,r)),r=!1;var b=dn;e:do try{if(Pt!==0&&yt!==null){var R=yt,Y=xr;switch(Pt){case 8:ih(),b=6;break e;case 3:case 2:case 9:case 6:yr.current===null&&(r=!0);var ue=Pt;if(Pt=0,xr=null,ba(e,R,Y,ue),a&&ga){b=0;break e}break;default:ue=Pt,Pt=0,xr=null,ba(e,R,Y,ue)}}Fb(),b=dn;break}catch(we){Dg(e,we)}while(!0);return r&&e.shellSuspendCounter++,us=wi=null,zt=o,N.H=h,N.A=m,yt===null&&(Yt=null,Ct=0,Ho()),b}function Fb(){for(;yt!==null;)Lg(yt)}function Gb(e,r){var a=zt;zt|=2;var o=zg(),h=Ug();Yt!==e||Ct!==r?(wc=null,bc=St()+500,xa(e,r)):ga=pn(e,r);e:do try{if(Pt!==0&&yt!==null){r=yt;var m=xr;t:switch(Pt){case 1:Pt=0,xr=null,ba(e,r,m,1);break;case 2:case 9:if(Yp(m)){Pt=0,xr=null,Bg(r);break}r=function(){Pt!==2&&Pt!==9||Yt!==e||(Pt=7),rs(e)},m.then(r,r);break e;case 3:Pt=7;break e;case 4:Pt=5;break e;case 7:Yp(m)?(Pt=0,xr=null,Bg(r)):(Pt=0,xr=null,ba(e,r,m,7));break;case 5:var b=null;switch(yt.tag){case 26:b=yt.memoizedState;case 5:case 27:var R=yt;if(b?jy(b):R.stateNode.complete){Pt=0,xr=null;var Y=R.sibling;if(Y!==null)yt=Y;else{var ue=R.return;ue!==null?(yt=ue,_c(ue)):yt=null}break t}}Pt=0,xr=null,ba(e,r,m,5);break;case 6:Pt=0,xr=null,ba(e,r,m,6);break;case 8:ih(),dn=6;break e;default:throw Error(l(462))}}Vb();break}catch(we){Dg(e,we)}while(!0);return us=wi=null,N.H=o,N.A=h,zt=a,yt!==null?0:(Yt=null,Ct=0,Ho(),dn)}function Vb(){for(;yt!==null&&!ct();)Lg(yt)}function Lg(e){var r=lg(e.alternate,e,bs);e.memoizedProps=e.pendingProps,r===null?_c(e):yt=r}function Bg(e){var r=e,a=r.alternate;switch(r.tag){case 15:case 0:r=tg(a,r,r.pendingProps,r.type,void 0,Ct);break;case 11:r=tg(a,r,r.pendingProps,r.type.render,r.ref,Ct);break;case 5:wd(r);default:cg(a,r),r=yt=Up(r,bs),r=lg(a,r,bs)}e.memoizedProps=e.pendingProps,r===null?_c(e):yt=r}function ba(e,r,a,o){us=wi=null,wd(r),ca=null,vl=0;var h=r.return;try{if(Mb(e,h,r,a,Ct)){dn=1,dc(e,Tr(a,e.current)),yt=null;return}}catch(m){if(h!==null)throw yt=h,m;dn=1,dc(e,Tr(a,e.current)),yt=null;return}r.flags&32768?(Tt||o===1?e=!0:ga||(Ct&536870912)!==0?e=!1:(Ws=e=!0,(o===2||o===9||o===3||o===6)&&(o=yr.current,o!==null&&o.tag===13&&(o.flags|=16384))),Ig(r,e)):_c(r)}function _c(e){var r=e;do{if((r.flags&32768)!==0){Ig(r,Ws);return}e=r.return;var a=Lb(r.alternate,r,bs);if(a!==null){yt=a;return}if(r=r.sibling,r!==null){yt=r;return}yt=r=e}while(r!==null);dn===0&&(dn=5)}function Ig(e,r){do{var a=Bb(e.alternate,e);if(a!==null){a.flags&=32767,yt=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!r&&(e=e.sibling,e!==null)){yt=e;return}yt=e=a}while(e!==null);dn=6,yt=null}function $g(e,r,a,o,h,m,b,R,Y){e.cancelPendingCommit=null;do Cc();while(kn!==0);if((zt&6)!==0)throw Error(l(327));if(r!==null){if(r===e.current)throw Error(l(177));if(m=r.lanes|r.childLanes,m|=Ku,gt(e,a,m,b,R,Y),e===Yt&&(yt=Yt=null,Ct=0),va=r,Zs=e,ws=a,nh=m,rh=h,Tg=o,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Wb(Rt,function(){return Gg(),null})):(e.callbackNode=null,e.callbackPriority=0),o=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||o){o=N.T,N.T=null,h=L.p,L.p=2,b=zt,zt|=4;try{Ib(e,r,a)}finally{zt=b,L.p=h,N.T=o}}kn=1,qg(),Pg(),Hg()}}function qg(){if(kn===1){kn=0;var e=Zs,r=va,a=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||a){a=N.T,N.T=null;var o=L.p;L.p=2;var h=zt;zt|=4;try{wg(r,e);var m=vh,b=Np(e.containerInfo),R=m.focusedElem,Y=m.selectionRange;if(b!==R&&R&&R.ownerDocument&&Ep(R.ownerDocument.documentElement,R)){if(Y!==null&&Hu(R)){var ue=Y.start,we=Y.end;if(we===void 0&&(we=ue),"selectionStart"in R)R.selectionStart=ue,R.selectionEnd=Math.min(we,R.value.length);else{var je=R.ownerDocument||document,pe=je&&je.defaultView||window;if(pe.getSelection){var ye=pe.getSelection(),qe=R.textContent.length,nt=Math.min(Y.start,qe),Vt=Y.end===void 0?nt:Math.min(Y.end,qe);!ye.extend&&nt>Vt&&(b=Vt,Vt=nt,nt=b);var se=Cp(R,nt),ee=Cp(R,Vt);if(se&&ee&&(ye.rangeCount!==1||ye.anchorNode!==se.node||ye.anchorOffset!==se.offset||ye.focusNode!==ee.node||ye.focusOffset!==ee.offset)){var ce=je.createRange();ce.setStart(se.node,se.offset),ye.removeAllRanges(),nt>Vt?(ye.addRange(ce),ye.extend(ee.node,ee.offset)):(ce.setEnd(ee.node,ee.offset),ye.addRange(ce))}}}}for(je=[],ye=R;ye=ye.parentNode;)ye.nodeType===1&&je.push({element:ye,left:ye.scrollLeft,top:ye.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<je.length;R++){var Se=je[R];Se.element.scrollLeft=Se.left,Se.element.scrollTop=Se.top}}Lc=!!yh,vh=yh=null}finally{zt=h,L.p=o,N.T=a}}e.current=r,kn=2}}function Pg(){if(kn===2){kn=0;var e=Zs,r=va,a=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||a){a=N.T,N.T=null;var o=L.p;L.p=2;var h=zt;zt|=4;try{gg(e,r.alternate,r)}finally{zt=h,L.p=o,N.T=a}}kn=3}}function Hg(){if(kn===4||kn===3){kn=0,wt();var e=Zs,r=va,a=ws,o=Tg;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?kn=5:(kn=0,va=Zs=null,Fg(e,e.pendingLanes));var h=e.pendingLanes;if(h===0&&(Js=null),ae(a),r=r.stateNode,Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(qn,r,void 0,(r.current.flags&128)===128)}catch{}if(o!==null){r=N.T,h=L.p,L.p=2,N.T=null;try{for(var m=e.onRecoverableError,b=0;b<o.length;b++){var R=o[b];m(R.value,{componentStack:R.stack})}}finally{N.T=r,L.p=h}}(ws&3)!==0&&Cc(),rs(e),h=e.pendingLanes,(a&261930)!==0&&(h&42)!==0?e===sh?zl++:(zl=0,sh=e):zl=0,Ul(0)}}function Fg(e,r){(e.pooledCacheLanes&=r)===0&&(r=e.pooledCache,r!=null&&(e.pooledCache=null,gl(r)))}function Cc(){return qg(),Pg(),Hg(),Gg()}function Gg(){if(kn!==5)return!1;var e=Zs,r=nh;nh=0;var a=ae(ws),o=N.T,h=L.p;try{L.p=32>a?32:a,N.T=null,a=rh,rh=null;var m=Zs,b=ws;if(kn=0,va=Zs=null,ws=0,(zt&6)!==0)throw Error(l(331));var R=zt;if(zt|=4,Eg(m.current),jg(m,m.current,b,a),zt=R,Ul(0,!1),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(qn,m)}catch{}return!0}finally{L.p=h,N.T=o,Fg(e,r)}}function Vg(e,r,a){r=Tr(a,r),r=Ud(e.stateNode,r,2),e=Vs(e,r,2),e!==null&&(kt(e,2),rs(e))}function Ht(e,r,a){if(e.tag===3)Vg(e,e,a);else for(;r!==null;){if(r.tag===3){Vg(r,e,a);break}else if(r.tag===1){var o=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(Js===null||!Js.has(o))){e=Tr(a,e),a=Ym(2),o=Vs(r,a,2),o!==null&&(Km(a,o,r,e),kt(o,2),rs(o));break}}r=r.return}}function lh(e,r,a){var o=e.pingCache;if(o===null){o=e.pingCache=new Pb;var h=new Set;o.set(r,h)}else h=o.get(r),h===void 0&&(h=new Set,o.set(r,h));h.has(a)||(Zd=!0,h.add(a),e=Yb.bind(null,e,r,a),r.then(e,e))}function Yb(e,r,a){var o=e.pingCache;o!==null&&o.delete(r),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,Yt===e&&(Ct&a)===a&&(dn===4||dn===3&&(Ct&62914560)===Ct&&300>St()-xc?(zt&2)===0&&xa(e,0):eh|=a,ya===Ct&&(ya=0)),rs(e)}function Yg(e,r){r===0&&(r=Ot()),e=vi(e,r),e!==null&&(kt(e,r),rs(e))}function Kb(e){var r=e.memoizedState,a=0;r!==null&&(a=r.retryLane),Yg(e,a)}function Qb(e,r){var a=0;switch(e.tag){case 31:case 13:var o=e.stateNode,h=e.memoizedState;h!==null&&(a=h.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(l(314))}o!==null&&o.delete(r),Yg(e,a)}function Wb(e,r){return mt(e,r)}var Ec=null,wa=null,oh=!1,Nc=!1,ch=!1,ti=0;function rs(e){e!==wa&&e.next===null&&(wa===null?Ec=wa=e:wa=wa.next=e),Nc=!0,oh||(oh=!0,Jb())}function Ul(e,r){if(!ch&&Nc){ch=!0;do for(var a=!1,o=Ec;o!==null;){if(e!==0){var h=o.pendingLanes;if(h===0)var m=0;else{var b=o.suspendedLanes,R=o.pingedLanes;m=(1<<31-ln(42|e)+1)-1,m&=h&~(b&~R),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(a=!0,Xg(o,m))}else m=Ct,m=Bt(o,o===Yt?m:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(m&3)===0||pn(o,m)||(a=!0,Xg(o,m));o=o.next}while(a);ch=!1}}function Xb(){Kg()}function Kg(){Nc=oh=!1;var e=0;ti!==0&&ow()&&(e=ti);for(var r=St(),a=null,o=Ec;o!==null;){var h=o.next,m=Qg(o,r);m===0?(o.next=null,a===null?Ec=h:a.next=h,h===null&&(wa=a)):(a=o,(e!==0||(m&3)!==0)&&(Nc=!0)),o=h}kn!==0&&kn!==5||Ul(e),ti!==0&&(ti=0)}function Qg(e,r){for(var a=e.suspendedLanes,o=e.pingedLanes,h=e.expirationTimes,m=e.pendingLanes&-62914561;0<m;){var b=31-ln(m),R=1<<b,Y=h[b];Y===-1?((R&a)===0||(R&o)!==0)&&(h[b]=cn(R,r)):Y<=r&&(e.expiredLanes|=R),m&=~R}if(r=Yt,a=Ct,a=Bt(e,e===r?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o=e.callbackNode,a===0||e===r&&(Pt===2||Pt===9)||e.cancelPendingCommit!==null)return o!==null&&o!==null&&et(o),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||pn(e,a)){if(r=a&-a,r===e.callbackPriority)return r;switch(o!==null&&et(o),ae(a)){case 2:case 8:a=ut;break;case 32:a=Rt;break;case 268435456:a=zn;break;default:a=Rt}return o=Wg.bind(null,e),a=mt(a,o),e.callbackPriority=r,e.callbackNode=a,r}return o!==null&&o!==null&&et(o),e.callbackPriority=2,e.callbackNode=null,2}function Wg(e,r){if(kn!==0&&kn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Cc()&&e.callbackNode!==a)return null;var o=Ct;return o=Bt(e,e===Yt?o:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),o===0?null:(kg(e,o,r),Qg(e,St()),e.callbackNode!=null&&e.callbackNode===a?Wg.bind(null,e):null)}function Xg(e,r){if(Cc())return null;kg(e,r,!0)}function Jb(){uw(function(){(zt&6)!==0?mt(lt,Xb):Kg()})}function uh(){if(ti===0){var e=aa;e===0&&(e=Un,Un<<=1,(Un&261888)===0&&(Un=256)),ti=e}return ti}function Jg(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ki(""+e)}function Zg(e,r){var a=r.ownerDocument.createElement("input");return a.name=r.name,a.value=r.value,e.id&&a.setAttribute("form",e.id),r.parentNode.insertBefore(a,r),e=new FormData(e),a.parentNode.removeChild(a),e}function Zb(e,r,a,o,h){if(r==="submit"&&a&&a.stateNode===h){var m=Jg((h[De]||null).action),b=o.submitter;b&&(r=(r=b[De]||null)?Jg(r.formAction):b.getAttribute("formAction"),r!==null&&(m=r,b=null));var R=new Jt("action","action",null,o,h);e.push({event:R,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(ti!==0){var Y=b?Zg(h,b):new FormData(h);Ad(a,{pending:!0,data:Y,method:h.method,action:m},null,Y)}}else typeof m=="function"&&(R.preventDefault(),Y=b?Zg(h,b):new FormData(h),Ad(a,{pending:!0,data:Y,method:h.method,action:m},m,Y))},currentTarget:h}]})}}for(var dh=0;dh<Yu.length;dh++){var hh=Yu[dh],ew=hh.toLowerCase(),tw=hh[0].toUpperCase()+hh.slice(1);Hr(ew,"on"+tw)}Hr(Ap,"onAnimationEnd"),Hr(kp,"onAnimationIteration"),Hr(Op,"onAnimationStart"),Hr("dblclick","onDoubleClick"),Hr("focusin","onFocus"),Hr("focusout","onBlur"),Hr(yb,"onTransitionRun"),Hr(vb,"onTransitionStart"),Hr(xb,"onTransitionCancel"),Hr(Dp,"onTransitionEnd"),qr("onMouseEnter",["mouseout","mouseover"]),qr("onMouseLeave",["mouseout","mouseover"]),qr("onPointerEnter",["pointerout","pointerover"]),qr("onPointerLeave",["pointerout","pointerover"]),pr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pr("onBeforeInput",["compositionend","keypress","textInput","paste"]),pr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ll="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ll));function ey(e,r){r=(r&4)!==0;for(var a=0;a<e.length;a++){var o=e[a],h=o.event;o=o.listeners;e:{var m=void 0;if(r)for(var b=o.length-1;0<=b;b--){var R=o[b],Y=R.instance,ue=R.currentTarget;if(R=R.listener,Y!==m&&h.isPropagationStopped())break e;m=R,h.currentTarget=ue;try{m(h)}catch(we){Po(we)}h.currentTarget=null,m=Y}else for(b=0;b<o.length;b++){if(R=o[b],Y=R.instance,ue=R.currentTarget,R=R.listener,Y!==m&&h.isPropagationStopped())break e;m=R,h.currentTarget=ue;try{m(h)}catch(we){Po(we)}h.currentTarget=null,m=Y}}}}function vt(e,r){var a=r[pt];a===void 0&&(a=r[pt]=new Set);var o=e+"__bubble";a.has(o)||(ty(r,e,2,!1),a.add(o))}function fh(e,r,a){var o=0;r&&(o|=4),ty(a,e,o,r)}var Rc="_reactListening"+Math.random().toString(36).slice(2);function ph(e){if(!e[Rc]){e[Rc]=!0,Os.forEach(function(a){a!=="selectionchange"&&(nw.has(a)||fh(a,!1,e),fh(a,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[Rc]||(r[Rc]=!0,fh("selectionchange",!1,r))}}function ty(e,r,a,o){switch(Ay(r)){case 2:var h=Aw;break;case 8:h=kw;break;default:h=Th}a=h.bind(null,r,a,e),h=void 0,!ve||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(h=!0),o?h!==void 0?e.addEventListener(r,a,{capture:!0,passive:h}):e.addEventListener(r,a,!0):h!==void 0?e.addEventListener(r,a,{passive:h}):e.addEventListener(r,a,!1)}function mh(e,r,a,o,h){var m=o;if((r&1)===0&&(r&2)===0&&o!==null)e:for(;;){if(o===null)return;var b=o.tag;if(b===3||b===4){var R=o.stateNode.containerInfo;if(R===h)break;if(b===4)for(b=o.return;b!==null;){var Y=b.tag;if((Y===3||Y===4)&&b.stateNode.containerInfo===h)return;b=b.return}for(;R!==null;){if(b=An(R),b===null)return;if(Y=b.tag,Y===5||Y===6||Y===26||Y===27){o=m=b;continue e}R=R.parentNode}}o=o.return}O(function(){var ue=m,we=ll(a),je=[];e:{var pe=Mp.get(e);if(pe!==void 0){var ye=Jt,qe=e;switch(e){case"keypress":if(He(a)===0)break e;case"keydown":case"keyup":ye=Qx;break;case"focusin":qe="focus",ye=Wn;break;case"focusout":qe="blur",ye=Wn;break;case"beforeblur":case"afterblur":ye=Wn;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ye=Qt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ye=wn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ye=Jx;break;case Ap:case kp:case Op:ye=as;break;case Dp:ye=eb;break;case"scroll":case"scrollend":ye=Bs;break;case"wheel":ye=nb;break;case"copy":case"cut":case"paste":ye=Is;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ye=dp;break;case"toggle":case"beforetoggle":ye=sb}var nt=(r&4)!==0,Vt=!nt&&(e==="scroll"||e==="scrollend"),se=nt?pe!==null?pe+"Capture":null:pe;nt=[];for(var ee=ue,ce;ee!==null;){var Se=ee;if(ce=Se.stateNode,Se=Se.tag,Se!==5&&Se!==26&&Se!==27||ce===null||se===null||(Se=Z(ee,se),Se!=null&&nt.push(Bl(ee,Se,ce))),Vt)break;ee=ee.return}0<nt.length&&(pe=new ye(pe,qe,null,a,we),je.push({event:pe,listeners:nt}))}}if((r&7)===0){e:{if(pe=e==="mouseover"||e==="pointerover",ye=e==="mouseout"||e==="pointerout",pe&&a!==al&&(qe=a.relatedTarget||a.fromElement)&&(An(qe)||qe[rt]))break e;if((ye||pe)&&(pe=we.window===we?we:(pe=we.ownerDocument)?pe.defaultView||pe.parentWindow:window,ye?(qe=a.relatedTarget||a.toElement,ye=ue,qe=qe?An(qe):null,qe!==null&&(Vt=u(qe),nt=qe.tag,qe!==Vt||nt!==5&&nt!==27&&nt!==6)&&(qe=null)):(ye=null,qe=ue),ye!==qe)){if(nt=Qt,Se="onMouseLeave",se="onMouseEnter",ee="mouse",(e==="pointerout"||e==="pointerover")&&(nt=dp,Se="onPointerLeave",se="onPointerEnter",ee="pointer"),Vt=ye==null?pe:Nr(ye),ce=qe==null?pe:Nr(qe),pe=new nt(Se,ee+"leave",ye,a,we),pe.target=Vt,pe.relatedTarget=ce,Se=null,An(we)===ue&&(nt=new nt(se,ee+"enter",qe,a,we),nt.target=ce,nt.relatedTarget=Vt,Se=nt),Vt=Se,ye&&qe)t:{for(nt=rw,se=ye,ee=qe,ce=0,Se=se;Se;Se=nt(Se))ce++;Se=0;for(var We=ee;We;We=nt(We))Se++;for(;0<ce-Se;)se=nt(se),ce--;for(;0<Se-ce;)ee=nt(ee),Se--;for(;ce--;){if(se===ee||ee!==null&&se===ee.alternate){nt=se;break t}se=nt(se),ee=nt(ee)}nt=null}else nt=null;ye!==null&&ny(je,pe,ye,nt,!1),qe!==null&&Vt!==null&&ny(je,Vt,qe,nt,!0)}}e:{if(pe=ue?Nr(ue):window,ye=pe.nodeName&&pe.nodeName.toLowerCase(),ye==="select"||ye==="input"&&pe.type==="file")var Dt=xp;else if(yp(pe))if(bp)Dt=pb;else{Dt=hb;var Ge=db}else ye=pe.nodeName,!ye||ye.toLowerCase()!=="input"||pe.type!=="checkbox"&&pe.type!=="radio"?ue&&Yi(ue.elementType)&&(Dt=xp):Dt=fb;if(Dt&&(Dt=Dt(e,ue))){vp(je,Dt,a,we);break e}Ge&&Ge(e,pe,ue),e==="focusout"&&ue&&pe.type==="number"&&ue.memoizedProps.value!=null&&il(pe,"number",pe.value)}switch(Ge=ue?Nr(ue):window,e){case"focusin":(yp(Ge)||Ge.contentEditable==="true")&&(Ji=Ge,Fu=ue,fl=null);break;case"focusout":fl=Fu=Ji=null;break;case"mousedown":Gu=!0;break;case"contextmenu":case"mouseup":case"dragend":Gu=!1,Rp(je,a,we);break;case"selectionchange":if(gb)break;case"keydown":case"keyup":Rp(je,a,we)}var ft;if($u)e:{switch(e){case"compositionstart":var Et="onCompositionStart";break e;case"compositionend":Et="onCompositionEnd";break e;case"compositionupdate":Et="onCompositionUpdate";break e}Et=void 0}else Xi?mp(e,a)&&(Et="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Et="onCompositionStart");Et&&(hp&&a.locale!=="ko"&&(Xi||Et!=="onCompositionStart"?Et==="onCompositionEnd"&&Xi&&(ft=Le()):(Ee=we,ke="value"in Ee?Ee.value:Ee.textContent,Xi=!0)),Ge=Tc(ue,Et),0<Ge.length&&(Et=new Bu(Et,e,null,a,we),je.push({event:Et,listeners:Ge}),ft?Et.data=ft:(ft=gp(a),ft!==null&&(Et.data=ft)))),(ft=ab?lb(e,a):ob(e,a))&&(Et=Tc(ue,"onBeforeInput"),0<Et.length&&(Ge=new Bu("onBeforeInput","beforeinput",null,a,we),je.push({event:Ge,listeners:Et}),Ge.data=ft)),Zb(je,e,ue,a,we)}ey(je,r)})}function Bl(e,r,a){return{instance:e,listener:r,currentTarget:a}}function Tc(e,r){for(var a=r+"Capture",o=[];e!==null;){var h=e,m=h.stateNode;if(h=h.tag,h!==5&&h!==26&&h!==27||m===null||(h=Z(e,a),h!=null&&o.unshift(Bl(e,h,m)),h=Z(e,r),h!=null&&o.push(Bl(e,h,m))),e.tag===3)return o;e=e.return}return[]}function rw(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function ny(e,r,a,o,h){for(var m=r._reactName,b=[];a!==null&&a!==o;){var R=a,Y=R.alternate,ue=R.stateNode;if(R=R.tag,Y!==null&&Y===o)break;R!==5&&R!==26&&R!==27||ue===null||(Y=ue,h?(ue=Z(a,m),ue!=null&&b.unshift(Bl(a,ue,Y))):h||(ue=Z(a,m),ue!=null&&b.push(Bl(a,ue,Y)))),a=a.return}b.length!==0&&e.push({event:r,listeners:b})}var sw=/\r\n?/g,iw=/\u0000|\uFFFD/g;function ry(e){return(typeof e=="string"?e:""+e).replace(sw,`
`).replace(iw,"")}function sy(e,r){return r=ry(r),ry(e)===r}function Gt(e,r,a,o,h,m){switch(a){case"children":typeof o=="string"?r==="body"||r==="textarea"&&o===""||is(e,o):(typeof o=="number"||typeof o=="bigint")&&r!=="body"&&is(e,""+o);break;case"className":Ds(e,"class",o);break;case"tabIndex":Ds(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":Ds(e,a,o);break;case"style":Io(e,o,m);break;case"data":if(r!=="object"){Ds(e,"data",o);break}case"src":case"href":if(o===""&&(r!=="a"||a!=="href")){e.removeAttribute(a);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(a);break}o=Ki(""+o),e.setAttribute(a,o);break;case"action":case"formAction":if(typeof o=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(a==="formAction"?(r!=="input"&&Gt(e,r,"name",h.name,h,null),Gt(e,r,"formEncType",h.formEncType,h,null),Gt(e,r,"formMethod",h.formMethod,h,null),Gt(e,r,"formTarget",h.formTarget,h,null)):(Gt(e,r,"encType",h.encType,h,null),Gt(e,r,"method",h.method,h,null),Gt(e,r,"target",h.target,h,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){e.removeAttribute(a);break}o=Ki(""+o),e.setAttribute(a,o);break;case"onClick":o!=null&&(e.onclick=Pr);break;case"onScroll":o!=null&&vt("scroll",e);break;case"onScrollEnd":o!=null&&vt("scrollend",e);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(l(61));if(a=o.__html,a!=null){if(h.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"multiple":e.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":e.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){e.removeAttribute("xlink:href");break}a=Ki(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,""+o):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":o===!0?e.setAttribute(a,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?e.setAttribute(a,o):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?e.setAttribute(a,o):e.removeAttribute(a);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?e.removeAttribute(a):e.setAttribute(a,o);break;case"popover":vt("beforetoggle",e),vt("toggle",e),Gi(e,"popover",o);break;case"xlinkActuate":ar(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":ar(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":ar(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":ar(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":ar(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":ar(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":ar(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":ar(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":ar(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":Gi(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Lu.get(a)||a,Gi(e,a,o))}}function gh(e,r,a,o,h,m){switch(a){case"style":Io(e,o,m);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(l(61));if(a=o.__html,a!=null){if(h.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"children":typeof o=="string"?is(e,o):(typeof o=="number"||typeof o=="bigint")&&is(e,""+o);break;case"onScroll":o!=null&&vt("scroll",e);break;case"onScrollEnd":o!=null&&vt("scrollend",e);break;case"onClick":o!=null&&(e.onclick=Pr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!er.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(h=a.endsWith("Capture"),r=a.slice(2,h?a.length-7:void 0),m=e[De]||null,m=m!=null?m[a]:null,typeof m=="function"&&e.removeEventListener(r,m,h),typeof o=="function")){typeof m!="function"&&m!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(r,o,h);break e}a in e?e[a]=o:o===!0?e.setAttribute(a,""):Gi(e,a,o)}}}function Vn(e,r,a){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":vt("error",e),vt("load",e);var o=!1,h=!1,m;for(m in a)if(a.hasOwnProperty(m)){var b=a[m];if(b!=null)switch(m){case"src":o=!0;break;case"srcSet":h=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:Gt(e,r,m,b,a,null)}}h&&Gt(e,r,"srcSet",a.srcSet,a,null),o&&Gt(e,r,"src",a.src,a,null);return;case"input":vt("invalid",e);var R=m=b=h=null,Y=null,ue=null;for(o in a)if(a.hasOwnProperty(o)){var we=a[o];if(we!=null)switch(o){case"name":h=we;break;case"type":b=we;break;case"checked":Y=we;break;case"defaultChecked":ue=we;break;case"value":m=we;break;case"defaultValue":R=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(l(137,r));break;default:Gt(e,r,o,we,a,null)}}Ms(e,m,R,Y,ue,b,h,!1);return;case"select":vt("invalid",e),o=b=m=null;for(h in a)if(a.hasOwnProperty(h)&&(R=a[h],R!=null))switch(h){case"value":m=R;break;case"defaultValue":b=R;break;case"multiple":o=R;default:Gt(e,r,h,R,a,null)}r=m,a=b,e.multiple=!!o,r!=null?zs(e,!!o,r,!1):a!=null&&zs(e,!!o,a,!0);return;case"textarea":vt("invalid",e),m=h=o=null;for(b in a)if(a.hasOwnProperty(b)&&(R=a[b],R!=null))switch(b){case"value":o=R;break;case"defaultValue":h=R;break;case"children":m=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(l(91));break;default:Gt(e,r,b,R,a,null)}Uo(e,o,h,m);return;case"option":for(Y in a)a.hasOwnProperty(Y)&&(o=a[Y],o!=null)&&(Y==="selected"?e.selected=o&&typeof o!="function"&&typeof o!="symbol":Gt(e,r,Y,o,a,null));return;case"dialog":vt("beforetoggle",e),vt("toggle",e),vt("cancel",e),vt("close",e);break;case"iframe":case"object":vt("load",e);break;case"video":case"audio":for(o=0;o<Ll.length;o++)vt(Ll[o],e);break;case"image":vt("error",e),vt("load",e);break;case"details":vt("toggle",e);break;case"embed":case"source":case"link":vt("error",e),vt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ue in a)if(a.hasOwnProperty(ue)&&(o=a[ue],o!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:Gt(e,r,ue,o,a,null)}return;default:if(Yi(r)){for(we in a)a.hasOwnProperty(we)&&(o=a[we],o!==void 0&&gh(e,r,we,o,a,void 0));return}}for(R in a)a.hasOwnProperty(R)&&(o=a[R],o!=null&&Gt(e,r,R,o,a,null))}function aw(e,r,a,o){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var h=null,m=null,b=null,R=null,Y=null,ue=null,we=null;for(ye in a){var je=a[ye];if(a.hasOwnProperty(ye)&&je!=null)switch(ye){case"checked":break;case"value":break;case"defaultValue":Y=je;default:o.hasOwnProperty(ye)||Gt(e,r,ye,null,o,je)}}for(var pe in o){var ye=o[pe];if(je=a[pe],o.hasOwnProperty(pe)&&(ye!=null||je!=null))switch(pe){case"type":m=ye;break;case"name":h=ye;break;case"checked":ue=ye;break;case"defaultChecked":we=ye;break;case"value":b=ye;break;case"defaultValue":R=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(l(137,r));break;default:ye!==je&&Gt(e,r,pe,ye,o,je)}}sl(e,b,R,Y,ue,we,m,h);return;case"select":ye=b=R=pe=null;for(m in a)if(Y=a[m],a.hasOwnProperty(m)&&Y!=null)switch(m){case"value":break;case"multiple":ye=Y;default:o.hasOwnProperty(m)||Gt(e,r,m,null,o,Y)}for(h in o)if(m=o[h],Y=a[h],o.hasOwnProperty(h)&&(m!=null||Y!=null))switch(h){case"value":pe=m;break;case"defaultValue":R=m;break;case"multiple":b=m;default:m!==Y&&Gt(e,r,h,m,o,Y)}r=R,a=b,o=ye,pe!=null?zs(e,!!a,pe,!1):!!o!=!!a&&(r!=null?zs(e,!!a,r,!0):zs(e,!!a,a?[]:"",!1));return;case"textarea":ye=pe=null;for(R in a)if(h=a[R],a.hasOwnProperty(R)&&h!=null&&!o.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:Gt(e,r,R,null,o,h)}for(b in o)if(h=o[b],m=a[b],o.hasOwnProperty(b)&&(h!=null||m!=null))switch(b){case"value":pe=h;break;case"defaultValue":ye=h;break;case"children":break;case"dangerouslySetInnerHTML":if(h!=null)throw Error(l(91));break;default:h!==m&&Gt(e,r,b,h,o,m)}zo(e,pe,ye);return;case"option":for(var qe in a)pe=a[qe],a.hasOwnProperty(qe)&&pe!=null&&!o.hasOwnProperty(qe)&&(qe==="selected"?e.selected=!1:Gt(e,r,qe,null,o,pe));for(Y in o)pe=o[Y],ye=a[Y],o.hasOwnProperty(Y)&&pe!==ye&&(pe!=null||ye!=null)&&(Y==="selected"?e.selected=pe&&typeof pe!="function"&&typeof pe!="symbol":Gt(e,r,Y,pe,o,ye));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var nt in a)pe=a[nt],a.hasOwnProperty(nt)&&pe!=null&&!o.hasOwnProperty(nt)&&Gt(e,r,nt,null,o,pe);for(ue in o)if(pe=o[ue],ye=a[ue],o.hasOwnProperty(ue)&&pe!==ye&&(pe!=null||ye!=null))switch(ue){case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(l(137,r));break;default:Gt(e,r,ue,pe,o,ye)}return;default:if(Yi(r)){for(var Vt in a)pe=a[Vt],a.hasOwnProperty(Vt)&&pe!==void 0&&!o.hasOwnProperty(Vt)&&gh(e,r,Vt,void 0,o,pe);for(we in o)pe=o[we],ye=a[we],!o.hasOwnProperty(we)||pe===ye||pe===void 0&&ye===void 0||gh(e,r,we,pe,o,ye);return}}for(var se in a)pe=a[se],a.hasOwnProperty(se)&&pe!=null&&!o.hasOwnProperty(se)&&Gt(e,r,se,null,o,pe);for(je in o)pe=o[je],ye=a[je],!o.hasOwnProperty(je)||pe===ye||pe==null&&ye==null||Gt(e,r,je,pe,o,ye)}function iy(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function lw(){if(typeof performance.getEntriesByType=="function"){for(var e=0,r=0,a=performance.getEntriesByType("resource"),o=0;o<a.length;o++){var h=a[o],m=h.transferSize,b=h.initiatorType,R=h.duration;if(m&&R&&iy(b)){for(b=0,R=h.responseEnd,o+=1;o<a.length;o++){var Y=a[o],ue=Y.startTime;if(ue>R)break;var we=Y.transferSize,je=Y.initiatorType;we&&iy(je)&&(Y=Y.responseEnd,b+=we*(Y<R?1:(R-ue)/(Y-ue)))}if(--o,r+=8*(m+b)/(h.duration/1e3),e++,10<e)break}}if(0<e)return r/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var yh=null,vh=null;function Ac(e){return e.nodeType===9?e:e.ownerDocument}function ay(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ly(e,r){if(e===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&r==="foreignObject"?0:e}function xh(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var bh=null;function ow(){var e=window.event;return e&&e.type==="popstate"?e===bh?!1:(bh=e,!0):(bh=null,!1)}var oy=typeof setTimeout=="function"?setTimeout:void 0,cw=typeof clearTimeout=="function"?clearTimeout:void 0,cy=typeof Promise=="function"?Promise:void 0,uw=typeof queueMicrotask=="function"?queueMicrotask:typeof cy<"u"?function(e){return cy.resolve(null).then(e).catch(dw)}:oy;function dw(e){setTimeout(function(){throw e})}function ni(e){return e==="head"}function uy(e,r){var a=r,o=0;do{var h=a.nextSibling;if(e.removeChild(a),h&&h.nodeType===8)if(a=h.data,a==="/$"||a==="/&"){if(o===0){e.removeChild(h),Ca(r);return}o--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")o++;else if(a==="html")Il(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,Il(a);for(var m=a.firstChild;m;){var b=m.nextSibling,R=m.nodeName;m[It]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&m.rel.toLowerCase()==="stylesheet"||a.removeChild(m),m=b}}else a==="body"&&Il(e.ownerDocument.body);a=h}while(a);Ca(r)}function dy(e,r){var a=e;e=0;do{var o=a.nextSibling;if(a.nodeType===1?r?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(r?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),o&&o.nodeType===8)if(a=o.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=o}while(a)}function wh(e){var r=e.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var a=r;switch(r=r.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":wh(a),sr(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function hw(e,r,a,o){for(;e.nodeType===1;){var h=a;if(e.nodeName.toLowerCase()!==r.toLowerCase()){if(!o&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(o){if(!e[It])switch(r){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(m=e.getAttribute("rel"),m==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(m!==h.rel||e.getAttribute("href")!==(h.href==null||h.href===""?null:h.href)||e.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin)||e.getAttribute("title")!==(h.title==null?null:h.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(m=e.getAttribute("src"),(m!==(h.src==null?null:h.src)||e.getAttribute("type")!==(h.type==null?null:h.type)||e.getAttribute("crossorigin")!==(h.crossOrigin==null?null:h.crossOrigin))&&m&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(r==="input"&&e.type==="hidden"){var m=h.name==null?null:""+h.name;if(h.type==="hidden"&&e.getAttribute("name")===m)return e}else return e;if(e=Mr(e.nextSibling),e===null)break}return null}function fw(e,r,a){if(r==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=Mr(e.nextSibling),e===null))return null;return e}function hy(e,r){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=Mr(e.nextSibling),e===null))return null;return e}function Sh(e){return e.data==="$?"||e.data==="$~"}function jh(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function pw(e,r){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=r;else if(e.data!=="$?"||a.readyState!=="loading")r();else{var o=function(){r(),a.removeEventListener("DOMContentLoaded",o)};a.addEventListener("DOMContentLoaded",o),e._reactRetry=o}}function Mr(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return e}var _h=null;function fy(e){e=e.nextSibling;for(var r=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(r===0)return Mr(e.nextSibling);r--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||r++}e=e.nextSibling}return null}function py(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(r===0)return e;r--}else a!=="/$"&&a!=="/&"||r++}e=e.previousSibling}return null}function my(e,r,a){switch(r=Ac(a),e){case"html":if(e=r.documentElement,!e)throw Error(l(452));return e;case"head":if(e=r.head,!e)throw Error(l(453));return e;case"body":if(e=r.body,!e)throw Error(l(454));return e;default:throw Error(l(451))}}function Il(e){for(var r=e.attributes;r.length;)e.removeAttributeNode(r[0]);sr(e)}var zr=new Map,gy=new Set;function kc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ss=L.d;L.d={f:mw,r:gw,D:yw,C:vw,L:xw,m:bw,X:Sw,S:ww,M:jw};function mw(){var e=Ss.f(),r=Sc();return e||r}function gw(e){var r=$t(e);r!==null&&r.tag===5&&r.type==="form"?Dm(r):Ss.r(e)}var Sa=typeof document>"u"?null:document;function yy(e,r,a){var o=Sa;if(o&&typeof r=="string"&&r){var h=lr(r);h='link[rel="'+e+'"][href="'+h+'"]',typeof a=="string"&&(h+='[crossorigin="'+a+'"]'),gy.has(h)||(gy.add(h),e={rel:e,crossOrigin:a,href:r},o.querySelector(h)===null&&(r=o.createElement("link"),Vn(r,"link",e),qt(r),o.head.appendChild(r)))}}function yw(e){Ss.D(e),yy("dns-prefetch",e,null)}function vw(e,r){Ss.C(e,r),yy("preconnect",e,r)}function xw(e,r,a){Ss.L(e,r,a);var o=Sa;if(o&&e&&r){var h='link[rel="preload"][as="'+lr(r)+'"]';r==="image"&&a&&a.imageSrcSet?(h+='[imagesrcset="'+lr(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(h+='[imagesizes="'+lr(a.imageSizes)+'"]')):h+='[href="'+lr(e)+'"]';var m=h;switch(r){case"style":m=ja(e);break;case"script":m=_a(e)}zr.has(m)||(e=v({rel:"preload",href:r==="image"&&a&&a.imageSrcSet?void 0:e,as:r},a),zr.set(m,e),o.querySelector(h)!==null||r==="style"&&o.querySelector($l(m))||r==="script"&&o.querySelector(ql(m))||(r=o.createElement("link"),Vn(r,"link",e),qt(r),o.head.appendChild(r)))}}function bw(e,r){Ss.m(e,r);var a=Sa;if(a&&e){var o=r&&typeof r.as=="string"?r.as:"script",h='link[rel="modulepreload"][as="'+lr(o)+'"][href="'+lr(e)+'"]',m=h;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=_a(e)}if(!zr.has(m)&&(e=v({rel:"modulepreload",href:e},r),zr.set(m,e),a.querySelector(h)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(ql(m)))return}o=a.createElement("link"),Vn(o,"link",e),qt(o),a.head.appendChild(o)}}}function ww(e,r,a){Ss.S(e,r,a);var o=Sa;if(o&&e){var h=ir(o).hoistableStyles,m=ja(e);r=r||"default";var b=h.get(m);if(!b){var R={loading:0,preload:null};if(b=o.querySelector($l(m)))R.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":r},a),(a=zr.get(m))&&Ch(e,a);var Y=b=o.createElement("link");qt(Y),Vn(Y,"link",e),Y._p=new Promise(function(ue,we){Y.onload=ue,Y.onerror=we}),Y.addEventListener("load",function(){R.loading|=1}),Y.addEventListener("error",function(){R.loading|=2}),R.loading|=4,Oc(b,r,o)}b={type:"stylesheet",instance:b,count:1,state:R},h.set(m,b)}}}function Sw(e,r){Ss.X(e,r);var a=Sa;if(a&&e){var o=ir(a).hoistableScripts,h=_a(e),m=o.get(h);m||(m=a.querySelector(ql(h)),m||(e=v({src:e,async:!0},r),(r=zr.get(h))&&Eh(e,r),m=a.createElement("script"),qt(m),Vn(m,"link",e),a.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},o.set(h,m))}}function jw(e,r){Ss.M(e,r);var a=Sa;if(a&&e){var o=ir(a).hoistableScripts,h=_a(e),m=o.get(h);m||(m=a.querySelector(ql(h)),m||(e=v({src:e,async:!0,type:"module"},r),(r=zr.get(h))&&Eh(e,r),m=a.createElement("script"),qt(m),Vn(m,"link",e),a.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},o.set(h,m))}}function vy(e,r,a,o){var h=(h=fe.current)?kc(h):null;if(!h)throw Error(l(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(r=ja(a.href),a=ir(h).hoistableStyles,o=a.get(r),o||(o={type:"style",instance:null,count:0,state:null},a.set(r,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=ja(a.href);var m=ir(h).hoistableStyles,b=m.get(e);if(b||(h=h.ownerDocument||h,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(e,b),(m=h.querySelector($l(e)))&&!m._p&&(b.instance=m,b.state.loading=5),zr.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},zr.set(e,a),m||_w(h,e,a,b.state))),r&&o===null)throw Error(l(528,""));return b}if(r&&o!==null)throw Error(l(529,""));return null;case"script":return r=a.async,a=a.src,typeof a=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=_a(a),a=ir(h).hoistableScripts,o=a.get(r),o||(o={type:"script",instance:null,count:0,state:null},a.set(r,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,e))}}function ja(e){return'href="'+lr(e)+'"'}function $l(e){return'link[rel="stylesheet"]['+e+"]"}function xy(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function _w(e,r,a,o){e.querySelector('link[rel="preload"][as="style"]['+r+"]")?o.loading=1:(r=e.createElement("link"),o.preload=r,r.addEventListener("load",function(){return o.loading|=1}),r.addEventListener("error",function(){return o.loading|=2}),Vn(r,"link",a),qt(r),e.head.appendChild(r))}function _a(e){return'[src="'+lr(e)+'"]'}function ql(e){return"script[async]"+e}function by(e,r,a){if(r.count++,r.instance===null)switch(r.type){case"style":var o=e.querySelector('style[data-href~="'+lr(a.href)+'"]');if(o)return r.instance=o,qt(o),o;var h=v({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return o=(e.ownerDocument||e).createElement("style"),qt(o),Vn(o,"style",h),Oc(o,a.precedence,e),r.instance=o;case"stylesheet":h=ja(a.href);var m=e.querySelector($l(h));if(m)return r.state.loading|=4,r.instance=m,qt(m),m;o=xy(a),(h=zr.get(h))&&Ch(o,h),m=(e.ownerDocument||e).createElement("link"),qt(m);var b=m;return b._p=new Promise(function(R,Y){b.onload=R,b.onerror=Y}),Vn(m,"link",o),r.state.loading|=4,Oc(m,a.precedence,e),r.instance=m;case"script":return m=_a(a.src),(h=e.querySelector(ql(m)))?(r.instance=h,qt(h),h):(o=a,(h=zr.get(m))&&(o=v({},a),Eh(o,h)),e=e.ownerDocument||e,h=e.createElement("script"),qt(h),Vn(h,"link",o),e.head.appendChild(h),r.instance=h);case"void":return null;default:throw Error(l(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(o=r.instance,r.state.loading|=4,Oc(o,a.precedence,e));return r.instance}function Oc(e,r,a){for(var o=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),h=o.length?o[o.length-1]:null,m=h,b=0;b<o.length;b++){var R=o[b];if(R.dataset.precedence===r)m=R;else if(m!==h)break}m?m.parentNode.insertBefore(e,m.nextSibling):(r=a.nodeType===9?a.head:a,r.insertBefore(e,r.firstChild))}function Ch(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.title==null&&(e.title=r.title)}function Eh(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.integrity==null&&(e.integrity=r.integrity)}var Dc=null;function wy(e,r,a){if(Dc===null){var o=new Map,h=Dc=new Map;h.set(a,o)}else h=Dc,o=h.get(a),o||(o=new Map,h.set(a,o));if(o.has(e))return o;for(o.set(e,null),a=a.getElementsByTagName(e),h=0;h<a.length;h++){var m=a[h];if(!(m[It]||m[Oe]||e==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var b=m.getAttribute(r)||"";b=e+b;var R=o.get(b);R?R.push(m):o.set(b,[m])}}return o}function Sy(e,r,a){e=e.ownerDocument||e,e.head.insertBefore(a,r==="title"?e.querySelector("head > title"):null)}function Cw(e,r,a){if(a===1||r.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(e=r.disabled,typeof r.precedence=="string"&&e==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function jy(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function Ew(e,r,a,o){if(a.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var h=ja(o.href),m=r.querySelector($l(h));if(m){r=m._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(e.count++,e=Mc.bind(e),r.then(e,e)),a.state.loading|=4,a.instance=m,qt(m);return}m=r.ownerDocument||r,o=xy(o),(h=zr.get(h))&&Ch(o,h),m=m.createElement("link"),qt(m);var b=m;b._p=new Promise(function(R,Y){b.onload=R,b.onerror=Y}),Vn(m,"link",o),a.instance=m}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,r),(r=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=Mc.bind(e),r.addEventListener("load",a),r.addEventListener("error",a))}}var Nh=0;function Nw(e,r){return e.stylesheets&&e.count===0&&Uc(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var o=setTimeout(function(){if(e.stylesheets&&Uc(e,e.stylesheets),e.unsuspend){var m=e.unsuspend;e.unsuspend=null,m()}},6e4+r);0<e.imgBytes&&Nh===0&&(Nh=62500*lw());var h=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Uc(e,e.stylesheets),e.unsuspend)){var m=e.unsuspend;e.unsuspend=null,m()}},(e.imgBytes>Nh?50:800)+r);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(o),clearTimeout(h)}}:null}function Mc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Uc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var zc=null;function Uc(e,r){e.stylesheets=null,e.unsuspend!==null&&(e.count++,zc=new Map,r.forEach(Rw,e),zc=null,Mc.call(e))}function Rw(e,r){if(!(r.state.loading&4)){var a=zc.get(e);if(a)var o=a.get(null);else{a=new Map,zc.set(e,a);for(var h=e.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<h.length;m++){var b=h[m];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(a.set(b.dataset.precedence,b),o=b)}o&&a.set(null,o)}h=r.instance,b=h.getAttribute("data-precedence"),m=a.get(b)||o,m===o&&a.set(null,h),a.set(b,h),this.count++,o=Mc.bind(this),h.addEventListener("load",o),h.addEventListener("error",o),m?m.parentNode.insertBefore(h,m.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(h,e.firstChild)),r.state.loading|=4}}var Pl={$$typeof:B,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function Tw(e,r,a,o,h,m,b,R,Y){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=mn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mn(0),this.hiddenUpdates=mn(null),this.identifierPrefix=o,this.onUncaughtError=h,this.onCaughtError=m,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Y,this.incompleteTransitions=new Map}function _y(e,r,a,o,h,m,b,R,Y,ue,we,je){return e=new Tw(e,r,a,b,Y,ue,we,je,R),r=1,m===!0&&(r|=24),m=gr(3,null,null,r),e.current=m,m.stateNode=e,r=ad(),r.refCount++,e.pooledCache=r,r.refCount++,m.memoizedState={element:o,isDehydrated:a,cache:r},ud(m),e}function Cy(e){return e?(e=ta,e):ta}function Ey(e,r,a,o,h,m){h=Cy(h),o.context===null?o.context=h:o.pendingContext=h,o=Gs(r),o.payload={element:a},m=m===void 0?null:m,m!==null&&(o.callback=m),a=Vs(e,o,r),a!==null&&(hr(a,e,r),bl(a,e,r))}function Ny(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<r?a:r}}function Rh(e,r){Ny(e,r),(e=e.alternate)&&Ny(e,r)}function Ry(e){if(e.tag===13||e.tag===31){var r=vi(e,67108864);r!==null&&hr(r,e,67108864),Rh(e,67108864)}}function Ty(e){if(e.tag===13||e.tag===31){var r=wr();r=re(r);var a=vi(e,r);a!==null&&hr(a,e,r),Rh(e,r)}}var Lc=!0;function Aw(e,r,a,o){var h=N.T;N.T=null;var m=L.p;try{L.p=2,Th(e,r,a,o)}finally{L.p=m,N.T=h}}function kw(e,r,a,o){var h=N.T;N.T=null;var m=L.p;try{L.p=8,Th(e,r,a,o)}finally{L.p=m,N.T=h}}function Th(e,r,a,o){if(Lc){var h=Ah(o);if(h===null)mh(e,r,o,Bc,a),ky(e,o);else if(Dw(h,e,r,a,o))o.stopPropagation();else if(ky(e,o),r&4&&-1<Ow.indexOf(e)){for(;h!==null;){var m=$t(h);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var b=Je(m.pendingLanes);if(b!==0){var R=m;for(R.pendingLanes|=2,R.entangledLanes|=2;b;){var Y=1<<31-ln(b);R.entanglements[1]|=Y,b&=~Y}rs(m),(zt&6)===0&&(bc=St()+500,Ul(0))}}break;case 31:case 13:R=vi(m,2),R!==null&&hr(R,m,2),Sc(),Rh(m,2)}if(m=Ah(o),m===null&&mh(e,r,o,Bc,a),m===h)break;h=m}h!==null&&o.stopPropagation()}else mh(e,r,o,null,a)}}function Ah(e){return e=ll(e),kh(e)}var Bc=null;function kh(e){if(Bc=null,e=An(e),e!==null){var r=u(e);if(r===null)e=null;else{var a=r.tag;if(a===13){if(e=d(r),e!==null)return e;e=null}else if(a===31){if(e=f(r),e!==null)return e;e=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null)}}return Bc=e,null}function Ay(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(jt()){case lt:return 2;case ut:return 8;case Rt:case Tn:return 32;case zn:return 268435456;default:return 32}default:return 32}}var Oh=!1,ri=null,si=null,ii=null,Hl=new Map,Fl=new Map,ai=[],Ow="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ky(e,r){switch(e){case"focusin":case"focusout":ri=null;break;case"dragenter":case"dragleave":si=null;break;case"mouseover":case"mouseout":ii=null;break;case"pointerover":case"pointerout":Hl.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fl.delete(r.pointerId)}}function Gl(e,r,a,o,h,m){return e===null||e.nativeEvent!==m?(e={blockedOn:r,domEventName:a,eventSystemFlags:o,nativeEvent:m,targetContainers:[h]},r!==null&&(r=$t(r),r!==null&&Ry(r)),e):(e.eventSystemFlags|=o,r=e.targetContainers,h!==null&&r.indexOf(h)===-1&&r.push(h),e)}function Dw(e,r,a,o,h){switch(r){case"focusin":return ri=Gl(ri,e,r,a,o,h),!0;case"dragenter":return si=Gl(si,e,r,a,o,h),!0;case"mouseover":return ii=Gl(ii,e,r,a,o,h),!0;case"pointerover":var m=h.pointerId;return Hl.set(m,Gl(Hl.get(m)||null,e,r,a,o,h)),!0;case"gotpointercapture":return m=h.pointerId,Fl.set(m,Gl(Fl.get(m)||null,e,r,a,o,h)),!0}return!1}function Oy(e){var r=An(e.target);if(r!==null){var a=u(r);if(a!==null){if(r=a.tag,r===13){if(r=d(a),r!==null){e.blockedOn=r,Re(e.priority,function(){Ty(a)});return}}else if(r===31){if(r=f(a),r!==null){e.blockedOn=r,Re(e.priority,function(){Ty(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ic(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var a=Ah(e.nativeEvent);if(a===null){a=e.nativeEvent;var o=new a.constructor(a.type,a);al=o,a.target.dispatchEvent(o),al=null}else return r=$t(a),r!==null&&Ry(r),e.blockedOn=a,!1;r.shift()}return!0}function Dy(e,r,a){Ic(e)&&a.delete(r)}function Mw(){Oh=!1,ri!==null&&Ic(ri)&&(ri=null),si!==null&&Ic(si)&&(si=null),ii!==null&&Ic(ii)&&(ii=null),Hl.forEach(Dy),Fl.forEach(Dy)}function $c(e,r){e.blockedOn===r&&(e.blockedOn=null,Oh||(Oh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Mw)))}var qc=null;function My(e){qc!==e&&(qc=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){qc===e&&(qc=null);for(var r=0;r<e.length;r+=3){var a=e[r],o=e[r+1],h=e[r+2];if(typeof o!="function"){if(kh(o||a)===null)continue;break}var m=$t(a);m!==null&&(e.splice(r,3),r-=3,Ad(m,{pending:!0,data:h,method:a.method,action:o},o,h))}}))}function Ca(e){function r(Y){return $c(Y,e)}ri!==null&&$c(ri,e),si!==null&&$c(si,e),ii!==null&&$c(ii,e),Hl.forEach(r),Fl.forEach(r);for(var a=0;a<ai.length;a++){var o=ai[a];o.blockedOn===e&&(o.blockedOn=null)}for(;0<ai.length&&(a=ai[0],a.blockedOn===null);)Oy(a),a.blockedOn===null&&ai.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(o=0;o<a.length;o+=3){var h=a[o],m=a[o+1],b=h[De]||null;if(typeof m=="function")b||My(a);else if(b){var R=null;if(m&&m.hasAttribute("formAction")){if(h=m,b=m[De]||null)R=b.formAction;else if(kh(h)!==null)continue}else R=b.action;typeof R=="function"?a[o+1]=R:(a.splice(o,3),o-=3),My(a)}}}function zy(){function e(m){m.canIntercept&&m.info==="react-transition"&&m.intercept({handler:function(){return new Promise(function(b){return h=b})},focusReset:"manual",scroll:"manual"})}function r(){h!==null&&(h(),h=null),o||setTimeout(a,20)}function a(){if(!o&&!navigation.transition){var m=navigation.currentEntry;m&&m.url!=null&&navigation.navigate(m.url,{state:m.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var o=!1,h=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(a,100),function(){o=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),h!==null&&(h(),h=null)}}}function Dh(e){this._internalRoot=e}Pc.prototype.render=Dh.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(l(409));var a=r.current,o=wr();Ey(a,o,e,r,null,null)},Pc.prototype.unmount=Dh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;Ey(e.current,2,null,e,null,null),Sc(),r[rt]=null}};function Pc(e){this._internalRoot=e}Pc.prototype.unstable_scheduleHydration=function(e){if(e){var r=xe();e={blockedOn:null,target:e,priority:r};for(var a=0;a<ai.length&&r!==0&&r<ai[a].priority;a++);ai.splice(a,0,e),a===0&&Oy(e)}};var Uy=t.version;if(Uy!=="19.2.3")throw Error(l(527,Uy,"19.2.3"));L.findDOMNode=function(e){var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(l(188)):(e=Object.keys(e).join(","),Error(l(268,e)));return e=g(r),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var zw={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hc.isDisabled&&Hc.supportsFiber)try{qn=Hc.inject(zw),Xt=Hc}catch{}}return Yl.createRoot=function(e,r){if(!c(e))throw Error(l(299));var a=!1,o="",h=Hm,m=Fm,b=Gm;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onUncaughtError!==void 0&&(h=r.onUncaughtError),r.onCaughtError!==void 0&&(m=r.onCaughtError),r.onRecoverableError!==void 0&&(b=r.onRecoverableError)),r=_y(e,1,!1,null,null,a,o,null,h,m,b,zy),e[rt]=r.current,ph(e),new Dh(r)},Yl.hydrateRoot=function(e,r,a){if(!c(e))throw Error(l(299));var o=!1,h="",m=Hm,b=Fm,R=Gm,Y=null;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(h=a.identifierPrefix),a.onUncaughtError!==void 0&&(m=a.onUncaughtError),a.onCaughtError!==void 0&&(b=a.onCaughtError),a.onRecoverableError!==void 0&&(R=a.onRecoverableError),a.formState!==void 0&&(Y=a.formState)),r=_y(e,1,!0,r,a??null,o,h,Y,m,b,R,zy),r.context=Cy(null),a=r.current,o=wr(),o=re(o),h=Gs(o),h.callback=null,Vs(a,h,o),a=o,r.current.lanes=a,kt(r,a),rs(r),e[rt]=r.current,ph(e),new Pc(r)},Yl.version="19.2.3",Yl}var Vy;function Fw(){if(Vy)return Uh.exports;Vy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Uh.exports=Hw(),Uh.exports}var Gw=Fw();var Yy="popstate";function Vw(n={}){function t(l,c){let{pathname:u,search:d,hash:f}=l.location;return Sf("",{pathname:u,search:d,hash:f},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function s(l,c){return typeof c=="string"?c:oo(c)}return Kw(t,s,null,n)}function Mn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Br(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Yw(){return Math.random().toString(36).substring(2,10)}function Ky(n,t){return{usr:n.state,key:n.key,idx:t}}function Sf(n,t,s=null,l){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?So(t):t,state:s,key:t&&t.key||l||Yw()}}function oo({pathname:n="/",search:t="",hash:s=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function So(n){let t={};if(n){let s=n.indexOf("#");s>=0&&(t.hash=n.substring(s),n=n.substring(0,s));let l=n.indexOf("?");l>=0&&(t.search=n.substring(l),n=n.substring(0,l)),n&&(t.pathname=n)}return t}function Kw(n,t,s,l={}){let{window:c=document.defaultView,v5Compat:u=!1}=l,d=c.history,f="POP",p=null,g=y();g==null&&(g=0,d.replaceState({...d.state,idx:g},""));function y(){return(d.state||{idx:null}).idx}function v(){f="POP";let _=y(),T=_==null?null:_-g;g=_,p&&p({action:f,location:E.location,delta:T})}function x(_,T){f="PUSH";let D=Sf(E.location,_,T);g=y()+1;let B=Ky(D,g),P=E.createHref(D);try{d.pushState(B,"",P)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;c.location.assign(P)}u&&p&&p({action:f,location:E.location,delta:1})}function S(_,T){f="REPLACE";let D=Sf(E.location,_,T);g=y();let B=Ky(D,g),P=E.createHref(D);d.replaceState(B,"",P),u&&p&&p({action:f,location:E.location,delta:0})}function C(_){return Qw(_)}let E={get action(){return f},get location(){return n(c,d)},listen(_){if(p)throw new Error("A history only accepts one active listener");return c.addEventListener(Yy,v),p=_,()=>{c.removeEventListener(Yy,v),p=null}},createHref(_){return t(c,_)},createURL:C,encodeLocation(_){let T=C(_);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:x,replace:S,go(_){return d.go(_)}};return E}function Qw(n,t=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),Mn(s,"No window.location.(origin|href) available to create URL");let l=typeof n=="string"?n:oo(n);return l=l.replace(/ $/,"%20"),!t&&l.startsWith("//")&&(l=s+l),new URL(l,s)}function w0(n,t,s="/"){return Ww(n,t,s,!1)}function Ww(n,t,s,l){let c=typeof t=="string"?So(t):t,u=Ns(c.pathname||"/",s);if(u==null)return null;let d=S0(n);Xw(d);let f=null;for(let p=0;f==null&&p<d.length;++p){let g=oS(u);f=aS(d[p],g,l)}return f}function S0(n,t=[],s=[],l="",c=!1){let u=(d,f,p=c,g)=>{let y={relativePath:g===void 0?d.path||"":g,caseSensitive:d.caseSensitive===!0,childrenIndex:f,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(l)&&p)return;Mn(y.relativePath.startsWith(l),`Absolute route path "${y.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(l.length)}let v=Es([l,y.relativePath]),x=s.concat(y);d.children&&d.children.length>0&&(Mn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),S0(d.children,t,x,v,p)),!(d.path==null&&!d.index)&&t.push({path:v,score:sS(v,d.index),routesMeta:x})};return n.forEach((d,f)=>{if(d.path===""||!d.path?.includes("?"))u(d,f);else for(let p of j0(d.path))u(d,f,!0,p)}),t}function j0(n){let t=n.split("/");if(t.length===0)return[];let[s,...l]=t,c=s.endsWith("?"),u=s.replace(/\?$/,"");if(l.length===0)return c?[u,""]:[u];let d=j0(l.join("/")),f=[];return f.push(...d.map(p=>p===""?u:[u,p].join("/"))),c&&f.push(...d),f.map(p=>n.startsWith("/")&&p===""?"/":p)}function Xw(n){n.sort((t,s)=>t.score!==s.score?s.score-t.score:iS(t.routesMeta.map(l=>l.childrenIndex),s.routesMeta.map(l=>l.childrenIndex)))}var Jw=/^:[\w-]+$/,Zw=3,eS=2,tS=1,nS=10,rS=-2,Qy=n=>n==="*";function sS(n,t){let s=n.split("/"),l=s.length;return s.some(Qy)&&(l+=rS),t&&(l+=eS),s.filter(c=>!Qy(c)).reduce((c,u)=>c+(Jw.test(u)?Zw:u===""?tS:nS),l)}function iS(n,t){return n.length===t.length&&n.slice(0,-1).every((l,c)=>l===t[c])?n[n.length-1]-t[t.length-1]:0}function aS(n,t,s=!1){let{routesMeta:l}=n,c={},u="/",d=[];for(let f=0;f<l.length;++f){let p=l[f],g=f===l.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=cu({path:p.relativePath,caseSensitive:p.caseSensitive,end:g},y),x=p.route;if(!v&&g&&s&&!l[l.length-1].route.index&&(v=cu({path:p.relativePath,caseSensitive:p.caseSensitive,end:!1},y)),!v)return null;Object.assign(c,v.params),d.push({params:c,pathname:Es([u,v.pathname]),pathnameBase:hS(Es([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=Es([u,v.pathnameBase]))}return d}function cu(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,l]=lS(n.path,n.caseSensitive,n.end),c=t.match(s);if(!c)return null;let u=c[0],d=u.replace(/(.)\/+$/,"$1"),f=c.slice(1);return{params:l.reduce((g,{paramName:y,isOptional:v},x)=>{if(y==="*"){let C=f[x]||"";d=u.slice(0,u.length-C.length).replace(/(.)\/+$/,"$1")}const S=f[x];return v&&!S?g[y]=void 0:g[y]=(S||"").replace(/%2F/g,"/"),g},{}),pathname:u,pathnameBase:d,pattern:n}}function lS(n,t=!1,s=!0){Br(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let l=[],c="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,f,p)=>(l.push({paramName:f,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(l.push({paramName:"*"}),c+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?c+="\\/*$":n!==""&&n!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,t?void 0:"i"),l]}function oS(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Br(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Ns(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,l=n.charAt(s);return l&&l!=="/"?null:n.slice(s)||"/"}var _0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cS=n=>_0.test(n);function uS(n,t="/"){let{pathname:s,search:l="",hash:c=""}=typeof n=="string"?So(n):n,u;if(s)if(cS(s))u=s;else{if(s.includes("//")){let d=s;s=s.replace(/\/\/+/g,"/"),Br(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${s}`)}s.startsWith("/")?u=Wy(s.substring(1),"/"):u=Wy(s,t)}else u=t;return{pathname:u,search:fS(l),hash:pS(c)}}function Wy(n,t){let s=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(c=>{c===".."?s.length>1&&s.pop():c!=="."&&s.push(c)}),s.length>1?s.join("/"):"/"}function $h(n,t,s,l){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function dS(n){return n.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function C0(n){let t=dS(n);return t.map((s,l)=>l===t.length-1?s.pathname:s.pathnameBase)}function E0(n,t,s,l=!1){let c;typeof n=="string"?c=So(n):(c={...n},Mn(!c.pathname||!c.pathname.includes("?"),$h("?","pathname","search",c)),Mn(!c.pathname||!c.pathname.includes("#"),$h("#","pathname","hash",c)),Mn(!c.search||!c.search.includes("#"),$h("#","search","hash",c)));let u=n===""||c.pathname==="",d=u?"/":c.pathname,f;if(d==null)f=s;else{let v=t.length-1;if(!l&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;c.pathname=x.join("/")}f=v>=0?t[v]:"/"}let p=uS(c,f),g=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&s.endsWith("/");return!p.pathname.endsWith("/")&&(g||y)&&(p.pathname+="/"),p}var Es=n=>n.join("/").replace(/\/\/+/g,"/"),hS=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),fS=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,pS=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,mS=class{constructor(n,t,s,l=!1){this.status=n,this.statusText=t||"",this.internal=l,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function gS(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function yS(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var N0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function R0(n,t){let s=n;if(typeof s!="string"||!_0.test(s))return{absoluteURL:void 0,isExternal:!1,to:s};let l=s,c=!1;if(N0)try{let u=new URL(window.location.href),d=s.startsWith("//")?new URL(u.protocol+s):new URL(s),f=Ns(d.pathname,t);d.origin===u.origin&&f!=null?s=f+d.search+d.hash:c=!0}catch{Br(!1,`<Link to="${s}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:l,isExternal:c,to:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var T0=["POST","PUT","PATCH","DELETE"];new Set(T0);var vS=["GET",...T0];new Set(vS);var Va=w.createContext(null);Va.displayName="DataRouter";var wu=w.createContext(null);wu.displayName="DataRouterState";var xS=w.createContext(!1),A0=w.createContext({isTransitioning:!1});A0.displayName="ViewTransition";var bS=w.createContext(new Map);bS.displayName="Fetchers";var wS=w.createContext(null);wS.displayName="Await";var Ir=w.createContext(null);Ir.displayName="Navigation";var Su=w.createContext(null);Su.displayName="Location";var Ts=w.createContext({outlet:null,matches:[],isDataRoute:!1});Ts.displayName="Route";var Hf=w.createContext(null);Hf.displayName="RouteError";var k0="REACT_ROUTER_ERROR",SS="REDIRECT",jS="ROUTE_ERROR_RESPONSE";function _S(n){if(n.startsWith(`${k0}:${SS}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function CS(n){if(n.startsWith(`${k0}:${jS}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new mS(t.status,t.statusText,t.data)}catch{}}function ES(n,{relative:t}={}){Mn(jo(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:l}=w.useContext(Ir),{hash:c,pathname:u,search:d}=_o(n,{relative:t}),f=u;return s!=="/"&&(f=u==="/"?s:Es([s,u])),l.createHref({pathname:f,search:d,hash:c})}function jo(){return w.useContext(Su)!=null}function As(){return Mn(jo(),"useLocation() may be used only in the context of a <Router> component."),w.useContext(Su).location}var O0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function D0(n){w.useContext(Ir).static||w.useLayoutEffect(n)}function M0(){let{isDataRoute:n}=w.useContext(Ts);return n?IS():NS()}function NS(){Mn(jo(),"useNavigate() may be used only in the context of a <Router> component.");let n=w.useContext(Va),{basename:t,navigator:s}=w.useContext(Ir),{matches:l}=w.useContext(Ts),{pathname:c}=As(),u=JSON.stringify(C0(l)),d=w.useRef(!1);return D0(()=>{d.current=!0}),w.useCallback((p,g={})=>{if(Br(d.current,O0),!d.current)return;if(typeof p=="number"){s.go(p);return}let y=E0(p,JSON.parse(u),c,g.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Es([t,y.pathname])),(g.replace?s.replace:s.push)(y,g.state,g)},[t,s,u,c,n])}w.createContext(null);function _o(n,{relative:t}={}){let{matches:s}=w.useContext(Ts),{pathname:l}=As(),c=JSON.stringify(C0(s));return w.useMemo(()=>E0(n,JSON.parse(c),l,t==="path"),[n,c,l,t])}function RS(n,t,s,l,c){Mn(jo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=w.useContext(Ir),{matches:d}=w.useContext(Ts),f=d[d.length-1],p=f?f.params:{},g=f?f.pathname:"/",y=f?f.pathnameBase:"/",v=f&&f.route;{let D=v&&v.path||"";U0(g,!v||D.endsWith("*")||D.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${g}" (under <Route path="${D}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${D}"> to <Route path="${D==="/"?"*":`${D}/*`}">.`)}let x=As(),S;S=x;let C=S.pathname||"/",E=C;if(y!=="/"){let D=y.replace(/^\//,"").split("/");E="/"+C.replace(/^\//,"").split("/").slice(D.length).join("/")}let _=w0(n,{pathname:E});return Br(v||_!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),Br(_==null||_[_.length-1].route.element!==void 0||_[_.length-1].route.Component!==void 0||_[_.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),DS(_&&_.map(D=>Object.assign({},D,{params:Object.assign({},p,D.params),pathname:Es([y,u.encodeLocation?u.encodeLocation(D.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?y:Es([y,u.encodeLocation?u.encodeLocation(D.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathnameBase])})),d,s,l,c)}function TS(){let n=BS(),t=gS(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,l="rgba(200,200,200, 0.5)",c={padding:"0.5rem",backgroundColor:l},u={padding:"2px 4px",backgroundColor:l},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=w.createElement(w.Fragment,null,w.createElement("p",null," Hey developer "),w.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",w.createElement("code",{style:u},"ErrorBoundary")," or"," ",w.createElement("code",{style:u},"errorElement")," prop on your route.")),w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},t),s?w.createElement("pre",{style:c},s):null,d)}var AS=w.createElement(TS,null),z0=class extends w.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const s=CS(n.digest);s&&(n=s)}let t=n!==void 0?w.createElement(Ts.Provider,{value:this.props.routeContext},w.createElement(Hf.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?w.createElement(kS,{error:n},t):t}};z0.contextType=xS;var qh=new WeakMap;function kS({children:n,error:t}){let{basename:s}=w.useContext(Ir);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let l=_S(t.digest);if(l){let c=qh.get(t);if(c)throw c;let u=R0(l.location,s);if(N0&&!qh.get(t))if(u.isExternal||l.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:l.replace}));throw qh.set(t,d),d}return w.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function OS({routeContext:n,match:t,children:s}){let l=w.useContext(Va);return l&&l.static&&l.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=t.route.id),w.createElement(Ts.Provider,{value:n},s)}function DS(n,t=[],s=null,l=null,c=null){if(n==null){if(!s)return null;if(s.errors)n=s.matches;else if(t.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let u=n,d=s?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);Mn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let f=!1,p=-1;if(s)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(p=y),v.route.id){let{loaderData:x,errors:S}=s,C=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!S||S[v.route.id]===void 0);if(v.route.lazy||C){f=!0,p>=0?u=u.slice(0,p+1):u=[u[0]];break}}}let g=s&&l?(y,v)=>{l(y,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:yS(s.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let S,C=!1,E=null,_=null;s&&(S=d&&v.route.id?d[v.route.id]:void 0,E=v.route.errorElement||AS,f&&(p<0&&x===0?(U0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),C=!0,_=null):p===x&&(C=!0,_=v.route.hydrateFallbackElement||null)));let T=t.concat(u.slice(0,x+1)),D=()=>{let B;return S?B=E:C?B=_:v.route.Component?B=w.createElement(v.route.Component,null):v.route.element?B=v.route.element:B=y,w.createElement(OS,{match:v,routeContext:{outlet:y,matches:T,isDataRoute:s!=null},children:B})};return s&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?w.createElement(z0,{location:s.location,revalidation:s.revalidation,component:E,error:S,children:D(),routeContext:{outlet:null,matches:T,isDataRoute:!0},onError:g}):D()},null)}function Ff(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function MS(n){let t=w.useContext(Va);return Mn(t,Ff(n)),t}function zS(n){let t=w.useContext(wu);return Mn(t,Ff(n)),t}function US(n){let t=w.useContext(Ts);return Mn(t,Ff(n)),t}function Gf(n){let t=US(n),s=t.matches[t.matches.length-1];return Mn(s.route.id,`${n} can only be used on routes that contain a unique "id"`),s.route.id}function LS(){return Gf("useRouteId")}function BS(){let n=w.useContext(Hf),t=zS("useRouteError"),s=Gf("useRouteError");return n!==void 0?n:t.errors?.[s]}function IS(){let{router:n}=MS("useNavigate"),t=Gf("useNavigate"),s=w.useRef(!1);return D0(()=>{s.current=!0}),w.useCallback(async(c,u={})=>{Br(s.current,O0),s.current&&(typeof c=="number"?await n.navigate(c):await n.navigate(c,{fromRouteId:t,...u}))},[n,t])}var Xy={};function U0(n,t,s){!t&&!Xy[n]&&(Xy[n]=!0,Br(!1,s))}w.memo($S);function $S({routes:n,future:t,state:s,onError:l}){return RS(n,void 0,s,l,t)}function qS({basename:n="/",children:t=null,location:s,navigationType:l="POP",navigator:c,static:u=!1,unstable_useTransitions:d}){Mn(!jo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=n.replace(/^\/*/,"/"),p=w.useMemo(()=>({basename:f,navigator:c,static:u,unstable_useTransitions:d,future:{}}),[f,c,u,d]);typeof s=="string"&&(s=So(s));let{pathname:g="/",search:y="",hash:v="",state:x=null,key:S="default"}=s,C=w.useMemo(()=>{let E=Ns(g,f);return E==null?null:{location:{pathname:E,search:y,hash:v,state:x,key:S},navigationType:l}},[f,g,y,v,x,S,l]);return Br(C!=null,`<Router basename="${f}"> is not able to match the URL "${g}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),C==null?null:w.createElement(Ir.Provider,{value:p},w.createElement(Su.Provider,{children:t,value:C}))}var ru="get",su="application/x-www-form-urlencoded";function ju(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function PS(n){return ju(n)&&n.tagName.toLowerCase()==="button"}function HS(n){return ju(n)&&n.tagName.toLowerCase()==="form"}function FS(n){return ju(n)&&n.tagName.toLowerCase()==="input"}function GS(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function VS(n,t){return n.button===0&&(!t||t==="_self")&&!GS(n)}function jf(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,s)=>{let l=n[s];return t.concat(Array.isArray(l)?l.map(c=>[s,c]):[[s,l]])},[]))}function YS(n,t){let s=jf(n);return t&&t.forEach((l,c)=>{s.has(c)||t.getAll(c).forEach(u=>{s.append(c,u)})}),s}var Fc=null;function KS(){if(Fc===null)try{new FormData(document.createElement("form"),0),Fc=!1}catch{Fc=!0}return Fc}var QS=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ph(n){return n!=null&&!QS.has(n)?(Br(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${su}"`),null):n}function WS(n,t){let s,l,c,u,d;if(HS(n)){let f=n.getAttribute("action");l=f?Ns(f,t):null,s=n.getAttribute("method")||ru,c=Ph(n.getAttribute("enctype"))||su,u=new FormData(n)}else if(PS(n)||FS(n)&&(n.type==="submit"||n.type==="image")){let f=n.form;if(f==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let p=n.getAttribute("formaction")||f.getAttribute("action");if(l=p?Ns(p,t):null,s=n.getAttribute("formmethod")||f.getAttribute("method")||ru,c=Ph(n.getAttribute("formenctype"))||Ph(f.getAttribute("enctype"))||su,u=new FormData(f,n),!KS()){let{name:g,type:y,value:v}=n;if(y==="image"){let x=g?`${g}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else g&&u.append(g,v)}}else{if(ju(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=ru,l=null,c=su,d=n}return u&&c==="text/plain"&&(d=u,u=void 0),{action:l,method:s.toLowerCase(),encType:c,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Vf(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function XS(n,t,s){let l=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return l.pathname==="/"?l.pathname=`_root.${s}`:t&&Ns(l.pathname,t)==="/"?l.pathname=`${t.replace(/\/$/,"")}/_root.${s}`:l.pathname=`${l.pathname.replace(/\/$/,"")}.${s}`,l}async function JS(n,t){if(n.id in t)return t[n.id];try{let s=await import(n.module);return t[n.id]=s,s}catch(s){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ZS(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function ej(n,t,s){let l=await Promise.all(n.map(async c=>{let u=t.routes[c.route.id];if(u){let d=await JS(u,s);return d.links?d.links():[]}return[]}));return sj(l.flat(1).filter(ZS).filter(c=>c.rel==="stylesheet"||c.rel==="preload").map(c=>c.rel==="stylesheet"?{...c,rel:"prefetch",as:"style"}:{...c,rel:"prefetch"}))}function Jy(n,t,s,l,c,u){let d=(p,g)=>s[g]?p.route.id!==s[g].route.id:!0,f=(p,g)=>s[g].pathname!==p.pathname||s[g].route.path?.endsWith("*")&&s[g].params["*"]!==p.params["*"];return u==="assets"?t.filter((p,g)=>d(p,g)||f(p,g)):u==="data"?t.filter((p,g)=>{let y=l.routes[p.route.id];if(!y||!y.hasLoader)return!1;if(d(p,g)||f(p,g))return!0;if(p.route.shouldRevalidate){let v=p.route.shouldRevalidate({currentUrl:new URL(c.pathname+c.search+c.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:p.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function tj(n,t,{includeHydrateFallback:s}={}){return nj(n.map(l=>{let c=t.routes[l.route.id];if(!c)return[];let u=[c.module];return c.clientActionModule&&(u=u.concat(c.clientActionModule)),c.clientLoaderModule&&(u=u.concat(c.clientLoaderModule)),s&&c.hydrateFallbackModule&&(u=u.concat(c.hydrateFallbackModule)),c.imports&&(u=u.concat(c.imports)),u}).flat(1))}function nj(n){return[...new Set(n)]}function rj(n){let t={},s=Object.keys(n).sort();for(let l of s)t[l]=n[l];return t}function sj(n,t){let s=new Set;return new Set(t),n.reduce((l,c)=>{let u=JSON.stringify(rj(c));return s.has(u)||(s.add(u),l.push({key:u,link:c})),l},[])}function L0(){let n=w.useContext(Va);return Vf(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function ij(){let n=w.useContext(wu);return Vf(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Yf=w.createContext(void 0);Yf.displayName="FrameworkContext";function B0(){let n=w.useContext(Yf);return Vf(n,"You must render this element inside a <HydratedRouter> element"),n}function aj(n,t){let s=w.useContext(Yf),[l,c]=w.useState(!1),[u,d]=w.useState(!1),{onFocus:f,onBlur:p,onMouseEnter:g,onMouseLeave:y,onTouchStart:v}=t,x=w.useRef(null);w.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let E=T=>{T.forEach(D=>{d(D.isIntersecting)})},_=new IntersectionObserver(E,{threshold:.5});return x.current&&_.observe(x.current),()=>{_.disconnect()}}},[n]),w.useEffect(()=>{if(l){let E=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(E)}}},[l]);let S=()=>{c(!0)},C=()=>{c(!1),d(!1)};return s?n!=="intent"?[u,x,{}]:[u,x,{onFocus:Kl(f,S),onBlur:Kl(p,C),onMouseEnter:Kl(g,S),onMouseLeave:Kl(y,C),onTouchStart:Kl(v,S)}]:[!1,x,{}]}function Kl(n,t){return s=>{n&&n(s),s.defaultPrevented||t(s)}}function lj({page:n,...t}){let{router:s}=L0(),l=w.useMemo(()=>w0(s.routes,n,s.basename),[s.routes,n,s.basename]);return l?w.createElement(cj,{page:n,matches:l,...t}):null}function oj(n){let{manifest:t,routeModules:s}=B0(),[l,c]=w.useState([]);return w.useEffect(()=>{let u=!1;return ej(n,t,s).then(d=>{u||c(d)}),()=>{u=!0}},[n,t,s]),l}function cj({page:n,matches:t,...s}){let l=As(),{manifest:c,routeModules:u}=B0(),{basename:d}=L0(),{loaderData:f,matches:p}=ij(),g=w.useMemo(()=>Jy(n,t,p,c,l,"data"),[n,t,p,c,l]),y=w.useMemo(()=>Jy(n,t,p,c,l,"assets"),[n,t,p,c,l]),v=w.useMemo(()=>{if(n===l.pathname+l.search+l.hash)return[];let C=new Set,E=!1;if(t.forEach(T=>{let D=c.routes[T.route.id];!D||!D.hasLoader||(!g.some(B=>B.route.id===T.route.id)&&T.route.id in f&&u[T.route.id]?.shouldRevalidate||D.hasClientLoader?E=!0:C.add(T.route.id))}),C.size===0)return[];let _=XS(n,d,"data");return E&&C.size>0&&_.searchParams.set("_routes",t.filter(T=>C.has(T.route.id)).map(T=>T.route.id).join(",")),[_.pathname+_.search]},[d,f,l,c,g,t,n,u]),x=w.useMemo(()=>tj(y,c),[y,c]),S=oj(y);return w.createElement(w.Fragment,null,v.map(C=>w.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...s})),x.map(C=>w.createElement("link",{key:C,rel:"modulepreload",href:C,...s})),S.map(({key:C,link:E})=>w.createElement("link",{key:C,nonce:s.nonce,...E})))}function uj(...n){return t=>{n.forEach(s=>{typeof s=="function"?s(t):s!=null&&(s.current=t)})}}var dj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{dj&&(window.__reactRouterVersion="7.11.0")}catch{}function hj({basename:n,children:t,unstable_useTransitions:s,window:l}){let c=w.useRef();c.current==null&&(c.current=Vw({window:l,v5Compat:!0}));let u=c.current,[d,f]=w.useState({action:u.action,location:u.location}),p=w.useCallback(g=>{s===!1?f(g):w.startTransition(()=>f(g))},[s]);return w.useLayoutEffect(()=>u.listen(p),[u,p]),w.createElement(qS,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:s})}var I0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$0=w.forwardRef(function({onClick:t,discover:s="render",prefetch:l="none",relative:c,reloadDocument:u,replace:d,state:f,target:p,to:g,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...S},C){let{basename:E,unstable_useTransitions:_}=w.useContext(Ir),T=typeof g=="string"&&I0.test(g),D=R0(g,E);g=D.to;let B=ES(g,{relative:c}),[P,$,j]=aj(l,S),M=gj(g,{replace:d,state:f,target:p,preventScrollReset:y,relative:c,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:_});function A(Q){t&&t(Q),Q.defaultPrevented||M(Q)}let F=w.createElement("a",{...S,...j,href:D.absoluteURL||B,onClick:D.isExternal||u?t:A,ref:uj(C,$),target:p,"data-discover":!T&&s==="render"?"true":void 0});return P&&!T?w.createElement(w.Fragment,null,F,w.createElement(lj,{page:B})):F});$0.displayName="Link";var fj=w.forwardRef(function({"aria-current":t="page",caseSensitive:s=!1,className:l="",end:c=!1,style:u,to:d,viewTransition:f,children:p,...g},y){let v=_o(d,{relative:g.relative}),x=As(),S=w.useContext(wu),{navigator:C,basename:E}=w.useContext(Ir),_=S!=null&&wj(v)&&f===!0,T=C.encodeLocation?C.encodeLocation(v).pathname:v.pathname,D=x.pathname,B=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;s||(D=D.toLowerCase(),B=B?B.toLowerCase():null,T=T.toLowerCase()),B&&E&&(B=Ns(B,E)||B);const P=T!=="/"&&T.endsWith("/")?T.length-1:T.length;let $=D===T||!c&&D.startsWith(T)&&D.charAt(P)==="/",j=B!=null&&(B===T||!c&&B.startsWith(T)&&B.charAt(T.length)==="/"),M={isActive:$,isPending:j,isTransitioning:_},A=$?t:void 0,F;typeof l=="function"?F=l(M):F=[l,$?"active":null,j?"pending":null,_?"transitioning":null].filter(Boolean).join(" ");let Q=typeof u=="function"?u(M):u;return w.createElement($0,{...g,"aria-current":A,className:F,ref:y,style:Q,to:d,viewTransition:f},typeof p=="function"?p(M):p)});fj.displayName="NavLink";var pj=w.forwardRef(({discover:n="render",fetcherKey:t,navigate:s,reloadDocument:l,replace:c,state:u,method:d=ru,action:f,onSubmit:p,relative:g,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...S},C)=>{let{unstable_useTransitions:E}=w.useContext(Ir),_=xj(),T=bj(f,{relative:g}),D=d.toLowerCase()==="get"?"get":"post",B=typeof f=="string"&&I0.test(f),P=$=>{if(p&&p($),$.defaultPrevented)return;$.preventDefault();let j=$.nativeEvent.submitter,M=j?.getAttribute("formmethod")||d,A=()=>_(j||$.currentTarget,{fetcherKey:t,method:M,navigate:s,replace:c,state:u,relative:g,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});E&&s!==!1?w.startTransition(()=>A()):A()};return w.createElement("form",{ref:C,method:D,action:T,onSubmit:l?p:P,...S,"data-discover":!B&&n==="render"?"true":void 0})});pj.displayName="Form";function mj(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function q0(n){let t=w.useContext(Va);return Mn(t,mj(n)),t}function gj(n,{target:t,replace:s,state:l,preventScrollReset:c,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:p}={}){let g=M0(),y=As(),v=_o(n,{relative:u});return w.useCallback(x=>{if(VS(x,t)){x.preventDefault();let S=s!==void 0?s:oo(y)===oo(v),C=()=>g(n,{replace:S,state:l,preventScrollReset:c,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f});p?w.startTransition(()=>C()):C()}},[y,g,v,s,l,t,n,c,u,d,f,p])}function Kf(n){Br(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=w.useRef(jf(n)),s=w.useRef(!1),l=As(),c=w.useMemo(()=>YS(l.search,s.current?null:t.current),[l.search]),u=M0(),d=w.useCallback((f,p)=>{const g=jf(typeof f=="function"?f(new URLSearchParams(c)):f);s.current=!0,u("?"+g,p)},[u,c]);return[c,d]}var yj=0,vj=()=>`__${String(++yj)}__`;function xj(){let{router:n}=q0("useSubmit"),{basename:t}=w.useContext(Ir),s=LS(),l=n.fetch,c=n.navigate;return w.useCallback(async(u,d={})=>{let{action:f,method:p,encType:g,formData:y,body:v}=WS(u,t);if(d.navigate===!1){let x=d.fetcherKey||vj();await l(x,s,d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||p,formEncType:d.encType||g,flushSync:d.flushSync})}else await c(d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||p,formEncType:d.encType||g,replace:d.replace,state:d.state,fromRouteId:s,flushSync:d.flushSync,viewTransition:d.viewTransition})},[l,c,t,s])}function bj(n,{relative:t}={}){let{basename:s}=w.useContext(Ir),l=w.useContext(Ts);Mn(l,"useFormAction must be used inside a RouteContext");let[c]=l.matches.slice(-1),u={..._o(n||".",{relative:t})},d=As();if(n==null){u.search=d.search;let f=new URLSearchParams(u.search),p=f.getAll("index");if(p.some(y=>y==="")){f.delete("index"),p.filter(v=>v).forEach(v=>f.append("index",v));let y=f.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&c.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(u.pathname=u.pathname==="/"?s:Es([s,u.pathname])),oo(u)}function wj(n,{relative:t}={}){let s=w.useContext(A0);Mn(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=q0("useViewTransitionState"),c=_o(n,{relative:t});if(!s.isTransitioning)return!1;let u=Ns(s.currentLocation.pathname,l)||s.currentLocation.pathname,d=Ns(s.nextLocation.pathname,l)||s.nextLocation.pathname;return cu(c.pathname,d)!=null||cu(c.pathname,u)!=null}var $a=b0();const be=({children:n,variant:t="primary",size:s="md",isLoading:l,block:c,className:u="",...d})=>{const f=["btn",`btn--${t}`,`btn--${s}`,c?"btn--block":"",l?"btn--loading":"",u].filter(Boolean).join(" ");return i.jsxs("button",{className:f,disabled:l,...d,children:[l&&i.jsx("span",{className:"btn__spinner"}),i.jsx("span",{className:"btn__content",children:n})]})},Sj=({children:n})=>(As(),i.jsxs("div",{className:"app-layout",children:[i.jsx("header",{className:"app-header",children:i.jsx("div",{className:"container app-header__content",children:i.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),i.jsx("main",{className:"container app-main",children:n}),i.jsx("footer",{className:"app-footer",children:i.jsx("div",{className:"container",children:i.jsx("p",{children:" 2026 recipe management"})})})]})),fn=({children:n,className:t="",hoverable:s=!1,...l})=>i.jsx("div",{className:`glass-card ${s?"glass-card--hoverable":""} ${t}`,...l,children:n});function jj(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return w.useMemo(()=>l=>{t.forEach(c=>c(l))},t)}const _u=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ya(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function Qf(n){return"nodeType"in n}function rr(n){var t,s;return n?Ya(n)?n:Qf(n)&&(t=(s=n.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function Wf(n){const{Document:t}=rr(n);return n instanceof t}function Co(n){return Ya(n)?!1:n instanceof rr(n).HTMLElement}function P0(n){return n instanceof rr(n).SVGElement}function Ka(n){return n?Ya(n)?n.document:Qf(n)?Wf(n)?n:Co(n)||P0(n)?n.ownerDocument:document:document:document}const Wr=_u?w.useLayoutEffect:w.useEffect;function Cu(n){const t=w.useRef(n);return Wr(()=>{t.current=n}),w.useCallback(function(){for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];return t.current==null?void 0:t.current(...l)},[])}function _j(){const n=w.useRef(null),t=w.useCallback((l,c)=>{n.current=setInterval(l,c)},[]),s=w.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,s]}function co(n,t){t===void 0&&(t=[n]);const s=w.useRef(n);return Wr(()=>{s.current!==n&&(s.current=n)},t),s}function Eo(n,t){const s=w.useRef();return w.useMemo(()=>{const l=n(s.current);return s.current=l,l},[...t])}function uu(n){const t=Cu(n),s=w.useRef(null),l=w.useCallback(c=>{c!==s.current&&t?.(c,s.current),s.current=c},[]);return[s,l]}function du(n){const t=w.useRef();return w.useEffect(()=>{t.current=n},[n]),t.current}let Hh={};function No(n,t){return w.useMemo(()=>{if(t)return t;const s=Hh[n]==null?0:Hh[n]+1;return Hh[n]=s,n+"-"+s},[n,t])}function H0(n){return function(t){for(var s=arguments.length,l=new Array(s>1?s-1:0),c=1;c<s;c++)l[c-1]=arguments[c];return l.reduce((u,d)=>{const f=Object.entries(d);for(const[p,g]of f){const y=u[p];y!=null&&(u[p]=y+n*g)}return u},{...t})}}const Ha=H0(1),uo=H0(-1);function Cj(n){return"clientX"in n&&"clientY"in n}function Eu(n){if(!n)return!1;const{KeyboardEvent:t}=rr(n.target);return t&&n instanceof t}function Ej(n){if(!n)return!1;const{TouchEvent:t}=rr(n.target);return t&&n instanceof t}function hu(n){if(Ej(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:s}=n.touches[0];return{x:t,y:s}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:s}=n.changedTouches[0];return{x:t,y:s}}}return Cj(n)?{x:n.clientX,y:n.clientY}:null}const Cr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:s}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:s}=n;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(n){if(n)return[Cr.Translate.toString(n),Cr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:s,easing:l}=n;return t+" "+s+"ms "+l}}}),Zy="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Nj(n){return n.matches(Zy)?n:n.querySelector(Zy)}const Rj={display:"none"};function Tj(n){let{id:t,value:s}=n;return Ae.createElement("div",{id:t,style:Rj},s)}function Aj(n){let{id:t,announcement:s,ariaLiveType:l="assertive"}=n;const c={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ae.createElement("div",{id:t,style:c,role:"status","aria-live":l,"aria-atomic":!0},s)}function kj(){const[n,t]=w.useState("");return{announce:w.useCallback(l=>{l!=null&&t(l)},[]),announcement:n}}const F0=w.createContext(null);function Oj(n){const t=w.useContext(F0);w.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function Dj(){const[n]=w.useState(()=>new Set),t=w.useCallback(l=>(n.add(l),()=>n.delete(l)),[n]);return[w.useCallback(l=>{let{type:c,event:u}=l;n.forEach(d=>{var f;return(f=d[c])==null?void 0:f.call(d,u)})},[n]),t]}const Mj={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},zj={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Uj(n){let{announcements:t=zj,container:s,hiddenTextDescribedById:l,screenReaderInstructions:c=Mj}=n;const{announce:u,announcement:d}=kj(),f=No("DndLiveRegion"),[p,g]=w.useState(!1);if(w.useEffect(()=>{g(!0)},[]),Oj(w.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:S}=v;t.onDragMove&&u(t.onDragMove({active:x,over:S}))},onDragOver(v){let{active:x,over:S}=v;u(t.onDragOver({active:x,over:S}))},onDragEnd(v){let{active:x,over:S}=v;u(t.onDragEnd({active:x,over:S}))},onDragCancel(v){let{active:x,over:S}=v;u(t.onDragCancel({active:x,over:S}))}}),[u,t])),!p)return null;const y=Ae.createElement(Ae.Fragment,null,Ae.createElement(Tj,{id:l,value:c.draggable}),Ae.createElement(Aj,{id:f,announcement:d}));return s?$a.createPortal(y,s):y}var Dn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Dn||(Dn={}));function fu(){}function fr(n,t){return w.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function Qa(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return w.useMemo(()=>[...t].filter(l=>l!=null),[...t])}const Xr=Object.freeze({x:0,y:0});function Xf(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function Lj(n,t){const s=hu(n);if(!s)return"0 0";const l={x:(s.x-t.left)/t.width*100,y:(s.y-t.top)/t.height*100};return l.x+"% "+l.y+"%"}function Jf(n,t){let{data:{value:s}}=n,{data:{value:l}}=t;return s-l}function Bj(n,t){let{data:{value:s}}=n,{data:{value:l}}=t;return l-s}function _f(n){let{left:t,top:s,height:l,width:c}=n;return[{x:t,y:s},{x:t+c,y:s},{x:t,y:s+l},{x:t+c,y:s+l}]}function G0(n,t){if(!n||n.length===0)return null;const[s]=n;return s[t]}function ev(n,t,s){return t===void 0&&(t=n.left),s===void 0&&(s=n.top),{x:t+n.width*.5,y:s+n.height*.5}}const Cf=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const c=ev(t,t.left,t.top),u=[];for(const d of l){const{id:f}=d,p=s.get(f);if(p){const g=Xf(ev(p),c);u.push({id:f,data:{droppableContainer:d,value:g}})}}return u.sort(Jf)},Ij=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const c=_f(t),u=[];for(const d of l){const{id:f}=d,p=s.get(f);if(p){const g=_f(p),y=c.reduce((x,S,C)=>x+Xf(g[C],S),0),v=Number((y/4).toFixed(4));u.push({id:f,data:{droppableContainer:d,value:v}})}}return u.sort(Jf)};function $j(n,t){const s=Math.max(t.top,n.top),l=Math.max(t.left,n.left),c=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=c-l,f=u-s;if(l<c&&s<u){const p=t.width*t.height,g=n.width*n.height,y=d*f,v=y/(p+g-y);return Number(v.toFixed(4))}return 0}const qj=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const c=[];for(const u of l){const{id:d}=u,f=s.get(d);if(f){const p=$j(f,t);p>0&&c.push({id:d,data:{droppableContainer:u,value:p}})}}return c.sort(Bj)};function Pj(n,t){const{top:s,left:l,bottom:c,right:u}=t;return s<=n.y&&n.y<=c&&l<=n.x&&n.x<=u}const V0=n=>{let{droppableContainers:t,droppableRects:s,pointerCoordinates:l}=n;if(!l)return[];const c=[];for(const u of t){const{id:d}=u,f=s.get(d);if(f&&Pj(l,f)){const g=_f(f).reduce((v,x)=>v+Xf(l,x),0),y=Number((g/4).toFixed(4));c.push({id:d,data:{droppableContainer:u,value:y}})}}return c.sort(Jf)};function Hj(n,t,s){return{...n,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function Y0(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:Xr}function Fj(n){return function(s){for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];return c.reduce((d,f)=>({...d,top:d.top+n*f.y,bottom:d.bottom+n*f.y,left:d.left+n*f.x,right:d.right+n*f.x}),{...s})}}const Gj=Fj(1);function K0(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Vj(n,t,s){const l=K0(t);if(!l)return n;const{scaleX:c,scaleY:u,x:d,y:f}=l,p=n.left-d-(1-c)*parseFloat(s),g=n.top-f-(1-u)*parseFloat(s.slice(s.indexOf(" ")+1)),y=c?n.width/c:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:g,right:p+y,bottom:g+v,left:p}}const Yj={ignoreTransform:!1};function Wa(n,t){t===void 0&&(t=Yj);let s=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:g,transformOrigin:y}=rr(n).getComputedStyle(n);g&&(s=Vj(s,g,y))}const{top:l,left:c,width:u,height:d,bottom:f,right:p}=s;return{top:l,left:c,width:u,height:d,bottom:f,right:p}}function tv(n){return Wa(n,{ignoreTransform:!0})}function Kj(n){const t=n.innerWidth,s=n.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function Qj(n,t){return t===void 0&&(t=rr(n).getComputedStyle(n)),t.position==="fixed"}function Wj(n,t){t===void 0&&(t=rr(n).getComputedStyle(n));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(c=>{const u=t[c];return typeof u=="string"?s.test(u):!1})}function Nu(n,t){const s=[];function l(c){if(t!=null&&s.length>=t||!c)return s;if(Wf(c)&&c.scrollingElement!=null&&!s.includes(c.scrollingElement))return s.push(c.scrollingElement),s;if(!Co(c)||P0(c)||s.includes(c))return s;const u=rr(n).getComputedStyle(c);return c!==n&&Wj(c,u)&&s.push(c),Qj(c,u)?s:l(c.parentNode)}return n?l(n):s}function Q0(n){const[t]=Nu(n,1);return t??null}function Fh(n){return!_u||!n?null:Ya(n)?n:Qf(n)?Wf(n)||n===Ka(n).scrollingElement?window:Co(n)?n:null:null}function W0(n){return Ya(n)?n.scrollX:n.scrollLeft}function X0(n){return Ya(n)?n.scrollY:n.scrollTop}function Ef(n){return{x:W0(n),y:X0(n)}}var Bn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Bn||(Bn={}));function J0(n){return!_u||!n?!1:n===document.scrollingElement}function Z0(n){const t={x:0,y:0},s=J0(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},l={x:n.scrollWidth-s.width,y:n.scrollHeight-s.height},c=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=l.y,f=n.scrollLeft>=l.x;return{isTop:c,isLeft:u,isBottom:d,isRight:f,maxScroll:l,minScroll:t}}const Xj={x:.2,y:.2};function Jj(n,t,s,l,c){let{top:u,left:d,right:f,bottom:p}=s;l===void 0&&(l=10),c===void 0&&(c=Xj);const{isTop:g,isBottom:y,isLeft:v,isRight:x}=Z0(n),S={x:0,y:0},C={x:0,y:0},E={height:t.height*c.y,width:t.width*c.x};return!g&&u<=t.top+E.height?(S.y=Bn.Backward,C.y=l*Math.abs((t.top+E.height-u)/E.height)):!y&&p>=t.bottom-E.height&&(S.y=Bn.Forward,C.y=l*Math.abs((t.bottom-E.height-p)/E.height)),!x&&f>=t.right-E.width?(S.x=Bn.Forward,C.x=l*Math.abs((t.right-E.width-f)/E.width)):!v&&d<=t.left+E.width&&(S.x=Bn.Backward,C.x=l*Math.abs((t.left+E.width-d)/E.width)),{direction:S,speed:C}}function Zj(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:s,right:l,bottom:c}=n.getBoundingClientRect();return{top:t,left:s,right:l,bottom:c,width:n.clientWidth,height:n.clientHeight}}function ex(n){return n.reduce((t,s)=>Ha(t,Ef(s)),Xr)}function e_(n){return n.reduce((t,s)=>t+W0(s),0)}function t_(n){return n.reduce((t,s)=>t+X0(s),0)}function tx(n,t){if(t===void 0&&(t=Wa),!n)return;const{top:s,left:l,bottom:c,right:u}=t(n);Q0(n)&&(c<=0||u<=0||s>=window.innerHeight||l>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const n_=[["x",["left","right"],e_],["y",["top","bottom"],t_]];class Zf{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const l=Nu(s),c=ex(l);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,f]of n_)for(const p of d)Object.defineProperty(this,p,{get:()=>{const g=f(l),y=c[u]-g;return this.rect[p]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ro{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var l;return(l=this.target)==null?void 0:l.removeEventListener(...s)})},this.target=t}add(t,s,l){var c;(c=this.target)==null||c.addEventListener(t,s,l),this.listeners.push([t,s,l])}}function r_(n){const{EventTarget:t}=rr(n);return n instanceof t?n:Ka(n)}function Gh(n,t){const s=Math.abs(n.x),l=Math.abs(n.y);return typeof t=="number"?Math.sqrt(s**2+l**2)>t:"x"in t&&"y"in t?s>t.x&&l>t.y:"x"in t?s>t.x:"y"in t?l>t.y:!1}var Lr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Lr||(Lr={}));function nv(n){n.preventDefault()}function s_(n){n.stopPropagation()}var At;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(At||(At={}));const nx={start:[At.Space,At.Enter],cancel:[At.Esc],end:[At.Space,At.Enter,At.Tab]},i_=(n,t)=>{let{currentCoordinates:s}=t;switch(n.code){case At.Right:return{...s,x:s.x+25};case At.Left:return{...s,x:s.x-25};case At.Down:return{...s,y:s.y+25};case At.Up:return{...s,y:s.y-25}}};class Xa{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new ro(Ka(s)),this.windowListeners=new ro(rr(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Lr.Resize,this.handleCancel),this.windowListeners.add(Lr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Lr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,l=t.node.current;l&&tx(l),s(Xr)}handleKeyDown(t){if(Eu(t)){const{active:s,context:l,options:c}=this.props,{keyboardCodes:u=nx,coordinateGetter:d=i_,scrollBehavior:f="smooth"}=c,{code:p}=t;if(u.end.includes(p)){this.handleEnd(t);return}if(u.cancel.includes(p)){this.handleCancel(t);return}const{collisionRect:g}=l.current,y=g?{x:g.left,y:g.top}:Xr;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:s,context:l.current,currentCoordinates:y});if(v){const x=uo(v,y),S={x:0,y:0},{scrollableAncestors:C}=l.current;for(const E of C){const _=t.code,{isTop:T,isRight:D,isLeft:B,isBottom:P,maxScroll:$,minScroll:j}=Z0(E),M=Zj(E),A={x:Math.min(_===At.Right?M.right-M.width/2:M.right,Math.max(_===At.Right?M.left:M.left+M.width/2,v.x)),y:Math.min(_===At.Down?M.bottom-M.height/2:M.bottom,Math.max(_===At.Down?M.top:M.top+M.height/2,v.y))},F=_===At.Right&&!D||_===At.Left&&!B,Q=_===At.Down&&!P||_===At.Up&&!T;if(F&&A.x!==v.x){const G=E.scrollLeft+x.x,H=_===At.Right&&G<=$.x||_===At.Left&&G>=j.x;if(H&&!x.y){E.scrollTo({left:G,behavior:f});return}H?S.x=E.scrollLeft-G:S.x=_===At.Right?E.scrollLeft-$.x:E.scrollLeft-j.x,S.x&&E.scrollBy({left:-S.x,behavior:f});break}else if(Q&&A.y!==v.y){const G=E.scrollTop+x.y,H=_===At.Down&&G<=$.y||_===At.Up&&G>=j.y;if(H&&!x.x){E.scrollTo({top:G,behavior:f});return}H?S.y=E.scrollTop-G:S.y=_===At.Down?E.scrollTop-$.y:E.scrollTop-j.y,S.y&&E.scrollBy({top:-S.y,behavior:f});break}}this.handleMove(t,Ha(uo(v,this.referenceCoordinates),S))}}}handleMove(t,s){const{onMove:l}=this.props;t.preventDefault(),l(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Xa.activators=[{eventName:"onKeyDown",handler:(n,t,s)=>{let{keyboardCodes:l=nx,onActivation:c}=t,{active:u}=s;const{code:d}=n.nativeEvent;if(l.start.includes(d)){const f=u.activatorNode.current;return f&&n.target!==f?!1:(n.preventDefault(),c?.({event:n.nativeEvent}),!0)}return!1}}];function rv(n){return!!(n&&"distance"in n)}function sv(n){return!!(n&&"delay"in n)}class ep{constructor(t,s,l){var c;l===void 0&&(l=r_(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:u}=t,{target:d}=u;this.props=t,this.events=s,this.document=Ka(d),this.documentListeners=new ro(this.document),this.listeners=new ro(l),this.windowListeners=new ro(rr(d)),this.initialCoordinates=(c=hu(u))!=null?c:Xr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:l}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Lr.Resize,this.handleCancel),this.windowListeners.add(Lr.DragStart,nv),this.windowListeners.add(Lr.VisibilityChange,this.handleCancel),this.windowListeners.add(Lr.ContextMenu,nv),this.documentListeners.add(Lr.Keydown,this.handleKeydown),s){if(l!=null&&l({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(sv(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(rv(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:l,onPending:c}=this.props;c(l,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(Lr.Click,s_,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Lr.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:l,initialCoordinates:c,props:u}=this,{onMove:d,options:{activationConstraint:f}}=u;if(!c)return;const p=(s=hu(t))!=null?s:Xr,g=uo(c,p);if(!l&&f){if(rv(f)){if(f.tolerance!=null&&Gh(g,f.tolerance))return this.handleCancel();if(Gh(g,f.distance))return this.handleStart()}if(sv(f)&&Gh(g,f.tolerance))return this.handleCancel();this.handlePending(f,g);return}t.cancelable&&t.preventDefault(),d(p)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===At.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const a_={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ru extends ep{constructor(t){const{event:s}=t,l=Ka(s.target);super(t,a_,l)}}Ru.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;return!s.isPrimary||s.button!==0?!1:(l?.({event:s}),!0)}}];const l_={move:{name:"mousemove"},end:{name:"mouseup"}};var Nf;(function(n){n[n.RightClick=2]="RightClick"})(Nf||(Nf={}));class Ro extends ep{constructor(t){super(t,l_,Ka(t.event.target))}}Ro.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;return s.button===Nf.RightClick?!1:(l?.({event:s}),!0)}}];const Vh={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class To extends ep{constructor(t){super(t,Vh)}static setup(){return window.addEventListener(Vh.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Vh.move.name,t)};function t(){}}}To.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;const{touches:c}=s;return c.length>1?!1:(l?.({event:s}),!0)}}];var so;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(so||(so={}));var pu;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(pu||(pu={}));function o_(n){let{acceleration:t,activator:s=so.Pointer,canScroll:l,draggingRect:c,enabled:u,interval:d=5,order:f=pu.TreeOrder,pointerCoordinates:p,scrollableAncestors:g,scrollableAncestorRects:y,delta:v,threshold:x}=n;const S=u_({delta:v,disabled:!u}),[C,E]=_j(),_=w.useRef({x:0,y:0}),T=w.useRef({x:0,y:0}),D=w.useMemo(()=>{switch(s){case so.Pointer:return p?{top:p.y,bottom:p.y,left:p.x,right:p.x}:null;case so.DraggableRect:return c}},[s,c,p]),B=w.useRef(null),P=w.useCallback(()=>{const j=B.current;if(!j)return;const M=_.current.x*T.current.x,A=_.current.y*T.current.y;j.scrollBy(M,A)},[]),$=w.useMemo(()=>f===pu.TreeOrder?[...g].reverse():g,[f,g]);w.useEffect(()=>{if(!u||!g.length||!D){E();return}for(const j of $){if(l?.(j)===!1)continue;const M=g.indexOf(j),A=y[M];if(!A)continue;const{direction:F,speed:Q}=Jj(j,A,D,t,x);for(const G of["x","y"])S[G][F[G]]||(Q[G]=0,F[G]=0);if(Q.x>0||Q.y>0){E(),B.current=j,C(P,d),_.current=Q,T.current=F;return}}_.current={x:0,y:0},T.current={x:0,y:0},E()},[t,P,l,E,u,d,JSON.stringify(D),JSON.stringify(S),C,g,$,y,JSON.stringify(x)])}const c_={x:{[Bn.Backward]:!1,[Bn.Forward]:!1},y:{[Bn.Backward]:!1,[Bn.Forward]:!1}};function u_(n){let{delta:t,disabled:s}=n;const l=du(t);return Eo(c=>{if(s||!l||!c)return c_;const u={x:Math.sign(t.x-l.x),y:Math.sign(t.y-l.y)};return{x:{[Bn.Backward]:c.x[Bn.Backward]||u.x===-1,[Bn.Forward]:c.x[Bn.Forward]||u.x===1},y:{[Bn.Backward]:c.y[Bn.Backward]||u.y===-1,[Bn.Forward]:c.y[Bn.Forward]||u.y===1}}},[s,t,l])}function d_(n,t){const s=t!=null?n.get(t):void 0,l=s?s.node.current:null;return Eo(c=>{var u;return t==null?null:(u=l??c)!=null?u:null},[l,t])}function h_(n,t){return w.useMemo(()=>n.reduce((s,l)=>{const{sensor:c}=l,u=c.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,l)}));return[...s,...u]},[]),[n,t])}var ho;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(ho||(ho={}));var Rf;(function(n){n.Optimized="optimized"})(Rf||(Rf={}));const iv=new Map;function f_(n,t){let{dragging:s,dependencies:l,config:c}=t;const[u,d]=w.useState(null),{frequency:f,measure:p,strategy:g}=c,y=w.useRef(n),v=_(),x=co(v),S=w.useCallback(function(T){T===void 0&&(T=[]),!x.current&&d(D=>D===null?T:D.concat(T.filter(B=>!D.includes(B))))},[x]),C=w.useRef(null),E=Eo(T=>{if(v&&!s)return iv;if(!T||T===iv||y.current!==n||u!=null){const D=new Map;for(let B of n){if(!B)continue;if(u&&u.length>0&&!u.includes(B.id)&&B.rect.current){D.set(B.id,B.rect.current);continue}const P=B.node.current,$=P?new Zf(p(P),P):null;B.rect.current=$,$&&D.set(B.id,$)}return D}return T},[n,u,s,v,p]);return w.useEffect(()=>{y.current=n},[n]),w.useEffect(()=>{v||S()},[s,v]),w.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),w.useEffect(()=>{v||typeof f!="number"||C.current!==null||(C.current=setTimeout(()=>{S(),C.current=null},f))},[f,v,S,...l]),{droppableRects:E,measureDroppableContainers:S,measuringScheduled:u!=null};function _(){switch(g){case ho.Always:return!1;case ho.BeforeDragging:return s;default:return!s}}}function tp(n,t){return Eo(s=>n?s||(typeof t=="function"?t(n):n):null,[t,n])}function p_(n,t){return tp(n,t)}function m_(n){let{callback:t,disabled:s}=n;const l=Cu(t),c=w.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(l)},[l,s]);return w.useEffect(()=>()=>c?.disconnect(),[c]),c}function Tu(n){let{callback:t,disabled:s}=n;const l=Cu(t),c=w.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(l)},[s]);return w.useEffect(()=>()=>c?.disconnect(),[c]),c}function g_(n){return new Zf(Wa(n),n)}function av(n,t,s){t===void 0&&(t=g_);const[l,c]=w.useState(null);function u(){c(p=>{if(!n)return null;if(n.isConnected===!1){var g;return(g=p??s)!=null?g:null}const y=t(n);return JSON.stringify(p)===JSON.stringify(y)?p:y})}const d=m_({callback(p){if(n)for(const g of p){const{type:y,target:v}=g;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),f=Tu({callback:u});return Wr(()=>{u(),n?(f?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(f?.disconnect(),d?.disconnect())},[n]),l}function y_(n){const t=tp(n);return Y0(n,t)}const lv=[];function v_(n){const t=w.useRef(n),s=Eo(l=>n?l&&l!==lv&&n&&t.current&&n.parentNode===t.current.parentNode?l:Nu(n):lv,[n]);return w.useEffect(()=>{t.current=n},[n]),s}function x_(n){const[t,s]=w.useState(null),l=w.useRef(n),c=w.useCallback(u=>{const d=Fh(u.target);d&&s(f=>f?(f.set(d,Ef(d)),new Map(f)):null)},[]);return w.useEffect(()=>{const u=l.current;if(n!==u){d(u);const f=n.map(p=>{const g=Fh(p);return g?(g.addEventListener("scroll",c,{passive:!0}),[g,Ef(g)]):null}).filter(p=>p!=null);s(f.length?new Map(f):null),l.current=n}return()=>{d(n),d(u)};function d(f){f.forEach(p=>{const g=Fh(p);g?.removeEventListener("scroll",c)})}},[c,n]),w.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>Ha(u,d),Xr):ex(n):Xr,[n,t])}function ov(n,t){t===void 0&&(t=[]);const s=w.useRef(null);return w.useEffect(()=>{s.current=null},t),w.useEffect(()=>{const l=n!==Xr;l&&!s.current&&(s.current=n),!l&&s.current&&(s.current=null)},[n]),s.current?uo(n,s.current):Xr}function b_(n){w.useEffect(()=>{if(!_u)return;const t=n.map(s=>{let{sensor:l}=s;return l.setup==null?void 0:l.setup()});return()=>{for(const s of t)s?.()}},n.map(t=>{let{sensor:s}=t;return s}))}function w_(n,t){return w.useMemo(()=>n.reduce((s,l)=>{let{eventName:c,handler:u}=l;return s[c]=d=>{u(d,t)},s},{}),[n,t])}function rx(n){return w.useMemo(()=>n?Kj(n):null,[n])}const cv=[];function S_(n,t){t===void 0&&(t=Wa);const[s]=n,l=rx(s?rr(s):null),[c,u]=w.useState(cv);function d(){u(()=>n.length?n.map(p=>J0(p)?l:new Zf(t(p),p)):cv)}const f=Tu({callback:d});return Wr(()=>{f?.disconnect(),d(),n.forEach(p=>f?.observe(p))},[n]),c}function sx(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return Co(t)?t:n}function j_(n){let{measure:t}=n;const[s,l]=w.useState(null),c=w.useCallback(g=>{for(const{target:y}of g)if(Co(y)){l(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=Tu({callback:c}),d=w.useCallback(g=>{const y=sx(g);u?.disconnect(),y&&u?.observe(y),l(y?t(y):null)},[t,u]),[f,p]=uu(d);return w.useMemo(()=>({nodeRef:f,rect:s,setRef:p}),[s,f,p])}const __=[{sensor:Ru,options:{}},{sensor:Xa,options:{}}],C_={current:{}},iu={draggable:{measure:tv},droppable:{measure:tv,strategy:ho.WhileDragging,frequency:Rf.Optimized},dragOverlay:{measure:Wa}};class io extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,l;return(s=(l=this.get(t))==null?void 0:l.node.current)!=null?s:void 0}}const E_={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new io,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:fu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:iu,measureDroppableContainers:fu,windowRect:null,measuringScheduled:!1},ix={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:fu,draggableNodes:new Map,over:null,measureDroppableContainers:fu},Ao=w.createContext(ix),ax=w.createContext(E_);function N_(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new io}}}function R_(n,t){switch(t.type){case Dn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Dn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case Dn.DragEnd:case Dn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Dn.RegisterDroppable:{const{element:s}=t,{id:l}=s,c=new io(n.droppable.containers);return c.set(l,s),{...n,droppable:{...n.droppable,containers:c}}}case Dn.SetDroppableDisabled:{const{id:s,key:l,disabled:c}=t,u=n.droppable.containers.get(s);if(!u||l!==u.key)return n;const d=new io(n.droppable.containers);return d.set(s,{...u,disabled:c}),{...n,droppable:{...n.droppable,containers:d}}}case Dn.UnregisterDroppable:{const{id:s,key:l}=t,c=n.droppable.containers.get(s);if(!c||l!==c.key)return n;const u=new io(n.droppable.containers);return u.delete(s),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function T_(n){let{disabled:t}=n;const{active:s,activatorEvent:l,draggableNodes:c}=w.useContext(Ao),u=du(l),d=du(s?.id);return w.useEffect(()=>{if(!t&&!l&&u&&d!=null){if(!Eu(u)||document.activeElement===u.target)return;const f=c.get(d);if(!f)return;const{activatorNode:p,node:g}=f;if(!p.current&&!g.current)return;requestAnimationFrame(()=>{for(const y of[p.current,g.current]){if(!y)continue;const v=Nj(y);if(v){v.focus();break}}})}},[l,t,c,d,u]),null}function lx(n,t){let{transform:s,...l}=t;return n!=null&&n.length?n.reduce((c,u)=>u({transform:c,...l}),s):s}function A_(n){return w.useMemo(()=>({draggable:{...iu.draggable,...n?.draggable},droppable:{...iu.droppable,...n?.droppable},dragOverlay:{...iu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function k_(n){let{activeNode:t,measure:s,initialRect:l,config:c=!0}=n;const u=w.useRef(!1),{x:d,y:f}=typeof c=="boolean"?{x:c,y:c}:c;Wr(()=>{if(!d&&!f||!t){u.current=!1;return}if(u.current||!l)return;const g=t?.node.current;if(!g||g.isConnected===!1)return;const y=s(g),v=Y0(y,l);if(d||(v.x=0),f||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=Q0(g);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,f,l,s])}const Au=w.createContext({...Xr,scaleX:1,scaleY:1});var oi;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(oi||(oi={}));const Pi=w.memo(function(t){var s,l,c,u;let{id:d,accessibility:f,autoScroll:p=!0,children:g,sensors:y=__,collisionDetection:v=qj,measuring:x,modifiers:S,...C}=t;const E=w.useReducer(R_,void 0,N_),[_,T]=E,[D,B]=Dj(),[P,$]=w.useState(oi.Uninitialized),j=P===oi.Initialized,{draggable:{active:M,nodes:A,translate:F},droppable:{containers:Q}}=_,G=M!=null?A.get(M):null,H=w.useRef({initial:null,translated:null}),W=w.useMemo(()=>{var Lt;return M!=null?{id:M,data:(Lt=G?.data)!=null?Lt:C_,rect:H}:null},[M,G]),z=w.useRef(null),[I,N]=w.useState(null),[L,K]=w.useState(null),oe=co(C,Object.values(C)),he=No("DndDescribedBy",d),U=w.useMemo(()=>Q.getEnabled(),[Q]),V=A_(x),{droppableRects:k,measureDroppableContainers:te,measuringScheduled:de}=f_(U,{dragging:j,dependencies:[F.x,F.y],config:V.droppable}),fe=d_(A,M),J=w.useMemo(()=>L?hu(L):null,[L]),q=nn(),le=p_(fe,V.draggable.measure);k_({activeNode:M!=null?A.get(M):null,config:q.layoutShiftCompensation,initialRect:le,measure:V.draggable.measure});const ge=av(fe,V.draggable.measure,le),Ne=av(fe?fe.parentElement:null),_e=w.useRef({activatorEvent:null,active:null,activeNode:fe,collisionRect:null,collisions:null,droppableRects:k,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:Q,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Me=Q.getNodeFor((s=_e.current.over)==null?void 0:s.id),Pe=j_({measure:V.dragOverlay.measure}),me=(l=Pe.nodeRef.current)!=null?l:fe,Qe=j?(c=Pe.rect)!=null?c:ge:null,Xe=!!(Pe.nodeRef.current&&Pe.rect),bt=y_(Xe?null:ge),Nt=rx(me?rr(me):null),mt=v_(j?Me??fe:null),et=S_(mt),ct=lx(S,{transform:{x:F.x-bt.x,y:F.y-bt.y,scaleX:1,scaleY:1},activatorEvent:L,active:W,activeNodeRect:ge,containerNodeRect:Ne,draggingNodeRect:Qe,over:_e.current.over,overlayNodeRect:Pe.rect,scrollableAncestors:mt,scrollableAncestorRects:et,windowRect:Nt}),wt=J?Ha(J,F):null,St=x_(mt),jt=ov(St),lt=ov(St,[ge]),ut=Ha(ct,jt),Rt=Qe?Gj(Qe,ct):null,Tn=W&&Rt?v({active:W,collisionRect:Rt,droppableRects:k,droppableContainers:U,pointerCoordinates:wt}):null,zn=G0(Tn,"id"),[Ut,Er]=w.useState(null),qn=Xe?ct:Ha(ct,lt),Xt=Hj(qn,(u=Ut?.rect)!=null?u:null,ge),an=w.useRef(null),ln=w.useCallback((Lt,Je)=>{let{sensor:Bt,options:pn}=Je;if(z.current==null)return;const cn=A.get(z.current);if(!cn)return;const Ot=Lt.nativeEvent,mn=new Bt({active:z.current,activeNode:cn,event:Ot,options:pn,context:_e,onAbort(gt){if(!A.get(gt))return;const{onDragAbort:Be}=oe.current,X={id:gt};Be?.(X),D({type:"onDragAbort",event:X})},onPending(gt,ne,Be,X){if(!A.get(gt))return;const{onDragPending:ae}=oe.current,xe={id:gt,constraint:ne,initialCoordinates:Be,offset:X};ae?.(xe),D({type:"onDragPending",event:xe})},onStart(gt){const ne=z.current;if(ne==null)return;const Be=A.get(ne);if(!Be)return;const{onDragStart:X}=oe.current,re={activatorEvent:Ot,active:{id:ne,data:Be.data,rect:H}};$a.unstable_batchedUpdates(()=>{X?.(re),$(oi.Initializing),T({type:Dn.DragStart,initialCoordinates:gt,active:ne}),D({type:"onDragStart",event:re}),N(an.current),K(Ot)})},onMove(gt){T({type:Dn.DragMove,coordinates:gt})},onEnd:kt(Dn.DragEnd),onCancel:kt(Dn.DragCancel)});an.current=mn;function kt(gt){return async function(){const{active:Be,collisions:X,over:re,scrollAdjustedTranslate:ae}=_e.current;let xe=null;if(Be&&ae){const{cancelDrop:Re}=oe.current;xe={activatorEvent:Ot,active:Be,collisions:X,delta:ae,over:re},gt===Dn.DragEnd&&typeof Re=="function"&&await Promise.resolve(Re(xe))&&(gt=Dn.DragCancel)}z.current=null,$a.unstable_batchedUpdates(()=>{T({type:gt}),$(oi.Uninitialized),Er(null),N(null),K(null),an.current=null;const Re=gt===Dn.DragEnd?"onDragEnd":"onDragCancel";if(xe){const $e=oe.current[Re];$e?.(xe),D({type:Re,event:xe})}})}}},[A]),on=w.useCallback((Lt,Je)=>(Bt,pn)=>{const cn=Bt.nativeEvent,Ot=A.get(pn);if(z.current!==null||!Ot||cn.dndKit||cn.defaultPrevented)return;const mn={active:Ot};Lt(Bt,Je.options,mn)===!0&&(cn.dndKit={capturedBy:Je.sensor},z.current=pn,ln(Bt,Je))},[A,ln]),tn=h_(y,on);b_(y),Wr(()=>{ge&&P===oi.Initializing&&$(oi.Initialized)},[ge,P]),w.useEffect(()=>{const{onDragMove:Lt}=oe.current,{active:Je,activatorEvent:Bt,collisions:pn,over:cn}=_e.current;if(!Je||!Bt)return;const Ot={active:Je,activatorEvent:Bt,collisions:pn,delta:{x:ut.x,y:ut.y},over:cn};$a.unstable_batchedUpdates(()=>{Lt?.(Ot),D({type:"onDragMove",event:Ot})})},[ut.x,ut.y]),w.useEffect(()=>{const{active:Lt,activatorEvent:Je,collisions:Bt,droppableContainers:pn,scrollAdjustedTranslate:cn}=_e.current;if(!Lt||z.current==null||!Je||!cn)return;const{onDragOver:Ot}=oe.current,mn=pn.get(zn),kt=mn&&mn.rect.current?{id:mn.id,rect:mn.rect.current,data:mn.data,disabled:mn.disabled}:null,gt={active:Lt,activatorEvent:Je,collisions:Bt,delta:{x:cn.x,y:cn.y},over:kt};$a.unstable_batchedUpdates(()=>{Er(kt),Ot?.(gt),D({type:"onDragOver",event:gt})})},[zn]),Wr(()=>{_e.current={activatorEvent:L,active:W,activeNode:fe,collisionRect:Rt,collisions:Tn,droppableRects:k,draggableNodes:A,draggingNode:me,draggingNodeRect:Qe,droppableContainers:Q,over:Ut,scrollableAncestors:mt,scrollAdjustedTranslate:ut},H.current={initial:Qe,translated:Rt}},[W,fe,Tn,Rt,A,me,Qe,k,Q,Ut,mt,ut]),o_({...q,delta:F,draggingRect:Rt,pointerCoordinates:wt,scrollableAncestors:mt,scrollableAncestorRects:et});const $r=w.useMemo(()=>({active:W,activeNode:fe,activeNodeRect:ge,activatorEvent:L,collisions:Tn,containerNodeRect:Ne,dragOverlay:Pe,draggableNodes:A,droppableContainers:Q,droppableRects:k,over:Ut,measureDroppableContainers:te,scrollableAncestors:mt,scrollableAncestorRects:et,measuringConfiguration:V,measuringScheduled:de,windowRect:Nt}),[W,fe,ge,L,Tn,Ne,Pe,A,Q,k,Ut,te,mt,et,V,de,Nt]),Un=w.useMemo(()=>({activatorEvent:L,activators:tn,active:W,activeNodeRect:ge,ariaDescribedById:{draggable:he},dispatch:T,draggableNodes:A,over:Ut,measureDroppableContainers:te}),[L,tn,W,ge,T,he,A,Ut,te]);return Ae.createElement(F0.Provider,{value:B},Ae.createElement(Ao.Provider,{value:Un},Ae.createElement(ax.Provider,{value:$r},Ae.createElement(Au.Provider,{value:Xt},g)),Ae.createElement(T_,{disabled:f?.restoreFocus===!1})),Ae.createElement(Uj,{...f,hiddenTextDescribedById:he}));function nn(){const Lt=I?.autoScrollEnabled===!1,Je=typeof p=="object"?p.enabled===!1:p===!1,Bt=j&&!Lt&&!Je;return typeof p=="object"?{...p,enabled:Bt}:{enabled:Bt}}}),O_=w.createContext(null),uv="button",D_="Draggable";function np(n){let{id:t,data:s,disabled:l=!1,attributes:c}=n;const u=No(D_),{activators:d,activatorEvent:f,active:p,activeNodeRect:g,ariaDescribedById:y,draggableNodes:v,over:x}=w.useContext(Ao),{role:S=uv,roleDescription:C="draggable",tabIndex:E=0}=c??{},_=p?.id===t,T=w.useContext(_?Au:O_),[D,B]=uu(),[P,$]=uu(),j=w_(d,t),M=co(s);Wr(()=>(v.set(t,{id:t,key:u,node:D,activatorNode:P,data:M}),()=>{const F=v.get(t);F&&F.key===u&&v.delete(t)}),[v,t]);const A=w.useMemo(()=>({role:S,tabIndex:E,"aria-disabled":l,"aria-pressed":_&&S===uv?!0:void 0,"aria-roledescription":C,"aria-describedby":y.draggable}),[l,S,E,_,C,y.draggable]);return{active:p,activatorEvent:f,activeNodeRect:g,attributes:A,isDragging:_,listeners:l?void 0:j,node:D,over:x,setNodeRef:B,setActivatorNodeRef:$,transform:T}}function ox(){return w.useContext(ax)}const M_="Droppable",z_={timeout:25};function ko(n){let{data:t,disabled:s=!1,id:l,resizeObserverConfig:c}=n;const u=No(M_),{active:d,dispatch:f,over:p,measureDroppableContainers:g}=w.useContext(Ao),y=w.useRef({disabled:s}),v=w.useRef(!1),x=w.useRef(null),S=w.useRef(null),{disabled:C,updateMeasurementsFor:E,timeout:_}={...z_,...c},T=co(E??l),D=w.useCallback(()=>{if(!v.current){v.current=!0;return}S.current!=null&&clearTimeout(S.current),S.current=setTimeout(()=>{g(Array.isArray(T.current)?T.current:[T.current]),S.current=null},_)},[_]),B=Tu({callback:D,disabled:C||!d}),P=w.useCallback((A,F)=>{B&&(F&&(B.unobserve(F),v.current=!1),A&&B.observe(A))},[B]),[$,j]=uu(P),M=co(t);return w.useEffect(()=>{!B||!$.current||(B.disconnect(),v.current=!1,B.observe($.current))},[$,B]),w.useEffect(()=>(f({type:Dn.RegisterDroppable,element:{id:l,key:u,disabled:s,node:$,rect:x,data:M}}),()=>f({type:Dn.UnregisterDroppable,key:u,id:l})),[l]),w.useEffect(()=>{s!==y.current.disabled&&(f({type:Dn.SetDroppableDisabled,id:l,key:u,disabled:s}),y.current.disabled=s)},[l,u,s,f]),{active:d,rect:x,isOver:p?.id===l,node:$,over:p,setNodeRef:j}}function U_(n){let{animation:t,children:s}=n;const[l,c]=w.useState(null),[u,d]=w.useState(null),f=du(s);return!s&&!l&&f&&c(f),Wr(()=>{if(!u)return;const p=l?.key,g=l?.props.id;if(p==null||g==null){c(null);return}Promise.resolve(t(g,u)).then(()=>{c(null)})},[t,l,u]),Ae.createElement(Ae.Fragment,null,s,l?w.cloneElement(l,{ref:d}):null)}const L_={x:0,y:0,scaleX:1,scaleY:1};function B_(n){let{children:t}=n;return Ae.createElement(Ao.Provider,{value:ix},Ae.createElement(Au.Provider,{value:L_},t))}const I_={position:"fixed",touchAction:"none"},$_=n=>Eu(n)?"transform 250ms ease":void 0,q_=w.forwardRef((n,t)=>{let{as:s,activatorEvent:l,adjustScale:c,children:u,className:d,rect:f,style:p,transform:g,transition:y=$_}=n;if(!f)return null;const v=c?g:{...g,scaleX:1,scaleY:1},x={...I_,width:f.width,height:f.height,top:f.top,left:f.left,transform:Cr.Transform.toString(v),transformOrigin:c&&l?Lj(l,f):void 0,transition:typeof y=="function"?y(l):y,...p};return Ae.createElement(s,{className:d,style:x,ref:t},u)}),rp=n=>t=>{let{active:s,dragOverlay:l}=t;const c={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[f,p]of Object.entries(u.active))p!==void 0&&(c[f]=s.node.style.getPropertyValue(f),s.node.style.setProperty(f,p));if(u!=null&&u.dragOverlay)for(const[f,p]of Object.entries(u.dragOverlay))p!==void 0&&l.node.style.setProperty(f,p);return d!=null&&d.active&&s.node.classList.add(d.active),d!=null&&d.dragOverlay&&l.node.classList.add(d.dragOverlay),function(){for(const[p,g]of Object.entries(c))s.node.style.setProperty(p,g);d!=null&&d.active&&s.node.classList.remove(d.active)}},P_=n=>{let{transform:{initial:t,final:s}}=n;return[{transform:Cr.Transform.toString(t)},{transform:Cr.Transform.toString(s)}]},H_={duration:250,easing:"ease",keyframes:P_,sideEffects:rp({styles:{active:{opacity:"0"}}})};function F_(n){let{config:t,draggableNodes:s,droppableContainers:l,measuringConfiguration:c}=n;return Cu((u,d)=>{if(t===null)return;const f=s.get(u);if(!f)return;const p=f.node.current;if(!p)return;const g=sx(d);if(!g)return;const{transform:y}=rr(d).getComputedStyle(d),v=K0(y);if(!v)return;const x=typeof t=="function"?t:G_(t);return tx(p,c.draggable.measure),x({active:{id:u,data:f.data,node:p,rect:c.draggable.measure(p)},draggableNodes:s,dragOverlay:{node:d,rect:c.dragOverlay.measure(g)},droppableContainers:l,measuringConfiguration:c,transform:v})})}function G_(n){const{duration:t,easing:s,sideEffects:l,keyframes:c}={...H_,...n};return u=>{let{active:d,dragOverlay:f,transform:p,...g}=u;if(!t)return;const y={x:f.rect.left-d.rect.left,y:f.rect.top-d.rect.top},v={scaleX:p.scaleX!==1?d.rect.width*p.scaleX/f.rect.width:1,scaleY:p.scaleY!==1?d.rect.height*p.scaleY/f.rect.height:1},x={x:p.x-y.x,y:p.y-y.y,...v},S=c({...g,active:d,dragOverlay:f,transform:{initial:p,final:x}}),[C]=S,E=S[S.length-1];if(JSON.stringify(C)===JSON.stringify(E))return;const _=l?.({active:d,dragOverlay:f,...g}),T=f.node.animate(S,{duration:t,easing:s,fill:"forwards"});return new Promise(D=>{T.onfinish=()=>{_?.(),D()}})}}let dv=0;function V_(n){return w.useMemo(()=>{if(n!=null)return dv++,dv},[n])}const cx=Ae.memo(n=>{let{adjustScale:t=!1,children:s,dropAnimation:l,style:c,transition:u,modifiers:d,wrapperElement:f="div",className:p,zIndex:g=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:S,draggableNodes:C,droppableContainers:E,dragOverlay:_,over:T,measuringConfiguration:D,scrollableAncestors:B,scrollableAncestorRects:P,windowRect:$}=ox(),j=w.useContext(Au),M=V_(v?.id),A=lx(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:S,draggingNodeRect:_.rect,over:T,overlayNodeRect:_.rect,scrollableAncestors:B,scrollableAncestorRects:P,transform:j,windowRect:$}),F=tp(x),Q=F_({config:l,draggableNodes:C,droppableContainers:E,measuringConfiguration:D}),G=F?_.setRef:void 0;return Ae.createElement(B_,null,Ae.createElement(U_,{animation:Q},v&&M?Ae.createElement(q_,{key:M,id:v.id,ref:G,as:f,activatorEvent:y,adjustScale:t,className:p,transition:u,rect:F,style:{zIndex:g,...c},transform:A},s):null))});function Hi(n,t,s){const l=n.slice();return l.splice(s<0?l.length+s:s,0,l.splice(t,1)[0]),l}function Y_(n,t){return n.reduce((s,l,c)=>{const u=t.get(l);return u&&(s[c]=u),s},Array(n.length))}function Gc(n){return n!==null&&n>=0}function K_(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==t[s])return!1;return!0}function Q_(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const sp=n=>{let{rects:t,activeIndex:s,overIndex:l,index:c}=n;const u=Hi(t,l,s),d=t[c],f=u[c];return!f||!d?null:{x:f.left-d.left,y:f.top-d.top,scaleX:f.width/d.width,scaleY:f.height/d.height}},Vc={scaleX:1,scaleY:1},fo=n=>{var t;let{activeIndex:s,activeNodeRect:l,index:c,rects:u,overIndex:d}=n;const f=(t=u[s])!=null?t:l;if(!f)return null;if(c===s){const g=u[d];return g?{x:0,y:s<d?g.top+g.height-(f.top+f.height):g.top-f.top,...Vc}:null}const p=W_(u,c,s);return c>s&&c<=d?{x:0,y:-f.height-p,...Vc}:c<s&&c>=d?{x:0,y:f.height+p,...Vc}:{x:0,y:0,...Vc}};function W_(n,t,s){const l=n[t],c=n[t-1],u=n[t+1];return l?s<t?c?l.top-(c.top+c.height):u?u.top-(l.top+l.height):0:u?u.top-(l.top+l.height):c?l.top-(c.top+c.height):0:0}const ux="Sortable",dx=Ae.createContext({activeIndex:-1,containerId:ux,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:sp,disabled:{draggable:!1,droppable:!1}});function Ga(n){let{children:t,id:s,items:l,strategy:c=sp,disabled:u=!1}=n;const{active:d,dragOverlay:f,droppableRects:p,over:g,measureDroppableContainers:y}=ox(),v=No(ux,s),x=f.rect!==null,S=w.useMemo(()=>l.map(j=>typeof j=="object"&&"id"in j?j.id:j),[l]),C=d!=null,E=d?S.indexOf(d.id):-1,_=g?S.indexOf(g.id):-1,T=w.useRef(S),D=!K_(S,T.current),B=_!==-1&&E===-1||D,P=Q_(u);Wr(()=>{D&&C&&y(S)},[D,S,C,y]),w.useEffect(()=>{T.current=S},[S]);const $=w.useMemo(()=>({activeIndex:E,containerId:v,disabled:P,disableTransforms:B,items:S,overIndex:_,useDragOverlay:x,sortedRects:Y_(S,p),strategy:c}),[E,v,P.draggable,P.droppable,B,S,_,p,x,c]);return Ae.createElement(dx.Provider,{value:$},t)}const X_=n=>{let{id:t,items:s,activeIndex:l,overIndex:c}=n;return Hi(s,l,c).indexOf(t)},J_=n=>{let{containerId:t,isSorting:s,wasDragging:l,index:c,items:u,newIndex:d,previousItems:f,previousContainerId:p,transition:g}=n;return!g||!l||f!==u&&c===d?!1:s?!0:d!==c&&t===p},Z_={duration:200,easing:"ease"},hx="transform",e1=Cr.Transition.toString({property:hx,duration:0,easing:"linear"}),t1={roleDescription:"sortable"};function n1(n){let{disabled:t,index:s,node:l,rect:c}=n;const[u,d]=w.useState(null),f=w.useRef(s);return Wr(()=>{if(!t&&s!==f.current&&l.current){const p=c.current;if(p){const g=Wa(l.current,{ignoreTransform:!0}),y={x:p.left-g.left,y:p.top-g.top,scaleX:p.width/g.width,scaleY:p.height/g.height};(y.x||y.y)&&d(y)}}s!==f.current&&(f.current=s)},[t,s,l,c]),w.useEffect(()=>{u&&d(null)},[u]),u}function Ja(n){let{animateLayoutChanges:t=J_,attributes:s,disabled:l,data:c,getNewIndex:u=X_,id:d,strategy:f,resizeObserverConfig:p,transition:g=Z_}=n;const{items:y,containerId:v,activeIndex:x,disabled:S,disableTransforms:C,sortedRects:E,overIndex:_,useDragOverlay:T,strategy:D}=w.useContext(dx),B=r1(l,S),P=y.indexOf(d),$=w.useMemo(()=>({sortable:{containerId:v,index:P,items:y},...c}),[v,c,P,y]),j=w.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:M,node:A,isOver:F,setNodeRef:Q}=ko({id:d,data:$,disabled:B.droppable,resizeObserverConfig:{updateMeasurementsFor:j,...p}}),{active:G,activatorEvent:H,activeNodeRect:W,attributes:z,setNodeRef:I,listeners:N,isDragging:L,over:K,setActivatorNodeRef:oe,transform:he}=np({id:d,data:$,attributes:{...t1,...s},disabled:B.draggable}),U=jj(Q,I),V=!!G,k=V&&!C&&Gc(x)&&Gc(_),te=!T&&L,de=te&&k?he:null,J=k?de??(f??D)({rects:E,activeNodeRect:W,activeIndex:x,overIndex:_,index:P}):null,q=Gc(x)&&Gc(_)?u({id:d,items:y,activeIndex:x,overIndex:_}):P,le=G?.id,ge=w.useRef({activeId:le,items:y,newIndex:q,containerId:v}),Ne=y!==ge.current.items,_e=t({active:G,containerId:v,isDragging:L,isSorting:V,id:d,index:P,items:y,newIndex:ge.current.newIndex,previousItems:ge.current.items,previousContainerId:ge.current.containerId,transition:g,wasDragging:ge.current.activeId!=null}),Me=n1({disabled:!_e,index:P,node:A,rect:M});return w.useEffect(()=>{V&&ge.current.newIndex!==q&&(ge.current.newIndex=q),v!==ge.current.containerId&&(ge.current.containerId=v),y!==ge.current.items&&(ge.current.items=y)},[V,q,v,y]),w.useEffect(()=>{if(le===ge.current.activeId)return;if(le!=null&&ge.current.activeId==null){ge.current.activeId=le;return}const me=setTimeout(()=>{ge.current.activeId=le},50);return()=>clearTimeout(me)},[le]),{active:G,activeIndex:x,attributes:z,data:$,rect:M,index:P,newIndex:q,items:y,isOver:F,isSorting:V,isDragging:L,listeners:N,node:A,overIndex:_,over:K,setNodeRef:U,setActivatorNodeRef:oe,setDroppableNodeRef:Q,setDraggableNodeRef:I,transform:Me??J,transition:Pe()};function Pe(){if(Me||Ne&&ge.current.newIndex===P)return e1;if(!(te&&!Eu(H)||!g)&&(V||_e))return Cr.Transition.toString({...g,property:hx})}}function r1(n,t){var s,l;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(s=n?.draggable)!=null?s:t.draggable,droppable:(l=n?.droppable)!=null?l:t.droppable}}function mu(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const s1=[At.Down,At.Right,At.Up,At.Left],ku=(n,t)=>{let{context:{active:s,collisionRect:l,droppableRects:c,droppableContainers:u,over:d,scrollableAncestors:f}}=t;if(s1.includes(n.code)){if(n.preventDefault(),!s||!l)return;const p=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=c.get(v.id);if(x)switch(n.code){case At.Down:l.top<x.top&&p.push(v);break;case At.Up:l.top>x.top&&p.push(v);break;case At.Left:l.left>x.left&&p.push(v);break;case At.Right:l.left<x.left&&p.push(v);break}});const g=Ij({collisionRect:l,droppableRects:c,droppableContainers:p});let y=G0(g,"id");if(y===d?.id&&g.length>1&&(y=g[1].id),y!=null){const v=u.get(s.id),x=u.get(y),S=x?c.get(x.id):null,C=x?.node.current;if(C&&S&&v&&x){const _=Nu(C).some((j,M)=>f[M]!==j),T=fx(v,x),D=i1(v,x),B=_||!T?{x:0,y:0}:{x:D?l.width-S.width:0,y:D?l.height-S.height:0},P={x:S.left,y:S.top};return B.x&&B.y?P:uo(P,B)}}}};function fx(n,t){return!mu(n)||!mu(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function i1(n,t){return!mu(n)||!mu(t)||!fx(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const hv=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},hi=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],a1=({recipe:n,isSelected:t,isSelectMode:s,onSelectRecipe:l,onToggleSelection:c,disableDrag:u,showOwner:d,ownerLabelFn:f})=>{const{attributes:p,listeners:g,setNodeRef:y,transform:v,transition:x,isDragging:S}=Ja({id:n.id,disabled:u}),C={transform:Cr.Transform.toString(v),transition:x,opacity:S?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"};return i.jsx("div",{ref:y,style:C,...p,...g,children:i.jsxs(fn,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some(E=>/|Dessert/i.test(E))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{s?c(n.id):l(n)},children:[i.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?i.jsx("img",{src:n.image,alt:n.title,className:"recipe-card__image",loading:"lazy",decoding:"async"}):i.jsx("div",{className:"recipe-card__image placeholder"}),i.jsx("div",{className:"recipe-card__overlay"}),s&&i.jsx("div",{className:"recipe-card__selection-overlay",children:i.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),i.jsx("div",{className:"recipe-card__tags",children:(()=>{const E=hi(n.tags);if(E.length===0)return null;const _=E.filter(B=>!B.startsWith("owner:"));return(_.includes("URL")?["URL"]:_).slice(0,1).map((B,P)=>i.jsx("span",{className:"recipe-tag",children:B},`${B}-${P}`))})()})]}),i.jsxs("div",{className:"recipe-card__content",children:[i.jsx("h3",{className:"recipe-title",children:n.title}),i.jsx("p",{className:"recipe-desc",children:n.description}),i.jsxs("div",{className:"recipe-meta",children:[n.storeName&&i.jsxs("span",{children:[" ",n.storeName]}),d&&typeof f=="function"&&i.jsxs("span",{className:"recipe-owner",children:[" ",f(n)]}),i.jsxs("div",{className:"recipe-dates",children:[i.jsxs("span",{className:"recipe-date",children:[" : ",hv(n.created_at)]}),n.updated_at&&i.jsxs("span",{className:"recipe-date",children:[" : ",hv(n.updated_at)]})]})]})]})]})})},fv=n=>{const t=hi(n.tags);return n.type==="bread"||t.some(s=>/|Bread/i.test(s))},pv=n=>{const t=l=>/|Dessert/i.test(l),s=hi(n.tags);return/|Dessert/i.test(n.category||"")||s.some(t)},mv=n=>{const t=hi(n.tags);return/|Sauce/i.test(n.category||"")||t.some(s=>/|Sauce/i.test(s))},gv=n=>{const t=hi(n.tags);return/||Decor/i.test(n.category||"")||t.some(s=>/||Decor/i.test(s))},yv=n=>{const t=n.category||"",s=hi(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||s.some(l=>/|Dressing||Vinaigrette||Mayonnaise/i.test(l))},vv=n=>{const t=n.filter(v=>fv(v)),s=n.filter(v=>!fv(v)),l=s.filter(v=>mv(v)),c=s.filter(v=>!mv(v)),u=c.filter(v=>gv(v)),d=c.filter(v=>!gv(v)),f=d.filter(v=>yv(v)),p=d.filter(v=>!yv(v)),g=p.filter(v=>pv(v));return{cookingRecipes:p.filter(v=>!pv(v)),breadRecipes:t,dessertRecipes:g,sauceRecipes:l,dressingRecipes:f,decorationRecipes:u}},xv=({recipes:n,onSelectRecipe:t,isSelectMode:s,selectedIds:l,onToggleSelection:c,disableDrag:u,displayMode:d="normal",publicRecipeView:f="none",showOwner:p=!1,ownerLabelFn:g,currentUser:y=null})=>{const[v,x]=w.useState({}),S=I=>{x(N=>({...N,[I]:!N[I]}))},C=I=>hi(I?.tags).map(L=>L.toLowerCase()).includes("public"),E=I=>{if(!y)return!1;const N=hi(I?.tags).filter(K=>K.startsWith("owner:"));if(N.length===0)return!1;const L=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return N.some(K=>L.has(K))},_=n.filter(I=>C(I)),T=_.filter(I=>E(I)),D=_.filter(I=>!E(I)),B=n.filter(I=>!C(I)),{cookingRecipes:P,breadRecipes:$,dessertRecipes:j,sauceRecipes:M,dressingRecipes:A,decorationRecipes:F}=vv(B),[Q,G]=w.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);Ae.useEffect(()=>{const I=()=>{window.innerWidth>=1024?G(9):G(8)};return window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]);const H=(I,N,L,K,{showWhenEmpty:oe=!1,emptyMessage:he=""}={})=>{if(N.length===0&&!oe)return null;const U=d==="all";let V=N,k=!1,te=!1;return U||(k=v[K],te=N.length>Q,V=k?N:N.slice(0,Q)),i.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{onClick:()=>!U&&te&&S(K),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!U&&te?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[i.jsx("span",{children:L})," ",I,i.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",N.length,")"]}),!U&&te&&i.jsx("span",{className:"section-toggle-btn",children:k?" ":" "})]}),i.jsx("div",{className:"recipe-grid",children:i.jsx(Ga,{items:V.map(de=>de.id),strategy:sp,children:V.map(de=>{const fe=l&&l.has(de.id);return i.jsx(a1,{recipe:de,isSelected:fe,isSelectMode:s,onSelectRecipe:t,onToggleSelection:c,disableDrag:u,showOwner:p,ownerLabelFn:g},de.id)})})}),N.length===0&&i.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:he||`${I}`})]})},W=()=>{if(f!=="mine"&&f!=="others")return null;const I=f==="mine",N=I?"":"",L=I?"":"",K=I?"public-mine":"public-others",oe=I?T:D,he=I?"":"",U=vv(oe);return i.jsxs("div",{className:"public-recipes-block",children:[i.jsxs("div",{className:"public-recipes-block__header",children:[i.jsx("span",{children:L}),i.jsx("span",{children:N}),i.jsxs("span",{className:"public-recipes-block__count",children:["(",oe.length,")"]})]}),oe.length===0?i.jsx("div",{className:"public-recipes-block__empty",children:he}):i.jsxs(i.Fragment,{children:[H("",U.cookingRecipes,"",`${K}-cooking`),H("",U.breadRecipes,"",`${K}-bread`),H("",U.dessertRecipes,"",`${K}-dessert`),H("",U.sauceRecipes,"",`${K}-sauce`),H("",U.dressingRecipes,"",`${K}-dressing`),H("",U.decorationRecipes,"",`${K}-decoration`)]})]})},z=f==="none"&&_.length>0&&B.length===0;return i.jsxs("div",{className:"recipe-list-container",children:[W(),z&&i.jsx("div",{className:"recipe-list-empty-hint",children:""}),H("",P,"","cooking"),H("",$,"","bread"),H("",j,"","dessert"),H("",M,"","sauce"),H("",A,"","dressing"),H("",F,"","decoration"),n.length===0&&i.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},Jn=({isOpen:n,onClose:t,title:s,children:l,size:c="medium",showCloseButton:u=!0})=>{if(w.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),w.useEffect(()=>{const f=p=>{p.key==="Escape"&&n&&t()};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[n,t]),!n)return null;const d=f=>{f.target===f.currentTarget&&t()};return i.jsx("div",{className:"modal-overlay",onClick:d,children:i.jsxs("div",{className:`modal-content modal-${c}`,children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h3",{className:"modal-title",children:s}),u&&i.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),i.jsx("div",{className:"modal-body",children:l})]})})};function Ou(n,t){var s={};for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&t.indexOf(l)<0&&(s[l]=n[l]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,l=Object.getOwnPropertySymbols(n);c<l.length;c++)t.indexOf(l[c])<0&&Object.prototype.propertyIsEnumerable.call(n,l[c])&&(s[l[c]]=n[l[c]]);return s}function l1(n,t,s,l){function c(u){return u instanceof s?u:new s(function(d){d(u)})}return new(s||(s=Promise))(function(u,d){function f(y){try{g(l.next(y))}catch(v){d(v)}}function p(y){try{g(l.throw(y))}catch(v){d(v)}}function g(y){y.done?u(y.value):c(y.value).then(f,p)}g((l=l.apply(n,t||[])).next())})}const o1=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class ip extends Error{constructor(t,s="FunctionsError",l){super(t),this.name=s,this.context=l}}class c1 extends ip{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class bv extends ip{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class wv extends ip{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Tf;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Tf||(Tf={}));class u1{constructor(t,{headers:s={},customFetch:l,region:c=Tf.Any}={}){this.url=t,this.headers=s,this.region=c,this.fetch=o1(l)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return l1(this,arguments,void 0,function*(s,l={}){var c;let u,d;try{const{headers:f,method:p,body:g,signal:y,timeout:v}=l;let x={},{region:S}=l;S||(S=this.region);const C=new URL(`${this.url}/${s}`);S&&S!=="any"&&(x["x-region"]=S,C.searchParams.set("forceFunctionRegion",S));let E;g&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)?typeof Blob<"u"&&g instanceof Blob||g instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",E=g):typeof g=="string"?(x["Content-Type"]="text/plain",E=g):typeof FormData<"u"&&g instanceof FormData?E=g:(x["Content-Type"]="application/json",E=JSON.stringify(g)):E=g;let _=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(_=d.signal,y.addEventListener("abort",()=>d.abort())):_=d.signal);const T=yield this.fetch(C.toString(),{method:p||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),f),body:E,signal:_}).catch($=>{throw new c1($)}),D=T.headers.get("x-relay-error");if(D&&D==="true")throw new bv(T);if(!T.ok)throw new wv(T);let B=((c=T.headers.get("Content-Type"))!==null&&c!==void 0?c:"text/plain").split(";")[0].trim(),P;return B==="application/json"?P=yield T.json():B==="application/octet-stream"||B==="application/pdf"?P=yield T.blob():B==="text/event-stream"?P=T:B==="multipart/form-data"?P=yield T.formData():P=yield T.text(),{data:P,error:null,response:T}}catch(f){return{data:null,error:f,response:f instanceof wv||f instanceof bv?f.context:void 0}}finally{u&&clearTimeout(u)}})}}var d1=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},h1=class{constructor(n){var t,s;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(s=n.isMaybeSingle)!==null&&s!==void 0?s:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const l=this.fetch;let c=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,f=null,p=null,g=u.status,y=u.statusText;if(u.ok){var v,x;if(s.method!=="HEAD"){var S;const T=await u.text();T===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((S=s.headers.get("Accept"))===null||S===void 0)&&S.includes("application/vnd.pgrst.plan+text"))?f=T:f=JSON.parse(T))}const E=(v=s.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),_=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");E&&_&&_.length>1&&(p=parseInt(_[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(f)&&(f.length>1?(d={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,p=null,g=406,y="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{var C;const E=await u.text();try{d=JSON.parse(E),Array.isArray(d)&&u.status===404&&(f=[],d=null,g=200,y="OK")}catch{u.status===404&&E===""?(g=204,y="No Content"):d={message:E}}if(d&&s.isMaybeSingle&&(!(d==null||(C=d.details)===null||C===void 0)&&C.includes("0 rows"))&&(d=null,g=200,y="OK"),d&&s.shouldThrowOnError)throw new d1(d)}return{error:d,data:f,count:p,status:g,statusText:y}});return this.shouldThrowOnError||(c=c.catch(u=>{var d;let f="";const p=u?.cause;if(p){var g,y,v,x;const C=(g=p?.message)!==null&&g!==void 0?g:"",E=(y=p?.code)!==null&&y!==void 0?y:"";f=`${(v=u?.name)!==null&&v!==void 0?v:"FetchError"}: ${u?.message}`,f+=`

Caused by: ${(x=p?.name)!==null&&x!==void 0?x:"Error"}: ${C}`,E&&(f+=` (${E})`),p?.stack&&(f+=`
${p.stack}`)}else{var S;f=(S=u?.stack)!==null&&S!==void 0?S:""}return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:f,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),c.then(n,t)}returns(){return this}overrideTypes(){return this}},f1=class extends h1{select(n){let t=!1;const s=(n??"*").split("").map(l=>/\s/.test(l)&&!t?"":(l==='"'&&(t=!t),l)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:s,foreignTable:l,referencedTable:c=l}={}){const u=c?`${c}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:s=t}={}){const l=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(l,`${n}`),this}range(n,t,{foreignTable:s,referencedTable:l=s}={}){const c=typeof l>"u"?"offset":`${l}.offset`,u=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(c,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:s=!1,buffers:l=!1,wal:c=!1,format:u="text"}={}){var d;const f=[n?"analyze":null,t?"verbose":null,s?"settings":null,l?"buffers":null,c?"wal":null].filter(Boolean).join("|"),p=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${p}"; options=${f};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const Sv=new RegExp("[,()]");var Ua=class extends f1{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const s=Array.from(new Set(t)).map(l=>typeof l=="string"&&Sv.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`in.(${s})`),this}notIn(n,t){const s=Array.from(new Set(t)).map(l=>typeof l=="string"&&Sv.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`not.in.(${s})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:s,type:l}={}){let c="";l==="plain"?c="pl":l==="phrase"?c="ph":l==="websearch"&&(c="w");const u=s===void 0?"":`(${s})`;return this.url.searchParams.append(n,`${c}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(n,t,s){return this.url.searchParams.append(n,`not.${t}.${s}`),this}or(n,{foreignTable:t,referencedTable:s=t}={}){const l=s?`${s}.or`:"or";return this.url.searchParams.append(l,`(${n})`),this}filter(n,t,s){return this.url.searchParams.append(n,`${t}.${s}`),this}},p1=class{constructor(n,{headers:t={},schema:s,fetch:l}){this.url=n,this.headers=new Headers(t),this.schema=s,this.fetch=l}select(n,t){const{head:s=!1,count:l}=t??{},c=s?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(f=>/\s/.test(f)&&!u?"":(f==='"'&&(u=!u),f)).join("");return this.url.searchParams.set("select",d),l&&this.headers.append("Prefer",`count=${l}`),new Ua({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:t,defaultToNull:s=!0}={}){var l;const c="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(u.length>0){const d=[...new Set(u)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new Ua({method:c,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(n,{onConflict:t,ignoreDuplicates:s=!1,count:l,defaultToNull:c=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const f=n.reduce((p,g)=>p.concat(Object.keys(g)),[]);if(f.length>0){const p=[...new Set(f)].map(g=>`"${g}"`);this.url.searchParams.set("columns",p.join(","))}}return new Ua({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(n,{count:t}={}){var s;const l="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Ua({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:n}={}){var t;const s="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new Ua({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},m1=class px{constructor(t,{headers:s={},schema:l,fetch:c}={}){this.url=t,this.headers=new Headers(s),this.schemaName=l,this.fetch=c}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new p1(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new px(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:l=!1,get:c=!1,count:u}={}){var d;let f;const p=new URL(`${this.url}/rpc/${t}`);let g;l||c?(f=l?"HEAD":"GET",Object.entries(s).filter(([v,x])=>x!==void 0).map(([v,x])=>[v,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([v,x])=>{p.searchParams.append(v,x)})):(f="POST",g=s);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new Ua({method:f,url:p,headers:y,schema:this.schemaName,body:g,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}};class g1{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const s=process.versions;if(s&&s.node){const l=s.node,c=parseInt(l.replace(/^v/,"").split(".")[0]);return c>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${c} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${c} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const l=this.getWebSocketConstructor();return new l(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const y1="2.89.0",v1=`realtime-js/${y1}`,mx="1.0.0",x1="2.0.0",jv=mx,Af=1e4,b1=1e3,w1=100;var ci;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(ci||(ci={}));var On;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(On||(On={}));var Qr;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Qr||(Qr={}));var kf;(function(n){n.websocket="websocket"})(kf||(kf={}));var Bi;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Bi||(Bi={}));class S1{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,s){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return s(this._binaryEncodeUserBroadcastPush(t));let l=[t.join_ref,t.ref,t.topic,t.event,t.payload];return s(JSON.stringify(l))}_binaryEncodeUserBroadcastPush(t){var s;return this._isArrayBuffer((s=t.payload)===null||s===void 0?void 0:s.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var s,l;const c=(l=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&l!==void 0?l:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,c)}_encodeJsonUserBroadcastPush(t){var s,l;const c=(l=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&l!==void 0?l:{},d=new TextEncoder().encode(JSON.stringify(c)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,s,l){var c,u;const d=t.topic,f=(c=t.ref)!==null&&c!==void 0?c:"",p=(u=t.join_ref)!==null&&u!==void 0?u:"",g=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(p.length>255)throw new Error(`joinRef length ${p.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`ref length ${f.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`userEvent length ${g.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+p.length+f.length+d.length+g.length+v.length,S=new ArrayBuffer(this.HEADER_LENGTH+x);let C=new DataView(S),E=0;C.setUint8(E++,this.KINDS.userBroadcastPush),C.setUint8(E++,p.length),C.setUint8(E++,f.length),C.setUint8(E++,d.length),C.setUint8(E++,g.length),C.setUint8(E++,v.length),C.setUint8(E++,s),Array.from(p,T=>C.setUint8(E++,T.charCodeAt(0))),Array.from(f,T=>C.setUint8(E++,T.charCodeAt(0))),Array.from(d,T=>C.setUint8(E++,T.charCodeAt(0))),Array.from(g,T=>C.setUint8(E++,T.charCodeAt(0))),Array.from(v,T=>C.setUint8(E++,T.charCodeAt(0)));var _=new Uint8Array(S.byteLength+l.byteLength);return _.set(new Uint8Array(S),0),_.set(new Uint8Array(l),S.byteLength),_.buffer}decode(t,s){if(this._isArrayBuffer(t)){let l=this._binaryDecode(t);return s(l)}if(typeof t=="string"){const l=JSON.parse(t),[c,u,d,f,p]=l;return s({join_ref:c,ref:u,topic:d,event:f,payload:p})}return s({})}_binaryDecode(t){const s=new DataView(t),l=s.getUint8(0),c=new TextDecoder;if(l===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,s,c)}_decodeUserBroadcast(t,s,l){const c=s.getUint8(1),u=s.getUint8(2),d=s.getUint8(3),f=s.getUint8(4);let p=this.HEADER_LENGTH+4;const g=l.decode(t.slice(p,p+c));p=p+c;const y=l.decode(t.slice(p,p+u));p=p+u;const v=l.decode(t.slice(p,p+d));p=p+d;const x=t.slice(p,t.byteLength),S=f===this.JSON_ENCODING?JSON.parse(l.decode(x)):x,C={type:this.BROADCAST_EVENT,event:y,payload:S};return d>0&&(C.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:g,event:this.BROADCAST_EVENT,payload:C}}_isArrayBuffer(t){var s;return t instanceof ArrayBuffer||((s=t?.constructor)===null||s===void 0?void 0:s.name)==="ArrayBuffer"}_pick(t,s){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([l])=>s.includes(l)))}}class gx{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Wt;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Wt||(Wt={}));const _v=(n,t,s={})=>{var l;const c=(l=s.skipTypes)!==null&&l!==void 0?l:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=j1(d,n,t,c),u),{}):{}},j1=(n,t,s,l)=>{const c=t.find(f=>f.name===n),u=c?.type,d=s[n];return u&&!l.includes(u)?yx(u,d):Of(d)},yx=(n,t)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return N1(t,s)}switch(n){case Wt.bool:return _1(t);case Wt.float4:case Wt.float8:case Wt.int2:case Wt.int4:case Wt.int8:case Wt.numeric:case Wt.oid:return C1(t);case Wt.json:case Wt.jsonb:return E1(t);case Wt.timestamp:return R1(t);case Wt.abstime:case Wt.date:case Wt.daterange:case Wt.int4range:case Wt.int8range:case Wt.money:case Wt.reltime:case Wt.text:case Wt.time:case Wt.timestamptz:case Wt.timetz:case Wt.tsrange:case Wt.tstzrange:return Of(t);default:return Of(t)}},Of=n=>n,_1=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},C1=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},E1=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},N1=(n,t)=>{if(typeof n!="string")return n;const s=n.length-1,l=n[s];if(n[0]==="{"&&l==="}"){let u;const d=n.slice(1,s);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(f=>yx(t,f))}return n},R1=n=>typeof n=="string"?n.replace(" ","T"):n,vx=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Yh{constructor(t,s,l={},c=Af){this.channel=t,this.event=s,this.payload=l,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var l;return this._hasReceived(t)&&s((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(l=>l.status===t).forEach(l=>l.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Cv;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Cv||(Cv={}));class ao{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},c=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ao.syncState(this.state,c,u,d),this.pendingDiffs.forEach(p=>{this.state=ao.syncDiff(this.state,p,u,d)}),this.pendingDiffs=[],f()}),this.channel._on(l.diff,{},c=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=ao.syncDiff(this.state,c,u,d),f())}),this.onJoin((c,u,d)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:u,newPresences:d})}),this.onLeave((c,u,d)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,l,c){const u=this.cloneDeep(t),d=this.transformState(s),f={},p={};return this.map(u,(g,y)=>{d[g]||(p[g]=y)}),this.map(d,(g,y)=>{const v=u[g];if(v){const x=y.map(_=>_.presence_ref),S=v.map(_=>_.presence_ref),C=y.filter(_=>S.indexOf(_.presence_ref)<0),E=v.filter(_=>x.indexOf(_.presence_ref)<0);C.length>0&&(f[g]=C),E.length>0&&(p[g]=E)}else f[g]=y}),this.syncDiff(u,{joins:f,leaves:p},l,c)}static syncDiff(t,s,l,c){const{joins:u,leaves:d}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return l||(l=()=>{}),c||(c=()=>{}),this.map(u,(f,p)=>{var g;const y=(g=t[f])!==null&&g!==void 0?g:[];if(t[f]=this.cloneDeep(p),y.length>0){const v=t[f].map(S=>S.presence_ref),x=y.filter(S=>v.indexOf(S.presence_ref)<0);t[f].unshift(...x)}l(f,y,p)}),this.map(d,(f,p)=>{let g=t[f];if(!g)return;const y=p.map(v=>v.presence_ref);g=g.filter(v=>y.indexOf(v.presence_ref)<0),t[f]=g,c(f,g,p),g.length===0&&delete t[f]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(l=>s(l,t[l]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,l)=>{const c=t[l];return"metas"in c?s[l]=c.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):s[l]=c,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ev;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Ev||(Ev={}));var lo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(lo||(lo={}));var Cs;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Cs||(Cs={}));class qa{constructor(t,s={config:{}},l){var c,u;if(this.topic=t,this.params=s,this.socket=l,this.bindings={},this.state=On.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new Yh(this,Qr.join,this.params,this.timeout),this.rejoinTimer=new gx(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=On.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=On.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=On.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=On.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=On.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Qr.reply,{},(d,f)=>{this._trigger(this._replyEventName(f),d)}),this.presence=new ao(this),this.broadcastEndpointURL=vx(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(c=this.params.config)===null||c===void 0?void 0:c.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,s=this.timeout){var l,c,u;if(this.socket.isConnected()||this.socket.connect(),this.state==On.closed){const{config:{broadcast:d,presence:f,private:p}}=this.params,g=(c=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(S=>S.filter))!==null&&c!==void 0?c:[],y=!!this.bindings[lo.PRESENCE]&&this.bindings[lo.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},f),{enabled:y}),postgres_changes:g,private:p};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(S=>t?.(Cs.CHANNEL_ERROR,S)),this._onClose(()=>t?.(Cs.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:S})=>{var C;if(this.socket._isManualToken()||this.socket.setAuth(),S===void 0){t?.(Cs.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,_=(C=E?.length)!==null&&C!==void 0?C:0,T=[];for(let D=0;D<_;D++){const B=E[D],{filter:{event:P,schema:$,table:j,filter:M}}=B,A=S&&S[D];if(A&&A.event===P&&qa.isFilterValueEqual(A.schema,$)&&qa.isFilterValueEqual(A.table,j)&&qa.isFilterValueEqual(A.filter,M))T.push(Object.assign(Object.assign({},B),{id:A.id}));else{this.unsubscribe(),this.state=On.errored,t?.(Cs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=T,t&&t(Cs.SUBSCRIBED);return}}).receive("error",S=>{this.state=On.errored,t?.(Cs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{t?.(Cs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,l){return this.state===On.joined&&t===lo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,s,l)}async httpSend(t,s,l={}){var c;if(s==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:s,private:this.private}]})},f=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(c=l.timeout)!==null&&c!==void 0?c:this.timeout);if(f.status===202)return{success:!0};let p=f.statusText;try{const g=await f.json();p=g.error||g.message||p}catch{}return Promise.reject(new Error(p))}async send(t,s={}){var l,c;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,f={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(f.Authorization=`Bearer ${this.socket.accessTokenValue}`);const p={method:"POST",headers:f,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const g=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(l=s.timeout)!==null&&l!==void 0?l:this.timeout);return await((c=g.body)===null||c===void 0?void 0:c.cancel()),g.ok?"ok":"error"}catch(g){return g.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,f,p;const g=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((p=(f=(d=this.params)===null||d===void 0?void 0:d.config)===null||f===void 0?void 0:f.broadcast)===null||p===void 0)&&p.ack)&&u("ok"),g.receive("ok",()=>u("ok")),g.receive("error",()=>u("error")),g.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=On.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Qr.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(c=>{l=new Yh(this,Qr.leave,{},t),l.receive("ok",()=>{s(),c("ok")}).receive("timeout",()=>{s(),c("timed out")}).receive("error",()=>{c("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=On.closed,this.bindings={}}async _fetchWithTimeout(t,s,l){const c=new AbortController,u=setTimeout(()=>c.abort(),l),d=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:c.signal}));return clearTimeout(u),d}_push(t,s,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new Yh(this,t,s,l);return this._canPush()?c.send():this._addToPushBuffer(c),c}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>w1){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,l){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,l){var c,u;const d=t.toLocaleLowerCase(),{close:f,error:p,leave:g,join:y}=Qr;if(l&&[f,p,g,y].indexOf(d)>=0&&l!==this._joinRef())return;let x=this._onMessage(d,s,l);if(s&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(S=>{var C,E,_;return((C=S.filter)===null||C===void 0?void 0:C.event)==="*"||((_=(E=S.filter)===null||E===void 0?void 0:E.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===d}).map(S=>S.callback(x,l)):(u=this.bindings[d])===null||u===void 0||u.filter(S=>{var C,E,_,T,D,B;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in S){const P=S.id,$=(C=S.filter)===null||C===void 0?void 0:C.event;return P&&((E=s.ids)===null||E===void 0?void 0:E.includes(P))&&($==="*"||$?.toLocaleLowerCase()===((_=s.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const P=(D=(T=S?.filter)===null||T===void 0?void 0:T.event)===null||D===void 0?void 0:D.toLocaleLowerCase();return P==="*"||P===((B=s?.event)===null||B===void 0?void 0:B.toLocaleLowerCase())}else return S.type.toLocaleLowerCase()===d}).map(S=>{if(typeof x=="object"&&"ids"in x){const C=x.data,{schema:E,table:_,commit_timestamp:T,type:D,errors:B}=C;x=Object.assign(Object.assign({},{schema:E,table:_,commit_timestamp:T,eventType:D,new:{},old:{},errors:B}),this._getPayloadRecords(C))}S.callback(x,l)})}_isClosed(){return this.state===On.closed}_isJoined(){return this.state===On.joined}_isJoining(){return this.state===On.joining}_isLeaving(){return this.state===On.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,l){const c=t.toLocaleLowerCase(),u={type:c,filter:s,callback:l};return this.bindings[c]?this.bindings[c].push(u):this.bindings[c]=[u],this}_off(t,s){const l=t.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(c=>{var u;return!(((u=c.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===l&&qa.isEqual(c.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(t[l]!==s[l])return!1;return!0}static isFilterValueEqual(t,s){return(t??void 0)===(s??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Qr.close,{},t)}_onError(t){this._on(Qr.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=On.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=_v(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=_v(t.columns,t.old_record)),s}}const Kh=()=>{},Yc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},T1=[1e3,2e3,5e3,1e4],A1=1e4,k1=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class O1{constructor(t,s){var l;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Af,this.transport=null,this.heartbeatIntervalMs=Yc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Kh,this.ref=0,this.reconnectTimer=null,this.vsn=jv,this.logger=Kh,this.conn=null,this.sendBuffer=[],this.serializer=new S1,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=c=>c?(...u)=>c(...u):(...u)=>fetch(...u),!(!((l=s?.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${kf.websocket}`,this.httpEndpoint=vx(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=g1.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,s??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,l){this.logger(t,s,l)}connectionState(){switch(this.conn&&this.conn.readyState){case ci.connecting:return Bi.Connecting;case ci.open:return Bi.Open;case ci.closing:return Bi.Closing;default:return Bi.Closed}}isConnected(){return this.connectionState()===Bi.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const l=`realtime:${t}`,c=this.getChannels().find(u=>u.topic===l);if(c)return c;{const u=new qa(`realtime:${t}`,s,this);return this.channels.push(u),u}}push(t){const{topic:s,event:l,payload:c,ref:u}=t,d=()=>{this.encode(t,f=>{var p;(p=this.conn)===null||p===void 0||p.send(f)})};this.log("push",`${s} ${l} (${u})`,c),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(b1,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Yc.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(l=>l.topic===t&&(l._isJoined()||l._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(g){this.log("error","error in heartbeat callback",g)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:l,event:c,payload:u,ref:d}=s,f=d?`(${d})`:"",p=u.status||"";this.log("receive",`${p} ${l} ${c} ${f}`.trim(),u),this.channels.filter(g=>g._isMember(l)).forEach(g=>g._trigger(c,u,d)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===ci.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ci.open||this.conn.readyState===ci.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(s=>{this.log("error","error waiting for auth on connect",s),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this._terminateWorker()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Qr.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const l=t.match(/\?/)?"&":"?",c=new URLSearchParams(s);return`${t}${l}${c}`}_workerObjectUrl(t){let s;if(t)s=t;else{const l=new Blob([k1],{type:"application/javascript"});s=URL.createObjectURL(l)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s,l=!1;if(t)s=t,l=!0;else if(this.accessToken)try{s=await this.accessToken()}catch(c){this.log("error","Error fetching access token from callback",c),s=this.accessTokenValue}else s=this.accessTokenValue;l?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(c=>{const u={access_token:s,version:v1};s&&c.updateJoinPayload(u),c.joinedOnce&&c._isJoined()&&c._push(Qr.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(s=>{this.log("error",`Error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(l=>{try{l(s)}catch(c){this.log("error",`error in ${t} callback`,c)}})}catch(l){this.log("error",`error triggering ${t} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new gx(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Yc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,l,c,u,d,f,p,g,y,v,x,S;switch(this.transport=(s=t?.transport)!==null&&s!==void 0?s:null,this.timeout=(l=t?.timeout)!==null&&l!==void 0?l:Af,this.heartbeatIntervalMs=(c=t?.heartbeatIntervalMs)!==null&&c!==void 0?c:Yc.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(f=t?.heartbeatCallback)!==null&&f!==void 0?f:Kh,this.vsn=(p=t?.vsn)!==null&&p!==void 0?p:jv,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(g=t?.reconnectAfterMs)!==null&&g!==void 0?g:(C=>T1[C-1]||A1),this.vsn){case mx:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((C,E)=>E(JSON.stringify(C))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((C,E)=>E(JSON.parse(C)));break;case x1:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(S=t?.decode)!==null&&S!==void 0?S:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var po=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function D1(n,t,s){const l=new URL(t,n);if(s)for(const[c,u]of Object.entries(s))u!==void 0&&l.searchParams.set(c,u);return l.toString()}async function M1(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function z1(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:s,path:l,query:c,body:u,headers:d}){const f=D1(n.baseUrl,l,c),p=await M1(n.auth),g=await t(f,{method:s,headers:{...u?{"Content-Type":"application/json"}:{},...p,...d},body:u?JSON.stringify(u):void 0}),y=await g.text(),v=(g.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!g.ok){const S=v?x:void 0,C=S?.error;throw new po(C?.message??`Request failed with status ${g.status}`,{status:g.status,icebergType:C?.type,icebergCode:C?.code,details:S})}return{status:g.status,headers:g.headers,data:x}}}}function Kc(n){return n.join("")}var U1=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:Kc(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(l=>({namespace:l}))}async createNamespace(n,t){const s={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Kc(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Kc(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Kc(n.namespace)}`}),!0}catch(t){if(t instanceof po&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(s){if(s instanceof po&&s.status===409)return;throw s}}};function Ea(n){return n.join("")}var L1=class{constructor(n,t="",s){this.client=n,this.prefix=t,this.accessDelegation=s}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ea(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ea(n.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(n,t){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ea(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ea(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ea(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ea(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(s){if(s instanceof po&&s.status===404)return!1;throw s}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(s){if(s instanceof po&&s.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw s}}},B1=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const s=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=z1({baseUrl:s,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new U1(this.client,t),this.tableOps=new L1(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},Du=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function sn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var I1=class extends Du{constructor(n,t,s){super(n),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Df=class extends Du{constructor(n,t){super(n),this.name="StorageUnknownError",this.originalError=t}};const ap=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),$1=()=>Response,Mf=n=>{if(Array.isArray(n))return n.map(s=>Mf(s));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([s,l])=>{const c=s.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[c]=Mf(l)}),t},q1=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},P1=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function mo(n){"@babel/helpers - typeof";return mo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mo(n)}function H1(n,t){if(mo(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var l=s.call(n,t);if(mo(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function F1(n){var t=H1(n,"string");return mo(t)=="symbol"?t:t+""}function G1(n,t,s){return(t=F1(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function Nv(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable})),s.push.apply(s,l)}return s}function it(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Nv(Object(s),!0).forEach(function(l){G1(n,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Nv(Object(s)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(s,l))})}return n}const Qh=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},V1=async(n,t,s)=>{n instanceof await $1()&&!s?.noResolveJson?n.json().then(l=>{const c=n.status||500,u=l?.statusCode||c+"";t(new I1(Qh(l),c,u))}).catch(l=>{t(new Df(Qh(l),l))}):t(new Df(Qh(n),n))},Y1=(n,t,s,l)=>{const c={method:n,headers:t?.headers||{}};return n==="GET"||!l?c:(q1(l)?(c.headers=it({"Content-Type":"application/json"},t?.headers),c.body=JSON.stringify(l)):c.body=l,t?.duplex&&(c.duplex=t.duplex),it(it({},c),s))};async function Oo(n,t,s,l,c,u){return new Promise((d,f)=>{n(s,Y1(t,l,c,u)).then(p=>{if(!p.ok)throw p;return l?.noResolveJson?p:p.json()}).then(p=>d(p)).catch(p=>V1(p,f,l))})}async function go(n,t,s,l){return Oo(n,"GET",t,s,l)}async function Kr(n,t,s,l,c){return Oo(n,"POST",t,l,c,s)}async function zf(n,t,s,l,c){return Oo(n,"PUT",t,l,c,s)}async function K1(n,t,s,l){return Oo(n,"HEAD",t,it(it({},s),{},{noResolveJson:!0}),l)}async function lp(n,t,s,l,c){return Oo(n,"DELETE",t,l,c,s)}var Q1=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(sn(t))return{data:null,error:t};throw t}}};let xx;xx=Symbol.toStringTag;var W1=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[xx]="BlobDownloadBuilder",this.promise=null}asStream(){return new Q1(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(sn(t))return{data:null,error:t};throw t}}};const X1={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Rv={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var J1=class{constructor(n,t={},s,l){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.bucketId=s,this.fetch=ap(l)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,t,s,l){var c=this;try{let u;const d=it(it({},Rv),l);let f=it(it({},c.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const p=d.metadata;typeof Blob<"u"&&s instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),p&&u.append("metadata",c.encodeMetadata(p)),u.append("",s)):typeof FormData<"u"&&s instanceof FormData?(u=s,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),p&&!u.has("metadata")&&u.append("metadata",c.encodeMetadata(p))):(u=s,f["cache-control"]=`max-age=${d.cacheControl}`,f["content-type"]=d.contentType,p&&(f["x-metadata"]=c.toBase64(c.encodeMetadata(p))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),l?.headers&&(f=it(it({},f),l.headers));const g=c._removeEmptyFolders(t),y=c._getFinalPath(g),v=await(n=="PUT"?zf:Kr)(c.fetch,`${c.url}/object/${y}`,u,it({headers:f},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:g,id:v.Id,fullPath:v.Key},error:null}}catch(u){if(c.shouldThrowOnError)throw u;if(sn(u))return{data:null,error:u};throw u}}async upload(n,t,s){return this.uploadOrUpdate("POST",n,t,s)}async uploadToSignedUrl(n,t,s,l){var c=this;const u=c._removeEmptyFolders(n),d=c._getFinalPath(u),f=new URL(c.url+`/object/upload/sign/${d}`);f.searchParams.set("token",t);try{let p;const g=it({upsert:Rv.upsert},l),y=it(it({},c.headers),{"x-upsert":String(g.upsert)});return typeof Blob<"u"&&s instanceof Blob?(p=new FormData,p.append("cacheControl",g.cacheControl),p.append("",s)):typeof FormData<"u"&&s instanceof FormData?(p=s,p.append("cacheControl",g.cacheControl)):(p=s,y["cache-control"]=`max-age=${g.cacheControl}`,y["content-type"]=g.contentType),{data:{path:u,fullPath:(await zf(c.fetch,f.toString(),p,{headers:y})).Key},error:null}}catch(p){if(c.shouldThrowOnError)throw p;if(sn(p))return{data:null,error:p};throw p}}async createSignedUploadUrl(n,t){var s=this;try{let l=s._getFinalPath(n);const c=it({},s.headers);t?.upsert&&(c["x-upsert"]="true");const u=await Kr(s.fetch,`${s.url}/object/upload/sign/${l}`,{},{headers:c}),d=new URL(s.url+u.url),f=d.searchParams.get("token");if(!f)throw new Du("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:f},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(sn(l))return{data:null,error:l};throw l}}async update(n,t,s){return this.uploadOrUpdate("PUT",n,t,s)}async move(n,t,s){var l=this;try{return{data:await Kr(l.fetch,`${l.url}/object/move`,{bucketId:l.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:l.headers}),error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(sn(c))return{data:null,error:c};throw c}}async copy(n,t,s){var l=this;try{return{data:{path:(await Kr(l.fetch,`${l.url}/object/copy`,{bucketId:l.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:l.headers})).Key},error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(sn(c))return{data:null,error:c};throw c}}async createSignedUrl(n,t,s){var l=this;try{let c=l._getFinalPath(n),u=await Kr(l.fetch,`${l.url}/object/sign/${c}`,it({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:l.headers});const d=s?.download?`&download=${s.download===!0?"":s.download}`:"";return u={signedUrl:encodeURI(`${l.url}${u.signedURL}${d}`)},{data:u,error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(sn(c))return{data:null,error:c};throw c}}async createSignedUrls(n,t,s){var l=this;try{const c=await Kr(l.fetch,`${l.url}/object/sign/${l.bucketId}`,{expiresIn:t,paths:n},{headers:l.headers}),u=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:c.map(d=>it(it({},d),{},{signedUrl:d.signedURL?encodeURI(`${l.url}${d.signedURL}${u}`):null})),error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(sn(c))return{data:null,error:c};throw c}}download(n,t){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),c=l?`?${l}`:"",u=this._getFinalPath(n),d=()=>go(this.fetch,`${this.url}/${s}/${u}${c}`,{headers:this.headers,noResolveJson:!0});return new W1(d,this.shouldThrowOnError)}async info(n){var t=this;const s=t._getFinalPath(n);try{return{data:Mf(await go(t.fetch,`${t.url}/object/info/${s}`,{headers:t.headers})),error:null}}catch(l){if(t.shouldThrowOnError)throw l;if(sn(l))return{data:null,error:l};throw l}}async exists(n){var t=this;const s=t._getFinalPath(n);try{return await K1(t.fetch,`${t.url}/object/${s}`,{headers:t.headers}),{data:!0,error:null}}catch(l){if(t.shouldThrowOnError)throw l;if(sn(l)&&l instanceof Df){const c=l.originalError;if([400,404].includes(c?.status))return{data:!1,error:l}}throw l}}getPublicUrl(n,t){const s=this._getFinalPath(n),l=[],c=t?.download?`download=${t.download===!0?"":t.download}`:"";c!==""&&l.push(c);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&l.push(d);let f=l.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${s}${f}`)}}}async remove(n){var t=this;try{return{data:await lp(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(sn(s))return{data:null,error:s};throw s}}async list(n,t,s){var l=this;try{const c=it(it(it({},X1),t),{},{prefix:n||""});return{data:await Kr(l.fetch,`${l.url}/object/list/${l.bucketId}`,c,{headers:l.headers},s),error:null}}catch(c){if(l.shouldThrowOnError)throw c;if(sn(c))return{data:null,error:c};throw c}}async listV2(n,t){var s=this;try{const l=it({},n);return{data:await Kr(s.fetch,`${s.url}/object/list-v2/${s.bucketId}`,l,{headers:s.headers},t),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(sn(l))return{data:null,error:l};throw l}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const bx="2.89.0",wx={"X-Client-Info":`storage-js/${bx}`};var Z1=class{constructor(n,t={},s,l){this.shouldThrowOnError=!1;const c=new URL(n);l?.useNewHostname&&/supabase\.(co|in|red)$/.test(c.hostname)&&!c.hostname.includes("storage.supabase.")&&(c.hostname=c.hostname.replace("supabase.","storage.supabase.")),this.url=c.href.replace(/\/$/,""),this.headers=it(it({},wx),t),this.fetch=ap(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var t=this;try{const s=t.listBucketOptionsToQueryString(n);return{data:await go(t.fetch,`${t.url}/bucket${s}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(sn(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await go(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(sn(s))return{data:null,error:s};throw s}}async createBucket(n,t={public:!1}){var s=this;try{return{data:await Kr(s.fetch,`${s.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(sn(l))return{data:null,error:l};throw l}}async updateBucket(n,t){var s=this;try{return{data:await zf(s.fetch,`${s.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(sn(l))return{data:null,error:l};throw l}}async emptyBucket(n){var t=this;try{return{data:await Kr(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(sn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await lp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(sn(s))return{data:null,error:s};throw s}}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},eC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=it(it({},wx),t),this.fetch=ap(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Kr(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(sn(s))return{data:null,error:s};throw s}}async listBuckets(n){var t=this;try{const s=new URLSearchParams;n?.limit!==void 0&&s.set("limit",n.limit.toString()),n?.offset!==void 0&&s.set("offset",n.offset.toString()),n?.sortColumn&&s.set("sortColumn",n.sortColumn),n?.sortOrder&&s.set("sortOrder",n.sortOrder),n?.search&&s.set("search",n.search);const l=s.toString(),c=l?`${t.url}/bucket?${l}`:`${t.url}/bucket`;return{data:await go(t.fetch,c,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(sn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await lp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(sn(s))return{data:null,error:s};throw s}}from(n){var t=this;if(!P1(n))throw new Du("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const s=new B1({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),l=this.shouldThrowOnError;return new Proxy(s,{get(c,u){const d=c[u];return typeof d!="function"?d:async(...f)=>{try{return{data:await d.apply(c,f),error:null}}catch(p){if(l)throw p;return{data:null,error:p}}}}})}};const op={"X-Client-Info":`storage-js/${bx}`,"Content-Type":"application/json"};var Sx=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function jr(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var Wh=class extends Sx{constructor(n,t,s){super(n),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},tC=class extends Sx{constructor(n,t){super(n),this.name="StorageVectorsUnknownError",this.originalError=t}};const cp=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),nC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Tv=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),rC=async(n,t,s)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!s?.noResolveJson){const l=n.status||500,c=n;if(typeof c.json=="function")c.json().then(u=>{const d=u?.statusCode||u?.code||l+"";t(new Wh(Tv(u),l,d))}).catch(()=>{const u=l+"";t(new Wh(c.statusText||`HTTP ${l} error`,l,u))});else{const u=l+"";t(new Wh(c.statusText||`HTTP ${l} error`,l,u))}}else t(new tC(Tv(n),n))},sC=(n,t,s,l)=>{const c={method:n,headers:t?.headers||{}};return l?(nC(l)?(c.headers=it({"Content-Type":"application/json"},t?.headers),c.body=JSON.stringify(l)):c.body=l,it(it({},c),s)):c};async function iC(n,t,s,l,c,u){return new Promise((d,f)=>{n(s,sC(t,l,c,u)).then(p=>{if(!p.ok)throw p;if(l?.noResolveJson)return p;const g=p.headers.get("content-type");return!g||!g.includes("application/json")?{}:p.json()}).then(p=>d(p)).catch(p=>rC(p,f,l))})}async function _r(n,t,s,l,c){return iC(n,"POST",t,l,c,s)}var aC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=it(it({},op),t),this.fetch=cp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var t=this;try{return{data:await _r(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async getIndex(n,t){var s=this;try{return{data:await _r(s.fetch,`${s.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(jr(l))return{data:null,error:l};throw l}}async listIndexes(n){var t=this;try{return{data:await _r(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async deleteIndex(n,t){var s=this;try{return{data:await _r(s.fetch,`${s.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers})||{},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(jr(l))return{data:null,error:l};throw l}}},lC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=it(it({},op),t),this.fetch=cp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var t=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await _r(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async getVectors(n){var t=this;try{return{data:await _r(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async listVectors(n){var t=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await _r(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async queryVectors(n){var t=this;try{return{data:await _r(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async deleteVectors(n){var t=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await _r(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}},oC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=it(it({},op),t),this.fetch=cp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await _r(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await _r(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async listBuckets(n={}){var t=this;try{return{data:await _r(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await _r(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(jr(s))return{data:null,error:s};throw s}}},cC=class extends oC{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new uC(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,s=this;return t().call(s,n)}async getBucket(n){var t=()=>super.getBucket,s=this;return t().call(s,n)}async listBuckets(n={}){var t=()=>super.listBuckets,s=this;return t().call(s,n)}async deleteBucket(n){var t=()=>super.deleteBucket,s=this;return t().call(s,n)}},uC=class extends aC{constructor(n,t,s,l){super(n,t,l),this.vectorBucketName=s}async createIndex(n){var t=()=>super.createIndex,s=this;return t().call(s,it(it({},n),{},{vectorBucketName:s.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,s=this;return t().call(s,it(it({},n),{},{vectorBucketName:s.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,s=this;return t().call(s,s.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,s=this;return t().call(s,s.vectorBucketName,n)}index(n){return new dC(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},dC=class extends lC{constructor(n,t,s,l,c){super(n,t,c),this.vectorBucketName=s,this.indexName=l}async putVectors(n){var t=()=>super.putVectors,s=this;return t().call(s,it(it({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async getVectors(n){var t=()=>super.getVectors,s=this;return t().call(s,it(it({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,s=this;return t().call(s,it(it({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,s=this;return t().call(s,it(it({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,s=this;return t().call(s,it(it({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}},hC=class extends Z1{constructor(n,t={},s,l){super(n,t,s,l)}from(n){return new J1(this.url,this.headers,n,this.fetch)}get vectors(){return new cC(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new eC(this.url+"/iceberg",this.headers,this.fetch)}};const jx="2.89.0",La=30*1e3,Uf=3,Xh=Uf*La,fC="http://localhost:9999",pC="supabase.auth.token",mC={"X-Client-Info":`gotrue-js/${jx}`},Lf="X-Supabase-Api-Version",_x={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},gC=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,yC=600*1e3;class yo extends Error{constructor(t,s,l){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=l}}function Ye(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class vC extends yo{constructor(t,s,l){super(t,s,l),this.name="AuthApiError",this.status=s,this.code=l}}function xC(n){return Ye(n)&&n.name==="AuthApiError"}class Ii extends yo{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class ks extends yo{constructor(t,s,l,c){super(t,l,c),this.name=s,this.status=l}}class Sr extends ks{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function bC(n){return Ye(n)&&n.name==="AuthSessionMissingError"}class Na extends ks{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Qc extends ks{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Wc extends ks{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function wC(n){return Ye(n)&&n.name==="AuthImplicitGrantRedirectError"}class Av extends ks{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class SC extends ks{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Bf extends ks{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function Jh(n){return Ye(n)&&n.name==="AuthRetryableFetchError"}class kv extends ks{constructor(t,s,l){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=l}}class If extends ks{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const gu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ov=` 	
\r=`.split(""),jC=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<Ov.length;t+=1)n[Ov[t].charCodeAt(0)]=-2;for(let t=0;t<gu.length;t+=1)n[gu[t].charCodeAt(0)]=t;return n})();function Dv(n,t,s){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;s(gu[l]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;s(gu[l]),t.queuedBits-=6}}function Cx(n,t,s){const l=jC[n];if(l>-1)for(t.queue=t.queue<<6|l,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Mv(n){const t=[],s=d=>{t.push(String.fromCodePoint(d))},l={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},u=d=>{EC(d,l,s)};for(let d=0;d<n.length;d+=1)Cx(n.charCodeAt(d),c,u);return t.join("")}function _C(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function CC(n,t){for(let s=0;s<n.length;s+=1){let l=n.charCodeAt(s);if(l>55295&&l<=56319){const c=(l-55296)*1024&65535;l=(n.charCodeAt(s+1)-56320&65535|c)+65536,s+=1}_C(l,t)}}function EC(n,t,s){if(t.utf8seq===0){if(n<=127){s(n);return}for(let l=1;l<6;l+=1)if((n>>7-l&1)===0){t.utf8seq=l;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function Fa(n){const t=[],s={queue:0,queuedBits:0},l=c=>{t.push(c)};for(let c=0;c<n.length;c+=1)Cx(n.charCodeAt(c),s,l);return new Uint8Array(t)}function NC(n){const t=[];return CC(n,s=>t.push(s)),new Uint8Array(t)}function qi(n){const t=[],s={queue:0,queuedBits:0},l=c=>{t.push(c)};return n.forEach(c=>Dv(c,s,l)),Dv(null,s,l),t.join("")}function RC(n){return Math.round(Date.now()/1e3)+n}function TC(){return Symbol("auth-callback")}const Qn=()=>typeof window<"u"&&typeof document<"u",ki={tested:!1,writable:!1},Ex=()=>{if(!Qn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ki.tested)return ki.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ki.tested=!0,ki.writable=!0}catch{ki.tested=!0,ki.writable=!1}return ki.writable};function AC(n){const t={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((c,u)=>{t[u]=c})}catch{}return s.searchParams.forEach((l,c)=>{t[c]=l}),t}const Nx=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),kC=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Ba=async(n,t,s)=>{await n.setItem(t,JSON.stringify(s))},Oi=async(n,t)=>{const s=await n.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Yn=async(n,t)=>{await n.removeItem(t)};class Mu{constructor(){this.promise=new Mu.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}Mu.promiseConstructor=Promise;function Zh(n){const t=n.split(".");if(t.length!==3)throw new If("Invalid JWT structure");for(let l=0;l<t.length;l++)if(!gC.test(t[l]))throw new If("JWT not in base64url format");return{header:JSON.parse(Mv(t[0])),payload:JSON.parse(Mv(t[1])),signature:Fa(t[2]),raw:{header:t[0],payload:t[1]}}}async function OC(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function DC(n,t){return new Promise((l,c)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){l(d);return}}catch(d){if(!t(u,d)){c(d);return}}})()})}function MC(n){return("0"+n.toString(16)).substr(-2)}function zC(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=s.length;let c="";for(let u=0;u<56;u++)c+=s.charAt(Math.floor(Math.random()*l));return c}return crypto.getRandomValues(t),Array.from(t,MC).join("")}async function UC(n){const s=new TextEncoder().encode(n),l=await crypto.subtle.digest("SHA-256",s),c=new Uint8Array(l);return Array.from(c).map(u=>String.fromCharCode(u)).join("")}async function LC(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await UC(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ra(n,t,s=!1){const l=zC();let c=l;s&&(c+="/PASSWORD_RECOVERY"),await Ba(n,`${t}-code-verifier`,c);const u=await LC(l);return[u,l===u?"plain":"s256"]}const BC=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function IC(n){const t=n.headers.get(Lf);if(!t||!t.match(BC))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function $C(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function qC(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const PC=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ta(n){if(!PC.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ef(){const n={};return new Proxy(n,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const l=s.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function HC(n,t){return new Proxy(n,{get:(s,l,c)=>{if(l==="__isInsecureUserWarningProxy")return!0;if(typeof l=="symbol"){const u=l.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(s,l,c)}return!t.value&&typeof l=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(s,l,c)}})}function zv(n){return JSON.parse(JSON.stringify(n))}const Li=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),FC=[502,503,504];async function Uv(n){var t;if(!kC(n))throw new Bf(Li(n),0);if(FC.includes(n.status))throw new Bf(Li(n),n.status);let s;try{s=await n.json()}catch(u){throw new Ii(Li(u),u)}let l;const c=IC(n);if(c&&c.getTime()>=_x["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?l=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(l=s.error_code),l){if(l==="weak_password")throw new kv(Li(s),n.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(l==="session_not_found")throw new Sr}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new kv(Li(s),n.status,s.weak_password.reasons);throw new vC(Li(s),n.status||500,l)}const GC=(n,t,s,l)=>{const c={method:n,headers:t?.headers||{}};return n==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),c.body=JSON.stringify(l),Object.assign(Object.assign({},c),s))};async function st(n,t,s,l){var c;const u=Object.assign({},l?.headers);u[Lf]||(u[Lf]=_x["2024-01-01"].name),l?.jwt&&(u.Authorization=`Bearer ${l.jwt}`);const d=(c=l?.query)!==null&&c!==void 0?c:{};l?.redirectTo&&(d.redirect_to=l.redirectTo);const f=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",p=await VC(n,t,s+f,{headers:u,noResolveJson:l?.noResolveJson},{},l?.body);return l?.xform?l?.xform(p):{data:Object.assign({},p),error:null}}async function VC(n,t,s,l,c,u){const d=GC(t,l,c,u);let f;try{f=await n(s,Object.assign({},d))}catch(p){throw console.error(p),new Bf(Li(p),0)}if(f.ok||await Uv(f),l?.noResolveJson)return f;try{return await f.json()}catch(p){await Uv(p)}}function Vr(n){var t;let s=null;QC(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=RC(n.expires_in)));const l=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:s,user:l},error:null}}function Lv(n){const t=Vr(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,l)=>s&&typeof l=="string",!0)&&(t.data.weak_password=n.weak_password),t}function ui(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function YC(n){return{data:n,error:null}}function KC(n){const{action_link:t,email_otp:s,hashed_token:l,redirect_to:c,verification_type:u}=n,d=Ou(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:t,email_otp:s,hashed_token:l,redirect_to:c,verification_type:u},p=Object.assign({},d);return{data:{properties:f,user:p},error:null}}function Bv(n){return n}function QC(n){return n.access_token&&n.refresh_token&&n.expires_in}const tf=["global","local","others"];class WC{constructor({url:t="",headers:s={},fetch:l}){this.url=t,this.headers=s,this.fetch=Nx(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,s=tf[0]){if(tf.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${tf.join(", ")}`);try{return await st(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(l){if(Ye(l))return{data:null,error:l};throw l}}async inviteUserByEmail(t,s={}){try{return await st(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:ui})}catch(l){if(Ye(l))return{data:{user:null},error:l};throw l}}async generateLink(t){try{const{options:s}=t,l=Ou(t,["options"]),c=Object.assign(Object.assign({},l),s);return"newEmail"in l&&(c.new_email=l?.newEmail,delete c.newEmail),await st(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:KC,redirectTo:s?.redirectTo})}catch(s){if(Ye(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await st(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:ui})}catch(s){if(Ye(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,l,c,u,d,f,p;try{const g={nextPage:null,lastPage:0,total:0},y=await st(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:"",per_page:(u=(c=t?.perPage)===null||c===void 0?void 0:c.toString())!==null&&u!==void 0?u:""},xform:Bv});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,S=(p=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&p!==void 0?p:[];return S.length>0&&(S.forEach(C=>{const E=parseInt(C.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(C.split(";")[1].split("=")[1]);g[`${_}Page`]=E}),g.total=parseInt(x)),{data:Object.assign(Object.assign({},v),g),error:null}}catch(g){if(Ye(g))return{data:{users:[]},error:g};throw g}}async getUserById(t){Ta(t);try{return await st(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:ui})}catch(s){if(Ye(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){Ta(t);try{return await st(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:ui})}catch(l){if(Ye(l))return{data:{user:null},error:l};throw l}}async deleteUser(t,s=!1){Ta(t);try{return await st(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:ui})}catch(l){if(Ye(l))return{data:{user:null},error:l};throw l}}async _listFactors(t){Ta(t.userId);try{const{data:s,error:l}=await st(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:s,error:l}}catch(s){if(Ye(s))return{data:null,error:s};throw s}}async _deleteFactor(t){Ta(t.userId),Ta(t.id);try{return{data:await st(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(Ye(s))return{data:null,error:s};throw s}}async _listOAuthClients(t){var s,l,c,u,d,f,p;try{const g={nextPage:null,lastPage:0,total:0},y=await st(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:"",per_page:(u=(c=t?.perPage)===null||c===void 0?void 0:c.toString())!==null&&u!==void 0?u:""},xform:Bv});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,S=(p=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&p!==void 0?p:[];return S.length>0&&(S.forEach(C=>{const E=parseInt(C.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(C.split(";")[1].split("=")[1]);g[`${_}Page`]=E}),g.total=parseInt(x)),{data:Object.assign(Object.assign({},v),g),error:null}}catch(g){if(Ye(g))return{data:{clients:[]},error:g};throw g}}async _createOAuthClient(t){try{return await st(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Ye(s))return{data:null,error:s};throw s}}async _getOAuthClient(t){try{return await st(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Ye(s))return{data:null,error:s};throw s}}async _updateOAuthClient(t,s){try{return await st(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:s,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(Ye(l))return{data:null,error:l};throw l}}async _deleteOAuthClient(t){try{return await st(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ye(s))return{data:null,error:s};throw s}}async _regenerateOAuthClientSecret(t){try{return await st(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(Ye(s))return{data:null,error:s};throw s}}}function Iv(n={}){return{getItem:t=>n[t]||null,setItem:(t,s)=>{n[t]=s},removeItem:t=>{delete n[t]}}}const Aa={debug:!!(globalThis&&Ex()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Rx extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class XC extends Rx{}async function JC(n,t,s){Aa.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const l=new globalThis.AbortController;return t>0&&setTimeout(()=>{l.abort(),Aa.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async c=>{if(c){Aa.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,c.name);try{return await s()}finally{Aa.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,c.name)}}else{if(t===0)throw Aa.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new XC(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Aa.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}function ZC(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Tx(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function eE(n){return parseInt(n,16)}function tE(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,l=>l.toString(16).padStart(2,"0")).join("")}function nE(n){var t;const{chainId:s,domain:l,expirationTime:c,issuedAt:u=new Date,nonce:d,notBefore:f,requestId:p,resources:g,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const S=Tx(n.address),C=y?`${y}://${l}`:l,E=n.statement?`${n.statement}
`:"",_=`${C} wants you to sign in with your Ethereum account:
${S}

${E}`;let T=`URI: ${v}
Version: ${x}
Chain ID: ${s}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(c&&(T+=`
Expiration Time: ${c.toISOString()}`),f&&(T+=`
Not Before: ${f.toISOString()}`),p&&(T+=`
Request ID: ${p}`),g){let D=`
Resources:`;for(const B of g){if(!B||typeof B!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${B}`);D+=`
- ${B}`}T+=D}return`${_}
${T}`}class Rn extends Error{constructor({message:t,code:s,cause:l,name:c}){var u;super(t,{cause:l}),this.__isWebAuthnError=!0,this.name=(u=c??(l instanceof Error?l.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=s}}class yu extends Rn{constructor(t,s){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s,message:t}),this.name="WebAuthnUnknownError",this.originalError=s}}function rE({error:n,options:t}){var s,l,c;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Rn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((s=u.authenticatorSelection)===null||s===void 0?void 0:s.requireResidentKey)===!0)return new Rn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((l=u.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new Rn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((c=u.authenticatorSelection)===null||c===void 0?void 0:c.userVerification)==="required")return new Rn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Rn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Rn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(f=>f.type==="public-key").length===0?new Rn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Rn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(Ax(d)){if(u.rp.id!==d)return new Rn({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Rn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Rn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Rn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Rn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function sE({error:n,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Rn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Rn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const l=window.location.hostname;if(Ax(l)){if(s.rpId!==l)return new Rn({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Rn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Rn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Rn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class iE{createNewAbortSignal(){if(this.controller){const s=new Error("Cancelling existing WebAuthn API call for new one");s.name="AbortError",this.controller.abort(s)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const aE=new iE;function lE(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:s,excludeCredentials:l}=n,c=Ou(n,["challenge","user","excludeCredentials"]),u=Fa(t).buffer,d=Object.assign(Object.assign({},s),{id:Fa(s.id).buffer}),f=Object.assign(Object.assign({},c),{challenge:u,user:d});if(l&&l.length>0){f.excludeCredentials=new Array(l.length);for(let p=0;p<l.length;p++){const g=l[p];f.excludeCredentials[p]=Object.assign(Object.assign({},g),{id:Fa(g.id).buffer,type:g.type||"public-key",transports:g.transports})}}return f}function oE(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:s}=n,l=Ou(n,["challenge","allowCredentials"]),c=Fa(t).buffer,u=Object.assign(Object.assign({},l),{challenge:c});if(s&&s.length>0){u.allowCredentials=new Array(s.length);for(let d=0;d<s.length;d++){const f=s[d];u.allowCredentials[d]=Object.assign(Object.assign({},f),{id:Fa(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function cE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n;return{id:n.id,rawId:n.id,response:{attestationObject:qi(new Uint8Array(n.response.attestationObject)),clientDataJSON:qi(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function uE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n,l=n.getClientExtensionResults(),c=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:qi(new Uint8Array(c.authenticatorData)),clientDataJSON:qi(new Uint8Array(c.clientDataJSON)),signature:qi(new Uint8Array(c.signature)),userHandle:c.userHandle?qi(new Uint8Array(c.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Ax(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function $v(){var n,t;return!!(Qn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function dE(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new yu("Browser returned unexpected credential type",t)}:{data:null,error:new yu("Empty credential response",t)}}catch(t){return{data:null,error:rE({error:t,options:n})}}}async function hE(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new yu("Browser returned unexpected credential type",t)}:{data:null,error:new yu("Empty credential response",t)}}catch(t){return{data:null,error:sE({error:t,options:n})}}}const fE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},pE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function vu(...n){const t=c=>c!==null&&typeof c=="object"&&!Array.isArray(c),s=c=>c instanceof ArrayBuffer||ArrayBuffer.isView(c),l={};for(const c of n)if(c)for(const u in c){const d=c[u];if(d!==void 0)if(Array.isArray(d))l[u]=d;else if(s(d))l[u]=d;else if(t(d)){const f=l[u];t(f)?l[u]=vu(f,d):l[u]=vu(d)}else l[u]=d}return l}function mE(n,t){return vu(fE,n,t||{})}function gE(n,t){return vu(pE,n,t||{})}class yE{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:s,friendlyName:l,signal:c},u){try{const{data:d,error:f}=await this.client.mfa.challenge({factorId:t,webauthn:s});if(!d)return{data:null,error:f};const p=c??aE.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:g}=d.webauthn.credential_options.publicKey;g.name||(g.name=`${g.id}:${l}`),g.displayName||(g.displayName=g.name)}switch(d.webauthn.type){case"create":{const g=mE(d.webauthn.credential_options.publicKey,u?.create),{data:y,error:v}=await dE({publicKey:g,signal:p});return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}case"request":{const g=gE(d.webauthn.credential_options.publicKey,u?.request),{data:y,error:v}=await hE(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:g,signal:p}));return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}}}catch(d){return Ye(d)?{data:null,error:d}:{data:null,error:new Ii("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:s,webauthn:l}){return this.client.mfa.verify({factorId:s,challengeId:t,webauthn:l})}async _authenticate({factorId:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:c}={}},u){if(!s)return{data:null,error:new yo("rpId is required for WebAuthn authentication")};try{if(!$v())return{data:null,error:new Ii("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this.challenge({factorId:t,webauthn:{rpId:s,rpOrigins:l},signal:c},{request:u});if(!d)return{data:null,error:f};const{webauthn:p}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:p.type,rpId:s,rpOrigins:l,credential_response:p.credential_response}})}catch(d){return Ye(d)?{data:null,error:d}:{data:null,error:new Ii("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:c}={}},u){if(!s)return{data:null,error:new yo("rpId is required for WebAuthn registration")};try{if(!$v())return{data:null,error:new Ii("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:f};const{data:p,error:g}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:s,rpOrigins:l},signal:c},{create:u});return p?this._verify({factorId:d.id,challengeId:p.challengeId,webauthn:{rpId:s,rpOrigins:l,type:p.webauthn.type,credential_response:p.webauthn.credential_response}}):{data:null,error:g}}catch(d){return Ye(d)?{data:null,error:d}:{data:null,error:new Ii("Unexpected error in register",d)}}}}ZC();const vE={url:fC,storageKey:pC,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:mC,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function qv(n,t,s){return await s()}const ka={};class vo{get jwks(){var t,s;return(s=(t=ka[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){ka[this.storageKey]=Object.assign(Object.assign({},ka[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=ka[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){ka[this.storageKey]=Object.assign(Object.assign({},ka[this.storageKey]),{cachedAt:t})}constructor(t){var s,l,c;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},vE),t);if(this.storageKey=u.storageKey,this.instanceID=(s=vo.nextInstanceID[this.storageKey])!==null&&s!==void 0?s:0,vo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&Qn()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new WC({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=Nx(u.fetch),this.lock=u.lock||qv,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:this.persistSession&&Qn()&&(!((l=globalThis?.navigator)===null||l===void 0)&&l.locks)?this.lock=JC:this.lock=qv,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new yE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:Ex()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Iv(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=Iv(this.memoryStorage)),Qn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(c=this.broadcastChannel)===null||c===void 0||c.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${jx}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let s={},l="none";if(Qn()&&(s=AC(window.location.href),this._isImplicitGrantCallback(s)?l="implicit":await this._isPKCECallback(s)&&(l="pkce")),Qn()&&this.detectSessionInUrl&&l!=="none"){const{data:c,error:u}=await this._getSessionFromURL(s,l);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),wC(u)){const p=(t=u.details)===null||t===void 0?void 0:t.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:d,redirectType:f}=c;return this._debug("#_initialize()","detected session in URL",d,"redirect type",f),await this._saveSession(d),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return Ye(s)?this._returnResult({error:s}):this._returnResult({error:new Ii("Unexpected error during initialization",s)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,l,c;try{const u=await st(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(c=t?.options)===null||c===void 0?void 0:c.captchaToken}},xform:Vr}),{data:d,error:f}=u;if(f||!d)return this._returnResult({data:{user:null,session:null},error:f});const p=d.session,g=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:g,session:p},error:null})}catch(u){if(Ye(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var s,l,c;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let S=null,C=null;this.flowType==="pkce"&&([S,C]=await Ra(this.storage,this.storageKey)),u=await st(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(s=x?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:S,code_challenge_method:C},xform:Vr})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await st(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(l=x?.data)!==null&&l!==void 0?l:{},channel:(c=x?.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:Vr})}else throw new Qc("You must provide either an email or phone number and a password");const{data:d,error:f}=u;if(f||!d)return await Yn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:f});const p=d.session,g=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:g,session:p},error:null})}catch(u){if(await Yn(this.storage,`${this.storageKey}-code-verifier`),Ye(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let s;if("email"in t){const{email:u,password:d,options:f}=t;s=await st(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Lv})}else if("phone"in t){const{phone:u,password:d,options:f}=t;s=await st(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Lv})}else throw new Qc("You must provide either an email or phone number and a password");const{data:l,error:c}=s;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const u=new Na;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:c})}catch(s){if(Ye(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOAuth(t){var s,l,c,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;switch(s){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(t){var s,l,c,u,d,f,p,g,y,v,x;let S,C;if("message"in t)S=t.message,C=t.signature;else{const{chain:E,wallet:_,statement:T,options:D}=t;let B;if(Qn())if(typeof _=="object")B=_;else{const F=window;if("ethereum"in F&&typeof F.ethereum=="object"&&"request"in F.ethereum&&typeof F.ethereum.request=="function")B=F.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof _!="object"||!D?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");B=_}const P=new URL((s=D?.url)!==null&&s!==void 0?s:window.location.href),$=await B.request({method:"eth_requestAccounts"}).then(F=>F).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!$||$.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const j=Tx($[0]);let M=(l=D?.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!M){const F=await B.request({method:"eth_chainId"});M=eE(F)}const A={domain:P.host,address:j,statement:T,uri:P.href,version:"1",chainId:M,nonce:(c=D?.signInWithEthereum)===null||c===void 0?void 0:c.nonce,issuedAt:(d=(u=D?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(f=D?.signInWithEthereum)===null||f===void 0?void 0:f.expirationTime,notBefore:(p=D?.signInWithEthereum)===null||p===void 0?void 0:p.notBefore,requestId:(g=D?.signInWithEthereum)===null||g===void 0?void 0:g.requestId,resources:(y=D?.signInWithEthereum)===null||y===void 0?void 0:y.resources};S=nE(A),C=await B.request({method:"personal_sign",params:[tE(S),j]})}try{const{data:E,error:_}=await st(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:S,signature:C},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Vr});if(_)throw _;if(!E||!E.session||!E.user){const T=new Na;return this._returnResult({data:{user:null,session:null},error:T})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:Object.assign({},E),error:_})}catch(E){if(Ye(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async signInWithSolana(t){var s,l,c,u,d,f,p,g,y,v,x,S;let C,E;if("message"in t)C=t.message,E=t.signature;else{const{chain:_,wallet:T,statement:D,options:B}=t;let P;if(Qn())if(typeof T=="object")P=T;else{const j=window;if("solana"in j&&typeof j.solana=="object"&&("signIn"in j.solana&&typeof j.solana.signIn=="function"||"signMessage"in j.solana&&typeof j.solana.signMessage=="function"))P=j.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof T!="object"||!B?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=T}const $=new URL((s=B?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in P&&P.signIn){const j=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},B?.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),D?{statement:D}:null));let M;if(Array.isArray(j)&&j[0]&&typeof j[0]=="object")M=j[0];else if(j&&typeof j=="object"&&"signedMessage"in j&&"signature"in j)M=j;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)C=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),E=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");C=[`${$.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),...D?["",D,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(c=(l=B?.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((u=B?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${B.signInWithSolana.notBefore}`]:[],...!((d=B?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${B.signInWithSolana.expirationTime}`]:[],...!((f=B?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${B.signInWithSolana.chainId}`]:[],...!((p=B?.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${B.signInWithSolana.nonce}`]:[],...!((g=B?.signInWithSolana)===null||g===void 0)&&g.requestId?[`Request ID: ${B.signInWithSolana.requestId}`]:[],...!((v=(y=B?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...B.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const j=await P.signMessage(new TextEncoder().encode(C),"utf8");if(!j||!(j instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");E=j}}try{const{data:_,error:T}=await st(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:C,signature:qi(E)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(S=t.options)===null||S===void 0?void 0:S.captchaToken}}:null),xform:Vr});if(T)throw T;if(!_||!_.session||!_.user){const D=new Na;return this._returnResult({data:{user:null,session:null},error:D})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign({},_),error:T})}catch(_){if(Ye(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async _exchangeCodeForSession(t){const s=await Oi(this.storage,`${this.storageKey}-code-verifier`),[l,c]=(s??"").split("/");try{if(!l&&this.flowType==="pkce")throw new SC;const{data:u,error:d}=await st(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:l},xform:Vr});if(await Yn(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const f=new Na;return this._returnResult({data:{user:null,session:null,redirectType:null},error:f})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:c??null}),error:d})}catch(u){if(await Yn(this.storage,`${this.storageKey}-code-verifier`),Ye(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:s,provider:l,token:c,access_token:u,nonce:d}=t,f=await st(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:c,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Vr}),{data:p,error:g}=f;if(g)return this._returnResult({data:{user:null,session:null},error:g});if(!p||!p.session||!p.user){const y=new Na;return this._returnResult({data:{user:null,session:null},error:y})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:p,error:g})}catch(s){if(Ye(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOtp(t){var s,l,c,u,d;try{if("email"in t){const{email:f,options:p}=t;let g=null,y=null;this.flowType==="pkce"&&([g,y]=await Ra(this.storage,this.storageKey));const{error:v}=await st(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(s=p?.data)!==null&&s!==void 0?s:{},create_user:(l=p?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:g,code_challenge_method:y},redirectTo:p?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:f,options:p}=t,{data:g,error:y}=await st(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(c=p?.data)!==null&&c!==void 0?c:{},create_user:(u=p?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(d=p?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:g?.message_id},error:y})}throw new Qc("You must provide either an email or phone number.")}catch(f){if(await Yn(this.storage,`${this.storageKey}-code-verifier`),Ye(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async verifyOtp(t){var s,l;try{let c,u;"options"in t&&(c=(s=t.options)===null||s===void 0?void 0:s.redirectTo,u=(l=t.options)===null||l===void 0?void 0:l.captchaToken);const{data:d,error:f}=await st(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:c,xform:Vr});if(f)throw f;if(!d)throw new Error("An error occurred on token verification.");const p=d.session,g=d.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),this._returnResult({data:{user:g,session:p},error:null})}catch(c){if(Ye(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signInWithSSO(t){var s,l,c,u,d;try{let f=null,p=null;this.flowType==="pkce"&&([f,p]=await Ra(this.storage,this.storageKey));const g=await st(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(l=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&l!==void 0?l:void 0}),!((c=t?.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:p}),headers:this.headers,xform:YC});return!((u=g.data)===null||u===void 0)&&u.url&&Qn()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(g.data.url),this._returnResult(g)}catch(f){if(await Yn(this.storage,`${this.storageKey}-code-verifier`),Ye(f))return this._returnResult({data:null,error:f});throw f}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:l}=t;if(l)throw l;if(!s)throw new Sr;const{error:c}=await st(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return this._returnResult({data:{user:null,session:null},error:c})})}catch(t){if(Ye(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:l,type:c,options:u}=t,{error:d}=await st(this.fetch,"POST",s,{headers:this.headers,body:{email:l,type:c,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:l,type:c,options:u}=t,{data:d,error:f}=await st(this.fetch,"POST",s,{headers:this.headers,body:{phone:l,type:c,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:f})}throw new Qc("You must provide either an email or phone number and a type")}catch(s){if(Ye(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await l,await s()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=s();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Oi(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const l=t.expires_at?t.expires_at*1e3-Date.now()<Xh:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",t.expires_at),!l){if(this.userStorage){const d=await Oi(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=ef()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=HC(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:c,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:c},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const s=await this._acquireLock(-1,async()=>await this._getUser());return s.data.user&&(this.suppressGetSessionWarning=!0),s}async _getUser(t){try{return t?await st(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:ui}):await this._useSession(async s=>{var l,c,u;const{data:d,error:f}=s;if(f)throw f;return!(!((l=d.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Sr}:await st(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0,xform:ui})})}catch(s){if(Ye(s))return bC(s)&&(await this._removeSession(),await Yn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:s});throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async l=>{const{data:c,error:u}=l;if(u)throw u;if(!c.session)throw new Sr;const d=c.session;let f=null,p=null;this.flowType==="pkce"&&t.email!=null&&([f,p]=await Ra(this.storage,this.storageKey));const{data:g,error:y}=await st(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:f,code_challenge_method:p}),jwt:d.access_token,xform:ui});if(y)throw y;return d.user=g.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(l){if(await Yn(this.storage,`${this.storageKey}-code-verifier`),Ye(l))return this._returnResult({data:{user:null},error:l});throw l}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Sr;const s=Date.now()/1e3;let l=s,c=!0,u=null;const{payload:d}=Zh(t.access_token);if(d.exp&&(l=d.exp,c=l<=s),c){const{data:f,error:p}=await this._callRefreshToken(t.refresh_token);if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!f)return{data:{user:null,session:null},error:null};u=f}else{const{data:f,error:p}=await this._getUser(t.access_token);if(p)throw p;u={access_token:t.access_token,refresh_token:t.refresh_token,user:f.user,token_type:"bearer",expires_in:l-s,expires_at:l},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(s){if(Ye(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var l;if(!t){const{data:d,error:f}=s;if(f)throw f;t=(l=d.session)!==null&&l!==void 0?l:void 0}if(!t?.refresh_token)throw new Sr;const{data:c,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):c?this._returnResult({data:{user:c.user,session:c},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(s){if(Ye(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async _getSessionFromURL(t,s){try{if(!Qn())throw new Wc("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Wc(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new Av("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Wc("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Av("No code detected.");const{data:D,error:B}=await this._exchangeCodeForSession(t.code);if(B)throw B;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:D.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:c,access_token:u,refresh_token:d,expires_in:f,expires_at:p,token_type:g}=t;if(!u||!f||!d||!g)throw new Wc("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(f);let x=y+v;p&&(x=parseInt(p));const S=x-y;S*1e3<=La&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${S}s, should have been closer to ${v}s`);const C=x-v;y-C>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",C,x,y):y-C<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",C,x,y);const{data:E,error:_}=await this._getUser(u);if(_)throw _;const T={provider_token:l,provider_refresh_token:c,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:g,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:T,redirectType:t.type},error:null})}catch(l){if(Ye(l))return this._returnResult({data:{session:null,redirectType:null},error:l});throw l}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Oi(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var l;const{data:c,error:u}=s;if(u)return this._returnResult({error:u});const d=(l=c.session)===null||l===void 0?void 0:l.access_token;if(d){const{error:f}=await this.admin.signOut(d,t);if(f&&!(xC(f)&&(f.status===404||f.status===401||f.status===403)))return this._returnResult({error:f})}return t!=="others"&&(await this._removeSession(),await Yn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const s=TC(),l={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:l}}}async _emitInitialSession(t){return await this._useSession(async s=>{var l,c;try{const{data:{session:u},error:d}=s;if(d)throw d;await((l=this.stateChangeEmitters.get(t))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((c=this.stateChangeEmitters.get(t))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,s={}){let l=null,c=null;this.flowType==="pkce"&&([l,c]=await Ra(this.storage,this.storageKey,!0));try{return await st(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:l,code_challenge_method:c,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(u){if(await Yn(this.storage,`${this.storageKey}-code-verifier`),Ye(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:s,error:l}=await this.getUser();if(l)throw l;return this._returnResult({data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(s){if(Ye(s))return this._returnResult({data:null,error:s});throw s}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var s;try{const{data:l,error:c}=await this._useSession(async u=>{var d,f,p,g,y;const{data:v,error:x}=u;if(x)throw x;const S=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(f=t.options)===null||f===void 0?void 0:f.scopes,queryParams:(p=t.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await st(this.fetch,"GET",S,{headers:this.headers,jwt:(y=(g=v.session)===null||g===void 0?void 0:g.access_token)!==null&&y!==void 0?y:void 0})});if(c)throw c;return Qn()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(l?.url),this._returnResult({data:{provider:t.provider,url:l?.url},error:null})}catch(l){if(Ye(l))return this._returnResult({data:{provider:t.provider,url:null},error:l});throw l}}async linkIdentityIdToken(t){return await this._useSession(async s=>{var l;try{const{error:c,data:{session:u}}=s;if(c)throw c;const{options:d,provider:f,token:p,access_token:g,nonce:y}=t,v=await st(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=u?.access_token)!==null&&l!==void 0?l:void 0,body:{provider:f,id_token:p,access_token:g,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Vr}),{data:x,error:S}=v;return S?this._returnResult({data:{user:null,session:null},error:S}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new Na}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:S}))}catch(c){if(await Yn(this.storage,`${this.storageKey}-code-verifier`),Ye(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}})}async unlinkIdentity(t){try{return await this._useSession(async s=>{var l,c;const{data:u,error:d}=s;if(d)throw d;return await st(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(c=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&c!==void 0?c:void 0})})}catch(s){if(Ye(s))return this._returnResult({data:null,error:s});throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const l=Date.now();return await DC(async c=>(c>0&&await OC(200*Math.pow(2,c-1)),this._debug(s,"refreshing attempt",c),await st(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Vr})),(c,u)=>{const d=200*Math.pow(2,c);return u&&Jh(u)&&Date.now()+d-l<La})}catch(l){if(this._debug(s,"error",l),Ye(l))return this._returnResult({data:{session:null,user:null},error:l});throw l}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const l=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",l),Qn()&&!s.skipBrowserRedirect&&window.location.assign(l),{data:{provider:t,url:l},error:null}}async _recoverAndRefresh(){var t,s;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const c=await Oi(this.storage,this.storageKey);if(c&&this.userStorage){let d=await Oi(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:c.user},await Ba(this.userStorage,this.storageKey+"-user",d)),c.user=(t=d?.user)!==null&&t!==void 0?t:ef()}else if(c&&!c.user&&!c.user){const d=await Oi(this.storage,this.storageKey+"-user");d&&d?.user?(c.user=d.user,await Yn(this.storage,this.storageKey+"-user"),await Ba(this.storage,this.storageKey,c)):c.user=ef()}if(this._debug(l,"session from storage",c),!this._isValidSession(c)){this._debug(l,"session is not valid"),c!==null&&await this._removeSession();return}const u=((s=c.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Xh;if(this._debug(l,`session has${u?"":" not"} expired with margin of ${Xh}s`),u){if(this.autoRefreshToken&&c.refresh_token){const{error:d}=await this._callRefreshToken(c.refresh_token);d&&(console.error(d),Jh(d)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(c.user&&c.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:f}=await this._getUser(c.access_token);!f&&d?.user?(c.user=d.user,await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(l,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",c)}catch(c){this._debug(l,"error",c),console.error(c);return}finally{this._debug(l,"end")}}async _callRefreshToken(t){var s,l;if(!t)throw new Sr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new Mu;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new Sr;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const f={data:u.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(u){if(this._debug(c,"error",u),Ye(u)){const d={data:null,error:u};return Jh(u)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(d),d}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(u),u}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(t,s,l=!0){const c=`#_notifyAllSubscribers(${t})`;this._debug(c,"begin",s,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:t,session:s});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(t,s)}catch(p){u.push(p)}});if(await Promise.all(d),u.length>0){for(let f=0;f<u.length;f+=1)console.error(u[f]);throw u[0]}}finally{this._debug(c,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Yn(this.storage,`${this.storageKey}-code-verifier`);const s=Object.assign({},t),l=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&s.user&&await Ba(this.userStorage,this.storageKey+"-user",{user:s.user});const c=Object.assign({},s);delete c.user;const u=zv(c);await Ba(this.storage,this.storageKey,u)}else{const c=zv(s);await Ba(this.storage,this.storageKey,c)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Yn(this.storage,this.storageKey),await Yn(this.storage,this.storageKey+"-code-verifier"),await Yn(this.storage,this.storageKey+"-user"),this.userStorage&&await Yn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Qn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),La);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:l}}=s;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((l.expires_at*1e3-t)/La);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${La}ms, refresh threshold is ${Uf} ticks`),c<=Uf&&await this._callRefreshToken(l.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Rx)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Qn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,l){const c=[`provider=${encodeURIComponent(s)}`];if(l?.redirectTo&&c.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l?.scopes&&c.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[u,d]=await Ra(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});c.push(f.toString())}if(l?.queryParams){const u=new URLSearchParams(l.queryParams);c.push(u.toString())}return l?.skipBrowserRedirect&&c.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${t}?${c.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var l;const{data:c,error:u}=s;return u?this._returnResult({data:null,error:u}):await st(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token})})}catch(s){if(Ye(s))return this._returnResult({data:null,error:s});throw s}}async _enroll(t){try{return await this._useSession(async s=>{var l,c;const{data:u,error:d}=s;if(d)return this._returnResult({data:null,error:d});const f=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:p,error:g}=await st(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(l=u?.session)===null||l===void 0?void 0:l.access_token});return g?this._returnResult({data:null,error:g}):(t.factorType==="totp"&&p.type==="totp"&&(!((c=p?.totp)===null||c===void 0)&&c.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),this._returnResult({data:p,error:null}))})}catch(s){if(Ye(s))return this._returnResult({data:null,error:s});throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var l;const{data:c,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?cE(t.webauthn.credential_response):uE(t.webauthn.credential_response)})}:{code:t.code}),{data:f,error:p}=await st(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token});return p?this._returnResult({data:null,error:p}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+f.expires_in},f)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",f),this._returnResult({data:f,error:p}))})}catch(s){if(Ye(s))return this._returnResult({data:null,error:s});throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var l;const{data:c,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=await st(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(l=c?.session)===null||l===void 0?void 0:l.access_token});if(d.error)return d;const{data:f}=d;if(f.type!=="webauthn")return{data:f,error:null};switch(f.webauthn.type){case"create":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:lE(f.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:oE(f.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(s){if(Ye(s))return this._returnResult({data:null,error:s});throw s}})}async _challengeAndVerify(t){const{data:s,error:l}=await this._challenge({factorId:t.factorId});return l?this._returnResult({data:null,error:l}):await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){var t;const{data:{user:s},error:l}=await this.getUser();if(l)return{data:null,error:l};const c={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=s?.factors)!==null&&t!==void 0?t:[])c.all.push(u),u.status==="verified"&&c[u.factor_type].push(u);return{data:c,error:null}}async _getAuthenticatorAssuranceLevel(){var t,s;const{data:{session:l},error:c}=await this.getSession();if(c)return this._returnResult({data:null,error:c});if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=Zh(l.access_token);let d=null;u.aal&&(d=u.aal);let f=d;((s=(t=l.user.factors)===null||t===void 0?void 0:t.filter(y=>y.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(f="aal2");const g=u.amr||[];return{data:{currentLevel:d,nextLevel:f,currentAuthenticationMethods:g},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async s=>{const{data:{session:l},error:c}=s;return c?this._returnResult({data:null,error:c}):l?await st(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:l.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Sr})})}catch(s){if(Ye(s))return this._returnResult({data:null,error:s});throw s}}async _approveAuthorization(t,s){try{return await this._useSession(async l=>{const{data:{session:c},error:u}=l;if(u)return this._returnResult({data:null,error:u});if(!c)return this._returnResult({data:null,error:new Sr});const d=await st(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"approve"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&Qn()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(l){if(Ye(l))return this._returnResult({data:null,error:l});throw l}}async _denyAuthorization(t,s){try{return await this._useSession(async l=>{const{data:{session:c},error:u}=l;if(u)return this._returnResult({data:null,error:u});if(!c)return this._returnResult({data:null,error:new Sr});const d=await st(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"deny"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&Qn()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(l){if(Ye(l))return this._returnResult({data:null,error:l});throw l}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:s},error:l}=t;return l?this._returnResult({data:null,error:l}):s?await st(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,xform:c=>({data:c,error:null})}):this._returnResult({data:null,error:new Sr})})}catch(t){if(Ye(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async s=>{const{data:{session:l},error:c}=s;return c?this._returnResult({data:null,error:c}):l?(await st(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:l.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Sr})})}catch(s){if(Ye(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(t,s={keys:[]}){let l=s.keys.find(f=>f.kid===t);if(l)return l;const c=Date.now();if(l=this.jwks.keys.find(f=>f.kid===t),l&&this.jwks_cached_at+yC>c)return l;const{data:u,error:d}=await st(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=c,l=u.keys.find(f=>f.kid===t),!l)?null:l}async getClaims(t,s={}){try{let l=t;if(!l){const{data:S,error:C}=await this.getSession();if(C||!S.session)return this._returnResult({data:null,error:C});l=S.session.access_token}const{header:c,payload:u,signature:d,raw:{header:f,payload:p}}=Zh(l);s?.allowExpired||$C(u.exp);const g=!c.alg||c.alg.startsWith("HS")||!c.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(c.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!g){const{error:S}=await this.getUser(l);if(S)throw S;return{data:{claims:u,header:c,signature:d},error:null}}const y=qC(c.alg),v=await crypto.subtle.importKey("jwk",g,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,NC(`${f}.${p}`)))throw new If("Invalid JWT signature");return{data:{claims:u,header:c,signature:d},error:null}}catch(l){if(Ye(l))return this._returnResult({data:null,error:l});throw l}}}vo.nextInstanceID={};const xE=vo,bE="2.89.0";let to="";typeof Deno<"u"?to="deno":typeof document<"u"?to="web":typeof navigator<"u"&&navigator.product==="ReactNative"?to="react-native":to="node";const wE={"X-Client-Info":`supabase-js-${to}/${bE}`},SE={headers:wE},jE={schema:"public"},_E={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},CE={};function xo(n){"@babel/helpers - typeof";return xo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xo(n)}function EE(n,t){if(xo(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var l=s.call(n,t);if(xo(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function NE(n){var t=EE(n,"string");return xo(t)=="symbol"?t:t+""}function RE(n,t,s){return(t=NE(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function Pv(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable})),s.push.apply(s,l)}return s}function hn(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Pv(Object(s),!0).forEach(function(l){RE(n,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Pv(Object(s)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(s,l))})}return n}const TE=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),AE=()=>Headers,kE=(n,t,s)=>{const l=TE(s),c=AE();return async(u,d)=>{var f;const p=(f=await t())!==null&&f!==void 0?f:n;let g=new c(d?.headers);return g.has("apikey")||g.set("apikey",n),g.has("Authorization")||g.set("Authorization",`Bearer ${p}`),l(u,hn(hn({},d),{},{headers:g}))}};function OE(n){return n.endsWith("/")?n:n+"/"}function DE(n,t){var s,l;const{db:c,auth:u,realtime:d,global:f}=n,{db:p,auth:g,realtime:y,global:v}=t,x={db:hn(hn({},p),c),auth:hn(hn({},g),u),realtime:hn(hn({},y),d),storage:{},global:hn(hn(hn({},v),f),{},{headers:hn(hn({},(s=v?.headers)!==null&&s!==void 0?s:{}),(l=f?.headers)!==null&&l!==void 0?l:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function ME(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(OE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var zE=class extends xE{constructor(n){super(n)}},UE=class{constructor(n,t,s){var l,c;this.supabaseUrl=n,this.supabaseKey=t;const u=ME(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,f={db:jE,realtime:CE,auth:hn(hn({},_E),{},{storageKey:d}),global:SE},p=DE(s??{},f);if(this.storageKey=(l=p.auth.storageKey)!==null&&l!==void 0?l:"",this.headers=(c=p.global.headers)!==null&&c!==void 0?c:{},p.accessToken)this.accessToken=p.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var g;this.auth=this._initSupabaseAuthClient((g=p.auth)!==null&&g!==void 0?g:{},this.headers,p.global.fetch)}this.fetch=kE(t,this._getAccessToken.bind(this),p.global.fetch),this.realtime=this._initRealtimeClient(hn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},p.realtime)),this.accessToken&&this.accessToken().then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new m1(new URL("rest/v1",u).href,{headers:this.headers,schema:p.db.schema,fetch:this.fetch}),this.storage=new hC(this.storageUrl.href,this.headers,this.fetch,s?.storage),p.accessToken||this._listenForAuthEvents()}get functions(){return new u1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,s)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,s;if(n.accessToken)return await n.accessToken();const{data:l}=await n.auth.getSession();return(t=(s=l.session)===null||s===void 0?void 0:s.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:l,userStorage:c,storageKey:u,flowType:d,lock:f,debug:p,throwOnError:g},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new zE({url:this.authUrl.href,headers:hn(hn({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:l,userStorage:c,flowType:d,lock:f,debug:p,throwOnError:g,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(S=>S.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new O1(this.realtimeUrl.href,hn(hn({},n),{},{params:hn(hn({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,s){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const LE=(n,t,s)=>new UE(n,t,s);function BE(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}BE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const nf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var IE={};const kx=n=>{if(typeof import.meta<"u"&&nf&&nf[n])return nf[n];const t=IE;return t&&t[n]?t[n]:null},$E=kx("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",qE=kx("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",Te=LE($E,qE),PE={async translateRecipe(n,t="EN-US"){const s=[];s.push(n.title||""),s.push(n.description||"");let l=2,c=2;if(n.type==="bread"){const d=n.flours||[],f=n.breadIngredients||[];d.forEach(p=>s.push(p.name||"")),f.forEach(p=>s.push(p.name||"")),c=l+d.length+f.length}else{const d=n.ingredients||[];d.forEach(f=>{const p=typeof f=="string"?f:f.name||"";s.push(p)}),c=l+d.length}const u=n.steps||[];if(u.forEach(d=>{const f=typeof d=="object"&&d!==null?d.text||"":d||"";s.push(f)}),s.length===0)return n;try{const d=await this.translateList(s,t),f={...n};if(f.title=d[0],f.description=d[1],n.type==="bread"){const p=(n.flours||[]).length;f.flours=(n.flours||[]).map((g,y)=>({...g,name:d[l+y]})),f.breadIngredients=(n.breadIngredients||[]).map((g,y)=>({...g,name:d[l+p+y]}))}else f.ingredients=(n.ingredients||[]).map((p,g)=>{const y=d[l+g];return typeof p=="string"?y:{...p,name:y}});return f.steps=u.map((p,g)=>{const y=d[c+g];return typeof p=="object"&&p!==null?{...p,text:y}:y}),f}catch(d){throw console.error("Translation failed:",d),d}},async translateList(n,t){const{data:s,error:l}=await Te.functions.invoke("translate",{body:{text:n,target_lang:t}});if(l)throw console.error("Supabase Function Invocation Error:",l),new Error(`Translation Error: ${l.message}`);if(s&&s.error)throw console.error("Edge Function returned error:",s.error),new Error(`Translation Error: ${s.error}`);return s.translations.map(c=>c.text)}},bn=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},Xc=async(n,t,s)=>{let l=null;try{const c=new Promise((u,d)=>{l=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,c])}finally{l&&clearTimeout(l)}},au=n=>{if(Array.isArray(n))return n.map(s=>String(s)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const s=t.slice(1,-1);return s?s.split(",").map(l=>l.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},HE=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],s=Object.values(t)[0];return au(s)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return au(t)}return au(n)},FE=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const s=au(t);return s.length>0?s:t.split(",").map(l=>l.trim()).filter(Boolean)}return[]},Hv=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),s=String(n.message||"").toLowerCase(),l=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||s.includes("row-level security")||s.includes("permission denied")||s.includes("violates row-level security")||s.includes("invalid input syntax")||s.includes("column")||l.includes("row-level security")?!1:s.includes("failed to fetch")||s.includes("network")||s.includes("timeout")||s.includes("timed out")||s.includes("load failed")},Nn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},async _resolveShowMasterPreference(n,t=15e3){const s=n?.showMasterRecipes===!0,l=n?.id;if(!l)return s;const c=this._showMasterPrefCache.get(l),u=Date.now();if(c&&c.value!==s)return this._showMasterPrefCache.set(l,{value:s,updatedAt:u}),s;if(c&&u-c.updatedAt<3e4)return c.value;try{const{data:d,error:f}=await Xc(Te.from("profiles").select("show_master_recipes").eq("id",l).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(f)throw f;const p=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(l,{value:p,updatedAt:u}),p}catch{return this._showMasterPrefCache.set(l,{value:s,updatedAt:u}),s}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:s,error:l}=await Xc(Te.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(l)throw l;const c=HE(s),u=new Set(c.length>0?c:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const s=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:s,updatedAt:t},s}},async fetchRecipes(n,{timeoutMs:t=15e3}={}){let s=[];const l=async(_,{withOrderIndex:T})=>{let D=Te.from("recipes").select(_);T?D=D.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):D=D.order("created_at",{ascending:!1});const{data:B,error:P}=await Xc(D,t/4,"recipes.select(list)");if(P)throw P;return(B||[]).map(Yr)},c="id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index,recipe_sources(url)",u="id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,recipe_sources(url)",d="id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at",f="id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at";let p=null;const g="recipe_query_pattern",y=this._queryPatternCache.get(g);if(y)try{s=await l(y.spec,{withOrderIndex:y.withOrderIndex})}catch(_){console.warn("Cached query pattern failed, re-detecting...",_),this._queryPatternCache.delete(g),p=_}else try{s=await l(c,{withOrderIndex:!0}),this._queryPatternCache.set(g,{spec:c,withOrderIndex:!0})}catch(_){p=_;try{s=await l(u,{withOrderIndex:!1}),this._queryPatternCache.set(g,{spec:u,withOrderIndex:!1})}catch(T){p=T;try{s=await l(d,{withOrderIndex:!1}),this._queryPatternCache.set(g,{spec:d,withOrderIndex:!1})}catch(D){p=D;try{s=await l(f,{withOrderIndex:!1}),this._queryPatternCache.set(g,{spec:f,withOrderIndex:!1})}catch(B){p=B,s=[]}}}}if(s.length===0&&p)try{const _=localStorage.getItem("local_recipes");if(_)s=JSON.parse(_).map(T=>typeof Yr=="function"?Yr(T):T);else throw p}catch{throw p}if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const v=await this._resolveShowMasterPreference(n,t),x=await this._resolveMasterOwnerTags(t),S=n.role==="admin",C=[String(n.id)];return n.displayId&&C.push(String(n.displayId)),s.filter(_=>{if(S)return!0;const T=FE(_.tags),D=T.filter(j=>j&&j.startsWith("owner:"));if(D.length===0)return!0;const B=D.some(j=>x.has(j));if(v&&B)return!0;const P=D.some(j=>C.some(M=>j===`owner:${M}`)),$=T.includes("public");return!!(P||$)})},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),l=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:c}=await Te.storage.from("recipe-images").upload(l,n);if(c)throw c;const{data:u}=Te.storage.from("recipe-images").getPublicUrl(l);return u.publicUrl},async getRecipe(n){try{const{data:t,error:s}=await Xc(Te.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(s)throw s;return Yr(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const s=localStorage.getItem("local_recipes");if(s){const c=JSON.parse(s).find(u=>u.id==n);if(c)return Yr(c)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:s,created_at:l,sourceUrl:c,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const p=(u.tags||[]).filter(g=>!g.startsWith("owner:"));u.tags=[...p,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=Jc(u);try{const{data:f,error:p}=await Te.from("recipes").insert([d]).select().single();if(p)throw p;if(c){const{error:g}=await Te.from("recipe_sources").insert([{recipe_id:f.id,url:c}]);g&&console.error("Failed to save source URL:",g)}return Yr({...f,recipe_sources:c?[{url:c}]:[]})}catch(f){if(!Hv(f))throw f;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",f);const p=Date.now(),g={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=Jc(g);y.id=p,y.created_at=g.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),f}return Yr(y)}},async updateRecipe(n){const{id:t,created_at:s,sourceUrl:l,...c}=n;c.image instanceof File&&(c.image=await this.uploadImage(c.image));const u=Jc(c);try{const{data:d,error:f}=await Te.from("recipes").update(u).eq("id",n.id).select().single();if(f)throw f;if(l!==void 0&&(await Te.from("recipe_sources").delete().eq("recipe_id",n.id),l)){const{error:p}=await Te.from("recipe_sources").insert([{recipe_id:n.id,url:l}]);p&&console.error("Failed to update source URL:",p)}return Yr({...d,recipe_sources:l?[{url:l}]:[]})}catch(d){if(!Hv(d))throw d;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",d);const f=localStorage.getItem("local_recipes");if(f){let p=JSON.parse(f);const g=p.findIndex(y=>y.id==n.id);if(g!==-1){const y={...p[g],...u,updated_at:new Date().toISOString()};return p[g]=y,localStorage.setItem("local_recipes",JSON.stringify(p)),Yr(y)}}throw d}},async duplicateRecipe(n,t){const{id:s,created_at:l,updated_at:c,image:u,...d}=n;d.title=`${d.title} ()`;let f=null;if(u)try{const p=u.split("/").pop(),g=`copy-${Date.now()}-${p}`,{error:y}=await Te.storage.from("recipe-images").copy(p,g);if(y)console.warn("Image copy failed, using original URL:",y),f=u;else{const{data:v}=Te.storage.from("recipe-images").getPublicUrl(g);f=v.publicUrl}}catch(p){console.warn("Image copy logic error:",p),f=u}return d.image=f,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await Te.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(GE)},async getDeletedCount(){const{count:n,error:t}=await Te.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:s}=await Te.from("recipes").select("*").eq("id",n).single();if(s)throw s;const{error:l}=await Te.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(l)throw l;const{error:c}=await Te.from("recipes").delete().eq("id",n);if(c)throw c;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const s=localStorage.getItem("local_recipes");if(s){let l=JSON.parse(s);const c=l.length;if(l=l.filter(u=>u.id!=n),l.length<c)return localStorage.setItem("local_recipes",JSON.stringify(l)),!0}throw t}},async restoreRecipe(n){const{data:t,error:s}=await Te.from("deleted_recipes").select("*").eq("id",n).single();if(s)throw s;const{error:l}=await Te.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(l)throw l;const{error:c}=await Te.from("deleted_recipes").delete().eq("id",n);if(c)throw c;return!0},async hardDeleteRecipe(n){const{error:t}=await Te.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await Te.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(s=>s.recipe_id)},async addToHistory(n){const{error:t}=await Te.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(s=>Te.from("recipes").update({order_index:s.order_index}).eq("id",s.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,s=[];for(const l of n)try{await this.createRecipe(l),t++}catch(c){console.error("Import failed for recipe:",l.title,c),s.push({title:l.title,error:c.message})}return{success:!0,count:t,errors:s}},async updateRecipeCosts(n){const{data:t,error:s}=await Te.from("recipes").select("*");if(s)throw s;let l=0;const c=[];for(const u of t){const d=Yr(u);let f=!1;const p=g=>g.map(y=>{if(!y.name)return y;const v=n.get(bn(y.name));if(v&&y.purchaseCost!==v.price){f=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const S=parseFloat(x.quantity)||0;x.cost=Math.round(S/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const S=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*S)}return x}return y});if(d.type==="bread"){const g=p(d.flours||[]),y=p(d.breadIngredients||[]);f&&(d.flours=g,d.breadIngredients=y)}else{const g=p(d.ingredients||[]);f&&(d.ingredients=g)}if(f){const g=Jc(d);c.push(Te.from("recipes").update(g).eq("id",d.id)),l++}}return c.length>0&&await Promise.all(c),l}},Jc=n=>{let t=n.ingredients||[];const s={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(s.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const c=n.steps||[],u=n.stepGroups.map(d=>({...d,count:c.filter(f=>f.groupId===d.id).length}));s.stepGroups=u}if(n.type==="bread"){const c=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[s,...c,...u]}else t=[s,...t];const l=(n.steps||[]).map(c=>typeof c=="string"?c:c.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:l,tags:n.tags||[]}},Yr=n=>{const t=n.ingredients||[];let s="normal",l=[],c=[],u=[],d=[],f=t;if(n.ingredients_meta)s=n.ingredients_meta.type||"normal",f=[];else if(Array.isArray(t)&&t.length>0&&t[0]._meta){const g=t[0];s=g.type||"normal",g.groups&&(u=g.groups),g.stepGroups&&(d=g.stepGroups);const y=t.slice(1);s==="bread"?(l=y.filter(v=>v._group==="flour").map(v=>{const{_group:x,...S}=v;return S}),c=y.filter(v=>v._group==="other").map(v=>{const{_group:x,...S}=v;return S}),f=[...l,...c]):f=y}let p=n.steps||[];if(d.length>0&&Array.isArray(p)){let g=0;p=p.map(v=>({text:v}));const y=[];for(d.forEach(v=>{const x=v.count||0;for(let S=0;S<x;S++)g<p.length&&(y.push({...p[g],text:p[g].text,groupId:v.id}),g++)});g<p.length;)y.push({...p[g],groupId:"default"}),g++;p=y}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:s,flours:l,breadIngredients:c,ingredientGroups:u,stepGroups:d,ingredients:f,steps:p.length>0&&typeof p[0]=="object"?p:n.steps,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},GE=n=>({...Yr(n),deletedAt:n.deleted_at,originalId:n.original_id}),rf=Object.freeze(Object.defineProperty({__proto__:null,recipeService:Nn},Symbol.toStringTag,{value:"Module"})),sf="food",VE="food_alcohol",YE=new Set(["food","alcohol","soft_drink","supplies"]),Zc=n=>{const t=String(n||"").trim();return!t||t===VE?sf:YE.has(t)?t:sf},$n={async _getCurrentUserId(){const{data:n,error:t}=await Te.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,s,l=null,c=null,u=void 0,d=void 0){try{const f=await this._getCurrentUserId();if(!f)throw new Error("");const p={user_id:f,ingredient_name:n,packet_size:parseFloat(t),packet_unit:s,last_price:l?parseFloat(l):null,updated_at:new Date().toISOString()};if(c&&(p.item_category=Zc(c)),u!==void 0){const x=String(u??"").trim();p.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let S=Number.isFinite(x)?x:100;S<=0&&(S=100),S>100&&(S=100),p.yield_percent=S}const g=async x=>Te.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await g(p);if(v){const x=String(v.message||""),S=!!p.item_category&&x.includes("item_category"),C=Object.prototype.hasOwnProperty.call(p,"vendor")&&x.includes("vendor"),E=Object.prototype.hasOwnProperty.call(p,"yield_percent")&&x.includes("yield_percent");if(S||C||E){const _={...p};S&&delete _.item_category,C&&delete _.vendor,E&&delete _.yield_percent,{data:y,error:v}=await g(_)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:Zc(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(f){throw console.error("Error saving conversion:",f),f}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:s,error:l}=await Te.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return l?(l.code==="PGRST116"||console.warn("Error fetching conversion:",l),null):{ingredientName:s.ingredient_name,packetSize:s.packet_size,packetUnit:s.packet_unit,lastPrice:s.last_price,vendor:s.vendor||"",itemCategory:Zc(s.item_category),yieldPercent:s.yield_percent===null||s.yield_percent===void 0?100:s.yield_percent,updatedAt:s.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:s}=await Te.from("unit_conversions").select("*").eq("user_id",n);if(s)throw s;const l=new Map;return t.forEach(c=>{l.set(c.ingredient_name,{ingredientName:c.ingredient_name,packetSize:c.packet_size,packetUnit:c.packet_unit,lastPrice:c.last_price,vendor:c.vendor||"",itemCategory:Zc(c.item_category),yieldPercent:c.yield_percent===null||c.yield_percent===void 0?100:c.yield_percent,updatedAt:c.updated_at})}),l}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:s}=await Te.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(s)throw s;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}}},Ox=w.createContext(null),fi=()=>w.useContext(Ox),lu=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],KE=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var Oa={},af={exports:{}},lf,Fv;function QE(){if(Fv)return lf;Fv=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return lf=n,lf}var of,Gv;function WE(){if(Gv)return of;Gv=1;var n=QE();function t(){}function s(){}return s.resetWarningCache=t,of=function(){function l(d,f,p,g,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}l.isRequired=l;function c(){return l}var u={array:l,bigint:l,bool:l,func:l,number:l,object:l,string:l,symbol:l,any:l,arrayOf:c,element:l,elementType:l,instanceOf:c,node:l,objectOf:c,oneOf:c,oneOfType:c,shape:c,exact:c,checkPropTypes:s,resetWarningCache:t};return u.PropTypes=u,u},of}var Vv;function Dx(){return Vv||(Vv=1,af.exports=WE()()),af.exports}var cf,Yv;function Mx(){return Yv||(Yv=1,cf={L:1,M:0,Q:3,H:2}),cf}var uf,Kv;function zx(){return Kv||(Kv=1,uf={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),uf}var df,Qv;function XE(){if(Qv)return df;Qv=1;var n=zx();function t(s){this.mode=n.MODE_8BIT_BYTE,this.data=s}return t.prototype={getLength:function(s){return this.data.length},write:function(s){for(var l=0;l<this.data.length;l++)s.put(this.data.charCodeAt(l),8)}},df=t,df}var hf,Wv;function JE(){if(Wv)return hf;Wv=1;var n=Mx();function t(s,l){this.totalCount=s,this.dataCount=l}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(s,l){var c=t.getRsBlockTable(s,l);if(c==null)throw new Error("bad rs block @ typeNumber:"+s+"/errorCorrectLevel:"+l);for(var u=c.length/3,d=new Array,f=0;f<u;f++)for(var p=c[f*3+0],g=c[f*3+1],y=c[f*3+2],v=0;v<p;v++)d.push(new t(g,y));return d},t.getRsBlockTable=function(s,l){switch(l){case n.L:return t.RS_BLOCK_TABLE[(s-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(s-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(s-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(s-1)*4+3];default:return}},hf=t,hf}var ff,Xv;function ZE(){if(Xv)return ff;Xv=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var s=Math.floor(t/8);return(this.buffer[s]>>>7-t%8&1)==1},put:function(t,s){for(var l=0;l<s;l++)this.putBit((t>>>s-l-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),t&&(this.buffer[s]|=128>>>this.length%8),this.length++}},ff=n,ff}var pf,Jv;function Ux(){if(Jv)return pf;Jv=1;for(var n={glog:function(s){if(s<1)throw new Error("glog("+s+")");return n.LOG_TABLE[s]},gexp:function(s){for(;s<0;)s+=255;for(;s>=256;)s-=255;return n.EXP_TABLE[s]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return pf=n,pf}var mf,Zv;function Lx(){if(Zv)return mf;Zv=1;var n=Ux();function t(s,l){if(s.length==null)throw new Error(s.length+"/"+l);for(var c=0;c<s.length&&s[c]==0;)c++;this.num=new Array(s.length-c+l);for(var u=0;u<s.length-c;u++)this.num[u]=s[u+c]}return t.prototype={get:function(s){return this.num[s]},getLength:function(){return this.num.length},multiply:function(s){for(var l=new Array(this.getLength()+s.getLength()-1),c=0;c<this.getLength();c++)for(var u=0;u<s.getLength();u++)l[c+u]^=n.gexp(n.glog(this.get(c))+n.glog(s.get(u)));return new t(l,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var l=n.glog(this.get(0))-n.glog(s.get(0)),c=new Array(this.getLength()),u=0;u<this.getLength();u++)c[u]=this.get(u);for(var u=0;u<s.getLength();u++)c[u]^=n.gexp(n.glog(s.get(u))+l);return new t(c,0).mod(s)}},mf=t,mf}var gf,e0;function eN(){if(e0)return gf;e0=1;var n=zx(),t=Lx(),s=Ux(),l={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},c={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;c.getBCHDigit(d)-c.getBCHDigit(c.G15)>=0;)d^=c.G15<<c.getBCHDigit(d)-c.getBCHDigit(c.G15);return(u<<10|d)^c.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;c.getBCHDigit(d)-c.getBCHDigit(c.G18)>=0;)d^=c.G18<<c.getBCHDigit(d)-c.getBCHDigit(c.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return c.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,f){switch(u){case l.PATTERN000:return(d+f)%2==0;case l.PATTERN001:return d%2==0;case l.PATTERN010:return f%3==0;case l.PATTERN011:return(d+f)%3==0;case l.PATTERN100:return(Math.floor(d/2)+Math.floor(f/3))%2==0;case l.PATTERN101:return d*f%2+d*f%3==0;case l.PATTERN110:return(d*f%2+d*f%3)%2==0;case l.PATTERN111:return(d*f%3+(d+f)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),f=0;f<u;f++)d=d.multiply(new t([1,s.gexp(f)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),f=0,p=0;p<d;p++)for(var g=0;g<d;g++){for(var y=0,v=u.isDark(p,g),x=-1;x<=1;x++)if(!(p+x<0||d<=p+x))for(var S=-1;S<=1;S++)g+S<0||d<=g+S||x==0&&S==0||v==u.isDark(p+x,g+S)&&y++;y>5&&(f+=3+y-5)}for(var p=0;p<d-1;p++)for(var g=0;g<d-1;g++){var C=0;u.isDark(p,g)&&C++,u.isDark(p+1,g)&&C++,u.isDark(p,g+1)&&C++,u.isDark(p+1,g+1)&&C++,(C==0||C==4)&&(f+=3)}for(var p=0;p<d;p++)for(var g=0;g<d-6;g++)u.isDark(p,g)&&!u.isDark(p,g+1)&&u.isDark(p,g+2)&&u.isDark(p,g+3)&&u.isDark(p,g+4)&&!u.isDark(p,g+5)&&u.isDark(p,g+6)&&(f+=40);for(var g=0;g<d;g++)for(var p=0;p<d-6;p++)u.isDark(p,g)&&!u.isDark(p+1,g)&&u.isDark(p+2,g)&&u.isDark(p+3,g)&&u.isDark(p+4,g)&&!u.isDark(p+5,g)&&u.isDark(p+6,g)&&(f+=40);for(var E=0,g=0;g<d;g++)for(var p=0;p<d;p++)u.isDark(p,g)&&E++;var _=Math.abs(100*E/d/d-50)/5;return f+=_*10,f}};return gf=c,gf}var yf,t0;function tN(){if(t0)return yf;t0=1;var n=XE(),t=JE(),s=ZE(),l=eN(),c=Lx();function u(f,p){this.typeNumber=f,this.errorCorrectLevel=p,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(f){var p=new n(f);this.dataList.push(p),this.dataCache=null},d.isDark=function(f,p){if(f<0||this.moduleCount<=f||p<0||this.moduleCount<=p)throw new Error(f+","+p);return this.modules[f][p]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var f=1;for(f=1;f<40;f++){for(var p=t.getRSBlocks(f,this.errorCorrectLevel),g=new s,y=0,v=0;v<p.length;v++)y+=p[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];g.put(x.mode,4),g.put(x.getLength(),l.getLengthInBits(x.mode,f)),x.write(g)}if(g.getLengthInBits()<=y*8)break}this.typeNumber=f}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(f,p){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var g=0;g<this.moduleCount;g++){this.modules[g]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[g][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(f,p),this.typeNumber>=7&&this.setupTypeNumber(f),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,p)},d.setupPositionProbePattern=function(f,p){for(var g=-1;g<=7;g++)if(!(f+g<=-1||this.moduleCount<=f+g))for(var y=-1;y<=7;y++)p+y<=-1||this.moduleCount<=p+y||(0<=g&&g<=6&&(y==0||y==6)||0<=y&&y<=6&&(g==0||g==6)||2<=g&&g<=4&&2<=y&&y<=4?this.modules[f+g][p+y]=!0:this.modules[f+g][p+y]=!1)},d.getBestMaskPattern=function(){for(var f=0,p=0,g=0;g<8;g++){this.makeImpl(!0,g);var y=l.getLostPoint(this);(g==0||f>y)&&(f=y,p=g)}return p},d.createMovieClip=function(f,p,g){var y=f.createEmptyMovieClip(p,g),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var S=x*v,C=0;C<this.modules[x].length;C++){var E=C*v,_=this.modules[x][C];_&&(y.beginFill(0,100),y.moveTo(E,S),y.lineTo(E+v,S),y.lineTo(E+v,S+v),y.lineTo(E,S+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var f=8;f<this.moduleCount-8;f++)this.modules[f][6]==null&&(this.modules[f][6]=f%2==0);for(var p=8;p<this.moduleCount-8;p++)this.modules[6][p]==null&&(this.modules[6][p]=p%2==0)},d.setupPositionAdjustPattern=function(){for(var f=l.getPatternPosition(this.typeNumber),p=0;p<f.length;p++)for(var g=0;g<f.length;g++){var y=f[p],v=f[g];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var S=-2;S<=2;S++)x==-2||x==2||S==-2||S==2||x==0&&S==0?this.modules[y+x][v+S]=!0:this.modules[y+x][v+S]=!1}},d.setupTypeNumber=function(f){for(var p=l.getBCHTypeNumber(this.typeNumber),g=0;g<18;g++){var y=!f&&(p>>g&1)==1;this.modules[Math.floor(g/3)][g%3+this.moduleCount-8-3]=y}for(var g=0;g<18;g++){var y=!f&&(p>>g&1)==1;this.modules[g%3+this.moduleCount-8-3][Math.floor(g/3)]=y}},d.setupTypeInfo=function(f,p){for(var g=this.errorCorrectLevel<<3|p,y=l.getBCHTypeInfo(g),v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!f},d.mapData=function(f,p){for(var g=-1,y=this.moduleCount-1,v=7,x=0,S=this.moduleCount-1;S>0;S-=2)for(S==6&&S--;;){for(var C=0;C<2;C++)if(this.modules[y][S-C]==null){var E=!1;x<f.length&&(E=(f[x]>>>v&1)==1);var _=l.getMask(p,y,S-C);_&&(E=!E),this.modules[y][S-C]=E,v--,v==-1&&(x++,v=7)}if(y+=g,y<0||this.moduleCount<=y){y-=g,g=-g;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(f,p,g){for(var y=t.getRSBlocks(f,p),v=new s,x=0;x<g.length;x++){var S=g[x];v.put(S.mode,4),v.put(S.getLength(),l.getLengthInBits(S.mode,f)),S.write(v)}for(var C=0,x=0;x<y.length;x++)C+=y[x].dataCount;if(v.getLengthInBits()>C*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+C*8+")");for(v.getLengthInBits()+4<=C*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=C*8||(v.put(u.PAD0,8),v.getLengthInBits()>=C*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(f,p){for(var g=0,y=0,v=0,x=new Array(p.length),S=new Array(p.length),C=0;C<p.length;C++){var E=p[C].dataCount,_=p[C].totalCount-E;y=Math.max(y,E),v=Math.max(v,_),x[C]=new Array(E);for(var T=0;T<x[C].length;T++)x[C][T]=255&f.buffer[T+g];g+=E;var D=l.getErrorCorrectPolynomial(_),B=new c(x[C],D.getLength()-1),P=B.mod(D);S[C]=new Array(D.getLength()-1);for(var T=0;T<S[C].length;T++){var $=T+P.getLength()-S[C].length;S[C][T]=$>=0?P.get($):0}}for(var j=0,T=0;T<p.length;T++)j+=p[T].totalCount;for(var M=new Array(j),A=0,T=0;T<y;T++)for(var C=0;C<p.length;C++)T<x[C].length&&(M[A++]=x[C][T]);for(var T=0;T<v;T++)for(var C=0;C<p.length;C++)T<S[C].length&&(M[A++]=S[C][T]);return M},yf=u,yf}var eu={},n0;function nN(){if(n0)return eu;n0=1,Object.defineProperty(eu,"__esModule",{value:!0});var n=Object.assign||function(g){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(g[x]=v[x])}return g},t=Dx(),s=u(t),l=wo(),c=u(l);function u(g){return g&&g.__esModule?g:{default:g}}function d(g,y){var v={};for(var x in g)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(g,x)&&(v[x]=g[x]);return v}var f={bgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,bgD:s.default.string.isRequired,fgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,fgD:s.default.string.isRequired,size:s.default.number.isRequired,title:s.default.string,viewBoxSize:s.default.number.isRequired,xmlns:s.default.string},p=(0,l.forwardRef)(function(g,y){var v=g.bgColor,x=g.bgD,S=g.fgD,C=g.fgColor,E=g.size,_=g.title,T=g.viewBoxSize,D=g.xmlns,B=D===void 0?"http://www.w3.org/2000/svg":D,P=d(g,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return c.default.createElement("svg",n({},P,{height:E,ref:y,viewBox:"0 0 "+T+" "+T,width:E,xmlns:B}),_?c.default.createElement("title",null,_):null,c.default.createElement("path",{d:x,fill:v}),c.default.createElement("path",{d:S,fill:C}))});return p.displayName="QRCodeSvg",p.propTypes=f,eu.default=p,eu}var r0;function rN(){if(r0)return Oa;r0=1,Object.defineProperty(Oa,"__esModule",{value:!0}),Oa.QRCode=void 0;var n=Object.assign||function(E){for(var _=1;_<arguments.length;_++){var T=arguments[_];for(var D in T)Object.prototype.hasOwnProperty.call(T,D)&&(E[D]=T[D])}return E},t=Dx(),s=v(t),l=Mx(),c=v(l),u=tN(),d=v(u),f=wo(),p=v(f),g=nN(),y=v(g);function v(E){return E&&E.__esModule?E:{default:E}}function x(E,_){var T={};for(var D in E)_.indexOf(D)>=0||Object.prototype.hasOwnProperty.call(E,D)&&(T[D]=E[D]);return T}var S={bgColor:s.default.oneOfType([s.default.object,s.default.string]),fgColor:s.default.oneOfType([s.default.object,s.default.string]),level:s.default.string,size:s.default.number,value:s.default.string.isRequired},C=(0,f.forwardRef)(function(E,_){var T=E.bgColor,D=T===void 0?"#FFFFFF":T,B=E.fgColor,P=B===void 0?"#000000":B,$=E.level,j=$===void 0?"L":$,M=E.size,A=M===void 0?256:M,F=E.value,Q=x(E,["bgColor","fgColor","level","size","value"]),G=new d.default(-1,c.default[j]);G.addData(F),G.make();var H=G.modules;return p.default.createElement(y.default,n({},Q,{bgColor:D,bgD:H.map(function(W,z){return W.map(function(I,N){return I?"":"M "+N+" "+z+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:P,fgD:H.map(function(W,z){return W.map(function(I,N){return I?"M "+N+" "+z+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:_,size:A,viewBoxSize:H.length}))});return Oa.QRCode=C,C.displayName="QRCode",C.propTypes=S,Oa.default=C,Oa}var sN=rN();const iN=x0(sN),s0=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},aN=new Set(["food","alcohol","soft_drink","supplies"]),Bx=new Set(["alcohol","supplies"]),Ix=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":aN.has(t)?t:"":""},$f=n=>{const t=Ix(n?.itemCategory??n?.item_category);return t?Bx.has(t):!!n?.isAlcohol},Di=n=>$f(n)?1.1:1.08,i0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),lN=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=i0(t);if(!l)return null;for(const[c,u]of n.entries())if(i0(c)===l)return u;return null},Rs=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},oN=n=>{const t=Rs(n);return!Number.isFinite(t)||t<=0||t>100?100:t},cN=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return oN(s)/100},uN=(n,t,s)=>{const l=Rs(n),c=Rs(t);if(!Number.isFinite(l)||!Number.isFinite(c)||c<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/c*1e3:(["kg","","l",""].includes(u),l/c)},a0=(n,t,s,{defaultWeightWhenUnitEmpty:l=!1,forceWeightBased:c=!1,yieldRate:u=1}={})=>{const d=Rs(n),f=Rs(t);if(!Number.isFinite(d)||!Number.isFinite(f))return NaN;const p=Number.isFinite(u)&&u>0?u:1,g=String(s||"").trim().toLowerCase();return c||!g&&l||["g","","ml","","cc",""].includes(g)?d/1e3*f/p:d*f/p},dN=(n,t)=>{const s=Rs(n?.purchaseCost),l=Rs(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},hN=({recipe:n,ownerLabel:t,onBack:s,onEdit:l,onDelete:c,onHardDelete:u,isDeleted:d,onView:f,onDuplicate:p,backLabel:g,onList:y})=>{const{user:v}=fi(),[x,S]=Ae.useState(!1),[C,E]=Ae.useState(!1),[_,T]=Ae.useState(!1),[D,B]=Ae.useState(new Set),[P,$]=Ae.useState(new Set),[j,M]=Ae.useState(new Set),[A,F]=Ae.useState({}),[Q,G]=Ae.useState("ORIGINAL"),[H,W]=Ae.useState(!1),[z,I]=Ae.useState(!0),[N,L]=Ae.useState(!1),[K,oe]=Ae.useState(new Map),[he,U]=Ae.useState(""),[V,k]=Ae.useState(1),[te,de]=Ae.useState(""),[fe,J]=Ae.useState(""),q=Ae.useMemo(()=>{const X=parseFloat(V);return isNaN(X)?1:X},[V]),le=(X,re)=>{if(!X)return"";const ae=parseFloat(X);if(isNaN(ae))return X;const xe=ae*parseFloat(re);return Number.isInteger(xe)?xe.toString():xe.toFixed(1).replace(/\.0$/,"")},ge=(X,re)=>{if(!X)return"";const ae=parseFloat(X);return isNaN(ae)?X:(ae*parseFloat(re)).toFixed(2).replace(/\.00$/,"")},[Ne,_e]=Ae.useState(n),[Me,Pe]=Ae.useState(!1),me=Q==="ORIGINAL"?Ne:A[Q]||Ne;Ae.useEffect(()=>{let X=!0;return $n.getAllConversions().then(re=>{X&&oe(re)}).catch(()=>{X&&oe(new Map)}),()=>{X=!1}},[]);const Qe=Ae.useMemo(()=>{const X=(re,ae={})=>{if(!re||typeof re!="object")return re;const xe=lN(K,re.name),Re=Ix(re.itemCategory??re.item_category??xe?.itemCategory),$e=cN(re,xe);let Oe=re;if(Re&&(Oe={...Oe,itemCategory:Re,isAlcohol:Bx.has(Re)}),!xe||!xe.packetSize){const Ie=String(re.unit||"").trim();if(ae.forceWeightBased||ae.defaultWeightWhenUnitEmpty&&!Ie){const It=a0(re.quantity,Oe.purchaseCost,re.unit,{...ae,yieldRate:$e}),sr=Number.isFinite(It)?Math.round(It*100)/100:NaN,An=Rs(Oe.cost);if(Number.isFinite(sr)&&(!Number.isFinite(An)||Math.abs(An-sr)>.01))return{...Oe,cost:sr}}return Oe}const rt=[xe.lastPrice,re.purchaseCostRef,re.purchase_cost,re.purchaseCost].find(Ie=>Number.isFinite(Rs(Ie))),pt=uN(rt,xe.packetSize,xe.packetUnit);if(!Number.isFinite(pt)||!dN(re,pt))return Oe;const gn=a0(re.quantity,pt,re.unit,{...ae,yieldRate:$e});return{...Oe,purchaseCost:Math.round(pt*100)/100,cost:Number.isFinite(gn)?Math.round(gn*100)/100:Oe.cost}};return{...me,ingredients:(me.ingredients||[]).map(re=>X(re)),flours:(me.flours||[]).map(re=>X(re,{forceWeightBased:!0})),breadIngredients:(me.breadIngredients||[]).map(re=>X(re,{forceWeightBased:!0}))}},[K,me]);Ae.useEffect(()=>{_e(n),!n.steps&&!d&&(Pe(!0),Nn.getRecipe(n.id).then(X=>{_e(X)}).catch(X=>{console.error("Failed to load details",X)}).finally(()=>{Pe(!1)}))},[n,d]);const[Xe,bt]=Ae.useState(n.tags?.includes("public")||!1),Nt=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),et=!(n.tags&&n.tags.some(X=>X.startsWith("owner:")))||Nt,ct=async()=>{const X=!Xe;try{const re=n.tags||[];let ae;X?ae=[...re,"public"]:ae=re.filter(xe=>xe!=="public"),bt(X),await Nn.updateRecipe({...n,tags:ae})}catch(re){console.error("Failed to toggle public",re),alert(""),bt(!X)}},wt=(X,re,ae=!1)=>Q==="ORIGINAL"||!z||!re||X===re?X:i.jsxs(i.Fragment,{children:[X,ae?i.jsx("br",{}):" ",i.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",re,")"]})]}),St=async X=>{const re=X.target.value;if(G(re),re!=="ORIGINAL"&&!A[re]){W(!0);try{const ae=await PE.translateRecipe(n,re);F(xe=>({...xe,[re]:ae}))}catch(ae){console.error(ae),alert(""),G("ORIGINAL")}finally{W(!1)}}},jt=X=>{B(re=>{const ae=new Set(re);return ae.has(X)?ae.delete(X):ae.add(X),ae})},lt=X=>{$(re=>{const ae=new Set(re);return ae.has(X)?ae.delete(X):ae.add(X),ae})},ut=X=>{M(re=>{const ae=new Set(re);return ae.has(X)?ae.delete(X):ae.add(X),ae})};Ae.useEffect(()=>{window.scrollTo(0,0),f&&n&&!d&&f(n.id);const X=document.title;return n&&n.title&&(document.title=n.title),F({}),G("ORIGINAL"),B(new Set),$(new Set),M(new Set),bt(n.tags?.includes("public")||!1),()=>{document.title=X}},[n.id,n.title]),Ae.useEffect(()=>{n&&n.servings?J(n.servings.toString()):J(""),de("")},[n]);const Rt=()=>{S(!0)},Tn=()=>{S(!1),c(n)},zn=()=>{S(!1)},Ut=()=>{T(!0)},Er=()=>{T(!1),u(n)},qn=()=>{T(!1)},Xt=()=>{E(!0)},an=async()=>{E(!1);try{const X=await Nn.duplicateRecipe(n,v);p&&p(X)}catch(X){console.error("Duplication failed",X),alert("")}},ln=()=>{E(!1)},on=Ae.useRef(null),tn=Ae.useRef(null),$r=X=>{tn.current=null,on.current=X.targetTouches[0].clientX},Un=X=>{tn.current=X.targetTouches[0].clientX},nn=()=>{if(!on.current||!tn.current)return;const X=on.current-tn.current,re=on.current<50,ae=X<-100;re&&ae&&s()},Lt=X=>{const re=Math.round(parseFloat(X)),ae=parseFloat(te),xe=parseFloat(fe);let Re=null,$e=null,Oe=null;return!isNaN(re)&&!isNaN(xe)&&xe>0&&(Oe=re/xe),!isNaN(re)&&!isNaN(ae)&&!isNaN(xe)&&ae>0&&xe>0&&($e=ae*xe,Re=re/$e*100),i.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[i.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("span",{children:["  ",i.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),i.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),i.jsx("input",{type:"number",value:te,onChange:De=>de(De.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),i.jsx("input",{type:"number",value:fe,onChange:De=>J(De.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Oe!==null&&i.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Re!==null?Re>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Re!==null?Re>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Re!==null?"6px":"0"},children:["1(): ",i.jsxs("strong",{children:["",Oe.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Re!==null&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",$e.toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",($e-re).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Re>40?"#d32f2f":"#2e7d32"},children:[": ",Re.toFixed(1),"%"]})]})]})]})]})},Je=Qe.ingredients||[];let Bt=me.steps||[];const pn=X=>String(X||"").trim().toLowerCase(),cn=X=>{const re=pn(X);return re?["","","steps","method"].some(ae=>re===ae||re.includes(ae)):!1};if(!Bt.length&&me.ingredientGroups){const X=me.ingredientGroups.find(re=>cn(re.name));if(X)Bt=Je.filter(ae=>ae.groupId===X.id).map(ae=>typeof ae=="string"?ae:{...ae,text:ae.name||ae.text||""});else{const re=Je.filter(ae=>cn(ae.group)||cn(ae.groupName));re.length&&(Bt=re.map(ae=>typeof ae=="string"?ae:{...ae,text:ae.name||ae.text||""}))}}const Ot=Bt,mn=Ae.useMemo(()=>{const X=me.ingredientGroups||[],re=["","steps","method",""],ae=De=>String(De||"").trim().toLowerCase(),xe=new Set(X.filter(De=>re.includes(ae(De.name))).map(De=>De.id)),Re=X.filter(De=>!xe.has(De.id));if(!Re.length)return[{id:"default",name:null,items:Je.filter(De=>!xe.has(De.groupId))}];const $e=Re.map(De=>{const rt=Je.filter(pt=>pt.groupId===De.id);return{id:De.id,name:De.name===""?null:De.name,items:rt}}).filter(De=>De.items.length>0),Oe=Je.filter(De=>De.groupId?xe.has(De.groupId)?!1:!Re.some(rt=>rt.id===De.groupId):!0);return Oe.length&&$e.push({id:"ungrouped",name:null,items:Oe}),$e.length?$e:[{id:"default",name:null,items:Je.filter(De=>!xe.has(De.groupId))}]},[me.ingredientGroups,Je]),kt=Ae.useMemo(()=>{if(me.type!=="bread")return null;const X=Qe.flours||[],re=Qe.breadIngredients||[],ae=X.reduce((Ie,at)=>Ie+(parseFloat(at.quantity)||0),0),xe=ae+re.reduce((Ie,at)=>Ie+(parseFloat(at.quantity)||0),0),Re=parseFloat(he),$e=Re&&xe?Re/xe:1,Oe=Ie=>ae?((parseFloat(Ie)||0)/ae*100).toFixed(1):"0.0",De=Ie=>Re?((parseFloat(Ie)||0)*$e).toFixed(1):Ie,rt=Ie=>{const at=parseFloat(Ie)||0;if(!Re)return at;const It=at*$e;return Math.round(It*100)/100},pt=Ie=>{const at=rt(Ie);return Number.isFinite(at)?at.toLocaleString(void 0,{maximumFractionDigits:2}):""},gn=Ie=>Ie.reduce((at,It)=>{const An=(parseFloat(It.cost)||0)*(Re?$e:1),$t=Di(It);return at+An*$t},0);return{flours:X,others:re,totalFlour:ae,grandTotal:xe,calcPercent:Oe,getScaledQtyValue:De,getScaledCostValue:rt,formatCostValue:pt,scaleFactor:$e,totalTaxIncluded:gn(X)+gn(re)}},[Qe.breadIngredients,Qe.flours,me.type,he]),gt=Ae.useMemo(()=>me.type==="bread"?0:Je.reduce((X,re)=>{const xe=(parseFloat(re.cost)||0)*q,Re=Di(re);return X+xe*Re},0),[me.type,Je,q]),ne=me.type==="bread"?kt?Math.round(kt.totalTaxIncluded).toLocaleString():"0":Math.round(gt).toLocaleString(),Be=me.description||n.description;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:$r,onTouchMove:Un,onTouchEnd:nn,children:[C&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(fn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(be,{variant:"ghost",onClick:ln,children:""}),i.jsx(be,{variant:"primary",onClick:an,children:""})]})]})}),_&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(fn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(be,{variant:"ghost",onClick:qn,children:""}),i.jsx(be,{variant:"danger",onClick:Er,children:""})]})]})}),x&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(fn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("small",{style:{color:"#666"},children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(be,{variant:"ghost",onClick:zn,children:""}),i.jsx(be,{variant:"danger",onClick:Tn,children:""})]})]})}),i.jsxs("div",{className:"recipe-detail__header",children:[i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx(be,{variant:"secondary",onClick:s,size:"sm",children:g||" "}),y&&i.jsx(be,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&i.jsxs("div",{className:"recipe-detail__actions",children:[et&&(v?.displayId==="yoshito"||v?.role==="admin")&&i.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:i.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:Xe,onChange:ct,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),i.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:Xe?"#4CAF50":"#888"},children:Xe?"":""})]})}),!et&&i.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),i.jsxs("select",{className:"language-select",value:Q,onChange:St,disabled:H,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[i.jsx("option",{value:"ORIGINAL",children:" Original ()"}),KE.map(X=>i.jsx("option",{value:X.code,children:X.label},X.code))]}),Q!=="ORIGINAL"&&i.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[i.jsx("input",{type:"checkbox",checked:z,onChange:X=>I(X.target.checked),style:{marginRight:"4px"}}),""]}),i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>L(!0),children:" "}),i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),i.jsx(be,{variant:"secondary",size:"sm",onClick:Xt,children:""}),et&&i.jsxs(i.Fragment,{children:[i.jsx(be,{variant:"secondary",size:"sm",onClick:l,children:""}),i.jsx(be,{variant:"danger",size:"sm",onClick:Rt,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&i.jsxs("div",{className:"recipe-detail__actions",children:[i.jsx(be,{variant:"ghost",size:"sm",onClick:Ut,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),i.jsx(be,{variant:"primary",size:"sm",onClick:()=>c(n,!0),children:""})]})]}),i.jsx("div",{className:"recipe-detail__hero",children:me.image?i.jsx("img",{src:me.image,alt:me.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),i.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[i.jsx("h1",{children:wt(me.title,n.title)}),i.jsx("p",{className:"recipe-detail__desc",children:wt(me.description,n.description,!0)}),v?.role==="admin"&&t&&i.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),i.jsxs("div",{className:"recipe-detail__meta",children:[me.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:wt(me.course,n.course)})]}),me.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:wt(me.category,n.category)})]}),me.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:wt(me.storeName,n.storeName)})]}),i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[me.servings,""]})]})]}),me.sourceUrl&&i.jsxs("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsx("div",{style:{fontSize:"0.85rem"},children:i.jsxs("a",{href:me.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",i.jsx("span",{className:"screen-only",children:""}),i.jsx("span",{className:"print-only",children:""})]})}),i.jsx("div",{style:{background:"white",padding:"4px",width:"fit-content"},children:i.jsx(iN,{value:me.sourceUrl,size:64,style:{height:"auto",maxWidth:"100%",width:"100%"}})})]})]}),i.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[i.jsxs("span",{children:[" : ",s0(n.created_at)]}),n.updated_at&&i.jsxs("span",{children:[" : ",s0(n.updated_at)]})]}),i.jsx("div",{className:"recipe-detail__content",children:i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),i.jsx(fn,{className:"ingredients-card",children:me.type==="bread"?i.jsx("div",{className:"bread-detail-view",children:(()=>{const X=Qe.flours||[],re=Qe.breadIngredients||[],ae=X.reduce((Ie,at)=>Ie+(parseFloat(at.quantity)||0),0),xe=ae+re.reduce((Ie,at)=>Ie+(parseFloat(at.quantity)||0),0),Re=ae?(xe/ae*100).toFixed(1):"0.0",$e=Ie=>ae?((parseFloat(Ie)||0)/ae*100).toFixed(1):"0.0",Oe=parseFloat(he),De=Oe&&xe?Oe/xe:1,rt=Ie=>Oe?((parseFloat(Ie)||0)*De).toFixed(1):Ie,pt=Ie=>{const at=parseFloat(Ie)||0;if(!Oe)return at;const It=at*De;return Math.round(It*100)/100},gn=Ie=>Number.isFinite(Ie)?Ie.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[xe.toLocaleString(),"g"]}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Re,"%)"]})]}),i.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("input",{id:"target-total-input",type:"number",value:he,onChange:Ie=>U(Ie.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),i.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),he&&i.jsx(be,{variant:"ghost",size:"sm",onClick:()=>U(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),he&&i.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",De.toFixed(3)," "]})]}),i.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[i.jsx("span",{children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",he?rt(ae):ae,"g (100%)"]})]}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:X.map((Ie,at)=>{const It=n.flours?.[at]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`flour-${at}`}),i.jsx("label",{htmlFor:`flour-${at}`,children:wt(Ie.name,It?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:he?i.jsx("span",{style:{color:"var(--color-primary)"},children:rt(Ie.quantity)}):Ie.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[$e(Ie.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ie.purchaseCost?`${Ie.purchaseCost}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:Ie.cost?`${gn(pt(Ie.cost))}`:"-"})]},at)})})]})]}),i.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[i.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:re.map((Ie,at)=>{const It=n.breadIngredients?.[at]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ingredient-${at}`}),i.jsx("label",{htmlFor:`ingredient-${at}`,children:wt(Ie.name,It?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:he?i.jsx("span",{style:{color:"var(--color-primary)"},children:rt(Ie.quantity)}):Ie.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[$e(Ie.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ie.purchaseCost?`${Ie.purchaseCost}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:Ie.cost?`${gn(pt(Ie.cost))}`:"-"})]},at)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const Ie=It=>It.reduce((sr,An)=>{const $t=parseFloat(An.cost)||0,Nr=Di(An),ir=$t*De;return sr+ir*Nr},0),at=Ie(X)+Ie(re);return Math.round(at).toLocaleString()})()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const Ie=It=>It.reduce((sr,An)=>{const $t=parseFloat(An.cost)||0,Nr=Di(An),ir=$t*De;return sr+ir*Nr},0),at=Ie(X)+Ie(re);return Lt(at)})()]})]})})()}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[i.jsx("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:":"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),i.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:V,onChange:X=>k(X.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(V)!==1&&i.jsx(be,{variant:"ghost",size:"sm",onClick:()=>k("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const X=me.ingredientGroups&&me.ingredientGroups.length>0?me.ingredientGroups:null;return X?X.map(re=>{const ae=Je.filter(xe=>xe.groupId===re.id);return ae.length===0||["","Steps","Method",""].includes(re.name)?null:i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(re.name)?"none":"block"},children:re.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:ae.map((xe,Re)=>{const $e=Je.indexOf(xe),Oe=n.ingredients?.[$e],De=typeof xe=="string"?xe:xe.name,rt=Oe?typeof Oe=="string"?Oe:Oe.name:"",pt=le(xe.quantity,V),gn=ge(xe.cost,V),Ie=String(V)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${re.id}-${Re}`}),i.jsx("label",{htmlFor:`ing-${re.id}-${Re}`,children:wt(De,rt)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Ie?"bold":"normal",color:Ie?"var(--color-primary)":"inherit"},children:pt}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:xe.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:xe.purchaseCost?`${xe.purchaseCost}`:"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[gn?`${gn}`:"-",$f(xe)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Re)})})]})]},re.id)}):i.jsxs(i.Fragment,{children:[i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:Je.map((re,ae)=>{const xe=n.ingredients?.[ae],Re=typeof re=="string"?re:re.name,$e=xe?typeof xe=="string"?xe:xe.name:"",Oe=le(re.quantity,V),De=ge(re.cost,V),rt=String(V)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${ae}`}),i.jsx("label",{htmlFor:`ing-${ae}`,children:wt(Re,$e)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:rt?"bold":"normal",color:rt?"var(--color-primary)":"inherit"},children:Oe}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:re.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:re.purchaseCost?`${re.purchaseCost}`:"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[De?`${De}`:"-",$f(re)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},ae)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ae=>ae.reduce((xe,Re)=>{const $e=parseFloat(Re.cost)||0,Oe=Di(Re),De=ge($e,V),rt=parseFloat(De)||0;return xe+rt*Oe},0))(Je)).toLocaleString()]})]})]})})(),i.jsx("div",{className:"screen-only no-print",children:i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((re=>re.reduce((ae,xe)=>{const Re=parseFloat(xe.cost)||0,$e=Di(xe),Oe=ge(Re,V),De=parseFloat(Oe)||0;return ae+De*$e},0))(Je)).toLocaleString()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]})}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const re=(ae=>ae.reduce((xe,Re)=>{const $e=parseFloat(Re.cost)||0,Oe=Di(Re),De=parseFloat(ge($e,V))||0;return xe+De*Oe},0))(Je);return Lt(re)})()]})})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),(()=>{const X=me.stepGroups&&me.stepGroups.length>0?me.stepGroups:null,re=X&&Ot.some(ae=>!ae||typeof ae!="object"||!ae.groupId?!1:X.some(xe=>xe.id===ae.groupId));return X&&re?i.jsx("div",{className:"steps-container",children:X.map(ae=>{const xe=Ot.filter(Re=>(typeof Re=="object"?Re.groupId:null)===ae.id);return xe.length===0?null:i.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[ae.name!==""&&ae.name!=="Steps"&&i.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:ae.name}),i.jsx("div",{className:"steps-list",children:xe.map((Re,$e)=>{const Oe=Ot.indexOf(Re),De=typeof Re=="object"?Re.text:Re,rt=n.steps?.[Oe],pt=typeof rt=="object"?rt.text:rt,gn=Ie=>Ie?Ie.replace(/<[^>]*>?/gm,""):"";return i.jsxs(fn,{className:`step-card ${D.has(Oe)?"is-completed":""}`,onClick:()=>jt(Oe),children:[i.jsx("div",{className:"step-number",children:Oe+1}),i.jsx("p",{className:"step-text",children:wt(gn(De),gn(pt),!0)})]},$e)})})]},ae.id)})}):i.jsx("div",{className:"steps-list",children:Ot.map((ae,xe)=>{const Re=typeof ae=="object"?ae.text:ae,$e=n.steps?.[xe],Oe=typeof $e=="object"?$e.text:$e;return i.jsxs(fn,{className:`step-card ${D.has(xe)?"is-completed":""}`,onClick:()=>jt(xe),children:[i.jsx("div",{className:"step-number",children:xe+1}),i.jsx("p",{className:"step-text",children:wt(Re,Oe,!0)})]},xe)})})})()]})]})}),i.jsx(Jn,{isOpen:N,onClose:()=>L(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-recipe",children:[i.jsx("div",{className:"preview-header",children:i.jsx("h2",{children:me.title})}),i.jsxs("div",{className:"preview-meta",children:[me.course&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",me.course]}),me.category&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",me.category]}),me.storeName&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",me.storeName]}),me.servings&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",me.servings,""]})]}),me.description&&i.jsx("div",{className:"preview-description",children:i.jsx("p",{children:me.description})}),i.jsx("div",{className:"preview-controls",children:me.type==="bread"?i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),i.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:he,onChange:X=>U(X.target.value),placeholder:"1000"}),he&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>U(""),children:""}),kt?.grandTotal?i.jsxs("span",{className:"preview-control-note",children:[": ",kt.grandTotal.toLocaleString(),"g"]}):null]}):i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:""}),i.jsx("span",{className:"preview-control-mult",children:""}),i.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:V,onChange:X=>k(X.target.value),placeholder:"1"}),String(V)!=="1"&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>k("1"),children:""})]})}),i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),me.type==="bread"?i.jsxs("div",{className:"preview-ingredients-bread",children:[i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Qe.flours||[]).map((X,re)=>{const ae=`flour-${re}`,xe=kt?kt.getScaledQtyValue(X.quantity):X.quantity;return i.jsxs("tr",{className:j.has(ae)?"is-completed":"",onClick:()=>ut(ae),role:"button",tabIndex:0,onKeyDown:Re=>{(Re.key==="Enter"||Re.key===" ")&&(Re.preventDefault(),ut(ae))},children:[i.jsx("td",{children:X.name}),i.jsxs("td",{style:{textAlign:"right"},children:[xe,"g"]})]},re)})})]})]}),i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Qe.breadIngredients||[]).map((X,re)=>{const ae=`bread-${re}`,xe=kt?kt.getScaledQtyValue(X.quantity):X.quantity;return i.jsxs("tr",{className:j.has(ae)?"is-completed":"",onClick:()=>ut(ae),role:"button",tabIndex:0,onKeyDown:Re=>{(Re.key==="Enter"||Re.key===" ")&&(Re.preventDefault(),ut(ae))},children:[i.jsx("td",{children:X.name}),i.jsxs("td",{style:{textAlign:"right"},children:[xe,"g"]})]},re)})})]})]})]}):i.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const X=me.ingredientGroups&&me.ingredientGroups.length>0?me.ingredientGroups:null;return X?X.map(re=>{const ae=Je.filter(xe=>xe.groupId===re.id);return ae.length===0||["","Steps","Method",""].includes(re.name)?null:i.jsxs("div",{className:"ingredient-group",children:[i.jsx("h4",{children:re.name}),i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:ae.map((xe,Re)=>{const $e=`${re.id}-${Re}`,Oe=typeof xe=="string"?xe:xe.name,De=typeof xe=="object"?le(xe.quantity,q):"",rt=typeof xe=="object"?xe.unit:"";return i.jsxs("tr",{className:j.has($e)?"is-completed":"",onClick:()=>ut($e),role:"button",tabIndex:0,onKeyDown:pt=>{(pt.key==="Enter"||pt.key===" ")&&(pt.preventDefault(),ut($e))},children:[i.jsx("td",{children:Oe}),i.jsx("td",{style:{textAlign:"right"},children:De}),i.jsx("td",{children:rt})]},Re)})})]})]},re.id)}):i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:Je.map((re,ae)=>{const xe=`ungrouped-${ae}`,Re=typeof re=="string"?re:re.name,$e=typeof re=="object"?le(re.quantity,q):"",Oe=typeof re=="object"?re.unit:"";return i.jsxs("tr",{className:j.has(xe)?"is-completed":"",onClick:()=>ut(xe),role:"button",tabIndex:0,onKeyDown:De=>{(De.key==="Enter"||De.key===" ")&&(De.preventDefault(),ut(xe))},children:[i.jsx("td",{children:Re}),i.jsx("td",{style:{textAlign:"right"},children:$e}),i.jsx("td",{children:Oe})]},ae)})})]})})()})]}),Ot.length>0&&i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),i.jsx("ol",{className:"preview-steps",children:Ot.map((X,re)=>{const ae=typeof X=="object"?X.text:X;return i.jsx("li",{className:P.has(re)?"is-completed":"",onClick:()=>lt(re),role:"button",tabIndex:0,onKeyDown:xe=>{(xe.key==="Enter"||xe.key===" ")&&(xe.preventDefault(),lt(re))},children:ae},re)})})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(be,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(be,{variant:"ghost",onClick:()=>L(!1),children:""})]})]})})]}),i.jsxs("div",{className:"print-layout",children:[i.jsx("div",{className:"recipe-detail__hero",children:me.image?i.jsx("img",{src:me.image,alt:me.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),i.jsxs("div",{className:"recipe-detail__title-card",children:[i.jsx("h1",{children:me.title}),Be&&i.jsx("p",{className:"recipe-detail__desc",children:Be})]}),i.jsxs("div",{className:"recipe-detail__meta",children:[me.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:me.category})]}),me.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value meta-value--store",children:me.storeName})]}),me.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:me.course})]}),me.servings&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[me.servings,""]})]})]}),i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),me.type==="bread"&&kt?i.jsxs("div",{children:[i.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:kt.flours.map((X,re)=>i.jsxs("tr",{children:[i.jsx("td",{children:X.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:kt.getScaledQtyValue(X.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[kt.calcPercent(X.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:X.purchaseCost?`${X.purchaseCost}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:X.cost?`${kt.formatCostValue(X.cost)}`:"-"})]},`print-flour-${re}`))})]})]}),i.jsxs("div",{className:"bread-section",children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:kt.others.map((X,re)=>i.jsxs("tr",{children:[i.jsx("td",{children:X.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:kt.getScaledQtyValue(X.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[kt.calcPercent(X.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:X.purchaseCost?`${X.purchaseCost}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:X.cost?`${kt.formatCostValue(X.cost)}`:"-"})]},`print-others-${re}`))})]})]})]}):mn.map(X=>i.jsxs("div",{style:{marginBottom:"1.2rem"},children:[X.name&&i.jsx("div",{className:"print-group-heading",children:X.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:X.items.map((re,ae)=>{const xe=typeof re=="object"?re.quantity:"",Re=typeof re=="object"?re.unit:"",$e=typeof re=="object"?re.purchaseCost:null,Oe=typeof re=="object"?re.cost:null,De=typeof re=="string"?re:re.name,rt=typeof re=="object"?le(re.quantity,q):xe;return i.jsxs("tr",{children:[i.jsx("td",{children:De}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:rt}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:Re}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:$e?`${$e}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:Oe?`${Oe}`:"-"})]},`print-ing-${X.id}-${ae}`)})})]})]},X.id)),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",ne]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),Ot.length>0?i.jsx("div",{className:"steps-list",children:Ot.map((X,re)=>{const ae=typeof X=="object"?X.text:X;return i.jsxs("div",{className:"step-card",children:[i.jsx("div",{className:"step-number",children:re+1}),i.jsx("p",{className:"step-text",children:ae})]},`print-step-${re}`)})}):i.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:""})]})]})]})]})},xt=({label:n,id:t,error:s,textarea:l,...c})=>{const u=l?"textarea":"input";return i.jsxs("div",{className:`input-group ${s?"input-group--error":""} ${c.wrapperClassName||""}`,children:[n&&i.jsx("label",{htmlFor:t,className:"input-label",children:n}),i.jsx(u,{id:t,className:`input-field ${c.className||""}`,style:c.style,...c}),s&&i.jsx("span",{className:"input-error",children:s})]})},Ql="app-data",nr={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await Te.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const s=String(t||"").replace(/^\/+/,"");return`${n}/${s}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:s}=await Te.storage.from(Ql).list(n);if(s)return console.warn("Failed to list price files:",s.message),[];if(!t||t.length===0)return[];const l=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:f,error:p}=await Te.storage.from(Ql).download(d);if(p)return console.error(`Failed to download ${u.name}:`,p),null;const g=await f.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(g)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(g)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(l)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._cacheByUserId.get(t);if(s)return s;try{const l=new Map,c=await this._downloadAllCsvTexts(t);if(!c||c.length===0)return new Map;for(const{text:u}of c){if(!u)continue;const d=this.parseCSV(u);for(const[f,p]of d)if(l.has(f)){const g=l.get(f);(p?.dateStr||"")>(g?.dateStr||"")&&l.set(f,p)}else l.set(f,p)}return this._cacheByUserId.set(t,l),l}catch(l){return console.error("Error in fetchPriceList:",l),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:s,error:l}=await Te.storage.from(Ql).list(t);if(l)throw l;return s.filter(c=>String(c?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=n.name;this.clearCache(s);const c=this._getUserScopedPath(s,l),{data:u,error:d}=await Te.storage.from(Ql).upload(c,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(s){return console.error("Error uploading price list:",s),{success:!1,error:s}}},async deletePriceFile(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");this.clearCache(s);const l=this._getUserScopedPath(s,n),{data:c,error:u}=await Te.storage.from(Ql).remove([l]);if(u)throw u;if(!c||c.length===0)throw new Error("");return{success:!0,data:c}}catch(s){return console.error("Error deleting price file:",s),{success:!1,error:s}}},parseCSV(n){const t=new Map,s=n.split(/\r?\n/).filter(c=>c.trim());if(s.length===0)return t;if(s.some(c=>c.startsWith("D,")||c.startsWith('"D",')))for(let c of s){const u=[];let d="",f=!1;for(let _=0;_<c.length;_++){const T=c[_];T==='"'?f=!f:T===","&&!f?(u.push(d),d=""):d+=T}u.push(d);const p=u.map(_=>(_=_.trim(),_.startsWith('"')&&_.endsWith('"')?_.slice(1,-1):_));if(p[0]!=="D")continue;const g=p[1],y=p[8],v=p[14],x=p[18],S=p[20],C=String(v??"").trim(),E=bn(C);if(E&&x){const _=parseFloat(x);if(!isNaN(_)){const T={price:_,vendor:y,unit:S,dateStr:g,displayName:C};if(t.has(E)){const D=t.get(E);(g||"")>=(D?.dateStr||"")&&t.set(E,T)}else t.set(E,T)}}}else{let c={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(s[0].split(",").map(p=>p.trim().replace(/^"|"$/g,"")).forEach((p,g)=>{["","","","","name","item"].some(y=>p.includes(y))&&(c.name=g),["","","","","price","cost"].some(y=>p.includes(y))&&(c.price=g),["","unit"].some(y=>p.includes(y))&&(c.unit=g),["","","","vendor","supplier"].some(y=>p.includes(y))&&(c.vendor=g)}),c.name===-1&&c.price===-1){c={name:0,price:1,unit:2,vendor:3};const p=s[0].split(",");isNaN(parseFloat(p[1]))&&(u=1)}else u=1;const f=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let p=u;p<s.length;p++){const g=s[p],y=[];let v="",x=!1;for(let P=0;P<g.length;P++){const $=g[P];$==='"'?x=!x:$===","&&!x?(y.push(v),v=""):v+=$}y.push(v);const S=y.map(P=>(P=P.trim(),P.startsWith('"')&&P.endsWith('"')?P.slice(1,-1):P)),C=c.name>-1?S[c.name]:null,E=c.price>-1?S[c.price]:null,_=c.unit>-1?S[c.unit]:"",T=c.vendor>-1?S[c.vendor]:"",D=String(C??"").trim(),B=bn(D);if(B&&E){const P=parseFloat(E.replace(/[^0-9.]/g,""));isNaN(P)||t.set(B,{price:P,vendor:T,unit:_,dateStr:f,displayName:D})}}}return t},parseCSVEntries(n,t=""){const s=[],l=n.split(/\r?\n/).filter(x=>x.trim());if(l.length===0)return s;const c=x=>{const S=String(x??"").trim();if(!S)return null;const C=parseFloat(S.replace(/[^0-9.]/g,""));return Number.isFinite(C)?C:null},u=x=>{const S=[];let C="",E=!1;for(let _=0;_<x.length;_++){const T=x[_];T==='"'?E=!E:T===","&&!E?(S.push(C),C=""):C+=T}return S.push(C),S.map(_=>(_=_.trim(),_.startsWith('"')&&_.endsWith('"')?_.slice(1,-1):_))},d=x=>{const S=String(x??"").trim();if(!S)return"";const C=S.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(C)return`${C[1]}/${String(C[2]).padStart(2,"0")}/${String(C[3]).padStart(2,"0")}`;const E=S.match(/^(\d{4})(\d{2})(\d{2})$/);return E?`${E[1]}/${E[2]}/${E[3]}`:S};if(l.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of l){const S=u(x);if(S[0]!=="D")continue;const C=d(S[1]),E=S[8],_=S[14],T=S[18],D=c(S[19]),B=S[20],P=String(_??"").trim(),$=bn(P);if(!$||!T)continue;const j=c(T);Number.isFinite(j)&&s.push({key:$,displayName:P,price:j,vendor:E,unit:B,dateStr:C,incomingQty:D,sourceFile:t})}return s}let p={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},g=0;if(l[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,S)=>{const C=String(x||"").toLowerCase();["","","","","name","item"].some(E=>C.includes(E))&&(p.name=S),["","","","","price","cost"].some(E=>C.includes(E))&&(p.price=S),["","unit"].some(E=>C.includes(E))&&(p.unit=S),["","","","vendor","supplier"].some(E=>C.includes(E))&&(p.vendor=S),["","","","date"].some(E=>C.includes(E))&&(p.date=S),["","","","","","qty","quantity"].some(E=>C.includes(E))&&(p.quantity=S)}),p.name===-1&&p.price===-1){p={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=l[0].split(",");isNaN(parseFloat(x[1]))&&(g=1)}else g=1;const v=d(new Date().toISOString().slice(0,10));for(let x=g;x<l.length;x++){const S=u(l[x]),C=p.name>-1?S[p.name]:null,E=p.price>-1?S[p.price]:null,_=p.unit>-1?S[p.unit]:"",T=p.vendor>-1?S[p.vendor]:"",D=p.date>-1?S[p.date]:"",B=p.quantity>-1?c(S[p.quantity]):null,P=String(C??"").trim(),$=bn(P);if(!$||!E)continue;const j=c(E);Number.isFinite(j)&&s.push({key:$,displayName:P,price:j,vendor:T,unit:_,dateStr:d(D)||v,incomingQty:B,sourceFile:t})}return s},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._historyCacheByUserId.get(t);if(s)return s;try{const l=await this._downloadAllCsvTexts(t);if(!l||l.length===0)return new Map;const c=new Map;for(const{fileName:u,text:d}of l){if(!d)continue;this.parseCSVEntries(d,u).forEach(p=>{const g=p?.key;g&&(c.has(g)||c.set(g,[]),c.get(g).push(p))})}for(const u of c.values())u.sort((d,f)=>{const p=String(d?.dateStr||""),g=String(f?.dateStr||"");if(p!==g)return p.localeCompare(g);const y=Number(d?.price),v=Number(f?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(f?.sourceFile||""))});return this._historyCacheByUserId.set(t,c),c}catch(l){return console.error("Error in fetchPriceHistory:",l),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),s=[];for(const[l,c]of t.entries())if(c&&typeof c=="object"){const{displayName:u,...d}=c;s.push({name:u||l,...d})}else s.push({name:l,price:c});return s.sort((l,c)=>l.dateStr&&c.dateStr?c.dateStr.localeCompare(l.dateStr):l.name.localeCompare(c.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(bn(n))||null}},bo={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:s}=await Te.rpc("search_ingredients",{search_query:n,max_results:15});return s?(console.warn(" Database search failed:",s),console.warn("Error message:",s.message),console.warn("Error code:",s.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){if(!n||n.trim().length===0)return this._lastDbResults=null,this._lastDbQuery=null,[];const t=n.toLowerCase().trim();try{const s=await this._searchFromDatabase(t);if(s&&Array.isArray(s)){this._lastDbResults=s,this._lastDbQuery=t;const c=s.map(f=>({name:f.ingredient_name,price:f.last_price,size:f.packet_size,unit:f.packet_unit,itemCategory:f.item_category||null,source:"manual",displaySource:" "}));if(c.length===0)return await this._fallbackSearch(t);if(!this._csvCache){const f=await nr.getPriceListArray();this._csvCache=f.map(p=>({name:p.name,price:p.price,size:null,unit:p.unit,source:"csv",displaySource:" CSV"}))}const u=new Set(c.map(f=>f.name)),d=this._csvCache.filter(f=>f.name.toLowerCase().includes(t)&&!u.has(f.name)).slice(0,5);return[...c,...d]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",s);const l=await this._fallbackSearch(t);return console.log(" Fallback search returned:",l.length,"results"),l}catch(s){return console.error("Error searching ingredients:",s),[]}},async _fallbackSearch(n){try{if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[s,l]=await Promise.all([nr.getPriceListArray(),$n.getAllConversions()]);console.log(" CSV Data rows:",s.length),console.log(" Manual Data items:",l.size);const c=Array.from(l.values()).map(p=>({name:p.ingredientName,price:p.lastPrice,size:p.packetSize,unit:p.packetUnit,itemCategory:p.itemCategory||null,source:"manual",displaySource:" "})),u=s.map(p=>({name:p.name,price:p.price,size:null,unit:p.unit,source:"csv",displaySource:" CSV"})),d=new Set(c.map(p=>p.name)),f=u.filter(p=>!d.has(p.name));this._csvCache=[...c,...f],console.log(" Cache built. Total items:",this._csvCache.length)}return this._csvCache.filter(s=>s.name.toLowerCase().includes(n)).slice(0,15).sort((s,l)=>{const c=s.name.toLowerCase(),u=l.name.toLowerCase();return c===n&&u!==n?-1:u===n&&c!==n?1:c.startsWith(n)&&!u.startsWith(n)?-1:u.startsWith(n)&&!c.startsWith(n)?1:c.localeCompare(u,"ja")})}catch(t){return console.error("Error in fallback search:",t),[]}}},up=({value:n,onChange:t,placeholder:s,disabled:l,onSelect:c})=>{const[u,d]=w.useState([]),[f,p]=w.useState(!1),[g,y]=w.useState(-1),v=w.useRef(null),x=w.useRef(null),[S,C]=w.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),E=w.useCallback(()=>{if(v.current){const $=v.current.getBoundingClientRect(),j=8,M=4,A=$.top-j,F=window.innerHeight-$.bottom-j,G=(A>=180||A>=F)&&A>=110,H=Math.max(110,Math.min(280,G?A-M:F-M)),W=$.left,z=Math.max(220,window.innerWidth-j*2),I=Math.min(Math.max($.width,220),z),N=Math.min(Math.max(j,W),window.innerWidth-j-I);C({top:G?$.top-M:$.bottom+M,left:N,width:I,maxHeight:H,placeAbove:G})}},[]);w.useEffect(()=>{const $=A=>{v.current&&!v.current.contains(A.target)&&x.current&&!x.current.contains(A.target)&&p(!1)},j=A=>{x.current&&x.current.contains(A.target)||p(!1)},M=()=>{f&&E()};return document.addEventListener("mousedown",$),window.addEventListener("scroll",j,{capture:!0}),window.addEventListener("resize",M),()=>{document.removeEventListener("mousedown",$),window.removeEventListener("scroll",j,{capture:!0}),window.removeEventListener("resize",M)}},[f,E]),w.useEffect(()=>{f&&E()},[f,u,E]);const _=w.useRef(0),T=w.useRef(null),D=async $=>{const j=$.target.value;if(t($),T.current&&clearTimeout(T.current),j.length===0){p(!1);return}T.current=setTimeout(async()=>{if(j.length>0){const M=++_.current;console.log(" AutocompleteInput: Fetching suggestions for:",j);const A=await bo.search(j);console.log(" AutocompleteInput: Got",A.length,"suggestions"),M===_.current&&(d(A),p(A.length>0),y(-1))}},150)},B=$=>{const j={target:{value:$.name}};t(j),p(!1),c&&c($)},P=$=>{f&&($.key==="ArrowDown"?($.preventDefault(),y(j=>j<u.length-1?j+1:j)):$.key==="ArrowUp"?($.preventDefault(),y(j=>j>0?j-1:-1)):$.key==="Enter"?g>=0&&($.preventDefault(),B(u[g])):$.key==="Escape"&&p(!1))};return i.jsxs("div",{className:"autocomplete-wrapper",ref:v,children:[i.jsx("input",{type:"text",className:"input-field autocomplete-input",value:n,onChange:D,onKeyDown:P,onFocus:async()=>{if(n&&n.length>0){E();const $=await bo.search(n);d($),p($.length>0)}else E()},placeholder:s,disabled:l}),f&&$a.createPortal(i.jsx("ul",{className:"suggestions-list",ref:x,style:{position:"fixed",top:`${S.top}px`,left:`${S.left}px`,width:`${S.width}px`,maxHeight:`${S.maxHeight}px`,transform:S.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:u.map(($,j)=>i.jsxs("li",{className:`suggestion-item ${j===g?"selected":""}`,onClick:()=>B($),onMouseEnter:()=>y(j),children:[i.jsxs("div",{className:"suggestion-main",children:[i.jsx("span",{className:"suggestion-name",children:$.name}),i.jsx("span",{className:"suggestion-source",children:$.displaySource})]}),i.jsxs("div",{className:"suggestion-details",children:[$.price&&`${Number($.price).toLocaleString()}`,$.size&&` / ${$.size}${$.unit}`,!$.size&&$.unit&&` / ${$.unit}`]})]},`${$.source}-${j}`))}),document.body)]})},$x=({isOpen:n,onClose:t,onApply:s,ingredientName:l,currentCost:c,currentQuantity:u,unit:d="g",initialPurchaseCost:f,initialContentAmount:p})=>{const[g,y]=w.useState(""),[v,x]=w.useState(""),[S,C]=w.useState(d),[E,_]=w.useState(!1),[T,D]=w.useState(!1),B=w.useCallback(async()=>{if(D(!0),f&&p){y(f),x(p);const A=await $n.getConversion(l);C(A&&A.packetUnit||d)}else{const A=await $n.getConversion(l);if(A)x(A.packetSize),C(A.packetUnit||d),A.lastPrice&&y(A.lastPrice);else try{const F=await nr.getPrice(l);if(F)if(y(c||F.price),F.unit){const Q=F.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(Q){let G=Q[1]?parseFloat(Q[1]):1,H=Q[2]?Q[2].trim().toLowerCase():"";H==="kg"?(G*=1e3,H="g"):H==="l"?(G*=1e3,H="ml"):H==="pk"||H==="pack"?H="":H==="bag"?H="":(H==="pc"||H==="pcs")&&(H=""),x(G),C(H||d)}else x(1),C(F.unit)}else x(""),C(d);else x(""),y(c||""),C(d)}catch(F){console.warn("Failed to load master price:",F),x(""),y(c||""),C(d)}}D(!1)},[l,f,p,d,c]);w.useEffect(()=>{if(!n||!l)return;const A=setTimeout(()=>{B()},0);return()=>clearTimeout(A)},[n,l,B]);const P=()=>{const A=parseFloat(g),F=parseFloat(v);return!A||!F?0:["g","ml","cc"].includes(S)?A/F*1e3:A/F},$=async()=>{const A=P();if(E&&v)try{await $n.saveConversion(l,v,S,g)}catch(F){console.error("Failed to save default conversion:",F)}s(A,S,g,v),t()};if(!n)return null;const j=P(),M=u?j*(u/(["g","ml"].includes(d)?1e3:1)):0;return i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"8px",width:"90%",maxWidth:"350px",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:[i.jsx("h3",{style:{margin:"0 0 16px 0",fontSize:"1.1rem",color:"#000"},children:""}),i.jsxs("div",{style:{marginBottom:"12px"},children:[i.jsx("label",{style:{display:"block",fontSize:"0.8rem",color:"#666"},children:""}),i.jsx("div",{style:{fontWeight:"bold"},children:l||"()"})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"12px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.8rem",color:"#666"},children:" ()"}),i.jsx("input",{type:"number",value:g,onChange:A=>y(A.target.value),className:"input-field",style:{width:"100%",padding:"8px",border:"1px solid #ccc",borderRadius:"4px"},placeholder:": 1000"})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.8rem",color:"#666"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"4px"},children:[i.jsx("input",{type:"number",value:v,onChange:A=>x(A.target.value),className:"input-field",style:{flex:1,padding:"8px",border:"1px solid #ccc",borderRadius:"4px"},placeholder:": 1000"}),i.jsxs("select",{value:S,onChange:A=>C(A.target.value),style:{padding:"8px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:"white"},children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:"p"}),i.jsx("option",{value:"cc",children:"cc"}),!["g","ml","","","","","","cc"].includes(S)&&i.jsx("option",{value:S,children:S})]})]})]})]}),i.jsx("div",{style:{backgroundColor:"#f5f5f5",padding:"12px",borderRadius:"4px",marginBottom:"16px"},children:T?i.jsx("div",{style:{textAlign:"center",color:"#666",fontSize:"0.8rem"},children:"CSV..."}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[i.jsx("span",{style:{fontSize:"0.9rem"},children:" (1kg/1):"}),i.jsxs("span",{style:{fontWeight:"bold"},children:["",Math.round(j).toLocaleString()]})]}),u&&i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",color:"#666",fontSize:"0.85rem"},children:[i.jsxs("span",{children:[" (",u,d,"):"]}),i.jsxs("span",{children:["",Math.round(M).toLocaleString()]})]})]})}),i.jsxs("div",{style:{marginBottom:"16px",display:"flex",alignItems:"center"},children:[i.jsx("input",{type:"checkbox",id:"saveDefault",checked:E,onChange:A=>_(A.target.checked),style:{marginRight:"8px"}}),i.jsxs("label",{htmlFor:"saveDefault",style:{fontSize:"0.9rem",cursor:"pointer"},children:["(",v,S,")"]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx("button",{type:"button",onClick:t,style:{flex:1,padding:"10px",border:"1px solid #ccc",background:"white",borderRadius:"4px",cursor:"pointer"},children:""}),i.jsx("button",{type:"button",onClick:$,disabled:!g||!v,style:{flex:1,padding:"10px",border:"none",background:!g||!v?"#ccc":"#D2691E",color:"white",borderRadius:"4px",cursor:"pointer",fontWeight:"bold"},children:""})]})]})})},fN=new Set(["food","alcohol","soft_drink","supplies"]),pN=new Set(["alcohol","supplies"]),qx={food:"",alcohol:"",soft_drink:"",supplies:""},di=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":fN.has(t)?t:"":""},zu=n=>pN.has(n),vf=(n,t)=>{const s=di(t);return s?{...n,itemCategory:s,isAlcohol:zu(s)}:{...n,itemCategory:null}},In=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},qf=n=>{const t=In(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Mi=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return qf(s)/100},mN=(n,t,s)=>{const l=In(n),c=In(t);if(!Number.isFinite(l)||!Number.isFinite(c)||c<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/c*1e3:(["kg","","l",""].includes(u),l/c)},l0=(n,t,s,l=!1,c=1)=>{const u=In(n),d=In(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const f=Number.isFinite(c)&&c>0?c:1;if(l)return u/1e3*d/f;const p=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(p)||!p?u/1e3*d/f:u*d/f},gN=(n,t)=>{const s=In(n?.purchaseCost),l=In(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},o0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Ur=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=o0(t);if(!l)return null;for(const[c,u]of n.entries())if(o0(c)===l)return u;return null},yN=({formData:n,setFormData:t})=>{const[s,l]=w.useState(new Map),[c,u]=w.useState({isOpen:!1,type:null,index:null}),[d,f]=w.useState(new Map);w.useEffect(()=>{(async()=>{const[M,A]=await Promise.all([nr.fetchPriceList(),$n.getAllConversions()]);l(M),f(A)})()},[]);const g=(j=>j.reduce((M,A)=>M+(parseFloat(A.quantity)||0),0))(n.flours||[]),y=j=>!g||g===0?0:((parseFloat(j)||0)/g*100).toFixed(1);w.useEffect(()=>{if(d.size===0)return;const j=(F=[])=>{let Q=!1;return{adjusted:F.map(H=>{if(!H||typeof H!="object")return H;const W=Ur(d,H.name);let z=H;const I=di(H.itemCategory??H.item_category??W?.itemCategory);if(I){const he=zu(I);(di(H.itemCategory??H.item_category)!==I||!!H.isAlcohol!==he)&&(z={...z,itemCategory:I,isAlcohol:he})}const N=Mi(H,W),L=l0(H.quantity,z.purchaseCost,H.unit,!0,N),K=Number.isFinite(L)?Math.round(L*100)/100:NaN,oe=In(z.cost);if(Number.isFinite(K)&&(!Number.isFinite(oe)||Math.abs(oe-K)>.01)&&(z={...z,cost:K}),W&&W.packetSize){const U=[W.lastPrice,H.purchaseCostRef,H.purchase_cost,H.purchaseCost].find(k=>Number.isFinite(In(k))),V=mN(U,W.packetSize,W.packetUnit);if(Number.isFinite(V)&&gN(H,V)){const k=Mi(H,W),te=Math.round(V*100)/100,de=l0(H.quantity,te,H.unit,!0,k),fe=Number.isFinite(de)?Math.round(de*100)/100:z.cost,J=In(z.purchaseCost),q=In(z.cost),le=!Number.isFinite(J)||Math.abs(J-te)>.01,ge=Number.isFinite(In(fe))&&(!Number.isFinite(q)||Math.abs(q-fe)>.01);(le||ge)&&(z={...z,purchaseCost:te,cost:fe})}}return z!==H&&(Q=!0),z}),changed:Q}},M=j(n.flours||[]),A=j(n.breadIngredients||[]);!M.changed&&!A.changed||t(F=>({...F,flours:M.adjusted,breadIngredients:A.adjusted}))},[d,n.breadIngredients,n.flours,t]);const v=(j,M,A)=>{const F=[...n.flours||[]];if(F[j]={...F[j],[M]:A},M==="name"){const Q=s.get(bn(A));if(Q){const G=typeof Q=="object"?Q.price:Q,H=typeof Q=="object"?Q.vendor:null,W=typeof Q=="object"?Q.unit:null;F[j].purchaseCostRef=G,F[j].vendorRef=H;const z=Ur(d,A);if(z&&z.packetSize){let N=0;const L=z.lastPrice!==null&&z.lastPrice!==void 0&&z.lastPrice!==""?z.lastPrice:G,K=(z.packetUnit||"").trim().toLowerCase();["g",""].includes(K)?N=L/z.packetSize*1e3:["kg",""].includes(K)?N=L/z.packetSize:["ml","","cc",""].includes(K)?N=L/z.packetSize*1e3:(["l",""].includes(K),N=L/z.packetSize),F[j].purchaseCost=Math.round(N*100)/100,F[j].unit="g"}else F[j].purchaseCost||(F[j].purchaseCost=G,!F[j].unit&&W&&(F[j].unit=W));const I=di(z?.itemCategory);I?F[j]=vf(F[j],I):F[j].itemCategory=null}else F[j].purchaseCostRef=null,F[j].vendorRef=null,F[j].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(M)||M==="name"){const Q=F[j],G=parseFloat(Q.quantity),H=parseFloat(Q.purchaseCost);if(!isNaN(G)&&!isNaN(H)){let W=0;const z=(Q.unit||"").trim().toLowerCase();z==="g"||z===""||z==="ml"||z===""||z==="cc"||z===""||!z?W=G/1e3*H:W=G*H;const I=Ur(d,Q.name),N=Mi(Q,I),L=Number.isFinite(N)&&N>0?N:1,K=Math.round(W/L*100)/100;K!==Q.cost&&(F[j].cost=K)}}t(Q=>({...Q,flours:F}))},x=(j,M,A)=>{const F=[...n.breadIngredients||[]];if(F[j]={...F[j],[M]:A},M==="name"){const Q=s.get(bn(A));if(Q){const G=typeof Q=="object"?Q.price:Q,H=typeof Q=="object"?Q.vendor:null,W=typeof Q=="object"?Q.unit:null;F[j].purchaseCostRef=G,F[j].vendorRef=H;const z=Ur(d,A);if(z&&z.packetSize){let N=0;const L=z.lastPrice!==null&&z.lastPrice!==void 0&&z.lastPrice!==""?z.lastPrice:G,K=(z.packetUnit||"").trim().toLowerCase();["g",""].includes(K)?(N=L/z.packetSize*1e3,F[j].unit="g"):["kg",""].includes(K)?(N=L/z.packetSize,F[j].unit="g"):["ml","","cc",""].includes(K)?(N=L/z.packetSize*1e3,F[j].unit="ml"):["l",""].includes(K)?(N=L/z.packetSize,F[j].unit="ml"):(N=L/z.packetSize,F[j].unit=z.packetUnit),F[j].purchaseCost=Math.round(N*100)/100}else F[j].purchaseCost||(F[j].purchaseCost=G,!F[j].unit&&W&&(F[j].unit=W));const I=di(z?.itemCategory);I?F[j]=vf(F[j],I):F[j].itemCategory=null}else F[j].purchaseCostRef=null,F[j].vendorRef=null,F[j].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(M)||M==="name"){const Q=F[j],G=parseFloat(Q.quantity),H=parseFloat(Q.purchaseCost);if(!isNaN(G)&&!isNaN(H)){let W=0;const z=Q.unit?Q.unit.trim().toLowerCase():"g";z==="g"||z===""||z==="ml"||z===""||z==="cc"||z===""?W=G/1e3*H:W=G*H;const I=Ur(d,Q.name),N=Mi(Q,I),L=Number.isFinite(N)&&N>0?N:1,K=Math.round(W/L*100)/100;K!==Q.cost&&(F[j].cost=K)}}t(Q=>({...Q,breadIngredients:F}))},S=()=>{t(j=>({...j,flours:[...j.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},C=()=>{t(j=>({...j,breadIngredients:[...j.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},E=j=>{t(M=>({...M,flours:M.flours.filter((A,F)=>F!==j)}))},_=j=>{t(M=>({...M,breadIngredients:M.breadIngredients.filter((A,F)=>F!==j)}))},T=Qa(fr(Ro,{activationConstraint:{distance:10}}),fr(To,{activationConstraint:{delay:250,tolerance:5}}),fr(Xa,{coordinateGetter:ku})),D=j=>{const{active:M,over:A}=j;M.id!==A.id&&t(F=>{const G=F.flours.some(z=>z.id===M.id)?"flours":"breadIngredients",H=F[G].findIndex(z=>z.id===M.id),W=F[G].findIndex(z=>z.id===A.id);return H!==-1&&W!==-1?{...F,[G]:Hi(F[G],H,W)}:F})};w.useEffect(()=>{if(!n.flours)t(j=>({...j,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const j=n.flours.map(M=>M.id?M:{...M,id:crypto.randomUUID()});JSON.stringify(j)!==JSON.stringify(n.flours)&&t(M=>({...M,flours:j}))}if(!n.breadIngredients)t(j=>({...j,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const j=n.breadIngredients.map(M=>M.id?M:{...M,id:crypto.randomUUID()});JSON.stringify(j)!==JSON.stringify(n.breadIngredients)&&t(M=>({...M,breadIngredients:j}))}},[]);const B=(j,M,A,F)=>{const{type:Q,index:G}=c;t(H=>{if(Q==="flour"){const W=[...H.flours],z={...W[G],purchaseCost:j,unit:M,purchase_cost:A,content_amount:F},I=parseFloat(z.quantity),N=parseFloat(j);if(!isNaN(I)&&!isNaN(N)){let L=0;M==="g"||M===""?L=I/1e3*N:L=I*N;const K=Ur(d,z.name),oe=Mi(z,K),he=Number.isFinite(oe)&&oe>0?oe:1;z.cost=Math.round(L/he*100)/100}return W[G]=z,$n.getAllConversions().then(L=>f(L)),bo.invalidateCache(),{...H,flours:W}}else if(Q==="ingredient"){const W=[...H.breadIngredients],z={...W[G],purchaseCost:j,unit:M,purchase_cost:A,content_amount:F},I=parseFloat(z.quantity),N=parseFloat(j);if(!isNaN(I)&&!isNaN(N)){let L=0;M==="g"||M===""?L=I/1e3*N:L=I*N;const K=Ur(d,z.name),oe=Mi(z,K),he=Number.isFinite(oe)&&oe>0?oe:1;z.cost=Math.round(L/he*100)/100}return W[G]=z,$n.getAllConversions().then(L=>f(L)),bo.invalidateCache(),{...H,breadIngredients:W}}return H})},P=(j,M,A)=>{A&&t(F=>{const Q=j==="flour"?"flours":"breadIngredients",G=[...F[Q]||[]],H={...G[M]};if(H.name=A.name,H.itemCategory=null,A.price!==void 0&&A.price!==null&&A.price!==""){H.purchaseCostRef=A.price,H.vendorRef=A.source==="csv"?"CSV":"Master";let N=A.price,L=A.unit;if(A.source==="manual")if(A.size&&A.size>0){const K=(A.unit||"").trim().toLowerCase();["g",""].includes(K)?(N=A.price/A.size*1e3,L="g"):["kg",""].includes(K)?(N=A.price/A.size,L="g"):["ml","","cc",""].includes(K)?(N=A.price/A.size*1e3,L="ml"):["l",""].includes(K)?(N=A.price/A.size,L="ml"):(N=A.price/A.size,L=A.unit)}else N=A.price,L=A.unit;else{const K=Ur(d,A.name);if(K&&K.packetSize){const oe=K.lastPrice!==null&&K.lastPrice!==void 0&&K.lastPrice!==""?K.lastPrice:A.price,he=(K.packetUnit||"").trim().toLowerCase();["g",""].includes(he)?(N=oe/K.packetSize*1e3,L="g"):["kg",""].includes(he)?(N=oe/K.packetSize,L="g"):["ml","","cc",""].includes(he)?(N=oe/K.packetSize*1e3,L="ml"):["l",""].includes(he)?(N=oe/K.packetSize,L="ml"):(N=oe/K.packetSize,L=K.packetUnit)}else N=A.price,L=A.unit}H.purchaseCost=Math.round(N*100)/100,j==="flour"?H.unit="g":L&&(H.unit=L)}const W=di(A.itemCategory??A.item_category??Ur(d,A.name)?.itemCategory);if(W){const N=vf(H,W);Object.assign(H,N)}const z=parseFloat(H.quantity),I=parseFloat(H.purchaseCost);if(!isNaN(z)&&!isNaN(I)){const N=Ur(d,H.name),L=Mi(H,N),K=Number.isFinite(L)&&L>0?L:1,oe=(H.unit||"").trim().toLowerCase();let he=0;oe==="g"||oe===""||oe==="ml"||oe===""||oe==="cc"||oe===""?he=z/1e3*I:he=z*I,H.cost=Math.round(he/K*100)/100}return G[M]=H,{...F,[Q]:G}})},$=c.isOpen&&c.index!==null?c.type==="flour"?n.flours[c.index]:n.breadIngredients[c.index]:null;return i.jsxs("div",{className:"bread-form",children:[i.jsxs(fn,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[i.jsxs("div",{className:"bread-header",children:[i.jsxs("h3",{children:[" (Total: ",g,"g)"]}),i.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Pi,{sensors:T,collisionDetection:Cf,onDragEnd:D,id:"flours-dnd",children:i.jsx(Ga,{items:n.flours||[],strategy:fo,children:(n.flours||[]).map((j,M)=>{const A=Ur(d,j?.name),F=qf(A?.yieldPercent??A?.yield_percent??j?.yieldPercent??j?.yield_percent);return i.jsx(vN,{id:j.id,index:M,item:j,yieldPercentApplied:F,onChange:v,onRemove:E,onSelect:P,calculatePercentage:y,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:M})},j.id)})})})})]}),i.jsx(be,{type:"button",variant:"secondary",size:"sm",onClick:S,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsxs(fn,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[i.jsxs("div",{className:"bread-header",children:[i.jsx("h3",{children:""}),i.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Pi,{sensors:T,collisionDetection:Cf,onDragEnd:D,id:"breadIngredients-dnd",children:i.jsx(Ga,{items:n.breadIngredients||[],strategy:fo,children:(n.breadIngredients||[]).map((j,M)=>{const A=Ur(d,j?.name),F=qf(A?.yieldPercent??A?.yield_percent??j?.yieldPercent??j?.yield_percent);return i.jsx(xN,{id:j.id,index:M,item:j,yieldPercentApplied:F,onChange:x,onRemove:_,onSelect:P,calculatePercentage:y,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:M})},j.id)})})})})]}),i.jsx(be,{type:"button",variant:"secondary",size:"sm",onClick:C,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:i.jsx(be,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),i.jsx($x,{isOpen:c.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:B,ingredientName:$?.name||"",currentCost:$?.purchaseCost,currentQuantity:$?.quantity,unit:$?.unit||"g",initialPurchaseCost:$?.purchase_cost,initialContentAmount:$?.content_amount})]})},vN=({id:n,index:t,item:s,yieldPercentApplied:l,onChange:c,onRemove:u,onSelect:d,calculatePercentage:f,floursLength:p,onOpenConversion:g})=>{const y=di(s.itemCategory??s.item_category),v=!!y,x=qx[y]||"",S=v?`${x}${zu(y)?"10%":"8%"}`:"",{attributes:C,listeners:E,setNodeRef:_,transform:T,transition:D,isDragging:B}=Ja({id:n}),P={transform:Cr.Transform.toString(T),transition:D,opacity:B?.5:1,position:"relative",zIndex:B?999:"auto"};return i.jsxs("div",{ref:_,style:P,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{...C,...E,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(up,{value:s.name,onChange:$=>c(t,"name",$.target.value),onSelect:$=>d("flour",t,$),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(xt,{type:"number",step:"any",value:s.quantity,onChange:$=>c(t,"quantity",$.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[f(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(xt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:$=>c(t,"purchaseCost",$.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:g,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(xt,{type:"number",step:"any",value:s.cost||"",onChange:$=>c(t,"cost",$.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(In(l))&&In(l)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const $=In(l),j=Math.round($*10)/10;return`${Number.isInteger(j)?Math.round(j):j}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:$=>c(t,"isAlcohol",$.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${S}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:p>1&&i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},xN=({id:n,index:t,item:s,yieldPercentApplied:l,onChange:c,onRemove:u,onSelect:d,calculatePercentage:f,onOpenConversion:p})=>{const g=di(s.itemCategory??s.item_category),y=!!g,v=qx[g]||"",x=y?`${v}${zu(g)?"10%":"8%"}`:"",{attributes:S,listeners:C,setNodeRef:E,transform:_,transition:T,isDragging:D}=Ja({id:n}),B={transform:Cr.Transform.toString(_),transition:T,opacity:D?.5:1,position:"relative",zIndex:D?999:"auto"};return i.jsxs("div",{ref:E,style:B,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{...S,...C,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(up,{value:s.name,onChange:P=>c(t,"name",P.target.value),onSelect:P=>d("ingredient",t,P),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(xt,{type:"number",step:"any",value:s.quantity,onChange:P=>c(t,"quantity",P.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[f(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(xt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:P=>c(t,"purchaseCost",P.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:p,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(xt,{type:"number",step:"any",value:s.cost||"",onChange:P=>c(t,"cost",P.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(In(l))&&In(l)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const P=In(l),$=Math.round(P*10)/10;return`${Number.isInteger($)?Math.round($):$}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:P=>c(t,"isAlcohol",P.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},bN=new Set(["food","alcohol","soft_drink","supplies"]),wN=new Set(["alcohol","supplies"]),SN={food:"",alcohol:"",soft_drink:"",supplies:""},Pa=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":bN.has(t)?t:"":""},xu=n=>wN.has(n),c0=(n,t)=>{const s=Pa(t);return s?{...n,itemCategory:s,isAlcohol:xu(s)}:{...n,itemCategory:null}},u0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),js=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=u0(t);if(!l)return null;for(const[c,u]of n.entries())if(u0(c)===l)return u;return null},Zn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},Px=n=>{const t=Zn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Da=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return Px(s)/100},jN=(n,t,s)=>{const l=Zn(n),c=Zn(t);if(!Number.isFinite(l)||!Number.isFinite(c)||c<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/c*1e3:(["kg","","l",""].includes(u),l/c)},xf=(n,t,s,l=1)=>{const c=Zn(n),u=Zn(t);if(!Number.isFinite(c)||!Number.isFinite(u))return NaN;const d=String(s||"").trim().toLowerCase();let f=0;["g","","ml","","cc",""].includes(d)?f=c/1e3*u:f=c*u;const p=Number.isFinite(l)&&l>0?l:1;return f/p},_N=(n,t)=>{const s=Zn(n?.purchaseCost),l=Zn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},CN=Ae.memo(({id:n,index:t,item:s,groupId:l,yieldPercentApplied:c,onChange:u,onRemove:d,handleSuggestionSelect:f,onOpenConversion:p})=>{const g=Pa(s.itemCategory??s.item_category),y=!!g,v=SN[g]||"",x=y?`${v}${xu(g)?"10%":"8%"}`:"",S=y?xu(g):!!s.isAlcohol,{attributes:C,listeners:E,setNodeRef:_,transform:T,transition:D,isDragging:B}=Ja({id:n,data:{groupId:l,index:t}}),P={transform:Cr.Translate.toString(T),transition:D,opacity:B?.3:1,position:"relative",zIndex:B?999:"auto"};return i.jsxs("div",{ref:_,style:P,className:"form-ingredient-row",children:[i.jsx("div",{...C,...E,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(up,{value:s.name,onChange:$=>u(l,t,"name",$.target.value),onSelect:$=>f(l,t,$),placeholder:""})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(xt,{value:s.quantity,onChange:$=>u(l,t,"quantity",$.target.value),placeholder:"0",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsx("div",{className:"ingredient-unit",children:i.jsx(xt,{value:s.unit,onChange:$=>u(l,t,"unit",$.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(xt,{type:"number",value:s.purchaseCost,onChange:$=>u(l,t,"purchaseCost",$.target.value),step:"0.01",placeholder:s.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},title:s.purchaseCostRef?`: ${s.purchaseCostRef}${s.vendorRef?` (${s.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:p,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",s.purchaseCostRef]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(xt,{type:"number",step:"0.01",value:s.cost,onChange:$=>u(l,t,"cost",$.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(Zn(c))&&Zn(c)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const $=Zn(c),j=Math.round($*10)/10;return`${Number.isInteger(j)?Math.round(j):j}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:S,onChange:$=>u(l,t,"isAlcohol",$.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(l,t),children:""})})]})},(n,t)=>n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),EN=({section:n,sections:t,onSectionChange:s,onRemoveSection:l,children:c})=>{const{setNodeRef:u}=ko({id:n.id});return i.jsxs(fn,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(xt,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>l(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[i.jsx("span",{}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[c,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},NN=({formData:n,setFormData:t,priceList:s})=>{const[l,c]=w.useState(new Map);w.useEffect(()=>{$n.getAllConversions().then(P=>c(P))},[]);const[u,d]=w.useState({isOpen:!1,groupId:null,index:null});w.useEffect(()=>{if(!n.ingredientSections){const P=n.ingredientGroups||[{id:"default",name:""}],$=n.ingredients||[],j=P.map(F=>({id:F.id,name:F.name,items:$.filter(Q=>F.id==="default"&&!Q.groupId?!0:Q.groupId===F.id)})),M=new Set(j.flatMap(F=>F.items.map(Q=>Q.id))),A=$.filter(F=>!M.has(F.id));A.length>0&&(j.length>0?j[0].items.push(...A):j.push({id:"default",name:"",items:A})),j.length===0&&j.push({id:crypto.randomUUID(),name:"",items:[]}),t(F=>({...F,ingredientSections:j}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const f=n.ingredientSections||[];w.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||l.size===0)return;let P=!1;const $=n.ingredientSections.map(j=>{const M=j.items.map(A=>{if(!A||typeof A!="object")return A;const F=js(l,A.name);let Q=A;const G=Pa(A.itemCategory??A.item_category??F?.itemCategory);if(G){const W=xu(G);(Pa(A.itemCategory??A.item_category)!==G||!!A.isAlcohol!==W)&&(Q={...Q,itemCategory:G,isAlcohol:W})}if(F&&F.packetSize){const z=[F.lastPrice,A.purchaseCostRef,A.purchase_cost,A.purchaseCost].find(N=>Number.isFinite(Zn(N))),I=jN(z,F.packetSize,F.packetUnit);if(Number.isFinite(I)&&_N(A,I)){const N=Da(A,F),L=Math.round(I*100)/100,K=xf(A.quantity,L,A.unit,N),oe=Number.isFinite(K)?Math.round(K*100)/100:Q.cost,he=Zn(Q.purchaseCost),U=Zn(Q.cost),V=!Number.isFinite(he)||Math.abs(he-L)>.01,k=Number.isFinite(Zn(oe))&&(!Number.isFinite(U)||Math.abs(U-oe)>.01);(V||k)&&(Q={...Q,purchaseCost:L,cost:oe})}}const H=Da(A,F);if(Number.isFinite(H)&&H>0&&Math.abs(H-1)>1e-4){const W=xf(A.quantity,Q.purchaseCost,A.unit,H),z=xf(A.quantity,Q.purchaseCost,A.unit,1),I=Zn(Q.cost);if(Number.isFinite(W)&&(!Number.isFinite(I)||Number.isFinite(z)&&Math.abs(I-z)<=.01)){const L=Math.round(W*100)/100,K=Zn(Q.cost);(!Number.isFinite(K)||Math.abs(K-L)>.01)&&(Q={...Q,cost:L})}}return Q!==A&&(P=!0),Q});return M!==j.items?{...j,items:M}:j});P&&t(j=>({...j,ingredientSections:$}))},[l,n.ingredientSections,t]);const p=Qa(fr(Ro,{activationConstraint:{distance:10}}),fr(To,{activationConstraint:{delay:250,tolerance:5}}),fr(Xa,{coordinateGetter:ku})),g=({active:P,over:$})=>{if(!$)return;const j=P.id,M=$.id,A=f.find(Q=>Q.items.some(G=>G.id===j)),F=f.find(Q=>Q.items.some(G=>G.id===M))||f.find(Q=>Q.id===M);!A||!F||A===F||t(Q=>{const G=A.items,H=F.items,W=G.findIndex(N=>N.id===j),z=H.findIndex(N=>N.id===M);let I;if(M===F.id)I=H.length+1;else{const L=$&&P.rect.current.translated&&P.rect.current.translated.top>$.rect.top+$.rect.height?1:0;I=z>=0?z+L:H.length+1}return{...Q,ingredientSections:Q.ingredientSections.map(N=>N.id===A.id?{...N,items:G.filter(L=>L.id!==j)}:N.id===F.id?{...N,items:[...H.slice(0,I),G[W],...H.slice(I,H.length)]}:N)}})},y=({active:P,over:$})=>{if(!$)return;const j=P.id,M=$.id,A=f.find(Q=>Q.items.some(G=>G.id===j)),F=f.find(Q=>Q.items.some(G=>G.id===M))||f.find(Q=>Q.id===M);if(A&&F&&A===F){const Q=A.items.findIndex(H=>H.id===j),G=F.items.findIndex(H=>H.id===M);Q!==G&&t(H=>({...H,ingredientSections:H.ingredientSections.map(W=>W.id===A.id?{...W,items:Hi(W.items,Q,G)}:W)}))}},v=(P,$,j,M)=>{const{groupId:A,index:F}=u;A!==null&&F!==null&&t(Q=>{const G=Q.ingredientSections.map(H=>{if(H.id!==A)return H;const W=[...H.items],z={...W[F],purchaseCost:P,unit:$,purchase_cost:j,content_amount:M},I=parseFloat(z.quantity),N=parseFloat(P);if(!isNaN(I)&&!isNaN(N)){const L=js(l,z.name),K=Da(z,L),oe=$?$.trim().toLowerCase():"";let he=0;oe==="g"||oe===""||oe==="ml"||oe===""||oe==="cc"||oe===""?he=I/1e3*N:he=I*N;const U=Number.isFinite(K)&&K>0?K:1;z.cost=Math.round(he/U*100)/100}return W[F]=z,{...H,items:W}});return $n.getAllConversions().then(H=>c(H)),bo.invalidateCache(),{...Q,ingredientSections:G}})},x=u.isOpen&&u.groupId!==null&&u.index!==null?f.find(P=>P.id===u.groupId)?.items[u.index]:null,S=Ae.useCallback((P,$,j,M)=>{t(A=>{const F=A.ingredientSections.map(Q=>{if(Q.id!==P)return Q;const G=[...Q.items],H={...G[$],[j]:M};if(G[$]=H,["quantity","purchaseCost","unit","name","isAlcohol"].includes(j)){const W=parseFloat(H.quantity),z=parseFloat(H.purchaseCost),I=js(l,H.name),N=Da(H,I),L=Number.isFinite(N)&&N>0?N:1;if(!isNaN(W)&&!isNaN(z)){let K=0;const oe=H.unit?H.unit.trim().toLowerCase():"";oe==="g"||oe===""||oe==="ml"||oe===""||oe==="cc"||oe===""?K=W/1e3*z:K=W*z;const he=Math.round(K/L*100)/100;he!==H.cost&&(H.cost=he,G[$]=H)}}if(j==="name"){const W=s.get(bn(M)),z=js(l,M),I=Pa(z?.itemCategory);if(I){const N=c0(H,I);Object.assign(H,N)}else W||(H.itemCategory=null);if(W){const N=typeof W=="object"?W.price:W,L=typeof W=="object"?W.vendor:null,K=typeof W=="object"?W.unit:null,oe=typeof W=="object"?W.size:null;if(H.purchaseCostRef=N,H.vendorRef=L,z&&z.packetSize){const V=z.lastPrice!==null&&z.lastPrice!==void 0&&z.lastPrice!==""?z.lastPrice:N;let k=0;const te=(z.packetUnit||"").trim().toLowerCase();["g",""].includes(te)?(k=V/z.packetSize*1e3,H.unit="g"):["kg",""].includes(te)?(k=V/z.packetSize,H.unit="g"):["ml","","cc",""].includes(te)?(k=V/z.packetSize*1e3,H.unit="ml"):["l",""].includes(te)?(k=V/z.packetSize,H.unit="ml"):(k=V/z.packetSize,H.unit=z.packetUnit),H.purchaseCost=Math.round(k*100)/100}else{let V=N,k=K;oe&&oe>1&&(["g",""].includes((K||"").toLowerCase())?(V=N/oe*1e3,k="g"):["ml","","cc",""].includes((K||"").toLowerCase())?(V=N/oe*1e3,k="ml"):["kg",""].includes(K?K.toLowerCase():"")?(V=N/oe,k="g"):["l",""].includes(K?K.toLowerCase():"")?(V=N/oe,k="ml"):V=N/oe),H.purchaseCost||(H.purchaseCost=Math.round(V*100)/100),!H.unit&&k&&(H.unit=k)}const he=parseFloat(H.quantity),U=parseFloat(H.purchaseCost);if(!isNaN(he)&&!isNaN(U)){const V=js(l,H.name),k=Da(H,V),te=Number.isFinite(k)&&k>0?k:1,de=H.unit?H.unit.trim().toLowerCase():"";let fe=0;de==="g"||de===""||de==="ml"||de===""||de==="cc"||de===""?fe=he/1e3*U:fe=he*U,H.cost=Math.round(fe/te*100)/100}}else H.purchaseCostRef=null,H.vendorRef=null;G[$]=H}return{...Q,items:G}});return{...A,ingredientSections:F}})},[l,s,t]),C=Ae.useCallback((P,$,j)=>{t(M=>{const A=M.ingredientSections.map(F=>{if(F.id!==P)return F;const Q=[...F.items],G={...Q[$]};if(G.name=j.name,G.itemCategory=null,j.price)if(G.purchaseCostRef=j.price,G.vendorRef=j.source==="csv"?"CSV":"Master",j.source==="manual")if(j.size&&j.size>0){const I=(j.unit||"").trim().toLowerCase();if(["g",""].includes(I)){const N=j.price/j.size*1e3;G.purchaseCost=Math.round(N*100)/100,G.unit="g"}else if(["kg",""].includes(I)){const N=j.price/j.size;G.purchaseCost=Math.round(N*100)/100,G.unit="g"}else if(["ml","","cc",""].includes(I)){const N=j.price/j.size*1e3;G.purchaseCost=Math.round(N*100)/100,G.unit="ml"}else if(["l",""].includes(I)){const N=j.price/j.size;G.purchaseCost=Math.round(N*100)/100,G.unit="ml"}else{const N=j.price/j.size;G.purchaseCost=Math.round(N*100)/100,G.unit=j.unit}}else G.purchaseCost=j.price,G.unit=j.unit;else{const I=js(l,j.name);if(I&&I.packetSize){const N=I.lastPrice!==null&&I.lastPrice!==void 0&&I.lastPrice!==""?I.lastPrice:j.price;let L=0;const K=(I.packetUnit||"").trim().toLowerCase();["g",""].includes(K)?(L=N/I.packetSize*1e3,G.unit="g"):["kg",""].includes(K)?(L=N/I.packetSize,G.unit="g"):["ml","","cc",""].includes(K)?(L=N/I.packetSize*1e3,G.unit="ml"):["l",""].includes(K)?(L=N/I.packetSize,G.unit="ml"):(L=N/I.packetSize,G.unit=I.packetUnit),G.purchaseCost=Math.round(L*100)/100}else G.purchaseCost=j.price,G.unit=j.unit}const H=Pa(j.itemCategory??j.item_category??js(l,j.name)?.itemCategory);if(H){const I=c0(G,H);Object.assign(G,I)}const W=parseFloat(G.quantity),z=parseFloat(G.purchaseCost);if(!isNaN(W)&&!isNaN(z)){const I=js(l,G.name),N=Da(G,I),L=Number.isFinite(N)&&N>0?N:1,K=G.unit?G.unit.trim().toLowerCase():"";let oe=0;K==="g"||K===""||K==="ml"||K===""||K==="cc"||K===""?oe=W/1e3*z:oe=W*z,G.cost=Math.round(oe/L*100)/100}return Q[$]=G,{...F,items:Q}});return{...M,ingredientSections:A}})},[l,t]),E=Ae.useCallback((P,$)=>{t(j=>({...j,ingredientSections:j.ingredientSections.map(M=>M.id===P?{...M,items:M.items.filter((A,F)=>F!==$)}:M)}))},[t]),_=P=>{const $={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(j=>({...j,ingredientSections:j.ingredientSections.map(M=>M.id===P?{...M,items:[...M.items,$]}:M)}))},T=()=>{t(P=>({...P,ingredientSections:[...P.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},D=P=>{t($=>({...$,ingredientSections:$.ingredientSections.filter(j=>j.id!==P)}))},B=(P,$)=>{t(j=>({...j,ingredientSections:j.ingredientSections.map(M=>M.id===P?{...M,name:$}:M)}))};return i.jsxs(Pi,{sensors:p,collisionDetection:V0,onDragOver:g,onDragEnd:y,children:[i.jsxs("div",{className:"recipe-form-ingredients",children:[f.map(P=>i.jsx(Ga,{id:P.id,items:P.items.map($=>$.id),strategy:fo,children:i.jsxs(EN,{section:P,sections:f,onSectionChange:B,onRemoveSection:D,children:[P.items.map(($,j)=>(()=>{const M=js(l,$?.name),A=Px(M?.yieldPercent??M?.yield_percent??$?.yieldPercent??$?.yield_percent);return i.jsx(CN,{id:$.id,index:j,item:$,groupId:P.id,yieldPercentApplied:A,onChange:S,onRemove:E,handleSuggestionSelect:C,onOpenConversion:()=>d({isOpen:!0,groupId:P.id,index:j})},$.id)})()),i.jsx(be,{type:"button",variant:"ghost",onClick:()=>_(P.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},P.id)),i.jsx(be,{type:"button",variant:"secondary",onClick:T,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(cx,{dropAnimation:{sideEffects:rp({styles:{active:{opacity:"0.5"}}})},children:null}),i.jsx($x,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,groupId:null,index:null}),onApply:v,ingredientName:x?.name||"",currentCost:x?.purchaseCost,currentQuantity:x?.quantity,unit:x?.unit||"g",initialPurchaseCost:x?.purchase_cost,initialContentAmount:x?.content_amount})]})},RN=({id:n,index:t,item:s,groupId:l,onChange:c,onRemove:u})=>{const{attributes:d,listeners:f,setNodeRef:p,transform:g,transition:y,isDragging:v}=Ja({id:n,data:{groupId:l,index:t}}),x={transform:Cr.Translate.toString(g),transition:y,opacity:v?.3:1,position:"relative",zIndex:v?999:"auto"};return i.jsxs("div",{ref:p,style:{...x,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[i.jsx("div",{...d,...f,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),i.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),i.jsx("div",{style:{flex:1},children:i.jsx(xt,{textarea:!0,value:s.text,onChange:S=>c(l,t,S.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(l,t),title:"",children:""})})]})},TN=({section:n,sections:t,onSectionChange:s,onRemoveSection:l,children:c})=>{const{setNodeRef:u}=ko({id:n.id});return i.jsxs(fn,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(xt,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>l(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[c,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},AN=({formData:n,setFormData:t})=>{w.useEffect(()=>{if(!n.stepSections){const x=n.stepGroups||[{id:"default",name:""}],C=(n.steps||[]||[]).map(D=>typeof D=="string"?{id:crypto.randomUUID(),text:D}:D),E=x.map(D=>({id:D.id,name:D.name,items:C.filter(B=>D.id==="default"&&!B.groupId?!0:B.groupId===D.id)})),_=new Set(E.flatMap(D=>D.items.map(B=>B.id))),T=C.filter(D=>!_.has(D.id));T.length>0&&(E.length>0?E[0].items.push(...T):E.push({id:"default",name:"",items:T})),E.length===0&&E.push({id:crypto.randomUUID(),name:"",items:[]}),t(D=>({...D,stepSections:E}))}},[n.steps,n.stepGroups,n.stepSections,t]);const s=n.stepSections||[],l=Qa(fr(Ro,{activationConstraint:{distance:10}}),fr(To,{activationConstraint:{delay:250,tolerance:5}}),fr(Xa,{coordinateGetter:ku})),c=({active:x,over:S})=>{if(!S)return;const C=x.id,E=S.id,_=s.find(D=>D.items.some(B=>B.id===C)),T=s.find(D=>D.items.some(B=>B.id===E))||s.find(D=>D.id===E);!_||!T||_===T||t(D=>{const B=_.items,P=T.items,$=B.findIndex(A=>A.id===C),j=P.findIndex(A=>A.id===E);let M;if(E===T.id)M=P.length+1;else{const F=S&&x.rect.current.translated&&x.rect.current.translated.top>S.rect.top+S.rect.height?1:0;M=j>=0?j+F:P.length+1}return{...D,stepSections:D.stepSections.map(A=>A.id===_.id?{...A,items:B.filter(F=>F.id!==C)}:A.id===T.id?{...A,items:[...P.slice(0,M),B[$],...P.slice(M,P.length)]}:A)}})},u=({active:x,over:S})=>{if(!S)return;const C=x.id,E=S.id,_=s.find(D=>D.items.some(B=>B.id===C)),T=s.find(D=>D.items.some(B=>B.id===E))||s.find(D=>D.id===E);if(_&&T&&_===T){const D=_.items.findIndex(P=>P.id===C),B=T.items.findIndex(P=>P.id===E);D!==B&&t(P=>({...P,stepSections:P.stepSections.map($=>$.id===_.id?{...$,items:Hi($.items,D,B)}:$)}))}},d=(x,S,C)=>{t(E=>({...E,stepSections:E.stepSections.map(_=>{if(_.id!==x)return _;const T=[..._.items];return T[S]={...T[S],text:C},{..._,items:T}})}))},f=(x,S)=>{t(C=>({...C,stepSections:C.stepSections.map(E=>E.id===x?{...E,items:E.items.filter((_,T)=>T!==S)}:E)}))},p=x=>{const S={id:crypto.randomUUID(),text:""};t(C=>({...C,stepSections:C.stepSections.map(E=>E.id===x?{...E,items:[...E.items,S]}:E)}))},g=()=>{t(x=>({...x,stepSections:[...x.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},y=x=>{t(S=>({...S,stepSections:S.stepSections.filter(C=>C.id!==x)}))},v=(x,S)=>{t(C=>({...C,stepSections:C.stepSections.map(E=>E.id===x?{...E,name:S}:E)}))};return i.jsxs(Pi,{sensors:l,collisionDetection:V0,onDragOver:c,onDragEnd:u,children:[i.jsxs("div",{className:"recipe-form-steps",children:[s.map(x=>i.jsx(Ga,{id:x.id,items:x.items.map(S=>S.id),strategy:fo,children:i.jsxs(TN,{section:x,sections:s,onSectionChange:v,onRemoveSection:y,children:[x.items.map((S,C)=>i.jsx(RN,{id:S.id,index:C,item:S,groupId:x.id,onChange:d,onRemove:f},S.id)),i.jsx(be,{type:"button",variant:"ghost",onClick:()=>p(x.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},x.id)),i.jsx(be,{type:"button",variant:"secondary",onClick:g,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(cx,{dropAnimation:{sideEffects:rp({styles:{active:{opacity:"0.5"}}})},children:null})]})},Hx=({onClose:n,onImport:t,initialMode:s="url"})=>{const[l,c]=w.useState(s),[u,d]=w.useState(null),[f,p]=w.useState(""),[g,y]=w.useState(""),[v,x]=w.useState(null),[S,C]=w.useState(null),[E,_]=w.useState(!1),[T,D]=w.useState(null),[B,P]=w.useState(!1),$=z=>{z.preventDefault(),z.stopPropagation(),z.type==="dragenter"||z.type==="dragover"?P(!0):z.type==="dragleave"&&P(!1)},j=z=>{if(z.preventDefault(),z.stopPropagation(),P(!1),z.dataTransfer.files&&z.dataTransfer.files[0]){const I=z.dataTransfer.files[0];I.type.startsWith("image/")&&(x(I),C(URL.createObjectURL(I)))}},M=z=>/[---]/.test(z||""),A=async z=>{try{const I=[];I.push(z.name||""),I.push(z.description||"");const N=[];Array.isArray(z.ingredients)&&z.ingredients.forEach((k,te)=>{k.name&&(I.push(k.name),N.push(te))});const L=[];if(Array.isArray(z.steps)&&z.steps.forEach((k,te)=>{I.push(k),L.push(te)}),I.length===0)return z;const{data:K,error:oe}=await Te.functions.invoke("translate",{body:{text:I,target_lang:"JA"}});if(oe)throw oe;const he=K.translations.map(k=>k.text);let U=0;const V={...z};return V.name=he[U++]||V.name,V.description=he[U++]||V.description,N.length>0&&(V.ingredients=V.ingredients.map((k,te)=>{const de=N.indexOf(te);return de!==-1?{...k,name:he[U+de]}:k}),U+=N.length),L.length>0&&(V.steps=V.steps.map((k,te)=>{const de=L.indexOf(te);return de!==-1?he[U+de]:k})),V}catch(I){return console.error("Translation failed:",I),alert(""),z}},[F,Q]=w.useState([]),G=async()=>{_(!0),D(null),Q([]);try{let z,I="";if(l==="url"){if(!g)return;I=g;const{data:K,error:oe}=await Te.functions.invoke("scrape-recipe",{body:{url:g}});if(oe)throw oe;z=K}else{if(!v)return;const K=new FormData;K.append("image",v);const{data:{session:oe}}=await Te.auth.getSession(),he=`${Te.supabaseUrl}/functions/v1/analyze-image`,U={Authorization:`Bearer ${oe?.access_token||Te.supabaseKey}`},V=await fetch(he,{method:"POST",headers:U,body:K});if(!V.ok)throw new Error(`Server Error: ${V.statusText}`);const k=V.body.getReader(),te=new TextDecoder;let de=null,fe="";for(;;){const{done:J,value:q}=await k.read();if(J)break;fe+=te.decode(q,{stream:!0});const le=fe.split(`

`);fe=le.pop()||"";for(const ge of le){const Ne=ge.trim();if(Ne.startsWith("data: "))try{const _e=JSON.parse(Ne.slice(6));if(_e.type==="log")Q(Me=>[...Me,_e.message]);else if(_e.type==="result")de=_e;else if(_e.type==="error")throw new Error(_e.message)}catch(_e){console.warn("Failed to parse SSE event",_e)}}}if(!de)throw new Error("");z=de}if(z.error)throw new Error(z.error);if(!z.recipe)throw new Error("No recipe found");let N=z.recipe;if(N.name=N.name||N.title||"",N.recipeYield=N.recipeYield||N.servings||"",N.description=N.description||"",!N.ingredients&&N.recipeIngredient&&(N.ingredients=N.recipeIngredient),Array.isArray(N.ingredients)){const K=["","","method","instructions","steps","preparation"],oe=[],he=[];N.ingredients.forEach(U=>{const V=(U.group||"").trim().toLowerCase();if(V&&K.some(k=>V===k||V.includes(k))){const k=U.name||U.text||"";k&&he.push(k)}else oe.push(U)}),he.length>0&&(console.log("Extracted steps from ingredients:",he),N.ingredients=oe,N.steps=Array.isArray(N.steps)?N.steps:[],N.steps=[...N.steps,...he])}const L=(N.name||"")+(N.steps?N.steps.slice(0,3).join(""):"");if(L&&!M(L)){d(N),p(I),c("confirm-translation"),_(!1);return}t(N,I),n()}catch(z){console.error("Import failed details:",z);const I=z.message||"Import failed. Please try again.";D(I)}finally{l!=="confirm-translation"&&_(!1)}},H=async z=>{_(!0);try{let I=u;z&&(I=await A(u)),t(I,f),n()}catch(I){console.error("Translation flow error:",I),D("Translation failed. Importing original."),t(u,f),n()}finally{_(!1)}},W=z=>{const I=z.target.files[0];I&&(x(I),C(URL.createObjectURL(I)))};return i.jsxs("div",{className:"modal-overlay fade-in",children:[E&&i.jsxs("div",{className:"loading-overlay",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"..."}),F.length>0&&i.jsx("div",{className:"progress-log-container",children:i.jsxs("div",{className:"progress-log",children:[F.map((z,I)=>i.jsx("div",{className:"log-entry",children:i.jsx("span",{className:"log-message",children:z})},I)),i.jsx("div",{ref:z=>z?.scrollIntoView({behavior:"smooth"})})]})})]}),i.jsxs(fn,{className:"import-modal-card",children:[i.jsx("h3",{className:"modal-title",children:l==="confirm-translation"?"":""}),l==="confirm-translation"?i.jsxs("div",{className:"translation-confirm-content",children:[i.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),i.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),i.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[i.jsx(be,{type:"button",variant:"primary",onClick:()=>H(!0),isLoading:E,style:{width:"100%"},children:""}),i.jsx(be,{type:"button",variant:"secondary",onClick:()=>H(!1),disabled:E,style:{width:"100%"},children:""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"import-mode-tabs",children:[i.jsx("button",{type:"button",onClick:()=>c("url"),className:`tab-btn tab-import-web ${l==="url"?"active":""}`,children:" Web URL"}),i.jsx("button",{type:"button",onClick:()=>c("image"),className:`tab-btn tab-import-image ${l==="image"?"active":""}`,children:"  (Best Effort)"})]}),l==="url"?i.jsxs(i.Fragment,{children:[i.jsx("p",{children:"URL"}),i.jsx("input",{type:"url",placeholder:"https://...",value:g,onChange:z=>y(z.target.value),className:"import-url-input",autoFocus:!0})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{children:""}),i.jsxs("div",{className:"image-upload-wrapper",children:[i.jsx("input",{type:"file",accept:"image/*",onChange:W,id:"recipe-image-upload",className:"image-upload-input"}),i.jsx("label",{htmlFor:"recipe-image-upload",onDragEnter:$,onDragLeave:$,onDragOver:$,onDrop:j,className:`image-upload-label ${B?"drag-active":""}`,children:S?i.jsx("img",{src:S,alt:"Preview",className:"image-upload-preview"}):B?"":""})]})]}),T&&i.jsx("p",{className:"error-text",children:T}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(be,{type:"button",variant:"ghost",onClick:n,disabled:E,children:""}),i.jsx(be,{type:"button",variant:"primary",onClick:G,isLoading:E,disabled:l==="url"?!g:!v,children:""})]})]})]})]})},d0=({onSave:n,onCancel:t,initialData:s})=>{const l=s||{},[c,u]=w.useState("ingredients"),[d,f]=w.useState(null),[p,g]=w.useState(new Map);Ae.useEffect(()=>{(async()=>{const z=await nr.fetchPriceList();g(z)})()},[]);const y=w.useMemo(()=>{const W=l.steps||[""];let z=l.stepGroups||[];const I=W.some(L=>typeof L=="object"&&L.group);if(z.length===0&&I){const L=new Map;W.forEach(K=>{typeof K=="object"&&K.group&&!L.has(K.group)&&L.set(K.group,crypto.randomUUID())}),z=Array.from(L.entries()).map(([K,oe])=>({id:oe,name:K}))}return{steps:W.map(L=>{const K=typeof L=="string"?L:L.text||"",oe=typeof L=="object"&&L.id?L.id:crypto.randomUUID();let he=typeof L=="object"?L.groupId:void 0;const U=typeof L=="object"?L.group:void 0;if(!he&&U&&z.length>0){const V=z.find(k=>k.name===U);V&&(he=V.id)}return{id:oe,text:K,groupId:he}}),stepGroups:z}},[l]),v=y.steps,x=y.stepGroups,S=w.useMemo(()=>{const W=l.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let z=l.ingredientGroups||[];if(z.length===0&&W.some(N=>N.group)){const N=new Map;W.forEach(L=>{L.group&&!N.has(L.group)&&N.set(L.group,crypto.randomUUID())}),z=Array.from(N.entries()).map(([L,K])=>({id:K,name:L})),N.size>0&&W.some(L=>!L.group)}return{ingredients:W.map(N=>{const L=typeof N=="string"?{name:N,quantity:"",unit:"",cost:"",purchaseCost:""}:{...N,cost:N.cost||"",purchaseCost:N.purchaseCost||""};let K=L.groupId;if(!K&&L.group&&z.length>0){const oe=z.find(he=>he.name===L.group);oe&&(K=oe.id)}return{...L,id:L.id||crypto.randomUUID(),groupId:K}}),ingredientGroups:z}},[l]),C=S.ingredients,E=S.ingredientGroups,[_,T]=w.useState({title:l.title||"",description:l.description||"",image:l.image||"",imageFile:null,storeName:l.storeName||"",servings:l.servings||"",ingredients:C,ingredientGroups:E,steps:v,stepGroups:x,tags:l.tags||[""],course:l.course||"",category:l.category||"",type:l.type||"normal",flours:l.flours||[],breadIngredients:l.breadIngredients||[],sourceUrl:l.sourceUrl||""}),[D,B]=w.useState(!1),P=(W,z="")=>{const I=new Map,N=W.ingredients||[];N.forEach(k=>{let te=k.group||"";te==="Main"&&(te=""),I.has(te)||I.set(te,crypto.randomUUID())});const L=Array.from(I.entries()).map(([k,te])=>({id:te,name:k})),K=N.map(k=>{let te=k.group||"";te==="Main"&&(te="");let de;return I.has(te)&&(de=I.get(te)),{id:crypto.randomUUID(),name:k.name||"",quantity:k.quantity||"",unit:k.unit||"",cost:"",purchaseCost:"",groupId:de}}),oe=new Map,he=W.steps||[];he.forEach(k=>{typeof k=="object"&&k.group&&k.group!=="Main"&&(oe.has(k.group)||oe.set(k.group,crypto.randomUUID()))});const U=Array.from(oe.entries()).map(([k,te])=>({id:te,name:k})),V=he.map(k=>{const te=typeof k=="object",de=te?k.text||"":k,fe=te?k.group:null;let J;return fe&&oe.has(fe)&&(J=oe.get(fe)),{id:crypto.randomUUID(),text:de,groupId:J}});T(k=>({...k,title:W.name||k.title,description:W.description||k.description,category:z?"URL":W.category||k.category,image:W.image||k.image,servings:W.recipeYield||k.servings,ingredients:K,ingredientGroups:L,steps:V,stepGroups:U,ingredientSections:void 0,stepSections:void 0,sourceUrl:z||k.sourceUrl})),f(null),u("ingredients")},$=W=>{W.preventDefault(),W.stopPropagation(),W.type==="dragenter"||W.type==="dragover"?B(!0):W.type==="dragleave"&&B(!1)},j=W=>{if(W.preventDefault(),W.stopPropagation(),B(!1),W.dataTransfer.files&&W.dataTransfer.files[0]){const z=W.dataTransfer.files[0];z.type.startsWith("image/")&&T(I=>({...I,imageFile:z,image:URL.createObjectURL(z)}))}},M=W=>{const{id:z,value:I}=W.target;T(N=>({...N,[z]:I}))},A=W=>{const z=W.target.files[0];z&&T(I=>({...I,imageFile:z,image:URL.createObjectURL(z)}))},F=w.useMemo(()=>{if(_.type==="bread")return(_.flours?.length||0)+(_.breadIngredients?.length||0);const W=_.ingredientSections||[];return W.length>0?W.reduce((z,I)=>z+(I?.items?.length||0),0):_.ingredients?.length||0},[_.breadIngredients,_.flours,_.ingredientSections,_.ingredients,_.type]),Q=w.useMemo(()=>{const W=_.stepSections||[];return W.length>0?W.reduce((z,I)=>z+(I?.items?.length||0),0):_.steps?.length||0},[_.stepSections,_.steps]),G=W=>{W.preventDefault();let z=[],I=[];if(_.type==="bread")z=_.ingredients.map(U=>{const{id:V,...k}=U;return k});else{const U=_.ingredientSections||[];U.length===0&&_.ingredients.length>0?z=_.ingredients.map(V=>{const{id:k,...te}=V;return te}):(z=U.flatMap(V=>V.items.map(k=>({...k,groupId:V.id}))).map(V=>{const{id:k,...te}=V;return te}),I=U.map(V=>({id:V.id,name:V.name})))}const N=new Set(_.tags||[]);_.course&&N.add(_.course),_.category&&N.add(_.category),_.type==="bread"&&N.add("");const L=Array.from(N).filter(Boolean);let K=[],oe=[];const he=_.stepSections||[];he.length===0&&_.steps.length>0?K=_.steps.map(U=>typeof U=="string"?{text:U}:U):(K=he.flatMap(U=>U.items.map(V=>({text:V.text,groupId:U.id}))),oe=he.map(U=>({id:U.id,name:U.name}))),n({..._,ingredients:z,ingredientGroups:I,steps:K,stepGroups:oe,image:_.imageFile||_.image,id:l.id||Date.now(),tags:L,ingredientSections:void 0,stepSections:void 0})},H=!!l?.id;return i.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:G,children:[d&&i.jsx(Hx,{onClose:()=>f(null),onImport:P,initialMode:d}),i.jsxs("div",{className:"recipe-form-mock__page",children:[i.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:i.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[i.jsxs("div",{className:"recipe-form-mock__crumb",children:[i.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),i.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),i.jsx("span",{className:"recipe-form-mock__crumb-page",children:H?"":""})]}),i.jsxs("div",{className:"recipe-form-mock__actions",children:[i.jsx(be,{type:"button",variant:"ghost",onClick:t,children:""}),i.jsx(be,{type:"submit",variant:"primary",children:""})]})]})}),i.jsxs("div",{className:"recipe-form-mock__sheet",children:[i.jsxs("header",{className:"recipe-form-mock__doc",children:[i.jsxs("div",{className:"recipe-form-mock__doc-title",children:[i.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:_.title,onChange:M,placeholder:"",required:!0}),i.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),i.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(xt,{label:"",id:"course",value:_.course,onChange:M,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"course-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(xt,{label:"",id:"category",value:_.category,onChange:M,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"category-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(xt,{label:"",id:"storeName",value:_.storeName,onChange:M,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),i.jsx("datalist",{id:"store-options",children:lu.map(W=>i.jsx("option",{value:W},W))})]}),i.jsx("div",{className:"recipe-form-mock__meta-field",children:i.jsx(xt,{label:"",id:"servings",value:_.servings,onChange:M,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),i.jsxs("div",{className:"recipe-form-mock__grid",children:[i.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[i.jsxs(fn,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsx(xt,{label:"",id:"description",textarea:!0,value:_.description,onChange:M,placeholder:"..."}),i.jsx(xt,{label:"URL",id:"sourceUrl",value:_.sourceUrl||"",onChange:M,placeholder:"https://example.com/recipe/..."})]}),i.jsxs(fn,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:`recipe-form-mock__image-drop ${D?"is-active":""}`,onDragEnter:$,onDragLeave:$,onDragOver:$,onDrop:j,children:[_.image?i.jsxs("div",{className:"recipe-form-mock__image-preview",children:[i.jsx("img",{src:_.image,alt:"",onError:W=>{W.target.style.display="none"}}),i.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>T(W=>({...W,image:"",imageFile:null})),title:"",children:""})]}):i.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",i.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),i.jsx("input",{type:"file",accept:"image/*",onChange:A,className:"recipe-form-mock__image-input"})]})]}),!l?.id&&i.jsxs(fn,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:"recipe-form-mock__import-actions",children:[i.jsx(be,{variant:"secondary",type:"button",onClick:()=>f("url"),children:"URL"}),i.jsx(be,{variant:"secondary",type:"button",onClick:()=>f("image"),children:""})]}),i.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),i.jsxs(fn,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[i.jsx("li",{children:""}),i.jsx("li",{children:""}),i.jsx("li",{children:""})]})]})]}),i.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:i.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[i.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[i.jsxs("div",{className:"recipe-form-mock__nav",children:[i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${c==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:F.toLocaleString()})]}),i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${c==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:Q.toLocaleString()})]})]}),i.jsx("div",{className:"recipe-form-mock__workspace-right",children:c==="ingredients"?i.jsxs("div",{className:"recipe-form-mock__segmented",children:[i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${_.type==="normal"?"active":""}`,onClick:()=>T(W=>({...W,type:"normal"})),children:""}),i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${_.type==="bread"?"active":""}`,onClick:()=>T(W=>({...W,type:"bread"})),children:""})]}):i.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),i.jsx("div",{className:"recipe-form-mock__workspace-body",children:c==="ingredients"?i.jsx("div",{className:"recipe-form-mock__editor-surface",children:_.type==="bread"?i.jsx(yN,{formData:_,setFormData:T}):i.jsx(NN,{formData:_,setFormData:T,priceList:p})}):i.jsx("div",{className:"recipe-form-mock__editor-surface",children:i.jsx(AN,{formData:_,setFormData:T})})})]})})]})]})]})]})},kN="modulepreload",ON=function(n){return"/app/"+n},h0={},bf=function(t,s,l){let c=Promise.resolve();if(s&&s.length>0){let p=function(g){return Promise.all(g.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");c=p(s.map(g=>{if(g=ON(g),g in h0)return;h0[g]=!0;const y=g.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":kN,y||(x.as="script"),x.crossOrigin="",x.href=g,f&&x.setAttribute("nonce",f),document.head.appendChild(x),y)return new Promise((S,C)=>{x.addEventListener("load",S),x.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${g}`)))})}))}function u(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return c.then(d=>{for(const f of d||[])f.status==="rejected"&&u(f.reason);return t().catch(u)})},f0="csv_unit_overrides",p0=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),bu={async _getCurrentUserId(){const{data:n,error:t}=await Te.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:s,error:l}=await Te.from(f0).select("ingredient_name,csv_unit").eq("user_id",t);if(l){if(p0(l))return new Map;throw l}const c=new Map;return(s||[]).forEach(u=>{u?.ingredient_name&&c.set(String(u.ingredient_name),String(u.csv_unit||""))}),c}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,s=null){const l=s||await this._getCurrentUserId();if(!l)throw new Error("");const c=String(n||"").trim(),u=String(t||"").trim();if(!c)throw new Error("");if(!u)throw new Error("");const{data:d,error:f}=await Te.from(f0).upsert({user_id:l,ingredient_name:c,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(f)throw p0(f)?new Error("DB csv_unit_overrides "):f;return d}},Fx=w.createContext(null),Do=()=>{const n=w.useContext(Fx);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},DN=()=>{const n=Do(),[t,s]=w.useState([]),[l,c]=w.useState(""),[u,d]=w.useState("all"),[f,p]=w.useState(null),[g,y]=w.useState(!1),[v,x]=w.useState(new Map),[S,C]=w.useState(new Map),[E,_]=w.useState({}),T="manual",D=k=>{const te=String(k||"").trim();return!te||te==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(te)?te:"food"},B=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:T,label:""}],P=w.useCallback(k=>{const te=bn(k);return te?v?.has(te):!1},[v]),$=Ae.useMemo(()=>{const k={all:t.length,food:0,alcohol:0,soft_drink:0,supplies:0,[T]:0};return t.forEach(te=>{const de=D(te?.itemCategory);k[de]=(k[de]||0)+1,P(te?.ingredientName)||(k[T]=(k[T]||0)+1)}),k},[t,P]),j=w.useCallback(async()=>{y(!0);try{const[k,te,de]=await Promise.all([$n.getAllConversions(),nr.fetchPriceList(),bu.getAll()]),fe=Array.from(k.values()).map(J=>({...J,clientId:J.ingredientName,isNew:!1,isEditing:!1}));x(te||new Map),C(de||new Map),s(fe.sort((J,q)=>J.ingredientName.localeCompare(q.ingredientName,"ja")))}catch(k){n.error(""),console.error("Failed to load ingredients:",k)}y(!1)},[n]);w.useEffect(()=>{const k=setTimeout(()=>{j()},0);return()=>clearTimeout(k)},[j]);const M=()=>{const k=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,te=["food","alcohol","soft_drink","supplies"].includes(u)?u:"food",de={clientId:k,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:te,isNew:!0,isEditing:!0};s(fe=>[de,...fe.map(J=>({...J,isEditing:!1}))]),p(k)},A=w.useCallback(k=>t.findIndex(te=>te?.clientId===k),[t]),F=async k=>{const te=A(k);if(te<0)return;const de=t[te];if(!de.ingredientName||!de.packetSize||!de.lastPrice){n.warning("");return}const fe=parseFloat(de.yieldPercent),J=Number.isFinite(fe)?fe:100;if(J<=0||J>100){n.warning("% 1100 ");return}try{await $n.saveConversion(de.ingredientName,de.packetSize,de.packetUnit,de.lastPrice,de.itemCategory,de.vendor,J),n.success(""),j(),p(null)}catch(q){n.error(""),console.error("Save error:",q)}},Q=async k=>{const te=A(k);if(te<0)return;const de=t[te],fe=de?.ingredientName;if(de.isNew){s(J=>J.filter(q=>q?.clientId!==k)),p(null);return}try{await $n.deleteConversion(fe),n.success(""),j()}catch(J){n.error(""),console.error("Delete error:",J)}},G=k=>{p(k),s(te=>te.map(de=>({...de,isEditing:de?.clientId===k})))},H=k=>{const te=A(k);te<0||(t[te].isNew?s(de=>de.filter(fe=>fe?.clientId!==k)):j(),p(null))},W=(k,te,de)=>{s(fe=>fe.map(J=>J?.clientId!==k?J:{...J,[te]:de}))},z=k=>{const te=parseFloat(k.lastPrice),de=parseFloat(k.packetSize);if(!te||!de)return"-";const fe=k.packetUnit?k.packetUnit.trim().toLowerCase():"";return fe==="g"||fe===""?`${Math.round(te/de*1e3).toLocaleString()}/kg`:fe==="ml"||fe==="cc"||fe===""||fe===""?`${Math.round(te/de*1e3).toLocaleString()}/L`:`${Math.round(te/de).toLocaleString()}/${k.packetUnit}`},I=t.filter(k=>{const te=String(k?.ingredientName||"");return te.toLowerCase().includes(l.toLowerCase())?u==="all"?!0:u===T?!P(te):D(k?.itemCategory)===u:!1}),N=u!=="all"||String(l||"").trim()!=="",L=k=>{const te=bn(k);if(!te)return"-";const fe=(v?.get(te)||null)?.unit;return fe?String(fe):"-"},K=k=>{const te=bn(k);if(!te)return"";const fe=(v?.get(te)||null)?.vendor;return fe?String(fe):""},oe=k=>{const te=String(k?.vendor||"").trim();return te||K(k?.ingredientName)},he=k=>{const te=(k??"").toString().trim();if(!te)return"";if(Object.prototype.hasOwnProperty.call(E,te))return E[te];const de=S?.get(te);if(de)return String(de);const fe=L(te);return fe==="-"?"":fe},U=k=>{const te=(k??"").toString().trim();if(!te)return"-";const de=S?.get(te);return de?String(de):L(te)},V=async(k,te)=>{const de=(k??"").toString().trim(),fe=(te??"").toString().trim();if(de){if(!fe){_(J=>{const q={...J};return delete q[de],q});return}try{await bu.upsert(de,fe),C(J=>{const q=new Map(J);return q.set(de,fe),q}),n.success("CSV")}catch(J){console.error(J),n.error(J?.message||"")}}};return i.jsxs("div",{className:"ingredient-master-container",children:[i.jsxs("div",{className:"master-header",children:[i.jsx("h3",{children:" "}),i.jsx(be,{variant:"primary",onClick:M,disabled:f!==null,children:"+ "})]}),i.jsx("div",{className:"master-search",children:i.jsx(xt,{placeholder:"...",value:l,onChange:k=>c(k.target.value)})}),i.jsxs("div",{className:"ingredient-master-stats",children:[i.jsxs("span",{children:[": ",i.jsx("strong",{children:(t.length||0).toLocaleString()})," "]}),N&&i.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",i.jsx("strong",{children:(I.length||0).toLocaleString()})," "]})]}),i.jsx("div",{className:"ingredient-category-tabs",children:B.map(k=>i.jsxs("button",{type:"button",className:`ingredient-category-tab ${u===k.key?"active":""}`,onClick:()=>d(k.key),disabled:f!==null,title:f!==null?"":void 0,children:[k.label," (",($[k.key]??0).toLocaleString(),")"]},k.key))}),g?i.jsx("div",{className:"master-loading",children:"..."}):i.jsx("div",{className:"master-table-wrapper",children:i.jsxs("table",{className:"master-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{children:""}),i.jsx("th",{children:"%"}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:I.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"8",style:{textAlign:"center",color:"#999"},children:N?"":""})}):I.map((k,te)=>{const de=k?.clientId??k?.ingredientName??String(te),fe=K(k?.ingredientName),J=String(k?.vendor||"").trim(),q=k?.isEditing&&!!fe&&fe!==J,le=oe(k),Ne=D(k?.itemCategory)==="food";return i.jsxs("tr",{className:k.isEditing?"editing":"",children:[i.jsx("td",{children:k.isEditing?i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx(xt,{value:k.ingredientName,onChange:_e=>W(de,"ingredientName",_e.target.value),placeholder:": ",disabled:!k.isNew,wrapperClassName:"input-group--no-margin"}),i.jsx(xt,{value:k.vendor||"",onChange:_e=>W(de,"vendor",_e.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),q&&i.jsxs("div",{className:"ingredient-subtext",children:["CSV: ",fe]})]}):i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx("div",{children:k.ingredientName}),le&&i.jsx("div",{className:"ingredient-subtext",children:le})]})}),i.jsx("td",{children:k.isEditing?i.jsx(xt,{type:"number",value:k.lastPrice,onChange:_e=>W(de,"lastPrice",_e.target.value),placeholder:": 500"}):`${parseFloat(k.lastPrice||0).toLocaleString()}`}),i.jsx("td",{children:k.isEditing?i.jsxs("div",{className:"input-with-hint",children:[i.jsx(xt,{type:"number",value:k.packetSize,onChange:_e=>W(de,"packetSize",_e.target.value),placeholder:["","","","PC","","",""].includes(k.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(k.packetUnit)&&i.jsxs("span",{className:"unit-hint",children:["1",k.packetUnit,"1"]})]}):k.packetSize}),i.jsx("td",{children:k.isEditing?i.jsxs("select",{value:k.packetUnit,onChange:_e=>W(de,"packetUnit",_e.target.value),className:"unit-select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"cc",children:"cc"})]}):k.packetUnit}),i.jsx("td",{className:"csv-unit-cell",children:k.isEditing?i.jsx(xt,{value:he(k.ingredientName),onChange:_e=>{const Me=(k.ingredientName??"").toString().trim(),Pe=_e.target.value;_(me=>({...me,[Me]:Pe}))},onBlur:_e=>V(k.ingredientName,_e.target.value),placeholder:L(k.ingredientName)==="-"?"":`CSV: ${L(k.ingredientName)}`}):i.jsx("span",{children:U(k.ingredientName)})}),i.jsx("td",{className:"normalized-cost",children:z(k)}),i.jsx("td",{children:Ne?k.isEditing?i.jsx(xt,{type:"number",value:k.yieldPercent??"",onChange:_e=>W(de,"yieldPercent",_e.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const _e=parseFloat(k.yieldPercent);if(!Number.isFinite(_e)||_e<=0)return"-";const Me=Math.round(_e*10)/10;return`${Number.isInteger(Me)?Math.round(Me):Me}%`})():i.jsx("span",{style:{color:"#999"},children:"-"})}),i.jsx("td",{children:i.jsx("div",{className:"action-buttons",children:k.isEditing?i.jsxs(i.Fragment,{children:[i.jsx(be,{variant:"primary",size:"sm",onClick:()=>F(de),children:""}),i.jsx(be,{variant:"ghost",size:"sm",onClick:()=>H(de),children:""})]}):i.jsxs(i.Fragment,{children:[i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>G(de),disabled:f!==null,children:""}),i.jsx(be,{variant:"ghost",size:"sm",onClick:()=>Q(de),disabled:f!==null,children:""})]})})})]},de)})})]})}),i.jsx("div",{className:"master-info",children:i.jsx("p",{children:" "})})]})},tu="__all_vendors__",Gx="__unknown_vendor__",Wl="__all_categories__",wf="food",ou=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],Pf=ou.reduce((n,t)=>(n[t.value]=t.label,n),{}),MN=new Set(["","","","","PC","","",""]),zi=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const s=Number(t);return Number.isFinite(s)?s:null},m0=n=>(typeof n=="string"?n.trim():"")||Gx,Ma=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?wf:Pf[t]?t:wf},zN=()=>{const[n,t]=w.useState([]),[s,l]=w.useState(!0),[c,u]=w.useState(null),[d,f]=w.useState(null),[p,g]=w.useState("all"),[y,v]=w.useState({key:null,direction:"asc"}),[x,S]=w.useState(""),[C,E]=w.useState(Wl),[_,T]=w.useState(tu),[D,B]=w.useState(!1),[P,$]=w.useState(null),j=w.useRef(null),M=Do(),[A,F]=w.useState({isOpen:!1,title:"",message:"",onConfirm:null}),Q=()=>{f(q=>!q||q.phase==="running"?q:null)};w.useEffect(()=>{G()},[]);const G=async()=>{l(!0),$(null);try{console.log("Starting data load for CsvToMasterImporter...");const[q,le]=await Promise.all([nr.getPriceListArray().catch(Ne=>(console.error("Error fetching price list:",Ne),[])),$n.getAllConversions().catch(Ne=>(console.error("Error fetching conversions:",Ne),new Map))]);if(console.log("Data fetched:",{csvCount:q?.length,masterSize:le?.size}),!Array.isArray(q))throw new Error("CSV");if(!(le instanceof Map))throw new Error("Map");const ge=[];for(const Ne of q){if(!Ne||!Ne.name)continue;const _e=le.get(Ne.name),Me=Ma(_e?.itemCategory),Pe=_e?.packetSize??"",me=_e?.packetUnit||Ne.unit||"",Qe=_e?.lastPrice??"",Xe=_e?Pe:MN.has(me)?1:"";ge.push({name:Ne.name,csvPrice:Ne.price,csvUnit:Ne.unit,csvVendor:Ne.vendor,masterCategory:Me,masterSize:Pe,masterUnit:me,masterPrice:Qe,isRegistered:!!_e,inputSize:Xe,inputUnit:me,inputPrice:_e?Qe:Ne.price??"",inputCategory:Me,isModified:!1})}console.log("Merge completed. Items:",ge.length),t(ge)}catch(q){console.error("Failed to load data for importer:",q),$(q.message||"")}finally{l(!1)}},H=async q=>{u(q.name);try{const le=zi(q.inputSize),ge=zi(q.inputPrice);if(le===null||le<=0){M.error("");return}if(!q.inputUnit){M.error("");return}if(!q.inputCategory){M.error("");return}await $n.saveConversion(q.name,le,q.inputUnit,ge,q.inputCategory),t(Ne=>Ne.map(_e=>_e.name===q.name?{..._e,isRegistered:!0,isModified:!1,masterSize:le,masterUnit:q.inputUnit,masterPrice:ge??"",masterCategory:q.inputCategory,inputCategory:q.inputCategory}:_e)),M.success("")}catch(le){console.error("Failed to save ingredient:",le),M.error("")}finally{u(null)}},W=async q=>{F(le=>({...le,isOpen:!1}));try{const le=q.filter(jt=>{const lt=zi(jt.inputSize);return!(lt!==null&&lt>0)||!jt.inputUnit||!jt.inputCategory});if(le.length>0){const jt=le.slice(0,5).map(ut=>ut.name).join(""),lt=le.length>5?` ${le.length-5}`:"";M.error(`: ${jt}${lt}`);return}u("bulk");const ge=q.length;f({phase:"running",total:ge,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const Ne=5,_e=120;let Me=0,Pe=0,me=0,Qe=0;const Xe=[],bt=[],Nt=(jt=!1,lt="")=>{const ut=Date.now();!jt&&ut-Qe<_e||(Qe=ut,f(Rt=>!Rt||Rt.phase!=="running"?Rt:{...Rt,processed:Me,success:Pe,failed:me,currentName:lt||Rt.currentName}))};let mt=0;const et=async()=>{for(;;){const jt=mt++;if(jt>=q.length)return;const lt=q[jt],ut=lt?.name?String(lt.name):"";try{const Rt=zi(lt.inputSize),Tn=zi(lt.inputPrice);if(Rt===null||Rt<=0)throw new Error("Invalid size");if(!lt.inputUnit)throw new Error("Invalid unit");if(!lt.inputCategory)throw new Error("Invalid category");await $n.saveConversion(lt.name,Rt,lt.inputUnit,Tn,lt.inputCategory),Pe++,Xe.push(lt)}catch(Rt){me++,bt.push(ut||`#${jt+1}`),console.error(`Failed to save ${ut}:`,Rt)}finally{Me++,Nt(!1,ut)}}},ct=Math.min(Ne,q.length);await Promise.all(Array.from({length:ct},()=>et())),Nt(!0);const wt=new Set(Xe.map(jt=>jt.name)),St=new Map(q.map(jt=>[jt.name,jt]));t(jt=>jt.map(lt=>{if(wt.has(lt.name)){const ut=St.get(lt.name);return{...lt,isRegistered:!0,isModified:!1,masterSize:zi(ut.inputSize)??"",masterUnit:ut.inputUnit,masterPrice:zi(ut.inputPrice)??"",masterCategory:ut.inputCategory,inputCategory:ut.inputCategory}}return lt})),me===0?M.success(`${Pe} `):M.warning(`:  ${Pe}  /  ${me} `),f({phase:"done",total:ge,processed:Me,success:Pe,failed:me,currentName:"",failedNames:bt.slice(0,10)})}catch(le){console.error("Bulk save error:",le),M.error(""),f(ge=>({phase:"error",total:ge?.total??q.length,processed:ge?.processed??0,success:ge?.success??0,failed:ge?.failed??0,currentName:"",failedNames:ge?.failedNames??[],errorMessage:le?.message?String(le.message):""}))}finally{u(null)}},z=()=>{const q=n.filter(le=>le.isModified);q.length!==0&&F({isOpen:!0,title:"",message:`${q.length} `,onConfirm:()=>W(q)})},I=(q,le,ge)=>{t(Ne=>Ne.map(_e=>_e.name===q?{..._e,[le]:ge,isModified:!0}:_e))},N=q=>{(q.key==="ArrowUp"||q.key==="ArrowDown")&&q.preventDefault()},L=q=>{v(le=>le.key===q?{key:q,direction:le.direction==="asc"?"desc":"asc"}:{key:q,direction:"asc"})},K=q=>y.key!==q?"":y.direction==="asc"?" ":" ",oe=w.useMemo(()=>{const q=new Map;n.forEach(ge=>{const Ne=m0(ge.csvVendor),_e=Ne===Gx?"":Ne,Me=q.get(Ne);Me?Me.count+=1:q.set(Ne,{key:Ne,label:_e,count:1})});const le=Array.from(q.values()).sort((ge,Ne)=>ge.label.localeCompare(Ne.label,"ja"));return[{key:tu,label:"",count:n.length},...le]},[n]);w.useEffect(()=>{oe.some(le=>le.key===_)||T(tu)},[oe,_]),w.useEffect(()=>{if(!D)return;const q=ge=>{j.current&&!j.current.contains(ge.target)&&B(!1)},le=ge=>{ge.key==="Escape"&&B(!1)};return document.addEventListener("mousedown",q),document.addEventListener("touchstart",q),document.addEventListener("keydown",le),()=>{document.removeEventListener("mousedown",q),document.removeEventListener("touchstart",q),document.removeEventListener("keydown",le)}},[D]);const he=w.useMemo(()=>_===tu?n:n.filter(q=>m0(q.csvVendor)===_),[n,_]),U=w.useMemo(()=>{const q={[Wl]:he.length};return ou.forEach(le=>{q[le.value]=0}),he.forEach(le=>{const ge=Ma(le.inputCategory);q[ge]=(q[ge]||0)+1}),q},[he]),V=w.useMemo(()=>C===Wl?he:he.filter(q=>Ma(q.inputCategory)===C),[he,C]),k=w.useMemo(()=>({all:V.length,unregistered:V.filter(q=>!q.isRegistered).length,registered:V.filter(q=>q.isRegistered).length}),[V]),te=w.useMemo(()=>oe.find(q=>q.key===_)||oe[0],[oe,_]),de=w.useMemo(()=>V.filter(q=>!(p==="unregistered"&&q.isRegistered||p==="registered"&&!q.isRegistered||x&&!q.name.includes(x))),[V,p,x]),fe=w.useMemo(()=>{if(!y.key)return de;const q=Ne=>String(Ne??""),le=Ne=>{const _e=parseFloat(Ne);return Number.isFinite(_e)?_e:Number.NEGATIVE_INFINITY},ge=[...de];return ge.sort((Ne,_e)=>{let Me=0;switch(y.key){case"name":Me=q(Ne.name).localeCompare(q(_e.name),"ja");break;case"csvPrice":Me=le(Ne.csvPrice)-le(_e.csvPrice);break;case"inputCategory":{const Pe=Pf[Ma(Ne.inputCategory)]||"",me=Pf[Ma(_e.inputCategory)]||"";Me=Pe.localeCompare(me,"ja");break}case"inputSize":Me=le(Ne.inputSize)-le(_e.inputSize);break;case"inputUnit":Me=q(Ne.inputUnit).localeCompare(q(_e.inputUnit),"ja");break;case"inputPrice":Me=le(Ne.inputPrice)-le(_e.inputPrice);break;default:Me=0;break}return Me===0&&(Me=q(Ne.name).localeCompare(q(_e.name),"ja")),y.direction==="asc"?Me:-Me}),ge},[de,y]),J=n.filter(q=>q.isModified).length;return s?i.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):P?i.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[i.jsx("h3",{children:""}),i.jsx("p",{children:P}),i.jsx(be,{variant:"secondary",onClick:G,children:""})]}):i.jsxs("div",{className:"csv-importer",children:[i.jsxs("div",{className:"importer-header",children:[i.jsx(xt,{placeholder:"...",value:x,onChange:q=>S(q.target.value),style:{maxWidth:"300px"}}),i.jsxs("div",{className:"filter-buttons",children:[i.jsxs(be,{variant:p==="all"?"primary":"secondary",onClick:()=>g("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",k.all,")"]}),i.jsxs(be,{variant:p==="unregistered"?"primary":"secondary",onClick:()=>g("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",k.unregistered,")"]}),i.jsxs(be,{variant:p==="registered"?"primary":"secondary",onClick:()=>g("registered"),size:"sm",children:[" (",k.registered,")"]})]}),i.jsxs("div",{className:"vendor-dropdown",ref:j,children:[i.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>B(q=>!q),"aria-haspopup":"listbox","aria-expanded":D,children:[i.jsxs("span",{children:[": ",te?.label," (",te?.count??0,")"]}),i.jsx("span",{className:`vendor-dropdown-chevron ${D?"open":""}`,children:""})]}),D&&i.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:oe.map(q=>i.jsxs("button",{type:"button",className:`vendor-tab ${_===q.key?"active":""}`,onClick:()=>{T(q.key),B(!1)},role:"option","aria-selected":_===q.key,children:[q.label," (",q.count,")"]},q.key))})]}),i.jsxs("div",{className:"category-filter-row",children:[i.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),i.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:C,onChange:q=>E(q.target.value),children:[i.jsxs("option",{value:Wl,children:[" (",U[Wl]||0,")"]}),ou.map(q=>i.jsxs("option",{value:q.value,children:[q.label," (",U[q.value]||0,")"]},q.value))]})]}),i.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[J>0&&i.jsx(be,{variant:"primary",size:"sm",onClick:z,disabled:c!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:c==="bulk"?"...":`(${J})`}),i.jsx(be,{variant:"secondary",size:"sm",onClick:G,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{style:{width:"22%"},onClick:()=>L("name"),children:[" (CSV)",K("name")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>L("csvPrice"),children:[" (CSV)",K("csvPrice")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>L("inputCategory"),children:[" ",i.jsx("span",{style:{color:"red"},children:"*"}),K("inputCategory")]}),i.jsxs("th",{style:{width:"18%"},onClick:()=>L("inputSize"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),K("inputSize")]}),i.jsxs("th",{style:{width:"13%"},onClick:()=>L("inputUnit"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),K("inputUnit")]}),i.jsxs("th",{style:{width:"12%"},onClick:()=>L("inputPrice"),children:[" ()",K("inputPrice")]}),i.jsx("th",{style:{width:"7%"},children:""})]})}),i.jsx("tbody",{children:fe.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:""})}):fe.map(q=>i.jsxs("tr",{style:{backgroundColor:q.isModified?"#fff8e1":q.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[i.jsxs("td",{style:{fontWeight:"500"},children:[q.name,q.csvVendor&&i.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:q.csvVendor})]}),i.jsxs("td",{children:[q.csvPrice?`${q.csvPrice.toLocaleString()} `:"-",q.csvUnit&&i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",q.csvUnit]})]}),i.jsx("td",{children:i.jsx("select",{className:"input-field",value:Ma(q.inputCategory),onChange:le=>I(q.name,"inputCategory",le.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:ou.map(le=>i.jsx("option",{value:le.value,children:le.label},le.value))})}),i.jsx("td",{children:i.jsx(xt,{type:"number",value:q.inputSize,onChange:le=>I(q.name,"inputSize",le.target.value),onKeyDown:N,placeholder:["","","","PC","","",""].includes(q.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),i.jsx("td",{children:i.jsxs("select",{className:"input-field",value:q.inputUnit,onChange:le=>I(q.name,"inputUnit",le.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","","","","","PC","","",""].includes(q.inputUnit)&&q.inputUnit&&i.jsxs("option",{value:q.inputUnit,children:[q.inputUnit," (CSV)"]}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"kg",children:"kg"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"L",children:"L"}),i.jsx("option",{value:"cc",children:"cc"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"PC",children:"PC"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""})]})}),i.jsx("td",{children:i.jsx(xt,{type:"number",value:q.inputPrice,onChange:le=>I(q.name,"inputPrice",le.target.value),placeholder:"",style:{width:"100%"}})}),i.jsx("td",{children:i.jsx(be,{variant:q.isRegistered?"secondary":"primary",size:"sm",onClick:()=>H(q),disabled:c===q.name||c==="bulk",block:!0,children:c===q.name?"...":q.isRegistered?"":""})})]},q.name))})]})}),i.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[i.jsx("p",{children:" CSV"}),i.jsx("p",{children:" "})]}),i.jsxs(Jn,{isOpen:A.isOpen,onClose:()=>F({...A,isOpen:!1}),title:A.title,size:"small",children:[i.jsx("div",{style:{marginBottom:"1.5rem"},children:A.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[i.jsx(be,{variant:"secondary",onClick:()=>F({...A,isOpen:!1}),children:""}),i.jsx(be,{variant:"primary",onClick:A.onConfirm,children:""})]})]}),i.jsx(Jn,{isOpen:!!d,onClose:Q,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?i.jsxs("div",{className:"bulk-progress",children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:""}),i.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),i.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&i.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&i.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),i.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[i.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(be,{variant:"primary",onClick:Q,children:""})})]}):i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),i.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(be,{variant:"primary",onClick:Q,children:""})})]})})]})},g0=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},UN=({onBack:n})=>{const[t,s]=Kf(),[l,c]=w.useState("price"),[u,d]=w.useState(null),[f,p]=w.useState({type:"",message:""}),[g,y]=w.useState(!1),[v,x]=w.useState([]),[S,C]=w.useState(!1),[E,_]=w.useState(null),[T,D]=w.useState(!1),[B,P]=w.useState(new Map),[$,j]=w.useState([]),[M,A]=w.useState(""),[F,Q]=w.useState(""),[G,H]=w.useState(""),W=Ae.useMemo(()=>{if(!M)return[];const J=B.get(M)||[],q=new Set;return J.forEach(le=>{const ge=g0(le?.dateStr);ge&&q.add(ge)}),Array.from(q).sort((le,ge)=>ge.localeCompare(le))},[B,M]);w.useEffect(()=>{if(G){if(!M){H("");return}W.length>0&&!W.includes(G)&&H("")}},[W,G,M]);const[z,I]=w.useState({key:"dateStr",direction:"desc"}),[N,L]=w.useState("");w.useEffect(()=>{const J=t.get("tab");(J==="price"||J==="ingredients"||J==="csv-import"||J==="duplicates")&&c(J)},[]);const K=J=>{let q="asc";z.key===J&&z.direction==="asc"&&(q="desc"),I({key:J,direction:q})},oe=Ae.useMemo(()=>{let J=[...v];if(N){const q=N.toLowerCase().trim();J=J.filter(le=>le.name&&le.name.toLowerCase().includes(q)||le.vendor&&le.vendor.toLowerCase().includes(q)||le.dateStr&&le.dateStr.includes(q))}return z.key&&J.sort((q,le)=>{let ge=q[z.key]||"",Ne=le[z.key]||"";return ge<Ne?z.direction==="asc"?-1:1:ge>Ne?z.direction==="asc"?1:-1:0}),J},[v,z,N]),[he,U]=w.useState([]);w.useEffect(()=>{k()},[]);const V=async()=>{D(!0);try{const q=await nr.fetchPriceHistory()||new Map;P(q);const le=[];for(const[ge,Ne]of q.entries()){const _e=new Set,Me=[];if((Ne||[]).forEach(et=>{const ct=[String(et?.dateStr||""),String(et?.price??""),String(et?.incomingQty??""),String(et?.unit||""),String(et?.vendor||""),String(et?.displayName||"")].join("|");_e.has(ct)||(_e.add(ct),Me.push(et))}),Me.length<2)continue;Me.sort((et,ct)=>String(et?.dateStr||"").localeCompare(String(ct?.dateStr||"")));const Pe=Me[Me.length-1]||{},me=Me.map(et=>Number(et?.price)).filter(et=>Number.isFinite(et)),Qe=me.length?Math.min(...me):null,Xe=me.length?Math.max(...me):null,bt=new Set(Me.map(et=>String(et?.dateStr||""))).size,Nt=new Set(Me.map(et=>String(et?.displayName||""))).size;let mt=0;for(let et=1;et<Me.length;et++){const ct=Number(Me[et-1]?.price),wt=Number(Me[et]?.price);Number.isFinite(ct)&&Number.isFinite(wt)&&ct!==wt&&mt++}le.push({key:ge,name:Pe?.displayName||ge,lastDate:Pe?.dateStr||"",lastPrice:Number.isFinite(Number(Pe?.price))?Number(Pe?.price):null,lastIncomingQty:Number.isFinite(Number(Pe?.incomingQty))?Number(Pe?.incomingQty):null,unit:Pe?.unit||"",vendor:Pe?.vendor||"",rows:Me.length,dates:bt,nameVariants:Nt,minPrice:Qe,maxPrice:Xe,changes:mt})}le.sort((ge,Ne)=>{const _e=String(ge?.lastDate||""),Me=String(Ne?.lastDate||"");return _e!==Me?Me.localeCompare(_e):(Ne?.changes||0)!==(ge?.changes||0)?(Ne?.changes||0)-(ge?.changes||0):(Ne?.rows||0)!==(ge?.rows||0)?(Ne?.rows||0)-(ge?.rows||0):String(ge?.name||"").localeCompare(String(Ne?.name||""),"ja")}),j(le),M&&!q.has(M)&&A("")}catch(J){console.error(J)}finally{D(!1)}};w.useEffect(()=>{l==="duplicates"&&V()},[l]);const k=async()=>{C(!0);try{const J=await nr.getPriceListArray();x(J);const q=await nr.getFileList();U(q)}catch(J){console.error("Failed to load price data",J)}finally{C(!1)}},te=J=>{J.target.files&&J.target.files[0]&&(d(J.target.files[0]),p({type:"",message:""}))},de=async()=>{if(!u)return;y(!0),p({type:"info",message:"..."});const J=await nr.uploadPriceList(u);if(J.success){p({type:"success",message:"..."});try{const{recipeService:le}=await bf(async()=>{const{recipeService:_e}=await Promise.resolve().then(()=>rf);return{recipeService:_e}},[]),ge=await nr.fetchPriceList(),Ne=await le.updateRecipeCosts(ge);p({type:"success",message:`${Ne}`})}catch(le){console.error("Cost update failed",le),p({type:"warning",message:""})}d(null);const q=document.getElementById("csv-upload-input");q&&(q.value=""),k()}else p({type:"error",message:`: ${J.error.message}`});y(!1)},fe=J=>{_({message:`${J}
`,onConfirm:async()=>{y(!0);const q=await nr.deletePriceFile(J);y(!1),q.success?(p({type:"success",message:""}),k()):p({type:"error",message:`: ${q.error.message}`})}})};return i.jsxs("div",{className:["dashboard-container","fade-in",l==="ingredients"||l==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[i.jsxs("div",{className:"dashboard-header",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),i.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[l==="csv-import"&&i.jsx(be,{variant:"secondary",onClick:()=>s({view:"inventory"}),title:"",children:" "}),i.jsx(be,{variant:"ghost",onClick:n,children:" "})]})]}),i.jsx("div",{className:"tabs-container",children:i.jsxs("div",{className:"tabs",children:[i.jsx("button",{className:`tab ${l==="price"?"active":""}`,onClick:()=>c("price"),children:" "}),i.jsx("button",{className:`tab ${l==="ingredients"?"active":""}`,onClick:()=>c("ingredients"),children:" "}),i.jsx("button",{className:`tab ${l==="csv-import"?"active":""}`,onClick:()=>c("csv-import"),children:" CSV"}),i.jsx("button",{className:`tab ${l==="duplicates"?"active":""}`,onClick:()=>c("duplicates"),children:" "})]})}),l==="ingredients"?i.jsx(DN,{}):l==="csv-import"?i.jsx(zN,{}):l==="duplicates"?i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[$.length.toLocaleString(),""]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[i.jsx(xt,{placeholder:"...",value:F,onChange:J=>Q(J.target.value),style:{flex:1,fontSize:"0.9rem"}}),i.jsx(be,{variant:"secondary",size:"sm",onClick:V,disabled:T,title:"",children:""})]}),i.jsx("div",{className:"dup-list",children:T?i.jsx("div",{className:"dup-empty",children:"..."}):$.length===0?i.jsx("div",{className:"dup-empty",children:"2"}):$.filter(J=>{const q=String(F||"").trim();return q?String(J?.name||"").includes(q):!0}).map(J=>{const q=J.key===M,le=J.minPrice!==null&&J.maxPrice!==null&&J.minPrice!==J.maxPrice;return i.jsxs("button",{type:"button",className:`dup-item ${q?"active":""}`,onClick:()=>A(J.key),children:[i.jsxs("div",{className:"dup-item-top",children:[i.jsx("div",{className:"dup-item-name",title:J.name,children:J.name}),le&&i.jsx("span",{className:"dup-badge",children:""})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[": ",J.lastDate||"-"]}),i.jsxs("span",{children:[": ",J.rows,""]}),i.jsxs("span",{children:[": ",J.dates,""]})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[J.lastPrice!==null?`${Math.round(J.lastPrice).toLocaleString()}`:"-",J.unit?` / ${J.unit}`:""]}),i.jsxs("span",{children:[": ",J.lastIncomingQty!==null?Math.round(J.lastIncomingQty).toLocaleString():"-"]}),J.vendor?i.jsxs("span",{title:J.vendor,children:[": ",J.vendor]}):i.jsx("span",{children:": -"})]}),J.nameVariants>1&&i.jsxs("div",{className:"dup-item-note",children:[": ",J.nameVariants,""]})]},J.key)})})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:M?"":""})}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsxs("select",{value:G,onChange:J=>H(J.target.value),disabled:!M,title:M?"":"",className:"dup-month-select",children:[i.jsx("option",{value:"",children:""}),W.map(J=>i.jsx("option",{value:J,children:J.replace("-","/")},J))]}),i.jsx(be,{variant:"secondary",size:"sm",onClick:V,disabled:T,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:(()=>{if(!M)return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const J=B.get(M)||[],q=new Set,le=[];J.forEach(me=>{const Qe=[String(me?.dateStr||""),String(me?.price??""),String(me?.incomingQty??""),String(me?.unit||""),String(me?.vendor||""),String(me?.displayName||""),String(me?.sourceFile||"")].join("|");q.has(Qe)||(q.add(Qe),le.push(me))}),le.sort((me,Qe)=>String(me?.dateStr||"").localeCompare(String(Qe?.dateStr||"")));const ge=G?le.filter(me=>g0(me?.dateStr)===G):le,Ne=ge.map((me,Qe)=>{const Xe=Qe>0?ge[Qe-1]:null,bt=Xe?Number(Xe?.price):NaN,Nt=Number(me?.price);let mt=null,et=null;return Number.isFinite(bt)&&Number.isFinite(Nt)&&(mt=Nt-bt,et=bt!==0?mt/bt*100:null),{...me,_diff:mt,_pct:et}}),_e=ge.reduce((me,Qe)=>{const Xe=Number(Qe?.incomingQty);return me+(Number.isFinite(Xe)?Xe:0)},0),Me=ge.reduce((me,Qe)=>{const Xe=Number(Qe?.incomingQty),bt=Number(Qe?.price);return!Number.isFinite(Xe)||!Number.isFinite(bt)?me:me+Xe*bt},0),Pe=[...Ne].reverse();return i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"120px"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),i.jsx("tbody",{children:Pe.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:G?`${G}`:""})}):Pe.map((me,Qe)=>{const Xe=me?._diff,bt=me?._pct,Nt=Xe==null||!Number.isFinite(Xe)?"-":`${Xe>=0?"+":""}${Math.round(Xe).toLocaleString()}`,mt=bt==null||!Number.isFinite(bt)?"":` (${bt>=0?"+":""}${bt.toFixed(1)}%)`,et=Xe==null||!Number.isFinite(Xe)?"#888":Xe>0?"#c92a2a":Xe<0?"#2b8a3e":"#666",ct=Number(me?.price),wt=Number.isFinite(ct)?`${Math.round(ct).toLocaleString()}`:"-",St=Number(me?.incomingQty),jt=Number.isFinite(St)?Math.round(St).toLocaleString():"-",lt=Number.isFinite(St)&&Number.isFinite(ct)?St*ct:NaN,ut=Number.isFinite(lt)?`${Math.round(lt).toLocaleString()}`:"-";return i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:me?.dateStr||"-"}),i.jsx("td",{children:me?.vendor||"-"}),i.jsx("td",{style:{fontWeight:500},children:me?.displayName||"-"}),i.jsx("td",{className:"col-number",children:jt}),i.jsxs("td",{className:"col-number",children:[wt,me?.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",me.unit]})]}),i.jsx("td",{className:"col-number",children:ut}),i.jsxs("td",{className:"col-number",style:{color:et},children:[Nt,mt]})]},`${me?.dateStr||"d"}-${Qe}`)})}),Pe.length>0&&i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",G?`${G}`:""]}),i.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(_e).toLocaleString()}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),i.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(Me).toLocaleString()]}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[i.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),i.jsx(be,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const J=await bf(()=>Promise.resolve().then(()=>rf),void 0).then(Ne=>Ne.recipeService.exportAllRecipes()),q=new Blob([JSON.stringify(J,null,2)],{type:"application/json"}),le=URL.createObjectURL(q),ge=document.createElement("a");ge.href=le,ge.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),URL.revokeObjectURL(le)}catch(J){alert(""),console.error(J)}},children:" JSON"})]}),i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),i.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:async J=>{const q=J.target.files[0];if(q){if(!window.confirm(`
`)){J.target.value="";return}try{p({type:"info",message:"..."}),y(!0);const le=await q.text(),ge=JSON.parse(le),{recipeService:Ne}=await bf(async()=>{const{recipeService:Me}=await Promise.resolve().then(()=>rf);return{recipeService:Me}},void 0),_e=await Ne.importRecipes(ge);alert(`${_e.count}${_e.errors.length>0?`
: ${_e.errors.length}`:""}`),p({type:"success",message:""})}catch(le){console.error(le),alert(""),p({type:"error",message:""})}finally{y(!1),J.target.value=""}}}}),i.jsx(be,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:g,children:" "})]})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{className:"upload-area",children:[i.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",i.jsx("br",{}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",i.jsx("br",{})," 2: "]})]}),i.jsx("input",{type:"file",accept:".csv",onChange:te,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),i.jsx(be,{variant:"primary",onClick:de,disabled:!u||g,className:"upload-btn",size:"sm",block:!0,children:g?"...":""})]}),f.message&&i.jsx("div",{className:`status-msg ${f.type}`,children:f.message})]}),i.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[he.length,""]})]}),he.length===0?i.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):i.jsx("div",{className:"file-list",children:he.map(J=>i.jsxs("div",{className:"file-list-item",children:[i.jsx("span",{className:"file-name",title:J.name,children:J.name}),i.jsx(be,{variant:"danger",size:"sm",onClick:()=>fe(J.name),disabled:g,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},J.name))})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:" "}),i.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",oe.length.toLocaleString()," "]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsx(xt,{placeholder:" (, , )...",value:N,onChange:J=>L(J.target.value),style:{width:"250px",fontSize:"0.9rem"}}),i.jsx(be,{variant:"secondary",size:"sm",onClick:k,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:S?i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{onClick:()=>K("dateStr"),style:{width:"120px"},children:[" ",z.key==="dateStr"&&(z.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>K("vendor"),children:[" ",z.key==="vendor"&&(z.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>K("name"),children:[" ",z.key==="name"&&(z.direction==="asc"?"":"")]}),i.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),i.jsx("tbody",{children:oe.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",className:"no-data",children:""})}):oe.map((J,q)=>i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:J.dateStr||"-"}),i.jsx("td",{children:J.vendor||"-"}),i.jsx("td",{style:{fontWeight:"500"},children:J.name}),i.jsxs("td",{className:"col-number",children:[J.price?J.price.toLocaleString():"-",J.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",J.unit]})]})]},q))})]})})]})]}),E&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>_(null),children:i.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:J=>J.stopPropagation(),children:[i.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),i.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:E.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx(be,{variant:"ghost",onClick:()=>_(null),children:""}),i.jsx(be,{variant:"danger",onClick:()=>{E.onConfirm(),_(null)},children:""})]})]})})]})},LN=({recipes:n,recentIds:t,onSelect:s})=>{if(!t||t.length===0)return null;const l=t.map(c=>n.find(u=>u.id===c)).filter(Boolean).slice(0,7);return l.length===0?null:i.jsxs("div",{className:"recent-recipes",children:[i.jsx("h3",{className:"recent-header",children:""}),i.jsx("div",{className:"recent-list",children:l.map(c=>i.jsxs("div",{className:"recent-item",onClick:()=>s(c),children:[i.jsx("div",{className:"recent-thumbnail",children:c.image?i.jsx("img",{src:c.image,alt:c.title}):i.jsx("div",{className:"recent-placeholder"})}),i.jsx("div",{className:"recent-info",children:i.jsx("div",{className:"recent-title",children:c.title})})]},c.id))})]})},BN=({onBack:n})=>(w.useEffect(()=>{window.scrollTo(0,0)},[]),i.jsxs("div",{className:"levain-guide-container",children:[i.jsxs("header",{className:"levain-guide-header",children:[i.jsx("h1",{children:"LEVAIN GUIDE"}),i.jsx("p",{className:"subtitle",children:" "}),i.jsx("p",{className:"subtitle",children:""}),i.jsx("div",{className:"divider"})]}),i.jsxs("main",{className:"levain-guide-main",children:[i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("p",{children:"Levain"}),i.jsx("h3",{children:""}),i.jsx("p",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",i.jsx("br",{}),i.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",i.jsx("br",{}),i.jsx("strong",{children:""})," Acetobacter aceti "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:["",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",i.jsx("br",{}),"(   +  + )"]}),"",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHO",i.jsx("br",{}),"(  )"]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"- 7-10"}),i.jsxs("div",{className:"timeline",children:[i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),i.jsx("p",{children:"100g + 100ml 20-22"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsx("p",{children:"100g  50g50g + 50ml"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsxs("div",{className:"success-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),i.jsx("p",{children:"1150%1:1"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 15",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," pH 3.5-4.0"]})]})]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:"(ml)"}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"2"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"5-8"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-4"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"15-18"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"3-5"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25-28"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-3"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"30"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"1"}),i.jsx("br",{}),"100g50g + 50ml"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"8-12"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"2%100ml2g"}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 12 8:00"}),i.jsx("br",{}),"50g25g + 25ml "]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  14:00"}),i.jsx("br",{}),"25g + 25ml 2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  20:00"}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:" "})," ",i.jsx("br",{}),"",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:" "})," pH",i.jsx("br",{}),"pH 3.5-4.0pH"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"18"}),i.jsx("td",{children:"16-24"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"12-16"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"24-26"}),i.jsx("td",{children:"8-12"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"28"}),i.jsx("td",{children:"4-8"}),i.jsx("td",{children:"2"})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"1"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 22",i.jsx("br",{}),"2. 12",i.jsx("br",{}),"3. 1",i.jsx("br",{}),"4. 1-2"]}),i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," pH",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," "]}),i.jsx("h3",{children:"3"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. 15",i.jsx("br",{}),"3. 80%"]}),i.jsx("h3",{children:"4"}),i.jsxs("div",{className:"success-box",children:["",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:"5"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 1:0.8",i.jsx("br",{}),"2. ",i.jsx("br",{}),"3. "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"pH"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"pH4-8.0"}),i.jsx("br",{}),i.jsx("br",{})," pH 7.0",i.jsx("br",{})," pH 4.5-5.5",i.jsx("br",{})," pH 3.5-4.0",i.jsx("br",{})," pH 3.0"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:"pH 3.8-4.0"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 3.5"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 4.5"})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 1",i.jsx("br",{})," ",i.jsx("br",{})," -203"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"15-20"}),i.jsx("td",{children:"18-20"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25+"}),i.jsx("td",{children:"22-24"}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"18-22"}),i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"5-15"}),i.jsx("td",{children:"18"}),i.jsx("td",{children:"2-3"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 24",i.jsx("br",{})," ",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 18",i.jsx("br",{})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"100g + 50g + 150ml 12-24",i.jsx("br",{}),"11-2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"100ml"}),i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," pH3.5-4.0",i.jsx("br",{})," 0.5-1.5%",i.jsx("br",{})," 0.3-0.8%"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"15-25% ()"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"5-15%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"20-30%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"30-50%"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"formula",children:[" 18   - 8",i.jsx("br",{}),i.jsx("br",{}),"",i.jsx("br",{})," 2018  (20-8) = 1.5",i.jsx("br",{})," 2418  (24-8) = 1.125",i.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),i.jsxs("footer",{className:"levain-footer",children:[i.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),i.jsx("p",{children:""})]}),i.jsxs("button",{className:"levain-back-button",onClick:n,children:[i.jsx("span",{children:""})," "]})]})),IN=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},no={async fetchAllProfiles(){const n=await Te.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await Te.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const l=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let c=null;if(l)try{const{data:d,error:f}=await Te.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(f)throw f;if(d){const p=IN(d);if(p)return p}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),c=d}const u=await Te.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(c&&l)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${c.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await Te.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminResetPassword(n,t){const{data:s,error:l}=await Te.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(l)throw l;if(s?.error)throw new Error(s.error);return s},async sendPasswordResetEmail(n){const{error:t}=await Te.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(t)throw t;return!0}},$N=({onBack:n})=>{const{user:t,patchCurrentUserProfile:s}=fi(),[l,c]=w.useState([]),[u,d]=w.useState(!0),[f,p]=w.useState(null),[g,y]=w.useState(null),[v,x]=w.useState(""),[S,C]=w.useState(""),[E,_]=w.useState(""),[T,D]=w.useState(""),[B,P]=w.useState(!1),[$,j]=w.useState(!1),[M,A]=w.useState(new Set);w.useEffect(()=>{F()},[]);const F=async()=>{try{d(!0);const I=await no.fetchAllProfiles();c(I)}catch(I){console.error(I),p("")}finally{d(!1)}},Q=l.filter(I=>I.role==="admin"),G=l.filter(I=>I.role!=="admin"),H=(I,N)=>{A(L=>{const K=new Set(L);return N?K.add(I):K.delete(I),K})},W=async(I,N)=>{const L=!!I.show_master_recipes;p(null),c(K=>K.map(oe=>oe.id===I.id?{...oe,show_master_recipes:N}:oe)),I.id===t?.id&&s?.({showMasterRecipes:N}),H(I.id,!0);try{const oe=!!(await no.updateProfile(I.id,{show_master_recipes:N}))?.show_master_recipes;c(he=>he.map(U=>U.id===I.id?{...U,show_master_recipes:oe}:U)),I.id===t?.id&&s?.({showMasterRecipes:oe})}catch(K){console.error(K),c(oe=>oe.map(he=>he.id===I.id?{...he,show_master_recipes:L}:he)),I.id===t?.id&&s?.({showMasterRecipes:L}),p("RLS")}finally{H(I.id,!1)}},z=({user:I,isAdmin:N})=>i.jsxs(fn,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[I.display_id," ",N&&i.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),I.email&&i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:I.email}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date(I.created_at).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",I.updated_at?new Date(I.updated_at).toLocaleString():"---"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:I.show_master_recipes||!1,disabled:M.has(I.id),onChange:L=>W(I,L.target.checked)}),""]}),i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>{y({id:I.id,display_id:I.display_id,email:I.email}),x(""),C(""),_(""),D("")},style:{whiteSpace:"nowrap"},children:""})]})]},I.id);return i.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",height:"100%",overflowY:"auto"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[i.jsx("h2",{children:""}),i.jsx(be,{variant:"ghost",onClick:n,children:""})]}),f&&i.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:f}),u?i.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[Q.length>0&&i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:Q.map(I=>i.jsx(z,{user:I,isAdmin:!0},I.id))})]}),i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:G.length>0?G.map(I=>i.jsx(z,{user:I,isAdmin:!1},I.id)):i.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),i.jsx(Jn,{isOpen:!!g,onClose:()=>{B||y(null)},title:": ",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[i.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",g?.display_id||g?.email||g?.id]}),g?.email&&i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:g.email}),i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),E&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:E}),T&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:T}),i.jsxs("div",{style:{display:"grid",gap:"10px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:v,onChange:I=>x(I.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:S,onChange:I=>C(I.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[i.jsx(be,{variant:"ghost",onClick:()=>y(null),disabled:B,children:""}),i.jsx(be,{variant:"secondary",isLoading:$,disabled:!g?.email||B,onClick:async()=>{if(_(""),D(""),!g?.email){_("");return}j(!0);try{await no.sendPasswordResetEmail(g.email),D("")}catch(I){console.error(I),_(I?.message||"")}finally{j(!1)}},style:{whiteSpace:"nowrap"},children:""}),i.jsx(be,{variant:"danger",isLoading:B,onClick:async()=>{if(_(""),D(""),!!g?.id){if(!v||v.length<8){_("8");return}if(v!==S){_("");return}P(!0);try{await no.adminResetPassword(g.id,v),D(""),x(""),C("")}catch(I){console.error(I);const N=I?.message||"";/FunctionsHttpError|not found|404/i.test(N)||/admin-reset-password/i.test(N)?_(""):_(N)}finally{P(!1)}}},children:""})]})]})})]})},_s="inventory_items",Ui="inventory_snapshots",Xl="deleted_inventory_snapshots",za=(n,t)=>{const s=String(n?.message||"");return String(n?.code||"")==="42703"?s.toLowerCase().includes(String(t).toLowerCase()):s.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&s.toLowerCase().includes("does not exist")},Kn={getAll:async n=>{if(!n)return[];const{data:t,error:s}=await Te.from(_s).select("*").eq("user_id",n).order("created_at",{ascending:!0});return s?(console.error("Error fetching inventory:",s),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:s,isPhantom:l,_master:c,_csv:u,...d}=t,f=t?.tax10_override??t?.tax10Override,p={...d,user_id:n,tax10:!!t.tax10,tax10_override:!!f,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0},g=async x=>Te.from(_s).insert([x]).select().single();let{data:y,error:v}=await g(p);if(v){const x=za(v,"tax10"),S=za(v,"tax10_override");if(x||S){const C={...p};x&&delete C.tax10,S&&delete C.tax10_override,{data:y,error:v}=await g(C)}}if(v)throw console.error("Error adding item:",v),v;return y},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:s,isPhantom:l,created_at:c,_master:u,_csv:d,...f}=t,p=t?.tax10_override??t?.tax10Override,g={...f,tax10:!!t.tax10,tax10_override:!!p,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()},y=async S=>Te.from(_s).update(S).eq("id",t.id).eq("user_id",n).select().single();let{data:v,error:x}=await y(g);if(x){const S=za(x,"tax10"),C=za(x,"tax10_override");if(S||C){const E={...g};S&&delete E.tax10,C&&delete E.tax10_override,{data:v,error:x}=await y(E)}}if(x)throw console.error("Error updating item:",x),x;return v},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:s}=await Te.from(_s).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error deleting item:",s),s},adjustStock:async(n,t,s)=>{if(!n)throw new Error("User ID is required");const{data:l,error:c}=await Te.from(_s).select("quantity").eq("id",t).eq("user_id",n).single();if(c||!l)throw new Error("Item not found");const u=Math.max(0,(l.quantity||0)+s),{data:d,error:f}=await Te.from(_s).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(f)throw f;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await Te.from(_s).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:s}=await Te.from("ignored_items").select("name").eq("user_id",n);return s?(console.error("Error fetching ignored items:",s),new Set):new Set(t.map(l=>l.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:s}=await Te.from("ignored_items").insert([{user_id:n,name:t}]).select();if(s&&s.code!=="23505")throw console.error("Error ignoring item:",s),s},getSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await Te.from(Ui).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return s?(console.error("Error fetching snapshots:",s),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await Te.from(Xl).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return s?(console.error("Error fetching deleted snapshots:",s),[]):t||[]},createSnapshot:async(n,t,s,l)=>{if(!n)throw new Error("User ID is required");let c=null,u=null;const d=await Te.from(Ui).insert([{user_id:n,title:t,items:s,total_value:l,snapshot_date:new Date().toISOString()}]).select().single();if(c=d.data??null,u=d.error??null,u&&za(u,"user_id")){const f=await Te.from(Ui).insert([{title:t,items:s,total_value:l,snapshot_date:new Date().toISOString()}]).select().single();c=f.data??null,u=f.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return c},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:s,error:l}=await Te.from(Ui).select("*").eq("id",t).eq("user_id",n).single();if(l||!s)throw console.error("Error fetching snapshot for delete:",l),l||new Error("Snapshot not found");const{error:c}=await Te.from(Xl).insert([{original_id:s.id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at,deleted_at:new Date().toISOString()}]);if(c)throw console.error("Error moving snapshot to trash:",c),c;const{error:u}=await Te.from(Ui).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:s,error:l}=await Te.from(Xl).select("*").eq("id",t).eq("user_id",n).single();if(l||!s)throw console.error("Error fetching deleted snapshot:",l),l||new Error("Deleted snapshot not found");let c=null;{const{error:d}=await Te.from(Ui).insert([{id:s.original_id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);c=d}if(c){const{error:d}=await Te.from(Ui).insert([{user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await Te.from(Xl).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:s}=await Te.from(Xl).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error hard deleting snapshot from trash:",s),s;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await Te.from(_s).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(za(t.error,"user_id")){const s=await Te.from(_s).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(s.error)throw console.error("Error resetting quantities (fallback):",s.error),s.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},$i=n=>{const t=String(n??"").trim();if(!t)return"";const s=t.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s},qN=(n,t)=>{const s=$i(n),l=$i(t);if(!s||!l)return null;if(s===l)return 1;if(s==="kg"&&l==="g")return 1e3;if(s==="g"&&l==="kg")return 1/1e3;const c=s==="cc"?"ml":s,u=l==="cc"?"ml":l;return c==="l"&&u==="ml"?1e3:c==="ml"&&u==="l"?1/1e3:null},PN=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},Jl=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*1e3)/1e3;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString(void 0,{maximumFractionDigits:3})},HN=({item:n,isLowStock:t,onUpdateQuantity:s,onDelete:l,onToggleTax:c,onEdit:u,onRequestUnitSync:d})=>{const[f,p]=Ae.useState(n.quantity===""?"":parseFloat(n.quantity)||0),g=G=>{const H=String(G||"").trim();return H?H==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(H)?H:"":""},y={food:"",alcohol:"",soft_drink:"",supplies:""};Ae.useEffect(()=>{p(n.quantity===""?"":parseFloat(n.quantity)||0)},[n.quantity]);const v=parseFloat(n.price)||0,x=(()=>{if(!Number.isFinite(v)||v<=0)return"-";const G=n?._csv?.unit,H=String(G||"").trim(),W=String(n?.unit||"").trim();if(!H)return`${Jl(v)}`;const z=$i(W),I=$i(H);if(I===z)return`${Jl(v)}/${H}`;const N=qN(I,z);if(N!==null)return`${Jl(v*N)}/${H}`;const L=parseFloat(n?._master?.packetSize),K=String(n?._master?.packetUnit||"").trim(),oe=$i(K);return PN(H)&&Number.isFinite(L)&&L>0&&oe===z?`${Jl(v*L)}/${H}`:`${Jl(v)}/${W||"-"}`})(),S=g(n?._master?.itemCategory),C=S==="alcohol"||S==="supplies",E=n?.tax10_override===!0||n?.tax10_override===1||n?.tax10_override==="1"||n?.tax10_override==="true",_=S?E?n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true":C:n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true",T=S?E?`${y[S]||S}: ${C?"10%":"8%"}/ `:`${y[S]||S}${_?"10%":"8%"}`:"10%",D=_?1.1:1.08,B=f===""?0:parseFloat(f),P=v*B*D,$=Ae.useMemo(()=>{const G=n?._master?.packetSize,H=n?._master?.packetUnit,W=parseFloat(G);return!Number.isFinite(W)||W<=0?"-":`${Number.isInteger(W)?W.toLocaleString():W.toLocaleString(void 0,{maximumFractionDigits:3})}${H?String(H):""}`},[n?._master?.packetSize,n?._master?.packetUnit]),j=()=>{const G=parseFloat(f);!isNaN(G)&&G!==n.quantity&&s(n.id,G)},M=G=>{G.key==="Enter"&&G.target.blur()},A=G=>{const H=G?.target;H&&requestAnimationFrame(()=>{try{const W=String(H.value??"").length;H.setSelectionRange(W,W)}catch{}})},F=n?._master?.packetUnit||"",Q=!!F&&$i(F)!==$i(n?.unit);return i.jsxs("tr",{className:t(n)?"low-stock":"",children:[i.jsx("td",{style:{textAlign:"center"},children:i.jsx("input",{type:"checkbox",checked:_,onChange:G=>c&&c(n,G.target.checked),title:T,className:"inventory-tax-checkbox"})}),i.jsxs("td",{children:[n.name,t(n)&&i.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),i.jsx("td",{style:{textAlign:"right"},children:x}),i.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:$}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[i.jsx("input",{type:"text",inputMode:"decimal",value:f,onChange:G=>p(G.target.value),className:"inventory-quantity-input no-print",onBlur:j,onKeyDown:M,onFocus:A,onClick:A,style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),i.jsx("span",{className:"print-only",style:{display:"none"},children:f})]}),i.jsx("td",{children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:n.unit}),Q&&typeof d=="function"&&i.jsx("button",{type:"button",onClick:()=>d(n),title:`${F}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),i.jsx("td",{style:{textAlign:"right"},children:P>0?`${Math.round(P).toLocaleString()}`:"-"}),i.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:n.vendor||"-"}),i.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof u=="function"&&i.jsx("button",{type:"button",onClick:()=>u(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),i.jsx("button",{onClick:()=>l(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},FN=({items:n,loading:t,onDelete:s,onUpdateQuantity:l,onToggleTax:c,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:f,isOver:p}=ko({id:"inventory-list-droppable"}),g=C=>C.threshold>0&&C.quantity<=C.threshold,[y,v]=Ae.useState({key:null,direction:"asc"}),x=C=>{v(E=>E.key===C?{key:C,direction:E.direction==="asc"?"desc":"asc"}:{key:C,direction:"asc"})},S=Ae.useMemo(()=>{if(!y.key)return n;const C=[...n];return y.key==="vendor"&&C.sort((E,_)=>{const T=(E?.vendor||"").toString(),D=(_?.vendor||"").toString(),B=T.localeCompare(D,"ja");if(B!==0)return y.direction==="asc"?B:-B;const P=(E?.name||"").toString(),$=(_?.name||"").toString(),j=P.localeCompare($,"ja");return y.direction==="asc"?j:-j}),C},[n,y]);return i.jsxs("div",{ref:f,className:`inventory-list-droppable ${p?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:p?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[i.jsx("div",{className:"inventory-table-container",children:t?i.jsx("p",{children:"Loading..."}):i.jsxs("table",{className:"inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"}),i.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),i.jsx("th",{style:{width:"40px"}})]})}),i.jsxs("tbody",{children:[S.map(C=>i.jsx(HN,{item:C,isLowStock:g,onUpdateQuantity:l,onEdit:u,onDelete:s,onToggleTax:c,onRequestUnitSync:d},C.id)),S.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"9",style:{textAlign:"center",color:"#888",padding:"2rem"},children:p?"":""})})]}),i.jsx("tfoot",{children:(()=>{const C=n.reduce((E,_)=>{const T=parseFloat(_.price)||0,D=_.quantity===""?0:parseFloat(_.quantity)||0,B=_?.tax10===!0||_?.tax10===1||_?.tax10==="1"||_?.tax10==="true"?1.1:1.08,P=T*D;return E.net+=P,E.taxed+=P*B,E},{net:0,taxed:0});return i.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[i.jsx("td",{colSpan:"6",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(C.net).toLocaleString()," / ",Math.round(C.taxed).toLocaleString()]}),i.jsx("td",{colSpan:"2"})]})})()})]})}),p&&i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},GN=({onBack:n})=>{const{user:t}=fi(),s=t?.id,[,l]=Kf(),[c,u]=w.useState([]),[d,f]=w.useState([]),[p,g]=w.useState([]),[y,v]=w.useState([]),[x,S]=w.useState(new Map),[C,E]=w.useState(new Map),[_,T]=w.useState(new Set),[D,B]=w.useState(!0),[P,$]=w.useState(""),[j,M]=w.useState(!1),[A,F]=w.useState(null),[Q,G]=w.useState(!1),[H,W]=w.useState(null),[z,I]=w.useState(!1),[N,L]=w.useState(!1),[K,oe]=w.useState(""),[he,U]=w.useState(!1),[V,k]=w.useState(!0),[te,de]=w.useState(!1),[fe,J]=w.useState(null),[q,le]=w.useState("history"),[ge,Ne]=w.useState(null),[_e,Me]=w.useState(""),[Pe,me]=w.useState(!1),[Qe,Xe]=w.useState(null),[bt,Nt]=w.useState(!0),[mt,et]=w.useState({key:"name",direction:"asc"}),[ct,wt]=w.useState(!1),[St,jt]=w.useState(null),[lt,ut]=w.useState(new Set),[Rt,Tn]=w.useState(!1),[zn,Ut]=w.useState(null),[Er,qn]=w.useState(null),[Xt,an]=w.useState(!1),ln=Qa(fr(Ru,{activationConstraint:{distance:8}})),[on,tn]=w.useState("all"),[$r,Un]=w.useState(new Set),[nn,Lt]=w.useState(""),[Je,Bt]=w.useState(""),[pn,cn]=w.useState({}),[Ot,mn]=w.useState(""),kt=({row:O,onVendorClick:Z,isSelected:ie})=>{const{attributes:ve,listeners:Ce,setNodeRef:Ee,setActivatorNodeRef:ke,transform:Ue,transition:Le,isDragging:He}=Ja({id:O.vendor,data:{type:"summary-row"}}),Ke={transform:Cr.Transform.toString(Ue),transition:Le,opacity:He?.6:1};return i.jsxs("tr",{ref:Ee,style:Ke,...ve,className:ie?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[i.jsx("td",{className:"inventory-summary__drag",children:i.jsx("span",{ref:ke,...Ce,className:"inventory-summary__drag-handle",title:"",children:""})}),i.jsx("td",{children:i.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>Z?.(O.vendor),"aria-expanded":!!ie,children:[i.jsx("span",{children:O.vendor}),i.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:ie?"":""})]})}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(O.total||0).toLocaleString()]})]})};w.useEffect(()=>{s&&(tn("all"),$(""),gt())},[s]);const gt=async(O=!1)=>{O||B(!0);try{const[Z,ie,ve,Ce,Ee,ke,Ue]=await Promise.all([Kn.getAll(s),nr.getPriceListArray(),Kn.getIgnoredItems(s),Kn.getSnapshots(s),Kn.getDeletedSnapshots(s),$n.getAllConversions(),bu.getAll(s)]);u(Z),v(ie),T(ve),f(Ce||[]),g(Ee||[]),S(ke||new Map),E(Ue||new Map);const Le=ze=>{if(!ze)return-1;const Jt=new Date(ze).getTime();return Number.isFinite(Jt)?Jt:-1},He=(ze,tt)=>{const Jt=Math.max(Le(ze?.updated_at),Le(ze?.updatedAt),Le(ze?.created_at),Le(ze?.createdAt)),Kt=Math.max(Le(tt?.updated_at),Le(tt?.updatedAt),Le(tt?.created_at),Le(tt?.createdAt));return Jt!==Kt&&Kt>Jt?tt:ze},Ke=new Map;(Z||[]).forEach(ze=>{const tt=String(ze?.vendor??"").trim()||"__no_vendor__",Jt=bn(ze?.name)||String(ze?.name??"").trim();if(!Jt)return;const Kt=`${tt}@@${Jt}`,Bs=Ke.get(Kt);if(!Bs){Ke.set(Kt,ze);return}Ke.set(Kt,He(Bs,ze))});const Ze=new Set(Array.from(Ke.values()).map(ze=>ze.id));Un(Ze)}catch(Z){console.error("Failed to load data:",Z)}finally{O||B(!1)}},ne=O=>{if(!O)return"-";const Z=new Date(O);if(Number.isNaN(Z.getTime()))return String(O);const ie=Z.getFullYear(),ve=String(Z.getMonth()+1).padStart(2,"0"),Ce=String(Z.getDate()).padStart(2,"0"),Ee=String(Z.getHours()).padStart(2,"0"),ke=String(Z.getMinutes()).padStart(2,"0");return`${ie}/${ve}/${Ce} ${Ee}:${ke}`},Be=O=>{const Z=O?.items;return Array.isArray(Z)?Z:Z?[]:[]},X=O=>{const Z=O?.snapshot_date||O?.created_at;if(!Z)return null;const ie=new Date(Z);return Number.isNaN(ie.getTime())?null:ie},re=Ae.useMemo(()=>new Set([""]),[]),ae=O=>{const Z=String(O??"").trim();return re.has(Z)},xe=O=>O===!0||O===1||O==="1"||O==="true",Re=O=>{const Z=String(O??"").trim();if(!Z)return"";const ie=Z.toLowerCase();return ie===""?"g":ie===""?"ml":ie===""?"cc":ie===""?"kg":ie===""?"l":ie},$e=(O,Z)=>{const ie=parseFloat(O?.lastPrice),ve=parseFloat(O?.packetSize),Ce=Re(O?.packetUnit),Ee=Re(Z||Ce);if(!Number.isFinite(ie)||!Number.isFinite(ve)||ve<=0||!Ce)return null;const ke=ie/ve;if(Ee===Ce)return ke;if(Ce==="g"&&Ee==="kg")return ke*1e3;if(Ce==="kg"&&Ee==="g")return ke/1e3;const Ue=Ce==="cc"?"ml":Ce,Le=Ee==="cc"?"ml":Ee;return Ue==="ml"&&Le==="l"?ke*1e3:Ue==="l"&&Le==="ml"?ke/1e3:null},Oe=(O,Z)=>{const ie=Re(O),ve=Re(Z);if(!ie||!ve)return null;if(ie===ve)return 1;if(ie==="kg"&&ve==="g")return 1e3;if(ie==="g"&&ve==="kg")return 1/1e3;const Ce=ie==="cc"?"ml":ie,Ee=ve==="cc"?"ml":ve;return Ce==="l"&&Ee==="ml"?1e3:Ce==="ml"&&Ee==="l"?1/1e3:null},De=O=>{const Z=String(O||"").trim();return Z?Z==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(Z)?Z:"":""},rt=O=>{const Z=De(O);return Z==="alcohol"||Z==="supplies"},pt=O=>{const Z=De(O);return Z==="food"?"":Z==="alcohol"||Z==="soft_drink"?"":Z==="supplies"?"":""},gn=O=>{const Z=De(O);return Z==="food"?"food":Z==="alcohol"||Z==="soft_drink"?"drink":Z==="supplies"?"supplies":"unknown"},Ie=O=>O==="food"?"":O==="drink"?"":O==="supplies"?"":"",at=O=>xe(O?.tax10)?1.1:1.08,It=O=>O?`${O.getFullYear()}-${String(O.getMonth()+1).padStart(2,"0")}`:"",sr=O=>{if(!O)return-1;const ie=new Date(O).getTime();return Number.isFinite(ie)?ie:-1},An=O=>{const Z=[O?.updated_at,O?.updatedAt,O?.created_at,O?.createdAt];for(const ie of Z){const ve=sr(ie);if(ve>=0)return ve}return-1},$t=Ae.useMemo(()=>{const O=new Map;return d.forEach(Z=>{const ie=X(Z);if(!ie)return;const ve=It(ie);O.has(ve)||O.set(ve,{key:ve,year:ie.getFullYear(),month:ie.getMonth()+1})}),Array.from(O.values()).sort((Z,ie)=>ie.key.localeCompare(Z.key)).map(Z=>({...Z,label:`${Z.year}${Z.month}`}))},[d]);w.useEffect(()=>{if($t.length===0){nn&&Lt("");return}if(nn&&$t.some(ie=>ie.key===nn))return;const O=It(new Date),Z=$t.find(ie=>ie.key===O)?.key||$t[0].key;Lt(Z)},[$t,nn]),w.useEffect(()=>{if($t.length===0){Je&&Bt("");return}if(Je&&$t.some(ie=>ie.key===Je))return;const O=It(new Date),Z=$t.find(ie=>ie.key===O)?.key||$t[0].key;Bt(Z)},[$t,Je]);const Nr=Ae.useMemo(()=>{if(!Je)return null;const[O,Z]=Je.split("-"),ie=parseInt(O,10),ve=parseInt(Z,10);if(!Number.isFinite(ie)||!Number.isFinite(ve))return null;const Ce=Ue=>String(Ue).padStart(2,"0"),Ee=new Date(ie,ve-1,1),ke=new Date(ie,ve,0);return{year:ie,month:ve,start:Ee,end:ke,rangeLabel:`${ie}/${Ce(ve)}/01${ie}/${Ce(ve)}/${Ce(ke.getDate())}`}},[Je]),ir=Ae.useMemo(()=>Je?d.map(O=>({snapshot:O,date:X(O)})).filter(O=>O.date&&It(O.date)===Je).sort((O,Z)=>Z.date-O.date).map(O=>O.snapshot):d,[d,Je]),qt=Ae.useMemo(()=>{if(!nn)return null;const[O,Z]=nn.split("-"),ie=parseInt(O,10),ve=parseInt(Z,10);if(!Number.isFinite(ie)||!Number.isFinite(ve))return null;const Ce=Ue=>String(Ue).padStart(2,"0"),Ee=new Date(ie,ve-1,1),ke=new Date(ie,ve,0);return{year:ie,month:ve,start:Ee,end:ke,rangeLabel:`${ie}/${Ce(ve)}/01${ie}/${Ce(ve)}/${Ce(ke.getDate())}`}},[nn]),Os=Ae.useMemo(()=>nn?d.map(O=>({snapshot:O,date:X(O)})).filter(O=>O.date&&It(O.date)===nn).sort((O,Z)=>Z.date-O.date).map(O=>O.snapshot):[],[d,nn]),er=Os[0]||null,pr=nn||(er?.id?`snapshot:${er.id}`:""),qr=Ae.useMemo(()=>{const O=new Map;return Os.forEach(Z=>{const ie=X(Z)?.getTime()||-1;Be(Z).forEach((Ce,Ee)=>{const ke=(Ce?.vendor||"").toString().trim();if(ae(ke))return;const Ue=ke||"",Le=String(Ce?.name||"").trim();if(!Le)return;const He=`${Ue}::${Le}`,Ke={item:{...Ce,vendor:Ue},snapshotMs:ie,itemUpdatedMs:An(Ce),rowIndex:Ee},Ze=O.get(He);if(!Ze){O.set(He,Ke);return}if(Ke.snapshotMs!==Ze.snapshotMs){Ke.snapshotMs>Ze.snapshotMs&&O.set(He,Ke);return}if(Ke.itemUpdatedMs!==Ze.itemUpdatedMs){Ke.itemUpdatedMs>Ze.itemUpdatedMs&&O.set(He,Ke);return}Ke.rowIndex>=Ze.rowIndex&&O.set(He,Ke)})}),Array.from(O.values()).map(Z=>Z.item)},[Os,ae]),Fi=Ae.useMemo(()=>{const O=new Map;return qr.forEach(Z=>{const ie=(Z?.vendor||"").toString().trim(),ve=ie||"";if(ae(ie))return;const Ce=parseFloat(Z?.price)||0,Ee=Z?.quantity===""?0:parseFloat(Z?.quantity)||0,ke=Ce*Ee,Ue=ke*at(Z),Le=O.get(ve)||{vendor:ve,net:0,taxed:0};Le.net+=ke,Le.taxed+=Ue,O.set(ve,Le)}),Array.from(O.values()).map(Z=>({vendor:Z.vendor,net:Z.net,taxed:Z.taxed,total:Z.taxed}))},[qr,ae,at]),ss=Ae.useMemo(()=>{const O=new Map;return Fi.forEach(Z=>{O.set(Z.vendor,Z)}),O},[Fi]),Za=Ae.useMemo(()=>{const O=new Map;try{for(const[Z,ie]of(x||new Map).entries()){const ve=String(Z??"").trim();ve&&O.set(ve,ie)}}catch{}return O},[x]),el=Ae.useCallback(O=>{const Z=De(O?.itemCategory??O?.item_category);if(Z)return Z;const ie=String(O?.name??"").trim();if(!ie)return"";const ve=Za.get(ie);return De(ve?.itemCategory??ve?.item_category)},[Za]),Gi=Ae.useMemo(()=>{const O=new Map;qr.forEach((Z,ie)=>{const ve=(Z?.vendor||"").toString().trim(),Ce=ve||"";if(ae(ve))return;const Ee=parseFloat(Z?.price)||0,ke=Z?.quantity===""?0:parseFloat(Z?.quantity)||0,Ue=Ee*ke,Le=Ue*at(Z),He=el(Z),Ke=gn(He),Ze=O.get(Ce)||{vendor:Ce,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};Ze.totals[Ke]+=Le,Ze.totals.net+=Ue,Ze.totals.taxed+=Le,Ze.rows.push({id:Z?.id||`${Ce}-${Z?.name||"item"}-${ie}`,name:Z?.name||"",unit:Z?.unit||"",quantity:ke,price:Ee,taxed:Le,itemCategory:He,breakdownKey:Ke}),O.set(Ce,Ze)});for(const Z of O.values())Z.rows.sort((ie,ve)=>{const Ce={food:0,drink:1,unknown:2,supplies:3},Ee=Ce[ie?.breakdownKey]??2,ke=Ce[ve?.breakdownKey]??2;if(Ee!==ke)return Ee-ke;const Ue=(ie?.name||"").toString(),Le=(ve?.name||"").toString();return Ue.localeCompare(Le,"ja")});return O},[qr,ae,at,el]),Ds=Ae.useMemo(()=>Fi.slice().sort((O,Z)=>Z.taxed!==O.taxed?Z.taxed-O.taxed:O.vendor.localeCompare(Z.vendor,"ja")).map(O=>O.vendor),[Fi]),ar=Ae.useMemo(()=>{if(!pr)return Ds;const O=pn[pr],Z=new Set(ss.keys()),ie=Array.isArray(O)?O.filter(Ce=>Z.has(Ce)):[],ve=Ds.filter(Ce=>!ie.includes(Ce));return[...ie,...ve]},[pn,pr,Ds,ss]),Pn=Ae.useMemo(()=>ar.map(O=>ss.get(O)).filter(Boolean),[ar,ss]),tl=Pn.reduce((O,Z)=>(O.net+=Z.net||0,O.taxed+=Z.taxed||0,O),{net:0,taxed:0});w.useEffect(()=>{Ot&&(ss.has(Ot)||mn(""))},[Ot,ss]);const Uu=O=>{mn(Z=>Z===O?"":O)},nl=O=>{O?.id&&s&&(me(!1),Xe(null),Me(""),Ne({title:"",message:`${O.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{me(!0),Xe({type:"move",id:O.id});try{await Kn.deleteSnapshotToTrash(s,O.id),await gt(!0),Ut({title:"",message:"",type:"success"})}catch(Z){console.error(Z),Ut({title:"",message:"()",type:"error"})}finally{me(!1),Xe(null),Ne(null)}}}))},Mo=O=>{O?.id&&s&&(me(!1),Xe(null),Me(""),Ne({title:"",message:`${O.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{me(!0),Xe({type:"restore",id:O.id});try{await Kn.restoreSnapshotFromTrash(s,O.id),await gt(!0),Ut({title:"",message:"",type:"success"})}catch(Z){console.error(Z),Ut({title:"",message:"",type:"error"})}finally{me(!1),Xe(null),Ne(null)}}}))},Vi=O=>{O?.id&&s&&(me(!1),Xe(null),Me(""),Ne({title:" ",message:`${O.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{me(!0),Xe({type:"hard-delete",id:O.id});try{await Kn.hardDeleteSnapshotFromTrash(s,O.id),await gt(!0),Ut({title:"",message:"",type:"success"})}catch(Z){console.error(Z),Ut({title:"",message:"",type:"error"})}finally{me(!1),Xe(null),Ne(null)}}}))},rl=O=>{if(!O)return;const Z=Be(O).filter(ze=>!ae(ze?.vendor)),ie=["","","","","()",""],ve=Z.map(ze=>{const tt=parseFloat(ze?.price)||0,Jt=ze?.quantity===""?0:parseFloat(ze?.quantity)||0,Kt=Math.round(tt*Jt*at(ze));return[ze?.name??"",tt||"",ze?.unit??"",ze?.quantity??"",Kt||"",ze?.vendor??""]}),Ce=ze=>{const tt=String(ze??"");return tt.includes(",")||tt.includes('"')||tt.includes(`
`)||tt.includes("\r")?`"${tt.replace(/"/g,'""')}"`:tt},Ee=[ie.map(Ce).join(","),...ve.map(ze=>ze.map(Ce).join(","))].join(`
`),ke=new Uint8Array([239,187,191]),Ue=new Blob([ke,Ee],{type:"text/csv"}),Le=URL.createObjectURL(Ue),He=(O.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),Ke=(O.snapshot_date?new Date(O.snapshot_date):new Date).toISOString().slice(0,10),Ze=document.createElement("a");Ze.href=Le,Ze.download=`InventorySnapshot_${Ke}_${He}.csv`,document.body.appendChild(Ze),Ze.click(),document.body.removeChild(Ze),URL.revokeObjectURL(Le)},lr=()=>{if(!er)return;const O=["","()"],Z=Pn.map(ze=>[ze.vendor,Math.round(ze.total||0)]),ie=ze=>{const tt=String(ze??"");return tt.includes(",")||tt.includes('"')||tt.includes(`
`)||tt.includes("\r")?`"${tt.replace(/"/g,'""')}"`:tt},ve=[O.map(ie).join(","),...Z.map(ze=>ze.map(ie).join(","))].join(`
`),Ce=new Uint8Array([239,187,191]),Ee=new Blob([Ce,ve],{type:"text/csv"}),ke=URL.createObjectURL(Ee),Ue=(er.snapshot_date?new Date(er.snapshot_date):new Date).toISOString().slice(0,10),Le=er.title||"inventory_summary",He=qt?`${qt.year}${String(qt.month).padStart(2,"0")}`:Ue,Ke=Le.toString().replace(/[\\/:*?"<>|]/g,"_"),Ze=document.createElement("a");Ze.href=ke,Ze.download=`InventorySummary_${He}_${Ke}.csv`,document.body.appendChild(Ze),Ze.click(),document.body.removeChild(Ze),URL.revokeObjectURL(ke)},sl=O=>{if(!O?.vendor)return;const Z=["","","","","","()",""],ie=(O.rows||[]).map(ze=>{const tt=ze.itemCategory?pt(ze.itemCategory):Ie(ze.breakdownKey);return[ze.name||"",tt,Math.round(ze.price||0),ze.unit||"",Number(ze.quantity||0),Math.round(ze.taxed||0),O.vendor]}),ve=ze=>{const tt=String(ze??"");return tt.includes(",")||tt.includes('"')||tt.includes(`
`)||tt.includes("\r")?`"${tt.replace(/"/g,'""')}"`:tt},Ce=[Z.map(ve).join(","),...ie.map(ze=>ze.map(ve).join(","))].join(`
`),Ee=new Uint8Array([239,187,191]),ke=new Blob([Ee,Ce],{type:"text/csv"}),Ue=URL.createObjectURL(ke),Le=(er?.snapshot_date?new Date(er.snapshot_date):new Date).toISOString().slice(0,10),He=qt?`${qt.year}${String(qt.month).padStart(2,"0")}`:Le,Ke=O.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),Ze=document.createElement("a");Ze.href=Ue,Ze.download=`InventorySummary_${He}_${Ke}.csv`,document.body.appendChild(Ze),Ze.click(),document.body.removeChild(Ze),URL.revokeObjectURL(Ue)},Ms=Ae.useMemo(()=>{const O=Fe=>Fe?Fe.toString().trim():"",Z=Fe=>bn(Fe),ie=new Set;try{for(const Fe of(_||new Set).values()){const Ve=Z(Fe);Ve&&ie.add(Ve)}}catch{}const ve=new Set;try{for(const Fe of(lt||new Set).values()){const Ve=Z(Fe);Ve&&ve.add(Ve)}}catch{}const Ce=new Map;try{for(const[Fe,Ve]of(x||new Map).entries()){const ot=Z(Fe);ot&&Ce.set(ot,Ve)}}catch{}const Ee=new Map;try{(y||[]).forEach(Fe=>{const Ve=Z(Fe?.name);Ve&&Ee.set(Ve,Fe)})}catch{}const ke=new Map;try{for(const[Fe,Ve]of(C||new Map).entries()){const ot=Z(Fe);ot&&ke.set(ot,Ve)}}catch{}const Ue=Fe=>{const Ve=String(Fe??"").trim();if(!Ve)return"";const ot=Ve.toLowerCase();return ot===""?"g":ot===""?"ml":ot===""?"cc":ot===""?"kg":ot===""?"l":ot},Le=(Fe,Ve)=>{const ot=parseFloat(Fe?.lastPrice),Qt=parseFloat(Fe?.packetSize),yn=Ue(Fe?.packetUnit),wn=Ue(Ve||yn);if(!Number.isFinite(ot)||!Number.isFinite(Qt)||Qt<=0||!yn)return null;const _t=ot/Qt;if(wn===yn)return _t;if(yn==="g"&&wn==="kg")return _t*1e3;if(yn==="kg"&&wn==="g")return _t/1e3;const Wn=yn==="cc"?"ml":yn,Sn=wn==="cc"?"ml":wn;return Wn==="ml"&&Sn==="l"?_t*1e3:Wn==="l"&&Sn==="ml"?_t/1e3:null},He=Fe=>{const Ve=String(Fe??"").trim();return Ve?["","","","","","","","pc","PC",""].includes(Ve):!1},Ke=Fe=>{const Ve=Z(Fe?.name),ot=Ve?Ce.get(Ve):null,Qt=Ve?Ee.get(Ve):null,yn=Ve&&ke.has(Ve)?String(ke.get(Ve)||""):String(Qt?.unit||""),wn={...Fe};if(wn.name=O(wn.name),wn.vendor=O(wn.vendor),wn._csv={unit:yn,price:Qt?.price??null,vendor:O(Qt?.vendor)||null,dateStr:Qt?.dateStr??null},!ot)return wn;const _t={...wn},Wn=De(ot?.itemCategory),Sn=ot.packetUnit||"",as=parseFloat(ot.packetSize),Zr=Sn?Le(ot,Sn):null;if(_t.isPhantom)Sn&&Zr!==null&&(_t.unit=Sn,_t.price=Zr);else{if(!!Sn&&Number.isFinite(as)&&as>0&&(He(_t.unit)||!_t.unit)&&Zr!==null){const ls=_t.quantity;if(ls!==""&&ls!==null&&ls!==void 0){const mi=parseFloat(ls);Number.isFinite(mi)&&(_t.quantity=mi*as)}const Wi=_t.threshold;if(Wi!==""&&Wi!==null&&Wi!==void 0){const mi=parseFloat(Wi);Number.isFinite(mi)&&(_t.threshold=mi*as)}_t.unit=Sn}else(Sn&&Zr!==null||!_t.unit&&Sn)&&(_t.unit=Sn);if(Zr!==null&&Ue(_t.unit)===Ue(Sn))_t.price=Zr;else{const ls=Le(ot,_t.unit||Sn);ls!==null&&(_t.price=ls)}}const Is=xe(_t?.tax10_override??_t?.tax10Override),ol=Wn?rt(Wn):null;return _t._master={packetSize:ot.packetSize,packetUnit:ot.packetUnit,lastPrice:ot.lastPrice,itemCategory:Wn||null,tax10Auto:ol,tax10Override:Is,updatedAt:ot.updatedAt},Wn&&(_t.tax10_override=Is,!Is&&ol!==null&&(_t.tax10=ol)),_t},Ze=c.map(Ke),ze=new Map;Ze.forEach(Fe=>{const Ve=Z(Fe?.name);Ve&&ze.set(Ve,Fe)});const tt=[...Ze];y.forEach((Fe,Ve)=>{const ot=String(Fe?.name??""),Qt=O(ot),yn=Z(ot);if(yn&&!(_.has(ot)||Qt&&_.has(Qt)||ie.has(yn))&&!ze.has(yn)){const wn={id:`phantom-${Ve}`,isPhantom:!0,name:Qt,quantity:"",unit:Fe.unit||"",category:"",price:Fe.price,vendor:O(Fe.vendor),threshold:0,tax10:!1,tax10_override:!1};tt.push(Ke(wn))}});const Jt=tt.filter(Fe=>{const Ve=String(Fe?.name??""),ot=O(Ve),Qt=Z(Ve);return!(_.has(Ve)||ot&&_.has(ot)||Qt&&ie.has(Qt)||lt.has(Ve)||ot&&lt.has(ot)||Qt&&ve.has(Qt)||ae(Fe.vendor))}),Kt=Fe=>{if(!Fe)return-1;const ot=new Date(Fe).getTime();return Number.isFinite(ot)?ot:-1},Bs=(Fe,Ve)=>{const ot=!!Fe?.isPhantom,Qt=!!Ve?.isPhantom;if(ot!==Qt)return ot?Ve:Fe;const yn=Math.max(Kt(Fe?.updated_at),Kt(Fe?.updatedAt),Kt(Fe?.created_at),Kt(Fe?.createdAt)),wn=Math.max(Kt(Ve?.updated_at),Kt(Ve?.updatedAt),Kt(Ve?.created_at),Kt(Ve?.createdAt));if(yn!==wn)return wn>yn?Ve:Fe;const _t=Fe?.quantity,Wn=Ve?.quantity,Sn=_t===""||_t===null||_t===void 0?null:parseFloat(_t),as=Wn===""||Wn===null||Wn===void 0?null:parseFloat(Wn),Zr=Sn!==null&&Number.isFinite(Sn),Is=as!==null&&Number.isFinite(as);return Zr!==Is&&Is?Ve:Fe},Jr=new Map;return Jt.forEach(Fe=>{const Ve=Z(Fe?.name)||O(Fe?.name);if(!Ve)return;const Qt=`${O(Fe?.vendor)||"__no_vendor__"}@@${Ve}`,yn=Jr.get(Qt);if(!yn){Jr.set(Qt,Fe);return}Jr.set(Qt,Bs(yn,Fe))}),Array.from(Jr.values())},[c,y,_,lt,x,C,ae]),il=O=>{const{active:Z,over:ie}=O;if(!ie)return;if(Z?.data?.current?.type==="summary-row"){if(!pr)return;const Ce=Z.id,Ee=ie.id;if(!Ce||!Ee||Ce===Ee)return;const ke=ar,Ue=ke.indexOf(Ce),Le=ke.indexOf(Ee);if(Ue<0||Le<0)return;const He=Hi(ke,Ue,Le);cn(Ke=>({...Ke,[pr]:He}));return}if(ie.id==="inventory-list-droppable"){const Ce=Z.data.current.item;if(Z.data.current.type==="csv-item"){const Ee=String(Ce?.name??"").trim(),ke=bn(Ee);let Ue=null;if(x&&x.size>0&&ke&&(Ue=x.get(Ee)||null,!Ue)){for(const[Ze,ze]of x.entries())if(bn(Ze)===ke){Ue=ze;break}}const Le=Ue?.packetUnit||Ce.unit,He=Ue?$e(Ue,Le):null,Ke=He!==null?He:Ue?.lastPrice!==null&&Ue?.lastPrice!==void 0&&Ue?.lastPrice!==""?Ue.lastPrice:Ce.price;F({name:Ce.name,price:Ke,unit:Le,category:"",threshold:0,quantity:0,vendor:Ce.vendor,tax10:xe(Ce?.tax10),isNewFromCsv:!0}),M(!0)}}},zs=async O=>{if(O.preventDefault(),!s)return;const Z=new FormData(O.target),ie={name:Z.get("name"),quantity:parseFloat(Z.get("quantity")),unit:Z.get("unit"),category:Z.get("category"),threshold:parseFloat(Z.get("threshold")),vendor:A.vendor||"",price:A.price||0,tax10:xe(A?.tax10)};try{A.id&&!A.isPhantom?await Kn.update(s,{...A,...ie}):await Kn.add(s,ie),M(!1),F(null),gt()}catch(ve){console.error("Failed to save item:",ve),Ut({title:"",message:"",type:"error"})}},zo=O=>{jt(O),wt(!0)},Uo=O=>{!O||O.isPhantom||!O?._master?.packetUnit||(W(O),G(!0))},is=()=>{z||(G(!1),W(null))},Lo=async({convertQuantity:O})=>{if(!s)return;const Z=H;if(!Z||Z.isPhantom)return;const ie=Z?._master?.packetUnit;if(!ie)return;const ve=ie,Ce=$e(Z?._master,ve);if(Ce===null){Ut({title:"",message:"/",type:"error"});return}let Ee=Z.quantity,ke=Z.threshold;if(O){const Ue=Oe(Z.unit,ve);if(!Ue){Ut({title:"",message:"kgg / lml ",type:"error"});return}const Le=Z.quantity===""?null:parseFloat(Z.quantity);Le!==null&&Number.isFinite(Le)&&(Ee=Le*Ue);const He=Z.threshold===""?null:parseFloat(Z.threshold);He!==null&&Number.isFinite(He)&&(ke=He*Ue)}I(!0);try{await Kn.update(s,{id:Z.id,unit:ve,price:Ce,quantity:Ee===""?0:parseFloat(Ee)||0,threshold:ke===""?0:parseFloat(ke)||0,tax10:xe(Z?.tax10)}),await gt(!0),G(!1),W(null)}catch(Ue){console.error("Failed to sync unit:",Ue),Ut({title:"",message:"",type:"error"})}finally{I(!1)}},Bo=async()=>{if(St)try{const Z=(ie=>ie?ie.toString().trim():"")(St?.name);Z&&ut(ie=>{const ve=new Set(ie);return ve.add(Z),ve}),wt(!1),jt(null)}catch(O){console.error("Failed to delete/ignore item:",O)}},Io=async(O,Z)=>{try{if(!s)return;const ie=Ms.find(ve=>ve.id===O);if(!ie)return;if(ie.isPhantom){const ve={name:ie.name.trim(),quantity:Z,unit:ie.unit,category:ie.category||"",price:ie.price,vendor:ie.vendor,threshold:0,tax10:xe(ie?.tax10)},Ce=await Kn.add(s,ve);await gt(!0),Un(Ee=>{const ke=new Set(Ee);return ke.add(Ce.id),ke})}else u(ve=>ve.map(Ce=>Ce.id!==O?Ce:{...Ce,quantity:Z,unit:ie.unit??Ce.unit,price:ie.price??Ce.price,threshold:ie.threshold??Ce.threshold})),Un(ve=>{const Ce=new Set(ve);return Ce.add(O),Ce}),await Kn.update(s,{...ie,quantity:Z})}catch(ie){console.error(ie);const ve=ie?.message||ie?.error_description||(typeof ie=="string"?ie:null)||(()=>{try{return JSON.stringify(ie)}catch{return null}})()||"";Ut({title:"",message:`
${ve}`,type:"error"}),gt()}},Yi=async(O,Z)=>{try{if(!s||!O)return;const ie=!!Z;if(O.isPhantom){const ve={name:O.name.trim(),quantity:O.quantity===""?0:parseFloat(O.quantity)||0,unit:O.unit,category:O.category||"",price:O.price,vendor:O.vendor,threshold:0,tax10:ie,tax10_override:!0};await Kn.add(s,ve),await gt(!0)}else u(ve=>ve.map(Ce=>Ce.id===O.id?{...Ce,tax10:ie,tax10_override:!0}:Ce)),await Kn.update(s,{...O,tax10:ie,tax10_override:!0})}catch(ie){console.error(ie);const ve=ie?.message||ie?.error_description||(typeof ie=="string"?ie:null)||(()=>{try{return JSON.stringify(ie)}catch{return null}})()||"";Ut({title:"",message:`
${ve}`,type:"error"}),gt()}},Lu=(O,Z)=>{if(Z===!0){qn({item:O});return}Yi(O,Z)},$o=()=>{Xt||qn(null)},Ki=async()=>{const O=Er?.item;if(O){an(!0);try{await Yi(O,!0),qn(null)}finally{an(!1)}}},Pr=async()=>{if(!he&&K&&s){U(!0);try{const O=Ms.filter(ie=>!ie.isPhantom).map(ie=>{const ve={...ie};return delete ve.isPhantom,delete ve._master,delete ve._csv,ve}),Z=O.reduce((ie,ve)=>{const Ce=parseFloat(ve.price)||0,Ee=ve.quantity===""?0:parseFloat(ve.quantity)||0;return ie+Ce*Ee*at(ve)},0);await Kn.createSnapshot(s,K,O,Z),V?(await Kn.resetStockQuantities(s),await gt(),Un(new Set)):await gt(!0),L(!1),Tn(!0)}catch(O){console.error("Failed to complete inventory:",O);const Z=O?.message||O?.error_description||(typeof O=="string"?O:null)||(()=>{try{return JSON.stringify(O)}catch{return null}})()||"";Ut({title:"",message:`
${Z}`,type:"error"})}finally{U(!1)}}},al=()=>{const O=["","","","","()",""],Z=Qi.map(Le=>{const He=parseFloat(Le.price)||0,Ke=Le.quantity===""?0:parseFloat(Le.quantity)||0,Ze=Math.round(He*Ke*at(Le));return[Le.name,He,Le.unit,Le.quantity,Ze,Le.vendor||""]}),ie=[O.join(","),...Z.map(Le=>Le.map(He=>{const Ke=String(He??"");return Ke.includes(",")||Ke.includes('"')||Ke.includes(`
`)?`"${Ke.replace(/"/g,'""')}"`:Ke}).join(","))].join(`
`),ve=new Uint8Array([239,187,191]),Ce=new Blob([ve,ie],{type:"text/csv"}),Ee=document.createElement("a"),ke=URL.createObjectURL(Ce),Ue=new Date().toISOString().split("T")[0];Ee.href=ke,Ee.download=`Inventory_${Ue}.csv`,document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee),URL.revokeObjectURL(ke)},ll=["","","","","","","","","","","",""],Us=[...new Set(Ms.map(O=>O.vendor).filter(O=>O&&!ae(O)))].sort(),Ls=Ms.some(O=>!O.vendor),pi=on==="summary",Qi=Ms.filter(O=>O.name.toLowerCase().includes(P.toLowerCase())?on==="all"||on==="summary"?!0:on==="inventory-check"?$r.has(O.id)||!O.isPhantom:on==="other"?!O.vendor:O.vendor===on:!1);return j?i.jsxs("div",{className:"inventory-edit-container fade-in",children:[i.jsx("div",{className:"container-header",children:i.jsx("h2",{className:"section-title",children:A&&!A.isNewFromCsv?"":""})}),i.jsx(fn,{className:"edit-form-card",children:i.jsxs("form",{onSubmit:zs,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(xt,{name:"name",defaultValue:A?.name,required:!0,placeholder:": "})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(xt,{name:"quantity",type:"number",step:"0.01",defaultValue:A?.quantity,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(xt,{name:"unit",defaultValue:A?.unit||"g",required:!0,placeholder:"g, ml, ..."})]})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(xt,{name:"category",defaultValue:A?.category,list:"category-list",placeholder:"",autoComplete:"off"}),i.jsx("datalist",{id:"category-list",children:ll.map(O=>i.jsx("option",{value:O},O))})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" ()"}),i.jsx(xt,{name:"threshold",type:"number",step:"0.01",defaultValue:A?.threshold||0})]})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx(be,{variant:"ghost",type:"button",onClick:()=>{M(!1),F(null)},children:""}),i.jsx(be,{variant:"primary",type:"submit",children:""})]})]})})]}):i.jsx(Pi,{onDragEnd:il,sensors:ln,autoScroll:!1,children:i.jsxs("div",{className:"inventory-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsxs("div",{className:"header-actions inventory-header-actions",children:[i.jsx(be,{variant:"ghost",onClick:n,children:" "}),i.jsx(be,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>l({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),i.jsx(be,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const O=new Date;oe(`${O.getFullYear()}${O.getMonth()+1} `),k(!0),L(!0)},children:" "}),i.jsx(be,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{J(null),le("history"),de(!0)},title:"",children:" "}),i.jsx(be,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{F(null),M(!0)},children:"+ "})]})]}),i.jsx("div",{className:"inventory-split-layout",children:i.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[i.jsxs("div",{className:"inventory-controls",children:[pi?i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsx("select",{className:"inventory-controls__select",value:nn,onChange:O=>Lt(O.target.value),disabled:$t.length===0,children:$t.length===0?i.jsx("option",{value:"",children:""}):$t.map(O=>i.jsx("option",{value:O.key,children:O.label},O.key))})]}),qt&&i.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",qt.rangeLabel]})]}):i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsxs("select",{className:"inventory-controls__select",value:on==="inventory-check"?"":on,onChange:O=>{O.target.value&&tn(O.target.value)},children:[i.jsx("option",{value:"all",children:""}),i.jsx("option",{value:"",disabled:!0,children:""}),i.jsxs("optgroup",{label:"",children:[Us.map(O=>i.jsx("option",{value:O,children:O},O)),Ls&&i.jsx("option",{value:"other",children:""})]})]})]}),i.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:P,onChange:O=>$(O.target.value)})]}),i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[i.jsxs("button",{className:"inventory-controls__btn",onClick:()=>tn("inventory-check"),"data-active":on==="inventory-check"?"true":"false",children:["  (",$r.size,")"]}),i.jsx("button",{className:"inventory-controls__btn",onClick:()=>tn("summary"),"data-active":on==="summary"?"true":"false",children:" "}),!pi&&i.jsx("button",{className:"inventory-controls__btn",onClick:al,title:"CSV",children:" CSV (.csv)"}),!pi&&on==="inventory-check"&&i.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),pi?i.jsxs("div",{className:"inventory-summary",children:[i.jsx("div",{className:"inventory-summary__header",children:i.jsxs("div",{children:[i.jsx("div",{className:"inventory-summary__title",children:""}),qt&&i.jsxs("div",{className:"inventory-summary__meta",children:[": ",qt.rangeLabel]}),er?i.jsxs("div",{className:"inventory-summary__meta",children:[": ",er.title||"","",ne(er.snapshot_date),""]}):i.jsx("div",{className:"inventory-summary__meta",children:""}),Os.length>1&&i.jsxs("div",{className:"inventory-summary__note",children:[" ",Os.length," "]})]})}),er?i.jsxs("div",{className:"inventory-summary__table-wrap",children:[i.jsx("div",{className:"inventory-summary__actions",children:i.jsx(be,{variant:"secondary",size:"sm",onClick:lr,children:" CSV (.csv)"})}),i.jsxs("table",{className:"inventory-summary__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40px"}}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx(Ga,{items:ar,strategy:fo,children:i.jsxs("tbody",{children:[Pn.map(O=>{const Z=Ot===O.vendor,ie=Gi.get(O.vendor)||null;return i.jsxs(Ae.Fragment,{children:[i.jsx(kt,{row:O,onVendorClick:Uu,isSelected:Z}),Z&&ie&&i.jsxs("tr",{className:"inventory-summary__detail-row",children:[i.jsx("td",{}),i.jsx("td",{colSpan:"2",children:i.jsxs("div",{className:"inventory-summary__inline-detail",children:[i.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[i.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[ie.vendor," "]}),i.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>sl(ie),disabled:!ie.rows||ie.rows.length===0,children:" CSV"}),i.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(ie.totals.taxed||0).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(ve=>i.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:Ie(ve)}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ie.totals[ve]||0).toLocaleString()]})]},ve)),ie.totals.unknown>0&&i.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ie.totals.unknown).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(ie.totals.net||0).toLocaleString()]}),i.jsx("div",{className:"inventory-summary__inline-items-wrap",children:i.jsxs("table",{className:"inventory-summary__inline-items-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx("tbody",{children:ie.rows.map((ve,Ce)=>{const Ee=ve.itemCategory?pt(ve.itemCategory):Ie(ve.breakdownKey),ke=Ce>0?ie.rows[Ce-1]:null,Ue=!!ke&&ke.breakdownKey!==ve.breakdownKey;return i.jsxs("tr",{className:Ue?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[i.jsx("td",{children:ve.name||"-"}),i.jsx("td",{children:Ee}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(ve.price||0).toLocaleString()]}),i.jsxs("td",{style:{textAlign:"right"},children:[Number(ve.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),ve.unit?` ${ve.unit}`:""]}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(ve.taxed||0).toLocaleString()]})]},ve.id)})})]})})]})})]})]},O.vendor)}),Pn.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsx("td",{}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(tl.net).toLocaleString()," / ",Math.round(tl.taxed).toLocaleString()]})]})})]})]}):i.jsx("div",{className:"inventory-summary__empty",children:""})]}):i.jsx(FN,{items:Qi,loading:D,onSearch:$,searchQuery:P,onEdit:O=>{F(O),M(!0)},onDelete:zo,onUpdateQuantity:Io,onToggleTax:Lu,onRequestUnitSync:Uo})]})}),i.jsx(Jn,{isOpen:!!Er,onClose:$o,title:"10%",size:"small",showCloseButton:!Xt,children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",Er?.item?.name||"","",i.jsx("strong",{children:"10%"}),""]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[i.jsx(be,{variant:"secondary",onClick:$o,disabled:Xt,children:""}),i.jsx(be,{variant:"primary",onClick:Ki,disabled:Xt,children:Xt?"...":""})]})]})}),i.jsx(Jn,{isOpen:N,onClose:()=>{he||L(!1)},title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),i.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[i.jsx("strong",{children:":"}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. ",V?i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:"()0"}),""]}):i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:""}),""]}),i.jsx("br",{}),""]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:V,disabled:he,onChange:()=>k(!0)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:"0"}),""]})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:!V,disabled:he,onChange:()=>k(!1)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:""}),""]})]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),i.jsx("input",{type:"text",value:K,onChange:O=>oe(O.target.value),disabled:he,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx("button",{onClick:()=>{he||L(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:he?"not-allowed":"pointer",opacity:he?.6:1,fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Pr,disabled:he,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:he?"#94a3b8":"#2ecc71",color:"white",cursor:he?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:he?"...":V?"":""})]}),he&&i.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),i.jsxs(Jn,{isOpen:te,onClose:()=>de(!1),title:" ",size:"large",children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:q==="history"?i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:ir.length})," "]}):i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:p.length})," "]})}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",gap:"6px"},children:[i.jsx("button",{type:"button",onClick:()=>le("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:q==="history"?"#111":"#fff",color:q==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),i.jsx("button",{type:"button",onClick:()=>le("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:q==="trash"?"#111":"#fff",color:q==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>gt(!0),title:"",children:" "})]})]}),q==="history"&&i.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),i.jsx("select",{value:Je,onChange:O=>Bt(O.target.value),disabled:$t.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:$t.length===0?i.jsx("option",{value:"",children:""}):$t.map(O=>i.jsx("option",{value:O.key,children:O.label},O.key))})]}),Nr&&i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",Nr.rangeLabel]})]}),q==="history"&&ir.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):q==="trash"&&p.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:q==="trash"?"":""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),i.jsx("tbody",{children:(q==="history"?ir:p).map(O=>{const Z=Be(O).filter(Ke=>!ae(Ke?.vendor)),ie=Z.length,ve=Math.round(Z.reduce((Ke,Ze)=>{const ze=parseFloat(Ze?.price)||0,tt=Ze?.quantity===""?0:parseFloat(Ze?.quantity)||0;return Ke+ze*tt*at(Ze)},0)),Ce=q==="trash"?`trash-${O.id}`:O.id,Ee=ne(q==="trash"?O.deleted_at:O.snapshot_date),ke=Qe?.type==="move"&&Qe?.id===O.id,Ue=Qe?.type==="restore"&&Qe?.id===O.id,Le=Qe?.type==="hard-delete"&&Qe?.id===O.id,He=ke||Ue||Le;return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Ee}),i.jsx("td",{style:{padding:"10px"},children:O.title||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:ie.toLocaleString()}),i.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",ve.toLocaleString()]}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:q==="history"?i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>rl(O),disabled:ie===0||He,title:ie===0?"items CSV":"CSV",children:" CSV"}),i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>J(O),disabled:He,children:""}),i.jsx(be,{variant:"danger",size:"sm",onClick:()=>nl(O),disabled:He,title:"",children:ke?"...":""})]}):i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>rl(O),disabled:ie===0||He,children:" CSV"}),i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>J(O),disabled:He,children:""}),i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>Mo(O),disabled:He,title:"",children:Ue?"...":""}),i.jsx(be,{variant:"danger",size:"sm",onClick:()=>Vi(O),disabled:He,title:"",children:Le?"...":""})]})})]},Ce)})})]})})]}),i.jsx(Jn,{isOpen:!!ge,onClose:()=>{Pe||Ne(null)},title:ge?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:ge?.message}),ge?.requireText&&i.jsxs("div",{style:{marginTop:"14px"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",i.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:ge.requireText})," "]}),i.jsx("input",{type:"text",value:_e,onChange:O=>Me(O.target.value),placeholder:ge.requireText,disabled:Pe,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(be,{variant:"ghost",disabled:Pe,onClick:()=>{Pe||Ne(null)},children:""}),i.jsx(be,{variant:"danger",disabled:Pe||!!ge?.requireText&&_e!==ge.requireText,onClick:()=>ge?.onConfirm&&ge.onConfirm(),children:Pe?ge?.loadingLabel||"...":ge?.confirmLabel||""})]})]})}),i.jsx(Jn,{isOpen:!!fe,onClose:()=>J(null),title:fe?` ${fe.title||""}`:" ",size:"large",children:(()=>{const O=fe;if(!O)return null;const ve=[...Be(O).filter(Ee=>ae(Ee?.vendor)?!1:bt?(Ee?.quantity===""?0:parseFloat(Ee?.quantity)||0)!==0:!0)].sort((Ee,ke)=>{const Ue=mt.direction==="desc"?-1:1;if(mt.key==="vendor"){const tt=(Ee?.vendor||"").toString(),Jt=(ke?.vendor||"").toString(),Kt=tt.localeCompare(Jt,"ja");if(Kt!==0)return Kt*Ue;const Bs=(Ee?.name||"").toString(),Jr=(ke?.name||"").toString();return Bs.localeCompare(Jr,"ja")*Ue}const Le=(Ee?.name||"").toString(),He=(ke?.name||"").toString(),Ke=Le.localeCompare(He,"ja");if(Ke!==0)return Ke*Ue;const Ze=(Ee?.vendor||"").toString(),ze=(ke?.vendor||"").toString();return Ze.localeCompare(ze,"ja")*Ue}),Ce=ve.reduce((Ee,ke)=>{const Ue=parseFloat(ke?.price)||0,Le=ke?.quantity===""?0:parseFloat(ke?.quantity)||0,He=Ue*Le;return Ee.net+=He,Ee.taxed+=He*at(ke),Ee},{net:0,taxed:0});return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[i.jsxs("div",{children:[": ",i.jsx("strong",{children:ne(O.snapshot_date)})]}),i.jsxs("div",{children:[": ",i.jsx("strong",{children:ve.length.toLocaleString()})]}),i.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",i.jsxs("strong",{children:["",Math.round(Ce.net).toLocaleString()," / ",Math.round(Ce.taxed).toLocaleString()]})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:bt,onChange:Ee=>Nt(Ee.target.checked)}),"0"]}),i.jsx(be,{variant:"secondary",size:"sm",onClick:()=>rl(O),children:" CSV (.csv)"})]}),ve.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{et(Ee=>Ee.key==="vendor"?{key:"vendor",direction:Ee.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",mt.key==="vendor"&&(mt.direction==="asc"?"":"")]})]})}),i.jsx("tbody",{children:ve.map((Ee,ke)=>{const Ue=parseFloat(Ee?.price)||0,Le=Ee?.quantity===""?0:parseFloat(Ee?.quantity)||0,He=Math.round(Ue*Le*at(Ee)),Ke=el(Ee),Ze=pt(Ke);return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsxs("td",{style:{padding:"10px"},children:[Ee?.name||"-",xe(Ee?.tax10)&&i.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),i.jsx("td",{style:{padding:"10px"},children:Ze}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Ue?`${Math.round(Ue).toLocaleString()}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:Ee?.unit||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Le?Le.toLocaleString():"0"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:He?`${He.toLocaleString()}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:Ee?.vendor||"-"})]},Ee?.id||`${Ee?.name||"item"}-${ke}`)})})]})})]})})()}),i.jsx(Jn,{isOpen:Q,onClose:is,title:"",size:"small",children:(()=>{const O=H,Z=O?._master?.packetUnit||"",ie=O?.unit||"",ve=Oe(ie,Z),Ce=ve!==null&&ve!==1,Ee=parseFloat(O?.price)||0,ke=O?.quantity===""?0:parseFloat(O?.quantity)||0,Ue=O?at(O):1.08,Le=Ee*ke*Ue,He=Z?$e(O?._master,Z):null,Ke=He===null?null:He*ke*Ue,Ze=He===null||!Ce?null:He*(ke*ve)*Ue,ze=Jt=>`${Math.round(Jt).toLocaleString()}`,tt=Jt=>Number.isInteger(Jt)?Jt.toLocaleString():Jt.toLocaleString(void 0,{maximumFractionDigits:3});return i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[i.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:O?.name||"-"}),i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",tt(ke)," ",ie," /  ",Ee.toLocaleString()," /  ",ze(Le)]}),!!Z&&i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",Z]})]}),i.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",i.jsx("br",{}),""]})}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[i.jsx(be,{variant:"ghost",type:"button",onClick:is,disabled:z,children:""}),i.jsx(be,{variant:"secondary",type:"button",onClick:()=>Lo({convertQuantity:!1}),isLoading:z,disabled:z||!Z||He===null,title:Ke===null?"":`:  ${ze(Ke)}`,children:""}),Ce&&i.jsx(be,{variant:"primary",type:"button",onClick:()=>Lo({convertQuantity:!0}),isLoading:z,disabled:z||!Z||He===null,title:Ze===null?"":`:  ${ze(Ze)}`,children:""})]})]})})()}),i.jsx(Jn,{isOpen:ct,onClose:()=>wt(!1),title:"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",i.jsx("strong",{children:St?.name}),""]}),i.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",i.jsx("strong",{children:""}),"",i.jsx("br",{}),"CSV"]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx("button",{onClick:()=>wt(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Bo,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),i.jsx(Jn,{isOpen:Rt,onClose:()=>Tn(!1),title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),i.jsxs("h3",{style:{marginBottom:"1rem"},children:[K," "]}),i.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",i.jsx("br",{}),""]}),i.jsx("button",{onClick:()=>Tn(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),i.jsx(Jn,{isOpen:!!zn,onClose:()=>Ut(null),title:zn?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[zn?.type==="success"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),zn?.type==="error"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),i.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:zn?.message}),i.jsx("button",{onClick:()=>Ut(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:zn?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},Vx=n=>`planner_data_${n}`,Zl=n=>{try{if(!n)return{};let t=localStorage.getItem(Vx(n));return t?JSON.parse(t):{}}catch{return{}}},nu=(n,t)=>{n&&localStorage.setItem(Vx(n),JSON.stringify(t))},Ia={getAll:async n=>Zl(n),cleanupInvalidPlans:async(n,t)=>{const s=Zl(n);let l=!1;const c=new Set(t);return Object.keys(s).forEach(u=>{const d=s[u].length;s[u]=s[u].filter(f=>c.has(f.recipeId)),s[u].length!==d&&(l=!0),s[u].length===0&&(delete s[u],l=!0)}),l&&nu(n,s),s},addMeal:async(n,t,s,l)=>{const c=Zl(n);c[t]||(c[t]=[]);const u={id:Date.now().toString(),recipeId:s,type:l,note:""};return c[t].push(u),nu(n,c),u},removeMeal:async(n,t,s)=>{const l=Zl(n);l[t]&&(l[t]=l[t].filter(c=>c.id!==s),l[t].length===0&&delete l[t],nu(n,l))},updateMeal:async(n,t,s,l)=>{const c=Zl(n);if(c[t]){const u=c[t].findIndex(d=>d.id===s);u!==-1&&(c[t][u]={...c[t][u],...l},nu(n,c))}}},VN=({recipe:n})=>{const{attributes:t,listeners:s,setNodeRef:l,transform:c}=np({id:`recipe-${n.id}`,data:{recipe:n}}),u=c?{transform:`translate3d(${c.x}px, ${c.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:l,style:u,...s,...t,className:"draggable-recipe",children:n.title})},YN=({meal:n,dateStr:t,children:s})=>{const{attributes:l,listeners:c,setNodeRef:u,transform:d}=np({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),f=d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:u,style:f,...c,...l,className:"draggable-meal-wrapper",children:s})},KN=({dateStr:n,dayNum:t,isToday:s,isOutside:l,children:c})=>{const{setNodeRef:u,isOver:d}=ko({id:`date-${n}`,data:{dateStr:n}});return i.jsxs("div",{ref:u,className:`calendar-cell ${s?"today":""} ${l?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[i.jsx("div",{className:"day-number",children:t}),c]})},QN=({onBack:n,onSelectRecipe:t})=>{const{user:s}=fi(),l=Do(),[c,u]=w.useState([]),[d,f]=w.useState({}),[p,g]=w.useState(new Date),[y,v]=w.useState(""),[x,S]=w.useState(!1),[C,E]=w.useState(null),_=Qa(fr(Ru,{activationConstraint:{distance:8}})),T=w.useCallback(async()=>{const Q=await Nn.fetchRecipes(s);if(u(Q),s?.id){const G=Q.map(W=>W.id),H=await Ia.cleanupInvalidPlans(s.id,G);f(H)}},[s]);w.useEffect(()=>{const Q=setTimeout(()=>{T()},0);return()=>clearTimeout(Q)},[T]);const D=async Q=>{const{active:G,over:H}=Q;if(H&&H.id.startsWith("date-")){const W=H.data.current.dateStr;if(G.id.startsWith("recipe-")){const z=G.data.current.recipe;await Ia.addMeal(s.id,W,z.id,"dinner"),T()}else if(G.id.startsWith("meal-")){const{meal:z,dateStr:I}=G.data.current;if(I===W)return;await Ia.addMeal(s.id,W,z.recipeId,z.type||"dinner"),await Ia.removeMeal(s.id,I,z.id),T()}}},B=async(Q,G,H)=>{H&&H.stopPropagation(),E({dateStr:Q,mealId:G}),S(!0)},P=async()=>{if(!C)return;const{dateStr:Q,mealId:G}=C;S(!1),E(null);try{await Ia.removeMeal(s.id,Q,G),await T(),l.success("")}catch(H){l.error(""),console.error("Delete meal error:",H)}},$=()=>{S(!1),E(null)},j=()=>{const Q=p.getFullYear(),G=p.getMonth(),H=new Date(Q,G,1),W=new Date(Q,G+1,0),z=[],I=H.getDay();for(let L=I-1;L>=0;L--){const K=new Date(Q,G,-L);z.push({date:K,isOutside:!0})}for(let L=1;L<=W.getDate();L++){const K=new Date(Q,G,L);z.push({date:K,isOutside:!1})}const N=42-z.length;for(let L=1;L<=N;L++){const K=new Date(Q,G+1,L);z.push({date:K,isOutside:!0})}return z},M=Q=>`${Q.getFullYear()}-${String(Q.getMonth()+1).padStart(2,"0")}-${String(Q.getDate()).padStart(2,"0")}`,A=c.filter(Q=>Q.title.toLowerCase().includes(y.toLowerCase())),F=Q=>{g(new Date(p.getFullYear(),p.getMonth()+Q,1))};return i.jsxs("div",{className:"planner-container fade-in",children:[x&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(fn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("strong",{children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(be,{variant:"ghost",onClick:$,children:""}),i.jsx(be,{variant:"danger",onClick:P,children:""})]})]})}),i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(be,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx(Pi,{onDragEnd:D,sensors:_,children:i.jsxs("div",{className:"planner-layout",children:[i.jsxs("div",{className:"recipe-sidebar",children:[i.jsx("div",{className:"sidebar-search",children:i.jsx(xt,{placeholder:"...",value:y,onChange:Q=>v(Q.target.value)})}),i.jsx("div",{className:"draggable-list",children:A.map(Q=>i.jsx(VN,{recipe:Q},Q.id))})]}),i.jsxs("div",{className:"planner-calendar",children:[i.jsxs("div",{className:"calendar-header",children:[i.jsx(be,{variant:"ghost",onClick:()=>F(-1),children:" "}),i.jsxs("h3",{style:{margin:0},children:[p.getFullYear()," ",p.getMonth()+1,""]}),i.jsx(be,{variant:"ghost",onClick:()=>F(1),children:" "})]}),i.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(Q=>i.jsx("div",{className:"calendar-day-header",children:Q},Q)),j().map((Q,G)=>{const H=M(Q.date),W=d[H]||[],z=H===M(new Date);return i.jsx(KN,{dateStr:H,dayNum:Q.date.getDate(),isToday:z,isOutside:Q.isOutside,children:W.map(I=>{const N=c.find(L=>L.id===I.recipeId);return i.jsx(YN,{meal:I,dateStr:H,children:i.jsxs("div",{className:"planned-meal",title:N?.title,onClick:()=>N&&t&&t(N),children:[i.jsx("span",{children:N?.title||"Unknown"}),i.jsx("span",{className:"delete-meal-btn",onPointerDown:L=>{L.stopPropagation()},onClick:L=>B(H,I.id,L),children:""})]})},I.id)})},G)})]})]})]})})]})},WN=({onBack:n})=>{const{user:t}=fi(),s=Do(),[l,c]=w.useState(new Date().toISOString().slice(0,10)),[u,d]=w.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[f,p]=w.useState([]),[g,y]=w.useState(!1),[v,x]=w.useState(!1),[S,C]=w.useState(!1),[E,_]=w.useState(!1),T=async()=>{y(!0);try{if(!t?.id){s.error(""),y(!1);return}const j=await Ia.getAll(t.id),M=new Date(l),A=new Date(u);A.setHours(23,59,59,999);const F=[];if(Object.keys(j).forEach(fe=>{const J=new Date(fe);J>=M&&J<=A&&j[fe].forEach(q=>{F.push(q.recipeId)})}),F.length===0){s.info(""),x(!1);return}const Q=await Nn.fetchRecipes(t),G=F.map(fe=>Q.find(J=>J.id===fe)).filter(Boolean),H=fe=>(fe??"").toString().trim(),W=fe=>{const J=H(fe);if(!J)return"";const q=J.toLowerCase();return q===""?"g":q===""?"ml":q===""?"cc":q===""?"kg":q===""?"l":q},z=fe=>{const J=H(fe);return J?["","","","","","","","PC","pc",""].includes(J):!1},I=(fe,J)=>{const q=parseFloat(fe)||0,le=W(J);return le==="kg"?{qty:q*1e3,unit:"g"}:le==="g"?{qty:q,unit:"g"}:le==="l"?{qty:q*1e3,unit:"ml"}:le==="cc"?{qty:q,unit:"ml"}:le==="ml"?{qty:q,unit:"ml"}:{qty:q,unit:H(J)||""}},N=(fe,J,q,le)=>{const ge=H(q),Ne=parseFloat(J)||0;if(!le)return I(Ne,ge);const _e=parseFloat(le.packetSize),Me=W(le.packetUnit);if(!Number.isFinite(_e)||_e<=0||!Me)return I(Ne,ge);if(["g","kg","ml","cc","l"].includes(Me)&&z(ge)){const me=Ne*_e;return I(me,Me)}return I(Ne,ge)},[L,K,oe,he]=await Promise.all([$n.getAllConversions(),nr.fetchPriceList(t.id),Kn.getAll(t.id),bu.getAll(t.id)]),U=new Map;try{for(const[fe,J]of(L||new Map).entries()){const q=bn(fe);q&&(U.has(q)||U.set(q,J))}}catch{}const V=new Map;try{for(const[fe,J]of(he||new Map).entries()){const q=bn(fe);q&&(V.has(q)||V.set(q,J))}}catch{}const k=new Map;try{(oe||[]).forEach(fe=>{const J=bn(fe?.name);J&&(k.has(J)||k.set(J,fe))})}catch{}const te={};G.forEach(fe=>{[...fe.ingredients||[],...fe.flours||[],...fe.breadIngredients||[]].forEach(le=>{if(!le.name)return;const ge=H(le.name),Ne=bn(ge),_e=(Ne?U.get(Ne):null)||L?.get(ge)||null,Me=N(ge,le.quantity,le.unit,_e),Pe=Me.qty||0,me=Me.unit||"";te[ge]||(te[ge]={quantity:0,unit:me,count:0}),te[ge].quantity+=Pe})});const de=Object.keys(te).map(fe=>{const J=te[fe],q=bn(fe),le=(q?U.get(q):null)||L?.get(fe)||null,ge=q&&K?.get(q)||null,Ne=q&&k.get(q)||null,_e=N(fe,Ne?.quantity??0,Ne?.unit??J.unit,le),Me=J.quantity||0,Pe=_e.qty||0,me=J.unit||_e.unit||"",Qe=Pe-Me,Xe=parseFloat(le?.packetSize),bt=H(le?.packetUnit),Nt=Number.isFinite(Xe)&&Xe>0&&!!bt,mt=Nt?Xe*.2:0,et=Nt?Qe<mt:!1,ct=ge?.unit?String(ge.unit).trim():"",wt=q&&V.has(q)?String(V.get(q)).trim():"",St=wt||""||ct||""||"",jt=(le?.lastPrice!==null&&le?.lastPrice!==void 0&&le?.lastPrice!==""?parseFloat(le.lastPrice):null)??(ge?.price!==null&&ge?.price!==void 0?parseFloat(ge.price):null);let lt=null,ut=0,Rt=me;if(Nt){const zn=Math.max(0,mt-Qe);lt=Math.ceil(zn/Xe),et&&lt<1&&(lt=1),ut=lt,Rt=St}else ut=Math.max(0,Me-Pe),Rt=me;const Tn=Nt?et:ut>.01;return{name:fe,required:Me,stock:Pe,remaining:Qe,unit:me,shouldShow:Tn,toOrder:ut,orderUnit:Rt,orderPacks:lt,packSize:Nt?Xe:null,packUnit:Nt?bt:null,packPrice:Number.isFinite(jt)?jt:null,vendor:ge?.vendor||Ne?.vendor||""}}).filter(fe=>fe.shouldShow);p(de),x(!0)}catch(j){console.error(j),s.error("")}finally{y(!1)}},D=()=>{C(!0)},B=()=>{_(!0)},P=()=>f.map(j=>{if(Number.isFinite(j.orderPacks)&&j.orderPacks!==null){const M=j.packSize&&j.packUnit?`1${j.orderUnit}=${j.packSize}${j.packUnit}`:"";return`${j.name}: ${j.orderPacks}${j.orderUnit}${M}`}return`${j.name}: ${Number(j.toOrder||0).toFixed(1)}${j.unit}`}).join(`
`),$=async()=>{const j=document.getElementById("copy-textarea");if(j){j.select();try{await navigator.clipboard.writeText(j.value),s.success("")}catch{document.execCommand("copy"),s.success("")}}};return i.jsxs("div",{className:"order-list-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(be,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx("div",{className:"filter-card",children:i.jsxs("div",{className:"date-range-inputs",children:[i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:l,onChange:j=>c(j.target.value)})]}),i.jsx("span",{children:""}),i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:u,onChange:j=>d(j.target.value)})]}),i.jsx(be,{variant:"primary",onClick:T,disabled:g,children:g?"...":""})]})}),v&&i.jsxs("div",{className:"order-results",children:[i.jsxs("div",{className:"results-header",children:[i.jsxs("h3",{children:[" (",f.length,")"]}),i.jsxs("div",{className:"result-actions",children:[i.jsx(be,{variant:"secondary",onClick:D,children:" "}),i.jsx(be,{variant:"secondary",onClick:B,children:" "})]})]}),i.jsxs("table",{className:"order-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:f.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):f.map((j,M)=>i.jsxs("tr",{children:[i.jsx("td",{children:j.name}),i.jsxs("td",{style:{textAlign:"right"},children:[j.required.toFixed(1)," ",j.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,j.remaining??0).toFixed(1)," ",j.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(j.orderPacks)&&j.orderPacks!==null?i.jsxs(i.Fragment,{children:[j.orderPacks,j.orderUnit,j.packSize&&j.packUnit&&i.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",j.orderUnit," = ",Number(j.packSize).toLocaleString(),j.packUnit,j.packPrice?` / ${Math.round(j.packPrice).toLocaleString()}`:""]})]}):i.jsxs(i.Fragment,{children:[j.toOrder.toFixed(1)," ",i.jsx("span",{style:{fontSize:"0.8em"},children:j.unit})]})})]},M))})]})]}),i.jsx(Jn,{isOpen:S,onClose:()=>C(!1),title:" ",size:"medium",children:i.jsxs("div",{className:"copy-modal-content",children:[i.jsx("p",{className:"copy-instructions",children:""}),i.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:P(),onClick:j=>j.target.select()}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(be,{variant:"primary",onClick:$,children:" "}),i.jsx(be,{variant:"ghost",onClick:()=>C(!1),children:""})]})]})}),i.jsx(Jn,{isOpen:E,onClose:()=>_(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-content",children:[i.jsxs("div",{className:"print-preview-header",children:[i.jsx("h3",{children:""}),i.jsxs("p",{className:"print-period",children:[": ",l,"  ",u]})]}),i.jsxs("table",{className:"print-preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:f.map((j,M)=>i.jsxs("tr",{children:[i.jsx("td",{children:j.name}),i.jsxs("td",{style:{textAlign:"right"},children:[j.required.toFixed(1)," ",j.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,j.remaining??0).toFixed(1)," ",j.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(j.orderPacks)&&j.orderPacks!==null?`${j.orderPacks}${j.orderUnit}`:`${j.toOrder.toFixed(1)} ${j.unit}`})]},M))})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(be,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(be,{variant:"ghost",onClick:()=>_(!1),children:""})]})]})})]})},eo=async(n,t,s)=>{let l=null;try{const c=new Promise((u,d)=>{l=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,c])}finally{l&&clearTimeout(l)}},y0=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},XN=({children:n})=>{const[t,s]=w.useState(null),[l,c]=w.useState(!0),[u,d]=w.useState(!1),f=w.useCallback(async _=>{if(!_){s(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const T=_.id,D=_.email||"";try{const G=localStorage.getItem("auth_user_cache");if(G){const H=JSON.parse(G);H&&H.id===T&&s(H)}}catch(G){console.warn("[Auth] Failed to load cache",G)}let B=null,P=0;const $=3;for(;P<$;)try{const[G,H]=await Promise.all([eo(Te.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",T).single().then(I=>({data:I,error:null})).catch(I=>({data:null,error:I})),4e3,"profiles.select(with_email)").catch(I=>({data:null,error:I})),eo(Te.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",T).single().then(I=>({data:I,error:null})).catch(I=>({data:null,error:I})),4e3,"profiles.select").catch(I=>({data:null,error:I}))]);let W=null,z=null;if(G?.data?.data?(W=G.data.data,z=null):H?.data?.data?(W=H.data.data,z=null):z=G?.error??H?.error??new Error("Profile fetch failed"),z)if(z.code==="PGRST116"){const I=_.user_metadata&&_.user_metadata.display_id?String(_.user_metadata.display_id):y0(D)||T.slice(0,8);let N=null,L=null;const K=await eo(Te.from("profiles").insert([{id:T,display_id:I,email:D||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),8e3,"profiles.insert(with_email)");if(N=K?.data??null,L=K?.error??null,L&&String(L.message||"").toLowerCase().includes("email")){const oe=await eo(Te.from("profiles").insert([{id:T,display_id:I,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),8e3,"profiles.insert");N=oe?.data??null,L=oe?.error??null}if(L)throw L;B=N}else throw z;else B=W;if(B&&Object.prototype.hasOwnProperty.call(B,"email")&&D&&!B.email)try{await Te.from("profiles").update({email:D}).eq("id",T)}catch(I){console.warn("Failed to backfill profile email",I)}break}catch(G){console.error(`Failed to load/create profile (Attempt ${P+1}/${$}):`,G),P++,P<$&&await new Promise(H=>setTimeout(H,500*P))}const j=B?.display_id||y0(D)||T.slice(0,8),M=B?.role||"user",A=String(M).trim().toLowerCase(),F=B?.show_master_recipes===!0,Q={id:T,email:D,displayId:j,role:A,showMasterRecipes:F};s(Q);try{localStorage.setItem("auth_user_cache",JSON.stringify(Q))}catch(G){console.warn("[Auth] Failed to save cache",G)}},[]);w.useEffect(()=>{let _=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:T}=Te.auth.onAuthStateChange(async(B,P)=>{B==="PASSWORD_RECOVERY"&&d(!0);try{await f(P?.user||null)}catch($){console.error("Auth state change handler failed:",$)}});return _=T?.subscription,(async()=>{try{const{data:B}=await eo(Te.auth.getSession(),8e3,"auth.getSession");await f(B?.session?.user||null)}catch(B){console.error("Auth init failed:",B)}finally{c(!1)}})(),()=>{try{_?.unsubscribe?.()}catch{}}},[f]);const p=w.useCallback(async(_,T)=>{const{error:D}=await Te.auth.signInWithPassword({email:_,password:T});if(D)throw console.error("Login error:",D),new Error("")},[]),g=w.useCallback(async(_,T,D)=>{const{data:B,error:P}=await Te.auth.signUp({email:_,password:T,options:{data:{display_id:D}}});if(P)throw console.error("SignUp error:",P),new Error(P.message||"");const $=B?.user;if($?.id){let j=null;j=(await Te.from("profiles").insert([{id:$.id,display_id:D,email:_||null,role:"user",show_master_recipes:!1}]))?.error??null,j&&String(j.message||"").toLowerCase().includes("email")&&(j=(await Te.from("profiles").insert([{id:$.id,display_id:D,role:"user",show_master_recipes:!1}]))?.error??null),j&&j.code!=="23505"&&console.error("Profile create error:",j)}return{needsEmailConfirmation:!B?.session}},[]),y=w.useCallback(async()=>{await Te.auth.signOut(),s(null),d(!1)},[]),v=w.useCallback(_=>{!_||typeof _!="object"||s(T=>T&&{...T,..._})},[]),x=w.useCallback(async _=>{const{error:T}=await Te.auth.resetPasswordForEmail(_,{redirectTo:window.location.origin});if(T)throw console.error("Password reset email error:",T),new Error("");return!0},[]),S=w.useCallback(async _=>{const{error:T}=await Te.auth.updateUser({password:_});if(T)throw console.error("Update password error:",T),new Error("");return!0},[]),C=w.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),E=w.useMemo(()=>({user:t,loading:l,login:p,register:g,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:S,finishPasswordRecovery:C}),[t,l,p,g,y,v,x,u,S,C]);return i.jsx(Ox.Provider,{value:E,children:n})},JN=({id:n,message:t,type:s="info",onClose:l})=>{w.useEffect(()=>{const u=setTimeout(()=>{l(n)},3e3);return()=>clearTimeout(u)},[n,l]);const c=()=>{switch(s){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return i.jsxs("div",{className:`toast toast-${s}`,children:[i.jsx("div",{className:"toast-icon",children:c()}),i.jsx("div",{className:"toast-message",children:t}),i.jsx("button",{className:"toast-close",onClick:()=>l(n),"aria-label":"",children:""})]})},ZN=({toasts:n,onRemove:t})=>n.length===0?null:i.jsx("div",{className:"toast-container",children:n.map(s=>i.jsx(JN,{id:s.id,message:s.message,type:s.type,onClose:t},s.id))}),eR=({children:n})=>{const[t,s]=w.useState([]),l=w.useCallback((d,f="info")=>{const p=Date.now()+Math.random();s(g=>[...g,{id:p,message:d,type:f}].slice(-5))},[]),c=w.useCallback(d=>{s(f=>f.filter(p=>p.id!==d))},[]),u={showToast:l,success:d=>l(d,"success"),error:d=>l(d,"error"),warning:d=>l(d,"warning"),info:d=>l(d,"info")};return i.jsxs(Fx.Provider,{value:u,children:[n,i.jsx(ZN,{toasts:t,onRemove:c})]})},tR=()=>{const[n,t]=w.useState(!0),[s,l]=w.useState(!1),[c,u]=w.useState(""),[d,f]=w.useState(""),[p,g]=w.useState(""),[y,v]=w.useState(""),[x,S]=w.useState(""),[C,E]=w.useState(!1),[_,T]=w.useState(!1);Ae.useEffect(()=>{const A=localStorage.getItem("savedEmail"),F=localStorage.getItem("savedPassword");A&&(u(A),F&&f(F),T(!0))},[]);const{login:D,register:B,sendPasswordResetEmail:P}=fi(),$=async A=>{A.preventDefault(),v(""),S(""),E(!0);try{await D(c.trim(),d),_?(localStorage.setItem("savedEmail",c.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(F){v(F.message||"")}finally{E(!1)}},j=async A=>{A.preventDefault(),v(""),S(""),E(!0);try{if(!p.trim()){v("ID: yoshito");return}(await B(c.trim(),d,p.trim()))?.needsEmailConfirmation?S(""):S(""),t(!0),f("")}catch(F){v(F.message||"")}finally{E(!1)}},M=async A=>{A.preventDefault(),v(""),S(""),E(!0);try{await P(c.trim()),S(""),l(!1)}catch(F){v(F.message||"")}finally{E(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(fn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[i.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",i.jsx("br",{}),"Management"]}),i.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:s?"":n?"":""})]}),y&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),i.jsxs("form",{onSubmit:s?M:n?$:j,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"email",value:c,onChange:A=>u(A.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:d,onChange:A=>f(A.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&!n&&i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",i.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),i.jsx("input",{type:"text",value:p,onChange:A=>g(A.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!s&&i.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[i.jsx("input",{type:"checkbox",id:"rememberMe",checked:_,onChange:A=>T(A.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),i.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),i.jsx(be,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:C,children:s?"":n?"":""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s?i.jsx("button",{type:"button",onClick:()=>{l(!1),v(""),S("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):i.jsx("button",{type:"button",onClick:()=>{l(!0),v(""),S("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!s&&i.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),S("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},nR=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:s}=fi(),[l,c]=Ae.useState(""),[u,d]=Ae.useState(""),[f,p]=Ae.useState(""),[g,y]=Ae.useState(""),[v,x]=Ae.useState(!1),S=async C=>{if(C.preventDefault(),p(""),y(""),!l||l.length<8){p("8");return}if(l!==u){p("");return}x(!0);try{await n(l),y(""),t()}catch(E){console.error(E),p(E.message||"")}finally{x(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(fn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),i.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),f&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:f}),g&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:g}),i.jsxs("form",{onSubmit:S,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:l,onChange:C=>c(C.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:u,onChange:C=>d(C.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsx(be,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[i.jsx(be,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),i.jsx(be,{variant:"ghost",onClick:s,style:{flex:1},children:""})]})]})})},v0=({label:n,subLabel:t,variant:s="screen",showLogo:l=!0})=>i.jsxs("div",{className:s==="screen"?"loading-screen":"loading-inline",children:[l&&i.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),i.jsxs("div",{className:"loading-text",children:[n,i.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[i.jsx("span",{children:"."}),i.jsx("span",{children:"."}),i.jsx("span",{children:"."})]})]}),i.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&i.jsx("div",{className:"loading-subtext",children:t})]});function rR(){const{user:n,logout:t,loading:s,isPasswordRecovery:l}=fi(),c=Do(),[u,d]=Kf(),[f,p]=w.useState([]),[g,y]=w.useState(!0),[v,x]=w.useState(0),[S,C]=w.useState([]),[E,_]=w.useState(!1),[T,D]=w.useState({}),[B,P]=w.useState({}),$=u.get("view"),j=($==="create-mock"?"create":$)||"list",M=u.get("id"),A=f.find(ne=>String(ne.id)===M)||null,[F,Q]=w.useState(""),[G,H]=w.useState(null),[W,z]=w.useState(null),[I,N]=w.useState(""),[L,K]=w.useState("none"),[oe,he]=w.useState(!1),[U,V]=w.useState(!1),[k,te]=w.useState(new Set),[de,fe]=w.useState("normal"),[J,q]=w.useState(!1),[le,ge]=w.useState(null),[Ne,_e]=w.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),Me={inventory:"",planner:"",data:"",users:"","order-list":""};w.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const ne=window.matchMedia("(max-width: 700px)"),Be=()=>_e(!!ne.matches);return Be(),ne.addEventListener?ne.addEventListener("change",Be):ne.addListener(Be),()=>{ne.removeEventListener?ne.removeEventListener("change",Be):ne.removeListener(Be)}},[]),w.useEffect(()=>{if(!Ne||!Me[j]||typeof window>"u")return;const ne=`pc-recommend-shown:${j}`;try{if(window.sessionStorage.getItem(ne)==="1")return;window.sessionStorage.setItem(ne,"1")}catch{}ge(j)},[j,Ne]),w.useEffect(()=>{j!=="list"&&K("none")},[j]),w.useEffect(()=>{if(!s){_(!1);return}const ne=setTimeout(()=>_(!0),3500);return()=>clearTimeout(ne)},[s]),w.useEffect(()=>{s||n&&(async()=>{try{const ne=j==="trash"?tn():mt();await Promise.all([ne,Nt(),Xe()])}catch(ne){console.error("Error during initial data load:",ne)}})()},[s,n?.id]),w.useEffect(()=>{if(s)return;if(!n||n.role!=="admin"){D({}),P({});return}let ne=!1;return(async()=>{try{const Be=await no.fetchAllProfiles();if(ne)return;const X={},re={};for(const ae of Be||[])ae?.id&&(X[String(ae.id)]=ae),ae?.display_id&&(re[String(ae.display_id)]=ae);D(X),P(re)}catch(Be){console.warn("Failed to load profiles for admin owner labels",Be)}})(),()=>{ne=!0}},[s,n?.id,n?.role]);const Pe=ne=>{const X=(ne?.tags||[]).find(xe=>xe&&xe.startsWith("owner:"));if(!X)return"/";const re=String(X.slice(6)),ae=T[re]||B[re]||null;return ae?ae.display_id||ae.email||re:re.length>12?`${re.slice(0,8)}`:re},me=Qa(fr(Ro,{activationConstraint:{distance:10}}),fr(To,{activationConstraint:{delay:1e3,tolerance:5}}),fr(Xa,{coordinateGetter:ku})),Qe=ne=>{const{active:Be,over:X}=ne;Be.id!==X.id&&p(re=>{const ae=re.findIndex(Oe=>Oe.id===Be.id),xe=re.findIndex(Oe=>Oe.id===X.id);if(ae===-1||xe===-1)return re;const Re=Hi(re,ae,xe),$e=Re.map((Oe,De)=>({id:Oe.id,order_index:De}));return Nn.updateOrder($e).catch(Oe=>console.error("Order update failed",Oe)),Re})},Xe=async()=>{try{const ne=await Nn.fetchRecentRecipes();C(ne||[])}catch(ne){console.error("Failed to load history:",ne)}},bt=async ne=>{const Be=[ne,...S.filter(X=>X!==ne)].slice(0,20);C(Be);try{await Nn.addToHistory(ne)}catch(X){console.error("Failed to sync history",X)}},Nt=async()=>{try{const ne=await Nn.getDeletedCount();x(ne||0)}catch(ne){console.error("Failed to load trash count:",ne)}},mt=async()=>{try{y(!0);const ne=await Nn.fetchRecipes(n,{timeoutMs:15e3});p(ne||[])}catch(ne){console.error("Failed to fetch recipes:",ne),c.error(`

(${ne?.message||"unknown error"})`)}finally{y(!1)}},et=ne=>(ne||"").toString().replace(/\s+/g," ").trim(),ct=ne=>et(ne).toLowerCase(),wt="__NO_STORE__",St="__OTHER_STORE__",jt=[...new Set(f.map(ne=>et(ne.course)).filter(Boolean))],lt=[...new Set(f.map(ne=>et(ne.category)).filter(Boolean))],ut=f.reduce((ne,Be)=>{const X=ct(Be.storeName);return X&&(ne[X]=(ne[X]||0)+1),ne},{}),Rt=new Set(lu.map(ne=>ct(ne)).filter(Boolean)),Tn=f.reduce((ne,Be)=>ct(Be.storeName)?ne:ne+1,0),zn=f.reduce((ne,Be)=>{const X=ct(Be.storeName);return X?Rt.has(X)?ne:ne+1:ne},0),Ut=f.reduce((ne,Be)=>{const X=ct(Be.course);return X&&(ne[X]=(ne[X]||0)+1),ne},{}),Er=f.reduce((ne,Be)=>{const X=ct(Be.category);return X&&(ne[X]=(ne[X]||0)+1),ne},{}),qn=f.filter(ne=>{const Be=ct(F),X=F===""||F==="recent"&&S.includes(ne.id)||ne.tags&&ne.tags.includes(F)||F===wt&&!ct(ne.storeName)||F===St&&ct(ne.storeName)&&!Rt.has(ct(ne.storeName))||ne.category&&ct(ne.category)===Be||ne.course&&ct(ne.course)===Be||ne.storeName&&ct(ne.storeName)===Be,re=I.toLowerCase().trim(),ae=!re||ne.title.toLowerCase().includes(re)||ne.description&&ne.description.toLowerCase().includes(re)||ne.ingredients&&ne.ingredients.some(xe=>xe.name.toLowerCase().includes(re));return X&&ae}),Xt=F===""&&!I.trim()&&j==="list",an=(ne,Be={})=>{d({view:"detail",id:ne.id,...Be})},ln=async(ne,Be=!1)=>{try{if(ne.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&ne.tags.some(re=>re==="owner:yoshito")){c.warning("");return}Be?(await Nn.restoreRecipe(ne.id),(j==="trash"||j==="detail")&&(d({view:"trash"}),tn()),c.success("")):(await Nn.deleteRecipe(ne.id),p(f.filter(X=>X.id!==ne.id)),d({view:"list"}),Nt())}catch(X){console.error("Failed to delete/restore recipe:",X),c.error("")}finally{Nt()}},on=async ne=>{try{await Nn.hardDeleteRecipe(ne.id),p(f.filter(Be=>Be.id!==ne.id)),d({view:"trash"}),c.success(""),tn(),Nt()}catch(Be){console.error("Failed to hard delete recipe:",Be),c.error("")}},tn=async()=>{try{y(!0);const ne=await Nn.fetchDeletedRecipes();p(ne||[]),Q("")}catch(ne){console.error("Failed to fetch deleted recipes:",ne)}finally{y(!1)}},$r=()=>{d({view:"trash"}),tn()},Un=()=>{d({view:"list"}),mt()},nn=async(ne,Be)=>{try{let X,re=Be;if(Be&&n.role!=="admin"){const ae=ne.tags?.find(Re=>Re.startsWith("owner:"));ae===`owner:${n.id}`||n.displayId&&ae===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${ae||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),re=!1)}re?(X=await Nn.updateRecipe(ne,n),p(f.map(ae=>ae.id===X.id?X:ae))):(X=await Nn.createRecipe(ne,n),p([X,...f])),d(re?{view:"detail",id:X.id}:{view:"detail",id:X.id})}catch(X){console.error("Failed to save recipe:",X),c.error(`
: ${X.message||X.error_description||JSON.stringify(X)}`)}},Lt=(ne,Be="")=>{const re=["","baker","","","","dough","fermentation"].some(rt=>(ne.title||"").toLowerCase().includes(rt)),ae=["flour","","","","","","","","",""],xe=["yeast","","",""],Re=ne.ingredients||[],$e=Re.some(rt=>xe.some(pt=>(rt.name||"").toLowerCase().includes(pt))),Oe=Re.some(rt=>ae.some(pt=>(rt.name||"").toLowerCase().includes(pt))&&!rt.name.includes(""));if(Re.some(rt=>rt.quantity&&String(rt.quantity).includes("%")||rt.unit&&String(rt.unit).includes("%"))||$e||re&&Oe){ne.type="bread",ne.flours=[],ne.breadIngredients=[];const rt=["flour","","","","","","","",""];if(Re.forEach(pt=>{rt.some(Ie=>(pt.name||"").includes(Ie))?ne.flours.push(pt):ne.breadIngredients.push(pt)}),ne.flours.length===0&&Re.length>0){const pt=Re[0];(pt.name||"").includes("")&&(ne.flours.push(pt),ne.breadIngredients=ne.breadIngredients.filter(gn=>gn!==pt))}}ne.sourceUrl=Be,Be&&(ne.category="URL"),z(ne),d({view:"create"})},Je=()=>{V(!U),te(new Set)},Bt=ne=>{const Be=new Set(k);Be.has(ne)?Be.delete(ne):Be.add(ne),te(Be)},pn=()=>{q(!0)},cn=()=>{q(!1)},Ot=async()=>{q(!1);try{y(!0),j==="trash"?(await Promise.all(Array.from(k).map(ne=>Nn.hardDeleteRecipe(ne))),tn()):(await Promise.all(Array.from(k).map(ne=>Nn.deleteRecipe(ne))),p(f.filter(ne=>!k.has(ne.id))),Nt()),te(new Set),V(!1),c.success("")}catch(ne){console.error("Bulk delete failed",ne),c.warning(""),j==="trash"?tn():mt()}finally{y(!1)}},mn=async()=>{if(window.confirm(`${k.size}`))try{y(!0);for(const ne of k)await Nn.restoreRecipe(ne);p(f.filter(ne=>!k.has(ne.id))),Nt(),V(!1),te(new Set),c.success(""),tn()}catch(ne){console.error("Bulk restore failed",ne),c.warning(""),tn()}finally{y(!1)}},kt=()=>{const ne=qn.map(Be=>Be.id);te(new Set(ne))},gt=ne=>{p([ne,...f]),d({view:"edit",id:ne.id})};return w.useEffect(()=>{s||n&&(j==="trash"?tn():j==="list"&&mt())},[j,s,n?.id]),s&&!E?i.jsx(v0,{label:"",subLabel:""}):n?l?i.jsx(nR,{}):i.jsxs(Sj,{children:[J&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(fn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",k.size,"",j==="trash"?"":""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:j==="trash"?"":""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(be,{variant:"ghost",onClick:cn,children:""}),i.jsx(be,{variant:"danger",onClick:Ot,children:j==="trash"?"":""})]})]})}),i.jsx(Jn,{isOpen:!!le,onClose:()=>ge(null),title:"PC",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[i.jsx("p",{style:{marginTop:0},children:Me[le]?i.jsxs(i.Fragment,{children:["",i.jsx("strong",{children:Me[le]}),"/"]}):i.jsx(i.Fragment,{children:"/"})}),i.jsxs("p",{style:{marginBottom:0},children:["",i.jsx("strong",{children:"PC"}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[i.jsx(be,{variant:"ghost",onClick:()=>{ge(null),d({view:"list"})},children:""}),i.jsx(be,{variant:"primary",onClick:()=>ge(null),children:"OK"})]})]})}),(j==="list"||j==="trash")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"container-header",children:[i.jsxs("h2",{className:"section-title",children:[j==="trash"?" ()":"",j==="list"&&i.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",f.length,")"]})]}),i.jsx("div",{className:"header-actions",children:j==="list"||j==="trash"?i.jsxs(i.Fragment,{children:[U?i.jsxs(i.Fragment,{children:[i.jsx(be,{variant:"ghost",onClick:Je,children:""}),i.jsx(be,{variant:"secondary",onClick:kt,children:""}),j==="trash"&&i.jsxs(be,{variant:"secondary",onClick:mn,disabled:k.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",k.size,")"]}),i.jsxs(be,{variant:"danger",onClick:pn,disabled:k.size===0,children:[j==="trash"?"":""," (",k.size,")"]})]}):i.jsx(i.Fragment,{children:j==="list"?i.jsx(i.Fragment,{children:i.jsx(be,{onClick:()=>{z(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):i.jsx(be,{variant:"ghost",onClick:Un,children:" "})}),i.jsx("button",{className:"mobile-menu-toggle",onClick:()=>he(!oe),"aria-label":"",children:""}),i.jsxs("div",{className:`secondary-actions ${oe?"open":""}`,children:[i.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>he(!1),"aria-label":"",children:""}),i.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[i.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&i.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&i.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),j==="list"&&i.jsxs(i.Fragment,{children:[i.jsxs(be,{variant:"secondary",onClick:()=>{H("url"),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),i.jsxs(be,{variant:"secondary",onClick:()=>{H("image"),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsx("div",{className:"pc-recommend-note",children:i.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),i.jsxs(be,{variant:"secondary",onClick:()=>{d({view:"inventory"}),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsxs(be,{variant:"secondary",onClick:()=>{d({view:"planner"}),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(be,{variant:"secondary",onClick:()=>{d({view:"data"}),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&i.jsxs(be,{variant:"secondary",onClick:()=>{d({view:"users"}),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(be,{variant:"secondary",onClick:()=>{d({view:"order-list"}),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"})]}),!U&&i.jsxs(be,{variant:"ghost",onClick:()=>{Je(),he(!1)},className:"danger-text",children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," ",j==="trash"?"":""]}),j==="list"&&i.jsxs(be,{variant:"ghost",onClick:()=>{$r(),he(!1)},style:{position:"relative"},children:[i.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&i.jsx("span",{className:"trash-badge",children:v})]}),i.jsxs(be,{variant:"ghost",onClick:()=>{Un(),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(be,{variant:"ghost",onClick:()=>{t(),he(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]}),i.jsx("div",{className:`menu-backdrop ${oe?"open":""}`,onClick:()=>he(!1),"aria-hidden":"true"})]}):null})]}),j==="list"&&i.jsxs("div",{className:"list-toolbar",children:[i.jsxs("div",{className:"search-container search-container--compact",children:[i.jsx("span",{className:"search-icon",children:""}),i.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:I,onChange:ne=>N(ne.target.value)})]}),i.jsxs("div",{className:"public-recipe-toggles",children:[i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${L==="mine"?"active":""}`,"aria-pressed":L==="mine",onClick:()=>K("mine"),children:" "}),i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${L==="others"?"active":""}`,"aria-pressed":L==="others",onClick:()=>K("others"),children:" "}),L!=="none"&&i.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>K("none"),children:" "})]})]}),i.jsxs("div",{className:"tag-filter-container",children:[i.jsxs("select",{className:"store-filter-select",value:F===wt?wt:F===St?St:lu.includes(F)?F:"",onChange:ne=>Q(ne.target.value||""),children:[i.jsx("option",{value:"",children:""}),lu.map(ne=>i.jsxs("option",{value:ne,children:[ne," (",ut[ct(ne)]||0,")"]},ne)),i.jsxs("option",{value:wt,children:[" (",Tn,")"]}),i.jsxs("option",{value:St,children:[" (",zn,")"]})]}),i.jsxs("select",{className:"store-filter-select",value:jt.includes(F)?F:"",onChange:ne=>Q(ne.target.value||""),children:[i.jsx("option",{value:"",children:""}),jt.sort().map(ne=>i.jsxs("option",{value:ne,children:[ne," (",Ut[ct(ne)]||0,")"]},ne))]}),i.jsxs("select",{className:"store-filter-select",value:lt.includes(F)?F:"",onChange:ne=>Q(ne.target.value||""),children:[i.jsx("option",{value:"",children:""}),lt.sort().map(ne=>i.jsxs("option",{value:ne,children:[ne," (",Er[ct(ne)]||0,")"]},ne))]}),i.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[i.jsx("button",{className:`tag-filter-btn ${de==="normal"?"active":""}`,onClick:()=>fe("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),i.jsx("button",{className:`tag-filter-btn ${de==="all"?"active":""}`,onClick:()=>fe("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),g?i.jsx(v0,{label:"",variant:"inline",showLogo:!1}):f.length===0?i.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[j==="trash"?"":"",F!==""&&i.jsx("p",{children:""})]}):i.jsxs("div",{className:"main-content-wrapper",children:[j==="list"&&i.jsx("div",{className:"recent-list-wrapper",children:i.jsx(LN,{recipes:f,recentIds:S,onSelect:an})}),i.jsx("div",{className:"recipe-list-container",children:j==="list"?i.jsx(Pi,{sensors:me,collisionDetection:Cf,onDragEnd:Qe,children:i.jsx(xv,{recipes:qn,onSelectRecipe:an,isSelectMode:U,selectedIds:k,onToggleSelection:Bt,disableDrag:!Xt,displayMode:de,publicRecipeView:L,showOwner:n?.role==="admin",ownerLabelFn:Pe,currentUser:n})}):i.jsx(xv,{recipes:qn,onSelectRecipe:an,isSelectMode:U,selectedIds:k,onToggleSelection:Bt,disableDrag:!0,displayMode:de,publicRecipeView:L,showOwner:n?.role==="admin",ownerLabelFn:Pe,currentUser:n})})]})]}),j==="detail"&&A&&i.jsx(hN,{recipe:A,ownerLabel:n?.role==="admin"?Pe(A):void 0,isDeleted:!!A.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):A.deletedAt?$r():Un()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?Un:void 0,onEdit:()=>d({view:"edit",id:A.id,from:u.get("from")}),onDelete:ln,onView:bt,onHardDelete:on,onDuplicate:gt}),j==="edit"&&A&&i.jsx(d0,{initialData:A,onCancel:()=>d({view:"detail",id:A.id}),onSave:ne=>nn(ne,!0)},`edit-${A.id}`),j==="create"&&i.jsx(d0,{initialData:W,onCancel:()=>{d({view:"list"}),z(null)},onSave:ne=>nn(ne,!1)},W?"create-form-imported":"create-form"),G&&i.jsx(Hx,{initialMode:G,onClose:()=>H(null),onImport:Lt}),(j==="data"||j==="data-management")&&i.jsx(UN,{onBack:()=>d({view:"list"})}),j==="levain-guide"&&i.jsx(BN,{onBack:()=>d({view:"list"})}),j==="users"&&n?.role==="admin"&&i.jsx($N,{onBack:()=>d({view:"list"})}),j==="inventory"&&i.jsx(GN,{onBack:()=>d({view:"list"})}),j==="planner"&&i.jsx(QN,{onBack:()=>d({view:"list"}),onSelectRecipe:ne=>an(ne,{from:"planner"})}),j==="order-list"&&i.jsx(WN,{onBack:()=>d({view:"list"})})]}):i.jsx(tR,{})}function sR(){return i.jsx(eR,{children:i.jsx(XN,{children:i.jsx(rR,{})})})}class iR extends Ae.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,s){console.error("Uncaught error:",t,s),this.setState({error:t,errorInfo:s})}render(){return this.state.hasError?i.jsxs("div",{style:{padding:"2rem",color:"red"},children:[i.jsx("h1",{children:""}),i.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),i.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),i.jsx("br",{}),i.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}Gw.createRoot(document.getElementById("root")).render(i.jsx(w.StrictMode,{children:i.jsx(iR,{children:i.jsx(hj,{children:i.jsx(sR,{})})})}));
