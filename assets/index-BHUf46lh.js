(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(o){if(o.ep)return;o.ep=!0;const u=s(o);fetch(o.href,u)}})();var rT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $x(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function sT(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var s=function a(){var o=!1;try{o=this instanceof a}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(n).forEach(function(a){var o=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(s,a,o.get?o:{enumerable:!0,get:function(){return n[a]}})}),s}var Wh={exports:{}},so={};var tv;function uS(){if(tv)return so;tv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(a,o,u){var d=null;if(u!==void 0&&(d=""+u),o.key!==void 0&&(d=""+o.key),"key"in o){u={};for(var h in o)h!=="key"&&(u[h]=o[h])}else u=o;return o=u.ref,{$$typeof:n,type:a,key:d,ref:o!==void 0?o:null,props:u}}return so.Fragment=t,so.jsx=s,so.jsxs=s,so}var nv;function dS(){return nv||(nv=1,Wh.exports=uS()),Wh.exports}var i=dS(),Jh={exports:{}},Tt={};var rv;function hS(){if(rv)return Tt;rv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function w(B){return B===null||typeof B!="object"?null:(B=x&&B[x]||B["@@iterator"],typeof B=="function"?B:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,j={};function N(B,W,J){this.props=B,this.context=W,this.refs=j,this.updater=J||_}N.prototype.isReactComponent={},N.prototype.setState=function(B,W){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,W,"setState")},N.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function k(){}k.prototype=N.prototype;function O(B,W,J){this.props=B,this.context=W,this.refs=j,this.updater=J||_}var U=O.prototype=new k;U.constructor=O,E(U,N.prototype),U.isPureReactComponent=!0;var D=Array.isArray;function C(){}var M={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function H(B,W,J){var ge=J.ref;return{$$typeof:n,type:B,key:W,ref:ge!==void 0?ge:null,props:J}}function K(B,W){return H(B.type,W,B.props)}function F(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function q(B){var W={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(J){return W[J]})}var V=/\/+/g;function P(B,W){return typeof B=="object"&&B!==null&&B.key!=null?q(""+B.key):W.toString(36)}function L(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(C,C):(B.status="pending",B.then(function(W){B.status==="pending"&&(B.status="fulfilled",B.value=W)},function(W){B.status==="pending"&&(B.status="rejected",B.reason=W)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function A(B,W,J,ge,ze){var Re=typeof B;(Re==="undefined"||Re==="boolean")&&(B=null);var he=!1;if(B===null)he=!0;else switch(Re){case"bigint":case"string":case"number":he=!0;break;case"object":switch(B.$$typeof){case n:case t:he=!0;break;case y:return he=B._init,A(he(B._payload),W,J,ge,ze)}}if(he)return ze=ze(B),he=ge===""?"."+P(B,0):ge,D(ze)?(J="",he!=null&&(J=he.replace(V,"$&/")+"/"),A(ze,W,J,"",function(ye){return ye})):ze!=null&&(F(ze)&&(ze=K(ze,J+(ze.key==null||B&&B.key===ze.key?"":(""+ze.key).replace(V,"$&/")+"/")+he)),W.push(ze)),1;he=0;var I=ge===""?".":ge+":";if(D(B))for(var te=0;te<B.length;te++)ge=B[te],Re=I+P(ge,te),he+=A(ge,W,J,Re,ze);else if(te=w(B),typeof te=="function")for(B=te.call(B),te=0;!(ge=B.next()).done;)ge=ge.value,Re=I+P(ge,te++),he+=A(ge,W,J,Re,ze);else if(Re==="object"){if(typeof B.then=="function")return A(L(B),W,J,ge,ze);throw W=String(B),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return he}function $(B,W,J){if(B==null)return B;var ge=[],ze=0;return A(B,ge,"","",function(Re){return W.call(J,Re,ze++)}),ge}function Y(B){if(B._status===-1){var W=B._result;W=W(),W.then(function(J){(B._status===0||B._status===-1)&&(B._status=1,B._result=J)},function(J){(B._status===0||B._status===-1)&&(B._status=2,B._result=J)}),B._status===-1&&(B._status=0,B._result=W)}if(B._status===1)return B._result.default;throw B._result}var le=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},me={map:$,forEach:function(B,W,J){$(B,function(){W.apply(this,arguments)},J)},count:function(B){var W=0;return $(B,function(){W++}),W},toArray:function(B){return $(B,function(W){return W})||[]},only:function(B){if(!F(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return Tt.Activity=v,Tt.Children=me,Tt.Component=N,Tt.Fragment=s,Tt.Profiler=o,Tt.PureComponent=O,Tt.StrictMode=a,Tt.Suspense=f,Tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,Tt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return M.H.useMemoCache(B)}},Tt.cache=function(B){return function(){return B.apply(null,arguments)}},Tt.cacheSignal=function(){return null},Tt.cloneElement=function(B,W,J){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var ge=E({},B.props),ze=B.key;if(W!=null)for(Re in W.key!==void 0&&(ze=""+W.key),W)!T.call(W,Re)||Re==="key"||Re==="__self"||Re==="__source"||Re==="ref"&&W.ref===void 0||(ge[Re]=W[Re]);var Re=arguments.length-2;if(Re===1)ge.children=J;else if(1<Re){for(var he=Array(Re),I=0;I<Re;I++)he[I]=arguments[I+2];ge.children=he}return H(B.type,ze,ge)},Tt.createContext=function(B){return B={$$typeof:d,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:u,_context:B},B},Tt.createElement=function(B,W,J){var ge,ze={},Re=null;if(W!=null)for(ge in W.key!==void 0&&(Re=""+W.key),W)T.call(W,ge)&&ge!=="key"&&ge!=="__self"&&ge!=="__source"&&(ze[ge]=W[ge]);var he=arguments.length-2;if(he===1)ze.children=J;else if(1<he){for(var I=Array(he),te=0;te<he;te++)I[te]=arguments[te+2];ze.children=I}if(B&&B.defaultProps)for(ge in he=B.defaultProps,he)ze[ge]===void 0&&(ze[ge]=he[ge]);return H(B,Re,ze)},Tt.createRef=function(){return{current:null}},Tt.forwardRef=function(B){return{$$typeof:h,render:B}},Tt.isValidElement=F,Tt.lazy=function(B){return{$$typeof:y,_payload:{_status:-1,_result:B},_init:Y}},Tt.memo=function(B,W){return{$$typeof:m,type:B,compare:W===void 0?null:W}},Tt.startTransition=function(B){var W=M.T,J={};M.T=J;try{var ge=B(),ze=M.S;ze!==null&&ze(J,ge),typeof ge=="object"&&ge!==null&&typeof ge.then=="function"&&ge.then(C,le)}catch(Re){le(Re)}finally{W!==null&&J.types!==null&&(W.types=J.types),M.T=W}},Tt.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},Tt.use=function(B){return M.H.use(B)},Tt.useActionState=function(B,W,J){return M.H.useActionState(B,W,J)},Tt.useCallback=function(B,W){return M.H.useCallback(B,W)},Tt.useContext=function(B){return M.H.useContext(B)},Tt.useDebugValue=function(){},Tt.useDeferredValue=function(B,W){return M.H.useDeferredValue(B,W)},Tt.useEffect=function(B,W){return M.H.useEffect(B,W)},Tt.useEffectEvent=function(B){return M.H.useEffectEvent(B)},Tt.useId=function(){return M.H.useId()},Tt.useImperativeHandle=function(B,W,J){return M.H.useImperativeHandle(B,W,J)},Tt.useInsertionEffect=function(B,W){return M.H.useInsertionEffect(B,W)},Tt.useLayoutEffect=function(B,W){return M.H.useLayoutEffect(B,W)},Tt.useMemo=function(B,W){return M.H.useMemo(B,W)},Tt.useOptimistic=function(B,W){return M.H.useOptimistic(B,W)},Tt.useReducer=function(B,W,J){return M.H.useReducer(B,W,J)},Tt.useRef=function(B){return M.H.useRef(B)},Tt.useState=function(B){return M.H.useState(B)},Tt.useSyncExternalStore=function(B,W,J){return M.H.useSyncExternalStore(B,W,J)},Tt.useTransition=function(){return M.H.useTransition()},Tt.version="19.2.3",Tt}var sv;function Mo(){return sv||(sv=1,Jh.exports=hS()),Jh.exports}var b=Mo();const be=$x(b);var Xh={exports:{}},io={},Zh={exports:{}},ef={};var iv;function fS(){return iv||(iv=1,(function(n){function t(A,$){var Y=A.length;A.push($);e:for(;0<Y;){var le=Y-1>>>1,me=A[le];if(0<o(me,$))A[le]=$,A[Y]=me,Y=le;else break e}}function s(A){return A.length===0?null:A[0]}function a(A){if(A.length===0)return null;var $=A[0],Y=A.pop();if(Y!==$){A[0]=Y;e:for(var le=0,me=A.length,B=me>>>1;le<B;){var W=2*(le+1)-1,J=A[W],ge=W+1,ze=A[ge];if(0>o(J,Y))ge<me&&0>o(ze,J)?(A[le]=ze,A[ge]=Y,le=ge):(A[le]=J,A[W]=Y,le=W);else if(ge<me&&0>o(ze,Y))A[le]=ze,A[ge]=Y,le=ge;else break e}}return $}function o(A,$){var Y=A.sortIndex-$.sortIndex;return Y!==0?Y:A.id-$.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,h=d.now();n.unstable_now=function(){return d.now()-h}}var f=[],m=[],y=1,v=null,x=3,w=!1,_=!1,E=!1,j=!1,N=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function U(A){for(var $=s(m);$!==null;){if($.callback===null)a(m);else if($.startTime<=A)a(m),$.sortIndex=$.expirationTime,t(f,$);else break;$=s(m)}}function D(A){if(E=!1,U(A),!_)if(s(f)!==null)_=!0,C||(C=!0,q());else{var $=s(m);$!==null&&L(D,$.startTime-A)}}var C=!1,M=-1,T=5,H=-1;function K(){return j?!0:!(n.unstable_now()-H<T)}function F(){if(j=!1,C){var A=n.unstable_now();H=A;var $=!0;try{e:{_=!1,E&&(E=!1,k(M),M=-1),w=!0;var Y=x;try{t:{for(U(A),v=s(f);v!==null&&!(v.expirationTime>A&&K());){var le=v.callback;if(typeof le=="function"){v.callback=null,x=v.priorityLevel;var me=le(v.expirationTime<=A);if(A=n.unstable_now(),typeof me=="function"){v.callback=me,U(A),$=!0;break t}v===s(f)&&a(f),U(A)}else a(f);v=s(f)}if(v!==null)$=!0;else{var B=s(m);B!==null&&L(D,B.startTime-A),$=!1}}break e}finally{v=null,x=Y,w=!1}$=void 0}}finally{$?q():C=!1}}}var q;if(typeof O=="function")q=function(){O(F)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,P=V.port2;V.port1.onmessage=F,q=function(){P.postMessage(null)}}else q=function(){N(F,0)};function L(A,$){M=N(function(){A(n.unstable_now())},$)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(A){A.callback=null},n.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<A?Math.floor(1e3/A):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(A){switch(x){case 1:case 2:case 3:var $=3;break;default:$=x}var Y=x;x=$;try{return A()}finally{x=Y}},n.unstable_requestPaint=function(){j=!0},n.unstable_runWithPriority=function(A,$){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var Y=x;x=A;try{return $()}finally{x=Y}},n.unstable_scheduleCallback=function(A,$,Y){var le=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?le+Y:le):Y=le,A){case 1:var me=-1;break;case 2:me=250;break;case 5:me=1073741823;break;case 4:me=1e4;break;default:me=5e3}return me=Y+me,A={id:y++,callback:$,priorityLevel:A,startTime:Y,expirationTime:me,sortIndex:-1},Y>le?(A.sortIndex=Y,t(m,A),s(f)===null&&A===s(m)&&(E?(k(M),M=-1):E=!0,L(D,Y-le))):(A.sortIndex=me,t(f,A),_||w||(_=!0,C||(C=!0,q()))),A},n.unstable_shouldYield=K,n.unstable_wrapCallback=function(A){var $=x;return function(){var Y=x;x=$;try{return A.apply(this,arguments)}finally{x=Y}}}})(ef)),ef}var av;function pS(){return av||(av=1,Zh.exports=fS()),Zh.exports}var tf={exports:{}},sr={};var lv;function mS(){if(lv)return sr;lv=1;var n=Mo();function t(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var a={d:{f:s,r:function(){throw Error(t(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(f,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:f,containerInfo:m,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return sr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,sr.createPortal=function(f,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return u(f,m,null,y)},sr.flushSync=function(f){var m=d.T,y=a.p;try{if(d.T=null,a.p=2,f)return f()}finally{d.T=m,a.p=y,a.d.f()}},sr.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,a.d.C(f,m))},sr.prefetchDNS=function(f){typeof f=="string"&&a.d.D(f)},sr.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var y=m.as,v=h(y,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,w=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?a.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:w}):y==="script"&&a.d.X(f,{crossOrigin:v,integrity:x,fetchPriority:w,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},sr.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=h(m.as,m.crossOrigin);a.d.M(f,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&a.d.M(f)},sr.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=h(y,m.crossOrigin);a.d.L(f,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},sr.preloadModule=function(f,m){if(typeof f=="string")if(m){var y=h(m.as,m.crossOrigin);a.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else a.d.m(f)},sr.requestFormReset=function(f){a.d.r(f)},sr.unstable_batchedUpdates=function(f,m){return f(m)},sr.useFormState=function(f,m,y){return d.H.useFormState(f,m,y)},sr.useFormStatus=function(){return d.H.useHostTransitionStatus()},sr.version="19.2.3",sr}var ov;function Px(){if(ov)return tf.exports;ov=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),tf.exports=mS(),tf.exports}var cv;function gS(){if(cv)return io;cv=1;var n=pS(),t=Mo(),s=Px();function a(e){var r="https://react.dev/errors/"+e;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var r=e,l=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,(r.flags&4098)!==0&&(l=r.return),e=r.return;while(e)}return r.tag===3?l:null}function d(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function h(e){if(e.tag===31){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function f(e){if(u(e)!==e)throw Error(a(188))}function m(e){var r=e.alternate;if(!r){if(r=u(e),r===null)throw Error(a(188));return r!==e?null:e}for(var l=e,c=r;;){var p=l.return;if(p===null)break;var g=p.alternate;if(g===null){if(c=p.return,c!==null){l=c;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===l)return f(p),e;if(g===c)return f(p),r;g=g.sibling}throw Error(a(188))}if(l.return!==c.return)l=p,c=g;else{for(var S=!1,R=p.child;R;){if(R===l){S=!0,l=p,c=g;break}if(R===c){S=!0,c=p,l=g;break}R=R.sibling}if(!S){for(R=g.child;R;){if(R===l){S=!0,l=g,c=p;break}if(R===c){S=!0,c=g,l=p;break}R=R.sibling}if(!S)throw Error(a(189))}}if(l.alternate!==c)throw Error(a(190))}if(l.tag!==3)throw Error(a(188));return l.stateNode.current===l?e:r}function y(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e;for(e=e.child;e!==null;){if(r=y(e),r!==null)return r;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),O=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),H=Symbol.for("react.activity"),K=Symbol.for("react.memo_cache_sentinel"),F=Symbol.iterator;function q(e){return e===null||typeof e!="object"?null:(e=F&&e[F]||e["@@iterator"],typeof e=="function"?e:null)}var V=Symbol.for("react.client.reference");function P(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===V?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case E:return"Fragment";case N:return"Profiler";case j:return"StrictMode";case D:return"Suspense";case C:return"SuspenseList";case H:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case O:return e.displayName||"Context";case k:return(e._context.displayName||"Context")+".Consumer";case U:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case M:return r=e.displayName||null,r!==null?r:P(e.type)||"Memo";case T:r=e._payload,e=e._init;try{return P(e(r))}catch{}}return null}var L=Array.isArray,A=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},le=[],me=-1;function B(e){return{current:e}}function W(e){0>me||(e.current=le[me],le[me]=null,me--)}function J(e,r){me++,le[me]=e.current,e.current=r}var ge=B(null),ze=B(null),Re=B(null),he=B(null);function I(e,r){switch(J(Re,r),J(ze,e),J(ge,null),r.nodeType){case 9:case 11:e=(e=r.documentElement)&&(e=e.namespaceURI)?_y(e):0;break;default:if(e=r.tagName,r=r.namespaceURI)r=_y(r),e=Cy(r,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(ge),J(ge,e)}function te(){W(ge),W(ze),W(Re)}function ye(e){e.memoizedState!==null&&J(he,e);var r=ge.current,l=Cy(r,e.type);r!==l&&(J(ze,e),J(ge,l))}function Ne(e){ze.current===e&&(W(ge),W(ze)),he.current===e&&(W(he),eo._currentValue=Y)}var Oe,qe;function $e(e){if(Oe===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);Oe=r&&r[1]||"",qe=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Oe+e+qe}var Je=!1;function pe(e,r){if(!e||Je)return"";Je=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var Ce=function(){throw Error()};if(Object.defineProperty(Ce.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ce,[])}catch(ve){var de=ve}Reflect.construct(e,[],Ce)}else{try{Ce.call()}catch(ve){de=ve}e.call(Ce.prototype)}}else{try{throw Error()}catch(ve){de=ve}(Ce=e())&&typeof Ce.catch=="function"&&Ce.catch(function(){})}}catch(ve){if(ve&&de&&typeof ve.stack=="string")return[ve.stack,de.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),S=g[0],R=g[1];if(S&&R){var Q=S.split(`
`),ce=R.split(`
`);for(p=c=0;c<Q.length&&!Q[c].includes("DetermineComponentFrameRoot");)c++;for(;p<ce.length&&!ce[p].includes("DetermineComponentFrameRoot");)p++;if(c===Q.length||p===ce.length)for(c=Q.length-1,p=ce.length-1;1<=c&&0<=p&&Q[c]!==ce[p];)p--;for(;1<=c&&0<=p;c--,p--)if(Q[c]!==ce[p]){if(c!==1||p!==1)do if(c--,p--,0>p||Q[c]!==ce[p]){var we=`
`+Q[c].replace(" at new "," at ");return e.displayName&&we.includes("<anonymous>")&&(we=we.replace("<anonymous>",e.displayName)),we}while(1<=c&&0<=p);break}}}finally{Je=!1,Error.prepareStackTrace=l}return(l=e?e.displayName||e.name:"")?$e(l):""}function Xe(e,r){switch(e.tag){case 26:case 27:case 5:return $e(e.type);case 16:return $e("Lazy");case 13:return e.child!==r&&r!==null?$e("Suspense Fallback"):$e("Suspense");case 19:return $e("SuspenseList");case 0:case 15:return pe(e.type,!1);case 11:return pe(e.type.render,!1);case 1:return pe(e.type,!0);case 31:return $e("Activity");default:return""}}function ot(e){try{var r="",l=null;do r+=Xe(e,l),l=e,e=e.return;while(e);return r}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var jt=Object.prototype.hasOwnProperty,ke=n.unstable_scheduleCallback,Ae=n.unstable_cancelCallback,it=n.unstable_shouldYield,Mt=n.unstable_requestPaint,yt=n.unstable_now,ie=n.unstable_getCurrentPriorityLevel,_e=n.unstable_ImmediatePriority,Ee=n.unstable_UserBlockingPriority,Ie=n.unstable_NormalPriority,ct=n.unstable_LowPriority,pt=n.unstable_IdlePriority,Rt=n.log,Jt=n.unstable_setDisableYieldValue,Sn=null,_t=null;function rn(e){if(typeof Rt=="function"&&Jt(e),_t&&typeof _t.setStrictMode=="function")try{_t.setStrictMode(Sn,e)}catch{}}var cn=Math.clz32?Math.clz32:ar,xn=Math.log,Ln=Math.LN2;function ar(e){return e>>>=0,e===0?32:31-(xn(e)/Ln|0)|0}var fe=256,Ve=262144,et=4194304;function Ke(e){var r=e&42;if(r!==0)return r;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function nt(e,r,l){var c=e.pendingLanes;if(c===0)return 0;var p=0,g=e.suspendedLanes,S=e.pingedLanes;e=e.warmLanes;var R=c&134217727;return R!==0?(c=R&~g,c!==0?p=Ke(c):(S&=R,S!==0?p=Ke(S):l||(l=R&~e,l!==0&&(p=Ke(l))))):(R=c&~g,R!==0?p=Ke(R):S!==0?p=Ke(S):l||(l=c&~e,l!==0&&(p=Ke(l)))),p===0?0:r!==0&&r!==p&&(r&g)===0&&(g=p&-p,l=r&-r,g>=l||g===32&&(l&4194048)!==0)?r:p}function zt(e,r){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&r)===0}function bt(e,r){switch(e){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function At(){var e=et;return et<<=1,(et&62914560)===0&&(et=4194304),e}function tt(e){for(var r=[],l=0;31>l;l++)r.push(e);return r}function $t(e,r){e.pendingLanes|=r,r!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Qe(e,r,l,c,p,g){var S=e.pendingLanes;e.pendingLanes=l,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=l,e.entangledLanes&=l,e.errorRecoveryDisabledLanes&=l,e.shellSuspendCounter=0;var R=e.entanglements,Q=e.expirationTimes,ce=e.hiddenUpdates;for(l=S&~l;0<l;){var we=31-cn(l),Ce=1<<we;R[we]=0,Q[we]=-1;var de=ce[we];if(de!==null)for(ce[we]=null,we=0;we<de.length;we++){var ve=de[we];ve!==null&&(ve.lane&=-536870913)}l&=~Ce}c!==0&&Lt(e,c,0),g!==0&&p===0&&e.tag!==0&&(e.suspendedLanes|=g&~(S&~r))}function Lt(e,r,l){e.pendingLanes|=r,e.suspendedLanes&=~r;var c=31-cn(r);e.entangledLanes|=r,e.entanglements[c]=e.entanglements[c]|1073741824|l&261930}function Xt(e,r){var l=e.entangledLanes|=r;for(e=e.entanglements;l;){var c=31-cn(l),p=1<<c;p&r|e[c]&r&&(e[c]|=r),l&=~p}}function Qt(e,r){var l=r&-r;return l=(l&42)!==0?1:ne(l),(l&(e.suspendedLanes|r))!==0?0:l}function ne(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ee(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function ue(){var e=$.p;return e!==0?e:(e=window.event,e===void 0?32:Yy(e.type))}function je(e,r){var l=$.p;try{return $.p=e,r()}finally{$.p=l}}var Be=Math.random().toString(36).slice(2),Ze="__reactFiber$"+Be,Ye="__reactProps$"+Be,G="__reactContainer$"+Be,Le="__reactEvents$"+Be,Ge="__reactListeners$"+Be,Ct="__reactHandles$"+Be,Ue="__reactResources$"+Be,ft="__reactMarker$"+Be;function Ht(e){delete e[Ze],delete e[Ye],delete e[Le],delete e[Ge],delete e[Ct]}function En(e){var r=e[Ze];if(r)return r;for(var l=e.parentNode;l;){if(r=l[G]||l[Ze]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(e=Oy(e);e!==null;){if(l=e[Ze])return l;e=Oy(e)}return r}e=l,l=e.parentNode}return null}function kt(e){if(e=e[Ze]||e[G]){var r=e.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return e}return null}function Vn(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e.stateNode;throw Error(a(33))}function sn(e){var r=e[Ue];return r||(r=e[Ue]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Nt(e){e[ft]=!0}var Pr=new Set,Kn={};function yr(e,r){qr(e,r),qr(e+"Capture",r)}function qr(e,r){for(Kn[e]=r,e=0;e<r.length;e++)Pr.add(r[e])}var ta=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),cs={},dl={};function hl(e){return jt.call(dl,e)?!0:jt.call(cs,e)?!1:ta.test(e)?dl[e]=!0:(cs[e]=!0,!1)}function na(e,r,l){if(hl(r))if(l===null)e.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":e.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(r);return}}e.setAttribute(r,""+l)}}function $s(e,r,l){if(l===null)e.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttribute(r,""+l)}}function cr(e,r,l,c){if(c===null)e.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(l);return}e.setAttributeNS(r,l,""+c)}}function Yn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function fl(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Xu(e,r,l){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,r);if(!e.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,g=c.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return p.call(this)},set:function(S){l=""+S,g.call(this,S)}}),Object.defineProperty(e,r,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(S){l=""+S},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function pl(e){if(!e._valueTracker){var r=fl(e)?"checked":"value";e._valueTracker=Xu(e,r,""+e[r])}}function Ko(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var l=r.getValue(),c="";return e&&(c=fl(e)?e.checked?"true":"false":e.value),e=c,e!==l?(r.setValue(e),!0):!1}function ra(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var ml=/[\n"\\]/g;function ur(e){return e.replace(ml,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function gl(e,r,l,c,p,g,S,R){e.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.type=S:e.removeAttribute("type"),r!=null?S==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+Yn(r)):e.value!==""+Yn(r)&&(e.value=""+Yn(r)):S!=="submit"&&S!=="reset"||e.removeAttribute("value"),r!=null?yl(e,S,Yn(r)):l!=null?yl(e,S,Yn(l)):c!=null&&e.removeAttribute("value"),p==null&&g!=null&&(e.defaultChecked=!!g),p!=null&&(e.checked=p&&typeof p!="function"&&typeof p!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?e.name=""+Yn(R):e.removeAttribute("name")}function Ps(e,r,l,c,p,g,S,R){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),r!=null||l!=null){if(!(g!=="submit"&&g!=="reset"||r!=null)){pl(e);return}l=l!=null?""+Yn(l):"",r=r!=null?""+Yn(r):l,R||r===e.value||(e.value=r),e.defaultValue=r}c=c??p,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=R?e.checked:!!c,e.defaultChecked=!!c,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(e.name=S),pl(e)}function yl(e,r,l){r==="number"&&ra(e.ownerDocument)===e||e.defaultValue===""+l||(e.defaultValue=""+l)}function qs(e,r,l,c){if(e=e.options,r){r={};for(var p=0;p<l.length;p++)r["$"+l[p]]=!0;for(l=0;l<e.length;l++)p=r.hasOwnProperty("$"+e[l].value),e[l].selected!==p&&(e[l].selected=p),p&&c&&(e[l].defaultSelected=!0)}else{for(l=""+Yn(l),r=null,p=0;p<e.length;p++){if(e[p].value===l){e[p].selected=!0,c&&(e[p].defaultSelected=!0);return}r!==null||e[p].disabled||(r=e[p])}r!==null&&(r.selected=!0)}}function Yo(e,r,l){if(r!=null&&(r=""+Yn(r),r!==e.value&&(e.value=r),l==null)){e.defaultValue!==r&&(e.defaultValue=r);return}e.defaultValue=l!=null?""+Yn(l):""}function Qo(e,r,l,c){if(r==null){if(c!=null){if(l!=null)throw Error(a(92));if(L(c)){if(1<c.length)throw Error(a(93));c=c[0]}l=c}l==null&&(l=""),r=l}l=Yn(r),e.defaultValue=l,c=e.textContent,c===l&&c!==""&&c!==null&&(e.value=c),pl(e)}function us(e,r){if(r){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=r;return}}e.textContent=r}var Wo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Jo(e,r,l){var c=r.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="":c?e.setProperty(r,l):typeof l!="number"||l===0||Wo.has(r)?r==="float"?e.cssFloat=l:e[r]=(""+l).trim():e[r]=l+"px"}function Xo(e,r,l){if(r!=null&&typeof r!="object")throw Error(a(62));if(e=e.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var p in r)c=r[p],r.hasOwnProperty(p)&&l[p]!==c&&Jo(e,p,c)}else for(var g in r)r.hasOwnProperty(g)&&Jo(e,g,r[g])}function sa(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Zo=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ia(e){return Zo.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Fr(){}var vl=null;function xl(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Fs=null,Hs=null;function bi(e){var r=kt(e);if(r&&(e=r.stateNode)){var l=e[Ye]||null;e:switch(e=r.stateNode,r.type){case"input":if(gl(e,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),r=l.name,l.type==="radio"&&r!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+ur(""+r)+'"][type="radio"]'),r=0;r<l.length;r++){var c=l[r];if(c!==e&&c.form===e.form){var p=c[Ye]||null;if(!p)throw Error(a(90));gl(c,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(r=0;r<l.length;r++)c=l[r],c.form===e.form&&Ko(c)}break e;case"textarea":Yo(e,l.value,l.defaultValue);break e;case"select":r=l.value,r!=null&&qs(e,!!l.multiple,r,!1)}}}var aa=!1;function z(e,r,l){if(aa)return e(r,l);aa=!0;try{var c=e(r);return c}finally{if(aa=!1,(Fs!==null||Hs!==null)&&(zc(),Fs&&(r=Fs,e=Hs,Hs=Fs=null,bi(r),e)))for(r=0;r<e.length;r++)bi(e[r])}}function X(e,r){var l=e.stateNode;if(l===null)return null;var c=l[Ye]||null;if(c===null)return null;l=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(a(231,r,typeof l));return l}var ae=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xe=!1;if(ae)try{var De={};Object.defineProperty(De,"passive",{get:function(){xe=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch{xe=!1}var Me=null,Pe=null,He=null;function We(){if(He)return He;var e,r=Pe,l=r.length,c,p="value"in Me?Me.value:Me.textContent,g=p.length;for(e=0;e<l&&r[e]===p[e];e++);var S=l-e;for(c=1;c<=S&&r[l-c]===p[g-c];c++);return He=p.slice(e,1<c?1-c:void 0)}function st(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function ht(){return!0}function gt(){return!1}function Fe(e){function r(l,c,p,g,S){this._reactName=l,this._targetInst=p,this.type=c,this.nativeEvent=g,this.target=S,this.currentTarget=null;for(var R in e)e.hasOwnProperty(R)&&(l=e[R],this[R]=l?l(g):g[R]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?ht:gt,this.isPropagationStopped=gt,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=ht)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=ht)},persist:function(){},isPersistent:ht}),r}var vt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mn=Fe(vt),dn=v({},vt,{view:0,detail:0}),Gs=Fe(dn),ts,at,ut,Et=v({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:td,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ut&&(ut&&e.type==="mousemove"?(ts=e.screenX-ut.screenX,at=e.screenY-ut.screenY):at=ts=0,ut=e),ts)},movementY:function(e){return"movementY"in e?e.movementY:at}}),hn=Fe(Et),Nn=v({},Et,{dataTransfer:0}),Rn=Fe(Nn),Pt=v({},dn,{relatedTarget:0}),rr=Fe(Pt),An=v({},vt,{animationName:0,elapsedTime:0,pseudoElement:0}),ds=Fe(An),ns=v({},vt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Vs=Fe(ns),bl=v({},vt,{data:0}),ed=Fe(bl),hs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},la={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bb(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=wi[e])?!!r[e]:!1}function td(){return bb}var wb=v({},dn,{key:function(e){if(e.key){var r=hs[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=st(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?la[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:td,charCode:function(e){return e.type==="keypress"?st(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?st(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Sb=Fe(wb),jb=v({},Et,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tp=Fe(jb),_b=v({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:td}),Cb=Fe(_b),Eb=v({},vt,{propertyName:0,elapsedTime:0,pseudoElement:0}),Nb=Fe(Eb),kb=v({},Et,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tb=Fe(kb),Rb=v({},vt,{newState:0,oldState:0}),Ab=Fe(Rb),Ob=[9,13,27,32],nd=ae&&"CompositionEvent"in window,wl=null;ae&&"documentMode"in document&&(wl=document.documentMode);var Db=ae&&"TextEvent"in window&&!wl,Rp=ae&&(!nd||wl&&8<wl&&11>=wl),Ap=" ",Op=!1;function Dp(e,r){switch(e){case"keyup":return Ob.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var oa=!1;function Mb(e,r){switch(e){case"compositionend":return Mp(r);case"keypress":return r.which!==32?null:(Op=!0,Ap);case"textInput":return e=r.data,e===Ap&&Op?null:e;default:return null}}function zb(e,r){if(oa)return e==="compositionend"||!nd&&Dp(e,r)?(e=We(),He=Pe=Me=null,oa=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Rp&&r.locale!=="ko"?null:r.data;default:return null}}var Ub={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zp(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!Ub[e.type]:r==="textarea"}function Up(e,r,l,c){Fs?Hs?Hs.push(c):Hs=[c]:Fs=c,r=qc(r,"onChange"),0<r.length&&(l=new mn("onChange","change",null,l,c),e.push({event:l,listeners:r}))}var Sl=null,jl=null;function Lb(e){vy(e,0)}function ec(e){var r=Vn(e);if(Ko(r))return e}function Lp(e,r){if(e==="change")return r}var Ip=!1;if(ae){var rd;if(ae){var sd="oninput"in document;if(!sd){var Bp=document.createElement("div");Bp.setAttribute("oninput","return;"),sd=typeof Bp.oninput=="function"}rd=sd}else rd=!1;Ip=rd&&(!document.documentMode||9<document.documentMode)}function $p(){Sl&&(Sl.detachEvent("onpropertychange",Pp),jl=Sl=null)}function Pp(e){if(e.propertyName==="value"&&ec(jl)){var r=[];Up(r,jl,e,xl(e)),z(Lb,r)}}function Ib(e,r,l){e==="focusin"?($p(),Sl=r,jl=l,Sl.attachEvent("onpropertychange",Pp)):e==="focusout"&&$p()}function Bb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ec(jl)}function $b(e,r){if(e==="click")return ec(r)}function Pb(e,r){if(e==="input"||e==="change")return ec(r)}function qb(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var vr=typeof Object.is=="function"?Object.is:qb;function _l(e,r){if(vr(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var l=Object.keys(e),c=Object.keys(r);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var p=l[c];if(!jt.call(r,p)||!vr(e[p],r[p]))return!1}return!0}function qp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Fp(e,r){var l=qp(e);e=0;for(var c;l;){if(l.nodeType===3){if(c=e+l.textContent.length,e<=r&&c>=r)return{node:l,offset:r-e};e=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=qp(l)}}function Hp(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?Hp(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function Gp(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var r=ra(e.document);r instanceof e.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)e=r.contentWindow;else break;r=ra(e.document)}return r}function id(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}var Fb=ae&&"documentMode"in document&&11>=document.documentMode,ca=null,ad=null,Cl=null,ld=!1;function Vp(e,r,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;ld||ca==null||ca!==ra(c)||(c=ca,"selectionStart"in c&&id(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Cl&&_l(Cl,c)||(Cl=c,c=qc(ad,"onSelect"),0<c.length&&(r=new mn("onSelect","select",null,r,l),e.push({event:r,listeners:c}),r.target=ca)))}function Si(e,r){var l={};return l[e.toLowerCase()]=r.toLowerCase(),l["Webkit"+e]="webkit"+r,l["Moz"+e]="moz"+r,l}var ua={animationend:Si("Animation","AnimationEnd"),animationiteration:Si("Animation","AnimationIteration"),animationstart:Si("Animation","AnimationStart"),transitionrun:Si("Transition","TransitionRun"),transitionstart:Si("Transition","TransitionStart"),transitioncancel:Si("Transition","TransitionCancel"),transitionend:Si("Transition","TransitionEnd")},od={},Kp={};ae&&(Kp=document.createElement("div").style,"AnimationEvent"in window||(delete ua.animationend.animation,delete ua.animationiteration.animation,delete ua.animationstart.animation),"TransitionEvent"in window||delete ua.transitionend.transition);function ji(e){if(od[e])return od[e];if(!ua[e])return e;var r=ua[e],l;for(l in r)if(r.hasOwnProperty(l)&&l in Kp)return od[e]=r[l];return e}var Yp=ji("animationend"),Qp=ji("animationiteration"),Wp=ji("animationstart"),Hb=ji("transitionrun"),Gb=ji("transitionstart"),Vb=ji("transitioncancel"),Jp=ji("transitionend"),Xp=new Map,cd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");cd.push("scrollEnd");function Hr(e,r){Xp.set(e,r),yr(r,[e])}var tc=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Tr=[],da=0,ud=0;function nc(){for(var e=da,r=ud=da=0;r<e;){var l=Tr[r];Tr[r++]=null;var c=Tr[r];Tr[r++]=null;var p=Tr[r];Tr[r++]=null;var g=Tr[r];if(Tr[r++]=null,c!==null&&p!==null){var S=c.pending;S===null?p.next=p:(p.next=S.next,S.next=p),c.pending=p}g!==0&&Zp(l,p,g)}}function rc(e,r,l,c){Tr[da++]=e,Tr[da++]=r,Tr[da++]=l,Tr[da++]=c,ud|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function dd(e,r,l,c){return rc(e,r,l,c),sc(e)}function _i(e,r){return rc(e,null,null,r),sc(e)}function Zp(e,r,l){e.lanes|=l;var c=e.alternate;c!==null&&(c.lanes|=l);for(var p=!1,g=e.return;g!==null;)g.childLanes|=l,c=g.alternate,c!==null&&(c.childLanes|=l),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(p=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,p&&r!==null&&(p=31-cn(l),e=g.hiddenUpdates,c=e[p],c===null?e[p]=[r]:c.push(r),r.lane=l|536870912),g):null}function sc(e){if(50<Kl)throw Kl=0,bh=null,Error(a(185));for(var r=e.return;r!==null;)e=r,r=e.return;return e.tag===3?e.stateNode:null}var ha={};function Kb(e,r,l,c){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(e,r,l,c){return new Kb(e,r,l,c)}function hd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fs(e,r){var l=e.alternate;return l===null?(l=xr(e.tag,r,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=r,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&65011712,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,r=e.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l.refCleanup=e.refCleanup,l}function em(e,r){e.flags&=65011714;var l=e.alternate;return l===null?(e.childLanes=0,e.lanes=r,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=l.childLanes,e.lanes=l.lanes,e.child=l.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=l.memoizedProps,e.memoizedState=l.memoizedState,e.updateQueue=l.updateQueue,e.type=l.type,r=l.dependencies,e.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e}function ic(e,r,l,c,p,g){var S=0;if(c=e,typeof e=="function")hd(e)&&(S=1);else if(typeof e=="string")S=Xw(e,l,ge.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case H:return e=xr(31,l,r,p),e.elementType=H,e.lanes=g,e;case E:return Ci(l.children,p,g,r);case j:S=8,p|=24;break;case N:return e=xr(12,l,r,p|2),e.elementType=N,e.lanes=g,e;case D:return e=xr(13,l,r,p),e.elementType=D,e.lanes=g,e;case C:return e=xr(19,l,r,p),e.elementType=C,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case O:S=10;break e;case k:S=9;break e;case U:S=11;break e;case M:S=14;break e;case T:S=16,c=null;break e}S=29,l=Error(a(130,e===null?"null":typeof e,"")),c=null}return r=xr(S,l,r,p),r.elementType=e,r.type=c,r.lanes=g,r}function Ci(e,r,l,c){return e=xr(7,e,c,r),e.lanes=l,e}function fd(e,r,l){return e=xr(6,e,null,r),e.lanes=l,e}function tm(e){var r=xr(18,null,null,0);return r.stateNode=e,r}function pd(e,r,l){return r=xr(4,e.children!==null?e.children:[],e.key,r),r.lanes=l,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}var nm=new WeakMap;function Rr(e,r){if(typeof e=="object"&&e!==null){var l=nm.get(e);return l!==void 0?l:(r={value:e,source:r,stack:ot(r)},nm.set(e,r),r)}return{value:e,source:r,stack:ot(r)}}var fa=[],pa=0,ac=null,El=0,Ar=[],Or=0,Ks=null,rs=1,ss="";function ps(e,r){fa[pa++]=El,fa[pa++]=ac,ac=e,El=r}function rm(e,r,l){Ar[Or++]=rs,Ar[Or++]=ss,Ar[Or++]=Ks,Ks=e;var c=rs;e=ss;var p=32-cn(c)-1;c&=~(1<<p),l+=1;var g=32-cn(r)+p;if(30<g){var S=p-p%5;g=(c&(1<<S)-1).toString(32),c>>=S,p-=S,rs=1<<32-cn(r)+p|l<<p|c,ss=g+e}else rs=1<<g|l<<p|c,ss=e}function md(e){e.return!==null&&(ps(e,1),rm(e,1,0))}function gd(e){for(;e===ac;)ac=fa[--pa],fa[pa]=null,El=fa[--pa],fa[pa]=null;for(;e===Ks;)Ks=Ar[--Or],Ar[Or]=null,ss=Ar[--Or],Ar[Or]=null,rs=Ar[--Or],Ar[Or]=null}function sm(e,r){Ar[Or++]=rs,Ar[Or++]=ss,Ar[Or++]=Ks,rs=r.id,ss=r.overflow,Ks=e}var Qn=null,gn=null,Gt=!1,Ys=null,Dr=!1,yd=Error(a(519));function Qs(e){var r=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Nl(Rr(r,e)),yd}function im(e){var r=e.stateNode,l=e.type,c=e.memoizedProps;switch(r[Ze]=e,r[Ye]=c,l){case"dialog":Bt("cancel",r),Bt("close",r);break;case"iframe":case"object":case"embed":Bt("load",r);break;case"video":case"audio":for(l=0;l<Ql.length;l++)Bt(Ql[l],r);break;case"source":Bt("error",r);break;case"img":case"image":case"link":Bt("error",r),Bt("load",r);break;case"details":Bt("toggle",r);break;case"input":Bt("invalid",r),Ps(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Bt("invalid",r);break;case"textarea":Bt("invalid",r),Qo(r,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||r.textContent===""+l||c.suppressHydrationWarning===!0||Sy(r.textContent,l)?(c.popover!=null&&(Bt("beforetoggle",r),Bt("toggle",r)),c.onScroll!=null&&Bt("scroll",r),c.onScrollEnd!=null&&Bt("scrollend",r),c.onClick!=null&&(r.onclick=Fr),r=!0):r=!1,r||Qs(e,!0)}function am(e){for(Qn=e.return;Qn;)switch(Qn.tag){case 5:case 31:case 13:Dr=!1;return;case 27:case 3:Dr=!0;return;default:Qn=Qn.return}}function ma(e){if(e!==Qn)return!1;if(!Gt)return am(e),Gt=!0,!1;var r=e.tag,l;if((l=r!==3&&r!==27)&&((l=r===5)&&(l=e.type,l=!(l!=="form"&&l!=="button")||zh(e.type,e.memoizedProps)),l=!l),l&&gn&&Qs(e),am(e),r===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));gn=Ay(e)}else if(r===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));gn=Ay(e)}else r===27?(r=gn,ci(e.type)?(e=$h,$h=null,gn=e):gn=r):gn=Qn?zr(e.stateNode.nextSibling):null;return!0}function Ei(){gn=Qn=null,Gt=!1}function vd(){var e=Ys;return e!==null&&(pr===null?pr=e:pr.push.apply(pr,e),Ys=null),e}function Nl(e){Ys===null?Ys=[e]:Ys.push(e)}var xd=B(null),Ni=null,ms=null;function Ws(e,r,l){J(xd,r._currentValue),r._currentValue=l}function gs(e){e._currentValue=xd.current,W(xd)}function bd(e,r,l){for(;e!==null;){var c=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),e===l)break;e=e.return}}function wd(e,r,l,c){var p=e.child;for(p!==null&&(p.return=e);p!==null;){var g=p.dependencies;if(g!==null){var S=p.child;g=g.firstContext;e:for(;g!==null;){var R=g;g=p;for(var Q=0;Q<r.length;Q++)if(R.context===r[Q]){g.lanes|=l,R=g.alternate,R!==null&&(R.lanes|=l),bd(g.return,l,e),c||(S=null);break e}g=R.next}}else if(p.tag===18){if(S=p.return,S===null)throw Error(a(341));S.lanes|=l,g=S.alternate,g!==null&&(g.lanes|=l),bd(S,l,e),S=null}else S=p.child;if(S!==null)S.return=p;else for(S=p;S!==null;){if(S===e){S=null;break}if(p=S.sibling,p!==null){p.return=S.return,S=p;break}S=S.return}p=S}}function ga(e,r,l,c){e=null;for(var p=r,g=!1;p!==null;){if(!g){if((p.flags&524288)!==0)g=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var S=p.alternate;if(S===null)throw Error(a(387));if(S=S.memoizedProps,S!==null){var R=p.type;vr(p.pendingProps.value,S.value)||(e!==null?e.push(R):e=[R])}}else if(p===he.current){if(S=p.alternate,S===null)throw Error(a(387));S.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(e!==null?e.push(eo):e=[eo])}p=p.return}e!==null&&wd(r,e,l,c),r.flags|=262144}function lc(e){for(e=e.firstContext;e!==null;){if(!vr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ki(e){Ni=e,ms=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Wn(e){return lm(Ni,e)}function oc(e,r){return Ni===null&&ki(e),lm(e,r)}function lm(e,r){var l=r._currentValue;if(r={context:r,memoizedValue:l,next:null},ms===null){if(e===null)throw Error(a(308));ms=r,e.dependencies={lanes:0,firstContext:r},e.flags|=524288}else ms=ms.next=r;return l}var Yb=typeof AbortController<"u"?AbortController:function(){var e=[],r=this.signal={aborted:!1,addEventListener:function(l,c){e.push(c)}};this.abort=function(){r.aborted=!0,e.forEach(function(l){return l()})}},Qb=n.unstable_scheduleCallback,Wb=n.unstable_NormalPriority,On={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Sd(){return{controller:new Yb,data:new Map,refCount:0}}function kl(e){e.refCount--,e.refCount===0&&Qb(Wb,function(){e.controller.abort()})}var Tl=null,jd=0,ya=0,va=null;function Jb(e,r){if(Tl===null){var l=Tl=[];jd=0,ya=Eh(),va={status:"pending",value:void 0,then:function(c){l.push(c)}}}return jd++,r.then(om,om),r}function om(){if(--jd===0&&Tl!==null){va!==null&&(va.status="fulfilled");var e=Tl;Tl=null,ya=0,va=null;for(var r=0;r<e.length;r++)(0,e[r])()}}function Xb(e,r){var l=[],c={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return e.then(function(){c.status="fulfilled",c.value=r;for(var p=0;p<l.length;p++)(0,l[p])(r)},function(p){for(c.status="rejected",c.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),c}var cm=A.S;A.S=function(e,r){Vg=yt(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&Jb(e,r),cm!==null&&cm(e,r)};var Ti=B(null);function _d(){var e=Ti.current;return e!==null?e:un.pooledCache}function cc(e,r){r===null?J(Ti,Ti.current):J(Ti,r.pool)}function um(){var e=_d();return e===null?null:{parent:On._currentValue,pool:e}}var xa=Error(a(460)),Cd=Error(a(474)),uc=Error(a(542)),dc={then:function(){}};function dm(e){return e=e.status,e==="fulfilled"||e==="rejected"}function hm(e,r,l){switch(l=e[l],l===void 0?e.push(r):l!==r&&(r.then(Fr,Fr),r=l),r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,pm(e),e;default:if(typeof r.status=="string")r.then(Fr,Fr);else{if(e=un,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=r,e.status="pending",e.then(function(c){if(r.status==="pending"){var p=r;p.status="fulfilled",p.value=c}},function(c){if(r.status==="pending"){var p=r;p.status="rejected",p.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,pm(e),e}throw Ai=r,xa}}function Ri(e){try{var r=e._init;return r(e._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Ai=l,xa):l}}var Ai=null;function fm(){if(Ai===null)throw Error(a(459));var e=Ai;return Ai=null,e}function pm(e){if(e===xa||e===uc)throw Error(a(483))}var ba=null,Rl=0;function hc(e){var r=Rl;return Rl+=1,ba===null&&(ba=[]),hm(ba,e,r)}function Al(e,r){r=r.props.ref,e.ref=r!==void 0?r:null}function fc(e,r){throw r.$$typeof===x?Error(a(525)):(e=Object.prototype.toString.call(r),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)))}function mm(e){function r(se,Z){if(e){var oe=se.deletions;oe===null?(se.deletions=[Z],se.flags|=16):oe.push(Z)}}function l(se,Z){if(!e)return null;for(;Z!==null;)r(se,Z),Z=Z.sibling;return null}function c(se){for(var Z=new Map;se!==null;)se.key!==null?Z.set(se.key,se):Z.set(se.index,se),se=se.sibling;return Z}function p(se,Z){return se=fs(se,Z),se.index=0,se.sibling=null,se}function g(se,Z,oe){return se.index=oe,e?(oe=se.alternate,oe!==null?(oe=oe.index,oe<Z?(se.flags|=67108866,Z):oe):(se.flags|=67108866,Z)):(se.flags|=1048576,Z)}function S(se){return e&&se.alternate===null&&(se.flags|=67108866),se}function R(se,Z,oe,Se){return Z===null||Z.tag!==6?(Z=fd(oe,se.mode,Se),Z.return=se,Z):(Z=p(Z,oe),Z.return=se,Z)}function Q(se,Z,oe,Se){var mt=oe.type;return mt===E?we(se,Z,oe.props.children,Se,oe.key):Z!==null&&(Z.elementType===mt||typeof mt=="object"&&mt!==null&&mt.$$typeof===T&&Ri(mt)===Z.type)?(Z=p(Z,oe.props),Al(Z,oe),Z.return=se,Z):(Z=ic(oe.type,oe.key,oe.props,null,se.mode,Se),Al(Z,oe),Z.return=se,Z)}function ce(se,Z,oe,Se){return Z===null||Z.tag!==4||Z.stateNode.containerInfo!==oe.containerInfo||Z.stateNode.implementation!==oe.implementation?(Z=pd(oe,se.mode,Se),Z.return=se,Z):(Z=p(Z,oe.children||[]),Z.return=se,Z)}function we(se,Z,oe,Se,mt){return Z===null||Z.tag!==7?(Z=Ci(oe,se.mode,Se,mt),Z.return=se,Z):(Z=p(Z,oe),Z.return=se,Z)}function Ce(se,Z,oe){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Z=fd(""+Z,se.mode,oe),Z.return=se,Z;if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case w:return oe=ic(Z.type,Z.key,Z.props,null,se.mode,oe),Al(oe,Z),oe.return=se,oe;case _:return Z=pd(Z,se.mode,oe),Z.return=se,Z;case T:return Z=Ri(Z),Ce(se,Z,oe)}if(L(Z)||q(Z))return Z=Ci(Z,se.mode,oe,null),Z.return=se,Z;if(typeof Z.then=="function")return Ce(se,hc(Z),oe);if(Z.$$typeof===O)return Ce(se,oc(se,Z),oe);fc(se,Z)}return null}function de(se,Z,oe,Se){var mt=Z!==null?Z.key:null;if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return mt!==null?null:R(se,Z,""+oe,Se);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case w:return oe.key===mt?Q(se,Z,oe,Se):null;case _:return oe.key===mt?ce(se,Z,oe,Se):null;case T:return oe=Ri(oe),de(se,Z,oe,Se)}if(L(oe)||q(oe))return mt!==null?null:we(se,Z,oe,Se,null);if(typeof oe.then=="function")return de(se,Z,hc(oe),Se);if(oe.$$typeof===O)return de(se,Z,oc(se,oe),Se);fc(se,oe)}return null}function ve(se,Z,oe,Se,mt){if(typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint")return se=se.get(oe)||null,R(Z,se,""+Se,mt);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case w:return se=se.get(Se.key===null?oe:Se.key)||null,Q(Z,se,Se,mt);case _:return se=se.get(Se.key===null?oe:Se.key)||null,ce(Z,se,Se,mt);case T:return Se=Ri(Se),ve(se,Z,oe,Se,mt)}if(L(Se)||q(Se))return se=se.get(oe)||null,we(Z,se,Se,mt,null);if(typeof Se.then=="function")return ve(se,Z,oe,hc(Se),mt);if(Se.$$typeof===O)return ve(se,Z,oe,oc(Z,Se),mt);fc(Z,Se)}return null}function rt(se,Z,oe,Se){for(var mt=null,Kt=null,lt=Z,Dt=Z=0,Ft=null;lt!==null&&Dt<oe.length;Dt++){lt.index>Dt?(Ft=lt,lt=null):Ft=lt.sibling;var Yt=de(se,lt,oe[Dt],Se);if(Yt===null){lt===null&&(lt=Ft);break}e&&lt&&Yt.alternate===null&&r(se,lt),Z=g(Yt,Z,Dt),Kt===null?mt=Yt:Kt.sibling=Yt,Kt=Yt,lt=Ft}if(Dt===oe.length)return l(se,lt),Gt&&ps(se,Dt),mt;if(lt===null){for(;Dt<oe.length;Dt++)lt=Ce(se,oe[Dt],Se),lt!==null&&(Z=g(lt,Z,Dt),Kt===null?mt=lt:Kt.sibling=lt,Kt=lt);return Gt&&ps(se,Dt),mt}for(lt=c(lt);Dt<oe.length;Dt++)Ft=ve(lt,se,Dt,oe[Dt],Se),Ft!==null&&(e&&Ft.alternate!==null&&lt.delete(Ft.key===null?Dt:Ft.key),Z=g(Ft,Z,Dt),Kt===null?mt=Ft:Kt.sibling=Ft,Kt=Ft);return e&&lt.forEach(function(pi){return r(se,pi)}),Gt&&ps(se,Dt),mt}function xt(se,Z,oe,Se){if(oe==null)throw Error(a(151));for(var mt=null,Kt=null,lt=Z,Dt=Z=0,Ft=null,Yt=oe.next();lt!==null&&!Yt.done;Dt++,Yt=oe.next()){lt.index>Dt?(Ft=lt,lt=null):Ft=lt.sibling;var pi=de(se,lt,Yt.value,Se);if(pi===null){lt===null&&(lt=Ft);break}e&&lt&&pi.alternate===null&&r(se,lt),Z=g(pi,Z,Dt),Kt===null?mt=pi:Kt.sibling=pi,Kt=pi,lt=Ft}if(Yt.done)return l(se,lt),Gt&&ps(se,Dt),mt;if(lt===null){for(;!Yt.done;Dt++,Yt=oe.next())Yt=Ce(se,Yt.value,Se),Yt!==null&&(Z=g(Yt,Z,Dt),Kt===null?mt=Yt:Kt.sibling=Yt,Kt=Yt);return Gt&&ps(se,Dt),mt}for(lt=c(lt);!Yt.done;Dt++,Yt=oe.next())Yt=ve(lt,se,Dt,Yt.value,Se),Yt!==null&&(e&&Yt.alternate!==null&&lt.delete(Yt.key===null?Dt:Yt.key),Z=g(Yt,Z,Dt),Kt===null?mt=Yt:Kt.sibling=Yt,Kt=Yt);return e&&lt.forEach(function(cS){return r(se,cS)}),Gt&&ps(se,Dt),mt}function on(se,Z,oe,Se){if(typeof oe=="object"&&oe!==null&&oe.type===E&&oe.key===null&&(oe=oe.props.children),typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case w:e:{for(var mt=oe.key;Z!==null;){if(Z.key===mt){if(mt=oe.type,mt===E){if(Z.tag===7){l(se,Z.sibling),Se=p(Z,oe.props.children),Se.return=se,se=Se;break e}}else if(Z.elementType===mt||typeof mt=="object"&&mt!==null&&mt.$$typeof===T&&Ri(mt)===Z.type){l(se,Z.sibling),Se=p(Z,oe.props),Al(Se,oe),Se.return=se,se=Se;break e}l(se,Z);break}else r(se,Z);Z=Z.sibling}oe.type===E?(Se=Ci(oe.props.children,se.mode,Se,oe.key),Se.return=se,se=Se):(Se=ic(oe.type,oe.key,oe.props,null,se.mode,Se),Al(Se,oe),Se.return=se,se=Se)}return S(se);case _:e:{for(mt=oe.key;Z!==null;){if(Z.key===mt)if(Z.tag===4&&Z.stateNode.containerInfo===oe.containerInfo&&Z.stateNode.implementation===oe.implementation){l(se,Z.sibling),Se=p(Z,oe.children||[]),Se.return=se,se=Se;break e}else{l(se,Z);break}else r(se,Z);Z=Z.sibling}Se=pd(oe,se.mode,Se),Se.return=se,se=Se}return S(se);case T:return oe=Ri(oe),on(se,Z,oe,Se)}if(L(oe))return rt(se,Z,oe,Se);if(q(oe)){if(mt=q(oe),typeof mt!="function")throw Error(a(150));return oe=mt.call(oe),xt(se,Z,oe,Se)}if(typeof oe.then=="function")return on(se,Z,hc(oe),Se);if(oe.$$typeof===O)return on(se,Z,oc(se,oe),Se);fc(se,oe)}return typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint"?(oe=""+oe,Z!==null&&Z.tag===6?(l(se,Z.sibling),Se=p(Z,oe),Se.return=se,se=Se):(l(se,Z),Se=fd(oe,se.mode,Se),Se.return=se,se=Se),S(se)):l(se,Z)}return function(se,Z,oe,Se){try{Rl=0;var mt=on(se,Z,oe,Se);return ba=null,mt}catch(lt){if(lt===xa||lt===uc)throw lt;var Kt=xr(29,lt,null,se.mode);return Kt.lanes=Se,Kt.return=se,Kt}}}var Oi=mm(!0),gm=mm(!1),Js=!1;function Ed(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Nd(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Xs(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Zs(e,r,l){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(Wt&2)!==0){var p=c.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),c.pending=r,r=sc(e),Zp(e,null,l),r}return rc(e,c,r,l),sc(e)}function Ol(e,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194048)!==0)){var c=r.lanes;c&=e.pendingLanes,l|=c,r.lanes=l,Xt(e,l)}}function kd(e,r){var l=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var p=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var S={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};g===null?p=g=S:g=g.next=S,l=l.next}while(l!==null);g===null?p=g=r:g=g.next=r}else p=g=r;l={baseState:c.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=r:e.next=r,l.lastBaseUpdate=r}var Td=!1;function Dl(){if(Td){var e=va;if(e!==null)throw e}}function Ml(e,r,l,c){Td=!1;var p=e.updateQueue;Js=!1;var g=p.firstBaseUpdate,S=p.lastBaseUpdate,R=p.shared.pending;if(R!==null){p.shared.pending=null;var Q=R,ce=Q.next;Q.next=null,S===null?g=ce:S.next=ce,S=Q;var we=e.alternate;we!==null&&(we=we.updateQueue,R=we.lastBaseUpdate,R!==S&&(R===null?we.firstBaseUpdate=ce:R.next=ce,we.lastBaseUpdate=Q))}if(g!==null){var Ce=p.baseState;S=0,we=ce=Q=null,R=g;do{var de=R.lane&-536870913,ve=de!==R.lane;if(ve?(qt&de)===de:(c&de)===de){de!==0&&de===ya&&(Td=!0),we!==null&&(we=we.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});e:{var rt=e,xt=R;de=r;var on=l;switch(xt.tag){case 1:if(rt=xt.payload,typeof rt=="function"){Ce=rt.call(on,Ce,de);break e}Ce=rt;break e;case 3:rt.flags=rt.flags&-65537|128;case 0:if(rt=xt.payload,de=typeof rt=="function"?rt.call(on,Ce,de):rt,de==null)break e;Ce=v({},Ce,de);break e;case 2:Js=!0}}de=R.callback,de!==null&&(e.flags|=64,ve&&(e.flags|=8192),ve=p.callbacks,ve===null?p.callbacks=[de]:ve.push(de))}else ve={lane:de,tag:R.tag,payload:R.payload,callback:R.callback,next:null},we===null?(ce=we=ve,Q=Ce):we=we.next=ve,S|=de;if(R=R.next,R===null){if(R=p.shared.pending,R===null)break;ve=R,R=ve.next,ve.next=null,p.lastBaseUpdate=ve,p.shared.pending=null}}while(!0);we===null&&(Q=Ce),p.baseState=Q,p.firstBaseUpdate=ce,p.lastBaseUpdate=we,g===null&&(p.shared.lanes=0),si|=S,e.lanes=S,e.memoizedState=Ce}}function ym(e,r){if(typeof e!="function")throw Error(a(191,e));e.call(r)}function vm(e,r){var l=e.callbacks;if(l!==null)for(e.callbacks=null,e=0;e<l.length;e++)ym(l[e],r)}var wa=B(null),pc=B(0);function xm(e,r){e=Cs,J(pc,e),J(wa,r),Cs=e|r.baseLanes}function Rd(){J(pc,Cs),J(wa,wa.current)}function Ad(){Cs=pc.current,W(wa),W(pc)}var br=B(null),Mr=null;function ei(e){var r=e.alternate;J(kn,kn.current&1),J(br,e),Mr===null&&(r===null||wa.current!==null||r.memoizedState!==null)&&(Mr=e)}function Od(e){J(kn,kn.current),J(br,e),Mr===null&&(Mr=e)}function bm(e){e.tag===22?(J(kn,kn.current),J(br,e),Mr===null&&(Mr=e)):ti()}function ti(){J(kn,kn.current),J(br,br.current)}function wr(e){W(br),Mr===e&&(Mr=null),W(kn)}var kn=B(0);function mc(e){for(var r=e;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||Ih(l)||Bh(l)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var ys=0,Ot=null,an=null,Dn=null,gc=!1,Sa=!1,Di=!1,yc=0,zl=0,ja=null,Zb=0;function jn(){throw Error(a(321))}function Dd(e,r){if(r===null)return!1;for(var l=0;l<r.length&&l<e.length;l++)if(!vr(e[l],r[l]))return!1;return!0}function Md(e,r,l,c,p,g){return ys=g,Ot=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,A.H=e===null||e.memoizedState===null?rg:Qd,Di=!1,g=l(c,p),Di=!1,Sa&&(g=Sm(r,l,c,p)),wm(e),g}function wm(e){A.H=Il;var r=an!==null&&an.next!==null;if(ys=0,Dn=an=Ot=null,gc=!1,zl=0,ja=null,r)throw Error(a(300));e===null||Mn||(e=e.dependencies,e!==null&&lc(e)&&(Mn=!0))}function Sm(e,r,l,c){Ot=e;var p=0;do{if(Sa&&(ja=null),zl=0,Sa=!1,25<=p)throw Error(a(301));if(p+=1,Dn=an=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}A.H=sg,g=r(l,c)}while(Sa);return g}function ew(){var e=A.H,r=e.useState()[0];return r=typeof r.then=="function"?Ul(r):r,e=e.useState()[0],(an!==null?an.memoizedState:null)!==e&&(Ot.flags|=1024),r}function zd(){var e=yc!==0;return yc=0,e}function Ud(e,r,l){r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~l}function Ld(e){if(gc){for(e=e.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}gc=!1}ys=0,Dn=an=Ot=null,Sa=!1,zl=yc=0,ja=null}function lr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?Ot.memoizedState=Dn=e:Dn=Dn.next=e,Dn}function Tn(){if(an===null){var e=Ot.alternate;e=e!==null?e.memoizedState:null}else e=an.next;var r=Dn===null?Ot.memoizedState:Dn.next;if(r!==null)Dn=r,an=e;else{if(e===null)throw Ot.alternate===null?Error(a(467)):Error(a(310));an=e,e={memoizedState:an.memoizedState,baseState:an.baseState,baseQueue:an.baseQueue,queue:an.queue,next:null},Dn===null?Ot.memoizedState=Dn=e:Dn=Dn.next=e}return Dn}function vc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ul(e){var r=zl;return zl+=1,ja===null&&(ja=[]),e=hm(ja,e,r),r=Ot,(Dn===null?r.memoizedState:Dn.next)===null&&(r=r.alternate,A.H=r===null||r.memoizedState===null?rg:Qd),e}function xc(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Ul(e);if(e.$$typeof===O)return Wn(e)}throw Error(a(438,String(e)))}function Id(e){var r=null,l=Ot.updateQueue;if(l!==null&&(r=l.memoCache),r==null){var c=Ot.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(p){return p.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),l===null&&(l=vc(),Ot.updateQueue=l),l.memoCache=r,l=r.data[r.index],l===void 0)for(l=r.data[r.index]=Array(e),c=0;c<e;c++)l[c]=K;return r.index++,l}function vs(e,r){return typeof r=="function"?r(e):r}function bc(e){var r=Tn();return Bd(r,an,e)}function Bd(e,r,l){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=l;var p=e.baseQueue,g=c.pending;if(g!==null){if(p!==null){var S=p.next;p.next=g.next,g.next=S}r.baseQueue=p=g,c.pending=null}if(g=e.baseState,p===null)e.memoizedState=g;else{r=p.next;var R=S=null,Q=null,ce=r,we=!1;do{var Ce=ce.lane&-536870913;if(Ce!==ce.lane?(qt&Ce)===Ce:(ys&Ce)===Ce){var de=ce.revertLane;if(de===0)Q!==null&&(Q=Q.next={lane:0,revertLane:0,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null}),Ce===ya&&(we=!0);else if((ys&de)===de){ce=ce.next,de===ya&&(we=!0);continue}else Ce={lane:0,revertLane:ce.revertLane,gesture:null,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},Q===null?(R=Q=Ce,S=g):Q=Q.next=Ce,Ot.lanes|=de,si|=de;Ce=ce.action,Di&&l(g,Ce),g=ce.hasEagerState?ce.eagerState:l(g,Ce)}else de={lane:Ce,revertLane:ce.revertLane,gesture:ce.gesture,action:ce.action,hasEagerState:ce.hasEagerState,eagerState:ce.eagerState,next:null},Q===null?(R=Q=de,S=g):Q=Q.next=de,Ot.lanes|=Ce,si|=Ce;ce=ce.next}while(ce!==null&&ce!==r);if(Q===null?S=g:Q.next=R,!vr(g,e.memoizedState)&&(Mn=!0,we&&(l=va,l!==null)))throw l;e.memoizedState=g,e.baseState=S,e.baseQueue=Q,c.lastRenderedState=g}return p===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function $d(e){var r=Tn(),l=r.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=e;var c=l.dispatch,p=l.pending,g=r.memoizedState;if(p!==null){l.pending=null;var S=p=p.next;do g=e(g,S.action),S=S.next;while(S!==p);vr(g,r.memoizedState)||(Mn=!0),r.memoizedState=g,r.baseQueue===null&&(r.baseState=g),l.lastRenderedState=g}return[g,c]}function jm(e,r,l){var c=Ot,p=Tn(),g=Gt;if(g){if(l===void 0)throw Error(a(407));l=l()}else l=r();var S=!vr((an||p).memoizedState,l);if(S&&(p.memoizedState=l,Mn=!0),p=p.queue,Fd(Em.bind(null,c,p,e),[e]),p.getSnapshot!==r||S||Dn!==null&&Dn.memoizedState.tag&1){if(c.flags|=2048,_a(9,{destroy:void 0},Cm.bind(null,c,p,l,r),null),un===null)throw Error(a(349));g||(ys&127)!==0||_m(c,r,l)}return l}function _m(e,r,l){e.flags|=16384,e={getSnapshot:r,value:l},r=Ot.updateQueue,r===null?(r=vc(),Ot.updateQueue=r,r.stores=[e]):(l=r.stores,l===null?r.stores=[e]:l.push(e))}function Cm(e,r,l,c){r.value=l,r.getSnapshot=c,Nm(r)&&km(e)}function Em(e,r,l){return l(function(){Nm(r)&&km(e)})}function Nm(e){var r=e.getSnapshot;e=e.value;try{var l=r();return!vr(e,l)}catch{return!0}}function km(e){var r=_i(e,2);r!==null&&mr(r,e,2)}function Pd(e){var r=lr();if(typeof e=="function"){var l=e;if(e=l(),Di){rn(!0);try{l()}finally{rn(!1)}}}return r.memoizedState=r.baseState=e,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:e},r}function Tm(e,r,l,c){return e.baseState=l,Bd(e,an,typeof c=="function"?c:vs)}function tw(e,r,l,c,p){if(jc(e))throw Error(a(485));if(e=r.action,e!==null){var g={payload:p,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){g.listeners.push(S)}};A.T!==null?l(!0):g.isTransition=!1,c(g),l=r.pending,l===null?(g.next=r.pending=g,Rm(r,g)):(g.next=l.next,r.pending=l.next=g)}}function Rm(e,r){var l=r.action,c=r.payload,p=e.state;if(r.isTransition){var g=A.T,S={};A.T=S;try{var R=l(p,c),Q=A.S;Q!==null&&Q(S,R),Am(e,r,R)}catch(ce){qd(e,r,ce)}finally{g!==null&&S.types!==null&&(g.types=S.types),A.T=g}}else try{g=l(p,c),Am(e,r,g)}catch(ce){qd(e,r,ce)}}function Am(e,r,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){Om(e,r,c)},function(c){return qd(e,r,c)}):Om(e,r,l)}function Om(e,r,l){r.status="fulfilled",r.value=l,Dm(r),e.state=l,r=e.pending,r!==null&&(l=r.next,l===r?e.pending=null:(l=l.next,r.next=l,Rm(e,l)))}function qd(e,r,l){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=l,Dm(r),r=r.next;while(r!==c)}e.action=null}function Dm(e){e=e.listeners;for(var r=0;r<e.length;r++)(0,e[r])()}function Mm(e,r){return r}function zm(e,r){if(Gt){var l=un.formState;if(l!==null){e:{var c=Ot;if(Gt){if(gn){t:{for(var p=gn,g=Dr;p.nodeType!==8;){if(!g){p=null;break t}if(p=zr(p.nextSibling),p===null){p=null;break t}}g=p.data,p=g==="F!"||g==="F"?p:null}if(p){gn=zr(p.nextSibling),c=p.data==="F!";break e}}Qs(c)}c=!1}c&&(r=l[0])}}return l=lr(),l.memoizedState=l.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mm,lastRenderedState:r},l.queue=c,l=eg.bind(null,Ot,c),c.dispatch=l,c=Pd(!1),g=Yd.bind(null,Ot,!1,c.queue),c=lr(),p={state:r,dispatch:null,action:e,pending:null},c.queue=p,l=tw.bind(null,Ot,p,g,l),p.dispatch=l,c.memoizedState=e,[r,l,!1]}function Um(e){var r=Tn();return Lm(r,an,e)}function Lm(e,r,l){if(r=Bd(e,r,Mm)[0],e=bc(vs)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=Ul(r)}catch(S){throw S===xa?uc:S}else c=r;r=Tn();var p=r.queue,g=p.dispatch;return l!==r.memoizedState&&(Ot.flags|=2048,_a(9,{destroy:void 0},nw.bind(null,p,l),null)),[c,g,e]}function nw(e,r){e.action=r}function Im(e){var r=Tn(),l=an;if(l!==null)return Lm(r,l,e);Tn(),r=r.memoizedState,l=Tn();var c=l.queue.dispatch;return l.memoizedState=e,[r,c,!1]}function _a(e,r,l,c){return e={tag:e,create:l,deps:c,inst:r,next:null},r=Ot.updateQueue,r===null&&(r=vc(),Ot.updateQueue=r),l=r.lastEffect,l===null?r.lastEffect=e.next=e:(c=l.next,l.next=e,e.next=c,r.lastEffect=e),e}function Bm(){return Tn().memoizedState}function wc(e,r,l,c){var p=lr();Ot.flags|=e,p.memoizedState=_a(1|r,{destroy:void 0},l,c===void 0?null:c)}function Sc(e,r,l,c){var p=Tn();c=c===void 0?null:c;var g=p.memoizedState.inst;an!==null&&c!==null&&Dd(c,an.memoizedState.deps)?p.memoizedState=_a(r,g,l,c):(Ot.flags|=e,p.memoizedState=_a(1|r,g,l,c))}function $m(e,r){wc(8390656,8,e,r)}function Fd(e,r){Sc(2048,8,e,r)}function rw(e){Ot.flags|=4;var r=Ot.updateQueue;if(r===null)r=vc(),Ot.updateQueue=r,r.events=[e];else{var l=r.events;l===null?r.events=[e]:l.push(e)}}function Pm(e){var r=Tn().memoizedState;return rw({ref:r,nextImpl:e}),function(){if((Wt&2)!==0)throw Error(a(440));return r.impl.apply(void 0,arguments)}}function qm(e,r){return Sc(4,2,e,r)}function Fm(e,r){return Sc(4,4,e,r)}function Hm(e,r){if(typeof r=="function"){e=e();var l=r(e);return function(){typeof l=="function"?l():r(null)}}if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function Gm(e,r,l){l=l!=null?l.concat([e]):null,Sc(4,4,Hm.bind(null,r,e),l)}function Hd(){}function Vm(e,r){var l=Tn();r=r===void 0?null:r;var c=l.memoizedState;return r!==null&&Dd(r,c[1])?c[0]:(l.memoizedState=[e,r],e)}function Km(e,r){var l=Tn();r=r===void 0?null:r;var c=l.memoizedState;if(r!==null&&Dd(r,c[1]))return c[0];if(c=e(),Di){rn(!0);try{e()}finally{rn(!1)}}return l.memoizedState=[c,r],c}function Gd(e,r,l){return l===void 0||(ys&1073741824)!==0&&(qt&261930)===0?e.memoizedState=r:(e.memoizedState=l,e=Yg(),Ot.lanes|=e,si|=e,l)}function Ym(e,r,l,c){return vr(l,r)?l:wa.current!==null?(e=Gd(e,l,c),vr(e,r)||(Mn=!0),e):(ys&42)===0||(ys&1073741824)!==0&&(qt&261930)===0?(Mn=!0,e.memoizedState=l):(e=Yg(),Ot.lanes|=e,si|=e,r)}function Qm(e,r,l,c,p){var g=$.p;$.p=g!==0&&8>g?g:8;var S=A.T,R={};A.T=R,Yd(e,!1,r,l);try{var Q=p(),ce=A.S;if(ce!==null&&ce(R,Q),Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var we=Xb(Q,c);Ll(e,r,we,_r(e))}else Ll(e,r,c,_r(e))}catch(Ce){Ll(e,r,{then:function(){},status:"rejected",reason:Ce},_r())}finally{$.p=g,S!==null&&R.types!==null&&(S.types=R.types),A.T=S}}function sw(){}function Vd(e,r,l,c){if(e.tag!==5)throw Error(a(476));var p=Wm(e).queue;Qm(e,p,r,Y,l===null?sw:function(){return Jm(e),l(c)})}function Wm(e){var r=e.memoizedState;if(r!==null)return r;r={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:Y},next:null};var l={};return r.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:l},next:null},e.memoizedState=r,e=e.alternate,e!==null&&(e.memoizedState=r),r}function Jm(e){var r=Wm(e);r.next===null&&(r=e.alternate.memoizedState),Ll(e,r.next.queue,{},_r())}function Kd(){return Wn(eo)}function Xm(){return Tn().memoizedState}function Zm(){return Tn().memoizedState}function iw(e){for(var r=e.return;r!==null;){switch(r.tag){case 24:case 3:var l=_r();e=Xs(l);var c=Zs(r,e,l);c!==null&&(mr(c,r,l),Ol(c,r,l)),r={cache:Sd()},e.payload=r;return}r=r.return}}function aw(e,r,l){var c=_r();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},jc(e)?tg(r,l):(l=dd(e,r,l,c),l!==null&&(mr(l,e,c),ng(l,r,c)))}function eg(e,r,l){var c=_r();Ll(e,r,l,c)}function Ll(e,r,l,c){var p={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(jc(e))tg(r,p);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=r.lastRenderedReducer,g!==null))try{var S=r.lastRenderedState,R=g(S,l);if(p.hasEagerState=!0,p.eagerState=R,vr(R,S))return rc(e,r,p,0),un===null&&nc(),!1}catch{}if(l=dd(e,r,p,c),l!==null)return mr(l,e,c),ng(l,r,c),!0}return!1}function Yd(e,r,l,c){if(c={lane:2,revertLane:Eh(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},jc(e)){if(r)throw Error(a(479))}else r=dd(e,l,c,2),r!==null&&mr(r,e,2)}function jc(e){var r=e.alternate;return e===Ot||r!==null&&r===Ot}function tg(e,r){Sa=gc=!0;var l=e.pending;l===null?r.next=r:(r.next=l.next,l.next=r),e.pending=r}function ng(e,r,l){if((l&4194048)!==0){var c=r.lanes;c&=e.pendingLanes,l|=c,r.lanes=l,Xt(e,l)}}var Il={readContext:Wn,use:xc,useCallback:jn,useContext:jn,useEffect:jn,useImperativeHandle:jn,useLayoutEffect:jn,useInsertionEffect:jn,useMemo:jn,useReducer:jn,useRef:jn,useState:jn,useDebugValue:jn,useDeferredValue:jn,useTransition:jn,useSyncExternalStore:jn,useId:jn,useHostTransitionStatus:jn,useFormState:jn,useActionState:jn,useOptimistic:jn,useMemoCache:jn,useCacheRefresh:jn};Il.useEffectEvent=jn;var rg={readContext:Wn,use:xc,useCallback:function(e,r){return lr().memoizedState=[e,r===void 0?null:r],e},useContext:Wn,useEffect:$m,useImperativeHandle:function(e,r,l){l=l!=null?l.concat([e]):null,wc(4194308,4,Hm.bind(null,r,e),l)},useLayoutEffect:function(e,r){return wc(4194308,4,e,r)},useInsertionEffect:function(e,r){wc(4,2,e,r)},useMemo:function(e,r){var l=lr();r=r===void 0?null:r;var c=e();if(Di){rn(!0);try{e()}finally{rn(!1)}}return l.memoizedState=[c,r],c},useReducer:function(e,r,l){var c=lr();if(l!==void 0){var p=l(r);if(Di){rn(!0);try{l(r)}finally{rn(!1)}}}else p=r;return c.memoizedState=c.baseState=p,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:p},c.queue=e,e=e.dispatch=aw.bind(null,Ot,e),[c.memoizedState,e]},useRef:function(e){var r=lr();return e={current:e},r.memoizedState=e},useState:function(e){e=Pd(e);var r=e.queue,l=eg.bind(null,Ot,r);return r.dispatch=l,[e.memoizedState,l]},useDebugValue:Hd,useDeferredValue:function(e,r){var l=lr();return Gd(l,e,r)},useTransition:function(){var e=Pd(!1);return e=Qm.bind(null,Ot,e.queue,!0,!1),lr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,r,l){var c=Ot,p=lr();if(Gt){if(l===void 0)throw Error(a(407));l=l()}else{if(l=r(),un===null)throw Error(a(349));(qt&127)!==0||_m(c,r,l)}p.memoizedState=l;var g={value:l,getSnapshot:r};return p.queue=g,$m(Em.bind(null,c,g,e),[e]),c.flags|=2048,_a(9,{destroy:void 0},Cm.bind(null,c,g,l,r),null),l},useId:function(){var e=lr(),r=un.identifierPrefix;if(Gt){var l=ss,c=rs;l=(c&~(1<<32-cn(c)-1)).toString(32)+l,r="_"+r+"R_"+l,l=yc++,0<l&&(r+="H"+l.toString(32)),r+="_"}else l=Zb++,r="_"+r+"r_"+l.toString(32)+"_";return e.memoizedState=r},useHostTransitionStatus:Kd,useFormState:zm,useActionState:zm,useOptimistic:function(e){var r=lr();r.memoizedState=r.baseState=e;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=l,r=Yd.bind(null,Ot,!0,l),l.dispatch=r,[e,r]},useMemoCache:Id,useCacheRefresh:function(){return lr().memoizedState=iw.bind(null,Ot)},useEffectEvent:function(e){var r=lr(),l={impl:e};return r.memoizedState=l,function(){if((Wt&2)!==0)throw Error(a(440));return l.impl.apply(void 0,arguments)}}},Qd={readContext:Wn,use:xc,useCallback:Vm,useContext:Wn,useEffect:Fd,useImperativeHandle:Gm,useInsertionEffect:qm,useLayoutEffect:Fm,useMemo:Km,useReducer:bc,useRef:Bm,useState:function(){return bc(vs)},useDebugValue:Hd,useDeferredValue:function(e,r){var l=Tn();return Ym(l,an.memoizedState,e,r)},useTransition:function(){var e=bc(vs)[0],r=Tn().memoizedState;return[typeof e=="boolean"?e:Ul(e),r]},useSyncExternalStore:jm,useId:Xm,useHostTransitionStatus:Kd,useFormState:Um,useActionState:Um,useOptimistic:function(e,r){var l=Tn();return Tm(l,an,e,r)},useMemoCache:Id,useCacheRefresh:Zm};Qd.useEffectEvent=Pm;var sg={readContext:Wn,use:xc,useCallback:Vm,useContext:Wn,useEffect:Fd,useImperativeHandle:Gm,useInsertionEffect:qm,useLayoutEffect:Fm,useMemo:Km,useReducer:$d,useRef:Bm,useState:function(){return $d(vs)},useDebugValue:Hd,useDeferredValue:function(e,r){var l=Tn();return an===null?Gd(l,e,r):Ym(l,an.memoizedState,e,r)},useTransition:function(){var e=$d(vs)[0],r=Tn().memoizedState;return[typeof e=="boolean"?e:Ul(e),r]},useSyncExternalStore:jm,useId:Xm,useHostTransitionStatus:Kd,useFormState:Im,useActionState:Im,useOptimistic:function(e,r){var l=Tn();return an!==null?Tm(l,an,e,r):(l.baseState=e,[e,l.queue.dispatch])},useMemoCache:Id,useCacheRefresh:Zm};sg.useEffectEvent=Pm;function Wd(e,r,l,c){r=e.memoizedState,l=l(c,r),l=l==null?r:v({},r,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var Jd={enqueueSetState:function(e,r,l){e=e._reactInternals;var c=_r(),p=Xs(c);p.payload=r,l!=null&&(p.callback=l),r=Zs(e,p,c),r!==null&&(mr(r,e,c),Ol(r,e,c))},enqueueReplaceState:function(e,r,l){e=e._reactInternals;var c=_r(),p=Xs(c);p.tag=1,p.payload=r,l!=null&&(p.callback=l),r=Zs(e,p,c),r!==null&&(mr(r,e,c),Ol(r,e,c))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var l=_r(),c=Xs(l);c.tag=2,r!=null&&(c.callback=r),r=Zs(e,c,l),r!==null&&(mr(r,e,l),Ol(r,e,l))}};function ig(e,r,l,c,p,g,S){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,S):r.prototype&&r.prototype.isPureReactComponent?!_l(l,c)||!_l(p,g):!0}function ag(e,r,l,c){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,c),r.state!==e&&Jd.enqueueReplaceState(r,r.state,null)}function Mi(e,r){var l=r;if("ref"in r){l={};for(var c in r)c!=="ref"&&(l[c]=r[c])}if(e=e.defaultProps){l===r&&(l=v({},l));for(var p in e)l[p]===void 0&&(l[p]=e[p])}return l}function lg(e){tc(e)}function og(e){console.error(e)}function cg(e){tc(e)}function _c(e,r){try{var l=e.onUncaughtError;l(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function ug(e,r,l){try{var c=e.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Xd(e,r,l){return l=Xs(l),l.tag=3,l.payload={element:null},l.callback=function(){_c(e,r)},l}function dg(e){return e=Xs(e),e.tag=3,e}function hg(e,r,l,c){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var g=c.value;e.payload=function(){return p(g)},e.callback=function(){ug(r,l,c)}}var S=l.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(e.callback=function(){ug(r,l,c),typeof p!="function"&&(ii===null?ii=new Set([this]):ii.add(this));var R=c.stack;this.componentDidCatch(c.value,{componentStack:R!==null?R:""})})}function lw(e,r,l,c,p){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=l.alternate,r!==null&&ga(r,l,p,!0),l=br.current,l!==null){switch(l.tag){case 31:case 13:return Mr===null?Uc():l.alternate===null&&_n===0&&(_n=3),l.flags&=-257,l.flags|=65536,l.lanes=p,c===dc?l.flags|=16384:(r=l.updateQueue,r===null?l.updateQueue=new Set([c]):r.add(c),jh(e,c,p)),!1;case 22:return l.flags|=65536,c===dc?l.flags|=16384:(r=l.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=r):(l=r.retryQueue,l===null?r.retryQueue=new Set([c]):l.add(c)),jh(e,c,p)),!1}throw Error(a(435,l.tag))}return jh(e,c,p),Uc(),!1}if(Gt)return r=br.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=p,c!==yd&&(e=Error(a(422),{cause:c}),Nl(Rr(e,l)))):(c!==yd&&(r=Error(a(423),{cause:c}),Nl(Rr(r,l))),e=e.current.alternate,e.flags|=65536,p&=-p,e.lanes|=p,c=Rr(c,l),p=Xd(e.stateNode,c,p),kd(e,p),_n!==4&&(_n=2)),!1;var g=Error(a(520),{cause:c});if(g=Rr(g,l),Vl===null?Vl=[g]:Vl.push(g),_n!==4&&(_n=2),r===null)return!0;c=Rr(c,l),l=r;do{switch(l.tag){case 3:return l.flags|=65536,e=p&-p,l.lanes|=e,e=Xd(l.stateNode,c,e),kd(l,e),!1;case 1:if(r=l.type,g=l.stateNode,(l.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ii===null||!ii.has(g))))return l.flags|=65536,p&=-p,l.lanes|=p,p=dg(p),hg(p,e,l,c),kd(l,p),!1}l=l.return}while(l!==null);return!1}var Zd=Error(a(461)),Mn=!1;function Jn(e,r,l,c){r.child=e===null?gm(r,null,l,c):Oi(r,e.child,l,c)}function fg(e,r,l,c,p){l=l.render;var g=r.ref;if("ref"in c){var S={};for(var R in c)R!=="ref"&&(S[R]=c[R])}else S=c;return ki(r),c=Md(e,r,l,S,g,p),R=zd(),e!==null&&!Mn?(Ud(e,r,p),xs(e,r,p)):(Gt&&R&&md(r),r.flags|=1,Jn(e,r,c,p),r.child)}function pg(e,r,l,c,p){if(e===null){var g=l.type;return typeof g=="function"&&!hd(g)&&g.defaultProps===void 0&&l.compare===null?(r.tag=15,r.type=g,mg(e,r,g,c,p)):(e=ic(l.type,null,c,r,r.mode,p),e.ref=r.ref,e.return=r,r.child=e)}if(g=e.child,!lh(e,p)){var S=g.memoizedProps;if(l=l.compare,l=l!==null?l:_l,l(S,c)&&e.ref===r.ref)return xs(e,r,p)}return r.flags|=1,e=fs(g,c),e.ref=r.ref,e.return=r,r.child=e}function mg(e,r,l,c,p){if(e!==null){var g=e.memoizedProps;if(_l(g,c)&&e.ref===r.ref)if(Mn=!1,r.pendingProps=c=g,lh(e,p))(e.flags&131072)!==0&&(Mn=!0);else return r.lanes=e.lanes,xs(e,r,p)}return eh(e,r,l,c,p)}function gg(e,r,l,c){var p=c.children,g=e!==null?e.memoizedState:null;if(e===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((r.flags&128)!==0){if(g=g!==null?g.baseLanes|l:l,e!==null){for(c=r.child=e.child,p=0;c!==null;)p=p|c.lanes|c.childLanes,c=c.sibling;c=p&~g}else c=0,r.child=null;return yg(e,r,g,l,c)}if((l&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},e!==null&&cc(r,g!==null?g.cachePool:null),g!==null?xm(r,g):Rd(),bm(r);else return c=r.lanes=536870912,yg(e,r,g!==null?g.baseLanes|l:l,l,c)}else g!==null?(cc(r,g.cachePool),xm(r,g),ti(),r.memoizedState=null):(e!==null&&cc(r,null),Rd(),ti());return Jn(e,r,p,l),r.child}function Bl(e,r){return e!==null&&e.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function yg(e,r,l,c,p){var g=_d();return g=g===null?null:{parent:On._currentValue,pool:g},r.memoizedState={baseLanes:l,cachePool:g},e!==null&&cc(r,null),Rd(),bm(r),e!==null&&ga(e,r,c,!0),r.childLanes=p,null}function Cc(e,r){return r=Nc({mode:r.mode,children:r.children},e.mode),r.ref=e.ref,e.child=r,r.return=e,r}function vg(e,r,l){return Oi(r,e.child,null,l),e=Cc(r,r.pendingProps),e.flags|=2,wr(r),r.memoizedState=null,e}function ow(e,r,l){var c=r.pendingProps,p=(r.flags&128)!==0;if(r.flags&=-129,e===null){if(Gt){if(c.mode==="hidden")return e=Cc(r,c),r.lanes=536870912,Bl(null,e);if(Od(r),(e=gn)?(e=Ry(e,Dr),e=e!==null&&e.data==="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Ks!==null?{id:rs,overflow:ss}:null,retryLane:536870912,hydrationErrors:null},l=tm(e),l.return=r,r.child=l,Qn=r,gn=null)):e=null,e===null)throw Qs(r);return r.lanes=536870912,null}return Cc(r,c)}var g=e.memoizedState;if(g!==null){var S=g.dehydrated;if(Od(r),p)if(r.flags&256)r.flags&=-257,r=vg(e,r,l);else if(r.memoizedState!==null)r.child=e.child,r.flags|=128,r=null;else throw Error(a(558));else if(Mn||ga(e,r,l,!1),p=(l&e.childLanes)!==0,Mn||p){if(c=un,c!==null&&(S=Qt(c,l),S!==0&&S!==g.retryLane))throw g.retryLane=S,_i(e,S),mr(c,e,S),Zd;Uc(),r=vg(e,r,l)}else e=g.treeContext,gn=zr(S.nextSibling),Qn=r,Gt=!0,Ys=null,Dr=!1,e!==null&&sm(r,e),r=Cc(r,c),r.flags|=4096;return r}return e=fs(e.child,{mode:c.mode,children:c.children}),e.ref=r.ref,r.child=e,e.return=r,e}function Ec(e,r){var l=r.ref;if(l===null)e!==null&&e.ref!==null&&(r.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(a(284));(e===null||e.ref!==l)&&(r.flags|=4194816)}}function eh(e,r,l,c,p){return ki(r),l=Md(e,r,l,c,void 0,p),c=zd(),e!==null&&!Mn?(Ud(e,r,p),xs(e,r,p)):(Gt&&c&&md(r),r.flags|=1,Jn(e,r,l,p),r.child)}function xg(e,r,l,c,p,g){return ki(r),r.updateQueue=null,l=Sm(r,c,l,p),wm(e),c=zd(),e!==null&&!Mn?(Ud(e,r,g),xs(e,r,g)):(Gt&&c&&md(r),r.flags|=1,Jn(e,r,l,g),r.child)}function bg(e,r,l,c,p){if(ki(r),r.stateNode===null){var g=ha,S=l.contextType;typeof S=="object"&&S!==null&&(g=Wn(S)),g=new l(c,g),r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Jd,r.stateNode=g,g._reactInternals=r,g=r.stateNode,g.props=c,g.state=r.memoizedState,g.refs={},Ed(r),S=l.contextType,g.context=typeof S=="object"&&S!==null?Wn(S):ha,g.state=r.memoizedState,S=l.getDerivedStateFromProps,typeof S=="function"&&(Wd(r,l,S,c),g.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(S=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),S!==g.state&&Jd.enqueueReplaceState(g,g.state,null),Ml(r,c,g,p),Dl(),g.state=r.memoizedState),typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(e===null){g=r.stateNode;var R=r.memoizedProps,Q=Mi(l,R);g.props=Q;var ce=g.context,we=l.contextType;S=ha,typeof we=="object"&&we!==null&&(S=Wn(we));var Ce=l.getDerivedStateFromProps;we=typeof Ce=="function"||typeof g.getSnapshotBeforeUpdate=="function",R=r.pendingProps!==R,we||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(R||ce!==S)&&ag(r,g,c,S),Js=!1;var de=r.memoizedState;g.state=de,Ml(r,c,g,p),Dl(),ce=r.memoizedState,R||de!==ce||Js?(typeof Ce=="function"&&(Wd(r,l,Ce,c),ce=r.memoizedState),(Q=Js||ig(r,l,Q,c,de,ce,S))?(we||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=ce),g.props=c,g.state=ce,g.context=S,c=Q):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{g=r.stateNode,Nd(e,r),S=r.memoizedProps,we=Mi(l,S),g.props=we,Ce=r.pendingProps,de=g.context,ce=l.contextType,Q=ha,typeof ce=="object"&&ce!==null&&(Q=Wn(ce)),R=l.getDerivedStateFromProps,(ce=typeof R=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(S!==Ce||de!==Q)&&ag(r,g,c,Q),Js=!1,de=r.memoizedState,g.state=de,Ml(r,c,g,p),Dl();var ve=r.memoizedState;S!==Ce||de!==ve||Js||e!==null&&e.dependencies!==null&&lc(e.dependencies)?(typeof R=="function"&&(Wd(r,l,R,c),ve=r.memoizedState),(we=Js||ig(r,l,we,c,de,ve,Q)||e!==null&&e.dependencies!==null&&lc(e.dependencies))?(ce||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,ve,Q),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,ve,Q)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||S===e.memoizedProps&&de===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&de===e.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=ve),g.props=c,g.state=ve,g.context=Q,c=we):(typeof g.componentDidUpdate!="function"||S===e.memoizedProps&&de===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&de===e.memoizedState||(r.flags|=1024),c=!1)}return g=c,Ec(e,r),c=(r.flags&128)!==0,g||c?(g=r.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:g.render(),r.flags|=1,e!==null&&c?(r.child=Oi(r,e.child,null,p),r.child=Oi(r,null,l,p)):Jn(e,r,l,p),r.memoizedState=g.state,e=r.child):e=xs(e,r,p),e}function wg(e,r,l,c){return Ei(),r.flags|=256,Jn(e,r,l,c),r.child}var th={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function nh(e){return{baseLanes:e,cachePool:um()}}function rh(e,r,l){return e=e!==null?e.childLanes&~l:0,r&&(e|=jr),e}function Sg(e,r,l){var c=r.pendingProps,p=!1,g=(r.flags&128)!==0,S;if((S=g)||(S=e!==null&&e.memoizedState===null?!1:(kn.current&2)!==0),S&&(p=!0,r.flags&=-129),S=(r.flags&32)!==0,r.flags&=-33,e===null){if(Gt){if(p?ei(r):ti(),(e=gn)?(e=Ry(e,Dr),e=e!==null&&e.data!=="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Ks!==null?{id:rs,overflow:ss}:null,retryLane:536870912,hydrationErrors:null},l=tm(e),l.return=r,r.child=l,Qn=r,gn=null)):e=null,e===null)throw Qs(r);return Bh(e)?r.lanes=32:r.lanes=536870912,null}var R=c.children;return c=c.fallback,p?(ti(),p=r.mode,R=Nc({mode:"hidden",children:R},p),c=Ci(c,p,l,null),R.return=r,c.return=r,R.sibling=c,r.child=R,c=r.child,c.memoizedState=nh(l),c.childLanes=rh(e,S,l),r.memoizedState=th,Bl(null,c)):(ei(r),sh(r,R))}var Q=e.memoizedState;if(Q!==null&&(R=Q.dehydrated,R!==null)){if(g)r.flags&256?(ei(r),r.flags&=-257,r=ih(e,r,l)):r.memoizedState!==null?(ti(),r.child=e.child,r.flags|=128,r=null):(ti(),R=c.fallback,p=r.mode,c=Nc({mode:"visible",children:c.children},p),R=Ci(R,p,l,null),R.flags|=2,c.return=r,R.return=r,c.sibling=R,r.child=c,Oi(r,e.child,null,l),c=r.child,c.memoizedState=nh(l),c.childLanes=rh(e,S,l),r.memoizedState=th,r=Bl(null,c));else if(ei(r),Bh(R)){if(S=R.nextSibling&&R.nextSibling.dataset,S)var ce=S.dgst;S=ce,c=Error(a(419)),c.stack="",c.digest=S,Nl({value:c,source:null,stack:null}),r=ih(e,r,l)}else if(Mn||ga(e,r,l,!1),S=(l&e.childLanes)!==0,Mn||S){if(S=un,S!==null&&(c=Qt(S,l),c!==0&&c!==Q.retryLane))throw Q.retryLane=c,_i(e,c),mr(S,e,c),Zd;Ih(R)||Uc(),r=ih(e,r,l)}else Ih(R)?(r.flags|=192,r.child=e.child,r=null):(e=Q.treeContext,gn=zr(R.nextSibling),Qn=r,Gt=!0,Ys=null,Dr=!1,e!==null&&sm(r,e),r=sh(r,c.children),r.flags|=4096);return r}return p?(ti(),R=c.fallback,p=r.mode,Q=e.child,ce=Q.sibling,c=fs(Q,{mode:"hidden",children:c.children}),c.subtreeFlags=Q.subtreeFlags&65011712,ce!==null?R=fs(ce,R):(R=Ci(R,p,l,null),R.flags|=2),R.return=r,c.return=r,c.sibling=R,r.child=c,Bl(null,c),c=r.child,R=e.child.memoizedState,R===null?R=nh(l):(p=R.cachePool,p!==null?(Q=On._currentValue,p=p.parent!==Q?{parent:Q,pool:Q}:p):p=um(),R={baseLanes:R.baseLanes|l,cachePool:p}),c.memoizedState=R,c.childLanes=rh(e,S,l),r.memoizedState=th,Bl(e.child,c)):(ei(r),l=e.child,e=l.sibling,l=fs(l,{mode:"visible",children:c.children}),l.return=r,l.sibling=null,e!==null&&(S=r.deletions,S===null?(r.deletions=[e],r.flags|=16):S.push(e)),r.child=l,r.memoizedState=null,l)}function sh(e,r){return r=Nc({mode:"visible",children:r},e.mode),r.return=e,e.child=r}function Nc(e,r){return e=xr(22,e,null,r),e.lanes=0,e}function ih(e,r,l){return Oi(r,e.child,null,l),e=sh(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function jg(e,r,l){e.lanes|=r;var c=e.alternate;c!==null&&(c.lanes|=r),bd(e.return,r,l)}function ah(e,r,l,c,p,g){var S=e.memoizedState;S===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:p,treeForkCount:g}:(S.isBackwards=r,S.rendering=null,S.renderingStartTime=0,S.last=c,S.tail=l,S.tailMode=p,S.treeForkCount=g)}function _g(e,r,l){var c=r.pendingProps,p=c.revealOrder,g=c.tail;c=c.children;var S=kn.current,R=(S&2)!==0;if(R?(S=S&1|2,r.flags|=128):S&=1,J(kn,S),Jn(e,r,c,l),c=Gt?El:0,!R&&e!==null&&(e.flags&128)!==0)e:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&jg(e,l,r);else if(e.tag===19)jg(e,l,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break e;for(;e.sibling===null;){if(e.return===null||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(p){case"forwards":for(l=r.child,p=null;l!==null;)e=l.alternate,e!==null&&mc(e)===null&&(p=l),l=l.sibling;l=p,l===null?(p=r.child,r.child=null):(p=l.sibling,l.sibling=null),ah(r,!1,p,l,g,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,p=r.child,r.child=null;p!==null;){if(e=p.alternate,e!==null&&mc(e)===null){r.child=p;break}e=p.sibling,p.sibling=l,l=p,p=e}ah(r,!0,l,null,g,c);break;case"together":ah(r,!1,null,null,void 0,c);break;default:r.memoizedState=null}return r.child}function xs(e,r,l){if(e!==null&&(r.dependencies=e.dependencies),si|=r.lanes,(l&r.childLanes)===0)if(e!==null){if(ga(e,r,l,!1),(l&r.childLanes)===0)return null}else return null;if(e!==null&&r.child!==e.child)throw Error(a(153));if(r.child!==null){for(e=r.child,l=fs(e,e.pendingProps),r.child=l,l.return=r;e.sibling!==null;)e=e.sibling,l=l.sibling=fs(e,e.pendingProps),l.return=r;l.sibling=null}return r.child}function lh(e,r){return(e.lanes&r)!==0?!0:(e=e.dependencies,!!(e!==null&&lc(e)))}function cw(e,r,l){switch(r.tag){case 3:I(r,r.stateNode.containerInfo),Ws(r,On,e.memoizedState.cache),Ei();break;case 27:case 5:ye(r);break;case 4:I(r,r.stateNode.containerInfo);break;case 10:Ws(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Od(r),null;break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(ei(r),r.flags|=128,null):(l&r.child.childLanes)!==0?Sg(e,r,l):(ei(r),e=xs(e,r,l),e!==null?e.sibling:null);ei(r);break;case 19:var p=(e.flags&128)!==0;if(c=(l&r.childLanes)!==0,c||(ga(e,r,l,!1),c=(l&r.childLanes)!==0),p){if(c)return _g(e,r,l);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),J(kn,kn.current),c)break;return null;case 22:return r.lanes=0,gg(e,r,l,r.pendingProps);case 24:Ws(r,On,e.memoizedState.cache)}return xs(e,r,l)}function Cg(e,r,l){if(e!==null)if(e.memoizedProps!==r.pendingProps)Mn=!0;else{if(!lh(e,l)&&(r.flags&128)===0)return Mn=!1,cw(e,r,l);Mn=(e.flags&131072)!==0}else Mn=!1,Gt&&(r.flags&1048576)!==0&&rm(r,El,r.index);switch(r.lanes=0,r.tag){case 16:e:{var c=r.pendingProps;if(e=Ri(r.elementType),r.type=e,typeof e=="function")hd(e)?(c=Mi(e,c),r.tag=1,r=bg(null,r,e,c,l)):(r.tag=0,r=eh(null,r,e,c,l));else{if(e!=null){var p=e.$$typeof;if(p===U){r.tag=11,r=fg(null,r,e,c,l);break e}else if(p===M){r.tag=14,r=pg(null,r,e,c,l);break e}}throw r=P(e)||e,Error(a(306,r,""))}}return r;case 0:return eh(e,r,r.type,r.pendingProps,l);case 1:return c=r.type,p=Mi(c,r.pendingProps),bg(e,r,c,p,l);case 3:e:{if(I(r,r.stateNode.containerInfo),e===null)throw Error(a(387));c=r.pendingProps;var g=r.memoizedState;p=g.element,Nd(e,r),Ml(r,c,null,l);var S=r.memoizedState;if(c=S.cache,Ws(r,On,c),c!==g.cache&&wd(r,[On],l,!0),Dl(),c=S.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:S.cache},r.updateQueue.baseState=g,r.memoizedState=g,r.flags&256){r=wg(e,r,c,l);break e}else if(c!==p){p=Rr(Error(a(424)),r),Nl(p),r=wg(e,r,c,l);break e}else for(e=r.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,gn=zr(e.firstChild),Qn=r,Gt=!0,Ys=null,Dr=!0,l=gm(r,null,c,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Ei(),c===p){r=xs(e,r,l);break e}Jn(e,r,c,l)}r=r.child}return r;case 26:return Ec(e,r),e===null?(l=Uy(r.type,null,r.pendingProps,null))?r.memoizedState=l:Gt||(l=r.type,e=r.pendingProps,c=Fc(Re.current).createElement(l),c[Ze]=r,c[Ye]=e,Xn(c,l,e),Nt(c),r.stateNode=c):r.memoizedState=Uy(r.type,e.memoizedProps,r.pendingProps,e.memoizedState),null;case 27:return ye(r),e===null&&Gt&&(c=r.stateNode=Dy(r.type,r.pendingProps,Re.current),Qn=r,Dr=!0,p=gn,ci(r.type)?($h=p,gn=zr(c.firstChild)):gn=p),Jn(e,r,r.pendingProps.children,l),Ec(e,r),e===null&&(r.flags|=4194304),r.child;case 5:return e===null&&Gt&&((p=c=gn)&&(c=Bw(c,r.type,r.pendingProps,Dr),c!==null?(r.stateNode=c,Qn=r,gn=zr(c.firstChild),Dr=!1,p=!0):p=!1),p||Qs(r)),ye(r),p=r.type,g=r.pendingProps,S=e!==null?e.memoizedProps:null,c=g.children,zh(p,g)?c=null:S!==null&&zh(p,S)&&(r.flags|=32),r.memoizedState!==null&&(p=Md(e,r,ew,null,null,l),eo._currentValue=p),Ec(e,r),Jn(e,r,c,l),r.child;case 6:return e===null&&Gt&&((e=l=gn)&&(l=$w(l,r.pendingProps,Dr),l!==null?(r.stateNode=l,Qn=r,gn=null,e=!0):e=!1),e||Qs(r)),null;case 13:return Sg(e,r,l);case 4:return I(r,r.stateNode.containerInfo),c=r.pendingProps,e===null?r.child=Oi(r,null,c,l):Jn(e,r,c,l),r.child;case 11:return fg(e,r,r.type,r.pendingProps,l);case 7:return Jn(e,r,r.pendingProps,l),r.child;case 8:return Jn(e,r,r.pendingProps.children,l),r.child;case 12:return Jn(e,r,r.pendingProps.children,l),r.child;case 10:return c=r.pendingProps,Ws(r,r.type,c.value),Jn(e,r,c.children,l),r.child;case 9:return p=r.type._context,c=r.pendingProps.children,ki(r),p=Wn(p),c=c(p),r.flags|=1,Jn(e,r,c,l),r.child;case 14:return pg(e,r,r.type,r.pendingProps,l);case 15:return mg(e,r,r.type,r.pendingProps,l);case 19:return _g(e,r,l);case 31:return ow(e,r,l);case 22:return gg(e,r,l,r.pendingProps);case 24:return ki(r),c=Wn(On),e===null?(p=_d(),p===null&&(p=un,g=Sd(),p.pooledCache=g,g.refCount++,g!==null&&(p.pooledCacheLanes|=l),p=g),r.memoizedState={parent:c,cache:p},Ed(r),Ws(r,On,p)):((e.lanes&l)!==0&&(Nd(e,r),Ml(r,null,null,l),Dl()),p=e.memoizedState,g=r.memoizedState,p.parent!==c?(p={parent:c,cache:c},r.memoizedState=p,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=p),Ws(r,On,c)):(c=g.cache,Ws(r,On,c),c!==p.cache&&wd(r,[On],l,!0))),Jn(e,r,r.pendingProps.children,l),r.child;case 29:throw r.pendingProps}throw Error(a(156,r.tag))}function bs(e){e.flags|=4}function oh(e,r,l,c,p){if((r=(e.mode&32)!==0)&&(r=!1),r){if(e.flags|=16777216,(p&335544128)===p)if(e.stateNode.complete)e.flags|=8192;else if(Xg())e.flags|=8192;else throw Ai=dc,Cd}else e.flags&=-16777217}function Eg(e,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Py(r))if(Xg())e.flags|=8192;else throw Ai=dc,Cd}function kc(e,r){r!==null&&(e.flags|=4),e.flags&16384&&(r=e.tag!==22?At():536870912,e.lanes|=r,ka|=r)}function $l(e,r){if(!Gt)switch(e.tailMode){case"hidden":r=e.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function yn(e){var r=e.alternate!==null&&e.alternate.child===e.child,l=0,c=0;if(r)for(var p=e.child;p!==null;)l|=p.lanes|p.childLanes,c|=p.subtreeFlags&65011712,c|=p.flags&65011712,p.return=e,p=p.sibling;else for(p=e.child;p!==null;)l|=p.lanes|p.childLanes,c|=p.subtreeFlags,c|=p.flags,p.return=e,p=p.sibling;return e.subtreeFlags|=c,e.childLanes=l,r}function uw(e,r,l){var c=r.pendingProps;switch(gd(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yn(r),null;case 1:return yn(r),null;case 3:return l=r.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),gs(On),te(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(ma(r)?bs(r):e===null||e.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,vd())),yn(r),null;case 26:var p=r.type,g=r.memoizedState;return e===null?(bs(r),g!==null?(yn(r),Eg(r,g)):(yn(r),oh(r,p,null,c,l))):g?g!==e.memoizedState?(bs(r),yn(r),Eg(r,g)):(yn(r),r.flags&=-16777217):(e=e.memoizedProps,e!==c&&bs(r),yn(r),oh(r,p,e,c,l)),null;case 27:if(Ne(r),l=Re.current,p=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(!c){if(r.stateNode===null)throw Error(a(166));return yn(r),null}e=ge.current,ma(r)?im(r):(e=Dy(p,c,l),r.stateNode=e,bs(r))}return yn(r),null;case 5:if(Ne(r),p=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(!c){if(r.stateNode===null)throw Error(a(166));return yn(r),null}if(g=ge.current,ma(r))im(r);else{var S=Fc(Re.current);switch(g){case 1:g=S.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:g=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":g=S.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":g=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":g=S.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof c.is=="string"?S.createElement("select",{is:c.is}):S.createElement("select"),c.multiple?g.multiple=!0:c.size&&(g.size=c.size);break;default:g=typeof c.is=="string"?S.createElement(p,{is:c.is}):S.createElement(p)}}g[Ze]=r,g[Ye]=c;e:for(S=r.child;S!==null;){if(S.tag===5||S.tag===6)g.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===r)break e;for(;S.sibling===null;){if(S.return===null||S.return===r)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}r.stateNode=g;e:switch(Xn(g,p,c),p){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&bs(r)}}return yn(r),oh(r,r.type,e===null?null:e.memoizedProps,r.pendingProps,l),null;case 6:if(e&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(a(166));if(e=Re.current,ma(r)){if(e=r.stateNode,l=r.memoizedProps,c=null,p=Qn,p!==null)switch(p.tag){case 27:case 5:c=p.memoizedProps}e[Ze]=r,e=!!(e.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||Sy(e.nodeValue,l)),e||Qs(r,!0)}else e=Fc(e).createTextNode(c),e[Ze]=r,r.stateNode=e}return yn(r),null;case 31:if(l=r.memoizedState,e===null||e.memoizedState!==null){if(c=ma(r),l!==null){if(e===null){if(!c)throw Error(a(318));if(e=r.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[Ze]=r}else Ei(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;yn(r),e=!1}else l=vd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=l),e=!0;if(!e)return r.flags&256?(wr(r),r):(wr(r),null);if((r.flags&128)!==0)throw Error(a(558))}return yn(r),null;case 13:if(c=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(p=ma(r),c!==null&&c.dehydrated!==null){if(e===null){if(!p)throw Error(a(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(a(317));p[Ze]=r}else Ei(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;yn(r),p=!1}else p=vd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=p),p=!0;if(!p)return r.flags&256?(wr(r),r):(wr(r),null)}return wr(r),(r.flags&128)!==0?(r.lanes=l,r):(l=c!==null,e=e!==null&&e.memoizedState!==null,l&&(c=r.child,p=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(p=c.alternate.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==p&&(c.flags|=2048)),l!==e&&l&&(r.child.flags|=8192),kc(r,r.updateQueue),yn(r),null);case 4:return te(),e===null&&Rh(r.stateNode.containerInfo),yn(r),null;case 10:return gs(r.type),yn(r),null;case 19:if(W(kn),c=r.memoizedState,c===null)return yn(r),null;if(p=(r.flags&128)!==0,g=c.rendering,g===null)if(p)$l(c,!1);else{if(_n!==0||e!==null&&(e.flags&128)!==0)for(e=r.child;e!==null;){if(g=mc(e),g!==null){for(r.flags|=128,$l(c,!1),e=g.updateQueue,r.updateQueue=e,kc(r,e),r.subtreeFlags=0,e=l,l=r.child;l!==null;)em(l,e),l=l.sibling;return J(kn,kn.current&1|2),Gt&&ps(r,c.treeForkCount),r.child}e=e.sibling}c.tail!==null&&yt()>Dc&&(r.flags|=128,p=!0,$l(c,!1),r.lanes=4194304)}else{if(!p)if(e=mc(g),e!==null){if(r.flags|=128,p=!0,e=e.updateQueue,r.updateQueue=e,kc(r,e),$l(c,!0),c.tail===null&&c.tailMode==="hidden"&&!g.alternate&&!Gt)return yn(r),null}else 2*yt()-c.renderingStartTime>Dc&&l!==536870912&&(r.flags|=128,p=!0,$l(c,!1),r.lanes=4194304);c.isBackwards?(g.sibling=r.child,r.child=g):(e=c.last,e!==null?e.sibling=g:r.child=g,c.last=g)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=yt(),e.sibling=null,l=kn.current,J(kn,p?l&1|2:l&1),Gt&&ps(r,c.treeForkCount),e):(yn(r),null);case 22:case 23:return wr(r),Ad(),c=r.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(l&536870912)!==0&&(r.flags&128)===0&&(yn(r),r.subtreeFlags&6&&(r.flags|=8192)):yn(r),l=r.updateQueue,l!==null&&kc(r,l.retryQueue),l=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==l&&(r.flags|=2048),e!==null&&W(Ti),null;case 24:return l=null,e!==null&&(l=e.memoizedState.cache),r.memoizedState.cache!==l&&(r.flags|=2048),gs(On),yn(r),null;case 25:return null;case 30:return null}throw Error(a(156,r.tag))}function dw(e,r){switch(gd(r),r.tag){case 1:return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return gs(On),te(),e=r.flags,(e&65536)!==0&&(e&128)===0?(r.flags=e&-65537|128,r):null;case 26:case 27:case 5:return Ne(r),null;case 31:if(r.memoizedState!==null){if(wr(r),r.alternate===null)throw Error(a(340));Ei()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 13:if(wr(r),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(a(340));Ei()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return W(kn),null;case 4:return te(),null;case 10:return gs(r.type),null;case 22:case 23:return wr(r),Ad(),e!==null&&W(Ti),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 24:return gs(On),null;case 25:return null;default:return null}}function Ng(e,r){switch(gd(r),r.tag){case 3:gs(On),te();break;case 26:case 27:case 5:Ne(r);break;case 4:te();break;case 31:r.memoizedState!==null&&wr(r);break;case 13:wr(r);break;case 19:W(kn);break;case 10:gs(r.type);break;case 22:case 23:wr(r),Ad(),e!==null&&W(Ti);break;case 24:gs(On)}}function Pl(e,r){try{var l=r.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var p=c.next;l=p;do{if((l.tag&e)===e){c=void 0;var g=l.create,S=l.inst;c=g(),S.destroy=c}l=l.next}while(l!==p)}}catch(R){en(r,r.return,R)}}function ni(e,r,l){try{var c=r.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var g=p.next;c=g;do{if((c.tag&e)===e){var S=c.inst,R=S.destroy;if(R!==void 0){S.destroy=void 0,p=r;var Q=l,ce=R;try{ce()}catch(we){en(p,Q,we)}}}c=c.next}while(c!==g)}}catch(we){en(r,r.return,we)}}function kg(e){var r=e.updateQueue;if(r!==null){var l=e.stateNode;try{vm(r,l)}catch(c){en(e,e.return,c)}}}function Tg(e,r,l){l.props=Mi(e.type,e.memoizedProps),l.state=e.memoizedState;try{l.componentWillUnmount()}catch(c){en(e,r,c)}}function ql(e,r){try{var l=e.ref;if(l!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof l=="function"?e.refCleanup=l(c):l.current=c}}catch(p){en(e,r,p)}}function is(e,r){var l=e.ref,c=e.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(p){en(e,r,p)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){en(e,r,p)}else l.current=null}function Rg(e){var r=e.type,l=e.memoizedProps,c=e.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(p){en(e,e.return,p)}}function ch(e,r,l){try{var c=e.stateNode;Dw(c,e.type,l,r),c[Ye]=r}catch(p){en(e,e.return,p)}}function Ag(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&ci(e.type)||e.tag===4}function uh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Ag(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&ci(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function dh(e,r,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(e,r):(r=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,r.appendChild(e),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=Fr));else if(c!==4&&(c===27&&ci(e.type)&&(l=e.stateNode,r=null),e=e.child,e!==null))for(dh(e,r,l),e=e.sibling;e!==null;)dh(e,r,l),e=e.sibling}function Tc(e,r,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?l.insertBefore(e,r):l.appendChild(e);else if(c!==4&&(c===27&&ci(e.type)&&(l=e.stateNode),e=e.child,e!==null))for(Tc(e,r,l),e=e.sibling;e!==null;)Tc(e,r,l),e=e.sibling}function Og(e){var r=e.stateNode,l=e.memoizedProps;try{for(var c=e.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);Xn(r,c,l),r[Ze]=e,r[Ye]=l}catch(g){en(e,e.return,g)}}var ws=!1,zn=!1,hh=!1,Dg=typeof WeakSet=="function"?WeakSet:Set,Fn=null;function hw(e,r){if(e=e.containerInfo,Dh=Wc,e=Gp(e),id(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var p=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var S=0,R=-1,Q=-1,ce=0,we=0,Ce=e,de=null;t:for(;;){for(var ve;Ce!==l||p!==0&&Ce.nodeType!==3||(R=S+p),Ce!==g||c!==0&&Ce.nodeType!==3||(Q=S+c),Ce.nodeType===3&&(S+=Ce.nodeValue.length),(ve=Ce.firstChild)!==null;)de=Ce,Ce=ve;for(;;){if(Ce===e)break t;if(de===l&&++ce===p&&(R=S),de===g&&++we===c&&(Q=S),(ve=Ce.nextSibling)!==null)break;Ce=de,de=Ce.parentNode}Ce=ve}l=R===-1||Q===-1?null:{start:R,end:Q}}else l=null}l=l||{start:0,end:0}}else l=null;for(Mh={focusedElem:e,selectionRange:l},Wc=!1,Fn=r;Fn!==null;)if(r=Fn,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,Fn=e;else for(;Fn!==null;){switch(r=Fn,g=r.alternate,e=r.flags,r.tag){case 0:if((e&4)!==0&&(e=r.updateQueue,e=e!==null?e.events:null,e!==null))for(l=0;l<e.length;l++)p=e[l],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,l=r,p=g.memoizedProps,g=g.memoizedState,c=l.stateNode;try{var rt=Mi(l.type,p);e=c.getSnapshotBeforeUpdate(rt,g),c.__reactInternalSnapshotBeforeUpdate=e}catch(xt){en(l,l.return,xt)}}break;case 3:if((e&1024)!==0){if(e=r.stateNode.containerInfo,l=e.nodeType,l===9)Lh(e);else if(l===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Lh(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=r.sibling,e!==null){e.return=r.return,Fn=e;break}Fn=r.return}}function Mg(e,r,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:js(e,l),c&4&&Pl(5,l);break;case 1:if(js(e,l),c&4)if(e=l.stateNode,r===null)try{e.componentDidMount()}catch(S){en(l,l.return,S)}else{var p=Mi(l.type,r.memoizedProps);r=r.memoizedState;try{e.componentDidUpdate(p,r,e.__reactInternalSnapshotBeforeUpdate)}catch(S){en(l,l.return,S)}}c&64&&kg(l),c&512&&ql(l,l.return);break;case 3:if(js(e,l),c&64&&(e=l.updateQueue,e!==null)){if(r=null,l.child!==null)switch(l.child.tag){case 27:case 5:r=l.child.stateNode;break;case 1:r=l.child.stateNode}try{vm(e,r)}catch(S){en(l,l.return,S)}}break;case 27:r===null&&c&4&&Og(l);case 26:case 5:js(e,l),r===null&&c&4&&Rg(l),c&512&&ql(l,l.return);break;case 12:js(e,l);break;case 31:js(e,l),c&4&&Lg(e,l);break;case 13:js(e,l),c&4&&Ig(e,l),c&64&&(e=l.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(l=ww.bind(null,l),Pw(e,l))));break;case 22:if(c=l.memoizedState!==null||ws,!c){r=r!==null&&r.memoizedState!==null||zn,p=ws;var g=zn;ws=c,(zn=r)&&!g?_s(e,l,(l.subtreeFlags&8772)!==0):js(e,l),ws=p,zn=g}break;case 30:break;default:js(e,l)}}function zg(e){var r=e.alternate;r!==null&&(e.alternate=null,zg(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&Ht(r)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var vn=null,dr=!1;function Ss(e,r,l){for(l=l.child;l!==null;)Ug(e,r,l),l=l.sibling}function Ug(e,r,l){if(_t&&typeof _t.onCommitFiberUnmount=="function")try{_t.onCommitFiberUnmount(Sn,l)}catch{}switch(l.tag){case 26:zn||is(l,r),Ss(e,r,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:zn||is(l,r);var c=vn,p=dr;ci(l.type)&&(vn=l.stateNode,dr=!1),Ss(e,r,l),Jl(l.stateNode),vn=c,dr=p;break;case 5:zn||is(l,r);case 6:if(c=vn,p=dr,vn=null,Ss(e,r,l),vn=c,dr=p,vn!==null)if(dr)try{(vn.nodeType===9?vn.body:vn.nodeName==="HTML"?vn.ownerDocument.body:vn).removeChild(l.stateNode)}catch(g){en(l,r,g)}else try{vn.removeChild(l.stateNode)}catch(g){en(l,r,g)}break;case 18:vn!==null&&(dr?(e=vn,ky(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,l.stateNode),Ua(e)):ky(vn,l.stateNode));break;case 4:c=vn,p=dr,vn=l.stateNode.containerInfo,dr=!0,Ss(e,r,l),vn=c,dr=p;break;case 0:case 11:case 14:case 15:ni(2,l,r),zn||ni(4,l,r),Ss(e,r,l);break;case 1:zn||(is(l,r),c=l.stateNode,typeof c.componentWillUnmount=="function"&&Tg(l,r,c)),Ss(e,r,l);break;case 21:Ss(e,r,l);break;case 22:zn=(c=zn)||l.memoizedState!==null,Ss(e,r,l),zn=c;break;default:Ss(e,r,l)}}function Lg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Ua(e)}catch(l){en(r,r.return,l)}}}function Ig(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ua(e)}catch(l){en(r,r.return,l)}}function fw(e){switch(e.tag){case 31:case 13:case 19:var r=e.stateNode;return r===null&&(r=e.stateNode=new Dg),r;case 22:return e=e.stateNode,r=e._retryCache,r===null&&(r=e._retryCache=new Dg),r;default:throw Error(a(435,e.tag))}}function Rc(e,r){var l=fw(e);r.forEach(function(c){if(!l.has(c)){l.add(c);var p=Sw.bind(null,e,c);c.then(p,p)}})}function hr(e,r){var l=r.deletions;if(l!==null)for(var c=0;c<l.length;c++){var p=l[c],g=e,S=r,R=S;e:for(;R!==null;){switch(R.tag){case 27:if(ci(R.type)){vn=R.stateNode,dr=!1;break e}break;case 5:vn=R.stateNode,dr=!1;break e;case 3:case 4:vn=R.stateNode.containerInfo,dr=!0;break e}R=R.return}if(vn===null)throw Error(a(160));Ug(g,S,p),vn=null,dr=!1,g=p.alternate,g!==null&&(g.return=null),p.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Bg(r,e),r=r.sibling}var Gr=null;function Bg(e,r){var l=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:hr(r,e),fr(e),c&4&&(ni(3,e,e.return),Pl(3,e),ni(5,e,e.return));break;case 1:hr(r,e),fr(e),c&512&&(zn||l===null||is(l,l.return)),c&64&&ws&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(l=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var p=Gr;if(hr(r,e),fr(e),c&512&&(zn||l===null||is(l,l.return)),c&4){var g=l!==null?l.memoizedState:null;if(c=e.memoizedState,l===null)if(c===null)if(e.stateNode===null){e:{c=e.type,l=e.memoizedProps,p=p.ownerDocument||p;t:switch(c){case"title":g=p.getElementsByTagName("title")[0],(!g||g[ft]||g[Ze]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=p.createElement(c),p.head.insertBefore(g,p.querySelector("head > title"))),Xn(g,c,l),g[Ze]=e,Nt(g),c=g;break e;case"link":var S=By("link","href",p).get(c+(l.href||""));if(S){for(var R=0;R<S.length;R++)if(g=S[R],g.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&g.getAttribute("rel")===(l.rel==null?null:l.rel)&&g.getAttribute("title")===(l.title==null?null:l.title)&&g.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){S.splice(R,1);break t}}g=p.createElement(c),Xn(g,c,l),p.head.appendChild(g);break;case"meta":if(S=By("meta","content",p).get(c+(l.content||""))){for(R=0;R<S.length;R++)if(g=S[R],g.getAttribute("content")===(l.content==null?null:""+l.content)&&g.getAttribute("name")===(l.name==null?null:l.name)&&g.getAttribute("property")===(l.property==null?null:l.property)&&g.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&g.getAttribute("charset")===(l.charSet==null?null:l.charSet)){S.splice(R,1);break t}}g=p.createElement(c),Xn(g,c,l),p.head.appendChild(g);break;default:throw Error(a(468,c))}g[Ze]=e,Nt(g),c=g}e.stateNode=c}else $y(p,e.type,e.stateNode);else e.stateNode=Iy(p,c,e.memoizedProps);else g!==c?(g===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):g.count--,c===null?$y(p,e.type,e.stateNode):Iy(p,c,e.memoizedProps)):c===null&&e.stateNode!==null&&ch(e,e.memoizedProps,l.memoizedProps)}break;case 27:hr(r,e),fr(e),c&512&&(zn||l===null||is(l,l.return)),l!==null&&c&4&&ch(e,e.memoizedProps,l.memoizedProps);break;case 5:if(hr(r,e),fr(e),c&512&&(zn||l===null||is(l,l.return)),e.flags&32){p=e.stateNode;try{us(p,"")}catch(rt){en(e,e.return,rt)}}c&4&&e.stateNode!=null&&(p=e.memoizedProps,ch(e,p,l!==null?l.memoizedProps:p)),c&1024&&(hh=!0);break;case 6:if(hr(r,e),fr(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,l=e.stateNode;try{l.nodeValue=c}catch(rt){en(e,e.return,rt)}}break;case 3:if(Vc=null,p=Gr,Gr=Hc(r.containerInfo),hr(r,e),Gr=p,fr(e),c&4&&l!==null&&l.memoizedState.isDehydrated)try{Ua(r.containerInfo)}catch(rt){en(e,e.return,rt)}hh&&(hh=!1,$g(e));break;case 4:c=Gr,Gr=Hc(e.stateNode.containerInfo),hr(r,e),fr(e),Gr=c;break;case 12:hr(r,e),fr(e);break;case 31:hr(r,e),fr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Rc(e,c)));break;case 13:hr(r,e),fr(e),e.child.flags&8192&&e.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Oc=yt()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Rc(e,c)));break;case 22:p=e.memoizedState!==null;var Q=l!==null&&l.memoizedState!==null,ce=ws,we=zn;if(ws=ce||p,zn=we||Q,hr(r,e),zn=we,ws=ce,fr(e),c&8192)e:for(r=e.stateNode,r._visibility=p?r._visibility&-2:r._visibility|1,p&&(l===null||Q||ws||zn||zi(e)),l=null,r=e;;){if(r.tag===5||r.tag===26){if(l===null){Q=l=r;try{if(g=Q.stateNode,p)S=g.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{R=Q.stateNode;var Ce=Q.memoizedProps.style,de=Ce!=null&&Ce.hasOwnProperty("display")?Ce.display:null;R.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(rt){en(Q,Q.return,rt)}}}else if(r.tag===6){if(l===null){Q=r;try{Q.stateNode.nodeValue=p?"":Q.memoizedProps}catch(rt){en(Q,Q.return,rt)}}}else if(r.tag===18){if(l===null){Q=r;try{var ve=Q.stateNode;p?Ty(ve,!0):Ty(Q.stateNode,!1)}catch(rt){en(Q,Q.return,rt)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;l===r&&(l=null),r=r.return}l===r&&(l=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=e.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,Rc(e,l))));break;case 19:hr(r,e),fr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Rc(e,c)));break;case 30:break;case 21:break;default:hr(r,e),fr(e)}}function fr(e){var r=e.flags;if(r&2){try{for(var l,c=e.return;c!==null;){if(Ag(c)){l=c;break}c=c.return}if(l==null)throw Error(a(160));switch(l.tag){case 27:var p=l.stateNode,g=uh(e);Tc(e,g,p);break;case 5:var S=l.stateNode;l.flags&32&&(us(S,""),l.flags&=-33);var R=uh(e);Tc(e,R,S);break;case 3:case 4:var Q=l.stateNode.containerInfo,ce=uh(e);dh(e,ce,Q);break;default:throw Error(a(161))}}catch(we){en(e,e.return,we)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function $g(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var r=e;$g(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),e=e.sibling}}function js(e,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Mg(e,r.alternate,r),r=r.sibling}function zi(e){for(e=e.child;e!==null;){var r=e;switch(r.tag){case 0:case 11:case 14:case 15:ni(4,r,r.return),zi(r);break;case 1:is(r,r.return);var l=r.stateNode;typeof l.componentWillUnmount=="function"&&Tg(r,r.return,l),zi(r);break;case 27:Jl(r.stateNode);case 26:case 5:is(r,r.return),zi(r);break;case 22:r.memoizedState===null&&zi(r);break;case 30:zi(r);break;default:zi(r)}e=e.sibling}}function _s(e,r,l){for(l=l&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,p=e,g=r,S=g.flags;switch(g.tag){case 0:case 11:case 15:_s(p,g,l),Pl(4,g);break;case 1:if(_s(p,g,l),c=g,p=c.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(ce){en(c,c.return,ce)}if(c=g,p=c.updateQueue,p!==null){var R=c.stateNode;try{var Q=p.shared.hiddenCallbacks;if(Q!==null)for(p.shared.hiddenCallbacks=null,p=0;p<Q.length;p++)ym(Q[p],R)}catch(ce){en(c,c.return,ce)}}l&&S&64&&kg(g),ql(g,g.return);break;case 27:Og(g);case 26:case 5:_s(p,g,l),l&&c===null&&S&4&&Rg(g),ql(g,g.return);break;case 12:_s(p,g,l);break;case 31:_s(p,g,l),l&&S&4&&Lg(p,g);break;case 13:_s(p,g,l),l&&S&4&&Ig(p,g);break;case 22:g.memoizedState===null&&_s(p,g,l),ql(g,g.return);break;case 30:break;default:_s(p,g,l)}r=r.sibling}}function fh(e,r){var l=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),e=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(e=r.memoizedState.cachePool.pool),e!==l&&(e!=null&&e.refCount++,l!=null&&kl(l))}function ph(e,r){e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&kl(e))}function Vr(e,r,l,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Pg(e,r,l,c),r=r.sibling}function Pg(e,r,l,c){var p=r.flags;switch(r.tag){case 0:case 11:case 15:Vr(e,r,l,c),p&2048&&Pl(9,r);break;case 1:Vr(e,r,l,c);break;case 3:Vr(e,r,l,c),p&2048&&(e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&kl(e)));break;case 12:if(p&2048){Vr(e,r,l,c),e=r.stateNode;try{var g=r.memoizedProps,S=g.id,R=g.onPostCommit;typeof R=="function"&&R(S,r.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(Q){en(r,r.return,Q)}}else Vr(e,r,l,c);break;case 31:Vr(e,r,l,c);break;case 13:Vr(e,r,l,c);break;case 23:break;case 22:g=r.stateNode,S=r.alternate,r.memoizedState!==null?g._visibility&2?Vr(e,r,l,c):Fl(e,r):g._visibility&2?Vr(e,r,l,c):(g._visibility|=2,Ca(e,r,l,c,(r.subtreeFlags&10256)!==0||!1)),p&2048&&fh(S,r);break;case 24:Vr(e,r,l,c),p&2048&&ph(r.alternate,r);break;default:Vr(e,r,l,c)}}function Ca(e,r,l,c,p){for(p=p&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var g=e,S=r,R=l,Q=c,ce=S.flags;switch(S.tag){case 0:case 11:case 15:Ca(g,S,R,Q,p),Pl(8,S);break;case 23:break;case 22:var we=S.stateNode;S.memoizedState!==null?we._visibility&2?Ca(g,S,R,Q,p):Fl(g,S):(we._visibility|=2,Ca(g,S,R,Q,p)),p&&ce&2048&&fh(S.alternate,S);break;case 24:Ca(g,S,R,Q,p),p&&ce&2048&&ph(S.alternate,S);break;default:Ca(g,S,R,Q,p)}r=r.sibling}}function Fl(e,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var l=e,c=r,p=c.flags;switch(c.tag){case 22:Fl(l,c),p&2048&&fh(c.alternate,c);break;case 24:Fl(l,c),p&2048&&ph(c.alternate,c);break;default:Fl(l,c)}r=r.sibling}}var Hl=8192;function Ea(e,r,l){if(e.subtreeFlags&Hl)for(e=e.child;e!==null;)qg(e,r,l),e=e.sibling}function qg(e,r,l){switch(e.tag){case 26:Ea(e,r,l),e.flags&Hl&&e.memoizedState!==null&&Zw(l,Gr,e.memoizedState,e.memoizedProps);break;case 5:Ea(e,r,l);break;case 3:case 4:var c=Gr;Gr=Hc(e.stateNode.containerInfo),Ea(e,r,l),Gr=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=Hl,Hl=16777216,Ea(e,r,l),Hl=c):Ea(e,r,l));break;default:Ea(e,r,l)}}function Fg(e){var r=e.alternate;if(r!==null&&(e=r.child,e!==null)){r.child=null;do r=e.sibling,e.sibling=null,e=r;while(e!==null)}}function Gl(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];Fn=c,Gg(c,e)}Fg(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Hg(e),e=e.sibling}function Hg(e){switch(e.tag){case 0:case 11:case 15:Gl(e),e.flags&2048&&ni(9,e,e.return);break;case 3:Gl(e);break;case 12:Gl(e);break;case 22:var r=e.stateNode;e.memoizedState!==null&&r._visibility&2&&(e.return===null||e.return.tag!==13)?(r._visibility&=-3,Ac(e)):Gl(e);break;default:Gl(e)}}function Ac(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];Fn=c,Gg(c,e)}Fg(e)}for(e=e.child;e!==null;){switch(r=e,r.tag){case 0:case 11:case 15:ni(8,r,r.return),Ac(r);break;case 22:l=r.stateNode,l._visibility&2&&(l._visibility&=-3,Ac(r));break;default:Ac(r)}e=e.sibling}}function Gg(e,r){for(;Fn!==null;){var l=Fn;switch(l.tag){case 0:case 11:case 15:ni(8,l,r);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:kl(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,Fn=c;else e:for(l=e;Fn!==null;){c=Fn;var p=c.sibling,g=c.return;if(zg(c),c===l){Fn=null;break e}if(p!==null){p.return=g,Fn=p;break e}Fn=g}}}var pw={getCacheForType:function(e){var r=Wn(On),l=r.data.get(e);return l===void 0&&(l=e(),r.data.set(e,l)),l},cacheSignal:function(){return Wn(On).controller.signal}},mw=typeof WeakMap=="function"?WeakMap:Map,Wt=0,un=null,It=null,qt=0,Zt=0,Sr=null,ri=!1,Na=!1,mh=!1,Cs=0,_n=0,si=0,Ui=0,gh=0,jr=0,ka=0,Vl=null,pr=null,yh=!1,Oc=0,Vg=0,Dc=1/0,Mc=null,ii=null,In=0,ai=null,Ta=null,Es=0,vh=0,xh=null,Kg=null,Kl=0,bh=null;function _r(){return(Wt&2)!==0&&qt!==0?qt&-qt:A.T!==null?Eh():ue()}function Yg(){if(jr===0)if((qt&536870912)===0||Gt){var e=Ve;Ve<<=1,(Ve&3932160)===0&&(Ve=262144),jr=e}else jr=536870912;return e=br.current,e!==null&&(e.flags|=32),jr}function mr(e,r,l){(e===un&&(Zt===2||Zt===9)||e.cancelPendingCommit!==null)&&(Ra(e,0),li(e,qt,jr,!1)),$t(e,l),((Wt&2)===0||e!==un)&&(e===un&&((Wt&2)===0&&(Ui|=l),_n===4&&li(e,qt,jr,!1)),as(e))}function Qg(e,r,l){if((Wt&6)!==0)throw Error(a(327));var c=!l&&(r&127)===0&&(r&e.expiredLanes)===0||zt(e,r),p=c?vw(e,r):Sh(e,r,!0),g=c;do{if(p===0){Na&&!c&&li(e,r,0,!1);break}else{if(l=e.current.alternate,g&&!gw(l)){p=Sh(e,r,!1),g=!1;continue}if(p===2){if(g=r,e.errorRecoveryDisabledLanes&g)var S=0;else S=e.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){r=S;e:{var R=e;p=Vl;var Q=R.current.memoizedState.isDehydrated;if(Q&&(Ra(R,S).flags|=256),S=Sh(R,S,!1),S!==2){if(mh&&!Q){R.errorRecoveryDisabledLanes|=g,Ui|=g,p=4;break e}g=pr,pr=p,g!==null&&(pr===null?pr=g:pr.push.apply(pr,g))}p=S}if(g=!1,p!==2)continue}}if(p===1){Ra(e,0),li(e,r,0,!0);break}e:{switch(c=e,g=p,g){case 0:case 1:throw Error(a(345));case 4:if((r&4194048)!==r)break;case 6:li(c,r,jr,!ri);break e;case 2:pr=null;break;case 3:case 5:break;default:throw Error(a(329))}if((r&62914560)===r&&(p=Oc+300-yt(),10<p)){if(li(c,r,jr,!ri),nt(c,0,!0)!==0)break e;Es=r,c.timeoutHandle=Ey(Wg.bind(null,c,l,pr,Mc,yh,r,jr,Ui,ka,ri,g,"Throttled",-0,0),p);break e}Wg(c,l,pr,Mc,yh,r,jr,Ui,ka,ri,g,null,-0,0)}}break}while(!0);as(e)}function Wg(e,r,l,c,p,g,S,R,Q,ce,we,Ce,de,ve){if(e.timeoutHandle=-1,Ce=r.subtreeFlags,Ce&8192||(Ce&16785408)===16785408){Ce={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fr},qg(r,g,Ce);var rt=(g&62914560)===g?Oc-yt():(g&4194048)===g?Vg-yt():0;if(rt=eS(Ce,rt),rt!==null){Es=g,e.cancelPendingCommit=rt(sy.bind(null,e,r,g,l,c,p,S,R,Q,we,Ce,null,de,ve)),li(e,g,S,!ce);return}}sy(e,r,g,l,c,p,S,R,Q)}function gw(e){for(var r=e;;){var l=r.tag;if((l===0||l===11||l===15)&&r.flags&16384&&(l=r.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var p=l[c],g=p.getSnapshot;p=p.value;try{if(!vr(g(),p))return!1}catch{return!1}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function li(e,r,l,c){r&=~gh,r&=~Ui,e.suspendedLanes|=r,e.pingedLanes&=~r,c&&(e.warmLanes|=r),c=e.expirationTimes;for(var p=r;0<p;){var g=31-cn(p),S=1<<g;c[g]=-1,p&=~S}l!==0&&Lt(e,l,r)}function zc(){return(Wt&6)===0?(Yl(0),!1):!0}function wh(){if(It!==null){if(Zt===0)var e=It.return;else e=It,ms=Ni=null,Ld(e),ba=null,Rl=0,e=It;for(;e!==null;)Ng(e.alternate,e),e=e.return;It=null}}function Ra(e,r){var l=e.timeoutHandle;l!==-1&&(e.timeoutHandle=-1,Uw(l)),l=e.cancelPendingCommit,l!==null&&(e.cancelPendingCommit=null,l()),Es=0,wh(),un=e,It=l=fs(e.current,null),qt=r,Zt=0,Sr=null,ri=!1,Na=zt(e,r),mh=!1,ka=jr=gh=Ui=si=_n=0,pr=Vl=null,yh=!1,(r&8)!==0&&(r|=r&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=r;0<c;){var p=31-cn(c),g=1<<p;r|=e[p],c&=~g}return Cs=r,nc(),l}function Jg(e,r){Ot=null,A.H=Il,r===xa||r===uc?(r=fm(),Zt=3):r===Cd?(r=fm(),Zt=4):Zt=r===Zd?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Sr=r,It===null&&(_n=1,_c(e,Rr(r,e.current)))}function Xg(){var e=br.current;return e===null?!0:(qt&4194048)===qt?Mr===null:(qt&62914560)===qt||(qt&536870912)!==0?e===Mr:!1}function Zg(){var e=A.H;return A.H=Il,e===null?Il:e}function ey(){var e=A.A;return A.A=pw,e}function Uc(){_n=4,ri||(qt&4194048)!==qt&&br.current!==null||(Na=!0),(si&134217727)===0&&(Ui&134217727)===0||un===null||li(un,qt,jr,!1)}function Sh(e,r,l){var c=Wt;Wt|=2;var p=Zg(),g=ey();(un!==e||qt!==r)&&(Mc=null,Ra(e,r)),r=!1;var S=_n;e:do try{if(Zt!==0&&It!==null){var R=It,Q=Sr;switch(Zt){case 8:wh(),S=6;break e;case 3:case 2:case 9:case 6:br.current===null&&(r=!0);var ce=Zt;if(Zt=0,Sr=null,Aa(e,R,Q,ce),l&&Na){S=0;break e}break;default:ce=Zt,Zt=0,Sr=null,Aa(e,R,Q,ce)}}yw(),S=_n;break}catch(we){Jg(e,we)}while(!0);return r&&e.shellSuspendCounter++,ms=Ni=null,Wt=c,A.H=p,A.A=g,It===null&&(un=null,qt=0,nc()),S}function yw(){for(;It!==null;)ty(It)}function vw(e,r){var l=Wt;Wt|=2;var c=Zg(),p=ey();un!==e||qt!==r?(Mc=null,Dc=yt()+500,Ra(e,r)):Na=zt(e,r);e:do try{if(Zt!==0&&It!==null){r=It;var g=Sr;t:switch(Zt){case 1:Zt=0,Sr=null,Aa(e,r,g,1);break;case 2:case 9:if(dm(g)){Zt=0,Sr=null,ny(r);break}r=function(){Zt!==2&&Zt!==9||un!==e||(Zt=7),as(e)},g.then(r,r);break e;case 3:Zt=7;break e;case 4:Zt=5;break e;case 7:dm(g)?(Zt=0,Sr=null,ny(r)):(Zt=0,Sr=null,Aa(e,r,g,7));break;case 5:var S=null;switch(It.tag){case 26:S=It.memoizedState;case 5:case 27:var R=It;if(S?Py(S):R.stateNode.complete){Zt=0,Sr=null;var Q=R.sibling;if(Q!==null)It=Q;else{var ce=R.return;ce!==null?(It=ce,Lc(ce)):It=null}break t}}Zt=0,Sr=null,Aa(e,r,g,5);break;case 6:Zt=0,Sr=null,Aa(e,r,g,6);break;case 8:wh(),_n=6;break e;default:throw Error(a(462))}}xw();break}catch(we){Jg(e,we)}while(!0);return ms=Ni=null,A.H=c,A.A=p,Wt=l,It!==null?0:(un=null,qt=0,nc(),_n)}function xw(){for(;It!==null&&!it();)ty(It)}function ty(e){var r=Cg(e.alternate,e,Cs);e.memoizedProps=e.pendingProps,r===null?Lc(e):It=r}function ny(e){var r=e,l=r.alternate;switch(r.tag){case 15:case 0:r=xg(l,r,r.pendingProps,r.type,void 0,qt);break;case 11:r=xg(l,r,r.pendingProps,r.type.render,r.ref,qt);break;case 5:Ld(r);default:Ng(l,r),r=It=em(r,Cs),r=Cg(l,r,Cs)}e.memoizedProps=e.pendingProps,r===null?Lc(e):It=r}function Aa(e,r,l,c){ms=Ni=null,Ld(r),ba=null,Rl=0;var p=r.return;try{if(lw(e,p,r,l,qt)){_n=1,_c(e,Rr(l,e.current)),It=null;return}}catch(g){if(p!==null)throw It=p,g;_n=1,_c(e,Rr(l,e.current)),It=null;return}r.flags&32768?(Gt||c===1?e=!0:Na||(qt&536870912)!==0?e=!1:(ri=e=!0,(c===2||c===9||c===3||c===6)&&(c=br.current,c!==null&&c.tag===13&&(c.flags|=16384))),ry(r,e)):Lc(r)}function Lc(e){var r=e;do{if((r.flags&32768)!==0){ry(r,ri);return}e=r.return;var l=uw(r.alternate,r,Cs);if(l!==null){It=l;return}if(r=r.sibling,r!==null){It=r;return}It=r=e}while(r!==null);_n===0&&(_n=5)}function ry(e,r){do{var l=dw(e.alternate,e);if(l!==null){l.flags&=32767,It=l;return}if(l=e.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!r&&(e=e.sibling,e!==null)){It=e;return}It=e=l}while(e!==null);_n=6,It=null}function sy(e,r,l,c,p,g,S,R,Q){e.cancelPendingCommit=null;do Ic();while(In!==0);if((Wt&6)!==0)throw Error(a(327));if(r!==null){if(r===e.current)throw Error(a(177));if(g=r.lanes|r.childLanes,g|=ud,Qe(e,l,g,S,R,Q),e===un&&(It=un=null,qt=0),Ta=r,ai=e,Es=l,vh=g,xh=p,Kg=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,jw(Ie,function(){return cy(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=A.T,A.T=null,p=$.p,$.p=2,S=Wt,Wt|=4;try{hw(e,r,l)}finally{Wt=S,$.p=p,A.T=c}}In=1,iy(),ay(),ly()}}function iy(){if(In===1){In=0;var e=ai,r=Ta,l=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||l){l=A.T,A.T=null;var c=$.p;$.p=2;var p=Wt;Wt|=4;try{Bg(r,e);var g=Mh,S=Gp(e.containerInfo),R=g.focusedElem,Q=g.selectionRange;if(S!==R&&R&&R.ownerDocument&&Hp(R.ownerDocument.documentElement,R)){if(Q!==null&&id(R)){var ce=Q.start,we=Q.end;if(we===void 0&&(we=ce),"selectionStart"in R)R.selectionStart=ce,R.selectionEnd=Math.min(we,R.value.length);else{var Ce=R.ownerDocument||document,de=Ce&&Ce.defaultView||window;if(de.getSelection){var ve=de.getSelection(),rt=R.textContent.length,xt=Math.min(Q.start,rt),on=Q.end===void 0?xt:Math.min(Q.end,rt);!ve.extend&&xt>on&&(S=on,on=xt,xt=S);var se=Fp(R,xt),Z=Fp(R,on);if(se&&Z&&(ve.rangeCount!==1||ve.anchorNode!==se.node||ve.anchorOffset!==se.offset||ve.focusNode!==Z.node||ve.focusOffset!==Z.offset)){var oe=Ce.createRange();oe.setStart(se.node,se.offset),ve.removeAllRanges(),xt>on?(ve.addRange(oe),ve.extend(Z.node,Z.offset)):(oe.setEnd(Z.node,Z.offset),ve.addRange(oe))}}}}for(Ce=[],ve=R;ve=ve.parentNode;)ve.nodeType===1&&Ce.push({element:ve,left:ve.scrollLeft,top:ve.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<Ce.length;R++){var Se=Ce[R];Se.element.scrollLeft=Se.left,Se.element.scrollTop=Se.top}}Wc=!!Dh,Mh=Dh=null}finally{Wt=p,$.p=c,A.T=l}}e.current=r,In=2}}function ay(){if(In===2){In=0;var e=ai,r=Ta,l=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||l){l=A.T,A.T=null;var c=$.p;$.p=2;var p=Wt;Wt|=4;try{Mg(e,r.alternate,r)}finally{Wt=p,$.p=c,A.T=l}}In=3}}function ly(){if(In===4||In===3){In=0,Mt();var e=ai,r=Ta,l=Es,c=Kg;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?In=5:(In=0,Ta=ai=null,oy(e,e.pendingLanes));var p=e.pendingLanes;if(p===0&&(ii=null),ee(l),r=r.stateNode,_t&&typeof _t.onCommitFiberRoot=="function")try{_t.onCommitFiberRoot(Sn,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=A.T,p=$.p,$.p=2,A.T=null;try{for(var g=e.onRecoverableError,S=0;S<c.length;S++){var R=c[S];g(R.value,{componentStack:R.stack})}}finally{A.T=r,$.p=p}}(Es&3)!==0&&Ic(),as(e),p=e.pendingLanes,(l&261930)!==0&&(p&42)!==0?e===bh?Kl++:(Kl=0,bh=e):Kl=0,Yl(0)}}function oy(e,r){(e.pooledCacheLanes&=r)===0&&(r=e.pooledCache,r!=null&&(e.pooledCache=null,kl(r)))}function Ic(){return iy(),ay(),ly(),cy()}function cy(){if(In!==5)return!1;var e=ai,r=vh;vh=0;var l=ee(Es),c=A.T,p=$.p;try{$.p=32>l?32:l,A.T=null,l=xh,xh=null;var g=ai,S=Es;if(In=0,Ta=ai=null,Es=0,(Wt&6)!==0)throw Error(a(331));var R=Wt;if(Wt|=4,Hg(g.current),Pg(g,g.current,S,l),Wt=R,Yl(0,!1),_t&&typeof _t.onPostCommitFiberRoot=="function")try{_t.onPostCommitFiberRoot(Sn,g)}catch{}return!0}finally{$.p=p,A.T=c,oy(e,r)}}function uy(e,r,l){r=Rr(l,r),r=Xd(e.stateNode,r,2),e=Zs(e,r,2),e!==null&&($t(e,2),as(e))}function en(e,r,l){if(e.tag===3)uy(e,e,l);else for(;r!==null;){if(r.tag===3){uy(r,e,l);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(ii===null||!ii.has(c))){e=Rr(l,e),l=dg(2),c=Zs(r,l,2),c!==null&&(hg(l,c,r,e),$t(c,2),as(c));break}}r=r.return}}function jh(e,r,l){var c=e.pingCache;if(c===null){c=e.pingCache=new mw;var p=new Set;c.set(r,p)}else p=c.get(r),p===void 0&&(p=new Set,c.set(r,p));p.has(l)||(mh=!0,p.add(l),e=bw.bind(null,e,r,l),r.then(e,e))}function bw(e,r,l){var c=e.pingCache;c!==null&&c.delete(r),e.pingedLanes|=e.suspendedLanes&l,e.warmLanes&=~l,un===e&&(qt&l)===l&&(_n===4||_n===3&&(qt&62914560)===qt&&300>yt()-Oc?(Wt&2)===0&&Ra(e,0):gh|=l,ka===qt&&(ka=0)),as(e)}function dy(e,r){r===0&&(r=At()),e=_i(e,r),e!==null&&($t(e,r),as(e))}function ww(e){var r=e.memoizedState,l=0;r!==null&&(l=r.retryLane),dy(e,l)}function Sw(e,r){var l=0;switch(e.tag){case 31:case 13:var c=e.stateNode,p=e.memoizedState;p!==null&&(l=p.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(r),dy(e,l)}function jw(e,r){return ke(e,r)}var Bc=null,Oa=null,_h=!1,$c=!1,Ch=!1,oi=0;function as(e){e!==Oa&&e.next===null&&(Oa===null?Bc=Oa=e:Oa=Oa.next=e),$c=!0,_h||(_h=!0,Cw())}function Yl(e,r){if(!Ch&&$c){Ch=!0;do for(var l=!1,c=Bc;c!==null;){if(e!==0){var p=c.pendingLanes;if(p===0)var g=0;else{var S=c.suspendedLanes,R=c.pingedLanes;g=(1<<31-cn(42|e)+1)-1,g&=p&~(S&~R),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(l=!0,my(c,g))}else g=qt,g=nt(c,c===un?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||zt(c,g)||(l=!0,my(c,g));c=c.next}while(l);Ch=!1}}function _w(){hy()}function hy(){$c=_h=!1;var e=0;oi!==0&&zw()&&(e=oi);for(var r=yt(),l=null,c=Bc;c!==null;){var p=c.next,g=fy(c,r);g===0?(c.next=null,l===null?Bc=p:l.next=p,p===null&&(Oa=l)):(l=c,(e!==0||(g&3)!==0)&&($c=!0)),c=p}In!==0&&In!==5||Yl(e),oi!==0&&(oi=0)}function fy(e,r){for(var l=e.suspendedLanes,c=e.pingedLanes,p=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var S=31-cn(g),R=1<<S,Q=p[S];Q===-1?((R&l)===0||(R&c)!==0)&&(p[S]=bt(R,r)):Q<=r&&(e.expiredLanes|=R),g&=~R}if(r=un,l=qt,l=nt(e,e===r?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,l===0||e===r&&(Zt===2||Zt===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&Ae(c),e.callbackNode=null,e.callbackPriority=0;if((l&3)===0||zt(e,l)){if(r=l&-l,r===e.callbackPriority)return r;switch(c!==null&&Ae(c),ee(l)){case 2:case 8:l=Ee;break;case 32:l=Ie;break;case 268435456:l=pt;break;default:l=Ie}return c=py.bind(null,e),l=ke(l,c),e.callbackPriority=r,e.callbackNode=l,r}return c!==null&&c!==null&&Ae(c),e.callbackPriority=2,e.callbackNode=null,2}function py(e,r){if(In!==0&&In!==5)return e.callbackNode=null,e.callbackPriority=0,null;var l=e.callbackNode;if(Ic()&&e.callbackNode!==l)return null;var c=qt;return c=nt(e,e===un?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(Qg(e,c,r),fy(e,yt()),e.callbackNode!=null&&e.callbackNode===l?py.bind(null,e):null)}function my(e,r){if(Ic())return null;Qg(e,r,!0)}function Cw(){Lw(function(){(Wt&6)!==0?ke(_e,_w):hy()})}function Eh(){if(oi===0){var e=ya;e===0&&(e=fe,fe<<=1,(fe&261888)===0&&(fe=256)),oi=e}return oi}function gy(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:ia(""+e)}function yy(e,r){var l=r.ownerDocument.createElement("input");return l.name=r.name,l.value=r.value,e.id&&l.setAttribute("form",e.id),r.parentNode.insertBefore(l,r),e=new FormData(e),l.parentNode.removeChild(l),e}function Ew(e,r,l,c,p){if(r==="submit"&&l&&l.stateNode===p){var g=gy((p[Ye]||null).action),S=c.submitter;S&&(r=(r=S[Ye]||null)?gy(r.formAction):S.getAttribute("formAction"),r!==null&&(g=r,S=null));var R=new mn("action","action",null,c,p);e.push({event:R,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(oi!==0){var Q=S?yy(p,S):new FormData(p);Vd(l,{pending:!0,data:Q,method:p.method,action:g},null,Q)}}else typeof g=="function"&&(R.preventDefault(),Q=S?yy(p,S):new FormData(p),Vd(l,{pending:!0,data:Q,method:p.method,action:g},g,Q))},currentTarget:p}]})}}for(var Nh=0;Nh<cd.length;Nh++){var kh=cd[Nh],Nw=kh.toLowerCase(),kw=kh[0].toUpperCase()+kh.slice(1);Hr(Nw,"on"+kw)}Hr(Yp,"onAnimationEnd"),Hr(Qp,"onAnimationIteration"),Hr(Wp,"onAnimationStart"),Hr("dblclick","onDoubleClick"),Hr("focusin","onFocus"),Hr("focusout","onBlur"),Hr(Hb,"onTransitionRun"),Hr(Gb,"onTransitionStart"),Hr(Vb,"onTransitionCancel"),Hr(Jp,"onTransitionEnd"),qr("onMouseEnter",["mouseout","mouseover"]),qr("onMouseLeave",["mouseout","mouseover"]),qr("onPointerEnter",["pointerout","pointerover"]),qr("onPointerLeave",["pointerout","pointerover"]),yr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),yr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),yr("onBeforeInput",["compositionend","keypress","textInput","paste"]),yr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ql="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Tw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ql));function vy(e,r){r=(r&4)!==0;for(var l=0;l<e.length;l++){var c=e[l],p=c.event;c=c.listeners;e:{var g=void 0;if(r)for(var S=c.length-1;0<=S;S--){var R=c[S],Q=R.instance,ce=R.currentTarget;if(R=R.listener,Q!==g&&p.isPropagationStopped())break e;g=R,p.currentTarget=ce;try{g(p)}catch(we){tc(we)}p.currentTarget=null,g=Q}else for(S=0;S<c.length;S++){if(R=c[S],Q=R.instance,ce=R.currentTarget,R=R.listener,Q!==g&&p.isPropagationStopped())break e;g=R,p.currentTarget=ce;try{g(p)}catch(we){tc(we)}p.currentTarget=null,g=Q}}}}function Bt(e,r){var l=r[Le];l===void 0&&(l=r[Le]=new Set);var c=e+"__bubble";l.has(c)||(xy(r,e,2,!1),l.add(c))}function Th(e,r,l){var c=0;r&&(c|=4),xy(l,e,c,r)}var Pc="_reactListening"+Math.random().toString(36).slice(2);function Rh(e){if(!e[Pc]){e[Pc]=!0,Pr.forEach(function(l){l!=="selectionchange"&&(Tw.has(l)||Th(l,!1,e),Th(l,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[Pc]||(r[Pc]=!0,Th("selectionchange",!1,r))}}function xy(e,r,l,c){switch(Yy(r)){case 2:var p=rS;break;case 8:p=sS;break;default:p=Gh}l=p.bind(null,r,l,e),p=void 0,!xe||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),c?p!==void 0?e.addEventListener(r,l,{capture:!0,passive:p}):e.addEventListener(r,l,!0):p!==void 0?e.addEventListener(r,l,{passive:p}):e.addEventListener(r,l,!1)}function Ah(e,r,l,c,p){var g=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var S=c.tag;if(S===3||S===4){var R=c.stateNode.containerInfo;if(R===p)break;if(S===4)for(S=c.return;S!==null;){var Q=S.tag;if((Q===3||Q===4)&&S.stateNode.containerInfo===p)return;S=S.return}for(;R!==null;){if(S=En(R),S===null)return;if(Q=S.tag,Q===5||Q===6||Q===26||Q===27){c=g=S;continue e}R=R.parentNode}}c=c.return}z(function(){var ce=g,we=xl(l),Ce=[];e:{var de=Xp.get(e);if(de!==void 0){var ve=mn,rt=e;switch(e){case"keypress":if(st(l)===0)break e;case"keydown":case"keyup":ve=Sb;break;case"focusin":rt="focus",ve=rr;break;case"focusout":rt="blur",ve=rr;break;case"beforeblur":case"afterblur":ve=rr;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=Rn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=Cb;break;case Yp:case Qp:case Wp:ve=ds;break;case Jp:ve=Nb;break;case"scroll":case"scrollend":ve=Gs;break;case"wheel":ve=Tb;break;case"copy":case"cut":case"paste":ve=Vs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Tp;break;case"toggle":case"beforetoggle":ve=Ab}var xt=(r&4)!==0,on=!xt&&(e==="scroll"||e==="scrollend"),se=xt?de!==null?de+"Capture":null:de;xt=[];for(var Z=ce,oe;Z!==null;){var Se=Z;if(oe=Se.stateNode,Se=Se.tag,Se!==5&&Se!==26&&Se!==27||oe===null||se===null||(Se=X(Z,se),Se!=null&&xt.push(Wl(Z,Se,oe))),on)break;Z=Z.return}0<xt.length&&(de=new ve(de,rt,null,l,we),Ce.push({event:de,listeners:xt}))}}if((r&7)===0){e:{if(de=e==="mouseover"||e==="pointerover",ve=e==="mouseout"||e==="pointerout",de&&l!==vl&&(rt=l.relatedTarget||l.fromElement)&&(En(rt)||rt[G]))break e;if((ve||de)&&(de=we.window===we?we:(de=we.ownerDocument)?de.defaultView||de.parentWindow:window,ve?(rt=l.relatedTarget||l.toElement,ve=ce,rt=rt?En(rt):null,rt!==null&&(on=u(rt),xt=rt.tag,rt!==on||xt!==5&&xt!==27&&xt!==6)&&(rt=null)):(ve=null,rt=ce),ve!==rt)){if(xt=hn,Se="onMouseLeave",se="onMouseEnter",Z="mouse",(e==="pointerout"||e==="pointerover")&&(xt=Tp,Se="onPointerLeave",se="onPointerEnter",Z="pointer"),on=ve==null?de:Vn(ve),oe=rt==null?de:Vn(rt),de=new xt(Se,Z+"leave",ve,l,we),de.target=on,de.relatedTarget=oe,Se=null,En(we)===ce&&(xt=new xt(se,Z+"enter",rt,l,we),xt.target=oe,xt.relatedTarget=on,Se=xt),on=Se,ve&&rt)t:{for(xt=Rw,se=ve,Z=rt,oe=0,Se=se;Se;Se=xt(Se))oe++;Se=0;for(var mt=Z;mt;mt=xt(mt))Se++;for(;0<oe-Se;)se=xt(se),oe--;for(;0<Se-oe;)Z=xt(Z),Se--;for(;oe--;){if(se===Z||Z!==null&&se===Z.alternate){xt=se;break t}se=xt(se),Z=xt(Z)}xt=null}else xt=null;ve!==null&&by(Ce,de,ve,xt,!1),rt!==null&&on!==null&&by(Ce,on,rt,xt,!0)}}e:{if(de=ce?Vn(ce):window,ve=de.nodeName&&de.nodeName.toLowerCase(),ve==="select"||ve==="input"&&de.type==="file")var Kt=Lp;else if(zp(de))if(Ip)Kt=Pb;else{Kt=Bb;var lt=Ib}else ve=de.nodeName,!ve||ve.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?ce&&sa(ce.elementType)&&(Kt=Lp):Kt=$b;if(Kt&&(Kt=Kt(e,ce))){Up(Ce,Kt,l,we);break e}lt&&lt(e,de,ce),e==="focusout"&&ce&&de.type==="number"&&ce.memoizedProps.value!=null&&yl(de,"number",de.value)}switch(lt=ce?Vn(ce):window,e){case"focusin":(zp(lt)||lt.contentEditable==="true")&&(ca=lt,ad=ce,Cl=null);break;case"focusout":Cl=ad=ca=null;break;case"mousedown":ld=!0;break;case"contextmenu":case"mouseup":case"dragend":ld=!1,Vp(Ce,l,we);break;case"selectionchange":if(Fb)break;case"keydown":case"keyup":Vp(Ce,l,we)}var Dt;if(nd)e:{switch(e){case"compositionstart":var Ft="onCompositionStart";break e;case"compositionend":Ft="onCompositionEnd";break e;case"compositionupdate":Ft="onCompositionUpdate";break e}Ft=void 0}else oa?Dp(e,l)&&(Ft="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(Ft="onCompositionStart");Ft&&(Rp&&l.locale!=="ko"&&(oa||Ft!=="onCompositionStart"?Ft==="onCompositionEnd"&&oa&&(Dt=We()):(Me=we,Pe="value"in Me?Me.value:Me.textContent,oa=!0)),lt=qc(ce,Ft),0<lt.length&&(Ft=new ed(Ft,e,null,l,we),Ce.push({event:Ft,listeners:lt}),Dt?Ft.data=Dt:(Dt=Mp(l),Dt!==null&&(Ft.data=Dt)))),(Dt=Db?Mb(e,l):zb(e,l))&&(Ft=qc(ce,"onBeforeInput"),0<Ft.length&&(lt=new ed("onBeforeInput","beforeinput",null,l,we),Ce.push({event:lt,listeners:Ft}),lt.data=Dt)),Ew(Ce,e,ce,l,we)}vy(Ce,r)})}function Wl(e,r,l){return{instance:e,listener:r,currentTarget:l}}function qc(e,r){for(var l=r+"Capture",c=[];e!==null;){var p=e,g=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||g===null||(p=X(e,l),p!=null&&c.unshift(Wl(e,p,g)),p=X(e,r),p!=null&&c.push(Wl(e,p,g))),e.tag===3)return c;e=e.return}return[]}function Rw(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function by(e,r,l,c,p){for(var g=r._reactName,S=[];l!==null&&l!==c;){var R=l,Q=R.alternate,ce=R.stateNode;if(R=R.tag,Q!==null&&Q===c)break;R!==5&&R!==26&&R!==27||ce===null||(Q=ce,p?(ce=X(l,g),ce!=null&&S.unshift(Wl(l,ce,Q))):p||(ce=X(l,g),ce!=null&&S.push(Wl(l,ce,Q)))),l=l.return}S.length!==0&&e.push({event:r,listeners:S})}var Aw=/\r\n?/g,Ow=/\u0000|\uFFFD/g;function wy(e){return(typeof e=="string"?e:""+e).replace(Aw,`
`).replace(Ow,"")}function Sy(e,r){return r=wy(r),wy(e)===r}function ln(e,r,l,c,p,g){switch(l){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||us(e,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&us(e,""+c);break;case"className":$s(e,"class",c);break;case"tabIndex":$s(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":$s(e,l,c);break;case"style":Xo(e,c,g);break;case"data":if(r!=="object"){$s(e,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||l!=="href")){e.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=ia(""+c),e.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(l==="formAction"?(r!=="input"&&ln(e,r,"name",p.name,p,null),ln(e,r,"formEncType",p.formEncType,p,null),ln(e,r,"formMethod",p.formMethod,p,null),ln(e,r,"formTarget",p.formTarget,p,null)):(ln(e,r,"encType",p.encType,p,null),ln(e,r,"method",p.method,p,null),ln(e,r,"target",p.target,p,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=ia(""+c),e.setAttribute(l,c);break;case"onClick":c!=null&&(e.onclick=Fr);break;case"onScroll":c!=null&&Bt("scroll",e);break;case"onScrollEnd":c!=null&&Bt("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(p.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}l=ia(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""+c):e.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""):e.removeAttribute(l);break;case"capture":case"download":c===!0?e.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,c):e.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(l,c):e.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(l):e.setAttribute(l,c);break;case"popover":Bt("beforetoggle",e),Bt("toggle",e),na(e,"popover",c);break;case"xlinkActuate":cr(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":cr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":cr(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":cr(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":cr(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":cr(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":cr(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":cr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":cr(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":na(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Zu.get(l)||l,na(e,l,c))}}function Oh(e,r,l,c,p,g){switch(l){case"style":Xo(e,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(p.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"children":typeof c=="string"?us(e,c):(typeof c=="number"||typeof c=="bigint")&&us(e,""+c);break;case"onScroll":c!=null&&Bt("scroll",e);break;case"onScrollEnd":c!=null&&Bt("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Fr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Kn.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),r=l.slice(2,p?l.length-7:void 0),g=e[Ye]||null,g=g!=null?g[l]:null,typeof g=="function"&&e.removeEventListener(r,g,p),typeof c=="function")){typeof g!="function"&&g!==null&&(l in e?e[l]=null:e.hasAttribute(l)&&e.removeAttribute(l)),e.addEventListener(r,c,p);break e}l in e?e[l]=c:c===!0?e.setAttribute(l,""):na(e,l,c)}}}function Xn(e,r,l){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Bt("error",e),Bt("load",e);var c=!1,p=!1,g;for(g in l)if(l.hasOwnProperty(g)){var S=l[g];if(S!=null)switch(g){case"src":c=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,r));default:ln(e,r,g,S,l,null)}}p&&ln(e,r,"srcSet",l.srcSet,l,null),c&&ln(e,r,"src",l.src,l,null);return;case"input":Bt("invalid",e);var R=g=S=p=null,Q=null,ce=null;for(c in l)if(l.hasOwnProperty(c)){var we=l[c];if(we!=null)switch(c){case"name":p=we;break;case"type":S=we;break;case"checked":Q=we;break;case"defaultChecked":ce=we;break;case"value":g=we;break;case"defaultValue":R=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(a(137,r));break;default:ln(e,r,c,we,l,null)}}Ps(e,g,R,Q,ce,S,p,!1);return;case"select":Bt("invalid",e),c=S=g=null;for(p in l)if(l.hasOwnProperty(p)&&(R=l[p],R!=null))switch(p){case"value":g=R;break;case"defaultValue":S=R;break;case"multiple":c=R;default:ln(e,r,p,R,l,null)}r=g,l=S,e.multiple=!!c,r!=null?qs(e,!!c,r,!1):l!=null&&qs(e,!!c,l,!0);return;case"textarea":Bt("invalid",e),g=p=c=null;for(S in l)if(l.hasOwnProperty(S)&&(R=l[S],R!=null))switch(S){case"value":c=R;break;case"defaultValue":p=R;break;case"children":g=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(a(91));break;default:ln(e,r,S,R,l,null)}Qo(e,c,p,g);return;case"option":for(Q in l)l.hasOwnProperty(Q)&&(c=l[Q],c!=null)&&(Q==="selected"?e.selected=c&&typeof c!="function"&&typeof c!="symbol":ln(e,r,Q,c,l,null));return;case"dialog":Bt("beforetoggle",e),Bt("toggle",e),Bt("cancel",e),Bt("close",e);break;case"iframe":case"object":Bt("load",e);break;case"video":case"audio":for(c=0;c<Ql.length;c++)Bt(Ql[c],e);break;case"image":Bt("error",e),Bt("load",e);break;case"details":Bt("toggle",e);break;case"embed":case"source":case"link":Bt("error",e),Bt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ce in l)if(l.hasOwnProperty(ce)&&(c=l[ce],c!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,r));default:ln(e,r,ce,c,l,null)}return;default:if(sa(r)){for(we in l)l.hasOwnProperty(we)&&(c=l[we],c!==void 0&&Oh(e,r,we,c,l,void 0));return}}for(R in l)l.hasOwnProperty(R)&&(c=l[R],c!=null&&ln(e,r,R,c,l,null))}function Dw(e,r,l,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,g=null,S=null,R=null,Q=null,ce=null,we=null;for(ve in l){var Ce=l[ve];if(l.hasOwnProperty(ve)&&Ce!=null)switch(ve){case"checked":break;case"value":break;case"defaultValue":Q=Ce;default:c.hasOwnProperty(ve)||ln(e,r,ve,null,c,Ce)}}for(var de in c){var ve=c[de];if(Ce=l[de],c.hasOwnProperty(de)&&(ve!=null||Ce!=null))switch(de){case"type":g=ve;break;case"name":p=ve;break;case"checked":ce=ve;break;case"defaultChecked":we=ve;break;case"value":S=ve;break;case"defaultValue":R=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(a(137,r));break;default:ve!==Ce&&ln(e,r,de,ve,c,Ce)}}gl(e,S,R,Q,ce,we,g,p);return;case"select":ve=S=R=de=null;for(g in l)if(Q=l[g],l.hasOwnProperty(g)&&Q!=null)switch(g){case"value":break;case"multiple":ve=Q;default:c.hasOwnProperty(g)||ln(e,r,g,null,c,Q)}for(p in c)if(g=c[p],Q=l[p],c.hasOwnProperty(p)&&(g!=null||Q!=null))switch(p){case"value":de=g;break;case"defaultValue":R=g;break;case"multiple":S=g;default:g!==Q&&ln(e,r,p,g,c,Q)}r=R,l=S,c=ve,de!=null?qs(e,!!l,de,!1):!!c!=!!l&&(r!=null?qs(e,!!l,r,!0):qs(e,!!l,l?[]:"",!1));return;case"textarea":ve=de=null;for(R in l)if(p=l[R],l.hasOwnProperty(R)&&p!=null&&!c.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:ln(e,r,R,null,c,p)}for(S in c)if(p=c[S],g=l[S],c.hasOwnProperty(S)&&(p!=null||g!=null))switch(S){case"value":de=p;break;case"defaultValue":ve=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(a(91));break;default:p!==g&&ln(e,r,S,p,c,g)}Yo(e,de,ve);return;case"option":for(var rt in l)de=l[rt],l.hasOwnProperty(rt)&&de!=null&&!c.hasOwnProperty(rt)&&(rt==="selected"?e.selected=!1:ln(e,r,rt,null,c,de));for(Q in c)de=c[Q],ve=l[Q],c.hasOwnProperty(Q)&&de!==ve&&(de!=null||ve!=null)&&(Q==="selected"?e.selected=de&&typeof de!="function"&&typeof de!="symbol":ln(e,r,Q,de,c,ve));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var xt in l)de=l[xt],l.hasOwnProperty(xt)&&de!=null&&!c.hasOwnProperty(xt)&&ln(e,r,xt,null,c,de);for(ce in c)if(de=c[ce],ve=l[ce],c.hasOwnProperty(ce)&&de!==ve&&(de!=null||ve!=null))switch(ce){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(a(137,r));break;default:ln(e,r,ce,de,c,ve)}return;default:if(sa(r)){for(var on in l)de=l[on],l.hasOwnProperty(on)&&de!==void 0&&!c.hasOwnProperty(on)&&Oh(e,r,on,void 0,c,de);for(we in c)de=c[we],ve=l[we],!c.hasOwnProperty(we)||de===ve||de===void 0&&ve===void 0||Oh(e,r,we,de,c,ve);return}}for(var se in l)de=l[se],l.hasOwnProperty(se)&&de!=null&&!c.hasOwnProperty(se)&&ln(e,r,se,null,c,de);for(Ce in c)de=c[Ce],ve=l[Ce],!c.hasOwnProperty(Ce)||de===ve||de==null&&ve==null||ln(e,r,Ce,de,c,ve)}function jy(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Mw(){if(typeof performance.getEntriesByType=="function"){for(var e=0,r=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var p=l[c],g=p.transferSize,S=p.initiatorType,R=p.duration;if(g&&R&&jy(S)){for(S=0,R=p.responseEnd,c+=1;c<l.length;c++){var Q=l[c],ce=Q.startTime;if(ce>R)break;var we=Q.transferSize,Ce=Q.initiatorType;we&&jy(Ce)&&(Q=Q.responseEnd,S+=we*(Q<R?1:(R-ce)/(Q-ce)))}if(--c,r+=8*(g+S)/(p.duration/1e3),e++,10<e)break}}if(0<e)return r/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Dh=null,Mh=null;function Fc(e){return e.nodeType===9?e:e.ownerDocument}function _y(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Cy(e,r){if(e===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&r==="foreignObject"?0:e}function zh(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Uh=null;function zw(){var e=window.event;return e&&e.type==="popstate"?e===Uh?!1:(Uh=e,!0):(Uh=null,!1)}var Ey=typeof setTimeout=="function"?setTimeout:void 0,Uw=typeof clearTimeout=="function"?clearTimeout:void 0,Ny=typeof Promise=="function"?Promise:void 0,Lw=typeof queueMicrotask=="function"?queueMicrotask:typeof Ny<"u"?function(e){return Ny.resolve(null).then(e).catch(Iw)}:Ey;function Iw(e){setTimeout(function(){throw e})}function ci(e){return e==="head"}function ky(e,r){var l=r,c=0;do{var p=l.nextSibling;if(e.removeChild(l),p&&p.nodeType===8)if(l=p.data,l==="/$"||l==="/&"){if(c===0){e.removeChild(p),Ua(r);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")Jl(e.ownerDocument.documentElement);else if(l==="head"){l=e.ownerDocument.head,Jl(l);for(var g=l.firstChild;g;){var S=g.nextSibling,R=g.nodeName;g[ft]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&g.rel.toLowerCase()==="stylesheet"||l.removeChild(g),g=S}}else l==="body"&&Jl(e.ownerDocument.body);l=p}while(l);Ua(r)}function Ty(e,r){var l=e;e=0;do{var c=l.nextSibling;if(l.nodeType===1?r?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(r?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(e===0)break;e--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||e++;l=c}while(l)}function Lh(e){var r=e.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var l=r;switch(r=r.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Lh(l),Ht(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}e.removeChild(l)}}function Bw(e,r,l,c){for(;e.nodeType===1;){var p=l;if(e.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[ft])switch(r){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==p.rel||e.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||e.getAttribute("title")!==(p.title==null?null:p.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(p.src==null?null:p.src)||e.getAttribute("type")!==(p.type==null?null:p.type)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(r==="input"&&e.type==="hidden"){var g=p.name==null?null:""+p.name;if(p.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=zr(e.nextSibling),e===null)break}return null}function $w(e,r,l){if(r==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!l||(e=zr(e.nextSibling),e===null))return null;return e}function Ry(e,r){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=zr(e.nextSibling),e===null))return null;return e}function Ih(e){return e.data==="$?"||e.data==="$~"}function Bh(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Pw(e,r){var l=e.ownerDocument;if(e.data==="$~")e._reactRetry=r;else if(e.data!=="$?"||l.readyState!=="loading")r();else{var c=function(){r(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function zr(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return e}var $h=null;function Ay(e){e=e.nextSibling;for(var r=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"||l==="/&"){if(r===0)return zr(e.nextSibling);r--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||r++}e=e.nextSibling}return null}function Oy(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(r===0)return e;r--}else l!=="/$"&&l!=="/&"||r++}e=e.previousSibling}return null}function Dy(e,r,l){switch(r=Fc(l),e){case"html":if(e=r.documentElement,!e)throw Error(a(452));return e;case"head":if(e=r.head,!e)throw Error(a(453));return e;case"body":if(e=r.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function Jl(e){for(var r=e.attributes;r.length;)e.removeAttributeNode(r[0]);Ht(e)}var Ur=new Map,My=new Set;function Hc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Ns=$.d;$.d={f:qw,r:Fw,D:Hw,C:Gw,L:Vw,m:Kw,X:Qw,S:Yw,M:Ww};function qw(){var e=Ns.f(),r=zc();return e||r}function Fw(e){var r=kt(e);r!==null&&r.tag===5&&r.type==="form"?Jm(r):Ns.r(e)}var Da=typeof document>"u"?null:document;function zy(e,r,l){var c=Da;if(c&&typeof r=="string"&&r){var p=ur(r);p='link[rel="'+e+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),My.has(p)||(My.add(p),e={rel:e,crossOrigin:l,href:r},c.querySelector(p)===null&&(r=c.createElement("link"),Xn(r,"link",e),Nt(r),c.head.appendChild(r)))}}function Hw(e){Ns.D(e),zy("dns-prefetch",e,null)}function Gw(e,r){Ns.C(e,r),zy("preconnect",e,r)}function Vw(e,r,l){Ns.L(e,r,l);var c=Da;if(c&&e&&r){var p='link[rel="preload"][as="'+ur(r)+'"]';r==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+ur(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+ur(l.imageSizes)+'"]')):p+='[href="'+ur(e)+'"]';var g=p;switch(r){case"style":g=Ma(e);break;case"script":g=za(e)}Ur.has(g)||(e=v({rel:"preload",href:r==="image"&&l&&l.imageSrcSet?void 0:e,as:r},l),Ur.set(g,e),c.querySelector(p)!==null||r==="style"&&c.querySelector(Xl(g))||r==="script"&&c.querySelector(Zl(g))||(r=c.createElement("link"),Xn(r,"link",e),Nt(r),c.head.appendChild(r)))}}function Kw(e,r){Ns.m(e,r);var l=Da;if(l&&e){var c=r&&typeof r.as=="string"?r.as:"script",p='link[rel="modulepreload"][as="'+ur(c)+'"][href="'+ur(e)+'"]',g=p;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=za(e)}if(!Ur.has(g)&&(e=v({rel:"modulepreload",href:e},r),Ur.set(g,e),l.querySelector(p)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Zl(g)))return}c=l.createElement("link"),Xn(c,"link",e),Nt(c),l.head.appendChild(c)}}}function Yw(e,r,l){Ns.S(e,r,l);var c=Da;if(c&&e){var p=sn(c).hoistableStyles,g=Ma(e);r=r||"default";var S=p.get(g);if(!S){var R={loading:0,preload:null};if(S=c.querySelector(Xl(g)))R.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":r},l),(l=Ur.get(g))&&Ph(e,l);var Q=S=c.createElement("link");Nt(Q),Xn(Q,"link",e),Q._p=new Promise(function(ce,we){Q.onload=ce,Q.onerror=we}),Q.addEventListener("load",function(){R.loading|=1}),Q.addEventListener("error",function(){R.loading|=2}),R.loading|=4,Gc(S,r,c)}S={type:"stylesheet",instance:S,count:1,state:R},p.set(g,S)}}}function Qw(e,r){Ns.X(e,r);var l=Da;if(l&&e){var c=sn(l).hoistableScripts,p=za(e),g=c.get(p);g||(g=l.querySelector(Zl(p)),g||(e=v({src:e,async:!0},r),(r=Ur.get(p))&&qh(e,r),g=l.createElement("script"),Nt(g),Xn(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function Ww(e,r){Ns.M(e,r);var l=Da;if(l&&e){var c=sn(l).hoistableScripts,p=za(e),g=c.get(p);g||(g=l.querySelector(Zl(p)),g||(e=v({src:e,async:!0,type:"module"},r),(r=Ur.get(p))&&qh(e,r),g=l.createElement("script"),Nt(g),Xn(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function Uy(e,r,l,c){var p=(p=Re.current)?Hc(p):null;if(!p)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(r=Ma(l.href),l=sn(p).hoistableStyles,c=l.get(r),c||(c={type:"style",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){e=Ma(l.href);var g=sn(p).hoistableStyles,S=g.get(e);if(S||(p=p.ownerDocument||p,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,S),(g=p.querySelector(Xl(e)))&&!g._p&&(S.instance=g,S.state.loading=5),Ur.has(e)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Ur.set(e,l),g||Jw(p,e,l,S.state))),r&&c===null)throw Error(a(528,""));return S}if(r&&c!==null)throw Error(a(529,""));return null;case"script":return r=l.async,l=l.src,typeof l=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=za(l),l=sn(p).hoistableScripts,c=l.get(r),c||(c={type:"script",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Ma(e){return'href="'+ur(e)+'"'}function Xl(e){return'link[rel="stylesheet"]['+e+"]"}function Ly(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function Jw(e,r,l,c){e.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=e.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),Xn(r,"link",l),Nt(r),e.head.appendChild(r))}function za(e){return'[src="'+ur(e)+'"]'}function Zl(e){return"script[async]"+e}function Iy(e,r,l){if(r.count++,r.instance===null)switch(r.type){case"style":var c=e.querySelector('style[data-href~="'+ur(l.href)+'"]');if(c)return r.instance=c,Nt(c),c;var p=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),Nt(c),Xn(c,"style",p),Gc(c,l.precedence,e),r.instance=c;case"stylesheet":p=Ma(l.href);var g=e.querySelector(Xl(p));if(g)return r.state.loading|=4,r.instance=g,Nt(g),g;c=Ly(l),(p=Ur.get(p))&&Ph(c,p),g=(e.ownerDocument||e).createElement("link"),Nt(g);var S=g;return S._p=new Promise(function(R,Q){S.onload=R,S.onerror=Q}),Xn(g,"link",c),r.state.loading|=4,Gc(g,l.precedence,e),r.instance=g;case"script":return g=za(l.src),(p=e.querySelector(Zl(g)))?(r.instance=p,Nt(p),p):(c=l,(p=Ur.get(g))&&(c=v({},l),qh(c,p)),e=e.ownerDocument||e,p=e.createElement("script"),Nt(p),Xn(p,"link",c),e.head.appendChild(p),r.instance=p);case"void":return null;default:throw Error(a(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,Gc(c,l.precedence,e));return r.instance}function Gc(e,r,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=c.length?c[c.length-1]:null,g=p,S=0;S<c.length;S++){var R=c[S];if(R.dataset.precedence===r)g=R;else if(g!==p)break}g?g.parentNode.insertBefore(e,g.nextSibling):(r=l.nodeType===9?l.head:l,r.insertBefore(e,r.firstChild))}function Ph(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.title==null&&(e.title=r.title)}function qh(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.integrity==null&&(e.integrity=r.integrity)}var Vc=null;function By(e,r,l){if(Vc===null){var c=new Map,p=Vc=new Map;p.set(l,c)}else p=Vc,c=p.get(l),c||(c=new Map,p.set(l,c));if(c.has(e))return c;for(c.set(e,null),l=l.getElementsByTagName(e),p=0;p<l.length;p++){var g=l[p];if(!(g[ft]||g[Ze]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var S=g.getAttribute(r)||"";S=e+S;var R=c.get(S);R?R.push(g):c.set(S,[g])}}return c}function $y(e,r,l){e=e.ownerDocument||e,e.head.insertBefore(l,r==="title"?e.querySelector("head > title"):null)}function Xw(e,r,l){if(l===1||r.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(e=r.disabled,typeof r.precedence=="string"&&e==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Py(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function Zw(e,r,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var p=Ma(c.href),g=r.querySelector(Xl(p));if(g){r=g._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(e.count++,e=Kc.bind(e),r.then(e,e)),l.state.loading|=4,l.instance=g,Nt(g);return}g=r.ownerDocument||r,c=Ly(c),(p=Ur.get(p))&&Ph(c,p),g=g.createElement("link"),Nt(g);var S=g;S._p=new Promise(function(R,Q){S.onload=R,S.onerror=Q}),Xn(g,"link",c),l.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(l,r),(r=l.state.preload)&&(l.state.loading&3)===0&&(e.count++,l=Kc.bind(e),r.addEventListener("load",l),r.addEventListener("error",l))}}var Fh=0;function eS(e,r){return e.stylesheets&&e.count===0&&Qc(e,e.stylesheets),0<e.count||0<e.imgCount?function(l){var c=setTimeout(function(){if(e.stylesheets&&Qc(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+r);0<e.imgBytes&&Fh===0&&(Fh=62500*Mw());var p=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Qc(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>Fh?50:800)+r);return e.unsuspend=l,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(p)}}:null}function Kc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Qc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Yc=null;function Qc(e,r){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Yc=new Map,r.forEach(tS,e),Yc=null,Kc.call(e))}function tS(e,r){if(!(r.state.loading&4)){var l=Yc.get(e);if(l)var c=l.get(null);else{l=new Map,Yc.set(e,l);for(var p=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<p.length;g++){var S=p[g];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(l.set(S.dataset.precedence,S),c=S)}c&&l.set(null,c)}p=r.instance,S=p.getAttribute("data-precedence"),g=l.get(S)||c,g===c&&l.set(null,p),l.set(S,p),this.count++,c=Kc.bind(this),p.addEventListener("load",c),p.addEventListener("error",c),g?g.parentNode.insertBefore(p,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(p,e.firstChild)),r.state.loading|=4}}var eo={$$typeof:O,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function nS(e,r,l,c,p,g,S,R,Q){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=tt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tt(0),this.hiddenUpdates=tt(null),this.identifierPrefix=c,this.onUncaughtError=p,this.onCaughtError=g,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Q,this.incompleteTransitions=new Map}function qy(e,r,l,c,p,g,S,R,Q,ce,we,Ce){return e=new nS(e,r,l,S,Q,ce,we,Ce,R),r=1,g===!0&&(r|=24),g=xr(3,null,null,r),e.current=g,g.stateNode=e,r=Sd(),r.refCount++,e.pooledCache=r,r.refCount++,g.memoizedState={element:c,isDehydrated:l,cache:r},Ed(g),e}function Fy(e){return e?(e=ha,e):ha}function Hy(e,r,l,c,p,g){p=Fy(p),c.context===null?c.context=p:c.pendingContext=p,c=Xs(r),c.payload={element:l},g=g===void 0?null:g,g!==null&&(c.callback=g),l=Zs(e,c,r),l!==null&&(mr(l,e,r),Ol(l,e,r))}function Gy(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<r?l:r}}function Hh(e,r){Gy(e,r),(e=e.alternate)&&Gy(e,r)}function Vy(e){if(e.tag===13||e.tag===31){var r=_i(e,67108864);r!==null&&mr(r,e,67108864),Hh(e,67108864)}}function Ky(e){if(e.tag===13||e.tag===31){var r=_r();r=ne(r);var l=_i(e,r);l!==null&&mr(l,e,r),Hh(e,r)}}var Wc=!0;function rS(e,r,l,c){var p=A.T;A.T=null;var g=$.p;try{$.p=2,Gh(e,r,l,c)}finally{$.p=g,A.T=p}}function sS(e,r,l,c){var p=A.T;A.T=null;var g=$.p;try{$.p=8,Gh(e,r,l,c)}finally{$.p=g,A.T=p}}function Gh(e,r,l,c){if(Wc){var p=Vh(c);if(p===null)Ah(e,r,c,Jc,l),Qy(e,c);else if(aS(p,e,r,l,c))c.stopPropagation();else if(Qy(e,c),r&4&&-1<iS.indexOf(e)){for(;p!==null;){var g=kt(p);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var S=Ke(g.pendingLanes);if(S!==0){var R=g;for(R.pendingLanes|=2,R.entangledLanes|=2;S;){var Q=1<<31-cn(S);R.entanglements[1]|=Q,S&=~Q}as(g),(Wt&6)===0&&(Dc=yt()+500,Yl(0))}}break;case 31:case 13:R=_i(g,2),R!==null&&mr(R,g,2),zc(),Hh(g,2)}if(g=Vh(c),g===null&&Ah(e,r,c,Jc,l),g===p)break;p=g}p!==null&&c.stopPropagation()}else Ah(e,r,c,null,l)}}function Vh(e){return e=xl(e),Kh(e)}var Jc=null;function Kh(e){if(Jc=null,e=En(e),e!==null){var r=u(e);if(r===null)e=null;else{var l=r.tag;if(l===13){if(e=d(r),e!==null)return e;e=null}else if(l===31){if(e=h(r),e!==null)return e;e=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null)}}return Jc=e,null}function Yy(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ie()){case _e:return 2;case Ee:return 8;case Ie:case ct:return 32;case pt:return 268435456;default:return 32}default:return 32}}var Yh=!1,ui=null,di=null,hi=null,to=new Map,no=new Map,fi=[],iS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Qy(e,r){switch(e){case"focusin":case"focusout":ui=null;break;case"dragenter":case"dragleave":di=null;break;case"mouseover":case"mouseout":hi=null;break;case"pointerover":case"pointerout":to.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":no.delete(r.pointerId)}}function ro(e,r,l,c,p,g){return e===null||e.nativeEvent!==g?(e={blockedOn:r,domEventName:l,eventSystemFlags:c,nativeEvent:g,targetContainers:[p]},r!==null&&(r=kt(r),r!==null&&Vy(r)),e):(e.eventSystemFlags|=c,r=e.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),e)}function aS(e,r,l,c,p){switch(r){case"focusin":return ui=ro(ui,e,r,l,c,p),!0;case"dragenter":return di=ro(di,e,r,l,c,p),!0;case"mouseover":return hi=ro(hi,e,r,l,c,p),!0;case"pointerover":var g=p.pointerId;return to.set(g,ro(to.get(g)||null,e,r,l,c,p)),!0;case"gotpointercapture":return g=p.pointerId,no.set(g,ro(no.get(g)||null,e,r,l,c,p)),!0}return!1}function Wy(e){var r=En(e.target);if(r!==null){var l=u(r);if(l!==null){if(r=l.tag,r===13){if(r=d(l),r!==null){e.blockedOn=r,je(e.priority,function(){Ky(l)});return}}else if(r===31){if(r=h(l),r!==null){e.blockedOn=r,je(e.priority,function(){Ky(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var l=Vh(e.nativeEvent);if(l===null){l=e.nativeEvent;var c=new l.constructor(l.type,l);vl=c,l.target.dispatchEvent(c),vl=null}else return r=kt(l),r!==null&&Vy(r),e.blockedOn=l,!1;r.shift()}return!0}function Jy(e,r,l){Xc(e)&&l.delete(r)}function lS(){Yh=!1,ui!==null&&Xc(ui)&&(ui=null),di!==null&&Xc(di)&&(di=null),hi!==null&&Xc(hi)&&(hi=null),to.forEach(Jy),no.forEach(Jy)}function Zc(e,r){e.blockedOn===r&&(e.blockedOn=null,Yh||(Yh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,lS)))}var eu=null;function Xy(e){eu!==e&&(eu=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){eu===e&&(eu=null);for(var r=0;r<e.length;r+=3){var l=e[r],c=e[r+1],p=e[r+2];if(typeof c!="function"){if(Kh(c||l)===null)continue;break}var g=kt(l);g!==null&&(e.splice(r,3),r-=3,Vd(g,{pending:!0,data:p,method:l.method,action:c},c,p))}}))}function Ua(e){function r(Q){return Zc(Q,e)}ui!==null&&Zc(ui,e),di!==null&&Zc(di,e),hi!==null&&Zc(hi,e),to.forEach(r),no.forEach(r);for(var l=0;l<fi.length;l++){var c=fi[l];c.blockedOn===e&&(c.blockedOn=null)}for(;0<fi.length&&(l=fi[0],l.blockedOn===null);)Wy(l),l.blockedOn===null&&fi.shift();if(l=(e.ownerDocument||e).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var p=l[c],g=l[c+1],S=p[Ye]||null;if(typeof g=="function")S||Xy(l);else if(S){var R=null;if(g&&g.hasAttribute("formAction")){if(p=g,S=g[Ye]||null)R=S.formAction;else if(Kh(p)!==null)continue}else R=S.action;typeof R=="function"?l[c+1]=R:(l.splice(c,3),c-=3),Xy(l)}}}function Zy(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(S){return p=S})},focusReset:"manual",scroll:"manual"})}function r(){p!==null&&(p(),p=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,p=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),p!==null&&(p(),p=null)}}}function Qh(e){this._internalRoot=e}tu.prototype.render=Qh.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(a(409));var l=r.current,c=_r();Hy(l,c,e,r,null,null)},tu.prototype.unmount=Qh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;Hy(e.current,2,null,e,null,null),zc(),r[G]=null}};function tu(e){this._internalRoot=e}tu.prototype.unstable_scheduleHydration=function(e){if(e){var r=ue();e={blockedOn:null,target:e,priority:r};for(var l=0;l<fi.length&&r!==0&&r<fi[l].priority;l++);fi.splice(l,0,e),l===0&&Wy(e)}};var ev=t.version;if(ev!=="19.2.3")throw Error(a(527,ev,"19.2.3"));$.findDOMNode=function(e){var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=m(r),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var oS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:A,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nu.isDisabled&&nu.supportsFiber)try{Sn=nu.inject(oS),_t=nu}catch{}}return io.createRoot=function(e,r){if(!o(e))throw Error(a(299));var l=!1,c="",p=lg,g=og,S=cg;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(g=r.onCaughtError),r.onRecoverableError!==void 0&&(S=r.onRecoverableError)),r=qy(e,1,!1,null,null,l,c,null,p,g,S,Zy),e[G]=r.current,Rh(e),new Qh(r)},io.hydrateRoot=function(e,r,l){if(!o(e))throw Error(a(299));var c=!1,p="",g=lg,S=og,R=cg,Q=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(g=l.onUncaughtError),l.onCaughtError!==void 0&&(S=l.onCaughtError),l.onRecoverableError!==void 0&&(R=l.onRecoverableError),l.formState!==void 0&&(Q=l.formState)),r=qy(e,1,!0,r,l??null,c,p,Q,g,S,R,Zy),r.context=Fy(null),l=r.current,c=_r(),c=ne(c),p=Xs(c),p.callback=null,Zs(l,p,c),l=c,r.current.lanes=l,$t(r,l),as(r),e[G]=r.current,Rh(e),new tu(r)},io.version="19.2.3",io}var uv;function yS(){if(uv)return Xh.exports;uv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Xh.exports=gS(),Xh.exports}var vS=yS();var dv="popstate";function xS(n={}){function t(a,o){let{pathname:u,search:d,hash:h}=a.location;return $f("",{pathname:u,search:d,hash:h},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function s(a,o){return typeof o=="string"?o:So(o)}return wS(t,s,null,n)}function qn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Br(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function bS(){return Math.random().toString(36).substring(2,10)}function hv(n,t){return{usr:n.state,key:n.key,idx:t}}function $f(n,t,s=null,a){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?zo(t):t,state:s,key:t&&t.key||a||bS()}}function So({pathname:n="/",search:t="",hash:s=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function zo(n){let t={};if(n){let s=n.indexOf("#");s>=0&&(t.hash=n.substring(s),n=n.substring(0,s));let a=n.indexOf("?");a>=0&&(t.search=n.substring(a),n=n.substring(0,a)),n&&(t.pathname=n)}return t}function wS(n,t,s,a={}){let{window:o=document.defaultView,v5Compat:u=!1}=a,d=o.history,h="POP",f=null,m=y();m==null&&(m=0,d.replaceState({...d.state,idx:m},""));function y(){return(d.state||{idx:null}).idx}function v(){h="POP";let j=y(),N=j==null?null:j-m;m=j,f&&f({action:h,location:E.location,delta:N})}function x(j,N){h="PUSH";let k=$f(E.location,j,N);m=y()+1;let O=hv(k,m),U=E.createHref(k);try{d.pushState(O,"",U)}catch(D){if(D instanceof DOMException&&D.name==="DataCloneError")throw D;o.location.assign(U)}u&&f&&f({action:h,location:E.location,delta:1})}function w(j,N){h="REPLACE";let k=$f(E.location,j,N);m=y();let O=hv(k,m),U=E.createHref(k);d.replaceState(O,"",U),u&&f&&f({action:h,location:E.location,delta:0})}function _(j){return SS(j)}let E={get action(){return h},get location(){return n(o,d)},listen(j){if(f)throw new Error("A history only accepts one active listener");return o.addEventListener(dv,v),f=j,()=>{o.removeEventListener(dv,v),f=null}},createHref(j){return t(o,j)},createURL:_,encodeLocation(j){let N=_(j);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:x,replace:w,go(j){return d.go(j)}};return E}function SS(n,t=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),qn(s,"No window.location.(origin|href) available to create URL");let a=typeof n=="string"?n:So(n);return a=a.replace(/ $/,"%20"),!t&&a.startsWith("//")&&(a=s+a),new URL(a,s)}function qx(n,t,s="/"){return jS(n,t,s,!1)}function jS(n,t,s,a){let o=typeof t=="string"?zo(t):t,u=zs(o.pathname||"/",s);if(u==null)return null;let d=Fx(n);_S(d);let h=null;for(let f=0;h==null&&f<d.length;++f){let m=zS(u);h=DS(d[f],m,a)}return h}function Fx(n,t=[],s=[],a="",o=!1){let u=(d,h,f=o,m)=>{let y={relativePath:m===void 0?d.path||"":m,caseSensitive:d.caseSensitive===!0,childrenIndex:h,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(a)&&f)return;qn(y.relativePath.startsWith(a),`Absolute route path "${y.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(a.length)}let v=Ms([a,y.relativePath]),x=s.concat(y);d.children&&d.children.length>0&&(qn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),Fx(d.children,t,x,v,f)),!(d.path==null&&!d.index)&&t.push({path:v,score:AS(v,d.index),routesMeta:x})};return n.forEach((d,h)=>{if(d.path===""||!d.path?.includes("?"))u(d,h);else for(let f of Hx(d.path))u(d,h,!0,f)}),t}function Hx(n){let t=n.split("/");if(t.length===0)return[];let[s,...a]=t,o=s.endsWith("?"),u=s.replace(/\?$/,"");if(a.length===0)return o?[u,""]:[u];let d=Hx(a.join("/")),h=[];return h.push(...d.map(f=>f===""?u:[u,f].join("/"))),o&&h.push(...d),h.map(f=>n.startsWith("/")&&f===""?"/":f)}function _S(n){n.sort((t,s)=>t.score!==s.score?s.score-t.score:OS(t.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}var CS=/^:[\w-]+$/,ES=3,NS=2,kS=1,TS=10,RS=-2,fv=n=>n==="*";function AS(n,t){let s=n.split("/"),a=s.length;return s.some(fv)&&(a+=RS),t&&(a+=NS),s.filter(o=>!fv(o)).reduce((o,u)=>o+(CS.test(u)?ES:u===""?kS:TS),a)}function OS(n,t){return n.length===t.length&&n.slice(0,-1).every((a,o)=>a===t[o])?n[n.length-1]-t[t.length-1]:0}function DS(n,t,s=!1){let{routesMeta:a}=n,o={},u="/",d=[];for(let h=0;h<a.length;++h){let f=a[h],m=h===a.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=Cu({path:f.relativePath,caseSensitive:f.caseSensitive,end:m},y),x=f.route;if(!v&&m&&s&&!a[a.length-1].route.index&&(v=Cu({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},y)),!v)return null;Object.assign(o,v.params),d.push({params:o,pathname:Ms([u,v.pathname]),pathnameBase:BS(Ms([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=Ms([u,v.pathnameBase]))}return d}function Cu(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,a]=MS(n.path,n.caseSensitive,n.end),o=t.match(s);if(!o)return null;let u=o[0],d=u.replace(/(.)\/+$/,"$1"),h=o.slice(1);return{params:a.reduce((m,{paramName:y,isOptional:v},x)=>{if(y==="*"){let _=h[x]||"";d=u.slice(0,u.length-_.length).replace(/(.)\/+$/,"$1")}const w=h[x];return v&&!w?m[y]=void 0:m[y]=(w||"").replace(/%2F/g,"/"),m},{}),pathname:u,pathnameBase:d,pattern:n}}function MS(n,t=!1,s=!0){Br(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let a=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,h,f)=>(a.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(a.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),a]}function zS(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Br(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function zs(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,a=n.charAt(s);return a&&a!=="/"?null:n.slice(s)||"/"}var Gx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,US=n=>Gx.test(n);function LS(n,t="/"){let{pathname:s,search:a="",hash:o=""}=typeof n=="string"?zo(n):n,u;if(s)if(US(s))u=s;else{if(s.includes("//")){let d=s;s=s.replace(/\/\/+/g,"/"),Br(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${s}`)}s.startsWith("/")?u=pv(s.substring(1),"/"):u=pv(s,t)}else u=t;return{pathname:u,search:$S(a),hash:PS(o)}}function pv(n,t){let s=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?s.length>1&&s.pop():o!=="."&&s.push(o)}),s.length>1?s.join("/"):"/"}function nf(n,t,s,a){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function IS(n){return n.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function Vx(n){let t=IS(n);return t.map((s,a)=>a===t.length-1?s.pathname:s.pathnameBase)}function Kx(n,t,s,a=!1){let o;typeof n=="string"?o=zo(n):(o={...n},qn(!o.pathname||!o.pathname.includes("?"),nf("?","pathname","search",o)),qn(!o.pathname||!o.pathname.includes("#"),nf("#","pathname","hash",o)),qn(!o.search||!o.search.includes("#"),nf("#","search","hash",o)));let u=n===""||o.pathname==="",d=u?"/":o.pathname,h;if(d==null)h=s;else{let v=t.length-1;if(!a&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;o.pathname=x.join("/")}h=v>=0?t[v]:"/"}let f=LS(o,h),m=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&s.endsWith("/");return!f.pathname.endsWith("/")&&(m||y)&&(f.pathname+="/"),f}var Ms=n=>n.join("/").replace(/\/\/+/g,"/"),BS=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),$S=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,PS=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,qS=class{constructor(n,t,s,a=!1){this.status=n,this.statusText=t||"",this.internal=a,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function FS(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function HS(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Yx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Qx(n,t){let s=n;if(typeof s!="string"||!Gx.test(s))return{absoluteURL:void 0,isExternal:!1,to:s};let a=s,o=!1;if(Yx)try{let u=new URL(window.location.href),d=s.startsWith("//")?new URL(u.protocol+s):new URL(s),h=zs(d.pathname,t);d.origin===u.origin&&h!=null?s=h+d.search+d.hash:o=!0}catch{Br(!1,`<Link to="${s}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:o,to:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Wx=["POST","PUT","PATCH","DELETE"];new Set(Wx);var GS=["GET",...Wx];new Set(GS);var sl=b.createContext(null);sl.displayName="DataRouter";var Lu=b.createContext(null);Lu.displayName="DataRouterState";var VS=b.createContext(!1),Jx=b.createContext({isTransitioning:!1});Jx.displayName="ViewTransition";var KS=b.createContext(new Map);KS.displayName="Fetchers";var YS=b.createContext(null);YS.displayName="Await";var $r=b.createContext(null);$r.displayName="Navigation";var Iu=b.createContext(null);Iu.displayName="Location";var Ls=b.createContext({outlet:null,matches:[],isDataRoute:!1});Ls.displayName="Route";var op=b.createContext(null);op.displayName="RouteError";var Xx="REACT_ROUTER_ERROR",QS="REDIRECT",WS="ROUTE_ERROR_RESPONSE";function JS(n){if(n.startsWith(`${Xx}:${QS}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function XS(n){if(n.startsWith(`${Xx}:${WS}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new qS(t.status,t.statusText,t.data)}catch{}}function ZS(n,{relative:t}={}){qn(Uo(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:a}=b.useContext($r),{hash:o,pathname:u,search:d}=Lo(n,{relative:t}),h=u;return s!=="/"&&(h=u==="/"?s:Ms([s,u])),a.createHref({pathname:h,search:d,hash:o})}function Uo(){return b.useContext(Iu)!=null}function Is(){return qn(Uo(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(Iu).location}var Zx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function e0(n){b.useContext($r).static||b.useLayoutEffect(n)}function t0(){let{isDataRoute:n}=b.useContext(Ls);return n?hj():ej()}function ej(){qn(Uo(),"useNavigate() may be used only in the context of a <Router> component.");let n=b.useContext(sl),{basename:t,navigator:s}=b.useContext($r),{matches:a}=b.useContext(Ls),{pathname:o}=Is(),u=JSON.stringify(Vx(a)),d=b.useRef(!1);return e0(()=>{d.current=!0}),b.useCallback((f,m={})=>{if(Br(d.current,Zx),!d.current)return;if(typeof f=="number"){s.go(f);return}let y=Kx(f,JSON.parse(u),o,m.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Ms([t,y.pathname])),(m.replace?s.replace:s.push)(y,m.state,m)},[t,s,u,o,n])}b.createContext(null);function Lo(n,{relative:t}={}){let{matches:s}=b.useContext(Ls),{pathname:a}=Is(),o=JSON.stringify(Vx(s));return b.useMemo(()=>Kx(n,JSON.parse(o),a,t==="path"),[n,o,a,t])}function tj(n,t,s,a,o){qn(Uo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=b.useContext($r),{matches:d}=b.useContext(Ls),h=d[d.length-1],f=h?h.params:{},m=h?h.pathname:"/",y=h?h.pathnameBase:"/",v=h&&h.route;{let k=v&&v.path||"";r0(m,!v||k.endsWith("*")||k.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${k}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${k}"> to <Route path="${k==="/"?"*":`${k}/*`}">.`)}let x=Is(),w;w=x;let _=w.pathname||"/",E=_;if(y!=="/"){let k=y.replace(/^\//,"").split("/");E="/"+_.replace(/^\//,"").split("/").slice(k.length).join("/")}let j=qx(n,{pathname:E});return Br(v||j!=null,`No routes matched location "${w.pathname}${w.search}${w.hash}" `),Br(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${w.pathname}${w.search}${w.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),aj(j&&j.map(k=>Object.assign({},k,{params:Object.assign({},f,k.params),pathname:Ms([y,u.encodeLocation?u.encodeLocation(k.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?y:Ms([y,u.encodeLocation?u.encodeLocation(k.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:k.pathnameBase])})),d,s,a,o)}function nj(){let n=dj(),t=FS(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,a="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:a},u={padding:"2px 4px",backgroundColor:a},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:u},"ErrorBoundary")," or"," ",b.createElement("code",{style:u},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},t),s?b.createElement("pre",{style:o},s):null,d)}var rj=b.createElement(nj,null),n0=class extends b.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const s=XS(n.digest);s&&(n=s)}let t=n!==void 0?b.createElement(Ls.Provider,{value:this.props.routeContext},b.createElement(op.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?b.createElement(sj,{error:n},t):t}};n0.contextType=VS;var rf=new WeakMap;function sj({children:n,error:t}){let{basename:s}=b.useContext($r);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let a=JS(t.digest);if(a){let o=rf.get(t);if(o)throw o;let u=Qx(a.location,s);if(Yx&&!rf.get(t))if(u.isExternal||a.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:a.replace}));throw rf.set(t,d),d}return b.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function ij({routeContext:n,match:t,children:s}){let a=b.useContext(sl);return a&&a.static&&a.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=t.route.id),b.createElement(Ls.Provider,{value:n},s)}function aj(n,t=[],s=null,a=null,o=null){if(n==null){if(!s)return null;if(s.errors)n=s.matches;else if(t.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let u=n,d=s?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);qn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let h=!1,f=-1;if(s)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(f=y),v.route.id){let{loaderData:x,errors:w}=s,_=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!w||w[v.route.id]===void 0);if(v.route.lazy||_){h=!0,f>=0?u=u.slice(0,f+1):u=[u[0]];break}}}let m=s&&a?(y,v)=>{a(y,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:HS(s.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let w,_=!1,E=null,j=null;s&&(w=d&&v.route.id?d[v.route.id]:void 0,E=v.route.errorElement||rj,h&&(f<0&&x===0?(r0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),_=!0,j=null):f===x&&(_=!0,j=v.route.hydrateFallbackElement||null)));let N=t.concat(u.slice(0,x+1)),k=()=>{let O;return w?O=E:_?O=j:v.route.Component?O=b.createElement(v.route.Component,null):v.route.element?O=v.route.element:O=y,b.createElement(ij,{match:v,routeContext:{outlet:y,matches:N,isDataRoute:s!=null},children:O})};return s&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?b.createElement(n0,{location:s.location,revalidation:s.revalidation,component:E,error:w,children:k(),routeContext:{outlet:null,matches:N,isDataRoute:!0},onError:m}):k()},null)}function cp(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lj(n){let t=b.useContext(sl);return qn(t,cp(n)),t}function oj(n){let t=b.useContext(Lu);return qn(t,cp(n)),t}function cj(n){let t=b.useContext(Ls);return qn(t,cp(n)),t}function up(n){let t=cj(n),s=t.matches[t.matches.length-1];return qn(s.route.id,`${n} can only be used on routes that contain a unique "id"`),s.route.id}function uj(){return up("useRouteId")}function dj(){let n=b.useContext(op),t=oj("useRouteError"),s=up("useRouteError");return n!==void 0?n:t.errors?.[s]}function hj(){let{router:n}=lj("useNavigate"),t=up("useNavigate"),s=b.useRef(!1);return e0(()=>{s.current=!0}),b.useCallback(async(o,u={})=>{Br(s.current,Zx),s.current&&(typeof o=="number"?await n.navigate(o):await n.navigate(o,{fromRouteId:t,...u}))},[n,t])}var mv={};function r0(n,t,s){!t&&!mv[n]&&(mv[n]=!0,Br(!1,s))}b.memo(fj);function fj({routes:n,future:t,state:s,onError:a}){return tj(n,void 0,s,a,t)}function pj({basename:n="/",children:t=null,location:s,navigationType:a="POP",navigator:o,static:u=!1,unstable_useTransitions:d}){qn(!Uo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=n.replace(/^\/*/,"/"),f=b.useMemo(()=>({basename:h,navigator:o,static:u,unstable_useTransitions:d,future:{}}),[h,o,u,d]);typeof s=="string"&&(s=zo(s));let{pathname:m="/",search:y="",hash:v="",state:x=null,key:w="default"}=s,_=b.useMemo(()=>{let E=zs(m,h);return E==null?null:{location:{pathname:E,search:y,hash:v,state:x,key:w},navigationType:a}},[h,m,y,v,x,w,a]);return Br(_!=null,`<Router basename="${h}"> is not able to match the URL "${m}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:b.createElement($r.Provider,{value:f},b.createElement(Iu.Provider,{children:t,value:_}))}var vu="get",xu="application/x-www-form-urlencoded";function Bu(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function mj(n){return Bu(n)&&n.tagName.toLowerCase()==="button"}function gj(n){return Bu(n)&&n.tagName.toLowerCase()==="form"}function yj(n){return Bu(n)&&n.tagName.toLowerCase()==="input"}function vj(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function xj(n,t){return n.button===0&&(!t||t==="_self")&&!vj(n)}function Pf(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,s)=>{let a=n[s];return t.concat(Array.isArray(a)?a.map(o=>[s,o]):[[s,a]])},[]))}function bj(n,t){let s=Pf(n);return t&&t.forEach((a,o)=>{s.has(o)||t.getAll(o).forEach(u=>{s.append(o,u)})}),s}var ru=null;function wj(){if(ru===null)try{new FormData(document.createElement("form"),0),ru=!1}catch{ru=!0}return ru}var Sj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function sf(n){return n!=null&&!Sj.has(n)?(Br(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${xu}"`),null):n}function jj(n,t){let s,a,o,u,d;if(gj(n)){let h=n.getAttribute("action");a=h?zs(h,t):null,s=n.getAttribute("method")||vu,o=sf(n.getAttribute("enctype"))||xu,u=new FormData(n)}else if(mj(n)||yj(n)&&(n.type==="submit"||n.type==="image")){let h=n.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=n.getAttribute("formaction")||h.getAttribute("action");if(a=f?zs(f,t):null,s=n.getAttribute("formmethod")||h.getAttribute("method")||vu,o=sf(n.getAttribute("formenctype"))||sf(h.getAttribute("enctype"))||xu,u=new FormData(h,n),!wj()){let{name:m,type:y,value:v}=n;if(y==="image"){let x=m?`${m}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else m&&u.append(m,v)}}else{if(Bu(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=vu,a=null,o=xu,d=n}return u&&o==="text/plain"&&(d=u,u=void 0),{action:a,method:s.toLowerCase(),encType:o,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function dp(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function _j(n,t,s){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return a.pathname==="/"?a.pathname=`_root.${s}`:t&&zs(a.pathname,t)==="/"?a.pathname=`${t.replace(/\/$/,"")}/_root.${s}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${s}`,a}async function Cj(n,t){if(n.id in t)return t[n.id];try{let s=await import(n.module);return t[n.id]=s,s}catch(s){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Ej(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Nj(n,t,s){let a=await Promise.all(n.map(async o=>{let u=t.routes[o.route.id];if(u){let d=await Cj(u,s);return d.links?d.links():[]}return[]}));return Aj(a.flat(1).filter(Ej).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function gv(n,t,s,a,o,u){let d=(f,m)=>s[m]?f.route.id!==s[m].route.id:!0,h=(f,m)=>s[m].pathname!==f.pathname||s[m].route.path?.endsWith("*")&&s[m].params["*"]!==f.params["*"];return u==="assets"?t.filter((f,m)=>d(f,m)||h(f,m)):u==="data"?t.filter((f,m)=>{let y=a.routes[f.route.id];if(!y||!y.hasLoader)return!1;if(d(f,m)||h(f,m))return!0;if(f.route.shouldRevalidate){let v=f.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function kj(n,t,{includeHydrateFallback:s}={}){return Tj(n.map(a=>{let o=t.routes[a.route.id];if(!o)return[];let u=[o.module];return o.clientActionModule&&(u=u.concat(o.clientActionModule)),o.clientLoaderModule&&(u=u.concat(o.clientLoaderModule)),s&&o.hydrateFallbackModule&&(u=u.concat(o.hydrateFallbackModule)),o.imports&&(u=u.concat(o.imports)),u}).flat(1))}function Tj(n){return[...new Set(n)]}function Rj(n){let t={},s=Object.keys(n).sort();for(let a of s)t[a]=n[a];return t}function Aj(n,t){let s=new Set;return new Set(t),n.reduce((a,o)=>{let u=JSON.stringify(Rj(o));return s.has(u)||(s.add(u),a.push({key:u,link:o})),a},[])}function s0(){let n=b.useContext(sl);return dp(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function Oj(){let n=b.useContext(Lu);return dp(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var hp=b.createContext(void 0);hp.displayName="FrameworkContext";function i0(){let n=b.useContext(hp);return dp(n,"You must render this element inside a <HydratedRouter> element"),n}function Dj(n,t){let s=b.useContext(hp),[a,o]=b.useState(!1),[u,d]=b.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:m,onMouseLeave:y,onTouchStart:v}=t,x=b.useRef(null);b.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let E=N=>{N.forEach(k=>{d(k.isIntersecting)})},j=new IntersectionObserver(E,{threshold:.5});return x.current&&j.observe(x.current),()=>{j.disconnect()}}},[n]),b.useEffect(()=>{if(a){let E=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(E)}}},[a]);let w=()=>{o(!0)},_=()=>{o(!1),d(!1)};return s?n!=="intent"?[u,x,{}]:[u,x,{onFocus:ao(h,w),onBlur:ao(f,_),onMouseEnter:ao(m,w),onMouseLeave:ao(y,_),onTouchStart:ao(v,w)}]:[!1,x,{}]}function ao(n,t){return s=>{n&&n(s),s.defaultPrevented||t(s)}}function Mj({page:n,...t}){let{router:s}=s0(),a=b.useMemo(()=>qx(s.routes,n,s.basename),[s.routes,n,s.basename]);return a?b.createElement(Uj,{page:n,matches:a,...t}):null}function zj(n){let{manifest:t,routeModules:s}=i0(),[a,o]=b.useState([]);return b.useEffect(()=>{let u=!1;return Nj(n,t,s).then(d=>{u||o(d)}),()=>{u=!0}},[n,t,s]),a}function Uj({page:n,matches:t,...s}){let a=Is(),{manifest:o,routeModules:u}=i0(),{basename:d}=s0(),{loaderData:h,matches:f}=Oj(),m=b.useMemo(()=>gv(n,t,f,o,a,"data"),[n,t,f,o,a]),y=b.useMemo(()=>gv(n,t,f,o,a,"assets"),[n,t,f,o,a]),v=b.useMemo(()=>{if(n===a.pathname+a.search+a.hash)return[];let _=new Set,E=!1;if(t.forEach(N=>{let k=o.routes[N.route.id];!k||!k.hasLoader||(!m.some(O=>O.route.id===N.route.id)&&N.route.id in h&&u[N.route.id]?.shouldRevalidate||k.hasClientLoader?E=!0:_.add(N.route.id))}),_.size===0)return[];let j=_j(n,d,"data");return E&&_.size>0&&j.searchParams.set("_routes",t.filter(N=>_.has(N.route.id)).map(N=>N.route.id).join(",")),[j.pathname+j.search]},[d,h,a,o,m,t,n,u]),x=b.useMemo(()=>kj(y,o),[y,o]),w=zj(y);return b.createElement(b.Fragment,null,v.map(_=>b.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...s})),x.map(_=>b.createElement("link",{key:_,rel:"modulepreload",href:_,...s})),w.map(({key:_,link:E})=>b.createElement("link",{key:_,nonce:s.nonce,...E})))}function Lj(...n){return t=>{n.forEach(s=>{typeof s=="function"?s(t):s!=null&&(s.current=t)})}}var Ij=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Ij&&(window.__reactRouterVersion="7.11.0")}catch{}function Bj({basename:n,children:t,unstable_useTransitions:s,window:a}){let o=b.useRef();o.current==null&&(o.current=xS({window:a,v5Compat:!0}));let u=o.current,[d,h]=b.useState({action:u.action,location:u.location}),f=b.useCallback(m=>{s===!1?h(m):b.startTransition(()=>h(m))},[s]);return b.useLayoutEffect(()=>u.listen(f),[u,f]),b.createElement(pj,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:s})}var a0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,l0=b.forwardRef(function({onClick:t,discover:s="render",prefetch:a="none",relative:o,reloadDocument:u,replace:d,state:h,target:f,to:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...w},_){let{basename:E,unstable_useTransitions:j}=b.useContext($r),N=typeof m=="string"&&a0.test(m),k=Qx(m,E);m=k.to;let O=ZS(m,{relative:o}),[U,D,C]=Dj(a,w),M=Fj(m,{replace:d,state:h,target:f,preventScrollReset:y,relative:o,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:j});function T(K){t&&t(K),K.defaultPrevented||M(K)}let H=b.createElement("a",{...w,...C,href:k.absoluteURL||O,onClick:k.isExternal||u?t:T,ref:Lj(_,D),target:f,"data-discover":!N&&s==="render"?"true":void 0});return U&&!N?b.createElement(b.Fragment,null,H,b.createElement(Mj,{page:O})):H});l0.displayName="Link";var $j=b.forwardRef(function({"aria-current":t="page",caseSensitive:s=!1,className:a="",end:o=!1,style:u,to:d,viewTransition:h,children:f,...m},y){let v=Lo(d,{relative:m.relative}),x=Is(),w=b.useContext(Lu),{navigator:_,basename:E}=b.useContext($r),j=w!=null&&Yj(v)&&h===!0,N=_.encodeLocation?_.encodeLocation(v).pathname:v.pathname,k=x.pathname,O=w&&w.navigation&&w.navigation.location?w.navigation.location.pathname:null;s||(k=k.toLowerCase(),O=O?O.toLowerCase():null,N=N.toLowerCase()),O&&E&&(O=zs(O,E)||O);const U=N!=="/"&&N.endsWith("/")?N.length-1:N.length;let D=k===N||!o&&k.startsWith(N)&&k.charAt(U)==="/",C=O!=null&&(O===N||!o&&O.startsWith(N)&&O.charAt(N.length)==="/"),M={isActive:D,isPending:C,isTransitioning:j},T=D?t:void 0,H;typeof a=="function"?H=a(M):H=[a,D?"active":null,C?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let K=typeof u=="function"?u(M):u;return b.createElement(l0,{...m,"aria-current":T,className:H,ref:y,style:K,to:d,viewTransition:h},typeof f=="function"?f(M):f)});$j.displayName="NavLink";var Pj=b.forwardRef(({discover:n="render",fetcherKey:t,navigate:s,reloadDocument:a,replace:o,state:u,method:d=vu,action:h,onSubmit:f,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...w},_)=>{let{unstable_useTransitions:E}=b.useContext($r),j=Vj(),N=Kj(h,{relative:m}),k=d.toLowerCase()==="get"?"get":"post",O=typeof h=="string"&&a0.test(h),U=D=>{if(f&&f(D),D.defaultPrevented)return;D.preventDefault();let C=D.nativeEvent.submitter,M=C?.getAttribute("formmethod")||d,T=()=>j(C||D.currentTarget,{fetcherKey:t,method:M,navigate:s,replace:o,state:u,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});E&&s!==!1?b.startTransition(()=>T()):T()};return b.createElement("form",{ref:_,method:k,action:N,onSubmit:a?f:U,...w,"data-discover":!O&&n==="render"?"true":void 0})});Pj.displayName="Form";function qj(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function o0(n){let t=b.useContext(sl);return qn(t,qj(n)),t}function Fj(n,{target:t,replace:s,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let m=t0(),y=Is(),v=Lo(n,{relative:u});return b.useCallback(x=>{if(xj(x,t)){x.preventDefault();let w=s!==void 0?s:So(y)===So(v),_=()=>m(n,{replace:w,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:h});f?b.startTransition(()=>_()):_()}},[y,m,v,s,a,t,n,o,u,d,h,f])}function Io(n){Br(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=b.useRef(Pf(n)),s=b.useRef(!1),a=Is(),o=b.useMemo(()=>bj(a.search,s.current?null:t.current),[a.search]),u=t0(),d=b.useCallback((h,f)=>{const m=Pf(typeof h=="function"?h(new URLSearchParams(o)):h);s.current=!0,u("?"+m,f)},[u,o]);return[o,d]}var Hj=0,Gj=()=>`__${String(++Hj)}__`;function Vj(){let{router:n}=o0("useSubmit"),{basename:t}=b.useContext($r),s=uj(),a=n.fetch,o=n.navigate;return b.useCallback(async(u,d={})=>{let{action:h,method:f,encType:m,formData:y,body:v}=jj(u,t);if(d.navigate===!1){let x=d.fetcherKey||Gj();await a(x,s,d.action||h,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||f,formEncType:d.encType||m,flushSync:d.flushSync})}else await o(d.action||h,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||f,formEncType:d.encType||m,replace:d.replace,state:d.state,fromRouteId:s,flushSync:d.flushSync,viewTransition:d.viewTransition})},[a,o,t,s])}function Kj(n,{relative:t}={}){let{basename:s}=b.useContext($r),a=b.useContext(Ls);qn(a,"useFormAction must be used inside a RouteContext");let[o]=a.matches.slice(-1),u={...Lo(n||".",{relative:t})},d=Is();if(n==null){u.search=d.search;let h=new URLSearchParams(u.search),f=h.getAll("index");if(f.some(y=>y==="")){h.delete("index"),f.filter(v=>v).forEach(v=>h.append("index",v));let y=h.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&o.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(u.pathname=u.pathname==="/"?s:Ms([s,u.pathname])),So(u)}function Yj(n,{relative:t}={}){let s=b.useContext(Jx);qn(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=o0("useViewTransitionState"),o=Lo(n,{relative:t});if(!s.isTransitioning)return!1;let u=zs(s.currentLocation.pathname,a)||s.currentLocation.pathname,d=zs(s.nextLocation.pathname,a)||s.nextLocation.pathname;return Cu(o.pathname,d)!=null||Cu(o.pathname,u)!=null}var Ki=Px();const Qj=({children:n})=>(Is(),i.jsxs("div",{className:"app-layout",children:[i.jsx("header",{className:"app-header",children:i.jsx("div",{className:"container app-header__content",children:i.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),i.jsx("main",{className:"container app-main",children:n}),i.jsx("footer",{className:"app-footer",children:i.jsx("div",{className:"container",children:i.jsx("p",{children:" 2026 recipe management"})})})]})),tn=({children:n,className:t="",hoverable:s=!1,...a})=>i.jsx("div",{className:`glass-card ${s?"glass-card--hoverable":""} ${t}`,...a,children:n}),re=({children:n,variant:t="primary",size:s="md",isLoading:a,block:o,className:u="",...d})=>{const h=["btn",`btn--${t}`,`btn--${s}`,o?"btn--block":"",a?"btn--loading":"",u].filter(Boolean).join(" ");return i.jsxs("button",{className:h,disabled:a,...d,children:[a&&i.jsx("span",{className:"btn__spinner"}),i.jsx("span",{className:"btn__content",children:n})]})};function Wj(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return b.useMemo(()=>a=>{t.forEach(o=>o(a))},t)}const $u=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function il(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function fp(n){return"nodeType"in n}function or(n){var t,s;return n?il(n)?n:fp(n)&&(t=(s=n.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function pp(n){const{Document:t}=or(n);return n instanceof t}function Bo(n){return il(n)?!1:n instanceof or(n).HTMLElement}function c0(n){return n instanceof or(n).SVGElement}function al(n){return n?il(n)?n.document:fp(n)?pp(n)?n:Bo(n)||c0(n)?n.ownerDocument:document:document:document}const Xr=$u?b.useLayoutEffect:b.useEffect;function Pu(n){const t=b.useRef(n);return Xr(()=>{t.current=n}),b.useCallback(function(){for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return t.current==null?void 0:t.current(...a)},[])}function Jj(){const n=b.useRef(null),t=b.useCallback((a,o)=>{n.current=setInterval(a,o)},[]),s=b.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,s]}function jo(n,t){t===void 0&&(t=[n]);const s=b.useRef(n);return Xr(()=>{s.current!==n&&(s.current=n)},t),s}function $o(n,t){const s=b.useRef();return b.useMemo(()=>{const a=n(s.current);return s.current=a,a},[...t])}function Eu(n){const t=Pu(n),s=b.useRef(null),a=b.useCallback(o=>{o!==s.current&&t?.(o,s.current),s.current=o},[]);return[s,a]}function Nu(n){const t=b.useRef();return b.useEffect(()=>{t.current=n},[n]),t.current}let af={};function Po(n,t){return b.useMemo(()=>{if(t)return t;const s=af[n]==null?0:af[n]+1;return af[n]=s,n+"-"+s},[n,t])}function u0(n){return function(t){for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];return a.reduce((u,d)=>{const h=Object.entries(d);for(const[f,m]of h){const y=u[f];y!=null&&(u[f]=y+n*m)}return u},{...t})}}const Za=u0(1),_o=u0(-1);function Xj(n){return"clientX"in n&&"clientY"in n}function qu(n){if(!n)return!1;const{KeyboardEvent:t}=or(n.target);return t&&n instanceof t}function Zj(n){if(!n)return!1;const{TouchEvent:t}=or(n.target);return t&&n instanceof t}function ku(n){if(Zj(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:s}=n.touches[0];return{x:t,y:s}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:s}=n.changedTouches[0];return{x:t,y:s}}}return Xj(n)?{x:n.clientX,y:n.clientY}:null}const kr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:s}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:s}=n;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(n){if(n)return[kr.Translate.toString(n),kr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:s,easing:a}=n;return t+" "+s+"ms "+a}}}),yv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function e_(n){return n.matches(yv)?n:n.querySelector(yv)}const t_={display:"none"};function n_(n){let{id:t,value:s}=n;return be.createElement("div",{id:t,style:t_},s)}function r_(n){let{id:t,announcement:s,ariaLiveType:a="assertive"}=n;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return be.createElement("div",{id:t,style:o,role:"status","aria-live":a,"aria-atomic":!0},s)}function s_(){const[n,t]=b.useState("");return{announce:b.useCallback(a=>{a!=null&&t(a)},[]),announcement:n}}const d0=b.createContext(null);function i_(n){const t=b.useContext(d0);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function a_(){const[n]=b.useState(()=>new Set),t=b.useCallback(a=>(n.add(a),()=>n.delete(a)),[n]);return[b.useCallback(a=>{let{type:o,event:u}=a;n.forEach(d=>{var h;return(h=d[o])==null?void 0:h.call(d,u)})},[n]),t]}const l_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},o_={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function c_(n){let{announcements:t=o_,container:s,hiddenTextDescribedById:a,screenReaderInstructions:o=l_}=n;const{announce:u,announcement:d}=s_(),h=Po("DndLiveRegion"),[f,m]=b.useState(!1);if(b.useEffect(()=>{m(!0)},[]),i_(b.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:w}=v;t.onDragMove&&u(t.onDragMove({active:x,over:w}))},onDragOver(v){let{active:x,over:w}=v;u(t.onDragOver({active:x,over:w}))},onDragEnd(v){let{active:x,over:w}=v;u(t.onDragEnd({active:x,over:w}))},onDragCancel(v){let{active:x,over:w}=v;u(t.onDragCancel({active:x,over:w}))}}),[u,t])),!f)return null;const y=be.createElement(be.Fragment,null,be.createElement(n_,{id:a,value:o.draggable}),be.createElement(r_,{id:h,announcement:d}));return s?Ki.createPortal(y,s):y}var $n;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})($n||($n={}));function Tu(){}function gr(n,t){return b.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function ll(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return b.useMemo(()=>[...t].filter(a=>a!=null),[...t])}const Zr=Object.freeze({x:0,y:0});function mp(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function u_(n,t){const s=ku(n);if(!s)return"0 0";const a={x:(s.x-t.left)/t.width*100,y:(s.y-t.top)/t.height*100};return a.x+"% "+a.y+"%"}function gp(n,t){let{data:{value:s}}=n,{data:{value:a}}=t;return s-a}function d_(n,t){let{data:{value:s}}=n,{data:{value:a}}=t;return a-s}function qf(n){let{left:t,top:s,height:a,width:o}=n;return[{x:t,y:s},{x:t+o,y:s},{x:t,y:s+a},{x:t+o,y:s+a}]}function h0(n,t){if(!n||n.length===0)return null;const[s]=n;return s[t]}function vv(n,t,s){return t===void 0&&(t=n.left),s===void 0&&(s=n.top),{x:t+n.width*.5,y:s+n.height*.5}}const Ff=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:a}=n;const o=vv(t,t.left,t.top),u=[];for(const d of a){const{id:h}=d,f=s.get(h);if(f){const m=mp(vv(f),o);u.push({id:h,data:{droppableContainer:d,value:m}})}}return u.sort(gp)},h_=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:a}=n;const o=qf(t),u=[];for(const d of a){const{id:h}=d,f=s.get(h);if(f){const m=qf(f),y=o.reduce((x,w,_)=>x+mp(m[_],w),0),v=Number((y/4).toFixed(4));u.push({id:h,data:{droppableContainer:d,value:v}})}}return u.sort(gp)};function f_(n,t){const s=Math.max(t.top,n.top),a=Math.max(t.left,n.left),o=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=o-a,h=u-s;if(a<o&&s<u){const f=t.width*t.height,m=n.width*n.height,y=d*h,v=y/(f+m-y);return Number(v.toFixed(4))}return 0}const p_=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:a}=n;const o=[];for(const u of a){const{id:d}=u,h=s.get(d);if(h){const f=f_(h,t);f>0&&o.push({id:d,data:{droppableContainer:u,value:f}})}}return o.sort(d_)};function m_(n,t){const{top:s,left:a,bottom:o,right:u}=t;return s<=n.y&&n.y<=o&&a<=n.x&&n.x<=u}const f0=n=>{let{droppableContainers:t,droppableRects:s,pointerCoordinates:a}=n;if(!a)return[];const o=[];for(const u of t){const{id:d}=u,h=s.get(d);if(h&&m_(a,h)){const m=qf(h).reduce((v,x)=>v+mp(a,x),0),y=Number((m/4).toFixed(4));o.push({id:d,data:{droppableContainer:u,value:y}})}}return o.sort(gp)};function g_(n,t,s){return{...n,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function p0(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:Zr}function y_(n){return function(s){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];return o.reduce((d,h)=>({...d,top:d.top+n*h.y,bottom:d.bottom+n*h.y,left:d.left+n*h.x,right:d.right+n*h.x}),{...s})}}const v_=y_(1);function m0(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function x_(n,t,s){const a=m0(t);if(!a)return n;const{scaleX:o,scaleY:u,x:d,y:h}=a,f=n.left-d-(1-o)*parseFloat(s),m=n.top-h-(1-u)*parseFloat(s.slice(s.indexOf(" ")+1)),y=o?n.width/o:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:m,right:f+y,bottom:m+v,left:f}}const b_={ignoreTransform:!1};function ol(n,t){t===void 0&&(t=b_);let s=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:m,transformOrigin:y}=or(n).getComputedStyle(n);m&&(s=x_(s,m,y))}const{top:a,left:o,width:u,height:d,bottom:h,right:f}=s;return{top:a,left:o,width:u,height:d,bottom:h,right:f}}function xv(n){return ol(n,{ignoreTransform:!0})}function w_(n){const t=n.innerWidth,s=n.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function S_(n,t){return t===void 0&&(t=or(n).getComputedStyle(n)),t.position==="fixed"}function j_(n,t){t===void 0&&(t=or(n).getComputedStyle(n));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const u=t[o];return typeof u=="string"?s.test(u):!1})}function Fu(n,t){const s=[];function a(o){if(t!=null&&s.length>=t||!o)return s;if(pp(o)&&o.scrollingElement!=null&&!s.includes(o.scrollingElement))return s.push(o.scrollingElement),s;if(!Bo(o)||c0(o)||s.includes(o))return s;const u=or(n).getComputedStyle(o);return o!==n&&j_(o,u)&&s.push(o),S_(o,u)?s:a(o.parentNode)}return n?a(n):s}function g0(n){const[t]=Fu(n,1);return t??null}function lf(n){return!$u||!n?null:il(n)?n:fp(n)?pp(n)||n===al(n).scrollingElement?window:Bo(n)?n:null:null}function y0(n){return il(n)?n.scrollX:n.scrollLeft}function v0(n){return il(n)?n.scrollY:n.scrollTop}function Hf(n){return{x:y0(n),y:v0(n)}}var Hn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Hn||(Hn={}));function x0(n){return!$u||!n?!1:n===document.scrollingElement}function b0(n){const t={x:0,y:0},s=x0(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},a={x:n.scrollWidth-s.width,y:n.scrollHeight-s.height},o=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=a.y,h=n.scrollLeft>=a.x;return{isTop:o,isLeft:u,isBottom:d,isRight:h,maxScroll:a,minScroll:t}}const __={x:.2,y:.2};function C_(n,t,s,a,o){let{top:u,left:d,right:h,bottom:f}=s;a===void 0&&(a=10),o===void 0&&(o=__);const{isTop:m,isBottom:y,isLeft:v,isRight:x}=b0(n),w={x:0,y:0},_={x:0,y:0},E={height:t.height*o.y,width:t.width*o.x};return!m&&u<=t.top+E.height?(w.y=Hn.Backward,_.y=a*Math.abs((t.top+E.height-u)/E.height)):!y&&f>=t.bottom-E.height&&(w.y=Hn.Forward,_.y=a*Math.abs((t.bottom-E.height-f)/E.height)),!x&&h>=t.right-E.width?(w.x=Hn.Forward,_.x=a*Math.abs((t.right-E.width-h)/E.width)):!v&&d<=t.left+E.width&&(w.x=Hn.Backward,_.x=a*Math.abs((t.left+E.width-d)/E.width)),{direction:w,speed:_}}function E_(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:s,right:a,bottom:o}=n.getBoundingClientRect();return{top:t,left:s,right:a,bottom:o,width:n.clientWidth,height:n.clientHeight}}function w0(n){return n.reduce((t,s)=>Za(t,Hf(s)),Zr)}function N_(n){return n.reduce((t,s)=>t+y0(s),0)}function k_(n){return n.reduce((t,s)=>t+v0(s),0)}function S0(n,t){if(t===void 0&&(t=ol),!n)return;const{top:s,left:a,bottom:o,right:u}=t(n);g0(n)&&(o<=0||u<=0||s>=window.innerHeight||a>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const T_=[["x",["left","right"],N_],["y",["top","bottom"],k_]];class yp{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=Fu(s),o=w0(a);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,h]of T_)for(const f of d)Object.defineProperty(this,f,{get:()=>{const m=h(a),y=o[u]-m;return this.rect[f]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class yo{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...s)})},this.target=t}add(t,s,a){var o;(o=this.target)==null||o.addEventListener(t,s,a),this.listeners.push([t,s,a])}}function R_(n){const{EventTarget:t}=or(n);return n instanceof t?n:al(n)}function of(n,t){const s=Math.abs(n.x),a=Math.abs(n.y);return typeof t=="number"?Math.sqrt(s**2+a**2)>t:"x"in t&&"y"in t?s>t.x&&a>t.y:"x"in t?s>t.x:"y"in t?a>t.y:!1}var Ir;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Ir||(Ir={}));function bv(n){n.preventDefault()}function A_(n){n.stopPropagation()}var Vt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(Vt||(Vt={}));const j0={start:[Vt.Space,Vt.Enter],cancel:[Vt.Esc],end:[Vt.Space,Vt.Enter,Vt.Tab]},O_=(n,t)=>{let{currentCoordinates:s}=t;switch(n.code){case Vt.Right:return{...s,x:s.x+25};case Vt.Left:return{...s,x:s.x-25};case Vt.Down:return{...s,y:s.y+25};case Vt.Up:return{...s,y:s.y-25}}};class cl{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new yo(al(s)),this.windowListeners=new yo(or(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ir.Resize,this.handleCancel),this.windowListeners.add(Ir.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ir.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,a=t.node.current;a&&S0(a),s(Zr)}handleKeyDown(t){if(qu(t)){const{active:s,context:a,options:o}=this.props,{keyboardCodes:u=j0,coordinateGetter:d=O_,scrollBehavior:h="smooth"}=o,{code:f}=t;if(u.end.includes(f)){this.handleEnd(t);return}if(u.cancel.includes(f)){this.handleCancel(t);return}const{collisionRect:m}=a.current,y=m?{x:m.left,y:m.top}:Zr;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:s,context:a.current,currentCoordinates:y});if(v){const x=_o(v,y),w={x:0,y:0},{scrollableAncestors:_}=a.current;for(const E of _){const j=t.code,{isTop:N,isRight:k,isLeft:O,isBottom:U,maxScroll:D,minScroll:C}=b0(E),M=E_(E),T={x:Math.min(j===Vt.Right?M.right-M.width/2:M.right,Math.max(j===Vt.Right?M.left:M.left+M.width/2,v.x)),y:Math.min(j===Vt.Down?M.bottom-M.height/2:M.bottom,Math.max(j===Vt.Down?M.top:M.top+M.height/2,v.y))},H=j===Vt.Right&&!k||j===Vt.Left&&!O,K=j===Vt.Down&&!U||j===Vt.Up&&!N;if(H&&T.x!==v.x){const F=E.scrollLeft+x.x,q=j===Vt.Right&&F<=D.x||j===Vt.Left&&F>=C.x;if(q&&!x.y){E.scrollTo({left:F,behavior:h});return}q?w.x=E.scrollLeft-F:w.x=j===Vt.Right?E.scrollLeft-D.x:E.scrollLeft-C.x,w.x&&E.scrollBy({left:-w.x,behavior:h});break}else if(K&&T.y!==v.y){const F=E.scrollTop+x.y,q=j===Vt.Down&&F<=D.y||j===Vt.Up&&F>=C.y;if(q&&!x.x){E.scrollTo({top:F,behavior:h});return}q?w.y=E.scrollTop-F:w.y=j===Vt.Down?E.scrollTop-D.y:E.scrollTop-C.y,w.y&&E.scrollBy({top:-w.y,behavior:h});break}}this.handleMove(t,Za(_o(v,this.referenceCoordinates),w))}}}handleMove(t,s){const{onMove:a}=this.props;t.preventDefault(),a(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}cl.activators=[{eventName:"onKeyDown",handler:(n,t,s)=>{let{keyboardCodes:a=j0,onActivation:o}=t,{active:u}=s;const{code:d}=n.nativeEvent;if(a.start.includes(d)){const h=u.activatorNode.current;return h&&n.target!==h?!1:(n.preventDefault(),o?.({event:n.nativeEvent}),!0)}return!1}}];function wv(n){return!!(n&&"distance"in n)}function Sv(n){return!!(n&&"delay"in n)}class vp{constructor(t,s,a){var o;a===void 0&&(a=R_(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:u}=t,{target:d}=u;this.props=t,this.events=s,this.document=al(d),this.documentListeners=new yo(this.document),this.listeners=new yo(a),this.windowListeners=new yo(or(d)),this.initialCoordinates=(o=ku(u))!=null?o:Zr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:a}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ir.Resize,this.handleCancel),this.windowListeners.add(Ir.DragStart,bv),this.windowListeners.add(Ir.VisibilityChange,this.handleCancel),this.windowListeners.add(Ir.ContextMenu,bv),this.documentListeners.add(Ir.Keydown,this.handleKeydown),s){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Sv(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(wv(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:a,onPending:o}=this.props;o(a,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ir.Click,A_,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ir.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:a,initialCoordinates:o,props:u}=this,{onMove:d,options:{activationConstraint:h}}=u;if(!o)return;const f=(s=ku(t))!=null?s:Zr,m=_o(o,f);if(!a&&h){if(wv(h)){if(h.tolerance!=null&&of(m,h.tolerance))return this.handleCancel();if(of(m,h.distance))return this.handleStart()}if(Sv(h)&&of(m,h.tolerance))return this.handleCancel();this.handlePending(h,m);return}t.cancelable&&t.preventDefault(),d(f)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===Vt.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const D_={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Hu extends vp{constructor(t){const{event:s}=t,a=al(s.target);super(t,D_,a)}}Hu.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:a}=t;return!s.isPrimary||s.button!==0?!1:(a?.({event:s}),!0)}}];const M_={move:{name:"mousemove"},end:{name:"mouseup"}};var Gf;(function(n){n[n.RightClick=2]="RightClick"})(Gf||(Gf={}));class qo extends vp{constructor(t){super(t,M_,al(t.event.target))}}qo.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:a}=t;return s.button===Gf.RightClick?!1:(a?.({event:s}),!0)}}];const cf={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Fo extends vp{constructor(t){super(t,cf)}static setup(){return window.addEventListener(cf.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(cf.move.name,t)};function t(){}}}Fo.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:a}=t;const{touches:o}=s;return o.length>1?!1:(a?.({event:s}),!0)}}];var vo;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(vo||(vo={}));var Ru;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Ru||(Ru={}));function z_(n){let{acceleration:t,activator:s=vo.Pointer,canScroll:a,draggingRect:o,enabled:u,interval:d=5,order:h=Ru.TreeOrder,pointerCoordinates:f,scrollableAncestors:m,scrollableAncestorRects:y,delta:v,threshold:x}=n;const w=L_({delta:v,disabled:!u}),[_,E]=Jj(),j=b.useRef({x:0,y:0}),N=b.useRef({x:0,y:0}),k=b.useMemo(()=>{switch(s){case vo.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case vo.DraggableRect:return o}},[s,o,f]),O=b.useRef(null),U=b.useCallback(()=>{const C=O.current;if(!C)return;const M=j.current.x*N.current.x,T=j.current.y*N.current.y;C.scrollBy(M,T)},[]),D=b.useMemo(()=>h===Ru.TreeOrder?[...m].reverse():m,[h,m]);b.useEffect(()=>{if(!u||!m.length||!k){E();return}for(const C of D){if(a?.(C)===!1)continue;const M=m.indexOf(C),T=y[M];if(!T)continue;const{direction:H,speed:K}=C_(C,T,k,t,x);for(const F of["x","y"])w[F][H[F]]||(K[F]=0,H[F]=0);if(K.x>0||K.y>0){E(),O.current=C,_(U,d),j.current=K,N.current=H;return}}j.current={x:0,y:0},N.current={x:0,y:0},E()},[t,U,a,E,u,d,JSON.stringify(k),JSON.stringify(w),_,m,D,y,JSON.stringify(x)])}const U_={x:{[Hn.Backward]:!1,[Hn.Forward]:!1},y:{[Hn.Backward]:!1,[Hn.Forward]:!1}};function L_(n){let{delta:t,disabled:s}=n;const a=Nu(t);return $o(o=>{if(s||!a||!o)return U_;const u={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[Hn.Backward]:o.x[Hn.Backward]||u.x===-1,[Hn.Forward]:o.x[Hn.Forward]||u.x===1},y:{[Hn.Backward]:o.y[Hn.Backward]||u.y===-1,[Hn.Forward]:o.y[Hn.Forward]||u.y===1}}},[s,t,a])}function I_(n,t){const s=t!=null?n.get(t):void 0,a=s?s.node.current:null;return $o(o=>{var u;return t==null?null:(u=a??o)!=null?u:null},[a,t])}function B_(n,t){return b.useMemo(()=>n.reduce((s,a)=>{const{sensor:o}=a,u=o.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,a)}));return[...s,...u]},[]),[n,t])}var Co;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Co||(Co={}));var Vf;(function(n){n.Optimized="optimized"})(Vf||(Vf={}));const jv=new Map;function $_(n,t){let{dragging:s,dependencies:a,config:o}=t;const[u,d]=b.useState(null),{frequency:h,measure:f,strategy:m}=o,y=b.useRef(n),v=j(),x=jo(v),w=b.useCallback(function(N){N===void 0&&(N=[]),!x.current&&d(k=>k===null?N:k.concat(N.filter(O=>!k.includes(O))))},[x]),_=b.useRef(null),E=$o(N=>{if(v&&!s)return jv;if(!N||N===jv||y.current!==n||u!=null){const k=new Map;for(let O of n){if(!O)continue;if(u&&u.length>0&&!u.includes(O.id)&&O.rect.current){k.set(O.id,O.rect.current);continue}const U=O.node.current,D=U?new yp(f(U),U):null;O.rect.current=D,D&&k.set(O.id,D)}return k}return N},[n,u,s,v,f]);return b.useEffect(()=>{y.current=n},[n]),b.useEffect(()=>{v||w()},[s,v]),b.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),b.useEffect(()=>{v||typeof h!="number"||_.current!==null||(_.current=setTimeout(()=>{w(),_.current=null},h))},[h,v,w,...a]),{droppableRects:E,measureDroppableContainers:w,measuringScheduled:u!=null};function j(){switch(m){case Co.Always:return!1;case Co.BeforeDragging:return s;default:return!s}}}function xp(n,t){return $o(s=>n?s||(typeof t=="function"?t(n):n):null,[t,n])}function P_(n,t){return xp(n,t)}function q_(n){let{callback:t,disabled:s}=n;const a=Pu(t),o=b.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(a)},[a,s]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function Gu(n){let{callback:t,disabled:s}=n;const a=Pu(t),o=b.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(a)},[s]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function F_(n){return new yp(ol(n),n)}function _v(n,t,s){t===void 0&&(t=F_);const[a,o]=b.useState(null);function u(){o(f=>{if(!n)return null;if(n.isConnected===!1){var m;return(m=f??s)!=null?m:null}const y=t(n);return JSON.stringify(f)===JSON.stringify(y)?f:y})}const d=q_({callback(f){if(n)for(const m of f){const{type:y,target:v}=m;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),h=Gu({callback:u});return Xr(()=>{u(),n?(h?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(h?.disconnect(),d?.disconnect())},[n]),a}function H_(n){const t=xp(n);return p0(n,t)}const Cv=[];function G_(n){const t=b.useRef(n),s=$o(a=>n?a&&a!==Cv&&n&&t.current&&n.parentNode===t.current.parentNode?a:Fu(n):Cv,[n]);return b.useEffect(()=>{t.current=n},[n]),s}function V_(n){const[t,s]=b.useState(null),a=b.useRef(n),o=b.useCallback(u=>{const d=lf(u.target);d&&s(h=>h?(h.set(d,Hf(d)),new Map(h)):null)},[]);return b.useEffect(()=>{const u=a.current;if(n!==u){d(u);const h=n.map(f=>{const m=lf(f);return m?(m.addEventListener("scroll",o,{passive:!0}),[m,Hf(m)]):null}).filter(f=>f!=null);s(h.length?new Map(h):null),a.current=n}return()=>{d(n),d(u)};function d(h){h.forEach(f=>{const m=lf(f);m?.removeEventListener("scroll",o)})}},[o,n]),b.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>Za(u,d),Zr):w0(n):Zr,[n,t])}function Ev(n,t){t===void 0&&(t=[]);const s=b.useRef(null);return b.useEffect(()=>{s.current=null},t),b.useEffect(()=>{const a=n!==Zr;a&&!s.current&&(s.current=n),!a&&s.current&&(s.current=null)},[n]),s.current?_o(n,s.current):Zr}function K_(n){b.useEffect(()=>{if(!$u)return;const t=n.map(s=>{let{sensor:a}=s;return a.setup==null?void 0:a.setup()});return()=>{for(const s of t)s?.()}},n.map(t=>{let{sensor:s}=t;return s}))}function Y_(n,t){return b.useMemo(()=>n.reduce((s,a)=>{let{eventName:o,handler:u}=a;return s[o]=d=>{u(d,t)},s},{}),[n,t])}function _0(n){return b.useMemo(()=>n?w_(n):null,[n])}const Nv=[];function Q_(n,t){t===void 0&&(t=ol);const[s]=n,a=_0(s?or(s):null),[o,u]=b.useState(Nv);function d(){u(()=>n.length?n.map(f=>x0(f)?a:new yp(t(f),f)):Nv)}const h=Gu({callback:d});return Xr(()=>{h?.disconnect(),d(),n.forEach(f=>h?.observe(f))},[n]),o}function C0(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return Bo(t)?t:n}function W_(n){let{measure:t}=n;const[s,a]=b.useState(null),o=b.useCallback(m=>{for(const{target:y}of m)if(Bo(y)){a(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=Gu({callback:o}),d=b.useCallback(m=>{const y=C0(m);u?.disconnect(),y&&u?.observe(y),a(y?t(y):null)},[t,u]),[h,f]=Eu(d);return b.useMemo(()=>({nodeRef:h,rect:s,setRef:f}),[s,h,f])}const J_=[{sensor:Hu,options:{}},{sensor:cl,options:{}}],X_={current:{}},bu={draggable:{measure:xv},droppable:{measure:xv,strategy:Co.WhileDragging,frequency:Vf.Optimized},dragOverlay:{measure:ol}};class xo extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,a;return(s=(a=this.get(t))==null?void 0:a.node.current)!=null?s:void 0}}const Z_={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new xo,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Tu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:bu,measureDroppableContainers:Tu,windowRect:null,measuringScheduled:!1},E0={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Tu,draggableNodes:new Map,over:null,measureDroppableContainers:Tu},Ho=b.createContext(E0),N0=b.createContext(Z_);function e1(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new xo}}}function t1(n,t){switch(t.type){case $n.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case $n.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case $n.DragEnd:case $n.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $n.RegisterDroppable:{const{element:s}=t,{id:a}=s,o=new xo(n.droppable.containers);return o.set(a,s),{...n,droppable:{...n.droppable,containers:o}}}case $n.SetDroppableDisabled:{const{id:s,key:a,disabled:o}=t,u=n.droppable.containers.get(s);if(!u||a!==u.key)return n;const d=new xo(n.droppable.containers);return d.set(s,{...u,disabled:o}),{...n,droppable:{...n.droppable,containers:d}}}case $n.UnregisterDroppable:{const{id:s,key:a}=t,o=n.droppable.containers.get(s);if(!o||a!==o.key)return n;const u=new xo(n.droppable.containers);return u.delete(s),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function n1(n){let{disabled:t}=n;const{active:s,activatorEvent:a,draggableNodes:o}=b.useContext(Ho),u=Nu(a),d=Nu(s?.id);return b.useEffect(()=>{if(!t&&!a&&u&&d!=null){if(!qu(u)||document.activeElement===u.target)return;const h=o.get(d);if(!h)return;const{activatorNode:f,node:m}=h;if(!f.current&&!m.current)return;requestAnimationFrame(()=>{for(const y of[f.current,m.current]){if(!y)continue;const v=e_(y);if(v){v.focus();break}}})}},[a,t,o,d,u]),null}function k0(n,t){let{transform:s,...a}=t;return n!=null&&n.length?n.reduce((o,u)=>u({transform:o,...a}),s):s}function r1(n){return b.useMemo(()=>({draggable:{...bu.draggable,...n?.draggable},droppable:{...bu.droppable,...n?.droppable},dragOverlay:{...bu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function s1(n){let{activeNode:t,measure:s,initialRect:a,config:o=!0}=n;const u=b.useRef(!1),{x:d,y:h}=typeof o=="boolean"?{x:o,y:o}:o;Xr(()=>{if(!d&&!h||!t){u.current=!1;return}if(u.current||!a)return;const m=t?.node.current;if(!m||m.isConnected===!1)return;const y=s(m),v=p0(y,a);if(d||(v.x=0),h||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=g0(m);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,h,a,s])}const Vu=b.createContext({...Zr,scaleX:1,scaleY:1});var mi;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(mi||(mi={}));const Xi=b.memo(function(t){var s,a,o,u;let{id:d,accessibility:h,autoScroll:f=!0,children:m,sensors:y=J_,collisionDetection:v=p_,measuring:x,modifiers:w,..._}=t;const E=b.useReducer(t1,void 0,e1),[j,N]=E,[k,O]=a_(),[U,D]=b.useState(mi.Uninitialized),C=U===mi.Initialized,{draggable:{active:M,nodes:T,translate:H},droppable:{containers:K}}=j,F=M!=null?T.get(M):null,q=b.useRef({initial:null,translated:null}),V=b.useMemo(()=>{var et;return M!=null?{id:M,data:(et=F?.data)!=null?et:X_,rect:q}:null},[M,F]),P=b.useRef(null),[L,A]=b.useState(null),[$,Y]=b.useState(null),le=jo(_,Object.values(_)),me=Po("DndDescribedBy",d),B=b.useMemo(()=>K.getEnabled(),[K]),W=r1(x),{droppableRects:J,measureDroppableContainers:ge,measuringScheduled:ze}=$_(B,{dragging:C,dependencies:[H.x,H.y],config:W.droppable}),Re=I_(T,M),he=b.useMemo(()=>$?ku($):null,[$]),I=Ve(),te=P_(Re,W.draggable.measure);s1({activeNode:M!=null?T.get(M):null,config:I.layoutShiftCompensation,initialRect:te,measure:W.draggable.measure});const ye=_v(Re,W.draggable.measure,te),Ne=_v(Re?Re.parentElement:null),Oe=b.useRef({activatorEvent:null,active:null,activeNode:Re,collisionRect:null,collisions:null,droppableRects:J,draggableNodes:T,draggingNode:null,draggingNodeRect:null,droppableContainers:K,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),qe=K.getNodeFor((s=Oe.current.over)==null?void 0:s.id),$e=W_({measure:W.dragOverlay.measure}),Je=(a=$e.nodeRef.current)!=null?a:Re,pe=C?(o=$e.rect)!=null?o:ye:null,Xe=!!($e.nodeRef.current&&$e.rect),ot=H_(Xe?null:ye),jt=_0(Je?or(Je):null),ke=G_(C?qe??Re:null),Ae=Q_(ke),it=k0(w,{transform:{x:H.x-ot.x,y:H.y-ot.y,scaleX:1,scaleY:1},activatorEvent:$,active:V,activeNodeRect:ye,containerNodeRect:Ne,draggingNodeRect:pe,over:Oe.current.over,overlayNodeRect:$e.rect,scrollableAncestors:ke,scrollableAncestorRects:Ae,windowRect:jt}),Mt=he?Za(he,H):null,yt=V_(ke),ie=Ev(yt),_e=Ev(yt,[ye]),Ee=Za(it,ie),Ie=pe?v_(pe,it):null,ct=V&&Ie?v({active:V,collisionRect:Ie,droppableRects:J,droppableContainers:B,pointerCoordinates:Mt}):null,pt=h0(ct,"id"),[Rt,Jt]=b.useState(null),Sn=Xe?it:Za(it,_e),_t=g_(Sn,(u=Rt?.rect)!=null?u:null,ye),rn=b.useRef(null),cn=b.useCallback((et,Ke)=>{let{sensor:nt,options:zt}=Ke;if(P.current==null)return;const bt=T.get(P.current);if(!bt)return;const At=et.nativeEvent,tt=new nt({active:P.current,activeNode:bt,event:At,options:zt,context:Oe,onAbort(Qe){if(!T.get(Qe))return;const{onDragAbort:Xt}=le.current,Qt={id:Qe};Xt?.(Qt),k({type:"onDragAbort",event:Qt})},onPending(Qe,Lt,Xt,Qt){if(!T.get(Qe))return;const{onDragPending:ee}=le.current,ue={id:Qe,constraint:Lt,initialCoordinates:Xt,offset:Qt};ee?.(ue),k({type:"onDragPending",event:ue})},onStart(Qe){const Lt=P.current;if(Lt==null)return;const Xt=T.get(Lt);if(!Xt)return;const{onDragStart:Qt}=le.current,ne={activatorEvent:At,active:{id:Lt,data:Xt.data,rect:q}};Ki.unstable_batchedUpdates(()=>{Qt?.(ne),D(mi.Initializing),N({type:$n.DragStart,initialCoordinates:Qe,active:Lt}),k({type:"onDragStart",event:ne}),A(rn.current),Y(At)})},onMove(Qe){N({type:$n.DragMove,coordinates:Qe})},onEnd:$t($n.DragEnd),onCancel:$t($n.DragCancel)});rn.current=tt;function $t(Qe){return async function(){const{active:Xt,collisions:Qt,over:ne,scrollAdjustedTranslate:ee}=Oe.current;let ue=null;if(Xt&&ee){const{cancelDrop:je}=le.current;ue={activatorEvent:At,active:Xt,collisions:Qt,delta:ee,over:ne},Qe===$n.DragEnd&&typeof je=="function"&&await Promise.resolve(je(ue))&&(Qe=$n.DragCancel)}P.current=null,Ki.unstable_batchedUpdates(()=>{N({type:Qe}),D(mi.Uninitialized),Jt(null),A(null),Y(null),rn.current=null;const je=Qe===$n.DragEnd?"onDragEnd":"onDragCancel";if(ue){const Be=le.current[je];Be?.(ue),k({type:je,event:ue})}})}}},[T]),xn=b.useCallback((et,Ke)=>(nt,zt)=>{const bt=nt.nativeEvent,At=T.get(zt);if(P.current!==null||!At||bt.dndKit||bt.defaultPrevented)return;const tt={active:At};et(nt,Ke.options,tt)===!0&&(bt.dndKit={capturedBy:Ke.sensor},P.current=zt,cn(nt,Ke))},[T,cn]),Ln=B_(y,xn);K_(y),Xr(()=>{ye&&U===mi.Initializing&&D(mi.Initialized)},[ye,U]),b.useEffect(()=>{const{onDragMove:et}=le.current,{active:Ke,activatorEvent:nt,collisions:zt,over:bt}=Oe.current;if(!Ke||!nt)return;const At={active:Ke,activatorEvent:nt,collisions:zt,delta:{x:Ee.x,y:Ee.y},over:bt};Ki.unstable_batchedUpdates(()=>{et?.(At),k({type:"onDragMove",event:At})})},[Ee.x,Ee.y]),b.useEffect(()=>{const{active:et,activatorEvent:Ke,collisions:nt,droppableContainers:zt,scrollAdjustedTranslate:bt}=Oe.current;if(!et||P.current==null||!Ke||!bt)return;const{onDragOver:At}=le.current,tt=zt.get(pt),$t=tt&&tt.rect.current?{id:tt.id,rect:tt.rect.current,data:tt.data,disabled:tt.disabled}:null,Qe={active:et,activatorEvent:Ke,collisions:nt,delta:{x:bt.x,y:bt.y},over:$t};Ki.unstable_batchedUpdates(()=>{Jt($t),At?.(Qe),k({type:"onDragOver",event:Qe})})},[pt]),Xr(()=>{Oe.current={activatorEvent:$,active:V,activeNode:Re,collisionRect:Ie,collisions:ct,droppableRects:J,draggableNodes:T,draggingNode:Je,draggingNodeRect:pe,droppableContainers:K,over:Rt,scrollableAncestors:ke,scrollAdjustedTranslate:Ee},q.current={initial:pe,translated:Ie}},[V,Re,ct,Ie,T,Je,pe,J,K,Rt,ke,Ee]),z_({...I,delta:H,draggingRect:Ie,pointerCoordinates:Mt,scrollableAncestors:ke,scrollableAncestorRects:Ae});const ar=b.useMemo(()=>({active:V,activeNode:Re,activeNodeRect:ye,activatorEvent:$,collisions:ct,containerNodeRect:Ne,dragOverlay:$e,draggableNodes:T,droppableContainers:K,droppableRects:J,over:Rt,measureDroppableContainers:ge,scrollableAncestors:ke,scrollableAncestorRects:Ae,measuringConfiguration:W,measuringScheduled:ze,windowRect:jt}),[V,Re,ye,$,ct,Ne,$e,T,K,J,Rt,ge,ke,Ae,W,ze,jt]),fe=b.useMemo(()=>({activatorEvent:$,activators:Ln,active:V,activeNodeRect:ye,ariaDescribedById:{draggable:me},dispatch:N,draggableNodes:T,over:Rt,measureDroppableContainers:ge}),[$,Ln,V,ye,N,me,T,Rt,ge]);return be.createElement(d0.Provider,{value:O},be.createElement(Ho.Provider,{value:fe},be.createElement(N0.Provider,{value:ar},be.createElement(Vu.Provider,{value:_t},m)),be.createElement(n1,{disabled:h?.restoreFocus===!1})),be.createElement(c_,{...h,hiddenTextDescribedById:me}));function Ve(){const et=L?.autoScrollEnabled===!1,Ke=typeof f=="object"?f.enabled===!1:f===!1,nt=C&&!et&&!Ke;return typeof f=="object"?{...f,enabled:nt}:{enabled:nt}}}),i1=b.createContext(null),kv="button",a1="Draggable";function bp(n){let{id:t,data:s,disabled:a=!1,attributes:o}=n;const u=Po(a1),{activators:d,activatorEvent:h,active:f,activeNodeRect:m,ariaDescribedById:y,draggableNodes:v,over:x}=b.useContext(Ho),{role:w=kv,roleDescription:_="draggable",tabIndex:E=0}=o??{},j=f?.id===t,N=b.useContext(j?Vu:i1),[k,O]=Eu(),[U,D]=Eu(),C=Y_(d,t),M=jo(s);Xr(()=>(v.set(t,{id:t,key:u,node:k,activatorNode:U,data:M}),()=>{const H=v.get(t);H&&H.key===u&&v.delete(t)}),[v,t]);const T=b.useMemo(()=>({role:w,tabIndex:E,"aria-disabled":a,"aria-pressed":j&&w===kv?!0:void 0,"aria-roledescription":_,"aria-describedby":y.draggable}),[a,w,E,j,_,y.draggable]);return{active:f,activatorEvent:h,activeNodeRect:m,attributes:T,isDragging:j,listeners:a?void 0:C,node:k,over:x,setNodeRef:O,setActivatorNodeRef:D,transform:N}}function T0(){return b.useContext(N0)}const l1="Droppable",o1={timeout:25};function Go(n){let{data:t,disabled:s=!1,id:a,resizeObserverConfig:o}=n;const u=Po(l1),{active:d,dispatch:h,over:f,measureDroppableContainers:m}=b.useContext(Ho),y=b.useRef({disabled:s}),v=b.useRef(!1),x=b.useRef(null),w=b.useRef(null),{disabled:_,updateMeasurementsFor:E,timeout:j}={...o1,...o},N=jo(E??a),k=b.useCallback(()=>{if(!v.current){v.current=!0;return}w.current!=null&&clearTimeout(w.current),w.current=setTimeout(()=>{m(Array.isArray(N.current)?N.current:[N.current]),w.current=null},j)},[j]),O=Gu({callback:k,disabled:_||!d}),U=b.useCallback((T,H)=>{O&&(H&&(O.unobserve(H),v.current=!1),T&&O.observe(T))},[O]),[D,C]=Eu(U),M=jo(t);return b.useEffect(()=>{!O||!D.current||(O.disconnect(),v.current=!1,O.observe(D.current))},[D,O]),b.useEffect(()=>(h({type:$n.RegisterDroppable,element:{id:a,key:u,disabled:s,node:D,rect:x,data:M}}),()=>h({type:$n.UnregisterDroppable,key:u,id:a})),[a]),b.useEffect(()=>{s!==y.current.disabled&&(h({type:$n.SetDroppableDisabled,id:a,key:u,disabled:s}),y.current.disabled=s)},[a,u,s,h]),{active:d,rect:x,isOver:f?.id===a,node:D,over:f,setNodeRef:C}}function c1(n){let{animation:t,children:s}=n;const[a,o]=b.useState(null),[u,d]=b.useState(null),h=Nu(s);return!s&&!a&&h&&o(h),Xr(()=>{if(!u)return;const f=a?.key,m=a?.props.id;if(f==null||m==null){o(null);return}Promise.resolve(t(m,u)).then(()=>{o(null)})},[t,a,u]),be.createElement(be.Fragment,null,s,a?b.cloneElement(a,{ref:d}):null)}const u1={x:0,y:0,scaleX:1,scaleY:1};function d1(n){let{children:t}=n;return be.createElement(Ho.Provider,{value:E0},be.createElement(Vu.Provider,{value:u1},t))}const h1={position:"fixed",touchAction:"none"},f1=n=>qu(n)?"transform 250ms ease":void 0,p1=b.forwardRef((n,t)=>{let{as:s,activatorEvent:a,adjustScale:o,children:u,className:d,rect:h,style:f,transform:m,transition:y=f1}=n;if(!h)return null;const v=o?m:{...m,scaleX:1,scaleY:1},x={...h1,width:h.width,height:h.height,top:h.top,left:h.left,transform:kr.Transform.toString(v),transformOrigin:o&&a?u_(a,h):void 0,transition:typeof y=="function"?y(a):y,...f};return be.createElement(s,{className:d,style:x,ref:t},u)}),wp=n=>t=>{let{active:s,dragOverlay:a}=t;const o={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[h,f]of Object.entries(u.active))f!==void 0&&(o[h]=s.node.style.getPropertyValue(h),s.node.style.setProperty(h,f));if(u!=null&&u.dragOverlay)for(const[h,f]of Object.entries(u.dragOverlay))f!==void 0&&a.node.style.setProperty(h,f);return d!=null&&d.active&&s.node.classList.add(d.active),d!=null&&d.dragOverlay&&a.node.classList.add(d.dragOverlay),function(){for(const[f,m]of Object.entries(o))s.node.style.setProperty(f,m);d!=null&&d.active&&s.node.classList.remove(d.active)}},m1=n=>{let{transform:{initial:t,final:s}}=n;return[{transform:kr.Transform.toString(t)},{transform:kr.Transform.toString(s)}]},g1={duration:250,easing:"ease",keyframes:m1,sideEffects:wp({styles:{active:{opacity:"0"}}})};function y1(n){let{config:t,draggableNodes:s,droppableContainers:a,measuringConfiguration:o}=n;return Pu((u,d)=>{if(t===null)return;const h=s.get(u);if(!h)return;const f=h.node.current;if(!f)return;const m=C0(d);if(!m)return;const{transform:y}=or(d).getComputedStyle(d),v=m0(y);if(!v)return;const x=typeof t=="function"?t:v1(t);return S0(f,o.draggable.measure),x({active:{id:u,data:h.data,node:f,rect:o.draggable.measure(f)},draggableNodes:s,dragOverlay:{node:d,rect:o.dragOverlay.measure(m)},droppableContainers:a,measuringConfiguration:o,transform:v})})}function v1(n){const{duration:t,easing:s,sideEffects:a,keyframes:o}={...g1,...n};return u=>{let{active:d,dragOverlay:h,transform:f,...m}=u;if(!t)return;const y={x:h.rect.left-d.rect.left,y:h.rect.top-d.rect.top},v={scaleX:f.scaleX!==1?d.rect.width*f.scaleX/h.rect.width:1,scaleY:f.scaleY!==1?d.rect.height*f.scaleY/h.rect.height:1},x={x:f.x-y.x,y:f.y-y.y,...v},w=o({...m,active:d,dragOverlay:h,transform:{initial:f,final:x}}),[_]=w,E=w[w.length-1];if(JSON.stringify(_)===JSON.stringify(E))return;const j=a?.({active:d,dragOverlay:h,...m}),N=h.node.animate(w,{duration:t,easing:s,fill:"forwards"});return new Promise(k=>{N.onfinish=()=>{j?.(),k()}})}}let Tv=0;function x1(n){return b.useMemo(()=>{if(n!=null)return Tv++,Tv},[n])}const R0=be.memo(n=>{let{adjustScale:t=!1,children:s,dropAnimation:a,style:o,transition:u,modifiers:d,wrapperElement:h="div",className:f,zIndex:m=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:w,draggableNodes:_,droppableContainers:E,dragOverlay:j,over:N,measuringConfiguration:k,scrollableAncestors:O,scrollableAncestorRects:U,windowRect:D}=T0(),C=b.useContext(Vu),M=x1(v?.id),T=k0(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:w,draggingNodeRect:j.rect,over:N,overlayNodeRect:j.rect,scrollableAncestors:O,scrollableAncestorRects:U,transform:C,windowRect:D}),H=xp(x),K=y1({config:a,draggableNodes:_,droppableContainers:E,measuringConfiguration:k}),F=H?j.setRef:void 0;return be.createElement(d1,null,be.createElement(c1,{animation:K},v&&M?be.createElement(p1,{key:M,id:v.id,ref:F,as:h,activatorEvent:y,adjustScale:t,className:f,transition:u,rect:H,style:{zIndex:m,...o},transform:T},s):null))});function Zi(n,t,s){const a=n.slice();return a.splice(s<0?a.length+s:s,0,a.splice(t,1)[0]),a}function b1(n,t){return n.reduce((s,a,o)=>{const u=t.get(a);return u&&(s[o]=u),s},Array(n.length))}function su(n){return n!==null&&n>=0}function w1(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==t[s])return!1;return!0}function S1(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const Sp=n=>{let{rects:t,activeIndex:s,overIndex:a,index:o}=n;const u=Zi(t,a,s),d=t[o],h=u[o];return!h||!d?null:{x:h.left-d.left,y:h.top-d.top,scaleX:h.width/d.width,scaleY:h.height/d.height}},iu={scaleX:1,scaleY:1},Eo=n=>{var t;let{activeIndex:s,activeNodeRect:a,index:o,rects:u,overIndex:d}=n;const h=(t=u[s])!=null?t:a;if(!h)return null;if(o===s){const m=u[d];return m?{x:0,y:s<d?m.top+m.height-(h.top+h.height):m.top-h.top,...iu}:null}const f=j1(u,o,s);return o>s&&o<=d?{x:0,y:-h.height-f,...iu}:o<s&&o>=d?{x:0,y:h.height+f,...iu}:{x:0,y:0,...iu}};function j1(n,t,s){const a=n[t],o=n[t-1],u=n[t+1];return a?s<t?o?a.top-(o.top+o.height):u?u.top-(a.top+a.height):0:u?u.top-(a.top+a.height):o?a.top-(o.top+o.height):0:0}const A0="Sortable",O0=be.createContext({activeIndex:-1,containerId:A0,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Sp,disabled:{draggable:!1,droppable:!1}});function tl(n){let{children:t,id:s,items:a,strategy:o=Sp,disabled:u=!1}=n;const{active:d,dragOverlay:h,droppableRects:f,over:m,measureDroppableContainers:y}=T0(),v=Po(A0,s),x=h.rect!==null,w=b.useMemo(()=>a.map(C=>typeof C=="object"&&"id"in C?C.id:C),[a]),_=d!=null,E=d?w.indexOf(d.id):-1,j=m?w.indexOf(m.id):-1,N=b.useRef(w),k=!w1(w,N.current),O=j!==-1&&E===-1||k,U=S1(u);Xr(()=>{k&&_&&y(w)},[k,w,_,y]),b.useEffect(()=>{N.current=w},[w]);const D=b.useMemo(()=>({activeIndex:E,containerId:v,disabled:U,disableTransforms:O,items:w,overIndex:j,useDragOverlay:x,sortedRects:b1(w,f),strategy:o}),[E,v,U.draggable,U.droppable,O,w,j,f,x,o]);return be.createElement(O0.Provider,{value:D},t)}const _1=n=>{let{id:t,items:s,activeIndex:a,overIndex:o}=n;return Zi(s,a,o).indexOf(t)},C1=n=>{let{containerId:t,isSorting:s,wasDragging:a,index:o,items:u,newIndex:d,previousItems:h,previousContainerId:f,transition:m}=n;return!m||!a||h!==u&&o===d?!1:s?!0:d!==o&&t===f},E1={duration:200,easing:"ease"},D0="transform",N1=kr.Transition.toString({property:D0,duration:0,easing:"linear"}),k1={roleDescription:"sortable"};function T1(n){let{disabled:t,index:s,node:a,rect:o}=n;const[u,d]=b.useState(null),h=b.useRef(s);return Xr(()=>{if(!t&&s!==h.current&&a.current){const f=o.current;if(f){const m=ol(a.current,{ignoreTransform:!0}),y={x:f.left-m.left,y:f.top-m.top,scaleX:f.width/m.width,scaleY:f.height/m.height};(y.x||y.y)&&d(y)}}s!==h.current&&(h.current=s)},[t,s,a,o]),b.useEffect(()=>{u&&d(null)},[u]),u}function ul(n){let{animateLayoutChanges:t=C1,attributes:s,disabled:a,data:o,getNewIndex:u=_1,id:d,strategy:h,resizeObserverConfig:f,transition:m=E1}=n;const{items:y,containerId:v,activeIndex:x,disabled:w,disableTransforms:_,sortedRects:E,overIndex:j,useDragOverlay:N,strategy:k}=b.useContext(O0),O=R1(a,w),U=y.indexOf(d),D=b.useMemo(()=>({sortable:{containerId:v,index:U,items:y},...o}),[v,o,U,y]),C=b.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:M,node:T,isOver:H,setNodeRef:K}=Go({id:d,data:D,disabled:O.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...f}}),{active:F,activatorEvent:q,activeNodeRect:V,attributes:P,setNodeRef:L,listeners:A,isDragging:$,over:Y,setActivatorNodeRef:le,transform:me}=bp({id:d,data:D,attributes:{...k1,...s},disabled:O.draggable}),B=Wj(K,L),W=!!F,J=W&&!_&&su(x)&&su(j),ge=!N&&$,ze=ge&&J?me:null,he=J?ze??(h??k)({rects:E,activeNodeRect:V,activeIndex:x,overIndex:j,index:U}):null,I=su(x)&&su(j)?u({id:d,items:y,activeIndex:x,overIndex:j}):U,te=F?.id,ye=b.useRef({activeId:te,items:y,newIndex:I,containerId:v}),Ne=y!==ye.current.items,Oe=t({active:F,containerId:v,isDragging:$,isSorting:W,id:d,index:U,items:y,newIndex:ye.current.newIndex,previousItems:ye.current.items,previousContainerId:ye.current.containerId,transition:m,wasDragging:ye.current.activeId!=null}),qe=T1({disabled:!Oe,index:U,node:T,rect:M});return b.useEffect(()=>{W&&ye.current.newIndex!==I&&(ye.current.newIndex=I),v!==ye.current.containerId&&(ye.current.containerId=v),y!==ye.current.items&&(ye.current.items=y)},[W,I,v,y]),b.useEffect(()=>{if(te===ye.current.activeId)return;if(te!=null&&ye.current.activeId==null){ye.current.activeId=te;return}const Je=setTimeout(()=>{ye.current.activeId=te},50);return()=>clearTimeout(Je)},[te]),{active:F,activeIndex:x,attributes:P,data:D,rect:M,index:U,newIndex:I,items:y,isOver:H,isSorting:W,isDragging:$,listeners:A,node:T,overIndex:j,over:Y,setNodeRef:B,setActivatorNodeRef:le,setDroppableNodeRef:K,setDraggableNodeRef:L,transform:qe??he,transition:$e()};function $e(){if(qe||Ne&&ye.current.newIndex===U)return N1;if(!(ge&&!qu(q)||!m)&&(W||Oe))return kr.Transition.toString({...m,property:D0})}}function R1(n,t){var s,a;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(s=n?.draggable)!=null?s:t.draggable,droppable:(a=n?.droppable)!=null?a:t.droppable}}function Au(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const A1=[Vt.Down,Vt.Right,Vt.Up,Vt.Left],Ku=(n,t)=>{let{context:{active:s,collisionRect:a,droppableRects:o,droppableContainers:u,over:d,scrollableAncestors:h}}=t;if(A1.includes(n.code)){if(n.preventDefault(),!s||!a)return;const f=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=o.get(v.id);if(x)switch(n.code){case Vt.Down:a.top<x.top&&f.push(v);break;case Vt.Up:a.top>x.top&&f.push(v);break;case Vt.Left:a.left>x.left&&f.push(v);break;case Vt.Right:a.left<x.left&&f.push(v);break}});const m=h_({collisionRect:a,droppableRects:o,droppableContainers:f});let y=h0(m,"id");if(y===d?.id&&m.length>1&&(y=m[1].id),y!=null){const v=u.get(s.id),x=u.get(y),w=x?o.get(x.id):null,_=x?.node.current;if(_&&w&&v&&x){const j=Fu(_).some((C,M)=>h[M]!==C),N=M0(v,x),k=O1(v,x),O=j||!N?{x:0,y:0}:{x:k?a.width-w.width:0,y:k?a.height-w.height:0},U={x:w.left,y:w.top};return O.x&&O.y?U:_o(U,O)}}}};function M0(n,t){return!Au(n)||!Au(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function O1(n,t){return!Au(n)||!Au(t)||!M0(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const Rv=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},xi=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],D1=({recipe:n,isSelected:t,isSelectMode:s,onSelectRecipe:a,onToggleSelection:o,disableDrag:u,showOwner:d,ownerLabelFn:h})=>{const{attributes:f,listeners:m,setNodeRef:y,transform:v,transition:x,isDragging:w}=ul({id:n.id,disabled:u}),_={transform:kr.Transform.toString(v),transition:x,opacity:w?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"};return i.jsx("div",{ref:y,style:_,...f,...m,children:i.jsxs(tn,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some(E=>/|Dessert/i.test(E))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{s?o(n.id):a(n)},children:[i.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?i.jsx("img",{src:n.image,alt:n.title,className:"recipe-card__image",loading:"lazy",decoding:"async"}):i.jsx("div",{className:"recipe-card__image placeholder"}),i.jsx("div",{className:"recipe-card__overlay"}),s&&i.jsx("div",{className:"recipe-card__selection-overlay",children:i.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),i.jsx("div",{className:"recipe-card__tags",children:(()=>{const E=xi(n.tags);if(E.length===0)return null;const j=E.filter(O=>!O.startsWith("owner:"));return(j.includes("URL")?["URL"]:j).slice(0,1).map((O,U)=>i.jsx("span",{className:"recipe-tag",children:O},`${O}-${U}`))})()})]}),i.jsxs("div",{className:"recipe-card__content",children:[i.jsx("h3",{className:"recipe-title",children:n.title}),i.jsx("p",{className:"recipe-desc",children:n.description}),i.jsxs("div",{className:"recipe-meta",children:[n.storeName&&i.jsxs("span",{children:[" ",n.storeName]}),d&&typeof h=="function"&&i.jsxs("span",{className:"recipe-owner",children:[" ",h(n)]}),i.jsxs("div",{className:"recipe-dates",children:[i.jsxs("span",{className:"recipe-date",children:[" : ",Rv(n.created_at)]}),n.updated_at&&i.jsxs("span",{className:"recipe-date",children:[" : ",Rv(n.updated_at)]})]})]})]})]})})},Av=n=>{const t=xi(n.tags);return n.type==="bread"||t.some(s=>/|Bread/i.test(s))},Ov=n=>{const t=a=>/|Dessert/i.test(a),s=xi(n.tags);return/|Dessert/i.test(n.category||"")||s.some(t)},Dv=n=>{const t=xi(n.tags);return/|Sauce/i.test(n.category||"")||t.some(s=>/|Sauce/i.test(s))},Mv=n=>{const t=xi(n.tags);return/||Decor/i.test(n.category||"")||t.some(s=>/||Decor/i.test(s))},zv=n=>{const t=n.category||"",s=xi(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||s.some(a=>/|Dressing||Vinaigrette||Mayonnaise/i.test(a))},Uv=n=>{const t=n.filter(v=>Av(v)),s=n.filter(v=>!Av(v)),a=s.filter(v=>Dv(v)),o=s.filter(v=>!Dv(v)),u=o.filter(v=>Mv(v)),d=o.filter(v=>!Mv(v)),h=d.filter(v=>zv(v)),f=d.filter(v=>!zv(v)),m=f.filter(v=>Ov(v));return{cookingRecipes:f.filter(v=>!Ov(v)),breadRecipes:t,dessertRecipes:m,sauceRecipes:a,dressingRecipes:h,decorationRecipes:u}},Lv=({recipes:n,onSelectRecipe:t,isSelectMode:s,selectedIds:a,onToggleSelection:o,disableDrag:u,displayMode:d="normal",publicRecipeView:h="none",showOwner:f=!1,ownerLabelFn:m,currentUser:y=null})=>{const[v,x]=b.useState({}),w=L=>{x(A=>({...A,[L]:!A[L]}))},_=L=>xi(L?.tags).map($=>$.toLowerCase()).includes("public"),E=L=>{if(!y)return!1;const A=xi(L?.tags).filter(Y=>Y.startsWith("owner:"));if(A.length===0)return!1;const $=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return A.some(Y=>$.has(Y))},j=n.filter(L=>_(L)),N=j.filter(L=>E(L)),k=j.filter(L=>!E(L)),O=n.filter(L=>!_(L)),{cookingRecipes:U,breadRecipes:D,dessertRecipes:C,sauceRecipes:M,dressingRecipes:T,decorationRecipes:H}=Uv(O),[K,F]=b.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);be.useEffect(()=>{const L=()=>{window.innerWidth>=1024?F(9):F(8)};return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[]);const q=(L,A,$,Y,{showWhenEmpty:le=!1,emptyMessage:me=""}={})=>{if(A.length===0&&!le)return null;const B=d==="all";let W=A,J=!1,ge=!1;return B||(J=v[Y],ge=A.length>K,W=J?A:A.slice(0,K)),i.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{onClick:()=>!B&&ge&&w(Y),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!B&&ge?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[i.jsx("span",{children:$})," ",L,i.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",A.length,")"]}),!B&&ge&&i.jsx("span",{className:"section-toggle-btn",children:J?" ":" "})]}),i.jsx("div",{className:"recipe-grid",children:i.jsx(tl,{items:W.map(ze=>ze.id),strategy:Sp,children:W.map(ze=>{const Re=a&&a.has(ze.id);return i.jsx(D1,{recipe:ze,isSelected:Re,isSelectMode:s,onSelectRecipe:t,onToggleSelection:o,disableDrag:u,showOwner:f,ownerLabelFn:m},ze.id)})})}),A.length===0&&i.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:me||`${L}`})]})},V=()=>{if(h!=="mine"&&h!=="others")return null;const L=h==="mine",A=L?"":"",$=L?"":"",Y=L?"public-mine":"public-others",le=L?N:k,me=L?"":"",B=Uv(le);return i.jsxs("div",{className:"public-recipes-block",children:[i.jsxs("div",{className:"public-recipes-block__header",children:[i.jsx("span",{children:$}),i.jsx("span",{children:A}),i.jsxs("span",{className:"public-recipes-block__count",children:["(",le.length,")"]})]}),le.length===0?i.jsx("div",{className:"public-recipes-block__empty",children:me}):i.jsxs(i.Fragment,{children:[q("",B.cookingRecipes,"",`${Y}-cooking`),q("",B.breadRecipes,"",`${Y}-bread`),q("",B.dessertRecipes,"",`${Y}-dessert`),q("",B.sauceRecipes,"",`${Y}-sauce`),q("",B.dressingRecipes,"",`${Y}-dressing`),q("",B.decorationRecipes,"",`${Y}-decoration`)]})]})},P=h==="none"&&j.length>0&&O.length===0;return i.jsxs("div",{className:"recipe-list-container",children:[V(),P&&i.jsx("div",{className:"recipe-list-empty-hint",children:""}),q("",U,"","cooking"),q("",D,"","bread"),q("",C,"","dessert"),q("",M,"","sauce"),q("",T,"","dressing"),q("",H,"","decoration"),n.length===0&&i.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},pn=({isOpen:n,onClose:t,title:s,children:a,size:o="medium",showCloseButton:u=!0})=>{if(b.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),b.useEffect(()=>{const h=f=>{f.key==="Escape"&&n&&t()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[n,t]),!n)return null;const d=h=>{h.target===h.currentTarget&&t()};return i.jsx("div",{className:"modal-overlay",onClick:d,children:i.jsxs("div",{className:`modal-content modal-${o}`,children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h3",{className:"modal-title",children:s}),u&&i.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),i.jsx("div",{className:"modal-body",children:a})]})})};function Yu(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(n);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(n,a[o])&&(s[a[o]]=n[a[o]]);return s}function M1(n,t,s,a){function o(u){return u instanceof s?u:new s(function(d){d(u)})}return new(s||(s=Promise))(function(u,d){function h(y){try{m(a.next(y))}catch(v){d(v)}}function f(y){try{m(a.throw(y))}catch(v){d(v)}}function m(y){y.done?u(y.value):o(y.value).then(h,f)}m((a=a.apply(n,t||[])).next())})}const z1=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class jp extends Error{constructor(t,s="FunctionsError",a){super(t),this.name=s,this.context=a}}class U1 extends jp{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Iv extends jp{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Bv extends jp{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Kf;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Kf||(Kf={}));class L1{constructor(t,{headers:s={},customFetch:a,region:o=Kf.Any}={}){this.url=t,this.headers=s,this.region=o,this.fetch=z1(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return M1(this,arguments,void 0,function*(s,a={}){var o;let u,d;try{const{headers:h,method:f,body:m,signal:y,timeout:v}=a;let x={},{region:w}=a;w||(w=this.region);const _=new URL(`${this.url}/${s}`);w&&w!=="any"&&(x["x-region"]=w,_.searchParams.set("forceFunctionRegion",w));let E;m&&(h&&!Object.prototype.hasOwnProperty.call(h,"Content-Type")||!h)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",E=m):typeof m=="string"?(x["Content-Type"]="text/plain",E=m):typeof FormData<"u"&&m instanceof FormData?E=m:(x["Content-Type"]="application/json",E=JSON.stringify(m)):E=m;let j=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(j=d.signal,y.addEventListener("abort",()=>d.abort())):j=d.signal);const N=yield this.fetch(_.toString(),{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),h),body:E,signal:j}).catch(D=>{throw new U1(D)}),k=N.headers.get("x-relay-error");if(k&&k==="true")throw new Iv(N);if(!N.ok)throw new Bv(N);let O=((o=N.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),U;return O==="application/json"?U=yield N.json():O==="application/octet-stream"||O==="application/pdf"?U=yield N.blob():O==="text/event-stream"?U=N:O==="multipart/form-data"?U=yield N.formData():U=yield N.text(),{data:U,error:null,response:N}}catch(h){return{data:null,error:h,response:h instanceof Bv||h instanceof Iv?h.context:void 0}}finally{u&&clearTimeout(u)}})}}var I1=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},B1=class{constructor(n){var t,s;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(s=n.isMaybeSingle)!==null&&s!==void 0?s:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let o=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,h=null,f=null,m=u.status,y=u.statusText;if(u.ok){var v,x;if(s.method!=="HEAD"){var w;const N=await u.text();N===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((w=s.headers.get("Accept"))===null||w===void 0)&&w.includes("application/vnd.pgrst.plan+text"))?h=N:h=JSON.parse(N))}const E=(v=s.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),j=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");E&&j&&j.length>1&&(f=parseInt(j[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(h)&&(h.length>1?(d={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,f=null,m=406,y="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{var _;const E=await u.text();try{d=JSON.parse(E),Array.isArray(d)&&u.status===404&&(h=[],d=null,m=200,y="OK")}catch{u.status===404&&E===""?(m=204,y="No Content"):d={message:E}}if(d&&s.isMaybeSingle&&(!(d==null||(_=d.details)===null||_===void 0)&&_.includes("0 rows"))&&(d=null,m=200,y="OK"),d&&s.shouldThrowOnError)throw new I1(d)}return{error:d,data:h,count:f,status:m,statusText:y}});return this.shouldThrowOnError||(o=o.catch(u=>{var d;let h="";const f=u?.cause;if(f){var m,y,v,x;const _=(m=f?.message)!==null&&m!==void 0?m:"",E=(y=f?.code)!==null&&y!==void 0?y:"";h=`${(v=u?.name)!==null&&v!==void 0?v:"FetchError"}: ${u?.message}`,h+=`

Caused by: ${(x=f?.name)!==null&&x!==void 0?x:"Error"}: ${_}`,E&&(h+=` (${E})`),f?.stack&&(h+=`
${f.stack}`)}else{var w;h=(w=u?.stack)!==null&&w!==void 0?w:""}return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:h,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),o.then(n,t)}returns(){return this}overrideTypes(){return this}},$1=class extends B1{select(n){let t=!1;const s=(n??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:s,foreignTable:a,referencedTable:o=a}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:s=t}={}){const a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,t,{foreignTable:s,referencedTable:a=s}={}){const o=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:s=!1,buffers:a=!1,wal:o=!1,format:u="text"}={}){var d;const h=[n?"analyze":null,t?"verbose":null,s?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),f=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${f}"; options=${h};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const $v=new RegExp("[,()]");var Ka=class extends $1{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const s=Array.from(new Set(t)).map(a=>typeof a=="string"&&$v.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`in.(${s})`),this}notIn(n,t){const s=Array.from(new Set(t)).map(a=>typeof a=="string"&&$v.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`not.in.(${s})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:s,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const u=s===void 0?"":`(${s})`;return this.url.searchParams.append(n,`${o}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(n,t,s){return this.url.searchParams.append(n,`not.${t}.${s}`),this}or(n,{foreignTable:t,referencedTable:s=t}={}){const a=s?`${s}.or`:"or";return this.url.searchParams.append(a,`(${n})`),this}filter(n,t,s){return this.url.searchParams.append(n,`${t}.${s}`),this}},P1=class{constructor(n,{headers:t={},schema:s,fetch:a}){this.url=n,this.headers=new Headers(t),this.schema=s,this.fetch=a}select(n,t){const{head:s=!1,count:a}=t??{},o=s?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(h=>/\s/.test(h)&&!u?"":(h==='"'&&(u=!u),h)).join("");return this.url.searchParams.set("select",d),a&&this.headers.append("Prefer",`count=${a}`),new Ka({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:t,defaultToNull:s=!0}={}){var a;const o="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(u.length>0){const d=[...new Set(u)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new Ka({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(n,{onConflict:t,ignoreDuplicates:s=!1,count:a,defaultToNull:o=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const h=n.reduce((f,m)=>f.concat(Object.keys(m)),[]);if(h.length>0){const f=[...new Set(h)].map(m=>`"${m}"`);this.url.searchParams.set("columns",f.join(","))}}return new Ka({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(n,{count:t}={}){var s;const a="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Ka({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:n}={}){var t;const s="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new Ka({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},q1=class z0{constructor(t,{headers:s={},schema:a,fetch:o}={}){this.url=t,this.headers=new Headers(s),this.schemaName=a,this.fetch=o}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new P1(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new z0(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:a=!1,get:o=!1,count:u}={}){var d;let h;const f=new URL(`${this.url}/rpc/${t}`);let m;a||o?(h=a?"HEAD":"GET",Object.entries(s).filter(([v,x])=>x!==void 0).map(([v,x])=>[v,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([v,x])=>{f.searchParams.append(v,x)})):(h="POST",m=s);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new Ka({method:h,url:f,headers:y,schema:this.schemaName,body:m,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}};class F1{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const s=process.versions;if(s&&s.node){const a=s.node,o=parseInt(a.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const a=this.getWebSocketConstructor();return new a(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const H1="2.89.0",G1=`realtime-js/${H1}`,U0="1.0.0",V1="2.0.0",Pv=U0,Yf=1e4,K1=1e3,Y1=100;var gi;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(gi||(gi={}));var Bn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Bn||(Bn={}));var Wr;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Wr||(Wr={}));var Qf;(function(n){n.websocket="websocket"})(Qf||(Qf={}));var Hi;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Hi||(Hi={}));class Q1{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,s){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return s(this._binaryEncodeUserBroadcastPush(t));let a=[t.join_ref,t.ref,t.topic,t.event,t.payload];return s(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(t){var s;return this._isArrayBuffer((s=t.payload)===null||s===void 0?void 0:s.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var s,a;const o=(a=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var s,a;const o=(a=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&a!==void 0?a:{},d=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,s,a){var o,u;const d=t.topic,h=(o=t.ref)!==null&&o!==void 0?o:"",f=(u=t.join_ref)!==null&&u!==void 0?u:"",m=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(f.length>255)throw new Error(`joinRef length ${f.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`ref length ${h.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`userEvent length ${m.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+f.length+h.length+d.length+m.length+v.length,w=new ArrayBuffer(this.HEADER_LENGTH+x);let _=new DataView(w),E=0;_.setUint8(E++,this.KINDS.userBroadcastPush),_.setUint8(E++,f.length),_.setUint8(E++,h.length),_.setUint8(E++,d.length),_.setUint8(E++,m.length),_.setUint8(E++,v.length),_.setUint8(E++,s),Array.from(f,N=>_.setUint8(E++,N.charCodeAt(0))),Array.from(h,N=>_.setUint8(E++,N.charCodeAt(0))),Array.from(d,N=>_.setUint8(E++,N.charCodeAt(0))),Array.from(m,N=>_.setUint8(E++,N.charCodeAt(0))),Array.from(v,N=>_.setUint8(E++,N.charCodeAt(0)));var j=new Uint8Array(w.byteLength+a.byteLength);return j.set(new Uint8Array(w),0),j.set(new Uint8Array(a),w.byteLength),j.buffer}decode(t,s){if(this._isArrayBuffer(t)){let a=this._binaryDecode(t);return s(a)}if(typeof t=="string"){const a=JSON.parse(t),[o,u,d,h,f]=a;return s({join_ref:o,ref:u,topic:d,event:h,payload:f})}return s({})}_binaryDecode(t){const s=new DataView(t),a=s.getUint8(0),o=new TextDecoder;if(a===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,s,o)}_decodeUserBroadcast(t,s,a){const o=s.getUint8(1),u=s.getUint8(2),d=s.getUint8(3),h=s.getUint8(4);let f=this.HEADER_LENGTH+4;const m=a.decode(t.slice(f,f+o));f=f+o;const y=a.decode(t.slice(f,f+u));f=f+u;const v=a.decode(t.slice(f,f+d));f=f+d;const x=t.slice(f,t.byteLength),w=h===this.JSON_ENCODING?JSON.parse(a.decode(x)):x,_={type:this.BROADCAST_EVENT,event:y,payload:w};return d>0&&(_.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(t){var s;return t instanceof ArrayBuffer||((s=t?.constructor)===null||s===void 0?void 0:s.name)==="ArrayBuffer"}_pick(t,s){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([a])=>s.includes(a)))}}class L0{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var fn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(fn||(fn={}));const qv=(n,t,s={})=>{var a;const o=(a=s.skipTypes)!==null&&a!==void 0?a:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=W1(d,n,t,o),u),{}):{}},W1=(n,t,s,a)=>{const o=t.find(h=>h.name===n),u=o?.type,d=s[n];return u&&!a.includes(u)?I0(u,d):Wf(d)},I0=(n,t)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return eC(t,s)}switch(n){case fn.bool:return J1(t);case fn.float4:case fn.float8:case fn.int2:case fn.int4:case fn.int8:case fn.numeric:case fn.oid:return X1(t);case fn.json:case fn.jsonb:return Z1(t);case fn.timestamp:return tC(t);case fn.abstime:case fn.date:case fn.daterange:case fn.int4range:case fn.int8range:case fn.money:case fn.reltime:case fn.text:case fn.time:case fn.timestamptz:case fn.timetz:case fn.tsrange:case fn.tstzrange:return Wf(t);default:return Wf(t)}},Wf=n=>n,J1=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},X1=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},Z1=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},eC=(n,t)=>{if(typeof n!="string")return n;const s=n.length-1,a=n[s];if(n[0]==="{"&&a==="}"){let u;const d=n.slice(1,s);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(h=>I0(t,h))}return n},tC=n=>typeof n=="string"?n.replace(" ","T"):n,B0=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class uf{constructor(t,s,a={},o=Yf){this.channel=t,this.event=s,this.payload=a,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var a;return this._hasReceived(t)&&s((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Fv;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Fv||(Fv={}));class bo{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},o=>{const{onJoin:u,onLeave:d,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=bo.syncState(this.state,o,u,d),this.pendingDiffs.forEach(f=>{this.state=bo.syncDiff(this.state,f,u,d)}),this.pendingDiffs=[],h()}),this.channel._on(a.diff,{},o=>{const{onJoin:u,onLeave:d,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=bo.syncDiff(this.state,o,u,d),h())}),this.onJoin((o,u,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:u,newPresences:d})}),this.onLeave((o,u,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,a,o){const u=this.cloneDeep(t),d=this.transformState(s),h={},f={};return this.map(u,(m,y)=>{d[m]||(f[m]=y)}),this.map(d,(m,y)=>{const v=u[m];if(v){const x=y.map(j=>j.presence_ref),w=v.map(j=>j.presence_ref),_=y.filter(j=>w.indexOf(j.presence_ref)<0),E=v.filter(j=>x.indexOf(j.presence_ref)<0);_.length>0&&(h[m]=_),E.length>0&&(f[m]=E)}else h[m]=y}),this.syncDiff(u,{joins:h,leaves:f},a,o)}static syncDiff(t,s,a,o){const{joins:u,leaves:d}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return a||(a=()=>{}),o||(o=()=>{}),this.map(u,(h,f)=>{var m;const y=(m=t[h])!==null&&m!==void 0?m:[];if(t[h]=this.cloneDeep(f),y.length>0){const v=t[h].map(w=>w.presence_ref),x=y.filter(w=>v.indexOf(w.presence_ref)<0);t[h].unshift(...x)}a(h,y,f)}),this.map(d,(h,f)=>{let m=t[h];if(!m)return;const y=f.map(v=>v.presence_ref);m=m.filter(v=>y.indexOf(v.presence_ref)<0),t[h]=m,o(h,m,f),m.length===0&&delete t[h]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(a=>s(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,a)=>{const o=t[a];return"metas"in o?s[a]=o.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):s[a]=o,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Hv;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Hv||(Hv={}));var wo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(wo||(wo={}));var Os;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Os||(Os={}));class Ja{constructor(t,s={config:{}},a){var o,u;if(this.topic=t,this.params=s,this.socket=a,this.bindings={},this.state=Bn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new uf(this,Wr.join,this.params,this.timeout),this.rejoinTimer=new L0(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Bn.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Wr.reply,{},(d,h)=>{this._trigger(this._replyEventName(h),d)}),this.presence=new bo(this),this.broadcastEndpointURL=B0(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,s=this.timeout){var a,o,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Bn.closed){const{config:{broadcast:d,presence:h,private:f}}=this.params,m=(o=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(w=>w.filter))!==null&&o!==void 0?o:[],y=!!this.bindings[wo.PRESENCE]&&this.bindings[wo.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},h),{enabled:y}),postgres_changes:m,private:f};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(w=>t?.(Os.CHANNEL_ERROR,w)),this._onClose(()=>t?.(Os.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:w})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),w===void 0){t?.(Os.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,j=(_=E?.length)!==null&&_!==void 0?_:0,N=[];for(let k=0;k<j;k++){const O=E[k],{filter:{event:U,schema:D,table:C,filter:M}}=O,T=w&&w[k];if(T&&T.event===U&&Ja.isFilterValueEqual(T.schema,D)&&Ja.isFilterValueEqual(T.table,C)&&Ja.isFilterValueEqual(T.filter,M))N.push(Object.assign(Object.assign({},O),{id:T.id}));else{this.unsubscribe(),this.state=Bn.errored,t?.(Os.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=N,t&&t(Os.SUBSCRIBED);return}}).receive("error",w=>{this.state=Bn.errored,t?.(Os.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(w).join(", ")||"error")))}).receive("timeout",()=>{t?.(Os.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,a){return this.state===Bn.joined&&t===wo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,s,a)}async httpSend(t,s,a={}){var o;if(s==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:s,private:this.private}]})},h=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=a.timeout)!==null&&o!==void 0?o:this.timeout);if(h.status===202)return{success:!0};let f=h.statusText;try{const m=await h.json();f=m.error||m.message||f}catch{}return Promise.reject(new Error(f))}async send(t,s={}){var a,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,h={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(h.Authorization=`Bearer ${this.socket.accessTokenValue}`);const f={method:"POST",headers:h,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(a=s.timeout)!==null&&a!==void 0?a:this.timeout);return await((o=m.body)===null||o===void 0?void 0:o.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,h,f;const m=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((f=(h=(d=this.params)===null||d===void 0?void 0:d.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&u("ok"),m.receive("ok",()=>u("ok")),m.receive("error",()=>u("error")),m.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Bn.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Wr.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(o=>{a=new uf(this,Wr.leave,{},t),a.receive("ok",()=>{s(),o("ok")}).receive("timeout",()=>{s(),o("timed out")}).receive("error",()=>{o("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Bn.closed,this.bindings={}}async _fetchWithTimeout(t,s,a){const o=new AbortController,u=setTimeout(()=>o.abort(),a),d=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:o.signal}));return clearTimeout(u),d}_push(t,s,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new uf(this,t,s,a);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Y1){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,a){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,a){var o,u;const d=t.toLocaleLowerCase(),{close:h,error:f,leave:m,join:y}=Wr;if(a&&[h,f,m,y].indexOf(d)>=0&&a!==this._joinRef())return;let x=this._onMessage(d,s,a);if(s&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(w=>{var _,E,j;return((_=w.filter)===null||_===void 0?void 0:_.event)==="*"||((j=(E=w.filter)===null||E===void 0?void 0:E.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===d}).map(w=>w.callback(x,a)):(u=this.bindings[d])===null||u===void 0||u.filter(w=>{var _,E,j,N,k,O;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in w){const U=w.id,D=(_=w.filter)===null||_===void 0?void 0:_.event;return U&&((E=s.ids)===null||E===void 0?void 0:E.includes(U))&&(D==="*"||D?.toLocaleLowerCase()===((j=s.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const U=(k=(N=w?.filter)===null||N===void 0?void 0:N.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return U==="*"||U===((O=s?.event)===null||O===void 0?void 0:O.toLocaleLowerCase())}else return w.type.toLocaleLowerCase()===d}).map(w=>{if(typeof x=="object"&&"ids"in x){const _=x.data,{schema:E,table:j,commit_timestamp:N,type:k,errors:O}=_;x=Object.assign(Object.assign({},{schema:E,table:j,commit_timestamp:N,eventType:k,new:{},old:{},errors:O}),this._getPayloadRecords(_))}w.callback(x,a)})}_isClosed(){return this.state===Bn.closed}_isJoined(){return this.state===Bn.joined}_isJoining(){return this.state===Bn.joining}_isLeaving(){return this.state===Bn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,a){const o=t.toLocaleLowerCase(),u={type:o,filter:s,callback:a};return this.bindings[o]?this.bindings[o].push(u):this.bindings[o]=[u],this}_off(t,s){const a=t.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(o=>{var u;return!(((u=o.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===a&&Ja.isEqual(o.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const a in t)if(t[a]!==s[a])return!1;return!0}static isFilterValueEqual(t,s){return(t??void 0)===(s??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Wr.close,{},t)}_onError(t){this._on(Wr.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Bn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=qv(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=qv(t.columns,t.old_record)),s}}const df=()=>{},au={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},nC=[1e3,2e3,5e3,1e4],rC=1e4,sC=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class iC{constructor(t,s){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Yf,this.transport=null,this.heartbeatIntervalMs=au.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=df,this.ref=0,this.reconnectTimer=null,this.vsn=Pv,this.logger=df,this.conn=null,this.sendBuffer=[],this.serializer=new Q1,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...u)=>o(...u):(...u)=>fetch(...u),!(!((a=s?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${Qf.websocket}`,this.httpEndpoint=B0(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=F1.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,s??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,a){this.logger(t,s,a)}connectionState(){switch(this.conn&&this.conn.readyState){case gi.connecting:return Hi.Connecting;case gi.open:return Hi.Open;case gi.closing:return Hi.Closing;default:return Hi.Closed}}isConnected(){return this.connectionState()===Hi.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const a=`realtime:${t}`,o=this.getChannels().find(u=>u.topic===a);if(o)return o;{const u=new Ja(`realtime:${t}`,s,this);return this.channels.push(u),u}}push(t){const{topic:s,event:a,payload:o,ref:u}=t,d=()=>{this.encode(t,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${s} ${a} (${u})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(K1,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},au.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(m){this.log("error","error in heartbeat callback",m)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:a,event:o,payload:u,ref:d}=s,h=d?`(${d})`:"",f=u.status||"";this.log("receive",`${f} ${a} ${o} ${h}`.trim(),u),this.channels.filter(m=>m._isMember(a)).forEach(m=>m._trigger(o,u,d)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===gi.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===gi.open||this.conn.readyState===gi.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(s=>{this.log("error","error waiting for auth on connect",s),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this._terminateWorker()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Wr.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const a=t.match(/\?/)?"&":"?",o=new URLSearchParams(s);return`${t}${a}${o}`}_workerObjectUrl(t){let s;if(t)s=t;else{const a=new Blob([sC],{type:"application/javascript"});s=URL.createObjectURL(a)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s,a=!1;if(t)s=t,a=!0;else if(this.accessToken)try{s=await this.accessToken()}catch(o){this.log("error","Error fetching access token from callback",o),s=this.accessTokenValue}else s=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(o=>{const u={access_token:s,version:G1};s&&o.updateJoinPayload(u),o.joinedOnce&&o._isJoined()&&o._push(Wr.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(s=>{this.log("error",`Error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(a=>{try{a(s)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(a){this.log("error",`error triggering ${t} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new L0(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},au.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,a,o,u,d,h,f,m,y,v,x,w;switch(this.transport=(s=t?.transport)!==null&&s!==void 0?s:null,this.timeout=(a=t?.timeout)!==null&&a!==void 0?a:Yf,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:au.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(h=t?.heartbeatCallback)!==null&&h!==void 0?h:df,this.vsn=(f=t?.vsn)!==null&&f!==void 0?f:Pv,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=t?.reconnectAfterMs)!==null&&m!==void 0?m:(_=>nC[_-1]||rC),this.vsn){case U0:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((_,E)=>E(JSON.stringify(_))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((_,E)=>E(JSON.parse(_)));break;case V1:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(w=t?.decode)!==null&&w!==void 0?w:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var No=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function aC(n,t,s){const a=new URL(t,n);if(s)for(const[o,u]of Object.entries(s))u!==void 0&&a.searchParams.set(o,u);return a.toString()}async function lC(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function oC(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:s,path:a,query:o,body:u,headers:d}){const h=aC(n.baseUrl,a,o),f=await lC(n.auth),m=await t(h,{method:s,headers:{...u?{"Content-Type":"application/json"}:{},...f,...d},body:u?JSON.stringify(u):void 0}),y=await m.text(),v=(m.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!m.ok){const w=v?x:void 0,_=w?.error;throw new No(_?.message??`Request failed with status ${m.status}`,{status:m.status,icebergType:_?.type,icebergCode:_?.code,details:w})}return{status:m.status,headers:m.headers,data:x}}}}function lu(n){return n.join("")}var cC=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:lu(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(n,t){const s={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${lu(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${lu(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${lu(n.namespace)}`}),!0}catch(t){if(t instanceof No&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(s){if(s instanceof No&&s.status===409)return;throw s}}};function La(n){return n.join("")}var uC=class{constructor(n,t="",s){this.client=n,this.prefix=t,this.accessDelegation=s}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(n,t){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(s){if(s instanceof No&&s.status===404)return!1;throw s}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(s){if(s instanceof No&&s.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw s}}},dC=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const s=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=oC({baseUrl:s,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new cC(this.client,t),this.tableOps=new uC(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},Qu=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function wn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var hC=class extends Qu{constructor(n,t,s){super(n),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Jf=class extends Qu{constructor(n,t){super(n),this.name="StorageUnknownError",this.originalError=t}};const _p=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),fC=()=>Response,Xf=n=>{if(Array.isArray(n))return n.map(s=>Xf(s));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([s,a])=>{const o=s.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[o]=Xf(a)}),t},pC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},mC=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function ko(n){"@babel/helpers - typeof";return ko=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ko(n)}function gC(n,t){if(ko(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,t);if(ko(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function yC(n){var t=gC(n,"string");return ko(t)=="symbol"?t:t+""}function vC(n,t,s){return(t=yC(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function Gv(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),s.push.apply(s,a)}return s}function St(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Gv(Object(s),!0).forEach(function(a){vC(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Gv(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}const hf=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},xC=async(n,t,s)=>{n instanceof await fC()&&!s?.noResolveJson?n.json().then(a=>{const o=n.status||500,u=a?.statusCode||o+"";t(new hC(hf(a),o,u))}).catch(a=>{t(new Jf(hf(a),a))}):t(new Jf(hf(n),n))},bC=(n,t,s,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"||!a?o:(pC(a)?(o.headers=St({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,t?.duplex&&(o.duplex=t.duplex),St(St({},o),s))};async function Vo(n,t,s,a,o,u){return new Promise((d,h)=>{n(s,bC(t,a,o,u)).then(f=>{if(!f.ok)throw f;return a?.noResolveJson?f:f.json()}).then(f=>d(f)).catch(f=>xC(f,h,a))})}async function To(n,t,s,a){return Vo(n,"GET",t,s,a)}async function Qr(n,t,s,a,o){return Vo(n,"POST",t,a,o,s)}async function Zf(n,t,s,a,o){return Vo(n,"PUT",t,a,o,s)}async function wC(n,t,s,a){return Vo(n,"HEAD",t,St(St({},s),{},{noResolveJson:!0}),a)}async function Cp(n,t,s,a,o){return Vo(n,"DELETE",t,a,o,s)}var SC=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(wn(t))return{data:null,error:t};throw t}}};let $0;$0=Symbol.toStringTag;var jC=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[$0]="BlobDownloadBuilder",this.promise=null}asStream(){return new SC(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(wn(t))return{data:null,error:t};throw t}}};const _C={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Vv={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var CC=class{constructor(n,t={},s,a){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.bucketId=s,this.fetch=_p(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,t,s,a){var o=this;try{let u;const d=St(St({},Vv),a);let h=St(St({},o.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const f=d.metadata;typeof Blob<"u"&&s instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),f&&u.append("metadata",o.encodeMetadata(f)),u.append("",s)):typeof FormData<"u"&&s instanceof FormData?(u=s,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),f&&!u.has("metadata")&&u.append("metadata",o.encodeMetadata(f))):(u=s,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType,f&&(h["x-metadata"]=o.toBase64(o.encodeMetadata(f))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),a?.headers&&(h=St(St({},h),a.headers));const m=o._removeEmptyFolders(t),y=o._getFinalPath(m),v=await(n=="PUT"?Zf:Qr)(o.fetch,`${o.url}/object/${y}`,u,St({headers:h},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:m,id:v.Id,fullPath:v.Key},error:null}}catch(u){if(o.shouldThrowOnError)throw u;if(wn(u))return{data:null,error:u};throw u}}async upload(n,t,s){return this.uploadOrUpdate("POST",n,t,s)}async uploadToSignedUrl(n,t,s,a){var o=this;const u=o._removeEmptyFolders(n),d=o._getFinalPath(u),h=new URL(o.url+`/object/upload/sign/${d}`);h.searchParams.set("token",t);try{let f;const m=St({upsert:Vv.upsert},a),y=St(St({},o.headers),{"x-upsert":String(m.upsert)});return typeof Blob<"u"&&s instanceof Blob?(f=new FormData,f.append("cacheControl",m.cacheControl),f.append("",s)):typeof FormData<"u"&&s instanceof FormData?(f=s,f.append("cacheControl",m.cacheControl)):(f=s,y["cache-control"]=`max-age=${m.cacheControl}`,y["content-type"]=m.contentType),{data:{path:u,fullPath:(await Zf(o.fetch,h.toString(),f,{headers:y})).Key},error:null}}catch(f){if(o.shouldThrowOnError)throw f;if(wn(f))return{data:null,error:f};throw f}}async createSignedUploadUrl(n,t){var s=this;try{let a=s._getFinalPath(n);const o=St({},s.headers);t?.upsert&&(o["x-upsert"]="true");const u=await Qr(s.fetch,`${s.url}/object/upload/sign/${a}`,{},{headers:o}),d=new URL(s.url+u.url),h=d.searchParams.get("token");if(!h)throw new Qu("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:h},error:null}}catch(a){if(s.shouldThrowOnError)throw a;if(wn(a))return{data:null,error:a};throw a}}async update(n,t,s){return this.uploadOrUpdate("PUT",n,t,s)}async move(n,t,s){var a=this;try{return{data:await Qr(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:a.headers}),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}async copy(n,t,s){var a=this;try{return{data:{path:(await Qr(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:a.headers})).Key},error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}async createSignedUrl(n,t,s){var a=this;try{let o=a._getFinalPath(n),u=await Qr(a.fetch,`${a.url}/object/sign/${o}`,St({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:a.headers});const d=s?.download?`&download=${s.download===!0?"":s.download}`:"";return u={signedUrl:encodeURI(`${a.url}${u.signedURL}${d}`)},{data:u,error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}async createSignedUrls(n,t,s){var a=this;try{const o=await Qr(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:t,paths:n},{headers:a.headers}),u=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:o.map(d=>St(St({},d),{},{signedUrl:d.signedURL?encodeURI(`${a.url}${d.signedURL}${u}`):null})),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}download(n,t){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(t?.transform||{}),o=a?`?${a}`:"",u=this._getFinalPath(n),d=()=>To(this.fetch,`${this.url}/${s}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new jC(d,this.shouldThrowOnError)}async info(n){var t=this;const s=t._getFinalPath(n);try{return{data:Xf(await To(t.fetch,`${t.url}/object/info/${s}`,{headers:t.headers})),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(wn(a))return{data:null,error:a};throw a}}async exists(n){var t=this;const s=t._getFinalPath(n);try{return await wC(t.fetch,`${t.url}/object/${s}`,{headers:t.headers}),{data:!0,error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(wn(a)&&a instanceof Jf){const o=a.originalError;if([400,404].includes(o?.status))return{data:!1,error:a}}throw a}}getPublicUrl(n,t){const s=this._getFinalPath(n),a=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&a.push(o);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&a.push(d);let h=a.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${s}${h}`)}}}async remove(n){var t=this;try{return{data:await Cp(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async list(n,t,s){var a=this;try{const o=St(St(St({},_C),t),{},{prefix:n||""});return{data:await Qr(a.fetch,`${a.url}/object/list/${a.bucketId}`,o,{headers:a.headers},s),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}async listV2(n,t){var s=this;try{const a=St({},n);return{data:await Qr(s.fetch,`${s.url}/object/list-v2/${s.bucketId}`,a,{headers:s.headers},t),error:null}}catch(a){if(s.shouldThrowOnError)throw a;if(wn(a))return{data:null,error:a};throw a}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const P0="2.89.0",q0={"X-Client-Info":`storage-js/${P0}`};var EC=class{constructor(n,t={},s,a){this.shouldThrowOnError=!1;const o=new URL(n);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=St(St({},q0),t),this.fetch=_p(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var t=this;try{const s=t.listBucketOptionsToQueryString(n);return{data:await To(t.fetch,`${t.url}/bucket${s}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await To(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async createBucket(n,t={public:!1}){var s=this;try{return{data:await Qr(s.fetch,`${s.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(a){if(s.shouldThrowOnError)throw a;if(wn(a))return{data:null,error:a};throw a}}async updateBucket(n,t){var s=this;try{return{data:await Zf(s.fetch,`${s.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(a){if(s.shouldThrowOnError)throw a;if(wn(a))return{data:null,error:a};throw a}}async emptyBucket(n){var t=this;try{return{data:await Qr(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await Cp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},NC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=St(St({},q0),t),this.fetch=_p(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Qr(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async listBuckets(n){var t=this;try{const s=new URLSearchParams;n?.limit!==void 0&&s.set("limit",n.limit.toString()),n?.offset!==void 0&&s.set("offset",n.offset.toString()),n?.sortColumn&&s.set("sortColumn",n.sortColumn),n?.sortOrder&&s.set("sortOrder",n.sortOrder),n?.search&&s.set("search",n.search);const a=s.toString(),o=a?`${t.url}/bucket?${a}`:`${t.url}/bucket`;return{data:await To(t.fetch,o,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await Cp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}from(n){var t=this;if(!mC(n))throw new Qu("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const s=new dC({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(s,{get(o,u){const d=o[u];return typeof d!="function"?d:async(...h)=>{try{return{data:await d.apply(o,h),error:null}}catch(f){if(a)throw f;return{data:null,error:f}}}}})}};const Ep={"X-Client-Info":`storage-js/${P0}`,"Content-Type":"application/json"};var F0=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Er(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var ff=class extends F0{constructor(n,t,s){super(n),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},kC=class extends F0{constructor(n,t){super(n),this.name="StorageVectorsUnknownError",this.originalError=t}};const Np=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),TC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Kv=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),RC=async(n,t,s)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!s?.noResolveJson){const a=n.status||500,o=n;if(typeof o.json=="function")o.json().then(u=>{const d=u?.statusCode||u?.code||a+"";t(new ff(Kv(u),a,d))}).catch(()=>{const u=a+"";t(new ff(o.statusText||`HTTP ${a} error`,a,u))});else{const u=a+"";t(new ff(o.statusText||`HTTP ${a} error`,a,u))}}else t(new kC(Kv(n),n))},AC=(n,t,s,a)=>{const o={method:n,headers:t?.headers||{}};return a?(TC(a)?(o.headers=St({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,St(St({},o),s)):o};async function OC(n,t,s,a,o,u){return new Promise((d,h)=>{n(s,AC(t,a,o,u)).then(f=>{if(!f.ok)throw f;if(a?.noResolveJson)return f;const m=f.headers.get("content-type");return!m||!m.includes("application/json")?{}:f.json()}).then(f=>d(f)).catch(f=>RC(f,h,a))})}async function Nr(n,t,s,a,o){return OC(n,"POST",t,a,o,s)}var DC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=St(St({},Ep),t),this.fetch=Np(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async getIndex(n,t){var s=this;try{return{data:await Nr(s.fetch,`${s.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers}),error:null}}catch(a){if(s.shouldThrowOnError)throw a;if(Er(a))return{data:null,error:a};throw a}}async listIndexes(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async deleteIndex(n,t){var s=this;try{return{data:await Nr(s.fetch,`${s.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers})||{},error:null}}catch(a){if(s.shouldThrowOnError)throw a;if(Er(a))return{data:null,error:a};throw a}}},MC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=St(St({},Ep),t),this.fetch=Np(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var t=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Nr(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async getVectors(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async listVectors(n){var t=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await Nr(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async queryVectors(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async deleteVectors(n){var t=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Nr(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}},zC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=St(St({},Ep),t),this.fetch=Np(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async listBuckets(n={}){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await Nr(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Er(s))return{data:null,error:s};throw s}}},UC=class extends zC{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new LC(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,s=this;return t().call(s,n)}async getBucket(n){var t=()=>super.getBucket,s=this;return t().call(s,n)}async listBuckets(n={}){var t=()=>super.listBuckets,s=this;return t().call(s,n)}async deleteBucket(n){var t=()=>super.deleteBucket,s=this;return t().call(s,n)}},LC=class extends DC{constructor(n,t,s,a){super(n,t,a),this.vectorBucketName=s}async createIndex(n){var t=()=>super.createIndex,s=this;return t().call(s,St(St({},n),{},{vectorBucketName:s.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,s=this;return t().call(s,St(St({},n),{},{vectorBucketName:s.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,s=this;return t().call(s,s.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,s=this;return t().call(s,s.vectorBucketName,n)}index(n){return new IC(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},IC=class extends MC{constructor(n,t,s,a,o){super(n,t,o),this.vectorBucketName=s,this.indexName=a}async putVectors(n){var t=()=>super.putVectors,s=this;return t().call(s,St(St({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async getVectors(n){var t=()=>super.getVectors,s=this;return t().call(s,St(St({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,s=this;return t().call(s,St(St({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,s=this;return t().call(s,St(St({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,s=this;return t().call(s,St(St({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}},BC=class extends EC{constructor(n,t={},s,a){super(n,t,s,a)}from(n){return new CC(this.url,this.headers,n,this.fetch)}get vectors(){return new UC(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new NC(this.url+"/iceberg",this.headers,this.fetch)}};const H0="2.89.0",Ya=30*1e3,ep=3,pf=ep*Ya,$C="http://localhost:9999",PC="supabase.auth.token",qC={"X-Client-Info":`gotrue-js/${H0}`},tp="X-Supabase-Api-Version",G0={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},FC=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,HC=600*1e3;class Ro extends Error{constructor(t,s,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=a}}function dt(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class GC extends Ro{constructor(t,s,a){super(t,s,a),this.name="AuthApiError",this.status=s,this.code=a}}function VC(n){return dt(n)&&n.name==="AuthApiError"}class Gi extends Ro{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class Bs extends Ro{constructor(t,s,a,o){super(t,a,o),this.name=s,this.status=a}}class Cr extends Bs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function KC(n){return dt(n)&&n.name==="AuthSessionMissingError"}class Ia extends Bs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ou extends Bs{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class cu extends Bs{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function YC(n){return dt(n)&&n.name==="AuthImplicitGrantRedirectError"}class Yv extends Bs{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class QC extends Bs{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class np extends Bs{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function mf(n){return dt(n)&&n.name==="AuthRetryableFetchError"}class Qv extends Bs{constructor(t,s,a){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=a}}class rp extends Bs{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ou="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Wv=` 	
\r=`.split(""),WC=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<Wv.length;t+=1)n[Wv[t].charCodeAt(0)]=-2;for(let t=0;t<Ou.length;t+=1)n[Ou[t].charCodeAt(0)]=t;return n})();function Jv(n,t,s){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;s(Ou[a]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;s(Ou[a]),t.queuedBits-=6}}function V0(n,t,s){const a=WC[n];if(a>-1)for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Xv(n){const t=[],s=d=>{t.push(String.fromCodePoint(d))},a={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},u=d=>{ZC(d,a,s)};for(let d=0;d<n.length;d+=1)V0(n.charCodeAt(d),o,u);return t.join("")}function JC(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function XC(n,t){for(let s=0;s<n.length;s+=1){let a=n.charCodeAt(s);if(a>55295&&a<=56319){const o=(a-55296)*1024&65535;a=(n.charCodeAt(s+1)-56320&65535|o)+65536,s+=1}JC(a,t)}}function ZC(n,t,s){if(t.utf8seq===0){if(n<=127){s(n);return}for(let a=1;a<6;a+=1)if((n>>7-a&1)===0){t.utf8seq=a;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function el(n){const t=[],s={queue:0,queuedBits:0},a=o=>{t.push(o)};for(let o=0;o<n.length;o+=1)V0(n.charCodeAt(o),s,a);return new Uint8Array(t)}function eE(n){const t=[];return XC(n,s=>t.push(s)),new Uint8Array(t)}function Yi(n){const t=[],s={queue:0,queuedBits:0},a=o=>{t.push(o)};return n.forEach(o=>Jv(o,s,a)),Jv(null,s,a),t.join("")}function tE(n){return Math.round(Date.now()/1e3)+n}function nE(){return Symbol("auth-callback")}const tr=()=>typeof window<"u"&&typeof document<"u",Li={tested:!1,writable:!1},K0=()=>{if(!tr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Li.tested)return Li.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Li.tested=!0,Li.writable=!0}catch{Li.tested=!0,Li.writable=!1}return Li.writable};function rE(n){const t={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((o,u)=>{t[u]=o})}catch{}return s.searchParams.forEach((a,o)=>{t[o]=a}),t}const Y0=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),sE=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Qa=async(n,t,s)=>{await n.setItem(t,JSON.stringify(s))},Ii=async(n,t)=>{const s=await n.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Zn=async(n,t)=>{await n.removeItem(t)};class Wu{constructor(){this.promise=new Wu.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}Wu.promiseConstructor=Promise;function gf(n){const t=n.split(".");if(t.length!==3)throw new rp("Invalid JWT structure");for(let a=0;a<t.length;a++)if(!FC.test(t[a]))throw new rp("JWT not in base64url format");return{header:JSON.parse(Xv(t[0])),payload:JSON.parse(Xv(t[1])),signature:el(t[2]),raw:{header:t[0],payload:t[1]}}}async function iE(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function aE(n,t){return new Promise((a,o)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){a(d);return}}catch(d){if(!t(u,d)){o(d);return}}})()})}function lE(n){return("0"+n.toString(16)).substr(-2)}function oE(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=s.length;let o="";for(let u=0;u<56;u++)o+=s.charAt(Math.floor(Math.random()*a));return o}return crypto.getRandomValues(t),Array.from(t,lE).join("")}async function cE(n){const s=new TextEncoder().encode(n),a=await crypto.subtle.digest("SHA-256",s),o=new Uint8Array(a);return Array.from(o).map(u=>String.fromCharCode(u)).join("")}async function uE(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await cE(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ba(n,t,s=!1){const a=oE();let o=a;s&&(o+="/PASSWORD_RECOVERY"),await Qa(n,`${t}-code-verifier`,o);const u=await uE(a);return[u,a===u?"plain":"s256"]}const dE=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function hE(n){const t=n.headers.get(tp);if(!t||!t.match(dE))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function fE(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function pE(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const mE=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $a(n){if(!mE.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function yf(){const n={};return new Proxy(n,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const a=s.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function gE(n,t){return new Proxy(n,{get:(s,a,o)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const u=a.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(s,a,o)}return!t.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(s,a,o)}})}function Zv(n){return JSON.parse(JSON.stringify(n))}const Fi=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),yE=[502,503,504];async function ex(n){var t;if(!sE(n))throw new np(Fi(n),0);if(yE.includes(n.status))throw new np(Fi(n),n.status);let s;try{s=await n.json()}catch(u){throw new Gi(Fi(u),u)}let a;const o=hE(n);if(o&&o.getTime()>=G0["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?a=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(a=s.error_code),a){if(a==="weak_password")throw new Qv(Fi(s),n.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new Cr}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new Qv(Fi(s),n.status,s.weak_password.reasons);throw new GC(Fi(s),n.status||500,a)}const vE=(n,t,s,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(a),Object.assign(Object.assign({},o),s))};async function wt(n,t,s,a){var o;const u=Object.assign({},a?.headers);u[tp]||(u[tp]=G0["2024-01-01"].name),a?.jwt&&(u.Authorization=`Bearer ${a.jwt}`);const d=(o=a?.query)!==null&&o!==void 0?o:{};a?.redirectTo&&(d.redirect_to=a.redirectTo);const h=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",f=await xE(n,t,s+h,{headers:u,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(f):{data:Object.assign({},f),error:null}}async function xE(n,t,s,a,o,u){const d=vE(t,a,o,u);let h;try{h=await n(s,Object.assign({},d))}catch(f){throw console.error(f),new np(Fi(f),0)}if(h.ok||await ex(h),a?.noResolveJson)return h;try{return await h.json()}catch(f){await ex(f)}}function Kr(n){var t;let s=null;SE(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=tE(n.expires_in)));const a=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:s,user:a},error:null}}function tx(n){const t=Kr(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0)&&(t.data.weak_password=n.weak_password),t}function yi(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function bE(n){return{data:n,error:null}}function wE(n){const{action_link:t,email_otp:s,hashed_token:a,redirect_to:o,verification_type:u}=n,d=Yu(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:t,email_otp:s,hashed_token:a,redirect_to:o,verification_type:u},f=Object.assign({},d);return{data:{properties:h,user:f},error:null}}function nx(n){return n}function SE(n){return n.access_token&&n.refresh_token&&n.expires_in}const vf=["global","local","others"];class jE{constructor({url:t="",headers:s={},fetch:a}){this.url=t,this.headers=s,this.fetch=Y0(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,s=vf[0]){if(vf.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${vf.join(", ")}`);try{return await wt(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(dt(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,s={}){try{return await wt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:yi})}catch(a){if(dt(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:s}=t,a=Yu(t,["options"]),o=Object.assign(Object.assign({},a),s);return"newEmail"in a&&(o.new_email=a?.newEmail,delete o.newEmail),await wt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:wE,redirectTo:s?.redirectTo})}catch(s){if(dt(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await wt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:yi})}catch(s){if(dt(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,a,o,u,d,h,f;try{const m={nextPage:null,lastPage:0,total:0},y=await wt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:nx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,w=(f=(h=y.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return w.length>0&&(w.forEach(_=>{const E=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(_.split(";")[1].split("=")[1]);m[`${j}Page`]=E}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(dt(m))return{data:{users:[]},error:m};throw m}}async getUserById(t){$a(t);try{return await wt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:yi})}catch(s){if(dt(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){$a(t);try{return await wt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:yi})}catch(a){if(dt(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,s=!1){$a(t);try{return await wt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:yi})}catch(a){if(dt(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){$a(t.userId);try{const{data:s,error:a}=await wt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:s,error:a}}catch(s){if(dt(s))return{data:null,error:s};throw s}}async _deleteFactor(t){$a(t.userId),$a(t.id);try{return{data:await wt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(dt(s))return{data:null,error:s};throw s}}async _listOAuthClients(t){var s,a,o,u,d,h,f;try{const m={nextPage:null,lastPage:0,total:0},y=await wt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:nx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,w=(f=(h=y.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return w.length>0&&(w.forEach(_=>{const E=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(_.split(";")[1].split("=")[1]);m[`${j}Page`]=E}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(dt(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(t){try{return await wt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(dt(s))return{data:null,error:s};throw s}}async _getOAuthClient(t){try{return await wt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(dt(s))return{data:null,error:s};throw s}}async _updateOAuthClient(t,s){try{return await wt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:s,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(dt(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(t){try{return await wt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(s){if(dt(s))return{data:null,error:s};throw s}}async _regenerateOAuthClientSecret(t){try{return await wt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(dt(s))return{data:null,error:s};throw s}}}function rx(n={}){return{getItem:t=>n[t]||null,setItem:(t,s)=>{n[t]=s},removeItem:t=>{delete n[t]}}}const Pa={debug:!!(globalThis&&K0()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Q0 extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class _E extends Q0{}async function CE(n,t,s){Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const a=new globalThis.AbortController;return t>0&&setTimeout(()=>{a.abort(),Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async o=>{if(o){Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await s()}finally{Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(t===0)throw Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new _E(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Pa.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}function EE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function W0(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function NE(n){return parseInt(n,16)}function kE(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,a=>a.toString(16).padStart(2,"0")).join("")}function TE(n){var t;const{chainId:s,domain:a,expirationTime:o,issuedAt:u=new Date,nonce:d,notBefore:h,requestId:f,resources:m,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const w=W0(n.address),_=y?`${y}://${a}`:a,E=n.statement?`${n.statement}
`:"",j=`${_} wants you to sign in with your Ethereum account:
${w}

${E}`;let N=`URI: ${v}
Version: ${x}
Chain ID: ${s}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(o&&(N+=`
Expiration Time: ${o.toISOString()}`),h&&(N+=`
Not Before: ${h.toISOString()}`),f&&(N+=`
Request ID: ${f}`),m){let k=`
Resources:`;for(const O of m){if(!O||typeof O!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${O}`);k+=`
- ${O}`}N+=k}return`${j}
${N}`}class Un extends Error{constructor({message:t,code:s,cause:a,name:o}){var u;super(t,{cause:a}),this.__isWebAuthnError=!0,this.name=(u=o??(a instanceof Error?a.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=s}}class Du extends Un{constructor(t,s){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s,message:t}),this.name="WebAuthnUnknownError",this.originalError=s}}function RE({error:n,options:t}){var s,a,o;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Un({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((s=u.authenticatorSelection)===null||s===void 0?void 0:s.requireResidentKey)===!0)return new Un({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((a=u.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new Un({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((o=u.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Un({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Un({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Un({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(h=>h.type==="public-key").length===0?new Un({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Un({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(J0(d)){if(u.rp.id!==d)return new Un({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Un({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Un({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Un({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Un({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function AE({error:n,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Un({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Un({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const a=window.location.hostname;if(J0(a)){if(s.rpId!==a)return new Un({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Un({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Un({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Un({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class OE{createNewAbortSignal(){if(this.controller){const s=new Error("Cancelling existing WebAuthn API call for new one");s.name="AbortError",this.controller.abort(s)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const DE=new OE;function ME(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:s,excludeCredentials:a}=n,o=Yu(n,["challenge","user","excludeCredentials"]),u=el(t).buffer,d=Object.assign(Object.assign({},s),{id:el(s.id).buffer}),h=Object.assign(Object.assign({},o),{challenge:u,user:d});if(a&&a.length>0){h.excludeCredentials=new Array(a.length);for(let f=0;f<a.length;f++){const m=a[f];h.excludeCredentials[f]=Object.assign(Object.assign({},m),{id:el(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return h}function zE(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:s}=n,a=Yu(n,["challenge","allowCredentials"]),o=el(t).buffer,u=Object.assign(Object.assign({},a),{challenge:o});if(s&&s.length>0){u.allowCredentials=new Array(s.length);for(let d=0;d<s.length;d++){const h=s[d];u.allowCredentials[d]=Object.assign(Object.assign({},h),{id:el(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return u}function UE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n;return{id:n.id,rawId:n.id,response:{attestationObject:Yi(new Uint8Array(n.response.attestationObject)),clientDataJSON:Yi(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function LE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n,a=n.getClientExtensionResults(),o=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:Yi(new Uint8Array(o.authenticatorData)),clientDataJSON:Yi(new Uint8Array(o.clientDataJSON)),signature:Yi(new Uint8Array(o.signature)),userHandle:o.userHandle?Yi(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function J0(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function sx(){var n,t;return!!(tr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function IE(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Du("Browser returned unexpected credential type",t)}:{data:null,error:new Du("Empty credential response",t)}}catch(t){return{data:null,error:RE({error:t,options:n})}}}async function BE(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Du("Browser returned unexpected credential type",t)}:{data:null,error:new Du("Empty credential response",t)}}catch(t){return{data:null,error:AE({error:t,options:n})}}}const $E={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},PE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Mu(...n){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),s=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),a={};for(const o of n)if(o)for(const u in o){const d=o[u];if(d!==void 0)if(Array.isArray(d))a[u]=d;else if(s(d))a[u]=d;else if(t(d)){const h=a[u];t(h)?a[u]=Mu(h,d):a[u]=Mu(d)}else a[u]=d}return a}function qE(n,t){return Mu($E,n,t||{})}function FE(n,t){return Mu(PE,n,t||{})}class HE{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:s,friendlyName:a,signal:o},u){try{const{data:d,error:h}=await this.client.mfa.challenge({factorId:t,webauthn:s});if(!d)return{data:null,error:h};const f=o??DE.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:m}=d.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${a}`),m.displayName||(m.displayName=m.name)}switch(d.webauthn.type){case"create":{const m=qE(d.webauthn.credential_options.publicKey,u?.create),{data:y,error:v}=await IE({publicKey:m,signal:f});return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}case"request":{const m=FE(d.webauthn.credential_options.publicKey,u?.request),{data:y,error:v}=await BE(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:m,signal:f}));return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}}}catch(d){return dt(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:s,webauthn:a}){return this.client.mfa.verify({factorId:s,challengeId:t,webauthn:a})}async _authenticate({factorId:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!s)return{data:null,error:new Ro("rpId is required for WebAuthn authentication")};try{if(!sx())return{data:null,error:new Gi("Browser does not support WebAuthn",null)};const{data:d,error:h}=await this.challenge({factorId:t,webauthn:{rpId:s,rpOrigins:a},signal:o},{request:u});if(!d)return{data:null,error:h};const{webauthn:f}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:f.type,rpId:s,rpOrigins:a,credential_response:f.credential_response}})}catch(d){return dt(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!s)return{data:null,error:new Ro("rpId is required for WebAuthn registration")};try{if(!sx())return{data:null,error:new Gi("Browser does not support WebAuthn",null)};const{data:d,error:h}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:h};const{data:f,error:m}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:s,rpOrigins:a},signal:o},{create:u});return f?this._verify({factorId:d.id,challengeId:f.challengeId,webauthn:{rpId:s,rpOrigins:a,type:f.webauthn.type,credential_response:f.webauthn.credential_response}}):{data:null,error:m}}catch(d){return dt(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in register",d)}}}}EE();const GE={url:$C,storageKey:PC,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:qC,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function ix(n,t,s){return await s()}const qa={};class Ao{get jwks(){var t,s;return(s=(t=qa[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){qa[this.storageKey]=Object.assign(Object.assign({},qa[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=qa[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){qa[this.storageKey]=Object.assign(Object.assign({},qa[this.storageKey]),{cachedAt:t})}constructor(t){var s,a,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},GE),t);if(this.storageKey=u.storageKey,this.instanceID=(s=Ao.nextInstanceID[this.storageKey])!==null&&s!==void 0?s:0,Ao.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&tr()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new jE({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=Y0(u.fetch),this.lock=u.lock||ix,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:this.persistSession&&tr()&&(!((a=globalThis?.navigator)===null||a===void 0)&&a.locks)?this.lock=CE:this.lock=ix,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new HE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:K0()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=rx(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=rx(this.memoryStorage)),tr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${H0}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let s={},a="none";if(tr()&&(s=rE(window.location.href),this._isImplicitGrantCallback(s)?a="implicit":await this._isPKCECallback(s)&&(a="pkce")),tr()&&this.detectSessionInUrl&&a!=="none"){const{data:o,error:u}=await this._getSessionFromURL(s,a);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),YC(u)){const f=(t=u.details)===null||t===void 0?void 0:t.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:d,redirectType:h}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",h),await this._saveSession(d),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return dt(s)?this._returnResult({error:s}):this._returnResult({error:new Gi("Unexpected error during initialization",s)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,a,o;try{const u=await wt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Kr}),{data:d,error:h}=u;if(h||!d)return this._returnResult({data:{user:null,session:null},error:h});const f=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(u){if(dt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var s,a,o;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let w=null,_=null;this.flowType==="pkce"&&([w,_]=await Ba(this.storage,this.storageKey)),u=await wt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(s=x?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:w,code_challenge_method:_},xform:Kr})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await wt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(a=x?.data)!==null&&a!==void 0?a:{},channel:(o=x?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:Kr})}else throw new ou("You must provide either an email or phone number and a password");const{data:d,error:h}=u;if(h||!d)return await Zn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:h});const f=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),dt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let s;if("email"in t){const{email:u,password:d,options:h}=t;s=await wt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:tx})}else if("phone"in t){const{phone:u,password:d,options:h}=t;s=await wt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:tx})}else throw new ou("You must provide either an email or phone number and a password");const{data:a,error:o}=s;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!a||!a.session||!a.user){const u=new Ia;return this._returnResult({data:{user:null,session:null},error:u})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:o})}catch(s){if(dt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOAuth(t){var s,a,o,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;switch(s){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(t){var s,a,o,u,d,h,f,m,y,v,x;let w,_;if("message"in t)w=t.message,_=t.signature;else{const{chain:E,wallet:j,statement:N,options:k}=t;let O;if(tr())if(typeof j=="object")O=j;else{const H=window;if("ethereum"in H&&typeof H.ethereum=="object"&&"request"in H.ethereum&&typeof H.ethereum.request=="function")O=H.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!k?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");O=j}const U=new URL((s=k?.url)!==null&&s!==void 0?s:window.location.href),D=await O.request({method:"eth_requestAccounts"}).then(H=>H).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!D||D.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=W0(D[0]);let M=(a=k?.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!M){const H=await O.request({method:"eth_chainId"});M=NE(H)}const T={domain:U.host,address:C,statement:N,uri:U.href,version:"1",chainId:M,nonce:(o=k?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(u=k?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(h=k?.signInWithEthereum)===null||h===void 0?void 0:h.expirationTime,notBefore:(f=k?.signInWithEthereum)===null||f===void 0?void 0:f.notBefore,requestId:(m=k?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(y=k?.signInWithEthereum)===null||y===void 0?void 0:y.resources};w=TE(T),_=await O.request({method:"personal_sign",params:[kE(w),C]})}try{const{data:E,error:j}=await wt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:w,signature:_},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Kr});if(j)throw j;if(!E||!E.session||!E.user){const N=new Ia;return this._returnResult({data:{user:null,session:null},error:N})}return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),this._returnResult({data:Object.assign({},E),error:j})}catch(E){if(dt(E))return this._returnResult({data:{user:null,session:null},error:E});throw E}}async signInWithSolana(t){var s,a,o,u,d,h,f,m,y,v,x,w;let _,E;if("message"in t)_=t.message,E=t.signature;else{const{chain:j,wallet:N,statement:k,options:O}=t;let U;if(tr())if(typeof N=="object")U=N;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))U=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!O?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");U=N}const D=new URL((s=O?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in U&&U.signIn){const C=await U.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},O?.signInWithSolana),{version:"1",domain:D.host,uri:D.href}),k?{statement:k}:null));let M;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")M=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)M=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)_=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),E=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in U)||typeof U.signMessage!="function"||!("publicKey"in U)||typeof U!="object"||!U.publicKey||!("toBase58"in U.publicKey)||typeof U.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${D.host} wants you to sign in with your Solana account:`,U.publicKey.toBase58(),...k?["",k,""]:[""],"Version: 1",`URI: ${D.href}`,`Issued At: ${(o=(a=O?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((u=O?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${O.signInWithSolana.notBefore}`]:[],...!((d=O?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${O.signInWithSolana.expirationTime}`]:[],...!((h=O?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${O.signInWithSolana.chainId}`]:[],...!((f=O?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${O.signInWithSolana.nonce}`]:[],...!((m=O?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${O.signInWithSolana.requestId}`]:[],...!((v=(y=O?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...O.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const C=await U.signMessage(new TextEncoder().encode(_),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");E=C}}try{const{data:j,error:N}=await wt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:Yi(E)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(w=t.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:Kr});if(N)throw N;if(!j||!j.session||!j.user){const k=new Ia;return this._returnResult({data:{user:null,session:null},error:k})}return j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),this._returnResult({data:Object.assign({},j),error:N})}catch(j){if(dt(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async _exchangeCodeForSession(t){const s=await Ii(this.storage,`${this.storageKey}-code-verifier`),[a,o]=(s??"").split("/");try{if(!a&&this.flowType==="pkce")throw new QC;const{data:u,error:d}=await wt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:Kr});if(await Zn(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const h=new Ia;return this._returnResult({data:{user:null,session:null,redirectType:null},error:h})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:o??null}),error:d})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),dt(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:s,provider:a,token:o,access_token:u,nonce:d}=t,h=await wt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:o,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Kr}),{data:f,error:m}=h;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!f||!f.session||!f.user){const y=new Ia;return this._returnResult({data:{user:null,session:null},error:y})}return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),this._returnResult({data:f,error:m})}catch(s){if(dt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOtp(t){var s,a,o,u,d;try{if("email"in t){const{email:h,options:f}=t;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await Ba(this.storage,this.storageKey));const{error:v}=await wt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(a=f?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:y},redirectTo:f?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:h,options:f}=t,{data:m,error:y}=await wt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(o=f?.data)!==null&&o!==void 0?o:{},create_user:(u=f?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(d=f?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:y})}throw new ou("You must provide either an email or phone number.")}catch(h){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),dt(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async verifyOtp(t){var s,a;try{let o,u;"options"in t&&(o=(s=t.options)===null||s===void 0?void 0:s.redirectTo,u=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:d,error:h}=await wt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:o,xform:Kr});if(h)throw h;if(!d)throw new Error("An error occurred on token verification.");const f=d.session,m=d.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(o){if(dt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var s,a,o,u,d;try{let h=null,f=null;this.flowType==="pkce"&&([h,f]=await Ba(this.storage,this.storageKey));const m=await wt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&a!==void 0?a:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:f}),headers:this.headers,xform:bE});return!((u=m.data)===null||u===void 0)&&u.url&&tr()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(h){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),dt(h))return this._returnResult({data:null,error:h});throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:a}=t;if(a)throw a;if(!s)throw new Cr;const{error:o}=await wt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(dt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:a,type:o,options:u}=t,{error:d}=await wt(this.fetch,"POST",s,{headers:this.headers,body:{email:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:a,type:o,options:u}=t,{data:d,error:h}=await wt(this.fetch,"POST",s,{headers:this.headers,body:{phone:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:h})}throw new ou("You must provide either an email or phone number and a type")}catch(s){if(dt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await a,await s()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=s();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Ii(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at*1e3-Date.now()<pf:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.userStorage){const d=await Ii(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=yf()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=gE(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const s=await this._acquireLock(-1,async()=>await this._getUser());return s.data.user&&(this.suppressGetSessionWarning=!0),s}async _getUser(t){try{return t?await wt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:yi}):await this._useSession(async s=>{var a,o,u;const{data:d,error:h}=s;if(h)throw h;return!(!((a=d.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Cr}:await wt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:void 0,xform:yi})})}catch(s){if(dt(s))return KC(s)&&(await this._removeSession(),await Zn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:s});throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async a=>{const{data:o,error:u}=a;if(u)throw u;if(!o.session)throw new Cr;const d=o.session;let h=null,f=null;this.flowType==="pkce"&&t.email!=null&&([h,f]=await Ba(this.storage,this.storageKey));const{data:m,error:y}=await wt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:h,code_challenge_method:f}),jwt:d.access_token,xform:yi});if(y)throw y;return d.user=m.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(a){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),dt(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Cr;const s=Date.now()/1e3;let a=s,o=!0,u=null;const{payload:d}=gf(t.access_token);if(d.exp&&(a=d.exp,o=a<=s),o){const{data:h,error:f}=await this._callRefreshToken(t.refresh_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!h)return{data:{user:null,session:null},error:null};u=h}else{const{data:h,error:f}=await this._getUser(t.access_token);if(f)throw f;u={access_token:t.access_token,refresh_token:t.refresh_token,user:h.user,token_type:"bearer",expires_in:a-s,expires_at:a},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(s){if(dt(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var a;if(!t){const{data:d,error:h}=s;if(h)throw h;t=(a=d.session)!==null&&a!==void 0?a:void 0}if(!t?.refresh_token)throw new Cr;const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(s){if(dt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async _getSessionFromURL(t,s){try{if(!tr())throw new cu("No browser detected.");if(t.error||t.error_description||t.error_code)throw new cu(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new Yv("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new cu("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Yv("No code detected.");const{data:k,error:O}=await this._exchangeCodeForSession(t.code);if(O)throw O;const U=new URL(window.location.href);return U.searchParams.delete("code"),window.history.replaceState(window.history.state,"",U.toString()),{data:{session:k.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:o,access_token:u,refresh_token:d,expires_in:h,expires_at:f,token_type:m}=t;if(!u||!h||!d||!m)throw new cu("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(h);let x=y+v;f&&(x=parseInt(f));const w=x-y;w*1e3<=Ya&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${w}s, should have been closer to ${v}s`);const _=x-v;y-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,x,y):y-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,x,y);const{data:E,error:j}=await this._getUser(u);if(j)throw j;const N={provider_token:a,provider_refresh_token:o,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:m,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:N,redirectType:t.type},error:null})}catch(a){if(dt(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Ii(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var a;const{data:o,error:u}=s;if(u)return this._returnResult({error:u});const d=(a=o.session)===null||a===void 0?void 0:a.access_token;if(d){const{error:h}=await this.admin.signOut(d,t);if(h&&!(VC(h)&&(h.status===404||h.status===401||h.status===403)))return this._returnResult({error:h})}return t!=="others"&&(await this._removeSession(),await Zn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const s=nE(),a={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async s=>{var a,o;try{const{data:{session:u},error:d}=s;if(d)throw d;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,s={}){let a=null,o=null;this.flowType==="pkce"&&([a,o]=await Ba(this.storage,this.storageKey,!0));try{return await wt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:o,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),dt(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:s,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(s){if(dt(s))return this._returnResult({data:null,error:s});throw s}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var s;try{const{data:a,error:o}=await this._useSession(async u=>{var d,h,f,m,y;const{data:v,error:x}=u;if(x)throw x;const w=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(h=t.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=t.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await wt(this.fetch,"GET",w,{headers:this.headers,jwt:(y=(m=v.session)===null||m===void 0?void 0:m.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return tr()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(a?.url),this._returnResult({data:{provider:t.provider,url:a?.url},error:null})}catch(a){if(dt(a))return this._returnResult({data:{provider:t.provider,url:null},error:a});throw a}}async linkIdentityIdToken(t){return await this._useSession(async s=>{var a;try{const{error:o,data:{session:u}}=s;if(o)throw o;const{options:d,provider:h,token:f,access_token:m,nonce:y}=t,v=await wt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=u?.access_token)!==null&&a!==void 0?a:void 0,body:{provider:h,id_token:f,access_token:m,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Kr}),{data:x,error:w}=v;return w?this._returnResult({data:{user:null,session:null},error:w}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new Ia}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:w}))}catch(o){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),dt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async s=>{var a,o;const{data:u,error:d}=s;if(d)throw d;return await wt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(a=u.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0})})}catch(s){if(dt(s))return this._returnResult({data:null,error:s});throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const a=Date.now();return await aE(async o=>(o>0&&await iE(200*Math.pow(2,o-1)),this._debug(s,"refreshing attempt",o),await wt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Kr})),(o,u)=>{const d=200*Math.pow(2,o);return u&&mf(u)&&Date.now()+d-a<Ya})}catch(a){if(this._debug(s,"error",a),dt(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",a),tr()&&!s.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t,s;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const o=await Ii(this.storage,this.storageKey);if(o&&this.userStorage){let d=await Ii(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await Qa(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d?.user)!==null&&t!==void 0?t:yf()}else if(o&&!o.user&&!o.user){const d=await Ii(this.storage,this.storageKey+"-user");d&&d?.user?(o.user=d.user,await Zn(this.storage,this.storageKey+"-user"),await Qa(this.storage,this.storageKey,o)):o.user=yf()}if(this._debug(a,"session from storage",o),!this._isValidSession(o)){this._debug(a,"session is not valid"),o!==null&&await this._removeSession();return}const u=((s=o.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<pf;if(this._debug(a,`session has${u?"":" not"} expired with margin of ${pf}s`),u){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),mf(d)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:h}=await this._getUser(o.access_token);!h&&d?.user?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(a,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(a,"error",o),console.error(o);return}finally{this._debug(a,"end")}}async _callRefreshToken(t){var s,a;if(!t)throw new Cr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Wu;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new Cr;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const h={data:u.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(u){if(this._debug(o,"error",u),dt(u)){const d={data:null,error:u};return mf(u)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(d),d}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(u),u}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,s,a=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",s,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:s});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(t,s)}catch(f){u.push(f)}});if(await Promise.all(d),u.length>0){for(let h=0;h<u.length;h+=1)console.error(u[h]);throw u[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Zn(this.storage,`${this.storageKey}-code-verifier`);const s=Object.assign({},t),a=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&s.user&&await Qa(this.userStorage,this.storageKey+"-user",{user:s.user});const o=Object.assign({},s);delete o.user;const u=Zv(o);await Qa(this.storage,this.storageKey,u)}else{const o=Zv(s);await Qa(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Zn(this.storage,this.storageKey),await Zn(this.storage,this.storageKey+"-code-verifier"),await Zn(this.storage,this.storageKey+"-user"),this.userStorage&&await Zn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&tr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Ya);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:a}}=s;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((a.expires_at*1e3-t)/Ya);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Ya}ms, refresh threshold is ${ep} ticks`),o<=ep&&await this._callRefreshToken(a.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Q0)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,a){const o=[`provider=${encodeURIComponent(s)}`];if(a?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&o.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[u,d]=await Ba(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(h.toString())}if(a?.queryParams){const u=new URLSearchParams(a.queryParams);o.push(u.toString())}return a?.skipBrowserRedirect&&o.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var a;const{data:o,error:u}=s;return u?this._returnResult({data:null,error:u}):await wt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token})})}catch(s){if(dt(s))return this._returnResult({data:null,error:s});throw s}}async _enroll(t){try{return await this._useSession(async s=>{var a,o;const{data:u,error:d}=s;if(d)return this._returnResult({data:null,error:d});const h=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:f,error:m}=await wt(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(a=u?.session)===null||a===void 0?void 0:a.access_token});return m?this._returnResult({data:null,error:m}):(t.factorType==="totp"&&f.type==="totp"&&(!((o=f?.totp)===null||o===void 0)&&o.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),this._returnResult({data:f,error:null}))})}catch(s){if(dt(s))return this._returnResult({data:null,error:s});throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var a;const{data:o,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?UE(t.webauthn.credential_response):LE(t.webauthn.credential_response)})}:{code:t.code}),{data:h,error:f}=await wt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});return f?this._returnResult({data:null,error:f}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+h.expires_in},h)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",h),this._returnResult({data:h,error:f}))})}catch(s){if(dt(s))return this._returnResult({data:null,error:s});throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var a;const{data:o,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=await wt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});if(d.error)return d;const{data:h}=d;if(h.type!=="webauthn")return{data:h,error:null};switch(h.webauthn.type){case"create":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:ME(h.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:zE(h.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(s){if(dt(s))return this._returnResult({data:null,error:s});throw s}})}async _challengeAndVerify(t){const{data:s,error:a}=await this._challenge({factorId:t.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){var t;const{data:{user:s},error:a}=await this.getUser();if(a)return{data:null,error:a};const o={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=s?.factors)!==null&&t!==void 0?t:[])o.all.push(u),u.status==="verified"&&o[u.factor_type].push(u);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,s;const{data:{session:a},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=gf(a.access_token);let d=null;u.aal&&(d=u.aal);let h=d;((s=(t=a.user.factors)===null||t===void 0?void 0:t.filter(y=>y.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(h="aal2");const m=u.amr||[];return{data:{currentLevel:d,nextLevel:h,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async s=>{const{data:{session:a},error:o}=s;return o?this._returnResult({data:null,error:o}):a?await wt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:a.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Cr})})}catch(s){if(dt(s))return this._returnResult({data:null,error:s});throw s}}async _approveAuthorization(t,s){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Cr});const d=await wt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:h=>({data:h,error:null})});return d.data&&d.data.redirect_url&&tr()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(dt(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(t,s){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Cr});const d=await wt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:h=>({data:h,error:null})});return d.data&&d.data.redirect_url&&tr()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(dt(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:s},error:a}=t;return a?this._returnResult({data:null,error:a}):s?await wt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Cr})})}catch(t){if(dt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async s=>{const{data:{session:a},error:o}=s;return o?this._returnResult({data:null,error:o}):a?(await wt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Cr})})}catch(s){if(dt(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(t,s={keys:[]}){let a=s.keys.find(h=>h.kid===t);if(a)return a;const o=Date.now();if(a=this.jwks.keys.find(h=>h.kid===t),a&&this.jwks_cached_at+HC>o)return a;const{data:u,error:d}=await wt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=o,a=u.keys.find(h=>h.kid===t),!a)?null:a}async getClaims(t,s={}){try{let a=t;if(!a){const{data:w,error:_}=await this.getSession();if(_||!w.session)return this._returnResult({data:null,error:_});a=w.session.access_token}const{header:o,payload:u,signature:d,raw:{header:h,payload:f}}=gf(a);s?.allowExpired||fE(u.exp);const m=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!m){const{error:w}=await this.getUser(a);if(w)throw w;return{data:{claims:u,header:o,signature:d},error:null}}const y=pE(o.alg),v=await crypto.subtle.importKey("jwk",m,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,eE(`${h}.${f}`)))throw new rp("Invalid JWT signature");return{data:{claims:u,header:o,signature:d},error:null}}catch(a){if(dt(a))return this._returnResult({data:null,error:a});throw a}}}Ao.nextInstanceID={};const VE=Ao,KE="2.89.0";let mo="";typeof Deno<"u"?mo="deno":typeof document<"u"?mo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?mo="react-native":mo="node";const YE={"X-Client-Info":`supabase-js-${mo}/${KE}`},QE={headers:YE},WE={schema:"public"},JE={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},XE={};function Oo(n){"@babel/helpers - typeof";return Oo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oo(n)}function ZE(n,t){if(Oo(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,t);if(Oo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function eN(n){var t=ZE(n,"string");return Oo(t)=="symbol"?t:t+""}function tN(n,t,s){return(t=eN(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function ax(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),s.push.apply(s,a)}return s}function Cn(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?ax(Object(s),!0).forEach(function(a){tN(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):ax(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}const nN=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),rN=()=>Headers,sN=(n,t,s)=>{const a=nN(s),o=rN();return async(u,d)=>{var h;const f=(h=await t())!==null&&h!==void 0?h:n;let m=new o(d?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${f}`),a(u,Cn(Cn({},d),{},{headers:m}))}};function iN(n){return n.endsWith("/")?n:n+"/"}function aN(n,t){var s,a;const{db:o,auth:u,realtime:d,global:h}=n,{db:f,auth:m,realtime:y,global:v}=t,x={db:Cn(Cn({},f),o),auth:Cn(Cn({},m),u),realtime:Cn(Cn({},y),d),storage:{},global:Cn(Cn(Cn({},v),h),{},{headers:Cn(Cn({},(s=v?.headers)!==null&&s!==void 0?s:{}),(a=h?.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function lN(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(iN(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var oN=class extends VE{constructor(n){super(n)}},cN=class{constructor(n,t,s){var a,o;this.supabaseUrl=n,this.supabaseKey=t;const u=lN(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,h={db:WE,realtime:XE,auth:Cn(Cn({},JE),{},{storageKey:d}),global:QE},f=aN(s??{},h);if(this.storageKey=(a=f.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=f.global.headers)!==null&&o!==void 0?o:{},f.accessToken)this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var m;this.auth=this._initSupabaseAuthClient((m=f.auth)!==null&&m!==void 0?m:{},this.headers,f.global.fetch)}this.fetch=sN(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Cn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.accessToken&&this.accessToken().then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new q1(new URL("rest/v1",u).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this.storage=new BC(this.storageUrl.href,this.headers,this.fetch,s?.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new L1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,s)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,s;if(n.accessToken)return await n.accessToken();const{data:a}=await n.auth.getSession();return(t=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:a,userStorage:o,storageKey:u,flowType:d,lock:h,debug:f,throwOnError:m},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new oN({url:this.authUrl.href,headers:Cn(Cn({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:a,userStorage:o,flowType:d,lock:h,debug:f,throwOnError:m,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(w=>w.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new iC(this.realtimeUrl.href,Cn(Cn({},n),{},{params:Cn(Cn({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,s){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const uN=(n,t,s)=>new cN(n,t,s);function dN(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}dN()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const xf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_API_KEY:"REDACTED_GOOGLE_API_KEY",VITE_SUPABASE_ANON_KEY:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",VITE_SUPABASE_URL:"http://127.0.0.1:54321"};var hN={};const X0=n=>{if(typeof import.meta<"u"&&xf&&xf[n])return xf[n];const t=hN;return t&&t[n]?t[n]:null},Z0=X0("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",fN=X0("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",pN=Z0,Te=uN(Z0,fN),mN={async translateRecipe(n,t="EN-US"){const s=[];s.push(n.title||""),s.push(n.description||"");let a=2,o=2;if(n.type==="bread"){const d=n.flours||[],h=n.breadIngredients||[];d.forEach(f=>s.push(f.name||"")),h.forEach(f=>s.push(f.name||"")),o=a+d.length+h.length}else{const d=n.ingredients||[];d.forEach(h=>{const f=typeof h=="string"?h:h.name||"";s.push(f)}),o=a+d.length}const u=n.steps||[];if(u.forEach(d=>{const h=typeof d=="object"&&d!==null?d.text||"":d||"";s.push(h)}),s.length===0)return n;try{const d=await this.translateList(s,t),h={...n};if(h.title=d[0],h.description=d[1],n.type==="bread"){const f=(n.flours||[]).length;h.flours=(n.flours||[]).map((m,y)=>({...m,name:d[a+y]})),h.breadIngredients=(n.breadIngredients||[]).map((m,y)=>({...m,name:d[a+f+y]}))}else h.ingredients=(n.ingredients||[]).map((f,m)=>{const y=d[a+m];return typeof f=="string"?y:{...f,name:y}});return h.steps=u.map((f,m)=>{const y=d[o+m];return typeof f=="object"&&f!==null?{...f,text:y}:y}),h}catch(d){throw console.error("Translation failed:",d),d}},async translateList(n,t){const{data:s,error:a}=await Te.functions.invoke("translate",{body:{text:n,target_lang:t}});if(a)throw console.error("Supabase Function Invocation Error:",a),new Error(`Translation Error: ${a.message}`);if(s&&s.error)throw console.error("Edge Function returned error:",s.error),new Error(`Translation Error: ${s.error}`);return s.translations.map(o=>o.text)}},nn=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},uu=async(n,t,s)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},wu=n=>{if(Array.isArray(n))return n.map(s=>String(s)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const s=t.slice(1,-1);return s?s.split(",").map(a=>a.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},gN=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],s=Object.values(t)[0];return wu(s)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return wu(t)}return wu(n)},eb=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const s=wu(t);return s.length>0?s:t.split(",").map(a=>a.trim()).filter(Boolean)}return[]},lx=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),s=String(n.message||"").toLowerCase(),a=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||s.includes("row-level security")||s.includes("permission denied")||s.includes("violates row-level security")||s.includes("invalid input syntax")||s.includes("column")||a.includes("row-level security")?!1:s.includes("failed to fetch")||s.includes("network")||s.includes("timeout")||s.includes("timed out")||s.includes("load failed")},tb="recipe_list_cache",yN=300*1e3,ox=(n,t)=>{try{const s=(n||[]).map(a=>({id:a.id,title:a.title,description:a.description,image:a.image,servings:a.servings,course:a.course,category:a.category,storeName:a.storeName,store_name:a.store_name,tags:a.tags,created_at:a.created_at,updated_at:a.updated_at,type:a.type,sourceUrl:a.sourceUrl}));localStorage.setItem(tb,JSON.stringify({userId:t,updatedAt:Date.now(),recipes:s}))}catch{}},vN=n=>{try{const t=localStorage.getItem(tb);if(!t)return null;const s=JSON.parse(t);return s.userId!==n||Date.now()-s.updatedAt>yN?null:s.recipes||null}catch{return null}},bn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(n){return vN(n)},async _resolveShowMasterPreference(n,t=15e3){const s=n?.showMasterRecipes===!0,a=n?.id;if(!a)return s;const o=this._showMasterPrefCache.get(a),u=Date.now();if(o&&o.value!==s)return this._showMasterPrefCache.set(a,{value:s,updatedAt:u}),s;if(o&&u-o.updatedAt<3e4)return o.value;try{const{data:d,error:h}=await uu(Te.from("profiles").select("show_master_recipes").eq("id",a).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(h)throw h;const f=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(a,{value:f,updatedAt:u}),f}catch{return this._showMasterPrefCache.set(a,{value:s,updatedAt:u}),s}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:s,error:a}=await uu(Te.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(a)throw a;const o=gN(s),u=new Set(o.length>0?o:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const s=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:s,updatedAt:t},s}},async fetchRecipes(n,{timeoutMs:t=15e3,includeIngredients:s=!0,includeSources:a=!0}={}){if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const o=n.role==="admin",u=o?Promise.resolve(!1):this._resolveShowMasterPreference(n,t);let d=[];const h=async(U,{withOrderIndex:D,queryTimeoutMs:C})=>{let M=Te.from("recipes").select(U);D?M=M.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):M=M.order("created_at",{ascending:!1});const{data:T,error:H}=await uu(M,C,"recipes.select(list)");if(H)throw H;return(T||[]).map(Yr)},f=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`,m=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${a?",recipe_sources(url)":""}`,y=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",v=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let x=null;const w=`recipe_query_pattern:${s?"ing":"noing"}:${a?"src":"nosrc"}`,_=this._queryPatternCache.get(w),E=Math.max(2500,t);if(_)try{d=await h(_.spec,{withOrderIndex:_.withOrderIndex,queryTimeoutMs:E})}catch(U){console.warn("Cached query pattern failed, re-detecting...",U),this._queryPatternCache.delete(w),x=U}else{const D=Math.max(2500,Math.round(t/(s?[f,m,y,v]:[f,m,v]).length));try{d=await h(f,{withOrderIndex:!0,queryTimeoutMs:D}),this._queryPatternCache.set(w,{spec:f,withOrderIndex:!0})}catch(C){x=C;try{d=await h(m,{withOrderIndex:!1,queryTimeoutMs:D}),this._queryPatternCache.set(w,{spec:m,withOrderIndex:!1})}catch(M){x=M;try{d=await h(y,{withOrderIndex:!1,queryTimeoutMs:D}),this._queryPatternCache.set(w,{spec:y,withOrderIndex:!1})}catch(T){x=T;try{d=await h(v,{withOrderIndex:!1,queryTimeoutMs:D}),this._queryPatternCache.set(w,{spec:v,withOrderIndex:!1})}catch(H){x=H,d=[]}}}}}if(d.length===0&&x)try{const U=localStorage.getItem("local_recipes");if(U)d=JSON.parse(U).map(D=>typeof Yr=="function"?Yr(D):D);else throw x}catch{throw x}if(o)return ox(d,n.id),d;const j=[String(n.id)];n.displayId&&j.push(String(n.displayId));const N=await u,k=N?await this._resolveMasterOwnerTags(t):new Set,O=d.filter(U=>{const D=eb(U.tags),C=D.filter(K=>K&&K.startsWith("owner:"));if(C.length===0)return!0;const M=C.some(K=>k.has(K));if(N&&M)return!0;const T=C.some(K=>j.some(F=>K===`owner:${F}`)),H=D.includes("public");return!!(T||H)});return ox(O,n.id),O},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),a=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:o}=await Te.storage.from("recipe-images").upload(a,n);if(o)throw o;const{data:u}=Te.storage.from("recipe-images").getPublicUrl(a);return u.publicUrl},async getRecipe(n){try{const{data:t,error:s}=await uu(Te.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(s)throw s;return Yr(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const s=localStorage.getItem("local_recipes");if(s){const o=JSON.parse(s).find(u=>u.id==n);if(o)return Yr(o)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:s,created_at:a,sourceUrl:o,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const f=(u.tags||[]).filter(m=>!m.startsWith("owner:"));u.tags=[...f,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=du(u);try{const{data:h,error:f}=await Te.from("recipes").insert([d]).select().single();if(f)throw f;if(o){const{error:m}=await Te.from("recipe_sources").insert([{recipe_id:h.id,url:o}]);m&&console.error("Failed to save source URL:",m)}return Yr({...h,recipe_sources:o?[{url:o}]:[]})}catch(h){if(!lx(h))throw h;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",h);const f=Date.now(),m={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=du(m);y.id=f,y.created_at=m.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),h}return Yr(y)}},async updateRecipe(n){const{id:t,created_at:s,sourceUrl:a,...o}=n;o.image instanceof File&&(o.image=await this.uploadImage(o.image));const u=du(o);o.steps===void 0&&delete u.steps,o.tags===void 0&&delete u.tags,o.ingredients!==void 0||o.type!==void 0||o.ingredientGroups!==void 0||o.flours!==void 0||o.breadIngredients!==void 0||o.stepGroups!==void 0||delete u.ingredients;try{const{data:h,error:f}=await Te.from("recipes").update(u).eq("id",n.id).select().single();if(f)throw f;if(a!==void 0&&(await Te.from("recipe_sources").delete().eq("recipe_id",n.id),a)){const{error:m}=await Te.from("recipe_sources").insert([{recipe_id:n.id,url:a}]);m&&console.error("Failed to update source URL:",m)}return Yr({...h,recipe_sources:a?[{url:a}]:[]})}catch(h){if(!lx(h))throw h;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",h);const f=localStorage.getItem("local_recipes");if(f){let m=JSON.parse(f);const y=m.findIndex(v=>v.id==n.id);if(y!==-1){const v={...m[y],...u,updated_at:new Date().toISOString()};return m[y]=v,localStorage.setItem("local_recipes",JSON.stringify(m)),Yr(v)}}throw h}},async duplicateRecipe(n,t){const{id:s,created_at:a,updated_at:o,image:u,...d}=n;d.title=`${d.title} ()`;let h=null;if(u)try{const f=u.split("/").pop(),m=`copy-${Date.now()}-${f}`,{error:y}=await Te.storage.from("recipe-images").copy(f,m);if(y)console.warn("Image copy failed, using original URL:",y),h=u;else{const{data:v}=Te.storage.from("recipe-images").getPublicUrl(m);h=v.publicUrl}}catch(f){console.warn("Image copy logic error:",f),h=u}return d.image=h,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await Te.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(xN)},async getDeletedCount(){const{count:n,error:t}=await Te.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:s}=await Te.from("recipes").select("*").eq("id",n).single();if(s)throw s;const{error:a}=await Te.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Te.from("recipes").delete().eq("id",n);if(o)throw o;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const s=localStorage.getItem("local_recipes");if(s){let a=JSON.parse(s);const o=a.length;if(a=a.filter(u=>u.id!=n),a.length<o)return localStorage.setItem("local_recipes",JSON.stringify(a)),!0}throw t}},async restoreRecipe(n){const{data:t,error:s}=await Te.from("deleted_recipes").select("*").eq("id",n).single();if(s)throw s;const{error:a}=await Te.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Te.from("deleted_recipes").delete().eq("id",n);if(o)throw o;return!0},async hardDeleteRecipe(n){const{error:t}=await Te.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await Te.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(s=>s.recipe_id)},async addToHistory(n){const{error:t}=await Te.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(s=>Te.from("recipes").update({order_index:s.order_index}).eq("id",s.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,s=[];for(const a of n)try{await this.createRecipe(a),t++}catch(o){console.error("Import failed for recipe:",a.title,o),s.push({title:a.title,error:o.message})}return{success:!0,count:t,errors:s}},async updateRecipeCosts(n){const{data:t,error:s}=await Te.from("recipes").select("*");if(s)throw s;let a=0;const o=[];for(const u of t){const d=Yr(u);let h=!1;const f=m=>m.map(y=>{if(!y.name)return y;const v=n.get(nn(y.name));if(v&&y.purchaseCost!==v.price){h=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const w=parseFloat(x.quantity)||0;x.cost=Math.round(w/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const w=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*w)}return x}return y});if(d.type==="bread"){const m=f(d.flours||[]),y=f(d.breadIngredients||[]);h&&(d.flours=m,d.breadIngredients=y)}else{const m=f(d.ingredients||[]);h&&(d.ingredients=m)}if(h){const m=du(d);o.push(Te.from("recipes").update(m).eq("id",d.id)),a++}}return o.length>0&&await Promise.all(o),a}},du=n=>{let t=n.ingredients||[];const s={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(s.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const o=n.steps||[],u=n.stepGroups.map(d=>({...d,count:o.filter(h=>h.groupId===d.id).length}));s.stepGroups=u}if(n.type==="bread"){const o=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[s,...o,...u]}else t=[s,...t];const a=(n.steps||[]).map(o=>typeof o=="string"?o:o.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:a,tags:n.tags||[]}},Yr=n=>{const t=n.ingredients||[];let s="normal",a=[],o=[],u=[],d=[],h=t;const f=eb(n.tags);if(n.ingredients_meta)s=n.ingredients_meta.type||"normal",h=[];else if(Array.isArray(t)&&t.length>0&&t[0]._meta){const y=t[0];s=y.type||"normal",y.groups&&(u=y.groups),y.stepGroups&&(d=y.stepGroups);const v=t.slice(1);s==="bread"?(a=v.filter(x=>x._group==="flour").map(x=>{const{_group:w,..._}=x;return _}),o=v.filter(x=>x._group==="other").map(x=>{const{_group:w,..._}=x;return _}),h=[...a,...o]):h=v}let m=n.steps||[];if(d.length>0&&Array.isArray(m)){let y=0;m=m.map(x=>({text:x}));const v=[];for(d.forEach(x=>{const w=x.count||0;for(let _=0;_<w;_++)y<m.length&&(v.push({...m[y],text:m[y].text,groupId:x.id}),y++)});y<m.length;)v.push({...m[y],groupId:"default"}),y++;m=v}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:s,flours:a,breadIngredients:o,ingredientGroups:u,stepGroups:d,ingredients:h,steps:m.length>0&&typeof m[0]=="object"?m:n.steps,tags:f,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},xN=n=>({...Yr(n),deletedAt:n.deleted_at,originalId:n.original_id}),bf=Object.freeze(Object.defineProperty({__proto__:null,recipeService:bn},Symbol.toStringTag,{value:"Module"})),wf="food",bN="food_alcohol",wN=new Set(["food","alcohol","soft_drink","supplies"]),hu=n=>{const t=String(n||"").trim();return!t||t===bN?wf:wN.has(t)?t:wf},Pn={async _getCurrentUserId(){const{data:n,error:t}=await Te.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,s,a=null,o=null,u=void 0,d=void 0){try{const h=await this._getCurrentUserId();if(!h)throw new Error("");const f={user_id:h,ingredient_name:n,packet_size:parseFloat(t),packet_unit:s,last_price:a?parseFloat(a):null,updated_at:new Date().toISOString()};if(o&&(f.item_category=hu(o)),u!==void 0){const x=String(u??"").trim();f.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let w=Number.isFinite(x)?x:100;w<=0&&(w=100),w>100&&(w=100),f.yield_percent=w}const m=async x=>Te.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await m(f);if(v){const x=String(v.message||""),w=!!f.item_category&&x.includes("item_category"),_=Object.prototype.hasOwnProperty.call(f,"vendor")&&x.includes("vendor"),E=Object.prototype.hasOwnProperty.call(f,"yield_percent")&&x.includes("yield_percent");if(w||_||E){const j={...f};w&&delete j.item_category,_&&delete j.vendor,E&&delete j.yield_percent,{data:y,error:v}=await m(j)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:hu(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(h){throw console.error("Error saving conversion:",h),h}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:s,error:a}=await Te.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return a?(a.code==="PGRST116"||console.warn("Error fetching conversion:",a),null):{ingredientName:s.ingredient_name,packetSize:s.packet_size,packetUnit:s.packet_unit,lastPrice:s.last_price,vendor:s.vendor||"",itemCategory:hu(s.item_category),yieldPercent:s.yield_percent===null||s.yield_percent===void 0?100:s.yield_percent,updatedAt:s.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:s}=await Te.from("unit_conversions").select("*").eq("user_id",n);if(s)throw s;const a=new Map;return t.forEach(o=>{a.set(o.ingredient_name,{ingredientName:o.ingredient_name,packetSize:o.packet_size,packetUnit:o.packet_unit,lastPrice:o.last_price,vendor:o.vendor||"",itemCategory:hu(o.item_category),yieldPercent:o.yield_percent===null||o.yield_percent===void 0?100:o.yield_percent,updatedAt:o.updated_at})}),a}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:s}=await Te.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(s)throw s;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(n,{overwrite:t=!1}={}){const s=String(n||"").trim();if(!s)throw new Error("");const{data:a,error:o}=await Te.rpc("admin_copy_ingredient_master",{target_profile_id:s,overwrite:t===!0});if(o)throw o;return a}},nb=b.createContext(null),es=()=>b.useContext(nb),rb=b.createContext(null),ea=()=>{const n=b.useContext(rb);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},Su=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],SN=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var Fa={},Sf={exports:{}},jf,cx;function jN(){if(cx)return jf;cx=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return jf=n,jf}var _f,ux;function _N(){if(ux)return _f;ux=1;var n=jN();function t(){}function s(){}return s.resetWarningCache=t,_f=function(){function a(d,h,f,m,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}a.isRequired=a;function o(){return a}var u={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:o,element:a,elementType:a,instanceOf:o,node:a,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:s,resetWarningCache:t};return u.PropTypes=u,u},_f}var dx;function sb(){return dx||(dx=1,Sf.exports=_N()()),Sf.exports}var Cf,hx;function ib(){return hx||(hx=1,Cf={L:1,M:0,Q:3,H:2}),Cf}var Ef,fx;function ab(){return fx||(fx=1,Ef={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),Ef}var Nf,px;function CN(){if(px)return Nf;px=1;var n=ab();function t(s){this.mode=n.MODE_8BIT_BYTE,this.data=s}return t.prototype={getLength:function(s){return this.data.length},write:function(s){for(var a=0;a<this.data.length;a++)s.put(this.data.charCodeAt(a),8)}},Nf=t,Nf}var kf,mx;function EN(){if(mx)return kf;mx=1;var n=ib();function t(s,a){this.totalCount=s,this.dataCount=a}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(s,a){var o=t.getRsBlockTable(s,a);if(o==null)throw new Error("bad rs block @ typeNumber:"+s+"/errorCorrectLevel:"+a);for(var u=o.length/3,d=new Array,h=0;h<u;h++)for(var f=o[h*3+0],m=o[h*3+1],y=o[h*3+2],v=0;v<f;v++)d.push(new t(m,y));return d},t.getRsBlockTable=function(s,a){switch(a){case n.L:return t.RS_BLOCK_TABLE[(s-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(s-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(s-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(s-1)*4+3];default:return}},kf=t,kf}var Tf,gx;function NN(){if(gx)return Tf;gx=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var s=Math.floor(t/8);return(this.buffer[s]>>>7-t%8&1)==1},put:function(t,s){for(var a=0;a<s;a++)this.putBit((t>>>s-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),t&&(this.buffer[s]|=128>>>this.length%8),this.length++}},Tf=n,Tf}var Rf,yx;function lb(){if(yx)return Rf;yx=1;for(var n={glog:function(s){if(s<1)throw new Error("glog("+s+")");return n.LOG_TABLE[s]},gexp:function(s){for(;s<0;)s+=255;for(;s>=256;)s-=255;return n.EXP_TABLE[s]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return Rf=n,Rf}var Af,vx;function ob(){if(vx)return Af;vx=1;var n=lb();function t(s,a){if(s.length==null)throw new Error(s.length+"/"+a);for(var o=0;o<s.length&&s[o]==0;)o++;this.num=new Array(s.length-o+a);for(var u=0;u<s.length-o;u++)this.num[u]=s[u+o]}return t.prototype={get:function(s){return this.num[s]},getLength:function(){return this.num.length},multiply:function(s){for(var a=new Array(this.getLength()+s.getLength()-1),o=0;o<this.getLength();o++)for(var u=0;u<s.getLength();u++)a[o+u]^=n.gexp(n.glog(this.get(o))+n.glog(s.get(u)));return new t(a,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var a=n.glog(this.get(0))-n.glog(s.get(0)),o=new Array(this.getLength()),u=0;u<this.getLength();u++)o[u]=this.get(u);for(var u=0;u<s.getLength();u++)o[u]^=n.gexp(n.glog(s.get(u))+a);return new t(o,0).mod(s)}},Af=t,Af}var Of,xx;function kN(){if(xx)return Of;xx=1;var n=ab(),t=ob(),s=lb(),a={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;o.getBCHDigit(d)-o.getBCHDigit(o.G15)>=0;)d^=o.G15<<o.getBCHDigit(d)-o.getBCHDigit(o.G15);return(u<<10|d)^o.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;o.getBCHDigit(d)-o.getBCHDigit(o.G18)>=0;)d^=o.G18<<o.getBCHDigit(d)-o.getBCHDigit(o.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return o.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,h){switch(u){case a.PATTERN000:return(d+h)%2==0;case a.PATTERN001:return d%2==0;case a.PATTERN010:return h%3==0;case a.PATTERN011:return(d+h)%3==0;case a.PATTERN100:return(Math.floor(d/2)+Math.floor(h/3))%2==0;case a.PATTERN101:return d*h%2+d*h%3==0;case a.PATTERN110:return(d*h%2+d*h%3)%2==0;case a.PATTERN111:return(d*h%3+(d+h)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),h=0;h<u;h++)d=d.multiply(new t([1,s.gexp(h)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),h=0,f=0;f<d;f++)for(var m=0;m<d;m++){for(var y=0,v=u.isDark(f,m),x=-1;x<=1;x++)if(!(f+x<0||d<=f+x))for(var w=-1;w<=1;w++)m+w<0||d<=m+w||x==0&&w==0||v==u.isDark(f+x,m+w)&&y++;y>5&&(h+=3+y-5)}for(var f=0;f<d-1;f++)for(var m=0;m<d-1;m++){var _=0;u.isDark(f,m)&&_++,u.isDark(f+1,m)&&_++,u.isDark(f,m+1)&&_++,u.isDark(f+1,m+1)&&_++,(_==0||_==4)&&(h+=3)}for(var f=0;f<d;f++)for(var m=0;m<d-6;m++)u.isDark(f,m)&&!u.isDark(f,m+1)&&u.isDark(f,m+2)&&u.isDark(f,m+3)&&u.isDark(f,m+4)&&!u.isDark(f,m+5)&&u.isDark(f,m+6)&&(h+=40);for(var m=0;m<d;m++)for(var f=0;f<d-6;f++)u.isDark(f,m)&&!u.isDark(f+1,m)&&u.isDark(f+2,m)&&u.isDark(f+3,m)&&u.isDark(f+4,m)&&!u.isDark(f+5,m)&&u.isDark(f+6,m)&&(h+=40);for(var E=0,m=0;m<d;m++)for(var f=0;f<d;f++)u.isDark(f,m)&&E++;var j=Math.abs(100*E/d/d-50)/5;return h+=j*10,h}};return Of=o,Of}var Df,bx;function TN(){if(bx)return Df;bx=1;var n=CN(),t=EN(),s=NN(),a=kN(),o=ob();function u(h,f){this.typeNumber=h,this.errorCorrectLevel=f,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(h){var f=new n(h);this.dataList.push(f),this.dataCache=null},d.isDark=function(h,f){if(h<0||this.moduleCount<=h||f<0||this.moduleCount<=f)throw new Error(h+","+f);return this.modules[h][f]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var h=1;for(h=1;h<40;h++){for(var f=t.getRSBlocks(h,this.errorCorrectLevel),m=new s,y=0,v=0;v<f.length;v++)y+=f[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];m.put(x.mode,4),m.put(x.getLength(),a.getLengthInBits(x.mode,h)),x.write(m)}if(m.getLengthInBits()<=y*8)break}this.typeNumber=h}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(h,f){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++){this.modules[m]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[m][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(h,f),this.typeNumber>=7&&this.setupTypeNumber(h),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,f)},d.setupPositionProbePattern=function(h,f){for(var m=-1;m<=7;m++)if(!(h+m<=-1||this.moduleCount<=h+m))for(var y=-1;y<=7;y++)f+y<=-1||this.moduleCount<=f+y||(0<=m&&m<=6&&(y==0||y==6)||0<=y&&y<=6&&(m==0||m==6)||2<=m&&m<=4&&2<=y&&y<=4?this.modules[h+m][f+y]=!0:this.modules[h+m][f+y]=!1)},d.getBestMaskPattern=function(){for(var h=0,f=0,m=0;m<8;m++){this.makeImpl(!0,m);var y=a.getLostPoint(this);(m==0||h>y)&&(h=y,f=m)}return f},d.createMovieClip=function(h,f,m){var y=h.createEmptyMovieClip(f,m),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var w=x*v,_=0;_<this.modules[x].length;_++){var E=_*v,j=this.modules[x][_];j&&(y.beginFill(0,100),y.moveTo(E,w),y.lineTo(E+v,w),y.lineTo(E+v,w+v),y.lineTo(E,w+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var h=8;h<this.moduleCount-8;h++)this.modules[h][6]==null&&(this.modules[h][6]=h%2==0);for(var f=8;f<this.moduleCount-8;f++)this.modules[6][f]==null&&(this.modules[6][f]=f%2==0)},d.setupPositionAdjustPattern=function(){for(var h=a.getPatternPosition(this.typeNumber),f=0;f<h.length;f++)for(var m=0;m<h.length;m++){var y=h[f],v=h[m];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var w=-2;w<=2;w++)x==-2||x==2||w==-2||w==2||x==0&&w==0?this.modules[y+x][v+w]=!0:this.modules[y+x][v+w]=!1}},d.setupTypeNumber=function(h){for(var f=a.getBCHTypeNumber(this.typeNumber),m=0;m<18;m++){var y=!h&&(f>>m&1)==1;this.modules[Math.floor(m/3)][m%3+this.moduleCount-8-3]=y}for(var m=0;m<18;m++){var y=!h&&(f>>m&1)==1;this.modules[m%3+this.moduleCount-8-3][Math.floor(m/3)]=y}},d.setupTypeInfo=function(h,f){for(var m=this.errorCorrectLevel<<3|f,y=a.getBCHTypeInfo(m),v=0;v<15;v++){var x=!h&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!h&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!h},d.mapData=function(h,f){for(var m=-1,y=this.moduleCount-1,v=7,x=0,w=this.moduleCount-1;w>0;w-=2)for(w==6&&w--;;){for(var _=0;_<2;_++)if(this.modules[y][w-_]==null){var E=!1;x<h.length&&(E=(h[x]>>>v&1)==1);var j=a.getMask(f,y,w-_);j&&(E=!E),this.modules[y][w-_]=E,v--,v==-1&&(x++,v=7)}if(y+=m,y<0||this.moduleCount<=y){y-=m,m=-m;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(h,f,m){for(var y=t.getRSBlocks(h,f),v=new s,x=0;x<m.length;x++){var w=m[x];v.put(w.mode,4),v.put(w.getLength(),a.getLengthInBits(w.mode,h)),w.write(v)}for(var _=0,x=0;x<y.length;x++)_+=y[x].dataCount;if(v.getLengthInBits()>_*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+_*8+")");for(v.getLengthInBits()+4<=_*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=_*8||(v.put(u.PAD0,8),v.getLengthInBits()>=_*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(h,f){for(var m=0,y=0,v=0,x=new Array(f.length),w=new Array(f.length),_=0;_<f.length;_++){var E=f[_].dataCount,j=f[_].totalCount-E;y=Math.max(y,E),v=Math.max(v,j),x[_]=new Array(E);for(var N=0;N<x[_].length;N++)x[_][N]=255&h.buffer[N+m];m+=E;var k=a.getErrorCorrectPolynomial(j),O=new o(x[_],k.getLength()-1),U=O.mod(k);w[_]=new Array(k.getLength()-1);for(var N=0;N<w[_].length;N++){var D=N+U.getLength()-w[_].length;w[_][N]=D>=0?U.get(D):0}}for(var C=0,N=0;N<f.length;N++)C+=f[N].totalCount;for(var M=new Array(C),T=0,N=0;N<y;N++)for(var _=0;_<f.length;_++)N<x[_].length&&(M[T++]=x[_][N]);for(var N=0;N<v;N++)for(var _=0;_<f.length;_++)N<w[_].length&&(M[T++]=w[_][N]);return M},Df=u,Df}var fu={},wx;function RN(){if(wx)return fu;wx=1,Object.defineProperty(fu,"__esModule",{value:!0});var n=Object.assign||function(m){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(m[x]=v[x])}return m},t=sb(),s=u(t),a=Mo(),o=u(a);function u(m){return m&&m.__esModule?m:{default:m}}function d(m,y){var v={};for(var x in m)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(m,x)&&(v[x]=m[x]);return v}var h={bgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,bgD:s.default.string.isRequired,fgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,fgD:s.default.string.isRequired,size:s.default.number.isRequired,title:s.default.string,viewBoxSize:s.default.number.isRequired,xmlns:s.default.string},f=(0,a.forwardRef)(function(m,y){var v=m.bgColor,x=m.bgD,w=m.fgD,_=m.fgColor,E=m.size,j=m.title,N=m.viewBoxSize,k=m.xmlns,O=k===void 0?"http://www.w3.org/2000/svg":k,U=d(m,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return o.default.createElement("svg",n({},U,{height:E,ref:y,viewBox:"0 0 "+N+" "+N,width:E,xmlns:O}),j?o.default.createElement("title",null,j):null,o.default.createElement("path",{d:x,fill:v}),o.default.createElement("path",{d:w,fill:_}))});return f.displayName="QRCodeSvg",f.propTypes=h,fu.default=f,fu}var Sx;function AN(){if(Sx)return Fa;Sx=1,Object.defineProperty(Fa,"__esModule",{value:!0}),Fa.QRCode=void 0;var n=Object.assign||function(E){for(var j=1;j<arguments.length;j++){var N=arguments[j];for(var k in N)Object.prototype.hasOwnProperty.call(N,k)&&(E[k]=N[k])}return E},t=sb(),s=v(t),a=ib(),o=v(a),u=TN(),d=v(u),h=Mo(),f=v(h),m=RN(),y=v(m);function v(E){return E&&E.__esModule?E:{default:E}}function x(E,j){var N={};for(var k in E)j.indexOf(k)>=0||Object.prototype.hasOwnProperty.call(E,k)&&(N[k]=E[k]);return N}var w={bgColor:s.default.oneOfType([s.default.object,s.default.string]),fgColor:s.default.oneOfType([s.default.object,s.default.string]),level:s.default.string,size:s.default.number,value:s.default.string.isRequired},_=(0,h.forwardRef)(function(E,j){var N=E.bgColor,k=N===void 0?"#FFFFFF":N,O=E.fgColor,U=O===void 0?"#000000":O,D=E.level,C=D===void 0?"L":D,M=E.size,T=M===void 0?256:M,H=E.value,K=x(E,["bgColor","fgColor","level","size","value"]),F=new d.default(-1,o.default[C]);F.addData(H),F.make();var q=F.modules;return f.default.createElement(y.default,n({},K,{bgColor:k,bgD:q.map(function(V,P){return V.map(function(L,A){return L?"":"M "+A+" "+P+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:U,fgD:q.map(function(V,P){return V.map(function(L,A){return L?"M "+A+" "+P+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:j,size:T,viewBoxSize:q.length}))});return Fa.QRCode=_,_.displayName="QRCode",_.propTypes=w,Fa.default=_,Fa}var ON=AN();const DN=$x(ON),jx=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},MN=n=>{if(n==null)return NaN;if(typeof n=="number")return Number.isFinite(n)?n:NaN;const t=String(n).trim().replace(/[,\s]/g,"");if(!t)return NaN;const s=parseFloat(t);return Number.isFinite(s)?s:NaN},ls=(n,{maximumFractionDigits:t=1}={})=>{const s=MN(n);return Number.isFinite(s)?`${s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}`:null},zN=new Set(["food","alcohol","soft_drink","supplies"]),cb=new Set(["alcohol","supplies"]),ub=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":zN.has(t)?t:"":""},sp=n=>{const t=ub(n?.itemCategory??n?.item_category);return t?cb.has(t):!!n?.isAlcohol},Bi=n=>sp(n)?1.1:1.08,_x=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),UN=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const a=_x(t);if(!a)return null;for(const[o,u]of n.entries())if(_x(o)===a)return u;return null},Us=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},LN=n=>{const t=Us(n);return!Number.isFinite(t)||t<=0||t>100?100:t},IN=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return LN(s)/100},BN=(n,t,s)=>{const a=Us(n),o=Us(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},Cx=(n,t,s,{defaultWeightWhenUnitEmpty:a=!1,forceWeightBased:o=!1,yieldRate:u=1}={})=>{const d=Us(n),h=Us(t);if(!Number.isFinite(d)||!Number.isFinite(h))return NaN;const f=Number.isFinite(u)&&u>0?u:1,m=String(s||"").trim().toLowerCase();return o||!m&&a||["g","","ml","","cc",""].includes(m)?d/1e3*h/f:d*h/f},$N=(n,t)=>{const s=Us(n?.purchaseCost),a=Us(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-t)>.01):!1},PN=({recipe:n,ownerLabel:t,onBack:s,onEdit:a,onDelete:o,onHardDelete:u,isDeleted:d,onView:h,onDuplicate:f,backLabel:m,onList:y})=>{const{user:v}=es(),x=ea(),[w,_]=be.useState(!1),[E,j]=be.useState(!1),[N,k]=be.useState(!1),[O,U]=be.useState(new Set),[D,C]=be.useState(new Set),[M,T]=be.useState(new Set),[H,K]=be.useState({}),[F,q]=be.useState("ORIGINAL"),[V,P]=be.useState(!1),[L,A]=be.useState(!0),[$,Y]=be.useState(!1),[le,me]=be.useState(new Map),[B,W]=be.useState(""),[J,ge]=be.useState(1),[ze,Re]=be.useState(""),[he,I]=be.useState(""),te=be.useMemo(()=>{const ne=parseFloat(J);return isNaN(ne)?1:ne},[J]),ye=(ne,ee)=>{if(!ne)return"";const ue=parseFloat(ne);if(isNaN(ue))return ne;const je=ue*parseFloat(ee);return Number.isInteger(je)?je.toString():je.toFixed(1).replace(/\.0$/,"")},Ne=(ne,ee)=>{if(!ne)return"";const ue=parseFloat(ne);return isNaN(ue)?ne:(ue*parseFloat(ee)).toFixed(2).replace(/\.00$/,"")},[Oe,qe]=be.useState(n),[$e,Je]=be.useState(!1),pe=F==="ORIGINAL"?Oe:H[F]||Oe;be.useEffect(()=>{let ne=!0;return Pn.getAllConversions().then(ee=>{ne&&me(ee)}).catch(()=>{ne&&me(new Map)}),()=>{ne=!1}},[]);const Xe=be.useMemo(()=>{const ne=(ee,ue={})=>{if(!ee||typeof ee!="object")return ee;const je=UN(le,ee.name),Be=ub(ee.itemCategory??ee.item_category??je?.itemCategory),Ze=IN(ee,je);let Ye=ee;if(Be&&(Ye={...Ye,itemCategory:Be,isAlcohol:cb.has(Be)}),!je||!je.packetSize){const Ue=String(ee.unit||"").trim();if(ue.forceWeightBased||ue.defaultWeightWhenUnitEmpty&&!Ue){const Ht=Cx(ee.quantity,Ye.purchaseCost,ee.unit,{...ue,yieldRate:Ze}),En=Number.isFinite(Ht)?Math.round(Ht*100)/100:NaN,kt=Us(Ye.cost);if(Number.isFinite(En)&&(!Number.isFinite(kt)||Math.abs(kt-En)>.01))return{...Ye,cost:En}}return Ye}const Le=[je.lastPrice,ee.purchaseCostRef,ee.purchase_cost,ee.purchaseCost].find(Ue=>Number.isFinite(Us(Ue))),Ge=BN(Le,je.packetSize,je.packetUnit);if(!Number.isFinite(Ge)||!$N(ee,Ge))return Ye;const Ct=Cx(ee.quantity,Ge,ee.unit,{...ue,yieldRate:Ze});return{...Ye,purchaseCost:Math.round(Ge*100)/100,cost:Number.isFinite(Ct)?Math.round(Ct*100)/100:Ye.cost}};return{...pe,ingredients:(pe.ingredients||[]).map(ee=>ne(ee)),flours:(pe.flours||[]).map(ee=>ne(ee,{forceWeightBased:!0})),breadIngredients:(pe.breadIngredients||[]).map(ee=>ne(ee,{forceWeightBased:!0}))}},[le,pe]);be.useEffect(()=>{qe(n),!n.steps&&!d&&(Je(!0),bn.getRecipe(n.id).then(ne=>{qe(ne)}).catch(ne=>{console.error("Failed to load details",ne)}).finally(()=>{Je(!1)}))},[n,d]);const[ot,jt]=be.useState(n.tags?.includes("public")||!1),ke=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),it=!(n.tags&&n.tags.some(ne=>ne.startsWith("owner:")))||ke,Mt=async()=>{const ne=!ot;try{const ee=n.tags||[];let ue;ne?ue=[...ee,"public"]:ue=ee.filter(je=>je!=="public"),jt(ne),await bn.updateRecipe({id:n.id,tags:ue})}catch(ee){console.error("Failed to toggle public",ee),x.error(""),jt(!ne)}},yt=(ne,ee,ue=!1)=>F==="ORIGINAL"||!L||!ee||ne===ee?ne:i.jsxs(i.Fragment,{children:[ne,ue?i.jsx("br",{}):" ",i.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",ee,")"]})]}),ie=async ne=>{const ee=ne.target.value;if(q(ee),ee!=="ORIGINAL"&&!H[ee]){P(!0);try{const ue=await mN.translateRecipe(n,ee);K(je=>({...je,[ee]:ue}))}catch(ue){console.error(ue),x.error(""),q("ORIGINAL")}finally{P(!1)}}},_e=ne=>{U(ee=>{const ue=new Set(ee);return ue.has(ne)?ue.delete(ne):ue.add(ne),ue})},Ee=ne=>{C(ee=>{const ue=new Set(ee);return ue.has(ne)?ue.delete(ne):ue.add(ne),ue})},Ie=ne=>{T(ee=>{const ue=new Set(ee);return ue.has(ne)?ue.delete(ne):ue.add(ne),ue})};be.useEffect(()=>{window.scrollTo(0,0),h&&n&&!d&&h(n.id);const ne=document.title;return n&&n.title&&(document.title=n.title),K({}),q("ORIGINAL"),U(new Set),C(new Set),T(new Set),jt(n.tags?.includes("public")||!1),()=>{document.title=ne}},[n.id,n.title]),be.useEffect(()=>{n&&n.servings?I(n.servings.toString()):I(""),Re("")},[n]);const ct=()=>{_(!0)},pt=()=>{_(!1),o(n)},Rt=()=>{_(!1)},Jt=()=>{k(!0)},Sn=()=>{k(!1),u(n)},_t=()=>{k(!1)},rn=()=>{j(!0)},cn=async()=>{j(!1);try{const ne=await bn.duplicateRecipe(n,v);f&&f(ne)}catch(ne){console.error("Duplication failed",ne),x.error("")}},xn=()=>{j(!1)},Ln=be.useRef(null),ar=be.useRef(null),fe=ne=>{ar.current=null,Ln.current=ne.targetTouches[0].clientX},Ve=ne=>{ar.current=ne.targetTouches[0].clientX},et=()=>{if(!Ln.current||!ar.current)return;const ne=Ln.current-ar.current,ee=Ln.current<50,ue=ne<-100;ee&&ue&&s()},Ke=ne=>{const ee=Math.round(parseFloat(ne)),ue=parseFloat(ze),je=parseFloat(he);let Be=null,Ze=null,Ye=null;return!isNaN(ee)&&!isNaN(je)&&je>0&&(Ye=ee/je),!isNaN(ee)&&!isNaN(ue)&&!isNaN(je)&&ue>0&&je>0&&(Ze=ue*je,Be=ee/Ze*100),i.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[i.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("span",{children:["  ",i.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),i.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),i.jsx("input",{type:"number",value:ze,onChange:G=>Re(G.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),i.jsx("input",{type:"number",value:he,onChange:G=>I(G.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Ye!==null&&i.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Be!==null?Be>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Be!==null?Be>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Be!==null?"6px":"0"},children:["1(): ",i.jsxs("strong",{children:["",Ye.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Be!==null&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",Ze.toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(Ze-ee).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Be>40?"#d32f2f":"#2e7d32"},children:[": ",Be.toFixed(1),"%"]})]})]})]})]})},nt=Xe.ingredients||[];let zt=pe.steps||[];const bt=ne=>String(ne||"").trim().toLowerCase(),At=ne=>{const ee=bt(ne);return ee?["","","steps","method"].some(ue=>ee===ue||ee.includes(ue)):!1};if(!zt.length&&pe.ingredientGroups){const ne=pe.ingredientGroups.find(ee=>At(ee.name));if(ne)zt=nt.filter(ue=>ue.groupId===ne.id).map(ue=>typeof ue=="string"?ue:{...ue,text:ue.name||ue.text||""});else{const ee=nt.filter(ue=>At(ue.group)||At(ue.groupName));ee.length&&(zt=ee.map(ue=>typeof ue=="string"?ue:{...ue,text:ue.name||ue.text||""}))}}const tt=zt,$t=be.useMemo(()=>{const ne=pe.ingredientGroups||[],ee=["","steps","method",""],ue=G=>String(G||"").trim().toLowerCase(),je=new Set(ne.filter(G=>ee.includes(ue(G.name))).map(G=>G.id)),Be=ne.filter(G=>!je.has(G.id));if(!Be.length)return[{id:"default",name:null,items:nt.filter(G=>!je.has(G.groupId))}];const Ze=Be.map(G=>{const Le=nt.filter(Ge=>Ge.groupId===G.id);return{id:G.id,name:G.name===""?null:G.name,items:Le}}).filter(G=>G.items.length>0),Ye=nt.filter(G=>G.groupId?je.has(G.groupId)?!1:!Be.some(Le=>Le.id===G.groupId):!0);return Ye.length&&Ze.push({id:"ungrouped",name:null,items:Ye}),Ze.length?Ze:[{id:"default",name:null,items:nt.filter(G=>!je.has(G.groupId))}]},[pe.ingredientGroups,nt]),Qe=be.useMemo(()=>{if(pe.type!=="bread")return null;const ne=Xe.flours||[],ee=Xe.breadIngredients||[],ue=ne.reduce((Ue,ft)=>Ue+(parseFloat(ft.quantity)||0),0),je=ue+ee.reduce((Ue,ft)=>Ue+(parseFloat(ft.quantity)||0),0),Be=parseFloat(B),Ze=Be&&je?Be/je:1,Ye=Ue=>ue?((parseFloat(Ue)||0)/ue*100).toFixed(1):"0.0",G=Ue=>Be?((parseFloat(Ue)||0)*Ze).toFixed(1):Ue,Le=Ue=>{const ft=parseFloat(Ue)||0;if(!Be)return ft;const Ht=ft*Ze;return Math.round(Ht*100)/100},Ge=Ue=>{const ft=Le(Ue);return Number.isFinite(ft)?ft.toLocaleString(void 0,{maximumFractionDigits:2}):""},Ct=Ue=>Ue.reduce((ft,Ht)=>{const kt=(parseFloat(Ht.cost)||0)*(Be?Ze:1),Vn=Bi(Ht);return ft+kt*Vn},0);return{flours:ne,others:ee,totalFlour:ue,grandTotal:je,calcPercent:Ye,getScaledQtyValue:G,getScaledCostValue:Le,formatCostValue:Ge,scaleFactor:Ze,totalTaxIncluded:Ct(ne)+Ct(ee)}},[Xe.breadIngredients,Xe.flours,pe.type,B]),Lt=be.useMemo(()=>pe.type==="bread"?0:nt.reduce((ne,ee)=>{const je=(parseFloat(ee.cost)||0)*te,Be=Bi(ee);return ne+je*Be},0),[pe.type,nt,te]),Xt=pe.type==="bread"?Qe?Math.round(Qe.totalTaxIncluded).toLocaleString():"0":Math.round(Lt).toLocaleString(),Qt=pe.description||n.description;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:fe,onTouchMove:Ve,onTouchEnd:et,children:[E&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(re,{variant:"ghost",onClick:xn,children:""}),i.jsx(re,{variant:"primary",onClick:cn,children:""})]})]})}),N&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(re,{variant:"ghost",onClick:_t,children:""}),i.jsx(re,{variant:"danger",onClick:Sn,children:""})]})]})}),w&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("small",{style:{color:"#666"},children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(re,{variant:"ghost",onClick:Rt,children:""}),i.jsx(re,{variant:"danger",onClick:pt,children:""})]})]})}),i.jsxs("div",{className:"recipe-detail__header",children:[i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx(re,{variant:"secondary",onClick:s,size:"sm",children:m||" "}),y&&i.jsx(re,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&i.jsxs("div",{className:"recipe-detail__actions",children:[it&&(v?.displayId==="yoshito"||v?.role==="admin")&&i.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:i.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:ot,onChange:Mt,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),i.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:ot?"#4CAF50":"#888"},children:ot?"":""})]})}),!it&&i.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),i.jsxs("select",{className:"language-select",value:F,onChange:ie,disabled:V,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[i.jsx("option",{value:"ORIGINAL",children:" Original ()"}),SN.map(ne=>i.jsx("option",{value:ne.code,children:ne.label},ne.code))]}),F!=="ORIGINAL"&&i.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[i.jsx("input",{type:"checkbox",checked:L,onChange:ne=>A(ne.target.checked),style:{marginRight:"4px"}}),""]}),i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>Y(!0),children:" "}),i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),i.jsx(re,{variant:"secondary",size:"sm",onClick:rn,children:""}),it&&i.jsxs(i.Fragment,{children:[i.jsx(re,{variant:"secondary",size:"sm",onClick:a,children:""}),i.jsx(re,{variant:"danger",size:"sm",onClick:ct,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&i.jsxs("div",{className:"recipe-detail__actions",children:[i.jsx(re,{variant:"ghost",size:"sm",onClick:Jt,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),i.jsx(re,{variant:"primary",size:"sm",onClick:()=>o(n,!0),children:""})]})]}),i.jsx("div",{className:"recipe-detail__hero",children:pe.image?i.jsx("img",{src:pe.image,alt:pe.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),i.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[i.jsx("h1",{children:yt(pe.title,n.title)}),i.jsx("p",{className:"recipe-detail__desc",children:yt(pe.description,n.description,!0)}),v?.role==="admin"&&t&&i.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),i.jsxs("div",{className:"recipe-detail__meta",children:[pe.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:yt(pe.course,n.course)})]}),pe.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:yt(pe.category,n.category)})]}),pe.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:yt(pe.storeName,n.storeName)})]}),i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[pe.servings,""]})]})]}),pe.sourceUrl&&i.jsxs("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsx("div",{style:{fontSize:"0.85rem"},children:i.jsxs("a",{href:pe.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",i.jsx("span",{className:"screen-only",children:""}),i.jsx("span",{className:"print-only",children:""})]})}),i.jsx("div",{style:{background:"white",padding:"4px",width:"fit-content"},children:i.jsx(DN,{value:pe.sourceUrl,size:128,style:{display:"block"}})})]})]}),i.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[i.jsxs("span",{children:[" : ",jx(n.created_at)]}),n.updated_at&&i.jsxs("span",{children:[" : ",jx(n.updated_at)]})]}),i.jsx("div",{className:"recipe-detail__content",children:i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),i.jsx(tn,{className:"ingredients-card",children:pe.type==="bread"?i.jsx("div",{className:"bread-detail-view",children:(()=>{const ne=Xe.flours||[],ee=Xe.breadIngredients||[],ue=ne.reduce((Ue,ft)=>Ue+(parseFloat(ft.quantity)||0),0),je=ue+ee.reduce((Ue,ft)=>Ue+(parseFloat(ft.quantity)||0),0),Be=ue?(je/ue*100).toFixed(1):"0.0",Ze=Ue=>ue?((parseFloat(Ue)||0)/ue*100).toFixed(1):"0.0",Ye=parseFloat(B),G=Ye&&je?Ye/je:1,Le=Ue=>Ye?((parseFloat(Ue)||0)*G).toFixed(1):Ue,Ge=Ue=>{const ft=parseFloat(Ue)||0;if(!Ye)return ft;const Ht=ft*G;return Math.round(Ht*100)/100},Ct=Ue=>Number.isFinite(Ue)?Ue.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[je.toLocaleString(),"g"]}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Be,"%)"]})]}),i.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("input",{id:"target-total-input",type:"number",value:B,onChange:Ue=>W(Ue.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),i.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),B&&i.jsx(re,{variant:"ghost",size:"sm",onClick:()=>W(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),B&&i.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",G.toFixed(3)," "]})]}),i.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[i.jsx("span",{children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",B?Le(ue):ue,"g (100%)"]})]}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:ne.map((Ue,ft)=>{const Ht=n.flours?.[ft]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`flour-${ft}`}),i.jsx("label",{htmlFor:`flour-${ft}`,children:yt(Ue.name,Ht?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:B?i.jsx("span",{style:{color:"var(--color-primary)"},children:Le(Ue.quantity)}):Ue.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[Ze(Ue.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ls(Ue.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:Ue.cost?`${Ct(Ge(Ue.cost))}`:"-"})]},ft)})})]})]}),i.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[i.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:ee.map((Ue,ft)=>{const Ht=n.breadIngredients?.[ft]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ingredient-${ft}`}),i.jsx("label",{htmlFor:`ingredient-${ft}`,children:yt(Ue.name,Ht?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:B?i.jsx("span",{style:{color:"var(--color-primary)"},children:Le(Ue.quantity)}):Ue.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[Ze(Ue.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ls(Ue.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:Ue.cost?`${Ct(Ge(Ue.cost))}`:"-"})]},ft)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const Ue=Ht=>Ht.reduce((En,kt)=>{const Vn=parseFloat(kt.cost)||0,sn=Bi(kt),Nt=Vn*G;return En+Nt*sn},0),ft=Ue(ne)+Ue(ee);return Math.round(ft).toLocaleString()})()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const Ue=Ht=>Ht.reduce((En,kt)=>{const Vn=parseFloat(kt.cost)||0,sn=Bi(kt),Nt=Vn*G;return En+Nt*sn},0),ft=Ue(ne)+Ue(ee);return Ke(ft)})()]})]})})()}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[i.jsx("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:":"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),i.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:J,onChange:ne=>ge(ne.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(J)!==1&&i.jsx(re,{variant:"ghost",size:"sm",onClick:()=>ge("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const ne=pe.ingredientGroups&&pe.ingredientGroups.length>0?pe.ingredientGroups:null;return ne?ne.map(ee=>{const ue=nt.filter(je=>je.groupId===ee.id);return ue.length===0||["","Steps","Method",""].includes(ee.name)?null:i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(ee.name)?"none":"block"},children:ee.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:ue.map((je,Be)=>{const Ze=nt.indexOf(je),Ye=n.ingredients?.[Ze],G=typeof je=="string"?je:je.name,Le=Ye?typeof Ye=="string"?Ye:Ye.name:"",Ge=ye(je.quantity,J),Ct=Ne(je.cost,J),Ue=String(J)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${ee.id}-${Be}`}),i.jsx("label",{htmlFor:`ing-${ee.id}-${Be}`,children:yt(G,Le)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Ue?"bold":"normal",color:Ue?"var(--color-primary)":"inherit"},children:Ge}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:je.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ls(je.purchaseCost)??"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[ls(Ct)??"-",sp(je)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Be)})})]})]},ee.id)}):i.jsxs(i.Fragment,{children:[i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:nt.map((ee,ue)=>{const je=n.ingredients?.[ue],Be=typeof ee=="string"?ee:ee.name,Ze=je?typeof je=="string"?je:je.name:"",Ye=ye(ee.quantity,J),G=Ne(ee.cost,J),Le=String(J)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${ue}`}),i.jsx("label",{htmlFor:`ing-${ue}`,children:yt(Be,Ze)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Le?"bold":"normal",color:Le?"var(--color-primary)":"inherit"},children:Ye}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:ee.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ls(ee.purchaseCost)??"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[ls(G)??"-",sp(ee)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},ue)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ue=>ue.reduce((je,Be)=>{const Ze=parseFloat(Be.cost)||0,Ye=Bi(Be),G=Ne(Ze,J),Le=parseFloat(G)||0;return je+Le*Ye},0))(nt)).toLocaleString()]})]})]})})(),i.jsx("div",{className:"screen-only no-print",children:i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ee=>ee.reduce((ue,je)=>{const Be=parseFloat(je.cost)||0,Ze=Bi(je),Ye=Ne(Be,J),G=parseFloat(Ye)||0;return ue+G*Ze},0))(nt)).toLocaleString()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]})}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const ee=(ue=>ue.reduce((je,Be)=>{const Ze=parseFloat(Be.cost)||0,Ye=Bi(Be),G=parseFloat(Ne(Ze,J))||0;return je+G*Ye},0))(nt);return Ke(ee)})()]})})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),(()=>{const ne=pe.stepGroups&&pe.stepGroups.length>0?pe.stepGroups:null,ee=ne&&tt.some(ue=>!ue||typeof ue!="object"||!ue.groupId?!1:ne.some(je=>je.id===ue.groupId));return ne&&ee?i.jsx("div",{className:"steps-container",children:ne.map(ue=>{const je=tt.filter(Be=>(typeof Be=="object"?Be.groupId:null)===ue.id);return je.length===0?null:i.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[ue.name!==""&&ue.name!=="Steps"&&i.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:ue.name}),i.jsx("div",{className:"steps-list",children:je.map((Be,Ze)=>{const Ye=tt.indexOf(Be),G=typeof Be=="object"?Be.text:Be,Le=n.steps?.[Ye],Ge=typeof Le=="object"?Le.text:Le,Ct=Ue=>Ue?Ue.replace(/<[^>]*>?/gm,""):"";return i.jsxs(tn,{className:`step-card ${O.has(Ye)?"is-completed":""}`,onClick:()=>_e(Ye),children:[i.jsx("div",{className:"step-number",children:Ye+1}),i.jsx("p",{className:"step-text",children:yt(Ct(G),Ct(Ge),!0)})]},Ze)})})]},ue.id)})}):i.jsx("div",{className:"steps-list",children:tt.map((ue,je)=>{const Be=typeof ue=="object"?ue.text:ue,Ze=n.steps?.[je],Ye=typeof Ze=="object"?Ze.text:Ze;return i.jsxs(tn,{className:`step-card ${O.has(je)?"is-completed":""}`,onClick:()=>_e(je),children:[i.jsx("div",{className:"step-number",children:je+1}),i.jsx("p",{className:"step-text",children:yt(Be,Ye,!0)})]},je)})})})()]})]})}),i.jsx(pn,{isOpen:$,onClose:()=>Y(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-recipe",children:[i.jsx("div",{className:"preview-header",children:i.jsx("h2",{children:pe.title})}),i.jsxs("div",{className:"preview-meta",children:[pe.course&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",pe.course]}),pe.category&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",pe.category]}),pe.storeName&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",pe.storeName]}),pe.servings&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",pe.servings,""]})]}),pe.description&&i.jsx("div",{className:"preview-description",children:i.jsx("p",{children:pe.description})}),i.jsx("div",{className:"preview-controls",children:pe.type==="bread"?i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),i.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:B,onChange:ne=>W(ne.target.value),placeholder:"1000"}),B&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>W(""),children:""}),Qe?.grandTotal?i.jsxs("span",{className:"preview-control-note",children:[": ",Qe.grandTotal.toLocaleString(),"g"]}):null]}):i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:""}),i.jsx("span",{className:"preview-control-mult",children:""}),i.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:J,onChange:ne=>ge(ne.target.value),placeholder:"1"}),String(J)!=="1"&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>ge("1"),children:""})]})}),i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),pe.type==="bread"?i.jsxs("div",{className:"preview-ingredients-bread",children:[i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Xe.flours||[]).map((ne,ee)=>{const ue=`flour-${ee}`,je=Qe?Qe.getScaledQtyValue(ne.quantity):ne.quantity;return i.jsxs("tr",{className:M.has(ue)?"is-completed":"",onClick:()=>Ie(ue),role:"button",tabIndex:0,onKeyDown:Be=>{(Be.key==="Enter"||Be.key===" ")&&(Be.preventDefault(),Ie(ue))},children:[i.jsx("td",{children:ne.name}),i.jsxs("td",{style:{textAlign:"right"},children:[je,"g"]})]},ee)})})]})]}),i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Xe.breadIngredients||[]).map((ne,ee)=>{const ue=`bread-${ee}`,je=Qe?Qe.getScaledQtyValue(ne.quantity):ne.quantity;return i.jsxs("tr",{className:M.has(ue)?"is-completed":"",onClick:()=>Ie(ue),role:"button",tabIndex:0,onKeyDown:Be=>{(Be.key==="Enter"||Be.key===" ")&&(Be.preventDefault(),Ie(ue))},children:[i.jsx("td",{children:ne.name}),i.jsxs("td",{style:{textAlign:"right"},children:[je,"g"]})]},ee)})})]})]})]}):i.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const ne=pe.ingredientGroups&&pe.ingredientGroups.length>0?pe.ingredientGroups:null;return ne?ne.map(ee=>{const ue=nt.filter(je=>je.groupId===ee.id);return ue.length===0||["","Steps","Method",""].includes(ee.name)?null:i.jsxs("div",{className:"ingredient-group",children:[i.jsx("h4",{children:ee.name}),i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:ue.map((je,Be)=>{const Ze=`${ee.id}-${Be}`,Ye=typeof je=="string"?je:je.name,G=typeof je=="object"?ye(je.quantity,te):"",Le=typeof je=="object"?je.unit:"";return i.jsxs("tr",{className:M.has(Ze)?"is-completed":"",onClick:()=>Ie(Ze),role:"button",tabIndex:0,onKeyDown:Ge=>{(Ge.key==="Enter"||Ge.key===" ")&&(Ge.preventDefault(),Ie(Ze))},children:[i.jsx("td",{children:Ye}),i.jsx("td",{style:{textAlign:"right"},children:G}),i.jsx("td",{children:Le})]},Be)})})]})]},ee.id)}):i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:nt.map((ee,ue)=>{const je=`ungrouped-${ue}`,Be=typeof ee=="string"?ee:ee.name,Ze=typeof ee=="object"?ye(ee.quantity,te):"",Ye=typeof ee=="object"?ee.unit:"";return i.jsxs("tr",{className:M.has(je)?"is-completed":"",onClick:()=>Ie(je),role:"button",tabIndex:0,onKeyDown:G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),Ie(je))},children:[i.jsx("td",{children:Be}),i.jsx("td",{style:{textAlign:"right"},children:Ze}),i.jsx("td",{children:Ye})]},ue)})})]})})()})]}),tt.length>0&&i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),i.jsx("ol",{className:"preview-steps",children:tt.map((ne,ee)=>{const ue=typeof ne=="object"?ne.text:ne;return i.jsx("li",{className:D.has(ee)?"is-completed":"",onClick:()=>Ee(ee),role:"button",tabIndex:0,onKeyDown:je=>{(je.key==="Enter"||je.key===" ")&&(je.preventDefault(),Ee(ee))},children:ue},ee)})})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(re,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(re,{variant:"ghost",onClick:()=>Y(!1),children:""})]})]})})]}),i.jsxs("div",{className:"print-layout",children:[i.jsx("div",{className:"recipe-detail__hero",children:pe.image?i.jsx("img",{src:pe.image,alt:pe.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),i.jsxs("div",{className:"recipe-detail__title-card",children:[i.jsx("h1",{children:pe.title}),Qt&&i.jsx("p",{className:"recipe-detail__desc",children:Qt})]}),i.jsxs("div",{className:"recipe-detail__meta",children:[pe.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:pe.category})]}),pe.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value meta-value--store",children:pe.storeName})]}),pe.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:pe.course})]}),pe.servings&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[pe.servings,""]})]})]}),i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),pe.type==="bread"&&Qe?i.jsxs("div",{children:[i.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:Qe.flours.map((ne,ee)=>i.jsxs("tr",{children:[i.jsx("td",{children:ne.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Qe.getScaledQtyValue(ne.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[Qe.calcPercent(ne.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ls(ne.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:ne.cost?`${Qe.formatCostValue(ne.cost)}`:"-"})]},`print-flour-${ee}`))})]})]}),i.jsxs("div",{className:"bread-section",children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:Qe.others.map((ne,ee)=>i.jsxs("tr",{children:[i.jsx("td",{children:ne.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Qe.getScaledQtyValue(ne.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[Qe.calcPercent(ne.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ls(ne.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:ne.cost?`${Qe.formatCostValue(ne.cost)}`:"-"})]},`print-others-${ee}`))})]})]})]}):$t.map(ne=>i.jsxs("div",{style:{marginBottom:"1.2rem"},children:[ne.name&&i.jsx("div",{className:"print-group-heading",children:ne.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:ne.items.map((ee,ue)=>{const je=typeof ee=="object"?ee.quantity:"",Be=typeof ee=="object"?ee.unit:"",Ze=typeof ee=="object"?ee.purchaseCost:null,Ye=typeof ee=="object"?ee.cost:null,G=typeof ee=="string"?ee:ee.name,Le=typeof ee=="object"?ye(ee.quantity,te):je;return i.jsxs("tr",{children:[i.jsx("td",{children:G}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:Le}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:Be}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:ls(Ze)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:ls(Ye)??"-"})]},`print-ing-${ne.id}-${ue}`)})})]})]},ne.id)),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Xt]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),tt.length>0?i.jsx("div",{className:"steps-list",children:tt.map((ne,ee)=>{const ue=typeof ne=="object"?ne.text:ne;return i.jsxs("div",{className:"step-card",children:[i.jsx("div",{className:"step-number",children:ee+1}),i.jsx("p",{className:"step-text",children:ue})]},`print-step-${ee}`)})}):i.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:""})]})]})]})]})},db=n=>{if(n==null)return"";let t=String(n);return t=t.replace(/[-]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[--]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},Ut=({label:n,id:t,error:s,textarea:a,...o})=>{const u=a?"textarea":"input",d=o.type==="number"||o.inputMode==="decimal"||o.inputMode==="numeric",h=f=>{if(!o.onChange)return;if(!d){o.onChange(f);return}const m=f?.target?.value??"",y=db(m);if(y===m){o.onChange(f);return}o.onChange({target:{id:f?.target?.id,name:f?.target?.name,value:y}})};return i.jsxs("div",{className:`input-group ${s?"input-group--error":""} ${o.wrapperClassName||""}`,children:[n&&i.jsx("label",{htmlFor:t,className:"input-label",children:n}),i.jsx(u,{id:t,className:`input-field ${o.className||""}`,style:o.style,...o,onChange:h}),s&&i.jsx("span",{className:"input-error",children:s})]})},os="app-data",nr={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await Te.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const s=String(t||"").replace(/^\/+/,"");return`${n}/${s}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:s}=await Te.storage.from(os).list(n);if(s)return console.warn("Failed to list price files:",s.message),[];if(!t||t.length===0)return[];const a=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:h,error:f}=await Te.storage.from(os).download(d);if(f)return console.error(`Failed to download ${u.name}:`,f),null;const m=await h.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(m)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(m)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(a)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._cacheByUserId.get(t);if(s)return s;try{const a=new Map,o=await this._downloadAllCsvTexts(t);if(!o||o.length===0)return new Map;for(const{text:u}of o){if(!u)continue;const d=this.parseCSV(u);for(const[h,f]of d)if(a.has(h)){const m=a.get(h);(f?.dateStr||"")>(m?.dateStr||"")&&a.set(h,f)}else a.set(h,f)}return this._cacheByUserId.set(t,a),a}catch(a){return console.error("Error in fetchPriceList:",a),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:s,error:a}=await Te.storage.from(os).list(t);if(a)throw a;return s.filter(o=>String(o?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=n.name;this.clearCache(s);const o=this._getUserScopedPath(s,a),{data:u,error:d}=await Te.storage.from(os).upload(o,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(s){return console.error("Error uploading price list:",s),{success:!1,error:s}}},async deletePriceFile(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");this.clearCache(s);const a=this._getUserScopedPath(s,n),{data:o,error:u}=await Te.storage.from(os).remove([a]);if(u)throw u;if(!o||o.length===0)throw new Error("");return{success:!0,data:o}}catch(s){return console.error("Error deleting price file:",s),{success:!1,error:s}}},_splitFileName(n){const t=String(n||""),s=t.lastIndexOf(".");return s<=0?{base:t,ext:""}:{base:t.slice(0,s),ext:t.slice(s)}},_makeCopyFileName(n,t){const s=String(n||"");if(!t?.has?.(s))return s;const{base:a,ext:o}=this._splitFileName(s),u=a||s||"price";let d=1;for(;d<1e3;){const h=d===1?"_copy":`_copy${d}`,f=`${u}${h}${o}`;if(!t.has(f))return f;d++}return`${u}_copy_${Date.now()}${o}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:t=null,onProgress:s=null}={}){const a=t||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("");if(o===a)throw new Error("");const{data:u,error:d}=await Te.storage.from(os).list(a);if(d)throw d;const h=(u||[]).map(w=>w?.name).filter(Boolean).filter(w=>String(w).toLowerCase().endsWith(".csv")),{data:f,error:m}=await Te.storage.from(os).list(o);let y=new Set;if(m){const w=String(m?.message||"").toLowerCase();if(w.includes("not found")||w.includes("404"))y=new Set;else throw m}else y=new Set((f||[]).map(w=>w?.name).filter(Boolean));const v={sourceUserId:a,targetUserId:o,copied:[],skipped:[],failed:[]},x=h.length;s?.({phase:"start",total:x,done:0,current:""});for(let w=0;w<h.length;w++){const _=h[w],E=this._makeCopyFileName(_,y);y.add(E);const j=this._getUserScopedPath(a,_),N=this._getUserScopedPath(o,E);s?.({phase:"progress",total:x,done:w,current:`${_}  ${E}`,fromFile:_,toFile:E});try{const{data:k,error:O}=await Te.storage.from(os).download(j);if(O)throw O;if(!k)throw new Error("");const{error:U}=await Te.storage.from(os).upload(N,k,{upsert:!1,contentType:"text/csv"});if(U){const D=String(U?.message||"").toLowerCase();if(D.includes("already exists")||D.includes("exists")||D.includes("409")){let C=0,M=U;for(;C<5;){C++;const T=this._makeCopyFileName(_,y);y.add(T);const H=this._getUserScopedPath(o,T),{error:K}=await Te.storage.from(os).upload(H,k,{upsert:!1,contentType:"text/csv"});if(!K){v.copied.push({fromFile:_,toFile:T}),M=null;break}M=K}if(M)throw M;continue}throw U}v.copied.push({fromFile:_,toFile:E})}catch(k){console.error("copyPriceFilesToUser failed:",k),v.failed.push({file:_,errorMessage:String(k?.message||k)})}s?.({phase:"progress",total:x,done:w+1,current:`${_}  ${E}`,fromFile:_,toFile:E})}return s?.({phase:"done",total:x,done:x,current:"",result:v}),this.clearCache(o),v},parseCSV(n){const t=new Map,s=n.split(/\r?\n/).filter(o=>o.trim());if(s.length===0)return t;if(s.some(o=>o.startsWith("D,")||o.startsWith('"D",')))for(let o of s){const u=[];let d="",h=!1;for(let j=0;j<o.length;j++){const N=o[j];N==='"'?h=!h:N===","&&!h?(u.push(d),d=""):d+=N}u.push(d);const f=u.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j));if(f[0]!=="D")continue;const m=f[1],y=f[8],v=f[14],x=f[18],w=f[20],_=String(v??"").trim(),E=nn(_);if(E&&x){const j=parseFloat(x);if(!isNaN(j)){const N={price:j,vendor:y,unit:w,dateStr:m,displayName:_};if(t.has(E)){const k=t.get(E);(m||"")>=(k?.dateStr||"")&&t.set(E,N)}else t.set(E,N)}}}else{let o={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(s[0].split(",").map(f=>f.trim().replace(/^"|"$/g,"")).forEach((f,m)=>{["","","","","name","item"].some(y=>f.includes(y))&&(o.name=m),["","","","","price","cost"].some(y=>f.includes(y))&&(o.price=m),["","unit"].some(y=>f.includes(y))&&(o.unit=m),["","","","vendor","supplier"].some(y=>f.includes(y))&&(o.vendor=m)}),o.name===-1&&o.price===-1){o={name:0,price:1,unit:2,vendor:3};const f=s[0].split(",");isNaN(parseFloat(f[1]))&&(u=1)}else u=1;const h=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let f=u;f<s.length;f++){const m=s[f],y=[];let v="",x=!1;for(let U=0;U<m.length;U++){const D=m[U];D==='"'?x=!x:D===","&&!x?(y.push(v),v=""):v+=D}y.push(v);const w=y.map(U=>(U=U.trim(),U.startsWith('"')&&U.endsWith('"')?U.slice(1,-1):U)),_=o.name>-1?w[o.name]:null,E=o.price>-1?w[o.price]:null,j=o.unit>-1?w[o.unit]:"",N=o.vendor>-1?w[o.vendor]:"",k=String(_??"").trim(),O=nn(k);if(O&&E){const U=parseFloat(E.replace(/[^0-9.]/g,""));isNaN(U)||t.set(O,{price:U,vendor:N,unit:j,dateStr:h,displayName:k})}}}return t},parseCSVEntries(n,t=""){const s=[],a=n.split(/\r?\n/).filter(x=>x.trim());if(a.length===0)return s;const o=x=>{const w=String(x??"").trim();if(!w)return null;const _=parseFloat(w.replace(/[^0-9.]/g,""));return Number.isFinite(_)?_:null},u=x=>{const w=[];let _="",E=!1;for(let j=0;j<x.length;j++){const N=x[j];N==='"'?E=!E:N===","&&!E?(w.push(_),_=""):_+=N}return w.push(_),w.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j))},d=x=>{const w=String(x??"").trim();if(!w)return"";const _=w.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(_)return`${_[1]}/${String(_[2]).padStart(2,"0")}/${String(_[3]).padStart(2,"0")}`;const E=w.match(/^(\d{4})(\d{2})(\d{2})$/);return E?`${E[1]}/${E[2]}/${E[3]}`:w};if(a.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of a){const w=u(x);if(w[0]!=="D")continue;const _=d(w[1]),E=w[8],j=w[14],N=w[18],k=o(w[19]),O=w[20],U=String(j??"").trim(),D=nn(U);if(!D||!N)continue;const C=o(N);Number.isFinite(C)&&s.push({key:D,displayName:U,price:C,vendor:E,unit:O,dateStr:_,incomingQty:k,sourceFile:t})}return s}let f={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},m=0;if(a[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,w)=>{const _=String(x||"").toLowerCase();["","","","","name","item"].some(E=>_.includes(E))&&(f.name=w),["","","","","price","cost"].some(E=>_.includes(E))&&(f.price=w),["","unit"].some(E=>_.includes(E))&&(f.unit=w),["","","","vendor","supplier"].some(E=>_.includes(E))&&(f.vendor=w),["","","","date"].some(E=>_.includes(E))&&(f.date=w),["","","","","","qty","quantity"].some(E=>_.includes(E))&&(f.quantity=w)}),f.name===-1&&f.price===-1){f={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=a[0].split(",");isNaN(parseFloat(x[1]))&&(m=1)}else m=1;const v=d(new Date().toISOString().slice(0,10));for(let x=m;x<a.length;x++){const w=u(a[x]),_=f.name>-1?w[f.name]:null,E=f.price>-1?w[f.price]:null,j=f.unit>-1?w[f.unit]:"",N=f.vendor>-1?w[f.vendor]:"",k=f.date>-1?w[f.date]:"",O=f.quantity>-1?o(w[f.quantity]):null,U=String(_??"").trim(),D=nn(U);if(!D||!E)continue;const C=o(E);Number.isFinite(C)&&s.push({key:D,displayName:U,price:C,vendor:N,unit:j,dateStr:d(k)||v,incomingQty:O,sourceFile:t})}return s},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._historyCacheByUserId.get(t);if(s)return s;try{const a=await this._downloadAllCsvTexts(t);if(!a||a.length===0)return new Map;const o=new Map;for(const{fileName:u,text:d}of a){if(!d)continue;this.parseCSVEntries(d,u).forEach(f=>{const m=f?.key;m&&(o.has(m)||o.set(m,[]),o.get(m).push(f))})}for(const u of o.values())u.sort((d,h)=>{const f=String(d?.dateStr||""),m=String(h?.dateStr||"");if(f!==m)return f.localeCompare(m);const y=Number(d?.price),v=Number(h?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(h?.sourceFile||""))});return this._historyCacheByUserId.set(t,o),o}catch(a){return console.error("Error in fetchPriceHistory:",a),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),s=[];for(const[a,o]of t.entries())if(o&&typeof o=="object"){const{displayName:u,...d}=o;s.push({name:u||a,...d})}else s.push({name:a,price:o});return s.sort((a,o)=>a.dateStr&&o.dateStr?o.dateStr.localeCompare(a.dateStr):a.name.localeCompare(o.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(nn(n))||null}},Do={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:s}=await Te.rpc("search_ingredients",{search_query:n,max_results:15});return s?(console.warn(" Database search failed:",s),console.warn("Error message:",s.message),console.warn("Error code:",s.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){const t=String(n||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const s=t.toLowerCase(),a=nn(t);try{const o=await this._searchFromDatabase(s);if(o&&Array.isArray(o)){this._lastDbResults=o,this._lastDbQuery=s;const d=o.map(j=>({name:j.ingredient_name,price:j.last_price,size:j.packet_size,unit:j.packet_unit,itemCategory:j.item_category||null,source:"manual",displaySource:" "}));if(d.length===0)return await this._fallbackSearch(s);if(!this._csvCache){const j=await nr.getPriceListArray();this._csvCache=j.map(N=>({name:N.name,price:N.price,size:null,unit:N.unit,source:"csv",displaySource:" CSV"}))}const h=j=>{if(!a)return null;const N=String(j||"").indexOf(a);return N<0?null:{tier:j===a?0:N===0?1:2,idx:N,len:String(j||"").length}},f=(j,N)=>j.score.tier!==N.score.tier?j.score.tier-N.score.tier:j.score.idx!==N.score.idx?j.score.idx-N.score.idx:j.score.len!==N.score.len?j.score.len-N.score.len:j.name.localeCompare(N.name,"ja"),m=(j,N,k)=>{let O=0;for(;O<j.length&&f(j[O],N)<=0;)O++;j.splice(O,0,N),j.length>k&&j.pop()},v=Math.max(0,15-d.length),x=new Set(d.map(j=>nn(j.name))),w=[],_=new Set;if(v>0)for(const j of this._csvCache){const N=nn(j?.name);if(!N||x.has(N)||_.has(N))continue;const k=h(N);k&&(_.add(N),m(w,{...j,nameKey:N,score:k},v))}const E=w.map(j=>({name:j.name,price:j.price,size:j.size,unit:j.unit,source:j.source,displaySource:j.displaySource}));return[...d,...E]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",o);const u=await this._fallbackSearch(s);return console.log(" Fallback search returned:",u.length,"results"),u}catch(o){return console.error("Error searching ingredients:",o),[]}},async _fallbackSearch(n){try{const t=nn(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[f,m]=await Promise.all([nr.getPriceListArray(),Pn.getAllConversions()]);console.log(" CSV Data rows:",f.length),console.log(" Manual Data items:",m.size);const y=Array.from(m.values()).map(_=>({name:_.ingredientName,price:_.lastPrice,size:_.packetSize,unit:_.packetUnit,itemCategory:_.itemCategory||null,source:"manual",displaySource:" "})),v=f.map(_=>({name:_.name,price:_.price,size:null,unit:_.unit,source:"csv",displaySource:" CSV"})),x=new Set(y.map(_=>_.name)),w=v.filter(_=>!x.has(_.name));this._csvCache=[...y,...w],console.log(" Cache built. Total items:",this._csvCache.length)}const s=f=>{if(!t)return null;const m=String(f||"").indexOf(t);return m<0?null:{tier:f===t?0:m===0?1:2,idx:m,len:String(f||"").length}},a=(f,m)=>f.score.tier!==m.score.tier?f.score.tier-m.score.tier:f.score.idx!==m.score.idx?f.score.idx-m.score.idx:f.score.len!==m.score.len?f.score.len-m.score.len:f.name.localeCompare(m.name,"ja"),o=(f,m,y)=>{let v=0;for(;v<f.length&&a(f[v],m)<=0;)v++;f.splice(v,0,m),f.length>y&&f.pop()},u=15,d=[],h=new Set;for(const f of this._csvCache){const m=nn(f?.name);if(!m||h.has(m))continue;const y=s(m);y&&(h.add(m),o(d,{...f,nameKey:m,score:y},u))}return d.map(f=>({name:f.name,price:f.price,size:f.size,unit:f.unit,itemCategory:f.itemCategory||null,source:f.source,displaySource:f.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},kp=({value:n,onChange:t,placeholder:s,disabled:a,onSelect:o})=>{const[u,d]=b.useState([]),[h,f]=b.useState(!1),[m,y]=b.useState(-1),v=b.useRef(null),x=b.useRef(null),[w,_]=b.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),E=b.useCallback(()=>{if(v.current){const D=v.current.getBoundingClientRect(),C=8,M=4,T=D.top-C,H=window.innerHeight-D.bottom-C,F=(T>=180||T>=H)&&T>=110,q=Math.max(110,Math.min(280,F?T-M:H-M)),V=D.left,P=Math.max(220,window.innerWidth-C*2),L=Math.min(Math.max(D.width,220),P),A=Math.min(Math.max(C,V),window.innerWidth-C-L);_({top:F?D.top-M:D.bottom+M,left:A,width:L,maxHeight:q,placeAbove:F})}},[]);b.useEffect(()=>{const D=T=>{v.current&&!v.current.contains(T.target)&&x.current&&!x.current.contains(T.target)&&f(!1)},C=T=>{x.current&&x.current.contains(T.target)||f(!1)},M=()=>{h&&E()};return document.addEventListener("mousedown",D),window.addEventListener("scroll",C,{capture:!0}),window.addEventListener("resize",M),()=>{document.removeEventListener("mousedown",D),window.removeEventListener("scroll",C,{capture:!0}),window.removeEventListener("resize",M)}},[h,E]),b.useEffect(()=>{h&&E()},[h,u,E]);const j=b.useRef(0),N=b.useRef(null),k=async D=>{const C=D.target.value;if(t(D),N.current&&clearTimeout(N.current),C.length===0){f(!1);return}N.current=setTimeout(async()=>{if(C.length>0){const M=++j.current;console.log(" AutocompleteInput: Fetching suggestions for:",C);const T=await Do.search(C);console.log(" AutocompleteInput: Got",T.length,"suggestions"),M===j.current&&(d(T),f(T.length>0),y(-1))}},150)},O=D=>{const C={target:{value:D.name}};t(C),f(!1),o&&o(D)},U=D=>{h&&(D.key==="ArrowDown"?(D.preventDefault(),y(C=>C<u.length-1?C+1:C)):D.key==="ArrowUp"?(D.preventDefault(),y(C=>C>0?C-1:-1)):D.key==="Enter"?m>=0&&(D.preventDefault(),O(u[m])):D.key==="Escape"&&f(!1))};return i.jsxs("div",{className:"autocomplete-wrapper",ref:v,children:[i.jsx("input",{type:"text",className:"input-field autocomplete-input",value:n,onChange:k,onKeyDown:U,onFocus:async()=>{if(n&&n.length>0){E();const D=await Do.search(n);d(D),f(D.length>0)}else E()},placeholder:s,disabled:a}),h&&Ki.createPortal(i.jsx("ul",{className:"suggestions-list",ref:x,style:{position:"fixed",top:`${w.top}px`,left:`${w.left}px`,width:`${w.width}px`,maxHeight:`${w.maxHeight}px`,transform:w.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:u.map((D,C)=>i.jsxs("li",{className:`suggestion-item ${C===m?"selected":""}`,onClick:()=>O(D),onMouseEnter:()=>y(C),children:[i.jsxs("div",{className:"suggestion-main",children:[i.jsx("span",{className:"suggestion-name",children:D.name}),D?.source&&D.source!=="manual"&&i.jsx("span",{className:"suggestion-source",children:D.displaySource})]}),i.jsxs("div",{className:"suggestion-details",children:[D.price&&`${Number(D.price).toLocaleString()}`,D.size&&` / ${D.size}${D.unit}`,!D.size&&D.unit&&` / ${D.unit}`]})]},`${D.source}-${C}`))}),document.body)]})},hb=({isOpen:n,onClose:t,onApply:s,ingredientName:a,currentCost:o,currentQuantity:u,unit:d="g",initialPurchaseCost:h,initialContentAmount:f})=>{const[m,y]=b.useState(""),[v,x]=b.useState(""),[w,_]=b.useState(d),[E,j]=b.useState(""),[N,k]=b.useState(!1),[O,U]=b.useState(!1),D=b.useCallback(async()=>{if(U(!0),j(""),h&&f){y(h),x(f);const F=await Pn.getConversion(a);if(F)_(F.packetUnit||d),j(F.vendor||"");else{_(d);try{const q=await nr.getPrice(a);j(q?.vendor||"")}catch{}}}else{const F=await Pn.getConversion(a);if(F)x(F.packetSize),_(F.packetUnit||d),F.lastPrice&&y(F.lastPrice),j(F.vendor||"");else try{const q=await nr.getPrice(a);if(q)if(y(o||q.price),j(q.vendor||""),q.unit){const V=q.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(V){let P=V[1]?parseFloat(V[1]):1,L=V[2]?V[2].trim().toLowerCase():"";L==="kg"?(P*=1e3,L="g"):L==="l"?(P*=1e3,L="ml"):L==="pk"||L==="pack"?L="":L==="bag"?L="":(L==="pc"||L==="pcs")&&(L=""),x(P),_(L||d)}else x(1),_(q.unit)}else x(""),_(d);else x(""),y(o||""),_(d),j("")}catch(q){console.warn("Failed to load master price:",q),x(""),y(o||""),_(d),j("")}}U(!1)},[a,h,f,d,o]);b.useEffect(()=>{if(!n||!a)return;const F=setTimeout(()=>{D()},0);return()=>clearTimeout(F)},[n,a,D]);const C=()=>{const F=parseFloat(m),q=parseFloat(v);return!F||!q?0:["g","ml","cc"].includes(w)?F/q*1e3:F/q},M=async()=>{const F=C();if(N&&v)try{await Pn.saveConversion(a,v,w,m,null,E)}catch(q){console.error("Failed to save default conversion:",q)}s(F,w,m,v,E),t()};if(!n)return null;const T=C(),H=u?T*(u/(["g","ml"].includes(d)?1e3:1)):0,K=i.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:i.jsx("div",{className:"unit-conversion-modal__card",onClick:F=>F.stopPropagation(),children:i.jsxs("div",{className:"unit-conversion-modal__body",children:[i.jsx("h3",{className:"unit-conversion-modal__title",children:""}),i.jsxs("div",{className:"unit-conversion-modal__field",children:[i.jsx("span",{className:"unit-conversion-modal__label",children:""}),i.jsx("div",{className:"unit-conversion-modal__value",children:a||"()"})]}),i.jsxs("div",{className:"unit-conversion-modal__inputs",children:[i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),i.jsx("input",{type:"number",value:m,onChange:F=>y(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:""}),i.jsxs("div",{className:"unit-conversion-modal__row",children:[i.jsx("input",{type:"number",value:v,onChange:F=>x(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),i.jsxs("select",{value:w,onChange:F=>_(F.target.value),className:"unit-conversion-modal__select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:"p"}),i.jsx("option",{value:"cc",children:"cc"}),!["g","ml","","","","","","cc"].includes(w)&&i.jsx("option",{value:w,children:w})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:""}),i.jsx("input",{type:"text",value:E,onChange:F=>j(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),i.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:O?i.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[i.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),i.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(T).toLocaleString()]})]}),u&&i.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[i.jsxs("span",{children:[" (",u,d,"):"]}),i.jsxs("span",{children:["",Math.round(H).toLocaleString()]})]})]})}),i.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[i.jsx("input",{type:"checkbox",id:"saveDefault",checked:N,onChange:F=>k(F.target.checked)}),i.jsxs("span",{children:["(",v,w,")"]})]}),i.jsxs("div",{className:"unit-conversion-modal__actions",children:[i.jsx(re,{type:"button",variant:"secondary",onClick:t,disabled:O,children:""}),i.jsx(re,{type:"button",variant:"primary",onClick:M,disabled:!m||!v||O,children:""})]})]})})});return Ki.createPortal(K,document.body)},qN=new Set(["food","alcohol","soft_drink","supplies"]),FN=new Set(["alcohol","supplies"]),fb={food:"",alcohol:"",soft_drink:"",supplies:""},vi=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":qN.has(t)?t:"":""},Ju=n=>FN.has(n),Mf=(n,t)=>{const s=vi(t);return s?{...n,itemCategory:s,isAlcohol:Ju(s)}:{...n,itemCategory:null}},Gn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},ip=n=>{const t=Gn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},$i=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return ip(s)/100},HN=(n,t,s)=>{const a=Gn(n),o=Gn(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},Ex=(n,t,s,a=!1,o=1)=>{const u=Gn(n),d=Gn(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const h=Number.isFinite(o)&&o>0?o:1;if(a)return u/1e3*d/h;const f=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(f)||!f?u/1e3*d/h:u*d/h},GN=(n,t)=>{const s=Gn(n?.purchaseCost),a=Gn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-t)>.01):!1},Nx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Lr=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const a=Nx(t);if(!a)return null;for(const[o,u]of n.entries())if(Nx(o)===a)return u;return null},VN=({formData:n,setFormData:t})=>{const[s,a]=b.useState(new Map),[o,u]=b.useState({isOpen:!1,type:null,index:null}),[d,h]=b.useState(new Map);b.useEffect(()=>{(async()=>{const[M,T]=await Promise.all([nr.fetchPriceList(),Pn.getAllConversions()]);a(M),h(T)})()},[]);const m=(C=>C.reduce((M,T)=>M+(parseFloat(T.quantity)||0),0))(n.flours||[]),y=C=>!m||m===0?0:((parseFloat(C)||0)/m*100).toFixed(1);b.useEffect(()=>{if(d.size===0)return;const C=(H=[])=>{let K=!1;return{adjusted:H.map(q=>{if(!q||typeof q!="object")return q;const V=Lr(d,q.name);let P=q;const L=vi(q.itemCategory??q.item_category??V?.itemCategory);if(L){const me=Ju(L);(vi(q.itemCategory??q.item_category)!==L||!!q.isAlcohol!==me)&&(P={...P,itemCategory:L,isAlcohol:me})}const A=$i(q,V),$=Ex(q.quantity,P.purchaseCost,q.unit,!0,A),Y=Number.isFinite($)?Math.round($*100)/100:NaN,le=Gn(P.cost);if(Number.isFinite(Y)&&(!Number.isFinite(le)||Math.abs(le-Y)>.01)&&(P={...P,cost:Y}),V&&V.packetSize){const B=[V.lastPrice,q.purchaseCostRef,q.purchase_cost,q.purchaseCost].find(J=>Number.isFinite(Gn(J))),W=HN(B,V.packetSize,V.packetUnit);if(Number.isFinite(W)&&GN(q,W)){const J=$i(q,V),ge=Math.round(W*100)/100,ze=Ex(q.quantity,ge,q.unit,!0,J),Re=Number.isFinite(ze)?Math.round(ze*100)/100:P.cost,he=Gn(P.purchaseCost),I=Gn(P.cost),te=!Number.isFinite(he)||Math.abs(he-ge)>.01,ye=Number.isFinite(Gn(Re))&&(!Number.isFinite(I)||Math.abs(I-Re)>.01);(te||ye)&&(P={...P,purchaseCost:ge,cost:Re})}}return P!==q&&(K=!0),P}),changed:K}},M=C(n.flours||[]),T=C(n.breadIngredients||[]);!M.changed&&!T.changed||t(H=>({...H,flours:M.adjusted,breadIngredients:T.adjusted}))},[d,n.breadIngredients,n.flours,t]);const v=(C,M,T)=>{const H=[...n.flours||[]];if(H[C]={...H[C],[M]:T},M==="name"){const K=s.get(nn(T));if(K){const F=typeof K=="object"?K.price:K,q=typeof K=="object"?K.vendor:null,V=typeof K=="object"?K.unit:null;H[C].purchaseCostRef=F,H[C].vendorRef=q;const P=Lr(d,T);if(P&&P.packetSize){let A=0;const $=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:F,Y=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?A=$/P.packetSize*1e3:["kg",""].includes(Y)?A=$/P.packetSize:["ml","","cc",""].includes(Y)?A=$/P.packetSize*1e3:(["l",""].includes(Y),A=$/P.packetSize),H[C].purchaseCost=Math.round(A*100)/100,H[C].unit="g"}else H[C].purchaseCost||(H[C].purchaseCost=F,!H[C].unit&&V&&(H[C].unit=V));const L=vi(P?.itemCategory);L?H[C]=Mf(H[C],L):H[C].itemCategory=null}else H[C].purchaseCostRef=null,H[C].vendorRef=null,H[C].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(M)||M==="name"){const K=H[C],F=parseFloat(K.quantity),q=parseFloat(K.purchaseCost);if(!isNaN(F)&&!isNaN(q)){let V=0;const P=(K.unit||"").trim().toLowerCase();P==="g"||P===""||P==="ml"||P===""||P==="cc"||P===""||!P?V=F/1e3*q:V=F*q;const L=Lr(d,K.name),A=$i(K,L),$=Number.isFinite(A)&&A>0?A:1,Y=Math.round(V/$*100)/100;Y!==K.cost&&(H[C].cost=Y)}}t(K=>({...K,flours:H}))},x=(C,M,T)=>{const H=[...n.breadIngredients||[]];if(H[C]={...H[C],[M]:T},M==="name"){const K=s.get(nn(T));if(K){const F=typeof K=="object"?K.price:K,q=typeof K=="object"?K.vendor:null,V=typeof K=="object"?K.unit:null;H[C].purchaseCostRef=F,H[C].vendorRef=q;const P=Lr(d,T);if(P&&P.packetSize){let A=0;const $=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:F,Y=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?(A=$/P.packetSize*1e3,H[C].unit="g"):["kg",""].includes(Y)?(A=$/P.packetSize,H[C].unit="g"):["ml","","cc",""].includes(Y)?(A=$/P.packetSize*1e3,H[C].unit="ml"):["l",""].includes(Y)?(A=$/P.packetSize,H[C].unit="ml"):(A=$/P.packetSize,H[C].unit=P.packetUnit),H[C].purchaseCost=Math.round(A*100)/100}else H[C].purchaseCost||(H[C].purchaseCost=F,!H[C].unit&&V&&(H[C].unit=V));const L=vi(P?.itemCategory);L?H[C]=Mf(H[C],L):H[C].itemCategory=null}else H[C].purchaseCostRef=null,H[C].vendorRef=null,H[C].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(M)||M==="name"){const K=H[C],F=parseFloat(K.quantity),q=parseFloat(K.purchaseCost);if(!isNaN(F)&&!isNaN(q)){let V=0;const P=K.unit?K.unit.trim().toLowerCase():"g";P==="g"||P===""||P==="ml"||P===""||P==="cc"||P===""?V=F/1e3*q:V=F*q;const L=Lr(d,K.name),A=$i(K,L),$=Number.isFinite(A)&&A>0?A:1,Y=Math.round(V/$*100)/100;Y!==K.cost&&(H[C].cost=Y)}}t(K=>({...K,breadIngredients:H}))},w=()=>{t(C=>({...C,flours:[...C.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},_=()=>{t(C=>({...C,breadIngredients:[...C.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},E=C=>{t(M=>({...M,flours:M.flours.filter((T,H)=>H!==C)}))},j=C=>{t(M=>({...M,breadIngredients:M.breadIngredients.filter((T,H)=>H!==C)}))},N=ll(gr(qo,{activationConstraint:{distance:10}}),gr(Fo,{activationConstraint:{delay:250,tolerance:5}}),gr(cl,{coordinateGetter:Ku})),k=C=>{const{active:M,over:T}=C;M.id!==T.id&&t(H=>{const F=H.flours.some(P=>P.id===M.id)?"flours":"breadIngredients",q=H[F].findIndex(P=>P.id===M.id),V=H[F].findIndex(P=>P.id===T.id);return q!==-1&&V!==-1?{...H,[F]:Zi(H[F],q,V)}:H})};b.useEffect(()=>{if(!n.flours)t(C=>({...C,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const C=n.flours.map(M=>M.id?M:{...M,id:crypto.randomUUID()});JSON.stringify(C)!==JSON.stringify(n.flours)&&t(M=>({...M,flours:C}))}if(!n.breadIngredients)t(C=>({...C,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const C=n.breadIngredients.map(M=>M.id?M:{...M,id:crypto.randomUUID()});JSON.stringify(C)!==JSON.stringify(n.breadIngredients)&&t(M=>({...M,breadIngredients:C}))}},[]);const O=(C,M,T,H)=>{const{type:K,index:F}=o;t(q=>{if(K==="flour"){const V=[...q.flours],P={...V[F],purchaseCost:C,unit:M,purchase_cost:T,content_amount:H},L=parseFloat(P.quantity),A=parseFloat(C);if(!isNaN(L)&&!isNaN(A)){let $=0;M==="g"||M===""?$=L/1e3*A:$=L*A;const Y=Lr(d,P.name),le=$i(P,Y),me=Number.isFinite(le)&&le>0?le:1;P.cost=Math.round($/me*100)/100}return V[F]=P,Pn.getAllConversions().then($=>h($)),Do.invalidateCache(),{...q,flours:V}}else if(K==="ingredient"){const V=[...q.breadIngredients],P={...V[F],purchaseCost:C,unit:M,purchase_cost:T,content_amount:H},L=parseFloat(P.quantity),A=parseFloat(C);if(!isNaN(L)&&!isNaN(A)){let $=0;M==="g"||M===""?$=L/1e3*A:$=L*A;const Y=Lr(d,P.name),le=$i(P,Y),me=Number.isFinite(le)&&le>0?le:1;P.cost=Math.round($/me*100)/100}return V[F]=P,Pn.getAllConversions().then($=>h($)),Do.invalidateCache(),{...q,breadIngredients:V}}return q})},U=(C,M,T)=>{T&&t(H=>{const K=C==="flour"?"flours":"breadIngredients",F=[...H[K]||[]],q={...F[M]};if(q.name=T.name,q.itemCategory=null,T.price!==void 0&&T.price!==null&&T.price!==""){q.purchaseCostRef=T.price,q.vendorRef=T.source==="csv"?"CSV":"Master";let A=T.price,$=T.unit;if(T.source==="manual")if(T.size&&T.size>0){const Y=(T.unit||"").trim().toLowerCase();["g",""].includes(Y)?(A=T.price/T.size*1e3,$="g"):["kg",""].includes(Y)?(A=T.price/T.size,$="g"):["ml","","cc",""].includes(Y)?(A=T.price/T.size*1e3,$="ml"):["l",""].includes(Y)?(A=T.price/T.size,$="ml"):(A=T.price/T.size,$=T.unit)}else A=T.price,$=T.unit;else{const Y=Lr(d,T.name);if(Y&&Y.packetSize){const le=Y.lastPrice!==null&&Y.lastPrice!==void 0&&Y.lastPrice!==""?Y.lastPrice:T.price,me=(Y.packetUnit||"").trim().toLowerCase();["g",""].includes(me)?(A=le/Y.packetSize*1e3,$="g"):["kg",""].includes(me)?(A=le/Y.packetSize,$="g"):["ml","","cc",""].includes(me)?(A=le/Y.packetSize*1e3,$="ml"):["l",""].includes(me)?(A=le/Y.packetSize,$="ml"):(A=le/Y.packetSize,$=Y.packetUnit)}else A=T.price,$=T.unit}q.purchaseCost=Math.round(A*100)/100,C==="flour"?q.unit="g":$&&(q.unit=$)}const V=vi(T.itemCategory??T.item_category??Lr(d,T.name)?.itemCategory);if(V){const A=Mf(q,V);Object.assign(q,A)}const P=parseFloat(q.quantity),L=parseFloat(q.purchaseCost);if(!isNaN(P)&&!isNaN(L)){const A=Lr(d,q.name),$=$i(q,A),Y=Number.isFinite($)&&$>0?$:1,le=(q.unit||"").trim().toLowerCase();let me=0;le==="g"||le===""||le==="ml"||le===""||le==="cc"||le===""?me=P/1e3*L:me=P*L,q.cost=Math.round(me/Y*100)/100}return F[M]=q,{...H,[K]:F}})},D=o.isOpen&&o.index!==null?o.type==="flour"?n.flours[o.index]:n.breadIngredients[o.index]:null;return i.jsxs("div",{className:"bread-form",children:[i.jsxs(tn,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[i.jsxs("div",{className:"bread-header",children:[i.jsxs("h3",{children:[" (Total: ",m,"g)"]}),i.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Xi,{sensors:N,collisionDetection:Ff,onDragEnd:k,id:"flours-dnd",children:i.jsx(tl,{items:n.flours||[],strategy:Eo,children:(n.flours||[]).map((C,M)=>{const T=Lr(d,C?.name),H=ip(T?.yieldPercent??T?.yield_percent??C?.yieldPercent??C?.yield_percent);return i.jsx(KN,{id:C.id,index:M,item:C,yieldPercentApplied:H,onChange:v,onRemove:E,onSelect:U,calculatePercentage:y,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:M})},C.id)})})})})]}),i.jsx(re,{type:"button",variant:"secondary",size:"sm",onClick:w,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsxs(tn,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[i.jsxs("div",{className:"bread-header",children:[i.jsx("h3",{children:""}),i.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Xi,{sensors:N,collisionDetection:Ff,onDragEnd:k,id:"breadIngredients-dnd",children:i.jsx(tl,{items:n.breadIngredients||[],strategy:Eo,children:(n.breadIngredients||[]).map((C,M)=>{const T=Lr(d,C?.name),H=ip(T?.yieldPercent??T?.yield_percent??C?.yieldPercent??C?.yield_percent);return i.jsx(YN,{id:C.id,index:M,item:C,yieldPercentApplied:H,onChange:x,onRemove:j,onSelect:U,calculatePercentage:y,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:M})},C.id)})})})})]}),i.jsx(re,{type:"button",variant:"secondary",size:"sm",onClick:_,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:i.jsx(re,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),i.jsx(hb,{isOpen:o.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:O,ingredientName:D?.name||"",currentCost:D?.purchaseCost,currentQuantity:D?.quantity,unit:D?.unit||"g",initialPurchaseCost:D?.purchase_cost,initialContentAmount:D?.content_amount})]})},KN=({id:n,index:t,item:s,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:h,floursLength:f,onOpenConversion:m})=>{const y=vi(s.itemCategory??s.item_category),v=!!y,x=fb[y]||"",w=v?`${x}${Ju(y)?"10%":"8%"}`:"",{attributes:_,listeners:E,setNodeRef:j,transform:N,transition:k,isDragging:O}=ul({id:n}),U={transform:kr.Transform.toString(N),transition:k,opacity:O?.5:1,position:"relative",zIndex:O?999:"auto"};return i.jsxs("div",{ref:j,style:U,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{..._,...E,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(kp,{value:s.name,onChange:D=>o(t,"name",D.target.value),onSelect:D=>d("flour",t,D),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(Ut,{type:"number",step:"any",value:s.quantity,onChange:D=>o(t,"quantity",D.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[h(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(Ut,{type:"number",step:"any",value:s.purchaseCost||"",onChange:D=>o(t,"purchaseCost",D.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:m,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(Ut,{type:"number",step:"any",value:s.cost||"",onChange:D=>o(t,"cost",D.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Gn(a))&&Gn(a)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const D=Gn(a),C=Math.round(D*10)/10;return`${Number.isInteger(C)?Math.round(C):C}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:D=>o(t,"isAlcohol",D.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${w}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:f>1&&i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},YN=({id:n,index:t,item:s,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:h,onOpenConversion:f})=>{const m=vi(s.itemCategory??s.item_category),y=!!m,v=fb[m]||"",x=y?`${v}${Ju(m)?"10%":"8%"}`:"",{attributes:w,listeners:_,setNodeRef:E,transform:j,transition:N,isDragging:k}=ul({id:n}),O={transform:kr.Transform.toString(j),transition:N,opacity:k?.5:1,position:"relative",zIndex:k?999:"auto"};return i.jsxs("div",{ref:E,style:O,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{...w,..._,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(kp,{value:s.name,onChange:U=>o(t,"name",U.target.value),onSelect:U=>d("ingredient",t,U),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(Ut,{type:"number",step:"any",value:s.quantity,onChange:U=>o(t,"quantity",U.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[h(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(Ut,{type:"number",step:"any",value:s.purchaseCost||"",onChange:U=>o(t,"purchaseCost",U.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(Ut,{type:"number",step:"any",value:s.cost||"",onChange:U=>o(t,"cost",U.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Gn(a))&&Gn(a)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const U=Gn(a),D=Math.round(U*10)/10;return`${Number.isInteger(D)?Math.round(D):D}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:U=>o(t,"isAlcohol",U.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},QN=new Set(["food","alcohol","soft_drink","supplies"]),WN=new Set(["alcohol","supplies"]),JN={food:"",alcohol:"",soft_drink:"",supplies:""},Xa=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":QN.has(t)?t:"":""},zu=n=>WN.has(n),kx=(n,t)=>{const s=Xa(t);return s?{...n,itemCategory:s,isAlcohol:zu(s)}:{...n,itemCategory:null}},Tx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),ks=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const a=Tx(t);if(!a)return null;for(const[o,u]of n.entries())if(Tx(o)===a)return u;return null},ir=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},pb=n=>{const t=ir(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Ha=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return pb(s)/100},XN=(n,t,s)=>{const a=ir(n),o=ir(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},zf=(n,t,s,a=1)=>{const o=ir(n),u=ir(t);if(!Number.isFinite(o)||!Number.isFinite(u))return NaN;const d=String(s||"").trim().toLowerCase();let h=0;["g","","ml","","cc",""].includes(d)?h=o/1e3*u:h=o*u;const f=Number.isFinite(a)&&a>0?a:1;return h/f},ZN=(n,t)=>{const s=ir(n?.purchaseCost),a=ir(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-t)>.01):!1},ek=be.memo(({id:n,index:t,item:s,groupId:a,yieldPercentApplied:o,onChange:u,onRemove:d,handleSuggestionSelect:h,onOpenConversion:f})=>{const m=Xa(s.itemCategory??s.item_category),y=!!m,v=JN[m]||"",x=y?`${v}${zu(m)?"10%":"8%"}`:"",w=y?zu(m):!!s.isAlcohol,{attributes:_,listeners:E,setNodeRef:j,transform:N,transition:k,isDragging:O}=ul({id:n,data:{groupId:a,index:t}}),U={transform:kr.Translate.toString(N),transition:k,opacity:O?.3:1,position:"relative",zIndex:O?999:"auto"};return i.jsxs("div",{ref:j,style:U,className:"form-ingredient-row",children:[i.jsx("div",{..._,...E,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(kp,{value:s.name,onChange:D=>u(a,t,"name",D.target.value),onSelect:D=>h(a,t,D),placeholder:""})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(Ut,{value:s.quantity,onChange:D=>u(a,t,"quantity",D.target.value),placeholder:"0",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsx("div",{className:"ingredient-unit",children:i.jsx(Ut,{value:s.unit,onChange:D=>u(a,t,"unit",D.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[i.jsx(Ut,{type:"number",value:s.purchaseCost,onChange:D=>u(a,t,"purchaseCost",D.target.value),step:"0.01",placeholder:s.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},title:s.purchaseCostRef?`: ${s.purchaseCostRef}${s.vendorRef?` (${s.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",s.purchaseCostRef]})]}),i.jsxs("div",{className:"ingredient-cost","data-label":"",children:[i.jsx(Ut,{type:"number",step:"0.01",value:s.cost,onChange:D=>u(a,t,"cost",D.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(ir(o))&&ir(o)<99.999&&i.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const D=ir(o),C=Math.round(D*10)/10;return`${Number.isInteger(C)?Math.round(C):C}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:w,onChange:D=>u(a,t,"isAlcohol",D.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(a,t),children:""})})]})},(n,t)=>n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),tk=({section:n,sections:t,onSectionChange:s,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=Go({id:n.id});return i.jsxs(tn,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(Ut,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[i.jsx("span",{}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},nk=({formData:n,setFormData:t,priceList:s})=>{const[a,o]=b.useState(new Map);b.useEffect(()=>{Pn.getAllConversions().then(U=>o(U))},[]);const[u,d]=b.useState({isOpen:!1,groupId:null,index:null});b.useEffect(()=>{if(!n.ingredientSections){const U=n.ingredientGroups||[{id:"default",name:""}],D=n.ingredients||[],C=U.map(H=>({id:H.id,name:H.name,items:D.filter(K=>H.id==="default"&&!K.groupId?!0:K.groupId===H.id)})),M=new Set(C.flatMap(H=>H.items.map(K=>K.id))),T=D.filter(H=>!M.has(H.id));T.length>0&&(C.length>0?C[0].items.push(...T):C.push({id:"default",name:"",items:T})),C.length===0&&C.push({id:crypto.randomUUID(),name:"",items:[]}),t(H=>({...H,ingredientSections:C}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const h=n.ingredientSections||[];b.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||a.size===0)return;let U=!1;const D=n.ingredientSections.map(C=>{const M=C.items.map(T=>{if(!T||typeof T!="object")return T;const H=ks(a,T.name);let K=T;const F=Xa(T.itemCategory??T.item_category??H?.itemCategory);if(F){const V=zu(F);(Xa(T.itemCategory??T.item_category)!==F||!!T.isAlcohol!==V)&&(K={...K,itemCategory:F,isAlcohol:V})}if(H&&H.packetSize){const P=[H.lastPrice,T.purchaseCostRef,T.purchase_cost,T.purchaseCost].find(A=>Number.isFinite(ir(A))),L=XN(P,H.packetSize,H.packetUnit);if(Number.isFinite(L)&&ZN(T,L)){const A=Ha(T,H),$=Math.round(L*100)/100,Y=zf(T.quantity,$,T.unit,A),le=Number.isFinite(Y)?Math.round(Y*100)/100:K.cost,me=ir(K.purchaseCost),B=ir(K.cost),W=!Number.isFinite(me)||Math.abs(me-$)>.01,J=Number.isFinite(ir(le))&&(!Number.isFinite(B)||Math.abs(B-le)>.01);(W||J)&&(K={...K,purchaseCost:$,cost:le})}}const q=Ha(T,H);if(Number.isFinite(q)&&q>0&&Math.abs(q-1)>1e-4){const V=zf(T.quantity,K.purchaseCost,T.unit,q),P=zf(T.quantity,K.purchaseCost,T.unit,1),L=ir(K.cost);if(Number.isFinite(V)&&(!Number.isFinite(L)||Number.isFinite(P)&&Math.abs(L-P)<=.01)){const $=Math.round(V*100)/100,Y=ir(K.cost);(!Number.isFinite(Y)||Math.abs(Y-$)>.01)&&(K={...K,cost:$})}}return K!==T&&(U=!0),K});return M!==C.items?{...C,items:M}:C});U&&t(C=>({...C,ingredientSections:D}))},[a,n.ingredientSections,t]);const f=ll(gr(qo,{activationConstraint:{distance:10}}),gr(Fo,{activationConstraint:{delay:250,tolerance:5}}),gr(cl,{coordinateGetter:Ku})),m=({active:U,over:D})=>{if(!D)return;const C=U.id,M=D.id,T=h.find(K=>K.items.some(F=>F.id===C)),H=h.find(K=>K.items.some(F=>F.id===M))||h.find(K=>K.id===M);!T||!H||T===H||t(K=>{const F=T.items,q=H.items,V=F.findIndex(A=>A.id===C),P=q.findIndex(A=>A.id===M);let L;if(M===H.id)L=q.length+1;else{const $=D&&U.rect.current.translated&&U.rect.current.translated.top>D.rect.top+D.rect.height?1:0;L=P>=0?P+$:q.length+1}return{...K,ingredientSections:K.ingredientSections.map(A=>A.id===T.id?{...A,items:F.filter($=>$.id!==C)}:A.id===H.id?{...A,items:[...q.slice(0,L),F[V],...q.slice(L,q.length)]}:A)}})},y=({active:U,over:D})=>{if(!D)return;const C=U.id,M=D.id,T=h.find(K=>K.items.some(F=>F.id===C)),H=h.find(K=>K.items.some(F=>F.id===M))||h.find(K=>K.id===M);if(T&&H&&T===H){const K=T.items.findIndex(q=>q.id===C),F=H.items.findIndex(q=>q.id===M);K!==F&&t(q=>({...q,ingredientSections:q.ingredientSections.map(V=>V.id===T.id?{...V,items:Zi(V.items,K,F)}:V)}))}},v=(U,D,C,M)=>{const{groupId:T,index:H}=u;T!==null&&H!==null&&t(K=>{const F=K.ingredientSections.map(q=>{if(q.id!==T)return q;const V=[...q.items],P={...V[H],purchaseCost:U,unit:D,purchase_cost:C,content_amount:M},L=parseFloat(P.quantity),A=parseFloat(U);if(!isNaN(L)&&!isNaN(A)){const $=ks(a,P.name),Y=Ha(P,$),le=D?D.trim().toLowerCase():"";let me=0;le==="g"||le===""||le==="ml"||le===""||le==="cc"||le===""?me=L/1e3*A:me=L*A;const B=Number.isFinite(Y)&&Y>0?Y:1;P.cost=Math.round(me/B*100)/100}return V[H]=P,{...q,items:V}});return Pn.getAllConversions().then(q=>o(q)),Do.invalidateCache(),{...K,ingredientSections:F}})},x=u.isOpen&&u.groupId!==null&&u.index!==null?h.find(U=>U.id===u.groupId)?.items[u.index]:null,w=be.useCallback((U,D,C,M)=>{t(T=>{const H=T.ingredientSections.map(K=>{if(K.id!==U)return K;const F=[...K.items],q={...F[D],[C]:M};if(F[D]=q,["quantity","purchaseCost","unit","name","isAlcohol"].includes(C)){const V=parseFloat(q.quantity),P=parseFloat(q.purchaseCost),L=ks(a,q.name),A=Ha(q,L),$=Number.isFinite(A)&&A>0?A:1;if(!isNaN(V)&&!isNaN(P)){let Y=0;const le=q.unit?q.unit.trim().toLowerCase():"";le==="g"||le===""||le==="ml"||le===""||le==="cc"||le===""?Y=V/1e3*P:Y=V*P;const me=Math.round(Y/$*100)/100;me!==q.cost&&(q.cost=me,F[D]=q)}}if(C==="name"){const V=s.get(nn(M)),P=ks(a,M),L=Xa(P?.itemCategory);if(L){const A=kx(q,L);Object.assign(q,A)}else V||(q.itemCategory=null);if(V){const A=typeof V=="object"?V.price:V,$=typeof V=="object"?V.vendor:null,Y=typeof V=="object"?V.unit:null,le=typeof V=="object"?V.size:null;if(q.purchaseCostRef=A,q.vendorRef=$,P&&P.packetSize){const W=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:A;let J=0;const ge=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(ge)?(J=W/P.packetSize*1e3,q.unit="g"):["kg",""].includes(ge)?(J=W/P.packetSize,q.unit="g"):["ml","","cc",""].includes(ge)?(J=W/P.packetSize*1e3,q.unit="ml"):["l",""].includes(ge)?(J=W/P.packetSize,q.unit="ml"):(J=W/P.packetSize,q.unit=P.packetUnit),q.purchaseCost=Math.round(J*100)/100}else{let W=A,J=Y;le&&le>1&&(["g",""].includes((Y||"").toLowerCase())?(W=A/le*1e3,J="g"):["ml","","cc",""].includes((Y||"").toLowerCase())?(W=A/le*1e3,J="ml"):["kg",""].includes(Y?Y.toLowerCase():"")?(W=A/le,J="g"):["l",""].includes(Y?Y.toLowerCase():"")?(W=A/le,J="ml"):W=A/le),q.purchaseCost||(q.purchaseCost=Math.round(W*100)/100),!q.unit&&J&&(q.unit=J)}const me=parseFloat(q.quantity),B=parseFloat(q.purchaseCost);if(!isNaN(me)&&!isNaN(B)){const W=ks(a,q.name),J=Ha(q,W),ge=Number.isFinite(J)&&J>0?J:1,ze=q.unit?q.unit.trim().toLowerCase():"";let Re=0;ze==="g"||ze===""||ze==="ml"||ze===""||ze==="cc"||ze===""?Re=me/1e3*B:Re=me*B,q.cost=Math.round(Re/ge*100)/100}}else q.purchaseCostRef=null,q.vendorRef=null;F[D]=q}return{...K,items:F}});return{...T,ingredientSections:H}})},[a,s,t]),_=be.useCallback((U,D,C)=>{t(M=>{const T=M.ingredientSections.map(H=>{if(H.id!==U)return H;const K=[...H.items],F={...K[D]};if(F.name=C.name,F.itemCategory=null,C.price)if(F.purchaseCostRef=C.price,F.vendorRef=C.source==="csv"?"CSV":"Master",C.source==="manual")if(C.size&&C.size>0){const L=(C.unit||"").trim().toLowerCase();if(["g",""].includes(L)){const A=C.price/C.size*1e3;F.purchaseCost=Math.round(A*100)/100,F.unit="g"}else if(["kg",""].includes(L)){const A=C.price/C.size;F.purchaseCost=Math.round(A*100)/100,F.unit="g"}else if(["ml","","cc",""].includes(L)){const A=C.price/C.size*1e3;F.purchaseCost=Math.round(A*100)/100,F.unit="ml"}else if(["l",""].includes(L)){const A=C.price/C.size;F.purchaseCost=Math.round(A*100)/100,F.unit="ml"}else{const A=C.price/C.size;F.purchaseCost=Math.round(A*100)/100,F.unit=C.unit}}else F.purchaseCost=C.price,F.unit=C.unit;else{const L=ks(a,C.name);if(L&&L.packetSize){const A=L.lastPrice!==null&&L.lastPrice!==void 0&&L.lastPrice!==""?L.lastPrice:C.price;let $=0;const Y=(L.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?($=A/L.packetSize*1e3,F.unit="g"):["kg",""].includes(Y)?($=A/L.packetSize,F.unit="g"):["ml","","cc",""].includes(Y)?($=A/L.packetSize*1e3,F.unit="ml"):["l",""].includes(Y)?($=A/L.packetSize,F.unit="ml"):($=A/L.packetSize,F.unit=L.packetUnit),F.purchaseCost=Math.round($*100)/100}else F.purchaseCost=C.price,F.unit=C.unit}const q=Xa(C.itemCategory??C.item_category??ks(a,C.name)?.itemCategory);if(q){const L=kx(F,q);Object.assign(F,L)}const V=parseFloat(F.quantity),P=parseFloat(F.purchaseCost);if(!isNaN(V)&&!isNaN(P)){const L=ks(a,F.name),A=Ha(F,L),$=Number.isFinite(A)&&A>0?A:1,Y=F.unit?F.unit.trim().toLowerCase():"";let le=0;Y==="g"||Y===""||Y==="ml"||Y===""||Y==="cc"||Y===""?le=V/1e3*P:le=V*P,F.cost=Math.round(le/$*100)/100}return K[D]=F,{...H,items:K}});return{...M,ingredientSections:T}})},[a,t]),E=be.useCallback((U,D)=>{t(C=>({...C,ingredientSections:C.ingredientSections.map(M=>M.id===U?{...M,items:M.items.filter((T,H)=>H!==D)}:M)}))},[t]),j=U=>{const D={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(C=>({...C,ingredientSections:C.ingredientSections.map(M=>M.id===U?{...M,items:[...M.items,D]}:M)}))},N=()=>{t(U=>({...U,ingredientSections:[...U.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},k=U=>{t(D=>({...D,ingredientSections:D.ingredientSections.filter(C=>C.id!==U)}))},O=(U,D)=>{t(C=>({...C,ingredientSections:C.ingredientSections.map(M=>M.id===U?{...M,name:D}:M)}))};return i.jsxs(Xi,{sensors:f,collisionDetection:f0,onDragOver:m,onDragEnd:y,children:[i.jsxs("div",{className:"recipe-form-ingredients",children:[h.map(U=>i.jsx(tl,{id:U.id,items:U.items.map(D=>D.id),strategy:Eo,children:i.jsxs(tk,{section:U,sections:h,onSectionChange:O,onRemoveSection:k,children:[U.items.map((D,C)=>(()=>{const M=ks(a,D?.name),T=pb(M?.yieldPercent??M?.yield_percent??D?.yieldPercent??D?.yield_percent);return i.jsx(ek,{id:D.id,index:C,item:D,groupId:U.id,yieldPercentApplied:T,onChange:w,onRemove:E,handleSuggestionSelect:_,onOpenConversion:()=>d({isOpen:!0,groupId:U.id,index:C})},D.id)})()),i.jsx(re,{type:"button",variant:"ghost",onClick:()=>j(U.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},U.id)),i.jsx(re,{type:"button",variant:"secondary",onClick:N,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(R0,{dropAnimation:{sideEffects:wp({styles:{active:{opacity:"0.5"}}})},children:null}),i.jsx(hb,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,groupId:null,index:null}),onApply:v,ingredientName:x?.name||"",currentCost:x?.purchaseCost,currentQuantity:x?.quantity,unit:x?.unit||"g",initialPurchaseCost:x?.purchase_cost,initialContentAmount:x?.content_amount})]})},rk=({id:n,index:t,item:s,groupId:a,onChange:o,onRemove:u})=>{const{attributes:d,listeners:h,setNodeRef:f,transform:m,transition:y,isDragging:v}=ul({id:n,data:{groupId:a,index:t}}),x={transform:kr.Translate.toString(m),transition:y,opacity:v?.3:1,position:"relative",zIndex:v?999:"auto"};return i.jsxs("div",{ref:f,style:{...x,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[i.jsx("div",{...d,...h,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),i.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),i.jsx("div",{style:{flex:1},children:i.jsx(Ut,{textarea:!0,value:s.text,onChange:w=>o(a,t,w.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(a,t),title:"",children:""})})]})},sk=({section:n,sections:t,onSectionChange:s,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=Go({id:n.id});return i.jsxs(tn,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(Ut,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},ik=({formData:n,setFormData:t})=>{b.useEffect(()=>{if(!n.stepSections){const x=n.stepGroups||[{id:"default",name:""}],_=(n.steps||[]||[]).map(k=>typeof k=="string"?{id:crypto.randomUUID(),text:k}:k),E=x.map(k=>({id:k.id,name:k.name,items:_.filter(O=>k.id==="default"&&!O.groupId?!0:O.groupId===k.id)})),j=new Set(E.flatMap(k=>k.items.map(O=>O.id))),N=_.filter(k=>!j.has(k.id));N.length>0&&(E.length>0?E[0].items.push(...N):E.push({id:"default",name:"",items:N})),E.length===0&&E.push({id:crypto.randomUUID(),name:"",items:[]}),t(k=>({...k,stepSections:E}))}},[n.steps,n.stepGroups,n.stepSections,t]);const s=n.stepSections||[],a=ll(gr(qo,{activationConstraint:{distance:10}}),gr(Fo,{activationConstraint:{delay:250,tolerance:5}}),gr(cl,{coordinateGetter:Ku})),o=({active:x,over:w})=>{if(!w)return;const _=x.id,E=w.id,j=s.find(k=>k.items.some(O=>O.id===_)),N=s.find(k=>k.items.some(O=>O.id===E))||s.find(k=>k.id===E);!j||!N||j===N||t(k=>{const O=j.items,U=N.items,D=O.findIndex(T=>T.id===_),C=U.findIndex(T=>T.id===E);let M;if(E===N.id)M=U.length+1;else{const H=w&&x.rect.current.translated&&x.rect.current.translated.top>w.rect.top+w.rect.height?1:0;M=C>=0?C+H:U.length+1}return{...k,stepSections:k.stepSections.map(T=>T.id===j.id?{...T,items:O.filter(H=>H.id!==_)}:T.id===N.id?{...T,items:[...U.slice(0,M),O[D],...U.slice(M,U.length)]}:T)}})},u=({active:x,over:w})=>{if(!w)return;const _=x.id,E=w.id,j=s.find(k=>k.items.some(O=>O.id===_)),N=s.find(k=>k.items.some(O=>O.id===E))||s.find(k=>k.id===E);if(j&&N&&j===N){const k=j.items.findIndex(U=>U.id===_),O=N.items.findIndex(U=>U.id===E);k!==O&&t(U=>({...U,stepSections:U.stepSections.map(D=>D.id===j.id?{...D,items:Zi(D.items,k,O)}:D)}))}},d=(x,w,_)=>{t(E=>({...E,stepSections:E.stepSections.map(j=>{if(j.id!==x)return j;const N=[...j.items];return N[w]={...N[w],text:_},{...j,items:N}})}))},h=(x,w)=>{t(_=>({..._,stepSections:_.stepSections.map(E=>E.id===x?{...E,items:E.items.filter((j,N)=>N!==w)}:E)}))},f=x=>{const w={id:crypto.randomUUID(),text:""};t(_=>({..._,stepSections:_.stepSections.map(E=>E.id===x?{...E,items:[...E.items,w]}:E)}))},m=()=>{t(x=>({...x,stepSections:[...x.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},y=x=>{t(w=>({...w,stepSections:w.stepSections.filter(_=>_.id!==x)}))},v=(x,w)=>{t(_=>({..._,stepSections:_.stepSections.map(E=>E.id===x?{...E,name:w}:E)}))};return i.jsxs(Xi,{sensors:a,collisionDetection:f0,onDragOver:o,onDragEnd:u,children:[i.jsxs("div",{className:"recipe-form-steps",children:[s.map(x=>i.jsx(tl,{id:x.id,items:x.items.map(w=>w.id),strategy:Eo,children:i.jsxs(sk,{section:x,sections:s,onSectionChange:v,onRemoveSection:y,children:[x.items.map((w,_)=>i.jsx(rk,{id:w.id,index:_,item:w,groupId:x.id,onChange:d,onRemove:h},w.id)),i.jsx(re,{type:"button",variant:"ghost",onClick:()=>f(x.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},x.id)),i.jsx(re,{type:"button",variant:"secondary",onClick:m,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(R0,{dropAnimation:{sideEffects:wp({styles:{active:{opacity:"0.5"}}})},children:null})]})},mb=({onClose:n,onImport:t,initialMode:s="url"})=>{const a=ea(),[o,u]=b.useState(s),[d,h]=b.useState(null),[f,m]=b.useState(""),[y,v]=b.useState(""),[x,w]=b.useState(null),[_,E]=b.useState(null),[j,N]=b.useState(!1),[k,O]=b.useState(!1),[U,D]=b.useState(null),[C,M]=b.useState(!1),T=b.useRef(null),H=b.useRef(null),K=b.useRef(null),F=b.useRef(null),q=()=>{F.current&&(clearTimeout(F.current),F.current=null)},V=(I="")=>{if(q(),K.current){try{K.current.abort()}catch{}K.current=null}O(!1),I&&D(I)};b.useEffect(()=>()=>{if(q(),K.current){try{K.current.abort()}catch{}K.current=null}},[]),b.useEffect(()=>{if(!x){E(null);return}const I=URL.createObjectURL(x);return E(I),()=>URL.revokeObjectURL(I)},[x]);const P=I=>new Promise(te=>{if(!I||typeof I!="object")return te(I);const ye=String(I.type||"").toLowerCase();if(!ye.startsWith("image/"))return te(I);const Ne=2e6,Oe=2e3,qe=.9,$e=String(I.name||"").toLowerCase(),Je=ye.includes("heic")||ye.includes("heif")||$e.endsWith(".heic")||$e.endsWith(".heif"),pe=URL.createObjectURL(I);let Xe=!1;const ot=Ae=>{if(!Xe){Xe=!0;try{URL.revokeObjectURL(pe)}catch{}te(Ae)}},jt=setTimeout(()=>ot(I),15e3),ke=new Image;ke.onload=()=>{const Ae=ke.naturalWidth||ke.width||0,it=ke.naturalHeight||ke.height||0;if(!Ae||!it)return clearTimeout(jt),ot(I);const Mt=Math.min(1,Oe/Math.max(Ae,it)),yt=Math.max(1,Math.round(Ae*Mt)),ie=Math.max(1,Math.round(it*Mt)),_e=Mt<1,Ee=Je||I.size>Ne;if(!_e&&!Ee)return clearTimeout(jt),ot(I);const Ie=document.createElement("canvas");Ie.width=yt,Ie.height=ie;const ct=Ie.getContext("2d");if(!ct)return clearTimeout(jt),ot(I);ct.drawImage(ke,0,0,yt,ie),Ie.toBlob(pt=>{if(clearTimeout(jt),!pt)return ot(I);const Rt=String(I.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);ot(new File([pt],`${Rt}.jpg`,{type:"image/jpeg"}))},"image/jpeg",qe)},ke.onerror=()=>{clearTimeout(jt),ot(I)},ke.src=pe}),L=async I=>{if(I){if(!String(I.type||"").startsWith("image/")){D("");return}D(null),N(!0);try{const te=await P(I);w(te||I)}finally{N(!1)}}},A=()=>T.current?.click?.(),$=()=>H.current?.click?.(),Y=I=>{I.preventDefault(),I.stopPropagation(),I.type==="dragenter"||I.type==="dragover"?M(!0):I.type==="dragleave"&&M(!1)},le=I=>{if(I.preventDefault(),I.stopPropagation(),M(!1),I.dataTransfer.files&&I.dataTransfer.files[0]){const te=I.dataTransfer.files[0];te.type.startsWith("image/")&&L(te)}},me=I=>/[---]/.test(I||""),B=async I=>{try{const te=[];te.push(I.name||""),te.push(I.description||"");const ye=[];Array.isArray(I.ingredients)&&I.ingredients.forEach((Xe,ot)=>{Xe.name&&(te.push(Xe.name),ye.push(ot))});const Ne=[];if(Array.isArray(I.steps)&&I.steps.forEach((Xe,ot)=>{te.push(Xe),Ne.push(ot)}),te.length===0)return I;const{data:Oe,error:qe}=await Te.functions.invoke("translate",{body:{text:te,target_lang:"JA"}});if(qe)throw qe;const $e=Oe.translations.map(Xe=>Xe.text);let Je=0;const pe={...I};return pe.name=$e[Je++]||pe.name,pe.description=$e[Je++]||pe.description,ye.length>0&&(pe.ingredients=pe.ingredients.map((Xe,ot)=>{const jt=ye.indexOf(ot);return jt!==-1?{...Xe,name:$e[Je+jt]}:Xe}),Je+=ye.length),Ne.length>0&&(pe.steps=pe.steps.map((Xe,ot)=>{const jt=Ne.indexOf(ot);return jt!==-1?$e[Je+jt]:Xe})),pe}catch(te){return console.error("Translation failed:",te),a.warning(""),I}},[W,J]=b.useState([]),ge=async(I,te)=>{const ye="REDACTED_GOOGLE_API_KEY";if(I.size>4e6)return null;const Oe=await I.arrayBuffer(),qe=btoa(new Uint8Array(Oe).reduce((ke,Ae)=>ke+String.fromCharCode(Ae),"")),$e=I.type||"image/jpeg",pe=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${ye}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`


: 
- 
- 

JSONJSON
\`\`\`json
{
  "title": "",
  "description": "",
  "ingredients": [
    { "name": "", "quantity": "", "unit": "", "group": null }
  ],
  "steps": ["1...", "2..."]
}
\`\`\`


- 115ml, 15ml, 1200ml 
- 
- `},{inline_data:{mime_type:$e,data:qe}}]}]}),signal:te});if(!pe.ok){const ke=await pe.text();throw console.error("Gemini API Error:",pe.status,ke),new Error(`Gemini API Error: ${pe.status}`)}const ot=(await pe.json()).candidates?.[0]?.content?.parts?.[0]?.text;if(!ot)throw new Error("Gemini");let jt=ot;return jt.includes("```json")?jt=jt.split("```json")[1].split("```")[0]:jt.includes("```")&&(jt=jt.split("```")[1].split("```")[0]),{recipe:JSON.parse(jt.trim()),rawText:ot}},ze=async()=>{O(!0),D(null),J([]);try{let I,te="";if(o==="url"){if(!y)return;te=y;const{data:Oe,error:qe}=await Te.functions.invoke("scrape-recipe",{body:{url:y}});if(qe)throw qe;I=Oe}else{if(!x)return;q();const Oe=new AbortController;K.current=Oe;const qe=12e4;F.current=setTimeout(()=>{V("")},qe);const $e="REDACTED_GOOGLE_API_KEY";let Je=!1;if($e){J(pe=>[...pe," Gemini API..."]);try{const pe=await ge(x,Oe.signal);pe&&pe.recipe&&pe.recipe.title&&(J(Xe=>[...Xe," "]),I={recipe:pe.recipe,rawText:pe.rawText},Je=!0)}catch(pe){if(pe.name==="AbortError")throw pe;console.warn("Direct Gemini failed, falling back to Edge Function:",pe.message),J(Xe=>[...Xe,` API: ${pe.message}`])}}if(!Je){J(it=>[...it," ..."]);const pe=new FormData;pe.append("image",x);const{data:{session:Xe}}=await Te.auth.getSession(),jt="http://127.0.0.1:54321/functions/v1/analyze-image",ke={Authorization:`Bearer ${Xe?.access_token||"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH"}`};let Ae;try{Ae=await fetch(jt,{method:"POST",headers:ke,body:pe,signal:Oe.signal})}catch(it){throw console.error("Network Error:",it),new Error("")}if(!Ae.ok){const it=Ae.status;throw new Error(`Server Error: ${Ae.statusText} (${it})`)}if(!Ae.body)I=await Ae.json();else{const it=Ae.body.getReader(),Mt=new TextDecoder;let yt=null,ie="",_e=!1;for(;;){const{done:Ee,value:Ie}=await it.read();if(Ee)break;ie+=Mt.decode(Ie,{stream:!0});const ct=ie.split(`

`);ie=ct.pop()||"";for(const pt of ct){const Rt=pt.trim();if(Rt.startsWith("data: "))try{const Jt=JSON.parse(Rt.slice(6));if(Jt.type==="log")J(Sn=>[...Sn,Jt.message]);else if(Jt.type==="result")yt=Jt,_e=!0;else if(Jt.type==="error")throw new Error(Jt.message)}catch(Jt){if(Jt.message&&!Jt.message.includes("Failed to parse"))throw Jt;console.warn("Failed to parse SSE event",Jt)}}if(_e)break}try{await it.cancel()}catch{}if(!yt)throw new Error("");I=yt}}}if(I.error)throw new Error(I.error);if(!I.recipe)throw new Error("No recipe found");let ye=I.recipe;if(ye.name=ye.name||ye.title||"",ye.recipeYield=ye.recipeYield||ye.servings||"",ye.description=ye.description||"",!ye.ingredients&&ye.recipeIngredient&&(ye.ingredients=ye.recipeIngredient),Array.isArray(ye.ingredients)){const Oe=["","","method","instructions","steps","preparation"],qe=[],$e=[];ye.ingredients.forEach(Je=>{const pe=(Je.group||"").trim().toLowerCase();if(pe&&Oe.some(Xe=>pe===Xe||pe.includes(Xe))){const Xe=Je.name||Je.text||"";Xe&&$e.push(Xe)}else qe.push(Je)}),$e.length>0&&(console.log("Extracted steps from ingredients:",$e),ye.ingredients=qe,ye.steps=Array.isArray(ye.steps)?ye.steps:[],ye.steps=[...ye.steps,...$e])}const Ne=(ye.name||"")+(ye.steps?ye.steps.slice(0,3).join(""):"");if(Ne&&!me(Ne)){h(ye),m(te),u("confirm-translation"),O(!1);return}t(ye,te),n()}catch(I){if(console.error("Import failed details:",I),I?.name==="AbortError")return;const te=I.message||"Import failed. Please try again.";D(te)}finally{q(),K.current=null,o!=="confirm-translation"&&O(!1)}},Re=async I=>{O(!0);try{let te=d;I&&(te=await B(d)),t(te,f),n()}catch(te){console.error("Translation flow error:",te),D("Translation failed. Importing original."),t(d,f),n()}finally{O(!1)}},he=I=>{const te=I.target.files[0];te&&L(te),I.target.value=""};return i.jsxs("div",{className:"modal-overlay fade-in",children:[k&&i.jsxs("div",{className:"loading-overlay",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"..."}),W.length>0&&i.jsx("div",{className:"progress-log-container",children:i.jsxs("div",{className:"progress-log",children:[W.map((I,te)=>i.jsx("div",{className:"log-entry",children:i.jsx("span",{className:"log-message",children:I})},te)),i.jsx("div",{ref:I=>I?.scrollIntoView({behavior:"smooth"})})]})}),i.jsx("div",{style:{marginTop:"0.9rem",display:"flex",justifyContent:"center"},children:i.jsx(re,{type:"button",variant:"secondary",onClick:()=>V(),children:""})})]}),i.jsxs(tn,{className:"import-modal-card",children:[i.jsx("h3",{className:"modal-title",children:o==="confirm-translation"?"":""}),o==="confirm-translation"?i.jsxs("div",{className:"translation-confirm-content",children:[i.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),i.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),i.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[i.jsx(re,{type:"button",variant:"primary",onClick:()=>Re(!0),isLoading:k,style:{width:"100%"},children:""}),i.jsx(re,{type:"button",variant:"secondary",onClick:()=>Re(!1),disabled:k,style:{width:"100%"},children:""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"import-mode-tabs",children:[i.jsx("button",{type:"button",onClick:()=>u("url"),className:`tab-btn tab-import-web ${o==="url"?"active":""}`,children:" Web URL"}),i.jsx("button",{type:"button",onClick:()=>u("image"),className:`tab-btn tab-import-image ${o==="image"?"active":""}`,children:"  (Best Effort)"})]}),o==="url"?i.jsxs(i.Fragment,{children:[i.jsx("p",{children:"URL"}),i.jsx("input",{type:"url",placeholder:"https://...",value:y,onChange:I=>v(I.target.value),className:"import-url-input",autoFocus:!0})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{children:""}),i.jsxs("div",{className:"image-upload-wrapper",children:[i.jsx("input",{ref:T,type:"file",accept:"image/*",capture:"environment",onChange:he,className:"image-upload-input"}),i.jsx("input",{ref:H,type:"file",accept:"image/*",onChange:he,className:"image-upload-input"}),i.jsx("div",{onDragEnter:Y,onDragLeave:Y,onDragOver:Y,onDrop:le,className:`image-upload-label ${C?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{k||j||$()},onKeyDown:I=>{k||j||(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),$())},children:_?i.jsx("img",{src:_,alt:"Preview",className:"image-upload-preview"}):C?"":""}),i.jsxs("div",{className:"image-upload-actions",children:[i.jsx(re,{type:"button",variant:"secondary",onClick:A,disabled:k||j,children:""}),i.jsx(re,{type:"button",variant:"secondary",onClick:$,disabled:k||j,children:""})]})]}),j&&i.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),U&&i.jsx("p",{className:"error-text",children:U}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(re,{type:"button",variant:"ghost",onClick:n,disabled:k,children:""}),i.jsx(re,{type:"button",variant:"primary",onClick:ze,isLoading:k,disabled:j||(o==="url"?!y:!x),children:""})]})]})]})]})},Rx=({onSave:n,onCancel:t,initialData:s})=>{const a=s||{},[o,u]=b.useState("ingredients"),[d,h]=b.useState(null),[f,m]=b.useState(new Map);be.useEffect(()=>{(async()=>{const P=await nr.fetchPriceList();m(P)})()},[]);const y=b.useMemo(()=>{const V=a.steps||[""];let P=a.stepGroups||[];const L=V.some($=>typeof $=="object"&&$.group);if(P.length===0&&L){const $=new Map;V.forEach(Y=>{typeof Y=="object"&&Y.group&&!$.has(Y.group)&&$.set(Y.group,crypto.randomUUID())}),P=Array.from($.entries()).map(([Y,le])=>({id:le,name:Y}))}return{steps:V.map($=>{const Y=typeof $=="string"?$:$.text||"",le=typeof $=="object"&&$.id?$.id:crypto.randomUUID();let me=typeof $=="object"?$.groupId:void 0;const B=typeof $=="object"?$.group:void 0;if(!me&&B&&P.length>0){const W=P.find(J=>J.name===B);W&&(me=W.id)}return{id:le,text:Y,groupId:me}}),stepGroups:P}},[a]),v=y.steps,x=y.stepGroups,w=b.useMemo(()=>{const V=a.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let P=a.ingredientGroups||[];if(P.length===0&&V.some(A=>A.group)){const A=new Map;V.forEach($=>{$.group&&!A.has($.group)&&A.set($.group,crypto.randomUUID())}),P=Array.from(A.entries()).map(([$,Y])=>({id:Y,name:$})),A.size>0&&V.some($=>!$.group)}return{ingredients:V.map(A=>{const $=typeof A=="string"?{name:A,quantity:"",unit:"",cost:"",purchaseCost:""}:{...A,cost:A.cost||"",purchaseCost:A.purchaseCost||""};let Y=$.groupId;if(!Y&&$.group&&P.length>0){const le=P.find(me=>me.name===$.group);le&&(Y=le.id)}return{...$,id:$.id||crypto.randomUUID(),groupId:Y}}),ingredientGroups:P}},[a]),_=w.ingredients,E=w.ingredientGroups,[j,N]=b.useState({title:a.title||"",description:a.description||"",image:a.image||"",imageFile:null,storeName:a.storeName||"",servings:a.servings||"",ingredients:_,ingredientGroups:E,steps:v,stepGroups:x,tags:a.tags||[""],course:a.course||"",category:a.category||"",type:a.type||"normal",flours:a.flours||[],breadIngredients:a.breadIngredients||[],sourceUrl:a.sourceUrl||""}),[k,O]=b.useState(!1),U=(V,P="")=>{const L=new Map,A=V.ingredients||[];A.forEach(J=>{let ge=J.group||"";ge==="Main"&&(ge=""),L.has(ge)||L.set(ge,crypto.randomUUID())});const $=Array.from(L.entries()).map(([J,ge])=>({id:ge,name:J})),Y=A.map(J=>{let ge=J.group||"";ge==="Main"&&(ge="");let ze;return L.has(ge)&&(ze=L.get(ge)),{id:crypto.randomUUID(),name:J.name||"",quantity:J.quantity||"",unit:J.unit||"",cost:"",purchaseCost:"",groupId:ze}}),le=new Map,me=V.steps||[];me.forEach(J=>{typeof J=="object"&&J.group&&J.group!=="Main"&&(le.has(J.group)||le.set(J.group,crypto.randomUUID()))});const B=Array.from(le.entries()).map(([J,ge])=>({id:ge,name:J})),W=me.map(J=>{const ge=typeof J=="object",ze=ge?J.text||"":J,Re=ge?J.group:null;let he;return Re&&le.has(Re)&&(he=le.get(Re)),{id:crypto.randomUUID(),text:ze,groupId:he}});N(J=>({...J,title:V.name||J.title,description:V.description||J.description,category:P?"URL":V.category||J.category,image:V.image||J.image,servings:V.recipeYield||J.servings,ingredients:Y,ingredientGroups:$,steps:W,stepGroups:B,ingredientSections:void 0,stepSections:void 0,sourceUrl:P||J.sourceUrl})),h(null),u("ingredients")},D=V=>{V.preventDefault(),V.stopPropagation(),V.type==="dragenter"||V.type==="dragover"?O(!0):V.type==="dragleave"&&O(!1)},C=V=>{if(V.preventDefault(),V.stopPropagation(),O(!1),V.dataTransfer.files&&V.dataTransfer.files[0]){const P=V.dataTransfer.files[0];P.type.startsWith("image/")&&N(L=>({...L,imageFile:P,image:URL.createObjectURL(P)}))}},M=V=>{const{id:P,value:L}=V.target;N(A=>({...A,[P]:L}))},T=V=>{const P=V.target.files[0];P&&N(L=>({...L,imageFile:P,image:URL.createObjectURL(P)}))},H=b.useMemo(()=>{if(j.type==="bread")return(j.flours?.length||0)+(j.breadIngredients?.length||0);const V=j.ingredientSections||[];return V.length>0?V.reduce((P,L)=>P+(L?.items?.length||0),0):j.ingredients?.length||0},[j.breadIngredients,j.flours,j.ingredientSections,j.ingredients,j.type]),K=b.useMemo(()=>{const V=j.stepSections||[];return V.length>0?V.reduce((P,L)=>P+(L?.items?.length||0),0):j.steps?.length||0},[j.stepSections,j.steps]),F=V=>{V.preventDefault();let P=[],L=[];if(j.type==="bread")P=j.ingredients.map(B=>{const{id:W,...J}=B;return J});else{const B=j.ingredientSections||[];B.length===0&&j.ingredients.length>0?P=j.ingredients.map(W=>{const{id:J,...ge}=W;return ge}):(P=B.flatMap(W=>W.items.map(J=>({...J,groupId:W.id}))).map(W=>{const{id:J,...ge}=W;return ge}),L=B.map(W=>({id:W.id,name:W.name})))}const A=new Set(j.tags||[]);j.course&&A.add(j.course),j.category&&A.add(j.category),j.type==="bread"&&A.add("");const $=Array.from(A).filter(Boolean);let Y=[],le=[];const me=j.stepSections||[];me.length===0&&j.steps.length>0?Y=j.steps.map(B=>typeof B=="string"?{text:B}:B):(Y=me.flatMap(B=>B.items.map(W=>({text:W.text,groupId:B.id}))),le=me.map(B=>({id:B.id,name:B.name}))),n({...j,ingredients:P,ingredientGroups:L,steps:Y,stepGroups:le,image:j.imageFile||j.image,id:a.id||Date.now(),tags:$,ingredientSections:void 0,stepSections:void 0})},q=!!a?.id;return i.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:F,children:[d&&i.jsx(mb,{onClose:()=>h(null),onImport:U,initialMode:d}),i.jsxs("div",{className:"recipe-form-mock__page",children:[i.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:i.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[i.jsxs("div",{className:"recipe-form-mock__crumb",children:[i.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),i.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),i.jsx("span",{className:"recipe-form-mock__crumb-page",children:q?"":""})]}),i.jsxs("div",{className:"recipe-form-mock__actions",children:[i.jsx(re,{type:"button",variant:"ghost",onClick:t,children:""}),i.jsx(re,{type:"submit",variant:"primary",children:""})]})]})}),i.jsxs("div",{className:"recipe-form-mock__sheet",children:[i.jsxs("header",{className:"recipe-form-mock__doc",children:[i.jsxs("div",{className:"recipe-form-mock__doc-title",children:[i.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:j.title,onChange:M,placeholder:"",required:!0}),i.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),i.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(Ut,{label:"",id:"course",value:j.course,onChange:M,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"course-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(Ut,{label:"",id:"category",value:j.category,onChange:M,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"category-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(Ut,{label:"",id:"storeName",value:j.storeName,onChange:M,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),i.jsx("datalist",{id:"store-options",children:Su.map(V=>i.jsx("option",{value:V},V))})]}),i.jsx("div",{className:"recipe-form-mock__meta-field",children:i.jsx(Ut,{label:"",id:"servings",value:j.servings,onChange:M,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),i.jsxs("div",{className:"recipe-form-mock__grid",children:[i.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsx(Ut,{label:"",id:"description",textarea:!0,value:j.description,onChange:M,placeholder:"..."}),i.jsx(Ut,{label:"URL",id:"sourceUrl",value:j.sourceUrl||"",onChange:M,placeholder:"https://example.com/recipe/..."})]}),i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:`recipe-form-mock__image-drop ${k?"is-active":""}`,onDragEnter:D,onDragLeave:D,onDragOver:D,onDrop:C,children:[j.image?i.jsxs("div",{className:"recipe-form-mock__image-preview",children:[i.jsx("img",{src:j.image,alt:"",onError:V=>{V.target.style.display="none"}}),i.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>N(V=>({...V,image:"",imageFile:null})),title:"",children:""})]}):i.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",i.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),i.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"recipe-form-mock__image-input"})]})]}),!a?.id&&i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:"recipe-form-mock__import-actions",children:[i.jsx(re,{variant:"secondary",type:"button",onClick:()=>h("url"),children:"URL"}),i.jsx(re,{variant:"secondary",type:"button",onClick:()=>h("image"),children:""})]}),i.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[i.jsx("li",{children:""}),i.jsx("li",{children:""}),i.jsx("li",{children:""})]})]})]}),i.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:i.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[i.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[i.jsxs("div",{className:"recipe-form-mock__nav",children:[i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:H.toLocaleString()})]}),i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${o==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:K.toLocaleString()})]})]}),i.jsx("div",{className:"recipe-form-mock__workspace-right",children:o==="ingredients"?i.jsxs("div",{className:"recipe-form-mock__segmented",children:[i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="normal"?"active":""}`,onClick:()=>N(V=>({...V,type:"normal"})),children:""}),i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="bread"?"active":""}`,onClick:()=>N(V=>({...V,type:"bread"})),children:""})]}):i.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),i.jsx("div",{className:"recipe-form-mock__workspace-body",children:o==="ingredients"?i.jsx("div",{className:"recipe-form-mock__editor-surface",children:j.type==="bread"?i.jsx(VN,{formData:j,setFormData:N}):i.jsx(nk,{formData:j,setFormData:N,priceList:f})}):i.jsx("div",{className:"recipe-form-mock__editor-surface",children:i.jsx(ik,{formData:j,setFormData:N})})})]})})]})]})]})]})},ak="modulepreload",lk=function(n){return"/app/"+n},Ax={},ju=function(t,s,a){let o=Promise.resolve();if(s&&s.length>0){let f=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");o=f(s.map(m=>{if(m=lk(m),m in Ax)return;Ax[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":ak,y||(x.as="script"),x.crossOrigin="",x.href=m,h&&x.setAttribute("nonce",h),document.head.appendChild(x),y)return new Promise((w,_)=>{x.addEventListener("load",w),x.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return o.then(d=>{for(const h of d||[])h.status==="rejected"&&u(h.reason);return t().catch(u)})},ok=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},Qi={async fetchAllProfiles(){try{const{data:t,error:s}=await Te.rpc("admin_list_profiles");if(!s&&Array.isArray(t))return t;s&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",s)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const n=await Te.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await Te.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const a=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let o=null;if(a)try{const{data:d,error:h}=await Te.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(h)throw h;if(d){const f=ok(d);if(f)return f}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),o=d}const u=await Te.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(o&&a)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${o.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await Te.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminResetPassword(n,t){const{data:s,error:a}=await Te.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(a)throw a;if(s?.error)throw new Error(s.error);return s},async sendPasswordResetEmail(n){const{error:t}=await Te.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(t)throw t;return!0}},Ox="csv_unit_overrides",Dx=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),Uu={async _getCurrentUserId(){const{data:n,error:t}=await Te.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:s,error:a}=await Te.from(Ox).select("ingredient_name,csv_unit").eq("user_id",t);if(a){if(Dx(a))return new Map;throw a}const o=new Map;return(s||[]).forEach(u=>{u?.ingredient_name&&o.set(String(u.ingredient_name),String(u.csv_unit||""))}),o}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim(),u=String(t||"").trim();if(!o)throw new Error("");if(!u)throw new Error("");const{data:d,error:h}=await Te.from(Ox).upsert({user_id:a,ingredient_name:o,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(h)throw Dx(h)?new Error("DB csv_unit_overrides "):h;return d}},ck=()=>{const n=ea(),{user:t}=es(),[s,a]=b.useState([]),[o,u]=b.useState(""),[d,h]=b.useState("all"),[f,m]=b.useState(null),[y,v]=b.useState(!1),[x,w]=b.useState(new Map),[_,E]=b.useState(new Map),[j,N]=b.useState({}),[k,O]=b.useState(!1),[U,D]=b.useState([]),[C,M]=b.useState(!1),[T,H]=b.useState(""),[K,F]=b.useState(""),[q,V]=b.useState(!1),[P,L]=b.useState(!1),[A,$]=b.useState(null),[Y,le]=b.useState(!1),me="manual",B=ie=>{const _e=String(ie||"").trim();return!_e||_e==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(_e)?_e:"food"},W=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:me,label:""}],J=b.useCallback(ie=>{const _e=nn(ie);return _e?x?.has(_e):!1},[x]),ge=be.useMemo(()=>{const ie={all:s.length,food:0,alcohol:0,soft_drink:0,supplies:0,[me]:0};return s.forEach(_e=>{const Ee=B(_e?.itemCategory);ie[Ee]=(ie[Ee]||0)+1,J(_e?.ingredientName)||(ie[me]=(ie[me]||0)+1)}),ie},[s,J]),ze=b.useCallback(async()=>{v(!0);try{const[ie,_e,Ee]=await Promise.all([Pn.getAllConversions(),nr.fetchPriceList(),Uu.getAll()]),Ie=Array.from(ie.values()).map(ct=>({...ct,clientId:ct.ingredientName,isNew:!1,isEditing:!1}));w(_e||new Map),E(Ee||new Map),a(Ie.sort((ct,pt)=>ct.ingredientName.localeCompare(pt.ingredientName,"ja")))}catch(ie){n.error(""),console.error("Failed to load ingredients:",ie)}v(!1)},[n]);b.useEffect(()=>{const ie=setTimeout(()=>{ze()},0);return()=>clearTimeout(ie)},[ze]);const Re=()=>{const ie=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,_e=["food","alcohol","soft_drink","supplies"].includes(d)?d:"food",Ee={clientId:ie,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:_e,isNew:!0,isEditing:!0};a(Ie=>[Ee,...Ie.map(ct=>({...ct,isEditing:!1}))]),m(ie)},he=b.useCallback(ie=>s.findIndex(_e=>_e?.clientId===ie),[s]),I=async ie=>{const _e=he(ie);if(_e<0)return;const Ee=s[_e];if(!Ee.ingredientName||!Ee.packetSize||!Ee.lastPrice){n.warning("");return}const Ie=parseFloat(Ee.yieldPercent),ct=Number.isFinite(Ie)?Ie:100;if(ct<=0||ct>100){n.warning("% 1100 ");return}try{await Pn.saveConversion(Ee.ingredientName,Ee.packetSize,Ee.packetUnit,Ee.lastPrice,Ee.itemCategory,Ee.vendor,ct),n.success(""),ze(),m(null)}catch(pt){n.error(""),console.error("Save error:",pt)}},te=async ie=>{const _e=he(ie);if(_e<0)return;const Ee=s[_e],Ie=Ee?.ingredientName;if(Ee.isNew){a(ct=>ct.filter(pt=>pt?.clientId!==ie)),m(null);return}try{await Pn.deleteConversion(Ie),n.success(""),ze()}catch(ct){n.error(""),console.error("Delete error:",ct)}},ye=ie=>{m(ie),a(_e=>_e.map(Ee=>({...Ee,isEditing:Ee?.clientId===ie})))},Ne=ie=>{const _e=he(ie);_e<0||(s[_e].isNew?a(Ee=>Ee.filter(Ie=>Ie?.clientId!==ie)):ze(),m(null))},Oe=(ie,_e,Ee)=>{a(Ie=>Ie.map(ct=>ct?.clientId!==ie?ct:{...ct,[_e]:Ee}))},qe=ie=>{const _e=parseFloat(ie.lastPrice),Ee=parseFloat(ie.packetSize);if(!_e||!Ee)return"-";const Ie=ie.packetUnit?ie.packetUnit.trim().toLowerCase():"";return Ie==="g"||Ie===""?`${Math.round(_e/Ee*1e3).toLocaleString()}/kg`:Ie==="ml"||Ie==="cc"||Ie===""||Ie===""?`${Math.round(_e/Ee*1e3).toLocaleString()}/L`:`${Math.round(_e/Ee).toLocaleString()}/${ie.packetUnit}`},$e=s.filter(ie=>{const _e=String(ie?.ingredientName||"");return _e.toLowerCase().includes(o.toLowerCase())?d==="all"?!0:d===me?!J(_e):B(ie?.itemCategory)===d:!1}),Je=d!=="all"||String(o||"").trim()!=="",pe=ie=>{const _e=nn(ie);if(!_e)return"-";const Ie=(x?.get(_e)||null)?.unit;return Ie?String(Ie):"-"},Xe=ie=>{const _e=nn(ie);if(!_e)return"";const Ie=(x?.get(_e)||null)?.vendor;return Ie?String(Ie):""},ot=ie=>{const _e=String(ie?.vendor||"").trim();return _e||Xe(ie?.ingredientName)},jt=ie=>{const _e=(ie??"").toString().trim();if(!_e)return"";if(Object.prototype.hasOwnProperty.call(j,_e))return j[_e];const Ee=_?.get(_e);if(Ee)return String(Ee);const Ie=pe(_e);return Ie==="-"?"":Ie},ke=ie=>{const _e=(ie??"").toString().trim();if(!_e)return"-";const Ee=_?.get(_e);return Ee?String(Ee):pe(_e)},Ae=async(ie,_e)=>{const Ee=(ie??"").toString().trim(),Ie=(_e??"").toString().trim();if(Ee){if(!Ie){N(ct=>{const pt={...ct};return delete pt[Ee],pt});return}try{await Uu.upsert(Ee,Ie),E(ct=>{const pt=new Map(ct);return pt.set(Ee,Ie),pt}),n.success("CSV")}catch(ct){console.error(ct),n.error(ct?.message||"")}}},it=async()=>{if(t?.role==="admin"){O(!0),H(""),D([]),F(""),V(!1),$(null),le(!1),M(!0);try{const ie=await Qi.fetchAllProfiles();D(ie||[])}catch(ie){console.error(ie),H("")}finally{M(!1)}}},Mt=()=>{P||(le(!1),O(!1))},yt=async()=>{if(!(!K||P)){L(!0),$({type:"info",message:"..."});try{const ie=await Pn.adminCopyIngredientMasterToUser(K,{overwrite:q}),_e=ie?.unit_conversions||{},Ee=ie?.csv_unit_overrides||{},Ie=`: ${Number(_e.source_total||0).toLocaleString()}   ${Number(_e.copied||0).toLocaleString()} /  ${Number(_e.updated||0).toLocaleString()} /  ${Number(_e.skipped||0).toLocaleString()}`,ct=`(CSV): ${Number(Ee.source_total||0).toLocaleString()}   ${Number(Ee.copied||0).toLocaleString()} /  ${Number(Ee.updated||0).toLocaleString()} /  ${Number(Ee.skipped||0).toLocaleString()}`;$({type:"success",message:`
${Ie}
${ct}`}),n.success("")}catch(ie){console.error(ie),$({type:"error",message:`: ${String(ie?.message||ie)}`}),n.error("")}finally{L(!1)}}};return i.jsxs("div",{className:"ingredient-master-container",children:[i.jsxs("div",{className:"master-header",children:[i.jsx("h3",{children:" "}),i.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[t?.role==="admin"&&i.jsx(re,{variant:"secondary",onClick:it,disabled:f!==null||y||P,title:f!==null?"":void 0,children:""}),i.jsx(re,{variant:"primary",onClick:Re,disabled:f!==null,children:"+ "})]})]}),i.jsx("div",{className:"master-search",children:i.jsx(Ut,{placeholder:"...",value:o,onChange:ie=>u(ie.target.value)})}),i.jsxs("div",{className:"ingredient-master-stats",children:[i.jsxs("span",{children:[": ",i.jsx("strong",{children:(s.length||0).toLocaleString()})," "]}),Je&&i.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",i.jsx("strong",{children:($e.length||0).toLocaleString()})," "]})]}),i.jsx("div",{className:"ingredient-category-tabs",children:W.map(ie=>i.jsxs("button",{type:"button",className:`ingredient-category-tab ${d===ie.key?"active":""}`,onClick:()=>h(ie.key),disabled:f!==null,title:f!==null?"":void 0,children:[ie.label," (",(ge[ie.key]??0).toLocaleString(),")"]},ie.key))}),y?i.jsx("div",{className:"master-loading",children:"..."}):i.jsx("div",{className:"master-table-wrapper",children:i.jsxs("table",{className:"master-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{children:""}),i.jsx("th",{children:"%"}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:$e.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"8",style:{textAlign:"center",color:"#999"},children:Je?"":""})}):$e.map((ie,_e)=>{const Ee=ie?.clientId??ie?.ingredientName??String(_e),Ie=Xe(ie?.ingredientName),ct=String(ie?.vendor||"").trim(),pt=ie?.isEditing&&!!Ie&&Ie!==ct,Rt=ot(ie),Sn=B(ie?.itemCategory)==="food";return i.jsxs("tr",{className:ie.isEditing?"editing":"",children:[i.jsx("td",{children:ie.isEditing?i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx(Ut,{value:ie.ingredientName,onChange:_t=>Oe(Ee,"ingredientName",_t.target.value),placeholder:": ",disabled:!ie.isNew,wrapperClassName:"input-group--no-margin"}),i.jsx(Ut,{value:ie.vendor||"",onChange:_t=>Oe(Ee,"vendor",_t.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),pt&&i.jsxs("div",{className:"ingredient-subtext",children:["CSV: ",Ie]})]}):i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx("div",{children:ie.ingredientName}),Rt&&i.jsx("div",{className:"ingredient-subtext",children:Rt})]})}),i.jsx("td",{children:ie.isEditing?i.jsx(Ut,{type:"number",value:ie.lastPrice,onChange:_t=>Oe(Ee,"lastPrice",_t.target.value),placeholder:": 500"}):`${parseFloat(ie.lastPrice||0).toLocaleString()}`}),i.jsx("td",{children:ie.isEditing?i.jsxs("div",{className:"input-with-hint",children:[i.jsx(Ut,{type:"number",value:ie.packetSize,onChange:_t=>Oe(Ee,"packetSize",_t.target.value),placeholder:["","","","PC","","",""].includes(ie.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(ie.packetUnit)&&i.jsxs("span",{className:"unit-hint",children:["1",ie.packetUnit,"1"]})]}):ie.packetSize}),i.jsx("td",{children:ie.isEditing?i.jsxs("select",{value:ie.packetUnit,onChange:_t=>Oe(Ee,"packetUnit",_t.target.value),className:"unit-select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"cc",children:"cc"})]}):ie.packetUnit}),i.jsx("td",{className:"csv-unit-cell",children:ie.isEditing?i.jsx(Ut,{value:jt(ie.ingredientName),onChange:_t=>{const rn=(ie.ingredientName??"").toString().trim(),cn=_t.target.value;N(xn=>({...xn,[rn]:cn}))},onBlur:_t=>Ae(ie.ingredientName,_t.target.value),placeholder:pe(ie.ingredientName)==="-"?"":`CSV: ${pe(ie.ingredientName)}`}):i.jsx("span",{children:ke(ie.ingredientName)})}),i.jsx("td",{className:"normalized-cost",children:qe(ie)}),i.jsx("td",{children:Sn?ie.isEditing?i.jsx(Ut,{type:"number",value:ie.yieldPercent??"",onChange:_t=>Oe(Ee,"yieldPercent",_t.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const _t=parseFloat(ie.yieldPercent);if(!Number.isFinite(_t)||_t<=0)return"-";const rn=Math.round(_t*10)/10;return`${Number.isInteger(rn)?Math.round(rn):rn}%`})():i.jsx("span",{style:{color:"#999"},children:"-"})}),i.jsx("td",{children:i.jsx("div",{className:"action-buttons",children:ie.isEditing?i.jsxs(i.Fragment,{children:[i.jsx(re,{variant:"primary",size:"sm",onClick:()=>I(Ee),children:""}),i.jsx(re,{variant:"ghost",size:"sm",onClick:()=>Ne(Ee),children:""})]}):i.jsxs(i.Fragment,{children:[i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>ye(Ee),disabled:f!==null,children:""}),i.jsx(re,{variant:"ghost",size:"sm",onClick:()=>te(Ee),disabled:f!==null,children:""})]})})})]},Ee)})})]})}),i.jsx("div",{className:"master-info",children:i.jsx("p",{children:" "})}),i.jsx(pn,{isOpen:k,onClose:Mt,title:"",size:"medium",showCloseButton:!P,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",i.jsx("br",{}),i.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),Y?i.jsxs(i.Fragment,{children:[(()=>{const ie=U.find(Ee=>String(Ee?.id)===String(K)),_e=ie?`${ie.display_id}${ie.email?` (${ie.email})`:""}`:K?String(K).slice(0,8):"-";return i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",i.jsx("strong",{children:_e}),i.jsx("br",{}),": ",i.jsx("strong",{children:q?"":""})]})]})})(),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>le(!1),disabled:P,children:""}),i.jsx(re,{variant:"primary",onClick:yt,disabled:!K||P,children:P?"...":""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),C?i.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):i.jsxs("select",{value:K,onChange:ie=>F(ie.target.value),disabled:P||!!T,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:P?"#f3f4f6":"white"},children:[i.jsx("option",{value:"",children:"..."}),U.filter(ie=>String(ie?.id)&&String(ie?.id)!==String(t?.id)).map(ie=>i.jsxs("option",{value:ie.id,children:[ie.display_id,ie.email?` (${ie.email})`:"",ie.role==="admin"?" []":""]},ie.id))]}),T&&i.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:T})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[i.jsx("input",{type:"checkbox",checked:q,onChange:ie=>V(ie.target.checked),disabled:P}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(re,{variant:"ghost",onClick:Mt,disabled:P,children:""}),i.jsx(re,{variant:"primary",onClick:()=>le(!0),disabled:!K||P||C||!!T,children:""})]})]}),P&&i.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),A?.message&&i.jsx("div",{className:`status-msg ${A.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:A.message})]})})]})},pu="__all_vendors__",gb="__unknown_vendor__",lo="__all_categories__",Uf="food",_u=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],ap=_u.reduce((n,t)=>(n[t.value]=t.label,n),{}),uk=new Set(["","","","","PC","","",""]),Pi=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const s=Number(t);return Number.isFinite(s)?s:null},Mx=n=>(typeof n=="string"?n.trim():"")||gb,Ga=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?Uf:ap[t]?t:Uf},dk=()=>{const[n,t]=b.useState([]),[s,a]=b.useState(!0),[o,u]=b.useState(null),[d,h]=b.useState(null),[f,m]=b.useState("all"),[y,v]=b.useState({key:null,direction:"asc"}),[x,w]=b.useState(""),[_,E]=b.useState(lo),[j,N]=b.useState(pu),[k,O]=b.useState(!1),[U,D]=b.useState(null),C=b.useRef(null),M=ea(),[T,H]=b.useState({isOpen:!1,title:"",message:"",onConfirm:null}),K=()=>{h(I=>!I||I.phase==="running"?I:null)};b.useEffect(()=>{F()},[]);const F=async()=>{a(!0),D(null);try{console.log("Starting data load for CsvToMasterImporter...");const[I,te]=await Promise.all([nr.getPriceListArray().catch(Ne=>(console.error("Error fetching price list:",Ne),[])),Pn.getAllConversions().catch(Ne=>(console.error("Error fetching conversions:",Ne),new Map))]);if(console.log("Data fetched:",{csvCount:I?.length,masterSize:te?.size}),!Array.isArray(I))throw new Error("CSV");if(!(te instanceof Map))throw new Error("Map");const ye=[];for(const Ne of I){if(!Ne||!Ne.name)continue;const Oe=te.get(Ne.name),qe=Ga(Oe?.itemCategory),$e=Oe?.packetSize??"",Je=Oe?.packetUnit||Ne.unit||"",pe=Oe?.lastPrice??"",Xe=Oe?$e:uk.has(Je)?1:"";ye.push({name:Ne.name,csvPrice:Ne.price,csvUnit:Ne.unit,csvVendor:Ne.vendor,masterCategory:qe,masterSize:$e,masterUnit:Je,masterPrice:pe,isRegistered:!!Oe,inputSize:Xe,inputUnit:Je,inputPrice:Oe?pe:Ne.price??"",inputCategory:qe,isModified:!1})}console.log("Merge completed. Items:",ye.length),t(ye)}catch(I){console.error("Failed to load data for importer:",I),D(I.message||"")}finally{a(!1)}},q=async I=>{u(I.name);try{const te=Pi(I.inputSize),ye=Pi(I.inputPrice);if(te===null||te<=0){M.error("");return}if(!I.inputUnit){M.error("");return}if(!I.inputCategory){M.error("");return}await Pn.saveConversion(I.name,te,I.inputUnit,ye,I.inputCategory),t(Ne=>Ne.map(Oe=>Oe.name===I.name?{...Oe,isRegistered:!0,isModified:!1,masterSize:te,masterUnit:I.inputUnit,masterPrice:ye??"",masterCategory:I.inputCategory,inputCategory:I.inputCategory}:Oe)),M.success("")}catch(te){console.error("Failed to save ingredient:",te),M.error("")}finally{u(null)}},V=async I=>{H(te=>({...te,isOpen:!1}));try{const te=I.filter(ie=>{const _e=Pi(ie.inputSize);return!(_e!==null&&_e>0)||!ie.inputUnit||!ie.inputCategory});if(te.length>0){const ie=te.slice(0,5).map(Ee=>Ee.name).join(""),_e=te.length>5?` ${te.length-5}`:"";M.error(`: ${ie}${_e}`);return}u("bulk");const ye=I.length;h({phase:"running",total:ye,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const Ne=5,Oe=120;let qe=0,$e=0,Je=0,pe=0;const Xe=[],ot=[],jt=(ie=!1,_e="")=>{const Ee=Date.now();!ie&&Ee-pe<Oe||(pe=Ee,h(Ie=>!Ie||Ie.phase!=="running"?Ie:{...Ie,processed:qe,success:$e,failed:Je,currentName:_e||Ie.currentName}))};let ke=0;const Ae=async()=>{for(;;){const ie=ke++;if(ie>=I.length)return;const _e=I[ie],Ee=_e?.name?String(_e.name):"";try{const Ie=Pi(_e.inputSize),ct=Pi(_e.inputPrice);if(Ie===null||Ie<=0)throw new Error("Invalid size");if(!_e.inputUnit)throw new Error("Invalid unit");if(!_e.inputCategory)throw new Error("Invalid category");await Pn.saveConversion(_e.name,Ie,_e.inputUnit,ct,_e.inputCategory),$e++,Xe.push(_e)}catch(Ie){Je++,ot.push(Ee||`#${ie+1}`),console.error(`Failed to save ${Ee}:`,Ie)}finally{qe++,jt(!1,Ee)}}},it=Math.min(Ne,I.length);await Promise.all(Array.from({length:it},()=>Ae())),jt(!0);const Mt=new Set(Xe.map(ie=>ie.name)),yt=new Map(I.map(ie=>[ie.name,ie]));t(ie=>ie.map(_e=>{if(Mt.has(_e.name)){const Ee=yt.get(_e.name);return{..._e,isRegistered:!0,isModified:!1,masterSize:Pi(Ee.inputSize)??"",masterUnit:Ee.inputUnit,masterPrice:Pi(Ee.inputPrice)??"",masterCategory:Ee.inputCategory,inputCategory:Ee.inputCategory}}return _e})),Je===0?M.success(`${$e} `):M.warning(`:  ${$e}  /  ${Je} `),h({phase:"done",total:ye,processed:qe,success:$e,failed:Je,currentName:"",failedNames:ot.slice(0,10)})}catch(te){console.error("Bulk save error:",te),M.error(""),h(ye=>({phase:"error",total:ye?.total??I.length,processed:ye?.processed??0,success:ye?.success??0,failed:ye?.failed??0,currentName:"",failedNames:ye?.failedNames??[],errorMessage:te?.message?String(te.message):""}))}finally{u(null)}},P=()=>{const I=n.filter(te=>te.isModified);I.length!==0&&H({isOpen:!0,title:"",message:`${I.length} `,onConfirm:()=>V(I)})},L=(I,te,ye)=>{t(Ne=>Ne.map(Oe=>Oe.name===I?{...Oe,[te]:ye,isModified:!0}:Oe))},A=I=>{(I.key==="ArrowUp"||I.key==="ArrowDown")&&I.preventDefault()},$=I=>{v(te=>te.key===I?{key:I,direction:te.direction==="asc"?"desc":"asc"}:{key:I,direction:"asc"})},Y=I=>y.key!==I?"":y.direction==="asc"?" ":" ",le=b.useMemo(()=>{const I=new Map;n.forEach(ye=>{const Ne=Mx(ye.csvVendor),Oe=Ne===gb?"":Ne,qe=I.get(Ne);qe?qe.count+=1:I.set(Ne,{key:Ne,label:Oe,count:1})});const te=Array.from(I.values()).sort((ye,Ne)=>ye.label.localeCompare(Ne.label,"ja"));return[{key:pu,label:"",count:n.length},...te]},[n]);b.useEffect(()=>{le.some(te=>te.key===j)||N(pu)},[le,j]),b.useEffect(()=>{if(!k)return;const I=ye=>{C.current&&!C.current.contains(ye.target)&&O(!1)},te=ye=>{ye.key==="Escape"&&O(!1)};return document.addEventListener("mousedown",I),document.addEventListener("touchstart",I),document.addEventListener("keydown",te),()=>{document.removeEventListener("mousedown",I),document.removeEventListener("touchstart",I),document.removeEventListener("keydown",te)}},[k]);const me=b.useMemo(()=>j===pu?n:n.filter(I=>Mx(I.csvVendor)===j),[n,j]),B=b.useMemo(()=>{const I={[lo]:me.length};return _u.forEach(te=>{I[te.value]=0}),me.forEach(te=>{const ye=Ga(te.inputCategory);I[ye]=(I[ye]||0)+1}),I},[me]),W=b.useMemo(()=>_===lo?me:me.filter(I=>Ga(I.inputCategory)===_),[me,_]),J=b.useMemo(()=>({all:W.length,unregistered:W.filter(I=>!I.isRegistered).length,registered:W.filter(I=>I.isRegistered).length}),[W]),ge=b.useMemo(()=>le.find(I=>I.key===j)||le[0],[le,j]),ze=b.useMemo(()=>W.filter(I=>!(f==="unregistered"&&I.isRegistered||f==="registered"&&!I.isRegistered||x&&!I.name.includes(x))),[W,f,x]),Re=b.useMemo(()=>{if(!y.key)return ze;const I=Ne=>String(Ne??""),te=Ne=>{const Oe=parseFloat(Ne);return Number.isFinite(Oe)?Oe:Number.NEGATIVE_INFINITY},ye=[...ze];return ye.sort((Ne,Oe)=>{let qe=0;switch(y.key){case"name":qe=I(Ne.name).localeCompare(I(Oe.name),"ja");break;case"csvPrice":qe=te(Ne.csvPrice)-te(Oe.csvPrice);break;case"inputCategory":{const $e=ap[Ga(Ne.inputCategory)]||"",Je=ap[Ga(Oe.inputCategory)]||"";qe=$e.localeCompare(Je,"ja");break}case"inputSize":qe=te(Ne.inputSize)-te(Oe.inputSize);break;case"inputUnit":qe=I(Ne.inputUnit).localeCompare(I(Oe.inputUnit),"ja");break;case"inputPrice":qe=te(Ne.inputPrice)-te(Oe.inputPrice);break;default:qe=0;break}return qe===0&&(qe=I(Ne.name).localeCompare(I(Oe.name),"ja")),y.direction==="asc"?qe:-qe}),ye},[ze,y]),he=n.filter(I=>I.isModified).length;return s?i.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):U?i.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[i.jsx("h3",{children:""}),i.jsx("p",{children:U}),i.jsx(re,{variant:"secondary",onClick:F,children:""})]}):i.jsxs("div",{className:"csv-importer",children:[i.jsxs("div",{className:"importer-header",children:[i.jsx(Ut,{placeholder:"...",value:x,onChange:I=>w(I.target.value),style:{maxWidth:"300px"}}),i.jsxs("div",{className:"filter-buttons",children:[i.jsxs(re,{variant:f==="all"?"primary":"secondary",onClick:()=>m("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",J.all,")"]}),i.jsxs(re,{variant:f==="unregistered"?"primary":"secondary",onClick:()=>m("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",J.unregistered,")"]}),i.jsxs(re,{variant:f==="registered"?"primary":"secondary",onClick:()=>m("registered"),size:"sm",children:[" (",J.registered,")"]})]}),i.jsxs("div",{className:"vendor-dropdown",ref:C,children:[i.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>O(I=>!I),"aria-haspopup":"listbox","aria-expanded":k,children:[i.jsxs("span",{children:[": ",ge?.label," (",ge?.count??0,")"]}),i.jsx("span",{className:`vendor-dropdown-chevron ${k?"open":""}`,children:""})]}),k&&i.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:le.map(I=>i.jsxs("button",{type:"button",className:`vendor-tab ${j===I.key?"active":""}`,onClick:()=>{N(I.key),O(!1)},role:"option","aria-selected":j===I.key,children:[I.label," (",I.count,")"]},I.key))})]}),i.jsxs("div",{className:"category-filter-row",children:[i.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),i.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:_,onChange:I=>E(I.target.value),children:[i.jsxs("option",{value:lo,children:[" (",B[lo]||0,")"]}),_u.map(I=>i.jsxs("option",{value:I.value,children:[I.label," (",B[I.value]||0,")"]},I.value))]})]}),i.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[he>0&&i.jsx(re,{variant:"primary",size:"sm",onClick:P,disabled:o!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o==="bulk"?"...":`(${he})`}),i.jsx(re,{variant:"secondary",size:"sm",onClick:F,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{style:{width:"22%"},onClick:()=>$("name"),children:[" (CSV)",Y("name")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>$("csvPrice"),children:[" (CSV)",Y("csvPrice")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>$("inputCategory"),children:[" ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputCategory")]}),i.jsxs("th",{style:{width:"18%"},onClick:()=>$("inputSize"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputSize")]}),i.jsxs("th",{style:{width:"13%"},onClick:()=>$("inputUnit"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputUnit")]}),i.jsxs("th",{style:{width:"12%"},onClick:()=>$("inputPrice"),children:[" ()",Y("inputPrice")]}),i.jsx("th",{style:{width:"7%"},children:""})]})}),i.jsx("tbody",{children:Re.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:""})}):Re.map(I=>i.jsxs("tr",{style:{backgroundColor:I.isModified?"#fff8e1":I.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[i.jsxs("td",{style:{fontWeight:"500"},children:[I.name,I.csvVendor&&i.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:I.csvVendor})]}),i.jsxs("td",{children:[I.csvPrice?`${I.csvPrice.toLocaleString()} `:"-",I.csvUnit&&i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",I.csvUnit]})]}),i.jsx("td",{children:i.jsx("select",{className:"input-field",value:Ga(I.inputCategory),onChange:te=>L(I.name,"inputCategory",te.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:_u.map(te=>i.jsx("option",{value:te.value,children:te.label},te.value))})}),i.jsx("td",{children:i.jsx(Ut,{type:"number",value:I.inputSize,onChange:te=>L(I.name,"inputSize",te.target.value),onKeyDown:A,placeholder:["","","","PC","","",""].includes(I.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),i.jsx("td",{children:i.jsxs("select",{className:"input-field",value:I.inputUnit,onChange:te=>L(I.name,"inputUnit",te.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","","","","","PC","","",""].includes(I.inputUnit)&&I.inputUnit&&i.jsxs("option",{value:I.inputUnit,children:[I.inputUnit," (CSV)"]}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"kg",children:"kg"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"L",children:"L"}),i.jsx("option",{value:"cc",children:"cc"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"PC",children:"PC"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""})]})}),i.jsx("td",{children:i.jsx(Ut,{type:"number",value:I.inputPrice,onChange:te=>L(I.name,"inputPrice",te.target.value),placeholder:"",style:{width:"100%"}})}),i.jsx("td",{children:i.jsx(re,{variant:I.isRegistered?"secondary":"primary",size:"sm",onClick:()=>q(I),disabled:o===I.name||o==="bulk",block:!0,children:o===I.name?"...":I.isRegistered?"":""})})]},I.name))})]})}),i.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[i.jsx("p",{children:" CSV"}),i.jsx("p",{children:" "})]}),i.jsxs(pn,{isOpen:T.isOpen,onClose:()=>H({...T,isOpen:!1}),title:T.title,size:"small",children:[i.jsx("div",{style:{marginBottom:"1.5rem"},children:T.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[i.jsx(re,{variant:"secondary",onClick:()=>H({...T,isOpen:!1}),children:""}),i.jsx(re,{variant:"primary",onClick:T.onConfirm,children:""})]})]}),i.jsx(pn,{isOpen:!!d,onClose:K,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?i.jsxs("div",{className:"bulk-progress",children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:""}),i.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),i.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&i.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&i.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),i.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[i.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(re,{variant:"primary",onClick:K,children:""})})]}):i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),i.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(re,{variant:"primary",onClick:K,children:""})})]})})]})},zx=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},hk=({onBack:n})=>{const[t,s]=Io(),{user:a}=es(),[o,u]=b.useState("price"),[d,h]=b.useState(null),[f,m]=b.useState({type:"",message:""}),[y,v]=b.useState(!1),[x,w]=b.useState([]),[_,E]=b.useState(!1),[j,N]=b.useState(null),[k,O]=b.useState({type:"",message:""}),[U,D]=b.useState(null),[C,M]=b.useState(!1),[T,H]=b.useState(!1),[K,F]=b.useState(!1),[q,V]=b.useState([]),[P,L]=b.useState(!1),[A,$]=b.useState(""),[Y,le]=b.useState(""),[me,B]=b.useState(!1),[W,J]=b.useState({total:0,done:0,current:""}),[ge,ze]=b.useState(null),[Re,he]=b.useState(!1),[I,te]=b.useState(!1),[ye,Ne]=b.useState(new Map),[Oe,qe]=b.useState([]),[$e,Je]=b.useState(""),[pe,Xe]=b.useState(""),[ot,jt]=b.useState(""),ke=be.useMemo(()=>{if(!$e)return[];const fe=ye.get($e)||[],Ve=new Set;return fe.forEach(et=>{const Ke=zx(et?.dateStr);Ke&&Ve.add(Ke)}),Array.from(Ve).sort((et,Ke)=>Ke.localeCompare(et))},[ye,$e]);b.useEffect(()=>{if(ot){if(!$e){jt("");return}ke.length>0&&!ke.includes(ot)&&jt("")}},[ke,ot,$e]);const[Ae,it]=b.useState({key:"dateStr",direction:"desc"}),[Mt,yt]=b.useState("");b.useEffect(()=>{const fe=t.get("tab");(fe==="price"||fe==="ingredients"||fe==="csv-import"||fe==="duplicates")&&u(fe)},[]);const ie=fe=>{let Ve="asc";Ae.key===fe&&Ae.direction==="asc"&&(Ve="desc"),it({key:fe,direction:Ve})},_e=be.useMemo(()=>{let fe=[...x];if(Mt){const Ve=Mt.toLowerCase().trim();fe=fe.filter(et=>et.name&&et.name.toLowerCase().includes(Ve)||et.vendor&&et.vendor.toLowerCase().includes(Ve)||et.dateStr&&et.dateStr.includes(Ve))}return Ae.key&&fe.sort((Ve,et)=>{let Ke=Ve[Ae.key]||"",nt=et[Ae.key]||"";return Ke<nt?Ae.direction==="asc"?-1:1:Ke>nt?Ae.direction==="asc"?1:-1:0}),fe},[x,Ae,Mt]),[Ee,Ie]=b.useState([]);b.useEffect(()=>{pt()},[]);const ct=async()=>{te(!0);try{const Ve=await nr.fetchPriceHistory()||new Map;Ne(Ve);const et=[];for(const[Ke,nt]of Ve.entries()){const zt=new Set,bt=[];if((nt||[]).forEach(ne=>{const ee=[String(ne?.dateStr||""),String(ne?.price??""),String(ne?.incomingQty??""),String(ne?.unit||""),String(ne?.vendor||""),String(ne?.displayName||"")].join("|");zt.has(ee)||(zt.add(ee),bt.push(ne))}),bt.length<2)continue;bt.sort((ne,ee)=>String(ne?.dateStr||"").localeCompare(String(ee?.dateStr||"")));const At=bt[bt.length-1]||{},tt=bt.map(ne=>Number(ne?.price)).filter(ne=>Number.isFinite(ne)),$t=tt.length?Math.min(...tt):null,Qe=tt.length?Math.max(...tt):null,Lt=new Set(bt.map(ne=>String(ne?.dateStr||""))).size,Xt=new Set(bt.map(ne=>String(ne?.displayName||""))).size;let Qt=0;for(let ne=1;ne<bt.length;ne++){const ee=Number(bt[ne-1]?.price),ue=Number(bt[ne]?.price);Number.isFinite(ee)&&Number.isFinite(ue)&&ee!==ue&&Qt++}et.push({key:Ke,name:At?.displayName||Ke,lastDate:At?.dateStr||"",lastPrice:Number.isFinite(Number(At?.price))?Number(At?.price):null,lastIncomingQty:Number.isFinite(Number(At?.incomingQty))?Number(At?.incomingQty):null,unit:At?.unit||"",vendor:At?.vendor||"",rows:bt.length,dates:Lt,nameVariants:Xt,minPrice:$t,maxPrice:Qe,changes:Qt})}et.sort((Ke,nt)=>{const zt=String(Ke?.lastDate||""),bt=String(nt?.lastDate||"");return zt!==bt?bt.localeCompare(zt):(nt?.changes||0)!==(Ke?.changes||0)?(nt?.changes||0)-(Ke?.changes||0):(nt?.rows||0)!==(Ke?.rows||0)?(nt?.rows||0)-(Ke?.rows||0):String(Ke?.name||"").localeCompare(String(nt?.name||""),"ja")}),qe(et),$e&&!Ve.has($e)&&Je("")}catch(fe){console.error(fe)}finally{te(!1)}};b.useEffect(()=>{o==="duplicates"&&ct()},[o]);const pt=async()=>{E(!0);try{const fe=await nr.getPriceListArray();w(fe);const Ve=await nr.getFileList();Ie(Ve)}catch(fe){console.error("Failed to load price data",fe)}finally{E(!1)}},Rt=fe=>{fe.target.files&&fe.target.files[0]&&(h(fe.target.files[0]),m({type:"",message:""}))},Jt=async()=>{if(!d)return;v(!0),m({type:"info",message:"..."});const fe=await nr.uploadPriceList(d);if(fe.success){m({type:"success",message:"..."});try{const{recipeService:et}=await ju(async()=>{const{recipeService:zt}=await Promise.resolve().then(()=>bf);return{recipeService:zt}},[]),Ke=await nr.fetchPriceList(),nt=await et.updateRecipeCosts(Ke);m({type:"success",message:`${nt}`})}catch(et){console.error("Cost update failed",et),m({type:"warning",message:""})}h(null);const Ve=document.getElementById("csv-upload-input");Ve&&(Ve.value=""),pt()}else m({type:"error",message:`: ${fe.error.message}`});v(!1)},Sn=fe=>{N({message:`${fe}
`,onConfirm:async()=>{v(!0);const Ve=await nr.deletePriceFile(fe);v(!1),Ve.success?(m({type:"success",message:""}),pt()):m({type:"error",message:`: ${Ve.error.message}`})}})},_t=fe=>{fe&&(D(fe),M(!0),O({type:"",message:""}))},rn=()=>{if(T)return;M(!1),D(null);const fe=document.getElementById("backup-upload-input");fe&&(fe.value="")},cn=async()=>{const fe=U;if(!(!fe||T)){H(!0),O({type:"info",message:"..."});try{const Ve=await fe.text(),et=JSON.parse(Ve),{recipeService:Ke}=await ju(async()=>{const{recipeService:At}=await Promise.resolve().then(()=>bf);return{recipeService:At}},void 0),nt=await Ke.importRecipes(et),zt=Number(nt?.count||0),bt=Array.isArray(nt?.errors)?nt.errors.length:0;O({type:bt>0?"warning":"success",message:`: ${zt}${bt>0?` / : ${bt}`:""}`}),M(!1),D(null)}catch(Ve){console.error(Ve),O({type:"error",message:""})}finally{H(!1);const Ve=document.getElementById("backup-upload-input");Ve&&(Ve.value="")}}},xn=async()=>{F(!0),ze(null),J({total:0,done:0,current:""}),le(""),$(""),he(!1),L(!0);try{const fe=await Qi.fetchAllProfiles();V(fe||[])}catch(fe){console.error(fe),V([]),$("")}finally{L(!1)}},Ln=()=>{me||(he(!1),F(!1))},ar=async()=>{if(!(!Y||me)){B(!0),ze({type:"info",message:"..."}),J({total:0,done:0,current:""});try{const fe=await nr.copyPriceFilesToUser({targetUserId:Y,onProgress:({total:Ke,done:nt,current:zt})=>{J({total:Ke||0,done:nt||0,current:zt||""})}}),Ve=fe?.copied?.length??0,et=fe?.failed?.length??0;ze({type:et>0?"error":"success",message:`: ${Ve}${et>0?` / : ${et}`:""}`,failed:fe?.failed||[]})}catch(fe){console.error(fe),ze({type:"error",message:`: ${String(fe?.message||fe)}`})}finally{B(!1)}}};return i.jsxs("div",{className:["dashboard-container","fade-in",o==="ingredients"||o==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[i.jsxs("div",{className:"dashboard-header",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),i.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[o==="csv-import"&&i.jsx(re,{variant:"secondary",onClick:()=>s({view:"inventory"}),title:"",children:" "}),i.jsx(re,{variant:"ghost",onClick:n,children:" "})]})]}),i.jsx("div",{className:"tabs-container",children:i.jsxs("div",{className:"tabs",children:[i.jsx("button",{className:`tab ${o==="price"?"active":""}`,onClick:()=>u("price"),children:" "}),i.jsx("button",{className:`tab ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:" "}),i.jsx("button",{className:`tab ${o==="csv-import"?"active":""}`,onClick:()=>u("csv-import"),children:" CSV"}),i.jsx("button",{className:`tab ${o==="duplicates"?"active":""}`,onClick:()=>u("duplicates"),children:" "})]})}),o==="ingredients"?i.jsx(ck,{}):o==="csv-import"?i.jsx(dk,{}):o==="duplicates"?i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Oe.length.toLocaleString(),""]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[i.jsx(Ut,{placeholder:"...",value:pe,onChange:fe=>Xe(fe.target.value),style:{flex:1,fontSize:"0.9rem"}}),i.jsx(re,{variant:"secondary",size:"sm",onClick:ct,disabled:I,title:"",children:""})]}),i.jsx("div",{className:"dup-list",children:I?i.jsx("div",{className:"dup-empty",children:"..."}):Oe.length===0?i.jsx("div",{className:"dup-empty",children:"2"}):Oe.filter(fe=>{const Ve=String(pe||"").trim();return Ve?String(fe?.name||"").includes(Ve):!0}).map(fe=>{const Ve=fe.key===$e,et=fe.minPrice!==null&&fe.maxPrice!==null&&fe.minPrice!==fe.maxPrice;return i.jsxs("button",{type:"button",className:`dup-item ${Ve?"active":""}`,onClick:()=>Je(fe.key),children:[i.jsxs("div",{className:"dup-item-top",children:[i.jsx("div",{className:"dup-item-name",title:fe.name,children:fe.name}),et&&i.jsx("span",{className:"dup-badge",children:""})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[": ",fe.lastDate||"-"]}),i.jsxs("span",{children:[": ",fe.rows,""]}),i.jsxs("span",{children:[": ",fe.dates,""]})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[fe.lastPrice!==null?`${Math.round(fe.lastPrice).toLocaleString()}`:"-",fe.unit?` / ${fe.unit}`:""]}),i.jsxs("span",{children:[": ",fe.lastIncomingQty!==null?Math.round(fe.lastIncomingQty).toLocaleString():"-"]}),fe.vendor?i.jsxs("span",{title:fe.vendor,children:[": ",fe.vendor]}):i.jsx("span",{children:": -"})]}),fe.nameVariants>1&&i.jsxs("div",{className:"dup-item-note",children:[": ",fe.nameVariants,""]})]},fe.key)})})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:$e?"":""})}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsxs("select",{value:ot,onChange:fe=>jt(fe.target.value),disabled:!$e,title:$e?"":"",className:"dup-month-select",children:[i.jsx("option",{value:"",children:""}),ke.map(fe=>i.jsx("option",{value:fe,children:fe.replace("-","/")},fe))]}),i.jsx(re,{variant:"secondary",size:"sm",onClick:ct,disabled:I,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:(()=>{if(!$e)return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const fe=ye.get($e)||[],Ve=new Set,et=[];fe.forEach(tt=>{const $t=[String(tt?.dateStr||""),String(tt?.price??""),String(tt?.incomingQty??""),String(tt?.unit||""),String(tt?.vendor||""),String(tt?.displayName||""),String(tt?.sourceFile||"")].join("|");Ve.has($t)||(Ve.add($t),et.push(tt))}),et.sort((tt,$t)=>String(tt?.dateStr||"").localeCompare(String($t?.dateStr||"")));const Ke=ot?et.filter(tt=>zx(tt?.dateStr)===ot):et,nt=Ke.map((tt,$t)=>{const Qe=$t>0?Ke[$t-1]:null,Lt=Qe?Number(Qe?.price):NaN,Xt=Number(tt?.price);let Qt=null,ne=null;return Number.isFinite(Lt)&&Number.isFinite(Xt)&&(Qt=Xt-Lt,ne=Lt!==0?Qt/Lt*100:null),{...tt,_diff:Qt,_pct:ne}}),zt=Ke.reduce((tt,$t)=>{const Qe=Number($t?.incomingQty);return tt+(Number.isFinite(Qe)?Qe:0)},0),bt=Ke.reduce((tt,$t)=>{const Qe=Number($t?.incomingQty),Lt=Number($t?.price);return!Number.isFinite(Qe)||!Number.isFinite(Lt)?tt:tt+Qe*Lt},0),At=[...nt].reverse();return i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"120px"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),i.jsx("tbody",{children:At.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:ot?`${ot}`:""})}):At.map((tt,$t)=>{const Qe=tt?._diff,Lt=tt?._pct,Xt=Qe==null||!Number.isFinite(Qe)?"-":`${Qe>=0?"+":""}${Math.round(Qe).toLocaleString()}`,Qt=Lt==null||!Number.isFinite(Lt)?"":` (${Lt>=0?"+":""}${Lt.toFixed(1)}%)`,ne=Qe==null||!Number.isFinite(Qe)?"#888":Qe>0?"#c92a2a":Qe<0?"#2b8a3e":"#666",ee=Number(tt?.price),ue=Number.isFinite(ee)?`${Math.round(ee).toLocaleString()}`:"-",je=Number(tt?.incomingQty),Be=Number.isFinite(je)?Math.round(je).toLocaleString():"-",Ze=Number.isFinite(je)&&Number.isFinite(ee)?je*ee:NaN,Ye=Number.isFinite(Ze)?`${Math.round(Ze).toLocaleString()}`:"-";return i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:tt?.dateStr||"-"}),i.jsx("td",{children:tt?.vendor||"-"}),i.jsx("td",{style:{fontWeight:500},children:tt?.displayName||"-"}),i.jsx("td",{className:"col-number",children:Be}),i.jsxs("td",{className:"col-number",children:[ue,tt?.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",tt.unit]})]}),i.jsx("td",{className:"col-number",children:Ye}),i.jsxs("td",{className:"col-number",style:{color:ne},children:[Xt,Qt]})]},`${tt?.dateStr||"d"}-${$t}`)})}),At.length>0&&i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",ot?`${ot}`:""]}),i.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(zt).toLocaleString()}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),i.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(bt).toLocaleString()]}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[i.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),i.jsx(re,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const fe=await ju(()=>Promise.resolve().then(()=>bf),void 0).then(nt=>nt.recipeService.exportAllRecipes()),Ve=new Blob([JSON.stringify(fe,null,2)],{type:"application/json"}),et=URL.createObjectURL(Ve),Ke=document.createElement("a");Ke.href=et,Ke.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Ke),Ke.click(),document.body.removeChild(Ke),URL.revokeObjectURL(et)}catch(fe){O({type:"error",message:""}),console.error(fe)}},children:" JSON"})]}),i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),i.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:fe=>{const Ve=fe.target.files?.[0];Ve&&_t(Ve)}}),i.jsx(re,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:y||T,children:" "}),k.message&&i.jsx("div",{className:`status-msg ${k.type}`,style:{marginTop:"10px"},children:k.message})]})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{className:"upload-area",children:[i.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",i.jsx("br",{}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",i.jsx("br",{})," 2: "]})]}),i.jsx("input",{type:"file",accept:".csv",onChange:Rt,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),i.jsx(re,{variant:"primary",onClick:Jt,disabled:!d||y,className:"upload-btn",size:"sm",block:!0,children:y?"...":""})]}),f.message&&i.jsx("div",{className:`status-msg ${f.type}`,children:f.message})]}),a?.role==="admin"&&i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),i.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",Ee.length,""]}),i.jsx("div",{style:{marginTop:"0.75rem"},children:i.jsx(re,{variant:"secondary",size:"sm",block:!0,onClick:xn,disabled:me||y,title:"",children:""})})]}),i.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Ee.length,""]})]}),Ee.length===0?i.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):i.jsx("div",{className:"file-list",children:Ee.map(fe=>i.jsxs("div",{className:"file-list-item",children:[i.jsx("span",{className:"file-name",title:fe.name,children:fe.name}),i.jsx(re,{variant:"danger",size:"sm",onClick:()=>Sn(fe.name),disabled:y,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},fe.name))})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:" "}),i.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",_e.length.toLocaleString()," "]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsx(Ut,{placeholder:" (, , )...",value:Mt,onChange:fe=>yt(fe.target.value),style:{width:"250px",fontSize:"0.9rem"}}),i.jsx(re,{variant:"secondary",size:"sm",onClick:pt,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:_?i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{onClick:()=>ie("dateStr"),style:{width:"120px"},children:[" ",Ae.key==="dateStr"&&(Ae.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>ie("vendor"),children:[" ",Ae.key==="vendor"&&(Ae.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>ie("name"),children:[" ",Ae.key==="name"&&(Ae.direction==="asc"?"":"")]}),i.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),i.jsx("tbody",{children:_e.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",className:"no-data",children:""})}):_e.map((fe,Ve)=>i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:fe.dateStr||"-"}),i.jsx("td",{children:fe.vendor||"-"}),i.jsx("td",{style:{fontWeight:"500"},children:fe.name}),i.jsxs("td",{className:"col-number",children:[fe.price?fe.price.toLocaleString():"-",fe.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",fe.unit]})]})]},Ve))})]})})]})]}),i.jsx(pn,{isOpen:C,onClose:rn,title:" / ",size:"medium",showCloseButton:!T,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",i.jsx("br",{}),i.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:U?.name||"-"})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(re,{variant:"ghost",onClick:rn,disabled:T,children:""}),i.jsx(re,{variant:"primary",onClick:cn,disabled:!U||T,children:T?"...":""})]}),T&&i.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),k.message&&i.jsx("div",{className:`status-msg ${k.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:k.message})]})}),i.jsx(pn,{isOpen:K,onClose:Ln,title:"",size:"medium",showCloseButton:!me,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",i.jsx("br",{}),i.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",i.jsx("code",{children:"_copy"})," "]})]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",i.jsx("strong",{style:{color:"#111827"},children:a?.displayId||""})," / : ",Ee.length,""]}),Re?i.jsxs(i.Fragment,{children:[(()=>{const fe=q.find(et=>String(et?.id)===String(Y)),Ve=fe?`${fe.display_id}${fe.email?` (${fe.email})`:""}`:Y?String(Y).slice(0,8):"-";return i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",i.jsx("strong",{children:Ve}),i.jsx("br",{}),": ",i.jsx("strong",{children:Ee.length.toLocaleString()})," CSV",i.jsx("br",{}),": ",i.jsx("code",{children:"_copy"})," "]})]})})(),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>he(!1),disabled:me,children:""}),i.jsx(re,{variant:"primary",onClick:ar,disabled:!Y||me,children:me?"...":""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),P?i.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):i.jsxs("select",{value:Y,onChange:fe=>le(fe.target.value),disabled:me||!!A,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:me?"#f3f4f6":"white"},children:[i.jsx("option",{value:"",children:"..."}),q.filter(fe=>String(fe?.id)&&String(fe?.id)!==String(a?.id)).map(fe=>i.jsxs("option",{value:fe.id,children:[fe.display_id,fe.email?` (${fe.email})`:"",fe.role==="admin"?" []":""]},fe.id))]}),A&&i.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:A})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(re,{variant:"ghost",onClick:Ln,disabled:me,children:""}),i.jsx(re,{variant:"primary",onClick:()=>he(!0),disabled:!Y||me||P||!!A,children:""})]})]}),me&&i.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:W.total?`${W.done} / ${W.total}`:"..."})]})]}),i.jsx("div",{className:"bulk-progress-bar",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:W.total?`${Math.round(W.done/W.total*100)}%`:"0%"}})}),i.jsx("div",{className:"bulk-progress-current",title:W.current,children:W.current})]}),ge?.message&&i.jsx("div",{className:`status-msg ${ge.type||"info"}`,children:ge.message}),Array.isArray(ge?.failed)&&ge.failed.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",ge.failed.length,""]}),i.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:ge.failed.slice(0,10).map((fe,Ve)=>i.jsxs("li",{children:[fe?.file||"-",": ",fe?.errorMessage||"unknown error"]},`${fe?.file||"f"}-${Ve}`))}),ge.failed.length>10&&i.jsxs("div",{style:{marginTop:"6px"},children:["... ",ge.failed.length-10,""]})]})]})}),j&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>N(null),children:i.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:fe=>fe.stopPropagation(),children:[i.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),i.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:j.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>N(null),children:""}),i.jsx(re,{variant:"danger",onClick:()=>{j.onConfirm(),N(null)},children:""})]})]})})]})},fk=({recipes:n,recentIds:t,onSelect:s})=>{if(!t||t.length===0)return null;const a=t.map(o=>n.find(u=>u.id===o)).filter(Boolean).slice(0,7);return a.length===0?null:i.jsxs("div",{className:"recent-recipes",children:[i.jsx("h3",{className:"recent-header",children:""}),i.jsx("div",{className:"recent-list",children:a.map(o=>i.jsxs("div",{className:"recent-item",onClick:()=>s(o),children:[i.jsx("div",{className:"recent-thumbnail",children:o.image?i.jsx("img",{src:o.image,alt:o.title}):i.jsx("div",{className:"recent-placeholder"})}),i.jsx("div",{className:"recent-info",children:i.jsx("div",{className:"recent-title",children:o.title})})]},o.id))})]})},pk=({onBack:n})=>(b.useEffect(()=>{window.scrollTo(0,0)},[]),i.jsxs("div",{className:"levain-guide-container",children:[i.jsxs("header",{className:"levain-guide-header",children:[i.jsx("h1",{children:"LEVAIN GUIDE"}),i.jsx("p",{className:"subtitle",children:" "}),i.jsx("p",{className:"subtitle",children:""}),i.jsx("div",{className:"divider"})]}),i.jsxs("main",{className:"levain-guide-main",children:[i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("p",{children:"Levain"}),i.jsx("h3",{children:""}),i.jsx("p",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",i.jsx("br",{}),i.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",i.jsx("br",{}),i.jsx("strong",{children:""})," Acetobacter aceti "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:["",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",i.jsx("br",{}),"(   +  + )"]}),"",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHO",i.jsx("br",{}),"(  )"]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"- 7-10"}),i.jsxs("div",{className:"timeline",children:[i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),i.jsx("p",{children:"100g + 100ml 20-22"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsx("p",{children:"100g  50g50g + 50ml"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsxs("div",{className:"success-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),i.jsx("p",{children:"1150%1:1"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 15",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," pH 3.5-4.0"]})]})]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:"(ml)"}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"2"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"5-8"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-4"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"15-18"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"3-5"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25-28"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-3"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"30"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"1"}),i.jsx("br",{}),"100g50g + 50ml"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"8-12"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"2%100ml2g"}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 12 8:00"}),i.jsx("br",{}),"50g25g + 25ml "]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  14:00"}),i.jsx("br",{}),"25g + 25ml 2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  20:00"}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:" "})," ",i.jsx("br",{}),"",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:" "})," pH",i.jsx("br",{}),"pH 3.5-4.0pH"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"18"}),i.jsx("td",{children:"16-24"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"12-16"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"24-26"}),i.jsx("td",{children:"8-12"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"28"}),i.jsx("td",{children:"4-8"}),i.jsx("td",{children:"2"})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"1"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 22",i.jsx("br",{}),"2. 12",i.jsx("br",{}),"3. 1",i.jsx("br",{}),"4. 1-2"]}),i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," pH",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," "]}),i.jsx("h3",{children:"3"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. 15",i.jsx("br",{}),"3. 80%"]}),i.jsx("h3",{children:"4"}),i.jsxs("div",{className:"success-box",children:["",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:"5"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 1:0.8",i.jsx("br",{}),"2. ",i.jsx("br",{}),"3. "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"pH"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"pH4-8.0"}),i.jsx("br",{}),i.jsx("br",{})," pH 7.0",i.jsx("br",{})," pH 4.5-5.5",i.jsx("br",{})," pH 3.5-4.0",i.jsx("br",{})," pH 3.0"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:"pH 3.8-4.0"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 3.5"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 4.5"})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 1",i.jsx("br",{})," ",i.jsx("br",{})," -203"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"15-20"}),i.jsx("td",{children:"18-20"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25+"}),i.jsx("td",{children:"22-24"}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"18-22"}),i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"5-15"}),i.jsx("td",{children:"18"}),i.jsx("td",{children:"2-3"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 24",i.jsx("br",{})," ",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 18",i.jsx("br",{})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"100g + 50g + 150ml 12-24",i.jsx("br",{}),"11-2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"100ml"}),i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," pH3.5-4.0",i.jsx("br",{})," 0.5-1.5%",i.jsx("br",{})," 0.3-0.8%"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"15-25% ()"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"5-15%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"20-30%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"30-50%"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"formula",children:[" 18   - 8",i.jsx("br",{}),i.jsx("br",{}),"",i.jsx("br",{})," 2018  (20-8) = 1.5",i.jsx("br",{})," 2418  (24-8) = 1.125",i.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),i.jsxs("footer",{className:"levain-footer",children:[i.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),i.jsx("p",{children:""})]}),i.jsxs("button",{className:"levain-back-button",onClick:n,children:[i.jsx("span",{children:""})," "]})]})),mk=({onBack:n})=>{const{user:t,patchCurrentUserProfile:s}=es(),[a,o]=b.useState([]),[u,d]=b.useState(!0),[h,f]=b.useState(null),[m,y]=b.useState(null),[v,x]=b.useState(""),[w,_]=b.useState(""),[E,j]=b.useState(""),[N,k]=b.useState(""),[O,U]=b.useState(!1),[D,C]=b.useState(!1),[M,T]=b.useState(new Set);b.useEffect(()=>{H()},[]);const H=async()=>{try{d(!0);const L=await Qi.fetchAllProfiles();o(L)}catch(L){console.error(L),f("")}finally{d(!1)}},K=a.filter(L=>L.role==="admin"),F=a.filter(L=>L.role!=="admin"),q=(L,A)=>{T($=>{const Y=new Set($);return A?Y.add(L):Y.delete(L),Y})},V=async(L,A)=>{const $=!!L.show_master_recipes;f(null),o(Y=>Y.map(le=>le.id===L.id?{...le,show_master_recipes:A}:le)),L.id===t?.id&&s?.({showMasterRecipes:A}),q(L.id,!0);try{const le=!!(await Qi.updateProfile(L.id,{show_master_recipes:A}))?.show_master_recipes;o(me=>me.map(B=>B.id===L.id?{...B,show_master_recipes:le}:B)),L.id===t?.id&&s?.({showMasterRecipes:le})}catch(Y){console.error(Y),o(le=>le.map(me=>me.id===L.id?{...me,show_master_recipes:$}:me)),L.id===t?.id&&s?.({showMasterRecipes:$}),f("RLS")}finally{q(L.id,!1)}},P=({user:L,isAdmin:A})=>i.jsxs(tn,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[L.display_id," ",A&&i.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),L.email&&i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:L.email}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date(L.created_at).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",L.updated_at?new Date(L.updated_at).toLocaleString():"---"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:L.show_master_recipes||!1,disabled:M.has(L.id),onChange:$=>V(L,$.target.checked)}),""]}),i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>{y({id:L.id,display_id:L.display_id,email:L.email}),x(""),_(""),j(""),k("")},style:{whiteSpace:"nowrap"},children:""})]})]},L.id);return i.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",height:"100%",overflowY:"auto"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[i.jsx("h2",{children:""}),i.jsx(re,{variant:"ghost",onClick:n,children:""})]}),h&&i.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:h}),u?i.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[K.length>0&&i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:K.map(L=>i.jsx(P,{user:L,isAdmin:!0},L.id))})]}),i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:F.length>0?F.map(L=>i.jsx(P,{user:L,isAdmin:!1},L.id)):i.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),i.jsx(pn,{isOpen:!!m,onClose:()=>{O||y(null)},title:": ",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[i.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",m?.display_id||m?.email||m?.id]}),m?.email&&i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:m.email}),i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),E&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:E}),N&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:N}),i.jsxs("div",{style:{display:"grid",gap:"10px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:v,onChange:L=>x(L.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:w,onChange:L=>_(L.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>y(null),disabled:O,children:""}),i.jsx(re,{variant:"secondary",isLoading:D,disabled:!m?.email||O,onClick:async()=>{if(j(""),k(""),!m?.email){j("");return}C(!0);try{await Qi.sendPasswordResetEmail(m.email),k("")}catch(L){console.error(L),j(L?.message||"")}finally{C(!1)}},style:{whiteSpace:"nowrap"},children:""}),i.jsx(re,{variant:"danger",isLoading:O,onClick:async()=>{if(j(""),k(""),!!m?.id){if(!v||v.length<8){j("8");return}if(v!==w){j("");return}U(!0);try{await Qi.adminResetPassword(m.id,v),k(""),x(""),_("")}catch(L){console.error(L);const A=L?.message||"";/FunctionsHttpError|not found|404/i.test(A)||/admin-reset-password/i.test(A)?j(""):j(A)}finally{U(!1)}}},children:""})]})]})})]})},Ts="inventory_items",qi="inventory_snapshots",oo="deleted_inventory_snapshots",Va=(n,t)=>{const s=String(n?.message||"");return String(n?.code||"")==="42703"?s.toLowerCase().includes(String(t).toLowerCase()):s.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&s.toLowerCase().includes("does not exist")},er={getAll:async n=>{if(!n)return[];const{data:t,error:s}=await Te.from(Ts).select("*").eq("user_id",n).order("created_at",{ascending:!0});return s?(console.error("Error fetching inventory:",s),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:s,isPhantom:a,_master:o,_csv:u,...d}=t,h=t?.tax10_override??t?.tax10Override,f={...d,user_id:n,tax10:!!t.tax10,tax10_override:!!h,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0},m=async x=>Te.from(Ts).insert([x]).select().single();let{data:y,error:v}=await m(f);if(v){const x=Va(v,"tax10"),w=Va(v,"tax10_override");if(x||w){const _={...f};x&&delete _.tax10,w&&delete _.tax10_override,{data:y,error:v}=await m(_)}}if(v)throw console.error("Error adding item:",v),v;return y},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:s,isPhantom:a,created_at:o,_master:u,_csv:d,...h}=t,f=t?.tax10_override??t?.tax10Override,m={...h,tax10:!!t.tax10,tax10_override:!!f,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()},y=async w=>Te.from(Ts).update(w).eq("id",t.id).eq("user_id",n).select().single();let{data:v,error:x}=await y(m);if(x){const w=Va(x,"tax10"),_=Va(x,"tax10_override");if(w||_){const E={...m};w&&delete E.tax10,_&&delete E.tax10_override,{data:v,error:x}=await y(E)}}if(x)throw console.error("Error updating item:",x),x;return v},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:s}=await Te.from(Ts).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error deleting item:",s),s},adjustStock:async(n,t,s)=>{if(!n)throw new Error("User ID is required");const{data:a,error:o}=await Te.from(Ts).select("quantity").eq("id",t).eq("user_id",n).single();if(o||!a)throw new Error("Item not found");const u=Math.max(0,(a.quantity||0)+s),{data:d,error:h}=await Te.from(Ts).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(h)throw h;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await Te.from(Ts).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:s}=await Te.from("ignored_items").select("name").eq("user_id",n);return s?(console.error("Error fetching ignored items:",s),new Set):new Set(t.map(a=>a.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:s}=await Te.from("ignored_items").insert([{user_id:n,name:t}]).select();if(s&&s.code!=="23505")throw console.error("Error ignoring item:",s),s},getSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await Te.from(qi).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return s?(console.error("Error fetching snapshots:",s),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await Te.from(oo).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return s?(console.error("Error fetching deleted snapshots:",s),[]):t||[]},createSnapshot:async(n,t,s,a)=>{if(!n)throw new Error("User ID is required");let o=null,u=null;const d=await Te.from(qi).insert([{user_id:n,title:t,items:s,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();if(o=d.data??null,u=d.error??null,u&&Va(u,"user_id")){const h=await Te.from(qi).insert([{title:t,items:s,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();o=h.data??null,u=h.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return o},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:s,error:a}=await Te.from(qi).select("*").eq("id",t).eq("user_id",n).single();if(a||!s)throw console.error("Error fetching snapshot for delete:",a),a||new Error("Snapshot not found");const{error:o}=await Te.from(oo).insert([{original_id:s.id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at,deleted_at:new Date().toISOString()}]);if(o)throw console.error("Error moving snapshot to trash:",o),o;const{error:u}=await Te.from(qi).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:s,error:a}=await Te.from(oo).select("*").eq("id",t).eq("user_id",n).single();if(a||!s)throw console.error("Error fetching deleted snapshot:",a),a||new Error("Deleted snapshot not found");let o=null;{const{error:d}=await Te.from(qi).insert([{id:s.original_id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);o=d}if(o){const{error:d}=await Te.from(qi).insert([{user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await Te.from(oo).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:s}=await Te.from(oo).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error hard deleting snapshot from trash:",s),s;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await Te.from(Ts).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(Va(t.error,"user_id")){const s=await Te.from(Ts).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(s.error)throw console.error("Error resetting quantities (fallback):",s.error),s.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},Vi=n=>{const t=String(n??"").trim();if(!t)return"";const s=t.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s},gk=(n,t)=>{const s=Vi(n),a=Vi(t);if(!s||!a)return null;if(s===a)return 1;if(s==="kg"&&a==="g")return 1e3;if(s==="g"&&a==="kg")return 1/1e3;const o=s==="cc"?"ml":s,u=a==="cc"?"ml":a;return o==="l"&&u==="ml"?1e3:o==="ml"&&u==="l"?1/1e3:null},yk=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},co=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},vk=({item:n,isLowStock:t,onUpdateQuantity:s,onDelete:a,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const[h,f]=be.useState(n.quantity===""?"":parseFloat(n.quantity)||0),m=V=>{const P=String(V||"").trim();return P?P==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(P)?P:"":""},y={food:"",alcohol:"",soft_drink:"",supplies:""};be.useEffect(()=>{f(n.quantity===""?"":parseFloat(n.quantity)||0)},[n.quantity]);const v=parseFloat(n.price)||0,x=(()=>{if(!Number.isFinite(v)||v<=0)return"-";const V=n?._csv?.unit,P=String(V||"").trim(),L=String(n?.unit||"").trim();if(!P)return`${co(v)}`;const A=Vi(L),$=Vi(P);if($===A)return`${co(v)}/${P}`;const Y=gk($,A);if(Y!==null)return`${co(v*Y)}/${P}`;const le=parseFloat(n?._master?.packetSize),me=String(n?._master?.packetUnit||"").trim(),B=Vi(me);return yk(P)&&Number.isFinite(le)&&le>0&&B===A?`${co(v*le)}/${P}`:`${co(v)}/${L||"-"}`})(),w=m(n?._master?.itemCategory),_=w==="alcohol"||w==="supplies",E=n?.tax10_override===!0||n?.tax10_override===1||n?.tax10_override==="1"||n?.tax10_override==="true",j=w?E?n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true":_:n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true",N=w?E?`${y[w]||w}: ${_?"10%":"8%"}/ `:`${y[w]||w}${j?"10%":"8%"}`:"10%",k=j?1.1:1.08,O=h===""?0:parseFloat(h),U=v*O*k,D=be.useMemo(()=>{const V=n?._master?.packetSize,P=n?._master?.packetUnit,L=parseFloat(V);return!Number.isFinite(L)||L<=0?"-":`${Number.isInteger(L)?L.toLocaleString():L.toLocaleString(void 0,{maximumFractionDigits:3})}${P?String(P):""}`},[n?._master?.packetSize,n?._master?.packetUnit]),C=()=>{const V=parseFloat(h);!isNaN(V)&&V!==n.quantity&&s(n.id,V)},M=V=>{V&&setTimeout(()=>{try{V.select()}catch{}},0)},T=V=>{const L=V?.closest?.("table")||document;return Array.from(L.querySelectorAll("input.inventory-quantity-input"))},H=(V,P)=>{const L=T(V).filter(Y=>!Y.disabled),A=L.indexOf(V);if(A<0)return!1;const $=L[A+P];return $?(requestAnimationFrame(()=>{try{$.scrollIntoView({block:"nearest"})}catch{}$.focus(),M($)}),!0):!1},K=V=>{if(V.key==="Enter"){V.preventDefault(),H(V.currentTarget,V.shiftKey?-1:1),V.currentTarget.blur();return}V.key==="Tab"&&H(V.currentTarget,V.shiftKey?-1:1)&&(V.preventDefault(),V.currentTarget.blur())},F=n?._master?.packetUnit||"",q=!!F&&Vi(F)!==Vi(n?.unit);return i.jsxs("tr",{className:t(n)?"low-stock":"",children:[i.jsx("td",{style:{textAlign:"center"},children:i.jsx("input",{type:"checkbox",checked:j,onChange:V=>o&&o(n,V.target.checked),title:N,className:"inventory-tax-checkbox"})}),i.jsxs("td",{children:[n.name,t(n)&&i.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),i.jsx("td",{style:{textAlign:"right"},children:x}),i.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:D}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[i.jsx("input",{type:"text",inputMode:"decimal",value:h,onChange:V=>f(db(V.target.value)),className:"inventory-quantity-input no-print",onBlur:C,onKeyDown:K,onFocus:V=>M(V.target),onClick:V=>M(V.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),i.jsx("span",{className:"print-only",style:{display:"none"},children:h})]}),i.jsx("td",{children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:n.unit}),q&&typeof d=="function"&&i.jsx("button",{type:"button",onClick:()=>d(n),title:`${F}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),i.jsx("td",{style:{textAlign:"right"},children:U>0?`${Math.round(U).toLocaleString()}`:"-"}),i.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:n.vendor||"-"}),i.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof u=="function"&&i.jsx("button",{type:"button",onClick:()=>u(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),i.jsx("button",{onClick:()=>a(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},xk=({items:n,loading:t,onDelete:s,onUpdateQuantity:a,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:h,isOver:f}=Go({id:"inventory-list-droppable"}),m=_=>_.threshold>0&&_.quantity<=_.threshold,[y,v]=be.useState({key:null,direction:"asc"}),x=_=>{v(E=>E.key===_?{key:_,direction:E.direction==="asc"?"desc":"asc"}:{key:_,direction:"asc"})},w=be.useMemo(()=>{if(!y.key)return n;const _=[...n];return y.key==="vendor"&&_.sort((E,j)=>{const N=(E?.vendor||"").toString(),k=(j?.vendor||"").toString(),O=N.localeCompare(k,"ja");if(O!==0)return y.direction==="asc"?O:-O;const U=(E?.name||"").toString(),D=(j?.name||"").toString(),C=U.localeCompare(D,"ja");return y.direction==="asc"?C:-C}),_},[n,y]);return i.jsxs("div",{ref:h,className:`inventory-list-droppable ${f?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:f?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[i.jsx("div",{className:"inventory-table-container",children:t?i.jsx("p",{children:"Loading..."}):i.jsxs("table",{className:"inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"}),i.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),i.jsx("th",{style:{width:"40px"}})]})}),i.jsxs("tbody",{children:[w.map(_=>i.jsx(vk,{item:_,isLowStock:m,onUpdateQuantity:a,onEdit:u,onDelete:s,onToggleTax:o,onRequestUnitSync:d},_.id)),w.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"9",style:{textAlign:"center",color:"#888",padding:"2rem"},children:f?"":""})})]}),i.jsx("tfoot",{children:(()=>{const _=n.reduce((E,j)=>{const N=parseFloat(j.price)||0,k=j.quantity===""?0:parseFloat(j.quantity)||0,O=j?.tax10===!0||j?.tax10===1||j?.tax10==="1"||j?.tax10==="true"?1.1:1.08,U=N*k;return E.net+=U,E.taxed+=U*O,E},{net:0,taxed:0});return i.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[i.jsx("td",{colSpan:"6",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(_.net).toLocaleString()," / ",Math.round(_.taxed).toLocaleString()]}),i.jsx("td",{colSpan:"2"})]})})()})]})}),f&&i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},bk=({onBack:n})=>{const{user:t}=es(),s=t?.id,[,a]=Io(),[o,u]=b.useState([]),[d,h]=b.useState([]),[f,m]=b.useState([]),[y,v]=b.useState([]),[x,w]=b.useState(new Map),[_,E]=b.useState(new Map),[j,N]=b.useState(new Set),[k,O]=b.useState(!0),[U,D]=b.useState(""),[C,M]=b.useState(!1),[T,H]=b.useState(null),[K,F]=b.useState(!1),[q,V]=b.useState(null),[P,L]=b.useState(!1),[A,$]=b.useState(!1),[Y,le]=b.useState(""),[me,B]=b.useState(!1),[W,J]=b.useState(!0),[ge,ze]=b.useState(!1),[Re,he]=b.useState(null),[I,te]=b.useState("history"),[ye,Ne]=b.useState(null),[Oe,qe]=b.useState(""),[$e,Je]=b.useState(!1),[pe,Xe]=b.useState(null),[ot,jt]=b.useState(!0),[ke,Ae]=b.useState({key:"name",direction:"asc"}),[it,Mt]=b.useState(!1),[yt,ie]=b.useState(null),[_e,Ee]=b.useState(new Set),[Ie,ct]=b.useState(!1),[pt,Rt]=b.useState(null),[Jt,Sn]=b.useState(null),[_t,rn]=b.useState(!1),cn=ll(gr(Hu,{activationConstraint:{distance:8}})),[xn,Ln]=b.useState("all"),[ar,fe]=b.useState(new Set),[Ve,et]=b.useState(""),[Ke,nt]=b.useState(""),[zt,bt]=b.useState({}),[At,tt]=b.useState(""),$t=({row:z,onVendorClick:X,isSelected:ae})=>{const{attributes:xe,listeners:De,setNodeRef:Me,setActivatorNodeRef:Pe,transform:He,transition:We,isDragging:st}=ul({id:z.vendor,data:{type:"summary-row"}}),ht={transform:kr.Transform.toString(He),transition:We,opacity:st?.6:1};return i.jsxs("tr",{ref:Me,style:ht,...xe,className:ae?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[i.jsx("td",{className:"inventory-summary__drag",children:i.jsx("span",{ref:Pe,...De,className:"inventory-summary__drag-handle",title:"",children:""})}),i.jsx("td",{children:i.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>X?.(z.vendor),"aria-expanded":!!ae,children:[i.jsx("span",{children:z.vendor}),i.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:ae?"":""})]})}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(z.total||0).toLocaleString()]})]})};b.useEffect(()=>{s&&(Ln("all"),D(""),Qe())},[s]);const Qe=async(z=!1)=>{z||O(!0);try{const[X,ae,xe,De,Me,Pe,He]=await Promise.all([er.getAll(s),nr.getPriceListArray(),er.getIgnoredItems(s),er.getSnapshots(s),er.getDeletedSnapshots(s),Pn.getAllConversions(),Uu.getAll(s)]);u(X),v(ae),N(xe),h(De||[]),m(Me||[]),w(Pe||new Map),E(He||new Map);const We=Fe=>{if(!Fe)return-1;const mn=new Date(Fe).getTime();return Number.isFinite(mn)?mn:-1},st=(Fe,vt)=>{const mn=Math.max(We(Fe?.updated_at),We(Fe?.updatedAt),We(Fe?.created_at),We(Fe?.createdAt)),dn=Math.max(We(vt?.updated_at),We(vt?.updatedAt),We(vt?.created_at),We(vt?.createdAt));return mn!==dn&&dn>mn?vt:Fe},ht=new Map;(X||[]).forEach(Fe=>{const vt=String(Fe?.vendor??"").trim()||"__no_vendor__",mn=nn(Fe?.name)||String(Fe?.name??"").trim();if(!mn)return;const dn=`${vt}@@${mn}`,Gs=ht.get(dn);if(!Gs){ht.set(dn,Fe);return}ht.set(dn,st(Gs,Fe))});const gt=new Set(Array.from(ht.values()).map(Fe=>Fe.id));fe(gt)}catch(X){console.error("Failed to load data:",X)}finally{z||O(!1)}},Lt=z=>{if(!z)return"-";const X=new Date(z);if(Number.isNaN(X.getTime()))return String(z);const ae=X.getFullYear(),xe=String(X.getMonth()+1).padStart(2,"0"),De=String(X.getDate()).padStart(2,"0"),Me=String(X.getHours()).padStart(2,"0"),Pe=String(X.getMinutes()).padStart(2,"0");return`${ae}/${xe}/${De} ${Me}:${Pe}`},Xt=z=>{const X=z?.items;return Array.isArray(X)?X:X?[]:[]},Qt=z=>{const X=z?.snapshot_date||z?.created_at;if(!X)return null;const ae=new Date(X);return Number.isNaN(ae.getTime())?null:ae},ne=be.useMemo(()=>new Set([""]),[]),ee=z=>{const X=String(z??"").trim();return ne.has(X)},ue=z=>z===!0||z===1||z==="1"||z==="true",je=z=>{const X=String(z??"").trim();if(!X)return"";const ae=X.toLowerCase();return ae===""?"g":ae===""?"ml":ae===""?"cc":ae===""?"kg":ae===""?"l":ae},Be=(z,X)=>{const ae=parseFloat(z?.lastPrice),xe=parseFloat(z?.packetSize),De=je(z?.packetUnit),Me=je(X||De);if(!Number.isFinite(ae)||!Number.isFinite(xe)||xe<=0||!De)return null;const Pe=ae/xe;if(Me===De)return Pe;if(De==="g"&&Me==="kg")return Pe*1e3;if(De==="kg"&&Me==="g")return Pe/1e3;const He=De==="cc"?"ml":De,We=Me==="cc"?"ml":Me;return He==="ml"&&We==="l"?Pe*1e3:He==="l"&&We==="ml"?Pe/1e3:null},Ze=(z,X)=>{const ae=je(z),xe=je(X);if(!ae||!xe)return null;if(ae===xe)return 1;if(ae==="kg"&&xe==="g")return 1e3;if(ae==="g"&&xe==="kg")return 1/1e3;const De=ae==="cc"?"ml":ae,Me=xe==="cc"?"ml":xe;return De==="l"&&Me==="ml"?1e3:De==="ml"&&Me==="l"?1/1e3:null},Ye=z=>{const X=String(z||"").trim();return X?X==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(X)?X:"":""},G=z=>{const X=Ye(z);return X==="alcohol"||X==="supplies"},Le=z=>{const X=Ye(z);return X==="food"?"":X==="alcohol"||X==="soft_drink"?"":X==="supplies"?"":""},Ge=z=>{const X=Ye(z);return X==="food"?"food":X==="alcohol"||X==="soft_drink"?"drink":X==="supplies"?"supplies":"unknown"},Ct=z=>z==="food"?"":z==="drink"?"":z==="supplies"?"":"",Ue=z=>ue(z?.tax10)?1.1:1.08,ft=z=>z?`${z.getFullYear()}-${String(z.getMonth()+1).padStart(2,"0")}`:"",Ht=z=>{if(!z)return-1;const ae=new Date(z).getTime();return Number.isFinite(ae)?ae:-1},En=z=>{const X=[z?.updated_at,z?.updatedAt,z?.created_at,z?.createdAt];for(const ae of X){const xe=Ht(ae);if(xe>=0)return xe}return-1},kt=be.useMemo(()=>{const z=new Map;return d.forEach(X=>{const ae=Qt(X);if(!ae)return;const xe=ft(ae);z.has(xe)||z.set(xe,{key:xe,year:ae.getFullYear(),month:ae.getMonth()+1})}),Array.from(z.values()).sort((X,ae)=>ae.key.localeCompare(X.key)).map(X=>({...X,label:`${X.year}${X.month}`}))},[d]);b.useEffect(()=>{if(kt.length===0){Ve&&et("");return}if(Ve&&kt.some(ae=>ae.key===Ve))return;const z=ft(new Date),X=kt.find(ae=>ae.key===z)?.key||kt[0].key;et(X)},[kt,Ve]),b.useEffect(()=>{if(kt.length===0){Ke&&nt("");return}if(Ke&&kt.some(ae=>ae.key===Ke))return;const z=ft(new Date),X=kt.find(ae=>ae.key===z)?.key||kt[0].key;nt(X)},[kt,Ke]);const Vn=be.useMemo(()=>{if(!Ke)return null;const[z,X]=Ke.split("-"),ae=parseInt(z,10),xe=parseInt(X,10);if(!Number.isFinite(ae)||!Number.isFinite(xe))return null;const De=He=>String(He).padStart(2,"0"),Me=new Date(ae,xe-1,1),Pe=new Date(ae,xe,0);return{year:ae,month:xe,start:Me,end:Pe,rangeLabel:`${ae}/${De(xe)}/01${ae}/${De(xe)}/${De(Pe.getDate())}`}},[Ke]),sn=be.useMemo(()=>Ke?d.map(z=>({snapshot:z,date:Qt(z)})).filter(z=>z.date&&ft(z.date)===Ke).sort((z,X)=>X.date-z.date).map(z=>z.snapshot):d,[d,Ke]),Nt=be.useMemo(()=>{if(!Ve)return null;const[z,X]=Ve.split("-"),ae=parseInt(z,10),xe=parseInt(X,10);if(!Number.isFinite(ae)||!Number.isFinite(xe))return null;const De=He=>String(He).padStart(2,"0"),Me=new Date(ae,xe-1,1),Pe=new Date(ae,xe,0);return{year:ae,month:xe,start:Me,end:Pe,rangeLabel:`${ae}/${De(xe)}/01${ae}/${De(xe)}/${De(Pe.getDate())}`}},[Ve]),Pr=be.useMemo(()=>Ve?d.map(z=>({snapshot:z,date:Qt(z)})).filter(z=>z.date&&ft(z.date)===Ve).sort((z,X)=>X.date-z.date).map(z=>z.snapshot):[],[d,Ve]),Kn=Pr[0]||null,yr=Ve||(Kn?.id?`snapshot:${Kn.id}`:""),qr=be.useMemo(()=>{const z=new Map;return Pr.forEach(X=>{const ae=Qt(X)?.getTime()||-1;Xt(X).forEach((De,Me)=>{const Pe=(De?.vendor||"").toString().trim();if(ee(Pe))return;const He=Pe||"",We=String(De?.name||"").trim();if(!We)return;const st=`${He}::${We}`,ht={item:{...De,vendor:He},snapshotMs:ae,itemUpdatedMs:En(De),rowIndex:Me},gt=z.get(st);if(!gt){z.set(st,ht);return}if(ht.snapshotMs!==gt.snapshotMs){ht.snapshotMs>gt.snapshotMs&&z.set(st,ht);return}if(ht.itemUpdatedMs!==gt.itemUpdatedMs){ht.itemUpdatedMs>gt.itemUpdatedMs&&z.set(st,ht);return}ht.rowIndex>=gt.rowIndex&&z.set(st,ht)})}),Array.from(z.values()).map(X=>X.item)},[Pr,ee]),ta=be.useMemo(()=>{const z=new Map;return qr.forEach(X=>{const ae=(X?.vendor||"").toString().trim(),xe=ae||"";if(ee(ae))return;const De=parseFloat(X?.price)||0,Me=X?.quantity===""?0:parseFloat(X?.quantity)||0,Pe=De*Me,He=Pe*Ue(X),We=z.get(xe)||{vendor:xe,net:0,taxed:0};We.net+=Pe,We.taxed+=He,z.set(xe,We)}),Array.from(z.values()).map(X=>({vendor:X.vendor,net:X.net,taxed:X.taxed,total:X.taxed}))},[qr,ee,Ue]),cs=be.useMemo(()=>{const z=new Map;return ta.forEach(X=>{z.set(X.vendor,X)}),z},[ta]),dl=be.useMemo(()=>{const z=new Map;try{for(const[X,ae]of(x||new Map).entries()){const xe=String(X??"").trim();xe&&z.set(xe,ae)}}catch{}return z},[x]),hl=be.useCallback(z=>{const X=Ye(z?.itemCategory??z?.item_category);if(X)return X;const ae=String(z?.name??"").trim();if(!ae)return"";const xe=dl.get(ae);return Ye(xe?.itemCategory??xe?.item_category)},[dl]),na=be.useMemo(()=>{const z=new Map;qr.forEach((X,ae)=>{const xe=(X?.vendor||"").toString().trim(),De=xe||"";if(ee(xe))return;const Me=parseFloat(X?.price)||0,Pe=X?.quantity===""?0:parseFloat(X?.quantity)||0,He=Me*Pe,We=He*Ue(X),st=hl(X),ht=Ge(st),gt=z.get(De)||{vendor:De,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};gt.totals[ht]+=We,gt.totals.net+=He,gt.totals.taxed+=We,gt.rows.push({id:X?.id||`${De}-${X?.name||"item"}-${ae}`,name:X?.name||"",unit:X?.unit||"",quantity:Pe,price:Me,taxed:We,itemCategory:st,breakdownKey:ht}),z.set(De,gt)});for(const X of z.values())X.rows.sort((ae,xe)=>{const De={food:0,drink:1,unknown:2,supplies:3},Me=De[ae?.breakdownKey]??2,Pe=De[xe?.breakdownKey]??2;if(Me!==Pe)return Me-Pe;const He=(ae?.name||"").toString(),We=(xe?.name||"").toString();return He.localeCompare(We,"ja")});return z},[qr,ee,Ue,hl]),$s=be.useMemo(()=>ta.slice().sort((z,X)=>X.taxed!==z.taxed?X.taxed-z.taxed:z.vendor.localeCompare(X.vendor,"ja")).map(z=>z.vendor),[ta]),cr=be.useMemo(()=>{if(!yr)return $s;const z=zt[yr],X=new Set(cs.keys()),ae=Array.isArray(z)?z.filter(De=>X.has(De)):[],xe=$s.filter(De=>!ae.includes(De));return[...ae,...xe]},[zt,yr,$s,cs]),Yn=be.useMemo(()=>cr.map(z=>cs.get(z)).filter(Boolean),[cr,cs]),fl=Yn.reduce((z,X)=>(z.net+=X.net||0,z.taxed+=X.taxed||0,z),{net:0,taxed:0});b.useEffect(()=>{At&&(cs.has(At)||tt(""))},[At,cs]);const Xu=z=>{tt(X=>X===z?"":z)},pl=z=>{z?.id&&s&&(Je(!1),Xe(null),qe(""),Ne({title:"",message:`${z.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Je(!0),Xe({type:"move",id:z.id});try{await er.deleteSnapshotToTrash(s,z.id),await Qe(!0),Rt({title:"",message:"",type:"success"})}catch(X){console.error(X),Rt({title:"",message:"()",type:"error"})}finally{Je(!1),Xe(null),Ne(null)}}}))},Ko=z=>{z?.id&&s&&(Je(!1),Xe(null),qe(""),Ne({title:"",message:`${z.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Je(!0),Xe({type:"restore",id:z.id});try{await er.restoreSnapshotFromTrash(s,z.id),await Qe(!0),Rt({title:"",message:"",type:"success"})}catch(X){console.error(X),Rt({title:"",message:"",type:"error"})}finally{Je(!1),Xe(null),Ne(null)}}}))},ra=z=>{z?.id&&s&&(Je(!1),Xe(null),qe(""),Ne({title:" ",message:`${z.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Je(!0),Xe({type:"hard-delete",id:z.id});try{await er.hardDeleteSnapshotFromTrash(s,z.id),await Qe(!0),Rt({title:"",message:"",type:"success"})}catch(X){console.error(X),Rt({title:"",message:"",type:"error"})}finally{Je(!1),Xe(null),Ne(null)}}}))},ml=z=>{if(!z)return;const X=Xt(z).filter(Fe=>!ee(Fe?.vendor)),ae=["","","","","()",""],xe=X.map(Fe=>{const vt=parseFloat(Fe?.price)||0,mn=Fe?.quantity===""?0:parseFloat(Fe?.quantity)||0,dn=Math.round(vt*mn*Ue(Fe));return[Fe?.name??"",vt||"",Fe?.unit??"",Fe?.quantity??"",dn||"",Fe?.vendor??""]}),De=Fe=>{const vt=String(Fe??"");return vt.includes(",")||vt.includes('"')||vt.includes(`
`)||vt.includes("\r")?`"${vt.replace(/"/g,'""')}"`:vt},Me=[ae.map(De).join(","),...xe.map(Fe=>Fe.map(De).join(","))].join(`
`),Pe=new Uint8Array([239,187,191]),He=new Blob([Pe,Me],{type:"text/csv"}),We=URL.createObjectURL(He),st=(z.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),ht=(z.snapshot_date?new Date(z.snapshot_date):new Date).toISOString().slice(0,10),gt=document.createElement("a");gt.href=We,gt.download=`InventorySnapshot_${ht}_${st}.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),URL.revokeObjectURL(We)},ur=()=>{if(!Kn)return;const z=["","()"],X=Yn.map(Fe=>[Fe.vendor,Math.round(Fe.total||0)]),ae=Fe=>{const vt=String(Fe??"");return vt.includes(",")||vt.includes('"')||vt.includes(`
`)||vt.includes("\r")?`"${vt.replace(/"/g,'""')}"`:vt},xe=[z.map(ae).join(","),...X.map(Fe=>Fe.map(ae).join(","))].join(`
`),De=new Uint8Array([239,187,191]),Me=new Blob([De,xe],{type:"text/csv"}),Pe=URL.createObjectURL(Me),He=(Kn.snapshot_date?new Date(Kn.snapshot_date):new Date).toISOString().slice(0,10),We=Kn.title||"inventory_summary",st=Nt?`${Nt.year}${String(Nt.month).padStart(2,"0")}`:He,ht=We.toString().replace(/[\\/:*?"<>|]/g,"_"),gt=document.createElement("a");gt.href=Pe,gt.download=`InventorySummary_${st}_${ht}.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),URL.revokeObjectURL(Pe)},gl=z=>{if(!z?.vendor)return;const X=["","","","","","()",""],ae=(z.rows||[]).map(Fe=>{const vt=Fe.itemCategory?Le(Fe.itemCategory):Ct(Fe.breakdownKey);return[Fe.name||"",vt,Math.round(Fe.price||0),Fe.unit||"",Number(Fe.quantity||0),Math.round(Fe.taxed||0),z.vendor]}),xe=Fe=>{const vt=String(Fe??"");return vt.includes(",")||vt.includes('"')||vt.includes(`
`)||vt.includes("\r")?`"${vt.replace(/"/g,'""')}"`:vt},De=[X.map(xe).join(","),...ae.map(Fe=>Fe.map(xe).join(","))].join(`
`),Me=new Uint8Array([239,187,191]),Pe=new Blob([Me,De],{type:"text/csv"}),He=URL.createObjectURL(Pe),We=(Kn?.snapshot_date?new Date(Kn.snapshot_date):new Date).toISOString().slice(0,10),st=Nt?`${Nt.year}${String(Nt.month).padStart(2,"0")}`:We,ht=z.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),gt=document.createElement("a");gt.href=He,gt.download=`InventorySummary_${st}_${ht}.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),URL.revokeObjectURL(He)},Ps=be.useMemo(()=>{const z=at=>at?at.toString().trim():"",X=at=>nn(at),ae=new Set;try{for(const at of(j||new Set).values()){const ut=X(at);ut&&ae.add(ut)}}catch{}const xe=new Set;try{for(const at of(_e||new Set).values()){const ut=X(at);ut&&xe.add(ut)}}catch{}const De=new Map;try{for(const[at,ut]of(x||new Map).entries()){const Et=X(at);Et&&De.set(Et,ut)}}catch{}const Me=new Map;try{(y||[]).forEach(at=>{const ut=X(at?.name);ut&&Me.set(ut,at)})}catch{}const Pe=new Map;try{for(const[at,ut]of(_||new Map).entries()){const Et=X(at);Et&&Pe.set(Et,ut)}}catch{}const He=at=>{const ut=String(at??"").trim();if(!ut)return"";const Et=ut.toLowerCase();return Et===""?"g":Et===""?"ml":Et===""?"cc":Et===""?"kg":Et===""?"l":Et},We=(at,ut)=>{const Et=parseFloat(at?.lastPrice),hn=parseFloat(at?.packetSize),Nn=He(at?.packetUnit),Rn=He(ut||Nn);if(!Number.isFinite(Et)||!Number.isFinite(hn)||hn<=0||!Nn)return null;const Pt=Et/hn;if(Rn===Nn)return Pt;if(Nn==="g"&&Rn==="kg")return Pt*1e3;if(Nn==="kg"&&Rn==="g")return Pt/1e3;const rr=Nn==="cc"?"ml":Nn,An=Rn==="cc"?"ml":Rn;return rr==="ml"&&An==="l"?Pt*1e3:rr==="l"&&An==="ml"?Pt/1e3:null},st=at=>{const ut=String(at??"").trim();return ut?["","","","","","","","pc","PC",""].includes(ut):!1},ht=at=>{const ut=X(at?.name),Et=ut?De.get(ut):null,hn=ut?Me.get(ut):null,Nn=ut&&Pe.has(ut)?String(Pe.get(ut)||""):String(hn?.unit||""),Rn={...at};if(Rn.name=z(Rn.name),Rn.vendor=z(Rn.vendor),Rn._csv={unit:Nn,price:hn?.price??null,vendor:z(hn?.vendor)||null,dateStr:hn?.dateStr??null},!Et)return Rn;const Pt={...Rn},rr=Ye(Et?.itemCategory),An=Et.packetUnit||"",ds=parseFloat(Et.packetSize),ns=An?We(Et,An):null;if(Pt.isPhantom)An&&ns!==null&&(Pt.unit=An,Pt.price=ns);else{if(!!An&&Number.isFinite(ds)&&ds>0&&(st(Pt.unit)||!Pt.unit)&&ns!==null){const hs=Pt.quantity;if(hs!==""&&hs!==null&&hs!==void 0){const wi=parseFloat(hs);Number.isFinite(wi)&&(Pt.quantity=wi*ds)}const la=Pt.threshold;if(la!==""&&la!==null&&la!==void 0){const wi=parseFloat(la);Number.isFinite(wi)&&(Pt.threshold=wi*ds)}Pt.unit=An}else(An&&ns!==null||!Pt.unit&&An)&&(Pt.unit=An);if(ns!==null&&He(Pt.unit)===He(An))Pt.price=ns;else{const hs=We(Et,Pt.unit||An);hs!==null&&(Pt.price=hs)}}const Vs=ue(Pt?.tax10_override??Pt?.tax10Override),bl=rr?G(rr):null;return Pt._master={packetSize:Et.packetSize,packetUnit:Et.packetUnit,lastPrice:Et.lastPrice,itemCategory:rr||null,tax10Auto:bl,tax10Override:Vs,updatedAt:Et.updatedAt},rr&&(Pt.tax10_override=Vs,!Vs&&bl!==null&&(Pt.tax10=bl)),Pt},gt=o.map(ht),Fe=new Map;gt.forEach(at=>{const ut=X(at?.name);ut&&Fe.set(ut,at)});const vt=[...gt];y.forEach((at,ut)=>{const Et=String(at?.name??""),hn=z(Et),Nn=X(Et);if(Nn&&!(j.has(Et)||hn&&j.has(hn)||ae.has(Nn))&&!Fe.has(Nn)){const Rn={id:`phantom-${ut}`,isPhantom:!0,name:hn,quantity:"",unit:at.unit||"",category:"",price:at.price,vendor:z(at.vendor),threshold:0,tax10:!1,tax10_override:!1};vt.push(ht(Rn))}});const mn=vt.filter(at=>{const ut=String(at?.name??""),Et=z(ut),hn=X(ut);return!(j.has(ut)||Et&&j.has(Et)||hn&&ae.has(hn)||_e.has(ut)||Et&&_e.has(Et)||hn&&xe.has(hn)||ee(at.vendor))}),dn=at=>{if(!at)return-1;const Et=new Date(at).getTime();return Number.isFinite(Et)?Et:-1},Gs=(at,ut)=>{const Et=!!at?.isPhantom,hn=!!ut?.isPhantom;if(Et!==hn)return Et?ut:at;const Nn=Math.max(dn(at?.updated_at),dn(at?.updatedAt),dn(at?.created_at),dn(at?.createdAt)),Rn=Math.max(dn(ut?.updated_at),dn(ut?.updatedAt),dn(ut?.created_at),dn(ut?.createdAt));if(Nn!==Rn)return Rn>Nn?ut:at;const Pt=at?.quantity,rr=ut?.quantity,An=Pt===""||Pt===null||Pt===void 0?null:parseFloat(Pt),ds=rr===""||rr===null||rr===void 0?null:parseFloat(rr),ns=An!==null&&Number.isFinite(An),Vs=ds!==null&&Number.isFinite(ds);return ns!==Vs&&Vs?ut:at},ts=new Map;return mn.forEach(at=>{const ut=X(at?.name)||z(at?.name);if(!ut)return;const hn=`${z(at?.vendor)||"__no_vendor__"}@@${ut}`,Nn=ts.get(hn);if(!Nn){ts.set(hn,at);return}ts.set(hn,Gs(Nn,at))}),Array.from(ts.values())},[o,y,j,_e,x,_,ee]),yl=z=>{const{active:X,over:ae}=z;if(!ae)return;if(X?.data?.current?.type==="summary-row"){if(!yr)return;const De=X.id,Me=ae.id;if(!De||!Me||De===Me)return;const Pe=cr,He=Pe.indexOf(De),We=Pe.indexOf(Me);if(He<0||We<0)return;const st=Zi(Pe,He,We);bt(ht=>({...ht,[yr]:st}));return}if(ae.id==="inventory-list-droppable"){const De=X.data.current.item;if(X.data.current.type==="csv-item"){const Me=String(De?.name??"").trim(),Pe=nn(Me);let He=null;if(x&&x.size>0&&Pe&&(He=x.get(Me)||null,!He)){for(const[gt,Fe]of x.entries())if(nn(gt)===Pe){He=Fe;break}}const We=He?.packetUnit||De.unit,st=He?Be(He,We):null,ht=st!==null?st:He?.lastPrice!==null&&He?.lastPrice!==void 0&&He?.lastPrice!==""?He.lastPrice:De.price;H({name:De.name,price:ht,unit:We,category:"",threshold:0,quantity:0,vendor:De.vendor,tax10:ue(De?.tax10),isNewFromCsv:!0}),M(!0)}}},qs=async z=>{if(z.preventDefault(),!s)return;const X=new FormData(z.target),ae={name:X.get("name"),quantity:parseFloat(X.get("quantity")),unit:X.get("unit"),category:X.get("category"),threshold:parseFloat(X.get("threshold")),vendor:T.vendor||"",price:T.price||0,tax10:ue(T?.tax10)};try{T.id&&!T.isPhantom?await er.update(s,{...T,...ae}):await er.add(s,ae),M(!1),H(null),Qe()}catch(xe){console.error("Failed to save item:",xe),Rt({title:"",message:"",type:"error"})}},Yo=z=>{ie(z),Mt(!0)},Qo=z=>{!z||z.isPhantom||!z?._master?.packetUnit||(V(z),F(!0))},us=()=>{P||(F(!1),V(null))},Wo=async({convertQuantity:z})=>{if(!s)return;const X=q;if(!X||X.isPhantom)return;const ae=X?._master?.packetUnit;if(!ae)return;const xe=ae,De=Be(X?._master,xe);if(De===null){Rt({title:"",message:"/",type:"error"});return}let Me=X.quantity,Pe=X.threshold;if(z){const He=Ze(X.unit,xe);if(!He){Rt({title:"",message:"kgg / lml ",type:"error"});return}const We=X.quantity===""?null:parseFloat(X.quantity);We!==null&&Number.isFinite(We)&&(Me=We*He);const st=X.threshold===""?null:parseFloat(X.threshold);st!==null&&Number.isFinite(st)&&(Pe=st*He)}L(!0);try{await er.update(s,{id:X.id,unit:xe,price:De,quantity:Me===""?0:parseFloat(Me)||0,threshold:Pe===""?0:parseFloat(Pe)||0,tax10:ue(X?.tax10)}),await Qe(!0),F(!1),V(null)}catch(He){console.error("Failed to sync unit:",He),Rt({title:"",message:"",type:"error"})}finally{L(!1)}},Jo=async()=>{if(yt)try{const X=(ae=>ae?ae.toString().trim():"")(yt?.name);X&&Ee(ae=>{const xe=new Set(ae);return xe.add(X),xe}),Mt(!1),ie(null)}catch(z){console.error("Failed to delete/ignore item:",z)}},Xo=async(z,X)=>{try{if(!s)return;const ae=Ps.find(xe=>xe.id===z);if(!ae)return;if(ae.isPhantom){const xe={name:ae.name.trim(),quantity:X,unit:ae.unit,category:ae.category||"",price:ae.price,vendor:ae.vendor,threshold:0,tax10:ue(ae?.tax10)},De=await er.add(s,xe);await Qe(!0),fe(Me=>{const Pe=new Set(Me);return Pe.add(De.id),Pe})}else u(xe=>xe.map(De=>De.id!==z?De:{...De,quantity:X,unit:ae.unit??De.unit,price:ae.price??De.price,threshold:ae.threshold??De.threshold})),fe(xe=>{const De=new Set(xe);return De.add(z),De}),await er.update(s,{...ae,quantity:X})}catch(ae){console.error(ae);const xe=ae?.message||ae?.error_description||(typeof ae=="string"?ae:null)||(()=>{try{return JSON.stringify(ae)}catch{return null}})()||"";Rt({title:"",message:`
${xe}`,type:"error"}),Qe()}},sa=async(z,X)=>{try{if(!s||!z)return;const ae=!!X;if(z.isPhantom){const xe={name:z.name.trim(),quantity:z.quantity===""?0:parseFloat(z.quantity)||0,unit:z.unit,category:z.category||"",price:z.price,vendor:z.vendor,threshold:0,tax10:ae,tax10_override:!0};await er.add(s,xe),await Qe(!0)}else u(xe=>xe.map(De=>De.id===z.id?{...De,tax10:ae,tax10_override:!0}:De)),await er.update(s,{...z,tax10:ae,tax10_override:!0})}catch(ae){console.error(ae);const xe=ae?.message||ae?.error_description||(typeof ae=="string"?ae:null)||(()=>{try{return JSON.stringify(ae)}catch{return null}})()||"";Rt({title:"",message:`
${xe}`,type:"error"}),Qe()}},Zu=(z,X)=>{if(X===!0){Sn({item:z});return}sa(z,X)},Zo=()=>{_t||Sn(null)},ia=async()=>{const z=Jt?.item;if(z){rn(!0);try{await sa(z,!0),Sn(null)}finally{rn(!1)}}},Fr=async()=>{if(!me&&Y&&s){B(!0);try{const z=Ps.filter(ae=>!ae.isPhantom).map(ae=>{const xe={...ae};return delete xe.isPhantom,delete xe._master,delete xe._csv,xe}),X=z.reduce((ae,xe)=>{const De=parseFloat(xe.price)||0,Me=xe.quantity===""?0:parseFloat(xe.quantity)||0;return ae+De*Me*Ue(xe)},0);await er.createSnapshot(s,Y,z,X),W?(await er.resetStockQuantities(s),await Qe(),fe(new Set)):await Qe(!0),$(!1),ct(!0)}catch(z){console.error("Failed to complete inventory:",z);const X=z?.message||z?.error_description||(typeof z=="string"?z:null)||(()=>{try{return JSON.stringify(z)}catch{return null}})()||"";Rt({title:"",message:`
${X}`,type:"error"})}finally{B(!1)}}},vl=()=>{const z=["","","","","()",""],X=aa.map(We=>{const st=parseFloat(We.price)||0,ht=We.quantity===""?0:parseFloat(We.quantity)||0,gt=Math.round(st*ht*Ue(We));return[We.name,st,We.unit,We.quantity,gt,We.vendor||""]}),ae=[z.join(","),...X.map(We=>We.map(st=>{const ht=String(st??"");return ht.includes(",")||ht.includes('"')||ht.includes(`
`)?`"${ht.replace(/"/g,'""')}"`:ht}).join(","))].join(`
`),xe=new Uint8Array([239,187,191]),De=new Blob([xe,ae],{type:"text/csv"}),Me=document.createElement("a"),Pe=URL.createObjectURL(De),He=new Date().toISOString().split("T")[0];Me.href=Pe,Me.download=`Inventory_${He}.csv`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),URL.revokeObjectURL(Pe)},xl=["","","","","","","","","","","",""],Fs=[...new Set(Ps.map(z=>z.vendor).filter(z=>z&&!ee(z)))].sort(),Hs=Ps.some(z=>!z.vendor),bi=xn==="summary",aa=Ps.filter(z=>z.name.toLowerCase().includes(U.toLowerCase())?xn==="all"||xn==="summary"?!0:xn==="inventory-check"?ar.has(z.id)||!z.isPhantom:xn==="other"?!z.vendor:z.vendor===xn:!1);return C?i.jsxs("div",{className:"inventory-edit-container fade-in",children:[i.jsx("div",{className:"container-header",children:i.jsx("h2",{className:"section-title",children:T&&!T.isNewFromCsv?"":""})}),i.jsx(tn,{className:"edit-form-card",children:i.jsxs("form",{onSubmit:qs,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(Ut,{name:"name",defaultValue:T?.name,required:!0,placeholder:": "})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(Ut,{name:"quantity",type:"number",step:"0.01",defaultValue:T?.quantity,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(Ut,{name:"unit",defaultValue:T?.unit||"g",required:!0,placeholder:"g, ml, ..."})]})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(Ut,{name:"category",defaultValue:T?.category,list:"category-list",placeholder:"",autoComplete:"off"}),i.jsx("datalist",{id:"category-list",children:xl.map(z=>i.jsx("option",{value:z},z))})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" ()"}),i.jsx(Ut,{name:"threshold",type:"number",step:"0.01",defaultValue:T?.threshold||0})]})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx(re,{variant:"ghost",type:"button",onClick:()=>{M(!1),H(null)},children:""}),i.jsx(re,{variant:"primary",type:"submit",children:""})]})]})})]}):i.jsx(Xi,{onDragEnd:yl,sensors:cn,autoScroll:!1,children:i.jsxs("div",{className:"inventory-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsxs("div",{className:"header-actions inventory-header-actions",children:[i.jsx(re,{variant:"ghost",onClick:n,children:" "}),i.jsx(re,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>a({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),i.jsx(re,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const z=new Date;le(`${z.getFullYear()}${z.getMonth()+1} `),J(!0),$(!0)},children:" "}),i.jsx(re,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{he(null),te("history"),ze(!0)},title:"",children:" "}),i.jsx(re,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{H(null),M(!0)},children:"+ "})]})]}),i.jsx("div",{className:"inventory-split-layout",children:i.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[i.jsxs("div",{className:"inventory-controls",children:[bi?i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsx("select",{className:"inventory-controls__select",value:Ve,onChange:z=>et(z.target.value),disabled:kt.length===0,children:kt.length===0?i.jsx("option",{value:"",children:""}):kt.map(z=>i.jsx("option",{value:z.key,children:z.label},z.key))})]}),Nt&&i.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",Nt.rangeLabel]})]}):i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsxs("select",{className:"inventory-controls__select",value:xn==="inventory-check"?"":xn,onChange:z=>{z.target.value&&Ln(z.target.value)},children:[i.jsx("option",{value:"all",children:""}),i.jsx("option",{value:"",disabled:!0,children:""}),i.jsxs("optgroup",{label:"",children:[Fs.map(z=>i.jsx("option",{value:z,children:z},z)),Hs&&i.jsx("option",{value:"other",children:""})]})]})]}),i.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:U,onChange:z=>D(z.target.value)})]}),i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[i.jsxs("button",{className:"inventory-controls__btn",onClick:()=>Ln("inventory-check"),"data-active":xn==="inventory-check"?"true":"false",children:["  (",ar.size,")"]}),i.jsx("button",{className:"inventory-controls__btn",onClick:()=>Ln("summary"),"data-active":xn==="summary"?"true":"false",children:" "}),!bi&&i.jsx("button",{className:"inventory-controls__btn",onClick:vl,title:"CSV",children:" CSV (.csv)"}),!bi&&xn==="inventory-check"&&i.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),bi?i.jsxs("div",{className:"inventory-summary",children:[i.jsx("div",{className:"inventory-summary__header",children:i.jsxs("div",{children:[i.jsx("div",{className:"inventory-summary__title",children:""}),Nt&&i.jsxs("div",{className:"inventory-summary__meta",children:[": ",Nt.rangeLabel]}),Kn?i.jsxs("div",{className:"inventory-summary__meta",children:[": ",Kn.title||"","",Lt(Kn.snapshot_date),""]}):i.jsx("div",{className:"inventory-summary__meta",children:""}),Pr.length>1&&i.jsxs("div",{className:"inventory-summary__note",children:[" ",Pr.length," "]})]})}),Kn?i.jsxs("div",{className:"inventory-summary__table-wrap",children:[i.jsx("div",{className:"inventory-summary__actions",children:i.jsx(re,{variant:"secondary",size:"sm",onClick:ur,children:" CSV (.csv)"})}),i.jsxs("table",{className:"inventory-summary__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40px"}}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx(tl,{items:cr,strategy:Eo,children:i.jsxs("tbody",{children:[Yn.map(z=>{const X=At===z.vendor,ae=na.get(z.vendor)||null;return i.jsxs(be.Fragment,{children:[i.jsx($t,{row:z,onVendorClick:Xu,isSelected:X}),X&&ae&&i.jsxs("tr",{className:"inventory-summary__detail-row",children:[i.jsx("td",{}),i.jsx("td",{colSpan:"2",children:i.jsxs("div",{className:"inventory-summary__inline-detail",children:[i.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[i.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[ae.vendor," "]}),i.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>gl(ae),disabled:!ae.rows||ae.rows.length===0,children:" CSV"}),i.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(ae.totals.taxed||0).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(xe=>i.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:Ct(xe)}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ae.totals[xe]||0).toLocaleString()]})]},xe)),ae.totals.unknown>0&&i.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ae.totals.unknown).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(ae.totals.net||0).toLocaleString()]}),i.jsx("div",{className:"inventory-summary__inline-items-wrap",children:i.jsxs("table",{className:"inventory-summary__inline-items-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx("tbody",{children:ae.rows.map((xe,De)=>{const Me=xe.itemCategory?Le(xe.itemCategory):Ct(xe.breakdownKey),Pe=De>0?ae.rows[De-1]:null,He=!!Pe&&Pe.breakdownKey!==xe.breakdownKey;return i.jsxs("tr",{className:He?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[i.jsx("td",{children:xe.name||"-"}),i.jsx("td",{children:Me}),i.jsxs("td",{style:{textAlign:"right"},children:["",Number(xe.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),i.jsxs("td",{style:{textAlign:"right"},children:[Number(xe.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),xe.unit?` ${xe.unit}`:""]}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(xe.taxed||0).toLocaleString()]})]},xe.id)})})]})})]})})]})]},z.vendor)}),Yn.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsx("td",{}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(fl.net).toLocaleString()," / ",Math.round(fl.taxed).toLocaleString()]})]})})]})]}):i.jsx("div",{className:"inventory-summary__empty",children:""})]}):i.jsx(xk,{items:aa,loading:k,onSearch:D,searchQuery:U,onEdit:z=>{H(z),M(!0)},onDelete:Yo,onUpdateQuantity:Xo,onToggleTax:Zu,onRequestUnitSync:Qo})]})}),i.jsx(pn,{isOpen:!!Jt,onClose:Zo,title:"10%",size:"small",showCloseButton:!_t,children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",Jt?.item?.name||"","",i.jsx("strong",{children:"10%"}),""]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[i.jsx(re,{variant:"secondary",onClick:Zo,disabled:_t,children:""}),i.jsx(re,{variant:"primary",onClick:ia,disabled:_t,children:_t?"...":""})]})]})}),i.jsx(pn,{isOpen:A,onClose:()=>{me||$(!1)},title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),i.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[i.jsx("strong",{children:":"}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. ",W?i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:"()0"}),""]}):i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:""}),""]}),i.jsx("br",{}),""]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:W,disabled:me,onChange:()=>J(!0)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:"0"}),""]})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:!W,disabled:me,onChange:()=>J(!1)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:""}),""]})]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),i.jsx("input",{type:"text",value:Y,onChange:z=>le(z.target.value),disabled:me,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx("button",{onClick:()=>{me||$(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:me?"not-allowed":"pointer",opacity:me?.6:1,fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Fr,disabled:me,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:me?"#94a3b8":"#2ecc71",color:"white",cursor:me?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:me?"...":W?"":""})]}),me&&i.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),i.jsxs(pn,{isOpen:ge,onClose:()=>ze(!1),title:" ",size:"large",children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:I==="history"?i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:sn.length})," "]}):i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:f.length})," "]})}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",gap:"6px"},children:[i.jsx("button",{type:"button",onClick:()=>te("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:I==="history"?"#111":"#fff",color:I==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),i.jsx("button",{type:"button",onClick:()=>te("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:I==="trash"?"#111":"#fff",color:I==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>Qe(!0),title:"",children:" "})]})]}),I==="history"&&i.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),i.jsx("select",{value:Ke,onChange:z=>nt(z.target.value),disabled:kt.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:kt.length===0?i.jsx("option",{value:"",children:""}):kt.map(z=>i.jsx("option",{value:z.key,children:z.label},z.key))})]}),Vn&&i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",Vn.rangeLabel]})]}),I==="history"&&sn.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):I==="trash"&&f.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:I==="trash"?"":""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),i.jsx("tbody",{children:(I==="history"?sn:f).map(z=>{const X=Xt(z).filter(ht=>!ee(ht?.vendor)),ae=X.length,xe=Math.round(X.reduce((ht,gt)=>{const Fe=parseFloat(gt?.price)||0,vt=gt?.quantity===""?0:parseFloat(gt?.quantity)||0;return ht+Fe*vt*Ue(gt)},0)),De=I==="trash"?`trash-${z.id}`:z.id,Me=Lt(I==="trash"?z.deleted_at:z.snapshot_date),Pe=pe?.type==="move"&&pe?.id===z.id,He=pe?.type==="restore"&&pe?.id===z.id,We=pe?.type==="hard-delete"&&pe?.id===z.id,st=Pe||He||We;return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Me}),i.jsx("td",{style:{padding:"10px"},children:z.title||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:ae.toLocaleString()}),i.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",xe.toLocaleString()]}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:I==="history"?i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>ml(z),disabled:ae===0||st,title:ae===0?"items CSV":"CSV",children:" CSV"}),i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>he(z),disabled:st,children:""}),i.jsx(re,{variant:"danger",size:"sm",onClick:()=>pl(z),disabled:st,title:"",children:Pe?"...":""})]}):i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>ml(z),disabled:ae===0||st,children:" CSV"}),i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>he(z),disabled:st,children:""}),i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>Ko(z),disabled:st,title:"",children:He?"...":""}),i.jsx(re,{variant:"danger",size:"sm",onClick:()=>ra(z),disabled:st,title:"",children:We?"...":""})]})})]},De)})})]})})]}),i.jsx(pn,{isOpen:!!ye,onClose:()=>{$e||Ne(null)},title:ye?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:ye?.message}),ye?.requireText&&i.jsxs("div",{style:{marginTop:"14px"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",i.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:ye.requireText})," "]}),i.jsx("input",{type:"text",value:Oe,onChange:z=>qe(z.target.value),placeholder:ye.requireText,disabled:$e,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(re,{variant:"ghost",disabled:$e,onClick:()=>{$e||Ne(null)},children:""}),i.jsx(re,{variant:"danger",disabled:$e||!!ye?.requireText&&Oe!==ye.requireText,onClick:()=>ye?.onConfirm&&ye.onConfirm(),children:$e?ye?.loadingLabel||"...":ye?.confirmLabel||""})]})]})}),i.jsx(pn,{isOpen:!!Re,onClose:()=>he(null),title:Re?` ${Re.title||""}`:" ",size:"large",children:(()=>{const z=Re;if(!z)return null;const xe=[...Xt(z).filter(Me=>ee(Me?.vendor)?!1:ot?(Me?.quantity===""?0:parseFloat(Me?.quantity)||0)!==0:!0)].sort((Me,Pe)=>{const He=ke.direction==="desc"?-1:1;if(ke.key==="vendor"){const vt=(Me?.vendor||"").toString(),mn=(Pe?.vendor||"").toString(),dn=vt.localeCompare(mn,"ja");if(dn!==0)return dn*He;const Gs=(Me?.name||"").toString(),ts=(Pe?.name||"").toString();return Gs.localeCompare(ts,"ja")*He}const We=(Me?.name||"").toString(),st=(Pe?.name||"").toString(),ht=We.localeCompare(st,"ja");if(ht!==0)return ht*He;const gt=(Me?.vendor||"").toString(),Fe=(Pe?.vendor||"").toString();return gt.localeCompare(Fe,"ja")*He}),De=xe.reduce((Me,Pe)=>{const He=parseFloat(Pe?.price)||0,We=Pe?.quantity===""?0:parseFloat(Pe?.quantity)||0,st=He*We;return Me.net+=st,Me.taxed+=st*Ue(Pe),Me},{net:0,taxed:0});return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[i.jsxs("div",{children:[": ",i.jsx("strong",{children:Lt(z.snapshot_date)})]}),i.jsxs("div",{children:[": ",i.jsx("strong",{children:xe.length.toLocaleString()})]}),i.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",i.jsxs("strong",{children:["",Math.round(De.net).toLocaleString()," / ",Math.round(De.taxed).toLocaleString()]})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:ot,onChange:Me=>jt(Me.target.checked)}),"0"]}),i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>ml(z),children:" CSV (.csv)"})]}),xe.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{Ae(Me=>Me.key==="vendor"?{key:"vendor",direction:Me.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",ke.key==="vendor"&&(ke.direction==="asc"?"":"")]})]})}),i.jsx("tbody",{children:xe.map((Me,Pe)=>{const He=parseFloat(Me?.price)||0,We=Me?.quantity===""?0:parseFloat(Me?.quantity)||0,st=Math.round(He*We*Ue(Me)),ht=hl(Me),gt=Le(ht);return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsxs("td",{style:{padding:"10px"},children:[Me?.name||"-",ue(Me?.tax10)&&i.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),i.jsx("td",{style:{padding:"10px"},children:gt}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:He?`${Number(He).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:Me?.unit||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:We?We.toLocaleString():"0"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:st?`${st.toLocaleString()}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:Me?.vendor||"-"})]},Me?.id||`${Me?.name||"item"}-${Pe}`)})})]})})]})})()}),i.jsx(pn,{isOpen:K,onClose:us,title:"",size:"small",children:(()=>{const z=q,X=z?._master?.packetUnit||"",ae=z?.unit||"",xe=Ze(ae,X),De=xe!==null&&xe!==1,Me=parseFloat(z?.price)||0,Pe=z?.quantity===""?0:parseFloat(z?.quantity)||0,He=z?Ue(z):1.08,We=Me*Pe*He,st=X?Be(z?._master,X):null,ht=st===null?null:st*Pe*He,gt=st===null||!De?null:st*(Pe*xe)*He,Fe=mn=>`${Math.round(mn).toLocaleString()}`,vt=mn=>Number.isInteger(mn)?mn.toLocaleString():mn.toLocaleString(void 0,{maximumFractionDigits:3});return i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[i.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:z?.name||"-"}),i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",vt(Pe)," ",ae," /  ",Me.toLocaleString()," /  ",Fe(We)]}),!!X&&i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",X]})]}),i.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",i.jsx("br",{}),""]})}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[i.jsx(re,{variant:"ghost",type:"button",onClick:us,disabled:P,children:""}),i.jsx(re,{variant:"secondary",type:"button",onClick:()=>Wo({convertQuantity:!1}),isLoading:P,disabled:P||!X||st===null,title:ht===null?"":`:  ${Fe(ht)}`,children:""}),De&&i.jsx(re,{variant:"primary",type:"button",onClick:()=>Wo({convertQuantity:!0}),isLoading:P,disabled:P||!X||st===null,title:gt===null?"":`:  ${Fe(gt)}`,children:""})]})]})})()}),i.jsx(pn,{isOpen:it,onClose:()=>Mt(!1),title:"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",i.jsx("strong",{children:yt?.name}),""]}),i.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",i.jsx("strong",{children:""}),"",i.jsx("br",{}),"CSV"]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx("button",{onClick:()=>Mt(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Jo,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),i.jsx(pn,{isOpen:Ie,onClose:()=>ct(!1),title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),i.jsxs("h3",{style:{marginBottom:"1rem"},children:[Y," "]}),i.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",i.jsx("br",{}),""]}),i.jsx("button",{onClick:()=>ct(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),i.jsx(pn,{isOpen:!!pt,onClose:()=>Rt(null),title:pt?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[pt?.type==="success"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),pt?.type==="error"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),i.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:pt?.message}),i.jsx("button",{onClick:()=>Rt(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:pt?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},uo="app-data",wk="incoming-deliveries",Sk=n=>{const t=String(n||"").trim();return t&&t.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},jk=n=>{const t=String(n),s=t.lastIndexOf(".");return s<=0?t:t.slice(0,s)},_k=async n=>{if(!n)return"";const t=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},Jr={async _getCurrentUserId(){const{data:n,error:t}=await Te.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${wk}`},_filePath(n,t){const s=this._folderPath(n),a=String(t||"").replace(/^\/+/,"");return`${s}/${a}`},async listJsonFiles(n=null){const t=n||await this._getCurrentUserId();if(!t)return[];const s=this._folderPath(t),{data:a,error:o}=await Te.storage.from(uo).list(s,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return o?(console.error("Failed to list incoming deliveries:",o),[]):(a||[]).filter(u=>String(u?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._filePath(s,n),{data:o,error:u}=await Te.storage.from(uo).download(a);if(u)throw u;const d=await _k(o);return JSON.parse(d)},async saveDeliverySet({pdfFile:n,parsed:t},s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");if(!n)throw new Error("PDF");if(!t)throw new Error("");const o=new Date,u=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}_${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,d=Sk(jk(n.name||"delivery")),h=`${u}_${d}`,f=this._filePath(a,`${h}.pdf`),m=this._filePath(a,`${h}.json`),y={...t,_meta:{savedAt:o.toISOString(),originalFileName:n.name||null}},[v,x]=await Promise.all([Te.storage.from(uo).upload(f,n,{upsert:!1,contentType:"application/pdf"}),Te.storage.from(uo).upload(m,new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(v.error)throw v.error;if(x.error)throw x.error;return{baseName:h,pdfPath:f,jsonPath:m}},async deleteDeliverySet(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=String(n||"").trim();if(!a)throw new Error("baseName ");const o=this._filePath(s,`${a}.pdf`),u=this._filePath(s,`${a}.json`),{data:d,error:h}=await Te.storage.from(uo).remove([o,u]);if(h)throw h;return d}},Ck="/app/assets/pdf.worker-DU8cYlj-.js",Ek=n=>typeof n=="string"&&n.trim().length>0,Ds=n=>String(n??"").replace(/\u0000/g,"").trim(),go=n=>{const t=String(n??"").trim();if(!t)return null;const s=t.replace(/[,\s]/g,""),a=Number(s);return Number.isFinite(a)?a:null},ho=n=>{const t=String(n??"").trim();if(!t)return null;const s=t.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return s?s[2]?`${s[1]} ${s[2]}`:s[1]:null},Nk=n=>{const t=String(n??"").trim();return!!(!t||t==="/"||t.startsWith("")||t.includes(""))},kk=(n,t)=>{const s=String(n??"").trim(),a=s.match(/^No\.?\s*(\d{3,})\s*$/);if(a?.[1])return{slipNo:a[1],consumeNext:!1};if(/^No\.?\s*$/.test(s)){const o=String(t??"").trim();if(/^\d{3,}$/.test(o))return{slipNo:o,consumeNext:!0}}return null},lp=n=>{const t=String(n??"").trim();return t?!!/^No\.?\s*(\d{3,})?\s*$/.test(t):!1},Tk=(n,t)=>{const s=Ds(n[t]);if(!s||lp(s)||s===""||s===""||s===""||s==="No"||s===""||s===""||s===""||s===""||s===""||s==="")return null;let a=t+1;const o=go(n[a]);if(o==null)return null;a+=1;const u=go(n[a]);if(u==null)return null;a+=1;const d=Ds(n[a]);if(!d)return null;a+=1;let h=null,f=null,m=null;const y=go(n[a]);for(y!=null?(f=y,a+=1,m=Ds(n[a]),a+=1):(h=Ds(n[a])||null,a+=1,f=go(n[a]),a+=1,m=Ds(n[a]),a+=1);a<n.length;){const w=Ds(n[a]);if(w===""||w===""){a+=1;continue}break}let v=null;const x=Ds(n[a]);return/^\d+$/.test(x)&&(v=parseInt(x,10),a+=1),{item:{no:v,code:null,name:s,unitPrice:o,deliveryQty:u,deliveryUnit:d,spec:h,orderQty:f,orderUnit:m},nextIndex:a}},Rk=n=>{const t=(n||[]).map(Ds).filter(h=>!Nk(h)),s={title:t.find(h=>h.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let h=0;h<t.length;h+=1){const f=t[h],m=f.match(/^?\s*(.+)$/);if(m?.[1]&&!s.outputAt){s.outputAt=ho(m[1])||m[1].trim();continue}const y=f.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);y&&!s.rangeFrom&&(s.rangeFrom=y[1],s.rangeTo=y[2])}const a=new Map;let o=null,u=null;for(let h=0;h<t.length;h+=1){const f=t[h],m=t[h+1],y=kk(f,m);if(y?.slipNo){const v=y.slipNo;y.consumeNext&&(h+=1);const x=a.get(v);x?o=x:(o={slipNo:v,vendor:u||null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},a.set(v,o));continue}if(/^(||)/.test(f)&&!f.includes("")&&!f.includes("")&&!f.includes("")){let v=3;(f.startsWith("")||f.startsWith("")||f.startsWith(""))&&(v=4);let x=f.slice(v).trim();(x.startsWith(":")||x.startsWith(""))&&(x=x.slice(1).trim());let w=null;if(!x)Ek(m)&&!/^\d+$/.test(m)&&!m.includes("")&&(w=m.trim());else{const _=x.match(/^(\d+)\s+(.+)$/);_&&(x=_[2].trim()),w=x}w&&(o?o.vendor||(o.vendor=w):u=w);continue}if(o){if(f===""||f.startsWith("")){const v=f.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.slipDate=v[1]:ho(m)&&(o.slipDate=ho(m));continue}if(f===""){const v=go(m);v!=null&&(o.total=v);continue}if(f===""||f.startsWith("")){const v=f.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.deliveryDate=v[1]:ho(m)&&(o.deliveryDate=ho(m)?.slice(0,10));continue}if(f.startsWith("")){const x=f.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(x&&x!=="No"){o.comment=x;continue}const w=[];for(let E=h+1;E<t.length;E+=1){const j=t[E];if(j){if(lp(j)||j==="No"||j===""||j===""||j===""||j===""||j===""||j===""||j==="")break;w.push(j)}}const _=w.join(" ").trim();_&&_!=="No"&&(o.comment=_);continue}if(f===""||f===""){let v=h+1;for(;v<t.length;){const x=t[v];if(lp(x)||x==="")break;const w=Tk(t,v);if(!w){v+=1;continue}o.items.push(w.item),v=w.nextIndex}h=v-1}}}const d=Array.from(a.values()).sort((h,f)=>String(h.slipNo).localeCompare(String(f.slipNo),"ja"));return{report:s,slips:d}},Ux=async n=>{if(!n)throw new Error("PDF");const t=await n.arrayBuffer(),s=await ju(()=>import("./pdf-B8mgE00O.js").then(h=>h.p),[]),a=s?.default&&s.default.getDocument?s.default:s;if(!a?.getDocument)throw new Error("PDF");a?.GlobalWorkerOptions&&(a.GlobalWorkerOptions.workerSrc=Ck);const o=await a.getDocument({data:new Uint8Array(t)}).promise,u=[];for(let h=1;h<=o.numPages;h+=1){const m=await(await o.getPage(h)).getTextContent();for(const y of m.items||[]){const v=Ds(y?.str);v&&u.push(v)}}const d=Rk(u);if(!d?.slips||d.slips.length===0)throw new Error("PDFPDF");return d},Lf=n=>String(n||"").replace(/\.json$/i,""),Lx=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${s}/${a}/${o} ${u}:${d}`},Ak=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},Ok=n=>String(n||"").trim(),Dk=({onBack:n})=>{const[t,s]=Io(),[a,o]=be.useState(!0),[u,d]=be.useState([]),[h,f]=be.useState(null),[m,y]=be.useState(!1),[v,x]=be.useState(!1),[w,_]=be.useState(null),[E,j]=be.useState(!1),[N,k]=be.useState(""),[O,U]=be.useState(null),[D,C]=be.useState(!1),[M,T]=be.useState(null),[H,K]=be.useState(!1),[F,q]=be.useState(!1),[V,P]=be.useState(null),L=be.useCallback(async()=>{o(!0),k("");try{const he=await Jr.listJsonFiles();d(he||[])}catch(he){console.error(he),k(""),d([])}finally{o(!1)}},[]);be.useEffect(()=>{L()},[L]);const A=he=>{he.preventDefault(),y(!0)},$=he=>{he.preventDefault(),y(!1)},Y=he=>{he.preventDefault(),y(!1);const I=he.dataTransfer.files?.[0];I&&I.type==="application/pdf"?(f(I),_(null),P(null),k(""),le(I)):I&&k("PDF")},le=async he=>{if(he){k(""),x(!0),_(null),P(null);try{const I=await Ux(he);_(I||null)}catch(I){console.error(I),k(`PDF:
${I?.message||String(I)}`)}finally{x(!1)}}},me=async()=>{if(h){k(""),x(!0),_(null),P(null);try{const he=await Ux(h);_(he||null)}catch(he){console.error(he),k(`PDF:
${he?.message||String(he)}`)}finally{x(!1)}}},B=async()=>{if(!(!h||!w)){k(""),j(!0);try{await Jr.saveDeliverySet({pdfFile:h,parsed:w}),f(null),_(null),await L()}catch(he){console.error(he),k(`: ${he?.message||String(he)}`)}finally{j(!1)}}},W=async he=>{const I=Lf(he);C(!0),k("");try{const te=await Jr.downloadJson(he);U({baseName:I,data:te})}catch(te){console.error(te),k(`: ${te?.message||String(te)}`)}finally{C(!1)}},J=async()=>{if(M?.baseName){K(!0),k("");try{await Jr.deleteDeliverySet(M.baseName),T(null),await L()}catch(he){console.error(he),k(`: ${he?.message||String(he)}`)}finally{K(!1)}}},ge=he=>{const I=new Map,te=(Ne,Oe)=>{const qe=String(Ne?.name||"").trim();if(!qe)return;const $e=Ok(Ne?.deliveryUnit||Ne?.unit||Ne?.unitName||""),Je=Ak(Ne?.deliveryQty??Ne?.quantity??Ne?.qty);if(!Number.isFinite(Je)||Je===null)return;const pe=String(Oe||"").trim(),Xe=`${pe}@@${nn(qe)}@@${$e||""}`,ot=I.get(Xe);ot?ot.qty+=Je:I.set(Xe,{vendor:pe,name:qe,unit:$e,qty:Je})};return(he?.slips||he?.receipts||[]).forEach(Ne=>{const Oe=Ne?.vendor||"";(Ne?.items||[]).forEach($e=>te($e,Oe))}),Array.from(I.values()).sort((Ne,Oe)=>Ne.vendor!==Oe.vendor?Ne.vendor.localeCompare(Oe.vendor,"ja"):Ne.name!==Oe.name?Ne.name.localeCompare(Oe.name,"ja"):String(Ne.unit||"").localeCompare(String(Oe.unit||""),"ja"))},ze=async()=>{q(!0),k(""),P(null);try{const he=await Jr.listJsonFiles();if(!he||he.length===0){P([]);return}const I=[];for(const Ne of he){const Oe=Ne?.name;if(Oe)try{const qe=await Jr.downloadJson(Oe);I.push(qe)}catch(qe){console.warn("Failed to download:",Oe,qe)}}const te=new Map;I.forEach(Ne=>{ge(Ne).forEach(qe=>{const $e=`${qe.vendor}@@${nn(qe.name)}@@${qe.unit||""}`,Je=te.get($e);Je?Je.qty+=qe.qty:te.set($e,{...qe})})});const ye=Array.from(te.values()).sort((Ne,Oe)=>Ne.vendor!==Oe.vendor?Ne.vendor.localeCompare(Oe.vendor,"ja"):Ne.name!==Oe.name?Ne.name.localeCompare(Oe.name,"ja"):String(Ne.unit||"").localeCompare(String(Oe.unit||""),"ja"));P(ye)}catch(he){console.error(he),k(`: ${he?.message||String(he)}`)}finally{q(!1)}},Re=w?.slips||w?.receipts||[];return i.jsxs("div",{className:"incoming-deliveries",children:[i.jsxs("div",{className:"incoming-deliveries__header",children:[i.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsx(re,{variant:"secondary",onClick:()=>s({view:"incoming-stock"}),children:" "}),i.jsx(re,{variant:"ghost",onClick:n,children:" "})]})]}),N&&i.jsx(tn,{className:"incoming-deliveries__error",children:N}),i.jsxs(tn,{className:"incoming-deliveries__card",children:[i.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",pN]}),i.jsxs("div",{className:"incoming-deliveries__upload",children:[i.jsxs("div",{className:`incoming-deliveries__upload-zone ${m?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:A,onDragLeave:$,onDrop:Y,children:[i.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:m?"var(--color-primary)":"inherit"},children:m?"":"PDF"}),i.jsx("input",{type:"file",accept:"application/pdf",onChange:he=>{const I=he.target.files?.[0]||null;f(I),_(null),P(null),k("")},style:{width:"100%"}})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[i.jsx(re,{variant:"secondary",onClick:me,disabled:!h||v||E,children:v?"":""}),i.jsx(re,{variant:"primary",onClick:B,disabled:!h||!w||E||v,children:E?"":""})]})]}),w&&i.jsxs("div",{className:"incoming-deliveries__preview",children:[i.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",i.jsx("strong",{children:w?.report?.outputAt||w?.report?.outputDate||"-"})]}),i.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",i.jsx("strong",{children:Re.length})]}),Re.slice(0,3).map((he,I)=>i.jsxs("div",{className:"incoming-deliveries__slip",children:[i.jsxs("div",{className:"incoming-deliveries__slip-head",children:[i.jsx("div",{style:{fontWeight:700},children:he?.vendor||""}),i.jsxs("div",{style:{opacity:.85},children:["No: ",he?.slipNo||"-"," / : ",he?.deliveryDate||"-"]})]}),i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"52%"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%"},children:""})]})}),i.jsx("tbody",{children:(he?.items||[]).slice(0,6).map((te,ye)=>i.jsxs("tr",{children:[i.jsx("td",{children:te?.name||"-"}),i.jsx("td",{style:{textAlign:"right"},children:te?.unitPrice!=null?`${Math.round(te.unitPrice).toLocaleString()}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:te?.deliveryQty!=null?te.deliveryQty:"-"}),i.jsx("td",{children:te?.deliveryUnit||"-"})]},`${te?.no||ye}`))})]}),(he?.items||[]).length>6&&i.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(he?.items||[]).length-6)," "]})]},`${he?.slipNo||he?.id||I}`)),Re.length>3&&i.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),i.jsxs(tn,{className:"incoming-deliveries__card",children:[i.jsxs("div",{className:"incoming-deliveries__list-head",children:[i.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsx(re,{variant:"secondary",onClick:L,disabled:a||F,children:""}),i.jsx(re,{variant:"secondary",onClick:ze,disabled:a||F,children:F?"":""})]})]}),a?i.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):u.length===0?i.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):i.jsx("div",{className:"incoming-deliveries__file-list",children:u.map(he=>i.jsxs("div",{className:"incoming-deliveries__file-row",children:[i.jsxs("div",{className:"incoming-deliveries__file-info",children:[i.jsx("div",{style:{fontWeight:700},children:Lf(he.name)}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",Lx(he.updated_at||he.created_at)]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>W(he.name),disabled:D||H,children:D?"":""}),i.jsx(re,{variant:"ghost",size:"sm",onClick:()=>T({baseName:Lf(he.name)}),disabled:H,children:""})]})]},he.name))}),V&&i.jsxs("div",{className:"incoming-deliveries__aggregate",children:[i.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),V.length===0?i.jsx("div",{style:{opacity:.85},children:""}):i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:"/"}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:V.slice(0,60).map(he=>i.jsxs("tr",{children:[i.jsx("td",{children:he.vendor||"-"}),i.jsx("td",{children:he.name}),i.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(he.qty)?he.qty:"-"}),i.jsx("td",{children:he.unit||"-"})]},`${he.vendor}@@${he.name}@@${he.unit||""}`))})]}),V.length>60&&i.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),i.jsx(pn,{isOpen:!!O,onClose:()=>U(null),title:"PDF ",size:"large",children:O?.data?i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",Lx(O.data?._meta?.savedAt),O.data?._meta?.originalFileName?` / : ${O.data._meta.originalFileName}`:""]}),(O.data?.slips||O.data?.receipts||[]).map((he,I)=>i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[he?.vendor||"","No: ",he?.slipNo||"-"," / : ",he?.deliveryDate||"-",""]}),i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"52%"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%"},children:""})]})}),i.jsx("tbody",{children:(he?.items||[]).map((te,ye)=>i.jsxs("tr",{children:[i.jsx("td",{children:te?.name||"-"}),i.jsx("td",{style:{textAlign:"right"},children:te?.unitPrice!=null?`${Math.round(te.unitPrice).toLocaleString()}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:te?.deliveryQty!=null?te.deliveryQty:"-"}),i.jsx("td",{children:te?.deliveryUnit||"-"})]},`${te?.no||ye}`))})]})]},`${he?.slipNo||I}`))]}):i.jsx("div",{style:{opacity:.8},children:""})}),i.jsx(pn,{isOpen:!!M,onClose:()=>T(null),title:"",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsxs("p",{style:{marginTop:0},children:["",M?.baseName,""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>T(null),disabled:H,children:""}),i.jsx(re,{variant:"danger",onClick:J,disabled:H,children:H?"":""})]})]})})]})},Rs="app-data",Mk="incoming-stock",zk="stock.json",Uk="applied",Wi=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},nl=n=>String(n||"").trim(),Ji=(n,t,s)=>`${String(s||"").trim()}@@${nn(n)}@@${nl(t)}`,If=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===404)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("not found")||a.includes("object not found")},Lk=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===409)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("already exists")||a.includes("duplicate")||a.includes("409")},Ik=n=>{const t=new Map;return(n?.slips||n?.receipts||[]).forEach(a=>{const o=String(a?.vendor||"").trim();(a?.items||[]).forEach(u=>{const d=String(u?.name||"").trim();if(!d)return;const h=nl(u?.deliveryUnit||u?.unit||u?.unitName||""),f=Wi(u?.deliveryQty??u?.quantity??u?.qty);if(f==null)return;const m=Ji(d,h,o),y=t.get(m);y?y.quantity+=f:t.set(m,{vendor:o,name:d,unit:h,quantity:f})})}),Array.from(t.values()).filter(a=>Number.isFinite(a.quantity))},Bk=(n,t,s)=>{const a=new Map;return(n||[]).forEach(o=>{const u=String(o?.name||"").trim();if(!u)return;const d=nl(o?.unit||""),h=String(o?.vendor||"").trim(),f=Wi(o?.quantity)??0;a.set(Ji(u,d,h),{vendor:h,name:u,unit:d,quantity:f,updatedAt:o?.updatedAt||null})}),t.forEach(o=>{const u=Ji(o.name,o.unit,o.vendor),d=a.get(u);d?(d.quantity=Math.max(0,(Wi(d.quantity)??0)+(Wi(o.quantity)??0)),d.updatedAt=s):a.set(u,{vendor:o.vendor,name:o.name,unit:nl(o.unit),quantity:Math.max(0,Wi(o.quantity)??0),updatedAt:s})}),Array.from(a.values()).sort((o,u)=>o.vendor!==u.vendor?o.vendor.localeCompare(u.vendor,"ja"):o.name!==u.name?o.name.localeCompare(u.name,"ja"):String(o.unit||"").localeCompare(String(u.unit||""),"ja"))},As={async _getCurrentUserId(){const{data:n,error:t}=await Te.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${Mk}`},_stockPath(n){return`${this._folderPath(n)}/${zk}`},_appliedFolder(n){return`${this._folderPath(n)}/${Uk}`},_appliedMarkerPath(n,t){const s=this._appliedFolder(n),a=String(t||"").trim();if(!a)throw new Error("baseName is required");return`${s}/${a}.json`},async listAppliedBaseNames(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Set;const s=this._appliedFolder(t),{data:a,error:o}=await Te.storage.from(Rs).list(s,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(o)return If(o)?new Set:(console.error("Failed to list applied markers:",o),new Set);const u=new Set;return(a||[]).forEach(d=>{const h=String(d?.name||"");h.toLowerCase().endsWith(".json")&&u.add(h.replace(/\.json$/i,""))}),u},async loadStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const s=this._stockPath(t),{data:a,error:o}=await Te.storage.from(Rs).createSignedUrl(s,60);if(o){if(If(o))return{_meta:{version:1,updatedAt:null},items:[]};throw o}try{const u=await fetch(a.signedUrl,{cache:"no-store"});if(!u.ok){if(u.status===404)return{_meta:{version:1,updatedAt:null},items:[]};throw new Error(`Failed to fetch stock: ${u.status} ${u.statusText}`)}const d=await u.text(),h=JSON.parse(d||"{}"),f=Array.isArray(h?.items)?h.items:[];return{_meta:{version:1,updatedAt:h?._meta?.updatedAt||null},items:f}}catch(u){throw console.warn("loadStock fetch failed",u),u}},async saveStock(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._stockPath(s),o={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(n?.items)?n.items:[]},{error:u}=await Te.storage.from(Rs).upload(a,new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(u)throw u;return o},async applyDeliverySet({baseName:n,parsed:t},s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("baseName ");if(!t)throw new Error("");const u=Ik(t),d=new Date().toISOString(),h=this._appliedMarkerPath(a,o),f={baseName:o,appliedAt:d,slipCount:(t?.slips||t?.receipts||[]).length||0,itemCount:u.length},m=await Te.storage.from(Rs).upload(h,new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(m.error){if(Lk(m.error))return{status:"already_applied"};throw m.error}try{const y=await this.loadStock(a),v=Bk(y.items||[],u,d);return await this.saveStock({items:v},a),{status:"applied",addedCount:u.length}}catch(y){try{await Te.storage.from(Rs).remove([h])}catch{}throw y}},async updateStockItem({name:n,unit:t,vendor:s,delta:a},o=null){const u=o||await this._getCurrentUserId();if(!u)throw new Error("");const d=String(n||"").trim();if(!d)throw new Error("");const h=nl(t),f=String(s||"").trim(),m=Ji(d,h,f),y=Wi(a);if(y===null||!Number.isFinite(y))throw new Error("");const x=(await this.loadStock(u)).items||[],w=new Date().toISOString();let _=!1;const E=x.map(j=>{if(Ji(j.name,j.unit,j.vendor)===m){_=!0;const k=Math.max(0,(Wi(j.quantity)??0)+y);return{...j,quantity:k,updatedAt:w}}return j});if(!_)throw new Error("");return await this.saveStock({items:E},u),{status:"updated",name:d,unit:h}},async deleteStockItem({name:n,unit:t,vendor:s},a=null){const o=a||await this._getCurrentUserId();if(!o)throw new Error("");const u=String(n||"").trim();if(!u)throw new Error("");const d=nl(t),h=String(s||"").trim(),f=Ji(u,d,h),y=(await this.loadStock(o)).items||[],v=y.filter(x=>Ji(x.name,x.unit,x.vendor)!==f);return v.length,y.length,await this.saveStock({items:v},o),{status:"deleted",name:u}},async clearStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const s=this._stockPath(t),a={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await Te.storage.from(Rs).upload(s,new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const o=this._appliedFolder(t),{data:u}=await Te.storage.from(Rs).list(o,{limit:1e3});if(u?.length){const d=u.map(h=>`${o}/${h.name}`);await Te.storage.from(Rs).remove(d)}return{status:"cleared"}},async deleteAppliedMarker(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._appliedMarkerPath(s,n),{error:o}=await Te.storage.from(Rs).remove([a]);if(o){if(If(o))return{status:"not_found"};throw o}return{status:"deleted"}}},yb=n=>`planner_data_${n}`,fo=n=>{try{if(!n)return{};let t=localStorage.getItem(yb(n));return t?JSON.parse(t):{}}catch{return{}}},mu=(n,t)=>{n&&localStorage.setItem(yb(n),JSON.stringify(t))},Wa={getAll:async n=>fo(n),cleanupInvalidPlans:async(n,t)=>{const s=fo(n);let a=!1;const o=new Set(t);return Object.keys(s).forEach(u=>{const d=s[u].length;s[u]=s[u].filter(h=>o.has(h.recipeId)),s[u].length!==d&&(a=!0),s[u].length===0&&(delete s[u],a=!0)}),a&&mu(n,s),s},addMeal:async(n,t,s,a)=>{const o=fo(n);o[t]||(o[t]=[]);const u={id:Date.now().toString(),recipeId:s,type:a,note:""};return o[t].push(u),mu(n,o),u},removeMeal:async(n,t,s)=>{const a=fo(n);a[t]&&(a[t]=a[t].filter(o=>o.id!==s),a[t].length===0&&delete a[t],mu(n,a))},updateMeal:async(n,t,s,a)=>{const o=fo(n);if(o[t]){const u=o[t].findIndex(d=>d.id===s);u!==-1&&(o[t][u]={...o[t][u],...a},mu(n,o))}}},rl=n=>(n??"").toString().trim(),vb=n=>{const t=rl(n);if(!t)return"";const s=t.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s},$k=n=>{const t=rl(n);return t?["","","","","","","","PC","pc",""].includes(t):!1},gu=(n,t)=>{const s=parseFloat(n)||0,a=vb(t);return a==="kg"?{qty:s*1e3,unit:"g"}:a==="g"?{qty:s,unit:"g"}:a==="l"?{qty:s*1e3,unit:"ml"}:a==="cc"?{qty:s,unit:"ml"}:a==="ml"?{qty:s,unit:"ml"}:{qty:s,unit:rl(t)||""}},Ix=(n,t,s,a)=>{const o=rl(s),u=parseFloat(t)||0;if(!a)return gu(u,o);const d=parseFloat(a.packetSize),h=vb(a.packetUnit);if(!Number.isFinite(d)||d<=0||!h)return gu(u,o);if(["g","kg","ml","cc","l"].includes(h)&&$k(o)){const m=u*d;return gu(m,h)}return gu(u,o)},xb={async calculateShortages(n,t,s){if(!n?.id)throw new Error("User required");const a=await Wa.getAll(n.id),o=new Date(t),u=new Date(s);u.setHours(23,59,59,999);const d=[];if(Object.keys(a).forEach(k=>{const O=new Date(k);O>=o&&O<=u&&a[k].forEach(U=>{d.push(U.recipeId)})}),d.length===0)return[];const[h,f,m,y,v]=await Promise.all([bn.fetchRecipes(n),Pn.getAllConversions(),nr.fetchPriceList(n.id),er.getAll(n.id),Uu.getAll(n.id)]),x=d.map(k=>h.find(O=>O.id===k)).filter(Boolean),w=new Map;try{for(const[k,O]of(f||new Map).entries()){const U=nn(k);U&&(w.has(U)||w.set(U,O))}}catch{}const _=new Map;try{for(const[k,O]of(v||new Map).entries()){const U=nn(k);U&&(_.has(U)||_.set(U,O))}}catch{}const E=new Map;try{(y||[]).forEach(k=>{const O=nn(k?.name);O&&(E.has(O)||E.set(O,k))})}catch{}const j={};return x.forEach(k=>{[...k.ingredients||[],...k.flours||[],...k.breadIngredients||[]].forEach(D=>{if(!D.name)return;const C=rl(D.name),M=nn(C),T=(M?w.get(M):null)||f?.get(C)||null,H=Ix(C,D.quantity,D.unit,T),K=H.qty||0,F=H.unit||"";j[C]||(j[C]={quantity:0,unit:F,count:0}),j[C].quantity+=K})}),Object.keys(j).map(k=>{const O=j[k],U=nn(k),D=(U?w.get(U):null)||f?.get(k)||null,C=U&&m?.get(U)||null,M=U&&E.get(U)||null,T=Ix(k,M?.quantity??0,M?.unit??O.unit,D),H=O.quantity||0,K=T.qty||0,F=O.unit||T.unit||"",q=K-H,V=parseFloat(D?.packetSize),P=rl(D?.packetUnit),L=Number.isFinite(V)&&V>0&&!!P,A=L?V*.2:0,$=L?q<A:!1,Y=C?.unit?String(C.unit).trim():"",le=U&&_.has(U)?String(_.get(U)).trim():"",me=le||""||Y||""||"",B=(D?.lastPrice!==null&&D?.lastPrice!==void 0&&D?.lastPrice!==""?parseFloat(D.lastPrice):null)??(C?.price!==null&&C?.price!==void 0?parseFloat(C.price):null);let W=null,J=0,ge=F;if(L){const Re=Math.max(0,A-q);W=Math.ceil(Re/V),$&&W<1&&(W=1),J=W,ge=me}else J=Math.max(0,H-K),ge=F;const ze=L?$:J>.01;return{name:k,required:H,stock:K,remaining:q,unit:F,shouldShow:ze,toOrder:J,orderUnit:ge,orderPacks:W,packSize:L?V:null,packUnit:L?P:null,packPrice:Number.isFinite(B)?B:null,vendor:C?.vendor||M?.vendor||""}}).filter(k=>k.shouldShow)}},yu=n=>String(n||"").replace(/\.json$/i,""),Pk=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${s}/${a}/${o} ${u}:${d}`},qk=({onBack:n})=>{const{user:t}=es(),[s,a]=Io(),[o,u]=be.useState(!0),[d,h]=be.useState(""),[f,m]=be.useState([]),[y,v]=be.useState(new Set),[x,w]=be.useState({items:[]}),[_,E]=be.useState([]),[j,N]=be.useState(null),[k,O]=be.useState("need_order"),[U,D]=be.useState(!1),[C,M]=be.useState(null),[T,H]=be.useState(""),[K,F]=be.useState(!1),q=be.useCallback(async()=>{u(!0),h("");try{const ke=new Date,Ae=new Date(ke);Ae.setDate(ke.getDate()+7);const[it,Mt,yt,ie]=await Promise.all([Jr.listJsonFiles(),As.listAppliedBaseNames(),As.loadStock(),t?.id?xb.calculateShortages(t,ke.toISOString(),Ae.toISOString()):Promise.resolve([])]);m(it||[]),v(Mt||new Set),w(yt||{items:[]}),E(ie||[])}catch(ke){console.error(ke),h(ke?.message||String(ke))}finally{u(!1)}},[t]);be.useEffect(()=>{q()},[q]);const V=be.useMemo(()=>{const ke=new Map;return(_||[]).forEach(Ae=>{const it=`${Ae.vendor||""}@@${Ae.name}@@${Ae.unit||""}`;ke.set(it,{...Ae,quantity:Ae.stock,isShortage:!0,reason:` (: ${Ae.required.toFixed(1)}${Ae.unit})`})}),(x?.items||[]).forEach(Ae=>{if((Ae.quantity||0)<=0){const it=`${Ae.vendor||""}@@${Ae.name}@@${Ae.unit||""}`;ke.has(it)||ke.set(it,{...Ae,isShortage:!1})}}),Array.from(ke.values()).sort((Ae,it)=>Ae.isShortage!==it.isShortage?Ae.isShortage?-1:1:(Ae.vendor||"").localeCompare(it.vendor||""))},[_,x]),P=async ke=>{const Ae=yu(ke);N(Ae),h("");try{const it=await Jr.downloadJson(ke);(await As.applyDeliverySet({baseName:Ae,parsed:it}))?.status==="already_applied"&&h("PDF"),await q()}catch(it){console.error(it),h(it?.message||String(it))}finally{N(null)}},L=async()=>{N("all"),h("");try{const ke=await Jr.listJsonFiles(),Ae=await As.listAppliedBaseNames();for(const it of ke||[]){const Mt=it?.name;if(!Mt)continue;const yt=yu(Mt);if(Ae.has(yt))continue;const ie=await Jr.downloadJson(Mt);(await As.applyDeliverySet({baseName:yt,parsed:ie}))?.status==="applied"&&Ae.add(yt)}await q()}catch(ke){console.error(ke),h(ke?.message||String(ke))}finally{N(null)}},A=ke=>{M(ke),H(""),D(!0),h("")},$=ke=>{H(Ae=>{const Mt=(parseFloat(Ae)||0)+ke;return String(Math.round(Mt*1e3)/1e3)})},Y=async()=>{if(!C)return;const ke=Number(T);if(!T||isNaN(ke)||ke<=0){h("");return}F(!0),h("");try{await As.updateStockItem({name:C.name,unit:C.unit,vendor:C.vendor,delta:-ke}),await q(),D(!1),M(null)}catch(Ae){console.error(Ae),h(Ae?.message||String(Ae))}finally{F(!1)}},[le,me]=be.useState(!1),[B,W]=be.useState(null),[J,ge]=be.useState(!1),[ze,Re]=be.useState(!1),[he,I]=be.useState(!1),te=ke=>{W(ke),me(!0),h("")},ye=async()=>{if(B){ge(!0),h("");try{await As.deleteStockItem({name:B.name,unit:B.unit,vendor:B.vendor}),await q(),me(!1),W(null)}catch(ke){console.error(ke),h(": "+(ke.message||String(ke)))}finally{ge(!1)}}},[Ne,Oe]=be.useState(!1),[qe,$e]=be.useState(null),[Je,pe]=be.useState(!1),Xe=ke=>{const Ae=yu(ke.name);$e({name:ke.name,baseName:Ae}),Oe(!0),h("")},ot=async()=>{if(qe){pe(!0),h("");try{await Jr.deleteDeliverySet(qe.baseName),await As.deleteAppliedMarker(qe.baseName),await q(),Oe(!1),$e(null)}catch(ke){console.error(ke),h("PDF: "+(ke.message||String(ke)))}finally{pe(!1)}}},jt=async()=>{I(!0),h("");try{await As.clearStock(),await q(),Re(!1)}catch(ke){console.error(ke),h(": "+(ke.message||String(ke)))}finally{I(!1)}};return i.jsxs("div",{className:"incoming-stock",children:[i.jsxs("div",{className:"incoming-stock__header",children:[i.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx(re,{variant:"secondary",onClick:()=>a({view:"incoming-deliveries"}),children:" PDF"}),i.jsx(re,{variant:"ghost",onClick:n,children:" "})]})]}),d&&i.jsx(tn,{className:"incoming-stock__error",children:d}),i.jsxs(tn,{className:"incoming-stock__card",children:[i.jsxs("div",{className:"incoming-stock__card-head",children:[i.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[i.jsx(re,{variant:"secondary",onClick:q,disabled:o||!!j,children:""}),i.jsx(re,{variant:"primary",onClick:L,disabled:o||!!j,children:j==="all"?"":""}),i.jsx(re,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:()=>Re(!0),disabled:o||!!j||!x?.items?.length,children:" "})]})]}),o?i.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):f.length===0?i.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):i.jsx("div",{className:"incoming-stock__file-list",children:f.map(ke=>{const Ae=yu(ke?.name),it=y.has(Ae);return i.jsxs("div",{className:"incoming-stock__file-row",children:[i.jsxs("div",{className:"incoming-stock__file-info",children:[i.jsx("div",{style:{fontWeight:700},children:Ae}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",Pk(ke.updated_at||ke.created_at)]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[it?i.jsx("span",{className:"incoming-stock__badge",children:""}):i.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),i.jsx(re,{variant:it?"secondary":"primary",size:"sm",onClick:()=>P(ke.name),disabled:!!j||it,children:j===Ae?"":it?"":""}),i.jsx(re,{variant:"ghost",size:"sm",style:{color:"#d32f2f",marginLeft:"4px"},onClick:()=>Xe(ke),disabled:!!j,title:"PDF",children:""})]})]},ke.name)})}),!o&&i.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",i.jsx("strong",{children:y.size}),"  / PDF: ",i.jsx("strong",{children:f.length})," "]})]}),i.jsxs(tn,{className:"incoming-stock__card",children:[i.jsx("div",{className:"incoming-stock__card-head",children:i.jsx("h3",{className:"incoming-stock__section-title",children:""})}),i.jsxs("div",{className:"incoming-stock__tabs",children:[i.jsxs("button",{className:`incoming-stock__tab-button ${k==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>O("need_order"),children:[" ",i.jsx("span",{className:"incoming-stock__tab-count",children:V.length})]}),Array.from(new Set((x?.items||[]).map(ke=>ke.vendor||""))).sort().map(ke=>i.jsx("button",{className:`incoming-stock__tab-button ${k===ke?"incoming-stock__tab-button--active":""}`,onClick:()=>O(ke),children:ke},ke))]}),(()=>{let ke=[];if(k==="need_order")ke=V;else{const Ae=k===""?"":k;ke=(x?.items||[]).filter(it=>(it.vendor||"")===Ae)}return ke.length===0?i.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:k==="need_order"?"0":""}):i.jsx("div",{className:"incoming-stock__table-wrap",children:i.jsxs("table",{className:"incoming-stock__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"45%"},children:"/"}),i.jsx("th",{style:{width:"25%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"10%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),i.jsx("tbody",{children:ke.map(Ae=>i.jsxs("tr",{style:Ae.isShortage?{backgroundColor:"#fff5f5"}:{},children:[i.jsxs("td",{children:[i.jsxs("div",{style:{fontWeight:500},children:[Ae.name,Ae.isShortage&&i.jsx("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#d32f2f",border:"1px solid #d32f2f",borderRadius:"4px",padding:"1px 4px",verticalAlign:"middle"},children:""})]}),Ae.reason&&i.jsxs("div",{style:{fontSize:"0.8rem",color:"#d32f2f",marginTop:"2px"},children:[Ae.reason,"  : ",Ae.toOrder,Ae.orderUnit]}),!Ae.reason&&k==="need_order"&&Ae.vendor&&i.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:Ae.vendor})]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(Ae.quantity||0)<=0||Ae.isShortage?"#d32f2f":"inherit"},children:Number.isFinite(Ae.quantity)?Ae.quantity:"-"}),i.jsx("td",{children:Ae.unit||"-"}),i.jsx("td",{style:{textAlign:"center"},children:i.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[i.jsx(re,{variant:"secondary",size:"sm",onClick:()=>A(Ae),children:"/"}),i.jsx(re,{variant:"ghost",size:"sm",style:{color:"#d32f2f"},onClick:()=>te(Ae),children:""})]})})]},`${Ae.vendor}@@${Ae.name}@@${Ae.unit||""}`))})]})})})()]}),i.jsx(pn,{isOpen:U,onClose:()=>D(!1),title:"",children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsx("div",{style:{fontWeight:"bold"},children:C?.name})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsxs("div",{children:[C?.quantity," ",C?.unit]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsx(Ut,{type:"text",inputMode:"decimal",value:T,onChange:ke=>H(ke.target.value),readOnly:!0,placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px",textAlign:"center",backgroundColor:"#f9f9f9",cursor:"default"}}),i.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:C?.unit})]}),i.jsxs("div",{className:"incoming-stock__calc-grid",children:[i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>$(.001),children:"+0.001"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>$(.01),children:"+0.01"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>$(.1),children:"+0.1"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>$(.5),children:"+0.5"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>$(1),children:"+1"}),i.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>H(""),children:""})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>D(!1),disabled:K,children:""}),i.jsx(re,{variant:"primary",onClick:Y,disabled:K||!T,children:K?"":""})]})]})}),i.jsx(pn,{isOpen:le,onClose:()=>me(!1),title:"",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsxs("p",{style:{marginTop:0},children:["",B?.name,"",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.85rem",color:"#666"},children:""})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>me(!1),disabled:J,children:""}),i.jsx(re,{variant:"danger",onClick:ye,disabled:J,children:J?"":""})]})]})}),i.jsx(pn,{isOpen:Ne,onClose:()=>Oe(!1),title:"PDF",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsxs("p",{style:{marginTop:0},children:["",qe?.baseName,""]}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["",i.jsx("strong",{children:""}),"",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>Oe(!1),disabled:Je,children:""}),i.jsx(re,{variant:"danger",onClick:ot,disabled:Je,children:Je?"":""})]})]})}),i.jsx(pn,{isOpen:ze,onClose:()=>Re(!1),title:"",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsx("p",{style:{marginTop:0,fontWeight:"bold",color:"#d32f2f"},children:""}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["PDF",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>Re(!1),disabled:he,children:""}),i.jsx(re,{variant:"danger",onClick:jt,disabled:he,children:he?"":""})]})]})}),i.jsx(pn,{isOpen:!!j,onClose:()=>{},title:"",size:"small",showCloseButton:!1,children:i.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[i.jsx("div",{className:"incoming-stock__spinner"}),i.jsx("p",{style:{margin:"0 0 8px",fontWeight:"bold"},children:"PDF..."}),i.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",margin:0},children:[j==="all"?"":"",i.jsx("br",{}),""]})]})})]})},Fk=({recipe:n})=>{const{attributes:t,listeners:s,setNodeRef:a,transform:o}=bp({id:`recipe-${n.id}`,data:{recipe:n}}),u=o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:a,style:u,...s,...t,className:"draggable-recipe",children:n.title})},Hk=({meal:n,dateStr:t,children:s})=>{const{attributes:a,listeners:o,setNodeRef:u,transform:d}=bp({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),h=d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:u,style:h,...o,...a,className:"draggable-meal-wrapper",children:s})},Gk=({dateStr:n,dayNum:t,isToday:s,isOutside:a,children:o})=>{const{setNodeRef:u,isOver:d}=Go({id:`date-${n}`,data:{dateStr:n}});return i.jsxs("div",{ref:u,className:`calendar-cell ${s?"today":""} ${a?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[i.jsx("div",{className:"day-number",children:t}),o]})},Vk=({onBack:n,onSelectRecipe:t})=>{const{user:s}=es(),a=ea(),[o,u]=b.useState([]),[d,h]=b.useState({}),[f,m]=b.useState(new Date),[y,v]=b.useState(""),[x,w]=b.useState(!1),[_,E]=b.useState(null),j=ll(gr(Hu,{activationConstraint:{distance:8}})),N=b.useCallback(async()=>{const K=await bn.fetchRecipes(s);if(u(K),s?.id){const F=K.map(V=>V.id),q=await Wa.cleanupInvalidPlans(s.id,F);h(q)}},[s]);b.useEffect(()=>{const K=setTimeout(()=>{N()},0);return()=>clearTimeout(K)},[N]);const k=async K=>{const{active:F,over:q}=K;if(q&&q.id.startsWith("date-")){const V=q.data.current.dateStr;if(F.id.startsWith("recipe-")){const P=F.data.current.recipe;await Wa.addMeal(s.id,V,P.id,"dinner"),N()}else if(F.id.startsWith("meal-")){const{meal:P,dateStr:L}=F.data.current;if(L===V)return;await Wa.addMeal(s.id,V,P.recipeId,P.type||"dinner"),await Wa.removeMeal(s.id,L,P.id),N()}}},O=async(K,F,q)=>{q&&q.stopPropagation(),E({dateStr:K,mealId:F}),w(!0)},U=async()=>{if(!_)return;const{dateStr:K,mealId:F}=_;w(!1),E(null);try{await Wa.removeMeal(s.id,K,F),await N(),a.success("")}catch(q){a.error(""),console.error("Delete meal error:",q)}},D=()=>{w(!1),E(null)},C=()=>{const K=f.getFullYear(),F=f.getMonth(),q=new Date(K,F,1),V=new Date(K,F+1,0),P=[],L=q.getDay();for(let $=L-1;$>=0;$--){const Y=new Date(K,F,-$);P.push({date:Y,isOutside:!0})}for(let $=1;$<=V.getDate();$++){const Y=new Date(K,F,$);P.push({date:Y,isOutside:!1})}const A=42-P.length;for(let $=1;$<=A;$++){const Y=new Date(K,F+1,$);P.push({date:Y,isOutside:!0})}return P},M=K=>`${K.getFullYear()}-${String(K.getMonth()+1).padStart(2,"0")}-${String(K.getDate()).padStart(2,"0")}`,T=o.filter(K=>K.title.toLowerCase().includes(y.toLowerCase())),H=K=>{m(new Date(f.getFullYear(),f.getMonth()+K,1))};return i.jsxs("div",{className:"planner-container fade-in",children:[x&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("strong",{children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(re,{variant:"ghost",onClick:D,children:""}),i.jsx(re,{variant:"danger",onClick:U,children:""})]})]})}),i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(re,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx(Xi,{onDragEnd:k,sensors:j,children:i.jsxs("div",{className:"planner-layout",children:[i.jsxs("div",{className:"recipe-sidebar",children:[i.jsx("div",{className:"sidebar-search",children:i.jsx(Ut,{placeholder:"...",value:y,onChange:K=>v(K.target.value)})}),i.jsx("div",{className:"draggable-list",children:T.map(K=>i.jsx(Fk,{recipe:K},K.id))})]}),i.jsxs("div",{className:"planner-calendar",children:[i.jsxs("div",{className:"calendar-header",children:[i.jsx(re,{variant:"ghost",onClick:()=>H(-1),children:" "}),i.jsxs("h3",{style:{margin:0},children:[f.getFullYear()," ",f.getMonth()+1,""]}),i.jsx(re,{variant:"ghost",onClick:()=>H(1),children:" "})]}),i.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(K=>i.jsx("div",{className:"calendar-day-header",children:K},K)),C().map((K,F)=>{const q=M(K.date),V=d[q]||[],P=q===M(new Date);return i.jsx(Gk,{dateStr:q,dayNum:K.date.getDate(),isToday:P,isOutside:K.isOutside,children:V.map(L=>{const A=o.find($=>$.id===L.recipeId);return i.jsx(Hk,{meal:L,dateStr:q,children:i.jsxs("div",{className:"planned-meal",title:A?.title,onClick:()=>A&&t&&t(A),children:[i.jsx("span",{children:A?.title||"Unknown"}),i.jsx("span",{className:"delete-meal-btn",onPointerDown:$=>{$.stopPropagation()},onClick:$=>O(q,L.id,$),children:""})]})},L.id)})},F)})]})]})]})})]})},Kk=({onBack:n})=>{const{user:t}=es(),s=ea(),[a,o]=b.useState(new Date().toISOString().slice(0,10)),[u,d]=b.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[h,f]=b.useState([]),[m,y]=b.useState(!1),[v,x]=b.useState(!1),[w,_]=b.useState(!1),[E,j]=b.useState(!1),N=async()=>{y(!0);try{if(!t?.id){s.error(""),y(!1);return}const C=await xb.calculateShortages(t,a,u);C.length,f(C),x(!0)}catch(C){console.error(C),s.error(": "+(C.message||String(C)))}finally{y(!1)}},k=()=>{_(!0)},O=()=>{j(!0)},U=()=>h.map(C=>{if(Number.isFinite(C.orderPacks)&&C.orderPacks!==null){const M=C.packSize&&C.packUnit?`1${C.orderUnit}=${C.packSize}${C.packUnit}`:"";return`${C.name}: ${C.orderPacks}${C.orderUnit}${M}`}return`${C.name}: ${Number(C.toOrder||0).toFixed(1)}${C.unit}`}).join(`
`),D=async()=>{const C=document.getElementById("copy-textarea");if(C){C.select();try{await navigator.clipboard.writeText(C.value),s.success("")}catch{document.execCommand("copy"),s.success("")}}};return i.jsxs("div",{className:"order-list-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(re,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx("div",{className:"filter-card",children:i.jsxs("div",{className:"date-range-inputs",children:[i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:a,onChange:C=>o(C.target.value)})]}),i.jsx("span",{children:""}),i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:u,onChange:C=>d(C.target.value)})]}),i.jsx(re,{variant:"primary",onClick:N,disabled:m,children:m?"...":""})]})}),v&&i.jsxs("div",{className:"order-results",children:[i.jsxs("div",{className:"results-header",children:[i.jsxs("h3",{children:[" (",h.length,")"]}),i.jsxs("div",{className:"result-actions",children:[i.jsx(re,{variant:"secondary",onClick:k,children:" "}),i.jsx(re,{variant:"secondary",onClick:O,children:" "})]})]}),i.jsxs("table",{className:"order-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:h.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):h.map((C,M)=>i.jsxs("tr",{children:[i.jsx("td",{children:C.name}),i.jsxs("td",{style:{textAlign:"right"},children:[C.required.toFixed(1)," ",C.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,C.remaining??0).toFixed(1)," ",C.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(C.orderPacks)&&C.orderPacks!==null?i.jsxs(i.Fragment,{children:[C.orderPacks,C.orderUnit,C.packSize&&C.packUnit&&i.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",C.orderUnit," = ",Number(C.packSize).toLocaleString(),C.packUnit,C.packPrice?` / ${Math.round(C.packPrice).toLocaleString()}`:""]})]}):i.jsxs(i.Fragment,{children:[C.toOrder.toFixed(1)," ",i.jsx("span",{style:{fontSize:"0.8em"},children:C.unit})]})})]},M))})]})]}),i.jsx(pn,{isOpen:w,onClose:()=>_(!1),title:" ",size:"medium",children:i.jsxs("div",{className:"copy-modal-content",children:[i.jsx("p",{className:"copy-instructions",children:""}),i.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:U(),onClick:C=>C.target.select()}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(re,{variant:"primary",onClick:D,children:" "}),i.jsx(re,{variant:"ghost",onClick:()=>_(!1),children:""})]})]})}),i.jsx(pn,{isOpen:E,onClose:()=>j(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-content",children:[i.jsxs("div",{className:"print-preview-header",children:[i.jsx("h3",{children:""}),i.jsxs("p",{className:"print-period",children:[": ",a,"  ",u]})]}),i.jsxs("table",{className:"print-preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:h.map((C,M)=>i.jsxs("tr",{children:[i.jsx("td",{children:C.name}),i.jsxs("td",{style:{textAlign:"right"},children:[C.required.toFixed(1)," ",C.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,C.remaining??0).toFixed(1)," ",C.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(C.orderPacks)&&C.orderPacks!==null?`${C.orderPacks}${C.orderUnit}`:`${C.toOrder.toFixed(1)} ${C.unit}`})]},M))})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(re,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(re,{variant:"ghost",onClick:()=>j(!1),children:""})]})]})})]})},po=async(n,t,s)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},Bx=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},Yk=({children:n})=>{const[t,s]=b.useState(null),[a,o]=b.useState(!0),[u,d]=b.useState(!1),h=b.useCallback(async j=>{if(!j){s(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const N=j.id,k=j.email||"";try{const F=localStorage.getItem("auth_user_cache");if(F){const q=JSON.parse(F);q&&q.id===N&&s(q)}}catch(F){console.warn("[Auth] Failed to load cache",F)}let O=null,U=0;const D=3;for(;U<D;)try{const[F,q]=await Promise.all([po(Te.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",N).single().then(L=>({data:L,error:null})).catch(L=>({data:null,error:L})),2500,"profiles.select(with_email)").catch(L=>({data:null,error:L})),po(Te.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",N).single().then(L=>({data:L,error:null})).catch(L=>({data:null,error:L})),2500,"profiles.select").catch(L=>({data:null,error:L}))]);let V=null,P=null;if(F?.data?.data?(V=F.data.data,P=null):q?.data?.data?(V=q.data.data,P=null):P=F?.error??q?.error??new Error("Profile fetch failed"),P)if(P.code==="PGRST116"){const L=j.user_metadata&&j.user_metadata.display_id?String(j.user_metadata.display_id):Bx(k)||N.slice(0,8);let A=null,$=null;const Y=await po(Te.from("profiles").insert([{id:N,display_id:L,email:k||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),8e3,"profiles.insert(with_email)");if(A=Y?.data??null,$=Y?.error??null,$&&String($.message||"").toLowerCase().includes("email")){const le=await po(Te.from("profiles").insert([{id:N,display_id:L,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),8e3,"profiles.insert");A=le?.data??null,$=le?.error??null}if($)throw $;O=A}else throw P;else O=V;if(O&&Object.prototype.hasOwnProperty.call(O,"email")&&k&&!O.email)try{await Te.from("profiles").update({email:k}).eq("id",N)}catch(L){console.warn("Failed to backfill profile email",L)}break}catch(F){console.error(`Failed to load/create profile (Attempt ${U+1}/${D}):`,F),U++,U<D&&await new Promise(q=>setTimeout(q,500*U))}const C=O?.display_id||Bx(k)||N.slice(0,8),M=O?.role||"user",T=String(M).trim().toLowerCase(),H=O?.show_master_recipes===!0,K={id:N,email:k,displayId:C,role:T,showMasterRecipes:H};s(K);try{localStorage.setItem("auth_user_cache",JSON.stringify(K))}catch(F){console.warn("[Auth] Failed to save cache",F)}},[]);b.useEffect(()=>{let j=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:N}=Te.auth.onAuthStateChange(async(O,U)=>{O==="PASSWORD_RECOVERY"&&d(!0);try{await h(U?.user||null)}catch(D){console.error("Auth state change handler failed:",D)}});return j=N?.subscription,(async()=>{try{const{data:O}=await po(Te.auth.getSession(),5e3,"auth.getSession");await h(O?.session?.user||null)}catch(O){console.error("Auth init failed:",O)}finally{o(!1)}})(),()=>{try{j?.unsubscribe?.()}catch{}}},[h]);const f=b.useCallback(async(j,N)=>{const{error:k}=await Te.auth.signInWithPassword({email:j,password:N});if(k)throw console.error("Login error:",k),new Error("")},[]),m=b.useCallback(async(j,N,k)=>{const{data:O,error:U}=await Te.auth.signUp({email:j,password:N,options:{data:{display_id:k}}});if(U)throw console.error("SignUp error:",U),new Error(U.message||"");const D=O?.user;if(D?.id){let C=null;C=(await Te.from("profiles").insert([{id:D.id,display_id:k,email:j||null,role:"user",show_master_recipes:!1}]))?.error??null,C&&String(C.message||"").toLowerCase().includes("email")&&(C=(await Te.from("profiles").insert([{id:D.id,display_id:k,role:"user",show_master_recipes:!1}]))?.error??null),C&&C.code!=="23505"&&console.error("Profile create error:",C)}return{needsEmailConfirmation:!O?.session}},[]),y=b.useCallback(async()=>{await Te.auth.signOut(),s(null),d(!1)},[]),v=b.useCallback(j=>{!j||typeof j!="object"||s(N=>N&&{...N,...j})},[]),x=b.useCallback(async j=>{const{error:N}=await Te.auth.resetPasswordForEmail(j,{redirectTo:window.location.origin});if(N)throw console.error("Password reset email error:",N),new Error("");return!0},[]),w=b.useCallback(async j=>{const{error:N}=await Te.auth.updateUser({password:j});if(N)throw console.error("Update password error:",N),new Error("");return!0},[]),_=b.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),E=b.useMemo(()=>({user:t,loading:a,login:f,register:m,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:w,finishPasswordRecovery:_}),[t,a,f,m,y,v,x,u,w,_]);return i.jsx(nb.Provider,{value:E,children:n})},Qk=({id:n,message:t,type:s="info",onClose:a})=>{b.useEffect(()=>{const u=setTimeout(()=>{a(n)},3e3);return()=>clearTimeout(u)},[n,a]);const o=()=>{switch(s){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return i.jsxs("div",{className:`toast toast-${s}`,children:[i.jsx("div",{className:"toast-icon",children:o()}),i.jsx("div",{className:"toast-message",children:t}),i.jsx("button",{className:"toast-close",onClick:()=>a(n),"aria-label":"",children:""})]})},Wk=({toasts:n,onRemove:t})=>n.length===0?null:i.jsx("div",{className:"toast-container",children:n.map(s=>i.jsx(Qk,{id:s.id,message:s.message,type:s.type,onClose:t},s.id))}),Jk=({children:n})=>{const[t,s]=b.useState([]),a=b.useCallback((d,h="info")=>{const f=Date.now()+Math.random();s(m=>[...m,{id:f,message:d,type:h}].slice(-5))},[]),o=b.useCallback(d=>{s(h=>h.filter(f=>f.id!==d))},[]),u={showToast:a,success:d=>a(d,"success"),error:d=>a(d,"error"),warning:d=>a(d,"warning"),info:d=>a(d,"info")};return i.jsxs(rb.Provider,{value:u,children:[n,i.jsx(Wk,{toasts:t,onRemove:o})]})},Xk=()=>{const[n,t]=b.useState(!0),[s,a]=b.useState(!1),[o,u]=b.useState(""),[d,h]=b.useState(""),[f,m]=b.useState(""),[y,v]=b.useState(""),[x,w]=b.useState(""),[_,E]=b.useState(!1),[j,N]=b.useState(!1);be.useEffect(()=>{const T=localStorage.getItem("savedEmail"),H=localStorage.getItem("savedPassword");T&&(u(T),H&&h(H),N(!0))},[]);const{login:k,register:O,sendPasswordResetEmail:U}=es(),D=async T=>{T.preventDefault(),v(""),w(""),E(!0);try{await k(o.trim(),d),j?(localStorage.setItem("savedEmail",o.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(H){v(H.message||"")}finally{E(!1)}},C=async T=>{T.preventDefault(),v(""),w(""),E(!0);try{if(!f.trim()){v("ID: yoshito");return}(await O(o.trim(),d,f.trim()))?.needsEmailConfirmation?w(""):w(""),t(!0),h("")}catch(H){v(H.message||"")}finally{E(!1)}},M=async T=>{T.preventDefault(),v(""),w(""),E(!0);try{await U(o.trim()),w(""),a(!1)}catch(H){v(H.message||"")}finally{E(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(tn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[i.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",i.jsx("br",{}),"Management"]}),i.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:s?"":n?"":""})]}),y&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),i.jsxs("form",{onSubmit:s?M:n?D:C,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"email",value:o,onChange:T=>u(T.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:d,onChange:T=>h(T.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&!n&&i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",i.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),i.jsx("input",{type:"text",value:f,onChange:T=>m(T.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!s&&i.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[i.jsx("input",{type:"checkbox",id:"rememberMe",checked:j,onChange:T=>N(T.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),i.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),i.jsx(re,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:_,children:s?"":n?"":""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s?i.jsx("button",{type:"button",onClick:()=>{a(!1),v(""),w("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):i.jsx("button",{type:"button",onClick:()=>{a(!0),v(""),w("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!s&&i.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),w("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},Zk=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:s}=es(),[a,o]=be.useState(""),[u,d]=be.useState(""),[h,f]=be.useState(""),[m,y]=be.useState(""),[v,x]=be.useState(!1),w=async _=>{if(_.preventDefault(),f(""),y(""),!a||a.length<8){f("8");return}if(a!==u){f("");return}x(!0);try{await n(a),y(""),t()}catch(E){console.error(E),f(E.message||"")}finally{x(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(tn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),i.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),h&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:h}),m&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),i.jsxs("form",{onSubmit:w,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:a,onChange:_=>o(_.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:u,onChange:_=>d(_.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsx(re,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),i.jsx(re,{variant:"ghost",onClick:s,style:{flex:1},children:""})]})]})})},Bf=({label:n,subLabel:t,variant:s="screen",showLogo:a=!0})=>i.jsxs("div",{className:s==="screen"?"loading-screen":"loading-inline",children:[a&&i.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),i.jsxs("div",{className:"loading-text",children:[n,i.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[i.jsx("span",{children:"."}),i.jsx("span",{children:"."}),i.jsx("span",{children:"."})]})]}),i.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&i.jsx("div",{className:"loading-subtext",children:t})]});function eT(){const{user:n,logout:t,loading:s,isPasswordRecovery:a}=es(),o=ea(),[u,d]=Io(),[h,f]=b.useState([]),[m,y]=b.useState(!0),[v,x]=b.useState(0),[w,_]=b.useState([]),[E,j]=b.useState(!1),[N,k]=b.useState({}),[O,U]=b.useState({}),[D,C]=b.useState(!1),M=u.get("view"),T=(M==="create-mock"?"create":M)||"list",H=u.get("id"),K=h.find(G=>String(G.id)===H)||null,[F,q]=b.useState(null),[V,P]=b.useState(!1),[L,A]=b.useState(""),[$,Y]=b.useState(null),[le,me]=b.useState(null),[B,W]=b.useState(""),[J,ge]=b.useState("none"),[ze,Re]=b.useState(!1),[he,I]=b.useState(!1),[te,ye]=b.useState(new Set),[Ne,Oe]=b.useState("normal"),[qe,$e]=b.useState(!1),[Je,pe]=b.useState(!1),[Xe,ot]=b.useState(null),[jt,ke]=b.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),Ae={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};b.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const G=window.matchMedia("(max-width: 700px)"),Le=()=>ke(!!G.matches);return Le(),G.addEventListener?G.addEventListener("change",Le):G.addListener(Le),()=>{G.removeEventListener?G.removeEventListener("change",Le):G.removeListener(Le)}},[]),b.useEffect(()=>{if(!jt||!Ae[T]||typeof window>"u")return;const G=`pc-recommend-shown:${T}`;try{if(window.sessionStorage.getItem(G)==="1")return;window.sessionStorage.setItem(G,"1")}catch{}ot(T)},[T,jt]),b.useEffect(()=>{T!=="list"&&ge("none")},[T]),b.useEffect(()=>{if(!s){j(!1);return}const G=setTimeout(()=>j(!0),3500);return()=>clearTimeout(G)},[s]),b.useEffect(()=>{if(h.length>0||T==="trash")return;let G=n?.id;if(!G)try{G=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!G)return;const Le=bn.getCachedRecipes(G);Le&&Le.length>0&&(f(Le),C(!0),y(!1))},[n?.id]),b.useEffect(()=>{s||n&&(async()=>{try{const G=T==="trash"?bt():Ie();await Promise.all([G,Ee(),ie()])}catch(G){console.error("Error during initial data load:",G)}})()},[s,n?.id]),b.useEffect(()=>{if(s)return;if(!n||n.role!=="admin"){k({}),U({});return}let G=!1;return(async()=>{try{const Le=await Qi.fetchAllProfiles();if(G)return;const Ge={},Ct={};for(const Ue of Le||[])Ue?.id&&(Ge[String(Ue.id)]=Ue),Ue?.display_id&&(Ct[String(Ue.display_id)]=Ue);k(Ge),U(Ct)}catch(Le){console.warn("Failed to load profiles for admin owner labels",Le)}})(),()=>{G=!0}},[s,n?.id,n?.role]);const it=G=>{const Ge=(G?.tags||[]).find(ft=>ft&&ft.startsWith("owner:"));if(!Ge)return"/";const Ct=String(Ge.slice(6)),Ue=N[Ct]||O[Ct]||null;return Ue?Ue.display_id||Ue.email||Ct:Ct.length>12?`${Ct.slice(0,8)}`:Ct},Mt=ll(gr(qo,{activationConstraint:{distance:10}}),gr(Fo,{activationConstraint:{delay:1e3,tolerance:5}}),gr(cl,{coordinateGetter:Ku})),yt=G=>{const{active:Le,over:Ge}=G;Le.id!==Ge.id&&f(Ct=>{const Ue=Ct.findIndex(kt=>kt.id===Le.id),ft=Ct.findIndex(kt=>kt.id===Ge.id);if(Ue===-1||ft===-1)return Ct;const Ht=Zi(Ct,Ue,ft),En=Ht.map((kt,Vn)=>({id:kt.id,order_index:Vn}));return bn.updateOrder(En).catch(kt=>console.error("Order update failed",kt)),Ht})},ie=async()=>{try{const G=await bn.fetchRecentRecipes();_(G||[])}catch(G){console.error("Failed to load history:",G)}},_e=async G=>{const Le=[G,...w.filter(Ge=>Ge!==G)].slice(0,20);_(Le);try{await bn.addToHistory(G)}catch(Ge){console.error("Failed to sync history",Ge)}},Ee=async()=>{try{const G=await bn.getDeletedCount();x(G||0)}catch(G){console.error("Failed to load trash count:",G)}},Ie=async()=>{try{D||y(!0);const G=await bn.fetchRecipes(n,{timeoutMs:15e3,includeIngredients:!1,includeSources:!1});f(G||[])}catch(G){console.error("Failed to fetch recipes:",G),o.error(`

(${G?.message||"unknown error"})`)}finally{y(!1),C(!1)}},ct=G=>(G||"").toString().replace(/\s+/g," ").trim(),pt=G=>ct(G).toLowerCase(),Rt="__NO_STORE__",Jt="__OTHER_STORE__",Sn=[...new Set(h.map(G=>ct(G.course)).filter(Boolean))],_t=[...new Set(h.map(G=>ct(G.category)).filter(Boolean))],rn=h.reduce((G,Le)=>{const Ge=pt(Le.storeName);return Ge&&(G[Ge]=(G[Ge]||0)+1),G},{}),cn=new Set(Su.map(G=>pt(G)).filter(Boolean)),xn=h.reduce((G,Le)=>pt(Le.storeName)?G:G+1,0),Ln=h.reduce((G,Le)=>{const Ge=pt(Le.storeName);return Ge?cn.has(Ge)?G:G+1:G},0),ar=h.reduce((G,Le)=>{const Ge=pt(Le.course);return Ge&&(G[Ge]=(G[Ge]||0)+1),G},{}),fe=h.reduce((G,Le)=>{const Ge=pt(Le.category);return Ge&&(G[Ge]=(G[Ge]||0)+1),G},{}),Ve=h.filter(G=>{const Le=pt(L),Ge=L===""||L==="recent"&&w.includes(G.id)||G.tags&&G.tags.includes(L)||L===Rt&&!pt(G.storeName)||L===Jt&&pt(G.storeName)&&!cn.has(pt(G.storeName))||G.category&&pt(G.category)===Le||G.course&&pt(G.course)===Le||G.storeName&&pt(G.storeName)===Le,Ct=B.toLowerCase().trim(),Ue=!Ct||G.title.toLowerCase().includes(Ct)||G.description&&G.description.toLowerCase().includes(Ct)||G.ingredients&&G.ingredients.some(ft=>ft.name.toLowerCase().includes(Ct));return Ge&&Ue}),et=L===""&&!B.trim()&&T==="list",Ke=(G,Le={})=>{d({view:"detail",id:G.id,...Le})},nt=async(G,Le=!1)=>{try{if(G.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&G.tags.some(Ct=>Ct==="owner:yoshito")){o.warning("");return}Le?(await bn.restoreRecipe(G.id),(T==="trash"||T==="detail")&&(d({view:"trash"}),bt()),o.success("")):(await bn.deleteRecipe(G.id),f(h.filter(Ge=>Ge.id!==G.id)),d({view:"list"}),Ee())}catch(Ge){console.error("Failed to delete/restore recipe:",Ge),o.error("")}finally{Ee()}},zt=async G=>{try{await bn.hardDeleteRecipe(G.id),f(h.filter(Le=>Le.id!==G.id)),d({view:"trash"}),o.success(""),bt(),Ee()}catch(Le){console.error("Failed to hard delete recipe:",Le),o.error("")}},bt=async()=>{try{y(!0);const G=await bn.fetchDeletedRecipes();f(G||[]),A("")}catch(G){console.error("Failed to fetch deleted recipes:",G)}finally{y(!1)}},At=()=>{d({view:"trash"}),bt()},tt=()=>{d({view:"list"}),Ie()},$t=async(G,Le)=>{try{let Ge,Ct=Le;if(Le&&n.role!=="admin"){const Ue=G.tags?.find(Ht=>Ht.startsWith("owner:"));Ue===`owner:${n.id}`||n.displayId&&Ue===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${Ue||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),Ct=!1)}Ct?(Ge=await bn.updateRecipe(G,n),f(h.map(Ue=>Ue.id===Ge.id?Ge:Ue))):(Ge=await bn.createRecipe(G,n),f([Ge,...h])),d(Ct?{view:"detail",id:Ge.id}:{view:"detail",id:Ge.id})}catch(Ge){console.error("Failed to save recipe:",Ge),o.error(`
: ${Ge.message||Ge.error_description||JSON.stringify(Ge)}`)}};b.useEffect(()=>{let G=!1;return(async()=>{if(T!=="edit"||!H){q(null),P(!1);return}P(!0);try{const Ge=await bn.getRecipe(H);if(G)return;q(Ge)}catch(Ge){if(console.error("Failed to load edit recipe details",Ge),G)return;q(K),o.warning("")}finally{G||P(!1)}})(),()=>{G=!0}},[T,H]);const Qe=(G,Le="")=>{const Ct=["","baker","","","","dough","fermentation"].some(sn=>(G.title||"").toLowerCase().includes(sn)),Ue=["flour","","","","","","","","",""],ft=["yeast","","",""],Ht=G.ingredients||[],En=Ht.some(sn=>ft.some(Nt=>(sn.name||"").toLowerCase().includes(Nt))),kt=Ht.some(sn=>Ue.some(Nt=>(sn.name||"").toLowerCase().includes(Nt))&&!sn.name.includes(""));if(Ht.some(sn=>sn.quantity&&String(sn.quantity).includes("%")||sn.unit&&String(sn.unit).includes("%"))||En||Ct&&kt){G.type="bread",G.flours=[],G.breadIngredients=[];const sn=["flour","","","","","","","",""];if(Ht.forEach(Nt=>{sn.some(Kn=>(Nt.name||"").includes(Kn))?G.flours.push(Nt):G.breadIngredients.push(Nt)}),G.flours.length===0&&Ht.length>0){const Nt=Ht[0];(Nt.name||"").includes("")&&(G.flours.push(Nt),G.breadIngredients=G.breadIngredients.filter(Pr=>Pr!==Nt))}}G.sourceUrl=Le,Le&&(G.category="URL"),me(G),d({view:"create"})},Lt=()=>{I(!he),ye(new Set)},Xt=G=>{const Le=new Set(te);Le.has(G)?Le.delete(G):Le.add(G),ye(Le)},Qt=()=>{$e(!0)},ne=()=>{$e(!1)},ee=async()=>{$e(!1);try{y(!0),T==="trash"?(await Promise.all(Array.from(te).map(G=>bn.hardDeleteRecipe(G))),bt()):(await Promise.all(Array.from(te).map(G=>bn.deleteRecipe(G))),f(h.filter(G=>!te.has(G.id))),Ee()),ye(new Set),I(!1),o.success("")}catch(G){console.error("Bulk delete failed",G),o.warning(""),T==="trash"?bt():Ie()}finally{y(!1)}},ue=()=>{te.size!==0&&pe(!0)},je=()=>{pe(!1)},Be=async()=>{pe(!1);try{y(!0);for(const G of te)await bn.restoreRecipe(G);f(h.filter(G=>!te.has(G.id))),Ee(),I(!1),ye(new Set),o.success(""),bt()}catch(G){console.error("Bulk restore failed",G),o.warning(""),bt()}finally{y(!1)}},Ze=()=>{const G=Ve.map(Le=>Le.id);ye(new Set(G))},Ye=G=>{f([G,...h]),d({view:"edit",id:G.id})};if(b.useEffect(()=>{s||n&&(T==="trash"?bt():T==="list"&&Ie())},[T,s,n?.id]),s&&!E){let G=!1;try{const Le=JSON.parse(localStorage.getItem("auth_user_cache")||"null");Le?.id&&(G=!!bn.getCachedRecipes(Le.id))}catch{}if(!G)return i.jsx(Bf,{label:"",subLabel:""})}return n?a?i.jsx(Zk,{}):i.jsxs(Qj,{children:[qe&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",te.size,"",T==="trash"?"":""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:T==="trash"?"":""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(re,{variant:"ghost",onClick:ne,children:""}),i.jsx(re,{variant:"danger",onClick:ee,children:T==="trash"?"":""})]})]})}),Je&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",te.size,""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(re,{variant:"ghost",onClick:je,children:""}),i.jsx(re,{variant:"secondary",onClick:Be,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),i.jsx(pn,{isOpen:!!Xe,onClose:()=>ot(null),title:"PC",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[i.jsx("p",{style:{marginTop:0},children:Ae[Xe]?i.jsxs(i.Fragment,{children:["",i.jsx("strong",{children:Ae[Xe]}),"/"]}):i.jsx(i.Fragment,{children:"/"})}),i.jsxs("p",{style:{marginBottom:0},children:["",i.jsx("strong",{children:"PC"}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[i.jsx(re,{variant:"ghost",onClick:()=>{ot(null),d({view:"list"})},children:""}),i.jsx(re,{variant:"primary",onClick:()=>ot(null),children:"OK"})]})]})}),(T==="list"||T==="trash")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"container-header",children:[i.jsxs("h2",{className:"section-title",children:[T==="trash"?" ()":"",T==="list"&&i.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",h.length,")"]})]}),i.jsx("div",{className:"header-actions",children:T==="list"||T==="trash"?i.jsxs(i.Fragment,{children:[he?i.jsxs(i.Fragment,{children:[i.jsx(re,{variant:"ghost",onClick:Lt,children:""}),i.jsx(re,{variant:"secondary",onClick:Ze,children:""}),T==="trash"&&i.jsxs(re,{variant:"secondary",onClick:ue,disabled:te.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",te.size,")"]}),i.jsxs(re,{variant:"danger",onClick:Qt,disabled:te.size===0,children:[T==="trash"?"":""," (",te.size,")"]})]}):i.jsx(i.Fragment,{children:T==="list"?i.jsx(i.Fragment,{children:i.jsx(re,{onClick:()=>{me(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):i.jsx(re,{variant:"ghost",onClick:tt,children:" "})}),i.jsx("button",{className:"mobile-menu-toggle",onClick:()=>Re(!ze),"aria-label":"",children:""}),i.jsxs("div",{className:`secondary-actions ${ze?"open":""}`,children:[i.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>Re(!1),"aria-label":"",children:""}),i.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[i.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&i.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&i.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),i.jsxs(re,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),i.jsxs(re,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),T==="list"&&i.jsxs(i.Fragment,{children:[i.jsxs(re,{variant:"secondary",onClick:()=>{Y("url"),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),i.jsxs(re,{variant:"secondary",onClick:()=>{Y("image"),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsx("div",{className:"pc-recommend-note",children:i.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),i.jsxs(re,{variant:"secondary",onClick:()=>{d({view:"inventory"}),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsxs(re,{variant:"secondary",onClick:()=>{d({view:"incoming-deliveries"}),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),i.jsxs(re,{variant:"secondary",onClick:()=>{d({view:"incoming-stock"}),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsxs(re,{variant:"secondary",onClick:()=>{d({view:"planner"}),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(re,{variant:"secondary",onClick:()=>{d({view:"data"}),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&i.jsxs(re,{variant:"secondary",onClick:()=>{d({view:"users"}),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(re,{variant:"secondary",onClick:()=>{d({view:"order-list"}),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"})]}),!he&&i.jsxs(re,{variant:"ghost",onClick:()=>{Lt(),Re(!1)},className:"danger-text",children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," ",T==="trash"?"":""]}),T==="list"&&i.jsxs(re,{variant:"ghost",onClick:()=>{At(),Re(!1)},style:{position:"relative"},children:[i.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&i.jsx("span",{className:"trash-badge",children:v})]}),i.jsxs(re,{variant:"ghost",onClick:()=>{tt(),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(re,{variant:"ghost",onClick:()=>{t(),Re(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]}),i.jsx("div",{className:`menu-backdrop ${ze?"open":""}`,onClick:()=>Re(!1),"aria-hidden":"true"})]}):null})]}),T==="list"&&i.jsxs("div",{className:"list-toolbar",children:[i.jsxs("div",{className:"search-container search-container--compact",children:[i.jsx("span",{className:"search-icon",children:""}),i.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:B,onChange:G=>W(G.target.value)})]}),i.jsxs("div",{className:"public-recipe-toggles",children:[i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${J==="mine"?"active":""}`,"aria-pressed":J==="mine",onClick:()=>ge("mine"),children:" "}),i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${J==="others"?"active":""}`,"aria-pressed":J==="others",onClick:()=>ge("others"),children:" "}),J!=="none"&&i.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>ge("none"),children:" "})]})]}),i.jsxs("div",{className:"tag-filter-container",children:[i.jsxs("select",{className:"store-filter-select",value:L===Rt?Rt:L===Jt?Jt:Su.includes(L)?L:"",onChange:G=>A(G.target.value||""),children:[i.jsx("option",{value:"",children:""}),Su.map(G=>i.jsxs("option",{value:G,children:[G," (",rn[pt(G)]||0,")"]},G)),i.jsxs("option",{value:Rt,children:[" (",xn,")"]}),i.jsxs("option",{value:Jt,children:[" (",Ln,")"]})]}),i.jsxs("select",{className:"store-filter-select",value:Sn.includes(L)?L:"",onChange:G=>A(G.target.value||""),children:[i.jsx("option",{value:"",children:""}),Sn.sort().map(G=>i.jsxs("option",{value:G,children:[G," (",ar[pt(G)]||0,")"]},G))]}),i.jsxs("select",{className:"store-filter-select",value:_t.includes(L)?L:"",onChange:G=>A(G.target.value||""),children:[i.jsx("option",{value:"",children:""}),_t.sort().map(G=>i.jsxs("option",{value:G,children:[G," (",fe[pt(G)]||0,")"]},G))]}),i.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[i.jsx("button",{className:`tag-filter-btn ${Ne==="normal"?"active":""}`,onClick:()=>Oe("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),i.jsx("button",{className:`tag-filter-btn ${Ne==="all"?"active":""}`,onClick:()=>Oe("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),m?i.jsx(Bf,{label:D?"":"",subLabel:D?void 0:"",variant:"inline",showLogo:!1}):h.length===0?i.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[T==="trash"?"":"",L!==""&&i.jsx("p",{children:""})]}):i.jsxs("div",{className:"main-content-wrapper",children:[T==="list"&&i.jsx("div",{className:"recent-list-wrapper",children:i.jsx(fk,{recipes:h,recentIds:w,onSelect:Ke})}),i.jsx("div",{className:"recipe-list-container",children:T==="list"?i.jsx(Xi,{sensors:Mt,collisionDetection:Ff,onDragEnd:yt,children:i.jsx(Lv,{recipes:Ve,onSelectRecipe:Ke,isSelectMode:he,selectedIds:te,onToggleSelection:Xt,disableDrag:!et,displayMode:Ne,publicRecipeView:J,showOwner:n?.role==="admin",ownerLabelFn:it,currentUser:n})}):i.jsx(Lv,{recipes:Ve,onSelectRecipe:Ke,isSelectMode:he,selectedIds:te,onToggleSelection:Xt,disableDrag:!0,displayMode:Ne,publicRecipeView:J,showOwner:n?.role==="admin",ownerLabelFn:it,currentUser:n})})]})]}),T==="detail"&&K&&i.jsx(PN,{recipe:K,ownerLabel:n?.role==="admin"?it(K):void 0,isDeleted:!!K.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):K.deletedAt?At():tt()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?tt:void 0,onEdit:()=>d({view:"edit",id:K.id,from:u.get("from")}),onDelete:nt,onView:_e,onHardDelete:zt,onDuplicate:Ye}),T==="edit"&&H&&(V?i.jsx(Bf,{label:"",subLabel:"URL"}):F&&i.jsx(Rx,{initialData:F,onCancel:()=>d({view:"detail",id:H}),onSave:G=>$t(G,!0)},`edit-${H}`)),T==="create"&&i.jsx(Rx,{initialData:le,onCancel:()=>{d({view:"list"}),me(null)},onSave:G=>$t(G,!1)},le?"create-form-imported":"create-form"),$&&i.jsx(mb,{initialMode:$,onClose:()=>Y(null),onImport:Qe}),(T==="data"||T==="data-management")&&i.jsx(hk,{onBack:()=>d({view:"list"})}),T==="levain-guide"&&i.jsx(pk,{onBack:()=>d({view:"list"})}),T==="users"&&n?.role==="admin"&&i.jsx(mk,{onBack:()=>d({view:"list"})}),T==="inventory"&&i.jsx(bk,{onBack:()=>d({view:"list"})}),T==="incoming-deliveries"&&i.jsx(Dk,{onBack:()=>d({view:"list"})}),T==="incoming-stock"&&i.jsx(qk,{onBack:()=>d({view:"list"})}),T==="planner"&&i.jsx(Vk,{onBack:()=>d({view:"list"}),onSelectRecipe:G=>Ke(G,{from:"planner"})}),T==="order-list"&&i.jsx(Kk,{onBack:()=>d({view:"list"})})]}):i.jsx(Xk,{})}function tT(){return i.jsx(Jk,{children:i.jsx(Yk,{children:i.jsx(eT,{})})})}class nT extends be.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,s){console.error("Uncaught error:",t,s),this.setState({error:t,errorInfo:s})}render(){return this.state.hasError?i.jsxs("div",{style:{padding:"2rem",color:"red"},children:[i.jsx("h1",{children:""}),i.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),i.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),i.jsx("br",{}),i.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}vS.createRoot(document.getElementById("root")).render(i.jsx(b.StrictMode,{children:i.jsx(nT,{children:i.jsx(Bj,{children:i.jsx(tT,{})})})}));export{$x as a,rT as c,sT as g};
