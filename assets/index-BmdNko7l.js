(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(o){if(o.ep)return;o.ep=!0;const u=s(o);fetch(o.href,u)}})();var JT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function XT(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var s=function l(){var o=!1;try{o=this instanceof l}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(n).forEach(function(l){var o=Object.getOwnPropertyDescriptor(n,l);Object.defineProperty(s,l,o.get?o:{enumerable:!0,get:function(){return n[l]}})}),s}var Yh={exports:{}},ro={};var Zy;function iS(){if(Zy)return ro;Zy=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(l,o,u){var d=null;if(u!==void 0&&(d=""+u),o.key!==void 0&&(d=""+o.key),"key"in o){u={};for(var h in o)h!=="key"&&(u[h]=o[h])}else u=o;return o=u.ref,{$$typeof:n,type:l,key:d,ref:o!==void 0?o:null,props:u}}return ro.Fragment=t,ro.jsx=s,ro.jsxs=s,ro}var ev;function aS(){return ev||(ev=1,Yh.exports=iS()),Yh.exports}var i=aS(),Qh={exports:{}},Tt={};var tv;function lS(){if(tv)return Tt;tv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function w(B){return B===null||typeof B!="object"?null:(B=x&&B[x]||B["@@iterator"],typeof B=="function"?B:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,j={};function E(B,J,Z){this.props=B,this.context=J,this.refs=j,this.updater=Z||_}E.prototype.isReactComponent={},E.prototype.setState=function(B,J){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,J,"setState")},E.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function O(){}O.prototype=E.prototype;function D(B,J,Z){this.props=B,this.context=J,this.refs=j,this.updater=Z||_}var $=D.prototype=new O;$.constructor=D,N($,E.prototype),$.isPureReactComponent=!0;var z=Array.isArray;function C(){}var M={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function F(B,J,Z){var ge=Z.ref;return{$$typeof:n,type:B,key:J,ref:ge!==void 0?ge:null,props:Z}}function K(B,J){return F(B.type,J,B.props)}function G(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function q(B){var J={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(Z){return J[Z]})}var V=/\/+/g;function P(B,J){return typeof B=="object"&&B!==null&&B.key!=null?q(""+B.key):J.toString(36)}function L(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(C,C):(B.status="pending",B.then(function(J){B.status==="pending"&&(B.status="fulfilled",B.value=J)},function(J){B.status==="pending"&&(B.status="rejected",B.reason=J)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function R(B,J,Z,ge,Me){var ve=typeof B;(ve==="undefined"||ve==="boolean")&&(B=null);var ae=!1;if(B===null)ae=!0;else switch(ve){case"bigint":case"string":case"number":ae=!0;break;case"object":switch(B.$$typeof){case n:case t:ae=!0;break;case y:return ae=B._init,R(ae(B._payload),J,Z,ge,Me)}}if(ae)return Me=Me(B),ae=ge===""?"."+P(B,0):ge,z(Me)?(Z="",ae!=null&&(Z=ae.replace(V,"$&/")+"/"),R(Me,J,Z,"",function(ce){return ce})):Me!=null&&(G(Me)&&(Me=K(Me,Z+(Me.key==null||B&&B.key===Me.key?"":(""+Me.key).replace(V,"$&/")+"/")+ae)),J.push(Me)),1;ae=0;var A=ge===""?".":ge+":";if(z(B))for(var X=0;X<B.length;X++)ge=B[X],ve=A+P(ge,X),ae+=R(ge,J,Z,ve,Me);else if(X=w(B),typeof X=="function")for(B=X.call(B),X=0;!(ge=B.next()).done;)ge=ge.value,ve=A+P(ge,X++),ae+=R(ge,J,Z,ve,Me);else if(ve==="object"){if(typeof B.then=="function")return R(L(B),J,Z,ge,Me);throw J=String(B),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return ae}function I(B,J,Z){if(B==null)return B;var ge=[],Me=0;return R(B,ge,"","",function(ve){return J.call(Z,ve,Me++)}),ge}function Y(B){if(B._status===-1){var J=B._result;J=J(),J.then(function(Z){(B._status===0||B._status===-1)&&(B._status=1,B._result=Z)},function(Z){(B._status===0||B._status===-1)&&(B._status=2,B._result=Z)}),B._status===-1&&(B._status=0,B._result=J)}if(B._status===1)return B._result.default;throw B._result}var ue=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},ye={map:I,forEach:function(B,J,Z){I(B,function(){J.apply(this,arguments)},Z)},count:function(B){var J=0;return I(B,function(){J++}),J},toArray:function(B){return I(B,function(J){return J})||[]},only:function(B){if(!G(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return Tt.Activity=v,Tt.Children=ye,Tt.Component=E,Tt.Fragment=s,Tt.Profiler=o,Tt.PureComponent=D,Tt.StrictMode=l,Tt.Suspense=f,Tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=M,Tt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return M.H.useMemoCache(B)}},Tt.cache=function(B){return function(){return B.apply(null,arguments)}},Tt.cacheSignal=function(){return null},Tt.cloneElement=function(B,J,Z){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var ge=N({},B.props),Me=B.key;if(J!=null)for(ve in J.key!==void 0&&(Me=""+J.key),J)!T.call(J,ve)||ve==="key"||ve==="__self"||ve==="__source"||ve==="ref"&&J.ref===void 0||(ge[ve]=J[ve]);var ve=arguments.length-2;if(ve===1)ge.children=Z;else if(1<ve){for(var ae=Array(ve),A=0;A<ve;A++)ae[A]=arguments[A+2];ge.children=ae}return F(B.type,Me,ge)},Tt.createContext=function(B){return B={$$typeof:d,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:u,_context:B},B},Tt.createElement=function(B,J,Z){var ge,Me={},ve=null;if(J!=null)for(ge in J.key!==void 0&&(ve=""+J.key),J)T.call(J,ge)&&ge!=="key"&&ge!=="__self"&&ge!=="__source"&&(Me[ge]=J[ge]);var ae=arguments.length-2;if(ae===1)Me.children=Z;else if(1<ae){for(var A=Array(ae),X=0;X<ae;X++)A[X]=arguments[X+2];Me.children=A}if(B&&B.defaultProps)for(ge in ae=B.defaultProps,ae)Me[ge]===void 0&&(Me[ge]=ae[ge]);return F(B,ve,Me)},Tt.createRef=function(){return{current:null}},Tt.forwardRef=function(B){return{$$typeof:h,render:B}},Tt.isValidElement=G,Tt.lazy=function(B){return{$$typeof:y,_payload:{_status:-1,_result:B},_init:Y}},Tt.memo=function(B,J){return{$$typeof:m,type:B,compare:J===void 0?null:J}},Tt.startTransition=function(B){var J=M.T,Z={};M.T=Z;try{var ge=B(),Me=M.S;Me!==null&&Me(Z,ge),typeof ge=="object"&&ge!==null&&typeof ge.then=="function"&&ge.then(C,ue)}catch(ve){ue(ve)}finally{J!==null&&Z.types!==null&&(J.types=Z.types),M.T=J}},Tt.unstable_useCacheRefresh=function(){return M.H.useCacheRefresh()},Tt.use=function(B){return M.H.use(B)},Tt.useActionState=function(B,J,Z){return M.H.useActionState(B,J,Z)},Tt.useCallback=function(B,J){return M.H.useCallback(B,J)},Tt.useContext=function(B){return M.H.useContext(B)},Tt.useDebugValue=function(){},Tt.useDeferredValue=function(B,J){return M.H.useDeferredValue(B,J)},Tt.useEffect=function(B,J){return M.H.useEffect(B,J)},Tt.useEffectEvent=function(B){return M.H.useEffectEvent(B)},Tt.useId=function(){return M.H.useId()},Tt.useImperativeHandle=function(B,J,Z){return M.H.useImperativeHandle(B,J,Z)},Tt.useInsertionEffect=function(B,J){return M.H.useInsertionEffect(B,J)},Tt.useLayoutEffect=function(B,J){return M.H.useLayoutEffect(B,J)},Tt.useMemo=function(B,J){return M.H.useMemo(B,J)},Tt.useOptimistic=function(B,J){return M.H.useOptimistic(B,J)},Tt.useReducer=function(B,J,Z){return M.H.useReducer(B,J,Z)},Tt.useRef=function(B){return M.H.useRef(B)},Tt.useState=function(B){return M.H.useState(B)},Tt.useSyncExternalStore=function(B,J,Z){return M.H.useSyncExternalStore(B,J,Z)},Tt.useTransition=function(){return M.H.useTransition()},Tt.version="19.2.3",Tt}var nv;function Do(){return nv||(nv=1,Qh.exports=lS()),Qh.exports}var b=Do();const we=Lx(b);var Wh={exports:{}},so={},Jh={exports:{}},Xh={};var rv;function oS(){return rv||(rv=1,(function(n){function t(R,I){var Y=R.length;R.push(I);e:for(;0<Y;){var ue=Y-1>>>1,ye=R[ue];if(0<o(ye,I))R[ue]=I,R[Y]=ye,Y=ue;else break e}}function s(R){return R.length===0?null:R[0]}function l(R){if(R.length===0)return null;var I=R[0],Y=R.pop();if(Y!==I){R[0]=Y;e:for(var ue=0,ye=R.length,B=ye>>>1;ue<B;){var J=2*(ue+1)-1,Z=R[J],ge=J+1,Me=R[ge];if(0>o(Z,Y))ge<ye&&0>o(Me,Z)?(R[ue]=Me,R[ge]=Y,ue=ge):(R[ue]=Z,R[J]=Y,ue=J);else if(ge<ye&&0>o(Me,Y))R[ue]=Me,R[ge]=Y,ue=ge;else break e}}return I}function o(R,I){var Y=R.sortIndex-I.sortIndex;return Y!==0?Y:R.id-I.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,h=d.now();n.unstable_now=function(){return d.now()-h}}var f=[],m=[],y=1,v=null,x=3,w=!1,_=!1,N=!1,j=!1,E=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function $(R){for(var I=s(m);I!==null;){if(I.callback===null)l(m);else if(I.startTime<=R)l(m),I.sortIndex=I.expirationTime,t(f,I);else break;I=s(m)}}function z(R){if(N=!1,$(R),!_)if(s(f)!==null)_=!0,C||(C=!0,q());else{var I=s(m);I!==null&&L(z,I.startTime-R)}}var C=!1,M=-1,T=5,F=-1;function K(){return j?!0:!(n.unstable_now()-F<T)}function G(){if(j=!1,C){var R=n.unstable_now();F=R;var I=!0;try{e:{_=!1,N&&(N=!1,O(M),M=-1),w=!0;var Y=x;try{t:{for($(R),v=s(f);v!==null&&!(v.expirationTime>R&&K());){var ue=v.callback;if(typeof ue=="function"){v.callback=null,x=v.priorityLevel;var ye=ue(v.expirationTime<=R);if(R=n.unstable_now(),typeof ye=="function"){v.callback=ye,$(R),I=!0;break t}v===s(f)&&l(f),$(R)}else l(f);v=s(f)}if(v!==null)I=!0;else{var B=s(m);B!==null&&L(z,B.startTime-R),I=!1}}break e}finally{v=null,x=Y,w=!1}I=void 0}}finally{I?q():C=!1}}}var q;if(typeof D=="function")q=function(){D(G)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,P=V.port2;V.port1.onmessage=G,q=function(){P.postMessage(null)}}else q=function(){E(G,0)};function L(R,I){M=E(function(){R(n.unstable_now())},I)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(R){R.callback=null},n.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<R?Math.floor(1e3/R):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(R){switch(x){case 1:case 2:case 3:var I=3;break;default:I=x}var Y=x;x=I;try{return R()}finally{x=Y}},n.unstable_requestPaint=function(){j=!0},n.unstable_runWithPriority=function(R,I){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var Y=x;x=R;try{return I()}finally{x=Y}},n.unstable_scheduleCallback=function(R,I,Y){var ue=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ue+Y:ue):Y=ue,R){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=Y+ye,R={id:y++,callback:I,priorityLevel:R,startTime:Y,expirationTime:ye,sortIndex:-1},Y>ue?(R.sortIndex=Y,t(m,R),s(f)===null&&R===s(m)&&(N?(O(M),M=-1):N=!0,L(z,Y-ue))):(R.sortIndex=ye,t(f,R),_||w||(_=!0,C||(C=!0,q()))),R},n.unstable_shouldYield=K,n.unstable_wrapCallback=function(R){var I=x;return function(){var Y=x;x=I;try{return R.apply(this,arguments)}finally{x=Y}}}})(Xh)),Xh}var sv;function cS(){return sv||(sv=1,Jh.exports=oS()),Jh.exports}var Zh={exports:{}},sr={};var iv;function uS(){if(iv)return sr;iv=1;var n=Do();function t(f){var m="https://react.dev/errors/"+f;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+f+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var l={d:{f:s,r:function(){throw Error(t(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(f,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:f,containerInfo:m,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,m){if(f==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return sr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,sr.createPortal=function(f,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return u(f,m,null,y)},sr.flushSync=function(f){var m=d.T,y=l.p;try{if(d.T=null,l.p=2,f)return f()}finally{d.T=m,l.p=y,l.d.f()}},sr.preconnect=function(f,m){typeof f=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,l.d.C(f,m))},sr.prefetchDNS=function(f){typeof f=="string"&&l.d.D(f)},sr.preinit=function(f,m){if(typeof f=="string"&&m&&typeof m.as=="string"){var y=m.as,v=h(y,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,w=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?l.d.S(f,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:w}):y==="script"&&l.d.X(f,{crossOrigin:v,integrity:x,fetchPriority:w,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},sr.preinitModule=function(f,m){if(typeof f=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=h(m.as,m.crossOrigin);l.d.M(f,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&l.d.M(f)},sr.preload=function(f,m){if(typeof f=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=h(y,m.crossOrigin);l.d.L(f,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},sr.preloadModule=function(f,m){if(typeof f=="string")if(m){var y=h(m.as,m.crossOrigin);l.d.m(f,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else l.d.m(f)},sr.requestFormReset=function(f){l.d.r(f)},sr.unstable_batchedUpdates=function(f,m){return f(m)},sr.useFormState=function(f,m,y){return d.H.useFormState(f,m,y)},sr.useFormStatus=function(){return d.H.useHostTransitionStatus()},sr.version="19.2.3",sr}var av;function Ix(){if(av)return Zh.exports;av=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Zh.exports=uS(),Zh.exports}var lv;function dS(){if(lv)return so;lv=1;var n=cS(),t=Do(),s=Ix();function l(e){var r="https://react.dev/errors/"+e;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var r=e,a=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,(r.flags&4098)!==0&&(a=r.return),e=r.return;while(e)}return r.tag===3?a:null}function d(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function h(e){if(e.tag===31){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function f(e){if(u(e)!==e)throw Error(l(188))}function m(e){var r=e.alternate;if(!r){if(r=u(e),r===null)throw Error(l(188));return r!==e?null:e}for(var a=e,c=r;;){var p=a.return;if(p===null)break;var g=p.alternate;if(g===null){if(c=p.return,c!==null){a=c;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===a)return f(p),e;if(g===c)return f(p),r;g=g.sibling}throw Error(l(188))}if(a.return!==c.return)a=p,c=g;else{for(var S=!1,k=p.child;k;){if(k===a){S=!0,a=p,c=g;break}if(k===c){S=!0,c=p,a=g;break}k=k.sibling}if(!S){for(k=g.child;k;){if(k===a){S=!0,a=g,c=p;break}if(k===c){S=!0,c=g,a=p;break}k=k.sibling}if(!S)throw Error(l(189))}}if(a.alternate!==c)throw Error(l(190))}if(a.tag!==3)throw Error(l(188));return a.stateNode.current===a?e:r}function y(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e;for(e=e.child;e!==null;){if(r=y(e),r!==null)return r;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),w=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),D=Symbol.for("react.context"),$=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),T=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),K=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function q(e){return e===null||typeof e!="object"?null:(e=G&&e[G]||e["@@iterator"],typeof e=="function"?e:null)}var V=Symbol.for("react.client.reference");function P(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===V?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case N:return"Fragment";case E:return"Profiler";case j:return"StrictMode";case z:return"Suspense";case C:return"SuspenseList";case F:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case D:return e.displayName||"Context";case O:return(e._context.displayName||"Context")+".Consumer";case $:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case M:return r=e.displayName||null,r!==null?r:P(e.type)||"Memo";case T:r=e._payload,e=e._init;try{return P(e(r))}catch{}}return null}var L=Array.isArray,R=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,I=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},ue=[],ye=-1;function B(e){return{current:e}}function J(e){0>ye||(e.current=ue[ye],ue[ye]=null,ye--)}function Z(e,r){ye++,ue[ye]=e.current,e.current=r}var ge=B(null),Me=B(null),ve=B(null),ae=B(null);function A(e,r){switch(Z(ve,r),Z(Me,e),Z(ge,null),r.nodeType){case 9:case 11:e=(e=r.documentElement)&&(e=e.namespaceURI)?Sy(e):0;break;default:if(e=r.tagName,r=r.namespaceURI)r=Sy(r),e=jy(r,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}J(ge),Z(ge,e)}function X(){J(ge),J(Me),J(ve)}function ce(e){e.memoizedState!==null&&Z(ae,e);var r=ge.current,a=jy(r,e.type);r!==a&&(Z(Me,e),Z(ge,a))}function Se(e){Me.current===e&&(J(ge),J(Me)),ae.current===e&&(J(ae),Zl._currentValue=Y)}var Ae,Be;function Le(e){if(Ae===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);Ae=r&&r[1]||"",Be=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ae+e+Be}var Ge=!1;function W(e,r){if(!e||Ge)return"";Ge=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var ke=function(){throw Error()};if(Object.defineProperty(ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ke,[])}catch(xe){var pe=xe}Reflect.construct(e,[],ke)}else{try{ke.call()}catch(xe){pe=xe}e.call(ke.prototype)}}else{try{throw Error()}catch(xe){pe=xe}(ke=e())&&typeof ke.catch=="function"&&ke.catch(function(){})}}catch(xe){if(xe&&pe&&typeof xe.stack=="string")return[xe.stack,pe.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),S=g[0],k=g[1];if(S&&k){var Q=S.split(`
`),he=k.split(`
`);for(p=c=0;c<Q.length&&!Q[c].includes("DetermineComponentFrameRoot");)c++;for(;p<he.length&&!he[p].includes("DetermineComponentFrameRoot");)p++;if(c===Q.length||p===he.length)for(c=Q.length-1,p=he.length-1;1<=c&&0<=p&&Q[c]!==he[p];)p--;for(;1<=c&&0<=p;c--,p--)if(Q[c]!==he[p]){if(c!==1||p!==1)do if(c--,p--,0>p||Q[c]!==he[p]){var je=`
`+Q[c].replace(" at new "," at ");return e.displayName&&je.includes("<anonymous>")&&(je=je.replace("<anonymous>",e.displayName)),je}while(1<=c&&0<=p);break}}}finally{Ge=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Le(a):""}function Ce(e,r){switch(e.tag){case 26:case 27:case 5:return Le(e.type);case 16:return Le("Lazy");case 13:return e.child!==r&&r!==null?Le("Suspense Fallback"):Le("Suspense");case 19:return Le("SuspenseList");case 0:case 15:return W(e.type,!1);case 11:return W(e.type.render,!1);case 1:return W(e.type,!0);case 31:return Le("Activity");default:return""}}function $e(e){try{var r="",a=null;do r+=Ce(e,a),a=e,e=e.return;while(e);return r}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var rt=Object.prototype.hasOwnProperty,mt=n.unstable_scheduleCallback,ft=n.unstable_cancelCallback,Dt=n.unstable_shouldYield,Vt=n.unstable_requestPaint,St=n.unstable_now,oe=n.unstable_getCurrentPriorityLevel,_e=n.unstable_ImmediatePriority,Ne=n.unstable_UserBlockingPriority,Ie=n.unstable_NormalPriority,it=n.unstable_LowPriority,ut=n.unstable_IdlePriority,kt=n.log,Jt=n.unstable_setDisableYieldValue,Sn=null,jt=null;function rn(e){if(typeof kt=="function"&&Jt(e),jt&&typeof jt.setStrictMode=="function")try{jt.setStrictMode(Sn,e)}catch{}}var cn=Math.clz32?Math.clz32:ar,xn=Math.log,Ln=Math.LN2;function ar(e){return e>>>=0,e===0?32:31-(xn(e)/Ln|0)|0}var me=256,Ke=262144,Ze=4194304;function Ye(e){var r=e&42;if(r!==0)return r;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function tt(e,r,a){var c=e.pendingLanes;if(c===0)return 0;var p=0,g=e.suspendedLanes,S=e.pingedLanes;e=e.warmLanes;var k=c&134217727;return k!==0?(c=k&~g,c!==0?p=Ye(c):(S&=k,S!==0?p=Ye(S):a||(a=k&~e,a!==0&&(p=Ye(a))))):(k=c&~g,k!==0?p=Ye(k):S!==0?p=Ye(S):a||(a=c&~e,a!==0&&(p=Ye(a)))),p===0?0:r!==0&&r!==p&&(r&g)===0&&(g=p&-p,a=r&-r,g>=a||g===32&&(a&4194048)!==0)?r:p}function Mt(e,r){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&r)===0}function xt(e,r){switch(e){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Rt(){var e=Ze;return Ze<<=1,(Ze&62914560)===0&&(Ze=4194304),e}function et(e){for(var r=[],a=0;31>a;a++)r.push(e);return r}function Bt(e,r){e.pendingLanes|=r,r!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function We(e,r,a,c,p,g){var S=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var k=e.entanglements,Q=e.expirationTimes,he=e.hiddenUpdates;for(a=S&~a;0<a;){var je=31-cn(a),ke=1<<je;k[je]=0,Q[je]=-1;var pe=he[je];if(pe!==null)for(he[je]=null,je=0;je<pe.length;je++){var xe=pe[je];xe!==null&&(xe.lane&=-536870913)}a&=~ke}c!==0&&Ut(e,c,0),g!==0&&p===0&&e.tag!==0&&(e.suspendedLanes|=g&~(S&~r))}function Ut(e,r,a){e.pendingLanes|=r,e.suspendedLanes&=~r;var c=31-cn(r);e.entangledLanes|=r,e.entanglements[c]=e.entanglements[c]|1073741824|a&261930}function Xt(e,r){var a=e.entangledLanes|=r;for(e=e.entanglements;a;){var c=31-cn(a),p=1<<c;p&r|e[c]&r&&(e[c]|=r),a&=~p}}function Qt(e,r){var a=r&-r;return a=(a&42)!==0?1:re(a),(a&(e.suspendedLanes|r))!==0?0:a}function re(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ne(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function fe(){var e=I.p;return e!==0?e:(e=window.event,e===void 0?32:Vy(e.type))}function Te(e,r){var a=I.p;try{return I.p=e,r()}finally{I.p=a}}var Pe=Math.random().toString(36).slice(2),Xe="__reactFiber$"+Pe,Qe="__reactProps$"+Pe,H="__reactContainer$"+Pe,Ue="__reactEvents$"+Pe,Ve="__reactListeners$"+Pe,_t="__reactHandles$"+Pe,ze="__reactResources$"+Pe,ht="__reactMarker$"+Pe;function Ft(e){delete e[Xe],delete e[Qe],delete e[Ue],delete e[Ve],delete e[_t]}function Nn(e){var r=e[Xe];if(r)return r;for(var a=e.parentNode;a;){if(r=a[H]||a[Xe]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(e=Ry(e);e!==null;){if(a=e[Xe])return a;e=Ry(e)}return r}e=a,a=e.parentNode}return null}function Et(e){if(e=e[Xe]||e[H]){var r=e.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return e}return null}function Vn(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e.stateNode;throw Error(l(33))}function sn(e){var r=e[ze];return r||(r=e[ze]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Nt(e){e[ht]=!0}var Pr=new Set,Kn={};function yr(e,r){qr(e,r),qr(e+"Capture",r)}function qr(e,r){for(Kn[e]=r,e=0;e<r.length;e++)Pr.add(r[e])}var ta=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),cs={},ul={};function dl(e){return rt.call(ul,e)?!0:rt.call(cs,e)?!1:ta.test(e)?ul[e]=!0:(cs[e]=!0,!1)}function na(e,r,a){if(dl(r))if(a===null)e.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(r);return}}e.setAttribute(r,""+a)}}function $s(e,r,a){if(a===null)e.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttribute(r,""+a)}}function cr(e,r,a,c){if(c===null)e.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(r,a,""+c)}}function Yn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function hl(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Wu(e,r,a){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,r);if(!e.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,g=c.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return p.call(this)},set:function(S){a=""+S,g.call(this,S)}}),Object.defineProperty(e,r,{enumerable:c.enumerable}),{getValue:function(){return a},setValue:function(S){a=""+S},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function fl(e){if(!e._valueTracker){var r=hl(e)?"checked":"value";e._valueTracker=Wu(e,r,""+e[r])}}function Vo(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var a=r.getValue(),c="";return e&&(c=hl(e)?e.checked?"true":"false":e.value),e=c,e!==a?(r.setValue(e),!0):!1}function ra(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var pl=/[\n"\\]/g;function ur(e){return e.replace(pl,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function ml(e,r,a,c,p,g,S,k){e.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.type=S:e.removeAttribute("type"),r!=null?S==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+Yn(r)):e.value!==""+Yn(r)&&(e.value=""+Yn(r)):S!=="submit"&&S!=="reset"||e.removeAttribute("value"),r!=null?gl(e,S,Yn(r)):a!=null?gl(e,S,Yn(a)):c!=null&&e.removeAttribute("value"),p==null&&g!=null&&(e.defaultChecked=!!g),p!=null&&(e.checked=p&&typeof p!="function"&&typeof p!="symbol"),k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?e.name=""+Yn(k):e.removeAttribute("name")}function Ps(e,r,a,c,p,g,S,k){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),r!=null||a!=null){if(!(g!=="submit"&&g!=="reset"||r!=null)){fl(e);return}a=a!=null?""+Yn(a):"",r=r!=null?""+Yn(r):a,k||r===e.value||(e.value=r),e.defaultValue=r}c=c??p,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=k?e.checked:!!c,e.defaultChecked=!!c,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(e.name=S),fl(e)}function gl(e,r,a){r==="number"&&ra(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function qs(e,r,a,c){if(e=e.options,r){r={};for(var p=0;p<a.length;p++)r["$"+a[p]]=!0;for(a=0;a<e.length;a++)p=r.hasOwnProperty("$"+e[a].value),e[a].selected!==p&&(e[a].selected=p),p&&c&&(e[a].defaultSelected=!0)}else{for(a=""+Yn(a),r=null,p=0;p<e.length;p++){if(e[p].value===a){e[p].selected=!0,c&&(e[p].defaultSelected=!0);return}r!==null||e[p].disabled||(r=e[p])}r!==null&&(r.selected=!0)}}function Ko(e,r,a){if(r!=null&&(r=""+Yn(r),r!==e.value&&(e.value=r),a==null)){e.defaultValue!==r&&(e.defaultValue=r);return}e.defaultValue=a!=null?""+Yn(a):""}function Yo(e,r,a,c){if(r==null){if(c!=null){if(a!=null)throw Error(l(92));if(L(c)){if(1<c.length)throw Error(l(93));c=c[0]}a=c}a==null&&(a=""),r=a}a=Yn(r),e.defaultValue=a,c=e.textContent,c===a&&c!==""&&c!==null&&(e.value=c),fl(e)}function us(e,r){if(r){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=r;return}}e.textContent=r}var Qo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Wo(e,r,a){var c=r.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?c?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="":c?e.setProperty(r,a):typeof a!="number"||a===0||Qo.has(r)?r==="float"?e.cssFloat=a:e[r]=(""+a).trim():e[r]=a+"px"}function Jo(e,r,a){if(r!=null&&typeof r!="object")throw Error(l(62));if(e=e.style,a!=null){for(var c in a)!a.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var p in r)c=r[p],r.hasOwnProperty(p)&&a[p]!==c&&Wo(e,p,c)}else for(var g in r)r.hasOwnProperty(g)&&Wo(e,g,r[g])}function sa(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ju=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Xo=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ia(e){return Xo.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Fr(){}var yl=null;function vl(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Fs=null,Hs=null;function bi(e){var r=Et(e);if(r&&(e=r.stateNode)){var a=e[Qe]||null;e:switch(e=r.stateNode,r.type){case"input":if(ml(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),r=a.name,a.type==="radio"&&r!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ur(""+r)+'"][type="radio"]'),r=0;r<a.length;r++){var c=a[r];if(c!==e&&c.form===e.form){var p=c[Qe]||null;if(!p)throw Error(l(90));ml(c,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(r=0;r<a.length;r++)c=a[r],c.form===e.form&&Vo(c)}break e;case"textarea":Ko(e,a.value,a.defaultValue);break e;case"select":r=a.value,r!=null&&qs(e,!!a.multiple,r,!1)}}}var aa=!1;function U(e,r,a){if(aa)return e(r,a);aa=!0;try{var c=e(r);return c}finally{if(aa=!1,(Fs!==null||Hs!==null)&&(Mc(),Fs&&(r=Fs,e=Hs,Hs=Fs=null,bi(r),e)))for(r=0;r<e.length;r++)bi(e[r])}}function ee(e,r){var a=e.stateNode;if(a===null)return null;var c=a[Qe]||null;if(c===null)return null;a=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(l(231,r,typeof a));return a}var le=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),be=!1;if(le)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){be=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch{be=!1}var De=null,qe=null,He=null;function Je(){if(He)return He;var e,r=qe,a=r.length,c,p="value"in De?De.value:De.textContent,g=p.length;for(e=0;e<a&&r[e]===p[e];e++);var S=a-e;for(c=1;c<=S&&r[a-c]===p[g-c];c++);return He=p.slice(e,1<c?1-c:void 0)}function st(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function dt(){return!0}function gt(){return!1}function Fe(e){function r(a,c,p,g,S){this._reactName=a,this._targetInst=p,this.type=c,this.nativeEvent=g,this.target=S,this.currentTarget=null;for(var k in e)e.hasOwnProperty(k)&&(a=e[k],this[k]=a?a(g):g[k]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?dt:gt,this.isPropagationStopped=gt,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=dt)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=dt)},persist:function(){},isPersistent:dt}),r}var yt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pn=Fe(yt),dn=v({},yt,{view:0,detail:0}),Gs=Fe(dn),es,at,ot,Ct=v({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ot&&(ot&&e.type==="mousemove"?(es=e.screenX-ot.screenX,at=e.screenY-ot.screenY):at=es=0,ot=e),es)},movementY:function(e){return"movementY"in e?e.movementY:at}}),hn=Fe(Ct),En=v({},Ct,{dataTransfer:0}),Rn=Fe(En),$t=v({},dn,{relatedTarget:0}),rr=Fe($t),An=v({},yt,{animationName:0,elapsedTime:0,pseudoElement:0}),ds=Fe(An),ts=v({},yt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Vs=Fe(ts),xl=v({},yt,{data:0}),Xu=Fe(xl),hs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},la={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mb(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=wi[e])?!!r[e]:!1}function Zu(){return mb}var gb=v({},dn,{key:function(e){if(e.key){var r=hs[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=st(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?la[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zu,charCode:function(e){return e.type==="keypress"?st(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?st(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),yb=Fe(gb),vb=v({},Ct,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ep=Fe(vb),xb=v({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zu}),bb=Fe(xb),wb=v({},yt,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sb=Fe(wb),jb=v({},Ct,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_b=Fe(jb),Cb=v({},yt,{newState:0,oldState:0}),Nb=Fe(Cb),Eb=[9,13,27,32],ed=le&&"CompositionEvent"in window,bl=null;le&&"documentMode"in document&&(bl=document.documentMode);var Tb=le&&"TextEvent"in window&&!bl,Tp=le&&(!ed||bl&&8<bl&&11>=bl),kp=" ",Rp=!1;function Ap(e,r){switch(e){case"keyup":return Eb.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Op(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var oa=!1;function kb(e,r){switch(e){case"compositionend":return Op(r);case"keypress":return r.which!==32?null:(Rp=!0,kp);case"textInput":return e=r.data,e===kp&&Rp?null:e;default:return null}}function Rb(e,r){if(oa)return e==="compositionend"||!ed&&Ap(e,r)?(e=Je(),He=qe=De=null,oa=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Tp&&r.locale!=="ko"?null:r.data;default:return null}}var Ab={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dp(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!Ab[e.type]:r==="textarea"}function Mp(e,r,a,c){Fs?Hs?Hs.push(c):Hs=[c]:Fs=c,r=Pc(r,"onChange"),0<r.length&&(a=new pn("onChange","change",null,a,c),e.push({event:a,listeners:r}))}var wl=null,Sl=null;function Ob(e){gy(e,0)}function Zo(e){var r=Vn(e);if(Vo(r))return e}function zp(e,r){if(e==="change")return r}var Up=!1;if(le){var td;if(le){var nd="oninput"in document;if(!nd){var Lp=document.createElement("div");Lp.setAttribute("oninput","return;"),nd=typeof Lp.oninput=="function"}td=nd}else td=!1;Up=td&&(!document.documentMode||9<document.documentMode)}function Ip(){wl&&(wl.detachEvent("onpropertychange",Bp),Sl=wl=null)}function Bp(e){if(e.propertyName==="value"&&Zo(Sl)){var r=[];Mp(r,Sl,e,vl(e)),U(Ob,r)}}function Db(e,r,a){e==="focusin"?(Ip(),wl=r,Sl=a,wl.attachEvent("onpropertychange",Bp)):e==="focusout"&&Ip()}function Mb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Zo(Sl)}function zb(e,r){if(e==="click")return Zo(r)}function Ub(e,r){if(e==="input"||e==="change")return Zo(r)}function Lb(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var vr=typeof Object.is=="function"?Object.is:Lb;function jl(e,r){if(vr(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var a=Object.keys(e),c=Object.keys(r);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var p=a[c];if(!rt.call(r,p)||!vr(e[p],r[p]))return!1}return!0}function $p(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Pp(e,r){var a=$p(e);e=0;for(var c;a;){if(a.nodeType===3){if(c=e+a.textContent.length,e<=r&&c>=r)return{node:a,offset:r-e};e=c}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=$p(a)}}function qp(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?qp(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function Fp(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var r=ra(e.document);r instanceof e.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)e=r.contentWindow;else break;r=ra(e.document)}return r}function rd(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}var Ib=le&&"documentMode"in document&&11>=document.documentMode,ca=null,sd=null,_l=null,id=!1;function Hp(e,r,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;id||ca==null||ca!==ra(c)||(c=ca,"selectionStart"in c&&rd(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),_l&&jl(_l,c)||(_l=c,c=Pc(sd,"onSelect"),0<c.length&&(r=new pn("onSelect","select",null,r,a),e.push({event:r,listeners:c}),r.target=ca)))}function Si(e,r){var a={};return a[e.toLowerCase()]=r.toLowerCase(),a["Webkit"+e]="webkit"+r,a["Moz"+e]="moz"+r,a}var ua={animationend:Si("Animation","AnimationEnd"),animationiteration:Si("Animation","AnimationIteration"),animationstart:Si("Animation","AnimationStart"),transitionrun:Si("Transition","TransitionRun"),transitionstart:Si("Transition","TransitionStart"),transitioncancel:Si("Transition","TransitionCancel"),transitionend:Si("Transition","TransitionEnd")},ad={},Gp={};le&&(Gp=document.createElement("div").style,"AnimationEvent"in window||(delete ua.animationend.animation,delete ua.animationiteration.animation,delete ua.animationstart.animation),"TransitionEvent"in window||delete ua.transitionend.transition);function ji(e){if(ad[e])return ad[e];if(!ua[e])return e;var r=ua[e],a;for(a in r)if(r.hasOwnProperty(a)&&a in Gp)return ad[e]=r[a];return e}var Vp=ji("animationend"),Kp=ji("animationiteration"),Yp=ji("animationstart"),Bb=ji("transitionrun"),$b=ji("transitionstart"),Pb=ji("transitioncancel"),Qp=ji("transitionend"),Wp=new Map,ld="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ld.push("scrollEnd");function Hr(e,r){Wp.set(e,r),yr(r,[e])}var ec=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},kr=[],da=0,od=0;function tc(){for(var e=da,r=od=da=0;r<e;){var a=kr[r];kr[r++]=null;var c=kr[r];kr[r++]=null;var p=kr[r];kr[r++]=null;var g=kr[r];if(kr[r++]=null,c!==null&&p!==null){var S=c.pending;S===null?p.next=p:(p.next=S.next,S.next=p),c.pending=p}g!==0&&Jp(a,p,g)}}function nc(e,r,a,c){kr[da++]=e,kr[da++]=r,kr[da++]=a,kr[da++]=c,od|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function cd(e,r,a,c){return nc(e,r,a,c),rc(e)}function _i(e,r){return nc(e,null,null,r),rc(e)}function Jp(e,r,a){e.lanes|=a;var c=e.alternate;c!==null&&(c.lanes|=a);for(var p=!1,g=e.return;g!==null;)g.childLanes|=a,c=g.alternate,c!==null&&(c.childLanes|=a),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(p=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,p&&r!==null&&(p=31-cn(a),e=g.hiddenUpdates,c=e[p],c===null?e[p]=[r]:c.push(r),r.lane=a|536870912),g):null}function rc(e){if(50<Vl)throw Vl=0,vh=null,Error(l(185));for(var r=e.return;r!==null;)e=r,r=e.return;return e.tag===3?e.stateNode:null}var ha={};function qb(e,r,a,c){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(e,r,a,c){return new qb(e,r,a,c)}function ud(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fs(e,r){var a=e.alternate;return a===null?(a=xr(e.tag,r,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=r,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,r=e.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Xp(e,r){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=r,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,r=a.dependencies,e.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e}function sc(e,r,a,c,p,g){var S=0;if(c=e,typeof e=="function")ud(e)&&(S=1);else if(typeof e=="string")S=Kw(e,a,ge.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case F:return e=xr(31,a,r,p),e.elementType=F,e.lanes=g,e;case N:return Ci(a.children,p,g,r);case j:S=8,p|=24;break;case E:return e=xr(12,a,r,p|2),e.elementType=E,e.lanes=g,e;case z:return e=xr(13,a,r,p),e.elementType=z,e.lanes=g,e;case C:return e=xr(19,a,r,p),e.elementType=C,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case D:S=10;break e;case O:S=9;break e;case $:S=11;break e;case M:S=14;break e;case T:S=16,c=null;break e}S=29,a=Error(l(130,e===null?"null":typeof e,"")),c=null}return r=xr(S,a,r,p),r.elementType=e,r.type=c,r.lanes=g,r}function Ci(e,r,a,c){return e=xr(7,e,c,r),e.lanes=a,e}function dd(e,r,a){return e=xr(6,e,null,r),e.lanes=a,e}function Zp(e){var r=xr(18,null,null,0);return r.stateNode=e,r}function hd(e,r,a){return r=xr(4,e.children!==null?e.children:[],e.key,r),r.lanes=a,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}var em=new WeakMap;function Rr(e,r){if(typeof e=="object"&&e!==null){var a=em.get(e);return a!==void 0?a:(r={value:e,source:r,stack:$e(r)},em.set(e,r),r)}return{value:e,source:r,stack:$e(r)}}var fa=[],pa=0,ic=null,Cl=0,Ar=[],Or=0,Ks=null,ns=1,rs="";function ps(e,r){fa[pa++]=Cl,fa[pa++]=ic,ic=e,Cl=r}function tm(e,r,a){Ar[Or++]=ns,Ar[Or++]=rs,Ar[Or++]=Ks,Ks=e;var c=ns;e=rs;var p=32-cn(c)-1;c&=~(1<<p),a+=1;var g=32-cn(r)+p;if(30<g){var S=p-p%5;g=(c&(1<<S)-1).toString(32),c>>=S,p-=S,ns=1<<32-cn(r)+p|a<<p|c,rs=g+e}else ns=1<<g|a<<p|c,rs=e}function fd(e){e.return!==null&&(ps(e,1),tm(e,1,0))}function pd(e){for(;e===ic;)ic=fa[--pa],fa[pa]=null,Cl=fa[--pa],fa[pa]=null;for(;e===Ks;)Ks=Ar[--Or],Ar[Or]=null,rs=Ar[--Or],Ar[Or]=null,ns=Ar[--Or],Ar[Or]=null}function nm(e,r){Ar[Or++]=ns,Ar[Or++]=rs,Ar[Or++]=Ks,ns=r.id,rs=r.overflow,Ks=e}var Qn=null,mn=null,Ht=!1,Ys=null,Dr=!1,md=Error(l(519));function Qs(e){var r=Error(l(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Nl(Rr(r,e)),md}function rm(e){var r=e.stateNode,a=e.type,c=e.memoizedProps;switch(r[Xe]=e,r[Qe]=c,a){case"dialog":It("cancel",r),It("close",r);break;case"iframe":case"object":case"embed":It("load",r);break;case"video":case"audio":for(a=0;a<Yl.length;a++)It(Yl[a],r);break;case"source":It("error",r);break;case"img":case"image":case"link":It("error",r),It("load",r);break;case"details":It("toggle",r);break;case"input":It("invalid",r),Ps(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":It("invalid",r);break;case"textarea":It("invalid",r),Yo(r,c.value,c.defaultValue,c.children)}a=c.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||r.textContent===""+a||c.suppressHydrationWarning===!0||by(r.textContent,a)?(c.popover!=null&&(It("beforetoggle",r),It("toggle",r)),c.onScroll!=null&&It("scroll",r),c.onScrollEnd!=null&&It("scrollend",r),c.onClick!=null&&(r.onclick=Fr),r=!0):r=!1,r||Qs(e,!0)}function sm(e){for(Qn=e.return;Qn;)switch(Qn.tag){case 5:case 31:case 13:Dr=!1;return;case 27:case 3:Dr=!0;return;default:Qn=Qn.return}}function ma(e){if(e!==Qn)return!1;if(!Ht)return sm(e),Ht=!0,!1;var r=e.tag,a;if((a=r!==3&&r!==27)&&((a=r===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||Dh(e.type,e.memoizedProps)),a=!a),a&&mn&&Qs(e),sm(e),r===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));mn=ky(e)}else if(r===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));mn=ky(e)}else r===27?(r=mn,ci(e.type)?(e=Ih,Ih=null,mn=e):mn=r):mn=Qn?zr(e.stateNode.nextSibling):null;return!0}function Ni(){mn=Qn=null,Ht=!1}function gd(){var e=Ys;return e!==null&&(pr===null?pr=e:pr.push.apply(pr,e),Ys=null),e}function Nl(e){Ys===null?Ys=[e]:Ys.push(e)}var yd=B(null),Ei=null,ms=null;function Ws(e,r,a){Z(yd,r._currentValue),r._currentValue=a}function gs(e){e._currentValue=yd.current,J(yd)}function vd(e,r,a){for(;e!==null;){var c=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),e===a)break;e=e.return}}function xd(e,r,a,c){var p=e.child;for(p!==null&&(p.return=e);p!==null;){var g=p.dependencies;if(g!==null){var S=p.child;g=g.firstContext;e:for(;g!==null;){var k=g;g=p;for(var Q=0;Q<r.length;Q++)if(k.context===r[Q]){g.lanes|=a,k=g.alternate,k!==null&&(k.lanes|=a),vd(g.return,a,e),c||(S=null);break e}g=k.next}}else if(p.tag===18){if(S=p.return,S===null)throw Error(l(341));S.lanes|=a,g=S.alternate,g!==null&&(g.lanes|=a),vd(S,a,e),S=null}else S=p.child;if(S!==null)S.return=p;else for(S=p;S!==null;){if(S===e){S=null;break}if(p=S.sibling,p!==null){p.return=S.return,S=p;break}S=S.return}p=S}}function ga(e,r,a,c){e=null;for(var p=r,g=!1;p!==null;){if(!g){if((p.flags&524288)!==0)g=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var S=p.alternate;if(S===null)throw Error(l(387));if(S=S.memoizedProps,S!==null){var k=p.type;vr(p.pendingProps.value,S.value)||(e!==null?e.push(k):e=[k])}}else if(p===ae.current){if(S=p.alternate,S===null)throw Error(l(387));S.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(e!==null?e.push(Zl):e=[Zl])}p=p.return}e!==null&&xd(r,e,a,c),r.flags|=262144}function ac(e){for(e=e.firstContext;e!==null;){if(!vr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ti(e){Ei=e,ms=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Wn(e){return im(Ei,e)}function lc(e,r){return Ei===null&&Ti(e),im(e,r)}function im(e,r){var a=r._currentValue;if(r={context:r,memoizedValue:a,next:null},ms===null){if(e===null)throw Error(l(308));ms=r,e.dependencies={lanes:0,firstContext:r},e.flags|=524288}else ms=ms.next=r;return a}var Fb=typeof AbortController<"u"?AbortController:function(){var e=[],r=this.signal={aborted:!1,addEventListener:function(a,c){e.push(c)}};this.abort=function(){r.aborted=!0,e.forEach(function(a){return a()})}},Hb=n.unstable_scheduleCallback,Gb=n.unstable_NormalPriority,On={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function bd(){return{controller:new Fb,data:new Map,refCount:0}}function El(e){e.refCount--,e.refCount===0&&Hb(Gb,function(){e.controller.abort()})}var Tl=null,wd=0,ya=0,va=null;function Vb(e,r){if(Tl===null){var a=Tl=[];wd=0,ya=_h(),va={status:"pending",value:void 0,then:function(c){a.push(c)}}}return wd++,r.then(am,am),r}function am(){if(--wd===0&&Tl!==null){va!==null&&(va.status="fulfilled");var e=Tl;Tl=null,ya=0,va=null;for(var r=0;r<e.length;r++)(0,e[r])()}}function Kb(e,r){var a=[],c={status:"pending",value:null,reason:null,then:function(p){a.push(p)}};return e.then(function(){c.status="fulfilled",c.value=r;for(var p=0;p<a.length;p++)(0,a[p])(r)},function(p){for(c.status="rejected",c.reason=p,p=0;p<a.length;p++)(0,a[p])(void 0)}),c}var lm=R.S;R.S=function(e,r){Hg=St(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&Vb(e,r),lm!==null&&lm(e,r)};var ki=B(null);function Sd(){var e=ki.current;return e!==null?e:un.pooledCache}function oc(e,r){r===null?Z(ki,ki.current):Z(ki,r.pool)}function om(){var e=Sd();return e===null?null:{parent:On._currentValue,pool:e}}var xa=Error(l(460)),jd=Error(l(474)),cc=Error(l(542)),uc={then:function(){}};function cm(e){return e=e.status,e==="fulfilled"||e==="rejected"}function um(e,r,a){switch(a=e[a],a===void 0?e.push(r):a!==r&&(r.then(Fr,Fr),r=a),r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,hm(e),e;default:if(typeof r.status=="string")r.then(Fr,Fr);else{if(e=un,e!==null&&100<e.shellSuspendCounter)throw Error(l(482));e=r,e.status="pending",e.then(function(c){if(r.status==="pending"){var p=r;p.status="fulfilled",p.value=c}},function(c){if(r.status==="pending"){var p=r;p.status="rejected",p.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,hm(e),e}throw Ai=r,xa}}function Ri(e){try{var r=e._init;return r(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(Ai=a,xa):a}}var Ai=null;function dm(){if(Ai===null)throw Error(l(459));var e=Ai;return Ai=null,e}function hm(e){if(e===xa||e===cc)throw Error(l(483))}var ba=null,kl=0;function dc(e){var r=kl;return kl+=1,ba===null&&(ba=[]),um(ba,e,r)}function Rl(e,r){r=r.props.ref,e.ref=r!==void 0?r:null}function hc(e,r){throw r.$$typeof===x?Error(l(525)):(e=Object.prototype.toString.call(r),Error(l(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)))}function fm(e){function r(ie,te){if(e){var de=ie.deletions;de===null?(ie.deletions=[te],ie.flags|=16):de.push(te)}}function a(ie,te){if(!e)return null;for(;te!==null;)r(ie,te),te=te.sibling;return null}function c(ie){for(var te=new Map;ie!==null;)ie.key!==null?te.set(ie.key,ie):te.set(ie.index,ie),ie=ie.sibling;return te}function p(ie,te){return ie=fs(ie,te),ie.index=0,ie.sibling=null,ie}function g(ie,te,de){return ie.index=de,e?(de=ie.alternate,de!==null?(de=de.index,de<te?(ie.flags|=67108866,te):de):(ie.flags|=67108866,te)):(ie.flags|=1048576,te)}function S(ie){return e&&ie.alternate===null&&(ie.flags|=67108866),ie}function k(ie,te,de,Ee){return te===null||te.tag!==6?(te=dd(de,ie.mode,Ee),te.return=ie,te):(te=p(te,de),te.return=ie,te)}function Q(ie,te,de,Ee){var pt=de.type;return pt===N?je(ie,te,de.props.children,Ee,de.key):te!==null&&(te.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===T&&Ri(pt)===te.type)?(te=p(te,de.props),Rl(te,de),te.return=ie,te):(te=sc(de.type,de.key,de.props,null,ie.mode,Ee),Rl(te,de),te.return=ie,te)}function he(ie,te,de,Ee){return te===null||te.tag!==4||te.stateNode.containerInfo!==de.containerInfo||te.stateNode.implementation!==de.implementation?(te=hd(de,ie.mode,Ee),te.return=ie,te):(te=p(te,de.children||[]),te.return=ie,te)}function je(ie,te,de,Ee,pt){return te===null||te.tag!==7?(te=Ci(de,ie.mode,Ee,pt),te.return=ie,te):(te=p(te,de),te.return=ie,te)}function ke(ie,te,de){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return te=dd(""+te,ie.mode,de),te.return=ie,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case w:return de=sc(te.type,te.key,te.props,null,ie.mode,de),Rl(de,te),de.return=ie,de;case _:return te=hd(te,ie.mode,de),te.return=ie,te;case T:return te=Ri(te),ke(ie,te,de)}if(L(te)||q(te))return te=Ci(te,ie.mode,de,null),te.return=ie,te;if(typeof te.then=="function")return ke(ie,dc(te),de);if(te.$$typeof===D)return ke(ie,lc(ie,te),de);hc(ie,te)}return null}function pe(ie,te,de,Ee){var pt=te!==null?te.key:null;if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return pt!==null?null:k(ie,te,""+de,Ee);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case w:return de.key===pt?Q(ie,te,de,Ee):null;case _:return de.key===pt?he(ie,te,de,Ee):null;case T:return de=Ri(de),pe(ie,te,de,Ee)}if(L(de)||q(de))return pt!==null?null:je(ie,te,de,Ee,null);if(typeof de.then=="function")return pe(ie,te,dc(de),Ee);if(de.$$typeof===D)return pe(ie,te,lc(ie,de),Ee);hc(ie,de)}return null}function xe(ie,te,de,Ee,pt){if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return ie=ie.get(de)||null,k(te,ie,""+Ee,pt);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case w:return ie=ie.get(Ee.key===null?de:Ee.key)||null,Q(te,ie,Ee,pt);case _:return ie=ie.get(Ee.key===null?de:Ee.key)||null,he(te,ie,Ee,pt);case T:return Ee=Ri(Ee),xe(ie,te,de,Ee,pt)}if(L(Ee)||q(Ee))return ie=ie.get(de)||null,je(te,ie,Ee,pt,null);if(typeof Ee.then=="function")return xe(ie,te,de,dc(Ee),pt);if(Ee.$$typeof===D)return xe(ie,te,de,lc(te,Ee),pt);hc(te,Ee)}return null}function nt(ie,te,de,Ee){for(var pt=null,Kt=null,lt=te,Ot=te=0,qt=null;lt!==null&&Ot<de.length;Ot++){lt.index>Ot?(qt=lt,lt=null):qt=lt.sibling;var Yt=pe(ie,lt,de[Ot],Ee);if(Yt===null){lt===null&&(lt=qt);break}e&&lt&&Yt.alternate===null&&r(ie,lt),te=g(Yt,te,Ot),Kt===null?pt=Yt:Kt.sibling=Yt,Kt=Yt,lt=qt}if(Ot===de.length)return a(ie,lt),Ht&&ps(ie,Ot),pt;if(lt===null){for(;Ot<de.length;Ot++)lt=ke(ie,de[Ot],Ee),lt!==null&&(te=g(lt,te,Ot),Kt===null?pt=lt:Kt.sibling=lt,Kt=lt);return Ht&&ps(ie,Ot),pt}for(lt=c(lt);Ot<de.length;Ot++)qt=xe(lt,ie,Ot,de[Ot],Ee),qt!==null&&(e&&qt.alternate!==null&&lt.delete(qt.key===null?Ot:qt.key),te=g(qt,te,Ot),Kt===null?pt=qt:Kt.sibling=qt,Kt=qt);return e&&lt.forEach(function(pi){return r(ie,pi)}),Ht&&ps(ie,Ot),pt}function vt(ie,te,de,Ee){if(de==null)throw Error(l(151));for(var pt=null,Kt=null,lt=te,Ot=te=0,qt=null,Yt=de.next();lt!==null&&!Yt.done;Ot++,Yt=de.next()){lt.index>Ot?(qt=lt,lt=null):qt=lt.sibling;var pi=pe(ie,lt,Yt.value,Ee);if(pi===null){lt===null&&(lt=qt);break}e&&lt&&pi.alternate===null&&r(ie,lt),te=g(pi,te,Ot),Kt===null?pt=pi:Kt.sibling=pi,Kt=pi,lt=qt}if(Yt.done)return a(ie,lt),Ht&&ps(ie,Ot),pt;if(lt===null){for(;!Yt.done;Ot++,Yt=de.next())Yt=ke(ie,Yt.value,Ee),Yt!==null&&(te=g(Yt,te,Ot),Kt===null?pt=Yt:Kt.sibling=Yt,Kt=Yt);return Ht&&ps(ie,Ot),pt}for(lt=c(lt);!Yt.done;Ot++,Yt=de.next())Yt=xe(lt,ie,Ot,Yt.value,Ee),Yt!==null&&(e&&Yt.alternate!==null&&lt.delete(Yt.key===null?Ot:Yt.key),te=g(Yt,te,Ot),Kt===null?pt=Yt:Kt.sibling=Yt,Kt=Yt);return e&&lt.forEach(function(sS){return r(ie,sS)}),Ht&&ps(ie,Ot),pt}function on(ie,te,de,Ee){if(typeof de=="object"&&de!==null&&de.type===N&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case w:e:{for(var pt=de.key;te!==null;){if(te.key===pt){if(pt=de.type,pt===N){if(te.tag===7){a(ie,te.sibling),Ee=p(te,de.props.children),Ee.return=ie,ie=Ee;break e}}else if(te.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===T&&Ri(pt)===te.type){a(ie,te.sibling),Ee=p(te,de.props),Rl(Ee,de),Ee.return=ie,ie=Ee;break e}a(ie,te);break}else r(ie,te);te=te.sibling}de.type===N?(Ee=Ci(de.props.children,ie.mode,Ee,de.key),Ee.return=ie,ie=Ee):(Ee=sc(de.type,de.key,de.props,null,ie.mode,Ee),Rl(Ee,de),Ee.return=ie,ie=Ee)}return S(ie);case _:e:{for(pt=de.key;te!==null;){if(te.key===pt)if(te.tag===4&&te.stateNode.containerInfo===de.containerInfo&&te.stateNode.implementation===de.implementation){a(ie,te.sibling),Ee=p(te,de.children||[]),Ee.return=ie,ie=Ee;break e}else{a(ie,te);break}else r(ie,te);te=te.sibling}Ee=hd(de,ie.mode,Ee),Ee.return=ie,ie=Ee}return S(ie);case T:return de=Ri(de),on(ie,te,de,Ee)}if(L(de))return nt(ie,te,de,Ee);if(q(de)){if(pt=q(de),typeof pt!="function")throw Error(l(150));return de=pt.call(de),vt(ie,te,de,Ee)}if(typeof de.then=="function")return on(ie,te,dc(de),Ee);if(de.$$typeof===D)return on(ie,te,lc(ie,de),Ee);hc(ie,de)}return typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint"?(de=""+de,te!==null&&te.tag===6?(a(ie,te.sibling),Ee=p(te,de),Ee.return=ie,ie=Ee):(a(ie,te),Ee=dd(de,ie.mode,Ee),Ee.return=ie,ie=Ee),S(ie)):a(ie,te)}return function(ie,te,de,Ee){try{kl=0;var pt=on(ie,te,de,Ee);return ba=null,pt}catch(lt){if(lt===xa||lt===cc)throw lt;var Kt=xr(29,lt,null,ie.mode);return Kt.lanes=Ee,Kt.return=ie,Kt}}}var Oi=fm(!0),pm=fm(!1),Js=!1;function _d(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Cd(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Xs(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Zs(e,r,a){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(Wt&2)!==0){var p=c.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),c.pending=r,r=rc(e),Jp(e,null,a),r}return nc(e,c,r,a),rc(e)}function Al(e,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194048)!==0)){var c=r.lanes;c&=e.pendingLanes,a|=c,r.lanes=a,Xt(e,a)}}function Nd(e,r){var a=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var p=null,g=null;if(a=a.firstBaseUpdate,a!==null){do{var S={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};g===null?p=g=S:g=g.next=S,a=a.next}while(a!==null);g===null?p=g=r:g=g.next=r}else p=g=r;a={baseState:c.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=r:e.next=r,a.lastBaseUpdate=r}var Ed=!1;function Ol(){if(Ed){var e=va;if(e!==null)throw e}}function Dl(e,r,a,c){Ed=!1;var p=e.updateQueue;Js=!1;var g=p.firstBaseUpdate,S=p.lastBaseUpdate,k=p.shared.pending;if(k!==null){p.shared.pending=null;var Q=k,he=Q.next;Q.next=null,S===null?g=he:S.next=he,S=Q;var je=e.alternate;je!==null&&(je=je.updateQueue,k=je.lastBaseUpdate,k!==S&&(k===null?je.firstBaseUpdate=he:k.next=he,je.lastBaseUpdate=Q))}if(g!==null){var ke=p.baseState;S=0,je=he=Q=null,k=g;do{var pe=k.lane&-536870913,xe=pe!==k.lane;if(xe?(Pt&pe)===pe:(c&pe)===pe){pe!==0&&pe===ya&&(Ed=!0),je!==null&&(je=je.next={lane:0,tag:k.tag,payload:k.payload,callback:null,next:null});e:{var nt=e,vt=k;pe=r;var on=a;switch(vt.tag){case 1:if(nt=vt.payload,typeof nt=="function"){ke=nt.call(on,ke,pe);break e}ke=nt;break e;case 3:nt.flags=nt.flags&-65537|128;case 0:if(nt=vt.payload,pe=typeof nt=="function"?nt.call(on,ke,pe):nt,pe==null)break e;ke=v({},ke,pe);break e;case 2:Js=!0}}pe=k.callback,pe!==null&&(e.flags|=64,xe&&(e.flags|=8192),xe=p.callbacks,xe===null?p.callbacks=[pe]:xe.push(pe))}else xe={lane:pe,tag:k.tag,payload:k.payload,callback:k.callback,next:null},je===null?(he=je=xe,Q=ke):je=je.next=xe,S|=pe;if(k=k.next,k===null){if(k=p.shared.pending,k===null)break;xe=k,k=xe.next,xe.next=null,p.lastBaseUpdate=xe,p.shared.pending=null}}while(!0);je===null&&(Q=ke),p.baseState=Q,p.firstBaseUpdate=he,p.lastBaseUpdate=je,g===null&&(p.shared.lanes=0),si|=S,e.lanes=S,e.memoizedState=ke}}function mm(e,r){if(typeof e!="function")throw Error(l(191,e));e.call(r)}function gm(e,r){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)mm(a[e],r)}var wa=B(null),fc=B(0);function ym(e,r){e=Cs,Z(fc,e),Z(wa,r),Cs=e|r.baseLanes}function Td(){Z(fc,Cs),Z(wa,wa.current)}function kd(){Cs=fc.current,J(wa),J(fc)}var br=B(null),Mr=null;function ei(e){var r=e.alternate;Z(Tn,Tn.current&1),Z(br,e),Mr===null&&(r===null||wa.current!==null||r.memoizedState!==null)&&(Mr=e)}function Rd(e){Z(Tn,Tn.current),Z(br,e),Mr===null&&(Mr=e)}function vm(e){e.tag===22?(Z(Tn,Tn.current),Z(br,e),Mr===null&&(Mr=e)):ti()}function ti(){Z(Tn,Tn.current),Z(br,br.current)}function wr(e){J(br),Mr===e&&(Mr=null),J(Tn)}var Tn=B(0);function pc(e){for(var r=e;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Uh(a)||Lh(a)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var ys=0,At=null,an=null,Dn=null,mc=!1,Sa=!1,Di=!1,gc=0,Ml=0,ja=null,Yb=0;function jn(){throw Error(l(321))}function Ad(e,r){if(r===null)return!1;for(var a=0;a<r.length&&a<e.length;a++)if(!vr(e[a],r[a]))return!1;return!0}function Od(e,r,a,c,p,g){return ys=g,At=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,R.H=e===null||e.memoizedState===null?tg:Kd,Di=!1,g=a(c,p),Di=!1,Sa&&(g=bm(r,a,c,p)),xm(e),g}function xm(e){R.H=Ll;var r=an!==null&&an.next!==null;if(ys=0,Dn=an=At=null,mc=!1,Ml=0,ja=null,r)throw Error(l(300));e===null||Mn||(e=e.dependencies,e!==null&&ac(e)&&(Mn=!0))}function bm(e,r,a,c){At=e;var p=0;do{if(Sa&&(ja=null),Ml=0,Sa=!1,25<=p)throw Error(l(301));if(p+=1,Dn=an=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}R.H=ng,g=r(a,c)}while(Sa);return g}function Qb(){var e=R.H,r=e.useState()[0];return r=typeof r.then=="function"?zl(r):r,e=e.useState()[0],(an!==null?an.memoizedState:null)!==e&&(At.flags|=1024),r}function Dd(){var e=gc!==0;return gc=0,e}function Md(e,r,a){r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~a}function zd(e){if(mc){for(e=e.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}mc=!1}ys=0,Dn=an=At=null,Sa=!1,Ml=gc=0,ja=null}function lr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?At.memoizedState=Dn=e:Dn=Dn.next=e,Dn}function kn(){if(an===null){var e=At.alternate;e=e!==null?e.memoizedState:null}else e=an.next;var r=Dn===null?At.memoizedState:Dn.next;if(r!==null)Dn=r,an=e;else{if(e===null)throw At.alternate===null?Error(l(467)):Error(l(310));an=e,e={memoizedState:an.memoizedState,baseState:an.baseState,baseQueue:an.baseQueue,queue:an.queue,next:null},Dn===null?At.memoizedState=Dn=e:Dn=Dn.next=e}return Dn}function yc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zl(e){var r=Ml;return Ml+=1,ja===null&&(ja=[]),e=um(ja,e,r),r=At,(Dn===null?r.memoizedState:Dn.next)===null&&(r=r.alternate,R.H=r===null||r.memoizedState===null?tg:Kd),e}function vc(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return zl(e);if(e.$$typeof===D)return Wn(e)}throw Error(l(438,String(e)))}function Ud(e){var r=null,a=At.updateQueue;if(a!==null&&(r=a.memoCache),r==null){var c=At.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(p){return p.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),a===null&&(a=yc(),At.updateQueue=a),a.memoCache=r,a=r.data[r.index],a===void 0)for(a=r.data[r.index]=Array(e),c=0;c<e;c++)a[c]=K;return r.index++,a}function vs(e,r){return typeof r=="function"?r(e):r}function xc(e){var r=kn();return Ld(r,an,e)}function Ld(e,r,a){var c=e.queue;if(c===null)throw Error(l(311));c.lastRenderedReducer=a;var p=e.baseQueue,g=c.pending;if(g!==null){if(p!==null){var S=p.next;p.next=g.next,g.next=S}r.baseQueue=p=g,c.pending=null}if(g=e.baseState,p===null)e.memoizedState=g;else{r=p.next;var k=S=null,Q=null,he=r,je=!1;do{var ke=he.lane&-536870913;if(ke!==he.lane?(Pt&ke)===ke:(ys&ke)===ke){var pe=he.revertLane;if(pe===0)Q!==null&&(Q=Q.next={lane:0,revertLane:0,gesture:null,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null}),ke===ya&&(je=!0);else if((ys&pe)===pe){he=he.next,pe===ya&&(je=!0);continue}else ke={lane:0,revertLane:he.revertLane,gesture:null,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null},Q===null?(k=Q=ke,S=g):Q=Q.next=ke,At.lanes|=pe,si|=pe;ke=he.action,Di&&a(g,ke),g=he.hasEagerState?he.eagerState:a(g,ke)}else pe={lane:ke,revertLane:he.revertLane,gesture:he.gesture,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null},Q===null?(k=Q=pe,S=g):Q=Q.next=pe,At.lanes|=ke,si|=ke;he=he.next}while(he!==null&&he!==r);if(Q===null?S=g:Q.next=k,!vr(g,e.memoizedState)&&(Mn=!0,je&&(a=va,a!==null)))throw a;e.memoizedState=g,e.baseState=S,e.baseQueue=Q,c.lastRenderedState=g}return p===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function Id(e){var r=kn(),a=r.queue;if(a===null)throw Error(l(311));a.lastRenderedReducer=e;var c=a.dispatch,p=a.pending,g=r.memoizedState;if(p!==null){a.pending=null;var S=p=p.next;do g=e(g,S.action),S=S.next;while(S!==p);vr(g,r.memoizedState)||(Mn=!0),r.memoizedState=g,r.baseQueue===null&&(r.baseState=g),a.lastRenderedState=g}return[g,c]}function wm(e,r,a){var c=At,p=kn(),g=Ht;if(g){if(a===void 0)throw Error(l(407));a=a()}else a=r();var S=!vr((an||p).memoizedState,a);if(S&&(p.memoizedState=a,Mn=!0),p=p.queue,Pd(_m.bind(null,c,p,e),[e]),p.getSnapshot!==r||S||Dn!==null&&Dn.memoizedState.tag&1){if(c.flags|=2048,_a(9,{destroy:void 0},jm.bind(null,c,p,a,r),null),un===null)throw Error(l(349));g||(ys&127)!==0||Sm(c,r,a)}return a}function Sm(e,r,a){e.flags|=16384,e={getSnapshot:r,value:a},r=At.updateQueue,r===null?(r=yc(),At.updateQueue=r,r.stores=[e]):(a=r.stores,a===null?r.stores=[e]:a.push(e))}function jm(e,r,a,c){r.value=a,r.getSnapshot=c,Cm(r)&&Nm(e)}function _m(e,r,a){return a(function(){Cm(r)&&Nm(e)})}function Cm(e){var r=e.getSnapshot;e=e.value;try{var a=r();return!vr(e,a)}catch{return!0}}function Nm(e){var r=_i(e,2);r!==null&&mr(r,e,2)}function Bd(e){var r=lr();if(typeof e=="function"){var a=e;if(e=a(),Di){rn(!0);try{a()}finally{rn(!1)}}}return r.memoizedState=r.baseState=e,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:e},r}function Em(e,r,a,c){return e.baseState=a,Ld(e,an,typeof c=="function"?c:vs)}function Wb(e,r,a,c,p){if(Sc(e))throw Error(l(485));if(e=r.action,e!==null){var g={payload:p,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){g.listeners.push(S)}};R.T!==null?a(!0):g.isTransition=!1,c(g),a=r.pending,a===null?(g.next=r.pending=g,Tm(r,g)):(g.next=a.next,r.pending=a.next=g)}}function Tm(e,r){var a=r.action,c=r.payload,p=e.state;if(r.isTransition){var g=R.T,S={};R.T=S;try{var k=a(p,c),Q=R.S;Q!==null&&Q(S,k),km(e,r,k)}catch(he){$d(e,r,he)}finally{g!==null&&S.types!==null&&(g.types=S.types),R.T=g}}else try{g=a(p,c),km(e,r,g)}catch(he){$d(e,r,he)}}function km(e,r,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(c){Rm(e,r,c)},function(c){return $d(e,r,c)}):Rm(e,r,a)}function Rm(e,r,a){r.status="fulfilled",r.value=a,Am(r),e.state=a,r=e.pending,r!==null&&(a=r.next,a===r?e.pending=null:(a=a.next,r.next=a,Tm(e,a)))}function $d(e,r,a){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=a,Am(r),r=r.next;while(r!==c)}e.action=null}function Am(e){e=e.listeners;for(var r=0;r<e.length;r++)(0,e[r])()}function Om(e,r){return r}function Dm(e,r){if(Ht){var a=un.formState;if(a!==null){e:{var c=At;if(Ht){if(mn){t:{for(var p=mn,g=Dr;p.nodeType!==8;){if(!g){p=null;break t}if(p=zr(p.nextSibling),p===null){p=null;break t}}g=p.data,p=g==="F!"||g==="F"?p:null}if(p){mn=zr(p.nextSibling),c=p.data==="F!";break e}}Qs(c)}c=!1}c&&(r=a[0])}}return a=lr(),a.memoizedState=a.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Om,lastRenderedState:r},a.queue=c,a=Xm.bind(null,At,c),c.dispatch=a,c=Bd(!1),g=Vd.bind(null,At,!1,c.queue),c=lr(),p={state:r,dispatch:null,action:e,pending:null},c.queue=p,a=Wb.bind(null,At,p,g,a),p.dispatch=a,c.memoizedState=e,[r,a,!1]}function Mm(e){var r=kn();return zm(r,an,e)}function zm(e,r,a){if(r=Ld(e,r,Om)[0],e=xc(vs)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=zl(r)}catch(S){throw S===xa?cc:S}else c=r;r=kn();var p=r.queue,g=p.dispatch;return a!==r.memoizedState&&(At.flags|=2048,_a(9,{destroy:void 0},Jb.bind(null,p,a),null)),[c,g,e]}function Jb(e,r){e.action=r}function Um(e){var r=kn(),a=an;if(a!==null)return zm(r,a,e);kn(),r=r.memoizedState,a=kn();var c=a.queue.dispatch;return a.memoizedState=e,[r,c,!1]}function _a(e,r,a,c){return e={tag:e,create:a,deps:c,inst:r,next:null},r=At.updateQueue,r===null&&(r=yc(),At.updateQueue=r),a=r.lastEffect,a===null?r.lastEffect=e.next=e:(c=a.next,a.next=e,e.next=c,r.lastEffect=e),e}function Lm(){return kn().memoizedState}function bc(e,r,a,c){var p=lr();At.flags|=e,p.memoizedState=_a(1|r,{destroy:void 0},a,c===void 0?null:c)}function wc(e,r,a,c){var p=kn();c=c===void 0?null:c;var g=p.memoizedState.inst;an!==null&&c!==null&&Ad(c,an.memoizedState.deps)?p.memoizedState=_a(r,g,a,c):(At.flags|=e,p.memoizedState=_a(1|r,g,a,c))}function Im(e,r){bc(8390656,8,e,r)}function Pd(e,r){wc(2048,8,e,r)}function Xb(e){At.flags|=4;var r=At.updateQueue;if(r===null)r=yc(),At.updateQueue=r,r.events=[e];else{var a=r.events;a===null?r.events=[e]:a.push(e)}}function Bm(e){var r=kn().memoizedState;return Xb({ref:r,nextImpl:e}),function(){if((Wt&2)!==0)throw Error(l(440));return r.impl.apply(void 0,arguments)}}function $m(e,r){return wc(4,2,e,r)}function Pm(e,r){return wc(4,4,e,r)}function qm(e,r){if(typeof r=="function"){e=e();var a=r(e);return function(){typeof a=="function"?a():r(null)}}if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function Fm(e,r,a){a=a!=null?a.concat([e]):null,wc(4,4,qm.bind(null,r,e),a)}function qd(){}function Hm(e,r){var a=kn();r=r===void 0?null:r;var c=a.memoizedState;return r!==null&&Ad(r,c[1])?c[0]:(a.memoizedState=[e,r],e)}function Gm(e,r){var a=kn();r=r===void 0?null:r;var c=a.memoizedState;if(r!==null&&Ad(r,c[1]))return c[0];if(c=e(),Di){rn(!0);try{e()}finally{rn(!1)}}return a.memoizedState=[c,r],c}function Fd(e,r,a){return a===void 0||(ys&1073741824)!==0&&(Pt&261930)===0?e.memoizedState=r:(e.memoizedState=a,e=Vg(),At.lanes|=e,si|=e,a)}function Vm(e,r,a,c){return vr(a,r)?a:wa.current!==null?(e=Fd(e,a,c),vr(e,r)||(Mn=!0),e):(ys&42)===0||(ys&1073741824)!==0&&(Pt&261930)===0?(Mn=!0,e.memoizedState=a):(e=Vg(),At.lanes|=e,si|=e,r)}function Km(e,r,a,c,p){var g=I.p;I.p=g!==0&&8>g?g:8;var S=R.T,k={};R.T=k,Vd(e,!1,r,a);try{var Q=p(),he=R.S;if(he!==null&&he(k,Q),Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var je=Kb(Q,c);Ul(e,r,je,_r(e))}else Ul(e,r,c,_r(e))}catch(ke){Ul(e,r,{then:function(){},status:"rejected",reason:ke},_r())}finally{I.p=g,S!==null&&k.types!==null&&(S.types=k.types),R.T=S}}function Zb(){}function Hd(e,r,a,c){if(e.tag!==5)throw Error(l(476));var p=Ym(e).queue;Km(e,p,r,Y,a===null?Zb:function(){return Qm(e),a(c)})}function Ym(e){var r=e.memoizedState;if(r!==null)return r;r={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:Y},next:null};var a={};return r.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:a},next:null},e.memoizedState=r,e=e.alternate,e!==null&&(e.memoizedState=r),r}function Qm(e){var r=Ym(e);r.next===null&&(r=e.alternate.memoizedState),Ul(e,r.next.queue,{},_r())}function Gd(){return Wn(Zl)}function Wm(){return kn().memoizedState}function Jm(){return kn().memoizedState}function ew(e){for(var r=e.return;r!==null;){switch(r.tag){case 24:case 3:var a=_r();e=Xs(a);var c=Zs(r,e,a);c!==null&&(mr(c,r,a),Al(c,r,a)),r={cache:bd()},e.payload=r;return}r=r.return}}function tw(e,r,a){var c=_r();a={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},Sc(e)?Zm(r,a):(a=cd(e,r,a,c),a!==null&&(mr(a,e,c),eg(a,r,c)))}function Xm(e,r,a){var c=_r();Ul(e,r,a,c)}function Ul(e,r,a,c){var p={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(Sc(e))Zm(r,p);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=r.lastRenderedReducer,g!==null))try{var S=r.lastRenderedState,k=g(S,a);if(p.hasEagerState=!0,p.eagerState=k,vr(k,S))return nc(e,r,p,0),un===null&&tc(),!1}catch{}if(a=cd(e,r,p,c),a!==null)return mr(a,e,c),eg(a,r,c),!0}return!1}function Vd(e,r,a,c){if(c={lane:2,revertLane:_h(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Sc(e)){if(r)throw Error(l(479))}else r=cd(e,a,c,2),r!==null&&mr(r,e,2)}function Sc(e){var r=e.alternate;return e===At||r!==null&&r===At}function Zm(e,r){Sa=mc=!0;var a=e.pending;a===null?r.next=r:(r.next=a.next,a.next=r),e.pending=r}function eg(e,r,a){if((a&4194048)!==0){var c=r.lanes;c&=e.pendingLanes,a|=c,r.lanes=a,Xt(e,a)}}var Ll={readContext:Wn,use:vc,useCallback:jn,useContext:jn,useEffect:jn,useImperativeHandle:jn,useLayoutEffect:jn,useInsertionEffect:jn,useMemo:jn,useReducer:jn,useRef:jn,useState:jn,useDebugValue:jn,useDeferredValue:jn,useTransition:jn,useSyncExternalStore:jn,useId:jn,useHostTransitionStatus:jn,useFormState:jn,useActionState:jn,useOptimistic:jn,useMemoCache:jn,useCacheRefresh:jn};Ll.useEffectEvent=jn;var tg={readContext:Wn,use:vc,useCallback:function(e,r){return lr().memoizedState=[e,r===void 0?null:r],e},useContext:Wn,useEffect:Im,useImperativeHandle:function(e,r,a){a=a!=null?a.concat([e]):null,bc(4194308,4,qm.bind(null,r,e),a)},useLayoutEffect:function(e,r){return bc(4194308,4,e,r)},useInsertionEffect:function(e,r){bc(4,2,e,r)},useMemo:function(e,r){var a=lr();r=r===void 0?null:r;var c=e();if(Di){rn(!0);try{e()}finally{rn(!1)}}return a.memoizedState=[c,r],c},useReducer:function(e,r,a){var c=lr();if(a!==void 0){var p=a(r);if(Di){rn(!0);try{a(r)}finally{rn(!1)}}}else p=r;return c.memoizedState=c.baseState=p,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:p},c.queue=e,e=e.dispatch=tw.bind(null,At,e),[c.memoizedState,e]},useRef:function(e){var r=lr();return e={current:e},r.memoizedState=e},useState:function(e){e=Bd(e);var r=e.queue,a=Xm.bind(null,At,r);return r.dispatch=a,[e.memoizedState,a]},useDebugValue:qd,useDeferredValue:function(e,r){var a=lr();return Fd(a,e,r)},useTransition:function(){var e=Bd(!1);return e=Km.bind(null,At,e.queue,!0,!1),lr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,r,a){var c=At,p=lr();if(Ht){if(a===void 0)throw Error(l(407));a=a()}else{if(a=r(),un===null)throw Error(l(349));(Pt&127)!==0||Sm(c,r,a)}p.memoizedState=a;var g={value:a,getSnapshot:r};return p.queue=g,Im(_m.bind(null,c,g,e),[e]),c.flags|=2048,_a(9,{destroy:void 0},jm.bind(null,c,g,a,r),null),a},useId:function(){var e=lr(),r=un.identifierPrefix;if(Ht){var a=rs,c=ns;a=(c&~(1<<32-cn(c)-1)).toString(32)+a,r="_"+r+"R_"+a,a=gc++,0<a&&(r+="H"+a.toString(32)),r+="_"}else a=Yb++,r="_"+r+"r_"+a.toString(32)+"_";return e.memoizedState=r},useHostTransitionStatus:Gd,useFormState:Dm,useActionState:Dm,useOptimistic:function(e){var r=lr();r.memoizedState=r.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=a,r=Vd.bind(null,At,!0,a),a.dispatch=r,[e,r]},useMemoCache:Ud,useCacheRefresh:function(){return lr().memoizedState=ew.bind(null,At)},useEffectEvent:function(e){var r=lr(),a={impl:e};return r.memoizedState=a,function(){if((Wt&2)!==0)throw Error(l(440));return a.impl.apply(void 0,arguments)}}},Kd={readContext:Wn,use:vc,useCallback:Hm,useContext:Wn,useEffect:Pd,useImperativeHandle:Fm,useInsertionEffect:$m,useLayoutEffect:Pm,useMemo:Gm,useReducer:xc,useRef:Lm,useState:function(){return xc(vs)},useDebugValue:qd,useDeferredValue:function(e,r){var a=kn();return Vm(a,an.memoizedState,e,r)},useTransition:function(){var e=xc(vs)[0],r=kn().memoizedState;return[typeof e=="boolean"?e:zl(e),r]},useSyncExternalStore:wm,useId:Wm,useHostTransitionStatus:Gd,useFormState:Mm,useActionState:Mm,useOptimistic:function(e,r){var a=kn();return Em(a,an,e,r)},useMemoCache:Ud,useCacheRefresh:Jm};Kd.useEffectEvent=Bm;var ng={readContext:Wn,use:vc,useCallback:Hm,useContext:Wn,useEffect:Pd,useImperativeHandle:Fm,useInsertionEffect:$m,useLayoutEffect:Pm,useMemo:Gm,useReducer:Id,useRef:Lm,useState:function(){return Id(vs)},useDebugValue:qd,useDeferredValue:function(e,r){var a=kn();return an===null?Fd(a,e,r):Vm(a,an.memoizedState,e,r)},useTransition:function(){var e=Id(vs)[0],r=kn().memoizedState;return[typeof e=="boolean"?e:zl(e),r]},useSyncExternalStore:wm,useId:Wm,useHostTransitionStatus:Gd,useFormState:Um,useActionState:Um,useOptimistic:function(e,r){var a=kn();return an!==null?Em(a,an,e,r):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:Ud,useCacheRefresh:Jm};ng.useEffectEvent=Bm;function Yd(e,r,a,c){r=e.memoizedState,a=a(c,r),a=a==null?r:v({},r,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Qd={enqueueSetState:function(e,r,a){e=e._reactInternals;var c=_r(),p=Xs(c);p.payload=r,a!=null&&(p.callback=a),r=Zs(e,p,c),r!==null&&(mr(r,e,c),Al(r,e,c))},enqueueReplaceState:function(e,r,a){e=e._reactInternals;var c=_r(),p=Xs(c);p.tag=1,p.payload=r,a!=null&&(p.callback=a),r=Zs(e,p,c),r!==null&&(mr(r,e,c),Al(r,e,c))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var a=_r(),c=Xs(a);c.tag=2,r!=null&&(c.callback=r),r=Zs(e,c,a),r!==null&&(mr(r,e,a),Al(r,e,a))}};function rg(e,r,a,c,p,g,S){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,S):r.prototype&&r.prototype.isPureReactComponent?!jl(a,c)||!jl(p,g):!0}function sg(e,r,a,c){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,c),r.state!==e&&Qd.enqueueReplaceState(r,r.state,null)}function Mi(e,r){var a=r;if("ref"in r){a={};for(var c in r)c!=="ref"&&(a[c]=r[c])}if(e=e.defaultProps){a===r&&(a=v({},a));for(var p in e)a[p]===void 0&&(a[p]=e[p])}return a}function ig(e){ec(e)}function ag(e){console.error(e)}function lg(e){ec(e)}function jc(e,r){try{var a=e.onUncaughtError;a(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function og(e,r,a){try{var c=e.onCaughtError;c(a.value,{componentStack:a.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Wd(e,r,a){return a=Xs(a),a.tag=3,a.payload={element:null},a.callback=function(){jc(e,r)},a}function cg(e){return e=Xs(e),e.tag=3,e}function ug(e,r,a,c){var p=a.type.getDerivedStateFromError;if(typeof p=="function"){var g=c.value;e.payload=function(){return p(g)},e.callback=function(){og(r,a,c)}}var S=a.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(e.callback=function(){og(r,a,c),typeof p!="function"&&(ii===null?ii=new Set([this]):ii.add(this));var k=c.stack;this.componentDidCatch(c.value,{componentStack:k!==null?k:""})})}function nw(e,r,a,c,p){if(a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=a.alternate,r!==null&&ga(r,a,p,!0),a=br.current,a!==null){switch(a.tag){case 31:case 13:return Mr===null?zc():a.alternate===null&&_n===0&&(_n=3),a.flags&=-257,a.flags|=65536,a.lanes=p,c===uc?a.flags|=16384:(r=a.updateQueue,r===null?a.updateQueue=new Set([c]):r.add(c),wh(e,c,p)),!1;case 22:return a.flags|=65536,c===uc?a.flags|=16384:(r=a.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},a.updateQueue=r):(a=r.retryQueue,a===null?r.retryQueue=new Set([c]):a.add(c)),wh(e,c,p)),!1}throw Error(l(435,a.tag))}return wh(e,c,p),zc(),!1}if(Ht)return r=br.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=p,c!==md&&(e=Error(l(422),{cause:c}),Nl(Rr(e,a)))):(c!==md&&(r=Error(l(423),{cause:c}),Nl(Rr(r,a))),e=e.current.alternate,e.flags|=65536,p&=-p,e.lanes|=p,c=Rr(c,a),p=Wd(e.stateNode,c,p),Nd(e,p),_n!==4&&(_n=2)),!1;var g=Error(l(520),{cause:c});if(g=Rr(g,a),Gl===null?Gl=[g]:Gl.push(g),_n!==4&&(_n=2),r===null)return!0;c=Rr(c,a),a=r;do{switch(a.tag){case 3:return a.flags|=65536,e=p&-p,a.lanes|=e,e=Wd(a.stateNode,c,e),Nd(a,e),!1;case 1:if(r=a.type,g=a.stateNode,(a.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ii===null||!ii.has(g))))return a.flags|=65536,p&=-p,a.lanes|=p,p=cg(p),ug(p,e,a,c),Nd(a,p),!1}a=a.return}while(a!==null);return!1}var Jd=Error(l(461)),Mn=!1;function Jn(e,r,a,c){r.child=e===null?pm(r,null,a,c):Oi(r,e.child,a,c)}function dg(e,r,a,c,p){a=a.render;var g=r.ref;if("ref"in c){var S={};for(var k in c)k!=="ref"&&(S[k]=c[k])}else S=c;return Ti(r),c=Od(e,r,a,S,g,p),k=Dd(),e!==null&&!Mn?(Md(e,r,p),xs(e,r,p)):(Ht&&k&&fd(r),r.flags|=1,Jn(e,r,c,p),r.child)}function hg(e,r,a,c,p){if(e===null){var g=a.type;return typeof g=="function"&&!ud(g)&&g.defaultProps===void 0&&a.compare===null?(r.tag=15,r.type=g,fg(e,r,g,c,p)):(e=sc(a.type,null,c,r,r.mode,p),e.ref=r.ref,e.return=r,r.child=e)}if(g=e.child,!ih(e,p)){var S=g.memoizedProps;if(a=a.compare,a=a!==null?a:jl,a(S,c)&&e.ref===r.ref)return xs(e,r,p)}return r.flags|=1,e=fs(g,c),e.ref=r.ref,e.return=r,r.child=e}function fg(e,r,a,c,p){if(e!==null){var g=e.memoizedProps;if(jl(g,c)&&e.ref===r.ref)if(Mn=!1,r.pendingProps=c=g,ih(e,p))(e.flags&131072)!==0&&(Mn=!0);else return r.lanes=e.lanes,xs(e,r,p)}return Xd(e,r,a,c,p)}function pg(e,r,a,c){var p=c.children,g=e!==null?e.memoizedState:null;if(e===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((r.flags&128)!==0){if(g=g!==null?g.baseLanes|a:a,e!==null){for(c=r.child=e.child,p=0;c!==null;)p=p|c.lanes|c.childLanes,c=c.sibling;c=p&~g}else c=0,r.child=null;return mg(e,r,g,a,c)}if((a&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},e!==null&&oc(r,g!==null?g.cachePool:null),g!==null?ym(r,g):Td(),vm(r);else return c=r.lanes=536870912,mg(e,r,g!==null?g.baseLanes|a:a,a,c)}else g!==null?(oc(r,g.cachePool),ym(r,g),ti(),r.memoizedState=null):(e!==null&&oc(r,null),Td(),ti());return Jn(e,r,p,a),r.child}function Il(e,r){return e!==null&&e.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function mg(e,r,a,c,p){var g=Sd();return g=g===null?null:{parent:On._currentValue,pool:g},r.memoizedState={baseLanes:a,cachePool:g},e!==null&&oc(r,null),Td(),vm(r),e!==null&&ga(e,r,c,!0),r.childLanes=p,null}function _c(e,r){return r=Nc({mode:r.mode,children:r.children},e.mode),r.ref=e.ref,e.child=r,r.return=e,r}function gg(e,r,a){return Oi(r,e.child,null,a),e=_c(r,r.pendingProps),e.flags|=2,wr(r),r.memoizedState=null,e}function rw(e,r,a){var c=r.pendingProps,p=(r.flags&128)!==0;if(r.flags&=-129,e===null){if(Ht){if(c.mode==="hidden")return e=_c(r,c),r.lanes=536870912,Il(null,e);if(Rd(r),(e=mn)?(e=Ty(e,Dr),e=e!==null&&e.data==="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Ks!==null?{id:ns,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},a=Zp(e),a.return=r,r.child=a,Qn=r,mn=null)):e=null,e===null)throw Qs(r);return r.lanes=536870912,null}return _c(r,c)}var g=e.memoizedState;if(g!==null){var S=g.dehydrated;if(Rd(r),p)if(r.flags&256)r.flags&=-257,r=gg(e,r,a);else if(r.memoizedState!==null)r.child=e.child,r.flags|=128,r=null;else throw Error(l(558));else if(Mn||ga(e,r,a,!1),p=(a&e.childLanes)!==0,Mn||p){if(c=un,c!==null&&(S=Qt(c,a),S!==0&&S!==g.retryLane))throw g.retryLane=S,_i(e,S),mr(c,e,S),Jd;zc(),r=gg(e,r,a)}else e=g.treeContext,mn=zr(S.nextSibling),Qn=r,Ht=!0,Ys=null,Dr=!1,e!==null&&nm(r,e),r=_c(r,c),r.flags|=4096;return r}return e=fs(e.child,{mode:c.mode,children:c.children}),e.ref=r.ref,r.child=e,e.return=r,e}function Cc(e,r){var a=r.ref;if(a===null)e!==null&&e.ref!==null&&(r.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(l(284));(e===null||e.ref!==a)&&(r.flags|=4194816)}}function Xd(e,r,a,c,p){return Ti(r),a=Od(e,r,a,c,void 0,p),c=Dd(),e!==null&&!Mn?(Md(e,r,p),xs(e,r,p)):(Ht&&c&&fd(r),r.flags|=1,Jn(e,r,a,p),r.child)}function yg(e,r,a,c,p,g){return Ti(r),r.updateQueue=null,a=bm(r,c,a,p),xm(e),c=Dd(),e!==null&&!Mn?(Md(e,r,g),xs(e,r,g)):(Ht&&c&&fd(r),r.flags|=1,Jn(e,r,a,g),r.child)}function vg(e,r,a,c,p){if(Ti(r),r.stateNode===null){var g=ha,S=a.contextType;typeof S=="object"&&S!==null&&(g=Wn(S)),g=new a(c,g),r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Qd,r.stateNode=g,g._reactInternals=r,g=r.stateNode,g.props=c,g.state=r.memoizedState,g.refs={},_d(r),S=a.contextType,g.context=typeof S=="object"&&S!==null?Wn(S):ha,g.state=r.memoizedState,S=a.getDerivedStateFromProps,typeof S=="function"&&(Yd(r,a,S,c),g.state=r.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(S=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),S!==g.state&&Qd.enqueueReplaceState(g,g.state,null),Dl(r,c,g,p),Ol(),g.state=r.memoizedState),typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(e===null){g=r.stateNode;var k=r.memoizedProps,Q=Mi(a,k);g.props=Q;var he=g.context,je=a.contextType;S=ha,typeof je=="object"&&je!==null&&(S=Wn(je));var ke=a.getDerivedStateFromProps;je=typeof ke=="function"||typeof g.getSnapshotBeforeUpdate=="function",k=r.pendingProps!==k,je||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(k||he!==S)&&sg(r,g,c,S),Js=!1;var pe=r.memoizedState;g.state=pe,Dl(r,c,g,p),Ol(),he=r.memoizedState,k||pe!==he||Js?(typeof ke=="function"&&(Yd(r,a,ke,c),he=r.memoizedState),(Q=Js||rg(r,a,Q,c,pe,he,S))?(je||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=he),g.props=c,g.state=he,g.context=S,c=Q):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{g=r.stateNode,Cd(e,r),S=r.memoizedProps,je=Mi(a,S),g.props=je,ke=r.pendingProps,pe=g.context,he=a.contextType,Q=ha,typeof he=="object"&&he!==null&&(Q=Wn(he)),k=a.getDerivedStateFromProps,(he=typeof k=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(S!==ke||pe!==Q)&&sg(r,g,c,Q),Js=!1,pe=r.memoizedState,g.state=pe,Dl(r,c,g,p),Ol();var xe=r.memoizedState;S!==ke||pe!==xe||Js||e!==null&&e.dependencies!==null&&ac(e.dependencies)?(typeof k=="function"&&(Yd(r,a,k,c),xe=r.memoizedState),(je=Js||rg(r,a,je,c,pe,xe,Q)||e!==null&&e.dependencies!==null&&ac(e.dependencies))?(he||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,xe,Q),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,xe,Q)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||S===e.memoizedProps&&pe===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&pe===e.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=xe),g.props=c,g.state=xe,g.context=Q,c=je):(typeof g.componentDidUpdate!="function"||S===e.memoizedProps&&pe===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&pe===e.memoizedState||(r.flags|=1024),c=!1)}return g=c,Cc(e,r),c=(r.flags&128)!==0,g||c?(g=r.stateNode,a=c&&typeof a.getDerivedStateFromError!="function"?null:g.render(),r.flags|=1,e!==null&&c?(r.child=Oi(r,e.child,null,p),r.child=Oi(r,null,a,p)):Jn(e,r,a,p),r.memoizedState=g.state,e=r.child):e=xs(e,r,p),e}function xg(e,r,a,c){return Ni(),r.flags|=256,Jn(e,r,a,c),r.child}var Zd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function eh(e){return{baseLanes:e,cachePool:om()}}function th(e,r,a){return e=e!==null?e.childLanes&~a:0,r&&(e|=jr),e}function bg(e,r,a){var c=r.pendingProps,p=!1,g=(r.flags&128)!==0,S;if((S=g)||(S=e!==null&&e.memoizedState===null?!1:(Tn.current&2)!==0),S&&(p=!0,r.flags&=-129),S=(r.flags&32)!==0,r.flags&=-33,e===null){if(Ht){if(p?ei(r):ti(),(e=mn)?(e=Ty(e,Dr),e=e!==null&&e.data!=="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Ks!==null?{id:ns,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},a=Zp(e),a.return=r,r.child=a,Qn=r,mn=null)):e=null,e===null)throw Qs(r);return Lh(e)?r.lanes=32:r.lanes=536870912,null}var k=c.children;return c=c.fallback,p?(ti(),p=r.mode,k=Nc({mode:"hidden",children:k},p),c=Ci(c,p,a,null),k.return=r,c.return=r,k.sibling=c,r.child=k,c=r.child,c.memoizedState=eh(a),c.childLanes=th(e,S,a),r.memoizedState=Zd,Il(null,c)):(ei(r),nh(r,k))}var Q=e.memoizedState;if(Q!==null&&(k=Q.dehydrated,k!==null)){if(g)r.flags&256?(ei(r),r.flags&=-257,r=rh(e,r,a)):r.memoizedState!==null?(ti(),r.child=e.child,r.flags|=128,r=null):(ti(),k=c.fallback,p=r.mode,c=Nc({mode:"visible",children:c.children},p),k=Ci(k,p,a,null),k.flags|=2,c.return=r,k.return=r,c.sibling=k,r.child=c,Oi(r,e.child,null,a),c=r.child,c.memoizedState=eh(a),c.childLanes=th(e,S,a),r.memoizedState=Zd,r=Il(null,c));else if(ei(r),Lh(k)){if(S=k.nextSibling&&k.nextSibling.dataset,S)var he=S.dgst;S=he,c=Error(l(419)),c.stack="",c.digest=S,Nl({value:c,source:null,stack:null}),r=rh(e,r,a)}else if(Mn||ga(e,r,a,!1),S=(a&e.childLanes)!==0,Mn||S){if(S=un,S!==null&&(c=Qt(S,a),c!==0&&c!==Q.retryLane))throw Q.retryLane=c,_i(e,c),mr(S,e,c),Jd;Uh(k)||zc(),r=rh(e,r,a)}else Uh(k)?(r.flags|=192,r.child=e.child,r=null):(e=Q.treeContext,mn=zr(k.nextSibling),Qn=r,Ht=!0,Ys=null,Dr=!1,e!==null&&nm(r,e),r=nh(r,c.children),r.flags|=4096);return r}return p?(ti(),k=c.fallback,p=r.mode,Q=e.child,he=Q.sibling,c=fs(Q,{mode:"hidden",children:c.children}),c.subtreeFlags=Q.subtreeFlags&65011712,he!==null?k=fs(he,k):(k=Ci(k,p,a,null),k.flags|=2),k.return=r,c.return=r,c.sibling=k,r.child=c,Il(null,c),c=r.child,k=e.child.memoizedState,k===null?k=eh(a):(p=k.cachePool,p!==null?(Q=On._currentValue,p=p.parent!==Q?{parent:Q,pool:Q}:p):p=om(),k={baseLanes:k.baseLanes|a,cachePool:p}),c.memoizedState=k,c.childLanes=th(e,S,a),r.memoizedState=Zd,Il(e.child,c)):(ei(r),a=e.child,e=a.sibling,a=fs(a,{mode:"visible",children:c.children}),a.return=r,a.sibling=null,e!==null&&(S=r.deletions,S===null?(r.deletions=[e],r.flags|=16):S.push(e)),r.child=a,r.memoizedState=null,a)}function nh(e,r){return r=Nc({mode:"visible",children:r},e.mode),r.return=e,e.child=r}function Nc(e,r){return e=xr(22,e,null,r),e.lanes=0,e}function rh(e,r,a){return Oi(r,e.child,null,a),e=nh(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function wg(e,r,a){e.lanes|=r;var c=e.alternate;c!==null&&(c.lanes|=r),vd(e.return,r,a)}function sh(e,r,a,c,p,g){var S=e.memoizedState;S===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:p,treeForkCount:g}:(S.isBackwards=r,S.rendering=null,S.renderingStartTime=0,S.last=c,S.tail=a,S.tailMode=p,S.treeForkCount=g)}function Sg(e,r,a){var c=r.pendingProps,p=c.revealOrder,g=c.tail;c=c.children;var S=Tn.current,k=(S&2)!==0;if(k?(S=S&1|2,r.flags|=128):S&=1,Z(Tn,S),Jn(e,r,c,a),c=Ht?Cl:0,!k&&e!==null&&(e.flags&128)!==0)e:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&wg(e,a,r);else if(e.tag===19)wg(e,a,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break e;for(;e.sibling===null;){if(e.return===null||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(p){case"forwards":for(a=r.child,p=null;a!==null;)e=a.alternate,e!==null&&pc(e)===null&&(p=a),a=a.sibling;a=p,a===null?(p=r.child,r.child=null):(p=a.sibling,a.sibling=null),sh(r,!1,p,a,g,c);break;case"backwards":case"unstable_legacy-backwards":for(a=null,p=r.child,r.child=null;p!==null;){if(e=p.alternate,e!==null&&pc(e)===null){r.child=p;break}e=p.sibling,p.sibling=a,a=p,p=e}sh(r,!0,a,null,g,c);break;case"together":sh(r,!1,null,null,void 0,c);break;default:r.memoizedState=null}return r.child}function xs(e,r,a){if(e!==null&&(r.dependencies=e.dependencies),si|=r.lanes,(a&r.childLanes)===0)if(e!==null){if(ga(e,r,a,!1),(a&r.childLanes)===0)return null}else return null;if(e!==null&&r.child!==e.child)throw Error(l(153));if(r.child!==null){for(e=r.child,a=fs(e,e.pendingProps),r.child=a,a.return=r;e.sibling!==null;)e=e.sibling,a=a.sibling=fs(e,e.pendingProps),a.return=r;a.sibling=null}return r.child}function ih(e,r){return(e.lanes&r)!==0?!0:(e=e.dependencies,!!(e!==null&&ac(e)))}function sw(e,r,a){switch(r.tag){case 3:A(r,r.stateNode.containerInfo),Ws(r,On,e.memoizedState.cache),Ni();break;case 27:case 5:ce(r);break;case 4:A(r,r.stateNode.containerInfo);break;case 10:Ws(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Rd(r),null;break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(ei(r),r.flags|=128,null):(a&r.child.childLanes)!==0?bg(e,r,a):(ei(r),e=xs(e,r,a),e!==null?e.sibling:null);ei(r);break;case 19:var p=(e.flags&128)!==0;if(c=(a&r.childLanes)!==0,c||(ga(e,r,a,!1),c=(a&r.childLanes)!==0),p){if(c)return Sg(e,r,a);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Z(Tn,Tn.current),c)break;return null;case 22:return r.lanes=0,pg(e,r,a,r.pendingProps);case 24:Ws(r,On,e.memoizedState.cache)}return xs(e,r,a)}function jg(e,r,a){if(e!==null)if(e.memoizedProps!==r.pendingProps)Mn=!0;else{if(!ih(e,a)&&(r.flags&128)===0)return Mn=!1,sw(e,r,a);Mn=(e.flags&131072)!==0}else Mn=!1,Ht&&(r.flags&1048576)!==0&&tm(r,Cl,r.index);switch(r.lanes=0,r.tag){case 16:e:{var c=r.pendingProps;if(e=Ri(r.elementType),r.type=e,typeof e=="function")ud(e)?(c=Mi(e,c),r.tag=1,r=vg(null,r,e,c,a)):(r.tag=0,r=Xd(null,r,e,c,a));else{if(e!=null){var p=e.$$typeof;if(p===$){r.tag=11,r=dg(null,r,e,c,a);break e}else if(p===M){r.tag=14,r=hg(null,r,e,c,a);break e}}throw r=P(e)||e,Error(l(306,r,""))}}return r;case 0:return Xd(e,r,r.type,r.pendingProps,a);case 1:return c=r.type,p=Mi(c,r.pendingProps),vg(e,r,c,p,a);case 3:e:{if(A(r,r.stateNode.containerInfo),e===null)throw Error(l(387));c=r.pendingProps;var g=r.memoizedState;p=g.element,Cd(e,r),Dl(r,c,null,a);var S=r.memoizedState;if(c=S.cache,Ws(r,On,c),c!==g.cache&&xd(r,[On],a,!0),Ol(),c=S.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:S.cache},r.updateQueue.baseState=g,r.memoizedState=g,r.flags&256){r=xg(e,r,c,a);break e}else if(c!==p){p=Rr(Error(l(424)),r),Nl(p),r=xg(e,r,c,a);break e}else for(e=r.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,mn=zr(e.firstChild),Qn=r,Ht=!0,Ys=null,Dr=!0,a=pm(r,null,c,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Ni(),c===p){r=xs(e,r,a);break e}Jn(e,r,c,a)}r=r.child}return r;case 26:return Cc(e,r),e===null?(a=My(r.type,null,r.pendingProps,null))?r.memoizedState=a:Ht||(a=r.type,e=r.pendingProps,c=qc(ve.current).createElement(a),c[Xe]=r,c[Qe]=e,Xn(c,a,e),Nt(c),r.stateNode=c):r.memoizedState=My(r.type,e.memoizedProps,r.pendingProps,e.memoizedState),null;case 27:return ce(r),e===null&&Ht&&(c=r.stateNode=Ay(r.type,r.pendingProps,ve.current),Qn=r,Dr=!0,p=mn,ci(r.type)?(Ih=p,mn=zr(c.firstChild)):mn=p),Jn(e,r,r.pendingProps.children,a),Cc(e,r),e===null&&(r.flags|=4194304),r.child;case 5:return e===null&&Ht&&((p=c=mn)&&(c=Mw(c,r.type,r.pendingProps,Dr),c!==null?(r.stateNode=c,Qn=r,mn=zr(c.firstChild),Dr=!1,p=!0):p=!1),p||Qs(r)),ce(r),p=r.type,g=r.pendingProps,S=e!==null?e.memoizedProps:null,c=g.children,Dh(p,g)?c=null:S!==null&&Dh(p,S)&&(r.flags|=32),r.memoizedState!==null&&(p=Od(e,r,Qb,null,null,a),Zl._currentValue=p),Cc(e,r),Jn(e,r,c,a),r.child;case 6:return e===null&&Ht&&((e=a=mn)&&(a=zw(a,r.pendingProps,Dr),a!==null?(r.stateNode=a,Qn=r,mn=null,e=!0):e=!1),e||Qs(r)),null;case 13:return bg(e,r,a);case 4:return A(r,r.stateNode.containerInfo),c=r.pendingProps,e===null?r.child=Oi(r,null,c,a):Jn(e,r,c,a),r.child;case 11:return dg(e,r,r.type,r.pendingProps,a);case 7:return Jn(e,r,r.pendingProps,a),r.child;case 8:return Jn(e,r,r.pendingProps.children,a),r.child;case 12:return Jn(e,r,r.pendingProps.children,a),r.child;case 10:return c=r.pendingProps,Ws(r,r.type,c.value),Jn(e,r,c.children,a),r.child;case 9:return p=r.type._context,c=r.pendingProps.children,Ti(r),p=Wn(p),c=c(p),r.flags|=1,Jn(e,r,c,a),r.child;case 14:return hg(e,r,r.type,r.pendingProps,a);case 15:return fg(e,r,r.type,r.pendingProps,a);case 19:return Sg(e,r,a);case 31:return rw(e,r,a);case 22:return pg(e,r,a,r.pendingProps);case 24:return Ti(r),c=Wn(On),e===null?(p=Sd(),p===null&&(p=un,g=bd(),p.pooledCache=g,g.refCount++,g!==null&&(p.pooledCacheLanes|=a),p=g),r.memoizedState={parent:c,cache:p},_d(r),Ws(r,On,p)):((e.lanes&a)!==0&&(Cd(e,r),Dl(r,null,null,a),Ol()),p=e.memoizedState,g=r.memoizedState,p.parent!==c?(p={parent:c,cache:c},r.memoizedState=p,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=p),Ws(r,On,c)):(c=g.cache,Ws(r,On,c),c!==p.cache&&xd(r,[On],a,!0))),Jn(e,r,r.pendingProps.children,a),r.child;case 29:throw r.pendingProps}throw Error(l(156,r.tag))}function bs(e){e.flags|=4}function ah(e,r,a,c,p){if((r=(e.mode&32)!==0)&&(r=!1),r){if(e.flags|=16777216,(p&335544128)===p)if(e.stateNode.complete)e.flags|=8192;else if(Wg())e.flags|=8192;else throw Ai=uc,jd}else e.flags&=-16777217}function _g(e,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!By(r))if(Wg())e.flags|=8192;else throw Ai=uc,jd}function Ec(e,r){r!==null&&(e.flags|=4),e.flags&16384&&(r=e.tag!==22?Rt():536870912,e.lanes|=r,Ta|=r)}function Bl(e,r){if(!Ht)switch(e.tailMode){case"hidden":r=e.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function gn(e){var r=e.alternate!==null&&e.alternate.child===e.child,a=0,c=0;if(r)for(var p=e.child;p!==null;)a|=p.lanes|p.childLanes,c|=p.subtreeFlags&65011712,c|=p.flags&65011712,p.return=e,p=p.sibling;else for(p=e.child;p!==null;)a|=p.lanes|p.childLanes,c|=p.subtreeFlags,c|=p.flags,p.return=e,p=p.sibling;return e.subtreeFlags|=c,e.childLanes=a,r}function iw(e,r,a){var c=r.pendingProps;switch(pd(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gn(r),null;case 1:return gn(r),null;case 3:return a=r.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),gs(On),X(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(ma(r)?bs(r):e===null||e.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,gd())),gn(r),null;case 26:var p=r.type,g=r.memoizedState;return e===null?(bs(r),g!==null?(gn(r),_g(r,g)):(gn(r),ah(r,p,null,c,a))):g?g!==e.memoizedState?(bs(r),gn(r),_g(r,g)):(gn(r),r.flags&=-16777217):(e=e.memoizedProps,e!==c&&bs(r),gn(r),ah(r,p,e,c,a)),null;case 27:if(Se(r),a=ve.current,p=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(!c){if(r.stateNode===null)throw Error(l(166));return gn(r),null}e=ge.current,ma(r)?rm(r):(e=Ay(p,c,a),r.stateNode=e,bs(r))}return gn(r),null;case 5:if(Se(r),p=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(!c){if(r.stateNode===null)throw Error(l(166));return gn(r),null}if(g=ge.current,ma(r))rm(r);else{var S=qc(ve.current);switch(g){case 1:g=S.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:g=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":g=S.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":g=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":g=S.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof c.is=="string"?S.createElement("select",{is:c.is}):S.createElement("select"),c.multiple?g.multiple=!0:c.size&&(g.size=c.size);break;default:g=typeof c.is=="string"?S.createElement(p,{is:c.is}):S.createElement(p)}}g[Xe]=r,g[Qe]=c;e:for(S=r.child;S!==null;){if(S.tag===5||S.tag===6)g.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===r)break e;for(;S.sibling===null;){if(S.return===null||S.return===r)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}r.stateNode=g;e:switch(Xn(g,p,c),p){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&bs(r)}}return gn(r),ah(r,r.type,e===null?null:e.memoizedProps,r.pendingProps,a),null;case 6:if(e&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(l(166));if(e=ve.current,ma(r)){if(e=r.stateNode,a=r.memoizedProps,c=null,p=Qn,p!==null)switch(p.tag){case 27:case 5:c=p.memoizedProps}e[Xe]=r,e=!!(e.nodeValue===a||c!==null&&c.suppressHydrationWarning===!0||by(e.nodeValue,a)),e||Qs(r,!0)}else e=qc(e).createTextNode(c),e[Xe]=r,r.stateNode=e}return gn(r),null;case 31:if(a=r.memoizedState,e===null||e.memoizedState!==null){if(c=ma(r),a!==null){if(e===null){if(!c)throw Error(l(318));if(e=r.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(557));e[Xe]=r}else Ni(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;gn(r),e=!1}else a=gd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return r.flags&256?(wr(r),r):(wr(r),null);if((r.flags&128)!==0)throw Error(l(558))}return gn(r),null;case 13:if(c=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(p=ma(r),c!==null&&c.dehydrated!==null){if(e===null){if(!p)throw Error(l(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(l(317));p[Xe]=r}else Ni(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;gn(r),p=!1}else p=gd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=p),p=!0;if(!p)return r.flags&256?(wr(r),r):(wr(r),null)}return wr(r),(r.flags&128)!==0?(r.lanes=a,r):(a=c!==null,e=e!==null&&e.memoizedState!==null,a&&(c=r.child,p=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(p=c.alternate.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==p&&(c.flags|=2048)),a!==e&&a&&(r.child.flags|=8192),Ec(r,r.updateQueue),gn(r),null);case 4:return X(),e===null&&Th(r.stateNode.containerInfo),gn(r),null;case 10:return gs(r.type),gn(r),null;case 19:if(J(Tn),c=r.memoizedState,c===null)return gn(r),null;if(p=(r.flags&128)!==0,g=c.rendering,g===null)if(p)Bl(c,!1);else{if(_n!==0||e!==null&&(e.flags&128)!==0)for(e=r.child;e!==null;){if(g=pc(e),g!==null){for(r.flags|=128,Bl(c,!1),e=g.updateQueue,r.updateQueue=e,Ec(r,e),r.subtreeFlags=0,e=a,a=r.child;a!==null;)Xp(a,e),a=a.sibling;return Z(Tn,Tn.current&1|2),Ht&&ps(r,c.treeForkCount),r.child}e=e.sibling}c.tail!==null&&St()>Oc&&(r.flags|=128,p=!0,Bl(c,!1),r.lanes=4194304)}else{if(!p)if(e=pc(g),e!==null){if(r.flags|=128,p=!0,e=e.updateQueue,r.updateQueue=e,Ec(r,e),Bl(c,!0),c.tail===null&&c.tailMode==="hidden"&&!g.alternate&&!Ht)return gn(r),null}else 2*St()-c.renderingStartTime>Oc&&a!==536870912&&(r.flags|=128,p=!0,Bl(c,!1),r.lanes=4194304);c.isBackwards?(g.sibling=r.child,r.child=g):(e=c.last,e!==null?e.sibling=g:r.child=g,c.last=g)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=St(),e.sibling=null,a=Tn.current,Z(Tn,p?a&1|2:a&1),Ht&&ps(r,c.treeForkCount),e):(gn(r),null);case 22:case 23:return wr(r),kd(),c=r.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(a&536870912)!==0&&(r.flags&128)===0&&(gn(r),r.subtreeFlags&6&&(r.flags|=8192)):gn(r),a=r.updateQueue,a!==null&&Ec(r,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==a&&(r.flags|=2048),e!==null&&J(ki),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),r.memoizedState.cache!==a&&(r.flags|=2048),gs(On),gn(r),null;case 25:return null;case 30:return null}throw Error(l(156,r.tag))}function aw(e,r){switch(pd(r),r.tag){case 1:return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return gs(On),X(),e=r.flags,(e&65536)!==0&&(e&128)===0?(r.flags=e&-65537|128,r):null;case 26:case 27:case 5:return Se(r),null;case 31:if(r.memoizedState!==null){if(wr(r),r.alternate===null)throw Error(l(340));Ni()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 13:if(wr(r),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(l(340));Ni()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return J(Tn),null;case 4:return X(),null;case 10:return gs(r.type),null;case 22:case 23:return wr(r),kd(),e!==null&&J(ki),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 24:return gs(On),null;case 25:return null;default:return null}}function Cg(e,r){switch(pd(r),r.tag){case 3:gs(On),X();break;case 26:case 27:case 5:Se(r);break;case 4:X();break;case 31:r.memoizedState!==null&&wr(r);break;case 13:wr(r);break;case 19:J(Tn);break;case 10:gs(r.type);break;case 22:case 23:wr(r),kd(),e!==null&&J(ki);break;case 24:gs(On)}}function $l(e,r){try{var a=r.updateQueue,c=a!==null?a.lastEffect:null;if(c!==null){var p=c.next;a=p;do{if((a.tag&e)===e){c=void 0;var g=a.create,S=a.inst;c=g(),S.destroy=c}a=a.next}while(a!==p)}}catch(k){en(r,r.return,k)}}function ni(e,r,a){try{var c=r.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var g=p.next;c=g;do{if((c.tag&e)===e){var S=c.inst,k=S.destroy;if(k!==void 0){S.destroy=void 0,p=r;var Q=a,he=k;try{he()}catch(je){en(p,Q,je)}}}c=c.next}while(c!==g)}}catch(je){en(r,r.return,je)}}function Ng(e){var r=e.updateQueue;if(r!==null){var a=e.stateNode;try{gm(r,a)}catch(c){en(e,e.return,c)}}}function Eg(e,r,a){a.props=Mi(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(c){en(e,r,c)}}function Pl(e,r){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof a=="function"?e.refCleanup=a(c):a.current=c}}catch(p){en(e,r,p)}}function ss(e,r){var a=e.ref,c=e.refCleanup;if(a!==null)if(typeof c=="function")try{c()}catch(p){en(e,r,p)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(p){en(e,r,p)}else a.current=null}function Tg(e){var r=e.type,a=e.memoizedProps,c=e.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":a.autoFocus&&c.focus();break e;case"img":a.src?c.src=a.src:a.srcSet&&(c.srcset=a.srcSet)}}catch(p){en(e,e.return,p)}}function lh(e,r,a){try{var c=e.stateNode;Tw(c,e.type,a,r),c[Qe]=r}catch(p){en(e,e.return,p)}}function kg(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&ci(e.type)||e.tag===4}function oh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||kg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&ci(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ch(e,r,a){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,r):(r=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,r.appendChild(e),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=Fr));else if(c!==4&&(c===27&&ci(e.type)&&(a=e.stateNode,r=null),e=e.child,e!==null))for(ch(e,r,a),e=e.sibling;e!==null;)ch(e,r,a),e=e.sibling}function Tc(e,r,a){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?a.insertBefore(e,r):a.appendChild(e);else if(c!==4&&(c===27&&ci(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Tc(e,r,a),e=e.sibling;e!==null;)Tc(e,r,a),e=e.sibling}function Rg(e){var r=e.stateNode,a=e.memoizedProps;try{for(var c=e.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);Xn(r,c,a),r[Xe]=e,r[Qe]=a}catch(g){en(e,e.return,g)}}var ws=!1,zn=!1,uh=!1,Ag=typeof WeakSet=="function"?WeakSet:Set,Fn=null;function lw(e,r){if(e=e.containerInfo,Ah=Qc,e=Fp(e),rd(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var p=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{a.nodeType,g.nodeType}catch{a=null;break e}var S=0,k=-1,Q=-1,he=0,je=0,ke=e,pe=null;t:for(;;){for(var xe;ke!==a||p!==0&&ke.nodeType!==3||(k=S+p),ke!==g||c!==0&&ke.nodeType!==3||(Q=S+c),ke.nodeType===3&&(S+=ke.nodeValue.length),(xe=ke.firstChild)!==null;)pe=ke,ke=xe;for(;;){if(ke===e)break t;if(pe===a&&++he===p&&(k=S),pe===g&&++je===c&&(Q=S),(xe=ke.nextSibling)!==null)break;ke=pe,pe=ke.parentNode}ke=xe}a=k===-1||Q===-1?null:{start:k,end:Q}}else a=null}a=a||{start:0,end:0}}else a=null;for(Oh={focusedElem:e,selectionRange:a},Qc=!1,Fn=r;Fn!==null;)if(r=Fn,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,Fn=e;else for(;Fn!==null;){switch(r=Fn,g=r.alternate,e=r.flags,r.tag){case 0:if((e&4)!==0&&(e=r.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)p=e[a],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,a=r,p=g.memoizedProps,g=g.memoizedState,c=a.stateNode;try{var nt=Mi(a.type,p);e=c.getSnapshotBeforeUpdate(nt,g),c.__reactInternalSnapshotBeforeUpdate=e}catch(vt){en(a,a.return,vt)}}break;case 3:if((e&1024)!==0){if(e=r.stateNode.containerInfo,a=e.nodeType,a===9)zh(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":zh(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(l(163))}if(e=r.sibling,e!==null){e.return=r.return,Fn=e;break}Fn=r.return}}function Og(e,r,a){var c=a.flags;switch(a.tag){case 0:case 11:case 15:js(e,a),c&4&&$l(5,a);break;case 1:if(js(e,a),c&4)if(e=a.stateNode,r===null)try{e.componentDidMount()}catch(S){en(a,a.return,S)}else{var p=Mi(a.type,r.memoizedProps);r=r.memoizedState;try{e.componentDidUpdate(p,r,e.__reactInternalSnapshotBeforeUpdate)}catch(S){en(a,a.return,S)}}c&64&&Ng(a),c&512&&Pl(a,a.return);break;case 3:if(js(e,a),c&64&&(e=a.updateQueue,e!==null)){if(r=null,a.child!==null)switch(a.child.tag){case 27:case 5:r=a.child.stateNode;break;case 1:r=a.child.stateNode}try{gm(e,r)}catch(S){en(a,a.return,S)}}break;case 27:r===null&&c&4&&Rg(a);case 26:case 5:js(e,a),r===null&&c&4&&Tg(a),c&512&&Pl(a,a.return);break;case 12:js(e,a);break;case 31:js(e,a),c&4&&zg(e,a);break;case 13:js(e,a),c&4&&Ug(e,a),c&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=gw.bind(null,a),Uw(e,a))));break;case 22:if(c=a.memoizedState!==null||ws,!c){r=r!==null&&r.memoizedState!==null||zn,p=ws;var g=zn;ws=c,(zn=r)&&!g?_s(e,a,(a.subtreeFlags&8772)!==0):js(e,a),ws=p,zn=g}break;case 30:break;default:js(e,a)}}function Dg(e){var r=e.alternate;r!==null&&(e.alternate=null,Dg(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&Ft(r)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var vn=null,dr=!1;function Ss(e,r,a){for(a=a.child;a!==null;)Mg(e,r,a),a=a.sibling}function Mg(e,r,a){if(jt&&typeof jt.onCommitFiberUnmount=="function")try{jt.onCommitFiberUnmount(Sn,a)}catch{}switch(a.tag){case 26:zn||ss(a,r),Ss(e,r,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:zn||ss(a,r);var c=vn,p=dr;ci(a.type)&&(vn=a.stateNode,dr=!1),Ss(e,r,a),Wl(a.stateNode),vn=c,dr=p;break;case 5:zn||ss(a,r);case 6:if(c=vn,p=dr,vn=null,Ss(e,r,a),vn=c,dr=p,vn!==null)if(dr)try{(vn.nodeType===9?vn.body:vn.nodeName==="HTML"?vn.ownerDocument.body:vn).removeChild(a.stateNode)}catch(g){en(a,r,g)}else try{vn.removeChild(a.stateNode)}catch(g){en(a,r,g)}break;case 18:vn!==null&&(dr?(e=vn,Ny(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),Ua(e)):Ny(vn,a.stateNode));break;case 4:c=vn,p=dr,vn=a.stateNode.containerInfo,dr=!0,Ss(e,r,a),vn=c,dr=p;break;case 0:case 11:case 14:case 15:ni(2,a,r),zn||ni(4,a,r),Ss(e,r,a);break;case 1:zn||(ss(a,r),c=a.stateNode,typeof c.componentWillUnmount=="function"&&Eg(a,r,c)),Ss(e,r,a);break;case 21:Ss(e,r,a);break;case 22:zn=(c=zn)||a.memoizedState!==null,Ss(e,r,a),zn=c;break;default:Ss(e,r,a)}}function zg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Ua(e)}catch(a){en(r,r.return,a)}}}function Ug(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Ua(e)}catch(a){en(r,r.return,a)}}function ow(e){switch(e.tag){case 31:case 13:case 19:var r=e.stateNode;return r===null&&(r=e.stateNode=new Ag),r;case 22:return e=e.stateNode,r=e._retryCache,r===null&&(r=e._retryCache=new Ag),r;default:throw Error(l(435,e.tag))}}function kc(e,r){var a=ow(e);r.forEach(function(c){if(!a.has(c)){a.add(c);var p=yw.bind(null,e,c);c.then(p,p)}})}function hr(e,r){var a=r.deletions;if(a!==null)for(var c=0;c<a.length;c++){var p=a[c],g=e,S=r,k=S;e:for(;k!==null;){switch(k.tag){case 27:if(ci(k.type)){vn=k.stateNode,dr=!1;break e}break;case 5:vn=k.stateNode,dr=!1;break e;case 3:case 4:vn=k.stateNode.containerInfo,dr=!0;break e}k=k.return}if(vn===null)throw Error(l(160));Mg(g,S,p),vn=null,dr=!1,g=p.alternate,g!==null&&(g.return=null),p.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Lg(r,e),r=r.sibling}var Gr=null;function Lg(e,r){var a=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:hr(r,e),fr(e),c&4&&(ni(3,e,e.return),$l(3,e),ni(5,e,e.return));break;case 1:hr(r,e),fr(e),c&512&&(zn||a===null||ss(a,a.return)),c&64&&ws&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?c:a.concat(c))));break;case 26:var p=Gr;if(hr(r,e),fr(e),c&512&&(zn||a===null||ss(a,a.return)),c&4){var g=a!==null?a.memoizedState:null;if(c=e.memoizedState,a===null)if(c===null)if(e.stateNode===null){e:{c=e.type,a=e.memoizedProps,p=p.ownerDocument||p;t:switch(c){case"title":g=p.getElementsByTagName("title")[0],(!g||g[ht]||g[Xe]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=p.createElement(c),p.head.insertBefore(g,p.querySelector("head > title"))),Xn(g,c,a),g[Xe]=e,Nt(g),c=g;break e;case"link":var S=Ly("link","href",p).get(c+(a.href||""));if(S){for(var k=0;k<S.length;k++)if(g=S[k],g.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&g.getAttribute("rel")===(a.rel==null?null:a.rel)&&g.getAttribute("title")===(a.title==null?null:a.title)&&g.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){S.splice(k,1);break t}}g=p.createElement(c),Xn(g,c,a),p.head.appendChild(g);break;case"meta":if(S=Ly("meta","content",p).get(c+(a.content||""))){for(k=0;k<S.length;k++)if(g=S[k],g.getAttribute("content")===(a.content==null?null:""+a.content)&&g.getAttribute("name")===(a.name==null?null:a.name)&&g.getAttribute("property")===(a.property==null?null:a.property)&&g.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&g.getAttribute("charset")===(a.charSet==null?null:a.charSet)){S.splice(k,1);break t}}g=p.createElement(c),Xn(g,c,a),p.head.appendChild(g);break;default:throw Error(l(468,c))}g[Xe]=e,Nt(g),c=g}e.stateNode=c}else Iy(p,e.type,e.stateNode);else e.stateNode=Uy(p,c,e.memoizedProps);else g!==c?(g===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):g.count--,c===null?Iy(p,e.type,e.stateNode):Uy(p,c,e.memoizedProps)):c===null&&e.stateNode!==null&&lh(e,e.memoizedProps,a.memoizedProps)}break;case 27:hr(r,e),fr(e),c&512&&(zn||a===null||ss(a,a.return)),a!==null&&c&4&&lh(e,e.memoizedProps,a.memoizedProps);break;case 5:if(hr(r,e),fr(e),c&512&&(zn||a===null||ss(a,a.return)),e.flags&32){p=e.stateNode;try{us(p,"")}catch(nt){en(e,e.return,nt)}}c&4&&e.stateNode!=null&&(p=e.memoizedProps,lh(e,p,a!==null?a.memoizedProps:p)),c&1024&&(uh=!0);break;case 6:if(hr(r,e),fr(e),c&4){if(e.stateNode===null)throw Error(l(162));c=e.memoizedProps,a=e.stateNode;try{a.nodeValue=c}catch(nt){en(e,e.return,nt)}}break;case 3:if(Gc=null,p=Gr,Gr=Fc(r.containerInfo),hr(r,e),Gr=p,fr(e),c&4&&a!==null&&a.memoizedState.isDehydrated)try{Ua(r.containerInfo)}catch(nt){en(e,e.return,nt)}uh&&(uh=!1,Ig(e));break;case 4:c=Gr,Gr=Fc(e.stateNode.containerInfo),hr(r,e),fr(e),Gr=c;break;case 12:hr(r,e),fr(e);break;case 31:hr(r,e),fr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,kc(e,c)));break;case 13:hr(r,e),fr(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Ac=St()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,kc(e,c)));break;case 22:p=e.memoizedState!==null;var Q=a!==null&&a.memoizedState!==null,he=ws,je=zn;if(ws=he||p,zn=je||Q,hr(r,e),zn=je,ws=he,fr(e),c&8192)e:for(r=e.stateNode,r._visibility=p?r._visibility&-2:r._visibility|1,p&&(a===null||Q||ws||zn||zi(e)),a=null,r=e;;){if(r.tag===5||r.tag===26){if(a===null){Q=a=r;try{if(g=Q.stateNode,p)S=g.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{k=Q.stateNode;var ke=Q.memoizedProps.style,pe=ke!=null&&ke.hasOwnProperty("display")?ke.display:null;k.style.display=pe==null||typeof pe=="boolean"?"":(""+pe).trim()}}catch(nt){en(Q,Q.return,nt)}}}else if(r.tag===6){if(a===null){Q=r;try{Q.stateNode.nodeValue=p?"":Q.memoizedProps}catch(nt){en(Q,Q.return,nt)}}}else if(r.tag===18){if(a===null){Q=r;try{var xe=Q.stateNode;p?Ey(xe,!0):Ey(Q.stateNode,!1)}catch(nt){en(Q,Q.return,nt)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;a===r&&(a=null),r=r.return}a===r&&(a=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=e.updateQueue,c!==null&&(a=c.retryQueue,a!==null&&(c.retryQueue=null,kc(e,a))));break;case 19:hr(r,e),fr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,kc(e,c)));break;case 30:break;case 21:break;default:hr(r,e),fr(e)}}function fr(e){var r=e.flags;if(r&2){try{for(var a,c=e.return;c!==null;){if(kg(c)){a=c;break}c=c.return}if(a==null)throw Error(l(160));switch(a.tag){case 27:var p=a.stateNode,g=oh(e);Tc(e,g,p);break;case 5:var S=a.stateNode;a.flags&32&&(us(S,""),a.flags&=-33);var k=oh(e);Tc(e,k,S);break;case 3:case 4:var Q=a.stateNode.containerInfo,he=oh(e);ch(e,he,Q);break;default:throw Error(l(161))}}catch(je){en(e,e.return,je)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function Ig(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var r=e;Ig(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),e=e.sibling}}function js(e,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Og(e,r.alternate,r),r=r.sibling}function zi(e){for(e=e.child;e!==null;){var r=e;switch(r.tag){case 0:case 11:case 14:case 15:ni(4,r,r.return),zi(r);break;case 1:ss(r,r.return);var a=r.stateNode;typeof a.componentWillUnmount=="function"&&Eg(r,r.return,a),zi(r);break;case 27:Wl(r.stateNode);case 26:case 5:ss(r,r.return),zi(r);break;case 22:r.memoizedState===null&&zi(r);break;case 30:zi(r);break;default:zi(r)}e=e.sibling}}function _s(e,r,a){for(a=a&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,p=e,g=r,S=g.flags;switch(g.tag){case 0:case 11:case 15:_s(p,g,a),$l(4,g);break;case 1:if(_s(p,g,a),c=g,p=c.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(he){en(c,c.return,he)}if(c=g,p=c.updateQueue,p!==null){var k=c.stateNode;try{var Q=p.shared.hiddenCallbacks;if(Q!==null)for(p.shared.hiddenCallbacks=null,p=0;p<Q.length;p++)mm(Q[p],k)}catch(he){en(c,c.return,he)}}a&&S&64&&Ng(g),Pl(g,g.return);break;case 27:Rg(g);case 26:case 5:_s(p,g,a),a&&c===null&&S&4&&Tg(g),Pl(g,g.return);break;case 12:_s(p,g,a);break;case 31:_s(p,g,a),a&&S&4&&zg(p,g);break;case 13:_s(p,g,a),a&&S&4&&Ug(p,g);break;case 22:g.memoizedState===null&&_s(p,g,a),Pl(g,g.return);break;case 30:break;default:_s(p,g,a)}r=r.sibling}}function dh(e,r){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(e=r.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&El(a))}function hh(e,r){e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&El(e))}function Vr(e,r,a,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Bg(e,r,a,c),r=r.sibling}function Bg(e,r,a,c){var p=r.flags;switch(r.tag){case 0:case 11:case 15:Vr(e,r,a,c),p&2048&&$l(9,r);break;case 1:Vr(e,r,a,c);break;case 3:Vr(e,r,a,c),p&2048&&(e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&El(e)));break;case 12:if(p&2048){Vr(e,r,a,c),e=r.stateNode;try{var g=r.memoizedProps,S=g.id,k=g.onPostCommit;typeof k=="function"&&k(S,r.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(Q){en(r,r.return,Q)}}else Vr(e,r,a,c);break;case 31:Vr(e,r,a,c);break;case 13:Vr(e,r,a,c);break;case 23:break;case 22:g=r.stateNode,S=r.alternate,r.memoizedState!==null?g._visibility&2?Vr(e,r,a,c):ql(e,r):g._visibility&2?Vr(e,r,a,c):(g._visibility|=2,Ca(e,r,a,c,(r.subtreeFlags&10256)!==0||!1)),p&2048&&dh(S,r);break;case 24:Vr(e,r,a,c),p&2048&&hh(r.alternate,r);break;default:Vr(e,r,a,c)}}function Ca(e,r,a,c,p){for(p=p&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var g=e,S=r,k=a,Q=c,he=S.flags;switch(S.tag){case 0:case 11:case 15:Ca(g,S,k,Q,p),$l(8,S);break;case 23:break;case 22:var je=S.stateNode;S.memoizedState!==null?je._visibility&2?Ca(g,S,k,Q,p):ql(g,S):(je._visibility|=2,Ca(g,S,k,Q,p)),p&&he&2048&&dh(S.alternate,S);break;case 24:Ca(g,S,k,Q,p),p&&he&2048&&hh(S.alternate,S);break;default:Ca(g,S,k,Q,p)}r=r.sibling}}function ql(e,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var a=e,c=r,p=c.flags;switch(c.tag){case 22:ql(a,c),p&2048&&dh(c.alternate,c);break;case 24:ql(a,c),p&2048&&hh(c.alternate,c);break;default:ql(a,c)}r=r.sibling}}var Fl=8192;function Na(e,r,a){if(e.subtreeFlags&Fl)for(e=e.child;e!==null;)$g(e,r,a),e=e.sibling}function $g(e,r,a){switch(e.tag){case 26:Na(e,r,a),e.flags&Fl&&e.memoizedState!==null&&Yw(a,Gr,e.memoizedState,e.memoizedProps);break;case 5:Na(e,r,a);break;case 3:case 4:var c=Gr;Gr=Fc(e.stateNode.containerInfo),Na(e,r,a),Gr=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=Fl,Fl=16777216,Na(e,r,a),Fl=c):Na(e,r,a));break;default:Na(e,r,a)}}function Pg(e){var r=e.alternate;if(r!==null&&(e=r.child,e!==null)){r.child=null;do r=e.sibling,e.sibling=null,e=r;while(e!==null)}}function Hl(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var c=r[a];Fn=c,Fg(c,e)}Pg(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)qg(e),e=e.sibling}function qg(e){switch(e.tag){case 0:case 11:case 15:Hl(e),e.flags&2048&&ni(9,e,e.return);break;case 3:Hl(e);break;case 12:Hl(e);break;case 22:var r=e.stateNode;e.memoizedState!==null&&r._visibility&2&&(e.return===null||e.return.tag!==13)?(r._visibility&=-3,Rc(e)):Hl(e);break;default:Hl(e)}}function Rc(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var c=r[a];Fn=c,Fg(c,e)}Pg(e)}for(e=e.child;e!==null;){switch(r=e,r.tag){case 0:case 11:case 15:ni(8,r,r.return),Rc(r);break;case 22:a=r.stateNode,a._visibility&2&&(a._visibility&=-3,Rc(r));break;default:Rc(r)}e=e.sibling}}function Fg(e,r){for(;Fn!==null;){var a=Fn;switch(a.tag){case 0:case 11:case 15:ni(8,a,r);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var c=a.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:El(a.memoizedState.cache)}if(c=a.child,c!==null)c.return=a,Fn=c;else e:for(a=e;Fn!==null;){c=Fn;var p=c.sibling,g=c.return;if(Dg(c),c===a){Fn=null;break e}if(p!==null){p.return=g,Fn=p;break e}Fn=g}}}var cw={getCacheForType:function(e){var r=Wn(On),a=r.data.get(e);return a===void 0&&(a=e(),r.data.set(e,a)),a},cacheSignal:function(){return Wn(On).controller.signal}},uw=typeof WeakMap=="function"?WeakMap:Map,Wt=0,un=null,Lt=null,Pt=0,Zt=0,Sr=null,ri=!1,Ea=!1,fh=!1,Cs=0,_n=0,si=0,Ui=0,ph=0,jr=0,Ta=0,Gl=null,pr=null,mh=!1,Ac=0,Hg=0,Oc=1/0,Dc=null,ii=null,In=0,ai=null,ka=null,Ns=0,gh=0,yh=null,Gg=null,Vl=0,vh=null;function _r(){return(Wt&2)!==0&&Pt!==0?Pt&-Pt:R.T!==null?_h():fe()}function Vg(){if(jr===0)if((Pt&536870912)===0||Ht){var e=Ke;Ke<<=1,(Ke&3932160)===0&&(Ke=262144),jr=e}else jr=536870912;return e=br.current,e!==null&&(e.flags|=32),jr}function mr(e,r,a){(e===un&&(Zt===2||Zt===9)||e.cancelPendingCommit!==null)&&(Ra(e,0),li(e,Pt,jr,!1)),Bt(e,a),((Wt&2)===0||e!==un)&&(e===un&&((Wt&2)===0&&(Ui|=a),_n===4&&li(e,Pt,jr,!1)),is(e))}function Kg(e,r,a){if((Wt&6)!==0)throw Error(l(327));var c=!a&&(r&127)===0&&(r&e.expiredLanes)===0||Mt(e,r),p=c?fw(e,r):bh(e,r,!0),g=c;do{if(p===0){Ea&&!c&&li(e,r,0,!1);break}else{if(a=e.current.alternate,g&&!dw(a)){p=bh(e,r,!1),g=!1;continue}if(p===2){if(g=r,e.errorRecoveryDisabledLanes&g)var S=0;else S=e.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){r=S;e:{var k=e;p=Gl;var Q=k.current.memoizedState.isDehydrated;if(Q&&(Ra(k,S).flags|=256),S=bh(k,S,!1),S!==2){if(fh&&!Q){k.errorRecoveryDisabledLanes|=g,Ui|=g,p=4;break e}g=pr,pr=p,g!==null&&(pr===null?pr=g:pr.push.apply(pr,g))}p=S}if(g=!1,p!==2)continue}}if(p===1){Ra(e,0),li(e,r,0,!0);break}e:{switch(c=e,g=p,g){case 0:case 1:throw Error(l(345));case 4:if((r&4194048)!==r)break;case 6:li(c,r,jr,!ri);break e;case 2:pr=null;break;case 3:case 5:break;default:throw Error(l(329))}if((r&62914560)===r&&(p=Ac+300-St(),10<p)){if(li(c,r,jr,!ri),tt(c,0,!0)!==0)break e;Ns=r,c.timeoutHandle=_y(Yg.bind(null,c,a,pr,Dc,mh,r,jr,Ui,Ta,ri,g,"Throttled",-0,0),p);break e}Yg(c,a,pr,Dc,mh,r,jr,Ui,Ta,ri,g,null,-0,0)}}break}while(!0);is(e)}function Yg(e,r,a,c,p,g,S,k,Q,he,je,ke,pe,xe){if(e.timeoutHandle=-1,ke=r.subtreeFlags,ke&8192||(ke&16785408)===16785408){ke={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fr},$g(r,g,ke);var nt=(g&62914560)===g?Ac-St():(g&4194048)===g?Hg-St():0;if(nt=Qw(ke,nt),nt!==null){Ns=g,e.cancelPendingCommit=nt(ny.bind(null,e,r,g,a,c,p,S,k,Q,je,ke,null,pe,xe)),li(e,g,S,!he);return}}ny(e,r,g,a,c,p,S,k,Q)}function dw(e){for(var r=e;;){var a=r.tag;if((a===0||a===11||a===15)&&r.flags&16384&&(a=r.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var c=0;c<a.length;c++){var p=a[c],g=p.getSnapshot;p=p.value;try{if(!vr(g(),p))return!1}catch{return!1}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function li(e,r,a,c){r&=~ph,r&=~Ui,e.suspendedLanes|=r,e.pingedLanes&=~r,c&&(e.warmLanes|=r),c=e.expirationTimes;for(var p=r;0<p;){var g=31-cn(p),S=1<<g;c[g]=-1,p&=~S}a!==0&&Ut(e,a,r)}function Mc(){return(Wt&6)===0?(Kl(0),!1):!0}function xh(){if(Lt!==null){if(Zt===0)var e=Lt.return;else e=Lt,ms=Ei=null,zd(e),ba=null,kl=0,e=Lt;for(;e!==null;)Cg(e.alternate,e),e=e.return;Lt=null}}function Ra(e,r){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Aw(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Ns=0,xh(),un=e,Lt=a=fs(e.current,null),Pt=r,Zt=0,Sr=null,ri=!1,Ea=Mt(e,r),fh=!1,Ta=jr=ph=Ui=si=_n=0,pr=Gl=null,mh=!1,(r&8)!==0&&(r|=r&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=r;0<c;){var p=31-cn(c),g=1<<p;r|=e[p],c&=~g}return Cs=r,tc(),a}function Qg(e,r){At=null,R.H=Ll,r===xa||r===cc?(r=dm(),Zt=3):r===jd?(r=dm(),Zt=4):Zt=r===Jd?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Sr=r,Lt===null&&(_n=1,jc(e,Rr(r,e.current)))}function Wg(){var e=br.current;return e===null?!0:(Pt&4194048)===Pt?Mr===null:(Pt&62914560)===Pt||(Pt&536870912)!==0?e===Mr:!1}function Jg(){var e=R.H;return R.H=Ll,e===null?Ll:e}function Xg(){var e=R.A;return R.A=cw,e}function zc(){_n=4,ri||(Pt&4194048)!==Pt&&br.current!==null||(Ea=!0),(si&134217727)===0&&(Ui&134217727)===0||un===null||li(un,Pt,jr,!1)}function bh(e,r,a){var c=Wt;Wt|=2;var p=Jg(),g=Xg();(un!==e||Pt!==r)&&(Dc=null,Ra(e,r)),r=!1;var S=_n;e:do try{if(Zt!==0&&Lt!==null){var k=Lt,Q=Sr;switch(Zt){case 8:xh(),S=6;break e;case 3:case 2:case 9:case 6:br.current===null&&(r=!0);var he=Zt;if(Zt=0,Sr=null,Aa(e,k,Q,he),a&&Ea){S=0;break e}break;default:he=Zt,Zt=0,Sr=null,Aa(e,k,Q,he)}}hw(),S=_n;break}catch(je){Qg(e,je)}while(!0);return r&&e.shellSuspendCounter++,ms=Ei=null,Wt=c,R.H=p,R.A=g,Lt===null&&(un=null,Pt=0,tc()),S}function hw(){for(;Lt!==null;)Zg(Lt)}function fw(e,r){var a=Wt;Wt|=2;var c=Jg(),p=Xg();un!==e||Pt!==r?(Dc=null,Oc=St()+500,Ra(e,r)):Ea=Mt(e,r);e:do try{if(Zt!==0&&Lt!==null){r=Lt;var g=Sr;t:switch(Zt){case 1:Zt=0,Sr=null,Aa(e,r,g,1);break;case 2:case 9:if(cm(g)){Zt=0,Sr=null,ey(r);break}r=function(){Zt!==2&&Zt!==9||un!==e||(Zt=7),is(e)},g.then(r,r);break e;case 3:Zt=7;break e;case 4:Zt=5;break e;case 7:cm(g)?(Zt=0,Sr=null,ey(r)):(Zt=0,Sr=null,Aa(e,r,g,7));break;case 5:var S=null;switch(Lt.tag){case 26:S=Lt.memoizedState;case 5:case 27:var k=Lt;if(S?By(S):k.stateNode.complete){Zt=0,Sr=null;var Q=k.sibling;if(Q!==null)Lt=Q;else{var he=k.return;he!==null?(Lt=he,Uc(he)):Lt=null}break t}}Zt=0,Sr=null,Aa(e,r,g,5);break;case 6:Zt=0,Sr=null,Aa(e,r,g,6);break;case 8:xh(),_n=6;break e;default:throw Error(l(462))}}pw();break}catch(je){Qg(e,je)}while(!0);return ms=Ei=null,R.H=c,R.A=p,Wt=a,Lt!==null?0:(un=null,Pt=0,tc(),_n)}function pw(){for(;Lt!==null&&!Dt();)Zg(Lt)}function Zg(e){var r=jg(e.alternate,e,Cs);e.memoizedProps=e.pendingProps,r===null?Uc(e):Lt=r}function ey(e){var r=e,a=r.alternate;switch(r.tag){case 15:case 0:r=yg(a,r,r.pendingProps,r.type,void 0,Pt);break;case 11:r=yg(a,r,r.pendingProps,r.type.render,r.ref,Pt);break;case 5:zd(r);default:Cg(a,r),r=Lt=Xp(r,Cs),r=jg(a,r,Cs)}e.memoizedProps=e.pendingProps,r===null?Uc(e):Lt=r}function Aa(e,r,a,c){ms=Ei=null,zd(r),ba=null,kl=0;var p=r.return;try{if(nw(e,p,r,a,Pt)){_n=1,jc(e,Rr(a,e.current)),Lt=null;return}}catch(g){if(p!==null)throw Lt=p,g;_n=1,jc(e,Rr(a,e.current)),Lt=null;return}r.flags&32768?(Ht||c===1?e=!0:Ea||(Pt&536870912)!==0?e=!1:(ri=e=!0,(c===2||c===9||c===3||c===6)&&(c=br.current,c!==null&&c.tag===13&&(c.flags|=16384))),ty(r,e)):Uc(r)}function Uc(e){var r=e;do{if((r.flags&32768)!==0){ty(r,ri);return}e=r.return;var a=iw(r.alternate,r,Cs);if(a!==null){Lt=a;return}if(r=r.sibling,r!==null){Lt=r;return}Lt=r=e}while(r!==null);_n===0&&(_n=5)}function ty(e,r){do{var a=aw(e.alternate,e);if(a!==null){a.flags&=32767,Lt=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!r&&(e=e.sibling,e!==null)){Lt=e;return}Lt=e=a}while(e!==null);_n=6,Lt=null}function ny(e,r,a,c,p,g,S,k,Q){e.cancelPendingCommit=null;do Lc();while(In!==0);if((Wt&6)!==0)throw Error(l(327));if(r!==null){if(r===e.current)throw Error(l(177));if(g=r.lanes|r.childLanes,g|=od,We(e,a,g,S,k,Q),e===un&&(Lt=un=null,Pt=0),ka=r,ai=e,Ns=a,gh=g,yh=p,Gg=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,vw(Ie,function(){return ly(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=R.T,R.T=null,p=I.p,I.p=2,S=Wt,Wt|=4;try{lw(e,r,a)}finally{Wt=S,I.p=p,R.T=c}}In=1,ry(),sy(),iy()}}function ry(){if(In===1){In=0;var e=ai,r=ka,a=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||a){a=R.T,R.T=null;var c=I.p;I.p=2;var p=Wt;Wt|=4;try{Lg(r,e);var g=Oh,S=Fp(e.containerInfo),k=g.focusedElem,Q=g.selectionRange;if(S!==k&&k&&k.ownerDocument&&qp(k.ownerDocument.documentElement,k)){if(Q!==null&&rd(k)){var he=Q.start,je=Q.end;if(je===void 0&&(je=he),"selectionStart"in k)k.selectionStart=he,k.selectionEnd=Math.min(je,k.value.length);else{var ke=k.ownerDocument||document,pe=ke&&ke.defaultView||window;if(pe.getSelection){var xe=pe.getSelection(),nt=k.textContent.length,vt=Math.min(Q.start,nt),on=Q.end===void 0?vt:Math.min(Q.end,nt);!xe.extend&&vt>on&&(S=on,on=vt,vt=S);var ie=Pp(k,vt),te=Pp(k,on);if(ie&&te&&(xe.rangeCount!==1||xe.anchorNode!==ie.node||xe.anchorOffset!==ie.offset||xe.focusNode!==te.node||xe.focusOffset!==te.offset)){var de=ke.createRange();de.setStart(ie.node,ie.offset),xe.removeAllRanges(),vt>on?(xe.addRange(de),xe.extend(te.node,te.offset)):(de.setEnd(te.node,te.offset),xe.addRange(de))}}}}for(ke=[],xe=k;xe=xe.parentNode;)xe.nodeType===1&&ke.push({element:xe,left:xe.scrollLeft,top:xe.scrollTop});for(typeof k.focus=="function"&&k.focus(),k=0;k<ke.length;k++){var Ee=ke[k];Ee.element.scrollLeft=Ee.left,Ee.element.scrollTop=Ee.top}}Qc=!!Ah,Oh=Ah=null}finally{Wt=p,I.p=c,R.T=a}}e.current=r,In=2}}function sy(){if(In===2){In=0;var e=ai,r=ka,a=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||a){a=R.T,R.T=null;var c=I.p;I.p=2;var p=Wt;Wt|=4;try{Og(e,r.alternate,r)}finally{Wt=p,I.p=c,R.T=a}}In=3}}function iy(){if(In===4||In===3){In=0,Vt();var e=ai,r=ka,a=Ns,c=Gg;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?In=5:(In=0,ka=ai=null,ay(e,e.pendingLanes));var p=e.pendingLanes;if(p===0&&(ii=null),ne(a),r=r.stateNode,jt&&typeof jt.onCommitFiberRoot=="function")try{jt.onCommitFiberRoot(Sn,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=R.T,p=I.p,I.p=2,R.T=null;try{for(var g=e.onRecoverableError,S=0;S<c.length;S++){var k=c[S];g(k.value,{componentStack:k.stack})}}finally{R.T=r,I.p=p}}(Ns&3)!==0&&Lc(),is(e),p=e.pendingLanes,(a&261930)!==0&&(p&42)!==0?e===vh?Vl++:(Vl=0,vh=e):Vl=0,Kl(0)}}function ay(e,r){(e.pooledCacheLanes&=r)===0&&(r=e.pooledCache,r!=null&&(e.pooledCache=null,El(r)))}function Lc(){return ry(),sy(),iy(),ly()}function ly(){if(In!==5)return!1;var e=ai,r=gh;gh=0;var a=ne(Ns),c=R.T,p=I.p;try{I.p=32>a?32:a,R.T=null,a=yh,yh=null;var g=ai,S=Ns;if(In=0,ka=ai=null,Ns=0,(Wt&6)!==0)throw Error(l(331));var k=Wt;if(Wt|=4,qg(g.current),Bg(g,g.current,S,a),Wt=k,Kl(0,!1),jt&&typeof jt.onPostCommitFiberRoot=="function")try{jt.onPostCommitFiberRoot(Sn,g)}catch{}return!0}finally{I.p=p,R.T=c,ay(e,r)}}function oy(e,r,a){r=Rr(a,r),r=Wd(e.stateNode,r,2),e=Zs(e,r,2),e!==null&&(Bt(e,2),is(e))}function en(e,r,a){if(e.tag===3)oy(e,e,a);else for(;r!==null;){if(r.tag===3){oy(r,e,a);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(ii===null||!ii.has(c))){e=Rr(a,e),a=cg(2),c=Zs(r,a,2),c!==null&&(ug(a,c,r,e),Bt(c,2),is(c));break}}r=r.return}}function wh(e,r,a){var c=e.pingCache;if(c===null){c=e.pingCache=new uw;var p=new Set;c.set(r,p)}else p=c.get(r),p===void 0&&(p=new Set,c.set(r,p));p.has(a)||(fh=!0,p.add(a),e=mw.bind(null,e,r,a),r.then(e,e))}function mw(e,r,a){var c=e.pingCache;c!==null&&c.delete(r),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,un===e&&(Pt&a)===a&&(_n===4||_n===3&&(Pt&62914560)===Pt&&300>St()-Ac?(Wt&2)===0&&Ra(e,0):ph|=a,Ta===Pt&&(Ta=0)),is(e)}function cy(e,r){r===0&&(r=Rt()),e=_i(e,r),e!==null&&(Bt(e,r),is(e))}function gw(e){var r=e.memoizedState,a=0;r!==null&&(a=r.retryLane),cy(e,a)}function yw(e,r){var a=0;switch(e.tag){case 31:case 13:var c=e.stateNode,p=e.memoizedState;p!==null&&(a=p.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(l(314))}c!==null&&c.delete(r),cy(e,a)}function vw(e,r){return mt(e,r)}var Ic=null,Oa=null,Sh=!1,Bc=!1,jh=!1,oi=0;function is(e){e!==Oa&&e.next===null&&(Oa===null?Ic=Oa=e:Oa=Oa.next=e),Bc=!0,Sh||(Sh=!0,bw())}function Kl(e,r){if(!jh&&Bc){jh=!0;do for(var a=!1,c=Ic;c!==null;){if(e!==0){var p=c.pendingLanes;if(p===0)var g=0;else{var S=c.suspendedLanes,k=c.pingedLanes;g=(1<<31-cn(42|e)+1)-1,g&=p&~(S&~k),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(a=!0,fy(c,g))}else g=Pt,g=tt(c,c===un?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||Mt(c,g)||(a=!0,fy(c,g));c=c.next}while(a);jh=!1}}function xw(){uy()}function uy(){Bc=Sh=!1;var e=0;oi!==0&&Rw()&&(e=oi);for(var r=St(),a=null,c=Ic;c!==null;){var p=c.next,g=dy(c,r);g===0?(c.next=null,a===null?Ic=p:a.next=p,p===null&&(Oa=a)):(a=c,(e!==0||(g&3)!==0)&&(Bc=!0)),c=p}In!==0&&In!==5||Kl(e),oi!==0&&(oi=0)}function dy(e,r){for(var a=e.suspendedLanes,c=e.pingedLanes,p=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var S=31-cn(g),k=1<<S,Q=p[S];Q===-1?((k&a)===0||(k&c)!==0)&&(p[S]=xt(k,r)):Q<=r&&(e.expiredLanes|=k),g&=~k}if(r=un,a=Pt,a=tt(e,e===r?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,a===0||e===r&&(Zt===2||Zt===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&ft(c),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||Mt(e,a)){if(r=a&-a,r===e.callbackPriority)return r;switch(c!==null&&ft(c),ne(a)){case 2:case 8:a=Ne;break;case 32:a=Ie;break;case 268435456:a=ut;break;default:a=Ie}return c=hy.bind(null,e),a=mt(a,c),e.callbackPriority=r,e.callbackNode=a,r}return c!==null&&c!==null&&ft(c),e.callbackPriority=2,e.callbackNode=null,2}function hy(e,r){if(In!==0&&In!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Lc()&&e.callbackNode!==a)return null;var c=Pt;return c=tt(e,e===un?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(Kg(e,c,r),dy(e,St()),e.callbackNode!=null&&e.callbackNode===a?hy.bind(null,e):null)}function fy(e,r){if(Lc())return null;Kg(e,r,!0)}function bw(){Ow(function(){(Wt&6)!==0?mt(_e,xw):uy()})}function _h(){if(oi===0){var e=ya;e===0&&(e=me,me<<=1,(me&261888)===0&&(me=256)),oi=e}return oi}function py(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:ia(""+e)}function my(e,r){var a=r.ownerDocument.createElement("input");return a.name=r.name,a.value=r.value,e.id&&a.setAttribute("form",e.id),r.parentNode.insertBefore(a,r),e=new FormData(e),a.parentNode.removeChild(a),e}function ww(e,r,a,c,p){if(r==="submit"&&a&&a.stateNode===p){var g=py((p[Qe]||null).action),S=c.submitter;S&&(r=(r=S[Qe]||null)?py(r.formAction):S.getAttribute("formAction"),r!==null&&(g=r,S=null));var k=new pn("action","action",null,c,p);e.push({event:k,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(oi!==0){var Q=S?my(p,S):new FormData(p);Hd(a,{pending:!0,data:Q,method:p.method,action:g},null,Q)}}else typeof g=="function"&&(k.preventDefault(),Q=S?my(p,S):new FormData(p),Hd(a,{pending:!0,data:Q,method:p.method,action:g},g,Q))},currentTarget:p}]})}}for(var Ch=0;Ch<ld.length;Ch++){var Nh=ld[Ch],Sw=Nh.toLowerCase(),jw=Nh[0].toUpperCase()+Nh.slice(1);Hr(Sw,"on"+jw)}Hr(Vp,"onAnimationEnd"),Hr(Kp,"onAnimationIteration"),Hr(Yp,"onAnimationStart"),Hr("dblclick","onDoubleClick"),Hr("focusin","onFocus"),Hr("focusout","onBlur"),Hr(Bb,"onTransitionRun"),Hr($b,"onTransitionStart"),Hr(Pb,"onTransitionCancel"),Hr(Qp,"onTransitionEnd"),qr("onMouseEnter",["mouseout","mouseover"]),qr("onMouseLeave",["mouseout","mouseover"]),qr("onPointerEnter",["pointerout","pointerover"]),qr("onPointerLeave",["pointerout","pointerover"]),yr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),yr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),yr("onBeforeInput",["compositionend","keypress","textInput","paste"]),yr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_w=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yl));function gy(e,r){r=(r&4)!==0;for(var a=0;a<e.length;a++){var c=e[a],p=c.event;c=c.listeners;e:{var g=void 0;if(r)for(var S=c.length-1;0<=S;S--){var k=c[S],Q=k.instance,he=k.currentTarget;if(k=k.listener,Q!==g&&p.isPropagationStopped())break e;g=k,p.currentTarget=he;try{g(p)}catch(je){ec(je)}p.currentTarget=null,g=Q}else for(S=0;S<c.length;S++){if(k=c[S],Q=k.instance,he=k.currentTarget,k=k.listener,Q!==g&&p.isPropagationStopped())break e;g=k,p.currentTarget=he;try{g(p)}catch(je){ec(je)}p.currentTarget=null,g=Q}}}}function It(e,r){var a=r[Ue];a===void 0&&(a=r[Ue]=new Set);var c=e+"__bubble";a.has(c)||(yy(r,e,2,!1),a.add(c))}function Eh(e,r,a){var c=0;r&&(c|=4),yy(a,e,c,r)}var $c="_reactListening"+Math.random().toString(36).slice(2);function Th(e){if(!e[$c]){e[$c]=!0,Pr.forEach(function(a){a!=="selectionchange"&&(_w.has(a)||Eh(a,!1,e),Eh(a,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[$c]||(r[$c]=!0,Eh("selectionchange",!1,r))}}function yy(e,r,a,c){switch(Vy(r)){case 2:var p=Xw;break;case 8:p=Zw;break;default:p=Fh}a=p.bind(null,r,a,e),p=void 0,!be||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),c?p!==void 0?e.addEventListener(r,a,{capture:!0,passive:p}):e.addEventListener(r,a,!0):p!==void 0?e.addEventListener(r,a,{passive:p}):e.addEventListener(r,a,!1)}function kh(e,r,a,c,p){var g=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var S=c.tag;if(S===3||S===4){var k=c.stateNode.containerInfo;if(k===p)break;if(S===4)for(S=c.return;S!==null;){var Q=S.tag;if((Q===3||Q===4)&&S.stateNode.containerInfo===p)return;S=S.return}for(;k!==null;){if(S=Nn(k),S===null)return;if(Q=S.tag,Q===5||Q===6||Q===26||Q===27){c=g=S;continue e}k=k.parentNode}}c=c.return}U(function(){var he=g,je=vl(a),ke=[];e:{var pe=Wp.get(e);if(pe!==void 0){var xe=pn,nt=e;switch(e){case"keypress":if(st(a)===0)break e;case"keydown":case"keyup":xe=yb;break;case"focusin":nt="focus",xe=rr;break;case"focusout":nt="blur",xe=rr;break;case"beforeblur":case"afterblur":xe=rr;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":xe=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":xe=Rn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":xe=bb;break;case Vp:case Kp:case Yp:xe=ds;break;case Qp:xe=Sb;break;case"scroll":case"scrollend":xe=Gs;break;case"wheel":xe=_b;break;case"copy":case"cut":case"paste":xe=Vs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":xe=Ep;break;case"toggle":case"beforetoggle":xe=Nb}var vt=(r&4)!==0,on=!vt&&(e==="scroll"||e==="scrollend"),ie=vt?pe!==null?pe+"Capture":null:pe;vt=[];for(var te=he,de;te!==null;){var Ee=te;if(de=Ee.stateNode,Ee=Ee.tag,Ee!==5&&Ee!==26&&Ee!==27||de===null||ie===null||(Ee=ee(te,ie),Ee!=null&&vt.push(Ql(te,Ee,de))),on)break;te=te.return}0<vt.length&&(pe=new xe(pe,nt,null,a,je),ke.push({event:pe,listeners:vt}))}}if((r&7)===0){e:{if(pe=e==="mouseover"||e==="pointerover",xe=e==="mouseout"||e==="pointerout",pe&&a!==yl&&(nt=a.relatedTarget||a.fromElement)&&(Nn(nt)||nt[H]))break e;if((xe||pe)&&(pe=je.window===je?je:(pe=je.ownerDocument)?pe.defaultView||pe.parentWindow:window,xe?(nt=a.relatedTarget||a.toElement,xe=he,nt=nt?Nn(nt):null,nt!==null&&(on=u(nt),vt=nt.tag,nt!==on||vt!==5&&vt!==27&&vt!==6)&&(nt=null)):(xe=null,nt=he),xe!==nt)){if(vt=hn,Ee="onMouseLeave",ie="onMouseEnter",te="mouse",(e==="pointerout"||e==="pointerover")&&(vt=Ep,Ee="onPointerLeave",ie="onPointerEnter",te="pointer"),on=xe==null?pe:Vn(xe),de=nt==null?pe:Vn(nt),pe=new vt(Ee,te+"leave",xe,a,je),pe.target=on,pe.relatedTarget=de,Ee=null,Nn(je)===he&&(vt=new vt(ie,te+"enter",nt,a,je),vt.target=de,vt.relatedTarget=on,Ee=vt),on=Ee,xe&&nt)t:{for(vt=Cw,ie=xe,te=nt,de=0,Ee=ie;Ee;Ee=vt(Ee))de++;Ee=0;for(var pt=te;pt;pt=vt(pt))Ee++;for(;0<de-Ee;)ie=vt(ie),de--;for(;0<Ee-de;)te=vt(te),Ee--;for(;de--;){if(ie===te||te!==null&&ie===te.alternate){vt=ie;break t}ie=vt(ie),te=vt(te)}vt=null}else vt=null;xe!==null&&vy(ke,pe,xe,vt,!1),nt!==null&&on!==null&&vy(ke,on,nt,vt,!0)}}e:{if(pe=he?Vn(he):window,xe=pe.nodeName&&pe.nodeName.toLowerCase(),xe==="select"||xe==="input"&&pe.type==="file")var Kt=zp;else if(Dp(pe))if(Up)Kt=Ub;else{Kt=Mb;var lt=Db}else xe=pe.nodeName,!xe||xe.toLowerCase()!=="input"||pe.type!=="checkbox"&&pe.type!=="radio"?he&&sa(he.elementType)&&(Kt=zp):Kt=zb;if(Kt&&(Kt=Kt(e,he))){Mp(ke,Kt,a,je);break e}lt&&lt(e,pe,he),e==="focusout"&&he&&pe.type==="number"&&he.memoizedProps.value!=null&&gl(pe,"number",pe.value)}switch(lt=he?Vn(he):window,e){case"focusin":(Dp(lt)||lt.contentEditable==="true")&&(ca=lt,sd=he,_l=null);break;case"focusout":_l=sd=ca=null;break;case"mousedown":id=!0;break;case"contextmenu":case"mouseup":case"dragend":id=!1,Hp(ke,a,je);break;case"selectionchange":if(Ib)break;case"keydown":case"keyup":Hp(ke,a,je)}var Ot;if(ed)e:{switch(e){case"compositionstart":var qt="onCompositionStart";break e;case"compositionend":qt="onCompositionEnd";break e;case"compositionupdate":qt="onCompositionUpdate";break e}qt=void 0}else oa?Ap(e,a)&&(qt="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(qt="onCompositionStart");qt&&(Tp&&a.locale!=="ko"&&(oa||qt!=="onCompositionStart"?qt==="onCompositionEnd"&&oa&&(Ot=Je()):(De=je,qe="value"in De?De.value:De.textContent,oa=!0)),lt=Pc(he,qt),0<lt.length&&(qt=new Xu(qt,e,null,a,je),ke.push({event:qt,listeners:lt}),Ot?qt.data=Ot:(Ot=Op(a),Ot!==null&&(qt.data=Ot)))),(Ot=Tb?kb(e,a):Rb(e,a))&&(qt=Pc(he,"onBeforeInput"),0<qt.length&&(lt=new Xu("onBeforeInput","beforeinput",null,a,je),ke.push({event:lt,listeners:qt}),lt.data=Ot)),ww(ke,e,he,a,je)}gy(ke,r)})}function Ql(e,r,a){return{instance:e,listener:r,currentTarget:a}}function Pc(e,r){for(var a=r+"Capture",c=[];e!==null;){var p=e,g=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||g===null||(p=ee(e,a),p!=null&&c.unshift(Ql(e,p,g)),p=ee(e,r),p!=null&&c.push(Ql(e,p,g))),e.tag===3)return c;e=e.return}return[]}function Cw(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function vy(e,r,a,c,p){for(var g=r._reactName,S=[];a!==null&&a!==c;){var k=a,Q=k.alternate,he=k.stateNode;if(k=k.tag,Q!==null&&Q===c)break;k!==5&&k!==26&&k!==27||he===null||(Q=he,p?(he=ee(a,g),he!=null&&S.unshift(Ql(a,he,Q))):p||(he=ee(a,g),he!=null&&S.push(Ql(a,he,Q)))),a=a.return}S.length!==0&&e.push({event:r,listeners:S})}var Nw=/\r\n?/g,Ew=/\u0000|\uFFFD/g;function xy(e){return(typeof e=="string"?e:""+e).replace(Nw,`
`).replace(Ew,"")}function by(e,r){return r=xy(r),xy(e)===r}function ln(e,r,a,c,p,g){switch(a){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||us(e,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&us(e,""+c);break;case"className":$s(e,"class",c);break;case"tabIndex":$s(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":$s(e,a,c);break;case"style":Jo(e,c,g);break;case"data":if(r!=="object"){$s(e,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||a!=="href")){e.removeAttribute(a);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(a);break}c=ia(""+c),e.setAttribute(a,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(a==="formAction"?(r!=="input"&&ln(e,r,"name",p.name,p,null),ln(e,r,"formEncType",p.formEncType,p,null),ln(e,r,"formMethod",p.formMethod,p,null),ln(e,r,"formTarget",p.formTarget,p,null)):(ln(e,r,"encType",p.encType,p,null),ln(e,r,"method",p.method,p,null),ln(e,r,"target",p.target,p,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(a);break}c=ia(""+c),e.setAttribute(a,c);break;case"onClick":c!=null&&(e.onclick=Fr);break;case"onScroll":c!=null&&It("scroll",e);break;case"onScrollEnd":c!=null&&It("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(l(61));if(a=c.__html,a!=null){if(p.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}a=ia(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,""+c):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":c===!0?e.setAttribute(a,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,c):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(a,c):e.removeAttribute(a);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(a):e.setAttribute(a,c);break;case"popover":It("beforetoggle",e),It("toggle",e),na(e,"popover",c);break;case"xlinkActuate":cr(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":cr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":cr(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":cr(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":cr(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":cr(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":cr(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":cr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":cr(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":na(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Ju.get(a)||a,na(e,a,c))}}function Rh(e,r,a,c,p,g){switch(a){case"style":Jo(e,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(l(61));if(a=c.__html,a!=null){if(p.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"children":typeof c=="string"?us(e,c):(typeof c=="number"||typeof c=="bigint")&&us(e,""+c);break;case"onScroll":c!=null&&It("scroll",e);break;case"onScrollEnd":c!=null&&It("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Fr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Kn.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(p=a.endsWith("Capture"),r=a.slice(2,p?a.length-7:void 0),g=e[Qe]||null,g=g!=null?g[a]:null,typeof g=="function"&&e.removeEventListener(r,g,p),typeof c=="function")){typeof g!="function"&&g!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(r,c,p);break e}a in e?e[a]=c:c===!0?e.setAttribute(a,""):na(e,a,c)}}}function Xn(e,r,a){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":It("error",e),It("load",e);var c=!1,p=!1,g;for(g in a)if(a.hasOwnProperty(g)){var S=a[g];if(S!=null)switch(g){case"src":c=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:ln(e,r,g,S,a,null)}}p&&ln(e,r,"srcSet",a.srcSet,a,null),c&&ln(e,r,"src",a.src,a,null);return;case"input":It("invalid",e);var k=g=S=p=null,Q=null,he=null;for(c in a)if(a.hasOwnProperty(c)){var je=a[c];if(je!=null)switch(c){case"name":p=je;break;case"type":S=je;break;case"checked":Q=je;break;case"defaultChecked":he=je;break;case"value":g=je;break;case"defaultValue":k=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(l(137,r));break;default:ln(e,r,c,je,a,null)}}Ps(e,g,k,Q,he,S,p,!1);return;case"select":It("invalid",e),c=S=g=null;for(p in a)if(a.hasOwnProperty(p)&&(k=a[p],k!=null))switch(p){case"value":g=k;break;case"defaultValue":S=k;break;case"multiple":c=k;default:ln(e,r,p,k,a,null)}r=g,a=S,e.multiple=!!c,r!=null?qs(e,!!c,r,!1):a!=null&&qs(e,!!c,a,!0);return;case"textarea":It("invalid",e),g=p=c=null;for(S in a)if(a.hasOwnProperty(S)&&(k=a[S],k!=null))switch(S){case"value":c=k;break;case"defaultValue":p=k;break;case"children":g=k;break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(l(91));break;default:ln(e,r,S,k,a,null)}Yo(e,c,p,g);return;case"option":for(Q in a)a.hasOwnProperty(Q)&&(c=a[Q],c!=null)&&(Q==="selected"?e.selected=c&&typeof c!="function"&&typeof c!="symbol":ln(e,r,Q,c,a,null));return;case"dialog":It("beforetoggle",e),It("toggle",e),It("cancel",e),It("close",e);break;case"iframe":case"object":It("load",e);break;case"video":case"audio":for(c=0;c<Yl.length;c++)It(Yl[c],e);break;case"image":It("error",e),It("load",e);break;case"details":It("toggle",e);break;case"embed":case"source":case"link":It("error",e),It("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(he in a)if(a.hasOwnProperty(he)&&(c=a[he],c!=null))switch(he){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:ln(e,r,he,c,a,null)}return;default:if(sa(r)){for(je in a)a.hasOwnProperty(je)&&(c=a[je],c!==void 0&&Rh(e,r,je,c,a,void 0));return}}for(k in a)a.hasOwnProperty(k)&&(c=a[k],c!=null&&ln(e,r,k,c,a,null))}function Tw(e,r,a,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,g=null,S=null,k=null,Q=null,he=null,je=null;for(xe in a){var ke=a[xe];if(a.hasOwnProperty(xe)&&ke!=null)switch(xe){case"checked":break;case"value":break;case"defaultValue":Q=ke;default:c.hasOwnProperty(xe)||ln(e,r,xe,null,c,ke)}}for(var pe in c){var xe=c[pe];if(ke=a[pe],c.hasOwnProperty(pe)&&(xe!=null||ke!=null))switch(pe){case"type":g=xe;break;case"name":p=xe;break;case"checked":he=xe;break;case"defaultChecked":je=xe;break;case"value":S=xe;break;case"defaultValue":k=xe;break;case"children":case"dangerouslySetInnerHTML":if(xe!=null)throw Error(l(137,r));break;default:xe!==ke&&ln(e,r,pe,xe,c,ke)}}ml(e,S,k,Q,he,je,g,p);return;case"select":xe=S=k=pe=null;for(g in a)if(Q=a[g],a.hasOwnProperty(g)&&Q!=null)switch(g){case"value":break;case"multiple":xe=Q;default:c.hasOwnProperty(g)||ln(e,r,g,null,c,Q)}for(p in c)if(g=c[p],Q=a[p],c.hasOwnProperty(p)&&(g!=null||Q!=null))switch(p){case"value":pe=g;break;case"defaultValue":k=g;break;case"multiple":S=g;default:g!==Q&&ln(e,r,p,g,c,Q)}r=k,a=S,c=xe,pe!=null?qs(e,!!a,pe,!1):!!c!=!!a&&(r!=null?qs(e,!!a,r,!0):qs(e,!!a,a?[]:"",!1));return;case"textarea":xe=pe=null;for(k in a)if(p=a[k],a.hasOwnProperty(k)&&p!=null&&!c.hasOwnProperty(k))switch(k){case"value":break;case"children":break;default:ln(e,r,k,null,c,p)}for(S in c)if(p=c[S],g=a[S],c.hasOwnProperty(S)&&(p!=null||g!=null))switch(S){case"value":pe=p;break;case"defaultValue":xe=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(l(91));break;default:p!==g&&ln(e,r,S,p,c,g)}Ko(e,pe,xe);return;case"option":for(var nt in a)pe=a[nt],a.hasOwnProperty(nt)&&pe!=null&&!c.hasOwnProperty(nt)&&(nt==="selected"?e.selected=!1:ln(e,r,nt,null,c,pe));for(Q in c)pe=c[Q],xe=a[Q],c.hasOwnProperty(Q)&&pe!==xe&&(pe!=null||xe!=null)&&(Q==="selected"?e.selected=pe&&typeof pe!="function"&&typeof pe!="symbol":ln(e,r,Q,pe,c,xe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vt in a)pe=a[vt],a.hasOwnProperty(vt)&&pe!=null&&!c.hasOwnProperty(vt)&&ln(e,r,vt,null,c,pe);for(he in c)if(pe=c[he],xe=a[he],c.hasOwnProperty(he)&&pe!==xe&&(pe!=null||xe!=null))switch(he){case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(l(137,r));break;default:ln(e,r,he,pe,c,xe)}return;default:if(sa(r)){for(var on in a)pe=a[on],a.hasOwnProperty(on)&&pe!==void 0&&!c.hasOwnProperty(on)&&Rh(e,r,on,void 0,c,pe);for(je in c)pe=c[je],xe=a[je],!c.hasOwnProperty(je)||pe===xe||pe===void 0&&xe===void 0||Rh(e,r,je,pe,c,xe);return}}for(var ie in a)pe=a[ie],a.hasOwnProperty(ie)&&pe!=null&&!c.hasOwnProperty(ie)&&ln(e,r,ie,null,c,pe);for(ke in c)pe=c[ke],xe=a[ke],!c.hasOwnProperty(ke)||pe===xe||pe==null&&xe==null||ln(e,r,ke,pe,c,xe)}function wy(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function kw(){if(typeof performance.getEntriesByType=="function"){for(var e=0,r=0,a=performance.getEntriesByType("resource"),c=0;c<a.length;c++){var p=a[c],g=p.transferSize,S=p.initiatorType,k=p.duration;if(g&&k&&wy(S)){for(S=0,k=p.responseEnd,c+=1;c<a.length;c++){var Q=a[c],he=Q.startTime;if(he>k)break;var je=Q.transferSize,ke=Q.initiatorType;je&&wy(ke)&&(Q=Q.responseEnd,S+=je*(Q<k?1:(k-he)/(Q-he)))}if(--c,r+=8*(g+S)/(p.duration/1e3),e++,10<e)break}}if(0<e)return r/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Ah=null,Oh=null;function qc(e){return e.nodeType===9?e:e.ownerDocument}function Sy(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function jy(e,r){if(e===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&r==="foreignObject"?0:e}function Dh(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Mh=null;function Rw(){var e=window.event;return e&&e.type==="popstate"?e===Mh?!1:(Mh=e,!0):(Mh=null,!1)}var _y=typeof setTimeout=="function"?setTimeout:void 0,Aw=typeof clearTimeout=="function"?clearTimeout:void 0,Cy=typeof Promise=="function"?Promise:void 0,Ow=typeof queueMicrotask=="function"?queueMicrotask:typeof Cy<"u"?function(e){return Cy.resolve(null).then(e).catch(Dw)}:_y;function Dw(e){setTimeout(function(){throw e})}function ci(e){return e==="head"}function Ny(e,r){var a=r,c=0;do{var p=a.nextSibling;if(e.removeChild(a),p&&p.nodeType===8)if(a=p.data,a==="/$"||a==="/&"){if(c===0){e.removeChild(p),Ua(r);return}c--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")c++;else if(a==="html")Wl(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,Wl(a);for(var g=a.firstChild;g;){var S=g.nextSibling,k=g.nodeName;g[ht]||k==="SCRIPT"||k==="STYLE"||k==="LINK"&&g.rel.toLowerCase()==="stylesheet"||a.removeChild(g),g=S}}else a==="body"&&Wl(e.ownerDocument.body);a=p}while(a);Ua(r)}function Ey(e,r){var a=e;e=0;do{var c=a.nextSibling;if(a.nodeType===1?r?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(r?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),c&&c.nodeType===8)if(a=c.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=c}while(a)}function zh(e){var r=e.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var a=r;switch(r=r.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":zh(a),Ft(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Mw(e,r,a,c){for(;e.nodeType===1;){var p=a;if(e.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[ht])switch(r){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==p.rel||e.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||e.getAttribute("title")!==(p.title==null?null:p.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(p.src==null?null:p.src)||e.getAttribute("type")!==(p.type==null?null:p.type)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(r==="input"&&e.type==="hidden"){var g=p.name==null?null:""+p.name;if(p.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=zr(e.nextSibling),e===null)break}return null}function zw(e,r,a){if(r==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=zr(e.nextSibling),e===null))return null;return e}function Ty(e,r){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=zr(e.nextSibling),e===null))return null;return e}function Uh(e){return e.data==="$?"||e.data==="$~"}function Lh(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Uw(e,r){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=r;else if(e.data!=="$?"||a.readyState!=="loading")r();else{var c=function(){r(),a.removeEventListener("DOMContentLoaded",c)};a.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function zr(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return e}var Ih=null;function ky(e){e=e.nextSibling;for(var r=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(r===0)return zr(e.nextSibling);r--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||r++}e=e.nextSibling}return null}function Ry(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(r===0)return e;r--}else a!=="/$"&&a!=="/&"||r++}e=e.previousSibling}return null}function Ay(e,r,a){switch(r=qc(a),e){case"html":if(e=r.documentElement,!e)throw Error(l(452));return e;case"head":if(e=r.head,!e)throw Error(l(453));return e;case"body":if(e=r.body,!e)throw Error(l(454));return e;default:throw Error(l(451))}}function Wl(e){for(var r=e.attributes;r.length;)e.removeAttributeNode(r[0]);Ft(e)}var Ur=new Map,Oy=new Set;function Fc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Es=I.d;I.d={f:Lw,r:Iw,D:Bw,C:$w,L:Pw,m:qw,X:Hw,S:Fw,M:Gw};function Lw(){var e=Es.f(),r=Mc();return e||r}function Iw(e){var r=Et(e);r!==null&&r.tag===5&&r.type==="form"?Qm(r):Es.r(e)}var Da=typeof document>"u"?null:document;function Dy(e,r,a){var c=Da;if(c&&typeof r=="string"&&r){var p=ur(r);p='link[rel="'+e+'"][href="'+p+'"]',typeof a=="string"&&(p+='[crossorigin="'+a+'"]'),Oy.has(p)||(Oy.add(p),e={rel:e,crossOrigin:a,href:r},c.querySelector(p)===null&&(r=c.createElement("link"),Xn(r,"link",e),Nt(r),c.head.appendChild(r)))}}function Bw(e){Es.D(e),Dy("dns-prefetch",e,null)}function $w(e,r){Es.C(e,r),Dy("preconnect",e,r)}function Pw(e,r,a){Es.L(e,r,a);var c=Da;if(c&&e&&r){var p='link[rel="preload"][as="'+ur(r)+'"]';r==="image"&&a&&a.imageSrcSet?(p+='[imagesrcset="'+ur(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(p+='[imagesizes="'+ur(a.imageSizes)+'"]')):p+='[href="'+ur(e)+'"]';var g=p;switch(r){case"style":g=Ma(e);break;case"script":g=za(e)}Ur.has(g)||(e=v({rel:"preload",href:r==="image"&&a&&a.imageSrcSet?void 0:e,as:r},a),Ur.set(g,e),c.querySelector(p)!==null||r==="style"&&c.querySelector(Jl(g))||r==="script"&&c.querySelector(Xl(g))||(r=c.createElement("link"),Xn(r,"link",e),Nt(r),c.head.appendChild(r)))}}function qw(e,r){Es.m(e,r);var a=Da;if(a&&e){var c=r&&typeof r.as=="string"?r.as:"script",p='link[rel="modulepreload"][as="'+ur(c)+'"][href="'+ur(e)+'"]',g=p;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=za(e)}if(!Ur.has(g)&&(e=v({rel:"modulepreload",href:e},r),Ur.set(g,e),a.querySelector(p)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Xl(g)))return}c=a.createElement("link"),Xn(c,"link",e),Nt(c),a.head.appendChild(c)}}}function Fw(e,r,a){Es.S(e,r,a);var c=Da;if(c&&e){var p=sn(c).hoistableStyles,g=Ma(e);r=r||"default";var S=p.get(g);if(!S){var k={loading:0,preload:null};if(S=c.querySelector(Jl(g)))k.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":r},a),(a=Ur.get(g))&&Bh(e,a);var Q=S=c.createElement("link");Nt(Q),Xn(Q,"link",e),Q._p=new Promise(function(he,je){Q.onload=he,Q.onerror=je}),Q.addEventListener("load",function(){k.loading|=1}),Q.addEventListener("error",function(){k.loading|=2}),k.loading|=4,Hc(S,r,c)}S={type:"stylesheet",instance:S,count:1,state:k},p.set(g,S)}}}function Hw(e,r){Es.X(e,r);var a=Da;if(a&&e){var c=sn(a).hoistableScripts,p=za(e),g=c.get(p);g||(g=a.querySelector(Xl(p)),g||(e=v({src:e,async:!0},r),(r=Ur.get(p))&&$h(e,r),g=a.createElement("script"),Nt(g),Xn(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function Gw(e,r){Es.M(e,r);var a=Da;if(a&&e){var c=sn(a).hoistableScripts,p=za(e),g=c.get(p);g||(g=a.querySelector(Xl(p)),g||(e=v({src:e,async:!0,type:"module"},r),(r=Ur.get(p))&&$h(e,r),g=a.createElement("script"),Nt(g),Xn(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function My(e,r,a,c){var p=(p=ve.current)?Fc(p):null;if(!p)throw Error(l(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(r=Ma(a.href),a=sn(p).hoistableStyles,c=a.get(r),c||(c={type:"style",instance:null,count:0,state:null},a.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=Ma(a.href);var g=sn(p).hoistableStyles,S=g.get(e);if(S||(p=p.ownerDocument||p,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,S),(g=p.querySelector(Jl(e)))&&!g._p&&(S.instance=g,S.state.loading=5),Ur.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Ur.set(e,a),g||Vw(p,e,a,S.state))),r&&c===null)throw Error(l(528,""));return S}if(r&&c!==null)throw Error(l(529,""));return null;case"script":return r=a.async,a=a.src,typeof a=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=za(a),a=sn(p).hoistableScripts,c=a.get(r),c||(c={type:"script",instance:null,count:0,state:null},a.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,e))}}function Ma(e){return'href="'+ur(e)+'"'}function Jl(e){return'link[rel="stylesheet"]['+e+"]"}function zy(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function Vw(e,r,a,c){e.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=e.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),Xn(r,"link",a),Nt(r),e.head.appendChild(r))}function za(e){return'[src="'+ur(e)+'"]'}function Xl(e){return"script[async]"+e}function Uy(e,r,a){if(r.count++,r.instance===null)switch(r.type){case"style":var c=e.querySelector('style[data-href~="'+ur(a.href)+'"]');if(c)return r.instance=c,Nt(c),c;var p=v({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),Nt(c),Xn(c,"style",p),Hc(c,a.precedence,e),r.instance=c;case"stylesheet":p=Ma(a.href);var g=e.querySelector(Jl(p));if(g)return r.state.loading|=4,r.instance=g,Nt(g),g;c=zy(a),(p=Ur.get(p))&&Bh(c,p),g=(e.ownerDocument||e).createElement("link"),Nt(g);var S=g;return S._p=new Promise(function(k,Q){S.onload=k,S.onerror=Q}),Xn(g,"link",c),r.state.loading|=4,Hc(g,a.precedence,e),r.instance=g;case"script":return g=za(a.src),(p=e.querySelector(Xl(g)))?(r.instance=p,Nt(p),p):(c=a,(p=Ur.get(g))&&(c=v({},a),$h(c,p)),e=e.ownerDocument||e,p=e.createElement("script"),Nt(p),Xn(p,"link",c),e.head.appendChild(p),r.instance=p);case"void":return null;default:throw Error(l(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,Hc(c,a.precedence,e));return r.instance}function Hc(e,r,a){for(var c=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=c.length?c[c.length-1]:null,g=p,S=0;S<c.length;S++){var k=c[S];if(k.dataset.precedence===r)g=k;else if(g!==p)break}g?g.parentNode.insertBefore(e,g.nextSibling):(r=a.nodeType===9?a.head:a,r.insertBefore(e,r.firstChild))}function Bh(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.title==null&&(e.title=r.title)}function $h(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.integrity==null&&(e.integrity=r.integrity)}var Gc=null;function Ly(e,r,a){if(Gc===null){var c=new Map,p=Gc=new Map;p.set(a,c)}else p=Gc,c=p.get(a),c||(c=new Map,p.set(a,c));if(c.has(e))return c;for(c.set(e,null),a=a.getElementsByTagName(e),p=0;p<a.length;p++){var g=a[p];if(!(g[ht]||g[Xe]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var S=g.getAttribute(r)||"";S=e+S;var k=c.get(S);k?k.push(g):c.set(S,[g])}}return c}function Iy(e,r,a){e=e.ownerDocument||e,e.head.insertBefore(a,r==="title"?e.querySelector("head > title"):null)}function Kw(e,r,a){if(a===1||r.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(e=r.disabled,typeof r.precedence=="string"&&e==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function By(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function Yw(e,r,a,c){if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var p=Ma(c.href),g=r.querySelector(Jl(p));if(g){r=g._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(e.count++,e=Vc.bind(e),r.then(e,e)),a.state.loading|=4,a.instance=g,Nt(g);return}g=r.ownerDocument||r,c=zy(c),(p=Ur.get(p))&&Bh(c,p),g=g.createElement("link"),Nt(g);var S=g;S._p=new Promise(function(k,Q){S.onload=k,S.onerror=Q}),Xn(g,"link",c),a.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,r),(r=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=Vc.bind(e),r.addEventListener("load",a),r.addEventListener("error",a))}}var Ph=0;function Qw(e,r){return e.stylesheets&&e.count===0&&Yc(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var c=setTimeout(function(){if(e.stylesheets&&Yc(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+r);0<e.imgBytes&&Ph===0&&(Ph=62500*kw());var p=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Yc(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>Ph?50:800)+r);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(p)}}:null}function Vc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Yc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Kc=null;function Yc(e,r){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Kc=new Map,r.forEach(Ww,e),Kc=null,Vc.call(e))}function Ww(e,r){if(!(r.state.loading&4)){var a=Kc.get(e);if(a)var c=a.get(null);else{a=new Map,Kc.set(e,a);for(var p=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<p.length;g++){var S=p[g];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(a.set(S.dataset.precedence,S),c=S)}c&&a.set(null,c)}p=r.instance,S=p.getAttribute("data-precedence"),g=a.get(S)||c,g===c&&a.set(null,p),a.set(S,p),this.count++,c=Vc.bind(this),p.addEventListener("load",c),p.addEventListener("error",c),g?g.parentNode.insertBefore(p,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(p,e.firstChild)),r.state.loading|=4}}var Zl={$$typeof:D,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function Jw(e,r,a,c,p,g,S,k,Q){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=et(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=et(0),this.hiddenUpdates=et(null),this.identifierPrefix=c,this.onUncaughtError=p,this.onCaughtError=g,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Q,this.incompleteTransitions=new Map}function $y(e,r,a,c,p,g,S,k,Q,he,je,ke){return e=new Jw(e,r,a,S,Q,he,je,ke,k),r=1,g===!0&&(r|=24),g=xr(3,null,null,r),e.current=g,g.stateNode=e,r=bd(),r.refCount++,e.pooledCache=r,r.refCount++,g.memoizedState={element:c,isDehydrated:a,cache:r},_d(g),e}function Py(e){return e?(e=ha,e):ha}function qy(e,r,a,c,p,g){p=Py(p),c.context===null?c.context=p:c.pendingContext=p,c=Xs(r),c.payload={element:a},g=g===void 0?null:g,g!==null&&(c.callback=g),a=Zs(e,c,r),a!==null&&(mr(a,e,r),Al(a,e,r))}function Fy(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<r?a:r}}function qh(e,r){Fy(e,r),(e=e.alternate)&&Fy(e,r)}function Hy(e){if(e.tag===13||e.tag===31){var r=_i(e,67108864);r!==null&&mr(r,e,67108864),qh(e,67108864)}}function Gy(e){if(e.tag===13||e.tag===31){var r=_r();r=re(r);var a=_i(e,r);a!==null&&mr(a,e,r),qh(e,r)}}var Qc=!0;function Xw(e,r,a,c){var p=R.T;R.T=null;var g=I.p;try{I.p=2,Fh(e,r,a,c)}finally{I.p=g,R.T=p}}function Zw(e,r,a,c){var p=R.T;R.T=null;var g=I.p;try{I.p=8,Fh(e,r,a,c)}finally{I.p=g,R.T=p}}function Fh(e,r,a,c){if(Qc){var p=Hh(c);if(p===null)kh(e,r,c,Wc,a),Ky(e,c);else if(tS(p,e,r,a,c))c.stopPropagation();else if(Ky(e,c),r&4&&-1<eS.indexOf(e)){for(;p!==null;){var g=Et(p);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var S=Ye(g.pendingLanes);if(S!==0){var k=g;for(k.pendingLanes|=2,k.entangledLanes|=2;S;){var Q=1<<31-cn(S);k.entanglements[1]|=Q,S&=~Q}is(g),(Wt&6)===0&&(Oc=St()+500,Kl(0))}}break;case 31:case 13:k=_i(g,2),k!==null&&mr(k,g,2),Mc(),qh(g,2)}if(g=Hh(c),g===null&&kh(e,r,c,Wc,a),g===p)break;p=g}p!==null&&c.stopPropagation()}else kh(e,r,c,null,a)}}function Hh(e){return e=vl(e),Gh(e)}var Wc=null;function Gh(e){if(Wc=null,e=Nn(e),e!==null){var r=u(e);if(r===null)e=null;else{var a=r.tag;if(a===13){if(e=d(r),e!==null)return e;e=null}else if(a===31){if(e=h(r),e!==null)return e;e=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null)}}return Wc=e,null}function Vy(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(oe()){case _e:return 2;case Ne:return 8;case Ie:case it:return 32;case ut:return 268435456;default:return 32}default:return 32}}var Vh=!1,ui=null,di=null,hi=null,eo=new Map,to=new Map,fi=[],eS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ky(e,r){switch(e){case"focusin":case"focusout":ui=null;break;case"dragenter":case"dragleave":di=null;break;case"mouseover":case"mouseout":hi=null;break;case"pointerover":case"pointerout":eo.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":to.delete(r.pointerId)}}function no(e,r,a,c,p,g){return e===null||e.nativeEvent!==g?(e={blockedOn:r,domEventName:a,eventSystemFlags:c,nativeEvent:g,targetContainers:[p]},r!==null&&(r=Et(r),r!==null&&Hy(r)),e):(e.eventSystemFlags|=c,r=e.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),e)}function tS(e,r,a,c,p){switch(r){case"focusin":return ui=no(ui,e,r,a,c,p),!0;case"dragenter":return di=no(di,e,r,a,c,p),!0;case"mouseover":return hi=no(hi,e,r,a,c,p),!0;case"pointerover":var g=p.pointerId;return eo.set(g,no(eo.get(g)||null,e,r,a,c,p)),!0;case"gotpointercapture":return g=p.pointerId,to.set(g,no(to.get(g)||null,e,r,a,c,p)),!0}return!1}function Yy(e){var r=Nn(e.target);if(r!==null){var a=u(r);if(a!==null){if(r=a.tag,r===13){if(r=d(a),r!==null){e.blockedOn=r,Te(e.priority,function(){Gy(a)});return}}else if(r===31){if(r=h(a),r!==null){e.blockedOn=r,Te(e.priority,function(){Gy(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Jc(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var a=Hh(e.nativeEvent);if(a===null){a=e.nativeEvent;var c=new a.constructor(a.type,a);yl=c,a.target.dispatchEvent(c),yl=null}else return r=Et(a),r!==null&&Hy(r),e.blockedOn=a,!1;r.shift()}return!0}function Qy(e,r,a){Jc(e)&&a.delete(r)}function nS(){Vh=!1,ui!==null&&Jc(ui)&&(ui=null),di!==null&&Jc(di)&&(di=null),hi!==null&&Jc(hi)&&(hi=null),eo.forEach(Qy),to.forEach(Qy)}function Xc(e,r){e.blockedOn===r&&(e.blockedOn=null,Vh||(Vh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,nS)))}var Zc=null;function Wy(e){Zc!==e&&(Zc=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Zc===e&&(Zc=null);for(var r=0;r<e.length;r+=3){var a=e[r],c=e[r+1],p=e[r+2];if(typeof c!="function"){if(Gh(c||a)===null)continue;break}var g=Et(a);g!==null&&(e.splice(r,3),r-=3,Hd(g,{pending:!0,data:p,method:a.method,action:c},c,p))}}))}function Ua(e){function r(Q){return Xc(Q,e)}ui!==null&&Xc(ui,e),di!==null&&Xc(di,e),hi!==null&&Xc(hi,e),eo.forEach(r),to.forEach(r);for(var a=0;a<fi.length;a++){var c=fi[a];c.blockedOn===e&&(c.blockedOn=null)}for(;0<fi.length&&(a=fi[0],a.blockedOn===null);)Yy(a),a.blockedOn===null&&fi.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(c=0;c<a.length;c+=3){var p=a[c],g=a[c+1],S=p[Qe]||null;if(typeof g=="function")S||Wy(a);else if(S){var k=null;if(g&&g.hasAttribute("formAction")){if(p=g,S=g[Qe]||null)k=S.formAction;else if(Gh(p)!==null)continue}else k=S.action;typeof k=="function"?a[c+1]=k:(a.splice(c,3),c-=3),Wy(a)}}}function Jy(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(S){return p=S})},focusReset:"manual",scroll:"manual"})}function r(){p!==null&&(p(),p=null),c||setTimeout(a,20)}function a(){if(!c&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,p=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(a,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),p!==null&&(p(),p=null)}}}function Kh(e){this._internalRoot=e}eu.prototype.render=Kh.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(l(409));var a=r.current,c=_r();qy(a,c,e,r,null,null)},eu.prototype.unmount=Kh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;qy(e.current,2,null,e,null,null),Mc(),r[H]=null}};function eu(e){this._internalRoot=e}eu.prototype.unstable_scheduleHydration=function(e){if(e){var r=fe();e={blockedOn:null,target:e,priority:r};for(var a=0;a<fi.length&&r!==0&&r<fi[a].priority;a++);fi.splice(a,0,e),a===0&&Yy(e)}};var Xy=t.version;if(Xy!=="19.2.3")throw Error(l(527,Xy,"19.2.3"));I.findDOMNode=function(e){var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(l(188)):(e=Object.keys(e).join(","),Error(l(268,e)));return e=m(r),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var rS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tu.isDisabled&&tu.supportsFiber)try{Sn=tu.inject(rS),jt=tu}catch{}}return so.createRoot=function(e,r){if(!o(e))throw Error(l(299));var a=!1,c="",p=ig,g=ag,S=lg;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(g=r.onCaughtError),r.onRecoverableError!==void 0&&(S=r.onRecoverableError)),r=$y(e,1,!1,null,null,a,c,null,p,g,S,Jy),e[H]=r.current,Th(e),new Kh(r)},so.hydrateRoot=function(e,r,a){if(!o(e))throw Error(l(299));var c=!1,p="",g=ig,S=ag,k=lg,Q=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(p=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(S=a.onCaughtError),a.onRecoverableError!==void 0&&(k=a.onRecoverableError),a.formState!==void 0&&(Q=a.formState)),r=$y(e,1,!0,r,a??null,c,p,Q,g,S,k,Jy),r.context=Py(null),a=r.current,c=_r(),c=re(c),p=Xs(c),p.callback=null,Zs(a,p,c),a=c,r.current.lanes=a,Bt(r,a),is(r),e[H]=r.current,Th(e),new eu(r)},so.version="19.2.3",so}var ov;function hS(){if(ov)return Wh.exports;ov=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Wh.exports=dS(),Wh.exports}var fS=hS();var cv="popstate";function pS(n={}){function t(l,o){let{pathname:u,search:d,hash:h}=l.location;return If("",{pathname:u,search:d,hash:h},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function s(l,o){return typeof o=="string"?o:wo(o)}return gS(t,s,null,n)}function qn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Br(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function mS(){return Math.random().toString(36).substring(2,10)}function uv(n,t){return{usr:n.state,key:n.key,idx:t}}function If(n,t,s=null,l){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?Mo(t):t,state:s,key:t&&t.key||l||mS()}}function wo({pathname:n="/",search:t="",hash:s=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function Mo(n){let t={};if(n){let s=n.indexOf("#");s>=0&&(t.hash=n.substring(s),n=n.substring(0,s));let l=n.indexOf("?");l>=0&&(t.search=n.substring(l),n=n.substring(0,l)),n&&(t.pathname=n)}return t}function gS(n,t,s,l={}){let{window:o=document.defaultView,v5Compat:u=!1}=l,d=o.history,h="POP",f=null,m=y();m==null&&(m=0,d.replaceState({...d.state,idx:m},""));function y(){return(d.state||{idx:null}).idx}function v(){h="POP";let j=y(),E=j==null?null:j-m;m=j,f&&f({action:h,location:N.location,delta:E})}function x(j,E){h="PUSH";let O=If(N.location,j,E);m=y()+1;let D=uv(O,m),$=N.createHref(O);try{d.pushState(D,"",$)}catch(z){if(z instanceof DOMException&&z.name==="DataCloneError")throw z;o.location.assign($)}u&&f&&f({action:h,location:N.location,delta:1})}function w(j,E){h="REPLACE";let O=If(N.location,j,E);m=y();let D=uv(O,m),$=N.createHref(O);d.replaceState(D,"",$),u&&f&&f({action:h,location:N.location,delta:0})}function _(j){return yS(j)}let N={get action(){return h},get location(){return n(o,d)},listen(j){if(f)throw new Error("A history only accepts one active listener");return o.addEventListener(cv,v),f=j,()=>{o.removeEventListener(cv,v),f=null}},createHref(j){return t(o,j)},createURL:_,encodeLocation(j){let E=_(j);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:x,replace:w,go(j){return d.go(j)}};return N}function yS(n,t=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),qn(s,"No window.location.(origin|href) available to create URL");let l=typeof n=="string"?n:wo(n);return l=l.replace(/ $/,"%20"),!t&&l.startsWith("//")&&(l=s+l),new URL(l,s)}function Bx(n,t,s="/"){return vS(n,t,s,!1)}function vS(n,t,s,l){let o=typeof t=="string"?Mo(t):t,u=zs(o.pathname||"/",s);if(u==null)return null;let d=$x(n);xS(d);let h=null;for(let f=0;h==null&&f<d.length;++f){let m=RS(u);h=TS(d[f],m,l)}return h}function $x(n,t=[],s=[],l="",o=!1){let u=(d,h,f=o,m)=>{let y={relativePath:m===void 0?d.path||"":m,caseSensitive:d.caseSensitive===!0,childrenIndex:h,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(l)&&f)return;qn(y.relativePath.startsWith(l),`Absolute route path "${y.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(l.length)}let v=Ms([l,y.relativePath]),x=s.concat(y);d.children&&d.children.length>0&&(qn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),$x(d.children,t,x,v,f)),!(d.path==null&&!d.index)&&t.push({path:v,score:NS(v,d.index),routesMeta:x})};return n.forEach((d,h)=>{if(d.path===""||!d.path?.includes("?"))u(d,h);else for(let f of Px(d.path))u(d,h,!0,f)}),t}function Px(n){let t=n.split("/");if(t.length===0)return[];let[s,...l]=t,o=s.endsWith("?"),u=s.replace(/\?$/,"");if(l.length===0)return o?[u,""]:[u];let d=Px(l.join("/")),h=[];return h.push(...d.map(f=>f===""?u:[u,f].join("/"))),o&&h.push(...d),h.map(f=>n.startsWith("/")&&f===""?"/":f)}function xS(n){n.sort((t,s)=>t.score!==s.score?s.score-t.score:ES(t.routesMeta.map(l=>l.childrenIndex),s.routesMeta.map(l=>l.childrenIndex)))}var bS=/^:[\w-]+$/,wS=3,SS=2,jS=1,_S=10,CS=-2,dv=n=>n==="*";function NS(n,t){let s=n.split("/"),l=s.length;return s.some(dv)&&(l+=CS),t&&(l+=SS),s.filter(o=>!dv(o)).reduce((o,u)=>o+(bS.test(u)?wS:u===""?jS:_S),l)}function ES(n,t){return n.length===t.length&&n.slice(0,-1).every((l,o)=>l===t[o])?n[n.length-1]-t[t.length-1]:0}function TS(n,t,s=!1){let{routesMeta:l}=n,o={},u="/",d=[];for(let h=0;h<l.length;++h){let f=l[h],m=h===l.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=ju({path:f.relativePath,caseSensitive:f.caseSensitive,end:m},y),x=f.route;if(!v&&m&&s&&!l[l.length-1].route.index&&(v=ju({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},y)),!v)return null;Object.assign(o,v.params),d.push({params:o,pathname:Ms([u,v.pathname]),pathnameBase:MS(Ms([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=Ms([u,v.pathnameBase]))}return d}function ju(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,l]=kS(n.path,n.caseSensitive,n.end),o=t.match(s);if(!o)return null;let u=o[0],d=u.replace(/(.)\/+$/,"$1"),h=o.slice(1);return{params:l.reduce((m,{paramName:y,isOptional:v},x)=>{if(y==="*"){let _=h[x]||"";d=u.slice(0,u.length-_.length).replace(/(.)\/+$/,"$1")}const w=h[x];return v&&!w?m[y]=void 0:m[y]=(w||"").replace(/%2F/g,"/"),m},{}),pathname:u,pathnameBase:d,pattern:n}}function kS(n,t=!1,s=!0){Br(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let l=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,h,f)=>(l.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(l.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),l]}function RS(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Br(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function zs(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,l=n.charAt(s);return l&&l!=="/"?null:n.slice(s)||"/"}var qx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,AS=n=>qx.test(n);function OS(n,t="/"){let{pathname:s,search:l="",hash:o=""}=typeof n=="string"?Mo(n):n,u;if(s)if(AS(s))u=s;else{if(s.includes("//")){let d=s;s=s.replace(/\/\/+/g,"/"),Br(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${s}`)}s.startsWith("/")?u=hv(s.substring(1),"/"):u=hv(s,t)}else u=t;return{pathname:u,search:zS(l),hash:US(o)}}function hv(n,t){let s=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?s.length>1&&s.pop():o!=="."&&s.push(o)}),s.length>1?s.join("/"):"/"}function ef(n,t,s,l){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function DS(n){return n.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function Fx(n){let t=DS(n);return t.map((s,l)=>l===t.length-1?s.pathname:s.pathnameBase)}function Hx(n,t,s,l=!1){let o;typeof n=="string"?o=Mo(n):(o={...n},qn(!o.pathname||!o.pathname.includes("?"),ef("?","pathname","search",o)),qn(!o.pathname||!o.pathname.includes("#"),ef("#","pathname","hash",o)),qn(!o.search||!o.search.includes("#"),ef("#","search","hash",o)));let u=n===""||o.pathname==="",d=u?"/":o.pathname,h;if(d==null)h=s;else{let v=t.length-1;if(!l&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;o.pathname=x.join("/")}h=v>=0?t[v]:"/"}let f=OS(o,h),m=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&s.endsWith("/");return!f.pathname.endsWith("/")&&(m||y)&&(f.pathname+="/"),f}var Ms=n=>n.join("/").replace(/\/\/+/g,"/"),MS=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),zS=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,US=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,LS=class{constructor(n,t,s,l=!1){this.status=n,this.statusText=t||"",this.internal=l,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function IS(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function BS(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Gx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Vx(n,t){let s=n;if(typeof s!="string"||!qx.test(s))return{absoluteURL:void 0,isExternal:!1,to:s};let l=s,o=!1;if(Gx)try{let u=new URL(window.location.href),d=s.startsWith("//")?new URL(u.protocol+s):new URL(s),h=zs(d.pathname,t);d.origin===u.origin&&h!=null?s=h+d.search+d.hash:o=!0}catch{Br(!1,`<Link to="${s}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:l,isExternal:o,to:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Kx=["POST","PUT","PATCH","DELETE"];new Set(Kx);var $S=["GET",...Kx];new Set($S);var rl=b.createContext(null);rl.displayName="DataRouter";var zu=b.createContext(null);zu.displayName="DataRouterState";var PS=b.createContext(!1),Yx=b.createContext({isTransitioning:!1});Yx.displayName="ViewTransition";var qS=b.createContext(new Map);qS.displayName="Fetchers";var FS=b.createContext(null);FS.displayName="Await";var $r=b.createContext(null);$r.displayName="Navigation";var Uu=b.createContext(null);Uu.displayName="Location";var Ls=b.createContext({outlet:null,matches:[],isDataRoute:!1});Ls.displayName="Route";var ap=b.createContext(null);ap.displayName="RouteError";var Qx="REACT_ROUTER_ERROR",HS="REDIRECT",GS="ROUTE_ERROR_RESPONSE";function VS(n){if(n.startsWith(`${Qx}:${HS}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function KS(n){if(n.startsWith(`${Qx}:${GS}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new LS(t.status,t.statusText,t.data)}catch{}}function YS(n,{relative:t}={}){qn(zo(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:l}=b.useContext($r),{hash:o,pathname:u,search:d}=Uo(n,{relative:t}),h=u;return s!=="/"&&(h=u==="/"?s:Ms([s,u])),l.createHref({pathname:h,search:d,hash:o})}function zo(){return b.useContext(Uu)!=null}function Is(){return qn(zo(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(Uu).location}var Wx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Jx(n){b.useContext($r).static||b.useLayoutEffect(n)}function Xx(){let{isDataRoute:n}=b.useContext(Ls);return n?lj():QS()}function QS(){qn(zo(),"useNavigate() may be used only in the context of a <Router> component.");let n=b.useContext(rl),{basename:t,navigator:s}=b.useContext($r),{matches:l}=b.useContext(Ls),{pathname:o}=Is(),u=JSON.stringify(Fx(l)),d=b.useRef(!1);return Jx(()=>{d.current=!0}),b.useCallback((f,m={})=>{if(Br(d.current,Wx),!d.current)return;if(typeof f=="number"){s.go(f);return}let y=Hx(f,JSON.parse(u),o,m.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Ms([t,y.pathname])),(m.replace?s.replace:s.push)(y,m.state,m)},[t,s,u,o,n])}b.createContext(null);function Uo(n,{relative:t}={}){let{matches:s}=b.useContext(Ls),{pathname:l}=Is(),o=JSON.stringify(Fx(s));return b.useMemo(()=>Hx(n,JSON.parse(o),l,t==="path"),[n,o,l,t])}function WS(n,t,s,l,o){qn(zo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=b.useContext($r),{matches:d}=b.useContext(Ls),h=d[d.length-1],f=h?h.params:{},m=h?h.pathname:"/",y=h?h.pathnameBase:"/",v=h&&h.route;{let O=v&&v.path||"";e0(m,!v||O.endsWith("*")||O.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${O}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${O}"> to <Route path="${O==="/"?"*":`${O}/*`}">.`)}let x=Is(),w;w=x;let _=w.pathname||"/",N=_;if(y!=="/"){let O=y.replace(/^\//,"").split("/");N="/"+_.replace(/^\//,"").split("/").slice(O.length).join("/")}let j=Bx(n,{pathname:N});return Br(v||j!=null,`No routes matched location "${w.pathname}${w.search}${w.hash}" `),Br(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${w.pathname}${w.search}${w.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),tj(j&&j.map(O=>Object.assign({},O,{params:Object.assign({},f,O.params),pathname:Ms([y,u.encodeLocation?u.encodeLocation(O.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:O.pathname]),pathnameBase:O.pathnameBase==="/"?y:Ms([y,u.encodeLocation?u.encodeLocation(O.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:O.pathnameBase])})),d,s,l,o)}function JS(){let n=aj(),t=IS(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,l="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:l},u={padding:"2px 4px",backgroundColor:l},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:u},"ErrorBoundary")," or"," ",b.createElement("code",{style:u},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},t),s?b.createElement("pre",{style:o},s):null,d)}var XS=b.createElement(JS,null),Zx=class extends b.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const s=KS(n.digest);s&&(n=s)}let t=n!==void 0?b.createElement(Ls.Provider,{value:this.props.routeContext},b.createElement(ap.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?b.createElement(ZS,{error:n},t):t}};Zx.contextType=PS;var tf=new WeakMap;function ZS({children:n,error:t}){let{basename:s}=b.useContext($r);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let l=VS(t.digest);if(l){let o=tf.get(t);if(o)throw o;let u=Vx(l.location,s);if(Gx&&!tf.get(t))if(u.isExternal||l.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:l.replace}));throw tf.set(t,d),d}return b.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function ej({routeContext:n,match:t,children:s}){let l=b.useContext(rl);return l&&l.static&&l.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=t.route.id),b.createElement(Ls.Provider,{value:n},s)}function tj(n,t=[],s=null,l=null,o=null){if(n==null){if(!s)return null;if(s.errors)n=s.matches;else if(t.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let u=n,d=s?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);qn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let h=!1,f=-1;if(s)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(f=y),v.route.id){let{loaderData:x,errors:w}=s,_=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!w||w[v.route.id]===void 0);if(v.route.lazy||_){h=!0,f>=0?u=u.slice(0,f+1):u=[u[0]];break}}}let m=s&&l?(y,v)=>{l(y,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:BS(s.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let w,_=!1,N=null,j=null;s&&(w=d&&v.route.id?d[v.route.id]:void 0,N=v.route.errorElement||XS,h&&(f<0&&x===0?(e0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),_=!0,j=null):f===x&&(_=!0,j=v.route.hydrateFallbackElement||null)));let E=t.concat(u.slice(0,x+1)),O=()=>{let D;return w?D=N:_?D=j:v.route.Component?D=b.createElement(v.route.Component,null):v.route.element?D=v.route.element:D=y,b.createElement(ej,{match:v,routeContext:{outlet:y,matches:E,isDataRoute:s!=null},children:D})};return s&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?b.createElement(Zx,{location:s.location,revalidation:s.revalidation,component:N,error:w,children:O(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:m}):O()},null)}function lp(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nj(n){let t=b.useContext(rl);return qn(t,lp(n)),t}function rj(n){let t=b.useContext(zu);return qn(t,lp(n)),t}function sj(n){let t=b.useContext(Ls);return qn(t,lp(n)),t}function op(n){let t=sj(n),s=t.matches[t.matches.length-1];return qn(s.route.id,`${n} can only be used on routes that contain a unique "id"`),s.route.id}function ij(){return op("useRouteId")}function aj(){let n=b.useContext(ap),t=rj("useRouteError"),s=op("useRouteError");return n!==void 0?n:t.errors?.[s]}function lj(){let{router:n}=nj("useNavigate"),t=op("useNavigate"),s=b.useRef(!1);return Jx(()=>{s.current=!0}),b.useCallback(async(o,u={})=>{Br(s.current,Wx),s.current&&(typeof o=="number"?await n.navigate(o):await n.navigate(o,{fromRouteId:t,...u}))},[n,t])}var fv={};function e0(n,t,s){!t&&!fv[n]&&(fv[n]=!0,Br(!1,s))}b.memo(oj);function oj({routes:n,future:t,state:s,onError:l}){return WS(n,void 0,s,l,t)}function cj({basename:n="/",children:t=null,location:s,navigationType:l="POP",navigator:o,static:u=!1,unstable_useTransitions:d}){qn(!zo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=n.replace(/^\/*/,"/"),f=b.useMemo(()=>({basename:h,navigator:o,static:u,unstable_useTransitions:d,future:{}}),[h,o,u,d]);typeof s=="string"&&(s=Mo(s));let{pathname:m="/",search:y="",hash:v="",state:x=null,key:w="default"}=s,_=b.useMemo(()=>{let N=zs(m,h);return N==null?null:{location:{pathname:N,search:y,hash:v,state:x,key:w},navigationType:l}},[h,m,y,v,x,w,l]);return Br(_!=null,`<Router basename="${h}"> is not able to match the URL "${m}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:b.createElement($r.Provider,{value:f},b.createElement(Uu.Provider,{children:t,value:_}))}var gu="get",yu="application/x-www-form-urlencoded";function Lu(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function uj(n){return Lu(n)&&n.tagName.toLowerCase()==="button"}function dj(n){return Lu(n)&&n.tagName.toLowerCase()==="form"}function hj(n){return Lu(n)&&n.tagName.toLowerCase()==="input"}function fj(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function pj(n,t){return n.button===0&&(!t||t==="_self")&&!fj(n)}function Bf(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,s)=>{let l=n[s];return t.concat(Array.isArray(l)?l.map(o=>[s,o]):[[s,l]])},[]))}function mj(n,t){let s=Bf(n);return t&&t.forEach((l,o)=>{s.has(o)||t.getAll(o).forEach(u=>{s.append(o,u)})}),s}var nu=null;function gj(){if(nu===null)try{new FormData(document.createElement("form"),0),nu=!1}catch{nu=!0}return nu}var yj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function nf(n){return n!=null&&!yj.has(n)?(Br(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${yu}"`),null):n}function vj(n,t){let s,l,o,u,d;if(dj(n)){let h=n.getAttribute("action");l=h?zs(h,t):null,s=n.getAttribute("method")||gu,o=nf(n.getAttribute("enctype"))||yu,u=new FormData(n)}else if(uj(n)||hj(n)&&(n.type==="submit"||n.type==="image")){let h=n.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=n.getAttribute("formaction")||h.getAttribute("action");if(l=f?zs(f,t):null,s=n.getAttribute("formmethod")||h.getAttribute("method")||gu,o=nf(n.getAttribute("formenctype"))||nf(h.getAttribute("enctype"))||yu,u=new FormData(h,n),!gj()){let{name:m,type:y,value:v}=n;if(y==="image"){let x=m?`${m}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else m&&u.append(m,v)}}else{if(Lu(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=gu,l=null,o=yu,d=n}return u&&o==="text/plain"&&(d=u,u=void 0),{action:l,method:s.toLowerCase(),encType:o,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function cp(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function xj(n,t,s){let l=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return l.pathname==="/"?l.pathname=`_root.${s}`:t&&zs(l.pathname,t)==="/"?l.pathname=`${t.replace(/\/$/,"")}/_root.${s}`:l.pathname=`${l.pathname.replace(/\/$/,"")}.${s}`,l}async function bj(n,t){if(n.id in t)return t[n.id];try{let s=await import(n.module);return t[n.id]=s,s}catch(s){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function wj(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Sj(n,t,s){let l=await Promise.all(n.map(async o=>{let u=t.routes[o.route.id];if(u){let d=await bj(u,s);return d.links?d.links():[]}return[]}));return Nj(l.flat(1).filter(wj).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function pv(n,t,s,l,o,u){let d=(f,m)=>s[m]?f.route.id!==s[m].route.id:!0,h=(f,m)=>s[m].pathname!==f.pathname||s[m].route.path?.endsWith("*")&&s[m].params["*"]!==f.params["*"];return u==="assets"?t.filter((f,m)=>d(f,m)||h(f,m)):u==="data"?t.filter((f,m)=>{let y=l.routes[f.route.id];if(!y||!y.hasLoader)return!1;if(d(f,m)||h(f,m))return!0;if(f.route.shouldRevalidate){let v=f.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function jj(n,t,{includeHydrateFallback:s}={}){return _j(n.map(l=>{let o=t.routes[l.route.id];if(!o)return[];let u=[o.module];return o.clientActionModule&&(u=u.concat(o.clientActionModule)),o.clientLoaderModule&&(u=u.concat(o.clientLoaderModule)),s&&o.hydrateFallbackModule&&(u=u.concat(o.hydrateFallbackModule)),o.imports&&(u=u.concat(o.imports)),u}).flat(1))}function _j(n){return[...new Set(n)]}function Cj(n){let t={},s=Object.keys(n).sort();for(let l of s)t[l]=n[l];return t}function Nj(n,t){let s=new Set;return new Set(t),n.reduce((l,o)=>{let u=JSON.stringify(Cj(o));return s.has(u)||(s.add(u),l.push({key:u,link:o})),l},[])}function t0(){let n=b.useContext(rl);return cp(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function Ej(){let n=b.useContext(zu);return cp(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var up=b.createContext(void 0);up.displayName="FrameworkContext";function n0(){let n=b.useContext(up);return cp(n,"You must render this element inside a <HydratedRouter> element"),n}function Tj(n,t){let s=b.useContext(up),[l,o]=b.useState(!1),[u,d]=b.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:m,onMouseLeave:y,onTouchStart:v}=t,x=b.useRef(null);b.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let N=E=>{E.forEach(O=>{d(O.isIntersecting)})},j=new IntersectionObserver(N,{threshold:.5});return x.current&&j.observe(x.current),()=>{j.disconnect()}}},[n]),b.useEffect(()=>{if(l){let N=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(N)}}},[l]);let w=()=>{o(!0)},_=()=>{o(!1),d(!1)};return s?n!=="intent"?[u,x,{}]:[u,x,{onFocus:io(h,w),onBlur:io(f,_),onMouseEnter:io(m,w),onMouseLeave:io(y,_),onTouchStart:io(v,w)}]:[!1,x,{}]}function io(n,t){return s=>{n&&n(s),s.defaultPrevented||t(s)}}function kj({page:n,...t}){let{router:s}=t0(),l=b.useMemo(()=>Bx(s.routes,n,s.basename),[s.routes,n,s.basename]);return l?b.createElement(Aj,{page:n,matches:l,...t}):null}function Rj(n){let{manifest:t,routeModules:s}=n0(),[l,o]=b.useState([]);return b.useEffect(()=>{let u=!1;return Sj(n,t,s).then(d=>{u||o(d)}),()=>{u=!0}},[n,t,s]),l}function Aj({page:n,matches:t,...s}){let l=Is(),{manifest:o,routeModules:u}=n0(),{basename:d}=t0(),{loaderData:h,matches:f}=Ej(),m=b.useMemo(()=>pv(n,t,f,o,l,"data"),[n,t,f,o,l]),y=b.useMemo(()=>pv(n,t,f,o,l,"assets"),[n,t,f,o,l]),v=b.useMemo(()=>{if(n===l.pathname+l.search+l.hash)return[];let _=new Set,N=!1;if(t.forEach(E=>{let O=o.routes[E.route.id];!O||!O.hasLoader||(!m.some(D=>D.route.id===E.route.id)&&E.route.id in h&&u[E.route.id]?.shouldRevalidate||O.hasClientLoader?N=!0:_.add(E.route.id))}),_.size===0)return[];let j=xj(n,d,"data");return N&&_.size>0&&j.searchParams.set("_routes",t.filter(E=>_.has(E.route.id)).map(E=>E.route.id).join(",")),[j.pathname+j.search]},[d,h,l,o,m,t,n,u]),x=b.useMemo(()=>jj(y,o),[y,o]),w=Rj(y);return b.createElement(b.Fragment,null,v.map(_=>b.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...s})),x.map(_=>b.createElement("link",{key:_,rel:"modulepreload",href:_,...s})),w.map(({key:_,link:N})=>b.createElement("link",{key:_,nonce:s.nonce,...N})))}function Oj(...n){return t=>{n.forEach(s=>{typeof s=="function"?s(t):s!=null&&(s.current=t)})}}var Dj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Dj&&(window.__reactRouterVersion="7.11.0")}catch{}function Mj({basename:n,children:t,unstable_useTransitions:s,window:l}){let o=b.useRef();o.current==null&&(o.current=pS({window:l,v5Compat:!0}));let u=o.current,[d,h]=b.useState({action:u.action,location:u.location}),f=b.useCallback(m=>{s===!1?h(m):b.startTransition(()=>h(m))},[s]);return b.useLayoutEffect(()=>u.listen(f),[u,f]),b.createElement(cj,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:s})}var r0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,s0=b.forwardRef(function({onClick:t,discover:s="render",prefetch:l="none",relative:o,reloadDocument:u,replace:d,state:h,target:f,to:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...w},_){let{basename:N,unstable_useTransitions:j}=b.useContext($r),E=typeof m=="string"&&r0.test(m),O=Vx(m,N);m=O.to;let D=YS(m,{relative:o}),[$,z,C]=Tj(l,w),M=Ij(m,{replace:d,state:h,target:f,preventScrollReset:y,relative:o,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:j});function T(K){t&&t(K),K.defaultPrevented||M(K)}let F=b.createElement("a",{...w,...C,href:O.absoluteURL||D,onClick:O.isExternal||u?t:T,ref:Oj(_,z),target:f,"data-discover":!E&&s==="render"?"true":void 0});return $&&!E?b.createElement(b.Fragment,null,F,b.createElement(kj,{page:D})):F});s0.displayName="Link";var zj=b.forwardRef(function({"aria-current":t="page",caseSensitive:s=!1,className:l="",end:o=!1,style:u,to:d,viewTransition:h,children:f,...m},y){let v=Uo(d,{relative:m.relative}),x=Is(),w=b.useContext(zu),{navigator:_,basename:N}=b.useContext($r),j=w!=null&&Fj(v)&&h===!0,E=_.encodeLocation?_.encodeLocation(v).pathname:v.pathname,O=x.pathname,D=w&&w.navigation&&w.navigation.location?w.navigation.location.pathname:null;s||(O=O.toLowerCase(),D=D?D.toLowerCase():null,E=E.toLowerCase()),D&&N&&(D=zs(D,N)||D);const $=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let z=O===E||!o&&O.startsWith(E)&&O.charAt($)==="/",C=D!=null&&(D===E||!o&&D.startsWith(E)&&D.charAt(E.length)==="/"),M={isActive:z,isPending:C,isTransitioning:j},T=z?t:void 0,F;typeof l=="function"?F=l(M):F=[l,z?"active":null,C?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let K=typeof u=="function"?u(M):u;return b.createElement(s0,{...m,"aria-current":T,className:F,ref:y,style:K,to:d,viewTransition:h},typeof f=="function"?f(M):f)});zj.displayName="NavLink";var Uj=b.forwardRef(({discover:n="render",fetcherKey:t,navigate:s,reloadDocument:l,replace:o,state:u,method:d=gu,action:h,onSubmit:f,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...w},_)=>{let{unstable_useTransitions:N}=b.useContext($r),j=Pj(),E=qj(h,{relative:m}),O=d.toLowerCase()==="get"?"get":"post",D=typeof h=="string"&&r0.test(h),$=z=>{if(f&&f(z),z.defaultPrevented)return;z.preventDefault();let C=z.nativeEvent.submitter,M=C?.getAttribute("formmethod")||d,T=()=>j(C||z.currentTarget,{fetcherKey:t,method:M,navigate:s,replace:o,state:u,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});N&&s!==!1?b.startTransition(()=>T()):T()};return b.createElement("form",{ref:_,method:O,action:E,onSubmit:l?f:$,...w,"data-discover":!D&&n==="render"?"true":void 0})});Uj.displayName="Form";function Lj(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function i0(n){let t=b.useContext(rl);return qn(t,Lj(n)),t}function Ij(n,{target:t,replace:s,state:l,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let m=Xx(),y=Is(),v=Uo(n,{relative:u});return b.useCallback(x=>{if(pj(x,t)){x.preventDefault();let w=s!==void 0?s:wo(y)===wo(v),_=()=>m(n,{replace:w,state:l,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:h});f?b.startTransition(()=>_()):_()}},[y,m,v,s,l,t,n,o,u,d,h,f])}function Lo(n){Br(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=b.useRef(Bf(n)),s=b.useRef(!1),l=Is(),o=b.useMemo(()=>mj(l.search,s.current?null:t.current),[l.search]),u=Xx(),d=b.useCallback((h,f)=>{const m=Bf(typeof h=="function"?h(new URLSearchParams(o)):h);s.current=!0,u("?"+m,f)},[u,o]);return[o,d]}var Bj=0,$j=()=>`__${String(++Bj)}__`;function Pj(){let{router:n}=i0("useSubmit"),{basename:t}=b.useContext($r),s=ij(),l=n.fetch,o=n.navigate;return b.useCallback(async(u,d={})=>{let{action:h,method:f,encType:m,formData:y,body:v}=vj(u,t);if(d.navigate===!1){let x=d.fetcherKey||$j();await l(x,s,d.action||h,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||f,formEncType:d.encType||m,flushSync:d.flushSync})}else await o(d.action||h,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||f,formEncType:d.encType||m,replace:d.replace,state:d.state,fromRouteId:s,flushSync:d.flushSync,viewTransition:d.viewTransition})},[l,o,t,s])}function qj(n,{relative:t}={}){let{basename:s}=b.useContext($r),l=b.useContext(Ls);qn(l,"useFormAction must be used inside a RouteContext");let[o]=l.matches.slice(-1),u={...Uo(n||".",{relative:t})},d=Is();if(n==null){u.search=d.search;let h=new URLSearchParams(u.search),f=h.getAll("index");if(f.some(y=>y==="")){h.delete("index"),f.filter(v=>v).forEach(v=>h.append("index",v));let y=h.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&o.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(u.pathname=u.pathname==="/"?s:Ms([s,u.pathname])),wo(u)}function Fj(n,{relative:t}={}){let s=b.useContext(Yx);qn(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=i0("useViewTransitionState"),o=Uo(n,{relative:t});if(!s.isTransitioning)return!1;let u=zs(s.currentLocation.pathname,l)||s.currentLocation.pathname,d=zs(s.nextLocation.pathname,l)||s.nextLocation.pathname;return ju(o.pathname,d)!=null||ju(o.pathname,u)!=null}var Ki=Ix();const Hj=({children:n})=>(Is(),i.jsxs("div",{className:"app-layout",children:[i.jsx("header",{className:"app-header",children:i.jsx("div",{className:"container app-header__content",children:i.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),i.jsx("main",{className:"container app-main",children:n}),i.jsx("footer",{className:"app-footer",children:i.jsx("div",{className:"container",children:i.jsx("p",{children:" 2026 recipe management"})})})]})),tn=({children:n,className:t="",hoverable:s=!1,...l})=>i.jsx("div",{className:`glass-card ${s?"glass-card--hoverable":""} ${t}`,...l,children:n}),se=({children:n,variant:t="primary",size:s="md",isLoading:l,block:o,className:u="",...d})=>{const h=["btn",`btn--${t}`,`btn--${s}`,o?"btn--block":"",l?"btn--loading":"",u].filter(Boolean).join(" ");return i.jsxs("button",{className:h,disabled:l,...d,children:[l&&i.jsx("span",{className:"btn__spinner"}),i.jsx("span",{className:"btn__content",children:n})]})};function Gj(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return b.useMemo(()=>l=>{t.forEach(o=>o(l))},t)}const Iu=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function sl(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function dp(n){return"nodeType"in n}function or(n){var t,s;return n?sl(n)?n:dp(n)&&(t=(s=n.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function hp(n){const{Document:t}=or(n);return n instanceof t}function Io(n){return sl(n)?!1:n instanceof or(n).HTMLElement}function a0(n){return n instanceof or(n).SVGElement}function il(n){return n?sl(n)?n.document:dp(n)?hp(n)?n:Io(n)||a0(n)?n.ownerDocument:document:document:document}const Xr=Iu?b.useLayoutEffect:b.useEffect;function Bu(n){const t=b.useRef(n);return Xr(()=>{t.current=n}),b.useCallback(function(){for(var s=arguments.length,l=new Array(s),o=0;o<s;o++)l[o]=arguments[o];return t.current==null?void 0:t.current(...l)},[])}function Vj(){const n=b.useRef(null),t=b.useCallback((l,o)=>{n.current=setInterval(l,o)},[]),s=b.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,s]}function So(n,t){t===void 0&&(t=[n]);const s=b.useRef(n);return Xr(()=>{s.current!==n&&(s.current=n)},t),s}function Bo(n,t){const s=b.useRef();return b.useMemo(()=>{const l=n(s.current);return s.current=l,l},[...t])}function _u(n){const t=Bu(n),s=b.useRef(null),l=b.useCallback(o=>{o!==s.current&&t?.(o,s.current),s.current=o},[]);return[s,l]}function Cu(n){const t=b.useRef();return b.useEffect(()=>{t.current=n},[n]),t.current}let rf={};function $o(n,t){return b.useMemo(()=>{if(t)return t;const s=rf[n]==null?0:rf[n]+1;return rf[n]=s,n+"-"+s},[n,t])}function l0(n){return function(t){for(var s=arguments.length,l=new Array(s>1?s-1:0),o=1;o<s;o++)l[o-1]=arguments[o];return l.reduce((u,d)=>{const h=Object.entries(d);for(const[f,m]of h){const y=u[f];y!=null&&(u[f]=y+n*m)}return u},{...t})}}const Za=l0(1),jo=l0(-1);function Kj(n){return"clientX"in n&&"clientY"in n}function $u(n){if(!n)return!1;const{KeyboardEvent:t}=or(n.target);return t&&n instanceof t}function Yj(n){if(!n)return!1;const{TouchEvent:t}=or(n.target);return t&&n instanceof t}function Nu(n){if(Yj(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:s}=n.touches[0];return{x:t,y:s}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:s}=n.changedTouches[0];return{x:t,y:s}}}return Kj(n)?{x:n.clientX,y:n.clientY}:null}const Tr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:s}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:s}=n;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(n){if(n)return[Tr.Translate.toString(n),Tr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:s,easing:l}=n;return t+" "+s+"ms "+l}}}),mv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Qj(n){return n.matches(mv)?n:n.querySelector(mv)}const Wj={display:"none"};function Jj(n){let{id:t,value:s}=n;return we.createElement("div",{id:t,style:Wj},s)}function Xj(n){let{id:t,announcement:s,ariaLiveType:l="assertive"}=n;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return we.createElement("div",{id:t,style:o,role:"status","aria-live":l,"aria-atomic":!0},s)}function Zj(){const[n,t]=b.useState("");return{announce:b.useCallback(l=>{l!=null&&t(l)},[]),announcement:n}}const o0=b.createContext(null);function e_(n){const t=b.useContext(o0);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function t_(){const[n]=b.useState(()=>new Set),t=b.useCallback(l=>(n.add(l),()=>n.delete(l)),[n]);return[b.useCallback(l=>{let{type:o,event:u}=l;n.forEach(d=>{var h;return(h=d[o])==null?void 0:h.call(d,u)})},[n]),t]}const n_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},r_={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function s_(n){let{announcements:t=r_,container:s,hiddenTextDescribedById:l,screenReaderInstructions:o=n_}=n;const{announce:u,announcement:d}=Zj(),h=$o("DndLiveRegion"),[f,m]=b.useState(!1);if(b.useEffect(()=>{m(!0)},[]),e_(b.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:w}=v;t.onDragMove&&u(t.onDragMove({active:x,over:w}))},onDragOver(v){let{active:x,over:w}=v;u(t.onDragOver({active:x,over:w}))},onDragEnd(v){let{active:x,over:w}=v;u(t.onDragEnd({active:x,over:w}))},onDragCancel(v){let{active:x,over:w}=v;u(t.onDragCancel({active:x,over:w}))}}),[u,t])),!f)return null;const y=we.createElement(we.Fragment,null,we.createElement(Jj,{id:l,value:o.draggable}),we.createElement(Xj,{id:h,announcement:d}));return s?Ki.createPortal(y,s):y}var $n;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})($n||($n={}));function Eu(){}function gr(n,t){return b.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function al(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return b.useMemo(()=>[...t].filter(l=>l!=null),[...t])}const Zr=Object.freeze({x:0,y:0});function fp(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function i_(n,t){const s=Nu(n);if(!s)return"0 0";const l={x:(s.x-t.left)/t.width*100,y:(s.y-t.top)/t.height*100};return l.x+"% "+l.y+"%"}function pp(n,t){let{data:{value:s}}=n,{data:{value:l}}=t;return s-l}function a_(n,t){let{data:{value:s}}=n,{data:{value:l}}=t;return l-s}function $f(n){let{left:t,top:s,height:l,width:o}=n;return[{x:t,y:s},{x:t+o,y:s},{x:t,y:s+l},{x:t+o,y:s+l}]}function c0(n,t){if(!n||n.length===0)return null;const[s]=n;return s[t]}function gv(n,t,s){return t===void 0&&(t=n.left),s===void 0&&(s=n.top),{x:t+n.width*.5,y:s+n.height*.5}}const Pf=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const o=gv(t,t.left,t.top),u=[];for(const d of l){const{id:h}=d,f=s.get(h);if(f){const m=fp(gv(f),o);u.push({id:h,data:{droppableContainer:d,value:m}})}}return u.sort(pp)},l_=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const o=$f(t),u=[];for(const d of l){const{id:h}=d,f=s.get(h);if(f){const m=$f(f),y=o.reduce((x,w,_)=>x+fp(m[_],w),0),v=Number((y/4).toFixed(4));u.push({id:h,data:{droppableContainer:d,value:v}})}}return u.sort(pp)};function o_(n,t){const s=Math.max(t.top,n.top),l=Math.max(t.left,n.left),o=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=o-l,h=u-s;if(l<o&&s<u){const f=t.width*t.height,m=n.width*n.height,y=d*h,v=y/(f+m-y);return Number(v.toFixed(4))}return 0}const c_=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const o=[];for(const u of l){const{id:d}=u,h=s.get(d);if(h){const f=o_(h,t);f>0&&o.push({id:d,data:{droppableContainer:u,value:f}})}}return o.sort(a_)};function u_(n,t){const{top:s,left:l,bottom:o,right:u}=t;return s<=n.y&&n.y<=o&&l<=n.x&&n.x<=u}const u0=n=>{let{droppableContainers:t,droppableRects:s,pointerCoordinates:l}=n;if(!l)return[];const o=[];for(const u of t){const{id:d}=u,h=s.get(d);if(h&&u_(l,h)){const m=$f(h).reduce((v,x)=>v+fp(l,x),0),y=Number((m/4).toFixed(4));o.push({id:d,data:{droppableContainer:u,value:y}})}}return o.sort(pp)};function d_(n,t,s){return{...n,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function d0(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:Zr}function h_(n){return function(s){for(var l=arguments.length,o=new Array(l>1?l-1:0),u=1;u<l;u++)o[u-1]=arguments[u];return o.reduce((d,h)=>({...d,top:d.top+n*h.y,bottom:d.bottom+n*h.y,left:d.left+n*h.x,right:d.right+n*h.x}),{...s})}}const f_=h_(1);function h0(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function p_(n,t,s){const l=h0(t);if(!l)return n;const{scaleX:o,scaleY:u,x:d,y:h}=l,f=n.left-d-(1-o)*parseFloat(s),m=n.top-h-(1-u)*parseFloat(s.slice(s.indexOf(" ")+1)),y=o?n.width/o:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:m,right:f+y,bottom:m+v,left:f}}const m_={ignoreTransform:!1};function ll(n,t){t===void 0&&(t=m_);let s=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:m,transformOrigin:y}=or(n).getComputedStyle(n);m&&(s=p_(s,m,y))}const{top:l,left:o,width:u,height:d,bottom:h,right:f}=s;return{top:l,left:o,width:u,height:d,bottom:h,right:f}}function yv(n){return ll(n,{ignoreTransform:!0})}function g_(n){const t=n.innerWidth,s=n.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function y_(n,t){return t===void 0&&(t=or(n).getComputedStyle(n)),t.position==="fixed"}function v_(n,t){t===void 0&&(t=or(n).getComputedStyle(n));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const u=t[o];return typeof u=="string"?s.test(u):!1})}function Pu(n,t){const s=[];function l(o){if(t!=null&&s.length>=t||!o)return s;if(hp(o)&&o.scrollingElement!=null&&!s.includes(o.scrollingElement))return s.push(o.scrollingElement),s;if(!Io(o)||a0(o)||s.includes(o))return s;const u=or(n).getComputedStyle(o);return o!==n&&v_(o,u)&&s.push(o),y_(o,u)?s:l(o.parentNode)}return n?l(n):s}function f0(n){const[t]=Pu(n,1);return t??null}function sf(n){return!Iu||!n?null:sl(n)?n:dp(n)?hp(n)||n===il(n).scrollingElement?window:Io(n)?n:null:null}function p0(n){return sl(n)?n.scrollX:n.scrollLeft}function m0(n){return sl(n)?n.scrollY:n.scrollTop}function qf(n){return{x:p0(n),y:m0(n)}}var Hn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Hn||(Hn={}));function g0(n){return!Iu||!n?!1:n===document.scrollingElement}function y0(n){const t={x:0,y:0},s=g0(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},l={x:n.scrollWidth-s.width,y:n.scrollHeight-s.height},o=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=l.y,h=n.scrollLeft>=l.x;return{isTop:o,isLeft:u,isBottom:d,isRight:h,maxScroll:l,minScroll:t}}const x_={x:.2,y:.2};function b_(n,t,s,l,o){let{top:u,left:d,right:h,bottom:f}=s;l===void 0&&(l=10),o===void 0&&(o=x_);const{isTop:m,isBottom:y,isLeft:v,isRight:x}=y0(n),w={x:0,y:0},_={x:0,y:0},N={height:t.height*o.y,width:t.width*o.x};return!m&&u<=t.top+N.height?(w.y=Hn.Backward,_.y=l*Math.abs((t.top+N.height-u)/N.height)):!y&&f>=t.bottom-N.height&&(w.y=Hn.Forward,_.y=l*Math.abs((t.bottom-N.height-f)/N.height)),!x&&h>=t.right-N.width?(w.x=Hn.Forward,_.x=l*Math.abs((t.right-N.width-h)/N.width)):!v&&d<=t.left+N.width&&(w.x=Hn.Backward,_.x=l*Math.abs((t.left+N.width-d)/N.width)),{direction:w,speed:_}}function w_(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:s,right:l,bottom:o}=n.getBoundingClientRect();return{top:t,left:s,right:l,bottom:o,width:n.clientWidth,height:n.clientHeight}}function v0(n){return n.reduce((t,s)=>Za(t,qf(s)),Zr)}function S_(n){return n.reduce((t,s)=>t+p0(s),0)}function j_(n){return n.reduce((t,s)=>t+m0(s),0)}function x0(n,t){if(t===void 0&&(t=ll),!n)return;const{top:s,left:l,bottom:o,right:u}=t(n);f0(n)&&(o<=0||u<=0||s>=window.innerHeight||l>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const __=[["x",["left","right"],S_],["y",["top","bottom"],j_]];class mp{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const l=Pu(s),o=v0(l);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,h]of __)for(const f of d)Object.defineProperty(this,f,{get:()=>{const m=h(l),y=o[u]-m;return this.rect[f]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class go{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var l;return(l=this.target)==null?void 0:l.removeEventListener(...s)})},this.target=t}add(t,s,l){var o;(o=this.target)==null||o.addEventListener(t,s,l),this.listeners.push([t,s,l])}}function C_(n){const{EventTarget:t}=or(n);return n instanceof t?n:il(n)}function af(n,t){const s=Math.abs(n.x),l=Math.abs(n.y);return typeof t=="number"?Math.sqrt(s**2+l**2)>t:"x"in t&&"y"in t?s>t.x&&l>t.y:"x"in t?s>t.x:"y"in t?l>t.y:!1}var Ir;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Ir||(Ir={}));function vv(n){n.preventDefault()}function N_(n){n.stopPropagation()}var Gt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(Gt||(Gt={}));const b0={start:[Gt.Space,Gt.Enter],cancel:[Gt.Esc],end:[Gt.Space,Gt.Enter,Gt.Tab]},E_=(n,t)=>{let{currentCoordinates:s}=t;switch(n.code){case Gt.Right:return{...s,x:s.x+25};case Gt.Left:return{...s,x:s.x-25};case Gt.Down:return{...s,y:s.y+25};case Gt.Up:return{...s,y:s.y-25}}};class ol{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new go(il(s)),this.windowListeners=new go(or(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ir.Resize,this.handleCancel),this.windowListeners.add(Ir.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ir.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,l=t.node.current;l&&x0(l),s(Zr)}handleKeyDown(t){if($u(t)){const{active:s,context:l,options:o}=this.props,{keyboardCodes:u=b0,coordinateGetter:d=E_,scrollBehavior:h="smooth"}=o,{code:f}=t;if(u.end.includes(f)){this.handleEnd(t);return}if(u.cancel.includes(f)){this.handleCancel(t);return}const{collisionRect:m}=l.current,y=m?{x:m.left,y:m.top}:Zr;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:s,context:l.current,currentCoordinates:y});if(v){const x=jo(v,y),w={x:0,y:0},{scrollableAncestors:_}=l.current;for(const N of _){const j=t.code,{isTop:E,isRight:O,isLeft:D,isBottom:$,maxScroll:z,minScroll:C}=y0(N),M=w_(N),T={x:Math.min(j===Gt.Right?M.right-M.width/2:M.right,Math.max(j===Gt.Right?M.left:M.left+M.width/2,v.x)),y:Math.min(j===Gt.Down?M.bottom-M.height/2:M.bottom,Math.max(j===Gt.Down?M.top:M.top+M.height/2,v.y))},F=j===Gt.Right&&!O||j===Gt.Left&&!D,K=j===Gt.Down&&!$||j===Gt.Up&&!E;if(F&&T.x!==v.x){const G=N.scrollLeft+x.x,q=j===Gt.Right&&G<=z.x||j===Gt.Left&&G>=C.x;if(q&&!x.y){N.scrollTo({left:G,behavior:h});return}q?w.x=N.scrollLeft-G:w.x=j===Gt.Right?N.scrollLeft-z.x:N.scrollLeft-C.x,w.x&&N.scrollBy({left:-w.x,behavior:h});break}else if(K&&T.y!==v.y){const G=N.scrollTop+x.y,q=j===Gt.Down&&G<=z.y||j===Gt.Up&&G>=C.y;if(q&&!x.x){N.scrollTo({top:G,behavior:h});return}q?w.y=N.scrollTop-G:w.y=j===Gt.Down?N.scrollTop-z.y:N.scrollTop-C.y,w.y&&N.scrollBy({top:-w.y,behavior:h});break}}this.handleMove(t,Za(jo(v,this.referenceCoordinates),w))}}}handleMove(t,s){const{onMove:l}=this.props;t.preventDefault(),l(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}ol.activators=[{eventName:"onKeyDown",handler:(n,t,s)=>{let{keyboardCodes:l=b0,onActivation:o}=t,{active:u}=s;const{code:d}=n.nativeEvent;if(l.start.includes(d)){const h=u.activatorNode.current;return h&&n.target!==h?!1:(n.preventDefault(),o?.({event:n.nativeEvent}),!0)}return!1}}];function xv(n){return!!(n&&"distance"in n)}function bv(n){return!!(n&&"delay"in n)}class gp{constructor(t,s,l){var o;l===void 0&&(l=C_(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:u}=t,{target:d}=u;this.props=t,this.events=s,this.document=il(d),this.documentListeners=new go(this.document),this.listeners=new go(l),this.windowListeners=new go(or(d)),this.initialCoordinates=(o=Nu(u))!=null?o:Zr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:l}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ir.Resize,this.handleCancel),this.windowListeners.add(Ir.DragStart,vv),this.windowListeners.add(Ir.VisibilityChange,this.handleCancel),this.windowListeners.add(Ir.ContextMenu,vv),this.documentListeners.add(Ir.Keydown,this.handleKeydown),s){if(l!=null&&l({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(bv(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(xv(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:l,onPending:o}=this.props;o(l,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ir.Click,N_,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ir.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:l,initialCoordinates:o,props:u}=this,{onMove:d,options:{activationConstraint:h}}=u;if(!o)return;const f=(s=Nu(t))!=null?s:Zr,m=jo(o,f);if(!l&&h){if(xv(h)){if(h.tolerance!=null&&af(m,h.tolerance))return this.handleCancel();if(af(m,h.distance))return this.handleStart()}if(bv(h)&&af(m,h.tolerance))return this.handleCancel();this.handlePending(h,m);return}t.cancelable&&t.preventDefault(),d(f)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===Gt.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const T_={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class qu extends gp{constructor(t){const{event:s}=t,l=il(s.target);super(t,T_,l)}}qu.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;return!s.isPrimary||s.button!==0?!1:(l?.({event:s}),!0)}}];const k_={move:{name:"mousemove"},end:{name:"mouseup"}};var Ff;(function(n){n[n.RightClick=2]="RightClick"})(Ff||(Ff={}));class Po extends gp{constructor(t){super(t,k_,il(t.event.target))}}Po.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;return s.button===Ff.RightClick?!1:(l?.({event:s}),!0)}}];const lf={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class qo extends gp{constructor(t){super(t,lf)}static setup(){return window.addEventListener(lf.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(lf.move.name,t)};function t(){}}}qo.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;const{touches:o}=s;return o.length>1?!1:(l?.({event:s}),!0)}}];var yo;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(yo||(yo={}));var Tu;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Tu||(Tu={}));function R_(n){let{acceleration:t,activator:s=yo.Pointer,canScroll:l,draggingRect:o,enabled:u,interval:d=5,order:h=Tu.TreeOrder,pointerCoordinates:f,scrollableAncestors:m,scrollableAncestorRects:y,delta:v,threshold:x}=n;const w=O_({delta:v,disabled:!u}),[_,N]=Vj(),j=b.useRef({x:0,y:0}),E=b.useRef({x:0,y:0}),O=b.useMemo(()=>{switch(s){case yo.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case yo.DraggableRect:return o}},[s,o,f]),D=b.useRef(null),$=b.useCallback(()=>{const C=D.current;if(!C)return;const M=j.current.x*E.current.x,T=j.current.y*E.current.y;C.scrollBy(M,T)},[]),z=b.useMemo(()=>h===Tu.TreeOrder?[...m].reverse():m,[h,m]);b.useEffect(()=>{if(!u||!m.length||!O){N();return}for(const C of z){if(l?.(C)===!1)continue;const M=m.indexOf(C),T=y[M];if(!T)continue;const{direction:F,speed:K}=b_(C,T,O,t,x);for(const G of["x","y"])w[G][F[G]]||(K[G]=0,F[G]=0);if(K.x>0||K.y>0){N(),D.current=C,_($,d),j.current=K,E.current=F;return}}j.current={x:0,y:0},E.current={x:0,y:0},N()},[t,$,l,N,u,d,JSON.stringify(O),JSON.stringify(w),_,m,z,y,JSON.stringify(x)])}const A_={x:{[Hn.Backward]:!1,[Hn.Forward]:!1},y:{[Hn.Backward]:!1,[Hn.Forward]:!1}};function O_(n){let{delta:t,disabled:s}=n;const l=Cu(t);return Bo(o=>{if(s||!l||!o)return A_;const u={x:Math.sign(t.x-l.x),y:Math.sign(t.y-l.y)};return{x:{[Hn.Backward]:o.x[Hn.Backward]||u.x===-1,[Hn.Forward]:o.x[Hn.Forward]||u.x===1},y:{[Hn.Backward]:o.y[Hn.Backward]||u.y===-1,[Hn.Forward]:o.y[Hn.Forward]||u.y===1}}},[s,t,l])}function D_(n,t){const s=t!=null?n.get(t):void 0,l=s?s.node.current:null;return Bo(o=>{var u;return t==null?null:(u=l??o)!=null?u:null},[l,t])}function M_(n,t){return b.useMemo(()=>n.reduce((s,l)=>{const{sensor:o}=l,u=o.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,l)}));return[...s,...u]},[]),[n,t])}var _o;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(_o||(_o={}));var Hf;(function(n){n.Optimized="optimized"})(Hf||(Hf={}));const wv=new Map;function z_(n,t){let{dragging:s,dependencies:l,config:o}=t;const[u,d]=b.useState(null),{frequency:h,measure:f,strategy:m}=o,y=b.useRef(n),v=j(),x=So(v),w=b.useCallback(function(E){E===void 0&&(E=[]),!x.current&&d(O=>O===null?E:O.concat(E.filter(D=>!O.includes(D))))},[x]),_=b.useRef(null),N=Bo(E=>{if(v&&!s)return wv;if(!E||E===wv||y.current!==n||u!=null){const O=new Map;for(let D of n){if(!D)continue;if(u&&u.length>0&&!u.includes(D.id)&&D.rect.current){O.set(D.id,D.rect.current);continue}const $=D.node.current,z=$?new mp(f($),$):null;D.rect.current=z,z&&O.set(D.id,z)}return O}return E},[n,u,s,v,f]);return b.useEffect(()=>{y.current=n},[n]),b.useEffect(()=>{v||w()},[s,v]),b.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),b.useEffect(()=>{v||typeof h!="number"||_.current!==null||(_.current=setTimeout(()=>{w(),_.current=null},h))},[h,v,w,...l]),{droppableRects:N,measureDroppableContainers:w,measuringScheduled:u!=null};function j(){switch(m){case _o.Always:return!1;case _o.BeforeDragging:return s;default:return!s}}}function yp(n,t){return Bo(s=>n?s||(typeof t=="function"?t(n):n):null,[t,n])}function U_(n,t){return yp(n,t)}function L_(n){let{callback:t,disabled:s}=n;const l=Bu(t),o=b.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(l)},[l,s]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function Fu(n){let{callback:t,disabled:s}=n;const l=Bu(t),o=b.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(l)},[s]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function I_(n){return new mp(ll(n),n)}function Sv(n,t,s){t===void 0&&(t=I_);const[l,o]=b.useState(null);function u(){o(f=>{if(!n)return null;if(n.isConnected===!1){var m;return(m=f??s)!=null?m:null}const y=t(n);return JSON.stringify(f)===JSON.stringify(y)?f:y})}const d=L_({callback(f){if(n)for(const m of f){const{type:y,target:v}=m;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),h=Fu({callback:u});return Xr(()=>{u(),n?(h?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(h?.disconnect(),d?.disconnect())},[n]),l}function B_(n){const t=yp(n);return d0(n,t)}const jv=[];function $_(n){const t=b.useRef(n),s=Bo(l=>n?l&&l!==jv&&n&&t.current&&n.parentNode===t.current.parentNode?l:Pu(n):jv,[n]);return b.useEffect(()=>{t.current=n},[n]),s}function P_(n){const[t,s]=b.useState(null),l=b.useRef(n),o=b.useCallback(u=>{const d=sf(u.target);d&&s(h=>h?(h.set(d,qf(d)),new Map(h)):null)},[]);return b.useEffect(()=>{const u=l.current;if(n!==u){d(u);const h=n.map(f=>{const m=sf(f);return m?(m.addEventListener("scroll",o,{passive:!0}),[m,qf(m)]):null}).filter(f=>f!=null);s(h.length?new Map(h):null),l.current=n}return()=>{d(n),d(u)};function d(h){h.forEach(f=>{const m=sf(f);m?.removeEventListener("scroll",o)})}},[o,n]),b.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>Za(u,d),Zr):v0(n):Zr,[n,t])}function _v(n,t){t===void 0&&(t=[]);const s=b.useRef(null);return b.useEffect(()=>{s.current=null},t),b.useEffect(()=>{const l=n!==Zr;l&&!s.current&&(s.current=n),!l&&s.current&&(s.current=null)},[n]),s.current?jo(n,s.current):Zr}function q_(n){b.useEffect(()=>{if(!Iu)return;const t=n.map(s=>{let{sensor:l}=s;return l.setup==null?void 0:l.setup()});return()=>{for(const s of t)s?.()}},n.map(t=>{let{sensor:s}=t;return s}))}function F_(n,t){return b.useMemo(()=>n.reduce((s,l)=>{let{eventName:o,handler:u}=l;return s[o]=d=>{u(d,t)},s},{}),[n,t])}function w0(n){return b.useMemo(()=>n?g_(n):null,[n])}const Cv=[];function H_(n,t){t===void 0&&(t=ll);const[s]=n,l=w0(s?or(s):null),[o,u]=b.useState(Cv);function d(){u(()=>n.length?n.map(f=>g0(f)?l:new mp(t(f),f)):Cv)}const h=Fu({callback:d});return Xr(()=>{h?.disconnect(),d(),n.forEach(f=>h?.observe(f))},[n]),o}function S0(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return Io(t)?t:n}function G_(n){let{measure:t}=n;const[s,l]=b.useState(null),o=b.useCallback(m=>{for(const{target:y}of m)if(Io(y)){l(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=Fu({callback:o}),d=b.useCallback(m=>{const y=S0(m);u?.disconnect(),y&&u?.observe(y),l(y?t(y):null)},[t,u]),[h,f]=_u(d);return b.useMemo(()=>({nodeRef:h,rect:s,setRef:f}),[s,h,f])}const V_=[{sensor:qu,options:{}},{sensor:ol,options:{}}],K_={current:{}},vu={draggable:{measure:yv},droppable:{measure:yv,strategy:_o.WhileDragging,frequency:Hf.Optimized},dragOverlay:{measure:ll}};class vo extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,l;return(s=(l=this.get(t))==null?void 0:l.node.current)!=null?s:void 0}}const Y_={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new vo,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Eu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:vu,measureDroppableContainers:Eu,windowRect:null,measuringScheduled:!1},j0={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Eu,draggableNodes:new Map,over:null,measureDroppableContainers:Eu},Fo=b.createContext(j0),_0=b.createContext(Y_);function Q_(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new vo}}}function W_(n,t){switch(t.type){case $n.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case $n.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case $n.DragEnd:case $n.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $n.RegisterDroppable:{const{element:s}=t,{id:l}=s,o=new vo(n.droppable.containers);return o.set(l,s),{...n,droppable:{...n.droppable,containers:o}}}case $n.SetDroppableDisabled:{const{id:s,key:l,disabled:o}=t,u=n.droppable.containers.get(s);if(!u||l!==u.key)return n;const d=new vo(n.droppable.containers);return d.set(s,{...u,disabled:o}),{...n,droppable:{...n.droppable,containers:d}}}case $n.UnregisterDroppable:{const{id:s,key:l}=t,o=n.droppable.containers.get(s);if(!o||l!==o.key)return n;const u=new vo(n.droppable.containers);return u.delete(s),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function J_(n){let{disabled:t}=n;const{active:s,activatorEvent:l,draggableNodes:o}=b.useContext(Fo),u=Cu(l),d=Cu(s?.id);return b.useEffect(()=>{if(!t&&!l&&u&&d!=null){if(!$u(u)||document.activeElement===u.target)return;const h=o.get(d);if(!h)return;const{activatorNode:f,node:m}=h;if(!f.current&&!m.current)return;requestAnimationFrame(()=>{for(const y of[f.current,m.current]){if(!y)continue;const v=Qj(y);if(v){v.focus();break}}})}},[l,t,o,d,u]),null}function C0(n,t){let{transform:s,...l}=t;return n!=null&&n.length?n.reduce((o,u)=>u({transform:o,...l}),s):s}function X_(n){return b.useMemo(()=>({draggable:{...vu.draggable,...n?.draggable},droppable:{...vu.droppable,...n?.droppable},dragOverlay:{...vu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function Z_(n){let{activeNode:t,measure:s,initialRect:l,config:o=!0}=n;const u=b.useRef(!1),{x:d,y:h}=typeof o=="boolean"?{x:o,y:o}:o;Xr(()=>{if(!d&&!h||!t){u.current=!1;return}if(u.current||!l)return;const m=t?.node.current;if(!m||m.isConnected===!1)return;const y=s(m),v=d0(y,l);if(d||(v.x=0),h||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=f0(m);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,h,l,s])}const Hu=b.createContext({...Zr,scaleX:1,scaleY:1});var mi;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(mi||(mi={}));const Xi=b.memo(function(t){var s,l,o,u;let{id:d,accessibility:h,autoScroll:f=!0,children:m,sensors:y=V_,collisionDetection:v=c_,measuring:x,modifiers:w,..._}=t;const N=b.useReducer(W_,void 0,Q_),[j,E]=N,[O,D]=t_(),[$,z]=b.useState(mi.Uninitialized),C=$===mi.Initialized,{draggable:{active:M,nodes:T,translate:F},droppable:{containers:K}}=j,G=M!=null?T.get(M):null,q=b.useRef({initial:null,translated:null}),V=b.useMemo(()=>{var Ze;return M!=null?{id:M,data:(Ze=G?.data)!=null?Ze:K_,rect:q}:null},[M,G]),P=b.useRef(null),[L,R]=b.useState(null),[I,Y]=b.useState(null),ue=So(_,Object.values(_)),ye=$o("DndDescribedBy",d),B=b.useMemo(()=>K.getEnabled(),[K]),J=X_(x),{droppableRects:Z,measureDroppableContainers:ge,measuringScheduled:Me}=z_(B,{dragging:C,dependencies:[F.x,F.y],config:J.droppable}),ve=D_(T,M),ae=b.useMemo(()=>I?Nu(I):null,[I]),A=Ke(),X=U_(ve,J.draggable.measure);Z_({activeNode:M!=null?T.get(M):null,config:A.layoutShiftCompensation,initialRect:X,measure:J.draggable.measure});const ce=Sv(ve,J.draggable.measure,X),Se=Sv(ve?ve.parentElement:null),Ae=b.useRef({activatorEvent:null,active:null,activeNode:ve,collisionRect:null,collisions:null,droppableRects:Z,draggableNodes:T,draggingNode:null,draggingNodeRect:null,droppableContainers:K,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Be=K.getNodeFor((s=Ae.current.over)==null?void 0:s.id),Le=G_({measure:J.dragOverlay.measure}),Ge=(l=Le.nodeRef.current)!=null?l:ve,W=C?(o=Le.rect)!=null?o:ce:null,Ce=!!(Le.nodeRef.current&&Le.rect),$e=B_(Ce?null:ce),rt=w0(Ge?or(Ge):null),mt=$_(C?Be??ve:null),ft=H_(mt),Dt=C0(w,{transform:{x:F.x-$e.x,y:F.y-$e.y,scaleX:1,scaleY:1},activatorEvent:I,active:V,activeNodeRect:ce,containerNodeRect:Se,draggingNodeRect:W,over:Ae.current.over,overlayNodeRect:Le.rect,scrollableAncestors:mt,scrollableAncestorRects:ft,windowRect:rt}),Vt=ae?Za(ae,F):null,St=P_(mt),oe=_v(St),_e=_v(St,[ce]),Ne=Za(Dt,oe),Ie=W?f_(W,Dt):null,it=V&&Ie?v({active:V,collisionRect:Ie,droppableRects:Z,droppableContainers:B,pointerCoordinates:Vt}):null,ut=c0(it,"id"),[kt,Jt]=b.useState(null),Sn=Ce?Dt:Za(Dt,_e),jt=d_(Sn,(u=kt?.rect)!=null?u:null,ce),rn=b.useRef(null),cn=b.useCallback((Ze,Ye)=>{let{sensor:tt,options:Mt}=Ye;if(P.current==null)return;const xt=T.get(P.current);if(!xt)return;const Rt=Ze.nativeEvent,et=new tt({active:P.current,activeNode:xt,event:Rt,options:Mt,context:Ae,onAbort(We){if(!T.get(We))return;const{onDragAbort:Xt}=ue.current,Qt={id:We};Xt?.(Qt),O({type:"onDragAbort",event:Qt})},onPending(We,Ut,Xt,Qt){if(!T.get(We))return;const{onDragPending:ne}=ue.current,fe={id:We,constraint:Ut,initialCoordinates:Xt,offset:Qt};ne?.(fe),O({type:"onDragPending",event:fe})},onStart(We){const Ut=P.current;if(Ut==null)return;const Xt=T.get(Ut);if(!Xt)return;const{onDragStart:Qt}=ue.current,re={activatorEvent:Rt,active:{id:Ut,data:Xt.data,rect:q}};Ki.unstable_batchedUpdates(()=>{Qt?.(re),z(mi.Initializing),E({type:$n.DragStart,initialCoordinates:We,active:Ut}),O({type:"onDragStart",event:re}),R(rn.current),Y(Rt)})},onMove(We){E({type:$n.DragMove,coordinates:We})},onEnd:Bt($n.DragEnd),onCancel:Bt($n.DragCancel)});rn.current=et;function Bt(We){return async function(){const{active:Xt,collisions:Qt,over:re,scrollAdjustedTranslate:ne}=Ae.current;let fe=null;if(Xt&&ne){const{cancelDrop:Te}=ue.current;fe={activatorEvent:Rt,active:Xt,collisions:Qt,delta:ne,over:re},We===$n.DragEnd&&typeof Te=="function"&&await Promise.resolve(Te(fe))&&(We=$n.DragCancel)}P.current=null,Ki.unstable_batchedUpdates(()=>{E({type:We}),z(mi.Uninitialized),Jt(null),R(null),Y(null),rn.current=null;const Te=We===$n.DragEnd?"onDragEnd":"onDragCancel";if(fe){const Pe=ue.current[Te];Pe?.(fe),O({type:Te,event:fe})}})}}},[T]),xn=b.useCallback((Ze,Ye)=>(tt,Mt)=>{const xt=tt.nativeEvent,Rt=T.get(Mt);if(P.current!==null||!Rt||xt.dndKit||xt.defaultPrevented)return;const et={active:Rt};Ze(tt,Ye.options,et)===!0&&(xt.dndKit={capturedBy:Ye.sensor},P.current=Mt,cn(tt,Ye))},[T,cn]),Ln=M_(y,xn);q_(y),Xr(()=>{ce&&$===mi.Initializing&&z(mi.Initialized)},[ce,$]),b.useEffect(()=>{const{onDragMove:Ze}=ue.current,{active:Ye,activatorEvent:tt,collisions:Mt,over:xt}=Ae.current;if(!Ye||!tt)return;const Rt={active:Ye,activatorEvent:tt,collisions:Mt,delta:{x:Ne.x,y:Ne.y},over:xt};Ki.unstable_batchedUpdates(()=>{Ze?.(Rt),O({type:"onDragMove",event:Rt})})},[Ne.x,Ne.y]),b.useEffect(()=>{const{active:Ze,activatorEvent:Ye,collisions:tt,droppableContainers:Mt,scrollAdjustedTranslate:xt}=Ae.current;if(!Ze||P.current==null||!Ye||!xt)return;const{onDragOver:Rt}=ue.current,et=Mt.get(ut),Bt=et&&et.rect.current?{id:et.id,rect:et.rect.current,data:et.data,disabled:et.disabled}:null,We={active:Ze,activatorEvent:Ye,collisions:tt,delta:{x:xt.x,y:xt.y},over:Bt};Ki.unstable_batchedUpdates(()=>{Jt(Bt),Rt?.(We),O({type:"onDragOver",event:We})})},[ut]),Xr(()=>{Ae.current={activatorEvent:I,active:V,activeNode:ve,collisionRect:Ie,collisions:it,droppableRects:Z,draggableNodes:T,draggingNode:Ge,draggingNodeRect:W,droppableContainers:K,over:kt,scrollableAncestors:mt,scrollAdjustedTranslate:Ne},q.current={initial:W,translated:Ie}},[V,ve,it,Ie,T,Ge,W,Z,K,kt,mt,Ne]),R_({...A,delta:F,draggingRect:Ie,pointerCoordinates:Vt,scrollableAncestors:mt,scrollableAncestorRects:ft});const ar=b.useMemo(()=>({active:V,activeNode:ve,activeNodeRect:ce,activatorEvent:I,collisions:it,containerNodeRect:Se,dragOverlay:Le,draggableNodes:T,droppableContainers:K,droppableRects:Z,over:kt,measureDroppableContainers:ge,scrollableAncestors:mt,scrollableAncestorRects:ft,measuringConfiguration:J,measuringScheduled:Me,windowRect:rt}),[V,ve,ce,I,it,Se,Le,T,K,Z,kt,ge,mt,ft,J,Me,rt]),me=b.useMemo(()=>({activatorEvent:I,activators:Ln,active:V,activeNodeRect:ce,ariaDescribedById:{draggable:ye},dispatch:E,draggableNodes:T,over:kt,measureDroppableContainers:ge}),[I,Ln,V,ce,E,ye,T,kt,ge]);return we.createElement(o0.Provider,{value:D},we.createElement(Fo.Provider,{value:me},we.createElement(_0.Provider,{value:ar},we.createElement(Hu.Provider,{value:jt},m)),we.createElement(J_,{disabled:h?.restoreFocus===!1})),we.createElement(s_,{...h,hiddenTextDescribedById:ye}));function Ke(){const Ze=L?.autoScrollEnabled===!1,Ye=typeof f=="object"?f.enabled===!1:f===!1,tt=C&&!Ze&&!Ye;return typeof f=="object"?{...f,enabled:tt}:{enabled:tt}}}),e1=b.createContext(null),Nv="button",t1="Draggable";function vp(n){let{id:t,data:s,disabled:l=!1,attributes:o}=n;const u=$o(t1),{activators:d,activatorEvent:h,active:f,activeNodeRect:m,ariaDescribedById:y,draggableNodes:v,over:x}=b.useContext(Fo),{role:w=Nv,roleDescription:_="draggable",tabIndex:N=0}=o??{},j=f?.id===t,E=b.useContext(j?Hu:e1),[O,D]=_u(),[$,z]=_u(),C=F_(d,t),M=So(s);Xr(()=>(v.set(t,{id:t,key:u,node:O,activatorNode:$,data:M}),()=>{const F=v.get(t);F&&F.key===u&&v.delete(t)}),[v,t]);const T=b.useMemo(()=>({role:w,tabIndex:N,"aria-disabled":l,"aria-pressed":j&&w===Nv?!0:void 0,"aria-roledescription":_,"aria-describedby":y.draggable}),[l,w,N,j,_,y.draggable]);return{active:f,activatorEvent:h,activeNodeRect:m,attributes:T,isDragging:j,listeners:l?void 0:C,node:O,over:x,setNodeRef:D,setActivatorNodeRef:z,transform:E}}function N0(){return b.useContext(_0)}const n1="Droppable",r1={timeout:25};function Ho(n){let{data:t,disabled:s=!1,id:l,resizeObserverConfig:o}=n;const u=$o(n1),{active:d,dispatch:h,over:f,measureDroppableContainers:m}=b.useContext(Fo),y=b.useRef({disabled:s}),v=b.useRef(!1),x=b.useRef(null),w=b.useRef(null),{disabled:_,updateMeasurementsFor:N,timeout:j}={...r1,...o},E=So(N??l),O=b.useCallback(()=>{if(!v.current){v.current=!0;return}w.current!=null&&clearTimeout(w.current),w.current=setTimeout(()=>{m(Array.isArray(E.current)?E.current:[E.current]),w.current=null},j)},[j]),D=Fu({callback:O,disabled:_||!d}),$=b.useCallback((T,F)=>{D&&(F&&(D.unobserve(F),v.current=!1),T&&D.observe(T))},[D]),[z,C]=_u($),M=So(t);return b.useEffect(()=>{!D||!z.current||(D.disconnect(),v.current=!1,D.observe(z.current))},[z,D]),b.useEffect(()=>(h({type:$n.RegisterDroppable,element:{id:l,key:u,disabled:s,node:z,rect:x,data:M}}),()=>h({type:$n.UnregisterDroppable,key:u,id:l})),[l]),b.useEffect(()=>{s!==y.current.disabled&&(h({type:$n.SetDroppableDisabled,id:l,key:u,disabled:s}),y.current.disabled=s)},[l,u,s,h]),{active:d,rect:x,isOver:f?.id===l,node:z,over:f,setNodeRef:C}}function s1(n){let{animation:t,children:s}=n;const[l,o]=b.useState(null),[u,d]=b.useState(null),h=Cu(s);return!s&&!l&&h&&o(h),Xr(()=>{if(!u)return;const f=l?.key,m=l?.props.id;if(f==null||m==null){o(null);return}Promise.resolve(t(m,u)).then(()=>{o(null)})},[t,l,u]),we.createElement(we.Fragment,null,s,l?b.cloneElement(l,{ref:d}):null)}const i1={x:0,y:0,scaleX:1,scaleY:1};function a1(n){let{children:t}=n;return we.createElement(Fo.Provider,{value:j0},we.createElement(Hu.Provider,{value:i1},t))}const l1={position:"fixed",touchAction:"none"},o1=n=>$u(n)?"transform 250ms ease":void 0,c1=b.forwardRef((n,t)=>{let{as:s,activatorEvent:l,adjustScale:o,children:u,className:d,rect:h,style:f,transform:m,transition:y=o1}=n;if(!h)return null;const v=o?m:{...m,scaleX:1,scaleY:1},x={...l1,width:h.width,height:h.height,top:h.top,left:h.left,transform:Tr.Transform.toString(v),transformOrigin:o&&l?i_(l,h):void 0,transition:typeof y=="function"?y(l):y,...f};return we.createElement(s,{className:d,style:x,ref:t},u)}),xp=n=>t=>{let{active:s,dragOverlay:l}=t;const o={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[h,f]of Object.entries(u.active))f!==void 0&&(o[h]=s.node.style.getPropertyValue(h),s.node.style.setProperty(h,f));if(u!=null&&u.dragOverlay)for(const[h,f]of Object.entries(u.dragOverlay))f!==void 0&&l.node.style.setProperty(h,f);return d!=null&&d.active&&s.node.classList.add(d.active),d!=null&&d.dragOverlay&&l.node.classList.add(d.dragOverlay),function(){for(const[f,m]of Object.entries(o))s.node.style.setProperty(f,m);d!=null&&d.active&&s.node.classList.remove(d.active)}},u1=n=>{let{transform:{initial:t,final:s}}=n;return[{transform:Tr.Transform.toString(t)},{transform:Tr.Transform.toString(s)}]},d1={duration:250,easing:"ease",keyframes:u1,sideEffects:xp({styles:{active:{opacity:"0"}}})};function h1(n){let{config:t,draggableNodes:s,droppableContainers:l,measuringConfiguration:o}=n;return Bu((u,d)=>{if(t===null)return;const h=s.get(u);if(!h)return;const f=h.node.current;if(!f)return;const m=S0(d);if(!m)return;const{transform:y}=or(d).getComputedStyle(d),v=h0(y);if(!v)return;const x=typeof t=="function"?t:f1(t);return x0(f,o.draggable.measure),x({active:{id:u,data:h.data,node:f,rect:o.draggable.measure(f)},draggableNodes:s,dragOverlay:{node:d,rect:o.dragOverlay.measure(m)},droppableContainers:l,measuringConfiguration:o,transform:v})})}function f1(n){const{duration:t,easing:s,sideEffects:l,keyframes:o}={...d1,...n};return u=>{let{active:d,dragOverlay:h,transform:f,...m}=u;if(!t)return;const y={x:h.rect.left-d.rect.left,y:h.rect.top-d.rect.top},v={scaleX:f.scaleX!==1?d.rect.width*f.scaleX/h.rect.width:1,scaleY:f.scaleY!==1?d.rect.height*f.scaleY/h.rect.height:1},x={x:f.x-y.x,y:f.y-y.y,...v},w=o({...m,active:d,dragOverlay:h,transform:{initial:f,final:x}}),[_]=w,N=w[w.length-1];if(JSON.stringify(_)===JSON.stringify(N))return;const j=l?.({active:d,dragOverlay:h,...m}),E=h.node.animate(w,{duration:t,easing:s,fill:"forwards"});return new Promise(O=>{E.onfinish=()=>{j?.(),O()}})}}let Ev=0;function p1(n){return b.useMemo(()=>{if(n!=null)return Ev++,Ev},[n])}const E0=we.memo(n=>{let{adjustScale:t=!1,children:s,dropAnimation:l,style:o,transition:u,modifiers:d,wrapperElement:h="div",className:f,zIndex:m=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:w,draggableNodes:_,droppableContainers:N,dragOverlay:j,over:E,measuringConfiguration:O,scrollableAncestors:D,scrollableAncestorRects:$,windowRect:z}=N0(),C=b.useContext(Hu),M=p1(v?.id),T=C0(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:w,draggingNodeRect:j.rect,over:E,overlayNodeRect:j.rect,scrollableAncestors:D,scrollableAncestorRects:$,transform:C,windowRect:z}),F=yp(x),K=h1({config:l,draggableNodes:_,droppableContainers:N,measuringConfiguration:O}),G=F?j.setRef:void 0;return we.createElement(a1,null,we.createElement(s1,{animation:K},v&&M?we.createElement(c1,{key:M,id:v.id,ref:G,as:h,activatorEvent:y,adjustScale:t,className:f,transition:u,rect:F,style:{zIndex:m,...o},transform:T},s):null))});function Zi(n,t,s){const l=n.slice();return l.splice(s<0?l.length+s:s,0,l.splice(t,1)[0]),l}function m1(n,t){return n.reduce((s,l,o)=>{const u=t.get(l);return u&&(s[o]=u),s},Array(n.length))}function ru(n){return n!==null&&n>=0}function g1(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==t[s])return!1;return!0}function y1(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const bp=n=>{let{rects:t,activeIndex:s,overIndex:l,index:o}=n;const u=Zi(t,l,s),d=t[o],h=u[o];return!h||!d?null:{x:h.left-d.left,y:h.top-d.top,scaleX:h.width/d.width,scaleY:h.height/d.height}},su={scaleX:1,scaleY:1},Co=n=>{var t;let{activeIndex:s,activeNodeRect:l,index:o,rects:u,overIndex:d}=n;const h=(t=u[s])!=null?t:l;if(!h)return null;if(o===s){const m=u[d];return m?{x:0,y:s<d?m.top+m.height-(h.top+h.height):m.top-h.top,...su}:null}const f=v1(u,o,s);return o>s&&o<=d?{x:0,y:-h.height-f,...su}:o<s&&o>=d?{x:0,y:h.height+f,...su}:{x:0,y:0,...su}};function v1(n,t,s){const l=n[t],o=n[t-1],u=n[t+1];return l?s<t?o?l.top-(o.top+o.height):u?u.top-(l.top+l.height):0:u?u.top-(l.top+l.height):o?l.top-(o.top+o.height):0:0}const T0="Sortable",k0=we.createContext({activeIndex:-1,containerId:T0,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:bp,disabled:{draggable:!1,droppable:!1}});function tl(n){let{children:t,id:s,items:l,strategy:o=bp,disabled:u=!1}=n;const{active:d,dragOverlay:h,droppableRects:f,over:m,measureDroppableContainers:y}=N0(),v=$o(T0,s),x=h.rect!==null,w=b.useMemo(()=>l.map(C=>typeof C=="object"&&"id"in C?C.id:C),[l]),_=d!=null,N=d?w.indexOf(d.id):-1,j=m?w.indexOf(m.id):-1,E=b.useRef(w),O=!g1(w,E.current),D=j!==-1&&N===-1||O,$=y1(u);Xr(()=>{O&&_&&y(w)},[O,w,_,y]),b.useEffect(()=>{E.current=w},[w]);const z=b.useMemo(()=>({activeIndex:N,containerId:v,disabled:$,disableTransforms:D,items:w,overIndex:j,useDragOverlay:x,sortedRects:m1(w,f),strategy:o}),[N,v,$.draggable,$.droppable,D,w,j,f,x,o]);return we.createElement(k0.Provider,{value:z},t)}const x1=n=>{let{id:t,items:s,activeIndex:l,overIndex:o}=n;return Zi(s,l,o).indexOf(t)},b1=n=>{let{containerId:t,isSorting:s,wasDragging:l,index:o,items:u,newIndex:d,previousItems:h,previousContainerId:f,transition:m}=n;return!m||!l||h!==u&&o===d?!1:s?!0:d!==o&&t===f},w1={duration:200,easing:"ease"},R0="transform",S1=Tr.Transition.toString({property:R0,duration:0,easing:"linear"}),j1={roleDescription:"sortable"};function _1(n){let{disabled:t,index:s,node:l,rect:o}=n;const[u,d]=b.useState(null),h=b.useRef(s);return Xr(()=>{if(!t&&s!==h.current&&l.current){const f=o.current;if(f){const m=ll(l.current,{ignoreTransform:!0}),y={x:f.left-m.left,y:f.top-m.top,scaleX:f.width/m.width,scaleY:f.height/m.height};(y.x||y.y)&&d(y)}}s!==h.current&&(h.current=s)},[t,s,l,o]),b.useEffect(()=>{u&&d(null)},[u]),u}function cl(n){let{animateLayoutChanges:t=b1,attributes:s,disabled:l,data:o,getNewIndex:u=x1,id:d,strategy:h,resizeObserverConfig:f,transition:m=w1}=n;const{items:y,containerId:v,activeIndex:x,disabled:w,disableTransforms:_,sortedRects:N,overIndex:j,useDragOverlay:E,strategy:O}=b.useContext(k0),D=C1(l,w),$=y.indexOf(d),z=b.useMemo(()=>({sortable:{containerId:v,index:$,items:y},...o}),[v,o,$,y]),C=b.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:M,node:T,isOver:F,setNodeRef:K}=Ho({id:d,data:z,disabled:D.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...f}}),{active:G,activatorEvent:q,activeNodeRect:V,attributes:P,setNodeRef:L,listeners:R,isDragging:I,over:Y,setActivatorNodeRef:ue,transform:ye}=vp({id:d,data:z,attributes:{...j1,...s},disabled:D.draggable}),B=Gj(K,L),J=!!G,Z=J&&!_&&ru(x)&&ru(j),ge=!E&&I,Me=ge&&Z?ye:null,ae=Z?Me??(h??O)({rects:N,activeNodeRect:V,activeIndex:x,overIndex:j,index:$}):null,A=ru(x)&&ru(j)?u({id:d,items:y,activeIndex:x,overIndex:j}):$,X=G?.id,ce=b.useRef({activeId:X,items:y,newIndex:A,containerId:v}),Se=y!==ce.current.items,Ae=t({active:G,containerId:v,isDragging:I,isSorting:J,id:d,index:$,items:y,newIndex:ce.current.newIndex,previousItems:ce.current.items,previousContainerId:ce.current.containerId,transition:m,wasDragging:ce.current.activeId!=null}),Be=_1({disabled:!Ae,index:$,node:T,rect:M});return b.useEffect(()=>{J&&ce.current.newIndex!==A&&(ce.current.newIndex=A),v!==ce.current.containerId&&(ce.current.containerId=v),y!==ce.current.items&&(ce.current.items=y)},[J,A,v,y]),b.useEffect(()=>{if(X===ce.current.activeId)return;if(X!=null&&ce.current.activeId==null){ce.current.activeId=X;return}const Ge=setTimeout(()=>{ce.current.activeId=X},50);return()=>clearTimeout(Ge)},[X]),{active:G,activeIndex:x,attributes:P,data:z,rect:M,index:$,newIndex:A,items:y,isOver:F,isSorting:J,isDragging:I,listeners:R,node:T,overIndex:j,over:Y,setNodeRef:B,setActivatorNodeRef:ue,setDroppableNodeRef:K,setDraggableNodeRef:L,transform:Be??ae,transition:Le()};function Le(){if(Be||Se&&ce.current.newIndex===$)return S1;if(!(ge&&!$u(q)||!m)&&(J||Ae))return Tr.Transition.toString({...m,property:R0})}}function C1(n,t){var s,l;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(s=n?.draggable)!=null?s:t.draggable,droppable:(l=n?.droppable)!=null?l:t.droppable}}function ku(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const N1=[Gt.Down,Gt.Right,Gt.Up,Gt.Left],Gu=(n,t)=>{let{context:{active:s,collisionRect:l,droppableRects:o,droppableContainers:u,over:d,scrollableAncestors:h}}=t;if(N1.includes(n.code)){if(n.preventDefault(),!s||!l)return;const f=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=o.get(v.id);if(x)switch(n.code){case Gt.Down:l.top<x.top&&f.push(v);break;case Gt.Up:l.top>x.top&&f.push(v);break;case Gt.Left:l.left>x.left&&f.push(v);break;case Gt.Right:l.left<x.left&&f.push(v);break}});const m=l_({collisionRect:l,droppableRects:o,droppableContainers:f});let y=c0(m,"id");if(y===d?.id&&m.length>1&&(y=m[1].id),y!=null){const v=u.get(s.id),x=u.get(y),w=x?o.get(x.id):null,_=x?.node.current;if(_&&w&&v&&x){const j=Pu(_).some((C,M)=>h[M]!==C),E=A0(v,x),O=E1(v,x),D=j||!E?{x:0,y:0}:{x:O?l.width-w.width:0,y:O?l.height-w.height:0},$={x:w.left,y:w.top};return D.x&&D.y?$:jo($,D)}}}};function A0(n,t){return!ku(n)||!ku(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function E1(n,t){return!ku(n)||!ku(t)||!A0(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const Tv=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},xi=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],T1=({recipe:n,isSelected:t,isSelectMode:s,onSelectRecipe:l,onToggleSelection:o,disableDrag:u,showOwner:d,ownerLabelFn:h})=>{const{attributes:f,listeners:m,setNodeRef:y,transform:v,transition:x,isDragging:w}=cl({id:n.id,disabled:u}),_={transform:Tr.Transform.toString(v),transition:x,opacity:w?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"};return i.jsx("div",{ref:y,style:_,...f,...m,children:i.jsxs(tn,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some(N=>/|Dessert/i.test(N))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{s?o(n.id):l(n)},children:[i.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?i.jsx("img",{src:n.image,alt:n.title,className:"recipe-card__image",loading:"lazy",decoding:"async"}):i.jsx("div",{className:"recipe-card__image placeholder"}),i.jsx("div",{className:"recipe-card__overlay"}),s&&i.jsx("div",{className:"recipe-card__selection-overlay",children:i.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),i.jsx("div",{className:"recipe-card__tags",children:(()=>{const N=xi(n.tags);if(N.length===0)return null;const j=N.filter(D=>!D.startsWith("owner:"));return(j.includes("URL")?["URL"]:j).slice(0,1).map((D,$)=>i.jsx("span",{className:"recipe-tag",children:D},`${D}-${$}`))})()})]}),i.jsxs("div",{className:"recipe-card__content",children:[i.jsx("h3",{className:"recipe-title",children:n.title}),i.jsx("p",{className:"recipe-desc",children:n.description}),i.jsxs("div",{className:"recipe-meta",children:[n.storeName&&i.jsxs("span",{children:[" ",n.storeName]}),d&&typeof h=="function"&&i.jsxs("span",{className:"recipe-owner",children:[" ",h(n)]}),i.jsxs("div",{className:"recipe-dates",children:[i.jsxs("span",{className:"recipe-date",children:[" : ",Tv(n.created_at)]}),n.updated_at&&i.jsxs("span",{className:"recipe-date",children:[" : ",Tv(n.updated_at)]})]})]})]})]})})},kv=n=>{const t=xi(n.tags);return n.type==="bread"||t.some(s=>/|Bread/i.test(s))},Rv=n=>{const t=l=>/|Dessert/i.test(l),s=xi(n.tags);return/|Dessert/i.test(n.category||"")||s.some(t)},Av=n=>{const t=xi(n.tags);return/|Sauce/i.test(n.category||"")||t.some(s=>/|Sauce/i.test(s))},Ov=n=>{const t=xi(n.tags);return/||Decor/i.test(n.category||"")||t.some(s=>/||Decor/i.test(s))},Dv=n=>{const t=n.category||"",s=xi(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||s.some(l=>/|Dressing||Vinaigrette||Mayonnaise/i.test(l))},Mv=n=>{const t=n.filter(v=>kv(v)),s=n.filter(v=>!kv(v)),l=s.filter(v=>Av(v)),o=s.filter(v=>!Av(v)),u=o.filter(v=>Ov(v)),d=o.filter(v=>!Ov(v)),h=d.filter(v=>Dv(v)),f=d.filter(v=>!Dv(v)),m=f.filter(v=>Rv(v));return{cookingRecipes:f.filter(v=>!Rv(v)),breadRecipes:t,dessertRecipes:m,sauceRecipes:l,dressingRecipes:h,decorationRecipes:u}},zv=({recipes:n,onSelectRecipe:t,isSelectMode:s,selectedIds:l,onToggleSelection:o,disableDrag:u,displayMode:d="normal",publicRecipeView:h="none",showOwner:f=!1,ownerLabelFn:m,currentUser:y=null})=>{const[v,x]=b.useState({}),w=L=>{x(R=>({...R,[L]:!R[L]}))},_=L=>xi(L?.tags).map(I=>I.toLowerCase()).includes("public"),N=L=>{if(!y)return!1;const R=xi(L?.tags).filter(Y=>Y.startsWith("owner:"));if(R.length===0)return!1;const I=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return R.some(Y=>I.has(Y))},j=n.filter(L=>_(L)),E=j.filter(L=>N(L)),O=j.filter(L=>!N(L)),D=n.filter(L=>!_(L)),{cookingRecipes:$,breadRecipes:z,dessertRecipes:C,sauceRecipes:M,dressingRecipes:T,decorationRecipes:F}=Mv(D),[K,G]=b.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);we.useEffect(()=>{const L=()=>{window.innerWidth>=1024?G(9):G(8)};return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[]);const q=(L,R,I,Y,{showWhenEmpty:ue=!1,emptyMessage:ye=""}={})=>{if(R.length===0&&!ue)return null;const B=d==="all";let J=R,Z=!1,ge=!1;return B||(Z=v[Y],ge=R.length>K,J=Z?R:R.slice(0,K)),i.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{onClick:()=>!B&&ge&&w(Y),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!B&&ge?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[i.jsx("span",{children:I})," ",L,i.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",R.length,")"]}),!B&&ge&&i.jsx("span",{className:"section-toggle-btn",children:Z?" ":" "})]}),i.jsx("div",{className:"recipe-grid",children:i.jsx(tl,{items:J.map(Me=>Me.id),strategy:bp,children:J.map(Me=>{const ve=l&&l.has(Me.id);return i.jsx(T1,{recipe:Me,isSelected:ve,isSelectMode:s,onSelectRecipe:t,onToggleSelection:o,disableDrag:u,showOwner:f,ownerLabelFn:m},Me.id)})})}),R.length===0&&i.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:ye||`${L}`})]})},V=()=>{if(h!=="mine"&&h!=="others")return null;const L=h==="mine",R=L?"":"",I=L?"":"",Y=L?"public-mine":"public-others",ue=L?E:O,ye=L?"":"",B=Mv(ue);return i.jsxs("div",{className:"public-recipes-block",children:[i.jsxs("div",{className:"public-recipes-block__header",children:[i.jsx("span",{children:I}),i.jsx("span",{children:R}),i.jsxs("span",{className:"public-recipes-block__count",children:["(",ue.length,")"]})]}),ue.length===0?i.jsx("div",{className:"public-recipes-block__empty",children:ye}):i.jsxs(i.Fragment,{children:[q("",B.cookingRecipes,"",`${Y}-cooking`),q("",B.breadRecipes,"",`${Y}-bread`),q("",B.dessertRecipes,"",`${Y}-dessert`),q("",B.sauceRecipes,"",`${Y}-sauce`),q("",B.dressingRecipes,"",`${Y}-dressing`),q("",B.decorationRecipes,"",`${Y}-decoration`)]})]})},P=h==="none"&&j.length>0&&D.length===0;return i.jsxs("div",{className:"recipe-list-container",children:[V(),P&&i.jsx("div",{className:"recipe-list-empty-hint",children:""}),q("",$,"","cooking"),q("",z,"","bread"),q("",C,"","dessert"),q("",M,"","sauce"),q("",T,"","dressing"),q("",F,"","decoration"),n.length===0&&i.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},yn=({isOpen:n,onClose:t,title:s,children:l,size:o="medium",showCloseButton:u=!0})=>{if(b.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),b.useEffect(()=>{const h=f=>{f.key==="Escape"&&n&&t()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[n,t]),!n)return null;const d=h=>{h.target===h.currentTarget&&t()};return i.jsx("div",{className:"modal-overlay",onClick:d,children:i.jsxs("div",{className:`modal-content modal-${o}`,children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h3",{className:"modal-title",children:s}),u&&i.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),i.jsx("div",{className:"modal-body",children:l})]})})};function Vu(n,t){var s={};for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&t.indexOf(l)<0&&(s[l]=n[l]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,l=Object.getOwnPropertySymbols(n);o<l.length;o++)t.indexOf(l[o])<0&&Object.prototype.propertyIsEnumerable.call(n,l[o])&&(s[l[o]]=n[l[o]]);return s}function k1(n,t,s,l){function o(u){return u instanceof s?u:new s(function(d){d(u)})}return new(s||(s=Promise))(function(u,d){function h(y){try{m(l.next(y))}catch(v){d(v)}}function f(y){try{m(l.throw(y))}catch(v){d(v)}}function m(y){y.done?u(y.value):o(y.value).then(h,f)}m((l=l.apply(n,t||[])).next())})}const R1=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class wp extends Error{constructor(t,s="FunctionsError",l){super(t),this.name=s,this.context=l}}class A1 extends wp{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class Uv extends wp{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Lv extends wp{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Gf;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Gf||(Gf={}));class O1{constructor(t,{headers:s={},customFetch:l,region:o=Gf.Any}={}){this.url=t,this.headers=s,this.region=o,this.fetch=R1(l)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return k1(this,arguments,void 0,function*(s,l={}){var o;let u,d;try{const{headers:h,method:f,body:m,signal:y,timeout:v}=l;let x={},{region:w}=l;w||(w=this.region);const _=new URL(`${this.url}/${s}`);w&&w!=="any"&&(x["x-region"]=w,_.searchParams.set("forceFunctionRegion",w));let N;m&&(h&&!Object.prototype.hasOwnProperty.call(h,"Content-Type")||!h)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",N=m):typeof m=="string"?(x["Content-Type"]="text/plain",N=m):typeof FormData<"u"&&m instanceof FormData?N=m:(x["Content-Type"]="application/json",N=JSON.stringify(m)):N=m;let j=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(j=d.signal,y.addEventListener("abort",()=>d.abort())):j=d.signal);const E=yield this.fetch(_.toString(),{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),h),body:N,signal:j}).catch(z=>{throw new A1(z)}),O=E.headers.get("x-relay-error");if(O&&O==="true")throw new Uv(E);if(!E.ok)throw new Lv(E);let D=((o=E.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),$;return D==="application/json"?$=yield E.json():D==="application/octet-stream"||D==="application/pdf"?$=yield E.blob():D==="text/event-stream"?$=E:D==="multipart/form-data"?$=yield E.formData():$=yield E.text(),{data:$,error:null,response:E}}catch(h){return{data:null,error:h,response:h instanceof Lv||h instanceof Uv?h.context:void 0}}finally{u&&clearTimeout(u)}})}}var D1=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},M1=class{constructor(n){var t,s;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(s=n.isMaybeSingle)!==null&&s!==void 0?s:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const l=this.fetch;let o=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,h=null,f=null,m=u.status,y=u.statusText;if(u.ok){var v,x;if(s.method!=="HEAD"){var w;const E=await u.text();E===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((w=s.headers.get("Accept"))===null||w===void 0)&&w.includes("application/vnd.pgrst.plan+text"))?h=E:h=JSON.parse(E))}const N=(v=s.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),j=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");N&&j&&j.length>1&&(f=parseInt(j[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(h)&&(h.length>1?(d={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,f=null,m=406,y="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{var _;const N=await u.text();try{d=JSON.parse(N),Array.isArray(d)&&u.status===404&&(h=[],d=null,m=200,y="OK")}catch{u.status===404&&N===""?(m=204,y="No Content"):d={message:N}}if(d&&s.isMaybeSingle&&(!(d==null||(_=d.details)===null||_===void 0)&&_.includes("0 rows"))&&(d=null,m=200,y="OK"),d&&s.shouldThrowOnError)throw new D1(d)}return{error:d,data:h,count:f,status:m,statusText:y}});return this.shouldThrowOnError||(o=o.catch(u=>{var d;let h="";const f=u?.cause;if(f){var m,y,v,x;const _=(m=f?.message)!==null&&m!==void 0?m:"",N=(y=f?.code)!==null&&y!==void 0?y:"";h=`${(v=u?.name)!==null&&v!==void 0?v:"FetchError"}: ${u?.message}`,h+=`

Caused by: ${(x=f?.name)!==null&&x!==void 0?x:"Error"}: ${_}`,N&&(h+=` (${N})`),f?.stack&&(h+=`
${f.stack}`)}else{var w;h=(w=u?.stack)!==null&&w!==void 0?w:""}return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:h,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),o.then(n,t)}returns(){return this}overrideTypes(){return this}},z1=class extends M1{select(n){let t=!1;const s=(n??"*").split("").map(l=>/\s/.test(l)&&!t?"":(l==='"'&&(t=!t),l)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:s,foreignTable:l,referencedTable:o=l}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:s=t}={}){const l=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(l,`${n}`),this}range(n,t,{foreignTable:s,referencedTable:l=s}={}){const o=typeof l>"u"?"offset":`${l}.offset`,u=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(o,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:s=!1,buffers:l=!1,wal:o=!1,format:u="text"}={}){var d;const h=[n?"analyze":null,t?"verbose":null,s?"settings":null,l?"buffers":null,o?"wal":null].filter(Boolean).join("|"),f=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${f}"; options=${h};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const Iv=new RegExp("[,()]");var Ka=class extends z1{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const s=Array.from(new Set(t)).map(l=>typeof l=="string"&&Iv.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`in.(${s})`),this}notIn(n,t){const s=Array.from(new Set(t)).map(l=>typeof l=="string"&&Iv.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`not.in.(${s})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:s,type:l}={}){let o="";l==="plain"?o="pl":l==="phrase"?o="ph":l==="websearch"&&(o="w");const u=s===void 0?"":`(${s})`;return this.url.searchParams.append(n,`${o}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(n,t,s){return this.url.searchParams.append(n,`not.${t}.${s}`),this}or(n,{foreignTable:t,referencedTable:s=t}={}){const l=s?`${s}.or`:"or";return this.url.searchParams.append(l,`(${n})`),this}filter(n,t,s){return this.url.searchParams.append(n,`${t}.${s}`),this}},U1=class{constructor(n,{headers:t={},schema:s,fetch:l}){this.url=n,this.headers=new Headers(t),this.schema=s,this.fetch=l}select(n,t){const{head:s=!1,count:l}=t??{},o=s?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(h=>/\s/.test(h)&&!u?"":(h==='"'&&(u=!u),h)).join("");return this.url.searchParams.set("select",d),l&&this.headers.append("Prefer",`count=${l}`),new Ka({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:t,defaultToNull:s=!0}={}){var l;const o="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(u.length>0){const d=[...new Set(u)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new Ka({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(n,{onConflict:t,ignoreDuplicates:s=!1,count:l,defaultToNull:o=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),l&&this.headers.append("Prefer",`count=${l}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const h=n.reduce((f,m)=>f.concat(Object.keys(m)),[]);if(h.length>0){const f=[...new Set(h)].map(m=>`"${m}"`);this.url.searchParams.set("columns",f.join(","))}}return new Ka({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(n,{count:t}={}){var s;const l="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Ka({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:n}={}){var t;const s="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new Ka({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},L1=class O0{constructor(t,{headers:s={},schema:l,fetch:o}={}){this.url=t,this.headers=new Headers(s),this.schemaName=l,this.fetch=o}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new U1(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new O0(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:l=!1,get:o=!1,count:u}={}){var d;let h;const f=new URL(`${this.url}/rpc/${t}`);let m;l||o?(h=l?"HEAD":"GET",Object.entries(s).filter(([v,x])=>x!==void 0).map(([v,x])=>[v,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([v,x])=>{f.searchParams.append(v,x)})):(h="POST",m=s);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new Ka({method:h,url:f,headers:y,schema:this.schemaName,body:m,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}};class I1{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const s=process.versions;if(s&&s.node){const l=s.node,o=parseInt(l.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const l=this.getWebSocketConstructor();return new l(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const B1="2.89.0",$1=`realtime-js/${B1}`,D0="1.0.0",P1="2.0.0",Bv=D0,Vf=1e4,q1=1e3,F1=100;var gi;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(gi||(gi={}));var Bn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Bn||(Bn={}));var Wr;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Wr||(Wr={}));var Kf;(function(n){n.websocket="websocket"})(Kf||(Kf={}));var Hi;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Hi||(Hi={}));class H1{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,s){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return s(this._binaryEncodeUserBroadcastPush(t));let l=[t.join_ref,t.ref,t.topic,t.event,t.payload];return s(JSON.stringify(l))}_binaryEncodeUserBroadcastPush(t){var s;return this._isArrayBuffer((s=t.payload)===null||s===void 0?void 0:s.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var s,l;const o=(l=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&l!==void 0?l:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var s,l;const o=(l=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&l!==void 0?l:{},d=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,s,l){var o,u;const d=t.topic,h=(o=t.ref)!==null&&o!==void 0?o:"",f=(u=t.join_ref)!==null&&u!==void 0?u:"",m=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(f.length>255)throw new Error(`joinRef length ${f.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`ref length ${h.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`userEvent length ${m.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+f.length+h.length+d.length+m.length+v.length,w=new ArrayBuffer(this.HEADER_LENGTH+x);let _=new DataView(w),N=0;_.setUint8(N++,this.KINDS.userBroadcastPush),_.setUint8(N++,f.length),_.setUint8(N++,h.length),_.setUint8(N++,d.length),_.setUint8(N++,m.length),_.setUint8(N++,v.length),_.setUint8(N++,s),Array.from(f,E=>_.setUint8(N++,E.charCodeAt(0))),Array.from(h,E=>_.setUint8(N++,E.charCodeAt(0))),Array.from(d,E=>_.setUint8(N++,E.charCodeAt(0))),Array.from(m,E=>_.setUint8(N++,E.charCodeAt(0))),Array.from(v,E=>_.setUint8(N++,E.charCodeAt(0)));var j=new Uint8Array(w.byteLength+l.byteLength);return j.set(new Uint8Array(w),0),j.set(new Uint8Array(l),w.byteLength),j.buffer}decode(t,s){if(this._isArrayBuffer(t)){let l=this._binaryDecode(t);return s(l)}if(typeof t=="string"){const l=JSON.parse(t),[o,u,d,h,f]=l;return s({join_ref:o,ref:u,topic:d,event:h,payload:f})}return s({})}_binaryDecode(t){const s=new DataView(t),l=s.getUint8(0),o=new TextDecoder;if(l===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,s,o)}_decodeUserBroadcast(t,s,l){const o=s.getUint8(1),u=s.getUint8(2),d=s.getUint8(3),h=s.getUint8(4);let f=this.HEADER_LENGTH+4;const m=l.decode(t.slice(f,f+o));f=f+o;const y=l.decode(t.slice(f,f+u));f=f+u;const v=l.decode(t.slice(f,f+d));f=f+d;const x=t.slice(f,t.byteLength),w=h===this.JSON_ENCODING?JSON.parse(l.decode(x)):x,_={type:this.BROADCAST_EVENT,event:y,payload:w};return d>0&&(_.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(t){var s;return t instanceof ArrayBuffer||((s=t?.constructor)===null||s===void 0?void 0:s.name)==="ArrayBuffer"}_pick(t,s){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([l])=>s.includes(l)))}}class M0{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var fn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(fn||(fn={}));const $v=(n,t,s={})=>{var l;const o=(l=s.skipTypes)!==null&&l!==void 0?l:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=G1(d,n,t,o),u),{}):{}},G1=(n,t,s,l)=>{const o=t.find(h=>h.name===n),u=o?.type,d=s[n];return u&&!l.includes(u)?z0(u,d):Yf(d)},z0=(n,t)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return Q1(t,s)}switch(n){case fn.bool:return V1(t);case fn.float4:case fn.float8:case fn.int2:case fn.int4:case fn.int8:case fn.numeric:case fn.oid:return K1(t);case fn.json:case fn.jsonb:return Y1(t);case fn.timestamp:return W1(t);case fn.abstime:case fn.date:case fn.daterange:case fn.int4range:case fn.int8range:case fn.money:case fn.reltime:case fn.text:case fn.time:case fn.timestamptz:case fn.timetz:case fn.tsrange:case fn.tstzrange:return Yf(t);default:return Yf(t)}},Yf=n=>n,V1=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},K1=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},Y1=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},Q1=(n,t)=>{if(typeof n!="string")return n;const s=n.length-1,l=n[s];if(n[0]==="{"&&l==="}"){let u;const d=n.slice(1,s);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(h=>z0(t,h))}return n},W1=n=>typeof n=="string"?n.replace(" ","T"):n,U0=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class of{constructor(t,s,l={},o=Vf){this.channel=t,this.event=s,this.payload=l,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var l;return this._hasReceived(t)&&s((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(l=>l.status===t).forEach(l=>l.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Pv;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Pv||(Pv={}));class xo{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},o=>{const{onJoin:u,onLeave:d,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xo.syncState(this.state,o,u,d),this.pendingDiffs.forEach(f=>{this.state=xo.syncDiff(this.state,f,u,d)}),this.pendingDiffs=[],h()}),this.channel._on(l.diff,{},o=>{const{onJoin:u,onLeave:d,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=xo.syncDiff(this.state,o,u,d),h())}),this.onJoin((o,u,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:u,newPresences:d})}),this.onLeave((o,u,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,l,o){const u=this.cloneDeep(t),d=this.transformState(s),h={},f={};return this.map(u,(m,y)=>{d[m]||(f[m]=y)}),this.map(d,(m,y)=>{const v=u[m];if(v){const x=y.map(j=>j.presence_ref),w=v.map(j=>j.presence_ref),_=y.filter(j=>w.indexOf(j.presence_ref)<0),N=v.filter(j=>x.indexOf(j.presence_ref)<0);_.length>0&&(h[m]=_),N.length>0&&(f[m]=N)}else h[m]=y}),this.syncDiff(u,{joins:h,leaves:f},l,o)}static syncDiff(t,s,l,o){const{joins:u,leaves:d}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return l||(l=()=>{}),o||(o=()=>{}),this.map(u,(h,f)=>{var m;const y=(m=t[h])!==null&&m!==void 0?m:[];if(t[h]=this.cloneDeep(f),y.length>0){const v=t[h].map(w=>w.presence_ref),x=y.filter(w=>v.indexOf(w.presence_ref)<0);t[h].unshift(...x)}l(h,y,f)}),this.map(d,(h,f)=>{let m=t[h];if(!m)return;const y=f.map(v=>v.presence_ref);m=m.filter(v=>y.indexOf(v.presence_ref)<0),t[h]=m,o(h,m,f),m.length===0&&delete t[h]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(l=>s(l,t[l]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,l)=>{const o=t[l];return"metas"in o?s[l]=o.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):s[l]=o,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var qv;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(qv||(qv={}));var bo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(bo||(bo={}));var Os;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Os||(Os={}));class Ja{constructor(t,s={config:{}},l){var o,u;if(this.topic=t,this.params=s,this.socket=l,this.bindings={},this.state=Bn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new of(this,Wr.join,this.params,this.timeout),this.rejoinTimer=new M0(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Bn.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Wr.reply,{},(d,h)=>{this._trigger(this._replyEventName(h),d)}),this.presence=new xo(this),this.broadcastEndpointURL=U0(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,s=this.timeout){var l,o,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Bn.closed){const{config:{broadcast:d,presence:h,private:f}}=this.params,m=(o=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(w=>w.filter))!==null&&o!==void 0?o:[],y=!!this.bindings[bo.PRESENCE]&&this.bindings[bo.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},h),{enabled:y}),postgres_changes:m,private:f};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(w=>t?.(Os.CHANNEL_ERROR,w)),this._onClose(()=>t?.(Os.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:w})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),w===void 0){t?.(Os.SUBSCRIBED);return}else{const N=this.bindings.postgres_changes,j=(_=N?.length)!==null&&_!==void 0?_:0,E=[];for(let O=0;O<j;O++){const D=N[O],{filter:{event:$,schema:z,table:C,filter:M}}=D,T=w&&w[O];if(T&&T.event===$&&Ja.isFilterValueEqual(T.schema,z)&&Ja.isFilterValueEqual(T.table,C)&&Ja.isFilterValueEqual(T.filter,M))E.push(Object.assign(Object.assign({},D),{id:T.id}));else{this.unsubscribe(),this.state=Bn.errored,t?.(Os.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=E,t&&t(Os.SUBSCRIBED);return}}).receive("error",w=>{this.state=Bn.errored,t?.(Os.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(w).join(", ")||"error")))}).receive("timeout",()=>{t?.(Os.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,l){return this.state===Bn.joined&&t===bo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,s,l)}async httpSend(t,s,l={}){var o;if(s==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:s,private:this.private}]})},h=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=l.timeout)!==null&&o!==void 0?o:this.timeout);if(h.status===202)return{success:!0};let f=h.statusText;try{const m=await h.json();f=m.error||m.message||f}catch{}return Promise.reject(new Error(f))}async send(t,s={}){var l,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,h={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(h.Authorization=`Bearer ${this.socket.accessTokenValue}`);const f={method:"POST",headers:h,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(l=s.timeout)!==null&&l!==void 0?l:this.timeout);return await((o=m.body)===null||o===void 0?void 0:o.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,h,f;const m=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((f=(h=(d=this.params)===null||d===void 0?void 0:d.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&u("ok"),m.receive("ok",()=>u("ok")),m.receive("error",()=>u("error")),m.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Bn.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Wr.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(o=>{l=new of(this,Wr.leave,{},t),l.receive("ok",()=>{s(),o("ok")}).receive("timeout",()=>{s(),o("timed out")}).receive("error",()=>{o("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Bn.closed,this.bindings={}}async _fetchWithTimeout(t,s,l){const o=new AbortController,u=setTimeout(()=>o.abort(),l),d=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:o.signal}));return clearTimeout(u),d}_push(t,s,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new of(this,t,s,l);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>F1){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,l){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,l){var o,u;const d=t.toLocaleLowerCase(),{close:h,error:f,leave:m,join:y}=Wr;if(l&&[h,f,m,y].indexOf(d)>=0&&l!==this._joinRef())return;let x=this._onMessage(d,s,l);if(s&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(w=>{var _,N,j;return((_=w.filter)===null||_===void 0?void 0:_.event)==="*"||((j=(N=w.filter)===null||N===void 0?void 0:N.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===d}).map(w=>w.callback(x,l)):(u=this.bindings[d])===null||u===void 0||u.filter(w=>{var _,N,j,E,O,D;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in w){const $=w.id,z=(_=w.filter)===null||_===void 0?void 0:_.event;return $&&((N=s.ids)===null||N===void 0?void 0:N.includes($))&&(z==="*"||z?.toLocaleLowerCase()===((j=s.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const $=(O=(E=w?.filter)===null||E===void 0?void 0:E.event)===null||O===void 0?void 0:O.toLocaleLowerCase();return $==="*"||$===((D=s?.event)===null||D===void 0?void 0:D.toLocaleLowerCase())}else return w.type.toLocaleLowerCase()===d}).map(w=>{if(typeof x=="object"&&"ids"in x){const _=x.data,{schema:N,table:j,commit_timestamp:E,type:O,errors:D}=_;x=Object.assign(Object.assign({},{schema:N,table:j,commit_timestamp:E,eventType:O,new:{},old:{},errors:D}),this._getPayloadRecords(_))}w.callback(x,l)})}_isClosed(){return this.state===Bn.closed}_isJoined(){return this.state===Bn.joined}_isJoining(){return this.state===Bn.joining}_isLeaving(){return this.state===Bn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,l){const o=t.toLocaleLowerCase(),u={type:o,filter:s,callback:l};return this.bindings[o]?this.bindings[o].push(u):this.bindings[o]=[u],this}_off(t,s){const l=t.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(o=>{var u;return!(((u=o.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===l&&Ja.isEqual(o.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(t[l]!==s[l])return!1;return!0}static isFilterValueEqual(t,s){return(t??void 0)===(s??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Wr.close,{},t)}_onError(t){this._on(Wr.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Bn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=$v(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=$v(t.columns,t.old_record)),s}}const cf=()=>{},iu={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},J1=[1e3,2e3,5e3,1e4],X1=1e4,Z1=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class eC{constructor(t,s){var l;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Vf,this.transport=null,this.heartbeatIntervalMs=iu.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=cf,this.ref=0,this.reconnectTimer=null,this.vsn=Bv,this.logger=cf,this.conn=null,this.sendBuffer=[],this.serializer=new H1,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...u)=>o(...u):(...u)=>fetch(...u),!(!((l=s?.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${Kf.websocket}`,this.httpEndpoint=U0(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=I1.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,s??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,l){this.logger(t,s,l)}connectionState(){switch(this.conn&&this.conn.readyState){case gi.connecting:return Hi.Connecting;case gi.open:return Hi.Open;case gi.closing:return Hi.Closing;default:return Hi.Closed}}isConnected(){return this.connectionState()===Hi.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const l=`realtime:${t}`,o=this.getChannels().find(u=>u.topic===l);if(o)return o;{const u=new Ja(`realtime:${t}`,s,this);return this.channels.push(u),u}}push(t){const{topic:s,event:l,payload:o,ref:u}=t,d=()=>{this.encode(t,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${s} ${l} (${u})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(q1,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},iu.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(l=>l.topic===t&&(l._isJoined()||l._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(m){this.log("error","error in heartbeat callback",m)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:l,event:o,payload:u,ref:d}=s,h=d?`(${d})`:"",f=u.status||"";this.log("receive",`${f} ${l} ${o} ${h}`.trim(),u),this.channels.filter(m=>m._isMember(l)).forEach(m=>m._trigger(o,u,d)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===gi.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===gi.open||this.conn.readyState===gi.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(s=>{this.log("error","error waiting for auth on connect",s),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this._terminateWorker()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Wr.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const l=t.match(/\?/)?"&":"?",o=new URLSearchParams(s);return`${t}${l}${o}`}_workerObjectUrl(t){let s;if(t)s=t;else{const l=new Blob([Z1],{type:"application/javascript"});s=URL.createObjectURL(l)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s,l=!1;if(t)s=t,l=!0;else if(this.accessToken)try{s=await this.accessToken()}catch(o){this.log("error","Error fetching access token from callback",o),s=this.accessTokenValue}else s=this.accessTokenValue;l?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(o=>{const u={access_token:s,version:$1};s&&o.updateJoinPayload(u),o.joinedOnce&&o._isJoined()&&o._push(Wr.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(s=>{this.log("error",`Error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(l=>{try{l(s)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(l){this.log("error",`error triggering ${t} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new M0(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},iu.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,l,o,u,d,h,f,m,y,v,x,w;switch(this.transport=(s=t?.transport)!==null&&s!==void 0?s:null,this.timeout=(l=t?.timeout)!==null&&l!==void 0?l:Vf,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:iu.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(h=t?.heartbeatCallback)!==null&&h!==void 0?h:cf,this.vsn=(f=t?.vsn)!==null&&f!==void 0?f:Bv,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=t?.reconnectAfterMs)!==null&&m!==void 0?m:(_=>J1[_-1]||X1),this.vsn){case D0:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((_,N)=>N(JSON.stringify(_))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((_,N)=>N(JSON.parse(_)));break;case P1:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(w=t?.decode)!==null&&w!==void 0?w:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var No=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function tC(n,t,s){const l=new URL(t,n);if(s)for(const[o,u]of Object.entries(s))u!==void 0&&l.searchParams.set(o,u);return l.toString()}async function nC(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function rC(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:s,path:l,query:o,body:u,headers:d}){const h=tC(n.baseUrl,l,o),f=await nC(n.auth),m=await t(h,{method:s,headers:{...u?{"Content-Type":"application/json"}:{},...f,...d},body:u?JSON.stringify(u):void 0}),y=await m.text(),v=(m.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!m.ok){const w=v?x:void 0,_=w?.error;throw new No(_?.message??`Request failed with status ${m.status}`,{status:m.status,icebergType:_?.type,icebergCode:_?.code,details:w})}return{status:m.status,headers:m.headers,data:x}}}}function au(n){return n.join("")}var sC=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:au(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(l=>({namespace:l}))}async createNamespace(n,t){const s={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${au(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${au(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${au(n.namespace)}`}),!0}catch(t){if(t instanceof No&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(s){if(s instanceof No&&s.status===409)return;throw s}}};function La(n){return n.join("")}var iC=class{constructor(n,t="",s){this.client=n,this.prefix=t,this.accessDelegation=s}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(n,t){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${La(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(s){if(s instanceof No&&s.status===404)return!1;throw s}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(s){if(s instanceof No&&s.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw s}}},aC=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const s=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=rC({baseUrl:s,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new sC(this.client,t),this.tableOps=new iC(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},Ku=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function wn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var lC=class extends Ku{constructor(n,t,s){super(n),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Qf=class extends Ku{constructor(n,t){super(n),this.name="StorageUnknownError",this.originalError=t}};const Sp=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),oC=()=>Response,Wf=n=>{if(Array.isArray(n))return n.map(s=>Wf(s));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([s,l])=>{const o=s.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[o]=Wf(l)}),t},cC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},uC=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Eo(n){"@babel/helpers - typeof";return Eo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eo(n)}function dC(n,t){if(Eo(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var l=s.call(n,t);if(Eo(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function hC(n){var t=dC(n,"string");return Eo(t)=="symbol"?t:t+""}function fC(n,t,s){return(t=hC(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function Fv(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),s.push.apply(s,l)}return s}function wt(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Fv(Object(s),!0).forEach(function(l){fC(n,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Fv(Object(s)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(s,l))})}return n}const uf=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},pC=async(n,t,s)=>{n instanceof await oC()&&!s?.noResolveJson?n.json().then(l=>{const o=n.status||500,u=l?.statusCode||o+"";t(new lC(uf(l),o,u))}).catch(l=>{t(new Qf(uf(l),l))}):t(new Qf(uf(n),n))},mC=(n,t,s,l)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"||!l?o:(cC(l)?(o.headers=wt({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(l)):o.body=l,t?.duplex&&(o.duplex=t.duplex),wt(wt({},o),s))};async function Go(n,t,s,l,o,u){return new Promise((d,h)=>{n(s,mC(t,l,o,u)).then(f=>{if(!f.ok)throw f;return l?.noResolveJson?f:f.json()}).then(f=>d(f)).catch(f=>pC(f,h,l))})}async function To(n,t,s,l){return Go(n,"GET",t,s,l)}async function Qr(n,t,s,l,o){return Go(n,"POST",t,l,o,s)}async function Jf(n,t,s,l,o){return Go(n,"PUT",t,l,o,s)}async function gC(n,t,s,l){return Go(n,"HEAD",t,wt(wt({},s),{},{noResolveJson:!0}),l)}async function jp(n,t,s,l,o){return Go(n,"DELETE",t,l,o,s)}var yC=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(wn(t))return{data:null,error:t};throw t}}};let L0;L0=Symbol.toStringTag;var vC=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[L0]="BlobDownloadBuilder",this.promise=null}asStream(){return new yC(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(wn(t))return{data:null,error:t};throw t}}};const xC={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Hv={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var bC=class{constructor(n,t={},s,l){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.bucketId=s,this.fetch=Sp(l)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,t,s,l){var o=this;try{let u;const d=wt(wt({},Hv),l);let h=wt(wt({},o.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const f=d.metadata;typeof Blob<"u"&&s instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),f&&u.append("metadata",o.encodeMetadata(f)),u.append("",s)):typeof FormData<"u"&&s instanceof FormData?(u=s,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),f&&!u.has("metadata")&&u.append("metadata",o.encodeMetadata(f))):(u=s,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType,f&&(h["x-metadata"]=o.toBase64(o.encodeMetadata(f))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),l?.headers&&(h=wt(wt({},h),l.headers));const m=o._removeEmptyFolders(t),y=o._getFinalPath(m),v=await(n=="PUT"?Jf:Qr)(o.fetch,`${o.url}/object/${y}`,u,wt({headers:h},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:m,id:v.Id,fullPath:v.Key},error:null}}catch(u){if(o.shouldThrowOnError)throw u;if(wn(u))return{data:null,error:u};throw u}}async upload(n,t,s){return this.uploadOrUpdate("POST",n,t,s)}async uploadToSignedUrl(n,t,s,l){var o=this;const u=o._removeEmptyFolders(n),d=o._getFinalPath(u),h=new URL(o.url+`/object/upload/sign/${d}`);h.searchParams.set("token",t);try{let f;const m=wt({upsert:Hv.upsert},l),y=wt(wt({},o.headers),{"x-upsert":String(m.upsert)});return typeof Blob<"u"&&s instanceof Blob?(f=new FormData,f.append("cacheControl",m.cacheControl),f.append("",s)):typeof FormData<"u"&&s instanceof FormData?(f=s,f.append("cacheControl",m.cacheControl)):(f=s,y["cache-control"]=`max-age=${m.cacheControl}`,y["content-type"]=m.contentType),{data:{path:u,fullPath:(await Jf(o.fetch,h.toString(),f,{headers:y})).Key},error:null}}catch(f){if(o.shouldThrowOnError)throw f;if(wn(f))return{data:null,error:f};throw f}}async createSignedUploadUrl(n,t){var s=this;try{let l=s._getFinalPath(n);const o=wt({},s.headers);t?.upsert&&(o["x-upsert"]="true");const u=await Qr(s.fetch,`${s.url}/object/upload/sign/${l}`,{},{headers:o}),d=new URL(s.url+u.url),h=d.searchParams.get("token");if(!h)throw new Ku("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:h},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(wn(l))return{data:null,error:l};throw l}}async update(n,t,s){return this.uploadOrUpdate("PUT",n,t,s)}async move(n,t,s){var l=this;try{return{data:await Qr(l.fetch,`${l.url}/object/move`,{bucketId:l.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:l.headers}),error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}async copy(n,t,s){var l=this;try{return{data:{path:(await Qr(l.fetch,`${l.url}/object/copy`,{bucketId:l.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:l.headers})).Key},error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}async createSignedUrl(n,t,s){var l=this;try{let o=l._getFinalPath(n),u=await Qr(l.fetch,`${l.url}/object/sign/${o}`,wt({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:l.headers});const d=s?.download?`&download=${s.download===!0?"":s.download}`:"";return u={signedUrl:encodeURI(`${l.url}${u.signedURL}${d}`)},{data:u,error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}async createSignedUrls(n,t,s){var l=this;try{const o=await Qr(l.fetch,`${l.url}/object/sign/${l.bucketId}`,{expiresIn:t,paths:n},{headers:l.headers}),u=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:o.map(d=>wt(wt({},d),{},{signedUrl:d.signedURL?encodeURI(`${l.url}${d.signedURL}${u}`):null})),error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}download(n,t){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),o=l?`?${l}`:"",u=this._getFinalPath(n),d=()=>To(this.fetch,`${this.url}/${s}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new vC(d,this.shouldThrowOnError)}async info(n){var t=this;const s=t._getFinalPath(n);try{return{data:Wf(await To(t.fetch,`${t.url}/object/info/${s}`,{headers:t.headers})),error:null}}catch(l){if(t.shouldThrowOnError)throw l;if(wn(l))return{data:null,error:l};throw l}}async exists(n){var t=this;const s=t._getFinalPath(n);try{return await gC(t.fetch,`${t.url}/object/${s}`,{headers:t.headers}),{data:!0,error:null}}catch(l){if(t.shouldThrowOnError)throw l;if(wn(l)&&l instanceof Qf){const o=l.originalError;if([400,404].includes(o?.status))return{data:!1,error:l}}throw l}}getPublicUrl(n,t){const s=this._getFinalPath(n),l=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&l.push(o);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&l.push(d);let h=l.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${s}${h}`)}}}async remove(n){var t=this;try{return{data:await jp(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async list(n,t,s){var l=this;try{const o=wt(wt(wt({},xC),t),{},{prefix:n||""});return{data:await Qr(l.fetch,`${l.url}/object/list/${l.bucketId}`,o,{headers:l.headers},s),error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(wn(o))return{data:null,error:o};throw o}}async listV2(n,t){var s=this;try{const l=wt({},n);return{data:await Qr(s.fetch,`${s.url}/object/list-v2/${s.bucketId}`,l,{headers:s.headers},t),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(wn(l))return{data:null,error:l};throw l}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const I0="2.89.0",B0={"X-Client-Info":`storage-js/${I0}`};var wC=class{constructor(n,t={},s,l){this.shouldThrowOnError=!1;const o=new URL(n);l?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=wt(wt({},B0),t),this.fetch=Sp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var t=this;try{const s=t.listBucketOptionsToQueryString(n);return{data:await To(t.fetch,`${t.url}/bucket${s}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await To(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async createBucket(n,t={public:!1}){var s=this;try{return{data:await Qr(s.fetch,`${s.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(wn(l))return{data:null,error:l};throw l}}async updateBucket(n,t){var s=this;try{return{data:await Jf(s.fetch,`${s.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(wn(l))return{data:null,error:l};throw l}}async emptyBucket(n){var t=this;try{return{data:await Qr(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await jp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},SC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=wt(wt({},B0),t),this.fetch=Sp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Qr(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async listBuckets(n){var t=this;try{const s=new URLSearchParams;n?.limit!==void 0&&s.set("limit",n.limit.toString()),n?.offset!==void 0&&s.set("offset",n.offset.toString()),n?.sortColumn&&s.set("sortColumn",n.sortColumn),n?.sortOrder&&s.set("sortOrder",n.sortOrder),n?.search&&s.set("search",n.search);const l=s.toString(),o=l?`${t.url}/bucket?${l}`:`${t.url}/bucket`;return{data:await To(t.fetch,o,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await jp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(wn(s))return{data:null,error:s};throw s}}from(n){var t=this;if(!uC(n))throw new Ku("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const s=new aC({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),l=this.shouldThrowOnError;return new Proxy(s,{get(o,u){const d=o[u];return typeof d!="function"?d:async(...h)=>{try{return{data:await d.apply(o,h),error:null}}catch(f){if(l)throw f;return{data:null,error:f}}}}})}};const _p={"X-Client-Info":`storage-js/${I0}`,"Content-Type":"application/json"};var $0=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Nr(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var df=class extends $0{constructor(n,t,s){super(n),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},jC=class extends $0{constructor(n,t){super(n),this.name="StorageVectorsUnknownError",this.originalError=t}};const Cp=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),_C=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Gv=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),CC=async(n,t,s)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!s?.noResolveJson){const l=n.status||500,o=n;if(typeof o.json=="function")o.json().then(u=>{const d=u?.statusCode||u?.code||l+"";t(new df(Gv(u),l,d))}).catch(()=>{const u=l+"";t(new df(o.statusText||`HTTP ${l} error`,l,u))});else{const u=l+"";t(new df(o.statusText||`HTTP ${l} error`,l,u))}}else t(new jC(Gv(n),n))},NC=(n,t,s,l)=>{const o={method:n,headers:t?.headers||{}};return l?(_C(l)?(o.headers=wt({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(l)):o.body=l,wt(wt({},o),s)):o};async function EC(n,t,s,l,o,u){return new Promise((d,h)=>{n(s,NC(t,l,o,u)).then(f=>{if(!f.ok)throw f;if(l?.noResolveJson)return f;const m=f.headers.get("content-type");return!m||!m.includes("application/json")?{}:f.json()}).then(f=>d(f)).catch(f=>CC(f,h,l))})}async function Er(n,t,s,l,o){return EC(n,"POST",t,l,o,s)}var TC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=wt(wt({},_p),t),this.fetch=Cp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async getIndex(n,t){var s=this;try{return{data:await Er(s.fetch,`${s.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Nr(l))return{data:null,error:l};throw l}}async listIndexes(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async deleteIndex(n,t){var s=this;try{return{data:await Er(s.fetch,`${s.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers})||{},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Nr(l))return{data:null,error:l};throw l}}},kC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=wt(wt({},_p),t),this.fetch=Cp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var t=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Er(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async getVectors(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async listVectors(n){var t=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await Er(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async queryVectors(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async deleteVectors(n){var t=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Er(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}},RC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=wt(wt({},_p),t),this.fetch=Cp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async listBuckets(n={}){var t=this;try{return{data:await Er(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}},AC=class extends RC{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new OC(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,s=this;return t().call(s,n)}async getBucket(n){var t=()=>super.getBucket,s=this;return t().call(s,n)}async listBuckets(n={}){var t=()=>super.listBuckets,s=this;return t().call(s,n)}async deleteBucket(n){var t=()=>super.deleteBucket,s=this;return t().call(s,n)}},OC=class extends TC{constructor(n,t,s,l){super(n,t,l),this.vectorBucketName=s}async createIndex(n){var t=()=>super.createIndex,s=this;return t().call(s,wt(wt({},n),{},{vectorBucketName:s.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,s=this;return t().call(s,wt(wt({},n),{},{vectorBucketName:s.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,s=this;return t().call(s,s.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,s=this;return t().call(s,s.vectorBucketName,n)}index(n){return new DC(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},DC=class extends kC{constructor(n,t,s,l,o){super(n,t,o),this.vectorBucketName=s,this.indexName=l}async putVectors(n){var t=()=>super.putVectors,s=this;return t().call(s,wt(wt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async getVectors(n){var t=()=>super.getVectors,s=this;return t().call(s,wt(wt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,s=this;return t().call(s,wt(wt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,s=this;return t().call(s,wt(wt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,s=this;return t().call(s,wt(wt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}},MC=class extends wC{constructor(n,t={},s,l){super(n,t,s,l)}from(n){return new bC(this.url,this.headers,n,this.fetch)}get vectors(){return new AC(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new SC(this.url+"/iceberg",this.headers,this.fetch)}};const P0="2.89.0",Ya=30*1e3,Xf=3,hf=Xf*Ya,zC="http://localhost:9999",UC="supabase.auth.token",LC={"X-Client-Info":`gotrue-js/${P0}`},Zf="X-Supabase-Api-Version",q0={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},IC=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,BC=600*1e3;class ko extends Error{constructor(t,s,l){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=l}}function ct(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class $C extends ko{constructor(t,s,l){super(t,s,l),this.name="AuthApiError",this.status=s,this.code=l}}function PC(n){return ct(n)&&n.name==="AuthApiError"}class Gi extends ko{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class Bs extends ko{constructor(t,s,l,o){super(t,l,o),this.name=s,this.status=l}}class Cr extends Bs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function qC(n){return ct(n)&&n.name==="AuthSessionMissingError"}class Ia extends Bs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class lu extends Bs{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class ou extends Bs{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function FC(n){return ct(n)&&n.name==="AuthImplicitGrantRedirectError"}class Vv extends Bs{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class HC extends Bs{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class ep extends Bs{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function ff(n){return ct(n)&&n.name==="AuthRetryableFetchError"}class Kv extends Bs{constructor(t,s,l){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=l}}class tp extends Bs{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ru="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Yv=` 	
\r=`.split(""),GC=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<Yv.length;t+=1)n[Yv[t].charCodeAt(0)]=-2;for(let t=0;t<Ru.length;t+=1)n[Ru[t].charCodeAt(0)]=t;return n})();function Qv(n,t,s){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;s(Ru[l]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;s(Ru[l]),t.queuedBits-=6}}function F0(n,t,s){const l=GC[n];if(l>-1)for(t.queue=t.queue<<6|l,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Wv(n){const t=[],s=d=>{t.push(String.fromCodePoint(d))},l={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},u=d=>{YC(d,l,s)};for(let d=0;d<n.length;d+=1)F0(n.charCodeAt(d),o,u);return t.join("")}function VC(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function KC(n,t){for(let s=0;s<n.length;s+=1){let l=n.charCodeAt(s);if(l>55295&&l<=56319){const o=(l-55296)*1024&65535;l=(n.charCodeAt(s+1)-56320&65535|o)+65536,s+=1}VC(l,t)}}function YC(n,t,s){if(t.utf8seq===0){if(n<=127){s(n);return}for(let l=1;l<6;l+=1)if((n>>7-l&1)===0){t.utf8seq=l;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function el(n){const t=[],s={queue:0,queuedBits:0},l=o=>{t.push(o)};for(let o=0;o<n.length;o+=1)F0(n.charCodeAt(o),s,l);return new Uint8Array(t)}function QC(n){const t=[];return KC(n,s=>t.push(s)),new Uint8Array(t)}function Yi(n){const t=[],s={queue:0,queuedBits:0},l=o=>{t.push(o)};return n.forEach(o=>Qv(o,s,l)),Qv(null,s,l),t.join("")}function WC(n){return Math.round(Date.now()/1e3)+n}function JC(){return Symbol("auth-callback")}const tr=()=>typeof window<"u"&&typeof document<"u",Li={tested:!1,writable:!1},H0=()=>{if(!tr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Li.tested)return Li.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Li.tested=!0,Li.writable=!0}catch{Li.tested=!0,Li.writable=!1}return Li.writable};function XC(n){const t={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((o,u)=>{t[u]=o})}catch{}return s.searchParams.forEach((l,o)=>{t[o]=l}),t}const G0=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),ZC=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Qa=async(n,t,s)=>{await n.setItem(t,JSON.stringify(s))},Ii=async(n,t)=>{const s=await n.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Zn=async(n,t)=>{await n.removeItem(t)};class Yu{constructor(){this.promise=new Yu.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}Yu.promiseConstructor=Promise;function pf(n){const t=n.split(".");if(t.length!==3)throw new tp("Invalid JWT structure");for(let l=0;l<t.length;l++)if(!IC.test(t[l]))throw new tp("JWT not in base64url format");return{header:JSON.parse(Wv(t[0])),payload:JSON.parse(Wv(t[1])),signature:el(t[2]),raw:{header:t[0],payload:t[1]}}}async function eN(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function tN(n,t){return new Promise((l,o)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){l(d);return}}catch(d){if(!t(u,d)){o(d);return}}})()})}function nN(n){return("0"+n.toString(16)).substr(-2)}function rN(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=s.length;let o="";for(let u=0;u<56;u++)o+=s.charAt(Math.floor(Math.random()*l));return o}return crypto.getRandomValues(t),Array.from(t,nN).join("")}async function sN(n){const s=new TextEncoder().encode(n),l=await crypto.subtle.digest("SHA-256",s),o=new Uint8Array(l);return Array.from(o).map(u=>String.fromCharCode(u)).join("")}async function iN(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await sN(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ba(n,t,s=!1){const l=rN();let o=l;s&&(o+="/PASSWORD_RECOVERY"),await Qa(n,`${t}-code-verifier`,o);const u=await iN(l);return[u,l===u?"plain":"s256"]}const aN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function lN(n){const t=n.headers.get(Zf);if(!t||!t.match(aN))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function oN(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function cN(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const uN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function $a(n){if(!uN.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function mf(){const n={};return new Proxy(n,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const l=s.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function dN(n,t){return new Proxy(n,{get:(s,l,o)=>{if(l==="__isInsecureUserWarningProxy")return!0;if(typeof l=="symbol"){const u=l.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(s,l,o)}return!t.value&&typeof l=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(s,l,o)}})}function Jv(n){return JSON.parse(JSON.stringify(n))}const Fi=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),hN=[502,503,504];async function Xv(n){var t;if(!ZC(n))throw new ep(Fi(n),0);if(hN.includes(n.status))throw new ep(Fi(n),n.status);let s;try{s=await n.json()}catch(u){throw new Gi(Fi(u),u)}let l;const o=lN(n);if(o&&o.getTime()>=q0["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?l=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(l=s.error_code),l){if(l==="weak_password")throw new Kv(Fi(s),n.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(l==="session_not_found")throw new Cr}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new Kv(Fi(s),n.status,s.weak_password.reasons);throw new $C(Fi(s),n.status||500,l)}const fN=(n,t,s,l)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(l),Object.assign(Object.assign({},o),s))};async function bt(n,t,s,l){var o;const u=Object.assign({},l?.headers);u[Zf]||(u[Zf]=q0["2024-01-01"].name),l?.jwt&&(u.Authorization=`Bearer ${l.jwt}`);const d=(o=l?.query)!==null&&o!==void 0?o:{};l?.redirectTo&&(d.redirect_to=l.redirectTo);const h=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",f=await pN(n,t,s+h,{headers:u,noResolveJson:l?.noResolveJson},{},l?.body);return l?.xform?l?.xform(f):{data:Object.assign({},f),error:null}}async function pN(n,t,s,l,o,u){const d=fN(t,l,o,u);let h;try{h=await n(s,Object.assign({},d))}catch(f){throw console.error(f),new ep(Fi(f),0)}if(h.ok||await Xv(h),l?.noResolveJson)return h;try{return await h.json()}catch(f){await Xv(f)}}function Kr(n){var t;let s=null;yN(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=WC(n.expires_in)));const l=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:s,user:l},error:null}}function Zv(n){const t=Kr(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,l)=>s&&typeof l=="string",!0)&&(t.data.weak_password=n.weak_password),t}function yi(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function mN(n){return{data:n,error:null}}function gN(n){const{action_link:t,email_otp:s,hashed_token:l,redirect_to:o,verification_type:u}=n,d=Vu(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:t,email_otp:s,hashed_token:l,redirect_to:o,verification_type:u},f=Object.assign({},d);return{data:{properties:h,user:f},error:null}}function ex(n){return n}function yN(n){return n.access_token&&n.refresh_token&&n.expires_in}const gf=["global","local","others"];class vN{constructor({url:t="",headers:s={},fetch:l}){this.url=t,this.headers=s,this.fetch=G0(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,s=gf[0]){if(gf.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${gf.join(", ")}`);try{return await bt(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(l){if(ct(l))return{data:null,error:l};throw l}}async inviteUserByEmail(t,s={}){try{return await bt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:yi})}catch(l){if(ct(l))return{data:{user:null},error:l};throw l}}async generateLink(t){try{const{options:s}=t,l=Vu(t,["options"]),o=Object.assign(Object.assign({},l),s);return"newEmail"in l&&(o.new_email=l?.newEmail,delete o.newEmail),await bt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:gN,redirectTo:s?.redirectTo})}catch(s){if(ct(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await bt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:yi})}catch(s){if(ct(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,l,o,u,d,h,f;try{const m={nextPage:null,lastPage:0,total:0},y=await bt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:ex});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,w=(f=(h=y.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return w.length>0&&(w.forEach(_=>{const N=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(_.split(";")[1].split("=")[1]);m[`${j}Page`]=N}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(ct(m))return{data:{users:[]},error:m};throw m}}async getUserById(t){$a(t);try{return await bt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:yi})}catch(s){if(ct(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){$a(t);try{return await bt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:yi})}catch(l){if(ct(l))return{data:{user:null},error:l};throw l}}async deleteUser(t,s=!1){$a(t);try{return await bt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:yi})}catch(l){if(ct(l))return{data:{user:null},error:l};throw l}}async _listFactors(t){$a(t.userId);try{const{data:s,error:l}=await bt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:s,error:l}}catch(s){if(ct(s))return{data:null,error:s};throw s}}async _deleteFactor(t){$a(t.userId),$a(t.id);try{return{data:await bt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(ct(s))return{data:null,error:s};throw s}}async _listOAuthClients(t){var s,l,o,u,d,h,f;try{const m={nextPage:null,lastPage:0,total:0},y=await bt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:ex});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,w=(f=(h=y.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return w.length>0&&(w.forEach(_=>{const N=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(_.split(";")[1].split("=")[1]);m[`${j}Page`]=N}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(ct(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(t){try{return await bt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(ct(s))return{data:null,error:s};throw s}}async _getOAuthClient(t){try{return await bt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(ct(s))return{data:null,error:s};throw s}}async _updateOAuthClient(t,s){try{return await bt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:s,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(ct(l))return{data:null,error:l};throw l}}async _deleteOAuthClient(t){try{return await bt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(s){if(ct(s))return{data:null,error:s};throw s}}async _regenerateOAuthClientSecret(t){try{return await bt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(ct(s))return{data:null,error:s};throw s}}}function tx(n={}){return{getItem:t=>n[t]||null,setItem:(t,s)=>{n[t]=s},removeItem:t=>{delete n[t]}}}const Pa={debug:!!(globalThis&&H0()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class V0 extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class xN extends V0{}async function bN(n,t,s){Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const l=new globalThis.AbortController;return t>0&&setTimeout(()=>{l.abort(),Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async o=>{if(o){Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await s()}finally{Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(t===0)throw Pa.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new xN(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Pa.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}function wN(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function K0(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function SN(n){return parseInt(n,16)}function jN(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,l=>l.toString(16).padStart(2,"0")).join("")}function _N(n){var t;const{chainId:s,domain:l,expirationTime:o,issuedAt:u=new Date,nonce:d,notBefore:h,requestId:f,resources:m,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const w=K0(n.address),_=y?`${y}://${l}`:l,N=n.statement?`${n.statement}
`:"",j=`${_} wants you to sign in with your Ethereum account:
${w}

${N}`;let E=`URI: ${v}
Version: ${x}
Chain ID: ${s}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(o&&(E+=`
Expiration Time: ${o.toISOString()}`),h&&(E+=`
Not Before: ${h.toISOString()}`),f&&(E+=`
Request ID: ${f}`),m){let O=`
Resources:`;for(const D of m){if(!D||typeof D!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${D}`);O+=`
- ${D}`}E+=O}return`${j}
${E}`}class Un extends Error{constructor({message:t,code:s,cause:l,name:o}){var u;super(t,{cause:l}),this.__isWebAuthnError=!0,this.name=(u=o??(l instanceof Error?l.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=s}}class Au extends Un{constructor(t,s){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s,message:t}),this.name="WebAuthnUnknownError",this.originalError=s}}function CN({error:n,options:t}){var s,l,o;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Un({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((s=u.authenticatorSelection)===null||s===void 0?void 0:s.requireResidentKey)===!0)return new Un({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((l=u.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new Un({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((o=u.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Un({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Un({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Un({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(h=>h.type==="public-key").length===0?new Un({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Un({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(Y0(d)){if(u.rp.id!==d)return new Un({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Un({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Un({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Un({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Un({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function NN({error:n,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Un({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Un({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const l=window.location.hostname;if(Y0(l)){if(s.rpId!==l)return new Un({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Un({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Un({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Un({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class EN{createNewAbortSignal(){if(this.controller){const s=new Error("Cancelling existing WebAuthn API call for new one");s.name="AbortError",this.controller.abort(s)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const TN=new EN;function kN(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:s,excludeCredentials:l}=n,o=Vu(n,["challenge","user","excludeCredentials"]),u=el(t).buffer,d=Object.assign(Object.assign({},s),{id:el(s.id).buffer}),h=Object.assign(Object.assign({},o),{challenge:u,user:d});if(l&&l.length>0){h.excludeCredentials=new Array(l.length);for(let f=0;f<l.length;f++){const m=l[f];h.excludeCredentials[f]=Object.assign(Object.assign({},m),{id:el(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return h}function RN(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:s}=n,l=Vu(n,["challenge","allowCredentials"]),o=el(t).buffer,u=Object.assign(Object.assign({},l),{challenge:o});if(s&&s.length>0){u.allowCredentials=new Array(s.length);for(let d=0;d<s.length;d++){const h=s[d];u.allowCredentials[d]=Object.assign(Object.assign({},h),{id:el(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return u}function AN(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n;return{id:n.id,rawId:n.id,response:{attestationObject:Yi(new Uint8Array(n.response.attestationObject)),clientDataJSON:Yi(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function ON(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n,l=n.getClientExtensionResults(),o=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:Yi(new Uint8Array(o.authenticatorData)),clientDataJSON:Yi(new Uint8Array(o.clientDataJSON)),signature:Yi(new Uint8Array(o.signature)),userHandle:o.userHandle?Yi(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Y0(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function nx(){var n,t;return!!(tr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function DN(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Au("Browser returned unexpected credential type",t)}:{data:null,error:new Au("Empty credential response",t)}}catch(t){return{data:null,error:CN({error:t,options:n})}}}async function MN(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Au("Browser returned unexpected credential type",t)}:{data:null,error:new Au("Empty credential response",t)}}catch(t){return{data:null,error:NN({error:t,options:n})}}}const zN={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},UN={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ou(...n){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),s=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),l={};for(const o of n)if(o)for(const u in o){const d=o[u];if(d!==void 0)if(Array.isArray(d))l[u]=d;else if(s(d))l[u]=d;else if(t(d)){const h=l[u];t(h)?l[u]=Ou(h,d):l[u]=Ou(d)}else l[u]=d}return l}function LN(n,t){return Ou(zN,n,t||{})}function IN(n,t){return Ou(UN,n,t||{})}class BN{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:s,friendlyName:l,signal:o},u){try{const{data:d,error:h}=await this.client.mfa.challenge({factorId:t,webauthn:s});if(!d)return{data:null,error:h};const f=o??TN.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:m}=d.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${l}`),m.displayName||(m.displayName=m.name)}switch(d.webauthn.type){case"create":{const m=LN(d.webauthn.credential_options.publicKey,u?.create),{data:y,error:v}=await DN({publicKey:m,signal:f});return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}case"request":{const m=IN(d.webauthn.credential_options.publicKey,u?.request),{data:y,error:v}=await MN(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:m,signal:f}));return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}}}catch(d){return ct(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:s,webauthn:l}){return this.client.mfa.verify({factorId:s,challengeId:t,webauthn:l})}async _authenticate({factorId:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!s)return{data:null,error:new ko("rpId is required for WebAuthn authentication")};try{if(!nx())return{data:null,error:new Gi("Browser does not support WebAuthn",null)};const{data:d,error:h}=await this.challenge({factorId:t,webauthn:{rpId:s,rpOrigins:l},signal:o},{request:u});if(!d)return{data:null,error:h};const{webauthn:f}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:f.type,rpId:s,rpOrigins:l,credential_response:f.credential_response}})}catch(d){return ct(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!s)return{data:null,error:new ko("rpId is required for WebAuthn registration")};try{if(!nx())return{data:null,error:new Gi("Browser does not support WebAuthn",null)};const{data:d,error:h}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:h};const{data:f,error:m}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:s,rpOrigins:l},signal:o},{create:u});return f?this._verify({factorId:d.id,challengeId:f.challengeId,webauthn:{rpId:s,rpOrigins:l,type:f.webauthn.type,credential_response:f.webauthn.credential_response}}):{data:null,error:m}}catch(d){return ct(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in register",d)}}}}wN();const $N={url:zC,storageKey:UC,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:LC,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function rx(n,t,s){return await s()}const qa={};class Ro{get jwks(){var t,s;return(s=(t=qa[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){qa[this.storageKey]=Object.assign(Object.assign({},qa[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=qa[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){qa[this.storageKey]=Object.assign(Object.assign({},qa[this.storageKey]),{cachedAt:t})}constructor(t){var s,l,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},$N),t);if(this.storageKey=u.storageKey,this.instanceID=(s=Ro.nextInstanceID[this.storageKey])!==null&&s!==void 0?s:0,Ro.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&tr()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new vN({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=G0(u.fetch),this.lock=u.lock||rx,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:this.persistSession&&tr()&&(!((l=globalThis?.navigator)===null||l===void 0)&&l.locks)?this.lock=bN:this.lock=rx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new BN(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:H0()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=tx(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=tx(this.memoryStorage)),tr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${P0}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let s={},l="none";if(tr()&&(s=XC(window.location.href),this._isImplicitGrantCallback(s)?l="implicit":await this._isPKCECallback(s)&&(l="pkce")),tr()&&this.detectSessionInUrl&&l!=="none"){const{data:o,error:u}=await this._getSessionFromURL(s,l);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),FC(u)){const f=(t=u.details)===null||t===void 0?void 0:t.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:d,redirectType:h}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",h),await this._saveSession(d),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return ct(s)?this._returnResult({error:s}):this._returnResult({error:new Gi("Unexpected error during initialization",s)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,l,o;try{const u=await bt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Kr}),{data:d,error:h}=u;if(h||!d)return this._returnResult({data:{user:null,session:null},error:h});const f=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(u){if(ct(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var s,l,o;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let w=null,_=null;this.flowType==="pkce"&&([w,_]=await Ba(this.storage,this.storageKey)),u=await bt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(s=x?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:w,code_challenge_method:_},xform:Kr})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await bt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(l=x?.data)!==null&&l!==void 0?l:{},channel:(o=x?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:Kr})}else throw new lu("You must provide either an email or phone number and a password");const{data:d,error:h}=u;if(h||!d)return await Zn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:h});const f=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ct(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let s;if("email"in t){const{email:u,password:d,options:h}=t;s=await bt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Zv})}else if("phone"in t){const{phone:u,password:d,options:h}=t;s=await bt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Zv})}else throw new lu("You must provide either an email or phone number and a password");const{data:l,error:o}=s;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!l||!l.session||!l.user){const u=new Ia;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:o})}catch(s){if(ct(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOAuth(t){var s,l,o,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;switch(s){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(t){var s,l,o,u,d,h,f,m,y,v,x;let w,_;if("message"in t)w=t.message,_=t.signature;else{const{chain:N,wallet:j,statement:E,options:O}=t;let D;if(tr())if(typeof j=="object")D=j;else{const F=window;if("ethereum"in F&&typeof F.ethereum=="object"&&"request"in F.ethereum&&typeof F.ethereum.request=="function")D=F.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!O?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");D=j}const $=new URL((s=O?.url)!==null&&s!==void 0?s:window.location.href),z=await D.request({method:"eth_requestAccounts"}).then(F=>F).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!z||z.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=K0(z[0]);let M=(l=O?.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!M){const F=await D.request({method:"eth_chainId"});M=SN(F)}const T={domain:$.host,address:C,statement:E,uri:$.href,version:"1",chainId:M,nonce:(o=O?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(u=O?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(h=O?.signInWithEthereum)===null||h===void 0?void 0:h.expirationTime,notBefore:(f=O?.signInWithEthereum)===null||f===void 0?void 0:f.notBefore,requestId:(m=O?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(y=O?.signInWithEthereum)===null||y===void 0?void 0:y.resources};w=_N(T),_=await D.request({method:"personal_sign",params:[jN(w),C]})}try{const{data:N,error:j}=await bt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:w,signature:_},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Kr});if(j)throw j;if(!N||!N.session||!N.user){const E=new Ia;return this._returnResult({data:{user:null,session:null},error:E})}return N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),this._returnResult({data:Object.assign({},N),error:j})}catch(N){if(ct(N))return this._returnResult({data:{user:null,session:null},error:N});throw N}}async signInWithSolana(t){var s,l,o,u,d,h,f,m,y,v,x,w;let _,N;if("message"in t)_=t.message,N=t.signature;else{const{chain:j,wallet:E,statement:O,options:D}=t;let $;if(tr())if(typeof E=="object")$=E;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))$=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof E!="object"||!D?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$=E}const z=new URL((s=D?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in $&&$.signIn){const C=await $.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},D?.signInWithSolana),{version:"1",domain:z.host,uri:z.href}),O?{statement:O}:null));let M;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")M=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)M=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)_=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),N=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in $)||typeof $.signMessage!="function"||!("publicKey"in $)||typeof $!="object"||!$.publicKey||!("toBase58"in $.publicKey)||typeof $.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${z.host} wants you to sign in with your Solana account:`,$.publicKey.toBase58(),...O?["",O,""]:[""],"Version: 1",`URI: ${z.href}`,`Issued At: ${(o=(l=D?.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((u=D?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${D.signInWithSolana.notBefore}`]:[],...!((d=D?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${D.signInWithSolana.expirationTime}`]:[],...!((h=D?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${D.signInWithSolana.chainId}`]:[],...!((f=D?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${D.signInWithSolana.nonce}`]:[],...!((m=D?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${D.signInWithSolana.requestId}`]:[],...!((v=(y=D?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...D.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const C=await $.signMessage(new TextEncoder().encode(_),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=C}}try{const{data:j,error:E}=await bt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:Yi(N)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(w=t.options)===null||w===void 0?void 0:w.captchaToken}}:null),xform:Kr});if(E)throw E;if(!j||!j.session||!j.user){const O=new Ia;return this._returnResult({data:{user:null,session:null},error:O})}return j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),this._returnResult({data:Object.assign({},j),error:E})}catch(j){if(ct(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async _exchangeCodeForSession(t){const s=await Ii(this.storage,`${this.storageKey}-code-verifier`),[l,o]=(s??"").split("/");try{if(!l&&this.flowType==="pkce")throw new HC;const{data:u,error:d}=await bt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:l},xform:Kr});if(await Zn(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const h=new Ia;return this._returnResult({data:{user:null,session:null,redirectType:null},error:h})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:o??null}),error:d})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ct(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:s,provider:l,token:o,access_token:u,nonce:d}=t,h=await bt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:o,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Kr}),{data:f,error:m}=h;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!f||!f.session||!f.user){const y=new Ia;return this._returnResult({data:{user:null,session:null},error:y})}return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),this._returnResult({data:f,error:m})}catch(s){if(ct(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOtp(t){var s,l,o,u,d;try{if("email"in t){const{email:h,options:f}=t;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await Ba(this.storage,this.storageKey));const{error:v}=await bt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(l=f?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:y},redirectTo:f?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:h,options:f}=t,{data:m,error:y}=await bt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(o=f?.data)!==null&&o!==void 0?o:{},create_user:(u=f?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(d=f?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:y})}throw new lu("You must provide either an email or phone number.")}catch(h){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ct(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async verifyOtp(t){var s,l;try{let o,u;"options"in t&&(o=(s=t.options)===null||s===void 0?void 0:s.redirectTo,u=(l=t.options)===null||l===void 0?void 0:l.captchaToken);const{data:d,error:h}=await bt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:o,xform:Kr});if(h)throw h;if(!d)throw new Error("An error occurred on token verification.");const f=d.session,m=d.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),this._returnResult({data:{user:m,session:f},error:null})}catch(o){if(ct(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var s,l,o,u,d;try{let h=null,f=null;this.flowType==="pkce"&&([h,f]=await Ba(this.storage,this.storageKey));const m=await bt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(l=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&l!==void 0?l:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:f}),headers:this.headers,xform:mN});return!((u=m.data)===null||u===void 0)&&u.url&&tr()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(h){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ct(h))return this._returnResult({data:null,error:h});throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:l}=t;if(l)throw l;if(!s)throw new Cr;const{error:o}=await bt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(ct(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:l,type:o,options:u}=t,{error:d}=await bt(this.fetch,"POST",s,{headers:this.headers,body:{email:l,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:l,type:o,options:u}=t,{data:d,error:h}=await bt(this.fetch,"POST",s,{headers:this.headers,body:{phone:l,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:h})}throw new lu("You must provide either an email or phone number and a type")}catch(s){if(ct(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await l,await s()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=s();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Ii(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const l=t.expires_at?t.expires_at*1e3-Date.now()<hf:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",t.expires_at),!l){if(this.userStorage){const d=await Ii(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=mf()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=dN(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const s=await this._acquireLock(-1,async()=>await this._getUser());return s.data.user&&(this.suppressGetSessionWarning=!0),s}async _getUser(t){try{return t?await bt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:yi}):await this._useSession(async s=>{var l,o,u;const{data:d,error:h}=s;if(h)throw h;return!(!((l=d.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Cr}:await bt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:void 0,xform:yi})})}catch(s){if(ct(s))return qC(s)&&(await this._removeSession(),await Zn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:s});throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async l=>{const{data:o,error:u}=l;if(u)throw u;if(!o.session)throw new Cr;const d=o.session;let h=null,f=null;this.flowType==="pkce"&&t.email!=null&&([h,f]=await Ba(this.storage,this.storageKey));const{data:m,error:y}=await bt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:h,code_challenge_method:f}),jwt:d.access_token,xform:yi});if(y)throw y;return d.user=m.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(l){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ct(l))return this._returnResult({data:{user:null},error:l});throw l}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Cr;const s=Date.now()/1e3;let l=s,o=!0,u=null;const{payload:d}=pf(t.access_token);if(d.exp&&(l=d.exp,o=l<=s),o){const{data:h,error:f}=await this._callRefreshToken(t.refresh_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!h)return{data:{user:null,session:null},error:null};u=h}else{const{data:h,error:f}=await this._getUser(t.access_token);if(f)throw f;u={access_token:t.access_token,refresh_token:t.refresh_token,user:h.user,token_type:"bearer",expires_in:l-s,expires_at:l},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(s){if(ct(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var l;if(!t){const{data:d,error:h}=s;if(h)throw h;t=(l=d.session)!==null&&l!==void 0?l:void 0}if(!t?.refresh_token)throw new Cr;const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(s){if(ct(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async _getSessionFromURL(t,s){try{if(!tr())throw new ou("No browser detected.");if(t.error||t.error_description||t.error_code)throw new ou(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new Vv("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ou("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Vv("No code detected.");const{data:O,error:D}=await this._exchangeCodeForSession(t.code);if(D)throw D;const $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:O.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:o,access_token:u,refresh_token:d,expires_in:h,expires_at:f,token_type:m}=t;if(!u||!h||!d||!m)throw new ou("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(h);let x=y+v;f&&(x=parseInt(f));const w=x-y;w*1e3<=Ya&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${w}s, should have been closer to ${v}s`);const _=x-v;y-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,x,y):y-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,x,y);const{data:N,error:j}=await this._getUser(u);if(j)throw j;const E={provider_token:l,provider_refresh_token:o,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:m,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:E,redirectType:t.type},error:null})}catch(l){if(ct(l))return this._returnResult({data:{session:null,redirectType:null},error:l});throw l}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Ii(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var l;const{data:o,error:u}=s;if(u)return this._returnResult({error:u});const d=(l=o.session)===null||l===void 0?void 0:l.access_token;if(d){const{error:h}=await this.admin.signOut(d,t);if(h&&!(PC(h)&&(h.status===404||h.status===401||h.status===403)))return this._returnResult({error:h})}return t!=="others"&&(await this._removeSession(),await Zn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const s=JC(),l={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:l}}}async _emitInitialSession(t){return await this._useSession(async s=>{var l,o;try{const{data:{session:u},error:d}=s;if(d)throw d;await((l=this.stateChangeEmitters.get(t))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,s={}){let l=null,o=null;this.flowType==="pkce"&&([l,o]=await Ba(this.storage,this.storageKey,!0));try{return await bt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:l,code_challenge_method:o,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ct(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:s,error:l}=await this.getUser();if(l)throw l;return this._returnResult({data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(s){if(ct(s))return this._returnResult({data:null,error:s});throw s}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var s;try{const{data:l,error:o}=await this._useSession(async u=>{var d,h,f,m,y;const{data:v,error:x}=u;if(x)throw x;const w=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(h=t.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=t.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await bt(this.fetch,"GET",w,{headers:this.headers,jwt:(y=(m=v.session)===null||m===void 0?void 0:m.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return tr()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(l?.url),this._returnResult({data:{provider:t.provider,url:l?.url},error:null})}catch(l){if(ct(l))return this._returnResult({data:{provider:t.provider,url:null},error:l});throw l}}async linkIdentityIdToken(t){return await this._useSession(async s=>{var l;try{const{error:o,data:{session:u}}=s;if(o)throw o;const{options:d,provider:h,token:f,access_token:m,nonce:y}=t,v=await bt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=u?.access_token)!==null&&l!==void 0?l:void 0,body:{provider:h,id_token:f,access_token:m,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Kr}),{data:x,error:w}=v;return w?this._returnResult({data:{user:null,session:null},error:w}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new Ia}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:w}))}catch(o){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ct(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async s=>{var l,o;const{data:u,error:d}=s;if(d)throw d;return await bt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&o!==void 0?o:void 0})})}catch(s){if(ct(s))return this._returnResult({data:null,error:s});throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const l=Date.now();return await tN(async o=>(o>0&&await eN(200*Math.pow(2,o-1)),this._debug(s,"refreshing attempt",o),await bt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Kr})),(o,u)=>{const d=200*Math.pow(2,o);return u&&ff(u)&&Date.now()+d-l<Ya})}catch(l){if(this._debug(s,"error",l),ct(l))return this._returnResult({data:{session:null,user:null},error:l});throw l}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const l=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",l),tr()&&!s.skipBrowserRedirect&&window.location.assign(l),{data:{provider:t,url:l},error:null}}async _recoverAndRefresh(){var t,s;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const o=await Ii(this.storage,this.storageKey);if(o&&this.userStorage){let d=await Ii(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await Qa(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d?.user)!==null&&t!==void 0?t:mf()}else if(o&&!o.user&&!o.user){const d=await Ii(this.storage,this.storageKey+"-user");d&&d?.user?(o.user=d.user,await Zn(this.storage,this.storageKey+"-user"),await Qa(this.storage,this.storageKey,o)):o.user=mf()}if(this._debug(l,"session from storage",o),!this._isValidSession(o)){this._debug(l,"session is not valid"),o!==null&&await this._removeSession();return}const u=((s=o.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<hf;if(this._debug(l,`session has${u?"":" not"} expired with margin of ${hf}s`),u){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),ff(d)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:h}=await this._getUser(o.access_token);!h&&d?.user?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(l,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(l,"error",o),console.error(o);return}finally{this._debug(l,"end")}}async _callRefreshToken(t){var s,l;if(!t)throw new Cr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Yu;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new Cr;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const h={data:u.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(u){if(this._debug(o,"error",u),ct(u)){const d={data:null,error:u};return ff(u)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(d),d}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(u),u}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,s,l=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",s,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:t,session:s});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(t,s)}catch(f){u.push(f)}});if(await Promise.all(d),u.length>0){for(let h=0;h<u.length;h+=1)console.error(u[h]);throw u[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Zn(this.storage,`${this.storageKey}-code-verifier`);const s=Object.assign({},t),l=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&s.user&&await Qa(this.userStorage,this.storageKey+"-user",{user:s.user});const o=Object.assign({},s);delete o.user;const u=Jv(o);await Qa(this.storage,this.storageKey,u)}else{const o=Jv(s);await Qa(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Zn(this.storage,this.storageKey),await Zn(this.storage,this.storageKey+"-code-verifier"),await Zn(this.storage,this.storageKey+"-user"),this.userStorage&&await Zn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&tr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Ya);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:l}}=s;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((l.expires_at*1e3-t)/Ya);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Ya}ms, refresh threshold is ${Xf} ticks`),o<=Xf&&await this._callRefreshToken(l.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof V0)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,l){const o=[`provider=${encodeURIComponent(s)}`];if(l?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l?.scopes&&o.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[u,d]=await Ba(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(h.toString())}if(l?.queryParams){const u=new URLSearchParams(l.queryParams);o.push(u.toString())}return l?.skipBrowserRedirect&&o.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var l;const{data:o,error:u}=s;return u?this._returnResult({data:null,error:u}):await bt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(l=o?.session)===null||l===void 0?void 0:l.access_token})})}catch(s){if(ct(s))return this._returnResult({data:null,error:s});throw s}}async _enroll(t){try{return await this._useSession(async s=>{var l,o;const{data:u,error:d}=s;if(d)return this._returnResult({data:null,error:d});const h=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:f,error:m}=await bt(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(l=u?.session)===null||l===void 0?void 0:l.access_token});return m?this._returnResult({data:null,error:m}):(t.factorType==="totp"&&f.type==="totp"&&(!((o=f?.totp)===null||o===void 0)&&o.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),this._returnResult({data:f,error:null}))})}catch(s){if(ct(s))return this._returnResult({data:null,error:s});throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var l;const{data:o,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?AN(t.webauthn.credential_response):ON(t.webauthn.credential_response)})}:{code:t.code}),{data:h,error:f}=await bt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(l=o?.session)===null||l===void 0?void 0:l.access_token});return f?this._returnResult({data:null,error:f}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+h.expires_in},h)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",h),this._returnResult({data:h,error:f}))})}catch(s){if(ct(s))return this._returnResult({data:null,error:s});throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var l;const{data:o,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=await bt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(l=o?.session)===null||l===void 0?void 0:l.access_token});if(d.error)return d;const{data:h}=d;if(h.type!=="webauthn")return{data:h,error:null};switch(h.webauthn.type){case"create":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:kN(h.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:RN(h.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(s){if(ct(s))return this._returnResult({data:null,error:s});throw s}})}async _challengeAndVerify(t){const{data:s,error:l}=await this._challenge({factorId:t.factorId});return l?this._returnResult({data:null,error:l}):await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){var t;const{data:{user:s},error:l}=await this.getUser();if(l)return{data:null,error:l};const o={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=s?.factors)!==null&&t!==void 0?t:[])o.all.push(u),u.status==="verified"&&o[u.factor_type].push(u);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,s;const{data:{session:l},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=pf(l.access_token);let d=null;u.aal&&(d=u.aal);let h=d;((s=(t=l.user.factors)===null||t===void 0?void 0:t.filter(y=>y.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(h="aal2");const m=u.amr||[];return{data:{currentLevel:d,nextLevel:h,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async s=>{const{data:{session:l},error:o}=s;return o?this._returnResult({data:null,error:o}):l?await bt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:l.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Cr})})}catch(s){if(ct(s))return this._returnResult({data:null,error:s});throw s}}async _approveAuthorization(t,s){try{return await this._useSession(async l=>{const{data:{session:o},error:u}=l;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Cr});const d=await bt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:h=>({data:h,error:null})});return d.data&&d.data.redirect_url&&tr()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(l){if(ct(l))return this._returnResult({data:null,error:l});throw l}}async _denyAuthorization(t,s){try{return await this._useSession(async l=>{const{data:{session:o},error:u}=l;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Cr});const d=await bt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:h=>({data:h,error:null})});return d.data&&d.data.redirect_url&&tr()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(l){if(ct(l))return this._returnResult({data:null,error:l});throw l}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:s},error:l}=t;return l?this._returnResult({data:null,error:l}):s?await bt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Cr})})}catch(t){if(ct(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async s=>{const{data:{session:l},error:o}=s;return o?this._returnResult({data:null,error:o}):l?(await bt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:l.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Cr})})}catch(s){if(ct(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(t,s={keys:[]}){let l=s.keys.find(h=>h.kid===t);if(l)return l;const o=Date.now();if(l=this.jwks.keys.find(h=>h.kid===t),l&&this.jwks_cached_at+BC>o)return l;const{data:u,error:d}=await bt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=o,l=u.keys.find(h=>h.kid===t),!l)?null:l}async getClaims(t,s={}){try{let l=t;if(!l){const{data:w,error:_}=await this.getSession();if(_||!w.session)return this._returnResult({data:null,error:_});l=w.session.access_token}const{header:o,payload:u,signature:d,raw:{header:h,payload:f}}=pf(l);s?.allowExpired||oN(u.exp);const m=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!m){const{error:w}=await this.getUser(l);if(w)throw w;return{data:{claims:u,header:o,signature:d},error:null}}const y=cN(o.alg),v=await crypto.subtle.importKey("jwk",m,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,QC(`${h}.${f}`)))throw new tp("Invalid JWT signature");return{data:{claims:u,header:o,signature:d},error:null}}catch(l){if(ct(l))return this._returnResult({data:null,error:l});throw l}}}Ro.nextInstanceID={};const PN=Ro,qN="2.89.0";let po="";typeof Deno<"u"?po="deno":typeof document<"u"?po="web":typeof navigator<"u"&&navigator.product==="ReactNative"?po="react-native":po="node";const FN={"X-Client-Info":`supabase-js-${po}/${qN}`},HN={headers:FN},GN={schema:"public"},VN={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},KN={};function Ao(n){"@babel/helpers - typeof";return Ao=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ao(n)}function YN(n,t){if(Ao(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var l=s.call(n,t);if(Ao(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function QN(n){var t=YN(n,"string");return Ao(t)=="symbol"?t:t+""}function WN(n,t,s){return(t=QN(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function sx(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),s.push.apply(s,l)}return s}function Cn(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?sx(Object(s),!0).forEach(function(l){WN(n,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):sx(Object(s)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(s,l))})}return n}const JN=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),XN=()=>Headers,ZN=(n,t,s)=>{const l=JN(s),o=XN();return async(u,d)=>{var h;const f=(h=await t())!==null&&h!==void 0?h:n;let m=new o(d?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${f}`),l(u,Cn(Cn({},d),{},{headers:m}))}};function eE(n){return n.endsWith("/")?n:n+"/"}function tE(n,t){var s,l;const{db:o,auth:u,realtime:d,global:h}=n,{db:f,auth:m,realtime:y,global:v}=t,x={db:Cn(Cn({},f),o),auth:Cn(Cn({},m),u),realtime:Cn(Cn({},y),d),storage:{},global:Cn(Cn(Cn({},v),h),{},{headers:Cn(Cn({},(s=v?.headers)!==null&&s!==void 0?s:{}),(l=h?.headers)!==null&&l!==void 0?l:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function nE(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(eE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var rE=class extends PN{constructor(n){super(n)}},sE=class{constructor(n,t,s){var l,o;this.supabaseUrl=n,this.supabaseKey=t;const u=nE(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,h={db:GN,realtime:KN,auth:Cn(Cn({},VN),{},{storageKey:d}),global:HN},f=tE(s??{},h);if(this.storageKey=(l=f.auth.storageKey)!==null&&l!==void 0?l:"",this.headers=(o=f.global.headers)!==null&&o!==void 0?o:{},f.accessToken)this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var m;this.auth=this._initSupabaseAuthClient((m=f.auth)!==null&&m!==void 0?m:{},this.headers,f.global.fetch)}this.fetch=ZN(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Cn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.accessToken&&this.accessToken().then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new L1(new URL("rest/v1",u).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this.storage=new MC(this.storageUrl.href,this.headers,this.fetch,s?.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new O1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,s)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,s;if(n.accessToken)return await n.accessToken();const{data:l}=await n.auth.getSession();return(t=(s=l.session)===null||s===void 0?void 0:s.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:l,userStorage:o,storageKey:u,flowType:d,lock:h,debug:f,throwOnError:m},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new rE({url:this.authUrl.href,headers:Cn(Cn({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:l,userStorage:o,flowType:d,lock:h,debug:f,throwOnError:m,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(w=>w.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new eC(this.realtimeUrl.href,Cn(Cn({},n),{},{params:Cn(Cn({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,s){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const iE=(n,t,s)=>new sE(n,t,s);function aE(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}aE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const yf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_API_KEY:"REDACTED_GOOGLE_API_KEY",VITE_SUPABASE_ANON_KEY:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",VITE_SUPABASE_URL:"http://127.0.0.1:54321"};var lE={};const Q0=n=>{if(typeof import.meta<"u"&&yf&&yf[n])return yf[n];const t=lE;return t&&t[n]?t[n]:null},W0=Q0("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",oE=Q0("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",cE=W0,Re=iE(W0,oE),uE={async translateRecipe(n,t="EN-US"){const s=[];s.push(n.title||""),s.push(n.description||"");let l=2,o=2;if(n.type==="bread"){const d=n.flours||[],h=n.breadIngredients||[];d.forEach(f=>s.push(f.name||"")),h.forEach(f=>s.push(f.name||"")),o=l+d.length+h.length}else{const d=n.ingredients||[];d.forEach(h=>{const f=typeof h=="string"?h:h.name||"";s.push(f)}),o=l+d.length}const u=n.steps||[];if(u.forEach(d=>{const h=typeof d=="object"&&d!==null?d.text||"":d||"";s.push(h)}),s.length===0)return n;try{const d=await this.translateList(s,t),h={...n};if(h.title=d[0],h.description=d[1],n.type==="bread"){const f=(n.flours||[]).length;h.flours=(n.flours||[]).map((m,y)=>({...m,name:d[l+y]})),h.breadIngredients=(n.breadIngredients||[]).map((m,y)=>({...m,name:d[l+f+y]}))}else h.ingredients=(n.ingredients||[]).map((f,m)=>{const y=d[l+m];return typeof f=="string"?y:{...f,name:y}});return h.steps=u.map((f,m)=>{const y=d[o+m];return typeof f=="object"&&f!==null?{...f,text:y}:y}),h}catch(d){throw console.error("Translation failed:",d),d}},async translateList(n,t){const{data:s,error:l}=await Re.functions.invoke("translate",{body:{text:n,target_lang:t}});if(l)throw console.error("Supabase Function Invocation Error:",l),new Error(`Translation Error: ${l.message}`);if(s&&s.error)throw console.error("Edge Function returned error:",s.error),new Error(`Translation Error: ${s.error}`);return s.translations.map(o=>o.text)}},nn=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},cu=async(n,t,s)=>{let l=null;try{const o=new Promise((u,d)=>{l=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{l&&clearTimeout(l)}},xu=n=>{if(Array.isArray(n))return n.map(s=>String(s)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const s=t.slice(1,-1);return s?s.split(",").map(l=>l.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},dE=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],s=Object.values(t)[0];return xu(s)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return xu(t)}return xu(n)},J0=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const s=xu(t);return s.length>0?s:t.split(",").map(l=>l.trim()).filter(Boolean)}return[]},ix=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),s=String(n.message||"").toLowerCase(),l=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||s.includes("row-level security")||s.includes("permission denied")||s.includes("violates row-level security")||s.includes("invalid input syntax")||s.includes("column")||l.includes("row-level security")?!1:s.includes("failed to fetch")||s.includes("network")||s.includes("timeout")||s.includes("timed out")||s.includes("load failed")},X0="recipe_list_cache",hE=300*1e3,ax=(n,t)=>{try{const s=(n||[]).map(l=>({id:l.id,title:l.title,description:l.description,image:l.image,servings:l.servings,course:l.course,category:l.category,storeName:l.storeName,store_name:l.store_name,tags:l.tags,created_at:l.created_at,updated_at:l.updated_at,type:l.type,sourceUrl:l.sourceUrl}));localStorage.setItem(X0,JSON.stringify({userId:t,updatedAt:Date.now(),recipes:s}))}catch{}},fE=n=>{try{const t=localStorage.getItem(X0);if(!t)return null;const s=JSON.parse(t);return s.userId!==n||Date.now()-s.updatedAt>hE?null:s.recipes||null}catch{return null}},bn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(n){return fE(n)},async _resolveShowMasterPreference(n,t=15e3){const s=n?.showMasterRecipes===!0,l=n?.id;if(!l)return s;const o=this._showMasterPrefCache.get(l),u=Date.now();if(o&&o.value!==s)return this._showMasterPrefCache.set(l,{value:s,updatedAt:u}),s;if(o&&u-o.updatedAt<3e4)return o.value;try{const{data:d,error:h}=await cu(Re.from("profiles").select("show_master_recipes").eq("id",l).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(h)throw h;const f=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(l,{value:f,updatedAt:u}),f}catch{return this._showMasterPrefCache.set(l,{value:s,updatedAt:u}),s}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:s,error:l}=await cu(Re.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(l)throw l;const o=dE(s),u=new Set(o.length>0?o:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const s=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:s,updatedAt:t},s}},async fetchRecipes(n,{timeoutMs:t=15e3,includeIngredients:s=!0,includeSources:l=!0}={}){if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const o=n.role==="admin",u=o?Promise.resolve(!1):this._resolveShowMasterPreference(n,t);let d=[];const h=async($,{withOrderIndex:z,queryTimeoutMs:C})=>{let M=Re.from("recipes").select($);z?M=M.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):M=M.order("created_at",{ascending:!1});const{data:T,error:F}=await cu(M,C,"recipes.select(list)");if(F)throw F;return(T||[]).map(Yr)},f=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${l?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${l?",recipe_sources(url)":""}`,m=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${l?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${l?",recipe_sources(url)":""}`,y=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",v=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let x=null;const w=`recipe_query_pattern:${s?"ing":"noing"}:${l?"src":"nosrc"}`,_=this._queryPatternCache.get(w),N=Math.max(2500,t);if(_)try{d=await h(_.spec,{withOrderIndex:_.withOrderIndex,queryTimeoutMs:N})}catch($){console.warn("Cached query pattern failed, re-detecting...",$),this._queryPatternCache.delete(w),x=$}else{const z=Math.max(2500,Math.round(t/(s?[f,m,y,v]:[f,m,v]).length));try{d=await h(f,{withOrderIndex:!0,queryTimeoutMs:z}),this._queryPatternCache.set(w,{spec:f,withOrderIndex:!0})}catch(C){x=C;try{d=await h(m,{withOrderIndex:!1,queryTimeoutMs:z}),this._queryPatternCache.set(w,{spec:m,withOrderIndex:!1})}catch(M){x=M;try{d=await h(y,{withOrderIndex:!1,queryTimeoutMs:z}),this._queryPatternCache.set(w,{spec:y,withOrderIndex:!1})}catch(T){x=T;try{d=await h(v,{withOrderIndex:!1,queryTimeoutMs:z}),this._queryPatternCache.set(w,{spec:v,withOrderIndex:!1})}catch(F){x=F,d=[]}}}}}if(d.length===0&&x)try{const $=localStorage.getItem("local_recipes");if($)d=JSON.parse($).map(z=>typeof Yr=="function"?Yr(z):z);else throw x}catch{throw x}if(o)return ax(d,n.id),d;const j=[String(n.id)];n.displayId&&j.push(String(n.displayId));const E=await u,O=E?await this._resolveMasterOwnerTags(t):new Set,D=d.filter($=>{const z=J0($.tags),C=z.filter(K=>K&&K.startsWith("owner:"));if(C.length===0)return!0;const M=C.some(K=>O.has(K));if(E&&M)return!0;const T=C.some(K=>j.some(G=>K===`owner:${G}`)),F=z.includes("public");return!!(T||F)});return ax(D,n.id),D},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),l=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:o}=await Re.storage.from("recipe-images").upload(l,n);if(o)throw o;const{data:u}=Re.storage.from("recipe-images").getPublicUrl(l);return u.publicUrl},async getRecipe(n){try{const{data:t,error:s}=await cu(Re.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(s)throw s;return Yr(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const s=localStorage.getItem("local_recipes");if(s){const o=JSON.parse(s).find(u=>u.id==n);if(o)return Yr(o)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:s,created_at:l,sourceUrl:o,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const f=(u.tags||[]).filter(m=>!m.startsWith("owner:"));u.tags=[...f,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=uu(u);try{const{data:h,error:f}=await Re.from("recipes").insert([d]).select().single();if(f)throw f;if(o){const{error:m}=await Re.from("recipe_sources").insert([{recipe_id:h.id,url:o}]);m&&console.error("Failed to save source URL:",m)}return Yr({...h,recipe_sources:o?[{url:o}]:[]})}catch(h){if(!ix(h))throw h;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",h);const f=Date.now(),m={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=uu(m);y.id=f,y.created_at=m.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),h}return Yr(y)}},async updateRecipe(n){const{id:t,created_at:s,sourceUrl:l,...o}=n;o.image instanceof File&&(o.image=await this.uploadImage(o.image));const u=uu(o);o.steps===void 0&&delete u.steps,o.tags===void 0&&delete u.tags,o.ingredients!==void 0||o.type!==void 0||o.ingredientGroups!==void 0||o.flours!==void 0||o.breadIngredients!==void 0||o.stepGroups!==void 0||delete u.ingredients;try{const{data:h,error:f}=await Re.from("recipes").update(u).eq("id",n.id).select().single();if(f)throw f;if(l!==void 0&&(await Re.from("recipe_sources").delete().eq("recipe_id",n.id),l)){const{error:m}=await Re.from("recipe_sources").insert([{recipe_id:n.id,url:l}]);m&&console.error("Failed to update source URL:",m)}return Yr({...h,recipe_sources:l?[{url:l}]:[]})}catch(h){if(!ix(h))throw h;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",h);const f=localStorage.getItem("local_recipes");if(f){let m=JSON.parse(f);const y=m.findIndex(v=>v.id==n.id);if(y!==-1){const v={...m[y],...u,updated_at:new Date().toISOString()};return m[y]=v,localStorage.setItem("local_recipes",JSON.stringify(m)),Yr(v)}}throw h}},async duplicateRecipe(n,t){const{id:s,created_at:l,updated_at:o,image:u,...d}=n;d.title=`${d.title} ()`;let h=null;if(u)try{const f=u.split("/").pop(),m=`copy-${Date.now()}-${f}`,{error:y}=await Re.storage.from("recipe-images").copy(f,m);if(y)console.warn("Image copy failed, using original URL:",y),h=u;else{const{data:v}=Re.storage.from("recipe-images").getPublicUrl(m);h=v.publicUrl}}catch(f){console.warn("Image copy logic error:",f),h=u}return d.image=h,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await Re.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(pE)},async getDeletedCount(){const{count:n,error:t}=await Re.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:s}=await Re.from("recipes").select("*").eq("id",n).single();if(s)throw s;const{error:l}=await Re.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(l)throw l;const{error:o}=await Re.from("recipes").delete().eq("id",n);if(o)throw o;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const s=localStorage.getItem("local_recipes");if(s){let l=JSON.parse(s);const o=l.length;if(l=l.filter(u=>u.id!=n),l.length<o)return localStorage.setItem("local_recipes",JSON.stringify(l)),!0}throw t}},async restoreRecipe(n){const{data:t,error:s}=await Re.from("deleted_recipes").select("*").eq("id",n).single();if(s)throw s;const{error:l}=await Re.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(l)throw l;const{error:o}=await Re.from("deleted_recipes").delete().eq("id",n);if(o)throw o;return!0},async hardDeleteRecipe(n){const{error:t}=await Re.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await Re.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(s=>s.recipe_id)},async addToHistory(n){const{error:t}=await Re.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(s=>Re.from("recipes").update({order_index:s.order_index}).eq("id",s.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,s=[];for(const l of n)try{await this.createRecipe(l),t++}catch(o){console.error("Import failed for recipe:",l.title,o),s.push({title:l.title,error:o.message})}return{success:!0,count:t,errors:s}},async updateRecipeCosts(n){const{data:t,error:s}=await Re.from("recipes").select("*");if(s)throw s;let l=0;const o=[];for(const u of t){const d=Yr(u);let h=!1;const f=m=>m.map(y=>{if(!y.name)return y;const v=n.get(nn(y.name));if(v&&y.purchaseCost!==v.price){h=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const w=parseFloat(x.quantity)||0;x.cost=Math.round(w/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const w=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*w)}return x}return y});if(d.type==="bread"){const m=f(d.flours||[]),y=f(d.breadIngredients||[]);h&&(d.flours=m,d.breadIngredients=y)}else{const m=f(d.ingredients||[]);h&&(d.ingredients=m)}if(h){const m=uu(d);o.push(Re.from("recipes").update(m).eq("id",d.id)),l++}}return o.length>0&&await Promise.all(o),l}},uu=n=>{let t=n.ingredients||[];const s={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(s.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const o=n.steps||[],u=n.stepGroups.map(d=>({...d,count:o.filter(h=>h.groupId===d.id).length}));s.stepGroups=u}if(n.type==="bread"){const o=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[s,...o,...u]}else t=[s,...t];const l=(n.steps||[]).map(o=>typeof o=="string"?o:o.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:l,tags:n.tags||[]}},Yr=n=>{const t=n.ingredients||[];let s="normal",l=[],o=[],u=[],d=[],h=t;const f=J0(n.tags);if(n.ingredients_meta)s=n.ingredients_meta.type||"normal",h=[];else if(Array.isArray(t)&&t.length>0&&t[0]._meta){const y=t[0];s=y.type||"normal",y.groups&&(u=y.groups),y.stepGroups&&(d=y.stepGroups);const v=t.slice(1);s==="bread"?(l=v.filter(x=>x._group==="flour").map(x=>{const{_group:w,..._}=x;return _}),o=v.filter(x=>x._group==="other").map(x=>{const{_group:w,..._}=x;return _}),h=[...l,...o]):h=v}let m=n.steps||[];if(d.length>0&&Array.isArray(m)){let y=0;m=m.map(x=>({text:x}));const v=[];for(d.forEach(x=>{const w=x.count||0;for(let _=0;_<w;_++)y<m.length&&(v.push({...m[y],text:m[y].text,groupId:x.id}),y++)});y<m.length;)v.push({...m[y],groupId:"default"}),y++;m=v}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:s,flours:l,breadIngredients:o,ingredientGroups:u,stepGroups:d,ingredients:h,steps:m.length>0&&typeof m[0]=="object"?m:n.steps,tags:f,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},pE=n=>({...Yr(n),deletedAt:n.deleted_at,originalId:n.original_id}),vf=Object.freeze(Object.defineProperty({__proto__:null,recipeService:bn},Symbol.toStringTag,{value:"Module"})),xf="food",mE="food_alcohol",gE=new Set(["food","alcohol","soft_drink","supplies"]),du=n=>{const t=String(n||"").trim();return!t||t===mE?xf:gE.has(t)?t:xf},Pn={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,s,l=null,o=null,u=void 0,d=void 0){try{const h=await this._getCurrentUserId();if(!h)throw new Error("");const f={user_id:h,ingredient_name:n,packet_size:parseFloat(t),packet_unit:s,last_price:l?parseFloat(l):null,updated_at:new Date().toISOString()};if(o&&(f.item_category=du(o)),u!==void 0){const x=String(u??"").trim();f.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let w=Number.isFinite(x)?x:100;w<=0&&(w=100),w>100&&(w=100),f.yield_percent=w}const m=async x=>Re.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await m(f);if(v){const x=String(v.message||""),w=!!f.item_category&&x.includes("item_category"),_=Object.prototype.hasOwnProperty.call(f,"vendor")&&x.includes("vendor"),N=Object.prototype.hasOwnProperty.call(f,"yield_percent")&&x.includes("yield_percent");if(w||_||N){const j={...f};w&&delete j.item_category,_&&delete j.vendor,N&&delete j.yield_percent,{data:y,error:v}=await m(j)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:du(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(h){throw console.error("Error saving conversion:",h),h}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:s,error:l}=await Re.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return l?(l.code==="PGRST116"||console.warn("Error fetching conversion:",l),null):{ingredientName:s.ingredient_name,packetSize:s.packet_size,packetUnit:s.packet_unit,lastPrice:s.last_price,vendor:s.vendor||"",itemCategory:du(s.item_category),yieldPercent:s.yield_percent===null||s.yield_percent===void 0?100:s.yield_percent,updatedAt:s.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:s}=await Re.from("unit_conversions").select("*").eq("user_id",n);if(s)throw s;const l=new Map;return t.forEach(o=>{l.set(o.ingredient_name,{ingredientName:o.ingredient_name,packetSize:o.packet_size,packetUnit:o.packet_unit,lastPrice:o.last_price,vendor:o.vendor||"",itemCategory:du(o.item_category),yieldPercent:o.yield_percent===null||o.yield_percent===void 0?100:o.yield_percent,updatedAt:o.updated_at})}),l}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:s}=await Re.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(s)throw s;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(n,{overwrite:t=!1}={}){const s=String(n||"").trim();if(!s)throw new Error("");const{data:l,error:o}=await Re.rpc("admin_copy_ingredient_master",{target_profile_id:s,overwrite:t===!0});if(o)throw o;return l}},Z0=b.createContext(null),os=()=>b.useContext(Z0),eb=b.createContext(null),ea=()=>{const n=b.useContext(eb);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},bu=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],yE=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var Fa={},bf={exports:{}},wf,lx;function vE(){if(lx)return wf;lx=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return wf=n,wf}var Sf,ox;function xE(){if(ox)return Sf;ox=1;var n=vE();function t(){}function s(){}return s.resetWarningCache=t,Sf=function(){function l(d,h,f,m,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}l.isRequired=l;function o(){return l}var u={array:l,bigint:l,bool:l,func:l,number:l,object:l,string:l,symbol:l,any:l,arrayOf:o,element:l,elementType:l,instanceOf:o,node:l,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:s,resetWarningCache:t};return u.PropTypes=u,u},Sf}var cx;function tb(){return cx||(cx=1,bf.exports=xE()()),bf.exports}var jf,ux;function nb(){return ux||(ux=1,jf={L:1,M:0,Q:3,H:2}),jf}var _f,dx;function rb(){return dx||(dx=1,_f={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),_f}var Cf,hx;function bE(){if(hx)return Cf;hx=1;var n=rb();function t(s){this.mode=n.MODE_8BIT_BYTE,this.data=s}return t.prototype={getLength:function(s){return this.data.length},write:function(s){for(var l=0;l<this.data.length;l++)s.put(this.data.charCodeAt(l),8)}},Cf=t,Cf}var Nf,fx;function wE(){if(fx)return Nf;fx=1;var n=nb();function t(s,l){this.totalCount=s,this.dataCount=l}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(s,l){var o=t.getRsBlockTable(s,l);if(o==null)throw new Error("bad rs block @ typeNumber:"+s+"/errorCorrectLevel:"+l);for(var u=o.length/3,d=new Array,h=0;h<u;h++)for(var f=o[h*3+0],m=o[h*3+1],y=o[h*3+2],v=0;v<f;v++)d.push(new t(m,y));return d},t.getRsBlockTable=function(s,l){switch(l){case n.L:return t.RS_BLOCK_TABLE[(s-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(s-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(s-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(s-1)*4+3];default:return}},Nf=t,Nf}var Ef,px;function SE(){if(px)return Ef;px=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var s=Math.floor(t/8);return(this.buffer[s]>>>7-t%8&1)==1},put:function(t,s){for(var l=0;l<s;l++)this.putBit((t>>>s-l-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),t&&(this.buffer[s]|=128>>>this.length%8),this.length++}},Ef=n,Ef}var Tf,mx;function sb(){if(mx)return Tf;mx=1;for(var n={glog:function(s){if(s<1)throw new Error("glog("+s+")");return n.LOG_TABLE[s]},gexp:function(s){for(;s<0;)s+=255;for(;s>=256;)s-=255;return n.EXP_TABLE[s]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return Tf=n,Tf}var kf,gx;function ib(){if(gx)return kf;gx=1;var n=sb();function t(s,l){if(s.length==null)throw new Error(s.length+"/"+l);for(var o=0;o<s.length&&s[o]==0;)o++;this.num=new Array(s.length-o+l);for(var u=0;u<s.length-o;u++)this.num[u]=s[u+o]}return t.prototype={get:function(s){return this.num[s]},getLength:function(){return this.num.length},multiply:function(s){for(var l=new Array(this.getLength()+s.getLength()-1),o=0;o<this.getLength();o++)for(var u=0;u<s.getLength();u++)l[o+u]^=n.gexp(n.glog(this.get(o))+n.glog(s.get(u)));return new t(l,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var l=n.glog(this.get(0))-n.glog(s.get(0)),o=new Array(this.getLength()),u=0;u<this.getLength();u++)o[u]=this.get(u);for(var u=0;u<s.getLength();u++)o[u]^=n.gexp(n.glog(s.get(u))+l);return new t(o,0).mod(s)}},kf=t,kf}var Rf,yx;function jE(){if(yx)return Rf;yx=1;var n=rb(),t=ib(),s=sb(),l={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;o.getBCHDigit(d)-o.getBCHDigit(o.G15)>=0;)d^=o.G15<<o.getBCHDigit(d)-o.getBCHDigit(o.G15);return(u<<10|d)^o.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;o.getBCHDigit(d)-o.getBCHDigit(o.G18)>=0;)d^=o.G18<<o.getBCHDigit(d)-o.getBCHDigit(o.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return o.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,h){switch(u){case l.PATTERN000:return(d+h)%2==0;case l.PATTERN001:return d%2==0;case l.PATTERN010:return h%3==0;case l.PATTERN011:return(d+h)%3==0;case l.PATTERN100:return(Math.floor(d/2)+Math.floor(h/3))%2==0;case l.PATTERN101:return d*h%2+d*h%3==0;case l.PATTERN110:return(d*h%2+d*h%3)%2==0;case l.PATTERN111:return(d*h%3+(d+h)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),h=0;h<u;h++)d=d.multiply(new t([1,s.gexp(h)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),h=0,f=0;f<d;f++)for(var m=0;m<d;m++){for(var y=0,v=u.isDark(f,m),x=-1;x<=1;x++)if(!(f+x<0||d<=f+x))for(var w=-1;w<=1;w++)m+w<0||d<=m+w||x==0&&w==0||v==u.isDark(f+x,m+w)&&y++;y>5&&(h+=3+y-5)}for(var f=0;f<d-1;f++)for(var m=0;m<d-1;m++){var _=0;u.isDark(f,m)&&_++,u.isDark(f+1,m)&&_++,u.isDark(f,m+1)&&_++,u.isDark(f+1,m+1)&&_++,(_==0||_==4)&&(h+=3)}for(var f=0;f<d;f++)for(var m=0;m<d-6;m++)u.isDark(f,m)&&!u.isDark(f,m+1)&&u.isDark(f,m+2)&&u.isDark(f,m+3)&&u.isDark(f,m+4)&&!u.isDark(f,m+5)&&u.isDark(f,m+6)&&(h+=40);for(var m=0;m<d;m++)for(var f=0;f<d-6;f++)u.isDark(f,m)&&!u.isDark(f+1,m)&&u.isDark(f+2,m)&&u.isDark(f+3,m)&&u.isDark(f+4,m)&&!u.isDark(f+5,m)&&u.isDark(f+6,m)&&(h+=40);for(var N=0,m=0;m<d;m++)for(var f=0;f<d;f++)u.isDark(f,m)&&N++;var j=Math.abs(100*N/d/d-50)/5;return h+=j*10,h}};return Rf=o,Rf}var Af,vx;function _E(){if(vx)return Af;vx=1;var n=bE(),t=wE(),s=SE(),l=jE(),o=ib();function u(h,f){this.typeNumber=h,this.errorCorrectLevel=f,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(h){var f=new n(h);this.dataList.push(f),this.dataCache=null},d.isDark=function(h,f){if(h<0||this.moduleCount<=h||f<0||this.moduleCount<=f)throw new Error(h+","+f);return this.modules[h][f]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var h=1;for(h=1;h<40;h++){for(var f=t.getRSBlocks(h,this.errorCorrectLevel),m=new s,y=0,v=0;v<f.length;v++)y+=f[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];m.put(x.mode,4),m.put(x.getLength(),l.getLengthInBits(x.mode,h)),x.write(m)}if(m.getLengthInBits()<=y*8)break}this.typeNumber=h}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(h,f){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++){this.modules[m]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[m][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(h,f),this.typeNumber>=7&&this.setupTypeNumber(h),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,f)},d.setupPositionProbePattern=function(h,f){for(var m=-1;m<=7;m++)if(!(h+m<=-1||this.moduleCount<=h+m))for(var y=-1;y<=7;y++)f+y<=-1||this.moduleCount<=f+y||(0<=m&&m<=6&&(y==0||y==6)||0<=y&&y<=6&&(m==0||m==6)||2<=m&&m<=4&&2<=y&&y<=4?this.modules[h+m][f+y]=!0:this.modules[h+m][f+y]=!1)},d.getBestMaskPattern=function(){for(var h=0,f=0,m=0;m<8;m++){this.makeImpl(!0,m);var y=l.getLostPoint(this);(m==0||h>y)&&(h=y,f=m)}return f},d.createMovieClip=function(h,f,m){var y=h.createEmptyMovieClip(f,m),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var w=x*v,_=0;_<this.modules[x].length;_++){var N=_*v,j=this.modules[x][_];j&&(y.beginFill(0,100),y.moveTo(N,w),y.lineTo(N+v,w),y.lineTo(N+v,w+v),y.lineTo(N,w+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var h=8;h<this.moduleCount-8;h++)this.modules[h][6]==null&&(this.modules[h][6]=h%2==0);for(var f=8;f<this.moduleCount-8;f++)this.modules[6][f]==null&&(this.modules[6][f]=f%2==0)},d.setupPositionAdjustPattern=function(){for(var h=l.getPatternPosition(this.typeNumber),f=0;f<h.length;f++)for(var m=0;m<h.length;m++){var y=h[f],v=h[m];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var w=-2;w<=2;w++)x==-2||x==2||w==-2||w==2||x==0&&w==0?this.modules[y+x][v+w]=!0:this.modules[y+x][v+w]=!1}},d.setupTypeNumber=function(h){for(var f=l.getBCHTypeNumber(this.typeNumber),m=0;m<18;m++){var y=!h&&(f>>m&1)==1;this.modules[Math.floor(m/3)][m%3+this.moduleCount-8-3]=y}for(var m=0;m<18;m++){var y=!h&&(f>>m&1)==1;this.modules[m%3+this.moduleCount-8-3][Math.floor(m/3)]=y}},d.setupTypeInfo=function(h,f){for(var m=this.errorCorrectLevel<<3|f,y=l.getBCHTypeInfo(m),v=0;v<15;v++){var x=!h&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!h&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!h},d.mapData=function(h,f){for(var m=-1,y=this.moduleCount-1,v=7,x=0,w=this.moduleCount-1;w>0;w-=2)for(w==6&&w--;;){for(var _=0;_<2;_++)if(this.modules[y][w-_]==null){var N=!1;x<h.length&&(N=(h[x]>>>v&1)==1);var j=l.getMask(f,y,w-_);j&&(N=!N),this.modules[y][w-_]=N,v--,v==-1&&(x++,v=7)}if(y+=m,y<0||this.moduleCount<=y){y-=m,m=-m;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(h,f,m){for(var y=t.getRSBlocks(h,f),v=new s,x=0;x<m.length;x++){var w=m[x];v.put(w.mode,4),v.put(w.getLength(),l.getLengthInBits(w.mode,h)),w.write(v)}for(var _=0,x=0;x<y.length;x++)_+=y[x].dataCount;if(v.getLengthInBits()>_*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+_*8+")");for(v.getLengthInBits()+4<=_*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=_*8||(v.put(u.PAD0,8),v.getLengthInBits()>=_*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(h,f){for(var m=0,y=0,v=0,x=new Array(f.length),w=new Array(f.length),_=0;_<f.length;_++){var N=f[_].dataCount,j=f[_].totalCount-N;y=Math.max(y,N),v=Math.max(v,j),x[_]=new Array(N);for(var E=0;E<x[_].length;E++)x[_][E]=255&h.buffer[E+m];m+=N;var O=l.getErrorCorrectPolynomial(j),D=new o(x[_],O.getLength()-1),$=D.mod(O);w[_]=new Array(O.getLength()-1);for(var E=0;E<w[_].length;E++){var z=E+$.getLength()-w[_].length;w[_][E]=z>=0?$.get(z):0}}for(var C=0,E=0;E<f.length;E++)C+=f[E].totalCount;for(var M=new Array(C),T=0,E=0;E<y;E++)for(var _=0;_<f.length;_++)E<x[_].length&&(M[T++]=x[_][E]);for(var E=0;E<v;E++)for(var _=0;_<f.length;_++)E<w[_].length&&(M[T++]=w[_][E]);return M},Af=u,Af}var hu={},xx;function CE(){if(xx)return hu;xx=1,Object.defineProperty(hu,"__esModule",{value:!0});var n=Object.assign||function(m){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(m[x]=v[x])}return m},t=tb(),s=u(t),l=Do(),o=u(l);function u(m){return m&&m.__esModule?m:{default:m}}function d(m,y){var v={};for(var x in m)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(m,x)&&(v[x]=m[x]);return v}var h={bgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,bgD:s.default.string.isRequired,fgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,fgD:s.default.string.isRequired,size:s.default.number.isRequired,title:s.default.string,viewBoxSize:s.default.number.isRequired,xmlns:s.default.string},f=(0,l.forwardRef)(function(m,y){var v=m.bgColor,x=m.bgD,w=m.fgD,_=m.fgColor,N=m.size,j=m.title,E=m.viewBoxSize,O=m.xmlns,D=O===void 0?"http://www.w3.org/2000/svg":O,$=d(m,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return o.default.createElement("svg",n({},$,{height:N,ref:y,viewBox:"0 0 "+E+" "+E,width:N,xmlns:D}),j?o.default.createElement("title",null,j):null,o.default.createElement("path",{d:x,fill:v}),o.default.createElement("path",{d:w,fill:_}))});return f.displayName="QRCodeSvg",f.propTypes=h,hu.default=f,hu}var bx;function NE(){if(bx)return Fa;bx=1,Object.defineProperty(Fa,"__esModule",{value:!0}),Fa.QRCode=void 0;var n=Object.assign||function(N){for(var j=1;j<arguments.length;j++){var E=arguments[j];for(var O in E)Object.prototype.hasOwnProperty.call(E,O)&&(N[O]=E[O])}return N},t=tb(),s=v(t),l=nb(),o=v(l),u=_E(),d=v(u),h=Do(),f=v(h),m=CE(),y=v(m);function v(N){return N&&N.__esModule?N:{default:N}}function x(N,j){var E={};for(var O in N)j.indexOf(O)>=0||Object.prototype.hasOwnProperty.call(N,O)&&(E[O]=N[O]);return E}var w={bgColor:s.default.oneOfType([s.default.object,s.default.string]),fgColor:s.default.oneOfType([s.default.object,s.default.string]),level:s.default.string,size:s.default.number,value:s.default.string.isRequired},_=(0,h.forwardRef)(function(N,j){var E=N.bgColor,O=E===void 0?"#FFFFFF":E,D=N.fgColor,$=D===void 0?"#000000":D,z=N.level,C=z===void 0?"L":z,M=N.size,T=M===void 0?256:M,F=N.value,K=x(N,["bgColor","fgColor","level","size","value"]),G=new d.default(-1,o.default[C]);G.addData(F),G.make();var q=G.modules;return f.default.createElement(y.default,n({},K,{bgColor:O,bgD:q.map(function(V,P){return V.map(function(L,R){return L?"":"M "+R+" "+P+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:$,fgD:q.map(function(V,P){return V.map(function(L,R){return L?"M "+R+" "+P+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:j,size:T,viewBoxSize:q.length}))});return Fa.QRCode=_,_.displayName="QRCode",_.propTypes=w,Fa.default=_,Fa}var EE=NE();const TE=Lx(EE),wx=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},kE=n=>{if(n==null)return NaN;if(typeof n=="number")return Number.isFinite(n)?n:NaN;const t=String(n).trim().replace(/[,\s]/g,"");if(!t)return NaN;const s=parseFloat(t);return Number.isFinite(s)?s:NaN},as=(n,{maximumFractionDigits:t=1}={})=>{const s=kE(n);return Number.isFinite(s)?`${s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}`:null},RE=new Set(["food","alcohol","soft_drink","supplies"]),ab=new Set(["alcohol","supplies"]),lb=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":RE.has(t)?t:"":""},np=n=>{const t=lb(n?.itemCategory??n?.item_category);return t?ab.has(t):!!n?.isAlcohol},Bi=n=>np(n)?1.1:1.08,Sx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),AE=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=Sx(t);if(!l)return null;for(const[o,u]of n.entries())if(Sx(o)===l)return u;return null},Us=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},OE=n=>{const t=Us(n);return!Number.isFinite(t)||t<=0||t>100?100:t},DE=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return OE(s)/100},ME=(n,t,s)=>{const l=Us(n),o=Us(t);if(!Number.isFinite(l)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/o*1e3:(["kg","","l",""].includes(u),l/o)},jx=(n,t,s,{defaultWeightWhenUnitEmpty:l=!1,forceWeightBased:o=!1,yieldRate:u=1}={})=>{const d=Us(n),h=Us(t);if(!Number.isFinite(d)||!Number.isFinite(h))return NaN;const f=Number.isFinite(u)&&u>0?u:1,m=String(s||"").trim().toLowerCase();return o||!m&&l||["g","","ml","","cc",""].includes(m)?d/1e3*h/f:d*h/f},zE=(n,t)=>{const s=Us(n?.purchaseCost),l=Us(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},UE=({recipe:n,ownerLabel:t,onBack:s,onEdit:l,onDelete:o,onHardDelete:u,isDeleted:d,onView:h,onDuplicate:f,backLabel:m,onList:y})=>{const{user:v}=os(),x=ea(),[w,_]=we.useState(!1),[N,j]=we.useState(!1),[E,O]=we.useState(!1),[D,$]=we.useState(new Set),[z,C]=we.useState(new Set),[M,T]=we.useState(new Set),[F,K]=we.useState({}),[G,q]=we.useState("ORIGINAL"),[V,P]=we.useState(!1),[L,R]=we.useState(!0),[I,Y]=we.useState(!1),[ue,ye]=we.useState(new Map),[B,J]=we.useState(""),[Z,ge]=we.useState(1),[Me,ve]=we.useState(""),[ae,A]=we.useState(""),X=we.useMemo(()=>{const re=parseFloat(Z);return isNaN(re)?1:re},[Z]),ce=(re,ne)=>{if(!re)return"";const fe=parseFloat(re);if(isNaN(fe))return re;const Te=fe*parseFloat(ne);return Number.isInteger(Te)?Te.toString():Te.toFixed(1).replace(/\.0$/,"")},Se=(re,ne)=>{if(!re)return"";const fe=parseFloat(re);return isNaN(fe)?re:(fe*parseFloat(ne)).toFixed(2).replace(/\.00$/,"")},[Ae,Be]=we.useState(n),[Le,Ge]=we.useState(!1),W=G==="ORIGINAL"?Ae:F[G]||Ae;we.useEffect(()=>{let re=!0;return Pn.getAllConversions().then(ne=>{re&&ye(ne)}).catch(()=>{re&&ye(new Map)}),()=>{re=!1}},[]);const Ce=we.useMemo(()=>{const re=(ne,fe={})=>{if(!ne||typeof ne!="object")return ne;const Te=AE(ue,ne.name),Pe=lb(ne.itemCategory??ne.item_category??Te?.itemCategory),Xe=DE(ne,Te);let Qe=ne;if(Pe&&(Qe={...Qe,itemCategory:Pe,isAlcohol:ab.has(Pe)}),!Te||!Te.packetSize){const ze=String(ne.unit||"").trim();if(fe.forceWeightBased||fe.defaultWeightWhenUnitEmpty&&!ze){const Ft=jx(ne.quantity,Qe.purchaseCost,ne.unit,{...fe,yieldRate:Xe}),Nn=Number.isFinite(Ft)?Math.round(Ft*100)/100:NaN,Et=Us(Qe.cost);if(Number.isFinite(Nn)&&(!Number.isFinite(Et)||Math.abs(Et-Nn)>.01))return{...Qe,cost:Nn}}return Qe}const Ue=[Te.lastPrice,ne.purchaseCostRef,ne.purchase_cost,ne.purchaseCost].find(ze=>Number.isFinite(Us(ze))),Ve=ME(Ue,Te.packetSize,Te.packetUnit);if(!Number.isFinite(Ve)||!zE(ne,Ve))return Qe;const _t=jx(ne.quantity,Ve,ne.unit,{...fe,yieldRate:Xe});return{...Qe,purchaseCost:Math.round(Ve*100)/100,cost:Number.isFinite(_t)?Math.round(_t*100)/100:Qe.cost}};return{...W,ingredients:(W.ingredients||[]).map(ne=>re(ne)),flours:(W.flours||[]).map(ne=>re(ne,{forceWeightBased:!0})),breadIngredients:(W.breadIngredients||[]).map(ne=>re(ne,{forceWeightBased:!0}))}},[ue,W]);we.useEffect(()=>{Be(n),!n.steps&&!d&&(Ge(!0),bn.getRecipe(n.id).then(re=>{Be(re)}).catch(re=>{console.error("Failed to load details",re)}).finally(()=>{Ge(!1)}))},[n,d]);const[$e,rt]=we.useState(n.tags?.includes("public")||!1),mt=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),Dt=!(n.tags&&n.tags.some(re=>re.startsWith("owner:")))||mt,Vt=async()=>{const re=!$e;try{const ne=n.tags||[];let fe;re?fe=[...ne,"public"]:fe=ne.filter(Te=>Te!=="public"),rt(re),await bn.updateRecipe({id:n.id,tags:fe})}catch(ne){console.error("Failed to toggle public",ne),x.error(""),rt(!re)}},St=(re,ne,fe=!1)=>G==="ORIGINAL"||!L||!ne||re===ne?re:i.jsxs(i.Fragment,{children:[re,fe?i.jsx("br",{}):" ",i.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",ne,")"]})]}),oe=async re=>{const ne=re.target.value;if(q(ne),ne!=="ORIGINAL"&&!F[ne]){P(!0);try{const fe=await uE.translateRecipe(n,ne);K(Te=>({...Te,[ne]:fe}))}catch(fe){console.error(fe),x.error(""),q("ORIGINAL")}finally{P(!1)}}},_e=re=>{$(ne=>{const fe=new Set(ne);return fe.has(re)?fe.delete(re):fe.add(re),fe})},Ne=re=>{C(ne=>{const fe=new Set(ne);return fe.has(re)?fe.delete(re):fe.add(re),fe})},Ie=re=>{T(ne=>{const fe=new Set(ne);return fe.has(re)?fe.delete(re):fe.add(re),fe})};we.useEffect(()=>{window.scrollTo(0,0),h&&n&&!d&&h(n.id);const re=document.title;return n&&n.title&&(document.title=n.title),K({}),q("ORIGINAL"),$(new Set),C(new Set),T(new Set),rt(n.tags?.includes("public")||!1),()=>{document.title=re}},[n.id,n.title]),we.useEffect(()=>{n&&n.servings?A(n.servings.toString()):A(""),ve("")},[n]);const it=()=>{_(!0)},ut=()=>{_(!1),o(n)},kt=()=>{_(!1)},Jt=()=>{O(!0)},Sn=()=>{O(!1),u(n)},jt=()=>{O(!1)},rn=()=>{j(!0)},cn=async()=>{j(!1);try{const re=await bn.duplicateRecipe(n,v);f&&f(re)}catch(re){console.error("Duplication failed",re),x.error("")}},xn=()=>{j(!1)},Ln=we.useRef(null),ar=we.useRef(null),me=re=>{ar.current=null,Ln.current=re.targetTouches[0].clientX},Ke=re=>{ar.current=re.targetTouches[0].clientX},Ze=()=>{if(!Ln.current||!ar.current)return;const re=Ln.current-ar.current,ne=Ln.current<50,fe=re<-100;ne&&fe&&s()},Ye=re=>{const ne=Math.round(parseFloat(re)),fe=parseFloat(Me),Te=parseFloat(ae);let Pe=null,Xe=null,Qe=null;return!isNaN(ne)&&!isNaN(Te)&&Te>0&&(Qe=ne/Te),!isNaN(ne)&&!isNaN(fe)&&!isNaN(Te)&&fe>0&&Te>0&&(Xe=fe*Te,Pe=ne/Xe*100),i.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[i.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("span",{children:["  ",i.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),i.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),i.jsx("input",{type:"number",value:Me,onChange:H=>ve(H.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),i.jsx("input",{type:"number",value:ae,onChange:H=>A(H.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Qe!==null&&i.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Pe!==null?Pe>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Pe!==null?Pe>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Pe!==null?"6px":"0"},children:["1(): ",i.jsxs("strong",{children:["",Qe.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Pe!==null&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",Xe.toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(Xe-ne).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Pe>40?"#d32f2f":"#2e7d32"},children:[": ",Pe.toFixed(1),"%"]})]})]})]})]})},tt=Ce.ingredients||[];let Mt=W.steps||[];const xt=re=>String(re||"").trim().toLowerCase(),Rt=re=>{const ne=xt(re);return ne?["","","steps","method"].some(fe=>ne===fe||ne.includes(fe)):!1};if(!Mt.length&&W.ingredientGroups){const re=W.ingredientGroups.find(ne=>Rt(ne.name));if(re)Mt=tt.filter(fe=>fe.groupId===re.id).map(fe=>typeof fe=="string"?fe:{...fe,text:fe.name||fe.text||""});else{const ne=tt.filter(fe=>Rt(fe.group)||Rt(fe.groupName));ne.length&&(Mt=ne.map(fe=>typeof fe=="string"?fe:{...fe,text:fe.name||fe.text||""}))}}const et=Mt,Bt=we.useMemo(()=>{const re=W.ingredientGroups||[],ne=["","steps","method",""],fe=H=>String(H||"").trim().toLowerCase(),Te=new Set(re.filter(H=>ne.includes(fe(H.name))).map(H=>H.id)),Pe=re.filter(H=>!Te.has(H.id));if(!Pe.length)return[{id:"default",name:null,items:tt.filter(H=>!Te.has(H.groupId))}];const Xe=Pe.map(H=>{const Ue=tt.filter(Ve=>Ve.groupId===H.id);return{id:H.id,name:H.name===""?null:H.name,items:Ue}}).filter(H=>H.items.length>0),Qe=tt.filter(H=>H.groupId?Te.has(H.groupId)?!1:!Pe.some(Ue=>Ue.id===H.groupId):!0);return Qe.length&&Xe.push({id:"ungrouped",name:null,items:Qe}),Xe.length?Xe:[{id:"default",name:null,items:tt.filter(H=>!Te.has(H.groupId))}]},[W.ingredientGroups,tt]),We=we.useMemo(()=>{if(W.type!=="bread")return null;const re=Ce.flours||[],ne=Ce.breadIngredients||[],fe=re.reduce((ze,ht)=>ze+(parseFloat(ht.quantity)||0),0),Te=fe+ne.reduce((ze,ht)=>ze+(parseFloat(ht.quantity)||0),0),Pe=parseFloat(B),Xe=Pe&&Te?Pe/Te:1,Qe=ze=>fe?((parseFloat(ze)||0)/fe*100).toFixed(1):"0.0",H=ze=>Pe?((parseFloat(ze)||0)*Xe).toFixed(1):ze,Ue=ze=>{const ht=parseFloat(ze)||0;if(!Pe)return ht;const Ft=ht*Xe;return Math.round(Ft*100)/100},Ve=ze=>{const ht=Ue(ze);return Number.isFinite(ht)?ht.toLocaleString(void 0,{maximumFractionDigits:2}):""},_t=ze=>ze.reduce((ht,Ft)=>{const Et=(parseFloat(Ft.cost)||0)*(Pe?Xe:1),Vn=Bi(Ft);return ht+Et*Vn},0);return{flours:re,others:ne,totalFlour:fe,grandTotal:Te,calcPercent:Qe,getScaledQtyValue:H,getScaledCostValue:Ue,formatCostValue:Ve,scaleFactor:Xe,totalTaxIncluded:_t(re)+_t(ne)}},[Ce.breadIngredients,Ce.flours,W.type,B]),Ut=we.useMemo(()=>W.type==="bread"?0:tt.reduce((re,ne)=>{const Te=(parseFloat(ne.cost)||0)*X,Pe=Bi(ne);return re+Te*Pe},0),[W.type,tt,X]),Xt=W.type==="bread"?We?Math.round(We.totalTaxIncluded).toLocaleString():"0":Math.round(Ut).toLocaleString(),Qt=W.description||n.description;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:me,onTouchMove:Ke,onTouchEnd:Ze,children:[N&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(se,{variant:"ghost",onClick:xn,children:""}),i.jsx(se,{variant:"primary",onClick:cn,children:""})]})]})}),E&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(se,{variant:"ghost",onClick:jt,children:""}),i.jsx(se,{variant:"danger",onClick:Sn,children:""})]})]})}),w&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("small",{style:{color:"#666"},children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(se,{variant:"ghost",onClick:kt,children:""}),i.jsx(se,{variant:"danger",onClick:ut,children:""})]})]})}),i.jsxs("div",{className:"recipe-detail__header",children:[i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx(se,{variant:"secondary",onClick:s,size:"sm",children:m||" "}),y&&i.jsx(se,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&i.jsxs("div",{className:"recipe-detail__actions",children:[Dt&&(v?.displayId==="yoshito"||v?.role==="admin")&&i.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:i.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:$e,onChange:Vt,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),i.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:$e?"#4CAF50":"#888"},children:$e?"":""})]})}),!Dt&&i.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),i.jsxs("select",{className:"language-select",value:G,onChange:oe,disabled:V,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[i.jsx("option",{value:"ORIGINAL",children:" Original ()"}),yE.map(re=>i.jsx("option",{value:re.code,children:re.label},re.code))]}),G!=="ORIGINAL"&&i.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[i.jsx("input",{type:"checkbox",checked:L,onChange:re=>R(re.target.checked),style:{marginRight:"4px"}}),""]}),i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>Y(!0),children:" "}),i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),i.jsx(se,{variant:"secondary",size:"sm",onClick:rn,children:""}),Dt&&i.jsxs(i.Fragment,{children:[i.jsx(se,{variant:"secondary",size:"sm",onClick:l,children:""}),i.jsx(se,{variant:"danger",size:"sm",onClick:it,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&i.jsxs("div",{className:"recipe-detail__actions",children:[i.jsx(se,{variant:"ghost",size:"sm",onClick:Jt,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),i.jsx(se,{variant:"primary",size:"sm",onClick:()=>o(n,!0),children:""})]})]}),i.jsx("div",{className:"recipe-detail__hero",children:W.image?i.jsx("img",{src:W.image,alt:W.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),i.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[i.jsx("h1",{children:St(W.title,n.title)}),i.jsx("p",{className:"recipe-detail__desc",children:St(W.description,n.description,!0)}),v?.role==="admin"&&t&&i.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),i.jsxs("div",{className:"recipe-detail__meta",children:[W.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:St(W.course,n.course)})]}),W.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:St(W.category,n.category)})]}),W.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:St(W.storeName,n.storeName)})]}),i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[W.servings,""]})]})]}),W.sourceUrl&&i.jsxs("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsx("div",{style:{fontSize:"0.85rem"},children:i.jsxs("a",{href:W.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",i.jsx("span",{className:"screen-only",children:""}),i.jsx("span",{className:"print-only",children:""})]})}),i.jsx("div",{style:{background:"white",padding:"4px",width:"fit-content"},children:i.jsx(TE,{value:W.sourceUrl,size:128,style:{display:"block"}})})]})]}),i.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[i.jsxs("span",{children:[" : ",wx(n.created_at)]}),n.updated_at&&i.jsxs("span",{children:[" : ",wx(n.updated_at)]})]}),i.jsx("div",{className:"recipe-detail__content",children:i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),i.jsx(tn,{className:"ingredients-card",children:W.type==="bread"?i.jsx("div",{className:"bread-detail-view",children:(()=>{const re=Ce.flours||[],ne=Ce.breadIngredients||[],fe=re.reduce((ze,ht)=>ze+(parseFloat(ht.quantity)||0),0),Te=fe+ne.reduce((ze,ht)=>ze+(parseFloat(ht.quantity)||0),0),Pe=fe?(Te/fe*100).toFixed(1):"0.0",Xe=ze=>fe?((parseFloat(ze)||0)/fe*100).toFixed(1):"0.0",Qe=parseFloat(B),H=Qe&&Te?Qe/Te:1,Ue=ze=>Qe?((parseFloat(ze)||0)*H).toFixed(1):ze,Ve=ze=>{const ht=parseFloat(ze)||0;if(!Qe)return ht;const Ft=ht*H;return Math.round(Ft*100)/100},_t=ze=>Number.isFinite(ze)?ze.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[Te.toLocaleString(),"g"]}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Pe,"%)"]})]}),i.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("input",{id:"target-total-input",type:"number",value:B,onChange:ze=>J(ze.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),i.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),B&&i.jsx(se,{variant:"ghost",size:"sm",onClick:()=>J(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),B&&i.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",H.toFixed(3)," "]})]}),i.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[i.jsx("span",{children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",B?Ue(fe):fe,"g (100%)"]})]}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:re.map((ze,ht)=>{const Ft=n.flours?.[ht]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`flour-${ht}`}),i.jsx("label",{htmlFor:`flour-${ht}`,children:St(ze.name,Ft?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:B?i.jsx("span",{style:{color:"var(--color-primary)"},children:Ue(ze.quantity)}):ze.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[Xe(ze.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:as(ze.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:ze.cost?`${_t(Ve(ze.cost))}`:"-"})]},ht)})})]})]}),i.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[i.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:ne.map((ze,ht)=>{const Ft=n.breadIngredients?.[ht]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ingredient-${ht}`}),i.jsx("label",{htmlFor:`ingredient-${ht}`,children:St(ze.name,Ft?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:B?i.jsx("span",{style:{color:"var(--color-primary)"},children:Ue(ze.quantity)}):ze.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[Xe(ze.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:as(ze.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:ze.cost?`${_t(Ve(ze.cost))}`:"-"})]},ht)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const ze=Ft=>Ft.reduce((Nn,Et)=>{const Vn=parseFloat(Et.cost)||0,sn=Bi(Et),Nt=Vn*H;return Nn+Nt*sn},0),ht=ze(re)+ze(ne);return Math.round(ht).toLocaleString()})()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const ze=Ft=>Ft.reduce((Nn,Et)=>{const Vn=parseFloat(Et.cost)||0,sn=Bi(Et),Nt=Vn*H;return Nn+Nt*sn},0),ht=ze(re)+ze(ne);return Ye(ht)})()]})]})})()}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[i.jsx("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:":"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),i.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:Z,onChange:re=>ge(re.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(Z)!==1&&i.jsx(se,{variant:"ghost",size:"sm",onClick:()=>ge("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const re=W.ingredientGroups&&W.ingredientGroups.length>0?W.ingredientGroups:null;return re?re.map(ne=>{const fe=tt.filter(Te=>Te.groupId===ne.id);return fe.length===0||["","Steps","Method",""].includes(ne.name)?null:i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(ne.name)?"none":"block"},children:ne.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:fe.map((Te,Pe)=>{const Xe=tt.indexOf(Te),Qe=n.ingredients?.[Xe],H=typeof Te=="string"?Te:Te.name,Ue=Qe?typeof Qe=="string"?Qe:Qe.name:"",Ve=ce(Te.quantity,Z),_t=Se(Te.cost,Z),ze=String(Z)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${ne.id}-${Pe}`}),i.jsx("label",{htmlFor:`ing-${ne.id}-${Pe}`,children:St(H,Ue)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:ze?"bold":"normal",color:ze?"var(--color-primary)":"inherit"},children:Ve}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:Te.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:as(Te.purchaseCost)??"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[as(_t)??"-",np(Te)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Pe)})})]})]},ne.id)}):i.jsxs(i.Fragment,{children:[i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:tt.map((ne,fe)=>{const Te=n.ingredients?.[fe],Pe=typeof ne=="string"?ne:ne.name,Xe=Te?typeof Te=="string"?Te:Te.name:"",Qe=ce(ne.quantity,Z),H=Se(ne.cost,Z),Ue=String(Z)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${fe}`}),i.jsx("label",{htmlFor:`ing-${fe}`,children:St(Pe,Xe)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Ue?"bold":"normal",color:Ue?"var(--color-primary)":"inherit"},children:Qe}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:ne.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:as(ne.purchaseCost)??"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[as(H)??"-",np(ne)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},fe)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((fe=>fe.reduce((Te,Pe)=>{const Xe=parseFloat(Pe.cost)||0,Qe=Bi(Pe),H=Se(Xe,Z),Ue=parseFloat(H)||0;return Te+Ue*Qe},0))(tt)).toLocaleString()]})]})]})})(),i.jsx("div",{className:"screen-only no-print",children:i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((ne=>ne.reduce((fe,Te)=>{const Pe=parseFloat(Te.cost)||0,Xe=Bi(Te),Qe=Se(Pe,Z),H=parseFloat(Qe)||0;return fe+H*Xe},0))(tt)).toLocaleString()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]})}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const ne=(fe=>fe.reduce((Te,Pe)=>{const Xe=parseFloat(Pe.cost)||0,Qe=Bi(Pe),H=parseFloat(Se(Xe,Z))||0;return Te+H*Qe},0))(tt);return Ye(ne)})()]})})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),(()=>{const re=W.stepGroups&&W.stepGroups.length>0?W.stepGroups:null,ne=re&&et.some(fe=>!fe||typeof fe!="object"||!fe.groupId?!1:re.some(Te=>Te.id===fe.groupId));return re&&ne?i.jsx("div",{className:"steps-container",children:re.map(fe=>{const Te=et.filter(Pe=>(typeof Pe=="object"?Pe.groupId:null)===fe.id);return Te.length===0?null:i.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[fe.name!==""&&fe.name!=="Steps"&&i.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:fe.name}),i.jsx("div",{className:"steps-list",children:Te.map((Pe,Xe)=>{const Qe=et.indexOf(Pe),H=typeof Pe=="object"?Pe.text:Pe,Ue=n.steps?.[Qe],Ve=typeof Ue=="object"?Ue.text:Ue,_t=ze=>ze?ze.replace(/<[^>]*>?/gm,""):"";return i.jsxs(tn,{className:`step-card ${D.has(Qe)?"is-completed":""}`,onClick:()=>_e(Qe),children:[i.jsx("div",{className:"step-number",children:Qe+1}),i.jsx("p",{className:"step-text",children:St(_t(H),_t(Ve),!0)})]},Xe)})})]},fe.id)})}):i.jsx("div",{className:"steps-list",children:et.map((fe,Te)=>{const Pe=typeof fe=="object"?fe.text:fe,Xe=n.steps?.[Te],Qe=typeof Xe=="object"?Xe.text:Xe;return i.jsxs(tn,{className:`step-card ${D.has(Te)?"is-completed":""}`,onClick:()=>_e(Te),children:[i.jsx("div",{className:"step-number",children:Te+1}),i.jsx("p",{className:"step-text",children:St(Pe,Qe,!0)})]},Te)})})})()]})]})}),i.jsx(yn,{isOpen:I,onClose:()=>Y(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-recipe",children:[i.jsx("div",{className:"preview-header",children:i.jsx("h2",{children:W.title})}),i.jsxs("div",{className:"preview-meta",children:[W.course&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",W.course]}),W.category&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",W.category]}),W.storeName&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",W.storeName]}),W.servings&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",W.servings,""]})]}),W.description&&i.jsx("div",{className:"preview-description",children:i.jsx("p",{children:W.description})}),i.jsx("div",{className:"preview-controls",children:W.type==="bread"?i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),i.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:B,onChange:re=>J(re.target.value),placeholder:"1000"}),B&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>J(""),children:""}),We?.grandTotal?i.jsxs("span",{className:"preview-control-note",children:[": ",We.grandTotal.toLocaleString(),"g"]}):null]}):i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:""}),i.jsx("span",{className:"preview-control-mult",children:""}),i.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:Z,onChange:re=>ge(re.target.value),placeholder:"1"}),String(Z)!=="1"&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>ge("1"),children:""})]})}),i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),W.type==="bread"?i.jsxs("div",{className:"preview-ingredients-bread",children:[i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Ce.flours||[]).map((re,ne)=>{const fe=`flour-${ne}`,Te=We?We.getScaledQtyValue(re.quantity):re.quantity;return i.jsxs("tr",{className:M.has(fe)?"is-completed":"",onClick:()=>Ie(fe),role:"button",tabIndex:0,onKeyDown:Pe=>{(Pe.key==="Enter"||Pe.key===" ")&&(Pe.preventDefault(),Ie(fe))},children:[i.jsx("td",{children:re.name}),i.jsxs("td",{style:{textAlign:"right"},children:[Te,"g"]})]},ne)})})]})]}),i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Ce.breadIngredients||[]).map((re,ne)=>{const fe=`bread-${ne}`,Te=We?We.getScaledQtyValue(re.quantity):re.quantity;return i.jsxs("tr",{className:M.has(fe)?"is-completed":"",onClick:()=>Ie(fe),role:"button",tabIndex:0,onKeyDown:Pe=>{(Pe.key==="Enter"||Pe.key===" ")&&(Pe.preventDefault(),Ie(fe))},children:[i.jsx("td",{children:re.name}),i.jsxs("td",{style:{textAlign:"right"},children:[Te,"g"]})]},ne)})})]})]})]}):i.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const re=W.ingredientGroups&&W.ingredientGroups.length>0?W.ingredientGroups:null;return re?re.map(ne=>{const fe=tt.filter(Te=>Te.groupId===ne.id);return fe.length===0||["","Steps","Method",""].includes(ne.name)?null:i.jsxs("div",{className:"ingredient-group",children:[i.jsx("h4",{children:ne.name}),i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:fe.map((Te,Pe)=>{const Xe=`${ne.id}-${Pe}`,Qe=typeof Te=="string"?Te:Te.name,H=typeof Te=="object"?ce(Te.quantity,X):"",Ue=typeof Te=="object"?Te.unit:"";return i.jsxs("tr",{className:M.has(Xe)?"is-completed":"",onClick:()=>Ie(Xe),role:"button",tabIndex:0,onKeyDown:Ve=>{(Ve.key==="Enter"||Ve.key===" ")&&(Ve.preventDefault(),Ie(Xe))},children:[i.jsx("td",{children:Qe}),i.jsx("td",{style:{textAlign:"right"},children:H}),i.jsx("td",{children:Ue})]},Pe)})})]})]},ne.id)}):i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:tt.map((ne,fe)=>{const Te=`ungrouped-${fe}`,Pe=typeof ne=="string"?ne:ne.name,Xe=typeof ne=="object"?ce(ne.quantity,X):"",Qe=typeof ne=="object"?ne.unit:"";return i.jsxs("tr",{className:M.has(Te)?"is-completed":"",onClick:()=>Ie(Te),role:"button",tabIndex:0,onKeyDown:H=>{(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),Ie(Te))},children:[i.jsx("td",{children:Pe}),i.jsx("td",{style:{textAlign:"right"},children:Xe}),i.jsx("td",{children:Qe})]},fe)})})]})})()})]}),et.length>0&&i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),i.jsx("ol",{className:"preview-steps",children:et.map((re,ne)=>{const fe=typeof re=="object"?re.text:re;return i.jsx("li",{className:z.has(ne)?"is-completed":"",onClick:()=>Ne(ne),role:"button",tabIndex:0,onKeyDown:Te=>{(Te.key==="Enter"||Te.key===" ")&&(Te.preventDefault(),Ne(ne))},children:fe},ne)})})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(se,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(se,{variant:"ghost",onClick:()=>Y(!1),children:""})]})]})})]}),i.jsxs("div",{className:"print-layout",children:[i.jsx("div",{className:"recipe-detail__hero",children:W.image?i.jsx("img",{src:W.image,alt:W.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),i.jsxs("div",{className:"recipe-detail__title-card",children:[i.jsx("h1",{children:W.title}),Qt&&i.jsx("p",{className:"recipe-detail__desc",children:Qt})]}),i.jsxs("div",{className:"recipe-detail__meta",children:[W.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:W.category})]}),W.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value meta-value--store",children:W.storeName})]}),W.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:W.course})]}),W.servings&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[W.servings,""]})]})]}),i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),W.type==="bread"&&We?i.jsxs("div",{children:[i.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:We.flours.map((re,ne)=>i.jsxs("tr",{children:[i.jsx("td",{children:re.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:We.getScaledQtyValue(re.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[We.calcPercent(re.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:as(re.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:re.cost?`${We.formatCostValue(re.cost)}`:"-"})]},`print-flour-${ne}`))})]})]}),i.jsxs("div",{className:"bread-section",children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:We.others.map((re,ne)=>i.jsxs("tr",{children:[i.jsx("td",{children:re.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:We.getScaledQtyValue(re.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[We.calcPercent(re.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:as(re.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:re.cost?`${We.formatCostValue(re.cost)}`:"-"})]},`print-others-${ne}`))})]})]})]}):Bt.map(re=>i.jsxs("div",{style:{marginBottom:"1.2rem"},children:[re.name&&i.jsx("div",{className:"print-group-heading",children:re.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:re.items.map((ne,fe)=>{const Te=typeof ne=="object"?ne.quantity:"",Pe=typeof ne=="object"?ne.unit:"",Xe=typeof ne=="object"?ne.purchaseCost:null,Qe=typeof ne=="object"?ne.cost:null,H=typeof ne=="string"?ne:ne.name,Ue=typeof ne=="object"?ce(ne.quantity,X):Te;return i.jsxs("tr",{children:[i.jsx("td",{children:H}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:Ue}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:Pe}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:as(Xe)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:as(Qe)??"-"})]},`print-ing-${re.id}-${fe}`)})})]})]},re.id)),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Xt]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),et.length>0?i.jsx("div",{className:"steps-list",children:et.map((re,ne)=>{const fe=typeof re=="object"?re.text:re;return i.jsxs("div",{className:"step-card",children:[i.jsx("div",{className:"step-number",children:ne+1}),i.jsx("p",{className:"step-text",children:fe})]},`print-step-${ne}`)})}):i.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:""})]})]})]})]})},ob=n=>{if(n==null)return"";let t=String(n);return t=t.replace(/[-]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[--]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},zt=({label:n,id:t,error:s,textarea:l,...o})=>{const u=l?"textarea":"input",d=o.type==="number"||o.inputMode==="decimal"||o.inputMode==="numeric",h=f=>{if(!o.onChange)return;if(!d){o.onChange(f);return}const m=f?.target?.value??"",y=ob(m);if(y===m){o.onChange(f);return}o.onChange({target:{id:f?.target?.id,name:f?.target?.name,value:y}})};return i.jsxs("div",{className:`input-group ${s?"input-group--error":""} ${o.wrapperClassName||""}`,children:[n&&i.jsx("label",{htmlFor:t,className:"input-label",children:n}),i.jsx(u,{id:t,className:`input-field ${o.className||""}`,style:o.style,...o,onChange:h}),s&&i.jsx("span",{className:"input-error",children:s})]})},ls="app-data",nr={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const s=String(t||"").replace(/^\/+/,"");return`${n}/${s}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:s}=await Re.storage.from(ls).list(n);if(s)return console.warn("Failed to list price files:",s.message),[];if(!t||t.length===0)return[];const l=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:h,error:f}=await Re.storage.from(ls).download(d);if(f)return console.error(`Failed to download ${u.name}:`,f),null;const m=await h.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(m)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(m)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(l)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._cacheByUserId.get(t);if(s)return s;try{const l=new Map,o=await this._downloadAllCsvTexts(t);if(!o||o.length===0)return new Map;for(const{text:u}of o){if(!u)continue;const d=this.parseCSV(u);for(const[h,f]of d)if(l.has(h)){const m=l.get(h);(f?.dateStr||"")>(m?.dateStr||"")&&l.set(h,f)}else l.set(h,f)}return this._cacheByUserId.set(t,l),l}catch(l){return console.error("Error in fetchPriceList:",l),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:s,error:l}=await Re.storage.from(ls).list(t);if(l)throw l;return s.filter(o=>String(o?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=n.name;this.clearCache(s);const o=this._getUserScopedPath(s,l),{data:u,error:d}=await Re.storage.from(ls).upload(o,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(s){return console.error("Error uploading price list:",s),{success:!1,error:s}}},async deletePriceFile(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");this.clearCache(s);const l=this._getUserScopedPath(s,n),{data:o,error:u}=await Re.storage.from(ls).remove([l]);if(u)throw u;if(!o||o.length===0)throw new Error("");return{success:!0,data:o}}catch(s){return console.error("Error deleting price file:",s),{success:!1,error:s}}},_splitFileName(n){const t=String(n||""),s=t.lastIndexOf(".");return s<=0?{base:t,ext:""}:{base:t.slice(0,s),ext:t.slice(s)}},_makeCopyFileName(n,t){const s=String(n||"");if(!t?.has?.(s))return s;const{base:l,ext:o}=this._splitFileName(s),u=l||s||"price";let d=1;for(;d<1e3;){const h=d===1?"_copy":`_copy${d}`,f=`${u}${h}${o}`;if(!t.has(f))return f;d++}return`${u}_copy_${Date.now()}${o}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:t=null,onProgress:s=null}={}){const l=t||await this._getCurrentUserId();if(!l)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("");if(o===l)throw new Error("");const{data:u,error:d}=await Re.storage.from(ls).list(l);if(d)throw d;const h=(u||[]).map(w=>w?.name).filter(Boolean).filter(w=>String(w).toLowerCase().endsWith(".csv")),{data:f,error:m}=await Re.storage.from(ls).list(o);let y=new Set;if(m){const w=String(m?.message||"").toLowerCase();if(w.includes("not found")||w.includes("404"))y=new Set;else throw m}else y=new Set((f||[]).map(w=>w?.name).filter(Boolean));const v={sourceUserId:l,targetUserId:o,copied:[],skipped:[],failed:[]},x=h.length;s?.({phase:"start",total:x,done:0,current:""});for(let w=0;w<h.length;w++){const _=h[w],N=this._makeCopyFileName(_,y);y.add(N);const j=this._getUserScopedPath(l,_),E=this._getUserScopedPath(o,N);s?.({phase:"progress",total:x,done:w,current:`${_}  ${N}`,fromFile:_,toFile:N});try{const{data:O,error:D}=await Re.storage.from(ls).download(j);if(D)throw D;if(!O)throw new Error("");const{error:$}=await Re.storage.from(ls).upload(E,O,{upsert:!1,contentType:"text/csv"});if($){const z=String($?.message||"").toLowerCase();if(z.includes("already exists")||z.includes("exists")||z.includes("409")){let C=0,M=$;for(;C<5;){C++;const T=this._makeCopyFileName(_,y);y.add(T);const F=this._getUserScopedPath(o,T),{error:K}=await Re.storage.from(ls).upload(F,O,{upsert:!1,contentType:"text/csv"});if(!K){v.copied.push({fromFile:_,toFile:T}),M=null;break}M=K}if(M)throw M;continue}throw $}v.copied.push({fromFile:_,toFile:N})}catch(O){console.error("copyPriceFilesToUser failed:",O),v.failed.push({file:_,errorMessage:String(O?.message||O)})}s?.({phase:"progress",total:x,done:w+1,current:`${_}  ${N}`,fromFile:_,toFile:N})}return s?.({phase:"done",total:x,done:x,current:"",result:v}),this.clearCache(o),v},parseCSV(n){const t=new Map,s=n.split(/\r?\n/).filter(o=>o.trim());if(s.length===0)return t;if(s.some(o=>o.startsWith("D,")||o.startsWith('"D",')))for(let o of s){const u=[];let d="",h=!1;for(let j=0;j<o.length;j++){const E=o[j];E==='"'?h=!h:E===","&&!h?(u.push(d),d=""):d+=E}u.push(d);const f=u.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j));if(f[0]!=="D")continue;const m=f[1],y=f[8],v=f[14],x=f[18],w=f[20],_=String(v??"").trim(),N=nn(_);if(N&&x){const j=parseFloat(x);if(!isNaN(j)){const E={price:j,vendor:y,unit:w,dateStr:m,displayName:_};if(t.has(N)){const O=t.get(N);(m||"")>=(O?.dateStr||"")&&t.set(N,E)}else t.set(N,E)}}}else{let o={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(s[0].split(",").map(f=>f.trim().replace(/^"|"$/g,"")).forEach((f,m)=>{["","","","","name","item"].some(y=>f.includes(y))&&(o.name=m),["","","","","price","cost"].some(y=>f.includes(y))&&(o.price=m),["","unit"].some(y=>f.includes(y))&&(o.unit=m),["","","","vendor","supplier"].some(y=>f.includes(y))&&(o.vendor=m)}),o.name===-1&&o.price===-1){o={name:0,price:1,unit:2,vendor:3};const f=s[0].split(",");isNaN(parseFloat(f[1]))&&(u=1)}else u=1;const h=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let f=u;f<s.length;f++){const m=s[f],y=[];let v="",x=!1;for(let $=0;$<m.length;$++){const z=m[$];z==='"'?x=!x:z===","&&!x?(y.push(v),v=""):v+=z}y.push(v);const w=y.map($=>($=$.trim(),$.startsWith('"')&&$.endsWith('"')?$.slice(1,-1):$)),_=o.name>-1?w[o.name]:null,N=o.price>-1?w[o.price]:null,j=o.unit>-1?w[o.unit]:"",E=o.vendor>-1?w[o.vendor]:"",O=String(_??"").trim(),D=nn(O);if(D&&N){const $=parseFloat(N.replace(/[^0-9.]/g,""));isNaN($)||t.set(D,{price:$,vendor:E,unit:j,dateStr:h,displayName:O})}}}return t},parseCSVEntries(n,t=""){const s=[],l=n.split(/\r?\n/).filter(x=>x.trim());if(l.length===0)return s;const o=x=>{const w=String(x??"").trim();if(!w)return null;const _=parseFloat(w.replace(/[^0-9.]/g,""));return Number.isFinite(_)?_:null},u=x=>{const w=[];let _="",N=!1;for(let j=0;j<x.length;j++){const E=x[j];E==='"'?N=!N:E===","&&!N?(w.push(_),_=""):_+=E}return w.push(_),w.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j))},d=x=>{const w=String(x??"").trim();if(!w)return"";const _=w.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(_)return`${_[1]}/${String(_[2]).padStart(2,"0")}/${String(_[3]).padStart(2,"0")}`;const N=w.match(/^(\d{4})(\d{2})(\d{2})$/);return N?`${N[1]}/${N[2]}/${N[3]}`:w};if(l.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of l){const w=u(x);if(w[0]!=="D")continue;const _=d(w[1]),N=w[8],j=w[14],E=w[18],O=o(w[19]),D=w[20],$=String(j??"").trim(),z=nn($);if(!z||!E)continue;const C=o(E);Number.isFinite(C)&&s.push({key:z,displayName:$,price:C,vendor:N,unit:D,dateStr:_,incomingQty:O,sourceFile:t})}return s}let f={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},m=0;if(l[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,w)=>{const _=String(x||"").toLowerCase();["","","","","name","item"].some(N=>_.includes(N))&&(f.name=w),["","","","","price","cost"].some(N=>_.includes(N))&&(f.price=w),["","unit"].some(N=>_.includes(N))&&(f.unit=w),["","","","vendor","supplier"].some(N=>_.includes(N))&&(f.vendor=w),["","","","date"].some(N=>_.includes(N))&&(f.date=w),["","","","","","qty","quantity"].some(N=>_.includes(N))&&(f.quantity=w)}),f.name===-1&&f.price===-1){f={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=l[0].split(",");isNaN(parseFloat(x[1]))&&(m=1)}else m=1;const v=d(new Date().toISOString().slice(0,10));for(let x=m;x<l.length;x++){const w=u(l[x]),_=f.name>-1?w[f.name]:null,N=f.price>-1?w[f.price]:null,j=f.unit>-1?w[f.unit]:"",E=f.vendor>-1?w[f.vendor]:"",O=f.date>-1?w[f.date]:"",D=f.quantity>-1?o(w[f.quantity]):null,$=String(_??"").trim(),z=nn($);if(!z||!N)continue;const C=o(N);Number.isFinite(C)&&s.push({key:z,displayName:$,price:C,vendor:E,unit:j,dateStr:d(O)||v,incomingQty:D,sourceFile:t})}return s},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._historyCacheByUserId.get(t);if(s)return s;try{const l=await this._downloadAllCsvTexts(t);if(!l||l.length===0)return new Map;const o=new Map;for(const{fileName:u,text:d}of l){if(!d)continue;this.parseCSVEntries(d,u).forEach(f=>{const m=f?.key;m&&(o.has(m)||o.set(m,[]),o.get(m).push(f))})}for(const u of o.values())u.sort((d,h)=>{const f=String(d?.dateStr||""),m=String(h?.dateStr||"");if(f!==m)return f.localeCompare(m);const y=Number(d?.price),v=Number(h?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(h?.sourceFile||""))});return this._historyCacheByUserId.set(t,o),o}catch(l){return console.error("Error in fetchPriceHistory:",l),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),s=[];for(const[l,o]of t.entries())if(o&&typeof o=="object"){const{displayName:u,...d}=o;s.push({name:u||l,...d})}else s.push({name:l,price:o});return s.sort((l,o)=>l.dateStr&&o.dateStr?o.dateStr.localeCompare(l.dateStr):l.name.localeCompare(o.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(nn(n))||null}},Oo={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:s}=await Re.rpc("search_ingredients",{search_query:n,max_results:15});return s?(console.warn(" Database search failed:",s),console.warn("Error message:",s.message),console.warn("Error code:",s.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){const t=String(n||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const s=t.toLowerCase(),l=nn(t);try{const o=await this._searchFromDatabase(s);if(o&&Array.isArray(o)){this._lastDbResults=o,this._lastDbQuery=s;const d=o.map(j=>({name:j.ingredient_name,price:j.last_price,size:j.packet_size,unit:j.packet_unit,itemCategory:j.item_category||null,source:"manual",displaySource:" "}));if(d.length===0)return await this._fallbackSearch(s);if(!this._csvCache){const j=await nr.getPriceListArray();this._csvCache=j.map(E=>({name:E.name,price:E.price,size:null,unit:E.unit,source:"csv",displaySource:" CSV"}))}const h=j=>{if(!l)return null;const E=String(j||"").indexOf(l);return E<0?null:{tier:j===l?0:E===0?1:2,idx:E,len:String(j||"").length}},f=(j,E)=>j.score.tier!==E.score.tier?j.score.tier-E.score.tier:j.score.idx!==E.score.idx?j.score.idx-E.score.idx:j.score.len!==E.score.len?j.score.len-E.score.len:j.name.localeCompare(E.name,"ja"),m=(j,E,O)=>{let D=0;for(;D<j.length&&f(j[D],E)<=0;)D++;j.splice(D,0,E),j.length>O&&j.pop()},v=Math.max(0,15-d.length),x=new Set(d.map(j=>nn(j.name))),w=[],_=new Set;if(v>0)for(const j of this._csvCache){const E=nn(j?.name);if(!E||x.has(E)||_.has(E))continue;const O=h(E);O&&(_.add(E),m(w,{...j,nameKey:E,score:O},v))}const N=w.map(j=>({name:j.name,price:j.price,size:j.size,unit:j.unit,source:j.source,displaySource:j.displaySource}));return[...d,...N]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",o);const u=await this._fallbackSearch(s);return console.log(" Fallback search returned:",u.length,"results"),u}catch(o){return console.error("Error searching ingredients:",o),[]}},async _fallbackSearch(n){try{const t=nn(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[f,m]=await Promise.all([nr.getPriceListArray(),Pn.getAllConversions()]);console.log(" CSV Data rows:",f.length),console.log(" Manual Data items:",m.size);const y=Array.from(m.values()).map(_=>({name:_.ingredientName,price:_.lastPrice,size:_.packetSize,unit:_.packetUnit,itemCategory:_.itemCategory||null,source:"manual",displaySource:" "})),v=f.map(_=>({name:_.name,price:_.price,size:null,unit:_.unit,source:"csv",displaySource:" CSV"})),x=new Set(y.map(_=>_.name)),w=v.filter(_=>!x.has(_.name));this._csvCache=[...y,...w],console.log(" Cache built. Total items:",this._csvCache.length)}const s=f=>{if(!t)return null;const m=String(f||"").indexOf(t);return m<0?null:{tier:f===t?0:m===0?1:2,idx:m,len:String(f||"").length}},l=(f,m)=>f.score.tier!==m.score.tier?f.score.tier-m.score.tier:f.score.idx!==m.score.idx?f.score.idx-m.score.idx:f.score.len!==m.score.len?f.score.len-m.score.len:f.name.localeCompare(m.name,"ja"),o=(f,m,y)=>{let v=0;for(;v<f.length&&l(f[v],m)<=0;)v++;f.splice(v,0,m),f.length>y&&f.pop()},u=15,d=[],h=new Set;for(const f of this._csvCache){const m=nn(f?.name);if(!m||h.has(m))continue;const y=s(m);y&&(h.add(m),o(d,{...f,nameKey:m,score:y},u))}return d.map(f=>({name:f.name,price:f.price,size:f.size,unit:f.unit,itemCategory:f.itemCategory||null,source:f.source,displaySource:f.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},Np=({value:n,onChange:t,placeholder:s,disabled:l,onSelect:o})=>{const[u,d]=b.useState([]),[h,f]=b.useState(!1),[m,y]=b.useState(-1),v=b.useRef(null),x=b.useRef(null),[w,_]=b.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),N=b.useCallback(()=>{if(v.current){const z=v.current.getBoundingClientRect(),C=8,M=4,T=z.top-C,F=window.innerHeight-z.bottom-C,G=(T>=180||T>=F)&&T>=110,q=Math.max(110,Math.min(280,G?T-M:F-M)),V=z.left,P=Math.max(220,window.innerWidth-C*2),L=Math.min(Math.max(z.width,220),P),R=Math.min(Math.max(C,V),window.innerWidth-C-L);_({top:G?z.top-M:z.bottom+M,left:R,width:L,maxHeight:q,placeAbove:G})}},[]);b.useEffect(()=>{const z=T=>{v.current&&!v.current.contains(T.target)&&x.current&&!x.current.contains(T.target)&&f(!1)},C=T=>{x.current&&x.current.contains(T.target)||f(!1)},M=()=>{h&&N()};return document.addEventListener("mousedown",z),window.addEventListener("scroll",C,{capture:!0}),window.addEventListener("resize",M),()=>{document.removeEventListener("mousedown",z),window.removeEventListener("scroll",C,{capture:!0}),window.removeEventListener("resize",M)}},[h,N]),b.useEffect(()=>{h&&N()},[h,u,N]);const j=b.useRef(0),E=b.useRef(null),O=async z=>{const C=z.target.value;if(t(z),E.current&&clearTimeout(E.current),C.length===0){f(!1);return}E.current=setTimeout(async()=>{if(C.length>0){const M=++j.current;console.log(" AutocompleteInput: Fetching suggestions for:",C);const T=await Oo.search(C);console.log(" AutocompleteInput: Got",T.length,"suggestions"),M===j.current&&(d(T),f(T.length>0),y(-1))}},150)},D=z=>{const C={target:{value:z.name}};t(C),f(!1),o&&o(z)},$=z=>{h&&(z.key==="ArrowDown"?(z.preventDefault(),y(C=>C<u.length-1?C+1:C)):z.key==="ArrowUp"?(z.preventDefault(),y(C=>C>0?C-1:-1)):z.key==="Enter"?m>=0&&(z.preventDefault(),D(u[m])):z.key==="Escape"&&f(!1))};return i.jsxs("div",{className:"autocomplete-wrapper",ref:v,children:[i.jsx("input",{type:"text",className:"input-field autocomplete-input",value:n,onChange:O,onKeyDown:$,onFocus:async()=>{if(n&&n.length>0){N();const z=await Oo.search(n);d(z),f(z.length>0)}else N()},placeholder:s,disabled:l}),h&&Ki.createPortal(i.jsx("ul",{className:"suggestions-list",ref:x,style:{position:"fixed",top:`${w.top}px`,left:`${w.left}px`,width:`${w.width}px`,maxHeight:`${w.maxHeight}px`,transform:w.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:u.map((z,C)=>i.jsxs("li",{className:`suggestion-item ${C===m?"selected":""}`,onClick:()=>D(z),onMouseEnter:()=>y(C),children:[i.jsxs("div",{className:"suggestion-main",children:[i.jsx("span",{className:"suggestion-name",children:z.name}),z?.source&&z.source!=="manual"&&i.jsx("span",{className:"suggestion-source",children:z.displaySource})]}),i.jsxs("div",{className:"suggestion-details",children:[z.price&&`${Number(z.price).toLocaleString()}`,z.size&&` / ${z.size}${z.unit}`,!z.size&&z.unit&&` / ${z.unit}`]})]},`${z.source}-${C}`))}),document.body)]})},cb=({isOpen:n,onClose:t,onApply:s,ingredientName:l,currentCost:o,currentQuantity:u,unit:d="g",initialPurchaseCost:h,initialContentAmount:f})=>{const[m,y]=b.useState(""),[v,x]=b.useState(""),[w,_]=b.useState(d),[N,j]=b.useState(""),[E,O]=b.useState(!1),[D,$]=b.useState(!1),z=b.useCallback(async()=>{if($(!0),j(""),h&&f){y(h),x(f);const G=await Pn.getConversion(l);if(G)_(G.packetUnit||d),j(G.vendor||"");else{_(d);try{const q=await nr.getPrice(l);j(q?.vendor||"")}catch{}}}else{const G=await Pn.getConversion(l);if(G)x(G.packetSize),_(G.packetUnit||d),G.lastPrice&&y(G.lastPrice),j(G.vendor||"");else try{const q=await nr.getPrice(l);if(q)if(y(o||q.price),j(q.vendor||""),q.unit){const V=q.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(V){let P=V[1]?parseFloat(V[1]):1,L=V[2]?V[2].trim().toLowerCase():"";L==="kg"?(P*=1e3,L="g"):L==="l"?(P*=1e3,L="ml"):L==="pk"||L==="pack"?L="":L==="bag"?L="":(L==="pc"||L==="pcs")&&(L=""),x(P),_(L||d)}else x(1),_(q.unit)}else x(""),_(d);else x(""),y(o||""),_(d),j("")}catch(q){console.warn("Failed to load master price:",q),x(""),y(o||""),_(d),j("")}}$(!1)},[l,h,f,d,o]);b.useEffect(()=>{if(!n||!l)return;const G=setTimeout(()=>{z()},0);return()=>clearTimeout(G)},[n,l,z]);const C=()=>{const G=parseFloat(m),q=parseFloat(v);return!G||!q?0:["g","ml","cc"].includes(w)?G/q*1e3:G/q},M=async()=>{const G=C();if(E&&v)try{await Pn.saveConversion(l,v,w,m,null,N)}catch(q){console.error("Failed to save default conversion:",q)}s(G,w,m,v,N),t()};if(!n)return null;const T=C(),F=u?T*(u/(["g","ml"].includes(d)?1e3:1)):0,K=i.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:i.jsx("div",{className:"unit-conversion-modal__card",onClick:G=>G.stopPropagation(),children:i.jsxs("div",{className:"unit-conversion-modal__body",children:[i.jsx("h3",{className:"unit-conversion-modal__title",children:""}),i.jsxs("div",{className:"unit-conversion-modal__field",children:[i.jsx("span",{className:"unit-conversion-modal__label",children:""}),i.jsx("div",{className:"unit-conversion-modal__value",children:l||"()"})]}),i.jsxs("div",{className:"unit-conversion-modal__inputs",children:[i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),i.jsx("input",{type:"number",value:m,onChange:G=>y(G.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:""}),i.jsxs("div",{className:"unit-conversion-modal__row",children:[i.jsx("input",{type:"number",value:v,onChange:G=>x(G.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),i.jsxs("select",{value:w,onChange:G=>_(G.target.value),className:"unit-conversion-modal__select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:"p"}),i.jsx("option",{value:"cc",children:"cc"}),!["g","ml","","","","","","cc"].includes(w)&&i.jsx("option",{value:w,children:w})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:""}),i.jsx("input",{type:"text",value:N,onChange:G=>j(G.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),i.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:D?i.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[i.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),i.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(T).toLocaleString()]})]}),u&&i.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[i.jsxs("span",{children:[" (",u,d,"):"]}),i.jsxs("span",{children:["",Math.round(F).toLocaleString()]})]})]})}),i.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[i.jsx("input",{type:"checkbox",id:"saveDefault",checked:E,onChange:G=>O(G.target.checked)}),i.jsxs("span",{children:["(",v,w,")"]})]}),i.jsxs("div",{className:"unit-conversion-modal__actions",children:[i.jsx(se,{type:"button",variant:"secondary",onClick:t,disabled:D,children:""}),i.jsx(se,{type:"button",variant:"primary",onClick:M,disabled:!m||!v||D,children:""})]})]})})});return Ki.createPortal(K,document.body)},LE=new Set(["food","alcohol","soft_drink","supplies"]),IE=new Set(["alcohol","supplies"]),ub={food:"",alcohol:"",soft_drink:"",supplies:""},vi=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":LE.has(t)?t:"":""},Qu=n=>IE.has(n),Of=(n,t)=>{const s=vi(t);return s?{...n,itemCategory:s,isAlcohol:Qu(s)}:{...n,itemCategory:null}},Gn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},rp=n=>{const t=Gn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},$i=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return rp(s)/100},BE=(n,t,s)=>{const l=Gn(n),o=Gn(t);if(!Number.isFinite(l)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/o*1e3:(["kg","","l",""].includes(u),l/o)},_x=(n,t,s,l=!1,o=1)=>{const u=Gn(n),d=Gn(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const h=Number.isFinite(o)&&o>0?o:1;if(l)return u/1e3*d/h;const f=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(f)||!f?u/1e3*d/h:u*d/h},$E=(n,t)=>{const s=Gn(n?.purchaseCost),l=Gn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},Cx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Lr=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=Cx(t);if(!l)return null;for(const[o,u]of n.entries())if(Cx(o)===l)return u;return null},PE=({formData:n,setFormData:t})=>{const[s,l]=b.useState(new Map),[o,u]=b.useState({isOpen:!1,type:null,index:null}),[d,h]=b.useState(new Map);b.useEffect(()=>{(async()=>{const[M,T]=await Promise.all([nr.fetchPriceList(),Pn.getAllConversions()]);l(M),h(T)})()},[]);const m=(C=>C.reduce((M,T)=>M+(parseFloat(T.quantity)||0),0))(n.flours||[]),y=C=>!m||m===0?0:((parseFloat(C)||0)/m*100).toFixed(1);b.useEffect(()=>{if(d.size===0)return;const C=(F=[])=>{let K=!1;return{adjusted:F.map(q=>{if(!q||typeof q!="object")return q;const V=Lr(d,q.name);let P=q;const L=vi(q.itemCategory??q.item_category??V?.itemCategory);if(L){const ye=Qu(L);(vi(q.itemCategory??q.item_category)!==L||!!q.isAlcohol!==ye)&&(P={...P,itemCategory:L,isAlcohol:ye})}const R=$i(q,V),I=_x(q.quantity,P.purchaseCost,q.unit,!0,R),Y=Number.isFinite(I)?Math.round(I*100)/100:NaN,ue=Gn(P.cost);if(Number.isFinite(Y)&&(!Number.isFinite(ue)||Math.abs(ue-Y)>.01)&&(P={...P,cost:Y}),V&&V.packetSize){const B=[V.lastPrice,q.purchaseCostRef,q.purchase_cost,q.purchaseCost].find(Z=>Number.isFinite(Gn(Z))),J=BE(B,V.packetSize,V.packetUnit);if(Number.isFinite(J)&&$E(q,J)){const Z=$i(q,V),ge=Math.round(J*100)/100,Me=_x(q.quantity,ge,q.unit,!0,Z),ve=Number.isFinite(Me)?Math.round(Me*100)/100:P.cost,ae=Gn(P.purchaseCost),A=Gn(P.cost),X=!Number.isFinite(ae)||Math.abs(ae-ge)>.01,ce=Number.isFinite(Gn(ve))&&(!Number.isFinite(A)||Math.abs(A-ve)>.01);(X||ce)&&(P={...P,purchaseCost:ge,cost:ve})}}return P!==q&&(K=!0),P}),changed:K}},M=C(n.flours||[]),T=C(n.breadIngredients||[]);!M.changed&&!T.changed||t(F=>({...F,flours:M.adjusted,breadIngredients:T.adjusted}))},[d,n.breadIngredients,n.flours,t]);const v=(C,M,T)=>{const F=[...n.flours||[]];if(F[C]={...F[C],[M]:T},M==="name"){const K=s.get(nn(T));if(K){const G=typeof K=="object"?K.price:K,q=typeof K=="object"?K.vendor:null,V=typeof K=="object"?K.unit:null;F[C].purchaseCostRef=G,F[C].vendorRef=q;const P=Lr(d,T);if(P&&P.packetSize){let R=0;const I=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:G,Y=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?R=I/P.packetSize*1e3:["kg",""].includes(Y)?R=I/P.packetSize:["ml","","cc",""].includes(Y)?R=I/P.packetSize*1e3:(["l",""].includes(Y),R=I/P.packetSize),F[C].purchaseCost=Math.round(R*100)/100,F[C].unit="g"}else F[C].purchaseCost||(F[C].purchaseCost=G,!F[C].unit&&V&&(F[C].unit=V));const L=vi(P?.itemCategory);L?F[C]=Of(F[C],L):F[C].itemCategory=null}else F[C].purchaseCostRef=null,F[C].vendorRef=null,F[C].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(M)||M==="name"){const K=F[C],G=parseFloat(K.quantity),q=parseFloat(K.purchaseCost);if(!isNaN(G)&&!isNaN(q)){let V=0;const P=(K.unit||"").trim().toLowerCase();P==="g"||P===""||P==="ml"||P===""||P==="cc"||P===""||!P?V=G/1e3*q:V=G*q;const L=Lr(d,K.name),R=$i(K,L),I=Number.isFinite(R)&&R>0?R:1,Y=Math.round(V/I*100)/100;Y!==K.cost&&(F[C].cost=Y)}}t(K=>({...K,flours:F}))},x=(C,M,T)=>{const F=[...n.breadIngredients||[]];if(F[C]={...F[C],[M]:T},M==="name"){const K=s.get(nn(T));if(K){const G=typeof K=="object"?K.price:K,q=typeof K=="object"?K.vendor:null,V=typeof K=="object"?K.unit:null;F[C].purchaseCostRef=G,F[C].vendorRef=q;const P=Lr(d,T);if(P&&P.packetSize){let R=0;const I=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:G,Y=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?(R=I/P.packetSize*1e3,F[C].unit="g"):["kg",""].includes(Y)?(R=I/P.packetSize,F[C].unit="g"):["ml","","cc",""].includes(Y)?(R=I/P.packetSize*1e3,F[C].unit="ml"):["l",""].includes(Y)?(R=I/P.packetSize,F[C].unit="ml"):(R=I/P.packetSize,F[C].unit=P.packetUnit),F[C].purchaseCost=Math.round(R*100)/100}else F[C].purchaseCost||(F[C].purchaseCost=G,!F[C].unit&&V&&(F[C].unit=V));const L=vi(P?.itemCategory);L?F[C]=Of(F[C],L):F[C].itemCategory=null}else F[C].purchaseCostRef=null,F[C].vendorRef=null,F[C].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(M)||M==="name"){const K=F[C],G=parseFloat(K.quantity),q=parseFloat(K.purchaseCost);if(!isNaN(G)&&!isNaN(q)){let V=0;const P=K.unit?K.unit.trim().toLowerCase():"g";P==="g"||P===""||P==="ml"||P===""||P==="cc"||P===""?V=G/1e3*q:V=G*q;const L=Lr(d,K.name),R=$i(K,L),I=Number.isFinite(R)&&R>0?R:1,Y=Math.round(V/I*100)/100;Y!==K.cost&&(F[C].cost=Y)}}t(K=>({...K,breadIngredients:F}))},w=()=>{t(C=>({...C,flours:[...C.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},_=()=>{t(C=>({...C,breadIngredients:[...C.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},N=C=>{t(M=>({...M,flours:M.flours.filter((T,F)=>F!==C)}))},j=C=>{t(M=>({...M,breadIngredients:M.breadIngredients.filter((T,F)=>F!==C)}))},E=al(gr(Po,{activationConstraint:{distance:10}}),gr(qo,{activationConstraint:{delay:250,tolerance:5}}),gr(ol,{coordinateGetter:Gu})),O=C=>{const{active:M,over:T}=C;M.id!==T.id&&t(F=>{const G=F.flours.some(P=>P.id===M.id)?"flours":"breadIngredients",q=F[G].findIndex(P=>P.id===M.id),V=F[G].findIndex(P=>P.id===T.id);return q!==-1&&V!==-1?{...F,[G]:Zi(F[G],q,V)}:F})};b.useEffect(()=>{if(!n.flours)t(C=>({...C,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const C=n.flours.map(M=>M.id?M:{...M,id:crypto.randomUUID()});JSON.stringify(C)!==JSON.stringify(n.flours)&&t(M=>({...M,flours:C}))}if(!n.breadIngredients)t(C=>({...C,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const C=n.breadIngredients.map(M=>M.id?M:{...M,id:crypto.randomUUID()});JSON.stringify(C)!==JSON.stringify(n.breadIngredients)&&t(M=>({...M,breadIngredients:C}))}},[]);const D=(C,M,T,F)=>{const{type:K,index:G}=o;t(q=>{if(K==="flour"){const V=[...q.flours],P={...V[G],purchaseCost:C,unit:M,purchase_cost:T,content_amount:F},L=parseFloat(P.quantity),R=parseFloat(C);if(!isNaN(L)&&!isNaN(R)){let I=0;M==="g"||M===""?I=L/1e3*R:I=L*R;const Y=Lr(d,P.name),ue=$i(P,Y),ye=Number.isFinite(ue)&&ue>0?ue:1;P.cost=Math.round(I/ye*100)/100}return V[G]=P,Pn.getAllConversions().then(I=>h(I)),Oo.invalidateCache(),{...q,flours:V}}else if(K==="ingredient"){const V=[...q.breadIngredients],P={...V[G],purchaseCost:C,unit:M,purchase_cost:T,content_amount:F},L=parseFloat(P.quantity),R=parseFloat(C);if(!isNaN(L)&&!isNaN(R)){let I=0;M==="g"||M===""?I=L/1e3*R:I=L*R;const Y=Lr(d,P.name),ue=$i(P,Y),ye=Number.isFinite(ue)&&ue>0?ue:1;P.cost=Math.round(I/ye*100)/100}return V[G]=P,Pn.getAllConversions().then(I=>h(I)),Oo.invalidateCache(),{...q,breadIngredients:V}}return q})},$=(C,M,T)=>{T&&t(F=>{const K=C==="flour"?"flours":"breadIngredients",G=[...F[K]||[]],q={...G[M]};if(q.name=T.name,q.itemCategory=null,T.price!==void 0&&T.price!==null&&T.price!==""){q.purchaseCostRef=T.price,q.vendorRef=T.source==="csv"?"CSV":"Master";let R=T.price,I=T.unit;if(T.source==="manual")if(T.size&&T.size>0){const Y=(T.unit||"").trim().toLowerCase();["g",""].includes(Y)?(R=T.price/T.size*1e3,I="g"):["kg",""].includes(Y)?(R=T.price/T.size,I="g"):["ml","","cc",""].includes(Y)?(R=T.price/T.size*1e3,I="ml"):["l",""].includes(Y)?(R=T.price/T.size,I="ml"):(R=T.price/T.size,I=T.unit)}else R=T.price,I=T.unit;else{const Y=Lr(d,T.name);if(Y&&Y.packetSize){const ue=Y.lastPrice!==null&&Y.lastPrice!==void 0&&Y.lastPrice!==""?Y.lastPrice:T.price,ye=(Y.packetUnit||"").trim().toLowerCase();["g",""].includes(ye)?(R=ue/Y.packetSize*1e3,I="g"):["kg",""].includes(ye)?(R=ue/Y.packetSize,I="g"):["ml","","cc",""].includes(ye)?(R=ue/Y.packetSize*1e3,I="ml"):["l",""].includes(ye)?(R=ue/Y.packetSize,I="ml"):(R=ue/Y.packetSize,I=Y.packetUnit)}else R=T.price,I=T.unit}q.purchaseCost=Math.round(R*100)/100,C==="flour"?q.unit="g":I&&(q.unit=I)}const V=vi(T.itemCategory??T.item_category??Lr(d,T.name)?.itemCategory);if(V){const R=Of(q,V);Object.assign(q,R)}const P=parseFloat(q.quantity),L=parseFloat(q.purchaseCost);if(!isNaN(P)&&!isNaN(L)){const R=Lr(d,q.name),I=$i(q,R),Y=Number.isFinite(I)&&I>0?I:1,ue=(q.unit||"").trim().toLowerCase();let ye=0;ue==="g"||ue===""||ue==="ml"||ue===""||ue==="cc"||ue===""?ye=P/1e3*L:ye=P*L,q.cost=Math.round(ye/Y*100)/100}return G[M]=q,{...F,[K]:G}})},z=o.isOpen&&o.index!==null?o.type==="flour"?n.flours[o.index]:n.breadIngredients[o.index]:null;return i.jsxs("div",{className:"bread-form",children:[i.jsxs(tn,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[i.jsxs("div",{className:"bread-header",children:[i.jsxs("h3",{children:[" (Total: ",m,"g)"]}),i.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Xi,{sensors:E,collisionDetection:Pf,onDragEnd:O,id:"flours-dnd",children:i.jsx(tl,{items:n.flours||[],strategy:Co,children:(n.flours||[]).map((C,M)=>{const T=Lr(d,C?.name),F=rp(T?.yieldPercent??T?.yield_percent??C?.yieldPercent??C?.yield_percent);return i.jsx(qE,{id:C.id,index:M,item:C,yieldPercentApplied:F,onChange:v,onRemove:N,onSelect:$,calculatePercentage:y,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:M})},C.id)})})})})]}),i.jsx(se,{type:"button",variant:"secondary",size:"sm",onClick:w,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsxs(tn,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[i.jsxs("div",{className:"bread-header",children:[i.jsx("h3",{children:""}),i.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Xi,{sensors:E,collisionDetection:Pf,onDragEnd:O,id:"breadIngredients-dnd",children:i.jsx(tl,{items:n.breadIngredients||[],strategy:Co,children:(n.breadIngredients||[]).map((C,M)=>{const T=Lr(d,C?.name),F=rp(T?.yieldPercent??T?.yield_percent??C?.yieldPercent??C?.yield_percent);return i.jsx(FE,{id:C.id,index:M,item:C,yieldPercentApplied:F,onChange:x,onRemove:j,onSelect:$,calculatePercentage:y,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:M})},C.id)})})})})]}),i.jsx(se,{type:"button",variant:"secondary",size:"sm",onClick:_,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:i.jsx(se,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),i.jsx(cb,{isOpen:o.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:D,ingredientName:z?.name||"",currentCost:z?.purchaseCost,currentQuantity:z?.quantity,unit:z?.unit||"g",initialPurchaseCost:z?.purchase_cost,initialContentAmount:z?.content_amount})]})},qE=({id:n,index:t,item:s,yieldPercentApplied:l,onChange:o,onRemove:u,onSelect:d,calculatePercentage:h,floursLength:f,onOpenConversion:m})=>{const y=vi(s.itemCategory??s.item_category),v=!!y,x=ub[y]||"",w=v?`${x}${Qu(y)?"10%":"8%"}`:"",{attributes:_,listeners:N,setNodeRef:j,transform:E,transition:O,isDragging:D}=cl({id:n}),$={transform:Tr.Transform.toString(E),transition:O,opacity:D?.5:1,position:"relative",zIndex:D?999:"auto"};return i.jsxs("div",{ref:j,style:$,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{..._,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(Np,{value:s.name,onChange:z=>o(t,"name",z.target.value),onSelect:z=>d("flour",t,z),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(zt,{type:"number",step:"any",value:s.quantity,onChange:z=>o(t,"quantity",z.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[h(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(zt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:z=>o(t,"purchaseCost",z.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:m,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(zt,{type:"number",step:"any",value:s.cost||"",onChange:z=>o(t,"cost",z.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Gn(l))&&Gn(l)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const z=Gn(l),C=Math.round(z*10)/10;return`${Number.isInteger(C)?Math.round(C):C}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:z=>o(t,"isAlcohol",z.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${w}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:f>1&&i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},FE=({id:n,index:t,item:s,yieldPercentApplied:l,onChange:o,onRemove:u,onSelect:d,calculatePercentage:h,onOpenConversion:f})=>{const m=vi(s.itemCategory??s.item_category),y=!!m,v=ub[m]||"",x=y?`${v}${Qu(m)?"10%":"8%"}`:"",{attributes:w,listeners:_,setNodeRef:N,transform:j,transition:E,isDragging:O}=cl({id:n}),D={transform:Tr.Transform.toString(j),transition:E,opacity:O?.5:1,position:"relative",zIndex:O?999:"auto"};return i.jsxs("div",{ref:N,style:D,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{...w,..._,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(Np,{value:s.name,onChange:$=>o(t,"name",$.target.value),onSelect:$=>d("ingredient",t,$),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(zt,{type:"number",step:"any",value:s.quantity,onChange:$=>o(t,"quantity",$.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[h(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(zt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:$=>o(t,"purchaseCost",$.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(zt,{type:"number",step:"any",value:s.cost||"",onChange:$=>o(t,"cost",$.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Gn(l))&&Gn(l)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const $=Gn(l),z=Math.round($*10)/10;return`${Number.isInteger(z)?Math.round(z):z}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:$=>o(t,"isAlcohol",$.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},HE=new Set(["food","alcohol","soft_drink","supplies"]),GE=new Set(["alcohol","supplies"]),VE={food:"",alcohol:"",soft_drink:"",supplies:""},Xa=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":HE.has(t)?t:"":""},Du=n=>GE.has(n),Nx=(n,t)=>{const s=Xa(t);return s?{...n,itemCategory:s,isAlcohol:Du(s)}:{...n,itemCategory:null}},Ex=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Ts=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=Ex(t);if(!l)return null;for(const[o,u]of n.entries())if(Ex(o)===l)return u;return null},ir=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},db=n=>{const t=ir(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Ha=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return db(s)/100},KE=(n,t,s)=>{const l=ir(n),o=ir(t);if(!Number.isFinite(l)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/o*1e3:(["kg","","l",""].includes(u),l/o)},Df=(n,t,s,l=1)=>{const o=ir(n),u=ir(t);if(!Number.isFinite(o)||!Number.isFinite(u))return NaN;const d=String(s||"").trim().toLowerCase();let h=0;["g","","ml","","cc",""].includes(d)?h=o/1e3*u:h=o*u;const f=Number.isFinite(l)&&l>0?l:1;return h/f},YE=(n,t)=>{const s=ir(n?.purchaseCost),l=ir(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},QE=we.memo(({id:n,index:t,item:s,groupId:l,yieldPercentApplied:o,onChange:u,onRemove:d,handleSuggestionSelect:h,onOpenConversion:f})=>{const m=Xa(s.itemCategory??s.item_category),y=!!m,v=VE[m]||"",x=y?`${v}${Du(m)?"10%":"8%"}`:"",w=y?Du(m):!!s.isAlcohol,{attributes:_,listeners:N,setNodeRef:j,transform:E,transition:O,isDragging:D}=cl({id:n,data:{groupId:l,index:t}}),$={transform:Tr.Translate.toString(E),transition:O,opacity:D?.3:1,position:"relative",zIndex:D?999:"auto"};return i.jsxs("div",{ref:j,style:$,className:"form-ingredient-row",children:[i.jsx("div",{..._,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(Np,{value:s.name,onChange:z=>u(l,t,"name",z.target.value),onSelect:z=>h(l,t,z),placeholder:""})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(zt,{value:s.quantity,onChange:z=>u(l,t,"quantity",z.target.value),placeholder:"0",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsx("div",{className:"ingredient-unit",children:i.jsx(zt,{value:s.unit,onChange:z=>u(l,t,"unit",z.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[i.jsx(zt,{type:"number",value:s.purchaseCost,onChange:z=>u(l,t,"purchaseCost",z.target.value),step:"0.01",placeholder:s.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},title:s.purchaseCostRef?`: ${s.purchaseCostRef}${s.vendorRef?` (${s.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",s.purchaseCostRef]})]}),i.jsxs("div",{className:"ingredient-cost","data-label":"",children:[i.jsx(zt,{type:"number",step:"0.01",value:s.cost,onChange:z=>u(l,t,"cost",z.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(ir(o))&&ir(o)<99.999&&i.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const z=ir(o),C=Math.round(z*10)/10;return`${Number.isInteger(C)?Math.round(C):C}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:w,onChange:z=>u(l,t,"isAlcohol",z.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(l,t),children:""})})]})},(n,t)=>n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),WE=({section:n,sections:t,onSectionChange:s,onRemoveSection:l,children:o})=>{const{setNodeRef:u}=Ho({id:n.id});return i.jsxs(tn,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(zt,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>l(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[i.jsx("span",{}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},JE=({formData:n,setFormData:t,priceList:s})=>{const[l,o]=b.useState(new Map);b.useEffect(()=>{Pn.getAllConversions().then($=>o($))},[]);const[u,d]=b.useState({isOpen:!1,groupId:null,index:null});b.useEffect(()=>{if(!n.ingredientSections){const $=n.ingredientGroups||[{id:"default",name:""}],z=n.ingredients||[],C=$.map(F=>({id:F.id,name:F.name,items:z.filter(K=>F.id==="default"&&!K.groupId?!0:K.groupId===F.id)})),M=new Set(C.flatMap(F=>F.items.map(K=>K.id))),T=z.filter(F=>!M.has(F.id));T.length>0&&(C.length>0?C[0].items.push(...T):C.push({id:"default",name:"",items:T})),C.length===0&&C.push({id:crypto.randomUUID(),name:"",items:[]}),t(F=>({...F,ingredientSections:C}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const h=n.ingredientSections||[];b.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||l.size===0)return;let $=!1;const z=n.ingredientSections.map(C=>{const M=C.items.map(T=>{if(!T||typeof T!="object")return T;const F=Ts(l,T.name);let K=T;const G=Xa(T.itemCategory??T.item_category??F?.itemCategory);if(G){const V=Du(G);(Xa(T.itemCategory??T.item_category)!==G||!!T.isAlcohol!==V)&&(K={...K,itemCategory:G,isAlcohol:V})}if(F&&F.packetSize){const P=[F.lastPrice,T.purchaseCostRef,T.purchase_cost,T.purchaseCost].find(R=>Number.isFinite(ir(R))),L=KE(P,F.packetSize,F.packetUnit);if(Number.isFinite(L)&&YE(T,L)){const R=Ha(T,F),I=Math.round(L*100)/100,Y=Df(T.quantity,I,T.unit,R),ue=Number.isFinite(Y)?Math.round(Y*100)/100:K.cost,ye=ir(K.purchaseCost),B=ir(K.cost),J=!Number.isFinite(ye)||Math.abs(ye-I)>.01,Z=Number.isFinite(ir(ue))&&(!Number.isFinite(B)||Math.abs(B-ue)>.01);(J||Z)&&(K={...K,purchaseCost:I,cost:ue})}}const q=Ha(T,F);if(Number.isFinite(q)&&q>0&&Math.abs(q-1)>1e-4){const V=Df(T.quantity,K.purchaseCost,T.unit,q),P=Df(T.quantity,K.purchaseCost,T.unit,1),L=ir(K.cost);if(Number.isFinite(V)&&(!Number.isFinite(L)||Number.isFinite(P)&&Math.abs(L-P)<=.01)){const I=Math.round(V*100)/100,Y=ir(K.cost);(!Number.isFinite(Y)||Math.abs(Y-I)>.01)&&(K={...K,cost:I})}}return K!==T&&($=!0),K});return M!==C.items?{...C,items:M}:C});$&&t(C=>({...C,ingredientSections:z}))},[l,n.ingredientSections,t]);const f=al(gr(Po,{activationConstraint:{distance:10}}),gr(qo,{activationConstraint:{delay:250,tolerance:5}}),gr(ol,{coordinateGetter:Gu})),m=({active:$,over:z})=>{if(!z)return;const C=$.id,M=z.id,T=h.find(K=>K.items.some(G=>G.id===C)),F=h.find(K=>K.items.some(G=>G.id===M))||h.find(K=>K.id===M);!T||!F||T===F||t(K=>{const G=T.items,q=F.items,V=G.findIndex(R=>R.id===C),P=q.findIndex(R=>R.id===M);let L;if(M===F.id)L=q.length+1;else{const I=z&&$.rect.current.translated&&$.rect.current.translated.top>z.rect.top+z.rect.height?1:0;L=P>=0?P+I:q.length+1}return{...K,ingredientSections:K.ingredientSections.map(R=>R.id===T.id?{...R,items:G.filter(I=>I.id!==C)}:R.id===F.id?{...R,items:[...q.slice(0,L),G[V],...q.slice(L,q.length)]}:R)}})},y=({active:$,over:z})=>{if(!z)return;const C=$.id,M=z.id,T=h.find(K=>K.items.some(G=>G.id===C)),F=h.find(K=>K.items.some(G=>G.id===M))||h.find(K=>K.id===M);if(T&&F&&T===F){const K=T.items.findIndex(q=>q.id===C),G=F.items.findIndex(q=>q.id===M);K!==G&&t(q=>({...q,ingredientSections:q.ingredientSections.map(V=>V.id===T.id?{...V,items:Zi(V.items,K,G)}:V)}))}},v=($,z,C,M)=>{const{groupId:T,index:F}=u;T!==null&&F!==null&&t(K=>{const G=K.ingredientSections.map(q=>{if(q.id!==T)return q;const V=[...q.items],P={...V[F],purchaseCost:$,unit:z,purchase_cost:C,content_amount:M},L=parseFloat(P.quantity),R=parseFloat($);if(!isNaN(L)&&!isNaN(R)){const I=Ts(l,P.name),Y=Ha(P,I),ue=z?z.trim().toLowerCase():"";let ye=0;ue==="g"||ue===""||ue==="ml"||ue===""||ue==="cc"||ue===""?ye=L/1e3*R:ye=L*R;const B=Number.isFinite(Y)&&Y>0?Y:1;P.cost=Math.round(ye/B*100)/100}return V[F]=P,{...q,items:V}});return Pn.getAllConversions().then(q=>o(q)),Oo.invalidateCache(),{...K,ingredientSections:G}})},x=u.isOpen&&u.groupId!==null&&u.index!==null?h.find($=>$.id===u.groupId)?.items[u.index]:null,w=we.useCallback(($,z,C,M)=>{t(T=>{const F=T.ingredientSections.map(K=>{if(K.id!==$)return K;const G=[...K.items],q={...G[z],[C]:M};if(G[z]=q,["quantity","purchaseCost","unit","name","isAlcohol"].includes(C)){const V=parseFloat(q.quantity),P=parseFloat(q.purchaseCost),L=Ts(l,q.name),R=Ha(q,L),I=Number.isFinite(R)&&R>0?R:1;if(!isNaN(V)&&!isNaN(P)){let Y=0;const ue=q.unit?q.unit.trim().toLowerCase():"";ue==="g"||ue===""||ue==="ml"||ue===""||ue==="cc"||ue===""?Y=V/1e3*P:Y=V*P;const ye=Math.round(Y/I*100)/100;ye!==q.cost&&(q.cost=ye,G[z]=q)}}if(C==="name"){const V=s.get(nn(M)),P=Ts(l,M),L=Xa(P?.itemCategory);if(L){const R=Nx(q,L);Object.assign(q,R)}else V||(q.itemCategory=null);if(V){const R=typeof V=="object"?V.price:V,I=typeof V=="object"?V.vendor:null,Y=typeof V=="object"?V.unit:null,ue=typeof V=="object"?V.size:null;if(q.purchaseCostRef=R,q.vendorRef=I,P&&P.packetSize){const J=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:R;let Z=0;const ge=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(ge)?(Z=J/P.packetSize*1e3,q.unit="g"):["kg",""].includes(ge)?(Z=J/P.packetSize,q.unit="g"):["ml","","cc",""].includes(ge)?(Z=J/P.packetSize*1e3,q.unit="ml"):["l",""].includes(ge)?(Z=J/P.packetSize,q.unit="ml"):(Z=J/P.packetSize,q.unit=P.packetUnit),q.purchaseCost=Math.round(Z*100)/100}else{let J=R,Z=Y;ue&&ue>1&&(["g",""].includes((Y||"").toLowerCase())?(J=R/ue*1e3,Z="g"):["ml","","cc",""].includes((Y||"").toLowerCase())?(J=R/ue*1e3,Z="ml"):["kg",""].includes(Y?Y.toLowerCase():"")?(J=R/ue,Z="g"):["l",""].includes(Y?Y.toLowerCase():"")?(J=R/ue,Z="ml"):J=R/ue),q.purchaseCost||(q.purchaseCost=Math.round(J*100)/100),!q.unit&&Z&&(q.unit=Z)}const ye=parseFloat(q.quantity),B=parseFloat(q.purchaseCost);if(!isNaN(ye)&&!isNaN(B)){const J=Ts(l,q.name),Z=Ha(q,J),ge=Number.isFinite(Z)&&Z>0?Z:1,Me=q.unit?q.unit.trim().toLowerCase():"";let ve=0;Me==="g"||Me===""||Me==="ml"||Me===""||Me==="cc"||Me===""?ve=ye/1e3*B:ve=ye*B,q.cost=Math.round(ve/ge*100)/100}}else q.purchaseCostRef=null,q.vendorRef=null;G[z]=q}return{...K,items:G}});return{...T,ingredientSections:F}})},[l,s,t]),_=we.useCallback(($,z,C)=>{t(M=>{const T=M.ingredientSections.map(F=>{if(F.id!==$)return F;const K=[...F.items],G={...K[z]};if(G.name=C.name,G.itemCategory=null,C.price)if(G.purchaseCostRef=C.price,G.vendorRef=C.source==="csv"?"CSV":"Master",C.source==="manual")if(C.size&&C.size>0){const L=(C.unit||"").trim().toLowerCase();if(["g",""].includes(L)){const R=C.price/C.size*1e3;G.purchaseCost=Math.round(R*100)/100,G.unit="g"}else if(["kg",""].includes(L)){const R=C.price/C.size;G.purchaseCost=Math.round(R*100)/100,G.unit="g"}else if(["ml","","cc",""].includes(L)){const R=C.price/C.size*1e3;G.purchaseCost=Math.round(R*100)/100,G.unit="ml"}else if(["l",""].includes(L)){const R=C.price/C.size;G.purchaseCost=Math.round(R*100)/100,G.unit="ml"}else{const R=C.price/C.size;G.purchaseCost=Math.round(R*100)/100,G.unit=C.unit}}else G.purchaseCost=C.price,G.unit=C.unit;else{const L=Ts(l,C.name);if(L&&L.packetSize){const R=L.lastPrice!==null&&L.lastPrice!==void 0&&L.lastPrice!==""?L.lastPrice:C.price;let I=0;const Y=(L.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?(I=R/L.packetSize*1e3,G.unit="g"):["kg",""].includes(Y)?(I=R/L.packetSize,G.unit="g"):["ml","","cc",""].includes(Y)?(I=R/L.packetSize*1e3,G.unit="ml"):["l",""].includes(Y)?(I=R/L.packetSize,G.unit="ml"):(I=R/L.packetSize,G.unit=L.packetUnit),G.purchaseCost=Math.round(I*100)/100}else G.purchaseCost=C.price,G.unit=C.unit}const q=Xa(C.itemCategory??C.item_category??Ts(l,C.name)?.itemCategory);if(q){const L=Nx(G,q);Object.assign(G,L)}const V=parseFloat(G.quantity),P=parseFloat(G.purchaseCost);if(!isNaN(V)&&!isNaN(P)){const L=Ts(l,G.name),R=Ha(G,L),I=Number.isFinite(R)&&R>0?R:1,Y=G.unit?G.unit.trim().toLowerCase():"";let ue=0;Y==="g"||Y===""||Y==="ml"||Y===""||Y==="cc"||Y===""?ue=V/1e3*P:ue=V*P,G.cost=Math.round(ue/I*100)/100}return K[z]=G,{...F,items:K}});return{...M,ingredientSections:T}})},[l,t]),N=we.useCallback(($,z)=>{t(C=>({...C,ingredientSections:C.ingredientSections.map(M=>M.id===$?{...M,items:M.items.filter((T,F)=>F!==z)}:M)}))},[t]),j=$=>{const z={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(C=>({...C,ingredientSections:C.ingredientSections.map(M=>M.id===$?{...M,items:[...M.items,z]}:M)}))},E=()=>{t($=>({...$,ingredientSections:[...$.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},O=$=>{t(z=>({...z,ingredientSections:z.ingredientSections.filter(C=>C.id!==$)}))},D=($,z)=>{t(C=>({...C,ingredientSections:C.ingredientSections.map(M=>M.id===$?{...M,name:z}:M)}))};return i.jsxs(Xi,{sensors:f,collisionDetection:u0,onDragOver:m,onDragEnd:y,children:[i.jsxs("div",{className:"recipe-form-ingredients",children:[h.map($=>i.jsx(tl,{id:$.id,items:$.items.map(z=>z.id),strategy:Co,children:i.jsxs(WE,{section:$,sections:h,onSectionChange:D,onRemoveSection:O,children:[$.items.map((z,C)=>(()=>{const M=Ts(l,z?.name),T=db(M?.yieldPercent??M?.yield_percent??z?.yieldPercent??z?.yield_percent);return i.jsx(QE,{id:z.id,index:C,item:z,groupId:$.id,yieldPercentApplied:T,onChange:w,onRemove:N,handleSuggestionSelect:_,onOpenConversion:()=>d({isOpen:!0,groupId:$.id,index:C})},z.id)})()),i.jsx(se,{type:"button",variant:"ghost",onClick:()=>j($.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},$.id)),i.jsx(se,{type:"button",variant:"secondary",onClick:E,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(E0,{dropAnimation:{sideEffects:xp({styles:{active:{opacity:"0.5"}}})},children:null}),i.jsx(cb,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,groupId:null,index:null}),onApply:v,ingredientName:x?.name||"",currentCost:x?.purchaseCost,currentQuantity:x?.quantity,unit:x?.unit||"g",initialPurchaseCost:x?.purchase_cost,initialContentAmount:x?.content_amount})]})},XE=({id:n,index:t,item:s,groupId:l,onChange:o,onRemove:u})=>{const{attributes:d,listeners:h,setNodeRef:f,transform:m,transition:y,isDragging:v}=cl({id:n,data:{groupId:l,index:t}}),x={transform:Tr.Translate.toString(m),transition:y,opacity:v?.3:1,position:"relative",zIndex:v?999:"auto"};return i.jsxs("div",{ref:f,style:{...x,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[i.jsx("div",{...d,...h,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),i.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),i.jsx("div",{style:{flex:1},children:i.jsx(zt,{textarea:!0,value:s.text,onChange:w=>o(l,t,w.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(l,t),title:"",children:""})})]})},ZE=({section:n,sections:t,onSectionChange:s,onRemoveSection:l,children:o})=>{const{setNodeRef:u}=Ho({id:n.id});return i.jsxs(tn,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(zt,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>l(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},eT=({formData:n,setFormData:t})=>{b.useEffect(()=>{if(!n.stepSections){const x=n.stepGroups||[{id:"default",name:""}],_=(n.steps||[]||[]).map(O=>typeof O=="string"?{id:crypto.randomUUID(),text:O}:O),N=x.map(O=>({id:O.id,name:O.name,items:_.filter(D=>O.id==="default"&&!D.groupId?!0:D.groupId===O.id)})),j=new Set(N.flatMap(O=>O.items.map(D=>D.id))),E=_.filter(O=>!j.has(O.id));E.length>0&&(N.length>0?N[0].items.push(...E):N.push({id:"default",name:"",items:E})),N.length===0&&N.push({id:crypto.randomUUID(),name:"",items:[]}),t(O=>({...O,stepSections:N}))}},[n.steps,n.stepGroups,n.stepSections,t]);const s=n.stepSections||[],l=al(gr(Po,{activationConstraint:{distance:10}}),gr(qo,{activationConstraint:{delay:250,tolerance:5}}),gr(ol,{coordinateGetter:Gu})),o=({active:x,over:w})=>{if(!w)return;const _=x.id,N=w.id,j=s.find(O=>O.items.some(D=>D.id===_)),E=s.find(O=>O.items.some(D=>D.id===N))||s.find(O=>O.id===N);!j||!E||j===E||t(O=>{const D=j.items,$=E.items,z=D.findIndex(T=>T.id===_),C=$.findIndex(T=>T.id===N);let M;if(N===E.id)M=$.length+1;else{const F=w&&x.rect.current.translated&&x.rect.current.translated.top>w.rect.top+w.rect.height?1:0;M=C>=0?C+F:$.length+1}return{...O,stepSections:O.stepSections.map(T=>T.id===j.id?{...T,items:D.filter(F=>F.id!==_)}:T.id===E.id?{...T,items:[...$.slice(0,M),D[z],...$.slice(M,$.length)]}:T)}})},u=({active:x,over:w})=>{if(!w)return;const _=x.id,N=w.id,j=s.find(O=>O.items.some(D=>D.id===_)),E=s.find(O=>O.items.some(D=>D.id===N))||s.find(O=>O.id===N);if(j&&E&&j===E){const O=j.items.findIndex($=>$.id===_),D=E.items.findIndex($=>$.id===N);O!==D&&t($=>({...$,stepSections:$.stepSections.map(z=>z.id===j.id?{...z,items:Zi(z.items,O,D)}:z)}))}},d=(x,w,_)=>{t(N=>({...N,stepSections:N.stepSections.map(j=>{if(j.id!==x)return j;const E=[...j.items];return E[w]={...E[w],text:_},{...j,items:E}})}))},h=(x,w)=>{t(_=>({..._,stepSections:_.stepSections.map(N=>N.id===x?{...N,items:N.items.filter((j,E)=>E!==w)}:N)}))},f=x=>{const w={id:crypto.randomUUID(),text:""};t(_=>({..._,stepSections:_.stepSections.map(N=>N.id===x?{...N,items:[...N.items,w]}:N)}))},m=()=>{t(x=>({...x,stepSections:[...x.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},y=x=>{t(w=>({...w,stepSections:w.stepSections.filter(_=>_.id!==x)}))},v=(x,w)=>{t(_=>({..._,stepSections:_.stepSections.map(N=>N.id===x?{...N,name:w}:N)}))};return i.jsxs(Xi,{sensors:l,collisionDetection:u0,onDragOver:o,onDragEnd:u,children:[i.jsxs("div",{className:"recipe-form-steps",children:[s.map(x=>i.jsx(tl,{id:x.id,items:x.items.map(w=>w.id),strategy:Co,children:i.jsxs(ZE,{section:x,sections:s,onSectionChange:v,onRemoveSection:y,children:[x.items.map((w,_)=>i.jsx(XE,{id:w.id,index:_,item:w,groupId:x.id,onChange:d,onRemove:h},w.id)),i.jsx(se,{type:"button",variant:"ghost",onClick:()=>f(x.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},x.id)),i.jsx(se,{type:"button",variant:"secondary",onClick:m,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(E0,{dropAnimation:{sideEffects:xp({styles:{active:{opacity:"0.5"}}})},children:null})]})},hb=({onClose:n,onImport:t,initialMode:s="url"})=>{const l=ea(),[o,u]=b.useState(s),[d,h]=b.useState(null),[f,m]=b.useState(""),[y,v]=b.useState(""),[x,w]=b.useState(null),[_,N]=b.useState(null),[j,E]=b.useState(!1),[O,D]=b.useState(!1),[$,z]=b.useState(null),[C,M]=b.useState(!1),T=b.useRef(null),F=b.useRef(null),K=b.useRef(null),G=b.useRef(null),q=()=>{G.current&&(clearTimeout(G.current),G.current=null)},V=(A="")=>{if(q(),K.current){try{K.current.abort()}catch{}K.current=null}D(!1),A&&z(A)};b.useEffect(()=>()=>{if(q(),K.current){try{K.current.abort()}catch{}K.current=null}},[]),b.useEffect(()=>{if(!x){N(null);return}const A=URL.createObjectURL(x);return N(A),()=>URL.revokeObjectURL(A)},[x]);const P=A=>new Promise(X=>{if(!A||typeof A!="object")return X(A);const ce=String(A.type||"").toLowerCase();if(!ce.startsWith("image/"))return X(A);const Se=2e6,Ae=2e3,Be=.9,Le=String(A.name||"").toLowerCase(),Ge=ce.includes("heic")||ce.includes("heif")||Le.endsWith(".heic")||Le.endsWith(".heif"),W=URL.createObjectURL(A);let Ce=!1;const $e=ft=>{if(!Ce){Ce=!0;try{URL.revokeObjectURL(W)}catch{}X(ft)}},rt=setTimeout(()=>$e(A),15e3),mt=new Image;mt.onload=()=>{const ft=mt.naturalWidth||mt.width||0,Dt=mt.naturalHeight||mt.height||0;if(!ft||!Dt)return clearTimeout(rt),$e(A);const Vt=Math.min(1,Ae/Math.max(ft,Dt)),St=Math.max(1,Math.round(ft*Vt)),oe=Math.max(1,Math.round(Dt*Vt)),_e=Vt<1,Ne=Ge||A.size>Se;if(!_e&&!Ne)return clearTimeout(rt),$e(A);const Ie=document.createElement("canvas");Ie.width=St,Ie.height=oe;const it=Ie.getContext("2d");if(!it)return clearTimeout(rt),$e(A);it.drawImage(mt,0,0,St,oe),Ie.toBlob(ut=>{if(clearTimeout(rt),!ut)return $e(A);const kt=String(A.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);$e(new File([ut],`${kt}.jpg`,{type:"image/jpeg"}))},"image/jpeg",Be)},mt.onerror=()=>{clearTimeout(rt),$e(A)},mt.src=W}),L=async A=>{if(A){if(!String(A.type||"").startsWith("image/")){z("");return}z(null),E(!0);try{const X=await P(A);w(X||A)}finally{E(!1)}}},R=()=>T.current?.click?.(),I=()=>F.current?.click?.(),Y=A=>{A.preventDefault(),A.stopPropagation(),A.type==="dragenter"||A.type==="dragover"?M(!0):A.type==="dragleave"&&M(!1)},ue=A=>{if(A.preventDefault(),A.stopPropagation(),M(!1),A.dataTransfer.files&&A.dataTransfer.files[0]){const X=A.dataTransfer.files[0];X.type.startsWith("image/")&&L(X)}},ye=A=>/[---]/.test(A||""),B=async A=>{try{const X=[];X.push(A.name||""),X.push(A.description||"");const ce=[];Array.isArray(A.ingredients)&&A.ingredients.forEach((Ce,$e)=>{Ce.name&&(X.push(Ce.name),ce.push($e))});const Se=[];if(Array.isArray(A.steps)&&A.steps.forEach((Ce,$e)=>{X.push(Ce),Se.push($e)}),X.length===0)return A;const{data:Ae,error:Be}=await Re.functions.invoke("translate",{body:{text:X,target_lang:"JA"}});if(Be)throw Be;const Le=Ae.translations.map(Ce=>Ce.text);let Ge=0;const W={...A};return W.name=Le[Ge++]||W.name,W.description=Le[Ge++]||W.description,ce.length>0&&(W.ingredients=W.ingredients.map((Ce,$e)=>{const rt=ce.indexOf($e);return rt!==-1?{...Ce,name:Le[Ge+rt]}:Ce}),Ge+=ce.length),Se.length>0&&(W.steps=W.steps.map((Ce,$e)=>{const rt=Se.indexOf($e);return rt!==-1?Le[Ge+rt]:Ce})),W}catch(X){return console.error("Translation failed:",X),l.warning(""),A}},[J,Z]=b.useState([]),ge=async(A,X)=>{const ce="REDACTED_GOOGLE_API_KEY";if(A.size>4e6)return null;const Ae=await A.arrayBuffer(),Be=btoa(new Uint8Array(Ae).reduce((mt,ft)=>mt+String.fromCharCode(ft),"")),Le=A.type||"image/jpeg",W=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${ce}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`


: 
- 
- 

JSONJSON
\`\`\`json
{
  "title": "",
  "description": "",
  "ingredients": [
    { "name": "", "quantity": "", "unit": "", "group": null }
  ],
  "steps": ["1...", "2..."]
}
\`\`\`


- 115ml, 15ml, 1200ml 
- 
- `},{inline_data:{mime_type:Le,data:Be}}]}]}),signal:X});if(!W.ok){const mt=await W.text();throw console.error("Gemini API Error:",W.status,mt),new Error(`Gemini API Error: ${W.status}`)}const $e=(await W.json()).candidates?.[0]?.content?.parts?.[0]?.text;if(!$e)throw new Error("Gemini");let rt=$e;return rt.includes("```json")?rt=rt.split("```json")[1].split("```")[0]:rt.includes("```")&&(rt=rt.split("```")[1].split("```")[0]),{recipe:JSON.parse(rt.trim()),rawText:$e}},Me=async()=>{D(!0),z(null),Z([]);try{let A,X="";if(o==="url"){if(!y)return;X=y;const{data:Ae,error:Be}=await Re.functions.invoke("scrape-recipe",{body:{url:y}});if(Be)throw Be;A=Ae}else{if(!x)return;q();const Ae=new AbortController;K.current=Ae;const Be=12e4;G.current=setTimeout(()=>{V("")},Be);const Le="REDACTED_GOOGLE_API_KEY";let Ge=!1;if(Le){Z(W=>[...W," Gemini API..."]);try{const W=await ge(x,Ae.signal);W&&W.recipe&&W.recipe.title&&(Z(Ce=>[...Ce," "]),A={recipe:W.recipe,rawText:W.rawText},Ge=!0)}catch(W){if(W.name==="AbortError")throw W;console.warn("Direct Gemini failed, falling back to Edge Function:",W.message),Z(Ce=>[...Ce,` API: ${W.message}`])}}if(!Ge){Z(Dt=>[...Dt," ..."]);const W=new FormData;W.append("image",x);const{data:{session:Ce}}=await Re.auth.getSession(),rt="http://127.0.0.1:54321/functions/v1/analyze-image",mt={Authorization:`Bearer ${Ce?.access_token||"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH"}`};let ft;try{ft=await fetch(rt,{method:"POST",headers:mt,body:W,signal:Ae.signal})}catch(Dt){throw console.error("Network Error:",Dt),new Error("")}if(!ft.ok){const Dt=ft.status;throw new Error(`Server Error: ${ft.statusText} (${Dt})`)}if(!ft.body)A=await ft.json();else{const Dt=ft.body.getReader(),Vt=new TextDecoder;let St=null,oe="",_e=!1;for(;;){const{done:Ne,value:Ie}=await Dt.read();if(Ne)break;oe+=Vt.decode(Ie,{stream:!0});const it=oe.split(`

`);oe=it.pop()||"";for(const ut of it){const kt=ut.trim();if(kt.startsWith("data: "))try{const Jt=JSON.parse(kt.slice(6));if(Jt.type==="log")Z(Sn=>[...Sn,Jt.message]);else if(Jt.type==="result")St=Jt,_e=!0;else if(Jt.type==="error")throw new Error(Jt.message)}catch(Jt){if(Jt.message&&!Jt.message.includes("Failed to parse"))throw Jt;console.warn("Failed to parse SSE event",Jt)}}if(_e)break}try{await Dt.cancel()}catch{}if(!St)throw new Error("");A=St}}}if(A.error)throw new Error(A.error);if(!A.recipe)throw new Error("No recipe found");let ce=A.recipe;if(ce.name=ce.name||ce.title||"",ce.recipeYield=ce.recipeYield||ce.servings||"",ce.description=ce.description||"",!ce.ingredients&&ce.recipeIngredient&&(ce.ingredients=ce.recipeIngredient),Array.isArray(ce.ingredients)){const Ae=["","","method","instructions","steps","preparation"],Be=[],Le=[];ce.ingredients.forEach(Ge=>{const W=(Ge.group||"").trim().toLowerCase();if(W&&Ae.some(Ce=>W===Ce||W.includes(Ce))){const Ce=Ge.name||Ge.text||"";Ce&&Le.push(Ce)}else Be.push(Ge)}),Le.length>0&&(console.log("Extracted steps from ingredients:",Le),ce.ingredients=Be,ce.steps=Array.isArray(ce.steps)?ce.steps:[],ce.steps=[...ce.steps,...Le])}const Se=(ce.name||"")+(ce.steps?ce.steps.slice(0,3).join(""):"");if(Se&&!ye(Se)){h(ce),m(X),u("confirm-translation"),D(!1);return}t(ce,X),n()}catch(A){if(console.error("Import failed details:",A),A?.name==="AbortError")return;const X=A.message||"Import failed. Please try again.";z(X)}finally{q(),K.current=null,o!=="confirm-translation"&&D(!1)}},ve=async A=>{D(!0);try{let X=d;A&&(X=await B(d)),t(X,f),n()}catch(X){console.error("Translation flow error:",X),z("Translation failed. Importing original."),t(d,f),n()}finally{D(!1)}},ae=A=>{const X=A.target.files[0];X&&L(X),A.target.value=""};return i.jsxs("div",{className:"modal-overlay fade-in",children:[O&&i.jsxs("div",{className:"loading-overlay",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"..."}),J.length>0&&i.jsx("div",{className:"progress-log-container",children:i.jsxs("div",{className:"progress-log",children:[J.map((A,X)=>i.jsx("div",{className:"log-entry",children:i.jsx("span",{className:"log-message",children:A})},X)),i.jsx("div",{ref:A=>A?.scrollIntoView({behavior:"smooth"})})]})}),i.jsx("div",{style:{marginTop:"0.9rem",display:"flex",justifyContent:"center"},children:i.jsx(se,{type:"button",variant:"secondary",onClick:()=>V(),children:""})})]}),i.jsxs(tn,{className:"import-modal-card",children:[i.jsx("h3",{className:"modal-title",children:o==="confirm-translation"?"":""}),o==="confirm-translation"?i.jsxs("div",{className:"translation-confirm-content",children:[i.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),i.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),i.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[i.jsx(se,{type:"button",variant:"primary",onClick:()=>ve(!0),isLoading:O,style:{width:"100%"},children:""}),i.jsx(se,{type:"button",variant:"secondary",onClick:()=>ve(!1),disabled:O,style:{width:"100%"},children:""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"import-mode-tabs",children:[i.jsx("button",{type:"button",onClick:()=>u("url"),className:`tab-btn tab-import-web ${o==="url"?"active":""}`,children:" Web URL"}),i.jsx("button",{type:"button",onClick:()=>u("image"),className:`tab-btn tab-import-image ${o==="image"?"active":""}`,children:"  (Best Effort)"})]}),o==="url"?i.jsxs(i.Fragment,{children:[i.jsx("p",{children:"URL"}),i.jsx("input",{type:"url",placeholder:"https://...",value:y,onChange:A=>v(A.target.value),className:"import-url-input",autoFocus:!0})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{children:""}),i.jsxs("div",{className:"image-upload-wrapper",children:[i.jsx("input",{ref:T,type:"file",accept:"image/*",capture:"environment",onChange:ae,className:"image-upload-input"}),i.jsx("input",{ref:F,type:"file",accept:"image/*",onChange:ae,className:"image-upload-input"}),i.jsx("div",{onDragEnter:Y,onDragLeave:Y,onDragOver:Y,onDrop:ue,className:`image-upload-label ${C?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{O||j||I()},onKeyDown:A=>{O||j||(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),I())},children:_?i.jsx("img",{src:_,alt:"Preview",className:"image-upload-preview"}):C?"":""}),i.jsxs("div",{className:"image-upload-actions",children:[i.jsx(se,{type:"button",variant:"secondary",onClick:R,disabled:O||j,children:""}),i.jsx(se,{type:"button",variant:"secondary",onClick:I,disabled:O||j,children:""})]})]}),j&&i.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),$&&i.jsx("p",{className:"error-text",children:$}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(se,{type:"button",variant:"ghost",onClick:n,disabled:O,children:""}),i.jsx(se,{type:"button",variant:"primary",onClick:Me,isLoading:O,disabled:j||(o==="url"?!y:!x),children:""})]})]})]})]})},Tx=({onSave:n,onCancel:t,initialData:s})=>{const l=s||{},[o,u]=b.useState("ingredients"),[d,h]=b.useState(null),[f,m]=b.useState(new Map);we.useEffect(()=>{(async()=>{const P=await nr.fetchPriceList();m(P)})()},[]);const y=b.useMemo(()=>{const V=l.steps||[""];let P=l.stepGroups||[];const L=V.some(I=>typeof I=="object"&&I.group);if(P.length===0&&L){const I=new Map;V.forEach(Y=>{typeof Y=="object"&&Y.group&&!I.has(Y.group)&&I.set(Y.group,crypto.randomUUID())}),P=Array.from(I.entries()).map(([Y,ue])=>({id:ue,name:Y}))}return{steps:V.map(I=>{const Y=typeof I=="string"?I:I.text||"",ue=typeof I=="object"&&I.id?I.id:crypto.randomUUID();let ye=typeof I=="object"?I.groupId:void 0;const B=typeof I=="object"?I.group:void 0;if(!ye&&B&&P.length>0){const J=P.find(Z=>Z.name===B);J&&(ye=J.id)}return{id:ue,text:Y,groupId:ye}}),stepGroups:P}},[l]),v=y.steps,x=y.stepGroups,w=b.useMemo(()=>{const V=l.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let P=l.ingredientGroups||[];if(P.length===0&&V.some(R=>R.group)){const R=new Map;V.forEach(I=>{I.group&&!R.has(I.group)&&R.set(I.group,crypto.randomUUID())}),P=Array.from(R.entries()).map(([I,Y])=>({id:Y,name:I})),R.size>0&&V.some(I=>!I.group)}return{ingredients:V.map(R=>{const I=typeof R=="string"?{name:R,quantity:"",unit:"",cost:"",purchaseCost:""}:{...R,cost:R.cost||"",purchaseCost:R.purchaseCost||""};let Y=I.groupId;if(!Y&&I.group&&P.length>0){const ue=P.find(ye=>ye.name===I.group);ue&&(Y=ue.id)}return{...I,id:I.id||crypto.randomUUID(),groupId:Y}}),ingredientGroups:P}},[l]),_=w.ingredients,N=w.ingredientGroups,[j,E]=b.useState({title:l.title||"",description:l.description||"",image:l.image||"",imageFile:null,storeName:l.storeName||"",servings:l.servings||"",ingredients:_,ingredientGroups:N,steps:v,stepGroups:x,tags:l.tags||[""],course:l.course||"",category:l.category||"",type:l.type||"normal",flours:l.flours||[],breadIngredients:l.breadIngredients||[],sourceUrl:l.sourceUrl||""}),[O,D]=b.useState(!1),$=(V,P="")=>{const L=new Map,R=V.ingredients||[];R.forEach(Z=>{let ge=Z.group||"";ge==="Main"&&(ge=""),L.has(ge)||L.set(ge,crypto.randomUUID())});const I=Array.from(L.entries()).map(([Z,ge])=>({id:ge,name:Z})),Y=R.map(Z=>{let ge=Z.group||"";ge==="Main"&&(ge="");let Me;return L.has(ge)&&(Me=L.get(ge)),{id:crypto.randomUUID(),name:Z.name||"",quantity:Z.quantity||"",unit:Z.unit||"",cost:"",purchaseCost:"",groupId:Me}}),ue=new Map,ye=V.steps||[];ye.forEach(Z=>{typeof Z=="object"&&Z.group&&Z.group!=="Main"&&(ue.has(Z.group)||ue.set(Z.group,crypto.randomUUID()))});const B=Array.from(ue.entries()).map(([Z,ge])=>({id:ge,name:Z})),J=ye.map(Z=>{const ge=typeof Z=="object",Me=ge?Z.text||"":Z,ve=ge?Z.group:null;let ae;return ve&&ue.has(ve)&&(ae=ue.get(ve)),{id:crypto.randomUUID(),text:Me,groupId:ae}});E(Z=>({...Z,title:V.name||Z.title,description:V.description||Z.description,category:P?"URL":V.category||Z.category,image:V.image||Z.image,servings:V.recipeYield||Z.servings,ingredients:Y,ingredientGroups:I,steps:J,stepGroups:B,ingredientSections:void 0,stepSections:void 0,sourceUrl:P||Z.sourceUrl})),h(null),u("ingredients")},z=V=>{V.preventDefault(),V.stopPropagation(),V.type==="dragenter"||V.type==="dragover"?D(!0):V.type==="dragleave"&&D(!1)},C=V=>{if(V.preventDefault(),V.stopPropagation(),D(!1),V.dataTransfer.files&&V.dataTransfer.files[0]){const P=V.dataTransfer.files[0];P.type.startsWith("image/")&&E(L=>({...L,imageFile:P,image:URL.createObjectURL(P)}))}},M=V=>{const{id:P,value:L}=V.target;E(R=>({...R,[P]:L}))},T=V=>{const P=V.target.files[0];P&&E(L=>({...L,imageFile:P,image:URL.createObjectURL(P)}))},F=b.useMemo(()=>{if(j.type==="bread")return(j.flours?.length||0)+(j.breadIngredients?.length||0);const V=j.ingredientSections||[];return V.length>0?V.reduce((P,L)=>P+(L?.items?.length||0),0):j.ingredients?.length||0},[j.breadIngredients,j.flours,j.ingredientSections,j.ingredients,j.type]),K=b.useMemo(()=>{const V=j.stepSections||[];return V.length>0?V.reduce((P,L)=>P+(L?.items?.length||0),0):j.steps?.length||0},[j.stepSections,j.steps]),G=V=>{V.preventDefault();let P=[],L=[];if(j.type==="bread")P=j.ingredients.map(B=>{const{id:J,...Z}=B;return Z});else{const B=j.ingredientSections||[];B.length===0&&j.ingredients.length>0?P=j.ingredients.map(J=>{const{id:Z,...ge}=J;return ge}):(P=B.flatMap(J=>J.items.map(Z=>({...Z,groupId:J.id}))).map(J=>{const{id:Z,...ge}=J;return ge}),L=B.map(J=>({id:J.id,name:J.name})))}const R=new Set(j.tags||[]);j.course&&R.add(j.course),j.category&&R.add(j.category),j.type==="bread"&&R.add("");const I=Array.from(R).filter(Boolean);let Y=[],ue=[];const ye=j.stepSections||[];ye.length===0&&j.steps.length>0?Y=j.steps.map(B=>typeof B=="string"?{text:B}:B):(Y=ye.flatMap(B=>B.items.map(J=>({text:J.text,groupId:B.id}))),ue=ye.map(B=>({id:B.id,name:B.name}))),n({...j,ingredients:P,ingredientGroups:L,steps:Y,stepGroups:ue,image:j.imageFile||j.image,id:l.id||Date.now(),tags:I,ingredientSections:void 0,stepSections:void 0})},q=!!l?.id;return i.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:G,children:[d&&i.jsx(hb,{onClose:()=>h(null),onImport:$,initialMode:d}),i.jsxs("div",{className:"recipe-form-mock__page",children:[i.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:i.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[i.jsxs("div",{className:"recipe-form-mock__crumb",children:[i.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),i.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),i.jsx("span",{className:"recipe-form-mock__crumb-page",children:q?"":""})]}),i.jsxs("div",{className:"recipe-form-mock__actions",children:[i.jsx(se,{type:"button",variant:"ghost",onClick:t,children:""}),i.jsx(se,{type:"submit",variant:"primary",children:""})]})]})}),i.jsxs("div",{className:"recipe-form-mock__sheet",children:[i.jsxs("header",{className:"recipe-form-mock__doc",children:[i.jsxs("div",{className:"recipe-form-mock__doc-title",children:[i.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:j.title,onChange:M,placeholder:"",required:!0}),i.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),i.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(zt,{label:"",id:"course",value:j.course,onChange:M,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"course-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(zt,{label:"",id:"category",value:j.category,onChange:M,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"category-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(zt,{label:"",id:"storeName",value:j.storeName,onChange:M,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),i.jsx("datalist",{id:"store-options",children:bu.map(V=>i.jsx("option",{value:V},V))})]}),i.jsx("div",{className:"recipe-form-mock__meta-field",children:i.jsx(zt,{label:"",id:"servings",value:j.servings,onChange:M,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),i.jsxs("div",{className:"recipe-form-mock__grid",children:[i.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsx(zt,{label:"",id:"description",textarea:!0,value:j.description,onChange:M,placeholder:"..."}),i.jsx(zt,{label:"URL",id:"sourceUrl",value:j.sourceUrl||"",onChange:M,placeholder:"https://example.com/recipe/..."})]}),i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:`recipe-form-mock__image-drop ${O?"is-active":""}`,onDragEnter:z,onDragLeave:z,onDragOver:z,onDrop:C,children:[j.image?i.jsxs("div",{className:"recipe-form-mock__image-preview",children:[i.jsx("img",{src:j.image,alt:"",onError:V=>{V.target.style.display="none"}}),i.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>E(V=>({...V,image:"",imageFile:null})),title:"",children:""})]}):i.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",i.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),i.jsx("input",{type:"file",accept:"image/*",onChange:T,className:"recipe-form-mock__image-input"})]})]}),!l?.id&&i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:"recipe-form-mock__import-actions",children:[i.jsx(se,{variant:"secondary",type:"button",onClick:()=>h("url"),children:"URL"}),i.jsx(se,{variant:"secondary",type:"button",onClick:()=>h("image"),children:""})]}),i.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[i.jsx("li",{children:""}),i.jsx("li",{children:""}),i.jsx("li",{children:""})]})]})]}),i.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:i.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[i.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[i.jsxs("div",{className:"recipe-form-mock__nav",children:[i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:F.toLocaleString()})]}),i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${o==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:K.toLocaleString()})]})]}),i.jsx("div",{className:"recipe-form-mock__workspace-right",children:o==="ingredients"?i.jsxs("div",{className:"recipe-form-mock__segmented",children:[i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="normal"?"active":""}`,onClick:()=>E(V=>({...V,type:"normal"})),children:""}),i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="bread"?"active":""}`,onClick:()=>E(V=>({...V,type:"bread"})),children:""})]}):i.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),i.jsx("div",{className:"recipe-form-mock__workspace-body",children:o==="ingredients"?i.jsx("div",{className:"recipe-form-mock__editor-surface",children:j.type==="bread"?i.jsx(PE,{formData:j,setFormData:E}):i.jsx(JE,{formData:j,setFormData:E,priceList:f})}):i.jsx("div",{className:"recipe-form-mock__editor-surface",children:i.jsx(eT,{formData:j,setFormData:E})})})]})})]})]})]})]})},tT="modulepreload",nT=function(n){return"/app/"+n},kx={},wu=function(t,s,l){let o=Promise.resolve();if(s&&s.length>0){let f=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");o=f(s.map(m=>{if(m=nT(m),m in kx)return;kx[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":tT,y||(x.as="script"),x.crossOrigin="",x.href=m,h&&x.setAttribute("nonce",h),document.head.appendChild(x),y)return new Promise((w,_)=>{x.addEventListener("load",w),x.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return o.then(d=>{for(const h of d||[])h.status==="rejected"&&u(h.reason);return t().catch(u)})},rT=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},Qi={async fetchAllProfiles(){try{const{data:t,error:s}=await Re.rpc("admin_list_profiles");if(!s&&Array.isArray(t))return t;s&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",s)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const n=await Re.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await Re.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const l=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let o=null;if(l)try{const{data:d,error:h}=await Re.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(h)throw h;if(d){const f=rT(d);if(f)return f}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),o=d}const u=await Re.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(o&&l)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${o.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await Re.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminResetPassword(n,t){const{data:s,error:l}=await Re.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(l)throw l;if(s?.error)throw new Error(s.error);return s},async sendPasswordResetEmail(n){const{error:t}=await Re.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(t)throw t;return!0}},Rx="csv_unit_overrides",Ax=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),Mu={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:s,error:l}=await Re.from(Rx).select("ingredient_name,csv_unit").eq("user_id",t);if(l){if(Ax(l))return new Map;throw l}const o=new Map;return(s||[]).forEach(u=>{u?.ingredient_name&&o.set(String(u.ingredient_name),String(u.csv_unit||""))}),o}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,s=null){const l=s||await this._getCurrentUserId();if(!l)throw new Error("");const o=String(n||"").trim(),u=String(t||"").trim();if(!o)throw new Error("");if(!u)throw new Error("");const{data:d,error:h}=await Re.from(Rx).upsert({user_id:l,ingredient_name:o,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(h)throw Ax(h)?new Error("DB csv_unit_overrides "):h;return d}},sT=()=>{const n=ea(),{user:t}=os(),[s,l]=b.useState([]),[o,u]=b.useState(""),[d,h]=b.useState("all"),[f,m]=b.useState(null),[y,v]=b.useState(!1),[x,w]=b.useState(new Map),[_,N]=b.useState(new Map),[j,E]=b.useState({}),[O,D]=b.useState(!1),[$,z]=b.useState([]),[C,M]=b.useState(!1),[T,F]=b.useState(""),[K,G]=b.useState(""),[q,V]=b.useState(!1),[P,L]=b.useState(!1),[R,I]=b.useState(null),[Y,ue]=b.useState(!1),ye="manual",B=oe=>{const _e=String(oe||"").trim();return!_e||_e==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(_e)?_e:"food"},J=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:ye,label:""}],Z=b.useCallback(oe=>{const _e=nn(oe);return _e?x?.has(_e):!1},[x]),ge=we.useMemo(()=>{const oe={all:s.length,food:0,alcohol:0,soft_drink:0,supplies:0,[ye]:0};return s.forEach(_e=>{const Ne=B(_e?.itemCategory);oe[Ne]=(oe[Ne]||0)+1,Z(_e?.ingredientName)||(oe[ye]=(oe[ye]||0)+1)}),oe},[s,Z]),Me=b.useCallback(async()=>{v(!0);try{const[oe,_e,Ne]=await Promise.all([Pn.getAllConversions(),nr.fetchPriceList(),Mu.getAll()]),Ie=Array.from(oe.values()).map(it=>({...it,clientId:it.ingredientName,isNew:!1,isEditing:!1}));w(_e||new Map),N(Ne||new Map),l(Ie.sort((it,ut)=>it.ingredientName.localeCompare(ut.ingredientName,"ja")))}catch(oe){n.error(""),console.error("Failed to load ingredients:",oe)}v(!1)},[n]);b.useEffect(()=>{const oe=setTimeout(()=>{Me()},0);return()=>clearTimeout(oe)},[Me]);const ve=()=>{const oe=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,_e=["food","alcohol","soft_drink","supplies"].includes(d)?d:"food",Ne={clientId:oe,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:_e,isNew:!0,isEditing:!0};l(Ie=>[Ne,...Ie.map(it=>({...it,isEditing:!1}))]),m(oe)},ae=b.useCallback(oe=>s.findIndex(_e=>_e?.clientId===oe),[s]),A=async oe=>{const _e=ae(oe);if(_e<0)return;const Ne=s[_e];if(!Ne.ingredientName||!Ne.packetSize||!Ne.lastPrice){n.warning("");return}const Ie=parseFloat(Ne.yieldPercent),it=Number.isFinite(Ie)?Ie:100;if(it<=0||it>100){n.warning("% 1100 ");return}try{await Pn.saveConversion(Ne.ingredientName,Ne.packetSize,Ne.packetUnit,Ne.lastPrice,Ne.itemCategory,Ne.vendor,it),n.success(""),Me(),m(null)}catch(ut){n.error(""),console.error("Save error:",ut)}},X=async oe=>{const _e=ae(oe);if(_e<0)return;const Ne=s[_e],Ie=Ne?.ingredientName;if(Ne.isNew){l(it=>it.filter(ut=>ut?.clientId!==oe)),m(null);return}try{await Pn.deleteConversion(Ie),n.success(""),Me()}catch(it){n.error(""),console.error("Delete error:",it)}},ce=oe=>{m(oe),l(_e=>_e.map(Ne=>({...Ne,isEditing:Ne?.clientId===oe})))},Se=oe=>{const _e=ae(oe);_e<0||(s[_e].isNew?l(Ne=>Ne.filter(Ie=>Ie?.clientId!==oe)):Me(),m(null))},Ae=(oe,_e,Ne)=>{l(Ie=>Ie.map(it=>it?.clientId!==oe?it:{...it,[_e]:Ne}))},Be=oe=>{const _e=parseFloat(oe.lastPrice),Ne=parseFloat(oe.packetSize);if(!_e||!Ne)return"-";const Ie=oe.packetUnit?oe.packetUnit.trim().toLowerCase():"";return Ie==="g"||Ie===""?`${Math.round(_e/Ne*1e3).toLocaleString()}/kg`:Ie==="ml"||Ie==="cc"||Ie===""||Ie===""?`${Math.round(_e/Ne*1e3).toLocaleString()}/L`:`${Math.round(_e/Ne).toLocaleString()}/${oe.packetUnit}`},Le=s.filter(oe=>{const _e=String(oe?.ingredientName||"");return _e.toLowerCase().includes(o.toLowerCase())?d==="all"?!0:d===ye?!Z(_e):B(oe?.itemCategory)===d:!1}),Ge=d!=="all"||String(o||"").trim()!=="",W=oe=>{const _e=nn(oe);if(!_e)return"-";const Ie=(x?.get(_e)||null)?.unit;return Ie?String(Ie):"-"},Ce=oe=>{const _e=nn(oe);if(!_e)return"";const Ie=(x?.get(_e)||null)?.vendor;return Ie?String(Ie):""},$e=oe=>{const _e=String(oe?.vendor||"").trim();return _e||Ce(oe?.ingredientName)},rt=oe=>{const _e=(oe??"").toString().trim();if(!_e)return"";if(Object.prototype.hasOwnProperty.call(j,_e))return j[_e];const Ne=_?.get(_e);if(Ne)return String(Ne);const Ie=W(_e);return Ie==="-"?"":Ie},mt=oe=>{const _e=(oe??"").toString().trim();if(!_e)return"-";const Ne=_?.get(_e);return Ne?String(Ne):W(_e)},ft=async(oe,_e)=>{const Ne=(oe??"").toString().trim(),Ie=(_e??"").toString().trim();if(Ne){if(!Ie){E(it=>{const ut={...it};return delete ut[Ne],ut});return}try{await Mu.upsert(Ne,Ie),N(it=>{const ut=new Map(it);return ut.set(Ne,Ie),ut}),n.success("CSV")}catch(it){console.error(it),n.error(it?.message||"")}}},Dt=async()=>{if(t?.role==="admin"){D(!0),F(""),z([]),G(""),V(!1),I(null),ue(!1),M(!0);try{const oe=await Qi.fetchAllProfiles();z(oe||[])}catch(oe){console.error(oe),F("")}finally{M(!1)}}},Vt=()=>{P||(ue(!1),D(!1))},St=async()=>{if(!(!K||P)){L(!0),I({type:"info",message:"..."});try{const oe=await Pn.adminCopyIngredientMasterToUser(K,{overwrite:q}),_e=oe?.unit_conversions||{},Ne=oe?.csv_unit_overrides||{},Ie=`: ${Number(_e.source_total||0).toLocaleString()}   ${Number(_e.copied||0).toLocaleString()} /  ${Number(_e.updated||0).toLocaleString()} /  ${Number(_e.skipped||0).toLocaleString()}`,it=`(CSV): ${Number(Ne.source_total||0).toLocaleString()}   ${Number(Ne.copied||0).toLocaleString()} /  ${Number(Ne.updated||0).toLocaleString()} /  ${Number(Ne.skipped||0).toLocaleString()}`;I({type:"success",message:`
${Ie}
${it}`}),n.success("")}catch(oe){console.error(oe),I({type:"error",message:`: ${String(oe?.message||oe)}`}),n.error("")}finally{L(!1)}}};return i.jsxs("div",{className:"ingredient-master-container",children:[i.jsxs("div",{className:"master-header",children:[i.jsx("h3",{children:" "}),i.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[t?.role==="admin"&&i.jsx(se,{variant:"secondary",onClick:Dt,disabled:f!==null||y||P,title:f!==null?"":void 0,children:""}),i.jsx(se,{variant:"primary",onClick:ve,disabled:f!==null,children:"+ "})]})]}),i.jsx("div",{className:"master-search",children:i.jsx(zt,{placeholder:"...",value:o,onChange:oe=>u(oe.target.value)})}),i.jsxs("div",{className:"ingredient-master-stats",children:[i.jsxs("span",{children:[": ",i.jsx("strong",{children:(s.length||0).toLocaleString()})," "]}),Ge&&i.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",i.jsx("strong",{children:(Le.length||0).toLocaleString()})," "]})]}),i.jsx("div",{className:"ingredient-category-tabs",children:J.map(oe=>i.jsxs("button",{type:"button",className:`ingredient-category-tab ${d===oe.key?"active":""}`,onClick:()=>h(oe.key),disabled:f!==null,title:f!==null?"":void 0,children:[oe.label," (",(ge[oe.key]??0).toLocaleString(),")"]},oe.key))}),y?i.jsx("div",{className:"master-loading",children:"..."}):i.jsx("div",{className:"master-table-wrapper",children:i.jsxs("table",{className:"master-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{children:""}),i.jsx("th",{children:"%"}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:Le.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"8",style:{textAlign:"center",color:"#999"},children:Ge?"":""})}):Le.map((oe,_e)=>{const Ne=oe?.clientId??oe?.ingredientName??String(_e),Ie=Ce(oe?.ingredientName),it=String(oe?.vendor||"").trim(),ut=oe?.isEditing&&!!Ie&&Ie!==it,kt=$e(oe),Sn=B(oe?.itemCategory)==="food";return i.jsxs("tr",{className:oe.isEditing?"editing":"",children:[i.jsx("td",{children:oe.isEditing?i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx(zt,{value:oe.ingredientName,onChange:jt=>Ae(Ne,"ingredientName",jt.target.value),placeholder:": ",disabled:!oe.isNew,wrapperClassName:"input-group--no-margin"}),i.jsx(zt,{value:oe.vendor||"",onChange:jt=>Ae(Ne,"vendor",jt.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),ut&&i.jsxs("div",{className:"ingredient-subtext",children:["CSV: ",Ie]})]}):i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx("div",{children:oe.ingredientName}),kt&&i.jsx("div",{className:"ingredient-subtext",children:kt})]})}),i.jsx("td",{children:oe.isEditing?i.jsx(zt,{type:"number",value:oe.lastPrice,onChange:jt=>Ae(Ne,"lastPrice",jt.target.value),placeholder:": 500"}):`${parseFloat(oe.lastPrice||0).toLocaleString()}`}),i.jsx("td",{children:oe.isEditing?i.jsxs("div",{className:"input-with-hint",children:[i.jsx(zt,{type:"number",value:oe.packetSize,onChange:jt=>Ae(Ne,"packetSize",jt.target.value),placeholder:["","","","PC","","",""].includes(oe.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(oe.packetUnit)&&i.jsxs("span",{className:"unit-hint",children:["1",oe.packetUnit,"1"]})]}):oe.packetSize}),i.jsx("td",{children:oe.isEditing?i.jsxs("select",{value:oe.packetUnit,onChange:jt=>Ae(Ne,"packetUnit",jt.target.value),className:"unit-select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"cc",children:"cc"})]}):oe.packetUnit}),i.jsx("td",{className:"csv-unit-cell",children:oe.isEditing?i.jsx(zt,{value:rt(oe.ingredientName),onChange:jt=>{const rn=(oe.ingredientName??"").toString().trim(),cn=jt.target.value;E(xn=>({...xn,[rn]:cn}))},onBlur:jt=>ft(oe.ingredientName,jt.target.value),placeholder:W(oe.ingredientName)==="-"?"":`CSV: ${W(oe.ingredientName)}`}):i.jsx("span",{children:mt(oe.ingredientName)})}),i.jsx("td",{className:"normalized-cost",children:Be(oe)}),i.jsx("td",{children:Sn?oe.isEditing?i.jsx(zt,{type:"number",value:oe.yieldPercent??"",onChange:jt=>Ae(Ne,"yieldPercent",jt.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const jt=parseFloat(oe.yieldPercent);if(!Number.isFinite(jt)||jt<=0)return"-";const rn=Math.round(jt*10)/10;return`${Number.isInteger(rn)?Math.round(rn):rn}%`})():i.jsx("span",{style:{color:"#999"},children:"-"})}),i.jsx("td",{children:i.jsx("div",{className:"action-buttons",children:oe.isEditing?i.jsxs(i.Fragment,{children:[i.jsx(se,{variant:"primary",size:"sm",onClick:()=>A(Ne),children:""}),i.jsx(se,{variant:"ghost",size:"sm",onClick:()=>Se(Ne),children:""})]}):i.jsxs(i.Fragment,{children:[i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>ce(Ne),disabled:f!==null,children:""}),i.jsx(se,{variant:"ghost",size:"sm",onClick:()=>X(Ne),disabled:f!==null,children:""})]})})})]},Ne)})})]})}),i.jsx("div",{className:"master-info",children:i.jsx("p",{children:" "})}),i.jsx(yn,{isOpen:O,onClose:Vt,title:"",size:"medium",showCloseButton:!P,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",i.jsx("br",{}),i.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),Y?i.jsxs(i.Fragment,{children:[(()=>{const oe=$.find(Ne=>String(Ne?.id)===String(K)),_e=oe?`${oe.display_id}${oe.email?` (${oe.email})`:""}`:K?String(K).slice(0,8):"-";return i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",i.jsx("strong",{children:_e}),i.jsx("br",{}),": ",i.jsx("strong",{children:q?"":""})]})]})})(),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>ue(!1),disabled:P,children:""}),i.jsx(se,{variant:"primary",onClick:St,disabled:!K||P,children:P?"...":""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),C?i.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):i.jsxs("select",{value:K,onChange:oe=>G(oe.target.value),disabled:P||!!T,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:P?"#f3f4f6":"white"},children:[i.jsx("option",{value:"",children:"..."}),$.filter(oe=>String(oe?.id)&&String(oe?.id)!==String(t?.id)).map(oe=>i.jsxs("option",{value:oe.id,children:[oe.display_id,oe.email?` (${oe.email})`:"",oe.role==="admin"?" []":""]},oe.id))]}),T&&i.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:T})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[i.jsx("input",{type:"checkbox",checked:q,onChange:oe=>V(oe.target.checked),disabled:P}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(se,{variant:"ghost",onClick:Vt,disabled:P,children:""}),i.jsx(se,{variant:"primary",onClick:()=>ue(!0),disabled:!K||P||C||!!T,children:""})]})]}),P&&i.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),R?.message&&i.jsx("div",{className:`status-msg ${R.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:R.message})]})})]})},fu="__all_vendors__",fb="__unknown_vendor__",ao="__all_categories__",Mf="food",Su=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],sp=Su.reduce((n,t)=>(n[t.value]=t.label,n),{}),iT=new Set(["","","","","PC","","",""]),Pi=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const s=Number(t);return Number.isFinite(s)?s:null},Ox=n=>(typeof n=="string"?n.trim():"")||fb,Ga=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?Mf:sp[t]?t:Mf},aT=()=>{const[n,t]=b.useState([]),[s,l]=b.useState(!0),[o,u]=b.useState(null),[d,h]=b.useState(null),[f,m]=b.useState("all"),[y,v]=b.useState({key:null,direction:"asc"}),[x,w]=b.useState(""),[_,N]=b.useState(ao),[j,E]=b.useState(fu),[O,D]=b.useState(!1),[$,z]=b.useState(null),C=b.useRef(null),M=ea(),[T,F]=b.useState({isOpen:!1,title:"",message:"",onConfirm:null}),K=()=>{h(A=>!A||A.phase==="running"?A:null)};b.useEffect(()=>{G()},[]);const G=async()=>{l(!0),z(null);try{console.log("Starting data load for CsvToMasterImporter...");const[A,X]=await Promise.all([nr.getPriceListArray().catch(Se=>(console.error("Error fetching price list:",Se),[])),Pn.getAllConversions().catch(Se=>(console.error("Error fetching conversions:",Se),new Map))]);if(console.log("Data fetched:",{csvCount:A?.length,masterSize:X?.size}),!Array.isArray(A))throw new Error("CSV");if(!(X instanceof Map))throw new Error("Map");const ce=[];for(const Se of A){if(!Se||!Se.name)continue;const Ae=X.get(Se.name),Be=Ga(Ae?.itemCategory),Le=Ae?.packetSize??"",Ge=Ae?.packetUnit||Se.unit||"",W=Ae?.lastPrice??"",Ce=Ae?Le:iT.has(Ge)?1:"";ce.push({name:Se.name,csvPrice:Se.price,csvUnit:Se.unit,csvVendor:Se.vendor,masterCategory:Be,masterSize:Le,masterUnit:Ge,masterPrice:W,isRegistered:!!Ae,inputSize:Ce,inputUnit:Ge,inputPrice:Ae?W:Se.price??"",inputCategory:Be,isModified:!1})}console.log("Merge completed. Items:",ce.length),t(ce)}catch(A){console.error("Failed to load data for importer:",A),z(A.message||"")}finally{l(!1)}},q=async A=>{u(A.name);try{const X=Pi(A.inputSize),ce=Pi(A.inputPrice);if(X===null||X<=0){M.error("");return}if(!A.inputUnit){M.error("");return}if(!A.inputCategory){M.error("");return}await Pn.saveConversion(A.name,X,A.inputUnit,ce,A.inputCategory),t(Se=>Se.map(Ae=>Ae.name===A.name?{...Ae,isRegistered:!0,isModified:!1,masterSize:X,masterUnit:A.inputUnit,masterPrice:ce??"",masterCategory:A.inputCategory,inputCategory:A.inputCategory}:Ae)),M.success("")}catch(X){console.error("Failed to save ingredient:",X),M.error("")}finally{u(null)}},V=async A=>{F(X=>({...X,isOpen:!1}));try{const X=A.filter(oe=>{const _e=Pi(oe.inputSize);return!(_e!==null&&_e>0)||!oe.inputUnit||!oe.inputCategory});if(X.length>0){const oe=X.slice(0,5).map(Ne=>Ne.name).join(""),_e=X.length>5?` ${X.length-5}`:"";M.error(`: ${oe}${_e}`);return}u("bulk");const ce=A.length;h({phase:"running",total:ce,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const Se=5,Ae=120;let Be=0,Le=0,Ge=0,W=0;const Ce=[],$e=[],rt=(oe=!1,_e="")=>{const Ne=Date.now();!oe&&Ne-W<Ae||(W=Ne,h(Ie=>!Ie||Ie.phase!=="running"?Ie:{...Ie,processed:Be,success:Le,failed:Ge,currentName:_e||Ie.currentName}))};let mt=0;const ft=async()=>{for(;;){const oe=mt++;if(oe>=A.length)return;const _e=A[oe],Ne=_e?.name?String(_e.name):"";try{const Ie=Pi(_e.inputSize),it=Pi(_e.inputPrice);if(Ie===null||Ie<=0)throw new Error("Invalid size");if(!_e.inputUnit)throw new Error("Invalid unit");if(!_e.inputCategory)throw new Error("Invalid category");await Pn.saveConversion(_e.name,Ie,_e.inputUnit,it,_e.inputCategory),Le++,Ce.push(_e)}catch(Ie){Ge++,$e.push(Ne||`#${oe+1}`),console.error(`Failed to save ${Ne}:`,Ie)}finally{Be++,rt(!1,Ne)}}},Dt=Math.min(Se,A.length);await Promise.all(Array.from({length:Dt},()=>ft())),rt(!0);const Vt=new Set(Ce.map(oe=>oe.name)),St=new Map(A.map(oe=>[oe.name,oe]));t(oe=>oe.map(_e=>{if(Vt.has(_e.name)){const Ne=St.get(_e.name);return{..._e,isRegistered:!0,isModified:!1,masterSize:Pi(Ne.inputSize)??"",masterUnit:Ne.inputUnit,masterPrice:Pi(Ne.inputPrice)??"",masterCategory:Ne.inputCategory,inputCategory:Ne.inputCategory}}return _e})),Ge===0?M.success(`${Le} `):M.warning(`:  ${Le}  /  ${Ge} `),h({phase:"done",total:ce,processed:Be,success:Le,failed:Ge,currentName:"",failedNames:$e.slice(0,10)})}catch(X){console.error("Bulk save error:",X),M.error(""),h(ce=>({phase:"error",total:ce?.total??A.length,processed:ce?.processed??0,success:ce?.success??0,failed:ce?.failed??0,currentName:"",failedNames:ce?.failedNames??[],errorMessage:X?.message?String(X.message):""}))}finally{u(null)}},P=()=>{const A=n.filter(X=>X.isModified);A.length!==0&&F({isOpen:!0,title:"",message:`${A.length} `,onConfirm:()=>V(A)})},L=(A,X,ce)=>{t(Se=>Se.map(Ae=>Ae.name===A?{...Ae,[X]:ce,isModified:!0}:Ae))},R=A=>{(A.key==="ArrowUp"||A.key==="ArrowDown")&&A.preventDefault()},I=A=>{v(X=>X.key===A?{key:A,direction:X.direction==="asc"?"desc":"asc"}:{key:A,direction:"asc"})},Y=A=>y.key!==A?"":y.direction==="asc"?" ":" ",ue=b.useMemo(()=>{const A=new Map;n.forEach(ce=>{const Se=Ox(ce.csvVendor),Ae=Se===fb?"":Se,Be=A.get(Se);Be?Be.count+=1:A.set(Se,{key:Se,label:Ae,count:1})});const X=Array.from(A.values()).sort((ce,Se)=>ce.label.localeCompare(Se.label,"ja"));return[{key:fu,label:"",count:n.length},...X]},[n]);b.useEffect(()=>{ue.some(X=>X.key===j)||E(fu)},[ue,j]),b.useEffect(()=>{if(!O)return;const A=ce=>{C.current&&!C.current.contains(ce.target)&&D(!1)},X=ce=>{ce.key==="Escape"&&D(!1)};return document.addEventListener("mousedown",A),document.addEventListener("touchstart",A),document.addEventListener("keydown",X),()=>{document.removeEventListener("mousedown",A),document.removeEventListener("touchstart",A),document.removeEventListener("keydown",X)}},[O]);const ye=b.useMemo(()=>j===fu?n:n.filter(A=>Ox(A.csvVendor)===j),[n,j]),B=b.useMemo(()=>{const A={[ao]:ye.length};return Su.forEach(X=>{A[X.value]=0}),ye.forEach(X=>{const ce=Ga(X.inputCategory);A[ce]=(A[ce]||0)+1}),A},[ye]),J=b.useMemo(()=>_===ao?ye:ye.filter(A=>Ga(A.inputCategory)===_),[ye,_]),Z=b.useMemo(()=>({all:J.length,unregistered:J.filter(A=>!A.isRegistered).length,registered:J.filter(A=>A.isRegistered).length}),[J]),ge=b.useMemo(()=>ue.find(A=>A.key===j)||ue[0],[ue,j]),Me=b.useMemo(()=>J.filter(A=>!(f==="unregistered"&&A.isRegistered||f==="registered"&&!A.isRegistered||x&&!A.name.includes(x))),[J,f,x]),ve=b.useMemo(()=>{if(!y.key)return Me;const A=Se=>String(Se??""),X=Se=>{const Ae=parseFloat(Se);return Number.isFinite(Ae)?Ae:Number.NEGATIVE_INFINITY},ce=[...Me];return ce.sort((Se,Ae)=>{let Be=0;switch(y.key){case"name":Be=A(Se.name).localeCompare(A(Ae.name),"ja");break;case"csvPrice":Be=X(Se.csvPrice)-X(Ae.csvPrice);break;case"inputCategory":{const Le=sp[Ga(Se.inputCategory)]||"",Ge=sp[Ga(Ae.inputCategory)]||"";Be=Le.localeCompare(Ge,"ja");break}case"inputSize":Be=X(Se.inputSize)-X(Ae.inputSize);break;case"inputUnit":Be=A(Se.inputUnit).localeCompare(A(Ae.inputUnit),"ja");break;case"inputPrice":Be=X(Se.inputPrice)-X(Ae.inputPrice);break;default:Be=0;break}return Be===0&&(Be=A(Se.name).localeCompare(A(Ae.name),"ja")),y.direction==="asc"?Be:-Be}),ce},[Me,y]),ae=n.filter(A=>A.isModified).length;return s?i.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):$?i.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[i.jsx("h3",{children:""}),i.jsx("p",{children:$}),i.jsx(se,{variant:"secondary",onClick:G,children:""})]}):i.jsxs("div",{className:"csv-importer",children:[i.jsxs("div",{className:"importer-header",children:[i.jsx(zt,{placeholder:"...",value:x,onChange:A=>w(A.target.value),style:{maxWidth:"300px"}}),i.jsxs("div",{className:"filter-buttons",children:[i.jsxs(se,{variant:f==="all"?"primary":"secondary",onClick:()=>m("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",Z.all,")"]}),i.jsxs(se,{variant:f==="unregistered"?"primary":"secondary",onClick:()=>m("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",Z.unregistered,")"]}),i.jsxs(se,{variant:f==="registered"?"primary":"secondary",onClick:()=>m("registered"),size:"sm",children:[" (",Z.registered,")"]})]}),i.jsxs("div",{className:"vendor-dropdown",ref:C,children:[i.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>D(A=>!A),"aria-haspopup":"listbox","aria-expanded":O,children:[i.jsxs("span",{children:[": ",ge?.label," (",ge?.count??0,")"]}),i.jsx("span",{className:`vendor-dropdown-chevron ${O?"open":""}`,children:""})]}),O&&i.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:ue.map(A=>i.jsxs("button",{type:"button",className:`vendor-tab ${j===A.key?"active":""}`,onClick:()=>{E(A.key),D(!1)},role:"option","aria-selected":j===A.key,children:[A.label," (",A.count,")"]},A.key))})]}),i.jsxs("div",{className:"category-filter-row",children:[i.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),i.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:_,onChange:A=>N(A.target.value),children:[i.jsxs("option",{value:ao,children:[" (",B[ao]||0,")"]}),Su.map(A=>i.jsxs("option",{value:A.value,children:[A.label," (",B[A.value]||0,")"]},A.value))]})]}),i.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[ae>0&&i.jsx(se,{variant:"primary",size:"sm",onClick:P,disabled:o!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o==="bulk"?"...":`(${ae})`}),i.jsx(se,{variant:"secondary",size:"sm",onClick:G,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{style:{width:"22%"},onClick:()=>I("name"),children:[" (CSV)",Y("name")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>I("csvPrice"),children:[" (CSV)",Y("csvPrice")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>I("inputCategory"),children:[" ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputCategory")]}),i.jsxs("th",{style:{width:"18%"},onClick:()=>I("inputSize"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputSize")]}),i.jsxs("th",{style:{width:"13%"},onClick:()=>I("inputUnit"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputUnit")]}),i.jsxs("th",{style:{width:"12%"},onClick:()=>I("inputPrice"),children:[" ()",Y("inputPrice")]}),i.jsx("th",{style:{width:"7%"},children:""})]})}),i.jsx("tbody",{children:ve.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:""})}):ve.map(A=>i.jsxs("tr",{style:{backgroundColor:A.isModified?"#fff8e1":A.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[i.jsxs("td",{style:{fontWeight:"500"},children:[A.name,A.csvVendor&&i.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:A.csvVendor})]}),i.jsxs("td",{children:[A.csvPrice?`${A.csvPrice.toLocaleString()} `:"-",A.csvUnit&&i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",A.csvUnit]})]}),i.jsx("td",{children:i.jsx("select",{className:"input-field",value:Ga(A.inputCategory),onChange:X=>L(A.name,"inputCategory",X.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:Su.map(X=>i.jsx("option",{value:X.value,children:X.label},X.value))})}),i.jsx("td",{children:i.jsx(zt,{type:"number",value:A.inputSize,onChange:X=>L(A.name,"inputSize",X.target.value),onKeyDown:R,placeholder:["","","","PC","","",""].includes(A.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),i.jsx("td",{children:i.jsxs("select",{className:"input-field",value:A.inputUnit,onChange:X=>L(A.name,"inputUnit",X.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","","","","","PC","","",""].includes(A.inputUnit)&&A.inputUnit&&i.jsxs("option",{value:A.inputUnit,children:[A.inputUnit," (CSV)"]}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"kg",children:"kg"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"L",children:"L"}),i.jsx("option",{value:"cc",children:"cc"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"PC",children:"PC"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""})]})}),i.jsx("td",{children:i.jsx(zt,{type:"number",value:A.inputPrice,onChange:X=>L(A.name,"inputPrice",X.target.value),placeholder:"",style:{width:"100%"}})}),i.jsx("td",{children:i.jsx(se,{variant:A.isRegistered?"secondary":"primary",size:"sm",onClick:()=>q(A),disabled:o===A.name||o==="bulk",block:!0,children:o===A.name?"...":A.isRegistered?"":""})})]},A.name))})]})}),i.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[i.jsx("p",{children:" CSV"}),i.jsx("p",{children:" "})]}),i.jsxs(yn,{isOpen:T.isOpen,onClose:()=>F({...T,isOpen:!1}),title:T.title,size:"small",children:[i.jsx("div",{style:{marginBottom:"1.5rem"},children:T.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[i.jsx(se,{variant:"secondary",onClick:()=>F({...T,isOpen:!1}),children:""}),i.jsx(se,{variant:"primary",onClick:T.onConfirm,children:""})]})]}),i.jsx(yn,{isOpen:!!d,onClose:K,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?i.jsxs("div",{className:"bulk-progress",children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:""}),i.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),i.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&i.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&i.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),i.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[i.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(se,{variant:"primary",onClick:K,children:""})})]}):i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),i.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(se,{variant:"primary",onClick:K,children:""})})]})})]})},Dx=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},lT=({onBack:n})=>{const[t,s]=Lo(),{user:l}=os(),[o,u]=b.useState("price"),[d,h]=b.useState(null),[f,m]=b.useState({type:"",message:""}),[y,v]=b.useState(!1),[x,w]=b.useState([]),[_,N]=b.useState(!1),[j,E]=b.useState(null),[O,D]=b.useState({type:"",message:""}),[$,z]=b.useState(null),[C,M]=b.useState(!1),[T,F]=b.useState(!1),[K,G]=b.useState(!1),[q,V]=b.useState([]),[P,L]=b.useState(!1),[R,I]=b.useState(""),[Y,ue]=b.useState(""),[ye,B]=b.useState(!1),[J,Z]=b.useState({total:0,done:0,current:""}),[ge,Me]=b.useState(null),[ve,ae]=b.useState(!1),[A,X]=b.useState(!1),[ce,Se]=b.useState(new Map),[Ae,Be]=b.useState([]),[Le,Ge]=b.useState(""),[W,Ce]=b.useState(""),[$e,rt]=b.useState(""),mt=we.useMemo(()=>{if(!Le)return[];const me=ce.get(Le)||[],Ke=new Set;return me.forEach(Ze=>{const Ye=Dx(Ze?.dateStr);Ye&&Ke.add(Ye)}),Array.from(Ke).sort((Ze,Ye)=>Ye.localeCompare(Ze))},[ce,Le]);b.useEffect(()=>{if($e){if(!Le){rt("");return}mt.length>0&&!mt.includes($e)&&rt("")}},[mt,$e,Le]);const[ft,Dt]=b.useState({key:"dateStr",direction:"desc"}),[Vt,St]=b.useState("");b.useEffect(()=>{const me=t.get("tab");(me==="price"||me==="ingredients"||me==="csv-import"||me==="duplicates")&&u(me)},[]);const oe=me=>{let Ke="asc";ft.key===me&&ft.direction==="asc"&&(Ke="desc"),Dt({key:me,direction:Ke})},_e=we.useMemo(()=>{let me=[...x];if(Vt){const Ke=Vt.toLowerCase().trim();me=me.filter(Ze=>Ze.name&&Ze.name.toLowerCase().includes(Ke)||Ze.vendor&&Ze.vendor.toLowerCase().includes(Ke)||Ze.dateStr&&Ze.dateStr.includes(Ke))}return ft.key&&me.sort((Ke,Ze)=>{let Ye=Ke[ft.key]||"",tt=Ze[ft.key]||"";return Ye<tt?ft.direction==="asc"?-1:1:Ye>tt?ft.direction==="asc"?1:-1:0}),me},[x,ft,Vt]),[Ne,Ie]=b.useState([]);b.useEffect(()=>{ut()},[]);const it=async()=>{X(!0);try{const Ke=await nr.fetchPriceHistory()||new Map;Se(Ke);const Ze=[];for(const[Ye,tt]of Ke.entries()){const Mt=new Set,xt=[];if((tt||[]).forEach(re=>{const ne=[String(re?.dateStr||""),String(re?.price??""),String(re?.incomingQty??""),String(re?.unit||""),String(re?.vendor||""),String(re?.displayName||"")].join("|");Mt.has(ne)||(Mt.add(ne),xt.push(re))}),xt.length<2)continue;xt.sort((re,ne)=>String(re?.dateStr||"").localeCompare(String(ne?.dateStr||"")));const Rt=xt[xt.length-1]||{},et=xt.map(re=>Number(re?.price)).filter(re=>Number.isFinite(re)),Bt=et.length?Math.min(...et):null,We=et.length?Math.max(...et):null,Ut=new Set(xt.map(re=>String(re?.dateStr||""))).size,Xt=new Set(xt.map(re=>String(re?.displayName||""))).size;let Qt=0;for(let re=1;re<xt.length;re++){const ne=Number(xt[re-1]?.price),fe=Number(xt[re]?.price);Number.isFinite(ne)&&Number.isFinite(fe)&&ne!==fe&&Qt++}Ze.push({key:Ye,name:Rt?.displayName||Ye,lastDate:Rt?.dateStr||"",lastPrice:Number.isFinite(Number(Rt?.price))?Number(Rt?.price):null,lastIncomingQty:Number.isFinite(Number(Rt?.incomingQty))?Number(Rt?.incomingQty):null,unit:Rt?.unit||"",vendor:Rt?.vendor||"",rows:xt.length,dates:Ut,nameVariants:Xt,minPrice:Bt,maxPrice:We,changes:Qt})}Ze.sort((Ye,tt)=>{const Mt=String(Ye?.lastDate||""),xt=String(tt?.lastDate||"");return Mt!==xt?xt.localeCompare(Mt):(tt?.changes||0)!==(Ye?.changes||0)?(tt?.changes||0)-(Ye?.changes||0):(tt?.rows||0)!==(Ye?.rows||0)?(tt?.rows||0)-(Ye?.rows||0):String(Ye?.name||"").localeCompare(String(tt?.name||""),"ja")}),Be(Ze),Le&&!Ke.has(Le)&&Ge("")}catch(me){console.error(me)}finally{X(!1)}};b.useEffect(()=>{o==="duplicates"&&it()},[o]);const ut=async()=>{N(!0);try{const me=await nr.getPriceListArray();w(me);const Ke=await nr.getFileList();Ie(Ke)}catch(me){console.error("Failed to load price data",me)}finally{N(!1)}},kt=me=>{me.target.files&&me.target.files[0]&&(h(me.target.files[0]),m({type:"",message:""}))},Jt=async()=>{if(!d)return;v(!0),m({type:"info",message:"..."});const me=await nr.uploadPriceList(d);if(me.success){m({type:"success",message:"..."});try{const{recipeService:Ze}=await wu(async()=>{const{recipeService:Mt}=await Promise.resolve().then(()=>vf);return{recipeService:Mt}},[]),Ye=await nr.fetchPriceList(),tt=await Ze.updateRecipeCosts(Ye);m({type:"success",message:`${tt}`})}catch(Ze){console.error("Cost update failed",Ze),m({type:"warning",message:""})}h(null);const Ke=document.getElementById("csv-upload-input");Ke&&(Ke.value=""),ut()}else m({type:"error",message:`: ${me.error.message}`});v(!1)},Sn=me=>{E({message:`${me}
`,onConfirm:async()=>{v(!0);const Ke=await nr.deletePriceFile(me);v(!1),Ke.success?(m({type:"success",message:""}),ut()):m({type:"error",message:`: ${Ke.error.message}`})}})},jt=me=>{me&&(z(me),M(!0),D({type:"",message:""}))},rn=()=>{if(T)return;M(!1),z(null);const me=document.getElementById("backup-upload-input");me&&(me.value="")},cn=async()=>{const me=$;if(!(!me||T)){F(!0),D({type:"info",message:"..."});try{const Ke=await me.text(),Ze=JSON.parse(Ke),{recipeService:Ye}=await wu(async()=>{const{recipeService:Rt}=await Promise.resolve().then(()=>vf);return{recipeService:Rt}},void 0),tt=await Ye.importRecipes(Ze),Mt=Number(tt?.count||0),xt=Array.isArray(tt?.errors)?tt.errors.length:0;D({type:xt>0?"warning":"success",message:`: ${Mt}${xt>0?` / : ${xt}`:""}`}),M(!1),z(null)}catch(Ke){console.error(Ke),D({type:"error",message:""})}finally{F(!1);const Ke=document.getElementById("backup-upload-input");Ke&&(Ke.value="")}}},xn=async()=>{G(!0),Me(null),Z({total:0,done:0,current:""}),ue(""),I(""),ae(!1),L(!0);try{const me=await Qi.fetchAllProfiles();V(me||[])}catch(me){console.error(me),V([]),I("")}finally{L(!1)}},Ln=()=>{ye||(ae(!1),G(!1))},ar=async()=>{if(!(!Y||ye)){B(!0),Me({type:"info",message:"..."}),Z({total:0,done:0,current:""});try{const me=await nr.copyPriceFilesToUser({targetUserId:Y,onProgress:({total:Ye,done:tt,current:Mt})=>{Z({total:Ye||0,done:tt||0,current:Mt||""})}}),Ke=me?.copied?.length??0,Ze=me?.failed?.length??0;Me({type:Ze>0?"error":"success",message:`: ${Ke}${Ze>0?` / : ${Ze}`:""}`,failed:me?.failed||[]})}catch(me){console.error(me),Me({type:"error",message:`: ${String(me?.message||me)}`})}finally{B(!1)}}};return i.jsxs("div",{className:["dashboard-container","fade-in",o==="ingredients"||o==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[i.jsxs("div",{className:"dashboard-header",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),i.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[o==="csv-import"&&i.jsx(se,{variant:"secondary",onClick:()=>s({view:"inventory"}),title:"",children:" "}),i.jsx(se,{variant:"ghost",onClick:n,children:" "})]})]}),i.jsx("div",{className:"tabs-container",children:i.jsxs("div",{className:"tabs",children:[i.jsx("button",{className:`tab ${o==="price"?"active":""}`,onClick:()=>u("price"),children:" "}),i.jsx("button",{className:`tab ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:" "}),i.jsx("button",{className:`tab ${o==="csv-import"?"active":""}`,onClick:()=>u("csv-import"),children:" CSV"}),i.jsx("button",{className:`tab ${o==="duplicates"?"active":""}`,onClick:()=>u("duplicates"),children:" "})]})}),o==="ingredients"?i.jsx(sT,{}):o==="csv-import"?i.jsx(aT,{}):o==="duplicates"?i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Ae.length.toLocaleString(),""]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[i.jsx(zt,{placeholder:"...",value:W,onChange:me=>Ce(me.target.value),style:{flex:1,fontSize:"0.9rem"}}),i.jsx(se,{variant:"secondary",size:"sm",onClick:it,disabled:A,title:"",children:""})]}),i.jsx("div",{className:"dup-list",children:A?i.jsx("div",{className:"dup-empty",children:"..."}):Ae.length===0?i.jsx("div",{className:"dup-empty",children:"2"}):Ae.filter(me=>{const Ke=String(W||"").trim();return Ke?String(me?.name||"").includes(Ke):!0}).map(me=>{const Ke=me.key===Le,Ze=me.minPrice!==null&&me.maxPrice!==null&&me.minPrice!==me.maxPrice;return i.jsxs("button",{type:"button",className:`dup-item ${Ke?"active":""}`,onClick:()=>Ge(me.key),children:[i.jsxs("div",{className:"dup-item-top",children:[i.jsx("div",{className:"dup-item-name",title:me.name,children:me.name}),Ze&&i.jsx("span",{className:"dup-badge",children:""})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[": ",me.lastDate||"-"]}),i.jsxs("span",{children:[": ",me.rows,""]}),i.jsxs("span",{children:[": ",me.dates,""]})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[me.lastPrice!==null?`${Math.round(me.lastPrice).toLocaleString()}`:"-",me.unit?` / ${me.unit}`:""]}),i.jsxs("span",{children:[": ",me.lastIncomingQty!==null?Math.round(me.lastIncomingQty).toLocaleString():"-"]}),me.vendor?i.jsxs("span",{title:me.vendor,children:[": ",me.vendor]}):i.jsx("span",{children:": -"})]}),me.nameVariants>1&&i.jsxs("div",{className:"dup-item-note",children:[": ",me.nameVariants,""]})]},me.key)})})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:Le?"":""})}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsxs("select",{value:$e,onChange:me=>rt(me.target.value),disabled:!Le,title:Le?"":"",className:"dup-month-select",children:[i.jsx("option",{value:"",children:""}),mt.map(me=>i.jsx("option",{value:me,children:me.replace("-","/")},me))]}),i.jsx(se,{variant:"secondary",size:"sm",onClick:it,disabled:A,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:(()=>{if(!Le)return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const me=ce.get(Le)||[],Ke=new Set,Ze=[];me.forEach(et=>{const Bt=[String(et?.dateStr||""),String(et?.price??""),String(et?.incomingQty??""),String(et?.unit||""),String(et?.vendor||""),String(et?.displayName||""),String(et?.sourceFile||"")].join("|");Ke.has(Bt)||(Ke.add(Bt),Ze.push(et))}),Ze.sort((et,Bt)=>String(et?.dateStr||"").localeCompare(String(Bt?.dateStr||"")));const Ye=$e?Ze.filter(et=>Dx(et?.dateStr)===$e):Ze,tt=Ye.map((et,Bt)=>{const We=Bt>0?Ye[Bt-1]:null,Ut=We?Number(We?.price):NaN,Xt=Number(et?.price);let Qt=null,re=null;return Number.isFinite(Ut)&&Number.isFinite(Xt)&&(Qt=Xt-Ut,re=Ut!==0?Qt/Ut*100:null),{...et,_diff:Qt,_pct:re}}),Mt=Ye.reduce((et,Bt)=>{const We=Number(Bt?.incomingQty);return et+(Number.isFinite(We)?We:0)},0),xt=Ye.reduce((et,Bt)=>{const We=Number(Bt?.incomingQty),Ut=Number(Bt?.price);return!Number.isFinite(We)||!Number.isFinite(Ut)?et:et+We*Ut},0),Rt=[...tt].reverse();return i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"120px"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),i.jsx("tbody",{children:Rt.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:$e?`${$e}`:""})}):Rt.map((et,Bt)=>{const We=et?._diff,Ut=et?._pct,Xt=We==null||!Number.isFinite(We)?"-":`${We>=0?"+":""}${Math.round(We).toLocaleString()}`,Qt=Ut==null||!Number.isFinite(Ut)?"":` (${Ut>=0?"+":""}${Ut.toFixed(1)}%)`,re=We==null||!Number.isFinite(We)?"#888":We>0?"#c92a2a":We<0?"#2b8a3e":"#666",ne=Number(et?.price),fe=Number.isFinite(ne)?`${Math.round(ne).toLocaleString()}`:"-",Te=Number(et?.incomingQty),Pe=Number.isFinite(Te)?Math.round(Te).toLocaleString():"-",Xe=Number.isFinite(Te)&&Number.isFinite(ne)?Te*ne:NaN,Qe=Number.isFinite(Xe)?`${Math.round(Xe).toLocaleString()}`:"-";return i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:et?.dateStr||"-"}),i.jsx("td",{children:et?.vendor||"-"}),i.jsx("td",{style:{fontWeight:500},children:et?.displayName||"-"}),i.jsx("td",{className:"col-number",children:Pe}),i.jsxs("td",{className:"col-number",children:[fe,et?.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",et.unit]})]}),i.jsx("td",{className:"col-number",children:Qe}),i.jsxs("td",{className:"col-number",style:{color:re},children:[Xt,Qt]})]},`${et?.dateStr||"d"}-${Bt}`)})}),Rt.length>0&&i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",$e?`${$e}`:""]}),i.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(Mt).toLocaleString()}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),i.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(xt).toLocaleString()]}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[i.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),i.jsx(se,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const me=await wu(()=>Promise.resolve().then(()=>vf),void 0).then(tt=>tt.recipeService.exportAllRecipes()),Ke=new Blob([JSON.stringify(me,null,2)],{type:"application/json"}),Ze=URL.createObjectURL(Ke),Ye=document.createElement("a");Ye.href=Ze,Ye.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Ye),Ye.click(),document.body.removeChild(Ye),URL.revokeObjectURL(Ze)}catch(me){D({type:"error",message:""}),console.error(me)}},children:" JSON"})]}),i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),i.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:me=>{const Ke=me.target.files?.[0];Ke&&jt(Ke)}}),i.jsx(se,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:y||T,children:" "}),O.message&&i.jsx("div",{className:`status-msg ${O.type}`,style:{marginTop:"10px"},children:O.message})]})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{className:"upload-area",children:[i.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",i.jsx("br",{}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",i.jsx("br",{})," 2: "]})]}),i.jsx("input",{type:"file",accept:".csv",onChange:kt,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),i.jsx(se,{variant:"primary",onClick:Jt,disabled:!d||y,className:"upload-btn",size:"sm",block:!0,children:y?"...":""})]}),f.message&&i.jsx("div",{className:`status-msg ${f.type}`,children:f.message})]}),l?.role==="admin"&&i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),i.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",Ne.length,""]}),i.jsx("div",{style:{marginTop:"0.75rem"},children:i.jsx(se,{variant:"secondary",size:"sm",block:!0,onClick:xn,disabled:ye||y,title:"",children:""})})]}),i.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Ne.length,""]})]}),Ne.length===0?i.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):i.jsx("div",{className:"file-list",children:Ne.map(me=>i.jsxs("div",{className:"file-list-item",children:[i.jsx("span",{className:"file-name",title:me.name,children:me.name}),i.jsx(se,{variant:"danger",size:"sm",onClick:()=>Sn(me.name),disabled:y,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},me.name))})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:" "}),i.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",_e.length.toLocaleString()," "]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsx(zt,{placeholder:" (, , )...",value:Vt,onChange:me=>St(me.target.value),style:{width:"250px",fontSize:"0.9rem"}}),i.jsx(se,{variant:"secondary",size:"sm",onClick:ut,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:_?i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{onClick:()=>oe("dateStr"),style:{width:"120px"},children:[" ",ft.key==="dateStr"&&(ft.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>oe("vendor"),children:[" ",ft.key==="vendor"&&(ft.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>oe("name"),children:[" ",ft.key==="name"&&(ft.direction==="asc"?"":"")]}),i.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),i.jsx("tbody",{children:_e.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",className:"no-data",children:""})}):_e.map((me,Ke)=>i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:me.dateStr||"-"}),i.jsx("td",{children:me.vendor||"-"}),i.jsx("td",{style:{fontWeight:"500"},children:me.name}),i.jsxs("td",{className:"col-number",children:[me.price?me.price.toLocaleString():"-",me.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",me.unit]})]})]},Ke))})]})})]})]}),i.jsx(yn,{isOpen:C,onClose:rn,title:" / ",size:"medium",showCloseButton:!T,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",i.jsx("br",{}),i.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:$?.name||"-"})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(se,{variant:"ghost",onClick:rn,disabled:T,children:""}),i.jsx(se,{variant:"primary",onClick:cn,disabled:!$||T,children:T?"...":""})]}),T&&i.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),O.message&&i.jsx("div",{className:`status-msg ${O.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:O.message})]})}),i.jsx(yn,{isOpen:K,onClose:Ln,title:"",size:"medium",showCloseButton:!ye,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",i.jsx("br",{}),i.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",i.jsx("code",{children:"_copy"})," "]})]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",i.jsx("strong",{style:{color:"#111827"},children:l?.displayId||""})," / : ",Ne.length,""]}),ve?i.jsxs(i.Fragment,{children:[(()=>{const me=q.find(Ze=>String(Ze?.id)===String(Y)),Ke=me?`${me.display_id}${me.email?` (${me.email})`:""}`:Y?String(Y).slice(0,8):"-";return i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",i.jsx("strong",{children:Ke}),i.jsx("br",{}),": ",i.jsx("strong",{children:Ne.length.toLocaleString()})," CSV",i.jsx("br",{}),": ",i.jsx("code",{children:"_copy"})," "]})]})})(),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>ae(!1),disabled:ye,children:""}),i.jsx(se,{variant:"primary",onClick:ar,disabled:!Y||ye,children:ye?"...":""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),P?i.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):i.jsxs("select",{value:Y,onChange:me=>ue(me.target.value),disabled:ye||!!R,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:ye?"#f3f4f6":"white"},children:[i.jsx("option",{value:"",children:"..."}),q.filter(me=>String(me?.id)&&String(me?.id)!==String(l?.id)).map(me=>i.jsxs("option",{value:me.id,children:[me.display_id,me.email?` (${me.email})`:"",me.role==="admin"?" []":""]},me.id))]}),R&&i.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:R})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(se,{variant:"ghost",onClick:Ln,disabled:ye,children:""}),i.jsx(se,{variant:"primary",onClick:()=>ae(!0),disabled:!Y||ye||P||!!R,children:""})]})]}),ye&&i.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:J.total?`${J.done} / ${J.total}`:"..."})]})]}),i.jsx("div",{className:"bulk-progress-bar",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:J.total?`${Math.round(J.done/J.total*100)}%`:"0%"}})}),i.jsx("div",{className:"bulk-progress-current",title:J.current,children:J.current})]}),ge?.message&&i.jsx("div",{className:`status-msg ${ge.type||"info"}`,children:ge.message}),Array.isArray(ge?.failed)&&ge.failed.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",ge.failed.length,""]}),i.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:ge.failed.slice(0,10).map((me,Ke)=>i.jsxs("li",{children:[me?.file||"-",": ",me?.errorMessage||"unknown error"]},`${me?.file||"f"}-${Ke}`))}),ge.failed.length>10&&i.jsxs("div",{style:{marginTop:"6px"},children:["... ",ge.failed.length-10,""]})]})]})}),j&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>E(null),children:i.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:me=>me.stopPropagation(),children:[i.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),i.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:j.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>E(null),children:""}),i.jsx(se,{variant:"danger",onClick:()=>{j.onConfirm(),E(null)},children:""})]})]})})]})},oT=({recipes:n,recentIds:t,onSelect:s})=>{if(!t||t.length===0)return null;const l=t.map(o=>n.find(u=>u.id===o)).filter(Boolean).slice(0,7);return l.length===0?null:i.jsxs("div",{className:"recent-recipes",children:[i.jsx("h3",{className:"recent-header",children:""}),i.jsx("div",{className:"recent-list",children:l.map(o=>i.jsxs("div",{className:"recent-item",onClick:()=>s(o),children:[i.jsx("div",{className:"recent-thumbnail",children:o.image?i.jsx("img",{src:o.image,alt:o.title}):i.jsx("div",{className:"recent-placeholder"})}),i.jsx("div",{className:"recent-info",children:i.jsx("div",{className:"recent-title",children:o.title})})]},o.id))})]})},cT=({onBack:n})=>(b.useEffect(()=>{window.scrollTo(0,0)},[]),i.jsxs("div",{className:"levain-guide-container",children:[i.jsxs("header",{className:"levain-guide-header",children:[i.jsx("h1",{children:"LEVAIN GUIDE"}),i.jsx("p",{className:"subtitle",children:" "}),i.jsx("p",{className:"subtitle",children:""}),i.jsx("div",{className:"divider"})]}),i.jsxs("main",{className:"levain-guide-main",children:[i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("p",{children:"Levain"}),i.jsx("h3",{children:""}),i.jsx("p",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",i.jsx("br",{}),i.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",i.jsx("br",{}),i.jsx("strong",{children:""})," Acetobacter aceti "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:["",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",i.jsx("br",{}),"(   +  + )"]}),"",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHO",i.jsx("br",{}),"(  )"]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"- 7-10"}),i.jsxs("div",{className:"timeline",children:[i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),i.jsx("p",{children:"100g + 100ml 20-22"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsx("p",{children:"100g  50g50g + 50ml"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsxs("div",{className:"success-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),i.jsx("p",{children:"1150%1:1"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 15",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," pH 3.5-4.0"]})]})]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:"(ml)"}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"2"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"5-8"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-4"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"15-18"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"3-5"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25-28"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-3"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"30"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"1"}),i.jsx("br",{}),"100g50g + 50ml"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"8-12"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"2%100ml2g"}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 12 8:00"}),i.jsx("br",{}),"50g25g + 25ml "]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  14:00"}),i.jsx("br",{}),"25g + 25ml 2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  20:00"}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:" "})," ",i.jsx("br",{}),"",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:" "})," pH",i.jsx("br",{}),"pH 3.5-4.0pH"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"18"}),i.jsx("td",{children:"16-24"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"12-16"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"24-26"}),i.jsx("td",{children:"8-12"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"28"}),i.jsx("td",{children:"4-8"}),i.jsx("td",{children:"2"})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"1"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 22",i.jsx("br",{}),"2. 12",i.jsx("br",{}),"3. 1",i.jsx("br",{}),"4. 1-2"]}),i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," pH",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," "]}),i.jsx("h3",{children:"3"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. 15",i.jsx("br",{}),"3. 80%"]}),i.jsx("h3",{children:"4"}),i.jsxs("div",{className:"success-box",children:["",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:"5"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 1:0.8",i.jsx("br",{}),"2. ",i.jsx("br",{}),"3. "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"pH"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"pH4-8.0"}),i.jsx("br",{}),i.jsx("br",{})," pH 7.0",i.jsx("br",{})," pH 4.5-5.5",i.jsx("br",{})," pH 3.5-4.0",i.jsx("br",{})," pH 3.0"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:"pH 3.8-4.0"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 3.5"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 4.5"})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 1",i.jsx("br",{})," ",i.jsx("br",{})," -203"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"15-20"}),i.jsx("td",{children:"18-20"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25+"}),i.jsx("td",{children:"22-24"}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"18-22"}),i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"5-15"}),i.jsx("td",{children:"18"}),i.jsx("td",{children:"2-3"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 24",i.jsx("br",{})," ",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 18",i.jsx("br",{})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"100g + 50g + 150ml 12-24",i.jsx("br",{}),"11-2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"100ml"}),i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," pH3.5-4.0",i.jsx("br",{})," 0.5-1.5%",i.jsx("br",{})," 0.3-0.8%"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"15-25% ()"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"5-15%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"20-30%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"30-50%"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"formula",children:[" 18   - 8",i.jsx("br",{}),i.jsx("br",{}),"",i.jsx("br",{})," 2018  (20-8) = 1.5",i.jsx("br",{})," 2418  (24-8) = 1.125",i.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),i.jsxs("footer",{className:"levain-footer",children:[i.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),i.jsx("p",{children:""})]}),i.jsxs("button",{className:"levain-back-button",onClick:n,children:[i.jsx("span",{children:""})," "]})]})),uT=({onBack:n})=>{const{user:t,patchCurrentUserProfile:s}=os(),[l,o]=b.useState([]),[u,d]=b.useState(!0),[h,f]=b.useState(null),[m,y]=b.useState(null),[v,x]=b.useState(""),[w,_]=b.useState(""),[N,j]=b.useState(""),[E,O]=b.useState(""),[D,$]=b.useState(!1),[z,C]=b.useState(!1),[M,T]=b.useState(new Set);b.useEffect(()=>{F()},[]);const F=async()=>{try{d(!0);const L=await Qi.fetchAllProfiles();o(L)}catch(L){console.error(L),f("")}finally{d(!1)}},K=l.filter(L=>L.role==="admin"),G=l.filter(L=>L.role!=="admin"),q=(L,R)=>{T(I=>{const Y=new Set(I);return R?Y.add(L):Y.delete(L),Y})},V=async(L,R)=>{const I=!!L.show_master_recipes;f(null),o(Y=>Y.map(ue=>ue.id===L.id?{...ue,show_master_recipes:R}:ue)),L.id===t?.id&&s?.({showMasterRecipes:R}),q(L.id,!0);try{const ue=!!(await Qi.updateProfile(L.id,{show_master_recipes:R}))?.show_master_recipes;o(ye=>ye.map(B=>B.id===L.id?{...B,show_master_recipes:ue}:B)),L.id===t?.id&&s?.({showMasterRecipes:ue})}catch(Y){console.error(Y),o(ue=>ue.map(ye=>ye.id===L.id?{...ye,show_master_recipes:I}:ye)),L.id===t?.id&&s?.({showMasterRecipes:I}),f("RLS")}finally{q(L.id,!1)}},P=({user:L,isAdmin:R})=>i.jsxs(tn,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[L.display_id," ",R&&i.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),L.email&&i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:L.email}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date(L.created_at).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",L.updated_at?new Date(L.updated_at).toLocaleString():"---"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:L.show_master_recipes||!1,disabled:M.has(L.id),onChange:I=>V(L,I.target.checked)}),""]}),i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>{y({id:L.id,display_id:L.display_id,email:L.email}),x(""),_(""),j(""),O("")},style:{whiteSpace:"nowrap"},children:""})]})]},L.id);return i.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",height:"100%",overflowY:"auto"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[i.jsx("h2",{children:""}),i.jsx(se,{variant:"ghost",onClick:n,children:""})]}),h&&i.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:h}),u?i.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[K.length>0&&i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:K.map(L=>i.jsx(P,{user:L,isAdmin:!0},L.id))})]}),i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:G.length>0?G.map(L=>i.jsx(P,{user:L,isAdmin:!1},L.id)):i.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),i.jsx(yn,{isOpen:!!m,onClose:()=>{D||y(null)},title:": ",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[i.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",m?.display_id||m?.email||m?.id]}),m?.email&&i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:m.email}),i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),N&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:N}),E&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:E}),i.jsxs("div",{style:{display:"grid",gap:"10px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:v,onChange:L=>x(L.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:w,onChange:L=>_(L.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>y(null),disabled:D,children:""}),i.jsx(se,{variant:"secondary",isLoading:z,disabled:!m?.email||D,onClick:async()=>{if(j(""),O(""),!m?.email){j("");return}C(!0);try{await Qi.sendPasswordResetEmail(m.email),O("")}catch(L){console.error(L),j(L?.message||"")}finally{C(!1)}},style:{whiteSpace:"nowrap"},children:""}),i.jsx(se,{variant:"danger",isLoading:D,onClick:async()=>{if(j(""),O(""),!!m?.id){if(!v||v.length<8){j("8");return}if(v!==w){j("");return}$(!0);try{await Qi.adminResetPassword(m.id,v),O(""),x(""),_("")}catch(L){console.error(L);const R=L?.message||"";/FunctionsHttpError|not found|404/i.test(R)||/admin-reset-password/i.test(R)?j(""):j(R)}finally{$(!1)}}},children:""})]})]})})]})},ks="inventory_items",qi="inventory_snapshots",lo="deleted_inventory_snapshots",Va=(n,t)=>{const s=String(n?.message||"");return String(n?.code||"")==="42703"?s.toLowerCase().includes(String(t).toLowerCase()):s.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&s.toLowerCase().includes("does not exist")},er={getAll:async n=>{if(!n)return[];const{data:t,error:s}=await Re.from(ks).select("*").eq("user_id",n).order("created_at",{ascending:!0});return s?(console.error("Error fetching inventory:",s),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:s,isPhantom:l,_master:o,_csv:u,...d}=t,h=t?.tax10_override??t?.tax10Override,f={...d,user_id:n,tax10:!!t.tax10,tax10_override:!!h,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0},m=async x=>Re.from(ks).insert([x]).select().single();let{data:y,error:v}=await m(f);if(v){const x=Va(v,"tax10"),w=Va(v,"tax10_override");if(x||w){const _={...f};x&&delete _.tax10,w&&delete _.tax10_override,{data:y,error:v}=await m(_)}}if(v)throw console.error("Error adding item:",v),v;return y},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:s,isPhantom:l,created_at:o,_master:u,_csv:d,...h}=t,f=t?.tax10_override??t?.tax10Override,m={...h,tax10:!!t.tax10,tax10_override:!!f,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()},y=async w=>Re.from(ks).update(w).eq("id",t.id).eq("user_id",n).select().single();let{data:v,error:x}=await y(m);if(x){const w=Va(x,"tax10"),_=Va(x,"tax10_override");if(w||_){const N={...m};w&&delete N.tax10,_&&delete N.tax10_override,{data:v,error:x}=await y(N)}}if(x)throw console.error("Error updating item:",x),x;return v},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:s}=await Re.from(ks).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error deleting item:",s),s},adjustStock:async(n,t,s)=>{if(!n)throw new Error("User ID is required");const{data:l,error:o}=await Re.from(ks).select("quantity").eq("id",t).eq("user_id",n).single();if(o||!l)throw new Error("Item not found");const u=Math.max(0,(l.quantity||0)+s),{data:d,error:h}=await Re.from(ks).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(h)throw h;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await Re.from(ks).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:s}=await Re.from("ignored_items").select("name").eq("user_id",n);return s?(console.error("Error fetching ignored items:",s),new Set):new Set(t.map(l=>l.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:s}=await Re.from("ignored_items").insert([{user_id:n,name:t}]).select();if(s&&s.code!=="23505")throw console.error("Error ignoring item:",s),s},getSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await Re.from(qi).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return s?(console.error("Error fetching snapshots:",s),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await Re.from(lo).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return s?(console.error("Error fetching deleted snapshots:",s),[]):t||[]},createSnapshot:async(n,t,s,l)=>{if(!n)throw new Error("User ID is required");let o=null,u=null;const d=await Re.from(qi).insert([{user_id:n,title:t,items:s,total_value:l,snapshot_date:new Date().toISOString()}]).select().single();if(o=d.data??null,u=d.error??null,u&&Va(u,"user_id")){const h=await Re.from(qi).insert([{title:t,items:s,total_value:l,snapshot_date:new Date().toISOString()}]).select().single();o=h.data??null,u=h.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return o},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:s,error:l}=await Re.from(qi).select("*").eq("id",t).eq("user_id",n).single();if(l||!s)throw console.error("Error fetching snapshot for delete:",l),l||new Error("Snapshot not found");const{error:o}=await Re.from(lo).insert([{original_id:s.id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at,deleted_at:new Date().toISOString()}]);if(o)throw console.error("Error moving snapshot to trash:",o),o;const{error:u}=await Re.from(qi).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:s,error:l}=await Re.from(lo).select("*").eq("id",t).eq("user_id",n).single();if(l||!s)throw console.error("Error fetching deleted snapshot:",l),l||new Error("Deleted snapshot not found");let o=null;{const{error:d}=await Re.from(qi).insert([{id:s.original_id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);o=d}if(o){const{error:d}=await Re.from(qi).insert([{user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await Re.from(lo).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:s}=await Re.from(lo).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error hard deleting snapshot from trash:",s),s;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await Re.from(ks).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(Va(t.error,"user_id")){const s=await Re.from(ks).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(s.error)throw console.error("Error resetting quantities (fallback):",s.error),s.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},Vi=n=>{const t=String(n??"").trim();if(!t)return"";const s=t.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s},dT=(n,t)=>{const s=Vi(n),l=Vi(t);if(!s||!l)return null;if(s===l)return 1;if(s==="kg"&&l==="g")return 1e3;if(s==="g"&&l==="kg")return 1/1e3;const o=s==="cc"?"ml":s,u=l==="cc"?"ml":l;return o==="l"&&u==="ml"?1e3:o==="ml"&&u==="l"?1/1e3:null},hT=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},oo=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},fT=({item:n,isLowStock:t,onUpdateQuantity:s,onDelete:l,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const[h,f]=we.useState(n.quantity===""?"":parseFloat(n.quantity)||0),m=V=>{const P=String(V||"").trim();return P?P==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(P)?P:"":""},y={food:"",alcohol:"",soft_drink:"",supplies:""};we.useEffect(()=>{f(n.quantity===""?"":parseFloat(n.quantity)||0)},[n.quantity]);const v=parseFloat(n.price)||0,x=(()=>{if(!Number.isFinite(v)||v<=0)return"-";const V=n?._csv?.unit,P=String(V||"").trim(),L=String(n?.unit||"").trim();if(!P)return`${oo(v)}`;const R=Vi(L),I=Vi(P);if(I===R)return`${oo(v)}/${P}`;const Y=dT(I,R);if(Y!==null)return`${oo(v*Y)}/${P}`;const ue=parseFloat(n?._master?.packetSize),ye=String(n?._master?.packetUnit||"").trim(),B=Vi(ye);return hT(P)&&Number.isFinite(ue)&&ue>0&&B===R?`${oo(v*ue)}/${P}`:`${oo(v)}/${L||"-"}`})(),w=m(n?._master?.itemCategory),_=w==="alcohol"||w==="supplies",N=n?.tax10_override===!0||n?.tax10_override===1||n?.tax10_override==="1"||n?.tax10_override==="true",j=w?N?n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true":_:n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true",E=w?N?`${y[w]||w}: ${_?"10%":"8%"}/ `:`${y[w]||w}${j?"10%":"8%"}`:"10%",O=j?1.1:1.08,D=h===""?0:parseFloat(h),$=v*D*O,z=we.useMemo(()=>{const V=n?._master?.packetSize,P=n?._master?.packetUnit,L=parseFloat(V);return!Number.isFinite(L)||L<=0?"-":`${Number.isInteger(L)?L.toLocaleString():L.toLocaleString(void 0,{maximumFractionDigits:3})}${P?String(P):""}`},[n?._master?.packetSize,n?._master?.packetUnit]),C=()=>{const V=parseFloat(h);!isNaN(V)&&V!==n.quantity&&s(n.id,V)},M=V=>{V&&setTimeout(()=>{try{V.select()}catch{}},0)},T=V=>{const L=V?.closest?.("table")||document;return Array.from(L.querySelectorAll("input.inventory-quantity-input"))},F=(V,P)=>{const L=T(V).filter(Y=>!Y.disabled),R=L.indexOf(V);if(R<0)return!1;const I=L[R+P];return I?(requestAnimationFrame(()=>{try{I.scrollIntoView({block:"nearest"})}catch{}I.focus(),M(I)}),!0):!1},K=V=>{if(V.key==="Enter"){V.preventDefault(),F(V.currentTarget,V.shiftKey?-1:1),V.currentTarget.blur();return}V.key==="Tab"&&F(V.currentTarget,V.shiftKey?-1:1)&&(V.preventDefault(),V.currentTarget.blur())},G=n?._master?.packetUnit||"",q=!!G&&Vi(G)!==Vi(n?.unit);return i.jsxs("tr",{className:t(n)?"low-stock":"",children:[i.jsx("td",{style:{textAlign:"center"},children:i.jsx("input",{type:"checkbox",checked:j,onChange:V=>o&&o(n,V.target.checked),title:E,className:"inventory-tax-checkbox"})}),i.jsxs("td",{children:[n.name,t(n)&&i.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),i.jsx("td",{style:{textAlign:"right"},children:x}),i.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:z}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[i.jsx("input",{type:"text",inputMode:"decimal",value:h,onChange:V=>f(ob(V.target.value)),className:"inventory-quantity-input no-print",onBlur:C,onKeyDown:K,onFocus:V=>M(V.target),onClick:V=>M(V.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),i.jsx("span",{className:"print-only",style:{display:"none"},children:h})]}),i.jsx("td",{children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:n.unit}),q&&typeof d=="function"&&i.jsx("button",{type:"button",onClick:()=>d(n),title:`${G}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),i.jsx("td",{style:{textAlign:"right"},children:$>0?`${Math.round($).toLocaleString()}`:"-"}),i.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:n.vendor||"-"}),i.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof u=="function"&&i.jsx("button",{type:"button",onClick:()=>u(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),i.jsx("button",{onClick:()=>l(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},pT=({items:n,loading:t,onDelete:s,onUpdateQuantity:l,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:h,isOver:f}=Ho({id:"inventory-list-droppable"}),m=_=>_.threshold>0&&_.quantity<=_.threshold,[y,v]=we.useState({key:null,direction:"asc"}),x=_=>{v(N=>N.key===_?{key:_,direction:N.direction==="asc"?"desc":"asc"}:{key:_,direction:"asc"})},w=we.useMemo(()=>{if(!y.key)return n;const _=[...n];return y.key==="vendor"&&_.sort((N,j)=>{const E=(N?.vendor||"").toString(),O=(j?.vendor||"").toString(),D=E.localeCompare(O,"ja");if(D!==0)return y.direction==="asc"?D:-D;const $=(N?.name||"").toString(),z=(j?.name||"").toString(),C=$.localeCompare(z,"ja");return y.direction==="asc"?C:-C}),_},[n,y]);return i.jsxs("div",{ref:h,className:`inventory-list-droppable ${f?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:f?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[i.jsx("div",{className:"inventory-table-container",children:t?i.jsx("p",{children:"Loading..."}):i.jsxs("table",{className:"inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"}),i.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),i.jsx("th",{style:{width:"40px"}})]})}),i.jsxs("tbody",{children:[w.map(_=>i.jsx(fT,{item:_,isLowStock:m,onUpdateQuantity:l,onEdit:u,onDelete:s,onToggleTax:o,onRequestUnitSync:d},_.id)),w.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"9",style:{textAlign:"center",color:"#888",padding:"2rem"},children:f?"":""})})]}),i.jsx("tfoot",{children:(()=>{const _=n.reduce((N,j)=>{const E=parseFloat(j.price)||0,O=j.quantity===""?0:parseFloat(j.quantity)||0,D=j?.tax10===!0||j?.tax10===1||j?.tax10==="1"||j?.tax10==="true"?1.1:1.08,$=E*O;return N.net+=$,N.taxed+=$*D,N},{net:0,taxed:0});return i.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[i.jsx("td",{colSpan:"6",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(_.net).toLocaleString()," / ",Math.round(_.taxed).toLocaleString()]}),i.jsx("td",{colSpan:"2"})]})})()})]})}),f&&i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},mT=({onBack:n})=>{const{user:t}=os(),s=t?.id,[,l]=Lo(),[o,u]=b.useState([]),[d,h]=b.useState([]),[f,m]=b.useState([]),[y,v]=b.useState([]),[x,w]=b.useState(new Map),[_,N]=b.useState(new Map),[j,E]=b.useState(new Set),[O,D]=b.useState(!0),[$,z]=b.useState(""),[C,M]=b.useState(!1),[T,F]=b.useState(null),[K,G]=b.useState(!1),[q,V]=b.useState(null),[P,L]=b.useState(!1),[R,I]=b.useState(!1),[Y,ue]=b.useState(""),[ye,B]=b.useState(!1),[J,Z]=b.useState(!0),[ge,Me]=b.useState(!1),[ve,ae]=b.useState(null),[A,X]=b.useState("history"),[ce,Se]=b.useState(null),[Ae,Be]=b.useState(""),[Le,Ge]=b.useState(!1),[W,Ce]=b.useState(null),[$e,rt]=b.useState(!0),[mt,ft]=b.useState({key:"name",direction:"asc"}),[Dt,Vt]=b.useState(!1),[St,oe]=b.useState(null),[_e,Ne]=b.useState(new Set),[Ie,it]=b.useState(!1),[ut,kt]=b.useState(null),[Jt,Sn]=b.useState(null),[jt,rn]=b.useState(!1),cn=al(gr(qu,{activationConstraint:{distance:8}})),[xn,Ln]=b.useState("all"),[ar,me]=b.useState(new Set),[Ke,Ze]=b.useState(""),[Ye,tt]=b.useState(""),[Mt,xt]=b.useState({}),[Rt,et]=b.useState(""),Bt=({row:U,onVendorClick:ee,isSelected:le})=>{const{attributes:be,listeners:Oe,setNodeRef:De,setActivatorNodeRef:qe,transform:He,transition:Je,isDragging:st}=cl({id:U.vendor,data:{type:"summary-row"}}),dt={transform:Tr.Transform.toString(He),transition:Je,opacity:st?.6:1};return i.jsxs("tr",{ref:De,style:dt,...be,className:le?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[i.jsx("td",{className:"inventory-summary__drag",children:i.jsx("span",{ref:qe,...Oe,className:"inventory-summary__drag-handle",title:"",children:""})}),i.jsx("td",{children:i.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>ee?.(U.vendor),"aria-expanded":!!le,children:[i.jsx("span",{children:U.vendor}),i.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:le?"":""})]})}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(U.total||0).toLocaleString()]})]})};b.useEffect(()=>{s&&(Ln("all"),z(""),We())},[s]);const We=async(U=!1)=>{U||D(!0);try{const[ee,le,be,Oe,De,qe,He]=await Promise.all([er.getAll(s),nr.getPriceListArray(),er.getIgnoredItems(s),er.getSnapshots(s),er.getDeletedSnapshots(s),Pn.getAllConversions(),Mu.getAll(s)]);u(ee),v(le),E(be),h(Oe||[]),m(De||[]),w(qe||new Map),N(He||new Map);const Je=Fe=>{if(!Fe)return-1;const pn=new Date(Fe).getTime();return Number.isFinite(pn)?pn:-1},st=(Fe,yt)=>{const pn=Math.max(Je(Fe?.updated_at),Je(Fe?.updatedAt),Je(Fe?.created_at),Je(Fe?.createdAt)),dn=Math.max(Je(yt?.updated_at),Je(yt?.updatedAt),Je(yt?.created_at),Je(yt?.createdAt));return pn!==dn&&dn>pn?yt:Fe},dt=new Map;(ee||[]).forEach(Fe=>{const yt=String(Fe?.vendor??"").trim()||"__no_vendor__",pn=nn(Fe?.name)||String(Fe?.name??"").trim();if(!pn)return;const dn=`${yt}@@${pn}`,Gs=dt.get(dn);if(!Gs){dt.set(dn,Fe);return}dt.set(dn,st(Gs,Fe))});const gt=new Set(Array.from(dt.values()).map(Fe=>Fe.id));me(gt)}catch(ee){console.error("Failed to load data:",ee)}finally{U||D(!1)}},Ut=U=>{if(!U)return"-";const ee=new Date(U);if(Number.isNaN(ee.getTime()))return String(U);const le=ee.getFullYear(),be=String(ee.getMonth()+1).padStart(2,"0"),Oe=String(ee.getDate()).padStart(2,"0"),De=String(ee.getHours()).padStart(2,"0"),qe=String(ee.getMinutes()).padStart(2,"0");return`${le}/${be}/${Oe} ${De}:${qe}`},Xt=U=>{const ee=U?.items;return Array.isArray(ee)?ee:ee?[]:[]},Qt=U=>{const ee=U?.snapshot_date||U?.created_at;if(!ee)return null;const le=new Date(ee);return Number.isNaN(le.getTime())?null:le},re=we.useMemo(()=>new Set([""]),[]),ne=U=>{const ee=String(U??"").trim();return re.has(ee)},fe=U=>U===!0||U===1||U==="1"||U==="true",Te=U=>{const ee=String(U??"").trim();if(!ee)return"";const le=ee.toLowerCase();return le===""?"g":le===""?"ml":le===""?"cc":le===""?"kg":le===""?"l":le},Pe=(U,ee)=>{const le=parseFloat(U?.lastPrice),be=parseFloat(U?.packetSize),Oe=Te(U?.packetUnit),De=Te(ee||Oe);if(!Number.isFinite(le)||!Number.isFinite(be)||be<=0||!Oe)return null;const qe=le/be;if(De===Oe)return qe;if(Oe==="g"&&De==="kg")return qe*1e3;if(Oe==="kg"&&De==="g")return qe/1e3;const He=Oe==="cc"?"ml":Oe,Je=De==="cc"?"ml":De;return He==="ml"&&Je==="l"?qe*1e3:He==="l"&&Je==="ml"?qe/1e3:null},Xe=(U,ee)=>{const le=Te(U),be=Te(ee);if(!le||!be)return null;if(le===be)return 1;if(le==="kg"&&be==="g")return 1e3;if(le==="g"&&be==="kg")return 1/1e3;const Oe=le==="cc"?"ml":le,De=be==="cc"?"ml":be;return Oe==="l"&&De==="ml"?1e3:Oe==="ml"&&De==="l"?1/1e3:null},Qe=U=>{const ee=String(U||"").trim();return ee?ee==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(ee)?ee:"":""},H=U=>{const ee=Qe(U);return ee==="alcohol"||ee==="supplies"},Ue=U=>{const ee=Qe(U);return ee==="food"?"":ee==="alcohol"||ee==="soft_drink"?"":ee==="supplies"?"":""},Ve=U=>{const ee=Qe(U);return ee==="food"?"food":ee==="alcohol"||ee==="soft_drink"?"drink":ee==="supplies"?"supplies":"unknown"},_t=U=>U==="food"?"":U==="drink"?"":U==="supplies"?"":"",ze=U=>fe(U?.tax10)?1.1:1.08,ht=U=>U?`${U.getFullYear()}-${String(U.getMonth()+1).padStart(2,"0")}`:"",Ft=U=>{if(!U)return-1;const le=new Date(U).getTime();return Number.isFinite(le)?le:-1},Nn=U=>{const ee=[U?.updated_at,U?.updatedAt,U?.created_at,U?.createdAt];for(const le of ee){const be=Ft(le);if(be>=0)return be}return-1},Et=we.useMemo(()=>{const U=new Map;return d.forEach(ee=>{const le=Qt(ee);if(!le)return;const be=ht(le);U.has(be)||U.set(be,{key:be,year:le.getFullYear(),month:le.getMonth()+1})}),Array.from(U.values()).sort((ee,le)=>le.key.localeCompare(ee.key)).map(ee=>({...ee,label:`${ee.year}${ee.month}`}))},[d]);b.useEffect(()=>{if(Et.length===0){Ke&&Ze("");return}if(Ke&&Et.some(le=>le.key===Ke))return;const U=ht(new Date),ee=Et.find(le=>le.key===U)?.key||Et[0].key;Ze(ee)},[Et,Ke]),b.useEffect(()=>{if(Et.length===0){Ye&&tt("");return}if(Ye&&Et.some(le=>le.key===Ye))return;const U=ht(new Date),ee=Et.find(le=>le.key===U)?.key||Et[0].key;tt(ee)},[Et,Ye]);const Vn=we.useMemo(()=>{if(!Ye)return null;const[U,ee]=Ye.split("-"),le=parseInt(U,10),be=parseInt(ee,10);if(!Number.isFinite(le)||!Number.isFinite(be))return null;const Oe=He=>String(He).padStart(2,"0"),De=new Date(le,be-1,1),qe=new Date(le,be,0);return{year:le,month:be,start:De,end:qe,rangeLabel:`${le}/${Oe(be)}/01${le}/${Oe(be)}/${Oe(qe.getDate())}`}},[Ye]),sn=we.useMemo(()=>Ye?d.map(U=>({snapshot:U,date:Qt(U)})).filter(U=>U.date&&ht(U.date)===Ye).sort((U,ee)=>ee.date-U.date).map(U=>U.snapshot):d,[d,Ye]),Nt=we.useMemo(()=>{if(!Ke)return null;const[U,ee]=Ke.split("-"),le=parseInt(U,10),be=parseInt(ee,10);if(!Number.isFinite(le)||!Number.isFinite(be))return null;const Oe=He=>String(He).padStart(2,"0"),De=new Date(le,be-1,1),qe=new Date(le,be,0);return{year:le,month:be,start:De,end:qe,rangeLabel:`${le}/${Oe(be)}/01${le}/${Oe(be)}/${Oe(qe.getDate())}`}},[Ke]),Pr=we.useMemo(()=>Ke?d.map(U=>({snapshot:U,date:Qt(U)})).filter(U=>U.date&&ht(U.date)===Ke).sort((U,ee)=>ee.date-U.date).map(U=>U.snapshot):[],[d,Ke]),Kn=Pr[0]||null,yr=Ke||(Kn?.id?`snapshot:${Kn.id}`:""),qr=we.useMemo(()=>{const U=new Map;return Pr.forEach(ee=>{const le=Qt(ee)?.getTime()||-1;Xt(ee).forEach((Oe,De)=>{const qe=(Oe?.vendor||"").toString().trim();if(ne(qe))return;const He=qe||"",Je=String(Oe?.name||"").trim();if(!Je)return;const st=`${He}::${Je}`,dt={item:{...Oe,vendor:He},snapshotMs:le,itemUpdatedMs:Nn(Oe),rowIndex:De},gt=U.get(st);if(!gt){U.set(st,dt);return}if(dt.snapshotMs!==gt.snapshotMs){dt.snapshotMs>gt.snapshotMs&&U.set(st,dt);return}if(dt.itemUpdatedMs!==gt.itemUpdatedMs){dt.itemUpdatedMs>gt.itemUpdatedMs&&U.set(st,dt);return}dt.rowIndex>=gt.rowIndex&&U.set(st,dt)})}),Array.from(U.values()).map(ee=>ee.item)},[Pr,ne]),ta=we.useMemo(()=>{const U=new Map;return qr.forEach(ee=>{const le=(ee?.vendor||"").toString().trim(),be=le||"";if(ne(le))return;const Oe=parseFloat(ee?.price)||0,De=ee?.quantity===""?0:parseFloat(ee?.quantity)||0,qe=Oe*De,He=qe*ze(ee),Je=U.get(be)||{vendor:be,net:0,taxed:0};Je.net+=qe,Je.taxed+=He,U.set(be,Je)}),Array.from(U.values()).map(ee=>({vendor:ee.vendor,net:ee.net,taxed:ee.taxed,total:ee.taxed}))},[qr,ne,ze]),cs=we.useMemo(()=>{const U=new Map;return ta.forEach(ee=>{U.set(ee.vendor,ee)}),U},[ta]),ul=we.useMemo(()=>{const U=new Map;try{for(const[ee,le]of(x||new Map).entries()){const be=String(ee??"").trim();be&&U.set(be,le)}}catch{}return U},[x]),dl=we.useCallback(U=>{const ee=Qe(U?.itemCategory??U?.item_category);if(ee)return ee;const le=String(U?.name??"").trim();if(!le)return"";const be=ul.get(le);return Qe(be?.itemCategory??be?.item_category)},[ul]),na=we.useMemo(()=>{const U=new Map;qr.forEach((ee,le)=>{const be=(ee?.vendor||"").toString().trim(),Oe=be||"";if(ne(be))return;const De=parseFloat(ee?.price)||0,qe=ee?.quantity===""?0:parseFloat(ee?.quantity)||0,He=De*qe,Je=He*ze(ee),st=dl(ee),dt=Ve(st),gt=U.get(Oe)||{vendor:Oe,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};gt.totals[dt]+=Je,gt.totals.net+=He,gt.totals.taxed+=Je,gt.rows.push({id:ee?.id||`${Oe}-${ee?.name||"item"}-${le}`,name:ee?.name||"",unit:ee?.unit||"",quantity:qe,price:De,taxed:Je,itemCategory:st,breakdownKey:dt}),U.set(Oe,gt)});for(const ee of U.values())ee.rows.sort((le,be)=>{const Oe={food:0,drink:1,unknown:2,supplies:3},De=Oe[le?.breakdownKey]??2,qe=Oe[be?.breakdownKey]??2;if(De!==qe)return De-qe;const He=(le?.name||"").toString(),Je=(be?.name||"").toString();return He.localeCompare(Je,"ja")});return U},[qr,ne,ze,dl]),$s=we.useMemo(()=>ta.slice().sort((U,ee)=>ee.taxed!==U.taxed?ee.taxed-U.taxed:U.vendor.localeCompare(ee.vendor,"ja")).map(U=>U.vendor),[ta]),cr=we.useMemo(()=>{if(!yr)return $s;const U=Mt[yr],ee=new Set(cs.keys()),le=Array.isArray(U)?U.filter(Oe=>ee.has(Oe)):[],be=$s.filter(Oe=>!le.includes(Oe));return[...le,...be]},[Mt,yr,$s,cs]),Yn=we.useMemo(()=>cr.map(U=>cs.get(U)).filter(Boolean),[cr,cs]),hl=Yn.reduce((U,ee)=>(U.net+=ee.net||0,U.taxed+=ee.taxed||0,U),{net:0,taxed:0});b.useEffect(()=>{Rt&&(cs.has(Rt)||et(""))},[Rt,cs]);const Wu=U=>{et(ee=>ee===U?"":U)},fl=U=>{U?.id&&s&&(Ge(!1),Ce(null),Be(""),Se({title:"",message:`${U.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Ge(!0),Ce({type:"move",id:U.id});try{await er.deleteSnapshotToTrash(s,U.id),await We(!0),kt({title:"",message:"",type:"success"})}catch(ee){console.error(ee),kt({title:"",message:"()",type:"error"})}finally{Ge(!1),Ce(null),Se(null)}}}))},Vo=U=>{U?.id&&s&&(Ge(!1),Ce(null),Be(""),Se({title:"",message:`${U.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Ge(!0),Ce({type:"restore",id:U.id});try{await er.restoreSnapshotFromTrash(s,U.id),await We(!0),kt({title:"",message:"",type:"success"})}catch(ee){console.error(ee),kt({title:"",message:"",type:"error"})}finally{Ge(!1),Ce(null),Se(null)}}}))},ra=U=>{U?.id&&s&&(Ge(!1),Ce(null),Be(""),Se({title:" ",message:`${U.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Ge(!0),Ce({type:"hard-delete",id:U.id});try{await er.hardDeleteSnapshotFromTrash(s,U.id),await We(!0),kt({title:"",message:"",type:"success"})}catch(ee){console.error(ee),kt({title:"",message:"",type:"error"})}finally{Ge(!1),Ce(null),Se(null)}}}))},pl=U=>{if(!U)return;const ee=Xt(U).filter(Fe=>!ne(Fe?.vendor)),le=["","","","","()",""],be=ee.map(Fe=>{const yt=parseFloat(Fe?.price)||0,pn=Fe?.quantity===""?0:parseFloat(Fe?.quantity)||0,dn=Math.round(yt*pn*ze(Fe));return[Fe?.name??"",yt||"",Fe?.unit??"",Fe?.quantity??"",dn||"",Fe?.vendor??""]}),Oe=Fe=>{const yt=String(Fe??"");return yt.includes(",")||yt.includes('"')||yt.includes(`
`)||yt.includes("\r")?`"${yt.replace(/"/g,'""')}"`:yt},De=[le.map(Oe).join(","),...be.map(Fe=>Fe.map(Oe).join(","))].join(`
`),qe=new Uint8Array([239,187,191]),He=new Blob([qe,De],{type:"text/csv"}),Je=URL.createObjectURL(He),st=(U.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),dt=(U.snapshot_date?new Date(U.snapshot_date):new Date).toISOString().slice(0,10),gt=document.createElement("a");gt.href=Je,gt.download=`InventorySnapshot_${dt}_${st}.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),URL.revokeObjectURL(Je)},ur=()=>{if(!Kn)return;const U=["","()"],ee=Yn.map(Fe=>[Fe.vendor,Math.round(Fe.total||0)]),le=Fe=>{const yt=String(Fe??"");return yt.includes(",")||yt.includes('"')||yt.includes(`
`)||yt.includes("\r")?`"${yt.replace(/"/g,'""')}"`:yt},be=[U.map(le).join(","),...ee.map(Fe=>Fe.map(le).join(","))].join(`
`),Oe=new Uint8Array([239,187,191]),De=new Blob([Oe,be],{type:"text/csv"}),qe=URL.createObjectURL(De),He=(Kn.snapshot_date?new Date(Kn.snapshot_date):new Date).toISOString().slice(0,10),Je=Kn.title||"inventory_summary",st=Nt?`${Nt.year}${String(Nt.month).padStart(2,"0")}`:He,dt=Je.toString().replace(/[\\/:*?"<>|]/g,"_"),gt=document.createElement("a");gt.href=qe,gt.download=`InventorySummary_${st}_${dt}.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),URL.revokeObjectURL(qe)},ml=U=>{if(!U?.vendor)return;const ee=["","","","","","()",""],le=(U.rows||[]).map(Fe=>{const yt=Fe.itemCategory?Ue(Fe.itemCategory):_t(Fe.breakdownKey);return[Fe.name||"",yt,Math.round(Fe.price||0),Fe.unit||"",Number(Fe.quantity||0),Math.round(Fe.taxed||0),U.vendor]}),be=Fe=>{const yt=String(Fe??"");return yt.includes(",")||yt.includes('"')||yt.includes(`
`)||yt.includes("\r")?`"${yt.replace(/"/g,'""')}"`:yt},Oe=[ee.map(be).join(","),...le.map(Fe=>Fe.map(be).join(","))].join(`
`),De=new Uint8Array([239,187,191]),qe=new Blob([De,Oe],{type:"text/csv"}),He=URL.createObjectURL(qe),Je=(Kn?.snapshot_date?new Date(Kn.snapshot_date):new Date).toISOString().slice(0,10),st=Nt?`${Nt.year}${String(Nt.month).padStart(2,"0")}`:Je,dt=U.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),gt=document.createElement("a");gt.href=He,gt.download=`InventorySummary_${st}_${dt}.csv`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),URL.revokeObjectURL(He)},Ps=we.useMemo(()=>{const U=at=>at?at.toString().trim():"",ee=at=>nn(at),le=new Set;try{for(const at of(j||new Set).values()){const ot=ee(at);ot&&le.add(ot)}}catch{}const be=new Set;try{for(const at of(_e||new Set).values()){const ot=ee(at);ot&&be.add(ot)}}catch{}const Oe=new Map;try{for(const[at,ot]of(x||new Map).entries()){const Ct=ee(at);Ct&&Oe.set(Ct,ot)}}catch{}const De=new Map;try{(y||[]).forEach(at=>{const ot=ee(at?.name);ot&&De.set(ot,at)})}catch{}const qe=new Map;try{for(const[at,ot]of(_||new Map).entries()){const Ct=ee(at);Ct&&qe.set(Ct,ot)}}catch{}const He=at=>{const ot=String(at??"").trim();if(!ot)return"";const Ct=ot.toLowerCase();return Ct===""?"g":Ct===""?"ml":Ct===""?"cc":Ct===""?"kg":Ct===""?"l":Ct},Je=(at,ot)=>{const Ct=parseFloat(at?.lastPrice),hn=parseFloat(at?.packetSize),En=He(at?.packetUnit),Rn=He(ot||En);if(!Number.isFinite(Ct)||!Number.isFinite(hn)||hn<=0||!En)return null;const $t=Ct/hn;if(Rn===En)return $t;if(En==="g"&&Rn==="kg")return $t*1e3;if(En==="kg"&&Rn==="g")return $t/1e3;const rr=En==="cc"?"ml":En,An=Rn==="cc"?"ml":Rn;return rr==="ml"&&An==="l"?$t*1e3:rr==="l"&&An==="ml"?$t/1e3:null},st=at=>{const ot=String(at??"").trim();return ot?["","","","","","","","pc","PC",""].includes(ot):!1},dt=at=>{const ot=ee(at?.name),Ct=ot?Oe.get(ot):null,hn=ot?De.get(ot):null,En=ot&&qe.has(ot)?String(qe.get(ot)||""):String(hn?.unit||""),Rn={...at};if(Rn.name=U(Rn.name),Rn.vendor=U(Rn.vendor),Rn._csv={unit:En,price:hn?.price??null,vendor:U(hn?.vendor)||null,dateStr:hn?.dateStr??null},!Ct)return Rn;const $t={...Rn},rr=Qe(Ct?.itemCategory),An=Ct.packetUnit||"",ds=parseFloat(Ct.packetSize),ts=An?Je(Ct,An):null;if($t.isPhantom)An&&ts!==null&&($t.unit=An,$t.price=ts);else{if(!!An&&Number.isFinite(ds)&&ds>0&&(st($t.unit)||!$t.unit)&&ts!==null){const hs=$t.quantity;if(hs!==""&&hs!==null&&hs!==void 0){const wi=parseFloat(hs);Number.isFinite(wi)&&($t.quantity=wi*ds)}const la=$t.threshold;if(la!==""&&la!==null&&la!==void 0){const wi=parseFloat(la);Number.isFinite(wi)&&($t.threshold=wi*ds)}$t.unit=An}else(An&&ts!==null||!$t.unit&&An)&&($t.unit=An);if(ts!==null&&He($t.unit)===He(An))$t.price=ts;else{const hs=Je(Ct,$t.unit||An);hs!==null&&($t.price=hs)}}const Vs=fe($t?.tax10_override??$t?.tax10Override),xl=rr?H(rr):null;return $t._master={packetSize:Ct.packetSize,packetUnit:Ct.packetUnit,lastPrice:Ct.lastPrice,itemCategory:rr||null,tax10Auto:xl,tax10Override:Vs,updatedAt:Ct.updatedAt},rr&&($t.tax10_override=Vs,!Vs&&xl!==null&&($t.tax10=xl)),$t},gt=o.map(dt),Fe=new Map;gt.forEach(at=>{const ot=ee(at?.name);ot&&Fe.set(ot,at)});const yt=[...gt];y.forEach((at,ot)=>{const Ct=String(at?.name??""),hn=U(Ct),En=ee(Ct);if(En&&!(j.has(Ct)||hn&&j.has(hn)||le.has(En))&&!Fe.has(En)){const Rn={id:`phantom-${ot}`,isPhantom:!0,name:hn,quantity:"",unit:at.unit||"",category:"",price:at.price,vendor:U(at.vendor),threshold:0,tax10:!1,tax10_override:!1};yt.push(dt(Rn))}});const pn=yt.filter(at=>{const ot=String(at?.name??""),Ct=U(ot),hn=ee(ot);return!(j.has(ot)||Ct&&j.has(Ct)||hn&&le.has(hn)||_e.has(ot)||Ct&&_e.has(Ct)||hn&&be.has(hn)||ne(at.vendor))}),dn=at=>{if(!at)return-1;const Ct=new Date(at).getTime();return Number.isFinite(Ct)?Ct:-1},Gs=(at,ot)=>{const Ct=!!at?.isPhantom,hn=!!ot?.isPhantom;if(Ct!==hn)return Ct?ot:at;const En=Math.max(dn(at?.updated_at),dn(at?.updatedAt),dn(at?.created_at),dn(at?.createdAt)),Rn=Math.max(dn(ot?.updated_at),dn(ot?.updatedAt),dn(ot?.created_at),dn(ot?.createdAt));if(En!==Rn)return Rn>En?ot:at;const $t=at?.quantity,rr=ot?.quantity,An=$t===""||$t===null||$t===void 0?null:parseFloat($t),ds=rr===""||rr===null||rr===void 0?null:parseFloat(rr),ts=An!==null&&Number.isFinite(An),Vs=ds!==null&&Number.isFinite(ds);return ts!==Vs&&Vs?ot:at},es=new Map;return pn.forEach(at=>{const ot=ee(at?.name)||U(at?.name);if(!ot)return;const hn=`${U(at?.vendor)||"__no_vendor__"}@@${ot}`,En=es.get(hn);if(!En){es.set(hn,at);return}es.set(hn,Gs(En,at))}),Array.from(es.values())},[o,y,j,_e,x,_,ne]),gl=U=>{const{active:ee,over:le}=U;if(!le)return;if(ee?.data?.current?.type==="summary-row"){if(!yr)return;const Oe=ee.id,De=le.id;if(!Oe||!De||Oe===De)return;const qe=cr,He=qe.indexOf(Oe),Je=qe.indexOf(De);if(He<0||Je<0)return;const st=Zi(qe,He,Je);xt(dt=>({...dt,[yr]:st}));return}if(le.id==="inventory-list-droppable"){const Oe=ee.data.current.item;if(ee.data.current.type==="csv-item"){const De=String(Oe?.name??"").trim(),qe=nn(De);let He=null;if(x&&x.size>0&&qe&&(He=x.get(De)||null,!He)){for(const[gt,Fe]of x.entries())if(nn(gt)===qe){He=Fe;break}}const Je=He?.packetUnit||Oe.unit,st=He?Pe(He,Je):null,dt=st!==null?st:He?.lastPrice!==null&&He?.lastPrice!==void 0&&He?.lastPrice!==""?He.lastPrice:Oe.price;F({name:Oe.name,price:dt,unit:Je,category:"",threshold:0,quantity:0,vendor:Oe.vendor,tax10:fe(Oe?.tax10),isNewFromCsv:!0}),M(!0)}}},qs=async U=>{if(U.preventDefault(),!s)return;const ee=new FormData(U.target),le={name:ee.get("name"),quantity:parseFloat(ee.get("quantity")),unit:ee.get("unit"),category:ee.get("category"),threshold:parseFloat(ee.get("threshold")),vendor:T.vendor||"",price:T.price||0,tax10:fe(T?.tax10)};try{T.id&&!T.isPhantom?await er.update(s,{...T,...le}):await er.add(s,le),M(!1),F(null),We()}catch(be){console.error("Failed to save item:",be),kt({title:"",message:"",type:"error"})}},Ko=U=>{oe(U),Vt(!0)},Yo=U=>{!U||U.isPhantom||!U?._master?.packetUnit||(V(U),G(!0))},us=()=>{P||(G(!1),V(null))},Qo=async({convertQuantity:U})=>{if(!s)return;const ee=q;if(!ee||ee.isPhantom)return;const le=ee?._master?.packetUnit;if(!le)return;const be=le,Oe=Pe(ee?._master,be);if(Oe===null){kt({title:"",message:"/",type:"error"});return}let De=ee.quantity,qe=ee.threshold;if(U){const He=Xe(ee.unit,be);if(!He){kt({title:"",message:"kgg / lml ",type:"error"});return}const Je=ee.quantity===""?null:parseFloat(ee.quantity);Je!==null&&Number.isFinite(Je)&&(De=Je*He);const st=ee.threshold===""?null:parseFloat(ee.threshold);st!==null&&Number.isFinite(st)&&(qe=st*He)}L(!0);try{await er.update(s,{id:ee.id,unit:be,price:Oe,quantity:De===""?0:parseFloat(De)||0,threshold:qe===""?0:parseFloat(qe)||0,tax10:fe(ee?.tax10)}),await We(!0),G(!1),V(null)}catch(He){console.error("Failed to sync unit:",He),kt({title:"",message:"",type:"error"})}finally{L(!1)}},Wo=async()=>{if(St)try{const ee=(le=>le?le.toString().trim():"")(St?.name);ee&&Ne(le=>{const be=new Set(le);return be.add(ee),be}),Vt(!1),oe(null)}catch(U){console.error("Failed to delete/ignore item:",U)}},Jo=async(U,ee)=>{try{if(!s)return;const le=Ps.find(be=>be.id===U);if(!le)return;if(le.isPhantom){const be={name:le.name.trim(),quantity:ee,unit:le.unit,category:le.category||"",price:le.price,vendor:le.vendor,threshold:0,tax10:fe(le?.tax10)},Oe=await er.add(s,be);await We(!0),me(De=>{const qe=new Set(De);return qe.add(Oe.id),qe})}else u(be=>be.map(Oe=>Oe.id!==U?Oe:{...Oe,quantity:ee,unit:le.unit??Oe.unit,price:le.price??Oe.price,threshold:le.threshold??Oe.threshold})),me(be=>{const Oe=new Set(be);return Oe.add(U),Oe}),await er.update(s,{...le,quantity:ee})}catch(le){console.error(le);const be=le?.message||le?.error_description||(typeof le=="string"?le:null)||(()=>{try{return JSON.stringify(le)}catch{return null}})()||"";kt({title:"",message:`
${be}`,type:"error"}),We()}},sa=async(U,ee)=>{try{if(!s||!U)return;const le=!!ee;if(U.isPhantom){const be={name:U.name.trim(),quantity:U.quantity===""?0:parseFloat(U.quantity)||0,unit:U.unit,category:U.category||"",price:U.price,vendor:U.vendor,threshold:0,tax10:le,tax10_override:!0};await er.add(s,be),await We(!0)}else u(be=>be.map(Oe=>Oe.id===U.id?{...Oe,tax10:le,tax10_override:!0}:Oe)),await er.update(s,{...U,tax10:le,tax10_override:!0})}catch(le){console.error(le);const be=le?.message||le?.error_description||(typeof le=="string"?le:null)||(()=>{try{return JSON.stringify(le)}catch{return null}})()||"";kt({title:"",message:`
${be}`,type:"error"}),We()}},Ju=(U,ee)=>{if(ee===!0){Sn({item:U});return}sa(U,ee)},Xo=()=>{jt||Sn(null)},ia=async()=>{const U=Jt?.item;if(U){rn(!0);try{await sa(U,!0),Sn(null)}finally{rn(!1)}}},Fr=async()=>{if(!ye&&Y&&s){B(!0);try{const U=Ps.filter(le=>!le.isPhantom).map(le=>{const be={...le};return delete be.isPhantom,delete be._master,delete be._csv,be}),ee=U.reduce((le,be)=>{const Oe=parseFloat(be.price)||0,De=be.quantity===""?0:parseFloat(be.quantity)||0;return le+Oe*De*ze(be)},0);await er.createSnapshot(s,Y,U,ee),J?(await er.resetStockQuantities(s),await We(),me(new Set)):await We(!0),I(!1),it(!0)}catch(U){console.error("Failed to complete inventory:",U);const ee=U?.message||U?.error_description||(typeof U=="string"?U:null)||(()=>{try{return JSON.stringify(U)}catch{return null}})()||"";kt({title:"",message:`
${ee}`,type:"error"})}finally{B(!1)}}},yl=()=>{const U=["","","","","()",""],ee=aa.map(Je=>{const st=parseFloat(Je.price)||0,dt=Je.quantity===""?0:parseFloat(Je.quantity)||0,gt=Math.round(st*dt*ze(Je));return[Je.name,st,Je.unit,Je.quantity,gt,Je.vendor||""]}),le=[U.join(","),...ee.map(Je=>Je.map(st=>{const dt=String(st??"");return dt.includes(",")||dt.includes('"')||dt.includes(`
`)?`"${dt.replace(/"/g,'""')}"`:dt}).join(","))].join(`
`),be=new Uint8Array([239,187,191]),Oe=new Blob([be,le],{type:"text/csv"}),De=document.createElement("a"),qe=URL.createObjectURL(Oe),He=new Date().toISOString().split("T")[0];De.href=qe,De.download=`Inventory_${He}.csv`,document.body.appendChild(De),De.click(),document.body.removeChild(De),URL.revokeObjectURL(qe)},vl=["","","","","","","","","","","",""],Fs=[...new Set(Ps.map(U=>U.vendor).filter(U=>U&&!ne(U)))].sort(),Hs=Ps.some(U=>!U.vendor),bi=xn==="summary",aa=Ps.filter(U=>U.name.toLowerCase().includes($.toLowerCase())?xn==="all"||xn==="summary"?!0:xn==="inventory-check"?ar.has(U.id)||!U.isPhantom:xn==="other"?!U.vendor:U.vendor===xn:!1);return C?i.jsxs("div",{className:"inventory-edit-container fade-in",children:[i.jsx("div",{className:"container-header",children:i.jsx("h2",{className:"section-title",children:T&&!T.isNewFromCsv?"":""})}),i.jsx(tn,{className:"edit-form-card",children:i.jsxs("form",{onSubmit:qs,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(zt,{name:"name",defaultValue:T?.name,required:!0,placeholder:": "})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(zt,{name:"quantity",type:"number",step:"0.01",defaultValue:T?.quantity,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(zt,{name:"unit",defaultValue:T?.unit||"g",required:!0,placeholder:"g, ml, ..."})]})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(zt,{name:"category",defaultValue:T?.category,list:"category-list",placeholder:"",autoComplete:"off"}),i.jsx("datalist",{id:"category-list",children:vl.map(U=>i.jsx("option",{value:U},U))})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" ()"}),i.jsx(zt,{name:"threshold",type:"number",step:"0.01",defaultValue:T?.threshold||0})]})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx(se,{variant:"ghost",type:"button",onClick:()=>{M(!1),F(null)},children:""}),i.jsx(se,{variant:"primary",type:"submit",children:""})]})]})})]}):i.jsx(Xi,{onDragEnd:gl,sensors:cn,autoScroll:!1,children:i.jsxs("div",{className:"inventory-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsxs("div",{className:"header-actions inventory-header-actions",children:[i.jsx(se,{variant:"ghost",onClick:n,children:" "}),i.jsx(se,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>l({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),i.jsx(se,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const U=new Date;ue(`${U.getFullYear()}${U.getMonth()+1} `),Z(!0),I(!0)},children:" "}),i.jsx(se,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{ae(null),X("history"),Me(!0)},title:"",children:" "}),i.jsx(se,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{F(null),M(!0)},children:"+ "})]})]}),i.jsx("div",{className:"inventory-split-layout",children:i.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[i.jsxs("div",{className:"inventory-controls",children:[bi?i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsx("select",{className:"inventory-controls__select",value:Ke,onChange:U=>Ze(U.target.value),disabled:Et.length===0,children:Et.length===0?i.jsx("option",{value:"",children:""}):Et.map(U=>i.jsx("option",{value:U.key,children:U.label},U.key))})]}),Nt&&i.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",Nt.rangeLabel]})]}):i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsxs("select",{className:"inventory-controls__select",value:xn==="inventory-check"?"":xn,onChange:U=>{U.target.value&&Ln(U.target.value)},children:[i.jsx("option",{value:"all",children:""}),i.jsx("option",{value:"",disabled:!0,children:""}),i.jsxs("optgroup",{label:"",children:[Fs.map(U=>i.jsx("option",{value:U,children:U},U)),Hs&&i.jsx("option",{value:"other",children:""})]})]})]}),i.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:$,onChange:U=>z(U.target.value)})]}),i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[i.jsxs("button",{className:"inventory-controls__btn",onClick:()=>Ln("inventory-check"),"data-active":xn==="inventory-check"?"true":"false",children:["  (",ar.size,")"]}),i.jsx("button",{className:"inventory-controls__btn",onClick:()=>Ln("summary"),"data-active":xn==="summary"?"true":"false",children:" "}),!bi&&i.jsx("button",{className:"inventory-controls__btn",onClick:yl,title:"CSV",children:" CSV (.csv)"}),!bi&&xn==="inventory-check"&&i.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),bi?i.jsxs("div",{className:"inventory-summary",children:[i.jsx("div",{className:"inventory-summary__header",children:i.jsxs("div",{children:[i.jsx("div",{className:"inventory-summary__title",children:""}),Nt&&i.jsxs("div",{className:"inventory-summary__meta",children:[": ",Nt.rangeLabel]}),Kn?i.jsxs("div",{className:"inventory-summary__meta",children:[": ",Kn.title||"","",Ut(Kn.snapshot_date),""]}):i.jsx("div",{className:"inventory-summary__meta",children:""}),Pr.length>1&&i.jsxs("div",{className:"inventory-summary__note",children:[" ",Pr.length," "]})]})}),Kn?i.jsxs("div",{className:"inventory-summary__table-wrap",children:[i.jsx("div",{className:"inventory-summary__actions",children:i.jsx(se,{variant:"secondary",size:"sm",onClick:ur,children:" CSV (.csv)"})}),i.jsxs("table",{className:"inventory-summary__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40px"}}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx(tl,{items:cr,strategy:Co,children:i.jsxs("tbody",{children:[Yn.map(U=>{const ee=Rt===U.vendor,le=na.get(U.vendor)||null;return i.jsxs(we.Fragment,{children:[i.jsx(Bt,{row:U,onVendorClick:Wu,isSelected:ee}),ee&&le&&i.jsxs("tr",{className:"inventory-summary__detail-row",children:[i.jsx("td",{}),i.jsx("td",{colSpan:"2",children:i.jsxs("div",{className:"inventory-summary__inline-detail",children:[i.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[i.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[le.vendor," "]}),i.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>ml(le),disabled:!le.rows||le.rows.length===0,children:" CSV"}),i.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(le.totals.taxed||0).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(be=>i.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:_t(be)}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(le.totals[be]||0).toLocaleString()]})]},be)),le.totals.unknown>0&&i.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(le.totals.unknown).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(le.totals.net||0).toLocaleString()]}),i.jsx("div",{className:"inventory-summary__inline-items-wrap",children:i.jsxs("table",{className:"inventory-summary__inline-items-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx("tbody",{children:le.rows.map((be,Oe)=>{const De=be.itemCategory?Ue(be.itemCategory):_t(be.breakdownKey),qe=Oe>0?le.rows[Oe-1]:null,He=!!qe&&qe.breakdownKey!==be.breakdownKey;return i.jsxs("tr",{className:He?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[i.jsx("td",{children:be.name||"-"}),i.jsx("td",{children:De}),i.jsxs("td",{style:{textAlign:"right"},children:["",Number(be.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),i.jsxs("td",{style:{textAlign:"right"},children:[Number(be.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),be.unit?` ${be.unit}`:""]}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(be.taxed||0).toLocaleString()]})]},be.id)})})]})})]})})]})]},U.vendor)}),Yn.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsx("td",{}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(hl.net).toLocaleString()," / ",Math.round(hl.taxed).toLocaleString()]})]})})]})]}):i.jsx("div",{className:"inventory-summary__empty",children:""})]}):i.jsx(pT,{items:aa,loading:O,onSearch:z,searchQuery:$,onEdit:U=>{F(U),M(!0)},onDelete:Ko,onUpdateQuantity:Jo,onToggleTax:Ju,onRequestUnitSync:Yo})]})}),i.jsx(yn,{isOpen:!!Jt,onClose:Xo,title:"10%",size:"small",showCloseButton:!jt,children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",Jt?.item?.name||"","",i.jsx("strong",{children:"10%"}),""]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[i.jsx(se,{variant:"secondary",onClick:Xo,disabled:jt,children:""}),i.jsx(se,{variant:"primary",onClick:ia,disabled:jt,children:jt?"...":""})]})]})}),i.jsx(yn,{isOpen:R,onClose:()=>{ye||I(!1)},title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),i.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[i.jsx("strong",{children:":"}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. ",J?i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:"()0"}),""]}):i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:""}),""]}),i.jsx("br",{}),""]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:J,disabled:ye,onChange:()=>Z(!0)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:"0"}),""]})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:!J,disabled:ye,onChange:()=>Z(!1)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:""}),""]})]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),i.jsx("input",{type:"text",value:Y,onChange:U=>ue(U.target.value),disabled:ye,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx("button",{onClick:()=>{ye||I(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:ye?"not-allowed":"pointer",opacity:ye?.6:1,fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Fr,disabled:ye,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:ye?"#94a3b8":"#2ecc71",color:"white",cursor:ye?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:ye?"...":J?"":""})]}),ye&&i.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),i.jsxs(yn,{isOpen:ge,onClose:()=>Me(!1),title:" ",size:"large",children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:A==="history"?i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:sn.length})," "]}):i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:f.length})," "]})}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",gap:"6px"},children:[i.jsx("button",{type:"button",onClick:()=>X("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:A==="history"?"#111":"#fff",color:A==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),i.jsx("button",{type:"button",onClick:()=>X("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:A==="trash"?"#111":"#fff",color:A==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>We(!0),title:"",children:" "})]})]}),A==="history"&&i.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),i.jsx("select",{value:Ye,onChange:U=>tt(U.target.value),disabled:Et.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:Et.length===0?i.jsx("option",{value:"",children:""}):Et.map(U=>i.jsx("option",{value:U.key,children:U.label},U.key))})]}),Vn&&i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",Vn.rangeLabel]})]}),A==="history"&&sn.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):A==="trash"&&f.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:A==="trash"?"":""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),i.jsx("tbody",{children:(A==="history"?sn:f).map(U=>{const ee=Xt(U).filter(dt=>!ne(dt?.vendor)),le=ee.length,be=Math.round(ee.reduce((dt,gt)=>{const Fe=parseFloat(gt?.price)||0,yt=gt?.quantity===""?0:parseFloat(gt?.quantity)||0;return dt+Fe*yt*ze(gt)},0)),Oe=A==="trash"?`trash-${U.id}`:U.id,De=Ut(A==="trash"?U.deleted_at:U.snapshot_date),qe=W?.type==="move"&&W?.id===U.id,He=W?.type==="restore"&&W?.id===U.id,Je=W?.type==="hard-delete"&&W?.id===U.id,st=qe||He||Je;return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:De}),i.jsx("td",{style:{padding:"10px"},children:U.title||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:le.toLocaleString()}),i.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",be.toLocaleString()]}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:A==="history"?i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>pl(U),disabled:le===0||st,title:le===0?"items CSV":"CSV",children:" CSV"}),i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>ae(U),disabled:st,children:""}),i.jsx(se,{variant:"danger",size:"sm",onClick:()=>fl(U),disabled:st,title:"",children:qe?"...":""})]}):i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>pl(U),disabled:le===0||st,children:" CSV"}),i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>ae(U),disabled:st,children:""}),i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>Vo(U),disabled:st,title:"",children:He?"...":""}),i.jsx(se,{variant:"danger",size:"sm",onClick:()=>ra(U),disabled:st,title:"",children:Je?"...":""})]})})]},Oe)})})]})})]}),i.jsx(yn,{isOpen:!!ce,onClose:()=>{Le||Se(null)},title:ce?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:ce?.message}),ce?.requireText&&i.jsxs("div",{style:{marginTop:"14px"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",i.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:ce.requireText})," "]}),i.jsx("input",{type:"text",value:Ae,onChange:U=>Be(U.target.value),placeholder:ce.requireText,disabled:Le,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(se,{variant:"ghost",disabled:Le,onClick:()=>{Le||Se(null)},children:""}),i.jsx(se,{variant:"danger",disabled:Le||!!ce?.requireText&&Ae!==ce.requireText,onClick:()=>ce?.onConfirm&&ce.onConfirm(),children:Le?ce?.loadingLabel||"...":ce?.confirmLabel||""})]})]})}),i.jsx(yn,{isOpen:!!ve,onClose:()=>ae(null),title:ve?` ${ve.title||""}`:" ",size:"large",children:(()=>{const U=ve;if(!U)return null;const be=[...Xt(U).filter(De=>ne(De?.vendor)?!1:$e?(De?.quantity===""?0:parseFloat(De?.quantity)||0)!==0:!0)].sort((De,qe)=>{const He=mt.direction==="desc"?-1:1;if(mt.key==="vendor"){const yt=(De?.vendor||"").toString(),pn=(qe?.vendor||"").toString(),dn=yt.localeCompare(pn,"ja");if(dn!==0)return dn*He;const Gs=(De?.name||"").toString(),es=(qe?.name||"").toString();return Gs.localeCompare(es,"ja")*He}const Je=(De?.name||"").toString(),st=(qe?.name||"").toString(),dt=Je.localeCompare(st,"ja");if(dt!==0)return dt*He;const gt=(De?.vendor||"").toString(),Fe=(qe?.vendor||"").toString();return gt.localeCompare(Fe,"ja")*He}),Oe=be.reduce((De,qe)=>{const He=parseFloat(qe?.price)||0,Je=qe?.quantity===""?0:parseFloat(qe?.quantity)||0,st=He*Je;return De.net+=st,De.taxed+=st*ze(qe),De},{net:0,taxed:0});return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[i.jsxs("div",{children:[": ",i.jsx("strong",{children:Ut(U.snapshot_date)})]}),i.jsxs("div",{children:[": ",i.jsx("strong",{children:be.length.toLocaleString()})]}),i.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",i.jsxs("strong",{children:["",Math.round(Oe.net).toLocaleString()," / ",Math.round(Oe.taxed).toLocaleString()]})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:$e,onChange:De=>rt(De.target.checked)}),"0"]}),i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>pl(U),children:" CSV (.csv)"})]}),be.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{ft(De=>De.key==="vendor"?{key:"vendor",direction:De.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",mt.key==="vendor"&&(mt.direction==="asc"?"":"")]})]})}),i.jsx("tbody",{children:be.map((De,qe)=>{const He=parseFloat(De?.price)||0,Je=De?.quantity===""?0:parseFloat(De?.quantity)||0,st=Math.round(He*Je*ze(De)),dt=dl(De),gt=Ue(dt);return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsxs("td",{style:{padding:"10px"},children:[De?.name||"-",fe(De?.tax10)&&i.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),i.jsx("td",{style:{padding:"10px"},children:gt}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:He?`${Number(He).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:De?.unit||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Je?Je.toLocaleString():"0"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:st?`${st.toLocaleString()}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:De?.vendor||"-"})]},De?.id||`${De?.name||"item"}-${qe}`)})})]})})]})})()}),i.jsx(yn,{isOpen:K,onClose:us,title:"",size:"small",children:(()=>{const U=q,ee=U?._master?.packetUnit||"",le=U?.unit||"",be=Xe(le,ee),Oe=be!==null&&be!==1,De=parseFloat(U?.price)||0,qe=U?.quantity===""?0:parseFloat(U?.quantity)||0,He=U?ze(U):1.08,Je=De*qe*He,st=ee?Pe(U?._master,ee):null,dt=st===null?null:st*qe*He,gt=st===null||!Oe?null:st*(qe*be)*He,Fe=pn=>`${Math.round(pn).toLocaleString()}`,yt=pn=>Number.isInteger(pn)?pn.toLocaleString():pn.toLocaleString(void 0,{maximumFractionDigits:3});return i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[i.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:U?.name||"-"}),i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",yt(qe)," ",le," /  ",De.toLocaleString()," /  ",Fe(Je)]}),!!ee&&i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",ee]})]}),i.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",i.jsx("br",{}),""]})}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[i.jsx(se,{variant:"ghost",type:"button",onClick:us,disabled:P,children:""}),i.jsx(se,{variant:"secondary",type:"button",onClick:()=>Qo({convertQuantity:!1}),isLoading:P,disabled:P||!ee||st===null,title:dt===null?"":`:  ${Fe(dt)}`,children:""}),Oe&&i.jsx(se,{variant:"primary",type:"button",onClick:()=>Qo({convertQuantity:!0}),isLoading:P,disabled:P||!ee||st===null,title:gt===null?"":`:  ${Fe(gt)}`,children:""})]})]})})()}),i.jsx(yn,{isOpen:Dt,onClose:()=>Vt(!1),title:"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",i.jsx("strong",{children:St?.name}),""]}),i.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",i.jsx("strong",{children:""}),"",i.jsx("br",{}),"CSV"]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx("button",{onClick:()=>Vt(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Wo,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),i.jsx(yn,{isOpen:Ie,onClose:()=>it(!1),title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),i.jsxs("h3",{style:{marginBottom:"1rem"},children:[Y," "]}),i.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",i.jsx("br",{}),""]}),i.jsx("button",{onClick:()=>it(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),i.jsx(yn,{isOpen:!!ut,onClose:()=>kt(null),title:ut?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[ut?.type==="success"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),ut?.type==="error"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),i.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:ut?.message}),i.jsx("button",{onClick:()=>kt(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:ut?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},co="app-data",gT="incoming-deliveries",yT=n=>{const t=String(n||"").trim();return t&&t.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},vT=n=>{const t=String(n),s=t.lastIndexOf(".");return s<=0?t:t.slice(0,s)},xT=async n=>{if(!n)return"";const t=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},Jr={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${gT}`},_filePath(n,t){const s=this._folderPath(n),l=String(t||"").replace(/^\/+/,"");return`${s}/${l}`},async listJsonFiles(n=null){const t=n||await this._getCurrentUserId();if(!t)return[];const s=this._folderPath(t),{data:l,error:o}=await Re.storage.from(co).list(s,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return o?(console.error("Failed to list incoming deliveries:",o),[]):(l||[]).filter(u=>String(u?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=this._filePath(s,n),{data:o,error:u}=await Re.storage.from(co).download(l);if(u)throw u;const d=await xT(o);return JSON.parse(d)},async saveDeliverySet({pdfFile:n,parsed:t},s=null){const l=s||await this._getCurrentUserId();if(!l)throw new Error("");if(!n)throw new Error("PDF");if(!t)throw new Error("");const o=new Date,u=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}_${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,d=yT(vT(n.name||"delivery")),h=`${u}_${d}`,f=this._filePath(l,`${h}.pdf`),m=this._filePath(l,`${h}.json`),y={...t,_meta:{savedAt:o.toISOString(),originalFileName:n.name||null}},[v,x]=await Promise.all([Re.storage.from(co).upload(f,n,{upsert:!1,contentType:"application/pdf"}),Re.storage.from(co).upload(m,new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(v.error)throw v.error;if(x.error)throw x.error;return{baseName:h,pdfPath:f,jsonPath:m}},async deleteDeliverySet(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=String(n||"").trim();if(!l)throw new Error("baseName ");const o=this._filePath(s,`${l}.pdf`),u=this._filePath(s,`${l}.json`),{data:d,error:h}=await Re.storage.from(co).remove([o,u]);if(h)throw h;return d}},bT="/app/assets/pdf.worker-DU8cYlj-.js",wT=n=>typeof n=="string"&&n.trim().length>0,Ds=n=>String(n??"").replace(/\u0000/g,"").trim(),mo=n=>{const t=String(n??"").trim();if(!t)return null;const s=t.replace(/[,\s]/g,""),l=Number(s);return Number.isFinite(l)?l:null},uo=n=>{const t=String(n??"").trim();if(!t)return null;const s=t.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return s?s[2]?`${s[1]} ${s[2]}`:s[1]:null},ST=n=>{const t=String(n??"").trim();return!!(!t||t==="/"||t.startsWith("")||t.includes(""))},jT=(n,t)=>{const s=String(n??"").trim(),l=s.match(/^No\.?\s*(\d{3,})\s*$/);if(l?.[1])return{slipNo:l[1],consumeNext:!1};if(/^No\.?\s*$/.test(s)){const o=String(t??"").trim();if(/^\d{3,}$/.test(o))return{slipNo:o,consumeNext:!0}}return null},ip=n=>{const t=String(n??"").trim();return t?!!/^No\.?\s*(\d{3,})?\s*$/.test(t):!1},_T=(n,t)=>{const s=Ds(n[t]);if(!s||ip(s)||s===""||s===""||s===""||s==="No"||s===""||s===""||s===""||s===""||s===""||s==="")return null;let l=t+1;const o=mo(n[l]);if(o==null)return null;l+=1;const u=mo(n[l]);if(u==null)return null;l+=1;const d=Ds(n[l]);if(!d)return null;l+=1;let h=null,f=null,m=null;const y=mo(n[l]);for(y!=null?(f=y,l+=1,m=Ds(n[l]),l+=1):(h=Ds(n[l])||null,l+=1,f=mo(n[l]),l+=1,m=Ds(n[l]),l+=1);l<n.length;){const w=Ds(n[l]);if(w===""||w===""){l+=1;continue}break}let v=null;const x=Ds(n[l]);return/^\d+$/.test(x)&&(v=parseInt(x,10),l+=1),{item:{no:v,code:null,name:s,unitPrice:o,deliveryQty:u,deliveryUnit:d,spec:h,orderQty:f,orderUnit:m},nextIndex:l}},CT=n=>{const t=(n||[]).map(Ds).filter(h=>!ST(h)),s={title:t.find(h=>h.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let h=0;h<t.length;h+=1){const f=t[h],m=f.match(/^?\s*(.+)$/);if(m?.[1]&&!s.outputAt){s.outputAt=uo(m[1])||m[1].trim();continue}const y=f.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);y&&!s.rangeFrom&&(s.rangeFrom=y[1],s.rangeTo=y[2])}const l=new Map;let o=null,u=null;for(let h=0;h<t.length;h+=1){const f=t[h],m=t[h+1],y=jT(f,m);if(y?.slipNo){const v=y.slipNo;y.consumeNext&&(h+=1);const x=l.get(v);x?o=x:(o={slipNo:v,vendor:u||null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},l.set(v,o));continue}if(/^(||)/.test(f)&&!f.includes("")&&!f.includes("")&&!f.includes("")){let v=3;(f.startsWith("")||f.startsWith("")||f.startsWith(""))&&(v=4);let x=f.slice(v).trim();(x.startsWith(":")||x.startsWith(""))&&(x=x.slice(1).trim());let w=null;if(!x)wT(m)&&!/^\d+$/.test(m)&&!m.includes("")&&(w=m.trim());else{const _=x.match(/^(\d+)\s+(.+)$/);_&&(x=_[2].trim()),w=x}w&&(o?o.vendor||(o.vendor=w):u=w);continue}if(o){if(f===""||f.startsWith("")){const v=f.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.slipDate=v[1]:uo(m)&&(o.slipDate=uo(m));continue}if(f===""){const v=mo(m);v!=null&&(o.total=v);continue}if(f===""||f.startsWith("")){const v=f.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.deliveryDate=v[1]:uo(m)&&(o.deliveryDate=uo(m)?.slice(0,10));continue}if(f.startsWith("")){const x=f.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(x&&x!=="No"){o.comment=x;continue}const w=[];for(let N=h+1;N<t.length;N+=1){const j=t[N];if(j){if(ip(j)||j==="No"||j===""||j===""||j===""||j===""||j===""||j===""||j==="")break;w.push(j)}}const _=w.join(" ").trim();_&&_!=="No"&&(o.comment=_);continue}if(f===""||f===""){let v=h+1;for(;v<t.length;){const x=t[v];if(ip(x)||x==="")break;const w=_T(t,v);if(!w){v+=1;continue}o.items.push(w.item),v=w.nextIndex}h=v-1}}}const d=Array.from(l.values()).sort((h,f)=>String(h.slipNo).localeCompare(String(f.slipNo),"ja"));return{report:s,slips:d}},Mx=async n=>{if(!n)throw new Error("PDF");const t=await n.arrayBuffer(),s=await wu(()=>import("./pdf-x4TCsUAT.js").then(h=>h.p),[]),l=s?.default&&s.default.getDocument?s.default:s;if(!l?.getDocument)throw new Error("PDF");l?.GlobalWorkerOptions&&(l.GlobalWorkerOptions.workerSrc=bT);const o=await l.getDocument({data:new Uint8Array(t)}).promise,u=[];for(let h=1;h<=o.numPages;h+=1){const m=await(await o.getPage(h)).getTextContent();for(const y of m.items||[]){const v=Ds(y?.str);v&&u.push(v)}}const d=CT(u);if(!d?.slips||d.slips.length===0)throw new Error("PDFPDF");return d},zf=n=>String(n||"").replace(/\.json$/i,""),zx=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const s=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${s}/${l}/${o} ${u}:${d}`},NT=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},ET=n=>String(n||"").trim(),TT=({onBack:n})=>{const[t,s]=Lo(),[l,o]=we.useState(!0),[u,d]=we.useState([]),[h,f]=we.useState(null),[m,y]=we.useState(!1),[v,x]=we.useState(!1),[w,_]=we.useState(null),[N,j]=we.useState(!1),[E,O]=we.useState(""),[D,$]=we.useState(null),[z,C]=we.useState(!1),[M,T]=we.useState(null),[F,K]=we.useState(!1),[G,q]=we.useState(!1),[V,P]=we.useState(null),L=we.useCallback(async()=>{o(!0),O("");try{const ae=await Jr.listJsonFiles();d(ae||[])}catch(ae){console.error(ae),O(""),d([])}finally{o(!1)}},[]);we.useEffect(()=>{L()},[L]);const R=ae=>{ae.preventDefault(),y(!0)},I=ae=>{ae.preventDefault(),y(!1)},Y=ae=>{ae.preventDefault(),y(!1);const A=ae.dataTransfer.files?.[0];A&&A.type==="application/pdf"?(f(A),_(null),P(null),O(""),ue(A)):A&&O("PDF")},ue=async ae=>{if(ae){O(""),x(!0),_(null),P(null);try{const A=await Mx(ae);_(A||null)}catch(A){console.error(A),O(`PDF:
${A?.message||String(A)}`)}finally{x(!1)}}},ye=async()=>{if(h){O(""),x(!0),_(null),P(null);try{const ae=await Mx(h);_(ae||null)}catch(ae){console.error(ae),O(`PDF:
${ae?.message||String(ae)}`)}finally{x(!1)}}},B=async()=>{if(!(!h||!w)){O(""),j(!0);try{await Jr.saveDeliverySet({pdfFile:h,parsed:w}),f(null),_(null),await L()}catch(ae){console.error(ae),O(`: ${ae?.message||String(ae)}`)}finally{j(!1)}}},J=async ae=>{const A=zf(ae);C(!0),O("");try{const X=await Jr.downloadJson(ae);$({baseName:A,data:X})}catch(X){console.error(X),O(`: ${X?.message||String(X)}`)}finally{C(!1)}},Z=async()=>{if(M?.baseName){K(!0),O("");try{await Jr.deleteDeliverySet(M.baseName),T(null),await L()}catch(ae){console.error(ae),O(`: ${ae?.message||String(ae)}`)}finally{K(!1)}}},ge=ae=>{const A=new Map,X=(Se,Ae)=>{const Be=String(Se?.name||"").trim();if(!Be)return;const Le=ET(Se?.deliveryUnit||Se?.unit||Se?.unitName||""),Ge=NT(Se?.deliveryQty??Se?.quantity??Se?.qty);if(!Number.isFinite(Ge)||Ge===null)return;const W=String(Ae||"").trim(),Ce=`${W}@@${nn(Be)}@@${Le||""}`,$e=A.get(Ce);$e?$e.qty+=Ge:A.set(Ce,{vendor:W,name:Be,unit:Le,qty:Ge})};return(ae?.slips||ae?.receipts||[]).forEach(Se=>{const Ae=Se?.vendor||"";(Se?.items||[]).forEach(Le=>X(Le,Ae))}),Array.from(A.values()).sort((Se,Ae)=>Se.vendor!==Ae.vendor?Se.vendor.localeCompare(Ae.vendor,"ja"):Se.name!==Ae.name?Se.name.localeCompare(Ae.name,"ja"):String(Se.unit||"").localeCompare(String(Ae.unit||""),"ja"))},Me=async()=>{q(!0),O(""),P(null);try{const ae=await Jr.listJsonFiles();if(!ae||ae.length===0){P([]);return}const A=[];for(const Se of ae){const Ae=Se?.name;if(Ae)try{const Be=await Jr.downloadJson(Ae);A.push(Be)}catch(Be){console.warn("Failed to download:",Ae,Be)}}const X=new Map;A.forEach(Se=>{ge(Se).forEach(Be=>{const Le=`${Be.vendor}@@${nn(Be.name)}@@${Be.unit||""}`,Ge=X.get(Le);Ge?Ge.qty+=Be.qty:X.set(Le,{...Be})})});const ce=Array.from(X.values()).sort((Se,Ae)=>Se.vendor!==Ae.vendor?Se.vendor.localeCompare(Ae.vendor,"ja"):Se.name!==Ae.name?Se.name.localeCompare(Ae.name,"ja"):String(Se.unit||"").localeCompare(String(Ae.unit||""),"ja"));P(ce)}catch(ae){console.error(ae),O(`: ${ae?.message||String(ae)}`)}finally{q(!1)}},ve=w?.slips||w?.receipts||[];return i.jsxs("div",{className:"incoming-deliveries",children:[i.jsxs("div",{className:"incoming-deliveries__header",children:[i.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsx(se,{variant:"secondary",onClick:()=>s({view:"incoming-stock"}),children:" "}),i.jsx(se,{variant:"ghost",onClick:n,children:" "})]})]}),E&&i.jsx(tn,{className:"incoming-deliveries__error",children:E}),i.jsxs(tn,{className:"incoming-deliveries__card",children:[i.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",cE]}),i.jsxs("div",{className:"incoming-deliveries__upload",children:[i.jsxs("div",{className:`incoming-deliveries__upload-zone ${m?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:R,onDragLeave:I,onDrop:Y,children:[i.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:m?"var(--color-primary)":"inherit"},children:m?"":"PDF"}),i.jsx("input",{type:"file",accept:"application/pdf",onChange:ae=>{const A=ae.target.files?.[0]||null;f(A),_(null),P(null),O("")},style:{width:"100%"}})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[i.jsx(se,{variant:"secondary",onClick:ye,disabled:!h||v||N,children:v?"":""}),i.jsx(se,{variant:"primary",onClick:B,disabled:!h||!w||N||v,children:N?"":""})]})]}),w&&i.jsxs("div",{className:"incoming-deliveries__preview",children:[i.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",i.jsx("strong",{children:w?.report?.outputAt||w?.report?.outputDate||"-"})]}),i.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",i.jsx("strong",{children:ve.length})]}),ve.slice(0,3).map((ae,A)=>i.jsxs("div",{className:"incoming-deliveries__slip",children:[i.jsxs("div",{className:"incoming-deliveries__slip-head",children:[i.jsx("div",{style:{fontWeight:700},children:ae?.vendor||""}),i.jsxs("div",{style:{opacity:.85},children:["No: ",ae?.slipNo||"-"," / : ",ae?.deliveryDate||"-"]})]}),i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"52%"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%"},children:""})]})}),i.jsx("tbody",{children:(ae?.items||[]).slice(0,6).map((X,ce)=>i.jsxs("tr",{children:[i.jsx("td",{children:X?.name||"-"}),i.jsx("td",{style:{textAlign:"right"},children:X?.unitPrice!=null?`${Math.round(X.unitPrice).toLocaleString()}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:X?.deliveryQty!=null?X.deliveryQty:"-"}),i.jsx("td",{children:X?.deliveryUnit||"-"})]},`${X?.no||ce}`))})]}),(ae?.items||[]).length>6&&i.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(ae?.items||[]).length-6)," "]})]},`${ae?.slipNo||ae?.id||A}`)),ve.length>3&&i.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),i.jsxs(tn,{className:"incoming-deliveries__card",children:[i.jsxs("div",{className:"incoming-deliveries__list-head",children:[i.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsx(se,{variant:"secondary",onClick:L,disabled:l||G,children:""}),i.jsx(se,{variant:"secondary",onClick:Me,disabled:l||G,children:G?"":""})]})]}),l?i.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):u.length===0?i.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):i.jsx("div",{className:"incoming-deliveries__file-list",children:u.map(ae=>i.jsxs("div",{className:"incoming-deliveries__file-row",children:[i.jsxs("div",{className:"incoming-deliveries__file-info",children:[i.jsx("div",{style:{fontWeight:700},children:zf(ae.name)}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",zx(ae.updated_at||ae.created_at)]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>J(ae.name),disabled:z||F,children:z?"":""}),i.jsx(se,{variant:"ghost",size:"sm",onClick:()=>T({baseName:zf(ae.name)}),disabled:F,children:""})]})]},ae.name))}),V&&i.jsxs("div",{className:"incoming-deliveries__aggregate",children:[i.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),V.length===0?i.jsx("div",{style:{opacity:.85},children:""}):i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:"/"}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:V.slice(0,60).map(ae=>i.jsxs("tr",{children:[i.jsx("td",{children:ae.vendor||"-"}),i.jsx("td",{children:ae.name}),i.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(ae.qty)?ae.qty:"-"}),i.jsx("td",{children:ae.unit||"-"})]},`${ae.vendor}@@${ae.name}@@${ae.unit||""}`))})]}),V.length>60&&i.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),i.jsx(yn,{isOpen:!!D,onClose:()=>$(null),title:"PDF ",size:"large",children:D?.data?i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",zx(D.data?._meta?.savedAt),D.data?._meta?.originalFileName?` / : ${D.data._meta.originalFileName}`:""]}),(D.data?.slips||D.data?.receipts||[]).map((ae,A)=>i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[ae?.vendor||"","No: ",ae?.slipNo||"-"," / : ",ae?.deliveryDate||"-",""]}),i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"52%"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%"},children:""})]})}),i.jsx("tbody",{children:(ae?.items||[]).map((X,ce)=>i.jsxs("tr",{children:[i.jsx("td",{children:X?.name||"-"}),i.jsx("td",{style:{textAlign:"right"},children:X?.unitPrice!=null?`${Math.round(X.unitPrice).toLocaleString()}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:X?.deliveryQty!=null?X.deliveryQty:"-"}),i.jsx("td",{children:X?.deliveryUnit||"-"})]},`${X?.no||ce}`))})]})]},`${ae?.slipNo||A}`))]}):i.jsx("div",{style:{opacity:.8},children:""})}),i.jsx(yn,{isOpen:!!M,onClose:()=>T(null),title:"",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsxs("p",{style:{marginTop:0},children:["",M?.baseName,""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>T(null),disabled:F,children:""}),i.jsx(se,{variant:"danger",onClick:Z,disabled:F,children:F?"":""})]})]})})]})},Rs="app-data",kT="incoming-stock",RT="stock.json",AT="applied",Wi=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},nl=n=>String(n||"").trim(),Ji=(n,t,s)=>`${String(s||"").trim()}@@${nn(n)}@@${nl(t)}`,Uf=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===404)return!0;const l=String(n?.message||"").toLowerCase();return l.includes("not found")||l.includes("object not found")},OT=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===409)return!0;const l=String(n?.message||"").toLowerCase();return l.includes("already exists")||l.includes("duplicate")||l.includes("409")},DT=n=>{const t=new Map;return(n?.slips||n?.receipts||[]).forEach(l=>{const o=String(l?.vendor||"").trim();(l?.items||[]).forEach(u=>{const d=String(u?.name||"").trim();if(!d)return;const h=nl(u?.deliveryUnit||u?.unit||u?.unitName||""),f=Wi(u?.deliveryQty??u?.quantity??u?.qty);if(f==null)return;const m=Ji(d,h,o),y=t.get(m);y?y.quantity+=f:t.set(m,{vendor:o,name:d,unit:h,quantity:f})})}),Array.from(t.values()).filter(l=>Number.isFinite(l.quantity))},MT=(n,t,s)=>{const l=new Map;return(n||[]).forEach(o=>{const u=String(o?.name||"").trim();if(!u)return;const d=nl(o?.unit||""),h=String(o?.vendor||"").trim(),f=Wi(o?.quantity)??0;l.set(Ji(u,d,h),{vendor:h,name:u,unit:d,quantity:f,updatedAt:o?.updatedAt||null})}),t.forEach(o=>{const u=Ji(o.name,o.unit,o.vendor),d=l.get(u);d?(d.quantity=Math.max(0,(Wi(d.quantity)??0)+(Wi(o.quantity)??0)),d.updatedAt=s):l.set(u,{vendor:o.vendor,name:o.name,unit:nl(o.unit),quantity:Math.max(0,Wi(o.quantity)??0),updatedAt:s})}),Array.from(l.values()).sort((o,u)=>o.vendor!==u.vendor?o.vendor.localeCompare(u.vendor,"ja"):o.name!==u.name?o.name.localeCompare(u.name,"ja"):String(o.unit||"").localeCompare(String(u.unit||""),"ja"))},As={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${kT}`},_stockPath(n){return`${this._folderPath(n)}/${RT}`},_appliedFolder(n){return`${this._folderPath(n)}/${AT}`},_appliedMarkerPath(n,t){const s=this._appliedFolder(n),l=String(t||"").trim();if(!l)throw new Error("baseName is required");return`${s}/${l}.json`},async listAppliedBaseNames(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Set;const s=this._appliedFolder(t),{data:l,error:o}=await Re.storage.from(Rs).list(s,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(o)return Uf(o)?new Set:(console.error("Failed to list applied markers:",o),new Set);const u=new Set;return(l||[]).forEach(d=>{const h=String(d?.name||"");h.toLowerCase().endsWith(".json")&&u.add(h.replace(/\.json$/i,""))}),u},async loadStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const s=this._stockPath(t),{data:l,error:o}=await Re.storage.from(Rs).createSignedUrl(s,60);if(o){if(Uf(o))return{_meta:{version:1,updatedAt:null},items:[]};throw o}try{const u=await fetch(l.signedUrl,{cache:"no-store"});if(!u.ok){if(u.status===404)return{_meta:{version:1,updatedAt:null},items:[]};throw new Error(`Failed to fetch stock: ${u.status} ${u.statusText}`)}const d=await u.text(),h=JSON.parse(d||"{}"),f=Array.isArray(h?.items)?h.items:[];return{_meta:{version:1,updatedAt:h?._meta?.updatedAt||null},items:f}}catch(u){throw console.warn("loadStock fetch failed",u),u}},async saveStock(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=this._stockPath(s),o={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(n?.items)?n.items:[]},{error:u}=await Re.storage.from(Rs).upload(l,new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(u)throw u;return o},async applyDeliverySet({baseName:n,parsed:t},s=null){const l=s||await this._getCurrentUserId();if(!l)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("baseName ");if(!t)throw new Error("");const u=DT(t),d=new Date().toISOString(),h=this._appliedMarkerPath(l,o),f={baseName:o,appliedAt:d,slipCount:(t?.slips||t?.receipts||[]).length||0,itemCount:u.length},m=await Re.storage.from(Rs).upload(h,new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(m.error){if(OT(m.error))return{status:"already_applied"};throw m.error}try{const y=await this.loadStock(l),v=MT(y.items||[],u,d);return await this.saveStock({items:v},l),{status:"applied",addedCount:u.length}}catch(y){try{await Re.storage.from(Rs).remove([h])}catch{}throw y}},async updateStockItem({name:n,unit:t,vendor:s,delta:l},o=null){const u=o||await this._getCurrentUserId();if(!u)throw new Error("");const d=String(n||"").trim();if(!d)throw new Error("");const h=nl(t),f=String(s||"").trim(),m=Ji(d,h,f),y=Wi(l);if(y===null||!Number.isFinite(y))throw new Error("");const x=(await this.loadStock(u)).items||[],w=new Date().toISOString();let _=!1;const N=x.map(j=>{if(Ji(j.name,j.unit,j.vendor)===m){_=!0;const O=Math.max(0,(Wi(j.quantity)??0)+y);return{...j,quantity:O,updatedAt:w}}return j});if(!_)throw new Error("");return await this.saveStock({items:N},u),{status:"updated",name:d,unit:h}},async deleteStockItem({name:n,unit:t,vendor:s},l=null){const o=l||await this._getCurrentUserId();if(!o)throw new Error("");const u=String(n||"").trim();if(!u)throw new Error("");const d=nl(t),h=String(s||"").trim(),f=Ji(u,d,h),y=(await this.loadStock(o)).items||[],v=y.filter(x=>Ji(x.name,x.unit,x.vendor)!==f);return v.length,y.length,await this.saveStock({items:v},o),{status:"deleted",name:u}},async clearStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const s=this._stockPath(t),l={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await Re.storage.from(Rs).upload(s,new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const o=this._appliedFolder(t),{data:u}=await Re.storage.from(Rs).list(o,{limit:1e3});if(u?.length){const d=u.map(h=>`${o}/${h.name}`);await Re.storage.from(Rs).remove(d)}return{status:"cleared"}},async deleteAppliedMarker(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=this._appliedMarkerPath(s,n),{error:o}=await Re.storage.from(Rs).remove([l]);if(o){if(Uf(o))return{status:"not_found"};throw o}return{status:"deleted"}}},pu=n=>String(n||"").replace(/\.json$/i,""),zT=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const s=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${s}/${l}/${o} ${u}:${d}`},UT=({onBack:n})=>{const[t,s]=Lo(),[l,o]=we.useState(!0),[u,d]=we.useState(""),[h,f]=we.useState([]),[m,y]=we.useState(new Set),[v,x]=we.useState({items:[]}),[w,_]=we.useState(null),[N,j]=we.useState("need_order"),[E,O]=we.useState(!1),[D,$]=we.useState(null),[z,C]=we.useState(""),[M,T]=we.useState(!1),F=we.useCallback(async()=>{o(!0),d("");try{const[W,Ce,$e]=await Promise.all([Jr.listJsonFiles(),As.listAppliedBaseNames(),As.loadStock()]);f(W||[]),y(Ce||new Set),x($e||{items:[]})}catch(W){console.error(W),d(W?.message||String(W))}finally{o(!1)}},[]);we.useEffect(()=>{F()},[F]);const K=async W=>{const Ce=pu(W);_(Ce),d("");try{const $e=await Jr.downloadJson(W);(await As.applyDeliverySet({baseName:Ce,parsed:$e}))?.status==="already_applied"&&d("PDF"),await F()}catch($e){console.error($e),d($e?.message||String($e))}finally{_(null)}},G=async()=>{_("all"),d("");try{const W=await Jr.listJsonFiles(),Ce=await As.listAppliedBaseNames();for(const $e of W||[]){const rt=$e?.name;if(!rt)continue;const mt=pu(rt);if(Ce.has(mt))continue;const ft=await Jr.downloadJson(rt);(await As.applyDeliverySet({baseName:mt,parsed:ft}))?.status==="applied"&&Ce.add(mt)}await F()}catch(W){console.error(W),d(W?.message||String(W))}finally{_(null)}},q=W=>{$(W),C(""),O(!0),d("")},V=W=>{C(Ce=>{const rt=(parseFloat(Ce)||0)+W;return String(Math.round(rt*100)/100)})},P=async()=>{if(!D)return;const W=Number(z);if(!z||isNaN(W)||W<=0){d("");return}T(!0),d("");try{await As.updateStockItem({name:D.name,unit:D.unit,vendor:D.vendor,delta:-W}),x(Ce=>({...Ce,items:(Ce.items||[]).map($e=>{if($e.name===D.name&&($e.unit||"")===(D.unit||"")&&($e.vendor||"")===(D.vendor||"")){const mt=Math.max(0,($e.quantity||0)-W);return{...$e,quantity:Math.round(mt*1e3)/1e3}}return $e})})),O(!1),$(null)}catch(Ce){console.error(Ce),d(Ce?.message||String(Ce))}finally{T(!1)}},[L,R]=we.useState(!1),[I,Y]=we.useState(null),[ue,ye]=we.useState(!1),[B,J]=we.useState(!1),[Z,ge]=we.useState(!1),Me=W=>{Y(W),R(!0),d("")},ve=async()=>{if(I){ye(!0),d("");try{await As.deleteStockItem({name:I.name,unit:I.unit,vendor:I.vendor}),x(W=>({...W,items:(W.items||[]).filter(Ce=>!(Ce.name===I.name&&(Ce.unit||"")===(I.unit||"")&&(Ce.vendor||"")===(I.vendor||"")))})),R(!1),Y(null)}catch(W){console.error(W),d(": "+(W.message||String(W)))}finally{ye(!1)}}},[ae,A]=we.useState(!1),[X,ce]=we.useState(null),[Se,Ae]=we.useState(!1),Be=W=>{const Ce=pu(W.name);ce({name:W.name,baseName:Ce}),A(!0),d("")},Le=async()=>{if(X){Ae(!0),d("");try{await Jr.deleteDeliverySet(X.baseName),await As.deleteAppliedMarker(X.baseName),await F(),A(!1),ce(null)}catch(W){console.error(W),d("PDF: "+(W.message||String(W)))}finally{Ae(!1)}}},Ge=async()=>{ge(!0),d("");try{await As.clearStock(),await F(),J(!1)}catch(W){console.error(W),d(": "+(W.message||String(W)))}finally{ge(!1)}};return i.jsxs("div",{className:"incoming-stock",children:[i.jsxs("div",{className:"incoming-stock__header",children:[i.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx(se,{variant:"secondary",onClick:()=>s({view:"incoming-deliveries"}),children:" PDF"}),i.jsx(se,{variant:"ghost",onClick:n,children:" "})]})]}),u&&i.jsx(tn,{className:"incoming-stock__error",children:u}),i.jsxs(tn,{className:"incoming-stock__card",children:[i.jsxs("div",{className:"incoming-stock__card-head",children:[i.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[i.jsx(se,{variant:"secondary",onClick:F,disabled:l||!!w,children:""}),i.jsx(se,{variant:"primary",onClick:G,disabled:l||!!w,children:w==="all"?"":""}),i.jsx(se,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:()=>J(!0),disabled:l||!!w||!v?.items?.length,children:" "})]})]}),l?i.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):h.length===0?i.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):i.jsx("div",{className:"incoming-stock__file-list",children:h.map(W=>{const Ce=pu(W?.name),$e=m.has(Ce);return i.jsxs("div",{className:"incoming-stock__file-row",children:[i.jsxs("div",{className:"incoming-stock__file-info",children:[i.jsx("div",{style:{fontWeight:700},children:Ce}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",zT(W.updated_at||W.created_at)]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[$e?i.jsx("span",{className:"incoming-stock__badge",children:""}):i.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),i.jsx(se,{variant:$e?"secondary":"primary",size:"sm",onClick:()=>K(W.name),disabled:!!w||$e,children:w===Ce?"":$e?"":""}),i.jsx(se,{variant:"ghost",size:"sm",style:{color:"#d32f2f",marginLeft:"4px"},onClick:()=>Be(W),disabled:!!w,title:"PDF",children:""})]})]},W.name)})}),!l&&i.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",i.jsx("strong",{children:m.size}),"  / PDF: ",i.jsx("strong",{children:h.length})," "]})]}),i.jsxs(tn,{className:"incoming-stock__card",children:[i.jsx("div",{className:"incoming-stock__card-head",children:i.jsx("h3",{className:"incoming-stock__section-title",children:""})}),i.jsxs("div",{className:"incoming-stock__tabs",children:[i.jsxs("button",{className:`incoming-stock__tab-button ${N==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>j("need_order"),children:[" ",i.jsx("span",{className:"incoming-stock__tab-count",children:(v?.items||[]).filter(W=>(W.quantity||0)<=0).length})]}),Array.from(new Set((v?.items||[]).map(W=>W.vendor||""))).sort().map(W=>i.jsx("button",{className:`incoming-stock__tab-button ${N===W?"incoming-stock__tab-button--active":""}`,onClick:()=>j(W),children:W},W))]}),(()=>{let W=[];if(N==="need_order")W=(v?.items||[]).filter(Ce=>(Ce.quantity||0)<=0);else{const Ce=N===""?"":N;W=(v?.items||[]).filter($e=>($e.vendor||"")===Ce)}return W.length===0?i.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:N==="need_order"?"0":""}):i.jsx("div",{className:"incoming-stock__table-wrap",children:i.jsxs("table",{className:"incoming-stock__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"50%"},children:"/"}),i.jsx("th",{style:{width:"20%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"10%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),i.jsx("tbody",{children:W.map(Ce=>i.jsxs("tr",{children:[i.jsxs("td",{children:[i.jsx("div",{style:{fontWeight:500},children:Ce.name}),N==="need_order"&&Ce.vendor&&i.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:Ce.vendor})]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(Ce.quantity||0)<=0?"#ef4444":"inherit"},children:Number.isFinite(Ce.quantity)?Ce.quantity:"-"}),i.jsx("td",{children:Ce.unit||"-"}),i.jsx("td",{style:{textAlign:"center"},children:i.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[i.jsx(se,{variant:"secondary",size:"sm",onClick:()=>q(Ce),children:"/"}),i.jsx(se,{variant:"ghost",size:"sm",style:{color:"#d32f2f"},onClick:()=>Me(Ce),children:""})]})})]},`${Ce.vendor}@@${Ce.name}@@${Ce.unit||""}`))})]})})})()]}),i.jsx(yn,{isOpen:E,onClose:()=>O(!1),title:"",children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsx("div",{style:{fontWeight:"bold"},children:D?.name})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsxs("div",{children:[D?.quantity," ",D?.unit]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsx(zt,{type:"number",value:z,onChange:W=>C(W.target.value),placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px"},autoFocus:!0}),i.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:D?.unit})]}),i.jsxs("div",{className:"incoming-stock__calc-grid",children:[i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(.1),children:"+0.1"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(.5),children:"+0.5"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(1),children:"+1"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(5),children:"+5"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(10),children:"+10"}),i.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>C(""),children:""})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>O(!1),disabled:M,children:""}),i.jsx(se,{variant:"primary",onClick:P,disabled:M||!z,children:M?"":""})]})]})}),i.jsx(yn,{isOpen:L,onClose:()=>R(!1),title:"",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsxs("p",{style:{marginTop:0},children:["",I?.name,"",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.85rem",color:"#666"},children:""})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>R(!1),disabled:ue,children:""}),i.jsx(se,{variant:"danger",onClick:ve,disabled:ue,children:ue?"":""})]})]})}),i.jsx(yn,{isOpen:ae,onClose:()=>A(!1),title:"PDF",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsxs("p",{style:{marginTop:0},children:["",X?.baseName,""]}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["",i.jsx("strong",{children:""}),"",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>A(!1),disabled:Se,children:""}),i.jsx(se,{variant:"danger",onClick:Le,disabled:Se,children:Se?"":""})]})]})}),i.jsx(yn,{isOpen:B,onClose:()=>J(!1),title:"",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsx("p",{style:{marginTop:0,fontWeight:"bold",color:"#d32f2f"},children:""}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["PDF",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>J(!1),disabled:Z,children:""}),i.jsx(se,{variant:"danger",onClick:Ge,disabled:Z,children:Z?"":""})]})]})})]})},pb=n=>`planner_data_${n}`,ho=n=>{try{if(!n)return{};let t=localStorage.getItem(pb(n));return t?JSON.parse(t):{}}catch{return{}}},mu=(n,t)=>{n&&localStorage.setItem(pb(n),JSON.stringify(t))},Wa={getAll:async n=>ho(n),cleanupInvalidPlans:async(n,t)=>{const s=ho(n);let l=!1;const o=new Set(t);return Object.keys(s).forEach(u=>{const d=s[u].length;s[u]=s[u].filter(h=>o.has(h.recipeId)),s[u].length!==d&&(l=!0),s[u].length===0&&(delete s[u],l=!0)}),l&&mu(n,s),s},addMeal:async(n,t,s,l)=>{const o=ho(n);o[t]||(o[t]=[]);const u={id:Date.now().toString(),recipeId:s,type:l,note:""};return o[t].push(u),mu(n,o),u},removeMeal:async(n,t,s)=>{const l=ho(n);l[t]&&(l[t]=l[t].filter(o=>o.id!==s),l[t].length===0&&delete l[t],mu(n,l))},updateMeal:async(n,t,s,l)=>{const o=ho(n);if(o[t]){const u=o[t].findIndex(d=>d.id===s);u!==-1&&(o[t][u]={...o[t][u],...l},mu(n,o))}}},LT=({recipe:n})=>{const{attributes:t,listeners:s,setNodeRef:l,transform:o}=vp({id:`recipe-${n.id}`,data:{recipe:n}}),u=o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:l,style:u,...s,...t,className:"draggable-recipe",children:n.title})},IT=({meal:n,dateStr:t,children:s})=>{const{attributes:l,listeners:o,setNodeRef:u,transform:d}=vp({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),h=d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:u,style:h,...o,...l,className:"draggable-meal-wrapper",children:s})},BT=({dateStr:n,dayNum:t,isToday:s,isOutside:l,children:o})=>{const{setNodeRef:u,isOver:d}=Ho({id:`date-${n}`,data:{dateStr:n}});return i.jsxs("div",{ref:u,className:`calendar-cell ${s?"today":""} ${l?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[i.jsx("div",{className:"day-number",children:t}),o]})},$T=({onBack:n,onSelectRecipe:t})=>{const{user:s}=os(),l=ea(),[o,u]=b.useState([]),[d,h]=b.useState({}),[f,m]=b.useState(new Date),[y,v]=b.useState(""),[x,w]=b.useState(!1),[_,N]=b.useState(null),j=al(gr(qu,{activationConstraint:{distance:8}})),E=b.useCallback(async()=>{const K=await bn.fetchRecipes(s);if(u(K),s?.id){const G=K.map(V=>V.id),q=await Wa.cleanupInvalidPlans(s.id,G);h(q)}},[s]);b.useEffect(()=>{const K=setTimeout(()=>{E()},0);return()=>clearTimeout(K)},[E]);const O=async K=>{const{active:G,over:q}=K;if(q&&q.id.startsWith("date-")){const V=q.data.current.dateStr;if(G.id.startsWith("recipe-")){const P=G.data.current.recipe;await Wa.addMeal(s.id,V,P.id,"dinner"),E()}else if(G.id.startsWith("meal-")){const{meal:P,dateStr:L}=G.data.current;if(L===V)return;await Wa.addMeal(s.id,V,P.recipeId,P.type||"dinner"),await Wa.removeMeal(s.id,L,P.id),E()}}},D=async(K,G,q)=>{q&&q.stopPropagation(),N({dateStr:K,mealId:G}),w(!0)},$=async()=>{if(!_)return;const{dateStr:K,mealId:G}=_;w(!1),N(null);try{await Wa.removeMeal(s.id,K,G),await E(),l.success("")}catch(q){l.error(""),console.error("Delete meal error:",q)}},z=()=>{w(!1),N(null)},C=()=>{const K=f.getFullYear(),G=f.getMonth(),q=new Date(K,G,1),V=new Date(K,G+1,0),P=[],L=q.getDay();for(let I=L-1;I>=0;I--){const Y=new Date(K,G,-I);P.push({date:Y,isOutside:!0})}for(let I=1;I<=V.getDate();I++){const Y=new Date(K,G,I);P.push({date:Y,isOutside:!1})}const R=42-P.length;for(let I=1;I<=R;I++){const Y=new Date(K,G+1,I);P.push({date:Y,isOutside:!0})}return P},M=K=>`${K.getFullYear()}-${String(K.getMonth()+1).padStart(2,"0")}-${String(K.getDate()).padStart(2,"0")}`,T=o.filter(K=>K.title.toLowerCase().includes(y.toLowerCase())),F=K=>{m(new Date(f.getFullYear(),f.getMonth()+K,1))};return i.jsxs("div",{className:"planner-container fade-in",children:[x&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("strong",{children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(se,{variant:"ghost",onClick:z,children:""}),i.jsx(se,{variant:"danger",onClick:$,children:""})]})]})}),i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(se,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx(Xi,{onDragEnd:O,sensors:j,children:i.jsxs("div",{className:"planner-layout",children:[i.jsxs("div",{className:"recipe-sidebar",children:[i.jsx("div",{className:"sidebar-search",children:i.jsx(zt,{placeholder:"...",value:y,onChange:K=>v(K.target.value)})}),i.jsx("div",{className:"draggable-list",children:T.map(K=>i.jsx(LT,{recipe:K},K.id))})]}),i.jsxs("div",{className:"planner-calendar",children:[i.jsxs("div",{className:"calendar-header",children:[i.jsx(se,{variant:"ghost",onClick:()=>F(-1),children:" "}),i.jsxs("h3",{style:{margin:0},children:[f.getFullYear()," ",f.getMonth()+1,""]}),i.jsx(se,{variant:"ghost",onClick:()=>F(1),children:" "})]}),i.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(K=>i.jsx("div",{className:"calendar-day-header",children:K},K)),C().map((K,G)=>{const q=M(K.date),V=d[q]||[],P=q===M(new Date);return i.jsx(BT,{dateStr:q,dayNum:K.date.getDate(),isToday:P,isOutside:K.isOutside,children:V.map(L=>{const R=o.find(I=>I.id===L.recipeId);return i.jsx(IT,{meal:L,dateStr:q,children:i.jsxs("div",{className:"planned-meal",title:R?.title,onClick:()=>R&&t&&t(R),children:[i.jsx("span",{children:R?.title||"Unknown"}),i.jsx("span",{className:"delete-meal-btn",onPointerDown:I=>{I.stopPropagation()},onClick:I=>D(q,L.id,I),children:""})]})},L.id)})},G)})]})]})]})})]})},PT=({onBack:n})=>{const{user:t}=os(),s=ea(),[l,o]=b.useState(new Date().toISOString().slice(0,10)),[u,d]=b.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[h,f]=b.useState([]),[m,y]=b.useState(!1),[v,x]=b.useState(!1),[w,_]=b.useState(!1),[N,j]=b.useState(!1),E=async()=>{y(!0);try{if(!t?.id){s.error(""),y(!1);return}const C=await Wa.getAll(t.id),M=new Date(l),T=new Date(u);T.setHours(23,59,59,999);const F=[];if(Object.keys(C).forEach(ve=>{const ae=new Date(ve);ae>=M&&ae<=T&&C[ve].forEach(A=>{F.push(A.recipeId)})}),F.length===0){s.info(""),x(!1);return}const K=await bn.fetchRecipes(t),G=F.map(ve=>K.find(ae=>ae.id===ve)).filter(Boolean),q=ve=>(ve??"").toString().trim(),V=ve=>{const ae=q(ve);if(!ae)return"";const A=ae.toLowerCase();return A===""?"g":A===""?"ml":A===""?"cc":A===""?"kg":A===""?"l":A},P=ve=>{const ae=q(ve);return ae?["","","","","","","","PC","pc",""].includes(ae):!1},L=(ve,ae)=>{const A=parseFloat(ve)||0,X=V(ae);return X==="kg"?{qty:A*1e3,unit:"g"}:X==="g"?{qty:A,unit:"g"}:X==="l"?{qty:A*1e3,unit:"ml"}:X==="cc"?{qty:A,unit:"ml"}:X==="ml"?{qty:A,unit:"ml"}:{qty:A,unit:q(ae)||""}},R=(ve,ae,A,X)=>{const ce=q(A),Se=parseFloat(ae)||0;if(!X)return L(Se,ce);const Ae=parseFloat(X.packetSize),Be=V(X.packetUnit);if(!Number.isFinite(Ae)||Ae<=0||!Be)return L(Se,ce);if(["g","kg","ml","cc","l"].includes(Be)&&P(ce)){const Ge=Se*Ae;return L(Ge,Be)}return L(Se,ce)},[I,Y,ue,ye]=await Promise.all([Pn.getAllConversions(),nr.fetchPriceList(t.id),er.getAll(t.id),Mu.getAll(t.id)]),B=new Map;try{for(const[ve,ae]of(I||new Map).entries()){const A=nn(ve);A&&(B.has(A)||B.set(A,ae))}}catch{}const J=new Map;try{for(const[ve,ae]of(ye||new Map).entries()){const A=nn(ve);A&&(J.has(A)||J.set(A,ae))}}catch{}const Z=new Map;try{(ue||[]).forEach(ve=>{const ae=nn(ve?.name);ae&&(Z.has(ae)||Z.set(ae,ve))})}catch{}const ge={};G.forEach(ve=>{[...ve.ingredients||[],...ve.flours||[],...ve.breadIngredients||[]].forEach(X=>{if(!X.name)return;const ce=q(X.name),Se=nn(ce),Ae=(Se?B.get(Se):null)||I?.get(ce)||null,Be=R(ce,X.quantity,X.unit,Ae),Le=Be.qty||0,Ge=Be.unit||"";ge[ce]||(ge[ce]={quantity:0,unit:Ge,count:0}),ge[ce].quantity+=Le})});const Me=Object.keys(ge).map(ve=>{const ae=ge[ve],A=nn(ve),X=(A?B.get(A):null)||I?.get(ve)||null,ce=A&&Y?.get(A)||null,Se=A&&Z.get(A)||null,Ae=R(ve,Se?.quantity??0,Se?.unit??ae.unit,X),Be=ae.quantity||0,Le=Ae.qty||0,Ge=ae.unit||Ae.unit||"",W=Le-Be,Ce=parseFloat(X?.packetSize),$e=q(X?.packetUnit),rt=Number.isFinite(Ce)&&Ce>0&&!!$e,mt=rt?Ce*.2:0,ft=rt?W<mt:!1,Dt=ce?.unit?String(ce.unit).trim():"",Vt=A&&J.has(A)?String(J.get(A)).trim():"",St=Vt||""||Dt||""||"",oe=(X?.lastPrice!==null&&X?.lastPrice!==void 0&&X?.lastPrice!==""?parseFloat(X.lastPrice):null)??(ce?.price!==null&&ce?.price!==void 0?parseFloat(ce.price):null);let _e=null,Ne=0,Ie=Ge;if(rt){const ut=Math.max(0,mt-W);_e=Math.ceil(ut/Ce),ft&&_e<1&&(_e=1),Ne=_e,Ie=St}else Ne=Math.max(0,Be-Le),Ie=Ge;const it=rt?ft:Ne>.01;return{name:ve,required:Be,stock:Le,remaining:W,unit:Ge,shouldShow:it,toOrder:Ne,orderUnit:Ie,orderPacks:_e,packSize:rt?Ce:null,packUnit:rt?$e:null,packPrice:Number.isFinite(oe)?oe:null,vendor:ce?.vendor||Se?.vendor||""}}).filter(ve=>ve.shouldShow);f(Me),x(!0)}catch(C){console.error(C),s.error("")}finally{y(!1)}},O=()=>{_(!0)},D=()=>{j(!0)},$=()=>h.map(C=>{if(Number.isFinite(C.orderPacks)&&C.orderPacks!==null){const M=C.packSize&&C.packUnit?`1${C.orderUnit}=${C.packSize}${C.packUnit}`:"";return`${C.name}: ${C.orderPacks}${C.orderUnit}${M}`}return`${C.name}: ${Number(C.toOrder||0).toFixed(1)}${C.unit}`}).join(`
`),z=async()=>{const C=document.getElementById("copy-textarea");if(C){C.select();try{await navigator.clipboard.writeText(C.value),s.success("")}catch{document.execCommand("copy"),s.success("")}}};return i.jsxs("div",{className:"order-list-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(se,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx("div",{className:"filter-card",children:i.jsxs("div",{className:"date-range-inputs",children:[i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:l,onChange:C=>o(C.target.value)})]}),i.jsx("span",{children:""}),i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:u,onChange:C=>d(C.target.value)})]}),i.jsx(se,{variant:"primary",onClick:E,disabled:m,children:m?"...":""})]})}),v&&i.jsxs("div",{className:"order-results",children:[i.jsxs("div",{className:"results-header",children:[i.jsxs("h3",{children:[" (",h.length,")"]}),i.jsxs("div",{className:"result-actions",children:[i.jsx(se,{variant:"secondary",onClick:O,children:" "}),i.jsx(se,{variant:"secondary",onClick:D,children:" "})]})]}),i.jsxs("table",{className:"order-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:h.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):h.map((C,M)=>i.jsxs("tr",{children:[i.jsx("td",{children:C.name}),i.jsxs("td",{style:{textAlign:"right"},children:[C.required.toFixed(1)," ",C.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,C.remaining??0).toFixed(1)," ",C.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(C.orderPacks)&&C.orderPacks!==null?i.jsxs(i.Fragment,{children:[C.orderPacks,C.orderUnit,C.packSize&&C.packUnit&&i.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",C.orderUnit," = ",Number(C.packSize).toLocaleString(),C.packUnit,C.packPrice?` / ${Math.round(C.packPrice).toLocaleString()}`:""]})]}):i.jsxs(i.Fragment,{children:[C.toOrder.toFixed(1)," ",i.jsx("span",{style:{fontSize:"0.8em"},children:C.unit})]})})]},M))})]})]}),i.jsx(yn,{isOpen:w,onClose:()=>_(!1),title:" ",size:"medium",children:i.jsxs("div",{className:"copy-modal-content",children:[i.jsx("p",{className:"copy-instructions",children:""}),i.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:$(),onClick:C=>C.target.select()}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(se,{variant:"primary",onClick:z,children:" "}),i.jsx(se,{variant:"ghost",onClick:()=>_(!1),children:""})]})]})}),i.jsx(yn,{isOpen:N,onClose:()=>j(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-content",children:[i.jsxs("div",{className:"print-preview-header",children:[i.jsx("h3",{children:""}),i.jsxs("p",{className:"print-period",children:[": ",l,"  ",u]})]}),i.jsxs("table",{className:"print-preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:h.map((C,M)=>i.jsxs("tr",{children:[i.jsx("td",{children:C.name}),i.jsxs("td",{style:{textAlign:"right"},children:[C.required.toFixed(1)," ",C.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,C.remaining??0).toFixed(1)," ",C.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(C.orderPacks)&&C.orderPacks!==null?`${C.orderPacks}${C.orderUnit}`:`${C.toOrder.toFixed(1)} ${C.unit}`})]},M))})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(se,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(se,{variant:"ghost",onClick:()=>j(!1),children:""})]})]})})]})},fo=async(n,t,s)=>{let l=null;try{const o=new Promise((u,d)=>{l=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{l&&clearTimeout(l)}},Ux=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},qT=({children:n})=>{const[t,s]=b.useState(null),[l,o]=b.useState(!0),[u,d]=b.useState(!1),h=b.useCallback(async j=>{if(!j){s(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const E=j.id,O=j.email||"";try{const G=localStorage.getItem("auth_user_cache");if(G){const q=JSON.parse(G);q&&q.id===E&&s(q)}}catch(G){console.warn("[Auth] Failed to load cache",G)}let D=null,$=0;const z=3;for(;$<z;)try{const[G,q]=await Promise.all([fo(Re.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",E).single().then(L=>({data:L,error:null})).catch(L=>({data:null,error:L})),2500,"profiles.select(with_email)").catch(L=>({data:null,error:L})),fo(Re.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",E).single().then(L=>({data:L,error:null})).catch(L=>({data:null,error:L})),2500,"profiles.select").catch(L=>({data:null,error:L}))]);let V=null,P=null;if(G?.data?.data?(V=G.data.data,P=null):q?.data?.data?(V=q.data.data,P=null):P=G?.error??q?.error??new Error("Profile fetch failed"),P)if(P.code==="PGRST116"){const L=j.user_metadata&&j.user_metadata.display_id?String(j.user_metadata.display_id):Ux(O)||E.slice(0,8);let R=null,I=null;const Y=await fo(Re.from("profiles").insert([{id:E,display_id:L,email:O||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),8e3,"profiles.insert(with_email)");if(R=Y?.data??null,I=Y?.error??null,I&&String(I.message||"").toLowerCase().includes("email")){const ue=await fo(Re.from("profiles").insert([{id:E,display_id:L,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),8e3,"profiles.insert");R=ue?.data??null,I=ue?.error??null}if(I)throw I;D=R}else throw P;else D=V;if(D&&Object.prototype.hasOwnProperty.call(D,"email")&&O&&!D.email)try{await Re.from("profiles").update({email:O}).eq("id",E)}catch(L){console.warn("Failed to backfill profile email",L)}break}catch(G){console.error(`Failed to load/create profile (Attempt ${$+1}/${z}):`,G),$++,$<z&&await new Promise(q=>setTimeout(q,500*$))}const C=D?.display_id||Ux(O)||E.slice(0,8),M=D?.role||"user",T=String(M).trim().toLowerCase(),F=D?.show_master_recipes===!0,K={id:E,email:O,displayId:C,role:T,showMasterRecipes:F};s(K);try{localStorage.setItem("auth_user_cache",JSON.stringify(K))}catch(G){console.warn("[Auth] Failed to save cache",G)}},[]);b.useEffect(()=>{let j=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:E}=Re.auth.onAuthStateChange(async(D,$)=>{D==="PASSWORD_RECOVERY"&&d(!0);try{await h($?.user||null)}catch(z){console.error("Auth state change handler failed:",z)}});return j=E?.subscription,(async()=>{try{const{data:D}=await fo(Re.auth.getSession(),5e3,"auth.getSession");await h(D?.session?.user||null)}catch(D){console.error("Auth init failed:",D)}finally{o(!1)}})(),()=>{try{j?.unsubscribe?.()}catch{}}},[h]);const f=b.useCallback(async(j,E)=>{const{error:O}=await Re.auth.signInWithPassword({email:j,password:E});if(O)throw console.error("Login error:",O),new Error("")},[]),m=b.useCallback(async(j,E,O)=>{const{data:D,error:$}=await Re.auth.signUp({email:j,password:E,options:{data:{display_id:O}}});if($)throw console.error("SignUp error:",$),new Error($.message||"");const z=D?.user;if(z?.id){let C=null;C=(await Re.from("profiles").insert([{id:z.id,display_id:O,email:j||null,role:"user",show_master_recipes:!1}]))?.error??null,C&&String(C.message||"").toLowerCase().includes("email")&&(C=(await Re.from("profiles").insert([{id:z.id,display_id:O,role:"user",show_master_recipes:!1}]))?.error??null),C&&C.code!=="23505"&&console.error("Profile create error:",C)}return{needsEmailConfirmation:!D?.session}},[]),y=b.useCallback(async()=>{await Re.auth.signOut(),s(null),d(!1)},[]),v=b.useCallback(j=>{!j||typeof j!="object"||s(E=>E&&{...E,...j})},[]),x=b.useCallback(async j=>{const{error:E}=await Re.auth.resetPasswordForEmail(j,{redirectTo:window.location.origin});if(E)throw console.error("Password reset email error:",E),new Error("");return!0},[]),w=b.useCallback(async j=>{const{error:E}=await Re.auth.updateUser({password:j});if(E)throw console.error("Update password error:",E),new Error("");return!0},[]),_=b.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),N=b.useMemo(()=>({user:t,loading:l,login:f,register:m,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:w,finishPasswordRecovery:_}),[t,l,f,m,y,v,x,u,w,_]);return i.jsx(Z0.Provider,{value:N,children:n})},FT=({id:n,message:t,type:s="info",onClose:l})=>{b.useEffect(()=>{const u=setTimeout(()=>{l(n)},3e3);return()=>clearTimeout(u)},[n,l]);const o=()=>{switch(s){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return i.jsxs("div",{className:`toast toast-${s}`,children:[i.jsx("div",{className:"toast-icon",children:o()}),i.jsx("div",{className:"toast-message",children:t}),i.jsx("button",{className:"toast-close",onClick:()=>l(n),"aria-label":"",children:""})]})},HT=({toasts:n,onRemove:t})=>n.length===0?null:i.jsx("div",{className:"toast-container",children:n.map(s=>i.jsx(FT,{id:s.id,message:s.message,type:s.type,onClose:t},s.id))}),GT=({children:n})=>{const[t,s]=b.useState([]),l=b.useCallback((d,h="info")=>{const f=Date.now()+Math.random();s(m=>[...m,{id:f,message:d,type:h}].slice(-5))},[]),o=b.useCallback(d=>{s(h=>h.filter(f=>f.id!==d))},[]),u={showToast:l,success:d=>l(d,"success"),error:d=>l(d,"error"),warning:d=>l(d,"warning"),info:d=>l(d,"info")};return i.jsxs(eb.Provider,{value:u,children:[n,i.jsx(HT,{toasts:t,onRemove:o})]})},VT=()=>{const[n,t]=b.useState(!0),[s,l]=b.useState(!1),[o,u]=b.useState(""),[d,h]=b.useState(""),[f,m]=b.useState(""),[y,v]=b.useState(""),[x,w]=b.useState(""),[_,N]=b.useState(!1),[j,E]=b.useState(!1);we.useEffect(()=>{const T=localStorage.getItem("savedEmail"),F=localStorage.getItem("savedPassword");T&&(u(T),F&&h(F),E(!0))},[]);const{login:O,register:D,sendPasswordResetEmail:$}=os(),z=async T=>{T.preventDefault(),v(""),w(""),N(!0);try{await O(o.trim(),d),j?(localStorage.setItem("savedEmail",o.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(F){v(F.message||"")}finally{N(!1)}},C=async T=>{T.preventDefault(),v(""),w(""),N(!0);try{if(!f.trim()){v("ID: yoshito");return}(await D(o.trim(),d,f.trim()))?.needsEmailConfirmation?w(""):w(""),t(!0),h("")}catch(F){v(F.message||"")}finally{N(!1)}},M=async T=>{T.preventDefault(),v(""),w(""),N(!0);try{await $(o.trim()),w(""),l(!1)}catch(F){v(F.message||"")}finally{N(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(tn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[i.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",i.jsx("br",{}),"Management"]}),i.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:s?"":n?"":""})]}),y&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),i.jsxs("form",{onSubmit:s?M:n?z:C,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"email",value:o,onChange:T=>u(T.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:d,onChange:T=>h(T.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&!n&&i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",i.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),i.jsx("input",{type:"text",value:f,onChange:T=>m(T.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!s&&i.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[i.jsx("input",{type:"checkbox",id:"rememberMe",checked:j,onChange:T=>E(T.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),i.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),i.jsx(se,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:_,children:s?"":n?"":""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s?i.jsx("button",{type:"button",onClick:()=>{l(!1),v(""),w("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):i.jsx("button",{type:"button",onClick:()=>{l(!0),v(""),w("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!s&&i.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),w("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},KT=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:s}=os(),[l,o]=we.useState(""),[u,d]=we.useState(""),[h,f]=we.useState(""),[m,y]=we.useState(""),[v,x]=we.useState(!1),w=async _=>{if(_.preventDefault(),f(""),y(""),!l||l.length<8){f("8");return}if(l!==u){f("");return}x(!0);try{await n(l),y(""),t()}catch(N){console.error(N),f(N.message||"")}finally{x(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(tn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),i.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),h&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:h}),m&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),i.jsxs("form",{onSubmit:w,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:l,onChange:_=>o(_.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:u,onChange:_=>d(_.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsx(se,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),i.jsx(se,{variant:"ghost",onClick:s,style:{flex:1},children:""})]})]})})},Lf=({label:n,subLabel:t,variant:s="screen",showLogo:l=!0})=>i.jsxs("div",{className:s==="screen"?"loading-screen":"loading-inline",children:[l&&i.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),i.jsxs("div",{className:"loading-text",children:[n,i.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[i.jsx("span",{children:"."}),i.jsx("span",{children:"."}),i.jsx("span",{children:"."})]})]}),i.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&i.jsx("div",{className:"loading-subtext",children:t})]});function YT(){const{user:n,logout:t,loading:s,isPasswordRecovery:l}=os(),o=ea(),[u,d]=Lo(),[h,f]=b.useState([]),[m,y]=b.useState(!0),[v,x]=b.useState(0),[w,_]=b.useState([]),[N,j]=b.useState(!1),[E,O]=b.useState({}),[D,$]=b.useState({}),[z,C]=b.useState(!1),M=u.get("view"),T=(M==="create-mock"?"create":M)||"list",F=u.get("id"),K=h.find(H=>String(H.id)===F)||null,[G,q]=b.useState(null),[V,P]=b.useState(!1),[L,R]=b.useState(""),[I,Y]=b.useState(null),[ue,ye]=b.useState(null),[B,J]=b.useState(""),[Z,ge]=b.useState("none"),[Me,ve]=b.useState(!1),[ae,A]=b.useState(!1),[X,ce]=b.useState(new Set),[Se,Ae]=b.useState("normal"),[Be,Le]=b.useState(!1),[Ge,W]=b.useState(!1),[Ce,$e]=b.useState(null),[rt,mt]=b.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),ft={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};b.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const H=window.matchMedia("(max-width: 700px)"),Ue=()=>mt(!!H.matches);return Ue(),H.addEventListener?H.addEventListener("change",Ue):H.addListener(Ue),()=>{H.removeEventListener?H.removeEventListener("change",Ue):H.removeListener(Ue)}},[]),b.useEffect(()=>{if(!rt||!ft[T]||typeof window>"u")return;const H=`pc-recommend-shown:${T}`;try{if(window.sessionStorage.getItem(H)==="1")return;window.sessionStorage.setItem(H,"1")}catch{}$e(T)},[T,rt]),b.useEffect(()=>{T!=="list"&&ge("none")},[T]),b.useEffect(()=>{if(!s){j(!1);return}const H=setTimeout(()=>j(!0),3500);return()=>clearTimeout(H)},[s]),b.useEffect(()=>{if(h.length>0||T==="trash")return;let H=n?.id;if(!H)try{H=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!H)return;const Ue=bn.getCachedRecipes(H);Ue&&Ue.length>0&&(f(Ue),C(!0),y(!1))},[n?.id]),b.useEffect(()=>{s||n&&(async()=>{try{const H=T==="trash"?xt():Ie();await Promise.all([H,Ne(),oe()])}catch(H){console.error("Error during initial data load:",H)}})()},[s,n?.id]),b.useEffect(()=>{if(s)return;if(!n||n.role!=="admin"){O({}),$({});return}let H=!1;return(async()=>{try{const Ue=await Qi.fetchAllProfiles();if(H)return;const Ve={},_t={};for(const ze of Ue||[])ze?.id&&(Ve[String(ze.id)]=ze),ze?.display_id&&(_t[String(ze.display_id)]=ze);O(Ve),$(_t)}catch(Ue){console.warn("Failed to load profiles for admin owner labels",Ue)}})(),()=>{H=!0}},[s,n?.id,n?.role]);const Dt=H=>{const Ve=(H?.tags||[]).find(ht=>ht&&ht.startsWith("owner:"));if(!Ve)return"/";const _t=String(Ve.slice(6)),ze=E[_t]||D[_t]||null;return ze?ze.display_id||ze.email||_t:_t.length>12?`${_t.slice(0,8)}`:_t},Vt=al(gr(Po,{activationConstraint:{distance:10}}),gr(qo,{activationConstraint:{delay:1e3,tolerance:5}}),gr(ol,{coordinateGetter:Gu})),St=H=>{const{active:Ue,over:Ve}=H;Ue.id!==Ve.id&&f(_t=>{const ze=_t.findIndex(Et=>Et.id===Ue.id),ht=_t.findIndex(Et=>Et.id===Ve.id);if(ze===-1||ht===-1)return _t;const Ft=Zi(_t,ze,ht),Nn=Ft.map((Et,Vn)=>({id:Et.id,order_index:Vn}));return bn.updateOrder(Nn).catch(Et=>console.error("Order update failed",Et)),Ft})},oe=async()=>{try{const H=await bn.fetchRecentRecipes();_(H||[])}catch(H){console.error("Failed to load history:",H)}},_e=async H=>{const Ue=[H,...w.filter(Ve=>Ve!==H)].slice(0,20);_(Ue);try{await bn.addToHistory(H)}catch(Ve){console.error("Failed to sync history",Ve)}},Ne=async()=>{try{const H=await bn.getDeletedCount();x(H||0)}catch(H){console.error("Failed to load trash count:",H)}},Ie=async()=>{try{z||y(!0);const H=await bn.fetchRecipes(n,{timeoutMs:15e3,includeIngredients:!1,includeSources:!1});f(H||[])}catch(H){console.error("Failed to fetch recipes:",H),o.error(`

(${H?.message||"unknown error"})`)}finally{y(!1),C(!1)}},it=H=>(H||"").toString().replace(/\s+/g," ").trim(),ut=H=>it(H).toLowerCase(),kt="__NO_STORE__",Jt="__OTHER_STORE__",Sn=[...new Set(h.map(H=>it(H.course)).filter(Boolean))],jt=[...new Set(h.map(H=>it(H.category)).filter(Boolean))],rn=h.reduce((H,Ue)=>{const Ve=ut(Ue.storeName);return Ve&&(H[Ve]=(H[Ve]||0)+1),H},{}),cn=new Set(bu.map(H=>ut(H)).filter(Boolean)),xn=h.reduce((H,Ue)=>ut(Ue.storeName)?H:H+1,0),Ln=h.reduce((H,Ue)=>{const Ve=ut(Ue.storeName);return Ve?cn.has(Ve)?H:H+1:H},0),ar=h.reduce((H,Ue)=>{const Ve=ut(Ue.course);return Ve&&(H[Ve]=(H[Ve]||0)+1),H},{}),me=h.reduce((H,Ue)=>{const Ve=ut(Ue.category);return Ve&&(H[Ve]=(H[Ve]||0)+1),H},{}),Ke=h.filter(H=>{const Ue=ut(L),Ve=L===""||L==="recent"&&w.includes(H.id)||H.tags&&H.tags.includes(L)||L===kt&&!ut(H.storeName)||L===Jt&&ut(H.storeName)&&!cn.has(ut(H.storeName))||H.category&&ut(H.category)===Ue||H.course&&ut(H.course)===Ue||H.storeName&&ut(H.storeName)===Ue,_t=B.toLowerCase().trim(),ze=!_t||H.title.toLowerCase().includes(_t)||H.description&&H.description.toLowerCase().includes(_t)||H.ingredients&&H.ingredients.some(ht=>ht.name.toLowerCase().includes(_t));return Ve&&ze}),Ze=L===""&&!B.trim()&&T==="list",Ye=(H,Ue={})=>{d({view:"detail",id:H.id,...Ue})},tt=async(H,Ue=!1)=>{try{if(H.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&H.tags.some(_t=>_t==="owner:yoshito")){o.warning("");return}Ue?(await bn.restoreRecipe(H.id),(T==="trash"||T==="detail")&&(d({view:"trash"}),xt()),o.success("")):(await bn.deleteRecipe(H.id),f(h.filter(Ve=>Ve.id!==H.id)),d({view:"list"}),Ne())}catch(Ve){console.error("Failed to delete/restore recipe:",Ve),o.error("")}finally{Ne()}},Mt=async H=>{try{await bn.hardDeleteRecipe(H.id),f(h.filter(Ue=>Ue.id!==H.id)),d({view:"trash"}),o.success(""),xt(),Ne()}catch(Ue){console.error("Failed to hard delete recipe:",Ue),o.error("")}},xt=async()=>{try{y(!0);const H=await bn.fetchDeletedRecipes();f(H||[]),R("")}catch(H){console.error("Failed to fetch deleted recipes:",H)}finally{y(!1)}},Rt=()=>{d({view:"trash"}),xt()},et=()=>{d({view:"list"}),Ie()},Bt=async(H,Ue)=>{try{let Ve,_t=Ue;if(Ue&&n.role!=="admin"){const ze=H.tags?.find(Ft=>Ft.startsWith("owner:"));ze===`owner:${n.id}`||n.displayId&&ze===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${ze||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),_t=!1)}_t?(Ve=await bn.updateRecipe(H,n),f(h.map(ze=>ze.id===Ve.id?Ve:ze))):(Ve=await bn.createRecipe(H,n),f([Ve,...h])),d(_t?{view:"detail",id:Ve.id}:{view:"detail",id:Ve.id})}catch(Ve){console.error("Failed to save recipe:",Ve),o.error(`
: ${Ve.message||Ve.error_description||JSON.stringify(Ve)}`)}};b.useEffect(()=>{let H=!1;return(async()=>{if(T!=="edit"||!F){q(null),P(!1);return}P(!0);try{const Ve=await bn.getRecipe(F);if(H)return;q(Ve)}catch(Ve){if(console.error("Failed to load edit recipe details",Ve),H)return;q(K),o.warning("")}finally{H||P(!1)}})(),()=>{H=!0}},[T,F]);const We=(H,Ue="")=>{const _t=["","baker","","","","dough","fermentation"].some(sn=>(H.title||"").toLowerCase().includes(sn)),ze=["flour","","","","","","","","",""],ht=["yeast","","",""],Ft=H.ingredients||[],Nn=Ft.some(sn=>ht.some(Nt=>(sn.name||"").toLowerCase().includes(Nt))),Et=Ft.some(sn=>ze.some(Nt=>(sn.name||"").toLowerCase().includes(Nt))&&!sn.name.includes(""));if(Ft.some(sn=>sn.quantity&&String(sn.quantity).includes("%")||sn.unit&&String(sn.unit).includes("%"))||Nn||_t&&Et){H.type="bread",H.flours=[],H.breadIngredients=[];const sn=["flour","","","","","","","",""];if(Ft.forEach(Nt=>{sn.some(Kn=>(Nt.name||"").includes(Kn))?H.flours.push(Nt):H.breadIngredients.push(Nt)}),H.flours.length===0&&Ft.length>0){const Nt=Ft[0];(Nt.name||"").includes("")&&(H.flours.push(Nt),H.breadIngredients=H.breadIngredients.filter(Pr=>Pr!==Nt))}}H.sourceUrl=Ue,Ue&&(H.category="URL"),ye(H),d({view:"create"})},Ut=()=>{A(!ae),ce(new Set)},Xt=H=>{const Ue=new Set(X);Ue.has(H)?Ue.delete(H):Ue.add(H),ce(Ue)},Qt=()=>{Le(!0)},re=()=>{Le(!1)},ne=async()=>{Le(!1);try{y(!0),T==="trash"?(await Promise.all(Array.from(X).map(H=>bn.hardDeleteRecipe(H))),xt()):(await Promise.all(Array.from(X).map(H=>bn.deleteRecipe(H))),f(h.filter(H=>!X.has(H.id))),Ne()),ce(new Set),A(!1),o.success("")}catch(H){console.error("Bulk delete failed",H),o.warning(""),T==="trash"?xt():Ie()}finally{y(!1)}},fe=()=>{X.size!==0&&W(!0)},Te=()=>{W(!1)},Pe=async()=>{W(!1);try{y(!0);for(const H of X)await bn.restoreRecipe(H);f(h.filter(H=>!X.has(H.id))),Ne(),A(!1),ce(new Set),o.success(""),xt()}catch(H){console.error("Bulk restore failed",H),o.warning(""),xt()}finally{y(!1)}},Xe=()=>{const H=Ke.map(Ue=>Ue.id);ce(new Set(H))},Qe=H=>{f([H,...h]),d({view:"edit",id:H.id})};if(b.useEffect(()=>{s||n&&(T==="trash"?xt():T==="list"&&Ie())},[T,s,n?.id]),s&&!N){let H=!1;try{const Ue=JSON.parse(localStorage.getItem("auth_user_cache")||"null");Ue?.id&&(H=!!bn.getCachedRecipes(Ue.id))}catch{}if(!H)return i.jsx(Lf,{label:"",subLabel:""})}return n?l?i.jsx(KT,{}):i.jsxs(Hj,{children:[Be&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",X.size,"",T==="trash"?"":""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:T==="trash"?"":""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(se,{variant:"ghost",onClick:re,children:""}),i.jsx(se,{variant:"danger",onClick:ne,children:T==="trash"?"":""})]})]})}),Ge&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",X.size,""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(se,{variant:"ghost",onClick:Te,children:""}),i.jsx(se,{variant:"secondary",onClick:Pe,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),i.jsx(yn,{isOpen:!!Ce,onClose:()=>$e(null),title:"PC",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[i.jsx("p",{style:{marginTop:0},children:ft[Ce]?i.jsxs(i.Fragment,{children:["",i.jsx("strong",{children:ft[Ce]}),"/"]}):i.jsx(i.Fragment,{children:"/"})}),i.jsxs("p",{style:{marginBottom:0},children:["",i.jsx("strong",{children:"PC"}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[i.jsx(se,{variant:"ghost",onClick:()=>{$e(null),d({view:"list"})},children:""}),i.jsx(se,{variant:"primary",onClick:()=>$e(null),children:"OK"})]})]})}),(T==="list"||T==="trash")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"container-header",children:[i.jsxs("h2",{className:"section-title",children:[T==="trash"?" ()":"",T==="list"&&i.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",h.length,")"]})]}),i.jsx("div",{className:"header-actions",children:T==="list"||T==="trash"?i.jsxs(i.Fragment,{children:[ae?i.jsxs(i.Fragment,{children:[i.jsx(se,{variant:"ghost",onClick:Ut,children:""}),i.jsx(se,{variant:"secondary",onClick:Xe,children:""}),T==="trash"&&i.jsxs(se,{variant:"secondary",onClick:fe,disabled:X.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",X.size,")"]}),i.jsxs(se,{variant:"danger",onClick:Qt,disabled:X.size===0,children:[T==="trash"?"":""," (",X.size,")"]})]}):i.jsx(i.Fragment,{children:T==="list"?i.jsx(i.Fragment,{children:i.jsx(se,{onClick:()=>{ye(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):i.jsx(se,{variant:"ghost",onClick:et,children:" "})}),i.jsx("button",{className:"mobile-menu-toggle",onClick:()=>ve(!Me),"aria-label":"",children:""}),i.jsxs("div",{className:`secondary-actions ${Me?"open":""}`,children:[i.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>ve(!1),"aria-label":"",children:""}),i.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[i.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&i.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&i.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),i.jsxs(se,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),i.jsxs(se,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),T==="list"&&i.jsxs(i.Fragment,{children:[i.jsxs(se,{variant:"secondary",onClick:()=>{Y("url"),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),i.jsxs(se,{variant:"secondary",onClick:()=>{Y("image"),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsx("div",{className:"pc-recommend-note",children:i.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),i.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"inventory"}),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"incoming-deliveries"}),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),i.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"incoming-stock"}),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"planner"}),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"data"}),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&i.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"users"}),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(se,{variant:"secondary",onClick:()=>{d({view:"order-list"}),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"})]}),!ae&&i.jsxs(se,{variant:"ghost",onClick:()=>{Ut(),ve(!1)},className:"danger-text",children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," ",T==="trash"?"":""]}),T==="list"&&i.jsxs(se,{variant:"ghost",onClick:()=>{Rt(),ve(!1)},style:{position:"relative"},children:[i.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&i.jsx("span",{className:"trash-badge",children:v})]}),i.jsxs(se,{variant:"ghost",onClick:()=>{et(),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(se,{variant:"ghost",onClick:()=>{t(),ve(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]}),i.jsx("div",{className:`menu-backdrop ${Me?"open":""}`,onClick:()=>ve(!1),"aria-hidden":"true"})]}):null})]}),T==="list"&&i.jsxs("div",{className:"list-toolbar",children:[i.jsxs("div",{className:"search-container search-container--compact",children:[i.jsx("span",{className:"search-icon",children:""}),i.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:B,onChange:H=>J(H.target.value)})]}),i.jsxs("div",{className:"public-recipe-toggles",children:[i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${Z==="mine"?"active":""}`,"aria-pressed":Z==="mine",onClick:()=>ge("mine"),children:" "}),i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${Z==="others"?"active":""}`,"aria-pressed":Z==="others",onClick:()=>ge("others"),children:" "}),Z!=="none"&&i.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>ge("none"),children:" "})]})]}),i.jsxs("div",{className:"tag-filter-container",children:[i.jsxs("select",{className:"store-filter-select",value:L===kt?kt:L===Jt?Jt:bu.includes(L)?L:"",onChange:H=>R(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),bu.map(H=>i.jsxs("option",{value:H,children:[H," (",rn[ut(H)]||0,")"]},H)),i.jsxs("option",{value:kt,children:[" (",xn,")"]}),i.jsxs("option",{value:Jt,children:[" (",Ln,")"]})]}),i.jsxs("select",{className:"store-filter-select",value:Sn.includes(L)?L:"",onChange:H=>R(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),Sn.sort().map(H=>i.jsxs("option",{value:H,children:[H," (",ar[ut(H)]||0,")"]},H))]}),i.jsxs("select",{className:"store-filter-select",value:jt.includes(L)?L:"",onChange:H=>R(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),jt.sort().map(H=>i.jsxs("option",{value:H,children:[H," (",me[ut(H)]||0,")"]},H))]}),i.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[i.jsx("button",{className:`tag-filter-btn ${Se==="normal"?"active":""}`,onClick:()=>Ae("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),i.jsx("button",{className:`tag-filter-btn ${Se==="all"?"active":""}`,onClick:()=>Ae("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),m?i.jsx(Lf,{label:z?"":"",subLabel:z?void 0:"",variant:"inline",showLogo:!1}):h.length===0?i.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[T==="trash"?"":"",L!==""&&i.jsx("p",{children:""})]}):i.jsxs("div",{className:"main-content-wrapper",children:[T==="list"&&i.jsx("div",{className:"recent-list-wrapper",children:i.jsx(oT,{recipes:h,recentIds:w,onSelect:Ye})}),i.jsx("div",{className:"recipe-list-container",children:T==="list"?i.jsx(Xi,{sensors:Vt,collisionDetection:Pf,onDragEnd:St,children:i.jsx(zv,{recipes:Ke,onSelectRecipe:Ye,isSelectMode:ae,selectedIds:X,onToggleSelection:Xt,disableDrag:!Ze,displayMode:Se,publicRecipeView:Z,showOwner:n?.role==="admin",ownerLabelFn:Dt,currentUser:n})}):i.jsx(zv,{recipes:Ke,onSelectRecipe:Ye,isSelectMode:ae,selectedIds:X,onToggleSelection:Xt,disableDrag:!0,displayMode:Se,publicRecipeView:Z,showOwner:n?.role==="admin",ownerLabelFn:Dt,currentUser:n})})]})]}),T==="detail"&&K&&i.jsx(UE,{recipe:K,ownerLabel:n?.role==="admin"?Dt(K):void 0,isDeleted:!!K.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):K.deletedAt?Rt():et()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?et:void 0,onEdit:()=>d({view:"edit",id:K.id,from:u.get("from")}),onDelete:tt,onView:_e,onHardDelete:Mt,onDuplicate:Qe}),T==="edit"&&F&&(V?i.jsx(Lf,{label:"",subLabel:"URL"}):G&&i.jsx(Tx,{initialData:G,onCancel:()=>d({view:"detail",id:F}),onSave:H=>Bt(H,!0)},`edit-${F}`)),T==="create"&&i.jsx(Tx,{initialData:ue,onCancel:()=>{d({view:"list"}),ye(null)},onSave:H=>Bt(H,!1)},ue?"create-form-imported":"create-form"),I&&i.jsx(hb,{initialMode:I,onClose:()=>Y(null),onImport:We}),(T==="data"||T==="data-management")&&i.jsx(lT,{onBack:()=>d({view:"list"})}),T==="levain-guide"&&i.jsx(cT,{onBack:()=>d({view:"list"})}),T==="users"&&n?.role==="admin"&&i.jsx(uT,{onBack:()=>d({view:"list"})}),T==="inventory"&&i.jsx(mT,{onBack:()=>d({view:"list"})}),T==="incoming-deliveries"&&i.jsx(TT,{onBack:()=>d({view:"list"})}),T==="incoming-stock"&&i.jsx(UT,{onBack:()=>d({view:"list"})}),T==="planner"&&i.jsx($T,{onBack:()=>d({view:"list"}),onSelectRecipe:H=>Ye(H,{from:"planner"})}),T==="order-list"&&i.jsx(PT,{onBack:()=>d({view:"list"})})]}):i.jsx(VT,{})}function QT(){return i.jsx(GT,{children:i.jsx(qT,{children:i.jsx(YT,{})})})}class WT extends we.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,s){console.error("Uncaught error:",t,s),this.setState({error:t,errorInfo:s})}render(){return this.state.hasError?i.jsxs("div",{style:{padding:"2rem",color:"red"},children:[i.jsx("h1",{children:""}),i.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),i.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),i.jsx("br",{}),i.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}fS.createRoot(document.getElementById("root")).render(i.jsx(b.StrictMode,{children:i.jsx(WT,{children:i.jsx(Mj,{children:i.jsx(QT,{})})})}));export{Lx as a,JT as c,XT as g};
