(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(o){if(o.ep)return;o.ep=!0;const u=s(o);fetch(o.href,u)}})();var eR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ux(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function tR(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var s=function l(){var o=!1;try{o=this instanceof l}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(n).forEach(function(l){var o=Object.getOwnPropertyDescriptor(n,l);Object.defineProperty(s,l,o.get?o:{enumerable:!0,get:function(){return n[l]}})}),s}var Kh={exports:{}},to={};var Xy;function iS(){if(Xy)return to;Xy=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(l,o,u){var d=null;if(u!==void 0&&(d=""+u),o.key!==void 0&&(d=""+o.key),"key"in o){u={};for(var h in o)h!=="key"&&(u[h]=o[h])}else u=o;return o=u.ref,{$$typeof:n,type:l,key:d,ref:o!==void 0?o:null,props:u}}return to.Fragment=t,to.jsx=s,to.jsxs=s,to}var Zy;function aS(){return Zy||(Zy=1,Kh.exports=iS()),Kh.exports}var i=aS(),Yh={exports:{}},Tt={};var ev;function lS(){if(ev)return Tt;ev=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),p=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function S(B){return B===null||typeof B!="object"?null:(B=x&&B[x]||B["@@iterator"],typeof B=="function"?B:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,j={};function T(B,W,Z){this.props=B,this.context=W,this.refs=j,this.updater=Z||_}T.prototype.isReactComponent={},T.prototype.setState=function(B,W){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,W,"setState")},T.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function D(){}D.prototype=T.prototype;function M(B,W,Z){this.props=B,this.context=W,this.refs=j,this.updater=Z||_}var $=M.prototype=new D;$.constructor=M,N($,T.prototype),$.isPureReactComponent=!0;var U=Array.isArray;function C(){}var z={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function F(B,W,Z){var ye=Z.ref;return{$$typeof:n,type:B,key:W,ref:ye!==void 0?ye:null,props:Z}}function K(B,W){return F(B.type,W,B.props)}function G(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function q(B){var W={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(Z){return W[Z]})}var V=/\/+/g;function P(B,W){return typeof B=="object"&&B!==null&&B.key!=null?q(""+B.key):W.toString(36)}function k(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(C,C):(B.status="pending",B.then(function(W){B.status==="pending"&&(B.status="fulfilled",B.value=W)},function(W){B.status==="pending"&&(B.status="rejected",B.reason=W)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function E(B,W,Z,ye,Me){var xe=typeof B;(xe==="undefined"||xe==="boolean")&&(B=null);var ae=!1;if(B===null)ae=!0;else switch(xe){case"bigint":case"string":case"number":ae=!0;break;case"object":switch(B.$$typeof){case n:case t:ae=!0;break;case y:return ae=B._init,E(ae(B._payload),W,Z,ye,Me)}}if(ae)return Me=Me(B),ae=ye===""?"."+P(B,0):ye,U(Me)?(Z="",ae!=null&&(Z=ae.replace(V,"$&/")+"/"),E(Me,W,Z,"",function(ce){return ce})):Me!=null&&(G(Me)&&(Me=K(Me,Z+(Me.key==null||B&&B.key===Me.key?"":(""+Me.key).replace(V,"$&/")+"/")+ae)),W.push(Me)),1;ae=0;var O=ye===""?".":ye+":";if(U(B))for(var J=0;J<B.length;J++)ye=B[J],xe=O+P(ye,J),ae+=E(ye,W,Z,xe,Me);else if(J=S(B),typeof J=="function")for(B=J.call(B),J=0;!(ye=B.next()).done;)ye=ye.value,xe=O+P(ye,J++),ae+=E(ye,W,Z,xe,Me);else if(xe==="object"){if(typeof B.then=="function")return E(k(B),W,Z,ye,Me);throw W=String(B),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return ae}function L(B,W,Z){if(B==null)return B;var ye=[],Me=0;return E(B,ye,"","",function(xe){return W.call(Z,xe,Me++)}),ye}function Y(B){if(B._status===-1){var W=B._result;W=W(),W.then(function(Z){(B._status===0||B._status===-1)&&(B._status=1,B._result=Z)},function(Z){(B._status===0||B._status===-1)&&(B._status=2,B._result=Z)}),B._status===-1&&(B._status=0,B._result=W)}if(B._status===1)return B._result.default;throw B._result}var oe=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},ge={map:L,forEach:function(B,W,Z){L(B,function(){W.apply(this,arguments)},Z)},count:function(B){var W=0;return L(B,function(){W++}),W},toArray:function(B){return L(B,function(W){return W})||[]},only:function(B){if(!G(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return Tt.Activity=v,Tt.Children=ge,Tt.Component=T,Tt.Fragment=s,Tt.Profiler=o,Tt.PureComponent=M,Tt.StrictMode=l,Tt.Suspense=p,Tt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=z,Tt.__COMPILER_RUNTIME={__proto__:null,c:function(B){return z.H.useMemoCache(B)}},Tt.cache=function(B){return function(){return B.apply(null,arguments)}},Tt.cacheSignal=function(){return null},Tt.cloneElement=function(B,W,Z){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var ye=N({},B.props),Me=B.key;if(W!=null)for(xe in W.key!==void 0&&(Me=""+W.key),W)!R.call(W,xe)||xe==="key"||xe==="__self"||xe==="__source"||xe==="ref"&&W.ref===void 0||(ye[xe]=W[xe]);var xe=arguments.length-2;if(xe===1)ye.children=Z;else if(1<xe){for(var ae=Array(xe),O=0;O<xe;O++)ae[O]=arguments[O+2];ye.children=ae}return F(B.type,Me,ye)},Tt.createContext=function(B){return B={$$typeof:d,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:u,_context:B},B},Tt.createElement=function(B,W,Z){var ye,Me={},xe=null;if(W!=null)for(ye in W.key!==void 0&&(xe=""+W.key),W)R.call(W,ye)&&ye!=="key"&&ye!=="__self"&&ye!=="__source"&&(Me[ye]=W[ye]);var ae=arguments.length-2;if(ae===1)Me.children=Z;else if(1<ae){for(var O=Array(ae),J=0;J<ae;J++)O[J]=arguments[J+2];Me.children=O}if(B&&B.defaultProps)for(ye in ae=B.defaultProps,ae)Me[ye]===void 0&&(Me[ye]=ae[ye]);return F(B,xe,Me)},Tt.createRef=function(){return{current:null}},Tt.forwardRef=function(B){return{$$typeof:h,render:B}},Tt.isValidElement=G,Tt.lazy=function(B){return{$$typeof:y,_payload:{_status:-1,_result:B},_init:Y}},Tt.memo=function(B,W){return{$$typeof:m,type:B,compare:W===void 0?null:W}},Tt.startTransition=function(B){var W=z.T,Z={};z.T=Z;try{var ye=B(),Me=z.S;Me!==null&&Me(Z,ye),typeof ye=="object"&&ye!==null&&typeof ye.then=="function"&&ye.then(C,oe)}catch(xe){oe(xe)}finally{W!==null&&Z.types!==null&&(W.types=Z.types),z.T=W}},Tt.unstable_useCacheRefresh=function(){return z.H.useCacheRefresh()},Tt.use=function(B){return z.H.use(B)},Tt.useActionState=function(B,W,Z){return z.H.useActionState(B,W,Z)},Tt.useCallback=function(B,W){return z.H.useCallback(B,W)},Tt.useContext=function(B){return z.H.useContext(B)},Tt.useDebugValue=function(){},Tt.useDeferredValue=function(B,W){return z.H.useDeferredValue(B,W)},Tt.useEffect=function(B,W){return z.H.useEffect(B,W)},Tt.useEffectEvent=function(B){return z.H.useEffectEvent(B)},Tt.useId=function(){return z.H.useId()},Tt.useImperativeHandle=function(B,W,Z){return z.H.useImperativeHandle(B,W,Z)},Tt.useInsertionEffect=function(B,W){return z.H.useInsertionEffect(B,W)},Tt.useLayoutEffect=function(B,W){return z.H.useLayoutEffect(B,W)},Tt.useMemo=function(B,W){return z.H.useMemo(B,W)},Tt.useOptimistic=function(B,W){return z.H.useOptimistic(B,W)},Tt.useReducer=function(B,W,Z){return z.H.useReducer(B,W,Z)},Tt.useRef=function(B){return z.H.useRef(B)},Tt.useState=function(B){return z.H.useState(B)},Tt.useSyncExternalStore=function(B,W,Z){return z.H.useSyncExternalStore(B,W,Z)},Tt.useTransition=function(){return z.H.useTransition()},Tt.version="19.2.3",Tt}var tv;function Do(){return tv||(tv=1,Yh.exports=lS()),Yh.exports}var b=Do();const _e=Ux(b);var Qh={exports:{}},no={},Wh={exports:{}},Jh={};var nv;function oS(){return nv||(nv=1,(function(n){function t(E,L){var Y=E.length;E.push(L);e:for(;0<Y;){var oe=Y-1>>>1,ge=E[oe];if(0<o(ge,L))E[oe]=L,E[Y]=ge,Y=oe;else break e}}function s(E){return E.length===0?null:E[0]}function l(E){if(E.length===0)return null;var L=E[0],Y=E.pop();if(Y!==L){E[0]=Y;e:for(var oe=0,ge=E.length,B=ge>>>1;oe<B;){var W=2*(oe+1)-1,Z=E[W],ye=W+1,Me=E[ye];if(0>o(Z,Y))ye<ge&&0>o(Me,Z)?(E[oe]=Me,E[ye]=Y,oe=ye):(E[oe]=Z,E[W]=Y,oe=W);else if(ye<ge&&0>o(Me,Y))E[oe]=Me,E[ye]=Y,oe=ye;else break e}}return L}function o(E,L){var Y=E.sortIndex-L.sortIndex;return Y!==0?Y:E.id-L.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,h=d.now();n.unstable_now=function(){return d.now()-h}}var p=[],m=[],y=1,v=null,x=3,S=!1,_=!1,N=!1,j=!1,T=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function $(E){for(var L=s(m);L!==null;){if(L.callback===null)l(m);else if(L.startTime<=E)l(m),L.sortIndex=L.expirationTime,t(p,L);else break;L=s(m)}}function U(E){if(N=!1,$(E),!_)if(s(p)!==null)_=!0,C||(C=!0,q());else{var L=s(m);L!==null&&k(U,L.startTime-E)}}var C=!1,z=-1,R=5,F=-1;function K(){return j?!0:!(n.unstable_now()-F<R)}function G(){if(j=!1,C){var E=n.unstable_now();F=E;var L=!0;try{e:{_=!1,N&&(N=!1,D(z),z=-1),S=!0;var Y=x;try{t:{for($(E),v=s(p);v!==null&&!(v.expirationTime>E&&K());){var oe=v.callback;if(typeof oe=="function"){v.callback=null,x=v.priorityLevel;var ge=oe(v.expirationTime<=E);if(E=n.unstable_now(),typeof ge=="function"){v.callback=ge,$(E),L=!0;break t}v===s(p)&&l(p),$(E)}else l(p);v=s(p)}if(v!==null)L=!0;else{var B=s(m);B!==null&&k(U,B.startTime-E),L=!1}}break e}finally{v=null,x=Y,S=!1}L=void 0}}finally{L?q():C=!1}}}var q;if(typeof M=="function")q=function(){M(G)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,P=V.port2;V.port1.onmessage=G,q=function(){P.postMessage(null)}}else q=function(){T(G,0)};function k(E,L){z=T(function(){E(n.unstable_now())},L)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(E){E.callback=null},n.unstable_forceFrameRate=function(E){0>E||125<E?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<E?Math.floor(1e3/E):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(E){switch(x){case 1:case 2:case 3:var L=3;break;default:L=x}var Y=x;x=L;try{return E()}finally{x=Y}},n.unstable_requestPaint=function(){j=!0},n.unstable_runWithPriority=function(E,L){switch(E){case 1:case 2:case 3:case 4:case 5:break;default:E=3}var Y=x;x=E;try{return L()}finally{x=Y}},n.unstable_scheduleCallback=function(E,L,Y){var oe=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?oe+Y:oe):Y=oe,E){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=Y+ge,E={id:y++,callback:L,priorityLevel:E,startTime:Y,expirationTime:ge,sortIndex:-1},Y>oe?(E.sortIndex=Y,t(m,E),s(p)===null&&E===s(m)&&(N?(D(z),z=-1):N=!0,k(U,Y-oe))):(E.sortIndex=ge,t(p,E),_||S||(_=!0,C||(C=!0,q()))),E},n.unstable_shouldYield=K,n.unstable_wrapCallback=function(E){var L=x;return function(){var Y=x;x=L;try{return E.apply(this,arguments)}finally{x=Y}}}})(Jh)),Jh}var rv;function cS(){return rv||(rv=1,Wh.exports=oS()),Wh.exports}var Xh={exports:{}},sr={};var sv;function uS(){if(sv)return sr;sv=1;var n=Do();function t(p){var m="https://react.dev/errors/"+p;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+p+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var l={d:{f:s,r:function(){throw Error(t(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(p,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:p,containerInfo:m,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(p,m){if(p==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return sr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,sr.createPortal=function(p,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return u(p,m,null,y)},sr.flushSync=function(p){var m=d.T,y=l.p;try{if(d.T=null,l.p=2,p)return p()}finally{d.T=m,l.p=y,l.d.f()}},sr.preconnect=function(p,m){typeof p=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,l.d.C(p,m))},sr.prefetchDNS=function(p){typeof p=="string"&&l.d.D(p)},sr.preinit=function(p,m){if(typeof p=="string"&&m&&typeof m.as=="string"){var y=m.as,v=h(y,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,S=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?l.d.S(p,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:S}):y==="script"&&l.d.X(p,{crossOrigin:v,integrity:x,fetchPriority:S,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},sr.preinitModule=function(p,m){if(typeof p=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=h(m.as,m.crossOrigin);l.d.M(p,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&l.d.M(p)},sr.preload=function(p,m){if(typeof p=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=h(y,m.crossOrigin);l.d.L(p,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},sr.preloadModule=function(p,m){if(typeof p=="string")if(m){var y=h(m.as,m.crossOrigin);l.d.m(p,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else l.d.m(p)},sr.requestFormReset=function(p){l.d.r(p)},sr.unstable_batchedUpdates=function(p,m){return p(m)},sr.useFormState=function(p,m,y){return d.H.useFormState(p,m,y)},sr.useFormStatus=function(){return d.H.useHostTransitionStatus()},sr.version="19.2.3",sr}var iv;function Lx(){if(iv)return Xh.exports;iv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Xh.exports=uS(),Xh.exports}var av;function dS(){if(av)return no;av=1;var n=cS(),t=Do(),s=Lx();function l(e){var r="https://react.dev/errors/"+e;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var r=e,a=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,(r.flags&4098)!==0&&(a=r.return),e=r.return;while(e)}return r.tag===3?a:null}function d(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function h(e){if(e.tag===31){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function p(e){if(u(e)!==e)throw Error(l(188))}function m(e){var r=e.alternate;if(!r){if(r=u(e),r===null)throw Error(l(188));return r!==e?null:e}for(var a=e,c=r;;){var f=a.return;if(f===null)break;var g=f.alternate;if(g===null){if(c=f.return,c!==null){a=c;continue}break}if(f.child===g.child){for(g=f.child;g;){if(g===a)return p(f),e;if(g===c)return p(f),r;g=g.sibling}throw Error(l(188))}if(a.return!==c.return)a=f,c=g;else{for(var w=!1,A=f.child;A;){if(A===a){w=!0,a=f,c=g;break}if(A===c){w=!0,c=f,a=g;break}A=A.sibling}if(!w){for(A=g.child;A;){if(A===a){w=!0,a=g,c=f;break}if(A===c){w=!0,c=g,a=f;break}A=A.sibling}if(!w)throw Error(l(189))}}if(a.alternate!==c)throw Error(l(190))}if(a.tag!==3)throw Error(l(188));return a.stateNode.current===a?e:r}function y(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e;for(e=e.child;e!==null;){if(r=y(e),r!==null)return r;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),M=Symbol.for("react.context"),$=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),K=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function q(e){return e===null||typeof e!="object"?null:(e=G&&e[G]||e["@@iterator"],typeof e=="function"?e:null)}var V=Symbol.for("react.client.reference");function P(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===V?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case N:return"Fragment";case T:return"Profiler";case j:return"StrictMode";case U:return"Suspense";case C:return"SuspenseList";case F:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case M:return e.displayName||"Context";case D:return(e._context.displayName||"Context")+".Consumer";case $:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case z:return r=e.displayName||null,r!==null?r:P(e.type)||"Memo";case R:r=e._payload,e=e._init;try{return P(e(r))}catch{}}return null}var k=Array.isArray,E=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},oe=[],ge=-1;function B(e){return{current:e}}function W(e){0>ge||(e.current=oe[ge],oe[ge]=null,ge--)}function Z(e,r){ge++,oe[ge]=e.current,e.current=r}var ye=B(null),Me=B(null),xe=B(null),ae=B(null);function O(e,r){switch(Z(xe,r),Z(Me,e),Z(ye,null),r.nodeType){case 9:case 11:e=(e=r.documentElement)&&(e=e.namespaceURI)?wy(e):0;break;default:if(e=r.tagName,r=r.namespaceURI)r=wy(r),e=Sy(r,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(ye),Z(ye,e)}function J(){W(ye),W(Me),W(xe)}function ce(e){e.memoizedState!==null&&Z(ae,e);var r=ye.current,a=Sy(r,e.type);r!==a&&(Z(Me,e),Z(ye,a))}function Se(e){Me.current===e&&(W(ye),W(Me)),ae.current===e&&(W(ae),Jl._currentValue=Y)}var ke,Be;function Le(e){if(ke===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);ke=r&&r[1]||"",Be=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ke+e+Be}var Ge=!1;function pe(e,r){if(!e||Ge)return"";Ge=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var Te=function(){throw Error()};if(Object.defineProperty(Te.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Te,[])}catch(ve){var fe=ve}Reflect.construct(e,[],Te)}else{try{Te.call()}catch(ve){fe=ve}e.call(Te.prototype)}}else{try{throw Error()}catch(ve){fe=ve}(Te=e())&&typeof Te.catch=="function"&&Te.catch(function(){})}}catch(ve){if(ve&&fe&&typeof ve.stack=="string")return[ve.stack,fe.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var f=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");f&&f.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),w=g[0],A=g[1];if(w&&A){var Q=w.split(`
`),de=A.split(`
`);for(f=c=0;c<Q.length&&!Q[c].includes("DetermineComponentFrameRoot");)c++;for(;f<de.length&&!de[f].includes("DetermineComponentFrameRoot");)f++;if(c===Q.length||f===de.length)for(c=Q.length-1,f=de.length-1;1<=c&&0<=f&&Q[c]!==de[f];)f--;for(;1<=c&&0<=f;c--,f--)if(Q[c]!==de[f]){if(c!==1||f!==1)do if(c--,f--,0>f||Q[c]!==de[f]){var we=`
`+Q[c].replace(" at new "," at ");return e.displayName&&we.includes("<anonymous>")&&(we=we.replace("<anonymous>",e.displayName)),we}while(1<=c&&0<=f);break}}}finally{Ge=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Le(a):""}function Ye(e,r){switch(e.tag){case 26:case 27:case 5:return Le(e.type);case 16:return Le("Lazy");case 13:return e.child!==r&&r!==null?Le("Suspense Fallback"):Le("Suspense");case 19:return Le("SuspenseList");case 0:case 15:return pe(e.type,!1);case 11:return pe(e.type.render,!1);case 1:return pe(e.type,!0);case 31:return Le("Activity");default:return""}}function rt(e){try{var r="",a=null;do r+=Ye(e,a),a=e,e=e.return;while(e);return r}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var ft=Object.prototype.hasOwnProperty,St=n.unstable_scheduleCallback,mt=n.unstable_cancelCallback,Dt=n.unstable_shouldYield,Vt=n.unstable_requestPaint,wt=n.unstable_now,ie=n.unstable_getCurrentPriorityLevel,je=n.unstable_ImmediatePriority,Ce=n.unstable_UserBlockingPriority,Ue=n.unstable_NormalPriority,st=n.unstable_LowPriority,ct=n.unstable_IdlePriority,Rt=n.log,Jt=n.unstable_setDisableYieldValue,wn=null,jt=null;function rn(e){if(typeof Rt=="function"&&Jt(e),jt&&typeof jt.setStrictMode=="function")try{jt.setStrictMode(wn,e)}catch{}}var cn=Math.clz32?Math.clz32:ar,vn=Math.log,Ln=Math.LN2;function ar(e){return e>>>=0,e===0?32:31-(vn(e)/Ln|0)|0}var me=256,He=262144,Xe=4194304;function Ve(e){var r=e&42;if(r!==0)return r;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function et(e,r,a){var c=e.pendingLanes;if(c===0)return 0;var f=0,g=e.suspendedLanes,w=e.pingedLanes;e=e.warmLanes;var A=c&134217727;return A!==0?(c=A&~g,c!==0?f=Ve(c):(w&=A,w!==0?f=Ve(w):a||(a=A&~e,a!==0&&(f=Ve(a))))):(A=c&~g,A!==0?f=Ve(A):w!==0?f=Ve(w):a||(a=c&~e,a!==0&&(f=Ve(a)))),f===0?0:r!==0&&r!==f&&(r&g)===0&&(g=f&-f,a=r&-r,g>=a||g===32&&(a&4194048)!==0)?r:f}function Mt(e,r){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&r)===0}function vt(e,r){switch(e){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kt(){var e=Xe;return Xe<<=1,(Xe&62914560)===0&&(Xe=4194304),e}function Ze(e){for(var r=[],a=0;31>a;a++)r.push(e);return r}function Bt(e,r){e.pendingLanes|=r,r!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Qe(e,r,a,c,f,g){var w=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var A=e.entanglements,Q=e.expirationTimes,de=e.hiddenUpdates;for(a=w&~a;0<a;){var we=31-cn(a),Te=1<<we;A[we]=0,Q[we]=-1;var fe=de[we];if(fe!==null)for(de[we]=null,we=0;we<fe.length;we++){var ve=fe[we];ve!==null&&(ve.lane&=-536870913)}a&=~Te}c!==0&&Ut(e,c,0),g!==0&&f===0&&e.tag!==0&&(e.suspendedLanes|=g&~(w&~r))}function Ut(e,r,a){e.pendingLanes|=r,e.suspendedLanes&=~r;var c=31-cn(r);e.entangledLanes|=r,e.entanglements[c]=e.entanglements[c]|1073741824|a&261930}function Xt(e,r){var a=e.entangledLanes|=r;for(e=e.entanglements;a;){var c=31-cn(a),f=1<<c;f&r|e[c]&r&&(e[c]|=r),a&=~f}}function Qt(e,r){var a=r&-r;return a=(a&42)!==0?1:ne(a),(a&(e.suspendedLanes|r))!==0?0:a}function ne(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function te(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function he(){var e=L.p;return e!==0?e:(e=window.event,e===void 0?32:Gy(e.type))}function Ee(e,r){var a=L.p;try{return L.p=e,r()}finally{L.p=a}}var Ie=Math.random().toString(36).slice(2),Je="__reactFiber$"+Ie,Ke="__reactProps$"+Ie,H="__reactContainer$"+Ie,ze="__reactEvents$"+Ie,Fe="__reactListeners$"+Ie,_t="__reactHandles$"+Ie,De="__reactResources$"+Ie,dt="__reactMarker$"+Ie;function Ft(e){delete e[Je],delete e[Ke],delete e[ze],delete e[Fe],delete e[_t]}function Nn(e){var r=e[Je];if(r)return r;for(var a=e.parentNode;a;){if(r=a[H]||a[Je]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(e=Ry(e);e!==null;){if(a=e[Je])return a;e=Ry(e)}return r}e=a,a=e.parentNode}return null}function Et(e){if(e=e[Je]||e[H]){var r=e.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return e}return null}function Vn(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e.stateNode;throw Error(l(33))}function sn(e){var r=e[De];return r||(r=e[De]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Nt(e){e[dt]=!0}var Pr=new Set,Kn={};function yr(e,r){qr(e,r),qr(e+"Capture",r)}function qr(e,r){for(Kn[e]=r,e=0;e<r.length;e++)Pr.add(r[e])}var ea=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),cs={},ol={};function cl(e){return ft.call(ol,e)?!0:ft.call(cs,e)?!1:ea.test(e)?ol[e]=!0:(cs[e]=!0,!1)}function ta(e,r,a){if(cl(r))if(a===null)e.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(r);return}}e.setAttribute(r,""+a)}}function Is(e,r,a){if(a===null)e.removeAttribute(r);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttribute(r,""+a)}}function cr(e,r,a,c){if(c===null)e.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(r,a,""+c)}}function Yn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function ul(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Qu(e,r,a){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,r);if(!e.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var f=c.get,g=c.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return f.call(this)},set:function(w){a=""+w,g.call(this,w)}}),Object.defineProperty(e,r,{enumerable:c.enumerable}),{getValue:function(){return a},setValue:function(w){a=""+w},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function dl(e){if(!e._valueTracker){var r=ul(e)?"checked":"value";e._valueTracker=Qu(e,r,""+e[r])}}function Vo(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var a=r.getValue(),c="";return e&&(c=ul(e)?e.checked?"true":"false":e.value),e=c,e!==a?(r.setValue(e),!0):!1}function na(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var hl=/[\n"\\]/g;function ur(e){return e.replace(hl,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function fl(e,r,a,c,f,g,w,A){e.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?e.type=w:e.removeAttribute("type"),r!=null?w==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+Yn(r)):e.value!==""+Yn(r)&&(e.value=""+Yn(r)):w!=="submit"&&w!=="reset"||e.removeAttribute("value"),r!=null?pl(e,w,Yn(r)):a!=null?pl(e,w,Yn(a)):c!=null&&e.removeAttribute("value"),f==null&&g!=null&&(e.defaultChecked=!!g),f!=null&&(e.checked=f&&typeof f!="function"&&typeof f!="symbol"),A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"?e.name=""+Yn(A):e.removeAttribute("name")}function Bs(e,r,a,c,f,g,w,A){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),r!=null||a!=null){if(!(g!=="submit"&&g!=="reset"||r!=null)){dl(e);return}a=a!=null?""+Yn(a):"",r=r!=null?""+Yn(r):a,A||r===e.value||(e.value=r),e.defaultValue=r}c=c??f,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=A?e.checked:!!c,e.defaultChecked=!!c,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(e.name=w),dl(e)}function pl(e,r,a){r==="number"&&na(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function $s(e,r,a,c){if(e=e.options,r){r={};for(var f=0;f<a.length;f++)r["$"+a[f]]=!0;for(a=0;a<e.length;a++)f=r.hasOwnProperty("$"+e[a].value),e[a].selected!==f&&(e[a].selected=f),f&&c&&(e[a].defaultSelected=!0)}else{for(a=""+Yn(a),r=null,f=0;f<e.length;f++){if(e[f].value===a){e[f].selected=!0,c&&(e[f].defaultSelected=!0);return}r!==null||e[f].disabled||(r=e[f])}r!==null&&(r.selected=!0)}}function Ko(e,r,a){if(r!=null&&(r=""+Yn(r),r!==e.value&&(e.value=r),a==null)){e.defaultValue!==r&&(e.defaultValue=r);return}e.defaultValue=a!=null?""+Yn(a):""}function Yo(e,r,a,c){if(r==null){if(c!=null){if(a!=null)throw Error(l(92));if(k(c)){if(1<c.length)throw Error(l(93));c=c[0]}a=c}a==null&&(a=""),r=a}a=Yn(r),e.defaultValue=a,c=e.textContent,c===a&&c!==""&&c!==null&&(e.value=c),dl(e)}function us(e,r){if(r){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=r;return}}e.textContent=r}var Qo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Wo(e,r,a){var c=r.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?c?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="":c?e.setProperty(r,a):typeof a!="number"||a===0||Qo.has(r)?r==="float"?e.cssFloat=a:e[r]=(""+a).trim():e[r]=a+"px"}function Jo(e,r,a){if(r!=null&&typeof r!="object")throw Error(l(62));if(e=e.style,a!=null){for(var c in a)!a.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var f in r)c=r[f],r.hasOwnProperty(f)&&a[f]!==c&&Wo(e,f,c)}else for(var g in r)r.hasOwnProperty(g)&&Wo(e,g,r[g])}function ra(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Xo=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function sa(e){return Xo.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Fr(){}var ml=null;function gl(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ps=null,qs=null;function xi(e){var r=Et(e);if(r&&(e=r.stateNode)){var a=e[Ke]||null;e:switch(e=r.stateNode,r.type){case"input":if(fl(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),r=a.name,a.type==="radio"&&r!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+ur(""+r)+'"][type="radio"]'),r=0;r<a.length;r++){var c=a[r];if(c!==e&&c.form===e.form){var f=c[Ke]||null;if(!f)throw Error(l(90));fl(c,f.value,f.defaultValue,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name)}}for(r=0;r<a.length;r++)c=a[r],c.form===e.form&&Vo(c)}break e;case"textarea":Ko(e,a.value,a.defaultValue);break e;case"select":r=a.value,r!=null&&$s(e,!!a.multiple,r,!1)}}}var ia=!1;function I(e,r,a){if(ia)return e(r,a);ia=!0;try{var c=e(r);return c}finally{if(ia=!1,(Ps!==null||qs!==null)&&(Mc(),Ps&&(r=Ps,e=qs,qs=Ps=null,xi(r),e)))for(r=0;r<e.length;r++)xi(e[r])}}function X(e,r){var a=e.stateNode;if(a===null)return null;var c=a[Ke]||null;if(c===null)return null;a=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(l(231,r,typeof a));return a}var se=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),be=!1;if(se)try{var Ae={};Object.defineProperty(Ae,"passive",{get:function(){be=!0}}),window.addEventListener("test",Ae,Ae),window.removeEventListener("test",Ae,Ae)}catch{be=!1}var Oe=null,$e=null,qe=null;function We(){if(qe)return qe;var e,r=$e,a=r.length,c,f="value"in Oe?Oe.value:Oe.textContent,g=f.length;for(e=0;e<a&&r[e]===f[e];e++);var w=a-e;for(c=1;c<=w&&r[a-c]===f[g-c];c++);return qe=f.slice(e,1<c?1-c:void 0)}function nt(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function ut(){return!0}function pt(){return!1}function Pe(e){function r(a,c,f,g,w){this._reactName=a,this._targetInst=f,this.type=c,this.nativeEvent=g,this.target=w,this.currentTarget=null;for(var A in e)e.hasOwnProperty(A)&&(a=e[A],this[A]=a?a(g):g[A]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?ut:pt,this.isPropagationStopped=pt,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=ut)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=ut)},persist:function(){},isPersistent:ut}),r}var gt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pn=Pe(gt),dn=v({},gt,{view:0,detail:0}),Fs=Pe(dn),Zr,it,lt,Ct=v({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Xu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==lt&&(lt&&e.type==="mousemove"?(Zr=e.screenX-lt.screenX,it=e.screenY-lt.screenY):it=Zr=0,lt=e),Zr)},movementY:function(e){return"movementY"in e?e.movementY:it}}),hn=Pe(Ct),En=v({},Ct,{dataTransfer:0}),kn=Pe(En),$t=v({},dn,{relatedTarget:0}),rr=Pe($t),An=v({},gt,{animationName:0,elapsedTime:0,pseudoElement:0}),ds=Pe(An),es=v({},gt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Hs=Pe(es),yl=v({},gt,{data:0}),Ju=Pe(yl),hs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mb(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=bi[e])?!!r[e]:!1}function Xu(){return mb}var gb=v({},dn,{key:function(e){if(e.key){var r=hs[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=nt(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?aa[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Xu,charCode:function(e){return e.type==="keypress"?nt(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?nt(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),yb=Pe(gb),vb=v({},Ct,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Np=Pe(vb),xb=v({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Xu}),bb=Pe(xb),wb=v({},gt,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sb=Pe(wb),jb=v({},Ct,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_b=Pe(jb),Cb=v({},gt,{newState:0,oldState:0}),Nb=Pe(Cb),Eb=[9,13,27,32],Zu=se&&"CompositionEvent"in window,vl=null;se&&"documentMode"in document&&(vl=document.documentMode);var Tb=se&&"TextEvent"in window&&!vl,Ep=se&&(!Zu||vl&&8<vl&&11>=vl),Tp=" ",Rp=!1;function kp(e,r){switch(e){case"keyup":return Eb.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ap(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var la=!1;function Rb(e,r){switch(e){case"compositionend":return Ap(r);case"keypress":return r.which!==32?null:(Rp=!0,Tp);case"textInput":return e=r.data,e===Tp&&Rp?null:e;default:return null}}function kb(e,r){if(la)return e==="compositionend"||!Zu&&kp(e,r)?(e=We(),qe=$e=Oe=null,la=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Ep&&r.locale!=="ko"?null:r.data;default:return null}}var Ab={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Op(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!Ab[e.type]:r==="textarea"}function Dp(e,r,a,c){Ps?qs?qs.push(c):qs=[c]:Ps=c,r=Pc(r,"onChange"),0<r.length&&(a=new pn("onChange","change",null,a,c),e.push({event:a,listeners:r}))}var xl=null,bl=null;function Ob(e){my(e,0)}function Zo(e){var r=Vn(e);if(Vo(r))return e}function Mp(e,r){if(e==="change")return r}var zp=!1;if(se){var ed;if(se){var td="oninput"in document;if(!td){var Up=document.createElement("div");Up.setAttribute("oninput","return;"),td=typeof Up.oninput=="function"}ed=td}else ed=!1;zp=ed&&(!document.documentMode||9<document.documentMode)}function Lp(){xl&&(xl.detachEvent("onpropertychange",Ip),bl=xl=null)}function Ip(e){if(e.propertyName==="value"&&Zo(bl)){var r=[];Dp(r,bl,e,gl(e)),I(Ob,r)}}function Db(e,r,a){e==="focusin"?(Lp(),xl=r,bl=a,xl.attachEvent("onpropertychange",Ip)):e==="focusout"&&Lp()}function Mb(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Zo(bl)}function zb(e,r){if(e==="click")return Zo(r)}function Ub(e,r){if(e==="input"||e==="change")return Zo(r)}function Lb(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var vr=typeof Object.is=="function"?Object.is:Lb;function wl(e,r){if(vr(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var a=Object.keys(e),c=Object.keys(r);if(a.length!==c.length)return!1;for(c=0;c<a.length;c++){var f=a[c];if(!ft.call(r,f)||!vr(e[f],r[f]))return!1}return!0}function Bp(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function $p(e,r){var a=Bp(e);e=0;for(var c;a;){if(a.nodeType===3){if(c=e+a.textContent.length,e<=r&&c>=r)return{node:a,offset:r-e};e=c}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Bp(a)}}function Pp(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?Pp(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function qp(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var r=na(e.document);r instanceof e.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)e=r.contentWindow;else break;r=na(e.document)}return r}function nd(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}var Ib=se&&"documentMode"in document&&11>=document.documentMode,oa=null,rd=null,Sl=null,sd=!1;function Fp(e,r,a){var c=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;sd||oa==null||oa!==na(c)||(c=oa,"selectionStart"in c&&nd(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Sl&&wl(Sl,c)||(Sl=c,c=Pc(rd,"onSelect"),0<c.length&&(r=new pn("onSelect","select",null,r,a),e.push({event:r,listeners:c}),r.target=oa)))}function wi(e,r){var a={};return a[e.toLowerCase()]=r.toLowerCase(),a["Webkit"+e]="webkit"+r,a["Moz"+e]="moz"+r,a}var ca={animationend:wi("Animation","AnimationEnd"),animationiteration:wi("Animation","AnimationIteration"),animationstart:wi("Animation","AnimationStart"),transitionrun:wi("Transition","TransitionRun"),transitionstart:wi("Transition","TransitionStart"),transitioncancel:wi("Transition","TransitionCancel"),transitionend:wi("Transition","TransitionEnd")},id={},Hp={};se&&(Hp=document.createElement("div").style,"AnimationEvent"in window||(delete ca.animationend.animation,delete ca.animationiteration.animation,delete ca.animationstart.animation),"TransitionEvent"in window||delete ca.transitionend.transition);function Si(e){if(id[e])return id[e];if(!ca[e])return e;var r=ca[e],a;for(a in r)if(r.hasOwnProperty(a)&&a in Hp)return id[e]=r[a];return e}var Gp=Si("animationend"),Vp=Si("animationiteration"),Kp=Si("animationstart"),Bb=Si("transitionrun"),$b=Si("transitionstart"),Pb=Si("transitioncancel"),Yp=Si("transitionend"),Qp=new Map,ad="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ad.push("scrollEnd");function Hr(e,r){Qp.set(e,r),yr(r,[e])}var ec=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Rr=[],ua=0,ld=0;function tc(){for(var e=ua,r=ld=ua=0;r<e;){var a=Rr[r];Rr[r++]=null;var c=Rr[r];Rr[r++]=null;var f=Rr[r];Rr[r++]=null;var g=Rr[r];if(Rr[r++]=null,c!==null&&f!==null){var w=c.pending;w===null?f.next=f:(f.next=w.next,w.next=f),c.pending=f}g!==0&&Wp(a,f,g)}}function nc(e,r,a,c){Rr[ua++]=e,Rr[ua++]=r,Rr[ua++]=a,Rr[ua++]=c,ld|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function od(e,r,a,c){return nc(e,r,a,c),rc(e)}function ji(e,r){return nc(e,null,null,r),rc(e)}function Wp(e,r,a){e.lanes|=a;var c=e.alternate;c!==null&&(c.lanes|=a);for(var f=!1,g=e.return;g!==null;)g.childLanes|=a,c=g.alternate,c!==null&&(c.childLanes|=a),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(f=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,f&&r!==null&&(f=31-cn(a),e=g.hiddenUpdates,c=e[f],c===null?e[f]=[r]:c.push(r),r.lane=a|536870912),g):null}function rc(e){if(50<Hl)throw Hl=0,yh=null,Error(l(185));for(var r=e.return;r!==null;)e=r,r=e.return;return e.tag===3?e.stateNode:null}var da={};function qb(e,r,a,c){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(e,r,a,c){return new qb(e,r,a,c)}function cd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function fs(e,r){var a=e.alternate;return a===null?(a=xr(e.tag,r,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=r,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,r=e.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Jp(e,r){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=r,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,r=a.dependencies,e.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e}function sc(e,r,a,c,f,g){var w=0;if(c=e,typeof e=="function")cd(e)&&(w=1);else if(typeof e=="string")w=Kw(e,a,ye.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case F:return e=xr(31,a,r,f),e.elementType=F,e.lanes=g,e;case N:return _i(a.children,f,g,r);case j:w=8,f|=24;break;case T:return e=xr(12,a,r,f|2),e.elementType=T,e.lanes=g,e;case U:return e=xr(13,a,r,f),e.elementType=U,e.lanes=g,e;case C:return e=xr(19,a,r,f),e.elementType=C,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case M:w=10;break e;case D:w=9;break e;case $:w=11;break e;case z:w=14;break e;case R:w=16,c=null;break e}w=29,a=Error(l(130,e===null?"null":typeof e,"")),c=null}return r=xr(w,a,r,f),r.elementType=e,r.type=c,r.lanes=g,r}function _i(e,r,a,c){return e=xr(7,e,c,r),e.lanes=a,e}function ud(e,r,a){return e=xr(6,e,null,r),e.lanes=a,e}function Xp(e){var r=xr(18,null,null,0);return r.stateNode=e,r}function dd(e,r,a){return r=xr(4,e.children!==null?e.children:[],e.key,r),r.lanes=a,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}var Zp=new WeakMap;function kr(e,r){if(typeof e=="object"&&e!==null){var a=Zp.get(e);return a!==void 0?a:(r={value:e,source:r,stack:rt(r)},Zp.set(e,r),r)}return{value:e,source:r,stack:rt(r)}}var ha=[],fa=0,ic=null,jl=0,Ar=[],Or=0,Gs=null,ts=1,ns="";function ps(e,r){ha[fa++]=jl,ha[fa++]=ic,ic=e,jl=r}function em(e,r,a){Ar[Or++]=ts,Ar[Or++]=ns,Ar[Or++]=Gs,Gs=e;var c=ts;e=ns;var f=32-cn(c)-1;c&=~(1<<f),a+=1;var g=32-cn(r)+f;if(30<g){var w=f-f%5;g=(c&(1<<w)-1).toString(32),c>>=w,f-=w,ts=1<<32-cn(r)+f|a<<f|c,ns=g+e}else ts=1<<g|a<<f|c,ns=e}function hd(e){e.return!==null&&(ps(e,1),em(e,1,0))}function fd(e){for(;e===ic;)ic=ha[--fa],ha[fa]=null,jl=ha[--fa],ha[fa]=null;for(;e===Gs;)Gs=Ar[--Or],Ar[Or]=null,ns=Ar[--Or],Ar[Or]=null,ts=Ar[--Or],Ar[Or]=null}function tm(e,r){Ar[Or++]=ts,Ar[Or++]=ns,Ar[Or++]=Gs,ts=r.id,ns=r.overflow,Gs=e}var Qn=null,mn=null,Ht=!1,Vs=null,Dr=!1,pd=Error(l(519));function Ks(e){var r=Error(l(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw _l(kr(r,e)),pd}function nm(e){var r=e.stateNode,a=e.type,c=e.memoizedProps;switch(r[Je]=e,r[Ke]=c,a){case"dialog":It("cancel",r),It("close",r);break;case"iframe":case"object":case"embed":It("load",r);break;case"video":case"audio":for(a=0;a<Vl.length;a++)It(Vl[a],r);break;case"source":It("error",r);break;case"img":case"image":case"link":It("error",r),It("load",r);break;case"details":It("toggle",r);break;case"input":It("invalid",r),Bs(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":It("invalid",r);break;case"textarea":It("invalid",r),Yo(r,c.value,c.defaultValue,c.children)}a=c.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||r.textContent===""+a||c.suppressHydrationWarning===!0||xy(r.textContent,a)?(c.popover!=null&&(It("beforetoggle",r),It("toggle",r)),c.onScroll!=null&&It("scroll",r),c.onScrollEnd!=null&&It("scrollend",r),c.onClick!=null&&(r.onclick=Fr),r=!0):r=!1,r||Ks(e,!0)}function rm(e){for(Qn=e.return;Qn;)switch(Qn.tag){case 5:case 31:case 13:Dr=!1;return;case 27:case 3:Dr=!0;return;default:Qn=Qn.return}}function pa(e){if(e!==Qn)return!1;if(!Ht)return rm(e),Ht=!0,!1;var r=e.tag,a;if((a=r!==3&&r!==27)&&((a=r===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||Oh(e.type,e.memoizedProps)),a=!a),a&&mn&&Ks(e),rm(e),r===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));mn=Ty(e)}else if(r===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(317));mn=Ty(e)}else r===27?(r=mn,li(e.type)?(e=Lh,Lh=null,mn=e):mn=r):mn=Qn?zr(e.stateNode.nextSibling):null;return!0}function Ci(){mn=Qn=null,Ht=!1}function md(){var e=Vs;return e!==null&&(pr===null?pr=e:pr.push.apply(pr,e),Vs=null),e}function _l(e){Vs===null?Vs=[e]:Vs.push(e)}var gd=B(null),Ni=null,ms=null;function Ys(e,r,a){Z(gd,r._currentValue),r._currentValue=a}function gs(e){e._currentValue=gd.current,W(gd)}function yd(e,r,a){for(;e!==null;){var c=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),e===a)break;e=e.return}}function vd(e,r,a,c){var f=e.child;for(f!==null&&(f.return=e);f!==null;){var g=f.dependencies;if(g!==null){var w=f.child;g=g.firstContext;e:for(;g!==null;){var A=g;g=f;for(var Q=0;Q<r.length;Q++)if(A.context===r[Q]){g.lanes|=a,A=g.alternate,A!==null&&(A.lanes|=a),yd(g.return,a,e),c||(w=null);break e}g=A.next}}else if(f.tag===18){if(w=f.return,w===null)throw Error(l(341));w.lanes|=a,g=w.alternate,g!==null&&(g.lanes|=a),yd(w,a,e),w=null}else w=f.child;if(w!==null)w.return=f;else for(w=f;w!==null;){if(w===e){w=null;break}if(f=w.sibling,f!==null){f.return=w.return,w=f;break}w=w.return}f=w}}function ma(e,r,a,c){e=null;for(var f=r,g=!1;f!==null;){if(!g){if((f.flags&524288)!==0)g=!0;else if((f.flags&262144)!==0)break}if(f.tag===10){var w=f.alternate;if(w===null)throw Error(l(387));if(w=w.memoizedProps,w!==null){var A=f.type;vr(f.pendingProps.value,w.value)||(e!==null?e.push(A):e=[A])}}else if(f===ae.current){if(w=f.alternate,w===null)throw Error(l(387));w.memoizedState.memoizedState!==f.memoizedState.memoizedState&&(e!==null?e.push(Jl):e=[Jl])}f=f.return}e!==null&&vd(r,e,a,c),r.flags|=262144}function ac(e){for(e=e.firstContext;e!==null;){if(!vr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ei(e){Ni=e,ms=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Wn(e){return sm(Ni,e)}function lc(e,r){return Ni===null&&Ei(e),sm(e,r)}function sm(e,r){var a=r._currentValue;if(r={context:r,memoizedValue:a,next:null},ms===null){if(e===null)throw Error(l(308));ms=r,e.dependencies={lanes:0,firstContext:r},e.flags|=524288}else ms=ms.next=r;return a}var Fb=typeof AbortController<"u"?AbortController:function(){var e=[],r=this.signal={aborted:!1,addEventListener:function(a,c){e.push(c)}};this.abort=function(){r.aborted=!0,e.forEach(function(a){return a()})}},Hb=n.unstable_scheduleCallback,Gb=n.unstable_NormalPriority,On={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function xd(){return{controller:new Fb,data:new Map,refCount:0}}function Cl(e){e.refCount--,e.refCount===0&&Hb(Gb,function(){e.controller.abort()})}var Nl=null,bd=0,ga=0,ya=null;function Vb(e,r){if(Nl===null){var a=Nl=[];bd=0,ga=jh(),ya={status:"pending",value:void 0,then:function(c){a.push(c)}}}return bd++,r.then(im,im),r}function im(){if(--bd===0&&Nl!==null){ya!==null&&(ya.status="fulfilled");var e=Nl;Nl=null,ga=0,ya=null;for(var r=0;r<e.length;r++)(0,e[r])()}}function Kb(e,r){var a=[],c={status:"pending",value:null,reason:null,then:function(f){a.push(f)}};return e.then(function(){c.status="fulfilled",c.value=r;for(var f=0;f<a.length;f++)(0,a[f])(r)},function(f){for(c.status="rejected",c.reason=f,f=0;f<a.length;f++)(0,a[f])(void 0)}),c}var am=E.S;E.S=function(e,r){Fg=wt(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&Vb(e,r),am!==null&&am(e,r)};var Ti=B(null);function wd(){var e=Ti.current;return e!==null?e:un.pooledCache}function oc(e,r){r===null?Z(Ti,Ti.current):Z(Ti,r.pool)}function lm(){var e=wd();return e===null?null:{parent:On._currentValue,pool:e}}var va=Error(l(460)),Sd=Error(l(474)),cc=Error(l(542)),uc={then:function(){}};function om(e){return e=e.status,e==="fulfilled"||e==="rejected"}function cm(e,r,a){switch(a=e[a],a===void 0?e.push(r):a!==r&&(r.then(Fr,Fr),r=a),r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,dm(e),e;default:if(typeof r.status=="string")r.then(Fr,Fr);else{if(e=un,e!==null&&100<e.shellSuspendCounter)throw Error(l(482));e=r,e.status="pending",e.then(function(c){if(r.status==="pending"){var f=r;f.status="fulfilled",f.value=c}},function(c){if(r.status==="pending"){var f=r;f.status="rejected",f.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,dm(e),e}throw ki=r,va}}function Ri(e){try{var r=e._init;return r(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(ki=a,va):a}}var ki=null;function um(){if(ki===null)throw Error(l(459));var e=ki;return ki=null,e}function dm(e){if(e===va||e===cc)throw Error(l(483))}var xa=null,El=0;function dc(e){var r=El;return El+=1,xa===null&&(xa=[]),cm(xa,e,r)}function Tl(e,r){r=r.props.ref,e.ref=r!==void 0?r:null}function hc(e,r){throw r.$$typeof===x?Error(l(525)):(e=Object.prototype.toString.call(r),Error(l(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)))}function hm(e){function r(re,ee){if(e){var ue=re.deletions;ue===null?(re.deletions=[ee],re.flags|=16):ue.push(ee)}}function a(re,ee){if(!e)return null;for(;ee!==null;)r(re,ee),ee=ee.sibling;return null}function c(re){for(var ee=new Map;re!==null;)re.key!==null?ee.set(re.key,re):ee.set(re.index,re),re=re.sibling;return ee}function f(re,ee){return re=fs(re,ee),re.index=0,re.sibling=null,re}function g(re,ee,ue){return re.index=ue,e?(ue=re.alternate,ue!==null?(ue=ue.index,ue<ee?(re.flags|=67108866,ee):ue):(re.flags|=67108866,ee)):(re.flags|=1048576,ee)}function w(re){return e&&re.alternate===null&&(re.flags|=67108866),re}function A(re,ee,ue,Ne){return ee===null||ee.tag!==6?(ee=ud(ue,re.mode,Ne),ee.return=re,ee):(ee=f(ee,ue),ee.return=re,ee)}function Q(re,ee,ue,Ne){var ht=ue.type;return ht===N?we(re,ee,ue.props.children,Ne,ue.key):ee!==null&&(ee.elementType===ht||typeof ht=="object"&&ht!==null&&ht.$$typeof===R&&Ri(ht)===ee.type)?(ee=f(ee,ue.props),Tl(ee,ue),ee.return=re,ee):(ee=sc(ue.type,ue.key,ue.props,null,re.mode,Ne),Tl(ee,ue),ee.return=re,ee)}function de(re,ee,ue,Ne){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ue.containerInfo||ee.stateNode.implementation!==ue.implementation?(ee=dd(ue,re.mode,Ne),ee.return=re,ee):(ee=f(ee,ue.children||[]),ee.return=re,ee)}function we(re,ee,ue,Ne,ht){return ee===null||ee.tag!==7?(ee=_i(ue,re.mode,Ne,ht),ee.return=re,ee):(ee=f(ee,ue),ee.return=re,ee)}function Te(re,ee,ue){if(typeof ee=="string"&&ee!==""||typeof ee=="number"||typeof ee=="bigint")return ee=ud(""+ee,re.mode,ue),ee.return=re,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case S:return ue=sc(ee.type,ee.key,ee.props,null,re.mode,ue),Tl(ue,ee),ue.return=re,ue;case _:return ee=dd(ee,re.mode,ue),ee.return=re,ee;case R:return ee=Ri(ee),Te(re,ee,ue)}if(k(ee)||q(ee))return ee=_i(ee,re.mode,ue,null),ee.return=re,ee;if(typeof ee.then=="function")return Te(re,dc(ee),ue);if(ee.$$typeof===M)return Te(re,lc(re,ee),ue);hc(re,ee)}return null}function fe(re,ee,ue,Ne){var ht=ee!==null?ee.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return ht!==null?null:A(re,ee,""+ue,Ne);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case S:return ue.key===ht?Q(re,ee,ue,Ne):null;case _:return ue.key===ht?de(re,ee,ue,Ne):null;case R:return ue=Ri(ue),fe(re,ee,ue,Ne)}if(k(ue)||q(ue))return ht!==null?null:we(re,ee,ue,Ne,null);if(typeof ue.then=="function")return fe(re,ee,dc(ue),Ne);if(ue.$$typeof===M)return fe(re,ee,lc(re,ue),Ne);hc(re,ue)}return null}function ve(re,ee,ue,Ne,ht){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return re=re.get(ue)||null,A(ee,re,""+Ne,ht);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case S:return re=re.get(Ne.key===null?ue:Ne.key)||null,Q(ee,re,Ne,ht);case _:return re=re.get(Ne.key===null?ue:Ne.key)||null,de(ee,re,Ne,ht);case R:return Ne=Ri(Ne),ve(re,ee,ue,Ne,ht)}if(k(Ne)||q(Ne))return re=re.get(ue)||null,we(ee,re,Ne,ht,null);if(typeof Ne.then=="function")return ve(re,ee,ue,dc(Ne),ht);if(Ne.$$typeof===M)return ve(re,ee,ue,lc(ee,Ne),ht);hc(ee,Ne)}return null}function tt(re,ee,ue,Ne){for(var ht=null,Kt=null,at=ee,Ot=ee=0,qt=null;at!==null&&Ot<ue.length;Ot++){at.index>Ot?(qt=at,at=null):qt=at.sibling;var Yt=fe(re,at,ue[Ot],Ne);if(Yt===null){at===null&&(at=qt);break}e&&at&&Yt.alternate===null&&r(re,at),ee=g(Yt,ee,Ot),Kt===null?ht=Yt:Kt.sibling=Yt,Kt=Yt,at=qt}if(Ot===ue.length)return a(re,at),Ht&&ps(re,Ot),ht;if(at===null){for(;Ot<ue.length;Ot++)at=Te(re,ue[Ot],Ne),at!==null&&(ee=g(at,ee,Ot),Kt===null?ht=at:Kt.sibling=at,Kt=at);return Ht&&ps(re,Ot),ht}for(at=c(at);Ot<ue.length;Ot++)qt=ve(at,re,Ot,ue[Ot],Ne),qt!==null&&(e&&qt.alternate!==null&&at.delete(qt.key===null?Ot:qt.key),ee=g(qt,ee,Ot),Kt===null?ht=qt:Kt.sibling=qt,Kt=qt);return e&&at.forEach(function(hi){return r(re,hi)}),Ht&&ps(re,Ot),ht}function yt(re,ee,ue,Ne){if(ue==null)throw Error(l(151));for(var ht=null,Kt=null,at=ee,Ot=ee=0,qt=null,Yt=ue.next();at!==null&&!Yt.done;Ot++,Yt=ue.next()){at.index>Ot?(qt=at,at=null):qt=at.sibling;var hi=fe(re,at,Yt.value,Ne);if(hi===null){at===null&&(at=qt);break}e&&at&&hi.alternate===null&&r(re,at),ee=g(hi,ee,Ot),Kt===null?ht=hi:Kt.sibling=hi,Kt=hi,at=qt}if(Yt.done)return a(re,at),Ht&&ps(re,Ot),ht;if(at===null){for(;!Yt.done;Ot++,Yt=ue.next())Yt=Te(re,Yt.value,Ne),Yt!==null&&(ee=g(Yt,ee,Ot),Kt===null?ht=Yt:Kt.sibling=Yt,Kt=Yt);return Ht&&ps(re,Ot),ht}for(at=c(at);!Yt.done;Ot++,Yt=ue.next())Yt=ve(at,re,Ot,Yt.value,Ne),Yt!==null&&(e&&Yt.alternate!==null&&at.delete(Yt.key===null?Ot:Yt.key),ee=g(Yt,ee,Ot),Kt===null?ht=Yt:Kt.sibling=Yt,Kt=Yt);return e&&at.forEach(function(sS){return r(re,sS)}),Ht&&ps(re,Ot),ht}function on(re,ee,ue,Ne){if(typeof ue=="object"&&ue!==null&&ue.type===N&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case S:e:{for(var ht=ue.key;ee!==null;){if(ee.key===ht){if(ht=ue.type,ht===N){if(ee.tag===7){a(re,ee.sibling),Ne=f(ee,ue.props.children),Ne.return=re,re=Ne;break e}}else if(ee.elementType===ht||typeof ht=="object"&&ht!==null&&ht.$$typeof===R&&Ri(ht)===ee.type){a(re,ee.sibling),Ne=f(ee,ue.props),Tl(Ne,ue),Ne.return=re,re=Ne;break e}a(re,ee);break}else r(re,ee);ee=ee.sibling}ue.type===N?(Ne=_i(ue.props.children,re.mode,Ne,ue.key),Ne.return=re,re=Ne):(Ne=sc(ue.type,ue.key,ue.props,null,re.mode,Ne),Tl(Ne,ue),Ne.return=re,re=Ne)}return w(re);case _:e:{for(ht=ue.key;ee!==null;){if(ee.key===ht)if(ee.tag===4&&ee.stateNode.containerInfo===ue.containerInfo&&ee.stateNode.implementation===ue.implementation){a(re,ee.sibling),Ne=f(ee,ue.children||[]),Ne.return=re,re=Ne;break e}else{a(re,ee);break}else r(re,ee);ee=ee.sibling}Ne=dd(ue,re.mode,Ne),Ne.return=re,re=Ne}return w(re);case R:return ue=Ri(ue),on(re,ee,ue,Ne)}if(k(ue))return tt(re,ee,ue,Ne);if(q(ue)){if(ht=q(ue),typeof ht!="function")throw Error(l(150));return ue=ht.call(ue),yt(re,ee,ue,Ne)}if(typeof ue.then=="function")return on(re,ee,dc(ue),Ne);if(ue.$$typeof===M)return on(re,ee,lc(re,ue),Ne);hc(re,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint"?(ue=""+ue,ee!==null&&ee.tag===6?(a(re,ee.sibling),Ne=f(ee,ue),Ne.return=re,re=Ne):(a(re,ee),Ne=ud(ue,re.mode,Ne),Ne.return=re,re=Ne),w(re)):a(re,ee)}return function(re,ee,ue,Ne){try{El=0;var ht=on(re,ee,ue,Ne);return xa=null,ht}catch(at){if(at===va||at===cc)throw at;var Kt=xr(29,at,null,re.mode);return Kt.lanes=Ne,Kt.return=re,Kt}}}var Ai=hm(!0),fm=hm(!1),Qs=!1;function jd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function _d(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ws(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Js(e,r,a){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(Wt&2)!==0){var f=c.pending;return f===null?r.next=r:(r.next=f.next,f.next=r),c.pending=r,r=rc(e),Wp(e,null,a),r}return nc(e,c,r,a),rc(e)}function Rl(e,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194048)!==0)){var c=r.lanes;c&=e.pendingLanes,a|=c,r.lanes=a,Xt(e,a)}}function Cd(e,r){var a=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,a===c)){var f=null,g=null;if(a=a.firstBaseUpdate,a!==null){do{var w={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};g===null?f=g=w:g=g.next=w,a=a.next}while(a!==null);g===null?f=g=r:g=g.next=r}else f=g=r;a={baseState:c.baseState,firstBaseUpdate:f,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=r:e.next=r,a.lastBaseUpdate=r}var Nd=!1;function kl(){if(Nd){var e=ya;if(e!==null)throw e}}function Al(e,r,a,c){Nd=!1;var f=e.updateQueue;Qs=!1;var g=f.firstBaseUpdate,w=f.lastBaseUpdate,A=f.shared.pending;if(A!==null){f.shared.pending=null;var Q=A,de=Q.next;Q.next=null,w===null?g=de:w.next=de,w=Q;var we=e.alternate;we!==null&&(we=we.updateQueue,A=we.lastBaseUpdate,A!==w&&(A===null?we.firstBaseUpdate=de:A.next=de,we.lastBaseUpdate=Q))}if(g!==null){var Te=f.baseState;w=0,we=de=Q=null,A=g;do{var fe=A.lane&-536870913,ve=fe!==A.lane;if(ve?(Pt&fe)===fe:(c&fe)===fe){fe!==0&&fe===ga&&(Nd=!0),we!==null&&(we=we.next={lane:0,tag:A.tag,payload:A.payload,callback:null,next:null});e:{var tt=e,yt=A;fe=r;var on=a;switch(yt.tag){case 1:if(tt=yt.payload,typeof tt=="function"){Te=tt.call(on,Te,fe);break e}Te=tt;break e;case 3:tt.flags=tt.flags&-65537|128;case 0:if(tt=yt.payload,fe=typeof tt=="function"?tt.call(on,Te,fe):tt,fe==null)break e;Te=v({},Te,fe);break e;case 2:Qs=!0}}fe=A.callback,fe!==null&&(e.flags|=64,ve&&(e.flags|=8192),ve=f.callbacks,ve===null?f.callbacks=[fe]:ve.push(fe))}else ve={lane:fe,tag:A.tag,payload:A.payload,callback:A.callback,next:null},we===null?(de=we=ve,Q=Te):we=we.next=ve,w|=fe;if(A=A.next,A===null){if(A=f.shared.pending,A===null)break;ve=A,A=ve.next,ve.next=null,f.lastBaseUpdate=ve,f.shared.pending=null}}while(!0);we===null&&(Q=Te),f.baseState=Q,f.firstBaseUpdate=de,f.lastBaseUpdate=we,g===null&&(f.shared.lanes=0),ni|=w,e.lanes=w,e.memoizedState=Te}}function pm(e,r){if(typeof e!="function")throw Error(l(191,e));e.call(r)}function mm(e,r){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)pm(a[e],r)}var ba=B(null),fc=B(0);function gm(e,r){e=Cs,Z(fc,e),Z(ba,r),Cs=e|r.baseLanes}function Ed(){Z(fc,Cs),Z(ba,ba.current)}function Td(){Cs=fc.current,W(ba),W(fc)}var br=B(null),Mr=null;function Xs(e){var r=e.alternate;Z(Tn,Tn.current&1),Z(br,e),Mr===null&&(r===null||ba.current!==null||r.memoizedState!==null)&&(Mr=e)}function Rd(e){Z(Tn,Tn.current),Z(br,e),Mr===null&&(Mr=e)}function ym(e){e.tag===22?(Z(Tn,Tn.current),Z(br,e),Mr===null&&(Mr=e)):Zs()}function Zs(){Z(Tn,Tn.current),Z(br,br.current)}function wr(e){W(br),Mr===e&&(Mr=null),W(Tn)}var Tn=B(0);function pc(e){for(var r=e;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||zh(a)||Uh(a)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var ys=0,At=null,an=null,Dn=null,mc=!1,wa=!1,Oi=!1,gc=0,Ol=0,Sa=null,Yb=0;function Sn(){throw Error(l(321))}function kd(e,r){if(r===null)return!1;for(var a=0;a<r.length&&a<e.length;a++)if(!vr(e[a],r[a]))return!1;return!0}function Ad(e,r,a,c,f,g){return ys=g,At=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,E.H=e===null||e.memoizedState===null?eg:Vd,Oi=!1,g=a(c,f),Oi=!1,wa&&(g=xm(r,a,c,f)),vm(e),g}function vm(e){E.H=zl;var r=an!==null&&an.next!==null;if(ys=0,Dn=an=At=null,mc=!1,Ol=0,Sa=null,r)throw Error(l(300));e===null||Mn||(e=e.dependencies,e!==null&&ac(e)&&(Mn=!0))}function xm(e,r,a,c){At=e;var f=0;do{if(wa&&(Sa=null),Ol=0,wa=!1,25<=f)throw Error(l(301));if(f+=1,Dn=an=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}E.H=tg,g=r(a,c)}while(wa);return g}function Qb(){var e=E.H,r=e.useState()[0];return r=typeof r.then=="function"?Dl(r):r,e=e.useState()[0],(an!==null?an.memoizedState:null)!==e&&(At.flags|=1024),r}function Od(){var e=gc!==0;return gc=0,e}function Dd(e,r,a){r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~a}function Md(e){if(mc){for(e=e.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}mc=!1}ys=0,Dn=an=At=null,wa=!1,Ol=gc=0,Sa=null}function lr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?At.memoizedState=Dn=e:Dn=Dn.next=e,Dn}function Rn(){if(an===null){var e=At.alternate;e=e!==null?e.memoizedState:null}else e=an.next;var r=Dn===null?At.memoizedState:Dn.next;if(r!==null)Dn=r,an=e;else{if(e===null)throw At.alternate===null?Error(l(467)):Error(l(310));an=e,e={memoizedState:an.memoizedState,baseState:an.baseState,baseQueue:an.baseQueue,queue:an.queue,next:null},Dn===null?At.memoizedState=Dn=e:Dn=Dn.next=e}return Dn}function yc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Dl(e){var r=Ol;return Ol+=1,Sa===null&&(Sa=[]),e=cm(Sa,e,r),r=At,(Dn===null?r.memoizedState:Dn.next)===null&&(r=r.alternate,E.H=r===null||r.memoizedState===null?eg:Vd),e}function vc(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Dl(e);if(e.$$typeof===M)return Wn(e)}throw Error(l(438,String(e)))}function zd(e){var r=null,a=At.updateQueue;if(a!==null&&(r=a.memoCache),r==null){var c=At.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(f){return f.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),a===null&&(a=yc(),At.updateQueue=a),a.memoCache=r,a=r.data[r.index],a===void 0)for(a=r.data[r.index]=Array(e),c=0;c<e;c++)a[c]=K;return r.index++,a}function vs(e,r){return typeof r=="function"?r(e):r}function xc(e){var r=Rn();return Ud(r,an,e)}function Ud(e,r,a){var c=e.queue;if(c===null)throw Error(l(311));c.lastRenderedReducer=a;var f=e.baseQueue,g=c.pending;if(g!==null){if(f!==null){var w=f.next;f.next=g.next,g.next=w}r.baseQueue=f=g,c.pending=null}if(g=e.baseState,f===null)e.memoizedState=g;else{r=f.next;var A=w=null,Q=null,de=r,we=!1;do{var Te=de.lane&-536870913;if(Te!==de.lane?(Pt&Te)===Te:(ys&Te)===Te){var fe=de.revertLane;if(fe===0)Q!==null&&(Q=Q.next={lane:0,revertLane:0,gesture:null,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null}),Te===ga&&(we=!0);else if((ys&fe)===fe){de=de.next,fe===ga&&(we=!0);continue}else Te={lane:0,revertLane:de.revertLane,gesture:null,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},Q===null?(A=Q=Te,w=g):Q=Q.next=Te,At.lanes|=fe,ni|=fe;Te=de.action,Oi&&a(g,Te),g=de.hasEagerState?de.eagerState:a(g,Te)}else fe={lane:Te,revertLane:de.revertLane,gesture:de.gesture,action:de.action,hasEagerState:de.hasEagerState,eagerState:de.eagerState,next:null},Q===null?(A=Q=fe,w=g):Q=Q.next=fe,At.lanes|=Te,ni|=Te;de=de.next}while(de!==null&&de!==r);if(Q===null?w=g:Q.next=A,!vr(g,e.memoizedState)&&(Mn=!0,we&&(a=ya,a!==null)))throw a;e.memoizedState=g,e.baseState=w,e.baseQueue=Q,c.lastRenderedState=g}return f===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function Ld(e){var r=Rn(),a=r.queue;if(a===null)throw Error(l(311));a.lastRenderedReducer=e;var c=a.dispatch,f=a.pending,g=r.memoizedState;if(f!==null){a.pending=null;var w=f=f.next;do g=e(g,w.action),w=w.next;while(w!==f);vr(g,r.memoizedState)||(Mn=!0),r.memoizedState=g,r.baseQueue===null&&(r.baseState=g),a.lastRenderedState=g}return[g,c]}function bm(e,r,a){var c=At,f=Rn(),g=Ht;if(g){if(a===void 0)throw Error(l(407));a=a()}else a=r();var w=!vr((an||f).memoizedState,a);if(w&&(f.memoizedState=a,Mn=!0),f=f.queue,$d(jm.bind(null,c,f,e),[e]),f.getSnapshot!==r||w||Dn!==null&&Dn.memoizedState.tag&1){if(c.flags|=2048,ja(9,{destroy:void 0},Sm.bind(null,c,f,a,r),null),un===null)throw Error(l(349));g||(ys&127)!==0||wm(c,r,a)}return a}function wm(e,r,a){e.flags|=16384,e={getSnapshot:r,value:a},r=At.updateQueue,r===null?(r=yc(),At.updateQueue=r,r.stores=[e]):(a=r.stores,a===null?r.stores=[e]:a.push(e))}function Sm(e,r,a,c){r.value=a,r.getSnapshot=c,_m(r)&&Cm(e)}function jm(e,r,a){return a(function(){_m(r)&&Cm(e)})}function _m(e){var r=e.getSnapshot;e=e.value;try{var a=r();return!vr(e,a)}catch{return!0}}function Cm(e){var r=ji(e,2);r!==null&&mr(r,e,2)}function Id(e){var r=lr();if(typeof e=="function"){var a=e;if(e=a(),Oi){rn(!0);try{a()}finally{rn(!1)}}}return r.memoizedState=r.baseState=e,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:e},r}function Nm(e,r,a,c){return e.baseState=a,Ud(e,an,typeof c=="function"?c:vs)}function Wb(e,r,a,c,f){if(Sc(e))throw Error(l(485));if(e=r.action,e!==null){var g={payload:f,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){g.listeners.push(w)}};E.T!==null?a(!0):g.isTransition=!1,c(g),a=r.pending,a===null?(g.next=r.pending=g,Em(r,g)):(g.next=a.next,r.pending=a.next=g)}}function Em(e,r){var a=r.action,c=r.payload,f=e.state;if(r.isTransition){var g=E.T,w={};E.T=w;try{var A=a(f,c),Q=E.S;Q!==null&&Q(w,A),Tm(e,r,A)}catch(de){Bd(e,r,de)}finally{g!==null&&w.types!==null&&(g.types=w.types),E.T=g}}else try{g=a(f,c),Tm(e,r,g)}catch(de){Bd(e,r,de)}}function Tm(e,r,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(c){Rm(e,r,c)},function(c){return Bd(e,r,c)}):Rm(e,r,a)}function Rm(e,r,a){r.status="fulfilled",r.value=a,km(r),e.state=a,r=e.pending,r!==null&&(a=r.next,a===r?e.pending=null:(a=a.next,r.next=a,Em(e,a)))}function Bd(e,r,a){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=a,km(r),r=r.next;while(r!==c)}e.action=null}function km(e){e=e.listeners;for(var r=0;r<e.length;r++)(0,e[r])()}function Am(e,r){return r}function Om(e,r){if(Ht){var a=un.formState;if(a!==null){e:{var c=At;if(Ht){if(mn){t:{for(var f=mn,g=Dr;f.nodeType!==8;){if(!g){f=null;break t}if(f=zr(f.nextSibling),f===null){f=null;break t}}g=f.data,f=g==="F!"||g==="F"?f:null}if(f){mn=zr(f.nextSibling),c=f.data==="F!";break e}}Ks(c)}c=!1}c&&(r=a[0])}}return a=lr(),a.memoizedState=a.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Am,lastRenderedState:r},a.queue=c,a=Jm.bind(null,At,c),c.dispatch=a,c=Id(!1),g=Gd.bind(null,At,!1,c.queue),c=lr(),f={state:r,dispatch:null,action:e,pending:null},c.queue=f,a=Wb.bind(null,At,f,g,a),f.dispatch=a,c.memoizedState=e,[r,a,!1]}function Dm(e){var r=Rn();return Mm(r,an,e)}function Mm(e,r,a){if(r=Ud(e,r,Am)[0],e=xc(vs)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=Dl(r)}catch(w){throw w===va?cc:w}else c=r;r=Rn();var f=r.queue,g=f.dispatch;return a!==r.memoizedState&&(At.flags|=2048,ja(9,{destroy:void 0},Jb.bind(null,f,a),null)),[c,g,e]}function Jb(e,r){e.action=r}function zm(e){var r=Rn(),a=an;if(a!==null)return Mm(r,a,e);Rn(),r=r.memoizedState,a=Rn();var c=a.queue.dispatch;return a.memoizedState=e,[r,c,!1]}function ja(e,r,a,c){return e={tag:e,create:a,deps:c,inst:r,next:null},r=At.updateQueue,r===null&&(r=yc(),At.updateQueue=r),a=r.lastEffect,a===null?r.lastEffect=e.next=e:(c=a.next,a.next=e,e.next=c,r.lastEffect=e),e}function Um(){return Rn().memoizedState}function bc(e,r,a,c){var f=lr();At.flags|=e,f.memoizedState=ja(1|r,{destroy:void 0},a,c===void 0?null:c)}function wc(e,r,a,c){var f=Rn();c=c===void 0?null:c;var g=f.memoizedState.inst;an!==null&&c!==null&&kd(c,an.memoizedState.deps)?f.memoizedState=ja(r,g,a,c):(At.flags|=e,f.memoizedState=ja(1|r,g,a,c))}function Lm(e,r){bc(8390656,8,e,r)}function $d(e,r){wc(2048,8,e,r)}function Xb(e){At.flags|=4;var r=At.updateQueue;if(r===null)r=yc(),At.updateQueue=r,r.events=[e];else{var a=r.events;a===null?r.events=[e]:a.push(e)}}function Im(e){var r=Rn().memoizedState;return Xb({ref:r,nextImpl:e}),function(){if((Wt&2)!==0)throw Error(l(440));return r.impl.apply(void 0,arguments)}}function Bm(e,r){return wc(4,2,e,r)}function $m(e,r){return wc(4,4,e,r)}function Pm(e,r){if(typeof r=="function"){e=e();var a=r(e);return function(){typeof a=="function"?a():r(null)}}if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function qm(e,r,a){a=a!=null?a.concat([e]):null,wc(4,4,Pm.bind(null,r,e),a)}function Pd(){}function Fm(e,r){var a=Rn();r=r===void 0?null:r;var c=a.memoizedState;return r!==null&&kd(r,c[1])?c[0]:(a.memoizedState=[e,r],e)}function Hm(e,r){var a=Rn();r=r===void 0?null:r;var c=a.memoizedState;if(r!==null&&kd(r,c[1]))return c[0];if(c=e(),Oi){rn(!0);try{e()}finally{rn(!1)}}return a.memoizedState=[c,r],c}function qd(e,r,a){return a===void 0||(ys&1073741824)!==0&&(Pt&261930)===0?e.memoizedState=r:(e.memoizedState=a,e=Gg(),At.lanes|=e,ni|=e,a)}function Gm(e,r,a,c){return vr(a,r)?a:ba.current!==null?(e=qd(e,a,c),vr(e,r)||(Mn=!0),e):(ys&42)===0||(ys&1073741824)!==0&&(Pt&261930)===0?(Mn=!0,e.memoizedState=a):(e=Gg(),At.lanes|=e,ni|=e,r)}function Vm(e,r,a,c,f){var g=L.p;L.p=g!==0&&8>g?g:8;var w=E.T,A={};E.T=A,Gd(e,!1,r,a);try{var Q=f(),de=E.S;if(de!==null&&de(A,Q),Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var we=Kb(Q,c);Ml(e,r,we,_r(e))}else Ml(e,r,c,_r(e))}catch(Te){Ml(e,r,{then:function(){},status:"rejected",reason:Te},_r())}finally{L.p=g,w!==null&&A.types!==null&&(w.types=A.types),E.T=w}}function Zb(){}function Fd(e,r,a,c){if(e.tag!==5)throw Error(l(476));var f=Km(e).queue;Vm(e,f,r,Y,a===null?Zb:function(){return Ym(e),a(c)})}function Km(e){var r=e.memoizedState;if(r!==null)return r;r={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:Y},next:null};var a={};return r.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:vs,lastRenderedState:a},next:null},e.memoizedState=r,e=e.alternate,e!==null&&(e.memoizedState=r),r}function Ym(e){var r=Km(e);r.next===null&&(r=e.alternate.memoizedState),Ml(e,r.next.queue,{},_r())}function Hd(){return Wn(Jl)}function Qm(){return Rn().memoizedState}function Wm(){return Rn().memoizedState}function ew(e){for(var r=e.return;r!==null;){switch(r.tag){case 24:case 3:var a=_r();e=Ws(a);var c=Js(r,e,a);c!==null&&(mr(c,r,a),Rl(c,r,a)),r={cache:xd()},e.payload=r;return}r=r.return}}function tw(e,r,a){var c=_r();a={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},Sc(e)?Xm(r,a):(a=od(e,r,a,c),a!==null&&(mr(a,e,c),Zm(a,r,c)))}function Jm(e,r,a){var c=_r();Ml(e,r,a,c)}function Ml(e,r,a,c){var f={lane:c,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(Sc(e))Xm(r,f);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=r.lastRenderedReducer,g!==null))try{var w=r.lastRenderedState,A=g(w,a);if(f.hasEagerState=!0,f.eagerState=A,vr(A,w))return nc(e,r,f,0),un===null&&tc(),!1}catch{}if(a=od(e,r,f,c),a!==null)return mr(a,e,c),Zm(a,r,c),!0}return!1}function Gd(e,r,a,c){if(c={lane:2,revertLane:jh(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Sc(e)){if(r)throw Error(l(479))}else r=od(e,a,c,2),r!==null&&mr(r,e,2)}function Sc(e){var r=e.alternate;return e===At||r!==null&&r===At}function Xm(e,r){wa=mc=!0;var a=e.pending;a===null?r.next=r:(r.next=a.next,a.next=r),e.pending=r}function Zm(e,r,a){if((a&4194048)!==0){var c=r.lanes;c&=e.pendingLanes,a|=c,r.lanes=a,Xt(e,a)}}var zl={readContext:Wn,use:vc,useCallback:Sn,useContext:Sn,useEffect:Sn,useImperativeHandle:Sn,useLayoutEffect:Sn,useInsertionEffect:Sn,useMemo:Sn,useReducer:Sn,useRef:Sn,useState:Sn,useDebugValue:Sn,useDeferredValue:Sn,useTransition:Sn,useSyncExternalStore:Sn,useId:Sn,useHostTransitionStatus:Sn,useFormState:Sn,useActionState:Sn,useOptimistic:Sn,useMemoCache:Sn,useCacheRefresh:Sn};zl.useEffectEvent=Sn;var eg={readContext:Wn,use:vc,useCallback:function(e,r){return lr().memoizedState=[e,r===void 0?null:r],e},useContext:Wn,useEffect:Lm,useImperativeHandle:function(e,r,a){a=a!=null?a.concat([e]):null,bc(4194308,4,Pm.bind(null,r,e),a)},useLayoutEffect:function(e,r){return bc(4194308,4,e,r)},useInsertionEffect:function(e,r){bc(4,2,e,r)},useMemo:function(e,r){var a=lr();r=r===void 0?null:r;var c=e();if(Oi){rn(!0);try{e()}finally{rn(!1)}}return a.memoizedState=[c,r],c},useReducer:function(e,r,a){var c=lr();if(a!==void 0){var f=a(r);if(Oi){rn(!0);try{a(r)}finally{rn(!1)}}}else f=r;return c.memoizedState=c.baseState=f,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:f},c.queue=e,e=e.dispatch=tw.bind(null,At,e),[c.memoizedState,e]},useRef:function(e){var r=lr();return e={current:e},r.memoizedState=e},useState:function(e){e=Id(e);var r=e.queue,a=Jm.bind(null,At,r);return r.dispatch=a,[e.memoizedState,a]},useDebugValue:Pd,useDeferredValue:function(e,r){var a=lr();return qd(a,e,r)},useTransition:function(){var e=Id(!1);return e=Vm.bind(null,At,e.queue,!0,!1),lr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,r,a){var c=At,f=lr();if(Ht){if(a===void 0)throw Error(l(407));a=a()}else{if(a=r(),un===null)throw Error(l(349));(Pt&127)!==0||wm(c,r,a)}f.memoizedState=a;var g={value:a,getSnapshot:r};return f.queue=g,Lm(jm.bind(null,c,g,e),[e]),c.flags|=2048,ja(9,{destroy:void 0},Sm.bind(null,c,g,a,r),null),a},useId:function(){var e=lr(),r=un.identifierPrefix;if(Ht){var a=ns,c=ts;a=(c&~(1<<32-cn(c)-1)).toString(32)+a,r="_"+r+"R_"+a,a=gc++,0<a&&(r+="H"+a.toString(32)),r+="_"}else a=Yb++,r="_"+r+"r_"+a.toString(32)+"_";return e.memoizedState=r},useHostTransitionStatus:Hd,useFormState:Om,useActionState:Om,useOptimistic:function(e){var r=lr();r.memoizedState=r.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=a,r=Gd.bind(null,At,!0,a),a.dispatch=r,[e,r]},useMemoCache:zd,useCacheRefresh:function(){return lr().memoizedState=ew.bind(null,At)},useEffectEvent:function(e){var r=lr(),a={impl:e};return r.memoizedState=a,function(){if((Wt&2)!==0)throw Error(l(440));return a.impl.apply(void 0,arguments)}}},Vd={readContext:Wn,use:vc,useCallback:Fm,useContext:Wn,useEffect:$d,useImperativeHandle:qm,useInsertionEffect:Bm,useLayoutEffect:$m,useMemo:Hm,useReducer:xc,useRef:Um,useState:function(){return xc(vs)},useDebugValue:Pd,useDeferredValue:function(e,r){var a=Rn();return Gm(a,an.memoizedState,e,r)},useTransition:function(){var e=xc(vs)[0],r=Rn().memoizedState;return[typeof e=="boolean"?e:Dl(e),r]},useSyncExternalStore:bm,useId:Qm,useHostTransitionStatus:Hd,useFormState:Dm,useActionState:Dm,useOptimistic:function(e,r){var a=Rn();return Nm(a,an,e,r)},useMemoCache:zd,useCacheRefresh:Wm};Vd.useEffectEvent=Im;var tg={readContext:Wn,use:vc,useCallback:Fm,useContext:Wn,useEffect:$d,useImperativeHandle:qm,useInsertionEffect:Bm,useLayoutEffect:$m,useMemo:Hm,useReducer:Ld,useRef:Um,useState:function(){return Ld(vs)},useDebugValue:Pd,useDeferredValue:function(e,r){var a=Rn();return an===null?qd(a,e,r):Gm(a,an.memoizedState,e,r)},useTransition:function(){var e=Ld(vs)[0],r=Rn().memoizedState;return[typeof e=="boolean"?e:Dl(e),r]},useSyncExternalStore:bm,useId:Qm,useHostTransitionStatus:Hd,useFormState:zm,useActionState:zm,useOptimistic:function(e,r){var a=Rn();return an!==null?Nm(a,an,e,r):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:zd,useCacheRefresh:Wm};tg.useEffectEvent=Im;function Kd(e,r,a,c){r=e.memoizedState,a=a(c,r),a=a==null?r:v({},r,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Yd={enqueueSetState:function(e,r,a){e=e._reactInternals;var c=_r(),f=Ws(c);f.payload=r,a!=null&&(f.callback=a),r=Js(e,f,c),r!==null&&(mr(r,e,c),Rl(r,e,c))},enqueueReplaceState:function(e,r,a){e=e._reactInternals;var c=_r(),f=Ws(c);f.tag=1,f.payload=r,a!=null&&(f.callback=a),r=Js(e,f,c),r!==null&&(mr(r,e,c),Rl(r,e,c))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var a=_r(),c=Ws(a);c.tag=2,r!=null&&(c.callback=r),r=Js(e,c,a),r!==null&&(mr(r,e,a),Rl(r,e,a))}};function ng(e,r,a,c,f,g,w){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,w):r.prototype&&r.prototype.isPureReactComponent?!wl(a,c)||!wl(f,g):!0}function rg(e,r,a,c){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,c),r.state!==e&&Yd.enqueueReplaceState(r,r.state,null)}function Di(e,r){var a=r;if("ref"in r){a={};for(var c in r)c!=="ref"&&(a[c]=r[c])}if(e=e.defaultProps){a===r&&(a=v({},a));for(var f in e)a[f]===void 0&&(a[f]=e[f])}return a}function sg(e){ec(e)}function ig(e){console.error(e)}function ag(e){ec(e)}function jc(e,r){try{var a=e.onUncaughtError;a(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function lg(e,r,a){try{var c=e.onCaughtError;c(a.value,{componentStack:a.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(f){setTimeout(function(){throw f})}}function Qd(e,r,a){return a=Ws(a),a.tag=3,a.payload={element:null},a.callback=function(){jc(e,r)},a}function og(e){return e=Ws(e),e.tag=3,e}function cg(e,r,a,c){var f=a.type.getDerivedStateFromError;if(typeof f=="function"){var g=c.value;e.payload=function(){return f(g)},e.callback=function(){lg(r,a,c)}}var w=a.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(e.callback=function(){lg(r,a,c),typeof f!="function"&&(ri===null?ri=new Set([this]):ri.add(this));var A=c.stack;this.componentDidCatch(c.value,{componentStack:A!==null?A:""})})}function nw(e,r,a,c,f){if(a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=a.alternate,r!==null&&ma(r,a,f,!0),a=br.current,a!==null){switch(a.tag){case 31:case 13:return Mr===null?zc():a.alternate===null&&jn===0&&(jn=3),a.flags&=-257,a.flags|=65536,a.lanes=f,c===uc?a.flags|=16384:(r=a.updateQueue,r===null?a.updateQueue=new Set([c]):r.add(c),bh(e,c,f)),!1;case 22:return a.flags|=65536,c===uc?a.flags|=16384:(r=a.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},a.updateQueue=r):(a=r.retryQueue,a===null?r.retryQueue=new Set([c]):a.add(c)),bh(e,c,f)),!1}throw Error(l(435,a.tag))}return bh(e,c,f),zc(),!1}if(Ht)return r=br.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=f,c!==pd&&(e=Error(l(422),{cause:c}),_l(kr(e,a)))):(c!==pd&&(r=Error(l(423),{cause:c}),_l(kr(r,a))),e=e.current.alternate,e.flags|=65536,f&=-f,e.lanes|=f,c=kr(c,a),f=Qd(e.stateNode,c,f),Cd(e,f),jn!==4&&(jn=2)),!1;var g=Error(l(520),{cause:c});if(g=kr(g,a),Fl===null?Fl=[g]:Fl.push(g),jn!==4&&(jn=2),r===null)return!0;c=kr(c,a),a=r;do{switch(a.tag){case 3:return a.flags|=65536,e=f&-f,a.lanes|=e,e=Qd(a.stateNode,c,e),Cd(a,e),!1;case 1:if(r=a.type,g=a.stateNode,(a.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ri===null||!ri.has(g))))return a.flags|=65536,f&=-f,a.lanes|=f,f=og(f),cg(f,e,a,c),Cd(a,f),!1}a=a.return}while(a!==null);return!1}var Wd=Error(l(461)),Mn=!1;function Jn(e,r,a,c){r.child=e===null?fm(r,null,a,c):Ai(r,e.child,a,c)}function ug(e,r,a,c,f){a=a.render;var g=r.ref;if("ref"in c){var w={};for(var A in c)A!=="ref"&&(w[A]=c[A])}else w=c;return Ei(r),c=Ad(e,r,a,w,g,f),A=Od(),e!==null&&!Mn?(Dd(e,r,f),xs(e,r,f)):(Ht&&A&&hd(r),r.flags|=1,Jn(e,r,c,f),r.child)}function dg(e,r,a,c,f){if(e===null){var g=a.type;return typeof g=="function"&&!cd(g)&&g.defaultProps===void 0&&a.compare===null?(r.tag=15,r.type=g,hg(e,r,g,c,f)):(e=sc(a.type,null,c,r,r.mode,f),e.ref=r.ref,e.return=r,r.child=e)}if(g=e.child,!sh(e,f)){var w=g.memoizedProps;if(a=a.compare,a=a!==null?a:wl,a(w,c)&&e.ref===r.ref)return xs(e,r,f)}return r.flags|=1,e=fs(g,c),e.ref=r.ref,e.return=r,r.child=e}function hg(e,r,a,c,f){if(e!==null){var g=e.memoizedProps;if(wl(g,c)&&e.ref===r.ref)if(Mn=!1,r.pendingProps=c=g,sh(e,f))(e.flags&131072)!==0&&(Mn=!0);else return r.lanes=e.lanes,xs(e,r,f)}return Jd(e,r,a,c,f)}function fg(e,r,a,c){var f=c.children,g=e!==null?e.memoizedState:null;if(e===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((r.flags&128)!==0){if(g=g!==null?g.baseLanes|a:a,e!==null){for(c=r.child=e.child,f=0;c!==null;)f=f|c.lanes|c.childLanes,c=c.sibling;c=f&~g}else c=0,r.child=null;return pg(e,r,g,a,c)}if((a&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},e!==null&&oc(r,g!==null?g.cachePool:null),g!==null?gm(r,g):Ed(),ym(r);else return c=r.lanes=536870912,pg(e,r,g!==null?g.baseLanes|a:a,a,c)}else g!==null?(oc(r,g.cachePool),gm(r,g),Zs(),r.memoizedState=null):(e!==null&&oc(r,null),Ed(),Zs());return Jn(e,r,f,a),r.child}function Ul(e,r){return e!==null&&e.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function pg(e,r,a,c,f){var g=wd();return g=g===null?null:{parent:On._currentValue,pool:g},r.memoizedState={baseLanes:a,cachePool:g},e!==null&&oc(r,null),Ed(),ym(r),e!==null&&ma(e,r,c,!0),r.childLanes=f,null}function _c(e,r){return r=Nc({mode:r.mode,children:r.children},e.mode),r.ref=e.ref,e.child=r,r.return=e,r}function mg(e,r,a){return Ai(r,e.child,null,a),e=_c(r,r.pendingProps),e.flags|=2,wr(r),r.memoizedState=null,e}function rw(e,r,a){var c=r.pendingProps,f=(r.flags&128)!==0;if(r.flags&=-129,e===null){if(Ht){if(c.mode==="hidden")return e=_c(r,c),r.lanes=536870912,Ul(null,e);if(Rd(r),(e=mn)?(e=Ey(e,Dr),e=e!==null&&e.data==="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Gs!==null?{id:ts,overflow:ns}:null,retryLane:536870912,hydrationErrors:null},a=Xp(e),a.return=r,r.child=a,Qn=r,mn=null)):e=null,e===null)throw Ks(r);return r.lanes=536870912,null}return _c(r,c)}var g=e.memoizedState;if(g!==null){var w=g.dehydrated;if(Rd(r),f)if(r.flags&256)r.flags&=-257,r=mg(e,r,a);else if(r.memoizedState!==null)r.child=e.child,r.flags|=128,r=null;else throw Error(l(558));else if(Mn||ma(e,r,a,!1),f=(a&e.childLanes)!==0,Mn||f){if(c=un,c!==null&&(w=Qt(c,a),w!==0&&w!==g.retryLane))throw g.retryLane=w,ji(e,w),mr(c,e,w),Wd;zc(),r=mg(e,r,a)}else e=g.treeContext,mn=zr(w.nextSibling),Qn=r,Ht=!0,Vs=null,Dr=!1,e!==null&&tm(r,e),r=_c(r,c),r.flags|=4096;return r}return e=fs(e.child,{mode:c.mode,children:c.children}),e.ref=r.ref,r.child=e,e.return=r,e}function Cc(e,r){var a=r.ref;if(a===null)e!==null&&e.ref!==null&&(r.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(l(284));(e===null||e.ref!==a)&&(r.flags|=4194816)}}function Jd(e,r,a,c,f){return Ei(r),a=Ad(e,r,a,c,void 0,f),c=Od(),e!==null&&!Mn?(Dd(e,r,f),xs(e,r,f)):(Ht&&c&&hd(r),r.flags|=1,Jn(e,r,a,f),r.child)}function gg(e,r,a,c,f,g){return Ei(r),r.updateQueue=null,a=xm(r,c,a,f),vm(e),c=Od(),e!==null&&!Mn?(Dd(e,r,g),xs(e,r,g)):(Ht&&c&&hd(r),r.flags|=1,Jn(e,r,a,g),r.child)}function yg(e,r,a,c,f){if(Ei(r),r.stateNode===null){var g=da,w=a.contextType;typeof w=="object"&&w!==null&&(g=Wn(w)),g=new a(c,g),r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=Yd,r.stateNode=g,g._reactInternals=r,g=r.stateNode,g.props=c,g.state=r.memoizedState,g.refs={},jd(r),w=a.contextType,g.context=typeof w=="object"&&w!==null?Wn(w):da,g.state=r.memoizedState,w=a.getDerivedStateFromProps,typeof w=="function"&&(Kd(r,a,w,c),g.state=r.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(w=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),w!==g.state&&Yd.enqueueReplaceState(g,g.state,null),Al(r,c,g,f),kl(),g.state=r.memoizedState),typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(e===null){g=r.stateNode;var A=r.memoizedProps,Q=Di(a,A);g.props=Q;var de=g.context,we=a.contextType;w=da,typeof we=="object"&&we!==null&&(w=Wn(we));var Te=a.getDerivedStateFromProps;we=typeof Te=="function"||typeof g.getSnapshotBeforeUpdate=="function",A=r.pendingProps!==A,we||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(A||de!==w)&&rg(r,g,c,w),Qs=!1;var fe=r.memoizedState;g.state=fe,Al(r,c,g,f),kl(),de=r.memoizedState,A||fe!==de||Qs?(typeof Te=="function"&&(Kd(r,a,Te,c),de=r.memoizedState),(Q=Qs||ng(r,a,Q,c,fe,de,w))?(we||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=de),g.props=c,g.state=de,g.context=w,c=Q):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{g=r.stateNode,_d(e,r),w=r.memoizedProps,we=Di(a,w),g.props=we,Te=r.pendingProps,fe=g.context,de=a.contextType,Q=da,typeof de=="object"&&de!==null&&(Q=Wn(de)),A=a.getDerivedStateFromProps,(de=typeof A=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(w!==Te||fe!==Q)&&rg(r,g,c,Q),Qs=!1,fe=r.memoizedState,g.state=fe,Al(r,c,g,f),kl();var ve=r.memoizedState;w!==Te||fe!==ve||Qs||e!==null&&e.dependencies!==null&&ac(e.dependencies)?(typeof A=="function"&&(Kd(r,a,A,c),ve=r.memoizedState),(we=Qs||ng(r,a,we,c,fe,ve,Q)||e!==null&&e.dependencies!==null&&ac(e.dependencies))?(de||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,ve,Q),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,ve,Q)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||w===e.memoizedProps&&fe===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||w===e.memoizedProps&&fe===e.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=ve),g.props=c,g.state=ve,g.context=Q,c=we):(typeof g.componentDidUpdate!="function"||w===e.memoizedProps&&fe===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||w===e.memoizedProps&&fe===e.memoizedState||(r.flags|=1024),c=!1)}return g=c,Cc(e,r),c=(r.flags&128)!==0,g||c?(g=r.stateNode,a=c&&typeof a.getDerivedStateFromError!="function"?null:g.render(),r.flags|=1,e!==null&&c?(r.child=Ai(r,e.child,null,f),r.child=Ai(r,null,a,f)):Jn(e,r,a,f),r.memoizedState=g.state,e=r.child):e=xs(e,r,f),e}function vg(e,r,a,c){return Ci(),r.flags|=256,Jn(e,r,a,c),r.child}var Xd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zd(e){return{baseLanes:e,cachePool:lm()}}function eh(e,r,a){return e=e!==null?e.childLanes&~a:0,r&&(e|=jr),e}function xg(e,r,a){var c=r.pendingProps,f=!1,g=(r.flags&128)!==0,w;if((w=g)||(w=e!==null&&e.memoizedState===null?!1:(Tn.current&2)!==0),w&&(f=!0,r.flags&=-129),w=(r.flags&32)!==0,r.flags&=-33,e===null){if(Ht){if(f?Xs(r):Zs(),(e=mn)?(e=Ey(e,Dr),e=e!==null&&e.data!=="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:Gs!==null?{id:ts,overflow:ns}:null,retryLane:536870912,hydrationErrors:null},a=Xp(e),a.return=r,r.child=a,Qn=r,mn=null)):e=null,e===null)throw Ks(r);return Uh(e)?r.lanes=32:r.lanes=536870912,null}var A=c.children;return c=c.fallback,f?(Zs(),f=r.mode,A=Nc({mode:"hidden",children:A},f),c=_i(c,f,a,null),A.return=r,c.return=r,A.sibling=c,r.child=A,c=r.child,c.memoizedState=Zd(a),c.childLanes=eh(e,w,a),r.memoizedState=Xd,Ul(null,c)):(Xs(r),th(r,A))}var Q=e.memoizedState;if(Q!==null&&(A=Q.dehydrated,A!==null)){if(g)r.flags&256?(Xs(r),r.flags&=-257,r=nh(e,r,a)):r.memoizedState!==null?(Zs(),r.child=e.child,r.flags|=128,r=null):(Zs(),A=c.fallback,f=r.mode,c=Nc({mode:"visible",children:c.children},f),A=_i(A,f,a,null),A.flags|=2,c.return=r,A.return=r,c.sibling=A,r.child=c,Ai(r,e.child,null,a),c=r.child,c.memoizedState=Zd(a),c.childLanes=eh(e,w,a),r.memoizedState=Xd,r=Ul(null,c));else if(Xs(r),Uh(A)){if(w=A.nextSibling&&A.nextSibling.dataset,w)var de=w.dgst;w=de,c=Error(l(419)),c.stack="",c.digest=w,_l({value:c,source:null,stack:null}),r=nh(e,r,a)}else if(Mn||ma(e,r,a,!1),w=(a&e.childLanes)!==0,Mn||w){if(w=un,w!==null&&(c=Qt(w,a),c!==0&&c!==Q.retryLane))throw Q.retryLane=c,ji(e,c),mr(w,e,c),Wd;zh(A)||zc(),r=nh(e,r,a)}else zh(A)?(r.flags|=192,r.child=e.child,r=null):(e=Q.treeContext,mn=zr(A.nextSibling),Qn=r,Ht=!0,Vs=null,Dr=!1,e!==null&&tm(r,e),r=th(r,c.children),r.flags|=4096);return r}return f?(Zs(),A=c.fallback,f=r.mode,Q=e.child,de=Q.sibling,c=fs(Q,{mode:"hidden",children:c.children}),c.subtreeFlags=Q.subtreeFlags&65011712,de!==null?A=fs(de,A):(A=_i(A,f,a,null),A.flags|=2),A.return=r,c.return=r,c.sibling=A,r.child=c,Ul(null,c),c=r.child,A=e.child.memoizedState,A===null?A=Zd(a):(f=A.cachePool,f!==null?(Q=On._currentValue,f=f.parent!==Q?{parent:Q,pool:Q}:f):f=lm(),A={baseLanes:A.baseLanes|a,cachePool:f}),c.memoizedState=A,c.childLanes=eh(e,w,a),r.memoizedState=Xd,Ul(e.child,c)):(Xs(r),a=e.child,e=a.sibling,a=fs(a,{mode:"visible",children:c.children}),a.return=r,a.sibling=null,e!==null&&(w=r.deletions,w===null?(r.deletions=[e],r.flags|=16):w.push(e)),r.child=a,r.memoizedState=null,a)}function th(e,r){return r=Nc({mode:"visible",children:r},e.mode),r.return=e,e.child=r}function Nc(e,r){return e=xr(22,e,null,r),e.lanes=0,e}function nh(e,r,a){return Ai(r,e.child,null,a),e=th(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function bg(e,r,a){e.lanes|=r;var c=e.alternate;c!==null&&(c.lanes|=r),yd(e.return,r,a)}function rh(e,r,a,c,f,g){var w=e.memoizedState;w===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:a,tailMode:f,treeForkCount:g}:(w.isBackwards=r,w.rendering=null,w.renderingStartTime=0,w.last=c,w.tail=a,w.tailMode=f,w.treeForkCount=g)}function wg(e,r,a){var c=r.pendingProps,f=c.revealOrder,g=c.tail;c=c.children;var w=Tn.current,A=(w&2)!==0;if(A?(w=w&1|2,r.flags|=128):w&=1,Z(Tn,w),Jn(e,r,c,a),c=Ht?jl:0,!A&&e!==null&&(e.flags&128)!==0)e:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&bg(e,a,r);else if(e.tag===19)bg(e,a,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break e;for(;e.sibling===null;){if(e.return===null||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(f){case"forwards":for(a=r.child,f=null;a!==null;)e=a.alternate,e!==null&&pc(e)===null&&(f=a),a=a.sibling;a=f,a===null?(f=r.child,r.child=null):(f=a.sibling,a.sibling=null),rh(r,!1,f,a,g,c);break;case"backwards":case"unstable_legacy-backwards":for(a=null,f=r.child,r.child=null;f!==null;){if(e=f.alternate,e!==null&&pc(e)===null){r.child=f;break}e=f.sibling,f.sibling=a,a=f,f=e}rh(r,!0,a,null,g,c);break;case"together":rh(r,!1,null,null,void 0,c);break;default:r.memoizedState=null}return r.child}function xs(e,r,a){if(e!==null&&(r.dependencies=e.dependencies),ni|=r.lanes,(a&r.childLanes)===0)if(e!==null){if(ma(e,r,a,!1),(a&r.childLanes)===0)return null}else return null;if(e!==null&&r.child!==e.child)throw Error(l(153));if(r.child!==null){for(e=r.child,a=fs(e,e.pendingProps),r.child=a,a.return=r;e.sibling!==null;)e=e.sibling,a=a.sibling=fs(e,e.pendingProps),a.return=r;a.sibling=null}return r.child}function sh(e,r){return(e.lanes&r)!==0?!0:(e=e.dependencies,!!(e!==null&&ac(e)))}function sw(e,r,a){switch(r.tag){case 3:O(r,r.stateNode.containerInfo),Ys(r,On,e.memoizedState.cache),Ci();break;case 27:case 5:ce(r);break;case 4:O(r,r.stateNode.containerInfo);break;case 10:Ys(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Rd(r),null;break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(Xs(r),r.flags|=128,null):(a&r.child.childLanes)!==0?xg(e,r,a):(Xs(r),e=xs(e,r,a),e!==null?e.sibling:null);Xs(r);break;case 19:var f=(e.flags&128)!==0;if(c=(a&r.childLanes)!==0,c||(ma(e,r,a,!1),c=(a&r.childLanes)!==0),f){if(c)return wg(e,r,a);r.flags|=128}if(f=r.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),Z(Tn,Tn.current),c)break;return null;case 22:return r.lanes=0,fg(e,r,a,r.pendingProps);case 24:Ys(r,On,e.memoizedState.cache)}return xs(e,r,a)}function Sg(e,r,a){if(e!==null)if(e.memoizedProps!==r.pendingProps)Mn=!0;else{if(!sh(e,a)&&(r.flags&128)===0)return Mn=!1,sw(e,r,a);Mn=(e.flags&131072)!==0}else Mn=!1,Ht&&(r.flags&1048576)!==0&&em(r,jl,r.index);switch(r.lanes=0,r.tag){case 16:e:{var c=r.pendingProps;if(e=Ri(r.elementType),r.type=e,typeof e=="function")cd(e)?(c=Di(e,c),r.tag=1,r=yg(null,r,e,c,a)):(r.tag=0,r=Jd(null,r,e,c,a));else{if(e!=null){var f=e.$$typeof;if(f===$){r.tag=11,r=ug(null,r,e,c,a);break e}else if(f===z){r.tag=14,r=dg(null,r,e,c,a);break e}}throw r=P(e)||e,Error(l(306,r,""))}}return r;case 0:return Jd(e,r,r.type,r.pendingProps,a);case 1:return c=r.type,f=Di(c,r.pendingProps),yg(e,r,c,f,a);case 3:e:{if(O(r,r.stateNode.containerInfo),e===null)throw Error(l(387));c=r.pendingProps;var g=r.memoizedState;f=g.element,_d(e,r),Al(r,c,null,a);var w=r.memoizedState;if(c=w.cache,Ys(r,On,c),c!==g.cache&&vd(r,[On],a,!0),kl(),c=w.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:w.cache},r.updateQueue.baseState=g,r.memoizedState=g,r.flags&256){r=vg(e,r,c,a);break e}else if(c!==f){f=kr(Error(l(424)),r),_l(f),r=vg(e,r,c,a);break e}else for(e=r.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,mn=zr(e.firstChild),Qn=r,Ht=!0,Vs=null,Dr=!0,a=fm(r,null,c,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Ci(),c===f){r=xs(e,r,a);break e}Jn(e,r,c,a)}r=r.child}return r;case 26:return Cc(e,r),e===null?(a=Dy(r.type,null,r.pendingProps,null))?r.memoizedState=a:Ht||(a=r.type,e=r.pendingProps,c=qc(xe.current).createElement(a),c[Je]=r,c[Ke]=e,Xn(c,a,e),Nt(c),r.stateNode=c):r.memoizedState=Dy(r.type,e.memoizedProps,r.pendingProps,e.memoizedState),null;case 27:return ce(r),e===null&&Ht&&(c=r.stateNode=ky(r.type,r.pendingProps,xe.current),Qn=r,Dr=!0,f=mn,li(r.type)?(Lh=f,mn=zr(c.firstChild)):mn=f),Jn(e,r,r.pendingProps.children,a),Cc(e,r),e===null&&(r.flags|=4194304),r.child;case 5:return e===null&&Ht&&((f=c=mn)&&(c=Mw(c,r.type,r.pendingProps,Dr),c!==null?(r.stateNode=c,Qn=r,mn=zr(c.firstChild),Dr=!1,f=!0):f=!1),f||Ks(r)),ce(r),f=r.type,g=r.pendingProps,w=e!==null?e.memoizedProps:null,c=g.children,Oh(f,g)?c=null:w!==null&&Oh(f,w)&&(r.flags|=32),r.memoizedState!==null&&(f=Ad(e,r,Qb,null,null,a),Jl._currentValue=f),Cc(e,r),Jn(e,r,c,a),r.child;case 6:return e===null&&Ht&&((e=a=mn)&&(a=zw(a,r.pendingProps,Dr),a!==null?(r.stateNode=a,Qn=r,mn=null,e=!0):e=!1),e||Ks(r)),null;case 13:return xg(e,r,a);case 4:return O(r,r.stateNode.containerInfo),c=r.pendingProps,e===null?r.child=Ai(r,null,c,a):Jn(e,r,c,a),r.child;case 11:return ug(e,r,r.type,r.pendingProps,a);case 7:return Jn(e,r,r.pendingProps,a),r.child;case 8:return Jn(e,r,r.pendingProps.children,a),r.child;case 12:return Jn(e,r,r.pendingProps.children,a),r.child;case 10:return c=r.pendingProps,Ys(r,r.type,c.value),Jn(e,r,c.children,a),r.child;case 9:return f=r.type._context,c=r.pendingProps.children,Ei(r),f=Wn(f),c=c(f),r.flags|=1,Jn(e,r,c,a),r.child;case 14:return dg(e,r,r.type,r.pendingProps,a);case 15:return hg(e,r,r.type,r.pendingProps,a);case 19:return wg(e,r,a);case 31:return rw(e,r,a);case 22:return fg(e,r,a,r.pendingProps);case 24:return Ei(r),c=Wn(On),e===null?(f=wd(),f===null&&(f=un,g=xd(),f.pooledCache=g,g.refCount++,g!==null&&(f.pooledCacheLanes|=a),f=g),r.memoizedState={parent:c,cache:f},jd(r),Ys(r,On,f)):((e.lanes&a)!==0&&(_d(e,r),Al(r,null,null,a),kl()),f=e.memoizedState,g=r.memoizedState,f.parent!==c?(f={parent:c,cache:c},r.memoizedState=f,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=f),Ys(r,On,c)):(c=g.cache,Ys(r,On,c),c!==f.cache&&vd(r,[On],a,!0))),Jn(e,r,r.pendingProps.children,a),r.child;case 29:throw r.pendingProps}throw Error(l(156,r.tag))}function bs(e){e.flags|=4}function ih(e,r,a,c,f){if((r=(e.mode&32)!==0)&&(r=!1),r){if(e.flags|=16777216,(f&335544128)===f)if(e.stateNode.complete)e.flags|=8192;else if(Qg())e.flags|=8192;else throw ki=uc,Sd}else e.flags&=-16777217}function jg(e,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Iy(r))if(Qg())e.flags|=8192;else throw ki=uc,Sd}function Ec(e,r){r!==null&&(e.flags|=4),e.flags&16384&&(r=e.tag!==22?kt():536870912,e.lanes|=r,Ea|=r)}function Ll(e,r){if(!Ht)switch(e.tailMode){case"hidden":r=e.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function gn(e){var r=e.alternate!==null&&e.alternate.child===e.child,a=0,c=0;if(r)for(var f=e.child;f!==null;)a|=f.lanes|f.childLanes,c|=f.subtreeFlags&65011712,c|=f.flags&65011712,f.return=e,f=f.sibling;else for(f=e.child;f!==null;)a|=f.lanes|f.childLanes,c|=f.subtreeFlags,c|=f.flags,f.return=e,f=f.sibling;return e.subtreeFlags|=c,e.childLanes=a,r}function iw(e,r,a){var c=r.pendingProps;switch(fd(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gn(r),null;case 1:return gn(r),null;case 3:return a=r.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),gs(On),J(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(pa(r)?bs(r):e===null||e.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,md())),gn(r),null;case 26:var f=r.type,g=r.memoizedState;return e===null?(bs(r),g!==null?(gn(r),jg(r,g)):(gn(r),ih(r,f,null,c,a))):g?g!==e.memoizedState?(bs(r),gn(r),jg(r,g)):(gn(r),r.flags&=-16777217):(e=e.memoizedProps,e!==c&&bs(r),gn(r),ih(r,f,e,c,a)),null;case 27:if(Se(r),a=xe.current,f=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(!c){if(r.stateNode===null)throw Error(l(166));return gn(r),null}e=ye.current,pa(r)?nm(r):(e=ky(f,c,a),r.stateNode=e,bs(r))}return gn(r),null;case 5:if(Se(r),f=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(!c){if(r.stateNode===null)throw Error(l(166));return gn(r),null}if(g=ye.current,pa(r))nm(r);else{var w=qc(xe.current);switch(g){case 1:g=w.createElementNS("http://www.w3.org/2000/svg",f);break;case 2:g=w.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;default:switch(f){case"svg":g=w.createElementNS("http://www.w3.org/2000/svg",f);break;case"math":g=w.createElementNS("http://www.w3.org/1998/Math/MathML",f);break;case"script":g=w.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof c.is=="string"?w.createElement("select",{is:c.is}):w.createElement("select"),c.multiple?g.multiple=!0:c.size&&(g.size=c.size);break;default:g=typeof c.is=="string"?w.createElement(f,{is:c.is}):w.createElement(f)}}g[Je]=r,g[Ke]=c;e:for(w=r.child;w!==null;){if(w.tag===5||w.tag===6)g.appendChild(w.stateNode);else if(w.tag!==4&&w.tag!==27&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===r)break e;for(;w.sibling===null;){if(w.return===null||w.return===r)break e;w=w.return}w.sibling.return=w.return,w=w.sibling}r.stateNode=g;e:switch(Xn(g,f,c),f){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&bs(r)}}return gn(r),ih(r,r.type,e===null?null:e.memoizedProps,r.pendingProps,a),null;case 6:if(e&&r.stateNode!=null)e.memoizedProps!==c&&bs(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(l(166));if(e=xe.current,pa(r)){if(e=r.stateNode,a=r.memoizedProps,c=null,f=Qn,f!==null)switch(f.tag){case 27:case 5:c=f.memoizedProps}e[Je]=r,e=!!(e.nodeValue===a||c!==null&&c.suppressHydrationWarning===!0||xy(e.nodeValue,a)),e||Ks(r,!0)}else e=qc(e).createTextNode(c),e[Je]=r,r.stateNode=e}return gn(r),null;case 31:if(a=r.memoizedState,e===null||e.memoizedState!==null){if(c=pa(r),a!==null){if(e===null){if(!c)throw Error(l(318));if(e=r.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(l(557));e[Je]=r}else Ci(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;gn(r),e=!1}else a=md(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return r.flags&256?(wr(r),r):(wr(r),null);if((r.flags&128)!==0)throw Error(l(558))}return gn(r),null;case 13:if(c=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(f=pa(r),c!==null&&c.dehydrated!==null){if(e===null){if(!f)throw Error(l(318));if(f=r.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(l(317));f[Je]=r}else Ci(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;gn(r),f=!1}else f=md(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=f),f=!0;if(!f)return r.flags&256?(wr(r),r):(wr(r),null)}return wr(r),(r.flags&128)!==0?(r.lanes=a,r):(a=c!==null,e=e!==null&&e.memoizedState!==null,a&&(c=r.child,f=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(f=c.alternate.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==f&&(c.flags|=2048)),a!==e&&a&&(r.child.flags|=8192),Ec(r,r.updateQueue),gn(r),null);case 4:return J(),e===null&&Eh(r.stateNode.containerInfo),gn(r),null;case 10:return gs(r.type),gn(r),null;case 19:if(W(Tn),c=r.memoizedState,c===null)return gn(r),null;if(f=(r.flags&128)!==0,g=c.rendering,g===null)if(f)Ll(c,!1);else{if(jn!==0||e!==null&&(e.flags&128)!==0)for(e=r.child;e!==null;){if(g=pc(e),g!==null){for(r.flags|=128,Ll(c,!1),e=g.updateQueue,r.updateQueue=e,Ec(r,e),r.subtreeFlags=0,e=a,a=r.child;a!==null;)Jp(a,e),a=a.sibling;return Z(Tn,Tn.current&1|2),Ht&&ps(r,c.treeForkCount),r.child}e=e.sibling}c.tail!==null&&wt()>Oc&&(r.flags|=128,f=!0,Ll(c,!1),r.lanes=4194304)}else{if(!f)if(e=pc(g),e!==null){if(r.flags|=128,f=!0,e=e.updateQueue,r.updateQueue=e,Ec(r,e),Ll(c,!0),c.tail===null&&c.tailMode==="hidden"&&!g.alternate&&!Ht)return gn(r),null}else 2*wt()-c.renderingStartTime>Oc&&a!==536870912&&(r.flags|=128,f=!0,Ll(c,!1),r.lanes=4194304);c.isBackwards?(g.sibling=r.child,r.child=g):(e=c.last,e!==null?e.sibling=g:r.child=g,c.last=g)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=wt(),e.sibling=null,a=Tn.current,Z(Tn,f?a&1|2:a&1),Ht&&ps(r,c.treeForkCount),e):(gn(r),null);case 22:case 23:return wr(r),Td(),c=r.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(a&536870912)!==0&&(r.flags&128)===0&&(gn(r),r.subtreeFlags&6&&(r.flags|=8192)):gn(r),a=r.updateQueue,a!==null&&Ec(r,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==a&&(r.flags|=2048),e!==null&&W(Ti),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),r.memoizedState.cache!==a&&(r.flags|=2048),gs(On),gn(r),null;case 25:return null;case 30:return null}throw Error(l(156,r.tag))}function aw(e,r){switch(fd(r),r.tag){case 1:return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return gs(On),J(),e=r.flags,(e&65536)!==0&&(e&128)===0?(r.flags=e&-65537|128,r):null;case 26:case 27:case 5:return Se(r),null;case 31:if(r.memoizedState!==null){if(wr(r),r.alternate===null)throw Error(l(340));Ci()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 13:if(wr(r),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(l(340));Ci()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return W(Tn),null;case 4:return J(),null;case 10:return gs(r.type),null;case 22:case 23:return wr(r),Td(),e!==null&&W(Ti),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 24:return gs(On),null;case 25:return null;default:return null}}function _g(e,r){switch(fd(r),r.tag){case 3:gs(On),J();break;case 26:case 27:case 5:Se(r);break;case 4:J();break;case 31:r.memoizedState!==null&&wr(r);break;case 13:wr(r);break;case 19:W(Tn);break;case 10:gs(r.type);break;case 22:case 23:wr(r),Td(),e!==null&&W(Ti);break;case 24:gs(On)}}function Il(e,r){try{var a=r.updateQueue,c=a!==null?a.lastEffect:null;if(c!==null){var f=c.next;a=f;do{if((a.tag&e)===e){c=void 0;var g=a.create,w=a.inst;c=g(),w.destroy=c}a=a.next}while(a!==f)}}catch(A){en(r,r.return,A)}}function ei(e,r,a){try{var c=r.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var g=f.next;c=g;do{if((c.tag&e)===e){var w=c.inst,A=w.destroy;if(A!==void 0){w.destroy=void 0,f=r;var Q=a,de=A;try{de()}catch(we){en(f,Q,we)}}}c=c.next}while(c!==g)}}catch(we){en(r,r.return,we)}}function Cg(e){var r=e.updateQueue;if(r!==null){var a=e.stateNode;try{mm(r,a)}catch(c){en(e,e.return,c)}}}function Ng(e,r,a){a.props=Di(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(c){en(e,r,c)}}function Bl(e,r){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof a=="function"?e.refCleanup=a(c):a.current=c}}catch(f){en(e,r,f)}}function rs(e,r){var a=e.ref,c=e.refCleanup;if(a!==null)if(typeof c=="function")try{c()}catch(f){en(e,r,f)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(f){en(e,r,f)}else a.current=null}function Eg(e){var r=e.type,a=e.memoizedProps,c=e.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":a.autoFocus&&c.focus();break e;case"img":a.src?c.src=a.src:a.srcSet&&(c.srcset=a.srcSet)}}catch(f){en(e,e.return,f)}}function ah(e,r,a){try{var c=e.stateNode;Tw(c,e.type,a,r),c[Ke]=r}catch(f){en(e,e.return,f)}}function Tg(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&li(e.type)||e.tag===4}function lh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Tg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&li(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function oh(e,r,a){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,r):(r=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,r.appendChild(e),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=Fr));else if(c!==4&&(c===27&&li(e.type)&&(a=e.stateNode,r=null),e=e.child,e!==null))for(oh(e,r,a),e=e.sibling;e!==null;)oh(e,r,a),e=e.sibling}function Tc(e,r,a){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?a.insertBefore(e,r):a.appendChild(e);else if(c!==4&&(c===27&&li(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Tc(e,r,a),e=e.sibling;e!==null;)Tc(e,r,a),e=e.sibling}function Rg(e){var r=e.stateNode,a=e.memoizedProps;try{for(var c=e.type,f=r.attributes;f.length;)r.removeAttributeNode(f[0]);Xn(r,c,a),r[Je]=e,r[Ke]=a}catch(g){en(e,e.return,g)}}var ws=!1,zn=!1,ch=!1,kg=typeof WeakSet=="function"?WeakSet:Set,Fn=null;function lw(e,r){if(e=e.containerInfo,kh=Qc,e=qp(e),nd(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var c=a.getSelection&&a.getSelection();if(c&&c.rangeCount!==0){a=c.anchorNode;var f=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{a.nodeType,g.nodeType}catch{a=null;break e}var w=0,A=-1,Q=-1,de=0,we=0,Te=e,fe=null;t:for(;;){for(var ve;Te!==a||f!==0&&Te.nodeType!==3||(A=w+f),Te!==g||c!==0&&Te.nodeType!==3||(Q=w+c),Te.nodeType===3&&(w+=Te.nodeValue.length),(ve=Te.firstChild)!==null;)fe=Te,Te=ve;for(;;){if(Te===e)break t;if(fe===a&&++de===f&&(A=w),fe===g&&++we===c&&(Q=w),(ve=Te.nextSibling)!==null)break;Te=fe,fe=Te.parentNode}Te=ve}a=A===-1||Q===-1?null:{start:A,end:Q}}else a=null}a=a||{start:0,end:0}}else a=null;for(Ah={focusedElem:e,selectionRange:a},Qc=!1,Fn=r;Fn!==null;)if(r=Fn,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,Fn=e;else for(;Fn!==null;){switch(r=Fn,g=r.alternate,e=r.flags,r.tag){case 0:if((e&4)!==0&&(e=r.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)f=e[a],f.ref.impl=f.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,a=r,f=g.memoizedProps,g=g.memoizedState,c=a.stateNode;try{var tt=Di(a.type,f);e=c.getSnapshotBeforeUpdate(tt,g),c.__reactInternalSnapshotBeforeUpdate=e}catch(yt){en(a,a.return,yt)}}break;case 3:if((e&1024)!==0){if(e=r.stateNode.containerInfo,a=e.nodeType,a===9)Mh(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Mh(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(l(163))}if(e=r.sibling,e!==null){e.return=r.return,Fn=e;break}Fn=r.return}}function Ag(e,r,a){var c=a.flags;switch(a.tag){case 0:case 11:case 15:js(e,a),c&4&&Il(5,a);break;case 1:if(js(e,a),c&4)if(e=a.stateNode,r===null)try{e.componentDidMount()}catch(w){en(a,a.return,w)}else{var f=Di(a.type,r.memoizedProps);r=r.memoizedState;try{e.componentDidUpdate(f,r,e.__reactInternalSnapshotBeforeUpdate)}catch(w){en(a,a.return,w)}}c&64&&Cg(a),c&512&&Bl(a,a.return);break;case 3:if(js(e,a),c&64&&(e=a.updateQueue,e!==null)){if(r=null,a.child!==null)switch(a.child.tag){case 27:case 5:r=a.child.stateNode;break;case 1:r=a.child.stateNode}try{mm(e,r)}catch(w){en(a,a.return,w)}}break;case 27:r===null&&c&4&&Rg(a);case 26:case 5:js(e,a),r===null&&c&4&&Eg(a),c&512&&Bl(a,a.return);break;case 12:js(e,a);break;case 31:js(e,a),c&4&&Mg(e,a);break;case 13:js(e,a),c&4&&zg(e,a),c&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=gw.bind(null,a),Uw(e,a))));break;case 22:if(c=a.memoizedState!==null||ws,!c){r=r!==null&&r.memoizedState!==null||zn,f=ws;var g=zn;ws=c,(zn=r)&&!g?_s(e,a,(a.subtreeFlags&8772)!==0):js(e,a),ws=f,zn=g}break;case 30:break;default:js(e,a)}}function Og(e){var r=e.alternate;r!==null&&(e.alternate=null,Og(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&Ft(r)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var yn=null,dr=!1;function Ss(e,r,a){for(a=a.child;a!==null;)Dg(e,r,a),a=a.sibling}function Dg(e,r,a){if(jt&&typeof jt.onCommitFiberUnmount=="function")try{jt.onCommitFiberUnmount(wn,a)}catch{}switch(a.tag){case 26:zn||rs(a,r),Ss(e,r,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:zn||rs(a,r);var c=yn,f=dr;li(a.type)&&(yn=a.stateNode,dr=!1),Ss(e,r,a),Yl(a.stateNode),yn=c,dr=f;break;case 5:zn||rs(a,r);case 6:if(c=yn,f=dr,yn=null,Ss(e,r,a),yn=c,dr=f,yn!==null)if(dr)try{(yn.nodeType===9?yn.body:yn.nodeName==="HTML"?yn.ownerDocument.body:yn).removeChild(a.stateNode)}catch(g){en(a,r,g)}else try{yn.removeChild(a.stateNode)}catch(g){en(a,r,g)}break;case 18:yn!==null&&(dr?(e=yn,Cy(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),za(e)):Cy(yn,a.stateNode));break;case 4:c=yn,f=dr,yn=a.stateNode.containerInfo,dr=!0,Ss(e,r,a),yn=c,dr=f;break;case 0:case 11:case 14:case 15:ei(2,a,r),zn||ei(4,a,r),Ss(e,r,a);break;case 1:zn||(rs(a,r),c=a.stateNode,typeof c.componentWillUnmount=="function"&&Ng(a,r,c)),Ss(e,r,a);break;case 21:Ss(e,r,a);break;case 22:zn=(c=zn)||a.memoizedState!==null,Ss(e,r,a),zn=c;break;default:Ss(e,r,a)}}function Mg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{za(e)}catch(a){en(r,r.return,a)}}}function zg(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{za(e)}catch(a){en(r,r.return,a)}}function ow(e){switch(e.tag){case 31:case 13:case 19:var r=e.stateNode;return r===null&&(r=e.stateNode=new kg),r;case 22:return e=e.stateNode,r=e._retryCache,r===null&&(r=e._retryCache=new kg),r;default:throw Error(l(435,e.tag))}}function Rc(e,r){var a=ow(e);r.forEach(function(c){if(!a.has(c)){a.add(c);var f=yw.bind(null,e,c);c.then(f,f)}})}function hr(e,r){var a=r.deletions;if(a!==null)for(var c=0;c<a.length;c++){var f=a[c],g=e,w=r,A=w;e:for(;A!==null;){switch(A.tag){case 27:if(li(A.type)){yn=A.stateNode,dr=!1;break e}break;case 5:yn=A.stateNode,dr=!1;break e;case 3:case 4:yn=A.stateNode.containerInfo,dr=!0;break e}A=A.return}if(yn===null)throw Error(l(160));Dg(g,w,f),yn=null,dr=!1,g=f.alternate,g!==null&&(g.return=null),f.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Ug(r,e),r=r.sibling}var Gr=null;function Ug(e,r){var a=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:hr(r,e),fr(e),c&4&&(ei(3,e,e.return),Il(3,e),ei(5,e,e.return));break;case 1:hr(r,e),fr(e),c&512&&(zn||a===null||rs(a,a.return)),c&64&&ws&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?c:a.concat(c))));break;case 26:var f=Gr;if(hr(r,e),fr(e),c&512&&(zn||a===null||rs(a,a.return)),c&4){var g=a!==null?a.memoizedState:null;if(c=e.memoizedState,a===null)if(c===null)if(e.stateNode===null){e:{c=e.type,a=e.memoizedProps,f=f.ownerDocument||f;t:switch(c){case"title":g=f.getElementsByTagName("title")[0],(!g||g[dt]||g[Je]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=f.createElement(c),f.head.insertBefore(g,f.querySelector("head > title"))),Xn(g,c,a),g[Je]=e,Nt(g),c=g;break e;case"link":var w=Uy("link","href",f).get(c+(a.href||""));if(w){for(var A=0;A<w.length;A++)if(g=w[A],g.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&g.getAttribute("rel")===(a.rel==null?null:a.rel)&&g.getAttribute("title")===(a.title==null?null:a.title)&&g.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){w.splice(A,1);break t}}g=f.createElement(c),Xn(g,c,a),f.head.appendChild(g);break;case"meta":if(w=Uy("meta","content",f).get(c+(a.content||""))){for(A=0;A<w.length;A++)if(g=w[A],g.getAttribute("content")===(a.content==null?null:""+a.content)&&g.getAttribute("name")===(a.name==null?null:a.name)&&g.getAttribute("property")===(a.property==null?null:a.property)&&g.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&g.getAttribute("charset")===(a.charSet==null?null:a.charSet)){w.splice(A,1);break t}}g=f.createElement(c),Xn(g,c,a),f.head.appendChild(g);break;default:throw Error(l(468,c))}g[Je]=e,Nt(g),c=g}e.stateNode=c}else Ly(f,e.type,e.stateNode);else e.stateNode=zy(f,c,e.memoizedProps);else g!==c?(g===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):g.count--,c===null?Ly(f,e.type,e.stateNode):zy(f,c,e.memoizedProps)):c===null&&e.stateNode!==null&&ah(e,e.memoizedProps,a.memoizedProps)}break;case 27:hr(r,e),fr(e),c&512&&(zn||a===null||rs(a,a.return)),a!==null&&c&4&&ah(e,e.memoizedProps,a.memoizedProps);break;case 5:if(hr(r,e),fr(e),c&512&&(zn||a===null||rs(a,a.return)),e.flags&32){f=e.stateNode;try{us(f,"")}catch(tt){en(e,e.return,tt)}}c&4&&e.stateNode!=null&&(f=e.memoizedProps,ah(e,f,a!==null?a.memoizedProps:f)),c&1024&&(ch=!0);break;case 6:if(hr(r,e),fr(e),c&4){if(e.stateNode===null)throw Error(l(162));c=e.memoizedProps,a=e.stateNode;try{a.nodeValue=c}catch(tt){en(e,e.return,tt)}}break;case 3:if(Gc=null,f=Gr,Gr=Fc(r.containerInfo),hr(r,e),Gr=f,fr(e),c&4&&a!==null&&a.memoizedState.isDehydrated)try{za(r.containerInfo)}catch(tt){en(e,e.return,tt)}ch&&(ch=!1,Lg(e));break;case 4:c=Gr,Gr=Fc(e.stateNode.containerInfo),hr(r,e),fr(e),Gr=c;break;case 12:hr(r,e),fr(e);break;case 31:hr(r,e),fr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Rc(e,c)));break;case 13:hr(r,e),fr(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Ac=wt()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Rc(e,c)));break;case 22:f=e.memoizedState!==null;var Q=a!==null&&a.memoizedState!==null,de=ws,we=zn;if(ws=de||f,zn=we||Q,hr(r,e),zn=we,ws=de,fr(e),c&8192)e:for(r=e.stateNode,r._visibility=f?r._visibility&-2:r._visibility|1,f&&(a===null||Q||ws||zn||Mi(e)),a=null,r=e;;){if(r.tag===5||r.tag===26){if(a===null){Q=a=r;try{if(g=Q.stateNode,f)w=g.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none";else{A=Q.stateNode;var Te=Q.memoizedProps.style,fe=Te!=null&&Te.hasOwnProperty("display")?Te.display:null;A.style.display=fe==null||typeof fe=="boolean"?"":(""+fe).trim()}}catch(tt){en(Q,Q.return,tt)}}}else if(r.tag===6){if(a===null){Q=r;try{Q.stateNode.nodeValue=f?"":Q.memoizedProps}catch(tt){en(Q,Q.return,tt)}}}else if(r.tag===18){if(a===null){Q=r;try{var ve=Q.stateNode;f?Ny(ve,!0):Ny(Q.stateNode,!1)}catch(tt){en(Q,Q.return,tt)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;a===r&&(a=null),r=r.return}a===r&&(a=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=e.updateQueue,c!==null&&(a=c.retryQueue,a!==null&&(c.retryQueue=null,Rc(e,a))));break;case 19:hr(r,e),fr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Rc(e,c)));break;case 30:break;case 21:break;default:hr(r,e),fr(e)}}function fr(e){var r=e.flags;if(r&2){try{for(var a,c=e.return;c!==null;){if(Tg(c)){a=c;break}c=c.return}if(a==null)throw Error(l(160));switch(a.tag){case 27:var f=a.stateNode,g=lh(e);Tc(e,g,f);break;case 5:var w=a.stateNode;a.flags&32&&(us(w,""),a.flags&=-33);var A=lh(e);Tc(e,A,w);break;case 3:case 4:var Q=a.stateNode.containerInfo,de=lh(e);oh(e,de,Q);break;default:throw Error(l(161))}}catch(we){en(e,e.return,we)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function Lg(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var r=e;Lg(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),e=e.sibling}}function js(e,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Ag(e,r.alternate,r),r=r.sibling}function Mi(e){for(e=e.child;e!==null;){var r=e;switch(r.tag){case 0:case 11:case 14:case 15:ei(4,r,r.return),Mi(r);break;case 1:rs(r,r.return);var a=r.stateNode;typeof a.componentWillUnmount=="function"&&Ng(r,r.return,a),Mi(r);break;case 27:Yl(r.stateNode);case 26:case 5:rs(r,r.return),Mi(r);break;case 22:r.memoizedState===null&&Mi(r);break;case 30:Mi(r);break;default:Mi(r)}e=e.sibling}}function _s(e,r,a){for(a=a&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,f=e,g=r,w=g.flags;switch(g.tag){case 0:case 11:case 15:_s(f,g,a),Il(4,g);break;case 1:if(_s(f,g,a),c=g,f=c.stateNode,typeof f.componentDidMount=="function")try{f.componentDidMount()}catch(de){en(c,c.return,de)}if(c=g,f=c.updateQueue,f!==null){var A=c.stateNode;try{var Q=f.shared.hiddenCallbacks;if(Q!==null)for(f.shared.hiddenCallbacks=null,f=0;f<Q.length;f++)pm(Q[f],A)}catch(de){en(c,c.return,de)}}a&&w&64&&Cg(g),Bl(g,g.return);break;case 27:Rg(g);case 26:case 5:_s(f,g,a),a&&c===null&&w&4&&Eg(g),Bl(g,g.return);break;case 12:_s(f,g,a);break;case 31:_s(f,g,a),a&&w&4&&Mg(f,g);break;case 13:_s(f,g,a),a&&w&4&&zg(f,g);break;case 22:g.memoizedState===null&&_s(f,g,a),Bl(g,g.return);break;case 30:break;default:_s(f,g,a)}r=r.sibling}}function uh(e,r){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(e=r.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&Cl(a))}function dh(e,r){e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&Cl(e))}function Vr(e,r,a,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Ig(e,r,a,c),r=r.sibling}function Ig(e,r,a,c){var f=r.flags;switch(r.tag){case 0:case 11:case 15:Vr(e,r,a,c),f&2048&&Il(9,r);break;case 1:Vr(e,r,a,c);break;case 3:Vr(e,r,a,c),f&2048&&(e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&Cl(e)));break;case 12:if(f&2048){Vr(e,r,a,c),e=r.stateNode;try{var g=r.memoizedProps,w=g.id,A=g.onPostCommit;typeof A=="function"&&A(w,r.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(Q){en(r,r.return,Q)}}else Vr(e,r,a,c);break;case 31:Vr(e,r,a,c);break;case 13:Vr(e,r,a,c);break;case 23:break;case 22:g=r.stateNode,w=r.alternate,r.memoizedState!==null?g._visibility&2?Vr(e,r,a,c):$l(e,r):g._visibility&2?Vr(e,r,a,c):(g._visibility|=2,_a(e,r,a,c,(r.subtreeFlags&10256)!==0||!1)),f&2048&&uh(w,r);break;case 24:Vr(e,r,a,c),f&2048&&dh(r.alternate,r);break;default:Vr(e,r,a,c)}}function _a(e,r,a,c,f){for(f=f&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var g=e,w=r,A=a,Q=c,de=w.flags;switch(w.tag){case 0:case 11:case 15:_a(g,w,A,Q,f),Il(8,w);break;case 23:break;case 22:var we=w.stateNode;w.memoizedState!==null?we._visibility&2?_a(g,w,A,Q,f):$l(g,w):(we._visibility|=2,_a(g,w,A,Q,f)),f&&de&2048&&uh(w.alternate,w);break;case 24:_a(g,w,A,Q,f),f&&de&2048&&dh(w.alternate,w);break;default:_a(g,w,A,Q,f)}r=r.sibling}}function $l(e,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var a=e,c=r,f=c.flags;switch(c.tag){case 22:$l(a,c),f&2048&&uh(c.alternate,c);break;case 24:$l(a,c),f&2048&&dh(c.alternate,c);break;default:$l(a,c)}r=r.sibling}}var Pl=8192;function Ca(e,r,a){if(e.subtreeFlags&Pl)for(e=e.child;e!==null;)Bg(e,r,a),e=e.sibling}function Bg(e,r,a){switch(e.tag){case 26:Ca(e,r,a),e.flags&Pl&&e.memoizedState!==null&&Yw(a,Gr,e.memoizedState,e.memoizedProps);break;case 5:Ca(e,r,a);break;case 3:case 4:var c=Gr;Gr=Fc(e.stateNode.containerInfo),Ca(e,r,a),Gr=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=Pl,Pl=16777216,Ca(e,r,a),Pl=c):Ca(e,r,a));break;default:Ca(e,r,a)}}function $g(e){var r=e.alternate;if(r!==null&&(e=r.child,e!==null)){r.child=null;do r=e.sibling,e.sibling=null,e=r;while(e!==null)}}function ql(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var c=r[a];Fn=c,qg(c,e)}$g(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Pg(e),e=e.sibling}function Pg(e){switch(e.tag){case 0:case 11:case 15:ql(e),e.flags&2048&&ei(9,e,e.return);break;case 3:ql(e);break;case 12:ql(e);break;case 22:var r=e.stateNode;e.memoizedState!==null&&r._visibility&2&&(e.return===null||e.return.tag!==13)?(r._visibility&=-3,kc(e)):ql(e);break;default:ql(e)}}function kc(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var a=0;a<r.length;a++){var c=r[a];Fn=c,qg(c,e)}$g(e)}for(e=e.child;e!==null;){switch(r=e,r.tag){case 0:case 11:case 15:ei(8,r,r.return),kc(r);break;case 22:a=r.stateNode,a._visibility&2&&(a._visibility&=-3,kc(r));break;default:kc(r)}e=e.sibling}}function qg(e,r){for(;Fn!==null;){var a=Fn;switch(a.tag){case 0:case 11:case 15:ei(8,a,r);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var c=a.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Cl(a.memoizedState.cache)}if(c=a.child,c!==null)c.return=a,Fn=c;else e:for(a=e;Fn!==null;){c=Fn;var f=c.sibling,g=c.return;if(Og(c),c===a){Fn=null;break e}if(f!==null){f.return=g,Fn=f;break e}Fn=g}}}var cw={getCacheForType:function(e){var r=Wn(On),a=r.data.get(e);return a===void 0&&(a=e(),r.data.set(e,a)),a},cacheSignal:function(){return Wn(On).controller.signal}},uw=typeof WeakMap=="function"?WeakMap:Map,Wt=0,un=null,Lt=null,Pt=0,Zt=0,Sr=null,ti=!1,Na=!1,hh=!1,Cs=0,jn=0,ni=0,zi=0,fh=0,jr=0,Ea=0,Fl=null,pr=null,ph=!1,Ac=0,Fg=0,Oc=1/0,Dc=null,ri=null,In=0,si=null,Ta=null,Ns=0,mh=0,gh=null,Hg=null,Hl=0,yh=null;function _r(){return(Wt&2)!==0&&Pt!==0?Pt&-Pt:E.T!==null?jh():he()}function Gg(){if(jr===0)if((Pt&536870912)===0||Ht){var e=He;He<<=1,(He&3932160)===0&&(He=262144),jr=e}else jr=536870912;return e=br.current,e!==null&&(e.flags|=32),jr}function mr(e,r,a){(e===un&&(Zt===2||Zt===9)||e.cancelPendingCommit!==null)&&(Ra(e,0),ii(e,Pt,jr,!1)),Bt(e,a),((Wt&2)===0||e!==un)&&(e===un&&((Wt&2)===0&&(zi|=a),jn===4&&ii(e,Pt,jr,!1)),ss(e))}function Vg(e,r,a){if((Wt&6)!==0)throw Error(l(327));var c=!a&&(r&127)===0&&(r&e.expiredLanes)===0||Mt(e,r),f=c?fw(e,r):xh(e,r,!0),g=c;do{if(f===0){Na&&!c&&ii(e,r,0,!1);break}else{if(a=e.current.alternate,g&&!dw(a)){f=xh(e,r,!1),g=!1;continue}if(f===2){if(g=r,e.errorRecoveryDisabledLanes&g)var w=0;else w=e.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){r=w;e:{var A=e;f=Fl;var Q=A.current.memoizedState.isDehydrated;if(Q&&(Ra(A,w).flags|=256),w=xh(A,w,!1),w!==2){if(hh&&!Q){A.errorRecoveryDisabledLanes|=g,zi|=g,f=4;break e}g=pr,pr=f,g!==null&&(pr===null?pr=g:pr.push.apply(pr,g))}f=w}if(g=!1,f!==2)continue}}if(f===1){Ra(e,0),ii(e,r,0,!0);break}e:{switch(c=e,g=f,g){case 0:case 1:throw Error(l(345));case 4:if((r&4194048)!==r)break;case 6:ii(c,r,jr,!ti);break e;case 2:pr=null;break;case 3:case 5:break;default:throw Error(l(329))}if((r&62914560)===r&&(f=Ac+300-wt(),10<f)){if(ii(c,r,jr,!ti),et(c,0,!0)!==0)break e;Ns=r,c.timeoutHandle=jy(Kg.bind(null,c,a,pr,Dc,ph,r,jr,zi,Ea,ti,g,"Throttled",-0,0),f);break e}Kg(c,a,pr,Dc,ph,r,jr,zi,Ea,ti,g,null,-0,0)}}break}while(!0);ss(e)}function Kg(e,r,a,c,f,g,w,A,Q,de,we,Te,fe,ve){if(e.timeoutHandle=-1,Te=r.subtreeFlags,Te&8192||(Te&16785408)===16785408){Te={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fr},Bg(r,g,Te);var tt=(g&62914560)===g?Ac-wt():(g&4194048)===g?Fg-wt():0;if(tt=Qw(Te,tt),tt!==null){Ns=g,e.cancelPendingCommit=tt(ty.bind(null,e,r,g,a,c,f,w,A,Q,we,Te,null,fe,ve)),ii(e,g,w,!de);return}}ty(e,r,g,a,c,f,w,A,Q)}function dw(e){for(var r=e;;){var a=r.tag;if((a===0||a===11||a===15)&&r.flags&16384&&(a=r.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var c=0;c<a.length;c++){var f=a[c],g=f.getSnapshot;f=f.value;try{if(!vr(g(),f))return!1}catch{return!1}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ii(e,r,a,c){r&=~fh,r&=~zi,e.suspendedLanes|=r,e.pingedLanes&=~r,c&&(e.warmLanes|=r),c=e.expirationTimes;for(var f=r;0<f;){var g=31-cn(f),w=1<<g;c[g]=-1,f&=~w}a!==0&&Ut(e,a,r)}function Mc(){return(Wt&6)===0?(Gl(0),!1):!0}function vh(){if(Lt!==null){if(Zt===0)var e=Lt.return;else e=Lt,ms=Ni=null,Md(e),xa=null,El=0,e=Lt;for(;e!==null;)_g(e.alternate,e),e=e.return;Lt=null}}function Ra(e,r){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Aw(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),Ns=0,vh(),un=e,Lt=a=fs(e.current,null),Pt=r,Zt=0,Sr=null,ti=!1,Na=Mt(e,r),hh=!1,Ea=jr=fh=zi=ni=jn=0,pr=Fl=null,ph=!1,(r&8)!==0&&(r|=r&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=r;0<c;){var f=31-cn(c),g=1<<f;r|=e[f],c&=~g}return Cs=r,tc(),a}function Yg(e,r){At=null,E.H=zl,r===va||r===cc?(r=um(),Zt=3):r===Sd?(r=um(),Zt=4):Zt=r===Wd?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Sr=r,Lt===null&&(jn=1,jc(e,kr(r,e.current)))}function Qg(){var e=br.current;return e===null?!0:(Pt&4194048)===Pt?Mr===null:(Pt&62914560)===Pt||(Pt&536870912)!==0?e===Mr:!1}function Wg(){var e=E.H;return E.H=zl,e===null?zl:e}function Jg(){var e=E.A;return E.A=cw,e}function zc(){jn=4,ti||(Pt&4194048)!==Pt&&br.current!==null||(Na=!0),(ni&134217727)===0&&(zi&134217727)===0||un===null||ii(un,Pt,jr,!1)}function xh(e,r,a){var c=Wt;Wt|=2;var f=Wg(),g=Jg();(un!==e||Pt!==r)&&(Dc=null,Ra(e,r)),r=!1;var w=jn;e:do try{if(Zt!==0&&Lt!==null){var A=Lt,Q=Sr;switch(Zt){case 8:vh(),w=6;break e;case 3:case 2:case 9:case 6:br.current===null&&(r=!0);var de=Zt;if(Zt=0,Sr=null,ka(e,A,Q,de),a&&Na){w=0;break e}break;default:de=Zt,Zt=0,Sr=null,ka(e,A,Q,de)}}hw(),w=jn;break}catch(we){Yg(e,we)}while(!0);return r&&e.shellSuspendCounter++,ms=Ni=null,Wt=c,E.H=f,E.A=g,Lt===null&&(un=null,Pt=0,tc()),w}function hw(){for(;Lt!==null;)Xg(Lt)}function fw(e,r){var a=Wt;Wt|=2;var c=Wg(),f=Jg();un!==e||Pt!==r?(Dc=null,Oc=wt()+500,Ra(e,r)):Na=Mt(e,r);e:do try{if(Zt!==0&&Lt!==null){r=Lt;var g=Sr;t:switch(Zt){case 1:Zt=0,Sr=null,ka(e,r,g,1);break;case 2:case 9:if(om(g)){Zt=0,Sr=null,Zg(r);break}r=function(){Zt!==2&&Zt!==9||un!==e||(Zt=7),ss(e)},g.then(r,r);break e;case 3:Zt=7;break e;case 4:Zt=5;break e;case 7:om(g)?(Zt=0,Sr=null,Zg(r)):(Zt=0,Sr=null,ka(e,r,g,7));break;case 5:var w=null;switch(Lt.tag){case 26:w=Lt.memoizedState;case 5:case 27:var A=Lt;if(w?Iy(w):A.stateNode.complete){Zt=0,Sr=null;var Q=A.sibling;if(Q!==null)Lt=Q;else{var de=A.return;de!==null?(Lt=de,Uc(de)):Lt=null}break t}}Zt=0,Sr=null,ka(e,r,g,5);break;case 6:Zt=0,Sr=null,ka(e,r,g,6);break;case 8:vh(),jn=6;break e;default:throw Error(l(462))}}pw();break}catch(we){Yg(e,we)}while(!0);return ms=Ni=null,E.H=c,E.A=f,Wt=a,Lt!==null?0:(un=null,Pt=0,tc(),jn)}function pw(){for(;Lt!==null&&!Dt();)Xg(Lt)}function Xg(e){var r=Sg(e.alternate,e,Cs);e.memoizedProps=e.pendingProps,r===null?Uc(e):Lt=r}function Zg(e){var r=e,a=r.alternate;switch(r.tag){case 15:case 0:r=gg(a,r,r.pendingProps,r.type,void 0,Pt);break;case 11:r=gg(a,r,r.pendingProps,r.type.render,r.ref,Pt);break;case 5:Md(r);default:_g(a,r),r=Lt=Jp(r,Cs),r=Sg(a,r,Cs)}e.memoizedProps=e.pendingProps,r===null?Uc(e):Lt=r}function ka(e,r,a,c){ms=Ni=null,Md(r),xa=null,El=0;var f=r.return;try{if(nw(e,f,r,a,Pt)){jn=1,jc(e,kr(a,e.current)),Lt=null;return}}catch(g){if(f!==null)throw Lt=f,g;jn=1,jc(e,kr(a,e.current)),Lt=null;return}r.flags&32768?(Ht||c===1?e=!0:Na||(Pt&536870912)!==0?e=!1:(ti=e=!0,(c===2||c===9||c===3||c===6)&&(c=br.current,c!==null&&c.tag===13&&(c.flags|=16384))),ey(r,e)):Uc(r)}function Uc(e){var r=e;do{if((r.flags&32768)!==0){ey(r,ti);return}e=r.return;var a=iw(r.alternate,r,Cs);if(a!==null){Lt=a;return}if(r=r.sibling,r!==null){Lt=r;return}Lt=r=e}while(r!==null);jn===0&&(jn=5)}function ey(e,r){do{var a=aw(e.alternate,e);if(a!==null){a.flags&=32767,Lt=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!r&&(e=e.sibling,e!==null)){Lt=e;return}Lt=e=a}while(e!==null);jn=6,Lt=null}function ty(e,r,a,c,f,g,w,A,Q){e.cancelPendingCommit=null;do Lc();while(In!==0);if((Wt&6)!==0)throw Error(l(327));if(r!==null){if(r===e.current)throw Error(l(177));if(g=r.lanes|r.childLanes,g|=ld,Qe(e,a,g,w,A,Q),e===un&&(Lt=un=null,Pt=0),Ta=r,si=e,Ns=a,mh=g,gh=f,Hg=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,vw(Ue,function(){return ay(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=E.T,E.T=null,f=L.p,L.p=2,w=Wt,Wt|=4;try{lw(e,r,a)}finally{Wt=w,L.p=f,E.T=c}}In=1,ny(),ry(),sy()}}function ny(){if(In===1){In=0;var e=si,r=Ta,a=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||a){a=E.T,E.T=null;var c=L.p;L.p=2;var f=Wt;Wt|=4;try{Ug(r,e);var g=Ah,w=qp(e.containerInfo),A=g.focusedElem,Q=g.selectionRange;if(w!==A&&A&&A.ownerDocument&&Pp(A.ownerDocument.documentElement,A)){if(Q!==null&&nd(A)){var de=Q.start,we=Q.end;if(we===void 0&&(we=de),"selectionStart"in A)A.selectionStart=de,A.selectionEnd=Math.min(we,A.value.length);else{var Te=A.ownerDocument||document,fe=Te&&Te.defaultView||window;if(fe.getSelection){var ve=fe.getSelection(),tt=A.textContent.length,yt=Math.min(Q.start,tt),on=Q.end===void 0?yt:Math.min(Q.end,tt);!ve.extend&&yt>on&&(w=on,on=yt,yt=w);var re=$p(A,yt),ee=$p(A,on);if(re&&ee&&(ve.rangeCount!==1||ve.anchorNode!==re.node||ve.anchorOffset!==re.offset||ve.focusNode!==ee.node||ve.focusOffset!==ee.offset)){var ue=Te.createRange();ue.setStart(re.node,re.offset),ve.removeAllRanges(),yt>on?(ve.addRange(ue),ve.extend(ee.node,ee.offset)):(ue.setEnd(ee.node,ee.offset),ve.addRange(ue))}}}}for(Te=[],ve=A;ve=ve.parentNode;)ve.nodeType===1&&Te.push({element:ve,left:ve.scrollLeft,top:ve.scrollTop});for(typeof A.focus=="function"&&A.focus(),A=0;A<Te.length;A++){var Ne=Te[A];Ne.element.scrollLeft=Ne.left,Ne.element.scrollTop=Ne.top}}Qc=!!kh,Ah=kh=null}finally{Wt=f,L.p=c,E.T=a}}e.current=r,In=2}}function ry(){if(In===2){In=0;var e=si,r=Ta,a=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||a){a=E.T,E.T=null;var c=L.p;L.p=2;var f=Wt;Wt|=4;try{Ag(e,r.alternate,r)}finally{Wt=f,L.p=c,E.T=a}}In=3}}function sy(){if(In===4||In===3){In=0,Vt();var e=si,r=Ta,a=Ns,c=Hg;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?In=5:(In=0,Ta=si=null,iy(e,e.pendingLanes));var f=e.pendingLanes;if(f===0&&(ri=null),te(a),r=r.stateNode,jt&&typeof jt.onCommitFiberRoot=="function")try{jt.onCommitFiberRoot(wn,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=E.T,f=L.p,L.p=2,E.T=null;try{for(var g=e.onRecoverableError,w=0;w<c.length;w++){var A=c[w];g(A.value,{componentStack:A.stack})}}finally{E.T=r,L.p=f}}(Ns&3)!==0&&Lc(),ss(e),f=e.pendingLanes,(a&261930)!==0&&(f&42)!==0?e===yh?Hl++:(Hl=0,yh=e):Hl=0,Gl(0)}}function iy(e,r){(e.pooledCacheLanes&=r)===0&&(r=e.pooledCache,r!=null&&(e.pooledCache=null,Cl(r)))}function Lc(){return ny(),ry(),sy(),ay()}function ay(){if(In!==5)return!1;var e=si,r=mh;mh=0;var a=te(Ns),c=E.T,f=L.p;try{L.p=32>a?32:a,E.T=null,a=gh,gh=null;var g=si,w=Ns;if(In=0,Ta=si=null,Ns=0,(Wt&6)!==0)throw Error(l(331));var A=Wt;if(Wt|=4,Pg(g.current),Ig(g,g.current,w,a),Wt=A,Gl(0,!1),jt&&typeof jt.onPostCommitFiberRoot=="function")try{jt.onPostCommitFiberRoot(wn,g)}catch{}return!0}finally{L.p=f,E.T=c,iy(e,r)}}function ly(e,r,a){r=kr(a,r),r=Qd(e.stateNode,r,2),e=Js(e,r,2),e!==null&&(Bt(e,2),ss(e))}function en(e,r,a){if(e.tag===3)ly(e,e,a);else for(;r!==null;){if(r.tag===3){ly(r,e,a);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(ri===null||!ri.has(c))){e=kr(a,e),a=og(2),c=Js(r,a,2),c!==null&&(cg(a,c,r,e),Bt(c,2),ss(c));break}}r=r.return}}function bh(e,r,a){var c=e.pingCache;if(c===null){c=e.pingCache=new uw;var f=new Set;c.set(r,f)}else f=c.get(r),f===void 0&&(f=new Set,c.set(r,f));f.has(a)||(hh=!0,f.add(a),e=mw.bind(null,e,r,a),r.then(e,e))}function mw(e,r,a){var c=e.pingCache;c!==null&&c.delete(r),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,un===e&&(Pt&a)===a&&(jn===4||jn===3&&(Pt&62914560)===Pt&&300>wt()-Ac?(Wt&2)===0&&Ra(e,0):fh|=a,Ea===Pt&&(Ea=0)),ss(e)}function oy(e,r){r===0&&(r=kt()),e=ji(e,r),e!==null&&(Bt(e,r),ss(e))}function gw(e){var r=e.memoizedState,a=0;r!==null&&(a=r.retryLane),oy(e,a)}function yw(e,r){var a=0;switch(e.tag){case 31:case 13:var c=e.stateNode,f=e.memoizedState;f!==null&&(a=f.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(l(314))}c!==null&&c.delete(r),oy(e,a)}function vw(e,r){return St(e,r)}var Ic=null,Aa=null,wh=!1,Bc=!1,Sh=!1,ai=0;function ss(e){e!==Aa&&e.next===null&&(Aa===null?Ic=Aa=e:Aa=Aa.next=e),Bc=!0,wh||(wh=!0,bw())}function Gl(e,r){if(!Sh&&Bc){Sh=!0;do for(var a=!1,c=Ic;c!==null;){if(e!==0){var f=c.pendingLanes;if(f===0)var g=0;else{var w=c.suspendedLanes,A=c.pingedLanes;g=(1<<31-cn(42|e)+1)-1,g&=f&~(w&~A),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(a=!0,hy(c,g))}else g=Pt,g=et(c,c===un?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||Mt(c,g)||(a=!0,hy(c,g));c=c.next}while(a);Sh=!1}}function xw(){cy()}function cy(){Bc=wh=!1;var e=0;ai!==0&&kw()&&(e=ai);for(var r=wt(),a=null,c=Ic;c!==null;){var f=c.next,g=uy(c,r);g===0?(c.next=null,a===null?Ic=f:a.next=f,f===null&&(Aa=a)):(a=c,(e!==0||(g&3)!==0)&&(Bc=!0)),c=f}In!==0&&In!==5||Gl(e),ai!==0&&(ai=0)}function uy(e,r){for(var a=e.suspendedLanes,c=e.pingedLanes,f=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var w=31-cn(g),A=1<<w,Q=f[w];Q===-1?((A&a)===0||(A&c)!==0)&&(f[w]=vt(A,r)):Q<=r&&(e.expiredLanes|=A),g&=~A}if(r=un,a=Pt,a=et(e,e===r?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,a===0||e===r&&(Zt===2||Zt===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&mt(c),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||Mt(e,a)){if(r=a&-a,r===e.callbackPriority)return r;switch(c!==null&&mt(c),te(a)){case 2:case 8:a=Ce;break;case 32:a=Ue;break;case 268435456:a=ct;break;default:a=Ue}return c=dy.bind(null,e),a=St(a,c),e.callbackPriority=r,e.callbackNode=a,r}return c!==null&&c!==null&&mt(c),e.callbackPriority=2,e.callbackNode=null,2}function dy(e,r){if(In!==0&&In!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Lc()&&e.callbackNode!==a)return null;var c=Pt;return c=et(e,e===un?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(Vg(e,c,r),uy(e,wt()),e.callbackNode!=null&&e.callbackNode===a?dy.bind(null,e):null)}function hy(e,r){if(Lc())return null;Vg(e,r,!0)}function bw(){Ow(function(){(Wt&6)!==0?St(je,xw):cy()})}function jh(){if(ai===0){var e=ga;e===0&&(e=me,me<<=1,(me&261888)===0&&(me=256)),ai=e}return ai}function fy(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:sa(""+e)}function py(e,r){var a=r.ownerDocument.createElement("input");return a.name=r.name,a.value=r.value,e.id&&a.setAttribute("form",e.id),r.parentNode.insertBefore(a,r),e=new FormData(e),a.parentNode.removeChild(a),e}function ww(e,r,a,c,f){if(r==="submit"&&a&&a.stateNode===f){var g=fy((f[Ke]||null).action),w=c.submitter;w&&(r=(r=w[Ke]||null)?fy(r.formAction):w.getAttribute("formAction"),r!==null&&(g=r,w=null));var A=new pn("action","action",null,c,f);e.push({event:A,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(ai!==0){var Q=w?py(f,w):new FormData(f);Fd(a,{pending:!0,data:Q,method:f.method,action:g},null,Q)}}else typeof g=="function"&&(A.preventDefault(),Q=w?py(f,w):new FormData(f),Fd(a,{pending:!0,data:Q,method:f.method,action:g},g,Q))},currentTarget:f}]})}}for(var _h=0;_h<ad.length;_h++){var Ch=ad[_h],Sw=Ch.toLowerCase(),jw=Ch[0].toUpperCase()+Ch.slice(1);Hr(Sw,"on"+jw)}Hr(Gp,"onAnimationEnd"),Hr(Vp,"onAnimationIteration"),Hr(Kp,"onAnimationStart"),Hr("dblclick","onDoubleClick"),Hr("focusin","onFocus"),Hr("focusout","onBlur"),Hr(Bb,"onTransitionRun"),Hr($b,"onTransitionStart"),Hr(Pb,"onTransitionCancel"),Hr(Yp,"onTransitionEnd"),qr("onMouseEnter",["mouseout","mouseover"]),qr("onMouseLeave",["mouseout","mouseover"]),qr("onPointerEnter",["pointerout","pointerover"]),qr("onPointerLeave",["pointerout","pointerover"]),yr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),yr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),yr("onBeforeInput",["compositionend","keypress","textInput","paste"]),yr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),yr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_w=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Vl));function my(e,r){r=(r&4)!==0;for(var a=0;a<e.length;a++){var c=e[a],f=c.event;c=c.listeners;e:{var g=void 0;if(r)for(var w=c.length-1;0<=w;w--){var A=c[w],Q=A.instance,de=A.currentTarget;if(A=A.listener,Q!==g&&f.isPropagationStopped())break e;g=A,f.currentTarget=de;try{g(f)}catch(we){ec(we)}f.currentTarget=null,g=Q}else for(w=0;w<c.length;w++){if(A=c[w],Q=A.instance,de=A.currentTarget,A=A.listener,Q!==g&&f.isPropagationStopped())break e;g=A,f.currentTarget=de;try{g(f)}catch(we){ec(we)}f.currentTarget=null,g=Q}}}}function It(e,r){var a=r[ze];a===void 0&&(a=r[ze]=new Set);var c=e+"__bubble";a.has(c)||(gy(r,e,2,!1),a.add(c))}function Nh(e,r,a){var c=0;r&&(c|=4),gy(a,e,c,r)}var $c="_reactListening"+Math.random().toString(36).slice(2);function Eh(e){if(!e[$c]){e[$c]=!0,Pr.forEach(function(a){a!=="selectionchange"&&(_w.has(a)||Nh(a,!1,e),Nh(a,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[$c]||(r[$c]=!0,Nh("selectionchange",!1,r))}}function gy(e,r,a,c){switch(Gy(r)){case 2:var f=Xw;break;case 8:f=Zw;break;default:f=qh}a=f.bind(null,r,a,e),f=void 0,!be||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(f=!0),c?f!==void 0?e.addEventListener(r,a,{capture:!0,passive:f}):e.addEventListener(r,a,!0):f!==void 0?e.addEventListener(r,a,{passive:f}):e.addEventListener(r,a,!1)}function Th(e,r,a,c,f){var g=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var w=c.tag;if(w===3||w===4){var A=c.stateNode.containerInfo;if(A===f)break;if(w===4)for(w=c.return;w!==null;){var Q=w.tag;if((Q===3||Q===4)&&w.stateNode.containerInfo===f)return;w=w.return}for(;A!==null;){if(w=Nn(A),w===null)return;if(Q=w.tag,Q===5||Q===6||Q===26||Q===27){c=g=w;continue e}A=A.parentNode}}c=c.return}I(function(){var de=g,we=gl(a),Te=[];e:{var fe=Qp.get(e);if(fe!==void 0){var ve=pn,tt=e;switch(e){case"keypress":if(nt(a)===0)break e;case"keydown":case"keyup":ve=yb;break;case"focusin":tt="focus",ve=rr;break;case"focusout":tt="blur",ve=rr;break;case"beforeblur":case"afterblur":ve=rr;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=kn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=bb;break;case Gp:case Vp:case Kp:ve=ds;break;case Yp:ve=Sb;break;case"scroll":case"scrollend":ve=Fs;break;case"wheel":ve=_b;break;case"copy":case"cut":case"paste":ve=Hs;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Np;break;case"toggle":case"beforetoggle":ve=Nb}var yt=(r&4)!==0,on=!yt&&(e==="scroll"||e==="scrollend"),re=yt?fe!==null?fe+"Capture":null:fe;yt=[];for(var ee=de,ue;ee!==null;){var Ne=ee;if(ue=Ne.stateNode,Ne=Ne.tag,Ne!==5&&Ne!==26&&Ne!==27||ue===null||re===null||(Ne=X(ee,re),Ne!=null&&yt.push(Kl(ee,Ne,ue))),on)break;ee=ee.return}0<yt.length&&(fe=new ve(fe,tt,null,a,we),Te.push({event:fe,listeners:yt}))}}if((r&7)===0){e:{if(fe=e==="mouseover"||e==="pointerover",ve=e==="mouseout"||e==="pointerout",fe&&a!==ml&&(tt=a.relatedTarget||a.fromElement)&&(Nn(tt)||tt[H]))break e;if((ve||fe)&&(fe=we.window===we?we:(fe=we.ownerDocument)?fe.defaultView||fe.parentWindow:window,ve?(tt=a.relatedTarget||a.toElement,ve=de,tt=tt?Nn(tt):null,tt!==null&&(on=u(tt),yt=tt.tag,tt!==on||yt!==5&&yt!==27&&yt!==6)&&(tt=null)):(ve=null,tt=de),ve!==tt)){if(yt=hn,Ne="onMouseLeave",re="onMouseEnter",ee="mouse",(e==="pointerout"||e==="pointerover")&&(yt=Np,Ne="onPointerLeave",re="onPointerEnter",ee="pointer"),on=ve==null?fe:Vn(ve),ue=tt==null?fe:Vn(tt),fe=new yt(Ne,ee+"leave",ve,a,we),fe.target=on,fe.relatedTarget=ue,Ne=null,Nn(we)===de&&(yt=new yt(re,ee+"enter",tt,a,we),yt.target=ue,yt.relatedTarget=on,Ne=yt),on=Ne,ve&&tt)t:{for(yt=Cw,re=ve,ee=tt,ue=0,Ne=re;Ne;Ne=yt(Ne))ue++;Ne=0;for(var ht=ee;ht;ht=yt(ht))Ne++;for(;0<ue-Ne;)re=yt(re),ue--;for(;0<Ne-ue;)ee=yt(ee),Ne--;for(;ue--;){if(re===ee||ee!==null&&re===ee.alternate){yt=re;break t}re=yt(re),ee=yt(ee)}yt=null}else yt=null;ve!==null&&yy(Te,fe,ve,yt,!1),tt!==null&&on!==null&&yy(Te,on,tt,yt,!0)}}e:{if(fe=de?Vn(de):window,ve=fe.nodeName&&fe.nodeName.toLowerCase(),ve==="select"||ve==="input"&&fe.type==="file")var Kt=Mp;else if(Op(fe))if(zp)Kt=Ub;else{Kt=Mb;var at=Db}else ve=fe.nodeName,!ve||ve.toLowerCase()!=="input"||fe.type!=="checkbox"&&fe.type!=="radio"?de&&ra(de.elementType)&&(Kt=Mp):Kt=zb;if(Kt&&(Kt=Kt(e,de))){Dp(Te,Kt,a,we);break e}at&&at(e,fe,de),e==="focusout"&&de&&fe.type==="number"&&de.memoizedProps.value!=null&&pl(fe,"number",fe.value)}switch(at=de?Vn(de):window,e){case"focusin":(Op(at)||at.contentEditable==="true")&&(oa=at,rd=de,Sl=null);break;case"focusout":Sl=rd=oa=null;break;case"mousedown":sd=!0;break;case"contextmenu":case"mouseup":case"dragend":sd=!1,Fp(Te,a,we);break;case"selectionchange":if(Ib)break;case"keydown":case"keyup":Fp(Te,a,we)}var Ot;if(Zu)e:{switch(e){case"compositionstart":var qt="onCompositionStart";break e;case"compositionend":qt="onCompositionEnd";break e;case"compositionupdate":qt="onCompositionUpdate";break e}qt=void 0}else la?kp(e,a)&&(qt="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(qt="onCompositionStart");qt&&(Ep&&a.locale!=="ko"&&(la||qt!=="onCompositionStart"?qt==="onCompositionEnd"&&la&&(Ot=We()):(Oe=we,$e="value"in Oe?Oe.value:Oe.textContent,la=!0)),at=Pc(de,qt),0<at.length&&(qt=new Ju(qt,e,null,a,we),Te.push({event:qt,listeners:at}),Ot?qt.data=Ot:(Ot=Ap(a),Ot!==null&&(qt.data=Ot)))),(Ot=Tb?Rb(e,a):kb(e,a))&&(qt=Pc(de,"onBeforeInput"),0<qt.length&&(at=new Ju("onBeforeInput","beforeinput",null,a,we),Te.push({event:at,listeners:qt}),at.data=Ot)),ww(Te,e,de,a,we)}my(Te,r)})}function Kl(e,r,a){return{instance:e,listener:r,currentTarget:a}}function Pc(e,r){for(var a=r+"Capture",c=[];e!==null;){var f=e,g=f.stateNode;if(f=f.tag,f!==5&&f!==26&&f!==27||g===null||(f=X(e,a),f!=null&&c.unshift(Kl(e,f,g)),f=X(e,r),f!=null&&c.push(Kl(e,f,g))),e.tag===3)return c;e=e.return}return[]}function Cw(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function yy(e,r,a,c,f){for(var g=r._reactName,w=[];a!==null&&a!==c;){var A=a,Q=A.alternate,de=A.stateNode;if(A=A.tag,Q!==null&&Q===c)break;A!==5&&A!==26&&A!==27||de===null||(Q=de,f?(de=X(a,g),de!=null&&w.unshift(Kl(a,de,Q))):f||(de=X(a,g),de!=null&&w.push(Kl(a,de,Q)))),a=a.return}w.length!==0&&e.push({event:r,listeners:w})}var Nw=/\r\n?/g,Ew=/\u0000|\uFFFD/g;function vy(e){return(typeof e=="string"?e:""+e).replace(Nw,`
`).replace(Ew,"")}function xy(e,r){return r=vy(r),vy(e)===r}function ln(e,r,a,c,f,g){switch(a){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||us(e,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&us(e,""+c);break;case"className":Is(e,"class",c);break;case"tabIndex":Is(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Is(e,a,c);break;case"style":Jo(e,c,g);break;case"data":if(r!=="object"){Is(e,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||a!=="href")){e.removeAttribute(a);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(a);break}c=sa(""+c),e.setAttribute(a,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(a==="formAction"?(r!=="input"&&ln(e,r,"name",f.name,f,null),ln(e,r,"formEncType",f.formEncType,f,null),ln(e,r,"formMethod",f.formMethod,f,null),ln(e,r,"formTarget",f.formTarget,f,null)):(ln(e,r,"encType",f.encType,f,null),ln(e,r,"method",f.method,f,null),ln(e,r,"target",f.target,f,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(a);break}c=sa(""+c),e.setAttribute(a,c);break;case"onClick":c!=null&&(e.onclick=Fr);break;case"onScroll":c!=null&&It("scroll",e);break;case"onScrollEnd":c!=null&&It("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(l(61));if(a=c.__html,a!=null){if(f.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}a=sa(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,""+c):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":c===!0?e.setAttribute(a,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(a,c):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(a,c):e.removeAttribute(a);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(a):e.setAttribute(a,c);break;case"popover":It("beforetoggle",e),It("toggle",e),ta(e,"popover",c);break;case"xlinkActuate":cr(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":cr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":cr(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":cr(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":cr(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":cr(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":cr(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":cr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":cr(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":ta(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Wu.get(a)||a,ta(e,a,c))}}function Rh(e,r,a,c,f,g){switch(a){case"style":Jo(e,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(l(61));if(a=c.__html,a!=null){if(f.children!=null)throw Error(l(60));e.innerHTML=a}}break;case"children":typeof c=="string"?us(e,c):(typeof c=="number"||typeof c=="bigint")&&us(e,""+c);break;case"onScroll":c!=null&&It("scroll",e);break;case"onScrollEnd":c!=null&&It("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Fr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Kn.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(f=a.endsWith("Capture"),r=a.slice(2,f?a.length-7:void 0),g=e[Ke]||null,g=g!=null?g[a]:null,typeof g=="function"&&e.removeEventListener(r,g,f),typeof c=="function")){typeof g!="function"&&g!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(r,c,f);break e}a in e?e[a]=c:c===!0?e.setAttribute(a,""):ta(e,a,c)}}}function Xn(e,r,a){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":It("error",e),It("load",e);var c=!1,f=!1,g;for(g in a)if(a.hasOwnProperty(g)){var w=a[g];if(w!=null)switch(g){case"src":c=!0;break;case"srcSet":f=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:ln(e,r,g,w,a,null)}}f&&ln(e,r,"srcSet",a.srcSet,a,null),c&&ln(e,r,"src",a.src,a,null);return;case"input":It("invalid",e);var A=g=w=f=null,Q=null,de=null;for(c in a)if(a.hasOwnProperty(c)){var we=a[c];if(we!=null)switch(c){case"name":f=we;break;case"type":w=we;break;case"checked":Q=we;break;case"defaultChecked":de=we;break;case"value":g=we;break;case"defaultValue":A=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(l(137,r));break;default:ln(e,r,c,we,a,null)}}Bs(e,g,A,Q,de,w,f,!1);return;case"select":It("invalid",e),c=w=g=null;for(f in a)if(a.hasOwnProperty(f)&&(A=a[f],A!=null))switch(f){case"value":g=A;break;case"defaultValue":w=A;break;case"multiple":c=A;default:ln(e,r,f,A,a,null)}r=g,a=w,e.multiple=!!c,r!=null?$s(e,!!c,r,!1):a!=null&&$s(e,!!c,a,!0);return;case"textarea":It("invalid",e),g=f=c=null;for(w in a)if(a.hasOwnProperty(w)&&(A=a[w],A!=null))switch(w){case"value":c=A;break;case"defaultValue":f=A;break;case"children":g=A;break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(l(91));break;default:ln(e,r,w,A,a,null)}Yo(e,c,f,g);return;case"option":for(Q in a)a.hasOwnProperty(Q)&&(c=a[Q],c!=null)&&(Q==="selected"?e.selected=c&&typeof c!="function"&&typeof c!="symbol":ln(e,r,Q,c,a,null));return;case"dialog":It("beforetoggle",e),It("toggle",e),It("cancel",e),It("close",e);break;case"iframe":case"object":It("load",e);break;case"video":case"audio":for(c=0;c<Vl.length;c++)It(Vl[c],e);break;case"image":It("error",e),It("load",e);break;case"details":It("toggle",e);break;case"embed":case"source":case"link":It("error",e),It("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(de in a)if(a.hasOwnProperty(de)&&(c=a[de],c!=null))switch(de){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,r));default:ln(e,r,de,c,a,null)}return;default:if(ra(r)){for(we in a)a.hasOwnProperty(we)&&(c=a[we],c!==void 0&&Rh(e,r,we,c,a,void 0));return}}for(A in a)a.hasOwnProperty(A)&&(c=a[A],c!=null&&ln(e,r,A,c,a,null))}function Tw(e,r,a,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var f=null,g=null,w=null,A=null,Q=null,de=null,we=null;for(ve in a){var Te=a[ve];if(a.hasOwnProperty(ve)&&Te!=null)switch(ve){case"checked":break;case"value":break;case"defaultValue":Q=Te;default:c.hasOwnProperty(ve)||ln(e,r,ve,null,c,Te)}}for(var fe in c){var ve=c[fe];if(Te=a[fe],c.hasOwnProperty(fe)&&(ve!=null||Te!=null))switch(fe){case"type":g=ve;break;case"name":f=ve;break;case"checked":de=ve;break;case"defaultChecked":we=ve;break;case"value":w=ve;break;case"defaultValue":A=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(l(137,r));break;default:ve!==Te&&ln(e,r,fe,ve,c,Te)}}fl(e,w,A,Q,de,we,g,f);return;case"select":ve=w=A=fe=null;for(g in a)if(Q=a[g],a.hasOwnProperty(g)&&Q!=null)switch(g){case"value":break;case"multiple":ve=Q;default:c.hasOwnProperty(g)||ln(e,r,g,null,c,Q)}for(f in c)if(g=c[f],Q=a[f],c.hasOwnProperty(f)&&(g!=null||Q!=null))switch(f){case"value":fe=g;break;case"defaultValue":A=g;break;case"multiple":w=g;default:g!==Q&&ln(e,r,f,g,c,Q)}r=A,a=w,c=ve,fe!=null?$s(e,!!a,fe,!1):!!c!=!!a&&(r!=null?$s(e,!!a,r,!0):$s(e,!!a,a?[]:"",!1));return;case"textarea":ve=fe=null;for(A in a)if(f=a[A],a.hasOwnProperty(A)&&f!=null&&!c.hasOwnProperty(A))switch(A){case"value":break;case"children":break;default:ln(e,r,A,null,c,f)}for(w in c)if(f=c[w],g=a[w],c.hasOwnProperty(w)&&(f!=null||g!=null))switch(w){case"value":fe=f;break;case"defaultValue":ve=f;break;case"children":break;case"dangerouslySetInnerHTML":if(f!=null)throw Error(l(91));break;default:f!==g&&ln(e,r,w,f,c,g)}Ko(e,fe,ve);return;case"option":for(var tt in a)fe=a[tt],a.hasOwnProperty(tt)&&fe!=null&&!c.hasOwnProperty(tt)&&(tt==="selected"?e.selected=!1:ln(e,r,tt,null,c,fe));for(Q in c)fe=c[Q],ve=a[Q],c.hasOwnProperty(Q)&&fe!==ve&&(fe!=null||ve!=null)&&(Q==="selected"?e.selected=fe&&typeof fe!="function"&&typeof fe!="symbol":ln(e,r,Q,fe,c,ve));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var yt in a)fe=a[yt],a.hasOwnProperty(yt)&&fe!=null&&!c.hasOwnProperty(yt)&&ln(e,r,yt,null,c,fe);for(de in c)if(fe=c[de],ve=a[de],c.hasOwnProperty(de)&&fe!==ve&&(fe!=null||ve!=null))switch(de){case"children":case"dangerouslySetInnerHTML":if(fe!=null)throw Error(l(137,r));break;default:ln(e,r,de,fe,c,ve)}return;default:if(ra(r)){for(var on in a)fe=a[on],a.hasOwnProperty(on)&&fe!==void 0&&!c.hasOwnProperty(on)&&Rh(e,r,on,void 0,c,fe);for(we in c)fe=c[we],ve=a[we],!c.hasOwnProperty(we)||fe===ve||fe===void 0&&ve===void 0||Rh(e,r,we,fe,c,ve);return}}for(var re in a)fe=a[re],a.hasOwnProperty(re)&&fe!=null&&!c.hasOwnProperty(re)&&ln(e,r,re,null,c,fe);for(Te in c)fe=c[Te],ve=a[Te],!c.hasOwnProperty(Te)||fe===ve||fe==null&&ve==null||ln(e,r,Te,fe,c,ve)}function by(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Rw(){if(typeof performance.getEntriesByType=="function"){for(var e=0,r=0,a=performance.getEntriesByType("resource"),c=0;c<a.length;c++){var f=a[c],g=f.transferSize,w=f.initiatorType,A=f.duration;if(g&&A&&by(w)){for(w=0,A=f.responseEnd,c+=1;c<a.length;c++){var Q=a[c],de=Q.startTime;if(de>A)break;var we=Q.transferSize,Te=Q.initiatorType;we&&by(Te)&&(Q=Q.responseEnd,w+=we*(Q<A?1:(A-de)/(Q-de)))}if(--c,r+=8*(g+w)/(f.duration/1e3),e++,10<e)break}}if(0<e)return r/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var kh=null,Ah=null;function qc(e){return e.nodeType===9?e:e.ownerDocument}function wy(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Sy(e,r){if(e===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&r==="foreignObject"?0:e}function Oh(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Dh=null;function kw(){var e=window.event;return e&&e.type==="popstate"?e===Dh?!1:(Dh=e,!0):(Dh=null,!1)}var jy=typeof setTimeout=="function"?setTimeout:void 0,Aw=typeof clearTimeout=="function"?clearTimeout:void 0,_y=typeof Promise=="function"?Promise:void 0,Ow=typeof queueMicrotask=="function"?queueMicrotask:typeof _y<"u"?function(e){return _y.resolve(null).then(e).catch(Dw)}:jy;function Dw(e){setTimeout(function(){throw e})}function li(e){return e==="head"}function Cy(e,r){var a=r,c=0;do{var f=a.nextSibling;if(e.removeChild(a),f&&f.nodeType===8)if(a=f.data,a==="/$"||a==="/&"){if(c===0){e.removeChild(f),za(r);return}c--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")c++;else if(a==="html")Yl(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,Yl(a);for(var g=a.firstChild;g;){var w=g.nextSibling,A=g.nodeName;g[dt]||A==="SCRIPT"||A==="STYLE"||A==="LINK"&&g.rel.toLowerCase()==="stylesheet"||a.removeChild(g),g=w}}else a==="body"&&Yl(e.ownerDocument.body);a=f}while(a);za(r)}function Ny(e,r){var a=e;e=0;do{var c=a.nextSibling;if(a.nodeType===1?r?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(r?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),c&&c.nodeType===8)if(a=c.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=c}while(a)}function Mh(e){var r=e.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var a=r;switch(r=r.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Mh(a),Ft(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Mw(e,r,a,c){for(;e.nodeType===1;){var f=a;if(e.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[dt])switch(r){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==f.rel||e.getAttribute("href")!==(f.href==null||f.href===""?null:f.href)||e.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin)||e.getAttribute("title")!==(f.title==null?null:f.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(f.src==null?null:f.src)||e.getAttribute("type")!==(f.type==null?null:f.type)||e.getAttribute("crossorigin")!==(f.crossOrigin==null?null:f.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(r==="input"&&e.type==="hidden"){var g=f.name==null?null:""+f.name;if(f.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=zr(e.nextSibling),e===null)break}return null}function zw(e,r,a){if(r==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=zr(e.nextSibling),e===null))return null;return e}function Ey(e,r){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=zr(e.nextSibling),e===null))return null;return e}function zh(e){return e.data==="$?"||e.data==="$~"}function Uh(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Uw(e,r){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=r;else if(e.data!=="$?"||a.readyState!=="loading")r();else{var c=function(){r(),a.removeEventListener("DOMContentLoaded",c)};a.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function zr(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return e}var Lh=null;function Ty(e){e=e.nextSibling;for(var r=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(r===0)return zr(e.nextSibling);r--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||r++}e=e.nextSibling}return null}function Ry(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(r===0)return e;r--}else a!=="/$"&&a!=="/&"||r++}e=e.previousSibling}return null}function ky(e,r,a){switch(r=qc(a),e){case"html":if(e=r.documentElement,!e)throw Error(l(452));return e;case"head":if(e=r.head,!e)throw Error(l(453));return e;case"body":if(e=r.body,!e)throw Error(l(454));return e;default:throw Error(l(451))}}function Yl(e){for(var r=e.attributes;r.length;)e.removeAttributeNode(r[0]);Ft(e)}var Ur=new Map,Ay=new Set;function Fc(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Es=L.d;L.d={f:Lw,r:Iw,D:Bw,C:$w,L:Pw,m:qw,X:Hw,S:Fw,M:Gw};function Lw(){var e=Es.f(),r=Mc();return e||r}function Iw(e){var r=Et(e);r!==null&&r.tag===5&&r.type==="form"?Ym(r):Es.r(e)}var Oa=typeof document>"u"?null:document;function Oy(e,r,a){var c=Oa;if(c&&typeof r=="string"&&r){var f=ur(r);f='link[rel="'+e+'"][href="'+f+'"]',typeof a=="string"&&(f+='[crossorigin="'+a+'"]'),Ay.has(f)||(Ay.add(f),e={rel:e,crossOrigin:a,href:r},c.querySelector(f)===null&&(r=c.createElement("link"),Xn(r,"link",e),Nt(r),c.head.appendChild(r)))}}function Bw(e){Es.D(e),Oy("dns-prefetch",e,null)}function $w(e,r){Es.C(e,r),Oy("preconnect",e,r)}function Pw(e,r,a){Es.L(e,r,a);var c=Oa;if(c&&e&&r){var f='link[rel="preload"][as="'+ur(r)+'"]';r==="image"&&a&&a.imageSrcSet?(f+='[imagesrcset="'+ur(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(f+='[imagesizes="'+ur(a.imageSizes)+'"]')):f+='[href="'+ur(e)+'"]';var g=f;switch(r){case"style":g=Da(e);break;case"script":g=Ma(e)}Ur.has(g)||(e=v({rel:"preload",href:r==="image"&&a&&a.imageSrcSet?void 0:e,as:r},a),Ur.set(g,e),c.querySelector(f)!==null||r==="style"&&c.querySelector(Ql(g))||r==="script"&&c.querySelector(Wl(g))||(r=c.createElement("link"),Xn(r,"link",e),Nt(r),c.head.appendChild(r)))}}function qw(e,r){Es.m(e,r);var a=Oa;if(a&&e){var c=r&&typeof r.as=="string"?r.as:"script",f='link[rel="modulepreload"][as="'+ur(c)+'"][href="'+ur(e)+'"]',g=f;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Ma(e)}if(!Ur.has(g)&&(e=v({rel:"modulepreload",href:e},r),Ur.set(g,e),a.querySelector(f)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Wl(g)))return}c=a.createElement("link"),Xn(c,"link",e),Nt(c),a.head.appendChild(c)}}}function Fw(e,r,a){Es.S(e,r,a);var c=Oa;if(c&&e){var f=sn(c).hoistableStyles,g=Da(e);r=r||"default";var w=f.get(g);if(!w){var A={loading:0,preload:null};if(w=c.querySelector(Ql(g)))A.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":r},a),(a=Ur.get(g))&&Ih(e,a);var Q=w=c.createElement("link");Nt(Q),Xn(Q,"link",e),Q._p=new Promise(function(de,we){Q.onload=de,Q.onerror=we}),Q.addEventListener("load",function(){A.loading|=1}),Q.addEventListener("error",function(){A.loading|=2}),A.loading|=4,Hc(w,r,c)}w={type:"stylesheet",instance:w,count:1,state:A},f.set(g,w)}}}function Hw(e,r){Es.X(e,r);var a=Oa;if(a&&e){var c=sn(a).hoistableScripts,f=Ma(e),g=c.get(f);g||(g=a.querySelector(Wl(f)),g||(e=v({src:e,async:!0},r),(r=Ur.get(f))&&Bh(e,r),g=a.createElement("script"),Nt(g),Xn(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(f,g))}}function Gw(e,r){Es.M(e,r);var a=Oa;if(a&&e){var c=sn(a).hoistableScripts,f=Ma(e),g=c.get(f);g||(g=a.querySelector(Wl(f)),g||(e=v({src:e,async:!0,type:"module"},r),(r=Ur.get(f))&&Bh(e,r),g=a.createElement("script"),Nt(g),Xn(g,"link",e),a.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(f,g))}}function Dy(e,r,a,c){var f=(f=xe.current)?Fc(f):null;if(!f)throw Error(l(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(r=Da(a.href),a=sn(f).hoistableStyles,c=a.get(r),c||(c={type:"style",instance:null,count:0,state:null},a.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=Da(a.href);var g=sn(f).hoistableStyles,w=g.get(e);if(w||(f=f.ownerDocument||f,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,w),(g=f.querySelector(Ql(e)))&&!g._p&&(w.instance=g,w.state.loading=5),Ur.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Ur.set(e,a),g||Vw(f,e,a,w.state))),r&&c===null)throw Error(l(528,""));return w}if(r&&c!==null)throw Error(l(529,""));return null;case"script":return r=a.async,a=a.src,typeof a=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Ma(a),a=sn(f).hoistableScripts,c=a.get(r),c||(c={type:"script",instance:null,count:0,state:null},a.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,e))}}function Da(e){return'href="'+ur(e)+'"'}function Ql(e){return'link[rel="stylesheet"]['+e+"]"}function My(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function Vw(e,r,a,c){e.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=e.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),Xn(r,"link",a),Nt(r),e.head.appendChild(r))}function Ma(e){return'[src="'+ur(e)+'"]'}function Wl(e){return"script[async]"+e}function zy(e,r,a){if(r.count++,r.instance===null)switch(r.type){case"style":var c=e.querySelector('style[data-href~="'+ur(a.href)+'"]');if(c)return r.instance=c,Nt(c),c;var f=v({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),Nt(c),Xn(c,"style",f),Hc(c,a.precedence,e),r.instance=c;case"stylesheet":f=Da(a.href);var g=e.querySelector(Ql(f));if(g)return r.state.loading|=4,r.instance=g,Nt(g),g;c=My(a),(f=Ur.get(f))&&Ih(c,f),g=(e.ownerDocument||e).createElement("link"),Nt(g);var w=g;return w._p=new Promise(function(A,Q){w.onload=A,w.onerror=Q}),Xn(g,"link",c),r.state.loading|=4,Hc(g,a.precedence,e),r.instance=g;case"script":return g=Ma(a.src),(f=e.querySelector(Wl(g)))?(r.instance=f,Nt(f),f):(c=a,(f=Ur.get(g))&&(c=v({},a),Bh(c,f)),e=e.ownerDocument||e,f=e.createElement("script"),Nt(f),Xn(f,"link",c),e.head.appendChild(f),r.instance=f);case"void":return null;default:throw Error(l(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,Hc(c,a.precedence,e));return r.instance}function Hc(e,r,a){for(var c=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),f=c.length?c[c.length-1]:null,g=f,w=0;w<c.length;w++){var A=c[w];if(A.dataset.precedence===r)g=A;else if(g!==f)break}g?g.parentNode.insertBefore(e,g.nextSibling):(r=a.nodeType===9?a.head:a,r.insertBefore(e,r.firstChild))}function Ih(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.title==null&&(e.title=r.title)}function Bh(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.integrity==null&&(e.integrity=r.integrity)}var Gc=null;function Uy(e,r,a){if(Gc===null){var c=new Map,f=Gc=new Map;f.set(a,c)}else f=Gc,c=f.get(a),c||(c=new Map,f.set(a,c));if(c.has(e))return c;for(c.set(e,null),a=a.getElementsByTagName(e),f=0;f<a.length;f++){var g=a[f];if(!(g[dt]||g[Je]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var w=g.getAttribute(r)||"";w=e+w;var A=c.get(w);A?A.push(g):c.set(w,[g])}}return c}function Ly(e,r,a){e=e.ownerDocument||e,e.head.insertBefore(a,r==="title"?e.querySelector("head > title"):null)}function Kw(e,r,a){if(a===1||r.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(e=r.disabled,typeof r.precedence=="string"&&e==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function Iy(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function Yw(e,r,a,c){if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var f=Da(c.href),g=r.querySelector(Ql(f));if(g){r=g._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(e.count++,e=Vc.bind(e),r.then(e,e)),a.state.loading|=4,a.instance=g,Nt(g);return}g=r.ownerDocument||r,c=My(c),(f=Ur.get(f))&&Ih(c,f),g=g.createElement("link"),Nt(g);var w=g;w._p=new Promise(function(A,Q){w.onload=A,w.onerror=Q}),Xn(g,"link",c),a.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,r),(r=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=Vc.bind(e),r.addEventListener("load",a),r.addEventListener("error",a))}}var $h=0;function Qw(e,r){return e.stylesheets&&e.count===0&&Yc(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var c=setTimeout(function(){if(e.stylesheets&&Yc(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+r);0<e.imgBytes&&$h===0&&($h=62500*Rw());var f=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Yc(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>$h?50:800)+r);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(f)}}:null}function Vc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Yc(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Kc=null;function Yc(e,r){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Kc=new Map,r.forEach(Ww,e),Kc=null,Vc.call(e))}function Ww(e,r){if(!(r.state.loading&4)){var a=Kc.get(e);if(a)var c=a.get(null);else{a=new Map,Kc.set(e,a);for(var f=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<f.length;g++){var w=f[g];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(a.set(w.dataset.precedence,w),c=w)}c&&a.set(null,c)}f=r.instance,w=f.getAttribute("data-precedence"),g=a.get(w)||c,g===c&&a.set(null,f),a.set(w,f),this.count++,c=Vc.bind(this),f.addEventListener("load",c),f.addEventListener("error",c),g?g.parentNode.insertBefore(f,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(f,e.firstChild)),r.state.loading|=4}}var Jl={$$typeof:M,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function Jw(e,r,a,c,f,g,w,A,Q){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ze(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ze(0),this.hiddenUpdates=Ze(null),this.identifierPrefix=c,this.onUncaughtError=f,this.onCaughtError=g,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Q,this.incompleteTransitions=new Map}function By(e,r,a,c,f,g,w,A,Q,de,we,Te){return e=new Jw(e,r,a,w,Q,de,we,Te,A),r=1,g===!0&&(r|=24),g=xr(3,null,null,r),e.current=g,g.stateNode=e,r=xd(),r.refCount++,e.pooledCache=r,r.refCount++,g.memoizedState={element:c,isDehydrated:a,cache:r},jd(g),e}function $y(e){return e?(e=da,e):da}function Py(e,r,a,c,f,g){f=$y(f),c.context===null?c.context=f:c.pendingContext=f,c=Ws(r),c.payload={element:a},g=g===void 0?null:g,g!==null&&(c.callback=g),a=Js(e,c,r),a!==null&&(mr(a,e,r),Rl(a,e,r))}function qy(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<r?a:r}}function Ph(e,r){qy(e,r),(e=e.alternate)&&qy(e,r)}function Fy(e){if(e.tag===13||e.tag===31){var r=ji(e,67108864);r!==null&&mr(r,e,67108864),Ph(e,67108864)}}function Hy(e){if(e.tag===13||e.tag===31){var r=_r();r=ne(r);var a=ji(e,r);a!==null&&mr(a,e,r),Ph(e,r)}}var Qc=!0;function Xw(e,r,a,c){var f=E.T;E.T=null;var g=L.p;try{L.p=2,qh(e,r,a,c)}finally{L.p=g,E.T=f}}function Zw(e,r,a,c){var f=E.T;E.T=null;var g=L.p;try{L.p=8,qh(e,r,a,c)}finally{L.p=g,E.T=f}}function qh(e,r,a,c){if(Qc){var f=Fh(c);if(f===null)Th(e,r,c,Wc,a),Vy(e,c);else if(tS(f,e,r,a,c))c.stopPropagation();else if(Vy(e,c),r&4&&-1<eS.indexOf(e)){for(;f!==null;){var g=Et(f);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var w=Ve(g.pendingLanes);if(w!==0){var A=g;for(A.pendingLanes|=2,A.entangledLanes|=2;w;){var Q=1<<31-cn(w);A.entanglements[1]|=Q,w&=~Q}ss(g),(Wt&6)===0&&(Oc=wt()+500,Gl(0))}}break;case 31:case 13:A=ji(g,2),A!==null&&mr(A,g,2),Mc(),Ph(g,2)}if(g=Fh(c),g===null&&Th(e,r,c,Wc,a),g===f)break;f=g}f!==null&&c.stopPropagation()}else Th(e,r,c,null,a)}}function Fh(e){return e=gl(e),Hh(e)}var Wc=null;function Hh(e){if(Wc=null,e=Nn(e),e!==null){var r=u(e);if(r===null)e=null;else{var a=r.tag;if(a===13){if(e=d(r),e!==null)return e;e=null}else if(a===31){if(e=h(r),e!==null)return e;e=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null)}}return Wc=e,null}function Gy(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ie()){case je:return 2;case Ce:return 8;case Ue:case st:return 32;case ct:return 268435456;default:return 32}default:return 32}}var Gh=!1,oi=null,ci=null,ui=null,Xl=new Map,Zl=new Map,di=[],eS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Vy(e,r){switch(e){case"focusin":case"focusout":oi=null;break;case"dragenter":case"dragleave":ci=null;break;case"mouseover":case"mouseout":ui=null;break;case"pointerover":case"pointerout":Xl.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zl.delete(r.pointerId)}}function eo(e,r,a,c,f,g){return e===null||e.nativeEvent!==g?(e={blockedOn:r,domEventName:a,eventSystemFlags:c,nativeEvent:g,targetContainers:[f]},r!==null&&(r=Et(r),r!==null&&Fy(r)),e):(e.eventSystemFlags|=c,r=e.targetContainers,f!==null&&r.indexOf(f)===-1&&r.push(f),e)}function tS(e,r,a,c,f){switch(r){case"focusin":return oi=eo(oi,e,r,a,c,f),!0;case"dragenter":return ci=eo(ci,e,r,a,c,f),!0;case"mouseover":return ui=eo(ui,e,r,a,c,f),!0;case"pointerover":var g=f.pointerId;return Xl.set(g,eo(Xl.get(g)||null,e,r,a,c,f)),!0;case"gotpointercapture":return g=f.pointerId,Zl.set(g,eo(Zl.get(g)||null,e,r,a,c,f)),!0}return!1}function Ky(e){var r=Nn(e.target);if(r!==null){var a=u(r);if(a!==null){if(r=a.tag,r===13){if(r=d(a),r!==null){e.blockedOn=r,Ee(e.priority,function(){Hy(a)});return}}else if(r===31){if(r=h(a),r!==null){e.blockedOn=r,Ee(e.priority,function(){Hy(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Jc(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var a=Fh(e.nativeEvent);if(a===null){a=e.nativeEvent;var c=new a.constructor(a.type,a);ml=c,a.target.dispatchEvent(c),ml=null}else return r=Et(a),r!==null&&Fy(r),e.blockedOn=a,!1;r.shift()}return!0}function Yy(e,r,a){Jc(e)&&a.delete(r)}function nS(){Gh=!1,oi!==null&&Jc(oi)&&(oi=null),ci!==null&&Jc(ci)&&(ci=null),ui!==null&&Jc(ui)&&(ui=null),Xl.forEach(Yy),Zl.forEach(Yy)}function Xc(e,r){e.blockedOn===r&&(e.blockedOn=null,Gh||(Gh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,nS)))}var Zc=null;function Qy(e){Zc!==e&&(Zc=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Zc===e&&(Zc=null);for(var r=0;r<e.length;r+=3){var a=e[r],c=e[r+1],f=e[r+2];if(typeof c!="function"){if(Hh(c||a)===null)continue;break}var g=Et(a);g!==null&&(e.splice(r,3),r-=3,Fd(g,{pending:!0,data:f,method:a.method,action:c},c,f))}}))}function za(e){function r(Q){return Xc(Q,e)}oi!==null&&Xc(oi,e),ci!==null&&Xc(ci,e),ui!==null&&Xc(ui,e),Xl.forEach(r),Zl.forEach(r);for(var a=0;a<di.length;a++){var c=di[a];c.blockedOn===e&&(c.blockedOn=null)}for(;0<di.length&&(a=di[0],a.blockedOn===null);)Ky(a),a.blockedOn===null&&di.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(c=0;c<a.length;c+=3){var f=a[c],g=a[c+1],w=f[Ke]||null;if(typeof g=="function")w||Qy(a);else if(w){var A=null;if(g&&g.hasAttribute("formAction")){if(f=g,w=g[Ke]||null)A=w.formAction;else if(Hh(f)!==null)continue}else A=w.action;typeof A=="function"?a[c+1]=A:(a.splice(c,3),c-=3),Qy(a)}}}function Wy(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(w){return f=w})},focusReset:"manual",scroll:"manual"})}function r(){f!==null&&(f(),f=null),c||setTimeout(a,20)}function a(){if(!c&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,f=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(a,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),f!==null&&(f(),f=null)}}}function Vh(e){this._internalRoot=e}eu.prototype.render=Vh.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(l(409));var a=r.current,c=_r();Py(a,c,e,r,null,null)},eu.prototype.unmount=Vh.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;Py(e.current,2,null,e,null,null),Mc(),r[H]=null}};function eu(e){this._internalRoot=e}eu.prototype.unstable_scheduleHydration=function(e){if(e){var r=he();e={blockedOn:null,target:e,priority:r};for(var a=0;a<di.length&&r!==0&&r<di[a].priority;a++);di.splice(a,0,e),a===0&&Ky(e)}};var Jy=t.version;if(Jy!=="19.2.3")throw Error(l(527,Jy,"19.2.3"));L.findDOMNode=function(e){var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(l(188)):(e=Object.keys(e).join(","),Error(l(268,e)));return e=m(r),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var rS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:E,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tu.isDisabled&&tu.supportsFiber)try{wn=tu.inject(rS),jt=tu}catch{}}return no.createRoot=function(e,r){if(!o(e))throw Error(l(299));var a=!1,c="",f=sg,g=ig,w=ag;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(f=r.onUncaughtError),r.onCaughtError!==void 0&&(g=r.onCaughtError),r.onRecoverableError!==void 0&&(w=r.onRecoverableError)),r=By(e,1,!1,null,null,a,c,null,f,g,w,Wy),e[H]=r.current,Eh(e),new Vh(r)},no.hydrateRoot=function(e,r,a){if(!o(e))throw Error(l(299));var c=!1,f="",g=sg,w=ig,A=ag,Q=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(g=a.onUncaughtError),a.onCaughtError!==void 0&&(w=a.onCaughtError),a.onRecoverableError!==void 0&&(A=a.onRecoverableError),a.formState!==void 0&&(Q=a.formState)),r=By(e,1,!0,r,a??null,c,f,Q,g,w,A,Wy),r.context=$y(null),a=r.current,c=_r(),c=ne(c),f=Ws(c),f.callback=null,Js(a,f,c),a=c,r.current.lanes=a,Bt(r,a),ss(r),e[H]=r.current,Eh(e),new eu(r)},no.version="19.2.3",no}var lv;function hS(){if(lv)return Qh.exports;lv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Qh.exports=dS(),Qh.exports}var fS=hS();var ov="popstate";function pS(n={}){function t(l,o){let{pathname:u,search:d,hash:h}=l.location;return Lf("",{pathname:u,search:d,hash:h},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function s(l,o){return typeof o=="string"?o:xo(o)}return gS(t,s,null,n)}function qn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Br(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function mS(){return Math.random().toString(36).substring(2,10)}function cv(n,t){return{usr:n.state,key:n.key,idx:t}}function Lf(n,t,s=null,l){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?Mo(t):t,state:s,key:t&&t.key||l||mS()}}function xo({pathname:n="/",search:t="",hash:s=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function Mo(n){let t={};if(n){let s=n.indexOf("#");s>=0&&(t.hash=n.substring(s),n=n.substring(0,s));let l=n.indexOf("?");l>=0&&(t.search=n.substring(l),n=n.substring(0,l)),n&&(t.pathname=n)}return t}function gS(n,t,s,l={}){let{window:o=document.defaultView,v5Compat:u=!1}=l,d=o.history,h="POP",p=null,m=y();m==null&&(m=0,d.replaceState({...d.state,idx:m},""));function y(){return(d.state||{idx:null}).idx}function v(){h="POP";let j=y(),T=j==null?null:j-m;m=j,p&&p({action:h,location:N.location,delta:T})}function x(j,T){h="PUSH";let D=Lf(N.location,j,T);m=y()+1;let M=cv(D,m),$=N.createHref(D);try{d.pushState(M,"",$)}catch(U){if(U instanceof DOMException&&U.name==="DataCloneError")throw U;o.location.assign($)}u&&p&&p({action:h,location:N.location,delta:1})}function S(j,T){h="REPLACE";let D=Lf(N.location,j,T);m=y();let M=cv(D,m),$=N.createHref(D);d.replaceState(M,"",$),u&&p&&p({action:h,location:N.location,delta:0})}function _(j){return yS(j)}let N={get action(){return h},get location(){return n(o,d)},listen(j){if(p)throw new Error("A history only accepts one active listener");return o.addEventListener(ov,v),p=j,()=>{o.removeEventListener(ov,v),p=null}},createHref(j){return t(o,j)},createURL:_,encodeLocation(j){let T=_(j);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:x,replace:S,go(j){return d.go(j)}};return N}function yS(n,t=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),qn(s,"No window.location.(origin|href) available to create URL");let l=typeof n=="string"?n:xo(n);return l=l.replace(/ $/,"%20"),!t&&l.startsWith("//")&&(l=s+l),new URL(l,s)}function Ix(n,t,s="/"){return vS(n,t,s,!1)}function vS(n,t,s,l){let o=typeof t=="string"?Mo(t):t,u=Ds(o.pathname||"/",s);if(u==null)return null;let d=Bx(n);xS(d);let h=null;for(let p=0;h==null&&p<d.length;++p){let m=kS(u);h=TS(d[p],m,l)}return h}function Bx(n,t=[],s=[],l="",o=!1){let u=(d,h,p=o,m)=>{let y={relativePath:m===void 0?d.path||"":m,caseSensitive:d.caseSensitive===!0,childrenIndex:h,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(l)&&p)return;qn(y.relativePath.startsWith(l),`Absolute route path "${y.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(l.length)}let v=Os([l,y.relativePath]),x=s.concat(y);d.children&&d.children.length>0&&(qn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),Bx(d.children,t,x,v,p)),!(d.path==null&&!d.index)&&t.push({path:v,score:NS(v,d.index),routesMeta:x})};return n.forEach((d,h)=>{if(d.path===""||!d.path?.includes("?"))u(d,h);else for(let p of $x(d.path))u(d,h,!0,p)}),t}function $x(n){let t=n.split("/");if(t.length===0)return[];let[s,...l]=t,o=s.endsWith("?"),u=s.replace(/\?$/,"");if(l.length===0)return o?[u,""]:[u];let d=$x(l.join("/")),h=[];return h.push(...d.map(p=>p===""?u:[u,p].join("/"))),o&&h.push(...d),h.map(p=>n.startsWith("/")&&p===""?"/":p)}function xS(n){n.sort((t,s)=>t.score!==s.score?s.score-t.score:ES(t.routesMeta.map(l=>l.childrenIndex),s.routesMeta.map(l=>l.childrenIndex)))}var bS=/^:[\w-]+$/,wS=3,SS=2,jS=1,_S=10,CS=-2,uv=n=>n==="*";function NS(n,t){let s=n.split("/"),l=s.length;return s.some(uv)&&(l+=CS),t&&(l+=SS),s.filter(o=>!uv(o)).reduce((o,u)=>o+(bS.test(u)?wS:u===""?jS:_S),l)}function ES(n,t){return n.length===t.length&&n.slice(0,-1).every((l,o)=>l===t[o])?n[n.length-1]-t[t.length-1]:0}function TS(n,t,s=!1){let{routesMeta:l}=n,o={},u="/",d=[];for(let h=0;h<l.length;++h){let p=l[h],m=h===l.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=Su({path:p.relativePath,caseSensitive:p.caseSensitive,end:m},y),x=p.route;if(!v&&m&&s&&!l[l.length-1].route.index&&(v=Su({path:p.relativePath,caseSensitive:p.caseSensitive,end:!1},y)),!v)return null;Object.assign(o,v.params),d.push({params:o,pathname:Os([u,v.pathname]),pathnameBase:MS(Os([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=Os([u,v.pathnameBase]))}return d}function Su(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,l]=RS(n.path,n.caseSensitive,n.end),o=t.match(s);if(!o)return null;let u=o[0],d=u.replace(/(.)\/+$/,"$1"),h=o.slice(1);return{params:l.reduce((m,{paramName:y,isOptional:v},x)=>{if(y==="*"){let _=h[x]||"";d=u.slice(0,u.length-_.length).replace(/(.)\/+$/,"$1")}const S=h[x];return v&&!S?m[y]=void 0:m[y]=(S||"").replace(/%2F/g,"/"),m},{}),pathname:u,pathnameBase:d,pattern:n}}function RS(n,t=!1,s=!0){Br(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let l=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,h,p)=>(l.push({paramName:h,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(l.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),l]}function kS(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Br(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Ds(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,l=n.charAt(s);return l&&l!=="/"?null:n.slice(s)||"/"}var Px=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,AS=n=>Px.test(n);function OS(n,t="/"){let{pathname:s,search:l="",hash:o=""}=typeof n=="string"?Mo(n):n,u;if(s)if(AS(s))u=s;else{if(s.includes("//")){let d=s;s=s.replace(/\/\/+/g,"/"),Br(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${s}`)}s.startsWith("/")?u=dv(s.substring(1),"/"):u=dv(s,t)}else u=t;return{pathname:u,search:zS(l),hash:US(o)}}function dv(n,t){let s=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?s.length>1&&s.pop():o!=="."&&s.push(o)}),s.length>1?s.join("/"):"/"}function Zh(n,t,s,l){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function DS(n){return n.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function qx(n){let t=DS(n);return t.map((s,l)=>l===t.length-1?s.pathname:s.pathnameBase)}function Fx(n,t,s,l=!1){let o;typeof n=="string"?o=Mo(n):(o={...n},qn(!o.pathname||!o.pathname.includes("?"),Zh("?","pathname","search",o)),qn(!o.pathname||!o.pathname.includes("#"),Zh("#","pathname","hash",o)),qn(!o.search||!o.search.includes("#"),Zh("#","search","hash",o)));let u=n===""||o.pathname==="",d=u?"/":o.pathname,h;if(d==null)h=s;else{let v=t.length-1;if(!l&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;o.pathname=x.join("/")}h=v>=0?t[v]:"/"}let p=OS(o,h),m=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&s.endsWith("/");return!p.pathname.endsWith("/")&&(m||y)&&(p.pathname+="/"),p}var Os=n=>n.join("/").replace(/\/\/+/g,"/"),MS=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),zS=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,US=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,LS=class{constructor(n,t,s,l=!1){this.status=n,this.statusText=t||"",this.internal=l,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function IS(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function BS(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Hx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Gx(n,t){let s=n;if(typeof s!="string"||!Px.test(s))return{absoluteURL:void 0,isExternal:!1,to:s};let l=s,o=!1;if(Hx)try{let u=new URL(window.location.href),d=s.startsWith("//")?new URL(u.protocol+s):new URL(s),h=Ds(d.pathname,t);d.origin===u.origin&&h!=null?s=h+d.search+d.hash:o=!0}catch{Br(!1,`<Link to="${s}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:l,isExternal:o,to:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Vx=["POST","PUT","PATCH","DELETE"];new Set(Vx);var $S=["GET",...Vx];new Set($S);var tl=b.createContext(null);tl.displayName="DataRouter";var Mu=b.createContext(null);Mu.displayName="DataRouterState";var PS=b.createContext(!1),Kx=b.createContext({isTransitioning:!1});Kx.displayName="ViewTransition";var qS=b.createContext(new Map);qS.displayName="Fetchers";var FS=b.createContext(null);FS.displayName="Await";var $r=b.createContext(null);$r.displayName="Navigation";var zu=b.createContext(null);zu.displayName="Location";var zs=b.createContext({outlet:null,matches:[],isDataRoute:!1});zs.displayName="Route";var ip=b.createContext(null);ip.displayName="RouteError";var Yx="REACT_ROUTER_ERROR",HS="REDIRECT",GS="ROUTE_ERROR_RESPONSE";function VS(n){if(n.startsWith(`${Yx}:${HS}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function KS(n){if(n.startsWith(`${Yx}:${GS}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new LS(t.status,t.statusText,t.data)}catch{}}function YS(n,{relative:t}={}){qn(zo(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:l}=b.useContext($r),{hash:o,pathname:u,search:d}=Uo(n,{relative:t}),h=u;return s!=="/"&&(h=u==="/"?s:Os([s,u])),l.createHref({pathname:h,search:d,hash:o})}function zo(){return b.useContext(zu)!=null}function Us(){return qn(zo(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(zu).location}var Qx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Wx(n){b.useContext($r).static||b.useLayoutEffect(n)}function Jx(){let{isDataRoute:n}=b.useContext(zs);return n?lj():QS()}function QS(){qn(zo(),"useNavigate() may be used only in the context of a <Router> component.");let n=b.useContext(tl),{basename:t,navigator:s}=b.useContext($r),{matches:l}=b.useContext(zs),{pathname:o}=Us(),u=JSON.stringify(qx(l)),d=b.useRef(!1);return Wx(()=>{d.current=!0}),b.useCallback((p,m={})=>{if(Br(d.current,Qx),!d.current)return;if(typeof p=="number"){s.go(p);return}let y=Fx(p,JSON.parse(u),o,m.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Os([t,y.pathname])),(m.replace?s.replace:s.push)(y,m.state,m)},[t,s,u,o,n])}b.createContext(null);function Uo(n,{relative:t}={}){let{matches:s}=b.useContext(zs),{pathname:l}=Us(),o=JSON.stringify(qx(s));return b.useMemo(()=>Fx(n,JSON.parse(o),l,t==="path"),[n,o,l,t])}function WS(n,t,s,l,o){qn(zo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=b.useContext($r),{matches:d}=b.useContext(zs),h=d[d.length-1],p=h?h.params:{},m=h?h.pathname:"/",y=h?h.pathnameBase:"/",v=h&&h.route;{let D=v&&v.path||"";Zx(m,!v||D.endsWith("*")||D.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${D}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${D}"> to <Route path="${D==="/"?"*":`${D}/*`}">.`)}let x=Us(),S;S=x;let _=S.pathname||"/",N=_;if(y!=="/"){let D=y.replace(/^\//,"").split("/");N="/"+_.replace(/^\//,"").split("/").slice(D.length).join("/")}let j=Ix(n,{pathname:N});return Br(v||j!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),Br(j==null||j[j.length-1].route.element!==void 0||j[j.length-1].route.Component!==void 0||j[j.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),tj(j&&j.map(D=>Object.assign({},D,{params:Object.assign({},p,D.params),pathname:Os([y,u.encodeLocation?u.encodeLocation(D.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?y:Os([y,u.encodeLocation?u.encodeLocation(D.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathnameBase])})),d,s,l,o)}function JS(){let n=aj(),t=IS(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,l="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:l},u={padding:"2px 4px",backgroundColor:l},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:u},"ErrorBoundary")," or"," ",b.createElement("code",{style:u},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},t),s?b.createElement("pre",{style:o},s):null,d)}var XS=b.createElement(JS,null),Xx=class extends b.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const s=KS(n.digest);s&&(n=s)}let t=n!==void 0?b.createElement(zs.Provider,{value:this.props.routeContext},b.createElement(ip.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?b.createElement(ZS,{error:n},t):t}};Xx.contextType=PS;var ef=new WeakMap;function ZS({children:n,error:t}){let{basename:s}=b.useContext($r);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let l=VS(t.digest);if(l){let o=ef.get(t);if(o)throw o;let u=Gx(l.location,s);if(Hx&&!ef.get(t))if(u.isExternal||l.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:l.replace}));throw ef.set(t,d),d}return b.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function ej({routeContext:n,match:t,children:s}){let l=b.useContext(tl);return l&&l.static&&l.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=t.route.id),b.createElement(zs.Provider,{value:n},s)}function tj(n,t=[],s=null,l=null,o=null){if(n==null){if(!s)return null;if(s.errors)n=s.matches;else if(t.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let u=n,d=s?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);qn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let h=!1,p=-1;if(s)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(p=y),v.route.id){let{loaderData:x,errors:S}=s,_=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!S||S[v.route.id]===void 0);if(v.route.lazy||_){h=!0,p>=0?u=u.slice(0,p+1):u=[u[0]];break}}}let m=s&&l?(y,v)=>{l(y,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:BS(s.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let S,_=!1,N=null,j=null;s&&(S=d&&v.route.id?d[v.route.id]:void 0,N=v.route.errorElement||XS,h&&(p<0&&x===0?(Zx("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),_=!0,j=null):p===x&&(_=!0,j=v.route.hydrateFallbackElement||null)));let T=t.concat(u.slice(0,x+1)),D=()=>{let M;return S?M=N:_?M=j:v.route.Component?M=b.createElement(v.route.Component,null):v.route.element?M=v.route.element:M=y,b.createElement(ej,{match:v,routeContext:{outlet:y,matches:T,isDataRoute:s!=null},children:M})};return s&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?b.createElement(Xx,{location:s.location,revalidation:s.revalidation,component:N,error:S,children:D(),routeContext:{outlet:null,matches:T,isDataRoute:!0},onError:m}):D()},null)}function ap(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nj(n){let t=b.useContext(tl);return qn(t,ap(n)),t}function rj(n){let t=b.useContext(Mu);return qn(t,ap(n)),t}function sj(n){let t=b.useContext(zs);return qn(t,ap(n)),t}function lp(n){let t=sj(n),s=t.matches[t.matches.length-1];return qn(s.route.id,`${n} can only be used on routes that contain a unique "id"`),s.route.id}function ij(){return lp("useRouteId")}function aj(){let n=b.useContext(ip),t=rj("useRouteError"),s=lp("useRouteError");return n!==void 0?n:t.errors?.[s]}function lj(){let{router:n}=nj("useNavigate"),t=lp("useNavigate"),s=b.useRef(!1);return Wx(()=>{s.current=!0}),b.useCallback(async(o,u={})=>{Br(s.current,Qx),s.current&&(typeof o=="number"?await n.navigate(o):await n.navigate(o,{fromRouteId:t,...u}))},[n,t])}var hv={};function Zx(n,t,s){!t&&!hv[n]&&(hv[n]=!0,Br(!1,s))}b.memo(oj);function oj({routes:n,future:t,state:s,onError:l}){return WS(n,void 0,s,l,t)}function cj({basename:n="/",children:t=null,location:s,navigationType:l="POP",navigator:o,static:u=!1,unstable_useTransitions:d}){qn(!zo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=n.replace(/^\/*/,"/"),p=b.useMemo(()=>({basename:h,navigator:o,static:u,unstable_useTransitions:d,future:{}}),[h,o,u,d]);typeof s=="string"&&(s=Mo(s));let{pathname:m="/",search:y="",hash:v="",state:x=null,key:S="default"}=s,_=b.useMemo(()=>{let N=Ds(m,h);return N==null?null:{location:{pathname:N,search:y,hash:v,state:x,key:S},navigationType:l}},[h,m,y,v,x,S,l]);return Br(_!=null,`<Router basename="${h}"> is not able to match the URL "${m}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:b.createElement($r.Provider,{value:p},b.createElement(zu.Provider,{children:t,value:_}))}var mu="get",gu="application/x-www-form-urlencoded";function Uu(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function uj(n){return Uu(n)&&n.tagName.toLowerCase()==="button"}function dj(n){return Uu(n)&&n.tagName.toLowerCase()==="form"}function hj(n){return Uu(n)&&n.tagName.toLowerCase()==="input"}function fj(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function pj(n,t){return n.button===0&&(!t||t==="_self")&&!fj(n)}function If(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,s)=>{let l=n[s];return t.concat(Array.isArray(l)?l.map(o=>[s,o]):[[s,l]])},[]))}function mj(n,t){let s=If(n);return t&&t.forEach((l,o)=>{s.has(o)||t.getAll(o).forEach(u=>{s.append(o,u)})}),s}var nu=null;function gj(){if(nu===null)try{new FormData(document.createElement("form"),0),nu=!1}catch{nu=!0}return nu}var yj=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function tf(n){return n!=null&&!yj.has(n)?(Br(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${gu}"`),null):n}function vj(n,t){let s,l,o,u,d;if(dj(n)){let h=n.getAttribute("action");l=h?Ds(h,t):null,s=n.getAttribute("method")||mu,o=tf(n.getAttribute("enctype"))||gu,u=new FormData(n)}else if(uj(n)||hj(n)&&(n.type==="submit"||n.type==="image")){let h=n.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let p=n.getAttribute("formaction")||h.getAttribute("action");if(l=p?Ds(p,t):null,s=n.getAttribute("formmethod")||h.getAttribute("method")||mu,o=tf(n.getAttribute("formenctype"))||tf(h.getAttribute("enctype"))||gu,u=new FormData(h,n),!gj()){let{name:m,type:y,value:v}=n;if(y==="image"){let x=m?`${m}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else m&&u.append(m,v)}}else{if(Uu(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=mu,l=null,o=gu,d=n}return u&&o==="text/plain"&&(d=u,u=void 0),{action:l,method:s.toLowerCase(),encType:o,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function op(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function xj(n,t,s){let l=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return l.pathname==="/"?l.pathname=`_root.${s}`:t&&Ds(l.pathname,t)==="/"?l.pathname=`${t.replace(/\/$/,"")}/_root.${s}`:l.pathname=`${l.pathname.replace(/\/$/,"")}.${s}`,l}async function bj(n,t){if(n.id in t)return t[n.id];try{let s=await import(n.module);return t[n.id]=s,s}catch(s){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function wj(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Sj(n,t,s){let l=await Promise.all(n.map(async o=>{let u=t.routes[o.route.id];if(u){let d=await bj(u,s);return d.links?d.links():[]}return[]}));return Nj(l.flat(1).filter(wj).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function fv(n,t,s,l,o,u){let d=(p,m)=>s[m]?p.route.id!==s[m].route.id:!0,h=(p,m)=>s[m].pathname!==p.pathname||s[m].route.path?.endsWith("*")&&s[m].params["*"]!==p.params["*"];return u==="assets"?t.filter((p,m)=>d(p,m)||h(p,m)):u==="data"?t.filter((p,m)=>{let y=l.routes[p.route.id];if(!y||!y.hasLoader)return!1;if(d(p,m)||h(p,m))return!0;if(p.route.shouldRevalidate){let v=p.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:p.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function jj(n,t,{includeHydrateFallback:s}={}){return _j(n.map(l=>{let o=t.routes[l.route.id];if(!o)return[];let u=[o.module];return o.clientActionModule&&(u=u.concat(o.clientActionModule)),o.clientLoaderModule&&(u=u.concat(o.clientLoaderModule)),s&&o.hydrateFallbackModule&&(u=u.concat(o.hydrateFallbackModule)),o.imports&&(u=u.concat(o.imports)),u}).flat(1))}function _j(n){return[...new Set(n)]}function Cj(n){let t={},s=Object.keys(n).sort();for(let l of s)t[l]=n[l];return t}function Nj(n,t){let s=new Set;return new Set(t),n.reduce((l,o)=>{let u=JSON.stringify(Cj(o));return s.has(u)||(s.add(u),l.push({key:u,link:o})),l},[])}function e0(){let n=b.useContext(tl);return op(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function Ej(){let n=b.useContext(Mu);return op(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var cp=b.createContext(void 0);cp.displayName="FrameworkContext";function t0(){let n=b.useContext(cp);return op(n,"You must render this element inside a <HydratedRouter> element"),n}function Tj(n,t){let s=b.useContext(cp),[l,o]=b.useState(!1),[u,d]=b.useState(!1),{onFocus:h,onBlur:p,onMouseEnter:m,onMouseLeave:y,onTouchStart:v}=t,x=b.useRef(null);b.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let N=T=>{T.forEach(D=>{d(D.isIntersecting)})},j=new IntersectionObserver(N,{threshold:.5});return x.current&&j.observe(x.current),()=>{j.disconnect()}}},[n]),b.useEffect(()=>{if(l){let N=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(N)}}},[l]);let S=()=>{o(!0)},_=()=>{o(!1),d(!1)};return s?n!=="intent"?[u,x,{}]:[u,x,{onFocus:ro(h,S),onBlur:ro(p,_),onMouseEnter:ro(m,S),onMouseLeave:ro(y,_),onTouchStart:ro(v,S)}]:[!1,x,{}]}function ro(n,t){return s=>{n&&n(s),s.defaultPrevented||t(s)}}function Rj({page:n,...t}){let{router:s}=e0(),l=b.useMemo(()=>Ix(s.routes,n,s.basename),[s.routes,n,s.basename]);return l?b.createElement(Aj,{page:n,matches:l,...t}):null}function kj(n){let{manifest:t,routeModules:s}=t0(),[l,o]=b.useState([]);return b.useEffect(()=>{let u=!1;return Sj(n,t,s).then(d=>{u||o(d)}),()=>{u=!0}},[n,t,s]),l}function Aj({page:n,matches:t,...s}){let l=Us(),{manifest:o,routeModules:u}=t0(),{basename:d}=e0(),{loaderData:h,matches:p}=Ej(),m=b.useMemo(()=>fv(n,t,p,o,l,"data"),[n,t,p,o,l]),y=b.useMemo(()=>fv(n,t,p,o,l,"assets"),[n,t,p,o,l]),v=b.useMemo(()=>{if(n===l.pathname+l.search+l.hash)return[];let _=new Set,N=!1;if(t.forEach(T=>{let D=o.routes[T.route.id];!D||!D.hasLoader||(!m.some(M=>M.route.id===T.route.id)&&T.route.id in h&&u[T.route.id]?.shouldRevalidate||D.hasClientLoader?N=!0:_.add(T.route.id))}),_.size===0)return[];let j=xj(n,d,"data");return N&&_.size>0&&j.searchParams.set("_routes",t.filter(T=>_.has(T.route.id)).map(T=>T.route.id).join(",")),[j.pathname+j.search]},[d,h,l,o,m,t,n,u]),x=b.useMemo(()=>jj(y,o),[y,o]),S=kj(y);return b.createElement(b.Fragment,null,v.map(_=>b.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...s})),x.map(_=>b.createElement("link",{key:_,rel:"modulepreload",href:_,...s})),S.map(({key:_,link:N})=>b.createElement("link",{key:_,nonce:s.nonce,...N})))}function Oj(...n){return t=>{n.forEach(s=>{typeof s=="function"?s(t):s!=null&&(s.current=t)})}}var Dj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Dj&&(window.__reactRouterVersion="7.11.0")}catch{}function Mj({basename:n,children:t,unstable_useTransitions:s,window:l}){let o=b.useRef();o.current==null&&(o.current=pS({window:l,v5Compat:!0}));let u=o.current,[d,h]=b.useState({action:u.action,location:u.location}),p=b.useCallback(m=>{s===!1?h(m):b.startTransition(()=>h(m))},[s]);return b.useLayoutEffect(()=>u.listen(p),[u,p]),b.createElement(cj,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:s})}var n0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,r0=b.forwardRef(function({onClick:t,discover:s="render",prefetch:l="none",relative:o,reloadDocument:u,replace:d,state:h,target:p,to:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...S},_){let{basename:N,unstable_useTransitions:j}=b.useContext($r),T=typeof m=="string"&&n0.test(m),D=Gx(m,N);m=D.to;let M=YS(m,{relative:o}),[$,U,C]=Tj(l,S),z=Ij(m,{replace:d,state:h,target:p,preventScrollReset:y,relative:o,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:j});function R(K){t&&t(K),K.defaultPrevented||z(K)}let F=b.createElement("a",{...S,...C,href:D.absoluteURL||M,onClick:D.isExternal||u?t:R,ref:Oj(_,U),target:p,"data-discover":!T&&s==="render"?"true":void 0});return $&&!T?b.createElement(b.Fragment,null,F,b.createElement(Rj,{page:M})):F});r0.displayName="Link";var zj=b.forwardRef(function({"aria-current":t="page",caseSensitive:s=!1,className:l="",end:o=!1,style:u,to:d,viewTransition:h,children:p,...m},y){let v=Uo(d,{relative:m.relative}),x=Us(),S=b.useContext(Mu),{navigator:_,basename:N}=b.useContext($r),j=S!=null&&Fj(v)&&h===!0,T=_.encodeLocation?_.encodeLocation(v).pathname:v.pathname,D=x.pathname,M=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;s||(D=D.toLowerCase(),M=M?M.toLowerCase():null,T=T.toLowerCase()),M&&N&&(M=Ds(M,N)||M);const $=T!=="/"&&T.endsWith("/")?T.length-1:T.length;let U=D===T||!o&&D.startsWith(T)&&D.charAt($)==="/",C=M!=null&&(M===T||!o&&M.startsWith(T)&&M.charAt(T.length)==="/"),z={isActive:U,isPending:C,isTransitioning:j},R=U?t:void 0,F;typeof l=="function"?F=l(z):F=[l,U?"active":null,C?"pending":null,j?"transitioning":null].filter(Boolean).join(" ");let K=typeof u=="function"?u(z):u;return b.createElement(r0,{...m,"aria-current":R,className:F,ref:y,style:K,to:d,viewTransition:h},typeof p=="function"?p(z):p)});zj.displayName="NavLink";var Uj=b.forwardRef(({discover:n="render",fetcherKey:t,navigate:s,reloadDocument:l,replace:o,state:u,method:d=mu,action:h,onSubmit:p,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...S},_)=>{let{unstable_useTransitions:N}=b.useContext($r),j=Pj(),T=qj(h,{relative:m}),D=d.toLowerCase()==="get"?"get":"post",M=typeof h=="string"&&n0.test(h),$=U=>{if(p&&p(U),U.defaultPrevented)return;U.preventDefault();let C=U.nativeEvent.submitter,z=C?.getAttribute("formmethod")||d,R=()=>j(C||U.currentTarget,{fetcherKey:t,method:z,navigate:s,replace:o,state:u,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});N&&s!==!1?b.startTransition(()=>R()):R()};return b.createElement("form",{ref:_,method:D,action:T,onSubmit:l?p:$,...S,"data-discover":!M&&n==="render"?"true":void 0})});Uj.displayName="Form";function Lj(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function s0(n){let t=b.useContext(tl);return qn(t,Lj(n)),t}function Ij(n,{target:t,replace:s,state:l,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:h,unstable_useTransitions:p}={}){let m=Jx(),y=Us(),v=Uo(n,{relative:u});return b.useCallback(x=>{if(pj(x,t)){x.preventDefault();let S=s!==void 0?s:xo(y)===xo(v),_=()=>m(n,{replace:S,state:l,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:h});p?b.startTransition(()=>_()):_()}},[y,m,v,s,l,t,n,o,u,d,h,p])}function Lo(n){Br(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=b.useRef(If(n)),s=b.useRef(!1),l=Us(),o=b.useMemo(()=>mj(l.search,s.current?null:t.current),[l.search]),u=Jx(),d=b.useCallback((h,p)=>{const m=If(typeof h=="function"?h(new URLSearchParams(o)):h);s.current=!0,u("?"+m,p)},[u,o]);return[o,d]}var Bj=0,$j=()=>`__${String(++Bj)}__`;function Pj(){let{router:n}=s0("useSubmit"),{basename:t}=b.useContext($r),s=ij(),l=n.fetch,o=n.navigate;return b.useCallback(async(u,d={})=>{let{action:h,method:p,encType:m,formData:y,body:v}=vj(u,t);if(d.navigate===!1){let x=d.fetcherKey||$j();await l(x,s,d.action||h,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||p,formEncType:d.encType||m,flushSync:d.flushSync})}else await o(d.action||h,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||p,formEncType:d.encType||m,replace:d.replace,state:d.state,fromRouteId:s,flushSync:d.flushSync,viewTransition:d.viewTransition})},[l,o,t,s])}function qj(n,{relative:t}={}){let{basename:s}=b.useContext($r),l=b.useContext(zs);qn(l,"useFormAction must be used inside a RouteContext");let[o]=l.matches.slice(-1),u={...Uo(n||".",{relative:t})},d=Us();if(n==null){u.search=d.search;let h=new URLSearchParams(u.search),p=h.getAll("index");if(p.some(y=>y==="")){h.delete("index"),p.filter(v=>v).forEach(v=>h.append("index",v));let y=h.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&o.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(u.pathname=u.pathname==="/"?s:Os([s,u.pathname])),xo(u)}function Fj(n,{relative:t}={}){let s=b.useContext(Kx);qn(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=s0("useViewTransitionState"),o=Uo(n,{relative:t});if(!s.isTransitioning)return!1;let u=Ds(s.currentLocation.pathname,l)||s.currentLocation.pathname,d=Ds(s.nextLocation.pathname,l)||s.nextLocation.pathname;return Su(o.pathname,d)!=null||Su(o.pathname,u)!=null}var Ki=Lx();const Hj=({children:n})=>(Us(),i.jsxs("div",{className:"app-layout",children:[i.jsx("header",{className:"app-header",children:i.jsx("div",{className:"container app-header__content",children:i.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),i.jsx("main",{className:"container app-main",children:n}),i.jsx("footer",{className:"app-footer",children:i.jsx("div",{className:"container",children:i.jsx("p",{children:" 2026 recipe management"})})})]})),tn=({children:n,className:t="",hoverable:s=!1,...l})=>i.jsx("div",{className:`glass-card ${s?"glass-card--hoverable":""} ${t}`,...l,children:n}),le=({children:n,variant:t="primary",size:s="md",isLoading:l,block:o,className:u="",...d})=>{const h=["btn",`btn--${t}`,`btn--${s}`,o?"btn--block":"",l?"btn--loading":"",u].filter(Boolean).join(" ");return i.jsxs("button",{className:h,disabled:l,...d,children:[l&&i.jsx("span",{className:"btn__spinner"}),i.jsx("span",{className:"btn__content",children:n})]})};function Gj(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return b.useMemo(()=>l=>{t.forEach(o=>o(l))},t)}const Lu=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function nl(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function up(n){return"nodeType"in n}function or(n){var t,s;return n?nl(n)?n:up(n)&&(t=(s=n.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function dp(n){const{Document:t}=or(n);return n instanceof t}function Io(n){return nl(n)?!1:n instanceof or(n).HTMLElement}function i0(n){return n instanceof or(n).SVGElement}function rl(n){return n?nl(n)?n.document:up(n)?dp(n)?n:Io(n)||i0(n)?n.ownerDocument:document:document:document}const Jr=Lu?b.useLayoutEffect:b.useEffect;function Iu(n){const t=b.useRef(n);return Jr(()=>{t.current=n}),b.useCallback(function(){for(var s=arguments.length,l=new Array(s),o=0;o<s;o++)l[o]=arguments[o];return t.current==null?void 0:t.current(...l)},[])}function Vj(){const n=b.useRef(null),t=b.useCallback((l,o)=>{n.current=setInterval(l,o)},[]),s=b.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,s]}function bo(n,t){t===void 0&&(t=[n]);const s=b.useRef(n);return Jr(()=>{s.current!==n&&(s.current=n)},t),s}function Bo(n,t){const s=b.useRef();return b.useMemo(()=>{const l=n(s.current);return s.current=l,l},[...t])}function ju(n){const t=Iu(n),s=b.useRef(null),l=b.useCallback(o=>{o!==s.current&&t?.(o,s.current),s.current=o},[]);return[s,l]}function _u(n){const t=b.useRef();return b.useEffect(()=>{t.current=n},[n]),t.current}let nf={};function $o(n,t){return b.useMemo(()=>{if(t)return t;const s=nf[n]==null?0:nf[n]+1;return nf[n]=s,n+"-"+s},[n,t])}function a0(n){return function(t){for(var s=arguments.length,l=new Array(s>1?s-1:0),o=1;o<s;o++)l[o-1]=arguments[o];return l.reduce((u,d)=>{const h=Object.entries(d);for(const[p,m]of h){const y=u[p];y!=null&&(u[p]=y+n*m)}return u},{...t})}}const Xa=a0(1),wo=a0(-1);function Kj(n){return"clientX"in n&&"clientY"in n}function Bu(n){if(!n)return!1;const{KeyboardEvent:t}=or(n.target);return t&&n instanceof t}function Yj(n){if(!n)return!1;const{TouchEvent:t}=or(n.target);return t&&n instanceof t}function Cu(n){if(Yj(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:s}=n.touches[0];return{x:t,y:s}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:s}=n.changedTouches[0];return{x:t,y:s}}}return Kj(n)?{x:n.clientX,y:n.clientY}:null}const Tr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:s}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:s}=n;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(n){if(n)return[Tr.Translate.toString(n),Tr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:s,easing:l}=n;return t+" "+s+"ms "+l}}}),pv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Qj(n){return n.matches(pv)?n:n.querySelector(pv)}const Wj={display:"none"};function Jj(n){let{id:t,value:s}=n;return _e.createElement("div",{id:t,style:Wj},s)}function Xj(n){let{id:t,announcement:s,ariaLiveType:l="assertive"}=n;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return _e.createElement("div",{id:t,style:o,role:"status","aria-live":l,"aria-atomic":!0},s)}function Zj(){const[n,t]=b.useState("");return{announce:b.useCallback(l=>{l!=null&&t(l)},[]),announcement:n}}const l0=b.createContext(null);function e_(n){const t=b.useContext(l0);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function t_(){const[n]=b.useState(()=>new Set),t=b.useCallback(l=>(n.add(l),()=>n.delete(l)),[n]);return[b.useCallback(l=>{let{type:o,event:u}=l;n.forEach(d=>{var h;return(h=d[o])==null?void 0:h.call(d,u)})},[n]),t]}const n_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},r_={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:s}=n;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function s_(n){let{announcements:t=r_,container:s,hiddenTextDescribedById:l,screenReaderInstructions:o=n_}=n;const{announce:u,announcement:d}=Zj(),h=$o("DndLiveRegion"),[p,m]=b.useState(!1);if(b.useEffect(()=>{m(!0)},[]),e_(b.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:S}=v;t.onDragMove&&u(t.onDragMove({active:x,over:S}))},onDragOver(v){let{active:x,over:S}=v;u(t.onDragOver({active:x,over:S}))},onDragEnd(v){let{active:x,over:S}=v;u(t.onDragEnd({active:x,over:S}))},onDragCancel(v){let{active:x,over:S}=v;u(t.onDragCancel({active:x,over:S}))}}),[u,t])),!p)return null;const y=_e.createElement(_e.Fragment,null,_e.createElement(Jj,{id:l,value:o.draggable}),_e.createElement(Xj,{id:h,announcement:d}));return s?Ki.createPortal(y,s):y}var $n;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})($n||($n={}));function Nu(){}function gr(n,t){return b.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function sl(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return b.useMemo(()=>[...t].filter(l=>l!=null),[...t])}const Xr=Object.freeze({x:0,y:0});function hp(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function i_(n,t){const s=Cu(n);if(!s)return"0 0";const l={x:(s.x-t.left)/t.width*100,y:(s.y-t.top)/t.height*100};return l.x+"% "+l.y+"%"}function fp(n,t){let{data:{value:s}}=n,{data:{value:l}}=t;return s-l}function a_(n,t){let{data:{value:s}}=n,{data:{value:l}}=t;return l-s}function Bf(n){let{left:t,top:s,height:l,width:o}=n;return[{x:t,y:s},{x:t+o,y:s},{x:t,y:s+l},{x:t+o,y:s+l}]}function o0(n,t){if(!n||n.length===0)return null;const[s]=n;return s[t]}function mv(n,t,s){return t===void 0&&(t=n.left),s===void 0&&(s=n.top),{x:t+n.width*.5,y:s+n.height*.5}}const $f=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const o=mv(t,t.left,t.top),u=[];for(const d of l){const{id:h}=d,p=s.get(h);if(p){const m=hp(mv(p),o);u.push({id:h,data:{droppableContainer:d,value:m}})}}return u.sort(fp)},l_=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const o=Bf(t),u=[];for(const d of l){const{id:h}=d,p=s.get(h);if(p){const m=Bf(p),y=o.reduce((x,S,_)=>x+hp(m[_],S),0),v=Number((y/4).toFixed(4));u.push({id:h,data:{droppableContainer:d,value:v}})}}return u.sort(fp)};function o_(n,t){const s=Math.max(t.top,n.top),l=Math.max(t.left,n.left),o=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=o-l,h=u-s;if(l<o&&s<u){const p=t.width*t.height,m=n.width*n.height,y=d*h,v=y/(p+m-y);return Number(v.toFixed(4))}return 0}const c_=n=>{let{collisionRect:t,droppableRects:s,droppableContainers:l}=n;const o=[];for(const u of l){const{id:d}=u,h=s.get(d);if(h){const p=o_(h,t);p>0&&o.push({id:d,data:{droppableContainer:u,value:p}})}}return o.sort(a_)};function u_(n,t){const{top:s,left:l,bottom:o,right:u}=t;return s<=n.y&&n.y<=o&&l<=n.x&&n.x<=u}const c0=n=>{let{droppableContainers:t,droppableRects:s,pointerCoordinates:l}=n;if(!l)return[];const o=[];for(const u of t){const{id:d}=u,h=s.get(d);if(h&&u_(l,h)){const m=Bf(h).reduce((v,x)=>v+hp(l,x),0),y=Number((m/4).toFixed(4));o.push({id:d,data:{droppableContainer:u,value:y}})}}return o.sort(fp)};function d_(n,t,s){return{...n,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function u0(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:Xr}function h_(n){return function(s){for(var l=arguments.length,o=new Array(l>1?l-1:0),u=1;u<l;u++)o[u-1]=arguments[u];return o.reduce((d,h)=>({...d,top:d.top+n*h.y,bottom:d.bottom+n*h.y,left:d.left+n*h.x,right:d.right+n*h.x}),{...s})}}const f_=h_(1);function d0(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function p_(n,t,s){const l=d0(t);if(!l)return n;const{scaleX:o,scaleY:u,x:d,y:h}=l,p=n.left-d-(1-o)*parseFloat(s),m=n.top-h-(1-u)*parseFloat(s.slice(s.indexOf(" ")+1)),y=o?n.width/o:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:m,right:p+y,bottom:m+v,left:p}}const m_={ignoreTransform:!1};function il(n,t){t===void 0&&(t=m_);let s=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:m,transformOrigin:y}=or(n).getComputedStyle(n);m&&(s=p_(s,m,y))}const{top:l,left:o,width:u,height:d,bottom:h,right:p}=s;return{top:l,left:o,width:u,height:d,bottom:h,right:p}}function gv(n){return il(n,{ignoreTransform:!0})}function g_(n){const t=n.innerWidth,s=n.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function y_(n,t){return t===void 0&&(t=or(n).getComputedStyle(n)),t.position==="fixed"}function v_(n,t){t===void 0&&(t=or(n).getComputedStyle(n));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const u=t[o];return typeof u=="string"?s.test(u):!1})}function $u(n,t){const s=[];function l(o){if(t!=null&&s.length>=t||!o)return s;if(dp(o)&&o.scrollingElement!=null&&!s.includes(o.scrollingElement))return s.push(o.scrollingElement),s;if(!Io(o)||i0(o)||s.includes(o))return s;const u=or(n).getComputedStyle(o);return o!==n&&v_(o,u)&&s.push(o),y_(o,u)?s:l(o.parentNode)}return n?l(n):s}function h0(n){const[t]=$u(n,1);return t??null}function rf(n){return!Lu||!n?null:nl(n)?n:up(n)?dp(n)||n===rl(n).scrollingElement?window:Io(n)?n:null:null}function f0(n){return nl(n)?n.scrollX:n.scrollLeft}function p0(n){return nl(n)?n.scrollY:n.scrollTop}function Pf(n){return{x:f0(n),y:p0(n)}}var Hn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Hn||(Hn={}));function m0(n){return!Lu||!n?!1:n===document.scrollingElement}function g0(n){const t={x:0,y:0},s=m0(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},l={x:n.scrollWidth-s.width,y:n.scrollHeight-s.height},o=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=l.y,h=n.scrollLeft>=l.x;return{isTop:o,isLeft:u,isBottom:d,isRight:h,maxScroll:l,minScroll:t}}const x_={x:.2,y:.2};function b_(n,t,s,l,o){let{top:u,left:d,right:h,bottom:p}=s;l===void 0&&(l=10),o===void 0&&(o=x_);const{isTop:m,isBottom:y,isLeft:v,isRight:x}=g0(n),S={x:0,y:0},_={x:0,y:0},N={height:t.height*o.y,width:t.width*o.x};return!m&&u<=t.top+N.height?(S.y=Hn.Backward,_.y=l*Math.abs((t.top+N.height-u)/N.height)):!y&&p>=t.bottom-N.height&&(S.y=Hn.Forward,_.y=l*Math.abs((t.bottom-N.height-p)/N.height)),!x&&h>=t.right-N.width?(S.x=Hn.Forward,_.x=l*Math.abs((t.right-N.width-h)/N.width)):!v&&d<=t.left+N.width&&(S.x=Hn.Backward,_.x=l*Math.abs((t.left+N.width-d)/N.width)),{direction:S,speed:_}}function w_(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:s,right:l,bottom:o}=n.getBoundingClientRect();return{top:t,left:s,right:l,bottom:o,width:n.clientWidth,height:n.clientHeight}}function y0(n){return n.reduce((t,s)=>Xa(t,Pf(s)),Xr)}function S_(n){return n.reduce((t,s)=>t+f0(s),0)}function j_(n){return n.reduce((t,s)=>t+p0(s),0)}function v0(n,t){if(t===void 0&&(t=il),!n)return;const{top:s,left:l,bottom:o,right:u}=t(n);h0(n)&&(o<=0||u<=0||s>=window.innerHeight||l>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const __=[["x",["left","right"],S_],["y",["top","bottom"],j_]];class pp{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const l=$u(s),o=y0(l);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,h]of __)for(const p of d)Object.defineProperty(this,p,{get:()=>{const m=h(l),y=o[u]-m;return this.rect[p]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class po{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var l;return(l=this.target)==null?void 0:l.removeEventListener(...s)})},this.target=t}add(t,s,l){var o;(o=this.target)==null||o.addEventListener(t,s,l),this.listeners.push([t,s,l])}}function C_(n){const{EventTarget:t}=or(n);return n instanceof t?n:rl(n)}function sf(n,t){const s=Math.abs(n.x),l=Math.abs(n.y);return typeof t=="number"?Math.sqrt(s**2+l**2)>t:"x"in t&&"y"in t?s>t.x&&l>t.y:"x"in t?s>t.x:"y"in t?l>t.y:!1}var Ir;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Ir||(Ir={}));function yv(n){n.preventDefault()}function N_(n){n.stopPropagation()}var Gt;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(Gt||(Gt={}));const x0={start:[Gt.Space,Gt.Enter],cancel:[Gt.Esc],end:[Gt.Space,Gt.Enter,Gt.Tab]},E_=(n,t)=>{let{currentCoordinates:s}=t;switch(n.code){case Gt.Right:return{...s,x:s.x+25};case Gt.Left:return{...s,x:s.x-25};case Gt.Down:return{...s,y:s.y+25};case Gt.Up:return{...s,y:s.y-25}}};class al{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new po(rl(s)),this.windowListeners=new po(or(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ir.Resize,this.handleCancel),this.windowListeners.add(Ir.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ir.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,l=t.node.current;l&&v0(l),s(Xr)}handleKeyDown(t){if(Bu(t)){const{active:s,context:l,options:o}=this.props,{keyboardCodes:u=x0,coordinateGetter:d=E_,scrollBehavior:h="smooth"}=o,{code:p}=t;if(u.end.includes(p)){this.handleEnd(t);return}if(u.cancel.includes(p)){this.handleCancel(t);return}const{collisionRect:m}=l.current,y=m?{x:m.left,y:m.top}:Xr;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:s,context:l.current,currentCoordinates:y});if(v){const x=wo(v,y),S={x:0,y:0},{scrollableAncestors:_}=l.current;for(const N of _){const j=t.code,{isTop:T,isRight:D,isLeft:M,isBottom:$,maxScroll:U,minScroll:C}=g0(N),z=w_(N),R={x:Math.min(j===Gt.Right?z.right-z.width/2:z.right,Math.max(j===Gt.Right?z.left:z.left+z.width/2,v.x)),y:Math.min(j===Gt.Down?z.bottom-z.height/2:z.bottom,Math.max(j===Gt.Down?z.top:z.top+z.height/2,v.y))},F=j===Gt.Right&&!D||j===Gt.Left&&!M,K=j===Gt.Down&&!$||j===Gt.Up&&!T;if(F&&R.x!==v.x){const G=N.scrollLeft+x.x,q=j===Gt.Right&&G<=U.x||j===Gt.Left&&G>=C.x;if(q&&!x.y){N.scrollTo({left:G,behavior:h});return}q?S.x=N.scrollLeft-G:S.x=j===Gt.Right?N.scrollLeft-U.x:N.scrollLeft-C.x,S.x&&N.scrollBy({left:-S.x,behavior:h});break}else if(K&&R.y!==v.y){const G=N.scrollTop+x.y,q=j===Gt.Down&&G<=U.y||j===Gt.Up&&G>=C.y;if(q&&!x.x){N.scrollTo({top:G,behavior:h});return}q?S.y=N.scrollTop-G:S.y=j===Gt.Down?N.scrollTop-U.y:N.scrollTop-C.y,S.y&&N.scrollBy({top:-S.y,behavior:h});break}}this.handleMove(t,Xa(wo(v,this.referenceCoordinates),S))}}}handleMove(t,s){const{onMove:l}=this.props;t.preventDefault(),l(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}al.activators=[{eventName:"onKeyDown",handler:(n,t,s)=>{let{keyboardCodes:l=x0,onActivation:o}=t,{active:u}=s;const{code:d}=n.nativeEvent;if(l.start.includes(d)){const h=u.activatorNode.current;return h&&n.target!==h?!1:(n.preventDefault(),o?.({event:n.nativeEvent}),!0)}return!1}}];function vv(n){return!!(n&&"distance"in n)}function xv(n){return!!(n&&"delay"in n)}class mp{constructor(t,s,l){var o;l===void 0&&(l=C_(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:u}=t,{target:d}=u;this.props=t,this.events=s,this.document=rl(d),this.documentListeners=new po(this.document),this.listeners=new po(l),this.windowListeners=new po(or(d)),this.initialCoordinates=(o=Cu(u))!=null?o:Xr,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:l}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ir.Resize,this.handleCancel),this.windowListeners.add(Ir.DragStart,yv),this.windowListeners.add(Ir.VisibilityChange,this.handleCancel),this.windowListeners.add(Ir.ContextMenu,yv),this.documentListeners.add(Ir.Keydown,this.handleKeydown),s){if(l!=null&&l({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(xv(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(vv(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:l,onPending:o}=this.props;o(l,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ir.Click,N_,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ir.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:l,initialCoordinates:o,props:u}=this,{onMove:d,options:{activationConstraint:h}}=u;if(!o)return;const p=(s=Cu(t))!=null?s:Xr,m=wo(o,p);if(!l&&h){if(vv(h)){if(h.tolerance!=null&&sf(m,h.tolerance))return this.handleCancel();if(sf(m,h.distance))return this.handleStart()}if(xv(h)&&sf(m,h.tolerance))return this.handleCancel();this.handlePending(h,m);return}t.cancelable&&t.preventDefault(),d(p)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===Gt.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const T_={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Pu extends mp{constructor(t){const{event:s}=t,l=rl(s.target);super(t,T_,l)}}Pu.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;return!s.isPrimary||s.button!==0?!1:(l?.({event:s}),!0)}}];const R_={move:{name:"mousemove"},end:{name:"mouseup"}};var qf;(function(n){n[n.RightClick=2]="RightClick"})(qf||(qf={}));class Po extends mp{constructor(t){super(t,R_,rl(t.event.target))}}Po.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;return s.button===qf.RightClick?!1:(l?.({event:s}),!0)}}];const af={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class qo extends mp{constructor(t){super(t,af)}static setup(){return window.addEventListener(af.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(af.move.name,t)};function t(){}}}qo.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:s}=n,{onActivation:l}=t;const{touches:o}=s;return o.length>1?!1:(l?.({event:s}),!0)}}];var mo;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(mo||(mo={}));var Eu;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Eu||(Eu={}));function k_(n){let{acceleration:t,activator:s=mo.Pointer,canScroll:l,draggingRect:o,enabled:u,interval:d=5,order:h=Eu.TreeOrder,pointerCoordinates:p,scrollableAncestors:m,scrollableAncestorRects:y,delta:v,threshold:x}=n;const S=O_({delta:v,disabled:!u}),[_,N]=Vj(),j=b.useRef({x:0,y:0}),T=b.useRef({x:0,y:0}),D=b.useMemo(()=>{switch(s){case mo.Pointer:return p?{top:p.y,bottom:p.y,left:p.x,right:p.x}:null;case mo.DraggableRect:return o}},[s,o,p]),M=b.useRef(null),$=b.useCallback(()=>{const C=M.current;if(!C)return;const z=j.current.x*T.current.x,R=j.current.y*T.current.y;C.scrollBy(z,R)},[]),U=b.useMemo(()=>h===Eu.TreeOrder?[...m].reverse():m,[h,m]);b.useEffect(()=>{if(!u||!m.length||!D){N();return}for(const C of U){if(l?.(C)===!1)continue;const z=m.indexOf(C),R=y[z];if(!R)continue;const{direction:F,speed:K}=b_(C,R,D,t,x);for(const G of["x","y"])S[G][F[G]]||(K[G]=0,F[G]=0);if(K.x>0||K.y>0){N(),M.current=C,_($,d),j.current=K,T.current=F;return}}j.current={x:0,y:0},T.current={x:0,y:0},N()},[t,$,l,N,u,d,JSON.stringify(D),JSON.stringify(S),_,m,U,y,JSON.stringify(x)])}const A_={x:{[Hn.Backward]:!1,[Hn.Forward]:!1},y:{[Hn.Backward]:!1,[Hn.Forward]:!1}};function O_(n){let{delta:t,disabled:s}=n;const l=_u(t);return Bo(o=>{if(s||!l||!o)return A_;const u={x:Math.sign(t.x-l.x),y:Math.sign(t.y-l.y)};return{x:{[Hn.Backward]:o.x[Hn.Backward]||u.x===-1,[Hn.Forward]:o.x[Hn.Forward]||u.x===1},y:{[Hn.Backward]:o.y[Hn.Backward]||u.y===-1,[Hn.Forward]:o.y[Hn.Forward]||u.y===1}}},[s,t,l])}function D_(n,t){const s=t!=null?n.get(t):void 0,l=s?s.node.current:null;return Bo(o=>{var u;return t==null?null:(u=l??o)!=null?u:null},[l,t])}function M_(n,t){return b.useMemo(()=>n.reduce((s,l)=>{const{sensor:o}=l,u=o.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,l)}));return[...s,...u]},[]),[n,t])}var So;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(So||(So={}));var Ff;(function(n){n.Optimized="optimized"})(Ff||(Ff={}));const bv=new Map;function z_(n,t){let{dragging:s,dependencies:l,config:o}=t;const[u,d]=b.useState(null),{frequency:h,measure:p,strategy:m}=o,y=b.useRef(n),v=j(),x=bo(v),S=b.useCallback(function(T){T===void 0&&(T=[]),!x.current&&d(D=>D===null?T:D.concat(T.filter(M=>!D.includes(M))))},[x]),_=b.useRef(null),N=Bo(T=>{if(v&&!s)return bv;if(!T||T===bv||y.current!==n||u!=null){const D=new Map;for(let M of n){if(!M)continue;if(u&&u.length>0&&!u.includes(M.id)&&M.rect.current){D.set(M.id,M.rect.current);continue}const $=M.node.current,U=$?new pp(p($),$):null;M.rect.current=U,U&&D.set(M.id,U)}return D}return T},[n,u,s,v,p]);return b.useEffect(()=>{y.current=n},[n]),b.useEffect(()=>{v||S()},[s,v]),b.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),b.useEffect(()=>{v||typeof h!="number"||_.current!==null||(_.current=setTimeout(()=>{S(),_.current=null},h))},[h,v,S,...l]),{droppableRects:N,measureDroppableContainers:S,measuringScheduled:u!=null};function j(){switch(m){case So.Always:return!1;case So.BeforeDragging:return s;default:return!s}}}function gp(n,t){return Bo(s=>n?s||(typeof t=="function"?t(n):n):null,[t,n])}function U_(n,t){return gp(n,t)}function L_(n){let{callback:t,disabled:s}=n;const l=Iu(t),o=b.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(l)},[l,s]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function qu(n){let{callback:t,disabled:s}=n;const l=Iu(t),o=b.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(l)},[s]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function I_(n){return new pp(il(n),n)}function wv(n,t,s){t===void 0&&(t=I_);const[l,o]=b.useState(null);function u(){o(p=>{if(!n)return null;if(n.isConnected===!1){var m;return(m=p??s)!=null?m:null}const y=t(n);return JSON.stringify(p)===JSON.stringify(y)?p:y})}const d=L_({callback(p){if(n)for(const m of p){const{type:y,target:v}=m;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),h=qu({callback:u});return Jr(()=>{u(),n?(h?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(h?.disconnect(),d?.disconnect())},[n]),l}function B_(n){const t=gp(n);return u0(n,t)}const Sv=[];function $_(n){const t=b.useRef(n),s=Bo(l=>n?l&&l!==Sv&&n&&t.current&&n.parentNode===t.current.parentNode?l:$u(n):Sv,[n]);return b.useEffect(()=>{t.current=n},[n]),s}function P_(n){const[t,s]=b.useState(null),l=b.useRef(n),o=b.useCallback(u=>{const d=rf(u.target);d&&s(h=>h?(h.set(d,Pf(d)),new Map(h)):null)},[]);return b.useEffect(()=>{const u=l.current;if(n!==u){d(u);const h=n.map(p=>{const m=rf(p);return m?(m.addEventListener("scroll",o,{passive:!0}),[m,Pf(m)]):null}).filter(p=>p!=null);s(h.length?new Map(h):null),l.current=n}return()=>{d(n),d(u)};function d(h){h.forEach(p=>{const m=rf(p);m?.removeEventListener("scroll",o)})}},[o,n]),b.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>Xa(u,d),Xr):y0(n):Xr,[n,t])}function jv(n,t){t===void 0&&(t=[]);const s=b.useRef(null);return b.useEffect(()=>{s.current=null},t),b.useEffect(()=>{const l=n!==Xr;l&&!s.current&&(s.current=n),!l&&s.current&&(s.current=null)},[n]),s.current?wo(n,s.current):Xr}function q_(n){b.useEffect(()=>{if(!Lu)return;const t=n.map(s=>{let{sensor:l}=s;return l.setup==null?void 0:l.setup()});return()=>{for(const s of t)s?.()}},n.map(t=>{let{sensor:s}=t;return s}))}function F_(n,t){return b.useMemo(()=>n.reduce((s,l)=>{let{eventName:o,handler:u}=l;return s[o]=d=>{u(d,t)},s},{}),[n,t])}function b0(n){return b.useMemo(()=>n?g_(n):null,[n])}const _v=[];function H_(n,t){t===void 0&&(t=il);const[s]=n,l=b0(s?or(s):null),[o,u]=b.useState(_v);function d(){u(()=>n.length?n.map(p=>m0(p)?l:new pp(t(p),p)):_v)}const h=qu({callback:d});return Jr(()=>{h?.disconnect(),d(),n.forEach(p=>h?.observe(p))},[n]),o}function w0(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return Io(t)?t:n}function G_(n){let{measure:t}=n;const[s,l]=b.useState(null),o=b.useCallback(m=>{for(const{target:y}of m)if(Io(y)){l(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=qu({callback:o}),d=b.useCallback(m=>{const y=w0(m);u?.disconnect(),y&&u?.observe(y),l(y?t(y):null)},[t,u]),[h,p]=ju(d);return b.useMemo(()=>({nodeRef:h,rect:s,setRef:p}),[s,h,p])}const V_=[{sensor:Pu,options:{}},{sensor:al,options:{}}],K_={current:{}},yu={draggable:{measure:gv},droppable:{measure:gv,strategy:So.WhileDragging,frequency:Ff.Optimized},dragOverlay:{measure:il}};class go extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,l;return(s=(l=this.get(t))==null?void 0:l.node.current)!=null?s:void 0}}const Y_={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new go,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Nu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:yu,measureDroppableContainers:Nu,windowRect:null,measuringScheduled:!1},S0={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Nu,draggableNodes:new Map,over:null,measureDroppableContainers:Nu},Fo=b.createContext(S0),j0=b.createContext(Y_);function Q_(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new go}}}function W_(n,t){switch(t.type){case $n.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case $n.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case $n.DragEnd:case $n.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case $n.RegisterDroppable:{const{element:s}=t,{id:l}=s,o=new go(n.droppable.containers);return o.set(l,s),{...n,droppable:{...n.droppable,containers:o}}}case $n.SetDroppableDisabled:{const{id:s,key:l,disabled:o}=t,u=n.droppable.containers.get(s);if(!u||l!==u.key)return n;const d=new go(n.droppable.containers);return d.set(s,{...u,disabled:o}),{...n,droppable:{...n.droppable,containers:d}}}case $n.UnregisterDroppable:{const{id:s,key:l}=t,o=n.droppable.containers.get(s);if(!o||l!==o.key)return n;const u=new go(n.droppable.containers);return u.delete(s),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function J_(n){let{disabled:t}=n;const{active:s,activatorEvent:l,draggableNodes:o}=b.useContext(Fo),u=_u(l),d=_u(s?.id);return b.useEffect(()=>{if(!t&&!l&&u&&d!=null){if(!Bu(u)||document.activeElement===u.target)return;const h=o.get(d);if(!h)return;const{activatorNode:p,node:m}=h;if(!p.current&&!m.current)return;requestAnimationFrame(()=>{for(const y of[p.current,m.current]){if(!y)continue;const v=Qj(y);if(v){v.focus();break}}})}},[l,t,o,d,u]),null}function _0(n,t){let{transform:s,...l}=t;return n!=null&&n.length?n.reduce((o,u)=>u({transform:o,...l}),s):s}function X_(n){return b.useMemo(()=>({draggable:{...yu.draggable,...n?.draggable},droppable:{...yu.droppable,...n?.droppable},dragOverlay:{...yu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function Z_(n){let{activeNode:t,measure:s,initialRect:l,config:o=!0}=n;const u=b.useRef(!1),{x:d,y:h}=typeof o=="boolean"?{x:o,y:o}:o;Jr(()=>{if(!d&&!h||!t){u.current=!1;return}if(u.current||!l)return;const m=t?.node.current;if(!m||m.isConnected===!1)return;const y=s(m),v=u0(y,l);if(d||(v.x=0),h||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=h0(m);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,h,l,s])}const Fu=b.createContext({...Xr,scaleX:1,scaleY:1});var pi;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(pi||(pi={}));const Ji=b.memo(function(t){var s,l,o,u;let{id:d,accessibility:h,autoScroll:p=!0,children:m,sensors:y=V_,collisionDetection:v=c_,measuring:x,modifiers:S,..._}=t;const N=b.useReducer(W_,void 0,Q_),[j,T]=N,[D,M]=t_(),[$,U]=b.useState(pi.Uninitialized),C=$===pi.Initialized,{draggable:{active:z,nodes:R,translate:F},droppable:{containers:K}}=j,G=z!=null?R.get(z):null,q=b.useRef({initial:null,translated:null}),V=b.useMemo(()=>{var Xe;return z!=null?{id:z,data:(Xe=G?.data)!=null?Xe:K_,rect:q}:null},[z,G]),P=b.useRef(null),[k,E]=b.useState(null),[L,Y]=b.useState(null),oe=bo(_,Object.values(_)),ge=$o("DndDescribedBy",d),B=b.useMemo(()=>K.getEnabled(),[K]),W=X_(x),{droppableRects:Z,measureDroppableContainers:ye,measuringScheduled:Me}=z_(B,{dragging:C,dependencies:[F.x,F.y],config:W.droppable}),xe=D_(R,z),ae=b.useMemo(()=>L?Cu(L):null,[L]),O=He(),J=U_(xe,W.draggable.measure);Z_({activeNode:z!=null?R.get(z):null,config:O.layoutShiftCompensation,initialRect:J,measure:W.draggable.measure});const ce=wv(xe,W.draggable.measure,J),Se=wv(xe?xe.parentElement:null),ke=b.useRef({activatorEvent:null,active:null,activeNode:xe,collisionRect:null,collisions:null,droppableRects:Z,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:K,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Be=K.getNodeFor((s=ke.current.over)==null?void 0:s.id),Le=G_({measure:W.dragOverlay.measure}),Ge=(l=Le.nodeRef.current)!=null?l:xe,pe=C?(o=Le.rect)!=null?o:ce:null,Ye=!!(Le.nodeRef.current&&Le.rect),rt=B_(Ye?null:ce),ft=b0(Ge?or(Ge):null),St=$_(C?Be??xe:null),mt=H_(St),Dt=_0(S,{transform:{x:F.x-rt.x,y:F.y-rt.y,scaleX:1,scaleY:1},activatorEvent:L,active:V,activeNodeRect:ce,containerNodeRect:Se,draggingNodeRect:pe,over:ke.current.over,overlayNodeRect:Le.rect,scrollableAncestors:St,scrollableAncestorRects:mt,windowRect:ft}),Vt=ae?Xa(ae,F):null,wt=P_(St),ie=jv(wt),je=jv(wt,[ce]),Ce=Xa(Dt,ie),Ue=pe?f_(pe,Dt):null,st=V&&Ue?v({active:V,collisionRect:Ue,droppableRects:Z,droppableContainers:B,pointerCoordinates:Vt}):null,ct=o0(st,"id"),[Rt,Jt]=b.useState(null),wn=Ye?Dt:Xa(Dt,je),jt=d_(wn,(u=Rt?.rect)!=null?u:null,ce),rn=b.useRef(null),cn=b.useCallback((Xe,Ve)=>{let{sensor:et,options:Mt}=Ve;if(P.current==null)return;const vt=R.get(P.current);if(!vt)return;const kt=Xe.nativeEvent,Ze=new et({active:P.current,activeNode:vt,event:kt,options:Mt,context:ke,onAbort(Qe){if(!R.get(Qe))return;const{onDragAbort:Xt}=oe.current,Qt={id:Qe};Xt?.(Qt),D({type:"onDragAbort",event:Qt})},onPending(Qe,Ut,Xt,Qt){if(!R.get(Qe))return;const{onDragPending:te}=oe.current,he={id:Qe,constraint:Ut,initialCoordinates:Xt,offset:Qt};te?.(he),D({type:"onDragPending",event:he})},onStart(Qe){const Ut=P.current;if(Ut==null)return;const Xt=R.get(Ut);if(!Xt)return;const{onDragStart:Qt}=oe.current,ne={activatorEvent:kt,active:{id:Ut,data:Xt.data,rect:q}};Ki.unstable_batchedUpdates(()=>{Qt?.(ne),U(pi.Initializing),T({type:$n.DragStart,initialCoordinates:Qe,active:Ut}),D({type:"onDragStart",event:ne}),E(rn.current),Y(kt)})},onMove(Qe){T({type:$n.DragMove,coordinates:Qe})},onEnd:Bt($n.DragEnd),onCancel:Bt($n.DragCancel)});rn.current=Ze;function Bt(Qe){return async function(){const{active:Xt,collisions:Qt,over:ne,scrollAdjustedTranslate:te}=ke.current;let he=null;if(Xt&&te){const{cancelDrop:Ee}=oe.current;he={activatorEvent:kt,active:Xt,collisions:Qt,delta:te,over:ne},Qe===$n.DragEnd&&typeof Ee=="function"&&await Promise.resolve(Ee(he))&&(Qe=$n.DragCancel)}P.current=null,Ki.unstable_batchedUpdates(()=>{T({type:Qe}),U(pi.Uninitialized),Jt(null),E(null),Y(null),rn.current=null;const Ee=Qe===$n.DragEnd?"onDragEnd":"onDragCancel";if(he){const Ie=oe.current[Ee];Ie?.(he),D({type:Ee,event:he})}})}}},[R]),vn=b.useCallback((Xe,Ve)=>(et,Mt)=>{const vt=et.nativeEvent,kt=R.get(Mt);if(P.current!==null||!kt||vt.dndKit||vt.defaultPrevented)return;const Ze={active:kt};Xe(et,Ve.options,Ze)===!0&&(vt.dndKit={capturedBy:Ve.sensor},P.current=Mt,cn(et,Ve))},[R,cn]),Ln=M_(y,vn);q_(y),Jr(()=>{ce&&$===pi.Initializing&&U(pi.Initialized)},[ce,$]),b.useEffect(()=>{const{onDragMove:Xe}=oe.current,{active:Ve,activatorEvent:et,collisions:Mt,over:vt}=ke.current;if(!Ve||!et)return;const kt={active:Ve,activatorEvent:et,collisions:Mt,delta:{x:Ce.x,y:Ce.y},over:vt};Ki.unstable_batchedUpdates(()=>{Xe?.(kt),D({type:"onDragMove",event:kt})})},[Ce.x,Ce.y]),b.useEffect(()=>{const{active:Xe,activatorEvent:Ve,collisions:et,droppableContainers:Mt,scrollAdjustedTranslate:vt}=ke.current;if(!Xe||P.current==null||!Ve||!vt)return;const{onDragOver:kt}=oe.current,Ze=Mt.get(ct),Bt=Ze&&Ze.rect.current?{id:Ze.id,rect:Ze.rect.current,data:Ze.data,disabled:Ze.disabled}:null,Qe={active:Xe,activatorEvent:Ve,collisions:et,delta:{x:vt.x,y:vt.y},over:Bt};Ki.unstable_batchedUpdates(()=>{Jt(Bt),kt?.(Qe),D({type:"onDragOver",event:Qe})})},[ct]),Jr(()=>{ke.current={activatorEvent:L,active:V,activeNode:xe,collisionRect:Ue,collisions:st,droppableRects:Z,draggableNodes:R,draggingNode:Ge,draggingNodeRect:pe,droppableContainers:K,over:Rt,scrollableAncestors:St,scrollAdjustedTranslate:Ce},q.current={initial:pe,translated:Ue}},[V,xe,st,Ue,R,Ge,pe,Z,K,Rt,St,Ce]),k_({...O,delta:F,draggingRect:Ue,pointerCoordinates:Vt,scrollableAncestors:St,scrollableAncestorRects:mt});const ar=b.useMemo(()=>({active:V,activeNode:xe,activeNodeRect:ce,activatorEvent:L,collisions:st,containerNodeRect:Se,dragOverlay:Le,draggableNodes:R,droppableContainers:K,droppableRects:Z,over:Rt,measureDroppableContainers:ye,scrollableAncestors:St,scrollableAncestorRects:mt,measuringConfiguration:W,measuringScheduled:Me,windowRect:ft}),[V,xe,ce,L,st,Se,Le,R,K,Z,Rt,ye,St,mt,W,Me,ft]),me=b.useMemo(()=>({activatorEvent:L,activators:Ln,active:V,activeNodeRect:ce,ariaDescribedById:{draggable:ge},dispatch:T,draggableNodes:R,over:Rt,measureDroppableContainers:ye}),[L,Ln,V,ce,T,ge,R,Rt,ye]);return _e.createElement(l0.Provider,{value:M},_e.createElement(Fo.Provider,{value:me},_e.createElement(j0.Provider,{value:ar},_e.createElement(Fu.Provider,{value:jt},m)),_e.createElement(J_,{disabled:h?.restoreFocus===!1})),_e.createElement(s_,{...h,hiddenTextDescribedById:ge}));function He(){const Xe=k?.autoScrollEnabled===!1,Ve=typeof p=="object"?p.enabled===!1:p===!1,et=C&&!Xe&&!Ve;return typeof p=="object"?{...p,enabled:et}:{enabled:et}}}),e1=b.createContext(null),Cv="button",t1="Draggable";function yp(n){let{id:t,data:s,disabled:l=!1,attributes:o}=n;const u=$o(t1),{activators:d,activatorEvent:h,active:p,activeNodeRect:m,ariaDescribedById:y,draggableNodes:v,over:x}=b.useContext(Fo),{role:S=Cv,roleDescription:_="draggable",tabIndex:N=0}=o??{},j=p?.id===t,T=b.useContext(j?Fu:e1),[D,M]=ju(),[$,U]=ju(),C=F_(d,t),z=bo(s);Jr(()=>(v.set(t,{id:t,key:u,node:D,activatorNode:$,data:z}),()=>{const F=v.get(t);F&&F.key===u&&v.delete(t)}),[v,t]);const R=b.useMemo(()=>({role:S,tabIndex:N,"aria-disabled":l,"aria-pressed":j&&S===Cv?!0:void 0,"aria-roledescription":_,"aria-describedby":y.draggable}),[l,S,N,j,_,y.draggable]);return{active:p,activatorEvent:h,activeNodeRect:m,attributes:R,isDragging:j,listeners:l?void 0:C,node:D,over:x,setNodeRef:M,setActivatorNodeRef:U,transform:T}}function C0(){return b.useContext(j0)}const n1="Droppable",r1={timeout:25};function Ho(n){let{data:t,disabled:s=!1,id:l,resizeObserverConfig:o}=n;const u=$o(n1),{active:d,dispatch:h,over:p,measureDroppableContainers:m}=b.useContext(Fo),y=b.useRef({disabled:s}),v=b.useRef(!1),x=b.useRef(null),S=b.useRef(null),{disabled:_,updateMeasurementsFor:N,timeout:j}={...r1,...o},T=bo(N??l),D=b.useCallback(()=>{if(!v.current){v.current=!0;return}S.current!=null&&clearTimeout(S.current),S.current=setTimeout(()=>{m(Array.isArray(T.current)?T.current:[T.current]),S.current=null},j)},[j]),M=qu({callback:D,disabled:_||!d}),$=b.useCallback((R,F)=>{M&&(F&&(M.unobserve(F),v.current=!1),R&&M.observe(R))},[M]),[U,C]=ju($),z=bo(t);return b.useEffect(()=>{!M||!U.current||(M.disconnect(),v.current=!1,M.observe(U.current))},[U,M]),b.useEffect(()=>(h({type:$n.RegisterDroppable,element:{id:l,key:u,disabled:s,node:U,rect:x,data:z}}),()=>h({type:$n.UnregisterDroppable,key:u,id:l})),[l]),b.useEffect(()=>{s!==y.current.disabled&&(h({type:$n.SetDroppableDisabled,id:l,key:u,disabled:s}),y.current.disabled=s)},[l,u,s,h]),{active:d,rect:x,isOver:p?.id===l,node:U,over:p,setNodeRef:C}}function s1(n){let{animation:t,children:s}=n;const[l,o]=b.useState(null),[u,d]=b.useState(null),h=_u(s);return!s&&!l&&h&&o(h),Jr(()=>{if(!u)return;const p=l?.key,m=l?.props.id;if(p==null||m==null){o(null);return}Promise.resolve(t(m,u)).then(()=>{o(null)})},[t,l,u]),_e.createElement(_e.Fragment,null,s,l?b.cloneElement(l,{ref:d}):null)}const i1={x:0,y:0,scaleX:1,scaleY:1};function a1(n){let{children:t}=n;return _e.createElement(Fo.Provider,{value:S0},_e.createElement(Fu.Provider,{value:i1},t))}const l1={position:"fixed",touchAction:"none"},o1=n=>Bu(n)?"transform 250ms ease":void 0,c1=b.forwardRef((n,t)=>{let{as:s,activatorEvent:l,adjustScale:o,children:u,className:d,rect:h,style:p,transform:m,transition:y=o1}=n;if(!h)return null;const v=o?m:{...m,scaleX:1,scaleY:1},x={...l1,width:h.width,height:h.height,top:h.top,left:h.left,transform:Tr.Transform.toString(v),transformOrigin:o&&l?i_(l,h):void 0,transition:typeof y=="function"?y(l):y,...p};return _e.createElement(s,{className:d,style:x,ref:t},u)}),vp=n=>t=>{let{active:s,dragOverlay:l}=t;const o={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[h,p]of Object.entries(u.active))p!==void 0&&(o[h]=s.node.style.getPropertyValue(h),s.node.style.setProperty(h,p));if(u!=null&&u.dragOverlay)for(const[h,p]of Object.entries(u.dragOverlay))p!==void 0&&l.node.style.setProperty(h,p);return d!=null&&d.active&&s.node.classList.add(d.active),d!=null&&d.dragOverlay&&l.node.classList.add(d.dragOverlay),function(){for(const[p,m]of Object.entries(o))s.node.style.setProperty(p,m);d!=null&&d.active&&s.node.classList.remove(d.active)}},u1=n=>{let{transform:{initial:t,final:s}}=n;return[{transform:Tr.Transform.toString(t)},{transform:Tr.Transform.toString(s)}]},d1={duration:250,easing:"ease",keyframes:u1,sideEffects:vp({styles:{active:{opacity:"0"}}})};function h1(n){let{config:t,draggableNodes:s,droppableContainers:l,measuringConfiguration:o}=n;return Iu((u,d)=>{if(t===null)return;const h=s.get(u);if(!h)return;const p=h.node.current;if(!p)return;const m=w0(d);if(!m)return;const{transform:y}=or(d).getComputedStyle(d),v=d0(y);if(!v)return;const x=typeof t=="function"?t:f1(t);return v0(p,o.draggable.measure),x({active:{id:u,data:h.data,node:p,rect:o.draggable.measure(p)},draggableNodes:s,dragOverlay:{node:d,rect:o.dragOverlay.measure(m)},droppableContainers:l,measuringConfiguration:o,transform:v})})}function f1(n){const{duration:t,easing:s,sideEffects:l,keyframes:o}={...d1,...n};return u=>{let{active:d,dragOverlay:h,transform:p,...m}=u;if(!t)return;const y={x:h.rect.left-d.rect.left,y:h.rect.top-d.rect.top},v={scaleX:p.scaleX!==1?d.rect.width*p.scaleX/h.rect.width:1,scaleY:p.scaleY!==1?d.rect.height*p.scaleY/h.rect.height:1},x={x:p.x-y.x,y:p.y-y.y,...v},S=o({...m,active:d,dragOverlay:h,transform:{initial:p,final:x}}),[_]=S,N=S[S.length-1];if(JSON.stringify(_)===JSON.stringify(N))return;const j=l?.({active:d,dragOverlay:h,...m}),T=h.node.animate(S,{duration:t,easing:s,fill:"forwards"});return new Promise(D=>{T.onfinish=()=>{j?.(),D()}})}}let Nv=0;function p1(n){return b.useMemo(()=>{if(n!=null)return Nv++,Nv},[n])}const N0=_e.memo(n=>{let{adjustScale:t=!1,children:s,dropAnimation:l,style:o,transition:u,modifiers:d,wrapperElement:h="div",className:p,zIndex:m=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:S,draggableNodes:_,droppableContainers:N,dragOverlay:j,over:T,measuringConfiguration:D,scrollableAncestors:M,scrollableAncestorRects:$,windowRect:U}=C0(),C=b.useContext(Fu),z=p1(v?.id),R=_0(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:S,draggingNodeRect:j.rect,over:T,overlayNodeRect:j.rect,scrollableAncestors:M,scrollableAncestorRects:$,transform:C,windowRect:U}),F=gp(x),K=h1({config:l,draggableNodes:_,droppableContainers:N,measuringConfiguration:D}),G=F?j.setRef:void 0;return _e.createElement(a1,null,_e.createElement(s1,{animation:K},v&&z?_e.createElement(c1,{key:z,id:v.id,ref:G,as:h,activatorEvent:y,adjustScale:t,className:p,transition:u,rect:F,style:{zIndex:m,...o},transform:R},s):null))});function Xi(n,t,s){const l=n.slice();return l.splice(s<0?l.length+s:s,0,l.splice(t,1)[0]),l}function m1(n,t){return n.reduce((s,l,o)=>{const u=t.get(l);return u&&(s[o]=u),s},Array(n.length))}function ru(n){return n!==null&&n>=0}function g1(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==t[s])return!1;return!0}function y1(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const xp=n=>{let{rects:t,activeIndex:s,overIndex:l,index:o}=n;const u=Xi(t,l,s),d=t[o],h=u[o];return!h||!d?null:{x:h.left-d.left,y:h.top-d.top,scaleX:h.width/d.width,scaleY:h.height/d.height}},su={scaleX:1,scaleY:1},jo=n=>{var t;let{activeIndex:s,activeNodeRect:l,index:o,rects:u,overIndex:d}=n;const h=(t=u[s])!=null?t:l;if(!h)return null;if(o===s){const m=u[d];return m?{x:0,y:s<d?m.top+m.height-(h.top+h.height):m.top-h.top,...su}:null}const p=v1(u,o,s);return o>s&&o<=d?{x:0,y:-h.height-p,...su}:o<s&&o>=d?{x:0,y:h.height+p,...su}:{x:0,y:0,...su}};function v1(n,t,s){const l=n[t],o=n[t-1],u=n[t+1];return l?s<t?o?l.top-(o.top+o.height):u?u.top-(l.top+l.height):0:u?u.top-(l.top+l.height):o?l.top-(o.top+o.height):0:0}const E0="Sortable",T0=_e.createContext({activeIndex:-1,containerId:E0,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:xp,disabled:{draggable:!1,droppable:!1}});function el(n){let{children:t,id:s,items:l,strategy:o=xp,disabled:u=!1}=n;const{active:d,dragOverlay:h,droppableRects:p,over:m,measureDroppableContainers:y}=C0(),v=$o(E0,s),x=h.rect!==null,S=b.useMemo(()=>l.map(C=>typeof C=="object"&&"id"in C?C.id:C),[l]),_=d!=null,N=d?S.indexOf(d.id):-1,j=m?S.indexOf(m.id):-1,T=b.useRef(S),D=!g1(S,T.current),M=j!==-1&&N===-1||D,$=y1(u);Jr(()=>{D&&_&&y(S)},[D,S,_,y]),b.useEffect(()=>{T.current=S},[S]);const U=b.useMemo(()=>({activeIndex:N,containerId:v,disabled:$,disableTransforms:M,items:S,overIndex:j,useDragOverlay:x,sortedRects:m1(S,p),strategy:o}),[N,v,$.draggable,$.droppable,M,S,j,p,x,o]);return _e.createElement(T0.Provider,{value:U},t)}const x1=n=>{let{id:t,items:s,activeIndex:l,overIndex:o}=n;return Xi(s,l,o).indexOf(t)},b1=n=>{let{containerId:t,isSorting:s,wasDragging:l,index:o,items:u,newIndex:d,previousItems:h,previousContainerId:p,transition:m}=n;return!m||!l||h!==u&&o===d?!1:s?!0:d!==o&&t===p},w1={duration:200,easing:"ease"},R0="transform",S1=Tr.Transition.toString({property:R0,duration:0,easing:"linear"}),j1={roleDescription:"sortable"};function _1(n){let{disabled:t,index:s,node:l,rect:o}=n;const[u,d]=b.useState(null),h=b.useRef(s);return Jr(()=>{if(!t&&s!==h.current&&l.current){const p=o.current;if(p){const m=il(l.current,{ignoreTransform:!0}),y={x:p.left-m.left,y:p.top-m.top,scaleX:p.width/m.width,scaleY:p.height/m.height};(y.x||y.y)&&d(y)}}s!==h.current&&(h.current=s)},[t,s,l,o]),b.useEffect(()=>{u&&d(null)},[u]),u}function ll(n){let{animateLayoutChanges:t=b1,attributes:s,disabled:l,data:o,getNewIndex:u=x1,id:d,strategy:h,resizeObserverConfig:p,transition:m=w1}=n;const{items:y,containerId:v,activeIndex:x,disabled:S,disableTransforms:_,sortedRects:N,overIndex:j,useDragOverlay:T,strategy:D}=b.useContext(T0),M=C1(l,S),$=y.indexOf(d),U=b.useMemo(()=>({sortable:{containerId:v,index:$,items:y},...o}),[v,o,$,y]),C=b.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:z,node:R,isOver:F,setNodeRef:K}=Ho({id:d,data:U,disabled:M.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...p}}),{active:G,activatorEvent:q,activeNodeRect:V,attributes:P,setNodeRef:k,listeners:E,isDragging:L,over:Y,setActivatorNodeRef:oe,transform:ge}=yp({id:d,data:U,attributes:{...j1,...s},disabled:M.draggable}),B=Gj(K,k),W=!!G,Z=W&&!_&&ru(x)&&ru(j),ye=!T&&L,Me=ye&&Z?ge:null,ae=Z?Me??(h??D)({rects:N,activeNodeRect:V,activeIndex:x,overIndex:j,index:$}):null,O=ru(x)&&ru(j)?u({id:d,items:y,activeIndex:x,overIndex:j}):$,J=G?.id,ce=b.useRef({activeId:J,items:y,newIndex:O,containerId:v}),Se=y!==ce.current.items,ke=t({active:G,containerId:v,isDragging:L,isSorting:W,id:d,index:$,items:y,newIndex:ce.current.newIndex,previousItems:ce.current.items,previousContainerId:ce.current.containerId,transition:m,wasDragging:ce.current.activeId!=null}),Be=_1({disabled:!ke,index:$,node:R,rect:z});return b.useEffect(()=>{W&&ce.current.newIndex!==O&&(ce.current.newIndex=O),v!==ce.current.containerId&&(ce.current.containerId=v),y!==ce.current.items&&(ce.current.items=y)},[W,O,v,y]),b.useEffect(()=>{if(J===ce.current.activeId)return;if(J!=null&&ce.current.activeId==null){ce.current.activeId=J;return}const Ge=setTimeout(()=>{ce.current.activeId=J},50);return()=>clearTimeout(Ge)},[J]),{active:G,activeIndex:x,attributes:P,data:U,rect:z,index:$,newIndex:O,items:y,isOver:F,isSorting:W,isDragging:L,listeners:E,node:R,overIndex:j,over:Y,setNodeRef:B,setActivatorNodeRef:oe,setDroppableNodeRef:K,setDraggableNodeRef:k,transform:Be??ae,transition:Le()};function Le(){if(Be||Se&&ce.current.newIndex===$)return S1;if(!(ye&&!Bu(q)||!m)&&(W||ke))return Tr.Transition.toString({...m,property:R0})}}function C1(n,t){var s,l;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(s=n?.draggable)!=null?s:t.draggable,droppable:(l=n?.droppable)!=null?l:t.droppable}}function Tu(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const N1=[Gt.Down,Gt.Right,Gt.Up,Gt.Left],Hu=(n,t)=>{let{context:{active:s,collisionRect:l,droppableRects:o,droppableContainers:u,over:d,scrollableAncestors:h}}=t;if(N1.includes(n.code)){if(n.preventDefault(),!s||!l)return;const p=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=o.get(v.id);if(x)switch(n.code){case Gt.Down:l.top<x.top&&p.push(v);break;case Gt.Up:l.top>x.top&&p.push(v);break;case Gt.Left:l.left>x.left&&p.push(v);break;case Gt.Right:l.left<x.left&&p.push(v);break}});const m=l_({collisionRect:l,droppableRects:o,droppableContainers:p});let y=o0(m,"id");if(y===d?.id&&m.length>1&&(y=m[1].id),y!=null){const v=u.get(s.id),x=u.get(y),S=x?o.get(x.id):null,_=x?.node.current;if(_&&S&&v&&x){const j=$u(_).some((C,z)=>h[z]!==C),T=k0(v,x),D=E1(v,x),M=j||!T?{x:0,y:0}:{x:D?l.width-S.width:0,y:D?l.height-S.height:0},$={x:S.left,y:S.top};return M.x&&M.y?$:wo($,M)}}}};function k0(n,t){return!Tu(n)||!Tu(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function E1(n,t){return!Tu(n)||!Tu(t)||!k0(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const Ev=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},vi=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],T1=({recipe:n,isSelected:t,isSelectMode:s,onSelectRecipe:l,onToggleSelection:o,disableDrag:u,showOwner:d,ownerLabelFn:h})=>{const{attributes:p,listeners:m,setNodeRef:y,transform:v,transition:x,isDragging:S}=ll({id:n.id,disabled:u}),_={transform:Tr.Transform.toString(v),transition:x,opacity:S?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"};return i.jsx("div",{ref:y,style:_,...p,...m,children:i.jsxs(tn,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some(N=>/|Dessert/i.test(N))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{s?o(n.id):l(n)},children:[i.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?i.jsx("img",{src:n.image,alt:n.title,className:"recipe-card__image",loading:"lazy",decoding:"async"}):i.jsx("div",{className:"recipe-card__image placeholder"}),i.jsx("div",{className:"recipe-card__overlay"}),s&&i.jsx("div",{className:"recipe-card__selection-overlay",children:i.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),i.jsx("div",{className:"recipe-card__tags",children:(()=>{const N=vi(n.tags);if(N.length===0)return null;const j=N.filter(M=>!M.startsWith("owner:"));return(j.includes("URL")?["URL"]:j).slice(0,1).map((M,$)=>i.jsx("span",{className:"recipe-tag",children:M},`${M}-${$}`))})()})]}),i.jsxs("div",{className:"recipe-card__content",children:[i.jsx("h3",{className:"recipe-title",children:n.title}),i.jsx("p",{className:"recipe-desc",children:n.description}),i.jsxs("div",{className:"recipe-meta",children:[n.storeName&&i.jsxs("span",{children:[" ",n.storeName]}),d&&typeof h=="function"&&i.jsxs("span",{className:"recipe-owner",children:[" ",h(n)]}),i.jsxs("div",{className:"recipe-dates",children:[i.jsxs("span",{className:"recipe-date",children:[" : ",Ev(n.created_at)]}),n.updated_at&&i.jsxs("span",{className:"recipe-date",children:[" : ",Ev(n.updated_at)]})]})]})]})]})})},Tv=n=>{const t=vi(n.tags);return n.type==="bread"||t.some(s=>/|Bread/i.test(s))},Rv=n=>{const t=l=>/|Dessert/i.test(l),s=vi(n.tags);return/|Dessert/i.test(n.category||"")||s.some(t)},kv=n=>{const t=vi(n.tags);return/|Sauce/i.test(n.category||"")||t.some(s=>/|Sauce/i.test(s))},Av=n=>{const t=vi(n.tags);return/||Decor/i.test(n.category||"")||t.some(s=>/||Decor/i.test(s))},Ov=n=>{const t=n.category||"",s=vi(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||s.some(l=>/|Dressing||Vinaigrette||Mayonnaise/i.test(l))},Dv=n=>{const t=n.filter(v=>Tv(v)),s=n.filter(v=>!Tv(v)),l=s.filter(v=>kv(v)),o=s.filter(v=>!kv(v)),u=o.filter(v=>Av(v)),d=o.filter(v=>!Av(v)),h=d.filter(v=>Ov(v)),p=d.filter(v=>!Ov(v)),m=p.filter(v=>Rv(v));return{cookingRecipes:p.filter(v=>!Rv(v)),breadRecipes:t,dessertRecipes:m,sauceRecipes:l,dressingRecipes:h,decorationRecipes:u}},Mv=({recipes:n,onSelectRecipe:t,isSelectMode:s,selectedIds:l,onToggleSelection:o,disableDrag:u,displayMode:d="normal",publicRecipeView:h="none",showOwner:p=!1,ownerLabelFn:m,currentUser:y=null})=>{const[v,x]=b.useState({}),S=k=>{x(E=>({...E,[k]:!E[k]}))},_=k=>vi(k?.tags).map(L=>L.toLowerCase()).includes("public"),N=k=>{if(!y)return!1;const E=vi(k?.tags).filter(Y=>Y.startsWith("owner:"));if(E.length===0)return!1;const L=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return E.some(Y=>L.has(Y))},j=n.filter(k=>_(k)),T=j.filter(k=>N(k)),D=j.filter(k=>!N(k)),M=n.filter(k=>!_(k)),{cookingRecipes:$,breadRecipes:U,dessertRecipes:C,sauceRecipes:z,dressingRecipes:R,decorationRecipes:F}=Dv(M),[K,G]=b.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);_e.useEffect(()=>{const k=()=>{window.innerWidth>=1024?G(9):G(8)};return window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[]);const q=(k,E,L,Y,{showWhenEmpty:oe=!1,emptyMessage:ge=""}={})=>{if(E.length===0&&!oe)return null;const B=d==="all";let W=E,Z=!1,ye=!1;return B||(Z=v[Y],ye=E.length>K,W=Z?E:E.slice(0,K)),i.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{onClick:()=>!B&&ye&&S(Y),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!B&&ye?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[i.jsx("span",{children:L})," ",k,i.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",E.length,")"]}),!B&&ye&&i.jsx("span",{className:"section-toggle-btn",children:Z?" ":" "})]}),i.jsx("div",{className:"recipe-grid",children:i.jsx(el,{items:W.map(Me=>Me.id),strategy:xp,children:W.map(Me=>{const xe=l&&l.has(Me.id);return i.jsx(T1,{recipe:Me,isSelected:xe,isSelectMode:s,onSelectRecipe:t,onToggleSelection:o,disableDrag:u,showOwner:p,ownerLabelFn:m},Me.id)})})}),E.length===0&&i.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:ge||`${k}`})]})},V=()=>{if(h!=="mine"&&h!=="others")return null;const k=h==="mine",E=k?"":"",L=k?"":"",Y=k?"public-mine":"public-others",oe=k?T:D,ge=k?"":"",B=Dv(oe);return i.jsxs("div",{className:"public-recipes-block",children:[i.jsxs("div",{className:"public-recipes-block__header",children:[i.jsx("span",{children:L}),i.jsx("span",{children:E}),i.jsxs("span",{className:"public-recipes-block__count",children:["(",oe.length,")"]})]}),oe.length===0?i.jsx("div",{className:"public-recipes-block__empty",children:ge}):i.jsxs(i.Fragment,{children:[q("",B.cookingRecipes,"",`${Y}-cooking`),q("",B.breadRecipes,"",`${Y}-bread`),q("",B.dessertRecipes,"",`${Y}-dessert`),q("",B.sauceRecipes,"",`${Y}-sauce`),q("",B.dressingRecipes,"",`${Y}-dressing`),q("",B.decorationRecipes,"",`${Y}-decoration`)]})]})},P=h==="none"&&j.length>0&&M.length===0;return i.jsxs("div",{className:"recipe-list-container",children:[V(),P&&i.jsx("div",{className:"recipe-list-empty-hint",children:""}),q("",$,"","cooking"),q("",U,"","bread"),q("",C,"","dessert"),q("",z,"","sauce"),q("",R,"","dressing"),q("",F,"","decoration"),n.length===0&&i.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},Cn=({isOpen:n,onClose:t,title:s,children:l,size:o="medium",showCloseButton:u=!0})=>{if(b.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),b.useEffect(()=>{const h=p=>{p.key==="Escape"&&n&&t()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[n,t]),!n)return null;const d=h=>{h.target===h.currentTarget&&t()};return i.jsx("div",{className:"modal-overlay",onClick:d,children:i.jsxs("div",{className:`modal-content modal-${o}`,children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h3",{className:"modal-title",children:s}),u&&i.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),i.jsx("div",{className:"modal-body",children:l})]})})};function Gu(n,t){var s={};for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&t.indexOf(l)<0&&(s[l]=n[l]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,l=Object.getOwnPropertySymbols(n);o<l.length;o++)t.indexOf(l[o])<0&&Object.prototype.propertyIsEnumerable.call(n,l[o])&&(s[l[o]]=n[l[o]]);return s}function R1(n,t,s,l){function o(u){return u instanceof s?u:new s(function(d){d(u)})}return new(s||(s=Promise))(function(u,d){function h(y){try{m(l.next(y))}catch(v){d(v)}}function p(y){try{m(l.throw(y))}catch(v){d(v)}}function m(y){y.done?u(y.value):o(y.value).then(h,p)}m((l=l.apply(n,t||[])).next())})}const k1=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class bp extends Error{constructor(t,s="FunctionsError",l){super(t),this.name=s,this.context=l}}class A1 extends bp{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class zv extends bp{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class Uv extends bp{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Hf;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Hf||(Hf={}));class O1{constructor(t,{headers:s={},customFetch:l,region:o=Hf.Any}={}){this.url=t,this.headers=s,this.region=o,this.fetch=k1(l)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return R1(this,arguments,void 0,function*(s,l={}){var o;let u,d;try{const{headers:h,method:p,body:m,signal:y,timeout:v}=l;let x={},{region:S}=l;S||(S=this.region);const _=new URL(`${this.url}/${s}`);S&&S!=="any"&&(x["x-region"]=S,_.searchParams.set("forceFunctionRegion",S));let N;m&&(h&&!Object.prototype.hasOwnProperty.call(h,"Content-Type")||!h)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",N=m):typeof m=="string"?(x["Content-Type"]="text/plain",N=m):typeof FormData<"u"&&m instanceof FormData?N=m:(x["Content-Type"]="application/json",N=JSON.stringify(m)):N=m;let j=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(j=d.signal,y.addEventListener("abort",()=>d.abort())):j=d.signal);const T=yield this.fetch(_.toString(),{method:p||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),h),body:N,signal:j}).catch(U=>{throw new A1(U)}),D=T.headers.get("x-relay-error");if(D&&D==="true")throw new zv(T);if(!T.ok)throw new Uv(T);let M=((o=T.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),$;return M==="application/json"?$=yield T.json():M==="application/octet-stream"||M==="application/pdf"?$=yield T.blob():M==="text/event-stream"?$=T:M==="multipart/form-data"?$=yield T.formData():$=yield T.text(),{data:$,error:null,response:T}}catch(h){return{data:null,error:h,response:h instanceof Uv||h instanceof zv?h.context:void 0}}finally{u&&clearTimeout(u)}})}}var D1=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},M1=class{constructor(n){var t,s;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(s=n.isMaybeSingle)!==null&&s!==void 0?s:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const l=this.fetch;let o=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,h=null,p=null,m=u.status,y=u.statusText;if(u.ok){var v,x;if(s.method!=="HEAD"){var S;const T=await u.text();T===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((S=s.headers.get("Accept"))===null||S===void 0)&&S.includes("application/vnd.pgrst.plan+text"))?h=T:h=JSON.parse(T))}const N=(v=s.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),j=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");N&&j&&j.length>1&&(p=parseInt(j[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(h)&&(h.length>1?(d={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,p=null,m=406,y="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{var _;const N=await u.text();try{d=JSON.parse(N),Array.isArray(d)&&u.status===404&&(h=[],d=null,m=200,y="OK")}catch{u.status===404&&N===""?(m=204,y="No Content"):d={message:N}}if(d&&s.isMaybeSingle&&(!(d==null||(_=d.details)===null||_===void 0)&&_.includes("0 rows"))&&(d=null,m=200,y="OK"),d&&s.shouldThrowOnError)throw new D1(d)}return{error:d,data:h,count:p,status:m,statusText:y}});return this.shouldThrowOnError||(o=o.catch(u=>{var d;let h="";const p=u?.cause;if(p){var m,y,v,x;const _=(m=p?.message)!==null&&m!==void 0?m:"",N=(y=p?.code)!==null&&y!==void 0?y:"";h=`${(v=u?.name)!==null&&v!==void 0?v:"FetchError"}: ${u?.message}`,h+=`

Caused by: ${(x=p?.name)!==null&&x!==void 0?x:"Error"}: ${_}`,N&&(h+=` (${N})`),p?.stack&&(h+=`
${p.stack}`)}else{var S;h=(S=u?.stack)!==null&&S!==void 0?S:""}return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:h,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),o.then(n,t)}returns(){return this}overrideTypes(){return this}},z1=class extends M1{select(n){let t=!1;const s=(n??"*").split("").map(l=>/\s/.test(l)&&!t?"":(l==='"'&&(t=!t),l)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:s,foreignTable:l,referencedTable:o=l}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:s=t}={}){const l=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(l,`${n}`),this}range(n,t,{foreignTable:s,referencedTable:l=s}={}){const o=typeof l>"u"?"offset":`${l}.offset`,u=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(o,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:s=!1,buffers:l=!1,wal:o=!1,format:u="text"}={}){var d;const h=[n?"analyze":null,t?"verbose":null,s?"settings":null,l?"buffers":null,o?"wal":null].filter(Boolean).join("|"),p=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${p}"; options=${h};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const Lv=new RegExp("[,()]");var Va=class extends z1{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const s=Array.from(new Set(t)).map(l=>typeof l=="string"&&Lv.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`in.(${s})`),this}notIn(n,t){const s=Array.from(new Set(t)).map(l=>typeof l=="string"&&Lv.test(l)?`"${l}"`:`${l}`).join(",");return this.url.searchParams.append(n,`not.in.(${s})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:s,type:l}={}){let o="";l==="plain"?o="pl":l==="phrase"?o="ph":l==="websearch"&&(o="w");const u=s===void 0?"":`(${s})`;return this.url.searchParams.append(n,`${o}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(n,t,s){return this.url.searchParams.append(n,`not.${t}.${s}`),this}or(n,{foreignTable:t,referencedTable:s=t}={}){const l=s?`${s}.or`:"or";return this.url.searchParams.append(l,`(${n})`),this}filter(n,t,s){return this.url.searchParams.append(n,`${t}.${s}`),this}},U1=class{constructor(n,{headers:t={},schema:s,fetch:l}){this.url=n,this.headers=new Headers(t),this.schema=s,this.fetch=l}select(n,t){const{head:s=!1,count:l}=t??{},o=s?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(h=>/\s/.test(h)&&!u?"":(h==='"'&&(u=!u),h)).join("");return this.url.searchParams.set("select",d),l&&this.headers.append("Prefer",`count=${l}`),new Va({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:t,defaultToNull:s=!0}={}){var l;const o="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(u.length>0){const d=[...new Set(u)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new Va({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(n,{onConflict:t,ignoreDuplicates:s=!1,count:l,defaultToNull:o=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),l&&this.headers.append("Prefer",`count=${l}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const h=n.reduce((p,m)=>p.concat(Object.keys(m)),[]);if(h.length>0){const p=[...new Set(h)].map(m=>`"${m}"`);this.url.searchParams.set("columns",p.join(","))}}return new Va({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(n,{count:t}={}){var s;const l="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Va({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:n}={}){var t;const s="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new Va({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},L1=class A0{constructor(t,{headers:s={},schema:l,fetch:o}={}){this.url=t,this.headers=new Headers(s),this.schemaName=l,this.fetch=o}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new U1(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new A0(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:l=!1,get:o=!1,count:u}={}){var d;let h;const p=new URL(`${this.url}/rpc/${t}`);let m;l||o?(h=l?"HEAD":"GET",Object.entries(s).filter(([v,x])=>x!==void 0).map(([v,x])=>[v,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([v,x])=>{p.searchParams.append(v,x)})):(h="POST",m=s);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new Va({method:h,url:p,headers:y,schema:this.schemaName,body:m,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}};class I1{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const s=process.versions;if(s&&s.node){const l=s.node,o=parseInt(l.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const l=this.getWebSocketConstructor();return new l(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const B1="2.89.0",$1=`realtime-js/${B1}`,O0="1.0.0",P1="2.0.0",Iv=O0,Gf=1e4,q1=1e3,F1=100;var mi;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(mi||(mi={}));var Bn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Bn||(Bn={}));var Wr;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Wr||(Wr={}));var Vf;(function(n){n.websocket="websocket"})(Vf||(Vf={}));var Hi;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Hi||(Hi={}));class H1{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,s){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return s(this._binaryEncodeUserBroadcastPush(t));let l=[t.join_ref,t.ref,t.topic,t.event,t.payload];return s(JSON.stringify(l))}_binaryEncodeUserBroadcastPush(t){var s;return this._isArrayBuffer((s=t.payload)===null||s===void 0?void 0:s.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var s,l;const o=(l=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&l!==void 0?l:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var s,l;const o=(l=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&l!==void 0?l:{},d=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,s,l){var o,u;const d=t.topic,h=(o=t.ref)!==null&&o!==void 0?o:"",p=(u=t.join_ref)!==null&&u!==void 0?u:"",m=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(p.length>255)throw new Error(`joinRef length ${p.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`ref length ${h.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`userEvent length ${m.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+p.length+h.length+d.length+m.length+v.length,S=new ArrayBuffer(this.HEADER_LENGTH+x);let _=new DataView(S),N=0;_.setUint8(N++,this.KINDS.userBroadcastPush),_.setUint8(N++,p.length),_.setUint8(N++,h.length),_.setUint8(N++,d.length),_.setUint8(N++,m.length),_.setUint8(N++,v.length),_.setUint8(N++,s),Array.from(p,T=>_.setUint8(N++,T.charCodeAt(0))),Array.from(h,T=>_.setUint8(N++,T.charCodeAt(0))),Array.from(d,T=>_.setUint8(N++,T.charCodeAt(0))),Array.from(m,T=>_.setUint8(N++,T.charCodeAt(0))),Array.from(v,T=>_.setUint8(N++,T.charCodeAt(0)));var j=new Uint8Array(S.byteLength+l.byteLength);return j.set(new Uint8Array(S),0),j.set(new Uint8Array(l),S.byteLength),j.buffer}decode(t,s){if(this._isArrayBuffer(t)){let l=this._binaryDecode(t);return s(l)}if(typeof t=="string"){const l=JSON.parse(t),[o,u,d,h,p]=l;return s({join_ref:o,ref:u,topic:d,event:h,payload:p})}return s({})}_binaryDecode(t){const s=new DataView(t),l=s.getUint8(0),o=new TextDecoder;if(l===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,s,o)}_decodeUserBroadcast(t,s,l){const o=s.getUint8(1),u=s.getUint8(2),d=s.getUint8(3),h=s.getUint8(4);let p=this.HEADER_LENGTH+4;const m=l.decode(t.slice(p,p+o));p=p+o;const y=l.decode(t.slice(p,p+u));p=p+u;const v=l.decode(t.slice(p,p+d));p=p+d;const x=t.slice(p,t.byteLength),S=h===this.JSON_ENCODING?JSON.parse(l.decode(x)):x,_={type:this.BROADCAST_EVENT,event:y,payload:S};return d>0&&(_.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(t){var s;return t instanceof ArrayBuffer||((s=t?.constructor)===null||s===void 0?void 0:s.name)==="ArrayBuffer"}_pick(t,s){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([l])=>s.includes(l)))}}class D0{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var fn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(fn||(fn={}));const Bv=(n,t,s={})=>{var l;const o=(l=s.skipTypes)!==null&&l!==void 0?l:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=G1(d,n,t,o),u),{}):{}},G1=(n,t,s,l)=>{const o=t.find(h=>h.name===n),u=o?.type,d=s[n];return u&&!l.includes(u)?M0(u,d):Kf(d)},M0=(n,t)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return Q1(t,s)}switch(n){case fn.bool:return V1(t);case fn.float4:case fn.float8:case fn.int2:case fn.int4:case fn.int8:case fn.numeric:case fn.oid:return K1(t);case fn.json:case fn.jsonb:return Y1(t);case fn.timestamp:return W1(t);case fn.abstime:case fn.date:case fn.daterange:case fn.int4range:case fn.int8range:case fn.money:case fn.reltime:case fn.text:case fn.time:case fn.timestamptz:case fn.timetz:case fn.tsrange:case fn.tstzrange:return Kf(t);default:return Kf(t)}},Kf=n=>n,V1=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},K1=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},Y1=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},Q1=(n,t)=>{if(typeof n!="string")return n;const s=n.length-1,l=n[s];if(n[0]==="{"&&l==="}"){let u;const d=n.slice(1,s);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(h=>M0(t,h))}return n},W1=n=>typeof n=="string"?n.replace(" ","T"):n,z0=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class lf{constructor(t,s,l={},o=Gf){this.channel=t,this.event=s,this.payload=l,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var l;return this._hasReceived(t)&&s((l=this.receivedResp)===null||l===void 0?void 0:l.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(l=>l.status===t).forEach(l=>l.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var $v;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})($v||($v={}));class yo{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const l=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(l.state,{},o=>{const{onJoin:u,onLeave:d,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=yo.syncState(this.state,o,u,d),this.pendingDiffs.forEach(p=>{this.state=yo.syncDiff(this.state,p,u,d)}),this.pendingDiffs=[],h()}),this.channel._on(l.diff,{},o=>{const{onJoin:u,onLeave:d,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=yo.syncDiff(this.state,o,u,d),h())}),this.onJoin((o,u,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:u,newPresences:d})}),this.onLeave((o,u,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,l,o){const u=this.cloneDeep(t),d=this.transformState(s),h={},p={};return this.map(u,(m,y)=>{d[m]||(p[m]=y)}),this.map(d,(m,y)=>{const v=u[m];if(v){const x=y.map(j=>j.presence_ref),S=v.map(j=>j.presence_ref),_=y.filter(j=>S.indexOf(j.presence_ref)<0),N=v.filter(j=>x.indexOf(j.presence_ref)<0);_.length>0&&(h[m]=_),N.length>0&&(p[m]=N)}else h[m]=y}),this.syncDiff(u,{joins:h,leaves:p},l,o)}static syncDiff(t,s,l,o){const{joins:u,leaves:d}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return l||(l=()=>{}),o||(o=()=>{}),this.map(u,(h,p)=>{var m;const y=(m=t[h])!==null&&m!==void 0?m:[];if(t[h]=this.cloneDeep(p),y.length>0){const v=t[h].map(S=>S.presence_ref),x=y.filter(S=>v.indexOf(S.presence_ref)<0);t[h].unshift(...x)}l(h,y,p)}),this.map(d,(h,p)=>{let m=t[h];if(!m)return;const y=p.map(v=>v.presence_ref);m=m.filter(v=>y.indexOf(v.presence_ref)<0),t[h]=m,o(h,m,p),m.length===0&&delete t[h]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(l=>s(l,t[l]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,l)=>{const o=t[l];return"metas"in o?s[l]=o.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):s[l]=o,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Pv;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Pv||(Pv={}));var vo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(vo||(vo={}));var ks;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(ks||(ks={}));class Wa{constructor(t,s={config:{}},l){var o,u;if(this.topic=t,this.params=s,this.socket=l,this.bindings={},this.state=Bn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new lf(this,Wr.join,this.params,this.timeout),this.rejoinTimer=new D0(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Bn.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Bn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Wr.reply,{},(d,h)=>{this._trigger(this._replyEventName(h),d)}),this.presence=new yo(this),this.broadcastEndpointURL=z0(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,s=this.timeout){var l,o,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Bn.closed){const{config:{broadcast:d,presence:h,private:p}}=this.params,m=(o=(l=this.bindings.postgres_changes)===null||l===void 0?void 0:l.map(S=>S.filter))!==null&&o!==void 0?o:[],y=!!this.bindings[vo.PRESENCE]&&this.bindings[vo.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},h),{enabled:y}),postgres_changes:m,private:p};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(S=>t?.(ks.CHANNEL_ERROR,S)),this._onClose(()=>t?.(ks.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:S})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),S===void 0){t?.(ks.SUBSCRIBED);return}else{const N=this.bindings.postgres_changes,j=(_=N?.length)!==null&&_!==void 0?_:0,T=[];for(let D=0;D<j;D++){const M=N[D],{filter:{event:$,schema:U,table:C,filter:z}}=M,R=S&&S[D];if(R&&R.event===$&&Wa.isFilterValueEqual(R.schema,U)&&Wa.isFilterValueEqual(R.table,C)&&Wa.isFilterValueEqual(R.filter,z))T.push(Object.assign(Object.assign({},M),{id:R.id}));else{this.unsubscribe(),this.state=Bn.errored,t?.(ks.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=T,t&&t(ks.SUBSCRIBED);return}}).receive("error",S=>{this.state=Bn.errored,t?.(ks.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{t?.(ks.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,l){return this.state===Bn.joined&&t===vo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,s,l)}async httpSend(t,s,l={}){var o;if(s==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:s,private:this.private}]})},h=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=l.timeout)!==null&&o!==void 0?o:this.timeout);if(h.status===202)return{success:!0};let p=h.statusText;try{const m=await h.json();p=m.error||m.message||p}catch{}return Promise.reject(new Error(p))}async send(t,s={}){var l,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,h={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(h.Authorization=`Bearer ${this.socket.accessTokenValue}`);const p={method:"POST",headers:h,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,p,(l=s.timeout)!==null&&l!==void 0?l:this.timeout);return await((o=m.body)===null||o===void 0?void 0:o.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,h,p;const m=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((p=(h=(d=this.params)===null||d===void 0?void 0:d.config)===null||h===void 0?void 0:h.broadcast)===null||p===void 0)&&p.ack)&&u("ok"),m.receive("ok",()=>u("ok")),m.receive("error",()=>u("error")),m.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Bn.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Wr.close,"leave",this._joinRef())};this.joinPush.destroy();let l=null;return new Promise(o=>{l=new lf(this,Wr.leave,{},t),l.receive("ok",()=>{s(),o("ok")}).receive("timeout",()=>{s(),o("timed out")}).receive("error",()=>{o("error")}),l.send(),this._canPush()||l.trigger("ok",{})}).finally(()=>{l?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Bn.closed,this.bindings={}}async _fetchWithTimeout(t,s,l){const o=new AbortController,u=setTimeout(()=>o.abort(),l),d=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:o.signal}));return clearTimeout(u),d}_push(t,s,l=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new lf(this,t,s,l);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>F1){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,l){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,l){var o,u;const d=t.toLocaleLowerCase(),{close:h,error:p,leave:m,join:y}=Wr;if(l&&[h,p,m,y].indexOf(d)>=0&&l!==this._joinRef())return;let x=this._onMessage(d,s,l);if(s&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(S=>{var _,N,j;return((_=S.filter)===null||_===void 0?void 0:_.event)==="*"||((j=(N=S.filter)===null||N===void 0?void 0:N.event)===null||j===void 0?void 0:j.toLocaleLowerCase())===d}).map(S=>S.callback(x,l)):(u=this.bindings[d])===null||u===void 0||u.filter(S=>{var _,N,j,T,D,M;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in S){const $=S.id,U=(_=S.filter)===null||_===void 0?void 0:_.event;return $&&((N=s.ids)===null||N===void 0?void 0:N.includes($))&&(U==="*"||U?.toLocaleLowerCase()===((j=s.data)===null||j===void 0?void 0:j.type.toLocaleLowerCase()))}else{const $=(D=(T=S?.filter)===null||T===void 0?void 0:T.event)===null||D===void 0?void 0:D.toLocaleLowerCase();return $==="*"||$===((M=s?.event)===null||M===void 0?void 0:M.toLocaleLowerCase())}else return S.type.toLocaleLowerCase()===d}).map(S=>{if(typeof x=="object"&&"ids"in x){const _=x.data,{schema:N,table:j,commit_timestamp:T,type:D,errors:M}=_;x=Object.assign(Object.assign({},{schema:N,table:j,commit_timestamp:T,eventType:D,new:{},old:{},errors:M}),this._getPayloadRecords(_))}S.callback(x,l)})}_isClosed(){return this.state===Bn.closed}_isJoined(){return this.state===Bn.joined}_isJoining(){return this.state===Bn.joining}_isLeaving(){return this.state===Bn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,l){const o=t.toLocaleLowerCase(),u={type:o,filter:s,callback:l};return this.bindings[o]?this.bindings[o].push(u):this.bindings[o]=[u],this}_off(t,s){const l=t.toLocaleLowerCase();return this.bindings[l]&&(this.bindings[l]=this.bindings[l].filter(o=>{var u;return!(((u=o.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===l&&Wa.isEqual(o.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(t[l]!==s[l])return!1;return!0}static isFilterValueEqual(t,s){return(t??void 0)===(s??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Wr.close,{},t)}_onError(t){this._on(Wr.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Bn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=Bv(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=Bv(t.columns,t.old_record)),s}}const of=()=>{},iu={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},J1=[1e3,2e3,5e3,1e4],X1=1e4,Z1=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class eC{constructor(t,s){var l;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Gf,this.transport=null,this.heartbeatIntervalMs=iu.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=of,this.ref=0,this.reconnectTimer=null,this.vsn=Iv,this.logger=of,this.conn=null,this.sendBuffer=[],this.serializer=new H1,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...u)=>o(...u):(...u)=>fetch(...u),!(!((l=s?.params)===null||l===void 0)&&l.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${Vf.websocket}`,this.httpEndpoint=z0(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=I1.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const l=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(l),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,s??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,l){this.logger(t,s,l)}connectionState(){switch(this.conn&&this.conn.readyState){case mi.connecting:return Hi.Connecting;case mi.open:return Hi.Open;case mi.closing:return Hi.Closing;default:return Hi.Closed}}isConnected(){return this.connectionState()===Hi.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const l=`realtime:${t}`,o=this.getChannels().find(u=>u.topic===l);if(o)return o;{const u=new Wa(`realtime:${t}`,s,this);return this.channels.push(u),u}}push(t){const{topic:s,event:l,payload:o,ref:u}=t,d=()=>{this.encode(t,h=>{var p;(p=this.conn)===null||p===void 0||p.send(h)})};this.log("push",`${s} ${l} (${u})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(q1,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},iu.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(l=>l.topic===t&&(l._isJoined()||l._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(m){this.log("error","error in heartbeat callback",m)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:l,event:o,payload:u,ref:d}=s,h=d?`(${d})`:"",p=u.status||"";this.log("receive",`${p} ${l} ${o} ${h}`.trim(),u),this.channels.filter(m=>m._isMember(l)).forEach(m=>m._trigger(o,u,d)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===mi.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===mi.open||this.conn.readyState===mi.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(s=>{this.log("error","error waiting for auth on connect",s),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this._terminateWorker()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Wr.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const l=t.match(/\?/)?"&":"?",o=new URLSearchParams(s);return`${t}${l}${o}`}_workerObjectUrl(t){let s;if(t)s=t;else{const l=new Blob([Z1],{type:"application/javascript"});s=URL.createObjectURL(l)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s,l=!1;if(t)s=t,l=!0;else if(this.accessToken)try{s=await this.accessToken()}catch(o){this.log("error","Error fetching access token from callback",o),s=this.accessTokenValue}else s=this.accessTokenValue;l?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(o=>{const u={access_token:s,version:$1};s&&o.updateJoinPayload(u),o.joinedOnce&&o._isJoined()&&o._push(Wr.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(s=>{this.log("error",`Error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(l=>{try{l(s)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(l){this.log("error",`error triggering ${t} callbacks`,l)}}_setupReconnectionTimer(){this.reconnectTimer=new D0(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},iu.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,l,o,u,d,h,p,m,y,v,x,S;switch(this.transport=(s=t?.transport)!==null&&s!==void 0?s:null,this.timeout=(l=t?.timeout)!==null&&l!==void 0?l:Gf,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:iu.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(h=t?.heartbeatCallback)!==null&&h!==void 0?h:of,this.vsn=(p=t?.vsn)!==null&&p!==void 0?p:Iv,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=t?.reconnectAfterMs)!==null&&m!==void 0?m:(_=>J1[_-1]||X1),this.vsn){case O0:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((_,N)=>N(JSON.stringify(_))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((_,N)=>N(JSON.parse(_)));break;case P1:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(S=t?.decode)!==null&&S!==void 0?S:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var _o=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function tC(n,t,s){const l=new URL(t,n);if(s)for(const[o,u]of Object.entries(s))u!==void 0&&l.searchParams.set(o,u);return l.toString()}async function nC(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function rC(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:s,path:l,query:o,body:u,headers:d}){const h=tC(n.baseUrl,l,o),p=await nC(n.auth),m=await t(h,{method:s,headers:{...u?{"Content-Type":"application/json"}:{},...p,...d},body:u?JSON.stringify(u):void 0}),y=await m.text(),v=(m.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!m.ok){const S=v?x:void 0,_=S?.error;throw new _o(_?.message??`Request failed with status ${m.status}`,{status:m.status,icebergType:_?.type,icebergCode:_?.code,details:S})}return{status:m.status,headers:m.headers,data:x}}}}function au(n){return n.join("")}var sC=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:au(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(l=>({namespace:l}))}async createNamespace(n,t){const s={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${au(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${au(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${au(n.namespace)}`}),!0}catch(t){if(t instanceof _o&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(s){if(s instanceof _o&&s.status===409)return;throw s}}};function Ua(n){return n.join("")}var iC=class{constructor(n,t="",s){this.client=n,this.prefix=t,this.accessDelegation=s}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ua(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ua(n.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(n,t){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Ua(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Ua(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Ua(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Ua(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(s){if(s instanceof _o&&s.status===404)return!1;throw s}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(s){if(s instanceof _o&&s.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw s}}},aC=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const s=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=rC({baseUrl:s,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new sC(this.client,t),this.tableOps=new iC(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},Vu=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function bn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var lC=class extends Vu{constructor(n,t,s){super(n),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Yf=class extends Vu{constructor(n,t){super(n),this.name="StorageUnknownError",this.originalError=t}};const wp=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),oC=()=>Response,Qf=n=>{if(Array.isArray(n))return n.map(s=>Qf(s));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([s,l])=>{const o=s.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[o]=Qf(l)}),t},cC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},uC=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Co(n){"@babel/helpers - typeof";return Co=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Co(n)}function dC(n,t){if(Co(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var l=s.call(n,t);if(Co(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function hC(n){var t=dC(n,"string");return Co(t)=="symbol"?t:t+""}function fC(n,t,s){return(t=hC(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function qv(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),s.push.apply(s,l)}return s}function bt(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?qv(Object(s),!0).forEach(function(l){fC(n,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):qv(Object(s)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(s,l))})}return n}const cf=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},pC=async(n,t,s)=>{n instanceof await oC()&&!s?.noResolveJson?n.json().then(l=>{const o=n.status||500,u=l?.statusCode||o+"";t(new lC(cf(l),o,u))}).catch(l=>{t(new Yf(cf(l),l))}):t(new Yf(cf(n),n))},mC=(n,t,s,l)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"||!l?o:(cC(l)?(o.headers=bt({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(l)):o.body=l,t?.duplex&&(o.duplex=t.duplex),bt(bt({},o),s))};async function Go(n,t,s,l,o,u){return new Promise((d,h)=>{n(s,mC(t,l,o,u)).then(p=>{if(!p.ok)throw p;return l?.noResolveJson?p:p.json()}).then(p=>d(p)).catch(p=>pC(p,h,l))})}async function No(n,t,s,l){return Go(n,"GET",t,s,l)}async function Qr(n,t,s,l,o){return Go(n,"POST",t,l,o,s)}async function Wf(n,t,s,l,o){return Go(n,"PUT",t,l,o,s)}async function gC(n,t,s,l){return Go(n,"HEAD",t,bt(bt({},s),{},{noResolveJson:!0}),l)}async function Sp(n,t,s,l,o){return Go(n,"DELETE",t,l,o,s)}var yC=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(bn(t))return{data:null,error:t};throw t}}};let U0;U0=Symbol.toStringTag;var vC=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[U0]="BlobDownloadBuilder",this.promise=null}asStream(){return new yC(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(bn(t))return{data:null,error:t};throw t}}};const xC={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Fv={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var bC=class{constructor(n,t={},s,l){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.bucketId=s,this.fetch=wp(l)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,t,s,l){var o=this;try{let u;const d=bt(bt({},Fv),l);let h=bt(bt({},o.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const p=d.metadata;typeof Blob<"u"&&s instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),p&&u.append("metadata",o.encodeMetadata(p)),u.append("",s)):typeof FormData<"u"&&s instanceof FormData?(u=s,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),p&&!u.has("metadata")&&u.append("metadata",o.encodeMetadata(p))):(u=s,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType,p&&(h["x-metadata"]=o.toBase64(o.encodeMetadata(p))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),l?.headers&&(h=bt(bt({},h),l.headers));const m=o._removeEmptyFolders(t),y=o._getFinalPath(m),v=await(n=="PUT"?Wf:Qr)(o.fetch,`${o.url}/object/${y}`,u,bt({headers:h},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:m,id:v.Id,fullPath:v.Key},error:null}}catch(u){if(o.shouldThrowOnError)throw u;if(bn(u))return{data:null,error:u};throw u}}async upload(n,t,s){return this.uploadOrUpdate("POST",n,t,s)}async uploadToSignedUrl(n,t,s,l){var o=this;const u=o._removeEmptyFolders(n),d=o._getFinalPath(u),h=new URL(o.url+`/object/upload/sign/${d}`);h.searchParams.set("token",t);try{let p;const m=bt({upsert:Fv.upsert},l),y=bt(bt({},o.headers),{"x-upsert":String(m.upsert)});return typeof Blob<"u"&&s instanceof Blob?(p=new FormData,p.append("cacheControl",m.cacheControl),p.append("",s)):typeof FormData<"u"&&s instanceof FormData?(p=s,p.append("cacheControl",m.cacheControl)):(p=s,y["cache-control"]=`max-age=${m.cacheControl}`,y["content-type"]=m.contentType),{data:{path:u,fullPath:(await Wf(o.fetch,h.toString(),p,{headers:y})).Key},error:null}}catch(p){if(o.shouldThrowOnError)throw p;if(bn(p))return{data:null,error:p};throw p}}async createSignedUploadUrl(n,t){var s=this;try{let l=s._getFinalPath(n);const o=bt({},s.headers);t?.upsert&&(o["x-upsert"]="true");const u=await Qr(s.fetch,`${s.url}/object/upload/sign/${l}`,{},{headers:o}),d=new URL(s.url+u.url),h=d.searchParams.get("token");if(!h)throw new Vu("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:h},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(bn(l))return{data:null,error:l};throw l}}async update(n,t,s){return this.uploadOrUpdate("PUT",n,t,s)}async move(n,t,s){var l=this;try{return{data:await Qr(l.fetch,`${l.url}/object/move`,{bucketId:l.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:l.headers}),error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(bn(o))return{data:null,error:o};throw o}}async copy(n,t,s){var l=this;try{return{data:{path:(await Qr(l.fetch,`${l.url}/object/copy`,{bucketId:l.bucketId,sourceKey:n,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:l.headers})).Key},error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(bn(o))return{data:null,error:o};throw o}}async createSignedUrl(n,t,s){var l=this;try{let o=l._getFinalPath(n),u=await Qr(l.fetch,`${l.url}/object/sign/${o}`,bt({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:l.headers});const d=s?.download?`&download=${s.download===!0?"":s.download}`:"";return u={signedUrl:encodeURI(`${l.url}${u.signedURL}${d}`)},{data:u,error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(bn(o))return{data:null,error:o};throw o}}async createSignedUrls(n,t,s){var l=this;try{const o=await Qr(l.fetch,`${l.url}/object/sign/${l.bucketId}`,{expiresIn:t,paths:n},{headers:l.headers}),u=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:o.map(d=>bt(bt({},d),{},{signedUrl:d.signedURL?encodeURI(`${l.url}${d.signedURL}${u}`):null})),error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(bn(o))return{data:null,error:o};throw o}}download(n,t){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(t?.transform||{}),o=l?`?${l}`:"",u=this._getFinalPath(n),d=()=>No(this.fetch,`${this.url}/${s}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new vC(d,this.shouldThrowOnError)}async info(n){var t=this;const s=t._getFinalPath(n);try{return{data:Qf(await No(t.fetch,`${t.url}/object/info/${s}`,{headers:t.headers})),error:null}}catch(l){if(t.shouldThrowOnError)throw l;if(bn(l))return{data:null,error:l};throw l}}async exists(n){var t=this;const s=t._getFinalPath(n);try{return await gC(t.fetch,`${t.url}/object/${s}`,{headers:t.headers}),{data:!0,error:null}}catch(l){if(t.shouldThrowOnError)throw l;if(bn(l)&&l instanceof Yf){const o=l.originalError;if([400,404].includes(o?.status))return{data:!1,error:l}}throw l}}getPublicUrl(n,t){const s=this._getFinalPath(n),l=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&l.push(o);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&l.push(d);let h=l.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${s}${h}`)}}}async remove(n){var t=this;try{return{data:await Sp(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(bn(s))return{data:null,error:s};throw s}}async list(n,t,s){var l=this;try{const o=bt(bt(bt({},xC),t),{},{prefix:n||""});return{data:await Qr(l.fetch,`${l.url}/object/list/${l.bucketId}`,o,{headers:l.headers},s),error:null}}catch(o){if(l.shouldThrowOnError)throw o;if(bn(o))return{data:null,error:o};throw o}}async listV2(n,t){var s=this;try{const l=bt({},n);return{data:await Qr(s.fetch,`${s.url}/object/list-v2/${s.bucketId}`,l,{headers:s.headers},t),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(bn(l))return{data:null,error:l};throw l}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const L0="2.89.0",I0={"X-Client-Info":`storage-js/${L0}`};var wC=class{constructor(n,t={},s,l){this.shouldThrowOnError=!1;const o=new URL(n);l?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=bt(bt({},I0),t),this.fetch=wp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var t=this;try{const s=t.listBucketOptionsToQueryString(n);return{data:await No(t.fetch,`${t.url}/bucket${s}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(bn(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await No(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(bn(s))return{data:null,error:s};throw s}}async createBucket(n,t={public:!1}){var s=this;try{return{data:await Qr(s.fetch,`${s.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(bn(l))return{data:null,error:l};throw l}}async updateBucket(n,t){var s=this;try{return{data:await Wf(s.fetch,`${s.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(bn(l))return{data:null,error:l};throw l}}async emptyBucket(n){var t=this;try{return{data:await Qr(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(bn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await Sp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(bn(s))return{data:null,error:s};throw s}}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},SC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=bt(bt({},I0),t),this.fetch=wp(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Qr(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(bn(s))return{data:null,error:s};throw s}}async listBuckets(n){var t=this;try{const s=new URLSearchParams;n?.limit!==void 0&&s.set("limit",n.limit.toString()),n?.offset!==void 0&&s.set("offset",n.offset.toString()),n?.sortColumn&&s.set("sortColumn",n.sortColumn),n?.sortOrder&&s.set("sortOrder",n.sortOrder),n?.search&&s.set("search",n.search);const l=s.toString(),o=l?`${t.url}/bucket?${l}`:`${t.url}/bucket`;return{data:await No(t.fetch,o,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(bn(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await Sp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(bn(s))return{data:null,error:s};throw s}}from(n){var t=this;if(!uC(n))throw new Vu("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const s=new aC({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),l=this.shouldThrowOnError;return new Proxy(s,{get(o,u){const d=o[u];return typeof d!="function"?d:async(...h)=>{try{return{data:await d.apply(o,h),error:null}}catch(p){if(l)throw p;return{data:null,error:p}}}}})}};const jp={"X-Client-Info":`storage-js/${L0}`,"Content-Type":"application/json"};var B0=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Nr(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var uf=class extends B0{constructor(n,t,s){super(n),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},jC=class extends B0{constructor(n,t){super(n),this.name="StorageVectorsUnknownError",this.originalError=t}};const _p=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),_C=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Hv=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),CC=async(n,t,s)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!s?.noResolveJson){const l=n.status||500,o=n;if(typeof o.json=="function")o.json().then(u=>{const d=u?.statusCode||u?.code||l+"";t(new uf(Hv(u),l,d))}).catch(()=>{const u=l+"";t(new uf(o.statusText||`HTTP ${l} error`,l,u))});else{const u=l+"";t(new uf(o.statusText||`HTTP ${l} error`,l,u))}}else t(new jC(Hv(n),n))},NC=(n,t,s,l)=>{const o={method:n,headers:t?.headers||{}};return l?(_C(l)?(o.headers=bt({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(l)):o.body=l,bt(bt({},o),s)):o};async function EC(n,t,s,l,o,u){return new Promise((d,h)=>{n(s,NC(t,l,o,u)).then(p=>{if(!p.ok)throw p;if(l?.noResolveJson)return p;const m=p.headers.get("content-type");return!m||!m.includes("application/json")?{}:p.json()}).then(p=>d(p)).catch(p=>CC(p,h,l))})}async function Er(n,t,s,l,o){return EC(n,"POST",t,l,o,s)}var TC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=bt(bt({},jp),t),this.fetch=_p(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async getIndex(n,t){var s=this;try{return{data:await Er(s.fetch,`${s.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers}),error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Nr(l))return{data:null,error:l};throw l}}async listIndexes(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async deleteIndex(n,t){var s=this;try{return{data:await Er(s.fetch,`${s.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:s.headers})||{},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Nr(l))return{data:null,error:l};throw l}}},RC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=bt(bt({},jp),t),this.fetch=_p(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var t=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Er(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async getVectors(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async listVectors(n){var t=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await Er(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async queryVectors(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async deleteVectors(n){var t=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Er(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}},kC=class{constructor(n,t={},s){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=bt(bt({},jp),t),this.fetch=_p(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async getBucket(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async listBuckets(n={}){var t=this;try{return{data:await Er(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}async deleteBucket(n){var t=this;try{return{data:await Er(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Nr(s))return{data:null,error:s};throw s}}},AC=class extends kC{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new OC(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,s=this;return t().call(s,n)}async getBucket(n){var t=()=>super.getBucket,s=this;return t().call(s,n)}async listBuckets(n={}){var t=()=>super.listBuckets,s=this;return t().call(s,n)}async deleteBucket(n){var t=()=>super.deleteBucket,s=this;return t().call(s,n)}},OC=class extends TC{constructor(n,t,s,l){super(n,t,l),this.vectorBucketName=s}async createIndex(n){var t=()=>super.createIndex,s=this;return t().call(s,bt(bt({},n),{},{vectorBucketName:s.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,s=this;return t().call(s,bt(bt({},n),{},{vectorBucketName:s.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,s=this;return t().call(s,s.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,s=this;return t().call(s,s.vectorBucketName,n)}index(n){return new DC(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},DC=class extends RC{constructor(n,t,s,l,o){super(n,t,o),this.vectorBucketName=s,this.indexName=l}async putVectors(n){var t=()=>super.putVectors,s=this;return t().call(s,bt(bt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async getVectors(n){var t=()=>super.getVectors,s=this;return t().call(s,bt(bt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,s=this;return t().call(s,bt(bt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,s=this;return t().call(s,bt(bt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,s=this;return t().call(s,bt(bt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}},MC=class extends wC{constructor(n,t={},s,l){super(n,t,s,l)}from(n){return new bC(this.url,this.headers,n,this.fetch)}get vectors(){return new AC(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new SC(this.url+"/iceberg",this.headers,this.fetch)}};const $0="2.89.0",Ka=30*1e3,Jf=3,df=Jf*Ka,zC="http://localhost:9999",UC="supabase.auth.token",LC={"X-Client-Info":`gotrue-js/${$0}`},Xf="X-Supabase-Api-Version",P0={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},IC=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,BC=600*1e3;class Eo extends Error{constructor(t,s,l){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=l}}function ot(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class $C extends Eo{constructor(t,s,l){super(t,s,l),this.name="AuthApiError",this.status=s,this.code=l}}function PC(n){return ot(n)&&n.name==="AuthApiError"}class Gi extends Eo{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class Ls extends Eo{constructor(t,s,l,o){super(t,l,o),this.name=s,this.status=l}}class Cr extends Ls{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function qC(n){return ot(n)&&n.name==="AuthSessionMissingError"}class La extends Ls{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class lu extends Ls{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class ou extends Ls{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function FC(n){return ot(n)&&n.name==="AuthImplicitGrantRedirectError"}class Gv extends Ls{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class HC extends Ls{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Zf extends Ls{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function hf(n){return ot(n)&&n.name==="AuthRetryableFetchError"}class Vv extends Ls{constructor(t,s,l){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=l}}class ep extends Ls{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ru="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Kv=` 	
\r=`.split(""),GC=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<Kv.length;t+=1)n[Kv[t].charCodeAt(0)]=-2;for(let t=0;t<Ru.length;t+=1)n[Ru[t].charCodeAt(0)]=t;return n})();function Yv(n,t,s){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;s(Ru[l]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const l=t.queue>>t.queuedBits-6&63;s(Ru[l]),t.queuedBits-=6}}function q0(n,t,s){const l=GC[n];if(l>-1)for(t.queue=t.queue<<6|l,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(l===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Qv(n){const t=[],s=d=>{t.push(String.fromCodePoint(d))},l={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},u=d=>{YC(d,l,s)};for(let d=0;d<n.length;d+=1)q0(n.charCodeAt(d),o,u);return t.join("")}function VC(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function KC(n,t){for(let s=0;s<n.length;s+=1){let l=n.charCodeAt(s);if(l>55295&&l<=56319){const o=(l-55296)*1024&65535;l=(n.charCodeAt(s+1)-56320&65535|o)+65536,s+=1}VC(l,t)}}function YC(n,t,s){if(t.utf8seq===0){if(n<=127){s(n);return}for(let l=1;l<6;l+=1)if((n>>7-l&1)===0){t.utf8seq=l;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function Za(n){const t=[],s={queue:0,queuedBits:0},l=o=>{t.push(o)};for(let o=0;o<n.length;o+=1)q0(n.charCodeAt(o),s,l);return new Uint8Array(t)}function QC(n){const t=[];return KC(n,s=>t.push(s)),new Uint8Array(t)}function Yi(n){const t=[],s={queue:0,queuedBits:0},l=o=>{t.push(o)};return n.forEach(o=>Yv(o,s,l)),Yv(null,s,l),t.join("")}function WC(n){return Math.round(Date.now()/1e3)+n}function JC(){return Symbol("auth-callback")}const tr=()=>typeof window<"u"&&typeof document<"u",Ui={tested:!1,writable:!1},F0=()=>{if(!tr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ui.tested)return Ui.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Ui.tested=!0,Ui.writable=!0}catch{Ui.tested=!0,Ui.writable=!1}return Ui.writable};function XC(n){const t={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((o,u)=>{t[u]=o})}catch{}return s.searchParams.forEach((l,o)=>{t[o]=l}),t}const H0=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),ZC=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Ya=async(n,t,s)=>{await n.setItem(t,JSON.stringify(s))},Li=async(n,t)=>{const s=await n.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Zn=async(n,t)=>{await n.removeItem(t)};class Ku{constructor(){this.promise=new Ku.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}Ku.promiseConstructor=Promise;function ff(n){const t=n.split(".");if(t.length!==3)throw new ep("Invalid JWT structure");for(let l=0;l<t.length;l++)if(!IC.test(t[l]))throw new ep("JWT not in base64url format");return{header:JSON.parse(Qv(t[0])),payload:JSON.parse(Qv(t[1])),signature:Za(t[2]),raw:{header:t[0],payload:t[1]}}}async function eN(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function tN(n,t){return new Promise((l,o)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){l(d);return}}catch(d){if(!t(u,d)){o(d);return}}})()})}function nN(n){return("0"+n.toString(16)).substr(-2)}function rN(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",l=s.length;let o="";for(let u=0;u<56;u++)o+=s.charAt(Math.floor(Math.random()*l));return o}return crypto.getRandomValues(t),Array.from(t,nN).join("")}async function sN(n){const s=new TextEncoder().encode(n),l=await crypto.subtle.digest("SHA-256",s),o=new Uint8Array(l);return Array.from(o).map(u=>String.fromCharCode(u)).join("")}async function iN(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await sN(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ia(n,t,s=!1){const l=rN();let o=l;s&&(o+="/PASSWORD_RECOVERY"),await Ya(n,`${t}-code-verifier`,o);const u=await iN(l);return[u,l===u?"plain":"s256"]}const aN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function lN(n){const t=n.headers.get(Xf);if(!t||!t.match(aN))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function oN(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function cN(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const uN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ba(n){if(!uN.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function pf(){const n={};return new Proxy(n,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const l=s.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function dN(n,t){return new Proxy(n,{get:(s,l,o)=>{if(l==="__isInsecureUserWarningProxy")return!0;if(typeof l=="symbol"){const u=l.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(s,l,o)}return!t.value&&typeof l=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(s,l,o)}})}function Wv(n){return JSON.parse(JSON.stringify(n))}const Fi=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),hN=[502,503,504];async function Jv(n){var t;if(!ZC(n))throw new Zf(Fi(n),0);if(hN.includes(n.status))throw new Zf(Fi(n),n.status);let s;try{s=await n.json()}catch(u){throw new Gi(Fi(u),u)}let l;const o=lN(n);if(o&&o.getTime()>=P0["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?l=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(l=s.error_code),l){if(l==="weak_password")throw new Vv(Fi(s),n.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(l==="session_not_found")throw new Cr}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new Vv(Fi(s),n.status,s.weak_password.reasons);throw new $C(Fi(s),n.status||500,l)}const fN=(n,t,s,l)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(l),Object.assign(Object.assign({},o),s))};async function xt(n,t,s,l){var o;const u=Object.assign({},l?.headers);u[Xf]||(u[Xf]=P0["2024-01-01"].name),l?.jwt&&(u.Authorization=`Bearer ${l.jwt}`);const d=(o=l?.query)!==null&&o!==void 0?o:{};l?.redirectTo&&(d.redirect_to=l.redirectTo);const h=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",p=await pN(n,t,s+h,{headers:u,noResolveJson:l?.noResolveJson},{},l?.body);return l?.xform?l?.xform(p):{data:Object.assign({},p),error:null}}async function pN(n,t,s,l,o,u){const d=fN(t,l,o,u);let h;try{h=await n(s,Object.assign({},d))}catch(p){throw console.error(p),new Zf(Fi(p),0)}if(h.ok||await Jv(h),l?.noResolveJson)return h;try{return await h.json()}catch(p){await Jv(p)}}function Kr(n){var t;let s=null;yN(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=WC(n.expires_in)));const l=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:s,user:l},error:null}}function Xv(n){const t=Kr(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,l)=>s&&typeof l=="string",!0)&&(t.data.weak_password=n.weak_password),t}function gi(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function mN(n){return{data:n,error:null}}function gN(n){const{action_link:t,email_otp:s,hashed_token:l,redirect_to:o,verification_type:u}=n,d=Gu(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:t,email_otp:s,hashed_token:l,redirect_to:o,verification_type:u},p=Object.assign({},d);return{data:{properties:h,user:p},error:null}}function Zv(n){return n}function yN(n){return n.access_token&&n.refresh_token&&n.expires_in}const mf=["global","local","others"];class vN{constructor({url:t="",headers:s={},fetch:l}){this.url=t,this.headers=s,this.fetch=H0(l),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,s=mf[0]){if(mf.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${mf.join(", ")}`);try{return await xt(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(l){if(ot(l))return{data:null,error:l};throw l}}async inviteUserByEmail(t,s={}){try{return await xt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:gi})}catch(l){if(ot(l))return{data:{user:null},error:l};throw l}}async generateLink(t){try{const{options:s}=t,l=Gu(t,["options"]),o=Object.assign(Object.assign({},l),s);return"newEmail"in l&&(o.new_email=l?.newEmail,delete o.newEmail),await xt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:gN,redirectTo:s?.redirectTo})}catch(s){if(ot(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await xt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:gi})}catch(s){if(ot(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,l,o,u,d,h,p;try{const m={nextPage:null,lastPage:0,total:0},y=await xt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:Zv});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,S=(p=(h=y.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&p!==void 0?p:[];return S.length>0&&(S.forEach(_=>{const N=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(_.split(";")[1].split("=")[1]);m[`${j}Page`]=N}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(ot(m))return{data:{users:[]},error:m};throw m}}async getUserById(t){Ba(t);try{return await xt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:gi})}catch(s){if(ot(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){Ba(t);try{return await xt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:gi})}catch(l){if(ot(l))return{data:{user:null},error:l};throw l}}async deleteUser(t,s=!1){Ba(t);try{return await xt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:gi})}catch(l){if(ot(l))return{data:{user:null},error:l};throw l}}async _listFactors(t){Ba(t.userId);try{const{data:s,error:l}=await xt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:s,error:l}}catch(s){if(ot(s))return{data:null,error:s};throw s}}async _deleteFactor(t){Ba(t.userId),Ba(t.id);try{return{data:await xt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(ot(s))return{data:null,error:s};throw s}}async _listOAuthClients(t){var s,l,o,u,d,h,p;try{const m={nextPage:null,lastPage:0,total:0},y=await xt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(l=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&l!==void 0?l:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:Zv});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,S=(p=(h=y.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&p!==void 0?p:[];return S.length>0&&(S.forEach(_=>{const N=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),j=JSON.parse(_.split(";")[1].split("=")[1]);m[`${j}Page`]=N}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(ot(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(t){try{return await xt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(ot(s))return{data:null,error:s};throw s}}async _getOAuthClient(t){try{return await xt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(ot(s))return{data:null,error:s};throw s}}async _updateOAuthClient(t,s){try{return await xt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:s,headers:this.headers,xform:l=>({data:l,error:null})})}catch(l){if(ot(l))return{data:null,error:l};throw l}}async _deleteOAuthClient(t){try{return await xt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(s){if(ot(s))return{data:null,error:s};throw s}}async _regenerateOAuthClientSecret(t){try{return await xt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(ot(s))return{data:null,error:s};throw s}}}function ex(n={}){return{getItem:t=>n[t]||null,setItem:(t,s)=>{n[t]=s},removeItem:t=>{delete n[t]}}}const $a={debug:!!(globalThis&&F0()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class G0 extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class xN extends G0{}async function bN(n,t,s){$a.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const l=new globalThis.AbortController;return t>0&&setTimeout(()=>{l.abort(),$a.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:l.signal},async o=>{if(o){$a.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await s()}finally{$a.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(t===0)throw $a.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new xN(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if($a.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}function wN(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function V0(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function SN(n){return parseInt(n,16)}function jN(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,l=>l.toString(16).padStart(2,"0")).join("")}function _N(n){var t;const{chainId:s,domain:l,expirationTime:o,issuedAt:u=new Date,nonce:d,notBefore:h,requestId:p,resources:m,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!l)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const S=V0(n.address),_=y?`${y}://${l}`:l,N=n.statement?`${n.statement}
`:"",j=`${_} wants you to sign in with your Ethereum account:
${S}

${N}`;let T=`URI: ${v}
Version: ${x}
Chain ID: ${s}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(o&&(T+=`
Expiration Time: ${o.toISOString()}`),h&&(T+=`
Not Before: ${h.toISOString()}`),p&&(T+=`
Request ID: ${p}`),m){let D=`
Resources:`;for(const M of m){if(!M||typeof M!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${M}`);D+=`
- ${M}`}T+=D}return`${j}
${T}`}class Un extends Error{constructor({message:t,code:s,cause:l,name:o}){var u;super(t,{cause:l}),this.__isWebAuthnError=!0,this.name=(u=o??(l instanceof Error?l.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=s}}class ku extends Un{constructor(t,s){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s,message:t}),this.name="WebAuthnUnknownError",this.originalError=s}}function CN({error:n,options:t}){var s,l,o;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Un({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((s=u.authenticatorSelection)===null||s===void 0?void 0:s.requireResidentKey)===!0)return new Un({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((l=u.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new Un({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((o=u.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Un({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Un({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Un({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(h=>h.type==="public-key").length===0?new Un({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Un({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(K0(d)){if(u.rp.id!==d)return new Un({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Un({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Un({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Un({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Un({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function NN({error:n,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Un({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Un({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const l=window.location.hostname;if(K0(l)){if(s.rpId!==l)return new Un({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Un({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Un({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Un({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class EN{createNewAbortSignal(){if(this.controller){const s=new Error("Cancelling existing WebAuthn API call for new one");s.name="AbortError",this.controller.abort(s)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const TN=new EN;function RN(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:s,excludeCredentials:l}=n,o=Gu(n,["challenge","user","excludeCredentials"]),u=Za(t).buffer,d=Object.assign(Object.assign({},s),{id:Za(s.id).buffer}),h=Object.assign(Object.assign({},o),{challenge:u,user:d});if(l&&l.length>0){h.excludeCredentials=new Array(l.length);for(let p=0;p<l.length;p++){const m=l[p];h.excludeCredentials[p]=Object.assign(Object.assign({},m),{id:Za(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return h}function kN(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:s}=n,l=Gu(n,["challenge","allowCredentials"]),o=Za(t).buffer,u=Object.assign(Object.assign({},l),{challenge:o});if(s&&s.length>0){u.allowCredentials=new Array(s.length);for(let d=0;d<s.length;d++){const h=s[d];u.allowCredentials[d]=Object.assign(Object.assign({},h),{id:Za(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return u}function AN(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n;return{id:n.id,rawId:n.id,response:{attestationObject:Yi(new Uint8Array(n.response.attestationObject)),clientDataJSON:Yi(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function ON(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n,l=n.getClientExtensionResults(),o=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:Yi(new Uint8Array(o.authenticatorData)),clientDataJSON:Yi(new Uint8Array(o.clientDataJSON)),signature:Yi(new Uint8Array(o.signature)),userHandle:o.userHandle?Yi(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:l,authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function K0(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function tx(){var n,t;return!!(tr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function DN(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new ku("Browser returned unexpected credential type",t)}:{data:null,error:new ku("Empty credential response",t)}}catch(t){return{data:null,error:CN({error:t,options:n})}}}async function MN(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new ku("Browser returned unexpected credential type",t)}:{data:null,error:new ku("Empty credential response",t)}}catch(t){return{data:null,error:NN({error:t,options:n})}}}const zN={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},UN={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Au(...n){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),s=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),l={};for(const o of n)if(o)for(const u in o){const d=o[u];if(d!==void 0)if(Array.isArray(d))l[u]=d;else if(s(d))l[u]=d;else if(t(d)){const h=l[u];t(h)?l[u]=Au(h,d):l[u]=Au(d)}else l[u]=d}return l}function LN(n,t){return Au(zN,n,t||{})}function IN(n,t){return Au(UN,n,t||{})}class BN{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:s,friendlyName:l,signal:o},u){try{const{data:d,error:h}=await this.client.mfa.challenge({factorId:t,webauthn:s});if(!d)return{data:null,error:h};const p=o??TN.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:m}=d.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${l}`),m.displayName||(m.displayName=m.name)}switch(d.webauthn.type){case"create":{const m=LN(d.webauthn.credential_options.publicKey,u?.create),{data:y,error:v}=await DN({publicKey:m,signal:p});return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}case"request":{const m=IN(d.webauthn.credential_options.publicKey,u?.request),{data:y,error:v}=await MN(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:m,signal:p}));return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}}}catch(d){return ot(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:s,webauthn:l}){return this.client.mfa.verify({factorId:s,challengeId:t,webauthn:l})}async _authenticate({factorId:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!s)return{data:null,error:new Eo("rpId is required for WebAuthn authentication")};try{if(!tx())return{data:null,error:new Gi("Browser does not support WebAuthn",null)};const{data:d,error:h}=await this.challenge({factorId:t,webauthn:{rpId:s,rpOrigins:l},signal:o},{request:u});if(!d)return{data:null,error:h};const{webauthn:p}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:p.type,rpId:s,rpOrigins:l,credential_response:p.credential_response}})}catch(d){return ot(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:l=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!s)return{data:null,error:new Eo("rpId is required for WebAuthn registration")};try{if(!tx())return{data:null,error:new Gi("Browser does not support WebAuthn",null)};const{data:d,error:h}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:h};const{data:p,error:m}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:s,rpOrigins:l},signal:o},{create:u});return p?this._verify({factorId:d.id,challengeId:p.challengeId,webauthn:{rpId:s,rpOrigins:l,type:p.webauthn.type,credential_response:p.webauthn.credential_response}}):{data:null,error:m}}catch(d){return ot(d)?{data:null,error:d}:{data:null,error:new Gi("Unexpected error in register",d)}}}}wN();const $N={url:zC,storageKey:UC,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:LC,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function nx(n,t,s){return await s()}const Pa={};class To{get jwks(){var t,s;return(s=(t=Pa[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){Pa[this.storageKey]=Object.assign(Object.assign({},Pa[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=Pa[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){Pa[this.storageKey]=Object.assign(Object.assign({},Pa[this.storageKey]),{cachedAt:t})}constructor(t){var s,l,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},$N),t);if(this.storageKey=u.storageKey,this.instanceID=(s=To.nextInstanceID[this.storageKey])!==null&&s!==void 0?s:0,To.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&tr()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new vN({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=H0(u.fetch),this.lock=u.lock||nx,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:this.persistSession&&tr()&&(!((l=globalThis?.navigator)===null||l===void 0)&&l.locks)?this.lock=bN:this.lock=nx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new BN(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:F0()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ex(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=ex(this.memoryStorage)),tr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${$0}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let s={},l="none";if(tr()&&(s=XC(window.location.href),this._isImplicitGrantCallback(s)?l="implicit":await this._isPKCECallback(s)&&(l="pkce")),tr()&&this.detectSessionInUrl&&l!=="none"){const{data:o,error:u}=await this._getSessionFromURL(s,l);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),FC(u)){const p=(t=u.details)===null||t===void 0?void 0:t.code;if(p==="identity_already_exists"||p==="identity_not_found"||p==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:d,redirectType:h}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",h),await this._saveSession(d),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return ot(s)?this._returnResult({error:s}):this._returnResult({error:new Gi("Unexpected error during initialization",s)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,l,o;try{const u=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(l=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&l!==void 0?l:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Kr}),{data:d,error:h}=u;if(h||!d)return this._returnResult({data:{user:null,session:null},error:h});const p=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(u){if(ot(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var s,l,o;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let S=null,_=null;this.flowType==="pkce"&&([S,_]=await Ia(this.storage,this.storageKey)),u=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(s=x?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:S,code_challenge_method:_},xform:Kr})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(l=x?.data)!==null&&l!==void 0?l:{},channel:(o=x?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:Kr})}else throw new lu("You must provide either an email or phone number and a password");const{data:d,error:h}=u;if(h||!d)return await Zn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:h});const p=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ot(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let s;if("email"in t){const{email:u,password:d,options:h}=t;s=await xt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Xv})}else if("phone"in t){const{phone:u,password:d,options:h}=t;s=await xt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Xv})}else throw new lu("You must provide either an email or phone number and a password");const{data:l,error:o}=s;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!l||!l.session||!l.user){const u=new La;return this._returnResult({data:{user:null,session:null},error:u})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:o})}catch(s){if(ot(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOAuth(t){var s,l,o,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;switch(s){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(t){var s,l,o,u,d,h,p,m,y,v,x;let S,_;if("message"in t)S=t.message,_=t.signature;else{const{chain:N,wallet:j,statement:T,options:D}=t;let M;if(tr())if(typeof j=="object")M=j;else{const F=window;if("ethereum"in F&&typeof F.ethereum=="object"&&"request"in F.ethereum&&typeof F.ethereum.request=="function")M=F.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!D?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");M=j}const $=new URL((s=D?.url)!==null&&s!==void 0?s:window.location.href),U=await M.request({method:"eth_requestAccounts"}).then(F=>F).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!U||U.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=V0(U[0]);let z=(l=D?.signInWithEthereum)===null||l===void 0?void 0:l.chainId;if(!z){const F=await M.request({method:"eth_chainId"});z=SN(F)}const R={domain:$.host,address:C,statement:T,uri:$.href,version:"1",chainId:z,nonce:(o=D?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(u=D?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(h=D?.signInWithEthereum)===null||h===void 0?void 0:h.expirationTime,notBefore:(p=D?.signInWithEthereum)===null||p===void 0?void 0:p.notBefore,requestId:(m=D?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(y=D?.signInWithEthereum)===null||y===void 0?void 0:y.resources};S=_N(R),_=await M.request({method:"personal_sign",params:[jN(S),C]})}try{const{data:N,error:j}=await xt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:S,signature:_},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Kr});if(j)throw j;if(!N||!N.session||!N.user){const T=new La;return this._returnResult({data:{user:null,session:null},error:T})}return N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),this._returnResult({data:Object.assign({},N),error:j})}catch(N){if(ot(N))return this._returnResult({data:{user:null,session:null},error:N});throw N}}async signInWithSolana(t){var s,l,o,u,d,h,p,m,y,v,x,S;let _,N;if("message"in t)_=t.message,N=t.signature;else{const{chain:j,wallet:T,statement:D,options:M}=t;let $;if(tr())if(typeof T=="object")$=T;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))$=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof T!="object"||!M?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$=T}const U=new URL((s=M?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in $&&$.signIn){const C=await $.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},M?.signInWithSolana),{version:"1",domain:U.host,uri:U.href}),D?{statement:D}:null));let z;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")z=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)z=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in z&&"signature"in z&&(typeof z.signedMessage=="string"||z.signedMessage instanceof Uint8Array)&&z.signature instanceof Uint8Array)_=typeof z.signedMessage=="string"?z.signedMessage:new TextDecoder().decode(z.signedMessage),N=z.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in $)||typeof $.signMessage!="function"||!("publicKey"in $)||typeof $!="object"||!$.publicKey||!("toBase58"in $.publicKey)||typeof $.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${U.host} wants you to sign in with your Solana account:`,$.publicKey.toBase58(),...D?["",D,""]:[""],"Version: 1",`URI: ${U.href}`,`Issued At: ${(o=(l=M?.signInWithSolana)===null||l===void 0?void 0:l.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((u=M?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${M.signInWithSolana.notBefore}`]:[],...!((d=M?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${M.signInWithSolana.expirationTime}`]:[],...!((h=M?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${M.signInWithSolana.chainId}`]:[],...!((p=M?.signInWithSolana)===null||p===void 0)&&p.nonce?[`Nonce: ${M.signInWithSolana.nonce}`]:[],...!((m=M?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${M.signInWithSolana.requestId}`]:[],...!((v=(y=M?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...M.signInWithSolana.resources.map(z=>`- ${z}`)]:[]].join(`
`);const C=await $.signMessage(new TextEncoder().encode(_),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=C}}try{const{data:j,error:T}=await xt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:Yi(N)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(S=t.options)===null||S===void 0?void 0:S.captchaToken}}:null),xform:Kr});if(T)throw T;if(!j||!j.session||!j.user){const D=new La;return this._returnResult({data:{user:null,session:null},error:D})}return j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),this._returnResult({data:Object.assign({},j),error:T})}catch(j){if(ot(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async _exchangeCodeForSession(t){const s=await Li(this.storage,`${this.storageKey}-code-verifier`),[l,o]=(s??"").split("/");try{if(!l&&this.flowType==="pkce")throw new HC;const{data:u,error:d}=await xt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:l},xform:Kr});if(await Zn(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const h=new La;return this._returnResult({data:{user:null,session:null,redirectType:null},error:h})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:o??null}),error:d})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ot(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:s,provider:l,token:o,access_token:u,nonce:d}=t,h=await xt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:l,id_token:o,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Kr}),{data:p,error:m}=h;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!p||!p.session||!p.user){const y=new La;return this._returnResult({data:{user:null,session:null},error:y})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:p,error:m})}catch(s){if(ot(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOtp(t){var s,l,o,u,d;try{if("email"in t){const{email:h,options:p}=t;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await Ia(this.storage,this.storageKey));const{error:v}=await xt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(s=p?.data)!==null&&s!==void 0?s:{},create_user:(l=p?.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:m,code_challenge_method:y},redirectTo:p?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:h,options:p}=t,{data:m,error:y}=await xt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(o=p?.data)!==null&&o!==void 0?o:{},create_user:(u=p?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:p?.captchaToken},channel:(d=p?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:y})}throw new lu("You must provide either an email or phone number.")}catch(h){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ot(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async verifyOtp(t){var s,l;try{let o,u;"options"in t&&(o=(s=t.options)===null||s===void 0?void 0:s.redirectTo,u=(l=t.options)===null||l===void 0?void 0:l.captchaToken);const{data:d,error:h}=await xt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:o,xform:Kr});if(h)throw h;if(!d)throw new Error("An error occurred on token verification.");const p=d.session,m=d.user;return p?.access_token&&(await this._saveSession(p),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",p)),this._returnResult({data:{user:m,session:p},error:null})}catch(o){if(ot(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var s,l,o,u,d;try{let h=null,p=null;this.flowType==="pkce"&&([h,p]=await Ia(this.storage,this.storageKey));const m=await xt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(l=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&l!==void 0?l:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:p}),headers:this.headers,xform:mN});return!((u=m.data)===null||u===void 0)&&u.url&&tr()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(h){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ot(h))return this._returnResult({data:null,error:h});throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:l}=t;if(l)throw l;if(!s)throw new Cr;const{error:o}=await xt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(ot(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:l,type:o,options:u}=t,{error:d}=await xt(this.fetch,"POST",s,{headers:this.headers,body:{email:l,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:l,type:o,options:u}=t,{data:d,error:h}=await xt(this.fetch,"POST",s,{headers:this.headers,body:{phone:l,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:h})}throw new lu("You must provide either an email or phone number and a type")}catch(s){if(ot(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const l=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await l,await s()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const l=s();for(this.pendingInLock.push((async()=>{try{await l}catch{}})()),await l;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await l}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Li(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const l=t.expires_at?t.expires_at*1e3-Date.now()<df:!1;if(this._debug("#__loadSession()",`session has${l?"":" not"} expired`,"expires_at",t.expires_at),!l){if(this.userStorage){const d=await Li(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=pf()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=dN(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const s=await this._acquireLock(-1,async()=>await this._getUser());return s.data.user&&(this.suppressGetSessionWarning=!0),s}async _getUser(t){try{return t?await xt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:gi}):await this._useSession(async s=>{var l,o,u;const{data:d,error:h}=s;if(h)throw h;return!(!((l=d.session)===null||l===void 0)&&l.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Cr}:await xt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:void 0,xform:gi})})}catch(s){if(ot(s))return qC(s)&&(await this._removeSession(),await Zn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:s});throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async l=>{const{data:o,error:u}=l;if(u)throw u;if(!o.session)throw new Cr;const d=o.session;let h=null,p=null;this.flowType==="pkce"&&t.email!=null&&([h,p]=await Ia(this.storage,this.storageKey));const{data:m,error:y}=await xt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:h,code_challenge_method:p}),jwt:d.access_token,xform:gi});if(y)throw y;return d.user=m.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(l){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ot(l))return this._returnResult({data:{user:null},error:l});throw l}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Cr;const s=Date.now()/1e3;let l=s,o=!0,u=null;const{payload:d}=ff(t.access_token);if(d.exp&&(l=d.exp,o=l<=s),o){const{data:h,error:p}=await this._callRefreshToken(t.refresh_token);if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!h)return{data:{user:null,session:null},error:null};u=h}else{const{data:h,error:p}=await this._getUser(t.access_token);if(p)throw p;u={access_token:t.access_token,refresh_token:t.refresh_token,user:h.user,token_type:"bearer",expires_in:l-s,expires_at:l},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(s){if(ot(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var l;if(!t){const{data:d,error:h}=s;if(h)throw h;t=(l=d.session)!==null&&l!==void 0?l:void 0}if(!t?.refresh_token)throw new Cr;const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(s){if(ot(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async _getSessionFromURL(t,s){try{if(!tr())throw new ou("No browser detected.");if(t.error||t.error_description||t.error_code)throw new ou(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new Gv("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ou("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Gv("No code detected.");const{data:D,error:M}=await this._exchangeCodeForSession(t.code);if(M)throw M;const $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:D.session,redirectType:null},error:null}}const{provider_token:l,provider_refresh_token:o,access_token:u,refresh_token:d,expires_in:h,expires_at:p,token_type:m}=t;if(!u||!h||!d||!m)throw new ou("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(h);let x=y+v;p&&(x=parseInt(p));const S=x-y;S*1e3<=Ka&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${S}s, should have been closer to ${v}s`);const _=x-v;y-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,x,y):y-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,x,y);const{data:N,error:j}=await this._getUser(u);if(j)throw j;const T={provider_token:l,provider_refresh_token:o,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:m,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:T,redirectType:t.type},error:null})}catch(l){if(ot(l))return this._returnResult({data:{session:null,redirectType:null},error:l});throw l}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Li(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var l;const{data:o,error:u}=s;if(u)return this._returnResult({error:u});const d=(l=o.session)===null||l===void 0?void 0:l.access_token;if(d){const{error:h}=await this.admin.signOut(d,t);if(h&&!(PC(h)&&(h.status===404||h.status===401||h.status===403)))return this._returnResult({error:h})}return t!=="others"&&(await this._removeSession(),await Zn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const s=JC(),l={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,l),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:l}}}async _emitInitialSession(t){return await this._useSession(async s=>{var l,o;try{const{data:{session:u},error:d}=s;if(d)throw d;await((l=this.stateChangeEmitters.get(t))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,s={}){let l=null,o=null;this.flowType==="pkce"&&([l,o]=await Ia(this.storage,this.storageKey,!0));try{return await xt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:l,code_challenge_method:o,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(u){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ot(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:s,error:l}=await this.getUser();if(l)throw l;return this._returnResult({data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var s;try{const{data:l,error:o}=await this._useSession(async u=>{var d,h,p,m,y;const{data:v,error:x}=u;if(x)throw x;const S=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(h=t.options)===null||h===void 0?void 0:h.scopes,queryParams:(p=t.options)===null||p===void 0?void 0:p.queryParams,skipBrowserRedirect:!0});return await xt(this.fetch,"GET",S,{headers:this.headers,jwt:(y=(m=v.session)===null||m===void 0?void 0:m.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return tr()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(l?.url),this._returnResult({data:{provider:t.provider,url:l?.url},error:null})}catch(l){if(ot(l))return this._returnResult({data:{provider:t.provider,url:null},error:l});throw l}}async linkIdentityIdToken(t){return await this._useSession(async s=>{var l;try{const{error:o,data:{session:u}}=s;if(o)throw o;const{options:d,provider:h,token:p,access_token:m,nonce:y}=t,v=await xt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(l=u?.access_token)!==null&&l!==void 0?l:void 0,body:{provider:h,id_token:p,access_token:m,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:Kr}),{data:x,error:S}=v;return S?this._returnResult({data:{user:null,session:null},error:S}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new La}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:S}))}catch(o){if(await Zn(this.storage,`${this.storageKey}-code-verifier`),ot(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async s=>{var l,o;const{data:u,error:d}=s;if(d)throw d;return await xt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&o!==void 0?o:void 0})})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const l=Date.now();return await tN(async o=>(o>0&&await eN(200*Math.pow(2,o-1)),this._debug(s,"refreshing attempt",o),await xt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Kr})),(o,u)=>{const d=200*Math.pow(2,o);return u&&hf(u)&&Date.now()+d-l<Ka})}catch(l){if(this._debug(s,"error",l),ot(l))return this._returnResult({data:{session:null,user:null},error:l});throw l}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const l=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",l),tr()&&!s.skipBrowserRedirect&&window.location.assign(l),{data:{provider:t,url:l},error:null}}async _recoverAndRefresh(){var t,s;const l="#_recoverAndRefresh()";this._debug(l,"begin");try{const o=await Li(this.storage,this.storageKey);if(o&&this.userStorage){let d=await Li(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await Ya(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d?.user)!==null&&t!==void 0?t:pf()}else if(o&&!o.user&&!o.user){const d=await Li(this.storage,this.storageKey+"-user");d&&d?.user?(o.user=d.user,await Zn(this.storage,this.storageKey+"-user"),await Ya(this.storage,this.storageKey,o)):o.user=pf()}if(this._debug(l,"session from storage",o),!this._isValidSession(o)){this._debug(l,"session is not valid"),o!==null&&await this._removeSession();return}const u=((s=o.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<df;if(this._debug(l,`session has${u?"":" not"} expired with margin of ${df}s`),u){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),hf(d)||(this._debug(l,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:h}=await this._getUser(o.access_token);!h&&d?.user?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(l,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(l,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(l,"error",o),console.error(o);return}finally{this._debug(l,"end")}}async _callRefreshToken(t){var s,l;if(!t)throw new Cr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Ku;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new Cr;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const h={data:u.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(u){if(this._debug(o,"error",u),ot(u)){const d={data:null,error:u};return hf(u)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(d),d}throw(l=this.refreshingDeferred)===null||l===void 0||l.reject(u),u}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,s,l=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",s,`broadcast = ${l}`);try{this.broadcastChannel&&l&&this.broadcastChannel.postMessage({event:t,session:s});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(t,s)}catch(p){u.push(p)}});if(await Promise.all(d),u.length>0){for(let h=0;h<u.length;h+=1)console.error(u[h]);throw u[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await Zn(this.storage,`${this.storageKey}-code-verifier`);const s=Object.assign({},t),l=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!l&&s.user&&await Ya(this.userStorage,this.storageKey+"-user",{user:s.user});const o=Object.assign({},s);delete o.user;const u=Wv(o);await Ya(this.storage,this.storageKey,u)}else{const o=Wv(s);await Ya(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Zn(this.storage,this.storageKey),await Zn(this.storage,this.storageKey+"-code-verifier"),await Zn(this.storage,this.storageKey+"-user"),this.userStorage&&await Zn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&tr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Ka);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:l}}=s;if(!l||!l.refresh_token||!l.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((l.expires_at*1e3-t)/Ka);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Ka}ms, refresh threshold is ${Jf} ticks`),o<=Jf&&await this._callRefreshToken(l.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof G0)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,l){const o=[`provider=${encodeURIComponent(s)}`];if(l?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(l.redirectTo)}`),l?.scopes&&o.push(`scopes=${encodeURIComponent(l.scopes)}`),this.flowType==="pkce"){const[u,d]=await Ia(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(h.toString())}if(l?.queryParams){const u=new URLSearchParams(l.queryParams);o.push(u.toString())}return l?.skipBrowserRedirect&&o.push(`skip_http_redirect=${l.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var l;const{data:o,error:u}=s;return u?this._returnResult({data:null,error:u}):await xt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(l=o?.session)===null||l===void 0?void 0:l.access_token})})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}}async _enroll(t){try{return await this._useSession(async s=>{var l,o;const{data:u,error:d}=s;if(d)return this._returnResult({data:null,error:d});const h=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:p,error:m}=await xt(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(l=u?.session)===null||l===void 0?void 0:l.access_token});return m?this._returnResult({data:null,error:m}):(t.factorType==="totp"&&p.type==="totp"&&(!((o=p?.totp)===null||o===void 0)&&o.qr_code)&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),this._returnResult({data:p,error:null}))})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var l;const{data:o,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?AN(t.webauthn.credential_response):ON(t.webauthn.credential_response)})}:{code:t.code}),{data:h,error:p}=await xt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(l=o?.session)===null||l===void 0?void 0:l.access_token});return p?this._returnResult({data:null,error:p}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+h.expires_in},h)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",h),this._returnResult({data:h,error:p}))})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var l;const{data:o,error:u}=s;if(u)return this._returnResult({data:null,error:u});const d=await xt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(l=o?.session)===null||l===void 0?void 0:l.access_token});if(d.error)return d;const{data:h}=d;if(h.type!=="webauthn")return{data:h,error:null};switch(h.webauthn.type){case"create":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:RN(h.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:kN(h.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}})}async _challengeAndVerify(t){const{data:s,error:l}=await this._challenge({factorId:t.factorId});return l?this._returnResult({data:null,error:l}):await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){var t;const{data:{user:s},error:l}=await this.getUser();if(l)return{data:null,error:l};const o={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=s?.factors)!==null&&t!==void 0?t:[])o.all.push(u),u.status==="verified"&&o[u.factor_type].push(u);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,s;const{data:{session:l},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=ff(l.access_token);let d=null;u.aal&&(d=u.aal);let h=d;((s=(t=l.user.factors)===null||t===void 0?void 0:t.filter(y=>y.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(h="aal2");const m=u.amr||[];return{data:{currentLevel:d,nextLevel:h,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async s=>{const{data:{session:l},error:o}=s;return o?this._returnResult({data:null,error:o}):l?await xt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:l.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Cr})})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}}async _approveAuthorization(t,s){try{return await this._useSession(async l=>{const{data:{session:o},error:u}=l;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Cr});const d=await xt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:h=>({data:h,error:null})});return d.data&&d.data.redirect_url&&tr()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(l){if(ot(l))return this._returnResult({data:null,error:l});throw l}}async _denyAuthorization(t,s){try{return await this._useSession(async l=>{const{data:{session:o},error:u}=l;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Cr});const d=await xt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:h=>({data:h,error:null})});return d.data&&d.data.redirect_url&&tr()&&!s?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(l){if(ot(l))return this._returnResult({data:null,error:l});throw l}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:s},error:l}=t;return l?this._returnResult({data:null,error:l}):s?await xt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Cr})})}catch(t){if(ot(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async s=>{const{data:{session:l},error:o}=s;return o?this._returnResult({data:null,error:o}):l?(await xt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:l.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Cr})})}catch(s){if(ot(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(t,s={keys:[]}){let l=s.keys.find(h=>h.kid===t);if(l)return l;const o=Date.now();if(l=this.jwks.keys.find(h=>h.kid===t),l&&this.jwks_cached_at+BC>o)return l;const{data:u,error:d}=await xt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=o,l=u.keys.find(h=>h.kid===t),!l)?null:l}async getClaims(t,s={}){try{let l=t;if(!l){const{data:S,error:_}=await this.getSession();if(_||!S.session)return this._returnResult({data:null,error:_});l=S.session.access_token}const{header:o,payload:u,signature:d,raw:{header:h,payload:p}}=ff(l);s?.allowExpired||oN(u.exp);const m=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!m){const{error:S}=await this.getUser(l);if(S)throw S;return{data:{claims:u,header:o,signature:d},error:null}}const y=cN(o.alg),v=await crypto.subtle.importKey("jwk",m,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,QC(`${h}.${p}`)))throw new ep("Invalid JWT signature");return{data:{claims:u,header:o,signature:d},error:null}}catch(l){if(ot(l))return this._returnResult({data:null,error:l});throw l}}}To.nextInstanceID={};const PN=To,qN="2.89.0";let ho="";typeof Deno<"u"?ho="deno":typeof document<"u"?ho="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ho="react-native":ho="node";const FN={"X-Client-Info":`supabase-js-${ho}/${qN}`},HN={headers:FN},GN={schema:"public"},VN={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},KN={};function Ro(n){"@babel/helpers - typeof";return Ro=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ro(n)}function YN(n,t){if(Ro(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var l=s.call(n,t);if(Ro(l)!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function QN(n){var t=YN(n,"string");return Ro(t)=="symbol"?t:t+""}function WN(n,t,s){return(t=QN(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function rx(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),s.push.apply(s,l)}return s}function _n(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?rx(Object(s),!0).forEach(function(l){WN(n,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):rx(Object(s)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(s,l))})}return n}const JN=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),XN=()=>Headers,ZN=(n,t,s)=>{const l=JN(s),o=XN();return async(u,d)=>{var h;const p=(h=await t())!==null&&h!==void 0?h:n;let m=new o(d?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${p}`),l(u,_n(_n({},d),{},{headers:m}))}};function eE(n){return n.endsWith("/")?n:n+"/"}function tE(n,t){var s,l;const{db:o,auth:u,realtime:d,global:h}=n,{db:p,auth:m,realtime:y,global:v}=t,x={db:_n(_n({},p),o),auth:_n(_n({},m),u),realtime:_n(_n({},y),d),storage:{},global:_n(_n(_n({},v),h),{},{headers:_n(_n({},(s=v?.headers)!==null&&s!==void 0?s:{}),(l=h?.headers)!==null&&l!==void 0?l:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function nE(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(eE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var rE=class extends PN{constructor(n){super(n)}},sE=class{constructor(n,t,s){var l,o;this.supabaseUrl=n,this.supabaseKey=t;const u=nE(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,h={db:GN,realtime:KN,auth:_n(_n({},VN),{},{storageKey:d}),global:HN},p=tE(s??{},h);if(this.storageKey=(l=p.auth.storageKey)!==null&&l!==void 0?l:"",this.headers=(o=p.global.headers)!==null&&o!==void 0?o:{},p.accessToken)this.accessToken=p.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var m;this.auth=this._initSupabaseAuthClient((m=p.auth)!==null&&m!==void 0?m:{},this.headers,p.global.fetch)}this.fetch=ZN(t,this._getAccessToken.bind(this),p.global.fetch),this.realtime=this._initRealtimeClient(_n({headers:this.headers,accessToken:this._getAccessToken.bind(this)},p.realtime)),this.accessToken&&this.accessToken().then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new L1(new URL("rest/v1",u).href,{headers:this.headers,schema:p.db.schema,fetch:this.fetch}),this.storage=new MC(this.storageUrl.href,this.headers,this.fetch,s?.storage),p.accessToken||this._listenForAuthEvents()}get functions(){return new O1(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,s)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,s;if(n.accessToken)return await n.accessToken();const{data:l}=await n.auth.getSession();return(t=(s=l.session)===null||s===void 0?void 0:s.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:l,userStorage:o,storageKey:u,flowType:d,lock:h,debug:p,throwOnError:m},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new rE({url:this.authUrl.href,headers:_n(_n({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:s,storage:l,userStorage:o,flowType:d,lock:h,debug:p,throwOnError:m,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(S=>S.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new eC(this.realtimeUrl.href,_n(_n({},n),{},{params:_n(_n({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,s){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const iE=(n,t,s)=>new sE(n,t,s);function aE(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}aE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const gf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_API_KEY:"REDACTED_GOOGLE_API_KEY",VITE_SUPABASE_ANON_KEY:"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH",VITE_SUPABASE_URL:"http://127.0.0.1:54321"};var lE={};const Y0=n=>{if(typeof import.meta<"u"&&gf&&gf[n])return gf[n];const t=lE;return t&&t[n]?t[n]:null},Q0=Y0("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",oE=Y0("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",cE=Q0,Re=iE(Q0,oE),uE={async translateRecipe(n,t="EN-US"){const s=[];s.push(n.title||""),s.push(n.description||"");let l=2,o=2;if(n.type==="bread"){const d=n.flours||[],h=n.breadIngredients||[];d.forEach(p=>s.push(p.name||"")),h.forEach(p=>s.push(p.name||"")),o=l+d.length+h.length}else{const d=n.ingredients||[];d.forEach(h=>{const p=typeof h=="string"?h:h.name||"";s.push(p)}),o=l+d.length}const u=n.steps||[];if(u.forEach(d=>{const h=typeof d=="object"&&d!==null?d.text||"":d||"";s.push(h)}),s.length===0)return n;try{const d=await this.translateList(s,t),h={...n};if(h.title=d[0],h.description=d[1],n.type==="bread"){const p=(n.flours||[]).length;h.flours=(n.flours||[]).map((m,y)=>({...m,name:d[l+y]})),h.breadIngredients=(n.breadIngredients||[]).map((m,y)=>({...m,name:d[l+p+y]}))}else h.ingredients=(n.ingredients||[]).map((p,m)=>{const y=d[l+m];return typeof p=="string"?y:{...p,name:y}});return h.steps=u.map((p,m)=>{const y=d[o+m];return typeof p=="object"&&p!==null?{...p,text:y}:y}),h}catch(d){throw console.error("Translation failed:",d),d}},async translateList(n,t){const{data:s,error:l}=await Re.functions.invoke("translate",{body:{text:n,target_lang:t}});if(l)throw console.error("Supabase Function Invocation Error:",l),new Error(`Translation Error: ${l.message}`);if(s&&s.error)throw console.error("Edge Function returned error:",s.error),new Error(`Translation Error: ${s.error}`);return s.translations.map(o=>o.text)}},nn=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},cu=async(n,t,s)=>{let l=null;try{const o=new Promise((u,d)=>{l=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{l&&clearTimeout(l)}},vu=n=>{if(Array.isArray(n))return n.map(s=>String(s)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const s=t.slice(1,-1);return s?s.split(",").map(l=>l.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},dE=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],s=Object.values(t)[0];return vu(s)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return vu(t)}return vu(n)},W0=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const s=vu(t);return s.length>0?s:t.split(",").map(l=>l.trim()).filter(Boolean)}return[]},sx=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),s=String(n.message||"").toLowerCase(),l=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||s.includes("row-level security")||s.includes("permission denied")||s.includes("violates row-level security")||s.includes("invalid input syntax")||s.includes("column")||l.includes("row-level security")?!1:s.includes("failed to fetch")||s.includes("network")||s.includes("timeout")||s.includes("timed out")||s.includes("load failed")},J0="recipe_list_cache",hE=300*1e3,ix=(n,t)=>{try{const s=(n||[]).map(l=>({id:l.id,title:l.title,description:l.description,image:l.image,servings:l.servings,course:l.course,category:l.category,storeName:l.storeName,store_name:l.store_name,tags:l.tags,created_at:l.created_at,updated_at:l.updated_at,type:l.type,sourceUrl:l.sourceUrl}));localStorage.setItem(J0,JSON.stringify({userId:t,updatedAt:Date.now(),recipes:s}))}catch{}},fE=n=>{try{const t=localStorage.getItem(J0);if(!t)return null;const s=JSON.parse(t);return s.userId!==n||Date.now()-s.updatedAt>hE?null:s.recipes||null}catch{return null}},xn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(n){return fE(n)},async _resolveShowMasterPreference(n,t=15e3){const s=n?.showMasterRecipes===!0,l=n?.id;if(!l)return s;const o=this._showMasterPrefCache.get(l),u=Date.now();if(o&&o.value!==s)return this._showMasterPrefCache.set(l,{value:s,updatedAt:u}),s;if(o&&u-o.updatedAt<3e4)return o.value;try{const{data:d,error:h}=await cu(Re.from("profiles").select("show_master_recipes").eq("id",l).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(h)throw h;const p=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(l,{value:p,updatedAt:u}),p}catch{return this._showMasterPrefCache.set(l,{value:s,updatedAt:u}),s}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:s,error:l}=await cu(Re.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(l)throw l;const o=dE(s),u=new Set(o.length>0?o:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const s=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:s,updatedAt:t},s}},async fetchRecipes(n,{timeoutMs:t=15e3,includeIngredients:s=!0,includeSources:l=!0}={}){if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const o=n.role==="admin",u=o?Promise.resolve(!1):this._resolveShowMasterPreference(n,t);let d=[];const h=async($,{withOrderIndex:U,queryTimeoutMs:C})=>{let z=Re.from("recipes").select($);U?z=z.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):z=z.order("created_at",{ascending:!1});const{data:R,error:F}=await cu(z,C,"recipes.select(list)");if(F)throw F;return(R||[]).map(Yr)},p=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${l?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${l?",recipe_sources(url)":""}`,m=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${l?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${l?",recipe_sources(url)":""}`,y=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",v=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let x=null;const S=`recipe_query_pattern:${s?"ing":"noing"}:${l?"src":"nosrc"}`,_=this._queryPatternCache.get(S),N=Math.max(2500,t);if(_)try{d=await h(_.spec,{withOrderIndex:_.withOrderIndex,queryTimeoutMs:N})}catch($){console.warn("Cached query pattern failed, re-detecting...",$),this._queryPatternCache.delete(S),x=$}else{const U=Math.max(2500,Math.round(t/(s?[p,m,y,v]:[p,m,v]).length));try{d=await h(p,{withOrderIndex:!0,queryTimeoutMs:U}),this._queryPatternCache.set(S,{spec:p,withOrderIndex:!0})}catch(C){x=C;try{d=await h(m,{withOrderIndex:!1,queryTimeoutMs:U}),this._queryPatternCache.set(S,{spec:m,withOrderIndex:!1})}catch(z){x=z;try{d=await h(y,{withOrderIndex:!1,queryTimeoutMs:U}),this._queryPatternCache.set(S,{spec:y,withOrderIndex:!1})}catch(R){x=R;try{d=await h(v,{withOrderIndex:!1,queryTimeoutMs:U}),this._queryPatternCache.set(S,{spec:v,withOrderIndex:!1})}catch(F){x=F,d=[]}}}}}if(d.length===0&&x)try{const $=localStorage.getItem("local_recipes");if($)d=JSON.parse($).map(U=>typeof Yr=="function"?Yr(U):U);else throw x}catch{throw x}if(o)return ix(d,n.id),d;const j=[String(n.id)];n.displayId&&j.push(String(n.displayId));const T=await u,D=T?await this._resolveMasterOwnerTags(t):new Set,M=d.filter($=>{const U=W0($.tags),C=U.filter(K=>K&&K.startsWith("owner:"));if(C.length===0)return!0;const z=C.some(K=>D.has(K));if(T&&z)return!0;const R=C.some(K=>j.some(G=>K===`owner:${G}`)),F=U.includes("public");return!!(R||F)});return ix(M,n.id),M},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),l=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:o}=await Re.storage.from("recipe-images").upload(l,n);if(o)throw o;const{data:u}=Re.storage.from("recipe-images").getPublicUrl(l);return u.publicUrl},async getRecipe(n){try{const{data:t,error:s}=await cu(Re.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(s)throw s;return Yr(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const s=localStorage.getItem("local_recipes");if(s){const o=JSON.parse(s).find(u=>u.id==n);if(o)return Yr(o)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:s,created_at:l,sourceUrl:o,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const p=(u.tags||[]).filter(m=>!m.startsWith("owner:"));u.tags=[...p,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=uu(u);try{const{data:h,error:p}=await Re.from("recipes").insert([d]).select().single();if(p)throw p;if(o){const{error:m}=await Re.from("recipe_sources").insert([{recipe_id:h.id,url:o}]);m&&console.error("Failed to save source URL:",m)}return Yr({...h,recipe_sources:o?[{url:o}]:[]})}catch(h){if(!sx(h))throw h;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",h);const p=Date.now(),m={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=uu(m);y.id=p,y.created_at=m.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),h}return Yr(y)}},async updateRecipe(n){const{id:t,created_at:s,sourceUrl:l,...o}=n;o.image instanceof File&&(o.image=await this.uploadImage(o.image));const u=uu(o);o.steps===void 0&&delete u.steps,o.tags===void 0&&delete u.tags,o.ingredients!==void 0||o.type!==void 0||o.ingredientGroups!==void 0||o.flours!==void 0||o.breadIngredients!==void 0||o.stepGroups!==void 0||delete u.ingredients;try{const{data:h,error:p}=await Re.from("recipes").update(u).eq("id",n.id).select().single();if(p)throw p;if(l!==void 0&&(await Re.from("recipe_sources").delete().eq("recipe_id",n.id),l)){const{error:m}=await Re.from("recipe_sources").insert([{recipe_id:n.id,url:l}]);m&&console.error("Failed to update source URL:",m)}return Yr({...h,recipe_sources:l?[{url:l}]:[]})}catch(h){if(!sx(h))throw h;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",h);const p=localStorage.getItem("local_recipes");if(p){let m=JSON.parse(p);const y=m.findIndex(v=>v.id==n.id);if(y!==-1){const v={...m[y],...u,updated_at:new Date().toISOString()};return m[y]=v,localStorage.setItem("local_recipes",JSON.stringify(m)),Yr(v)}}throw h}},async duplicateRecipe(n,t){const{id:s,created_at:l,updated_at:o,image:u,...d}=n;d.title=`${d.title} ()`;let h=null;if(u)try{const p=u.split("/").pop(),m=`copy-${Date.now()}-${p}`,{error:y}=await Re.storage.from("recipe-images").copy(p,m);if(y)console.warn("Image copy failed, using original URL:",y),h=u;else{const{data:v}=Re.storage.from("recipe-images").getPublicUrl(m);h=v.publicUrl}}catch(p){console.warn("Image copy logic error:",p),h=u}return d.image=h,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await Re.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(pE)},async getDeletedCount(){const{count:n,error:t}=await Re.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:s}=await Re.from("recipes").select("*").eq("id",n).single();if(s)throw s;const{error:l}=await Re.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(l)throw l;const{error:o}=await Re.from("recipes").delete().eq("id",n);if(o)throw o;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const s=localStorage.getItem("local_recipes");if(s){let l=JSON.parse(s);const o=l.length;if(l=l.filter(u=>u.id!=n),l.length<o)return localStorage.setItem("local_recipes",JSON.stringify(l)),!0}throw t}},async restoreRecipe(n){const{data:t,error:s}=await Re.from("deleted_recipes").select("*").eq("id",n).single();if(s)throw s;const{error:l}=await Re.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(l)throw l;const{error:o}=await Re.from("deleted_recipes").delete().eq("id",n);if(o)throw o;return!0},async hardDeleteRecipe(n){const{error:t}=await Re.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await Re.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(s=>s.recipe_id)},async addToHistory(n){const{error:t}=await Re.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(s=>Re.from("recipes").update({order_index:s.order_index}).eq("id",s.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,s=[];for(const l of n)try{await this.createRecipe(l),t++}catch(o){console.error("Import failed for recipe:",l.title,o),s.push({title:l.title,error:o.message})}return{success:!0,count:t,errors:s}},async updateRecipeCosts(n){const{data:t,error:s}=await Re.from("recipes").select("*");if(s)throw s;let l=0;const o=[];for(const u of t){const d=Yr(u);let h=!1;const p=m=>m.map(y=>{if(!y.name)return y;const v=n.get(nn(y.name));if(v&&y.purchaseCost!==v.price){h=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const S=parseFloat(x.quantity)||0;x.cost=Math.round(S/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const S=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*S)}return x}return y});if(d.type==="bread"){const m=p(d.flours||[]),y=p(d.breadIngredients||[]);h&&(d.flours=m,d.breadIngredients=y)}else{const m=p(d.ingredients||[]);h&&(d.ingredients=m)}if(h){const m=uu(d);o.push(Re.from("recipes").update(m).eq("id",d.id)),l++}}return o.length>0&&await Promise.all(o),l}},uu=n=>{let t=n.ingredients||[];const s={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(s.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const o=n.steps||[],u=n.stepGroups.map(d=>({...d,count:o.filter(h=>h.groupId===d.id).length}));s.stepGroups=u}if(n.type==="bread"){const o=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[s,...o,...u]}else t=[s,...t];const l=(n.steps||[]).map(o=>typeof o=="string"?o:o.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:l,tags:n.tags||[]}},Yr=n=>{const t=n.ingredients||[];let s="normal",l=[],o=[],u=[],d=[],h=t;const p=W0(n.tags);if(n.ingredients_meta)s=n.ingredients_meta.type||"normal",h=[];else if(Array.isArray(t)&&t.length>0&&t[0]._meta){const y=t[0];s=y.type||"normal",y.groups&&(u=y.groups),y.stepGroups&&(d=y.stepGroups);const v=t.slice(1);s==="bread"?(l=v.filter(x=>x._group==="flour").map(x=>{const{_group:S,..._}=x;return _}),o=v.filter(x=>x._group==="other").map(x=>{const{_group:S,..._}=x;return _}),h=[...l,...o]):h=v}let m=n.steps||[];if(d.length>0&&Array.isArray(m)){let y=0;m=m.map(x=>({text:x}));const v=[];for(d.forEach(x=>{const S=x.count||0;for(let _=0;_<S;_++)y<m.length&&(v.push({...m[y],text:m[y].text,groupId:x.id}),y++)});y<m.length;)v.push({...m[y],groupId:"default"}),y++;m=v}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:s,flours:l,breadIngredients:o,ingredientGroups:u,stepGroups:d,ingredients:h,steps:m.length>0&&typeof m[0]=="object"?m:n.steps,tags:p,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},pE=n=>({...Yr(n),deletedAt:n.deleted_at,originalId:n.original_id}),yf=Object.freeze(Object.defineProperty({__proto__:null,recipeService:xn},Symbol.toStringTag,{value:"Module"})),vf="food",mE="food_alcohol",gE=new Set(["food","alcohol","soft_drink","supplies"]),du=n=>{const t=String(n||"").trim();return!t||t===mE?vf:gE.has(t)?t:vf},Pn={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,s,l=null,o=null,u=void 0,d=void 0){try{const h=await this._getCurrentUserId();if(!h)throw new Error("");const p={user_id:h,ingredient_name:n,packet_size:parseFloat(t),packet_unit:s,last_price:l?parseFloat(l):null,updated_at:new Date().toISOString()};if(o&&(p.item_category=du(o)),u!==void 0){const x=String(u??"").trim();p.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let S=Number.isFinite(x)?x:100;S<=0&&(S=100),S>100&&(S=100),p.yield_percent=S}const m=async x=>Re.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await m(p);if(v){const x=String(v.message||""),S=!!p.item_category&&x.includes("item_category"),_=Object.prototype.hasOwnProperty.call(p,"vendor")&&x.includes("vendor"),N=Object.prototype.hasOwnProperty.call(p,"yield_percent")&&x.includes("yield_percent");if(S||_||N){const j={...p};S&&delete j.item_category,_&&delete j.vendor,N&&delete j.yield_percent,{data:y,error:v}=await m(j)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:du(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(h){throw console.error("Error saving conversion:",h),h}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:s,error:l}=await Re.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return l?(l.code==="PGRST116"||console.warn("Error fetching conversion:",l),null):{ingredientName:s.ingredient_name,packetSize:s.packet_size,packetUnit:s.packet_unit,lastPrice:s.last_price,vendor:s.vendor||"",itemCategory:du(s.item_category),yieldPercent:s.yield_percent===null||s.yield_percent===void 0?100:s.yield_percent,updatedAt:s.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:s}=await Re.from("unit_conversions").select("*").eq("user_id",n);if(s)throw s;const l=new Map;return t.forEach(o=>{l.set(o.ingredient_name,{ingredientName:o.ingredient_name,packetSize:o.packet_size,packetUnit:o.packet_unit,lastPrice:o.last_price,vendor:o.vendor||"",itemCategory:du(o.item_category),yieldPercent:o.yield_percent===null||o.yield_percent===void 0?100:o.yield_percent,updatedAt:o.updated_at})}),l}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:s}=await Re.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(s)throw s;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(n,{overwrite:t=!1}={}){const s=String(n||"").trim();if(!s)throw new Error("");const{data:l,error:o}=await Re.rpc("admin_copy_ingredient_master",{target_profile_id:s,overwrite:t===!0});if(o)throw o;return l}},X0=b.createContext(null),os=()=>b.useContext(X0),Z0=b.createContext(null),Zi=()=>{const n=b.useContext(Z0);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},xu=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],yE=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var qa={},xf={exports:{}},bf,ax;function vE(){if(ax)return bf;ax=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return bf=n,bf}var wf,lx;function xE(){if(lx)return wf;lx=1;var n=vE();function t(){}function s(){}return s.resetWarningCache=t,wf=function(){function l(d,h,p,m,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}l.isRequired=l;function o(){return l}var u={array:l,bigint:l,bool:l,func:l,number:l,object:l,string:l,symbol:l,any:l,arrayOf:o,element:l,elementType:l,instanceOf:o,node:l,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:s,resetWarningCache:t};return u.PropTypes=u,u},wf}var ox;function eb(){return ox||(ox=1,xf.exports=xE()()),xf.exports}var Sf,cx;function tb(){return cx||(cx=1,Sf={L:1,M:0,Q:3,H:2}),Sf}var jf,ux;function nb(){return ux||(ux=1,jf={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),jf}var _f,dx;function bE(){if(dx)return _f;dx=1;var n=nb();function t(s){this.mode=n.MODE_8BIT_BYTE,this.data=s}return t.prototype={getLength:function(s){return this.data.length},write:function(s){for(var l=0;l<this.data.length;l++)s.put(this.data.charCodeAt(l),8)}},_f=t,_f}var Cf,hx;function wE(){if(hx)return Cf;hx=1;var n=tb();function t(s,l){this.totalCount=s,this.dataCount=l}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(s,l){var o=t.getRsBlockTable(s,l);if(o==null)throw new Error("bad rs block @ typeNumber:"+s+"/errorCorrectLevel:"+l);for(var u=o.length/3,d=new Array,h=0;h<u;h++)for(var p=o[h*3+0],m=o[h*3+1],y=o[h*3+2],v=0;v<p;v++)d.push(new t(m,y));return d},t.getRsBlockTable=function(s,l){switch(l){case n.L:return t.RS_BLOCK_TABLE[(s-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(s-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(s-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(s-1)*4+3];default:return}},Cf=t,Cf}var Nf,fx;function SE(){if(fx)return Nf;fx=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var s=Math.floor(t/8);return(this.buffer[s]>>>7-t%8&1)==1},put:function(t,s){for(var l=0;l<s;l++)this.putBit((t>>>s-l-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),t&&(this.buffer[s]|=128>>>this.length%8),this.length++}},Nf=n,Nf}var Ef,px;function rb(){if(px)return Ef;px=1;for(var n={glog:function(s){if(s<1)throw new Error("glog("+s+")");return n.LOG_TABLE[s]},gexp:function(s){for(;s<0;)s+=255;for(;s>=256;)s-=255;return n.EXP_TABLE[s]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return Ef=n,Ef}var Tf,mx;function sb(){if(mx)return Tf;mx=1;var n=rb();function t(s,l){if(s.length==null)throw new Error(s.length+"/"+l);for(var o=0;o<s.length&&s[o]==0;)o++;this.num=new Array(s.length-o+l);for(var u=0;u<s.length-o;u++)this.num[u]=s[u+o]}return t.prototype={get:function(s){return this.num[s]},getLength:function(){return this.num.length},multiply:function(s){for(var l=new Array(this.getLength()+s.getLength()-1),o=0;o<this.getLength();o++)for(var u=0;u<s.getLength();u++)l[o+u]^=n.gexp(n.glog(this.get(o))+n.glog(s.get(u)));return new t(l,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var l=n.glog(this.get(0))-n.glog(s.get(0)),o=new Array(this.getLength()),u=0;u<this.getLength();u++)o[u]=this.get(u);for(var u=0;u<s.getLength();u++)o[u]^=n.gexp(n.glog(s.get(u))+l);return new t(o,0).mod(s)}},Tf=t,Tf}var Rf,gx;function jE(){if(gx)return Rf;gx=1;var n=nb(),t=sb(),s=rb(),l={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;o.getBCHDigit(d)-o.getBCHDigit(o.G15)>=0;)d^=o.G15<<o.getBCHDigit(d)-o.getBCHDigit(o.G15);return(u<<10|d)^o.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;o.getBCHDigit(d)-o.getBCHDigit(o.G18)>=0;)d^=o.G18<<o.getBCHDigit(d)-o.getBCHDigit(o.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return o.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,h){switch(u){case l.PATTERN000:return(d+h)%2==0;case l.PATTERN001:return d%2==0;case l.PATTERN010:return h%3==0;case l.PATTERN011:return(d+h)%3==0;case l.PATTERN100:return(Math.floor(d/2)+Math.floor(h/3))%2==0;case l.PATTERN101:return d*h%2+d*h%3==0;case l.PATTERN110:return(d*h%2+d*h%3)%2==0;case l.PATTERN111:return(d*h%3+(d+h)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),h=0;h<u;h++)d=d.multiply(new t([1,s.gexp(h)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),h=0,p=0;p<d;p++)for(var m=0;m<d;m++){for(var y=0,v=u.isDark(p,m),x=-1;x<=1;x++)if(!(p+x<0||d<=p+x))for(var S=-1;S<=1;S++)m+S<0||d<=m+S||x==0&&S==0||v==u.isDark(p+x,m+S)&&y++;y>5&&(h+=3+y-5)}for(var p=0;p<d-1;p++)for(var m=0;m<d-1;m++){var _=0;u.isDark(p,m)&&_++,u.isDark(p+1,m)&&_++,u.isDark(p,m+1)&&_++,u.isDark(p+1,m+1)&&_++,(_==0||_==4)&&(h+=3)}for(var p=0;p<d;p++)for(var m=0;m<d-6;m++)u.isDark(p,m)&&!u.isDark(p,m+1)&&u.isDark(p,m+2)&&u.isDark(p,m+3)&&u.isDark(p,m+4)&&!u.isDark(p,m+5)&&u.isDark(p,m+6)&&(h+=40);for(var m=0;m<d;m++)for(var p=0;p<d-6;p++)u.isDark(p,m)&&!u.isDark(p+1,m)&&u.isDark(p+2,m)&&u.isDark(p+3,m)&&u.isDark(p+4,m)&&!u.isDark(p+5,m)&&u.isDark(p+6,m)&&(h+=40);for(var N=0,m=0;m<d;m++)for(var p=0;p<d;p++)u.isDark(p,m)&&N++;var j=Math.abs(100*N/d/d-50)/5;return h+=j*10,h}};return Rf=o,Rf}var kf,yx;function _E(){if(yx)return kf;yx=1;var n=bE(),t=wE(),s=SE(),l=jE(),o=sb();function u(h,p){this.typeNumber=h,this.errorCorrectLevel=p,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(h){var p=new n(h);this.dataList.push(p),this.dataCache=null},d.isDark=function(h,p){if(h<0||this.moduleCount<=h||p<0||this.moduleCount<=p)throw new Error(h+","+p);return this.modules[h][p]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var h=1;for(h=1;h<40;h++){for(var p=t.getRSBlocks(h,this.errorCorrectLevel),m=new s,y=0,v=0;v<p.length;v++)y+=p[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];m.put(x.mode,4),m.put(x.getLength(),l.getLengthInBits(x.mode,h)),x.write(m)}if(m.getLengthInBits()<=y*8)break}this.typeNumber=h}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(h,p){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++){this.modules[m]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[m][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(h,p),this.typeNumber>=7&&this.setupTypeNumber(h),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,p)},d.setupPositionProbePattern=function(h,p){for(var m=-1;m<=7;m++)if(!(h+m<=-1||this.moduleCount<=h+m))for(var y=-1;y<=7;y++)p+y<=-1||this.moduleCount<=p+y||(0<=m&&m<=6&&(y==0||y==6)||0<=y&&y<=6&&(m==0||m==6)||2<=m&&m<=4&&2<=y&&y<=4?this.modules[h+m][p+y]=!0:this.modules[h+m][p+y]=!1)},d.getBestMaskPattern=function(){for(var h=0,p=0,m=0;m<8;m++){this.makeImpl(!0,m);var y=l.getLostPoint(this);(m==0||h>y)&&(h=y,p=m)}return p},d.createMovieClip=function(h,p,m){var y=h.createEmptyMovieClip(p,m),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var S=x*v,_=0;_<this.modules[x].length;_++){var N=_*v,j=this.modules[x][_];j&&(y.beginFill(0,100),y.moveTo(N,S),y.lineTo(N+v,S),y.lineTo(N+v,S+v),y.lineTo(N,S+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var h=8;h<this.moduleCount-8;h++)this.modules[h][6]==null&&(this.modules[h][6]=h%2==0);for(var p=8;p<this.moduleCount-8;p++)this.modules[6][p]==null&&(this.modules[6][p]=p%2==0)},d.setupPositionAdjustPattern=function(){for(var h=l.getPatternPosition(this.typeNumber),p=0;p<h.length;p++)for(var m=0;m<h.length;m++){var y=h[p],v=h[m];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var S=-2;S<=2;S++)x==-2||x==2||S==-2||S==2||x==0&&S==0?this.modules[y+x][v+S]=!0:this.modules[y+x][v+S]=!1}},d.setupTypeNumber=function(h){for(var p=l.getBCHTypeNumber(this.typeNumber),m=0;m<18;m++){var y=!h&&(p>>m&1)==1;this.modules[Math.floor(m/3)][m%3+this.moduleCount-8-3]=y}for(var m=0;m<18;m++){var y=!h&&(p>>m&1)==1;this.modules[m%3+this.moduleCount-8-3][Math.floor(m/3)]=y}},d.setupTypeInfo=function(h,p){for(var m=this.errorCorrectLevel<<3|p,y=l.getBCHTypeInfo(m),v=0;v<15;v++){var x=!h&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!h&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!h},d.mapData=function(h,p){for(var m=-1,y=this.moduleCount-1,v=7,x=0,S=this.moduleCount-1;S>0;S-=2)for(S==6&&S--;;){for(var _=0;_<2;_++)if(this.modules[y][S-_]==null){var N=!1;x<h.length&&(N=(h[x]>>>v&1)==1);var j=l.getMask(p,y,S-_);j&&(N=!N),this.modules[y][S-_]=N,v--,v==-1&&(x++,v=7)}if(y+=m,y<0||this.moduleCount<=y){y-=m,m=-m;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(h,p,m){for(var y=t.getRSBlocks(h,p),v=new s,x=0;x<m.length;x++){var S=m[x];v.put(S.mode,4),v.put(S.getLength(),l.getLengthInBits(S.mode,h)),S.write(v)}for(var _=0,x=0;x<y.length;x++)_+=y[x].dataCount;if(v.getLengthInBits()>_*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+_*8+")");for(v.getLengthInBits()+4<=_*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=_*8||(v.put(u.PAD0,8),v.getLengthInBits()>=_*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(h,p){for(var m=0,y=0,v=0,x=new Array(p.length),S=new Array(p.length),_=0;_<p.length;_++){var N=p[_].dataCount,j=p[_].totalCount-N;y=Math.max(y,N),v=Math.max(v,j),x[_]=new Array(N);for(var T=0;T<x[_].length;T++)x[_][T]=255&h.buffer[T+m];m+=N;var D=l.getErrorCorrectPolynomial(j),M=new o(x[_],D.getLength()-1),$=M.mod(D);S[_]=new Array(D.getLength()-1);for(var T=0;T<S[_].length;T++){var U=T+$.getLength()-S[_].length;S[_][T]=U>=0?$.get(U):0}}for(var C=0,T=0;T<p.length;T++)C+=p[T].totalCount;for(var z=new Array(C),R=0,T=0;T<y;T++)for(var _=0;_<p.length;_++)T<x[_].length&&(z[R++]=x[_][T]);for(var T=0;T<v;T++)for(var _=0;_<p.length;_++)T<S[_].length&&(z[R++]=S[_][T]);return z},kf=u,kf}var hu={},vx;function CE(){if(vx)return hu;vx=1,Object.defineProperty(hu,"__esModule",{value:!0});var n=Object.assign||function(m){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(m[x]=v[x])}return m},t=eb(),s=u(t),l=Do(),o=u(l);function u(m){return m&&m.__esModule?m:{default:m}}function d(m,y){var v={};for(var x in m)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(m,x)&&(v[x]=m[x]);return v}var h={bgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,bgD:s.default.string.isRequired,fgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,fgD:s.default.string.isRequired,size:s.default.number.isRequired,title:s.default.string,viewBoxSize:s.default.number.isRequired,xmlns:s.default.string},p=(0,l.forwardRef)(function(m,y){var v=m.bgColor,x=m.bgD,S=m.fgD,_=m.fgColor,N=m.size,j=m.title,T=m.viewBoxSize,D=m.xmlns,M=D===void 0?"http://www.w3.org/2000/svg":D,$=d(m,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return o.default.createElement("svg",n({},$,{height:N,ref:y,viewBox:"0 0 "+T+" "+T,width:N,xmlns:M}),j?o.default.createElement("title",null,j):null,o.default.createElement("path",{d:x,fill:v}),o.default.createElement("path",{d:S,fill:_}))});return p.displayName="QRCodeSvg",p.propTypes=h,hu.default=p,hu}var xx;function NE(){if(xx)return qa;xx=1,Object.defineProperty(qa,"__esModule",{value:!0}),qa.QRCode=void 0;var n=Object.assign||function(N){for(var j=1;j<arguments.length;j++){var T=arguments[j];for(var D in T)Object.prototype.hasOwnProperty.call(T,D)&&(N[D]=T[D])}return N},t=eb(),s=v(t),l=tb(),o=v(l),u=_E(),d=v(u),h=Do(),p=v(h),m=CE(),y=v(m);function v(N){return N&&N.__esModule?N:{default:N}}function x(N,j){var T={};for(var D in N)j.indexOf(D)>=0||Object.prototype.hasOwnProperty.call(N,D)&&(T[D]=N[D]);return T}var S={bgColor:s.default.oneOfType([s.default.object,s.default.string]),fgColor:s.default.oneOfType([s.default.object,s.default.string]),level:s.default.string,size:s.default.number,value:s.default.string.isRequired},_=(0,h.forwardRef)(function(N,j){var T=N.bgColor,D=T===void 0?"#FFFFFF":T,M=N.fgColor,$=M===void 0?"#000000":M,U=N.level,C=U===void 0?"L":U,z=N.size,R=z===void 0?256:z,F=N.value,K=x(N,["bgColor","fgColor","level","size","value"]),G=new d.default(-1,o.default[C]);G.addData(F),G.make();var q=G.modules;return p.default.createElement(y.default,n({},K,{bgColor:D,bgD:q.map(function(V,P){return V.map(function(k,E){return k?"":"M "+E+" "+P+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:$,fgD:q.map(function(V,P){return V.map(function(k,E){return k?"M "+E+" "+P+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:j,size:R,viewBoxSize:q.length}))});return qa.QRCode=_,_.displayName="QRCode",_.propTypes=S,qa.default=_,qa}var EE=NE();const TE=Ux(EE),bx=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},RE=n=>{if(n==null)return NaN;if(typeof n=="number")return Number.isFinite(n)?n:NaN;const t=String(n).trim().replace(/[,\s]/g,"");if(!t)return NaN;const s=parseFloat(t);return Number.isFinite(s)?s:NaN},is=(n,{maximumFractionDigits:t=1}={})=>{const s=RE(n);return Number.isFinite(s)?`${s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}`:null},kE=new Set(["food","alcohol","soft_drink","supplies"]),ib=new Set(["alcohol","supplies"]),ab=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":kE.has(t)?t:"":""},tp=n=>{const t=ab(n?.itemCategory??n?.item_category);return t?ib.has(t):!!n?.isAlcohol},Ii=n=>tp(n)?1.1:1.08,wx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),AE=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=wx(t);if(!l)return null;for(const[o,u]of n.entries())if(wx(o)===l)return u;return null},Ms=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},OE=n=>{const t=Ms(n);return!Number.isFinite(t)||t<=0||t>100?100:t},DE=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return OE(s)/100},ME=(n,t,s)=>{const l=Ms(n),o=Ms(t);if(!Number.isFinite(l)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/o*1e3:(["kg","","l",""].includes(u),l/o)},Sx=(n,t,s,{defaultWeightWhenUnitEmpty:l=!1,forceWeightBased:o=!1,yieldRate:u=1}={})=>{const d=Ms(n),h=Ms(t);if(!Number.isFinite(d)||!Number.isFinite(h))return NaN;const p=Number.isFinite(u)&&u>0?u:1,m=String(s||"").trim().toLowerCase();return o||!m&&l||["g","","ml","","cc",""].includes(m)?d/1e3*h/p:d*h/p},zE=(n,t)=>{const s=Ms(n?.purchaseCost),l=Ms(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},UE=({recipe:n,ownerLabel:t,onBack:s,onEdit:l,onDelete:o,onHardDelete:u,isDeleted:d,onView:h,onDuplicate:p,backLabel:m,onList:y})=>{const{user:v}=os(),x=Zi(),[S,_]=_e.useState(!1),[N,j]=_e.useState(!1),[T,D]=_e.useState(!1),[M,$]=_e.useState(new Set),[U,C]=_e.useState(new Set),[z,R]=_e.useState(new Set),[F,K]=_e.useState({}),[G,q]=_e.useState("ORIGINAL"),[V,P]=_e.useState(!1),[k,E]=_e.useState(!0),[L,Y]=_e.useState(!1),[oe,ge]=_e.useState(new Map),[B,W]=_e.useState(""),[Z,ye]=_e.useState(1),[Me,xe]=_e.useState(""),[ae,O]=_e.useState(""),J=_e.useMemo(()=>{const ne=parseFloat(Z);return isNaN(ne)?1:ne},[Z]),ce=(ne,te)=>{if(!ne)return"";const he=parseFloat(ne);if(isNaN(he))return ne;const Ee=he*parseFloat(te);return Number.isInteger(Ee)?Ee.toString():Ee.toFixed(1).replace(/\.0$/,"")},Se=(ne,te)=>{if(!ne)return"";const he=parseFloat(ne);return isNaN(he)?ne:(he*parseFloat(te)).toFixed(2).replace(/\.00$/,"")},[ke,Be]=_e.useState(n),[Le,Ge]=_e.useState(!1),pe=G==="ORIGINAL"?ke:F[G]||ke;_e.useEffect(()=>{let ne=!0;return Pn.getAllConversions().then(te=>{ne&&ge(te)}).catch(()=>{ne&&ge(new Map)}),()=>{ne=!1}},[]);const Ye=_e.useMemo(()=>{const ne=(te,he={})=>{if(!te||typeof te!="object")return te;const Ee=AE(oe,te.name),Ie=ab(te.itemCategory??te.item_category??Ee?.itemCategory),Je=DE(te,Ee);let Ke=te;if(Ie&&(Ke={...Ke,itemCategory:Ie,isAlcohol:ib.has(Ie)}),!Ee||!Ee.packetSize){const De=String(te.unit||"").trim();if(he.forceWeightBased||he.defaultWeightWhenUnitEmpty&&!De){const Ft=Sx(te.quantity,Ke.purchaseCost,te.unit,{...he,yieldRate:Je}),Nn=Number.isFinite(Ft)?Math.round(Ft*100)/100:NaN,Et=Ms(Ke.cost);if(Number.isFinite(Nn)&&(!Number.isFinite(Et)||Math.abs(Et-Nn)>.01))return{...Ke,cost:Nn}}return Ke}const ze=[Ee.lastPrice,te.purchaseCostRef,te.purchase_cost,te.purchaseCost].find(De=>Number.isFinite(Ms(De))),Fe=ME(ze,Ee.packetSize,Ee.packetUnit);if(!Number.isFinite(Fe)||!zE(te,Fe))return Ke;const _t=Sx(te.quantity,Fe,te.unit,{...he,yieldRate:Je});return{...Ke,purchaseCost:Math.round(Fe*100)/100,cost:Number.isFinite(_t)?Math.round(_t*100)/100:Ke.cost}};return{...pe,ingredients:(pe.ingredients||[]).map(te=>ne(te)),flours:(pe.flours||[]).map(te=>ne(te,{forceWeightBased:!0})),breadIngredients:(pe.breadIngredients||[]).map(te=>ne(te,{forceWeightBased:!0}))}},[oe,pe]);_e.useEffect(()=>{Be(n),!n.steps&&!d&&(Ge(!0),xn.getRecipe(n.id).then(ne=>{Be(ne)}).catch(ne=>{console.error("Failed to load details",ne)}).finally(()=>{Ge(!1)}))},[n,d]);const[rt,ft]=_e.useState(n.tags?.includes("public")||!1),St=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),Dt=!(n.tags&&n.tags.some(ne=>ne.startsWith("owner:")))||St,Vt=async()=>{const ne=!rt;try{const te=n.tags||[];let he;ne?he=[...te,"public"]:he=te.filter(Ee=>Ee!=="public"),ft(ne),await xn.updateRecipe({id:n.id,tags:he})}catch(te){console.error("Failed to toggle public",te),x.error(""),ft(!ne)}},wt=(ne,te,he=!1)=>G==="ORIGINAL"||!k||!te||ne===te?ne:i.jsxs(i.Fragment,{children:[ne,he?i.jsx("br",{}):" ",i.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",te,")"]})]}),ie=async ne=>{const te=ne.target.value;if(q(te),te!=="ORIGINAL"&&!F[te]){P(!0);try{const he=await uE.translateRecipe(n,te);K(Ee=>({...Ee,[te]:he}))}catch(he){console.error(he),x.error(""),q("ORIGINAL")}finally{P(!1)}}},je=ne=>{$(te=>{const he=new Set(te);return he.has(ne)?he.delete(ne):he.add(ne),he})},Ce=ne=>{C(te=>{const he=new Set(te);return he.has(ne)?he.delete(ne):he.add(ne),he})},Ue=ne=>{R(te=>{const he=new Set(te);return he.has(ne)?he.delete(ne):he.add(ne),he})};_e.useEffect(()=>{window.scrollTo(0,0),h&&n&&!d&&h(n.id);const ne=document.title;return n&&n.title&&(document.title=n.title),K({}),q("ORIGINAL"),$(new Set),C(new Set),R(new Set),ft(n.tags?.includes("public")||!1),()=>{document.title=ne}},[n.id,n.title]),_e.useEffect(()=>{n&&n.servings?O(n.servings.toString()):O(""),xe("")},[n]);const st=()=>{_(!0)},ct=()=>{_(!1),o(n)},Rt=()=>{_(!1)},Jt=()=>{D(!0)},wn=()=>{D(!1),u(n)},jt=()=>{D(!1)},rn=()=>{j(!0)},cn=async()=>{j(!1);try{const ne=await xn.duplicateRecipe(n,v);p&&p(ne)}catch(ne){console.error("Duplication failed",ne),x.error("")}},vn=()=>{j(!1)},Ln=_e.useRef(null),ar=_e.useRef(null),me=ne=>{ar.current=null,Ln.current=ne.targetTouches[0].clientX},He=ne=>{ar.current=ne.targetTouches[0].clientX},Xe=()=>{if(!Ln.current||!ar.current)return;const ne=Ln.current-ar.current,te=Ln.current<50,he=ne<-100;te&&he&&s()},Ve=ne=>{const te=Math.round(parseFloat(ne)),he=parseFloat(Me),Ee=parseFloat(ae);let Ie=null,Je=null,Ke=null;return!isNaN(te)&&!isNaN(Ee)&&Ee>0&&(Ke=te/Ee),!isNaN(te)&&!isNaN(he)&&!isNaN(Ee)&&he>0&&Ee>0&&(Je=he*Ee,Ie=te/Je*100),i.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[i.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("span",{children:["  ",i.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),i.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),i.jsx("input",{type:"number",value:Me,onChange:H=>xe(H.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[i.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),i.jsx("input",{type:"number",value:ae,onChange:H=>O(H.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Ke!==null&&i.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Ie!==null?Ie>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Ie!==null?Ie>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Ie!==null?"6px":"0"},children:["1(): ",i.jsxs("strong",{children:["",Ke.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Ie!==null&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",Je.toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(Je-te).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Ie>40?"#d32f2f":"#2e7d32"},children:[": ",Ie.toFixed(1),"%"]})]})]})]})]})},et=Ye.ingredients||[];let Mt=pe.steps||[];const vt=ne=>String(ne||"").trim().toLowerCase(),kt=ne=>{const te=vt(ne);return te?["","","steps","method"].some(he=>te===he||te.includes(he)):!1};if(!Mt.length&&pe.ingredientGroups){const ne=pe.ingredientGroups.find(te=>kt(te.name));if(ne)Mt=et.filter(he=>he.groupId===ne.id).map(he=>typeof he=="string"?he:{...he,text:he.name||he.text||""});else{const te=et.filter(he=>kt(he.group)||kt(he.groupName));te.length&&(Mt=te.map(he=>typeof he=="string"?he:{...he,text:he.name||he.text||""}))}}const Ze=Mt,Bt=_e.useMemo(()=>{const ne=pe.ingredientGroups||[],te=["","steps","method",""],he=H=>String(H||"").trim().toLowerCase(),Ee=new Set(ne.filter(H=>te.includes(he(H.name))).map(H=>H.id)),Ie=ne.filter(H=>!Ee.has(H.id));if(!Ie.length)return[{id:"default",name:null,items:et.filter(H=>!Ee.has(H.groupId))}];const Je=Ie.map(H=>{const ze=et.filter(Fe=>Fe.groupId===H.id);return{id:H.id,name:H.name===""?null:H.name,items:ze}}).filter(H=>H.items.length>0),Ke=et.filter(H=>H.groupId?Ee.has(H.groupId)?!1:!Ie.some(ze=>ze.id===H.groupId):!0);return Ke.length&&Je.push({id:"ungrouped",name:null,items:Ke}),Je.length?Je:[{id:"default",name:null,items:et.filter(H=>!Ee.has(H.groupId))}]},[pe.ingredientGroups,et]),Qe=_e.useMemo(()=>{if(pe.type!=="bread")return null;const ne=Ye.flours||[],te=Ye.breadIngredients||[],he=ne.reduce((De,dt)=>De+(parseFloat(dt.quantity)||0),0),Ee=he+te.reduce((De,dt)=>De+(parseFloat(dt.quantity)||0),0),Ie=parseFloat(B),Je=Ie&&Ee?Ie/Ee:1,Ke=De=>he?((parseFloat(De)||0)/he*100).toFixed(1):"0.0",H=De=>Ie?((parseFloat(De)||0)*Je).toFixed(1):De,ze=De=>{const dt=parseFloat(De)||0;if(!Ie)return dt;const Ft=dt*Je;return Math.round(Ft*100)/100},Fe=De=>{const dt=ze(De);return Number.isFinite(dt)?dt.toLocaleString(void 0,{maximumFractionDigits:2}):""},_t=De=>De.reduce((dt,Ft)=>{const Et=(parseFloat(Ft.cost)||0)*(Ie?Je:1),Vn=Ii(Ft);return dt+Et*Vn},0);return{flours:ne,others:te,totalFlour:he,grandTotal:Ee,calcPercent:Ke,getScaledQtyValue:H,getScaledCostValue:ze,formatCostValue:Fe,scaleFactor:Je,totalTaxIncluded:_t(ne)+_t(te)}},[Ye.breadIngredients,Ye.flours,pe.type,B]),Ut=_e.useMemo(()=>pe.type==="bread"?0:et.reduce((ne,te)=>{const Ee=(parseFloat(te.cost)||0)*J,Ie=Ii(te);return ne+Ee*Ie},0),[pe.type,et,J]),Xt=pe.type==="bread"?Qe?Math.round(Qe.totalTaxIncluded).toLocaleString():"0":Math.round(Ut).toLocaleString(),Qt=pe.description||n.description;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:me,onTouchMove:He,onTouchEnd:Xe,children:[N&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(le,{variant:"ghost",onClick:vn,children:""}),i.jsx(le,{variant:"primary",onClick:cn,children:""})]})]})}),T&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),""]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(le,{variant:"ghost",onClick:jt,children:""}),i.jsx(le,{variant:"danger",onClick:wn,children:""})]})]})}),S&&i.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[i.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("small",{style:{color:"#666"},children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(le,{variant:"ghost",onClick:Rt,children:""}),i.jsx(le,{variant:"danger",onClick:ct,children:""})]})]})}),i.jsxs("div",{className:"recipe-detail__header",children:[i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx(le,{variant:"secondary",onClick:s,size:"sm",children:m||" "}),y&&i.jsx(le,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&i.jsxs("div",{className:"recipe-detail__actions",children:[Dt&&(v?.displayId==="yoshito"||v?.role==="admin")&&i.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:i.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:rt,onChange:Vt,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),i.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:rt?"#4CAF50":"#888"},children:rt?"":""})]})}),!Dt&&i.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),i.jsxs("select",{className:"language-select",value:G,onChange:ie,disabled:V,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[i.jsx("option",{value:"ORIGINAL",children:" Original ()"}),yE.map(ne=>i.jsx("option",{value:ne.code,children:ne.label},ne.code))]}),G!=="ORIGINAL"&&i.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[i.jsx("input",{type:"checkbox",checked:k,onChange:ne=>E(ne.target.checked),style:{marginRight:"4px"}}),""]}),i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Y(!0),children:" "}),i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),i.jsx(le,{variant:"secondary",size:"sm",onClick:rn,children:""}),Dt&&i.jsxs(i.Fragment,{children:[i.jsx(le,{variant:"secondary",size:"sm",onClick:l,children:""}),i.jsx(le,{variant:"danger",size:"sm",onClick:st,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&i.jsxs("div",{className:"recipe-detail__actions",children:[i.jsx(le,{variant:"ghost",size:"sm",onClick:Jt,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),i.jsx(le,{variant:"primary",size:"sm",onClick:()=>o(n,!0),children:""})]})]}),i.jsx("div",{className:"recipe-detail__hero",children:pe.image?i.jsx("img",{src:pe.image,alt:pe.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),i.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[i.jsx("h1",{children:wt(pe.title,n.title)}),i.jsx("p",{className:"recipe-detail__desc",children:wt(pe.description,n.description,!0)}),v?.role==="admin"&&t&&i.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),i.jsxs("div",{className:"recipe-detail__meta",children:[pe.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:wt(pe.course,n.course)})]}),pe.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:wt(pe.category,n.category)})]}),pe.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:wt(pe.storeName,n.storeName)})]}),i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[pe.servings,""]})]})]}),pe.sourceUrl&&i.jsxs("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsx("div",{style:{fontSize:"0.85rem"},children:i.jsxs("a",{href:pe.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",i.jsx("span",{className:"screen-only",children:""}),i.jsx("span",{className:"print-only",children:""})]})}),i.jsx("div",{style:{background:"white",padding:"4px",width:"fit-content"},children:i.jsx(TE,{value:pe.sourceUrl,size:128,style:{display:"block"}})})]})]}),i.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[i.jsxs("span",{children:[" : ",bx(n.created_at)]}),n.updated_at&&i.jsxs("span",{children:[" : ",bx(n.updated_at)]})]}),i.jsx("div",{className:"recipe-detail__content",children:i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),i.jsx(tn,{className:"ingredients-card",children:pe.type==="bread"?i.jsx("div",{className:"bread-detail-view",children:(()=>{const ne=Ye.flours||[],te=Ye.breadIngredients||[],he=ne.reduce((De,dt)=>De+(parseFloat(dt.quantity)||0),0),Ee=he+te.reduce((De,dt)=>De+(parseFloat(dt.quantity)||0),0),Ie=he?(Ee/he*100).toFixed(1):"0.0",Je=De=>he?((parseFloat(De)||0)/he*100).toFixed(1):"0.0",Ke=parseFloat(B),H=Ke&&Ee?Ke/Ee:1,ze=De=>Ke?((parseFloat(De)||0)*H).toFixed(1):De,Fe=De=>{const dt=parseFloat(De)||0;if(!Ke)return dt;const Ft=dt*H;return Math.round(Ft*100)/100},_t=De=>Number.isFinite(De)?De.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[Ee.toLocaleString(),"g"]}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Ie,"%)"]})]}),i.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[i.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),i.jsxs("div",{style:{position:"relative"},children:[i.jsx("input",{id:"target-total-input",type:"number",value:B,onChange:De=>W(De.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),i.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),B&&i.jsx(le,{variant:"ghost",size:"sm",onClick:()=>W(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),B&&i.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",H.toFixed(3)," "]})]}),i.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[i.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[i.jsx("span",{children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",B?ze(he):he,"g (100%)"]})]}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:ne.map((De,dt)=>{const Ft=n.flours?.[dt]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`flour-${dt}`}),i.jsx("label",{htmlFor:`flour-${dt}`,children:wt(De.name,Ft?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:B?i.jsx("span",{style:{color:"var(--color-primary)"},children:ze(De.quantity)}):De.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[Je(De.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:is(De.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:De.cost?`${_t(Fe(De.cost))}`:"-"})]},dt)})})]})]}),i.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[i.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:te.map((De,dt)=>{const Ft=n.breadIngredients?.[dt]||{};return i.jsxs("tr",{children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ingredient-${dt}`}),i.jsx("label",{htmlFor:`ingredient-${dt}`,children:wt(De.name,Ft?.name)})]})}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:B?i.jsx("span",{style:{color:"var(--color-primary)"},children:ze(De.quantity)}):De.quantity}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[Je(De.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:is(De.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:De.cost?`${_t(Fe(De.cost))}`:"-"})]},dt)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const De=Ft=>Ft.reduce((Nn,Et)=>{const Vn=parseFloat(Et.cost)||0,sn=Ii(Et),Nt=Vn*H;return Nn+Nt*sn},0),dt=De(ne)+De(te);return Math.round(dt).toLocaleString()})()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const De=Ft=>Ft.reduce((Nn,Et)=>{const Vn=parseFloat(Et.cost)||0,sn=Ii(Et),Nt=Vn*H;return Nn+Nt*sn},0),dt=De(ne)+De(te);return Ve(dt)})()]})]})})()}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[i.jsx("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:":"}),i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),i.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:Z,onChange:ne=>ye(ne.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(Z)!==1&&i.jsx(le,{variant:"ghost",size:"sm",onClick:()=>ye("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const ne=pe.ingredientGroups&&pe.ingredientGroups.length>0?pe.ingredientGroups:null;return ne?ne.map(te=>{const he=et.filter(Ee=>Ee.groupId===te.id);return he.length===0||["","Steps","Method",""].includes(te.name)?null:i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(te.name)?"none":"block"},children:te.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:he.map((Ee,Ie)=>{const Je=et.indexOf(Ee),Ke=n.ingredients?.[Je],H=typeof Ee=="string"?Ee:Ee.name,ze=Ke?typeof Ke=="string"?Ke:Ke.name:"",Fe=ce(Ee.quantity,Z),_t=Se(Ee.cost,Z),De=String(Z)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${te.id}-${Ie}`}),i.jsx("label",{htmlFor:`ing-${te.id}-${Ie}`,children:wt(H,ze)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:De?"bold":"normal",color:De?"var(--color-primary)":"inherit"},children:Fe}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:Ee.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:is(Ee.purchaseCost)??"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[is(_t)??"-",tp(Ee)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Ie)})})]})]},te.id)}):i.jsxs(i.Fragment,{children:[i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:et.map((te,he)=>{const Ee=n.ingredients?.[he],Ie=typeof te=="string"?te:te.name,Je=Ee?typeof Ee=="string"?Ee:Ee.name:"",Ke=ce(te.quantity,Z),H=Se(te.cost,Z),ze=String(Z)!=="1";return i.jsxs("tr",{className:"ingredient-row",children:[i.jsx("td",{children:i.jsxs("div",{className:"ingredient-name",children:[i.jsx("input",{type:"checkbox",id:`ing-${he}`}),i.jsx("label",{htmlFor:`ing-${he}`,children:wt(Ie,Je)})]})}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:ze?"bold":"normal",color:ze?"var(--color-primary)":"inherit"},children:Ke}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:te.unit}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:is(te.purchaseCost)??"-"}),i.jsxs("td",{style:{textAlign:"right"},children:[is(H)??"-",tp(te)&&i.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},he)})})]}),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((he=>he.reduce((Ee,Ie)=>{const Je=parseFloat(Ie.cost)||0,Ke=Ii(Ie),H=Se(Je,Z),ze=parseFloat(H)||0;return Ee+ze*Ke},0))(et)).toLocaleString()]})]})]})})(),i.jsx("div",{className:"screen-only no-print",children:i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Math.round((te=>te.reduce((he,Ee)=>{const Ie=parseFloat(Ee.cost)||0,Je=Ii(Ee),Ke=Se(Ie,Z),H=parseFloat(Ke)||0;return he+H*Je},0))(et)).toLocaleString()]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]})}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const te=(he=>he.reduce((Ee,Ie)=>{const Je=parseFloat(Ie.cost)||0,Ke=Ii(Ie),H=parseFloat(Se(Je,Z))||0;return Ee+H*Ke},0))(et);return Ve(te)})()]})})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),(()=>{const ne=pe.stepGroups&&pe.stepGroups.length>0?pe.stepGroups:null,te=ne&&Ze.some(he=>!he||typeof he!="object"||!he.groupId?!1:ne.some(Ee=>Ee.id===he.groupId));return ne&&te?i.jsx("div",{className:"steps-container",children:ne.map(he=>{const Ee=Ze.filter(Ie=>(typeof Ie=="object"?Ie.groupId:null)===he.id);return Ee.length===0?null:i.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[he.name!==""&&he.name!=="Steps"&&i.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:he.name}),i.jsx("div",{className:"steps-list",children:Ee.map((Ie,Je)=>{const Ke=Ze.indexOf(Ie),H=typeof Ie=="object"?Ie.text:Ie,ze=n.steps?.[Ke],Fe=typeof ze=="object"?ze.text:ze,_t=De=>De?De.replace(/<[^>]*>?/gm,""):"";return i.jsxs(tn,{className:`step-card ${M.has(Ke)?"is-completed":""}`,onClick:()=>je(Ke),children:[i.jsx("div",{className:"step-number",children:Ke+1}),i.jsx("p",{className:"step-text",children:wt(_t(H),_t(Fe),!0)})]},Je)})})]},he.id)})}):i.jsx("div",{className:"steps-list",children:Ze.map((he,Ee)=>{const Ie=typeof he=="object"?he.text:he,Je=n.steps?.[Ee],Ke=typeof Je=="object"?Je.text:Je;return i.jsxs(tn,{className:`step-card ${M.has(Ee)?"is-completed":""}`,onClick:()=>je(Ee),children:[i.jsx("div",{className:"step-number",children:Ee+1}),i.jsx("p",{className:"step-text",children:wt(Ie,Ke,!0)})]},Ee)})})})()]})]})}),i.jsx(Cn,{isOpen:L,onClose:()=>Y(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-recipe",children:[i.jsx("div",{className:"preview-header",children:i.jsx("h2",{children:pe.title})}),i.jsxs("div",{className:"preview-meta",children:[pe.course&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",pe.course]}),pe.category&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",pe.category]}),pe.storeName&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",pe.storeName]}),pe.servings&&i.jsxs("div",{children:[i.jsx("strong",{children:":"})," ",pe.servings,""]})]}),pe.description&&i.jsx("div",{className:"preview-description",children:i.jsx("p",{children:pe.description})}),i.jsx("div",{className:"preview-controls",children:pe.type==="bread"?i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),i.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:B,onChange:ne=>W(ne.target.value),placeholder:"1000"}),B&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>W(""),children:""}),Qe?.grandTotal?i.jsxs("span",{className:"preview-control-note",children:[": ",Qe.grandTotal.toLocaleString(),"g"]}):null]}):i.jsxs("div",{className:"preview-control-row",children:[i.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:""}),i.jsx("span",{className:"preview-control-mult",children:""}),i.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:Z,onChange:ne=>ye(ne.target.value),placeholder:"1"}),String(Z)!=="1"&&i.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>ye("1"),children:""})]})}),i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),pe.type==="bread"?i.jsxs("div",{className:"preview-ingredients-bread",children:[i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Ye.flours||[]).map((ne,te)=>{const he=`flour-${te}`,Ee=Qe?Qe.getScaledQtyValue(ne.quantity):ne.quantity;return i.jsxs("tr",{className:z.has(he)?"is-completed":"",onClick:()=>Ue(he),role:"button",tabIndex:0,onKeyDown:Ie=>{(Ie.key==="Enter"||Ie.key===" ")&&(Ie.preventDefault(),Ue(he))},children:[i.jsx("td",{children:ne.name}),i.jsxs("td",{style:{textAlign:"right"},children:[Ee,"g"]})]},te)})})]})]}),i.jsxs("div",{className:"bread-group",children:[i.jsx("h4",{children:""}),i.jsxs("table",{className:"preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:(Ye.breadIngredients||[]).map((ne,te)=>{const he=`bread-${te}`,Ee=Qe?Qe.getScaledQtyValue(ne.quantity):ne.quantity;return i.jsxs("tr",{className:z.has(he)?"is-completed":"",onClick:()=>Ue(he),role:"button",tabIndex:0,onKeyDown:Ie=>{(Ie.key==="Enter"||Ie.key===" ")&&(Ie.preventDefault(),Ue(he))},children:[i.jsx("td",{children:ne.name}),i.jsxs("td",{style:{textAlign:"right"},children:[Ee,"g"]})]},te)})})]})]})]}):i.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const ne=pe.ingredientGroups&&pe.ingredientGroups.length>0?pe.ingredientGroups:null;return ne?ne.map(te=>{const he=et.filter(Ee=>Ee.groupId===te.id);return he.length===0||["","Steps","Method",""].includes(te.name)?null:i.jsxs("div",{className:"ingredient-group",children:[i.jsx("h4",{children:te.name}),i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:he.map((Ee,Ie)=>{const Je=`${te.id}-${Ie}`,Ke=typeof Ee=="string"?Ee:Ee.name,H=typeof Ee=="object"?ce(Ee.quantity,J):"",ze=typeof Ee=="object"?Ee.unit:"";return i.jsxs("tr",{className:z.has(Je)?"is-completed":"",onClick:()=>Ue(Je),role:"button",tabIndex:0,onKeyDown:Fe=>{(Fe.key==="Enter"||Fe.key===" ")&&(Fe.preventDefault(),Ue(Je))},children:[i.jsx("td",{children:Ke}),i.jsx("td",{style:{textAlign:"right"},children:H}),i.jsx("td",{children:ze})]},Ie)})})]})]},te.id)}):i.jsxs("table",{className:"preview-table preview-table--normal",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:et.map((te,he)=>{const Ee=`ungrouped-${he}`,Ie=typeof te=="string"?te:te.name,Je=typeof te=="object"?ce(te.quantity,J):"",Ke=typeof te=="object"?te.unit:"";return i.jsxs("tr",{className:z.has(Ee)?"is-completed":"",onClick:()=>Ue(Ee),role:"button",tabIndex:0,onKeyDown:H=>{(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),Ue(Ee))},children:[i.jsx("td",{children:Ie}),i.jsx("td",{style:{textAlign:"right"},children:Je}),i.jsx("td",{children:Ke})]},he)})})]})})()})]}),Ze.length>0&&i.jsxs("div",{className:"preview-section",children:[i.jsx("h3",{children:""}),i.jsx("ol",{className:"preview-steps",children:Ze.map((ne,te)=>{const he=typeof ne=="object"?ne.text:ne;return i.jsx("li",{className:U.has(te)?"is-completed":"",onClick:()=>Ce(te),role:"button",tabIndex:0,onKeyDown:Ee=>{(Ee.key==="Enter"||Ee.key===" ")&&(Ee.preventDefault(),Ce(te))},children:he},te)})})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(le,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(le,{variant:"ghost",onClick:()=>Y(!1),children:""})]})]})})]}),i.jsxs("div",{className:"print-layout",children:[i.jsx("div",{className:"recipe-detail__hero",children:pe.image?i.jsx("img",{src:pe.image,alt:pe.title,className:"recipe-detail__image"}):i.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),i.jsxs("div",{className:"recipe-detail__title-card",children:[i.jsx("h1",{children:pe.title}),Qt&&i.jsx("p",{className:"recipe-detail__desc",children:Qt})]}),i.jsxs("div",{className:"recipe-detail__meta",children:[pe.category&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:pe.category})]}),pe.storeName&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value meta-value--store",children:pe.storeName})]}),pe.course&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsx("span",{className:"meta-value",children:pe.course})]}),pe.servings&&i.jsxs("div",{className:"meta-item",children:[i.jsx("span",{className:"meta-label",children:""}),i.jsxs("span",{className:"meta-value",children:[pe.servings,""]})]})]}),i.jsxs("div",{className:"recipe-detail__main",children:[i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),pe.type==="bread"&&Qe?i.jsxs("div",{children:[i.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:Qe.flours.map((ne,te)=>i.jsxs("tr",{children:[i.jsx("td",{children:ne.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Qe.getScaledQtyValue(ne.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[Qe.calcPercent(ne.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:is(ne.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:ne.cost?`${Qe.formatCostValue(ne.cost)}`:"-"})]},`print-flour-${te}`))})]})]}),i.jsxs("div",{className:"bread-section",children:[i.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:""}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:" (g)"}),i.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"80px"},children:""})]})}),i.jsx("tbody",{children:Qe.others.map((ne,te)=>i.jsxs("tr",{children:[i.jsx("td",{children:ne.name}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Qe.getScaledQtyValue(ne.quantity)}),i.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[Qe.calcPercent(ne.quantity),"%"]}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:is(ne.purchaseCost)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:ne.cost?`${Qe.formatCostValue(ne.cost)}`:"-"})]},`print-others-${te}`))})]})]})]}):Bt.map(ne=>i.jsxs("div",{style:{marginBottom:"1.2rem"},children:[ne.name&&i.jsx("div",{className:"print-group-heading",children:ne.name}),i.jsxs("table",{className:"ingredients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"15%",textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:ne.items.map((te,he)=>{const Ee=typeof te=="object"?te.quantity:"",Ie=typeof te=="object"?te.unit:"",Je=typeof te=="object"?te.purchaseCost:null,Ke=typeof te=="object"?te.cost:null,H=typeof te=="string"?te:te.name,ze=typeof te=="object"?ce(te.quantity,J):Ee;return i.jsxs("tr",{children:[i.jsx("td",{children:H}),i.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:ze}),i.jsx("td",{style:{paddingLeft:"0.5rem"},children:Ie}),i.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:is(Je)??"-"}),i.jsx("td",{style:{textAlign:"right"},children:is(Ke)??"-"})]},`print-ing-${ne.id}-${he}`)})})]})]},ne.id)),i.jsxs("div",{className:"cost-summary",children:[i.jsx("span",{className:"cost-summary__label",children:":"}),i.jsxs("span",{className:"cost-summary__value",children:["",Xt]}),i.jsx("span",{className:"cost-summary__note",children:"()"})]}),i.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),i.jsxs("section",{className:"detail-section",children:[i.jsx("h2",{children:""}),Ze.length>0?i.jsx("div",{className:"steps-list",children:Ze.map((ne,te)=>{const he=typeof ne=="object"?ne.text:ne;return i.jsxs("div",{className:"step-card",children:[i.jsx("div",{className:"step-number",children:te+1}),i.jsx("p",{className:"step-text",children:he})]},`print-step-${te}`)})}):i.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:""})]})]})]})]})},lb=n=>{if(n==null)return"";let t=String(n);return t=t.replace(/[-]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[--]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},zt=({label:n,id:t,error:s,textarea:l,...o})=>{const u=l?"textarea":"input",d=o.type==="number"||o.inputMode==="decimal"||o.inputMode==="numeric",h=p=>{if(!o.onChange)return;if(!d){o.onChange(p);return}const m=p?.target?.value??"",y=lb(m);if(y===m){o.onChange(p);return}o.onChange({target:{id:p?.target?.id,name:p?.target?.name,value:y}})};return i.jsxs("div",{className:`input-group ${s?"input-group--error":""} ${o.wrapperClassName||""}`,children:[n&&i.jsx("label",{htmlFor:t,className:"input-label",children:n}),i.jsx(u,{id:t,className:`input-field ${o.className||""}`,style:o.style,...o,onChange:h}),s&&i.jsx("span",{className:"input-error",children:s})]})},as="app-data",nr={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const s=String(t||"").replace(/^\/+/,"");return`${n}/${s}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:s}=await Re.storage.from(as).list(n);if(s)return console.warn("Failed to list price files:",s.message),[];if(!t||t.length===0)return[];const l=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:h,error:p}=await Re.storage.from(as).download(d);if(p)return console.error(`Failed to download ${u.name}:`,p),null;const m=await h.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(m)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(m)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(l)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._cacheByUserId.get(t);if(s)return s;try{const l=new Map,o=await this._downloadAllCsvTexts(t);if(!o||o.length===0)return new Map;for(const{text:u}of o){if(!u)continue;const d=this.parseCSV(u);for(const[h,p]of d)if(l.has(h)){const m=l.get(h);(p?.dateStr||"")>(m?.dateStr||"")&&l.set(h,p)}else l.set(h,p)}return this._cacheByUserId.set(t,l),l}catch(l){return console.error("Error in fetchPriceList:",l),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:s,error:l}=await Re.storage.from(as).list(t);if(l)throw l;return s.filter(o=>String(o?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=n.name;this.clearCache(s);const o=this._getUserScopedPath(s,l),{data:u,error:d}=await Re.storage.from(as).upload(o,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(s){return console.error("Error uploading price list:",s),{success:!1,error:s}}},async deletePriceFile(n,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");this.clearCache(s);const l=this._getUserScopedPath(s,n),{data:o,error:u}=await Re.storage.from(as).remove([l]);if(u)throw u;if(!o||o.length===0)throw new Error("");return{success:!0,data:o}}catch(s){return console.error("Error deleting price file:",s),{success:!1,error:s}}},_splitFileName(n){const t=String(n||""),s=t.lastIndexOf(".");return s<=0?{base:t,ext:""}:{base:t.slice(0,s),ext:t.slice(s)}},_makeCopyFileName(n,t){const s=String(n||"");if(!t?.has?.(s))return s;const{base:l,ext:o}=this._splitFileName(s),u=l||s||"price";let d=1;for(;d<1e3;){const h=d===1?"_copy":`_copy${d}`,p=`${u}${h}${o}`;if(!t.has(p))return p;d++}return`${u}_copy_${Date.now()}${o}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:t=null,onProgress:s=null}={}){const l=t||await this._getCurrentUserId();if(!l)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("");if(o===l)throw new Error("");const{data:u,error:d}=await Re.storage.from(as).list(l);if(d)throw d;const h=(u||[]).map(S=>S?.name).filter(Boolean).filter(S=>String(S).toLowerCase().endsWith(".csv")),{data:p,error:m}=await Re.storage.from(as).list(o);let y=new Set;if(m){const S=String(m?.message||"").toLowerCase();if(S.includes("not found")||S.includes("404"))y=new Set;else throw m}else y=new Set((p||[]).map(S=>S?.name).filter(Boolean));const v={sourceUserId:l,targetUserId:o,copied:[],skipped:[],failed:[]},x=h.length;s?.({phase:"start",total:x,done:0,current:""});for(let S=0;S<h.length;S++){const _=h[S],N=this._makeCopyFileName(_,y);y.add(N);const j=this._getUserScopedPath(l,_),T=this._getUserScopedPath(o,N);s?.({phase:"progress",total:x,done:S,current:`${_}  ${N}`,fromFile:_,toFile:N});try{const{data:D,error:M}=await Re.storage.from(as).download(j);if(M)throw M;if(!D)throw new Error("");const{error:$}=await Re.storage.from(as).upload(T,D,{upsert:!1,contentType:"text/csv"});if($){const U=String($?.message||"").toLowerCase();if(U.includes("already exists")||U.includes("exists")||U.includes("409")){let C=0,z=$;for(;C<5;){C++;const R=this._makeCopyFileName(_,y);y.add(R);const F=this._getUserScopedPath(o,R),{error:K}=await Re.storage.from(as).upload(F,D,{upsert:!1,contentType:"text/csv"});if(!K){v.copied.push({fromFile:_,toFile:R}),z=null;break}z=K}if(z)throw z;continue}throw $}v.copied.push({fromFile:_,toFile:N})}catch(D){console.error("copyPriceFilesToUser failed:",D),v.failed.push({file:_,errorMessage:String(D?.message||D)})}s?.({phase:"progress",total:x,done:S+1,current:`${_}  ${N}`,fromFile:_,toFile:N})}return s?.({phase:"done",total:x,done:x,current:"",result:v}),this.clearCache(o),v},parseCSV(n){const t=new Map,s=n.split(/\r?\n/).filter(o=>o.trim());if(s.length===0)return t;if(s.some(o=>o.startsWith("D,")||o.startsWith('"D",')))for(let o of s){const u=[];let d="",h=!1;for(let j=0;j<o.length;j++){const T=o[j];T==='"'?h=!h:T===","&&!h?(u.push(d),d=""):d+=T}u.push(d);const p=u.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j));if(p[0]!=="D")continue;const m=p[1],y=p[8],v=p[14],x=p[18],S=p[20],_=String(v??"").trim(),N=nn(_);if(N&&x){const j=parseFloat(x);if(!isNaN(j)){const T={price:j,vendor:y,unit:S,dateStr:m,displayName:_};if(t.has(N)){const D=t.get(N);(m||"")>=(D?.dateStr||"")&&t.set(N,T)}else t.set(N,T)}}}else{let o={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(s[0].split(",").map(p=>p.trim().replace(/^"|"$/g,"")).forEach((p,m)=>{["","","","","name","item"].some(y=>p.includes(y))&&(o.name=m),["","","","","price","cost"].some(y=>p.includes(y))&&(o.price=m),["","unit"].some(y=>p.includes(y))&&(o.unit=m),["","","","vendor","supplier"].some(y=>p.includes(y))&&(o.vendor=m)}),o.name===-1&&o.price===-1){o={name:0,price:1,unit:2,vendor:3};const p=s[0].split(",");isNaN(parseFloat(p[1]))&&(u=1)}else u=1;const h=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let p=u;p<s.length;p++){const m=s[p],y=[];let v="",x=!1;for(let $=0;$<m.length;$++){const U=m[$];U==='"'?x=!x:U===","&&!x?(y.push(v),v=""):v+=U}y.push(v);const S=y.map($=>($=$.trim(),$.startsWith('"')&&$.endsWith('"')?$.slice(1,-1):$)),_=o.name>-1?S[o.name]:null,N=o.price>-1?S[o.price]:null,j=o.unit>-1?S[o.unit]:"",T=o.vendor>-1?S[o.vendor]:"",D=String(_??"").trim(),M=nn(D);if(M&&N){const $=parseFloat(N.replace(/[^0-9.]/g,""));isNaN($)||t.set(M,{price:$,vendor:T,unit:j,dateStr:h,displayName:D})}}}return t},parseCSVEntries(n,t=""){const s=[],l=n.split(/\r?\n/).filter(x=>x.trim());if(l.length===0)return s;const o=x=>{const S=String(x??"").trim();if(!S)return null;const _=parseFloat(S.replace(/[^0-9.]/g,""));return Number.isFinite(_)?_:null},u=x=>{const S=[];let _="",N=!1;for(let j=0;j<x.length;j++){const T=x[j];T==='"'?N=!N:T===","&&!N?(S.push(_),_=""):_+=T}return S.push(_),S.map(j=>(j=j.trim(),j.startsWith('"')&&j.endsWith('"')?j.slice(1,-1):j))},d=x=>{const S=String(x??"").trim();if(!S)return"";const _=S.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(_)return`${_[1]}/${String(_[2]).padStart(2,"0")}/${String(_[3]).padStart(2,"0")}`;const N=S.match(/^(\d{4})(\d{2})(\d{2})$/);return N?`${N[1]}/${N[2]}/${N[3]}`:S};if(l.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of l){const S=u(x);if(S[0]!=="D")continue;const _=d(S[1]),N=S[8],j=S[14],T=S[18],D=o(S[19]),M=S[20],$=String(j??"").trim(),U=nn($);if(!U||!T)continue;const C=o(T);Number.isFinite(C)&&s.push({key:U,displayName:$,price:C,vendor:N,unit:M,dateStr:_,incomingQty:D,sourceFile:t})}return s}let p={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},m=0;if(l[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,S)=>{const _=String(x||"").toLowerCase();["","","","","name","item"].some(N=>_.includes(N))&&(p.name=S),["","","","","price","cost"].some(N=>_.includes(N))&&(p.price=S),["","unit"].some(N=>_.includes(N))&&(p.unit=S),["","","","vendor","supplier"].some(N=>_.includes(N))&&(p.vendor=S),["","","","date"].some(N=>_.includes(N))&&(p.date=S),["","","","","","qty","quantity"].some(N=>_.includes(N))&&(p.quantity=S)}),p.name===-1&&p.price===-1){p={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=l[0].split(",");isNaN(parseFloat(x[1]))&&(m=1)}else m=1;const v=d(new Date().toISOString().slice(0,10));for(let x=m;x<l.length;x++){const S=u(l[x]),_=p.name>-1?S[p.name]:null,N=p.price>-1?S[p.price]:null,j=p.unit>-1?S[p.unit]:"",T=p.vendor>-1?S[p.vendor]:"",D=p.date>-1?S[p.date]:"",M=p.quantity>-1?o(S[p.quantity]):null,$=String(_??"").trim(),U=nn($);if(!U||!N)continue;const C=o(N);Number.isFinite(C)&&s.push({key:U,displayName:$,price:C,vendor:T,unit:j,dateStr:d(D)||v,incomingQty:M,sourceFile:t})}return s},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const s=this._historyCacheByUserId.get(t);if(s)return s;try{const l=await this._downloadAllCsvTexts(t);if(!l||l.length===0)return new Map;const o=new Map;for(const{fileName:u,text:d}of l){if(!d)continue;this.parseCSVEntries(d,u).forEach(p=>{const m=p?.key;m&&(o.has(m)||o.set(m,[]),o.get(m).push(p))})}for(const u of o.values())u.sort((d,h)=>{const p=String(d?.dateStr||""),m=String(h?.dateStr||"");if(p!==m)return p.localeCompare(m);const y=Number(d?.price),v=Number(h?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(h?.sourceFile||""))});return this._historyCacheByUserId.set(t,o),o}catch(l){return console.error("Error in fetchPriceHistory:",l),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),s=[];for(const[l,o]of t.entries())if(o&&typeof o=="object"){const{displayName:u,...d}=o;s.push({name:u||l,...d})}else s.push({name:l,price:o});return s.sort((l,o)=>l.dateStr&&o.dateStr?o.dateStr.localeCompare(l.dateStr):l.name.localeCompare(o.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(nn(n))||null}},ko={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:s}=await Re.rpc("search_ingredients",{search_query:n,max_results:15});return s?(console.warn(" Database search failed:",s),console.warn("Error message:",s.message),console.warn("Error code:",s.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){const t=String(n||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const s=t.toLowerCase(),l=nn(t);try{const o=await this._searchFromDatabase(s);if(o&&Array.isArray(o)){this._lastDbResults=o,this._lastDbQuery=s;const d=o.map(j=>({name:j.ingredient_name,price:j.last_price,size:j.packet_size,unit:j.packet_unit,itemCategory:j.item_category||null,source:"manual",displaySource:" "}));if(d.length===0)return await this._fallbackSearch(s);if(!this._csvCache){const j=await nr.getPriceListArray();this._csvCache=j.map(T=>({name:T.name,price:T.price,size:null,unit:T.unit,source:"csv",displaySource:" CSV"}))}const h=j=>{if(!l)return null;const T=String(j||"").indexOf(l);return T<0?null:{tier:j===l?0:T===0?1:2,idx:T,len:String(j||"").length}},p=(j,T)=>j.score.tier!==T.score.tier?j.score.tier-T.score.tier:j.score.idx!==T.score.idx?j.score.idx-T.score.idx:j.score.len!==T.score.len?j.score.len-T.score.len:j.name.localeCompare(T.name,"ja"),m=(j,T,D)=>{let M=0;for(;M<j.length&&p(j[M],T)<=0;)M++;j.splice(M,0,T),j.length>D&&j.pop()},v=Math.max(0,15-d.length),x=new Set(d.map(j=>nn(j.name))),S=[],_=new Set;if(v>0)for(const j of this._csvCache){const T=nn(j?.name);if(!T||x.has(T)||_.has(T))continue;const D=h(T);D&&(_.add(T),m(S,{...j,nameKey:T,score:D},v))}const N=S.map(j=>({name:j.name,price:j.price,size:j.size,unit:j.unit,source:j.source,displaySource:j.displaySource}));return[...d,...N]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",o);const u=await this._fallbackSearch(s);return console.log(" Fallback search returned:",u.length,"results"),u}catch(o){return console.error("Error searching ingredients:",o),[]}},async _fallbackSearch(n){try{const t=nn(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[p,m]=await Promise.all([nr.getPriceListArray(),Pn.getAllConversions()]);console.log(" CSV Data rows:",p.length),console.log(" Manual Data items:",m.size);const y=Array.from(m.values()).map(_=>({name:_.ingredientName,price:_.lastPrice,size:_.packetSize,unit:_.packetUnit,itemCategory:_.itemCategory||null,source:"manual",displaySource:" "})),v=p.map(_=>({name:_.name,price:_.price,size:null,unit:_.unit,source:"csv",displaySource:" CSV"})),x=new Set(y.map(_=>_.name)),S=v.filter(_=>!x.has(_.name));this._csvCache=[...y,...S],console.log(" Cache built. Total items:",this._csvCache.length)}const s=p=>{if(!t)return null;const m=String(p||"").indexOf(t);return m<0?null:{tier:p===t?0:m===0?1:2,idx:m,len:String(p||"").length}},l=(p,m)=>p.score.tier!==m.score.tier?p.score.tier-m.score.tier:p.score.idx!==m.score.idx?p.score.idx-m.score.idx:p.score.len!==m.score.len?p.score.len-m.score.len:p.name.localeCompare(m.name,"ja"),o=(p,m,y)=>{let v=0;for(;v<p.length&&l(p[v],m)<=0;)v++;p.splice(v,0,m),p.length>y&&p.pop()},u=15,d=[],h=new Set;for(const p of this._csvCache){const m=nn(p?.name);if(!m||h.has(m))continue;const y=s(m);y&&(h.add(m),o(d,{...p,nameKey:m,score:y},u))}return d.map(p=>({name:p.name,price:p.price,size:p.size,unit:p.unit,itemCategory:p.itemCategory||null,source:p.source,displaySource:p.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},Cp=({value:n,onChange:t,placeholder:s,disabled:l,onSelect:o})=>{const[u,d]=b.useState([]),[h,p]=b.useState(!1),[m,y]=b.useState(-1),v=b.useRef(null),x=b.useRef(null),[S,_]=b.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),N=b.useCallback(()=>{if(v.current){const U=v.current.getBoundingClientRect(),C=8,z=4,R=U.top-C,F=window.innerHeight-U.bottom-C,G=(R>=180||R>=F)&&R>=110,q=Math.max(110,Math.min(280,G?R-z:F-z)),V=U.left,P=Math.max(220,window.innerWidth-C*2),k=Math.min(Math.max(U.width,220),P),E=Math.min(Math.max(C,V),window.innerWidth-C-k);_({top:G?U.top-z:U.bottom+z,left:E,width:k,maxHeight:q,placeAbove:G})}},[]);b.useEffect(()=>{const U=R=>{v.current&&!v.current.contains(R.target)&&x.current&&!x.current.contains(R.target)&&p(!1)},C=R=>{x.current&&x.current.contains(R.target)||p(!1)},z=()=>{h&&N()};return document.addEventListener("mousedown",U),window.addEventListener("scroll",C,{capture:!0}),window.addEventListener("resize",z),()=>{document.removeEventListener("mousedown",U),window.removeEventListener("scroll",C,{capture:!0}),window.removeEventListener("resize",z)}},[h,N]),b.useEffect(()=>{h&&N()},[h,u,N]);const j=b.useRef(0),T=b.useRef(null),D=async U=>{const C=U.target.value;if(t(U),T.current&&clearTimeout(T.current),C.length===0){p(!1);return}T.current=setTimeout(async()=>{if(C.length>0){const z=++j.current;console.log(" AutocompleteInput: Fetching suggestions for:",C);const R=await ko.search(C);console.log(" AutocompleteInput: Got",R.length,"suggestions"),z===j.current&&(d(R),p(R.length>0),y(-1))}},150)},M=U=>{const C={target:{value:U.name}};t(C),p(!1),o&&o(U)},$=U=>{h&&(U.key==="ArrowDown"?(U.preventDefault(),y(C=>C<u.length-1?C+1:C)):U.key==="ArrowUp"?(U.preventDefault(),y(C=>C>0?C-1:-1)):U.key==="Enter"?m>=0&&(U.preventDefault(),M(u[m])):U.key==="Escape"&&p(!1))};return i.jsxs("div",{className:"autocomplete-wrapper",ref:v,children:[i.jsx("input",{type:"text",className:"input-field autocomplete-input",value:n,onChange:D,onKeyDown:$,onFocus:async()=>{if(n&&n.length>0){N();const U=await ko.search(n);d(U),p(U.length>0)}else N()},placeholder:s,disabled:l}),h&&Ki.createPortal(i.jsx("ul",{className:"suggestions-list",ref:x,style:{position:"fixed",top:`${S.top}px`,left:`${S.left}px`,width:`${S.width}px`,maxHeight:`${S.maxHeight}px`,transform:S.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:u.map((U,C)=>i.jsxs("li",{className:`suggestion-item ${C===m?"selected":""}`,onClick:()=>M(U),onMouseEnter:()=>y(C),children:[i.jsxs("div",{className:"suggestion-main",children:[i.jsx("span",{className:"suggestion-name",children:U.name}),U?.source&&U.source!=="manual"&&i.jsx("span",{className:"suggestion-source",children:U.displaySource})]}),i.jsxs("div",{className:"suggestion-details",children:[U.price&&`${Number(U.price).toLocaleString()}`,U.size&&` / ${U.size}${U.unit}`,!U.size&&U.unit&&` / ${U.unit}`]})]},`${U.source}-${C}`))}),document.body)]})},ob=({isOpen:n,onClose:t,onApply:s,ingredientName:l,currentCost:o,currentQuantity:u,unit:d="g",initialPurchaseCost:h,initialContentAmount:p})=>{const[m,y]=b.useState(""),[v,x]=b.useState(""),[S,_]=b.useState(d),[N,j]=b.useState(""),[T,D]=b.useState(!1),[M,$]=b.useState(!1),U=b.useCallback(async()=>{if($(!0),j(""),h&&p){y(h),x(p);const G=await Pn.getConversion(l);if(G)_(G.packetUnit||d),j(G.vendor||"");else{_(d);try{const q=await nr.getPrice(l);j(q?.vendor||"")}catch{}}}else{const G=await Pn.getConversion(l);if(G)x(G.packetSize),_(G.packetUnit||d),G.lastPrice&&y(G.lastPrice),j(G.vendor||"");else try{const q=await nr.getPrice(l);if(q)if(y(o||q.price),j(q.vendor||""),q.unit){const V=q.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(V){let P=V[1]?parseFloat(V[1]):1,k=V[2]?V[2].trim().toLowerCase():"";k==="kg"?(P*=1e3,k="g"):k==="l"?(P*=1e3,k="ml"):k==="pk"||k==="pack"?k="":k==="bag"?k="":(k==="pc"||k==="pcs")&&(k=""),x(P),_(k||d)}else x(1),_(q.unit)}else x(""),_(d);else x(""),y(o||""),_(d),j("")}catch(q){console.warn("Failed to load master price:",q),x(""),y(o||""),_(d),j("")}}$(!1)},[l,h,p,d,o]);b.useEffect(()=>{if(!n||!l)return;const G=setTimeout(()=>{U()},0);return()=>clearTimeout(G)},[n,l,U]);const C=()=>{const G=parseFloat(m),q=parseFloat(v);return!G||!q?0:["g","ml","cc"].includes(S)?G/q*1e3:G/q},z=async()=>{const G=C();if(T&&v)try{await Pn.saveConversion(l,v,S,m,null,N)}catch(q){console.error("Failed to save default conversion:",q)}s(G,S,m,v,N),t()};if(!n)return null;const R=C(),F=u?R*(u/(["g","ml"].includes(d)?1e3:1)):0,K=i.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:i.jsx("div",{className:"unit-conversion-modal__card",onClick:G=>G.stopPropagation(),children:i.jsxs("div",{className:"unit-conversion-modal__body",children:[i.jsx("h3",{className:"unit-conversion-modal__title",children:""}),i.jsxs("div",{className:"unit-conversion-modal__field",children:[i.jsx("span",{className:"unit-conversion-modal__label",children:""}),i.jsx("div",{className:"unit-conversion-modal__value",children:l||"()"})]}),i.jsxs("div",{className:"unit-conversion-modal__inputs",children:[i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),i.jsx("input",{type:"number",value:m,onChange:G=>y(G.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:""}),i.jsxs("div",{className:"unit-conversion-modal__row",children:[i.jsx("input",{type:"number",value:v,onChange:G=>x(G.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),i.jsxs("select",{value:S,onChange:G=>_(G.target.value),className:"unit-conversion-modal__select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:"p"}),i.jsx("option",{value:"cc",children:"cc"}),!["g","ml","","","","","","cc"].includes(S)&&i.jsx("option",{value:S,children:S})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"unit-conversion-modal__label",children:""}),i.jsx("input",{type:"text",value:N,onChange:G=>j(G.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),i.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:M?i.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[i.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),i.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(R).toLocaleString()]})]}),u&&i.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[i.jsxs("span",{children:[" (",u,d,"):"]}),i.jsxs("span",{children:["",Math.round(F).toLocaleString()]})]})]})}),i.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[i.jsx("input",{type:"checkbox",id:"saveDefault",checked:T,onChange:G=>D(G.target.checked)}),i.jsxs("span",{children:["(",v,S,")"]})]}),i.jsxs("div",{className:"unit-conversion-modal__actions",children:[i.jsx(le,{type:"button",variant:"secondary",onClick:t,disabled:M,children:""}),i.jsx(le,{type:"button",variant:"primary",onClick:z,disabled:!m||!v||M,children:""})]})]})})});return Ki.createPortal(K,document.body)},LE=new Set(["food","alcohol","soft_drink","supplies"]),IE=new Set(["alcohol","supplies"]),cb={food:"",alcohol:"",soft_drink:"",supplies:""},yi=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":LE.has(t)?t:"":""},Yu=n=>IE.has(n),Af=(n,t)=>{const s=yi(t);return s?{...n,itemCategory:s,isAlcohol:Yu(s)}:{...n,itemCategory:null}},Gn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},np=n=>{const t=Gn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Bi=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return np(s)/100},BE=(n,t,s)=>{const l=Gn(n),o=Gn(t);if(!Number.isFinite(l)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/o*1e3:(["kg","","l",""].includes(u),l/o)},jx=(n,t,s,l=!1,o=1)=>{const u=Gn(n),d=Gn(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const h=Number.isFinite(o)&&o>0?o:1;if(l)return u/1e3*d/h;const p=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(p)||!p?u/1e3*d/h:u*d/h},$E=(n,t)=>{const s=Gn(n?.purchaseCost),l=Gn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},_x=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Lr=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=_x(t);if(!l)return null;for(const[o,u]of n.entries())if(_x(o)===l)return u;return null},PE=({formData:n,setFormData:t})=>{const[s,l]=b.useState(new Map),[o,u]=b.useState({isOpen:!1,type:null,index:null}),[d,h]=b.useState(new Map);b.useEffect(()=>{(async()=>{const[z,R]=await Promise.all([nr.fetchPriceList(),Pn.getAllConversions()]);l(z),h(R)})()},[]);const m=(C=>C.reduce((z,R)=>z+(parseFloat(R.quantity)||0),0))(n.flours||[]),y=C=>!m||m===0?0:((parseFloat(C)||0)/m*100).toFixed(1);b.useEffect(()=>{if(d.size===0)return;const C=(F=[])=>{let K=!1;return{adjusted:F.map(q=>{if(!q||typeof q!="object")return q;const V=Lr(d,q.name);let P=q;const k=yi(q.itemCategory??q.item_category??V?.itemCategory);if(k){const ge=Yu(k);(yi(q.itemCategory??q.item_category)!==k||!!q.isAlcohol!==ge)&&(P={...P,itemCategory:k,isAlcohol:ge})}const E=Bi(q,V),L=jx(q.quantity,P.purchaseCost,q.unit,!0,E),Y=Number.isFinite(L)?Math.round(L*100)/100:NaN,oe=Gn(P.cost);if(Number.isFinite(Y)&&(!Number.isFinite(oe)||Math.abs(oe-Y)>.01)&&(P={...P,cost:Y}),V&&V.packetSize){const B=[V.lastPrice,q.purchaseCostRef,q.purchase_cost,q.purchaseCost].find(Z=>Number.isFinite(Gn(Z))),W=BE(B,V.packetSize,V.packetUnit);if(Number.isFinite(W)&&$E(q,W)){const Z=Bi(q,V),ye=Math.round(W*100)/100,Me=jx(q.quantity,ye,q.unit,!0,Z),xe=Number.isFinite(Me)?Math.round(Me*100)/100:P.cost,ae=Gn(P.purchaseCost),O=Gn(P.cost),J=!Number.isFinite(ae)||Math.abs(ae-ye)>.01,ce=Number.isFinite(Gn(xe))&&(!Number.isFinite(O)||Math.abs(O-xe)>.01);(J||ce)&&(P={...P,purchaseCost:ye,cost:xe})}}return P!==q&&(K=!0),P}),changed:K}},z=C(n.flours||[]),R=C(n.breadIngredients||[]);!z.changed&&!R.changed||t(F=>({...F,flours:z.adjusted,breadIngredients:R.adjusted}))},[d,n.breadIngredients,n.flours,t]);const v=(C,z,R)=>{const F=[...n.flours||[]];if(F[C]={...F[C],[z]:R},z==="name"){const K=s.get(nn(R));if(K){const G=typeof K=="object"?K.price:K,q=typeof K=="object"?K.vendor:null,V=typeof K=="object"?K.unit:null;F[C].purchaseCostRef=G,F[C].vendorRef=q;const P=Lr(d,R);if(P&&P.packetSize){let E=0;const L=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:G,Y=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?E=L/P.packetSize*1e3:["kg",""].includes(Y)?E=L/P.packetSize:["ml","","cc",""].includes(Y)?E=L/P.packetSize*1e3:(["l",""].includes(Y),E=L/P.packetSize),F[C].purchaseCost=Math.round(E*100)/100,F[C].unit="g"}else F[C].purchaseCost||(F[C].purchaseCost=G,!F[C].unit&&V&&(F[C].unit=V));const k=yi(P?.itemCategory);k?F[C]=Af(F[C],k):F[C].itemCategory=null}else F[C].purchaseCostRef=null,F[C].vendorRef=null,F[C].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(z)||z==="name"){const K=F[C],G=parseFloat(K.quantity),q=parseFloat(K.purchaseCost);if(!isNaN(G)&&!isNaN(q)){let V=0;const P=(K.unit||"").trim().toLowerCase();P==="g"||P===""||P==="ml"||P===""||P==="cc"||P===""||!P?V=G/1e3*q:V=G*q;const k=Lr(d,K.name),E=Bi(K,k),L=Number.isFinite(E)&&E>0?E:1,Y=Math.round(V/L*100)/100;Y!==K.cost&&(F[C].cost=Y)}}t(K=>({...K,flours:F}))},x=(C,z,R)=>{const F=[...n.breadIngredients||[]];if(F[C]={...F[C],[z]:R},z==="name"){const K=s.get(nn(R));if(K){const G=typeof K=="object"?K.price:K,q=typeof K=="object"?K.vendor:null,V=typeof K=="object"?K.unit:null;F[C].purchaseCostRef=G,F[C].vendorRef=q;const P=Lr(d,R);if(P&&P.packetSize){let E=0;const L=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:G,Y=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?(E=L/P.packetSize*1e3,F[C].unit="g"):["kg",""].includes(Y)?(E=L/P.packetSize,F[C].unit="g"):["ml","","cc",""].includes(Y)?(E=L/P.packetSize*1e3,F[C].unit="ml"):["l",""].includes(Y)?(E=L/P.packetSize,F[C].unit="ml"):(E=L/P.packetSize,F[C].unit=P.packetUnit),F[C].purchaseCost=Math.round(E*100)/100}else F[C].purchaseCost||(F[C].purchaseCost=G,!F[C].unit&&V&&(F[C].unit=V));const k=yi(P?.itemCategory);k?F[C]=Af(F[C],k):F[C].itemCategory=null}else F[C].purchaseCostRef=null,F[C].vendorRef=null,F[C].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(z)||z==="name"){const K=F[C],G=parseFloat(K.quantity),q=parseFloat(K.purchaseCost);if(!isNaN(G)&&!isNaN(q)){let V=0;const P=K.unit?K.unit.trim().toLowerCase():"g";P==="g"||P===""||P==="ml"||P===""||P==="cc"||P===""?V=G/1e3*q:V=G*q;const k=Lr(d,K.name),E=Bi(K,k),L=Number.isFinite(E)&&E>0?E:1,Y=Math.round(V/L*100)/100;Y!==K.cost&&(F[C].cost=Y)}}t(K=>({...K,breadIngredients:F}))},S=()=>{t(C=>({...C,flours:[...C.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},_=()=>{t(C=>({...C,breadIngredients:[...C.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},N=C=>{t(z=>({...z,flours:z.flours.filter((R,F)=>F!==C)}))},j=C=>{t(z=>({...z,breadIngredients:z.breadIngredients.filter((R,F)=>F!==C)}))},T=sl(gr(Po,{activationConstraint:{distance:10}}),gr(qo,{activationConstraint:{delay:250,tolerance:5}}),gr(al,{coordinateGetter:Hu})),D=C=>{const{active:z,over:R}=C;z.id!==R.id&&t(F=>{const G=F.flours.some(P=>P.id===z.id)?"flours":"breadIngredients",q=F[G].findIndex(P=>P.id===z.id),V=F[G].findIndex(P=>P.id===R.id);return q!==-1&&V!==-1?{...F,[G]:Xi(F[G],q,V)}:F})};b.useEffect(()=>{if(!n.flours)t(C=>({...C,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const C=n.flours.map(z=>z.id?z:{...z,id:crypto.randomUUID()});JSON.stringify(C)!==JSON.stringify(n.flours)&&t(z=>({...z,flours:C}))}if(!n.breadIngredients)t(C=>({...C,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const C=n.breadIngredients.map(z=>z.id?z:{...z,id:crypto.randomUUID()});JSON.stringify(C)!==JSON.stringify(n.breadIngredients)&&t(z=>({...z,breadIngredients:C}))}},[]);const M=(C,z,R,F)=>{const{type:K,index:G}=o;t(q=>{if(K==="flour"){const V=[...q.flours],P={...V[G],purchaseCost:C,unit:z,purchase_cost:R,content_amount:F},k=parseFloat(P.quantity),E=parseFloat(C);if(!isNaN(k)&&!isNaN(E)){let L=0;z==="g"||z===""?L=k/1e3*E:L=k*E;const Y=Lr(d,P.name),oe=Bi(P,Y),ge=Number.isFinite(oe)&&oe>0?oe:1;P.cost=Math.round(L/ge*100)/100}return V[G]=P,Pn.getAllConversions().then(L=>h(L)),ko.invalidateCache(),{...q,flours:V}}else if(K==="ingredient"){const V=[...q.breadIngredients],P={...V[G],purchaseCost:C,unit:z,purchase_cost:R,content_amount:F},k=parseFloat(P.quantity),E=parseFloat(C);if(!isNaN(k)&&!isNaN(E)){let L=0;z==="g"||z===""?L=k/1e3*E:L=k*E;const Y=Lr(d,P.name),oe=Bi(P,Y),ge=Number.isFinite(oe)&&oe>0?oe:1;P.cost=Math.round(L/ge*100)/100}return V[G]=P,Pn.getAllConversions().then(L=>h(L)),ko.invalidateCache(),{...q,breadIngredients:V}}return q})},$=(C,z,R)=>{R&&t(F=>{const K=C==="flour"?"flours":"breadIngredients",G=[...F[K]||[]],q={...G[z]};if(q.name=R.name,q.itemCategory=null,R.price!==void 0&&R.price!==null&&R.price!==""){q.purchaseCostRef=R.price,q.vendorRef=R.source==="csv"?"CSV":"Master";let E=R.price,L=R.unit;if(R.source==="manual")if(R.size&&R.size>0){const Y=(R.unit||"").trim().toLowerCase();["g",""].includes(Y)?(E=R.price/R.size*1e3,L="g"):["kg",""].includes(Y)?(E=R.price/R.size,L="g"):["ml","","cc",""].includes(Y)?(E=R.price/R.size*1e3,L="ml"):["l",""].includes(Y)?(E=R.price/R.size,L="ml"):(E=R.price/R.size,L=R.unit)}else E=R.price,L=R.unit;else{const Y=Lr(d,R.name);if(Y&&Y.packetSize){const oe=Y.lastPrice!==null&&Y.lastPrice!==void 0&&Y.lastPrice!==""?Y.lastPrice:R.price,ge=(Y.packetUnit||"").trim().toLowerCase();["g",""].includes(ge)?(E=oe/Y.packetSize*1e3,L="g"):["kg",""].includes(ge)?(E=oe/Y.packetSize,L="g"):["ml","","cc",""].includes(ge)?(E=oe/Y.packetSize*1e3,L="ml"):["l",""].includes(ge)?(E=oe/Y.packetSize,L="ml"):(E=oe/Y.packetSize,L=Y.packetUnit)}else E=R.price,L=R.unit}q.purchaseCost=Math.round(E*100)/100,C==="flour"?q.unit="g":L&&(q.unit=L)}const V=yi(R.itemCategory??R.item_category??Lr(d,R.name)?.itemCategory);if(V){const E=Af(q,V);Object.assign(q,E)}const P=parseFloat(q.quantity),k=parseFloat(q.purchaseCost);if(!isNaN(P)&&!isNaN(k)){const E=Lr(d,q.name),L=Bi(q,E),Y=Number.isFinite(L)&&L>0?L:1,oe=(q.unit||"").trim().toLowerCase();let ge=0;oe==="g"||oe===""||oe==="ml"||oe===""||oe==="cc"||oe===""?ge=P/1e3*k:ge=P*k,q.cost=Math.round(ge/Y*100)/100}return G[z]=q,{...F,[K]:G}})},U=o.isOpen&&o.index!==null?o.type==="flour"?n.flours[o.index]:n.breadIngredients[o.index]:null;return i.jsxs("div",{className:"bread-form",children:[i.jsxs(tn,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[i.jsxs("div",{className:"bread-header",children:[i.jsxs("h3",{children:[" (Total: ",m,"g)"]}),i.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Ji,{sensors:T,collisionDetection:$f,onDragEnd:D,id:"flours-dnd",children:i.jsx(el,{items:n.flours||[],strategy:jo,children:(n.flours||[]).map((C,z)=>{const R=Lr(d,C?.name),F=np(R?.yieldPercent??R?.yield_percent??C?.yieldPercent??C?.yield_percent);return i.jsx(qE,{id:C.id,index:z,item:C,yieldPercentApplied:F,onChange:v,onRemove:N,onSelect:$,calculatePercentage:y,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:z})},C.id)})})})})]}),i.jsx(le,{type:"button",variant:"secondary",size:"sm",onClick:S,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsxs(tn,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[i.jsxs("div",{className:"bread-header",children:[i.jsx("h3",{children:""}),i.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),i.jsxs("div",{className:"recipe-scroll-wrapper",children:[i.jsxs("div",{className:"recipe-list-header",children:[i.jsx("span",{})," ",i.jsx("span",{children:""}),i.jsx("span",{children:" (g)"}),i.jsx("span",{className:"text-center",children:"%"}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsx("div",{className:"bread-grid-body",children:i.jsx(Ji,{sensors:T,collisionDetection:$f,onDragEnd:D,id:"breadIngredients-dnd",children:i.jsx(el,{items:n.breadIngredients||[],strategy:jo,children:(n.breadIngredients||[]).map((C,z)=>{const R=Lr(d,C?.name),F=np(R?.yieldPercent??R?.yield_percent??C?.yieldPercent??C?.yield_percent);return i.jsx(FE,{id:C.id,index:z,item:C,yieldPercentApplied:F,onChange:x,onRemove:j,onSelect:$,calculatePercentage:y,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:z})},C.id)})})})})]}),i.jsx(le,{type:"button",variant:"secondary",size:"sm",onClick:_,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),i.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:i.jsx(le,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),i.jsx(ob,{isOpen:o.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:M,ingredientName:U?.name||"",currentCost:U?.purchaseCost,currentQuantity:U?.quantity,unit:U?.unit||"g",initialPurchaseCost:U?.purchase_cost,initialContentAmount:U?.content_amount})]})},qE=({id:n,index:t,item:s,yieldPercentApplied:l,onChange:o,onRemove:u,onSelect:d,calculatePercentage:h,floursLength:p,onOpenConversion:m})=>{const y=yi(s.itemCategory??s.item_category),v=!!y,x=cb[y]||"",S=v?`${x}${Yu(y)?"10%":"8%"}`:"",{attributes:_,listeners:N,setNodeRef:j,transform:T,transition:D,isDragging:M}=ll({id:n}),$={transform:Tr.Transform.toString(T),transition:D,opacity:M?.5:1,position:"relative",zIndex:M?999:"auto"};return i.jsxs("div",{ref:j,style:$,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{..._,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(Cp,{value:s.name,onChange:U=>o(t,"name",U.target.value),onSelect:U=>d("flour",t,U),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(zt,{type:"number",step:"any",value:s.quantity,onChange:U=>o(t,"quantity",U.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[h(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(zt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:U=>o(t,"purchaseCost",U.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:m,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(zt,{type:"number",step:"any",value:s.cost||"",onChange:U=>o(t,"cost",U.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Gn(l))&&Gn(l)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const U=Gn(l),C=Math.round(U*10)/10;return`${Number.isInteger(C)?Math.round(C):C}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:U=>o(t,"isAlcohol",U.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${S}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:p>1&&i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},FE=({id:n,index:t,item:s,yieldPercentApplied:l,onChange:o,onRemove:u,onSelect:d,calculatePercentage:h,onOpenConversion:p})=>{const m=yi(s.itemCategory??s.item_category),y=!!m,v=cb[m]||"",x=y?`${v}${Yu(m)?"10%":"8%"}`:"",{attributes:S,listeners:_,setNodeRef:N,transform:j,transition:T,isDragging:D}=ll({id:n}),M={transform:Tr.Transform.toString(j),transition:T,opacity:D?.5:1,position:"relative",zIndex:D?999:"auto"};return i.jsxs("div",{ref:N,style:M,className:"form-ingredient-row form-ingredient-row--bread",children:[i.jsx("div",{...S,..._,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(Cp,{value:s.name,onChange:$=>o(t,"name",$.target.value),onSelect:$=>d("ingredient",t,$),placeholder:": "})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(zt,{type:"number",step:"any",value:s.quantity,onChange:$=>o(t,"quantity",$.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-unit bread-percent",children:[h(s.quantity),"%"]}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[i.jsx(zt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:$=>o(t,"purchaseCost",$.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",onClick:p,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),i.jsxs("div",{className:"ingredient-cost",children:[i.jsx(zt,{type:"number",step:"any",value:s.cost||"",onChange:$=>o(t,"cost",$.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Gn(l))&&Gn(l)<99.999&&i.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const $=Gn(l),U=Math.round($*10)/10;return`${Number.isInteger(U)?Math.round(U):U}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:$=>o(t,"isAlcohol",$.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},HE=new Set(["food","alcohol","soft_drink","supplies"]),GE=new Set(["alcohol","supplies"]),VE={food:"",alcohol:"",soft_drink:"",supplies:""},Ja=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":HE.has(t)?t:"":""},Ou=n=>GE.has(n),Cx=(n,t)=>{const s=Ja(t);return s?{...n,itemCategory:s,isAlcohol:Ou(s)}:{...n,itemCategory:null}},Nx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Ts=(n,t)=>{if(!n||n.size===0||!t)return null;const s=n.get(t);if(s)return s;const l=Nx(t);if(!l)return null;for(const[o,u]of n.entries())if(Nx(o)===l)return u;return null},ir=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},ub=n=>{const t=ir(n);return!Number.isFinite(t)||t<=0||t>100?100:t},Fa=(n,t)=>{const s=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return ub(s)/100},KE=(n,t,s)=>{const l=ir(n),o=ir(t);if(!Number.isFinite(l)||!Number.isFinite(o)||o<=0)return NaN;const u=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?l/o*1e3:(["kg","","l",""].includes(u),l/o)},Of=(n,t,s,l=1)=>{const o=ir(n),u=ir(t);if(!Number.isFinite(o)||!Number.isFinite(u))return NaN;const d=String(s||"").trim().toLowerCase();let h=0;["g","","ml","","cc",""].includes(d)?h=o/1e3*u:h=o*u;const p=Number.isFinite(l)&&l>0?l:1;return h/p},YE=(n,t)=>{const s=ir(n?.purchaseCost),l=ir(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(l)&&Math.abs(s-l)<1e-4&&Math.abs(s-t)>.01):!1},QE=_e.memo(({id:n,index:t,item:s,groupId:l,yieldPercentApplied:o,onChange:u,onRemove:d,handleSuggestionSelect:h,onOpenConversion:p})=>{const m=Ja(s.itemCategory??s.item_category),y=!!m,v=VE[m]||"",x=y?`${v}${Ou(m)?"10%":"8%"}`:"",S=y?Ou(m):!!s.isAlcohol,{attributes:_,listeners:N,setNodeRef:j,transform:T,transition:D,isDragging:M}=ll({id:n,data:{groupId:l,index:t}}),$={transform:Tr.Translate.toString(T),transition:D,opacity:M?.3:1,position:"relative",zIndex:M?999:"auto"};return i.jsxs("div",{ref:j,style:$,className:"form-ingredient-row",children:[i.jsx("div",{..._,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),i.jsx("div",{className:"ingredient-name",children:i.jsx(Cp,{value:s.name,onChange:U=>u(l,t,"name",U.target.value),onSelect:U=>h(l,t,U),placeholder:""})}),i.jsx("div",{className:"ingredient-qty",children:i.jsx(zt,{value:s.quantity,onChange:U=>u(l,t,"quantity",U.target.value),placeholder:"0",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsx("div",{className:"ingredient-unit",children:i.jsx(zt,{value:s.unit,onChange:U=>u(l,t,"unit",U.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),i.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[i.jsx(zt,{type:"number",value:s.purchaseCost,onChange:U=>u(l,t,"purchaseCost",U.target.value),step:"0.01",placeholder:s.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},title:s.purchaseCostRef?`: ${s.purchaseCostRef}${s.vendorRef?` (${s.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),i.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:p,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&i.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",s.purchaseCostRef]})]}),i.jsxs("div",{className:"ingredient-cost","data-label":"",children:[i.jsx(zt,{type:"number",step:"0.01",value:s.cost,onChange:U=>u(l,t,"cost",U.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(ir(o))&&ir(o)<99.999&&i.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const U=ir(o),C=Math.round(U*10)/10;return`${Number.isInteger(C)?Math.round(C):C}%`})()]})]}),i.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:i.jsx("input",{type:"checkbox",checked:S,onChange:U=>u(l,t,"isAlcohol",U.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(l,t),children:""})})]})},(n,t)=>n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),WE=({section:n,sections:t,onSectionChange:s,onRemoveSection:l,children:o})=>{const{setNodeRef:u}=Ho({id:n.id});return i.jsxs(tn,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(zt,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>l(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[i.jsx("span",{}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},children:""}),i.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),i.jsx("span",{})]}),i.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},JE=({formData:n,setFormData:t,priceList:s})=>{const[l,o]=b.useState(new Map);b.useEffect(()=>{Pn.getAllConversions().then($=>o($))},[]);const[u,d]=b.useState({isOpen:!1,groupId:null,index:null});b.useEffect(()=>{if(!n.ingredientSections){const $=n.ingredientGroups||[{id:"default",name:""}],U=n.ingredients||[],C=$.map(F=>({id:F.id,name:F.name,items:U.filter(K=>F.id==="default"&&!K.groupId?!0:K.groupId===F.id)})),z=new Set(C.flatMap(F=>F.items.map(K=>K.id))),R=U.filter(F=>!z.has(F.id));R.length>0&&(C.length>0?C[0].items.push(...R):C.push({id:"default",name:"",items:R})),C.length===0&&C.push({id:crypto.randomUUID(),name:"",items:[]}),t(F=>({...F,ingredientSections:C}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const h=n.ingredientSections||[];b.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||l.size===0)return;let $=!1;const U=n.ingredientSections.map(C=>{const z=C.items.map(R=>{if(!R||typeof R!="object")return R;const F=Ts(l,R.name);let K=R;const G=Ja(R.itemCategory??R.item_category??F?.itemCategory);if(G){const V=Ou(G);(Ja(R.itemCategory??R.item_category)!==G||!!R.isAlcohol!==V)&&(K={...K,itemCategory:G,isAlcohol:V})}if(F&&F.packetSize){const P=[F.lastPrice,R.purchaseCostRef,R.purchase_cost,R.purchaseCost].find(E=>Number.isFinite(ir(E))),k=KE(P,F.packetSize,F.packetUnit);if(Number.isFinite(k)&&YE(R,k)){const E=Fa(R,F),L=Math.round(k*100)/100,Y=Of(R.quantity,L,R.unit,E),oe=Number.isFinite(Y)?Math.round(Y*100)/100:K.cost,ge=ir(K.purchaseCost),B=ir(K.cost),W=!Number.isFinite(ge)||Math.abs(ge-L)>.01,Z=Number.isFinite(ir(oe))&&(!Number.isFinite(B)||Math.abs(B-oe)>.01);(W||Z)&&(K={...K,purchaseCost:L,cost:oe})}}const q=Fa(R,F);if(Number.isFinite(q)&&q>0&&Math.abs(q-1)>1e-4){const V=Of(R.quantity,K.purchaseCost,R.unit,q),P=Of(R.quantity,K.purchaseCost,R.unit,1),k=ir(K.cost);if(Number.isFinite(V)&&(!Number.isFinite(k)||Number.isFinite(P)&&Math.abs(k-P)<=.01)){const L=Math.round(V*100)/100,Y=ir(K.cost);(!Number.isFinite(Y)||Math.abs(Y-L)>.01)&&(K={...K,cost:L})}}return K!==R&&($=!0),K});return z!==C.items?{...C,items:z}:C});$&&t(C=>({...C,ingredientSections:U}))},[l,n.ingredientSections,t]);const p=sl(gr(Po,{activationConstraint:{distance:10}}),gr(qo,{activationConstraint:{delay:250,tolerance:5}}),gr(al,{coordinateGetter:Hu})),m=({active:$,over:U})=>{if(!U)return;const C=$.id,z=U.id,R=h.find(K=>K.items.some(G=>G.id===C)),F=h.find(K=>K.items.some(G=>G.id===z))||h.find(K=>K.id===z);!R||!F||R===F||t(K=>{const G=R.items,q=F.items,V=G.findIndex(E=>E.id===C),P=q.findIndex(E=>E.id===z);let k;if(z===F.id)k=q.length+1;else{const L=U&&$.rect.current.translated&&$.rect.current.translated.top>U.rect.top+U.rect.height?1:0;k=P>=0?P+L:q.length+1}return{...K,ingredientSections:K.ingredientSections.map(E=>E.id===R.id?{...E,items:G.filter(L=>L.id!==C)}:E.id===F.id?{...E,items:[...q.slice(0,k),G[V],...q.slice(k,q.length)]}:E)}})},y=({active:$,over:U})=>{if(!U)return;const C=$.id,z=U.id,R=h.find(K=>K.items.some(G=>G.id===C)),F=h.find(K=>K.items.some(G=>G.id===z))||h.find(K=>K.id===z);if(R&&F&&R===F){const K=R.items.findIndex(q=>q.id===C),G=F.items.findIndex(q=>q.id===z);K!==G&&t(q=>({...q,ingredientSections:q.ingredientSections.map(V=>V.id===R.id?{...V,items:Xi(V.items,K,G)}:V)}))}},v=($,U,C,z)=>{const{groupId:R,index:F}=u;R!==null&&F!==null&&t(K=>{const G=K.ingredientSections.map(q=>{if(q.id!==R)return q;const V=[...q.items],P={...V[F],purchaseCost:$,unit:U,purchase_cost:C,content_amount:z},k=parseFloat(P.quantity),E=parseFloat($);if(!isNaN(k)&&!isNaN(E)){const L=Ts(l,P.name),Y=Fa(P,L),oe=U?U.trim().toLowerCase():"";let ge=0;oe==="g"||oe===""||oe==="ml"||oe===""||oe==="cc"||oe===""?ge=k/1e3*E:ge=k*E;const B=Number.isFinite(Y)&&Y>0?Y:1;P.cost=Math.round(ge/B*100)/100}return V[F]=P,{...q,items:V}});return Pn.getAllConversions().then(q=>o(q)),ko.invalidateCache(),{...K,ingredientSections:G}})},x=u.isOpen&&u.groupId!==null&&u.index!==null?h.find($=>$.id===u.groupId)?.items[u.index]:null,S=_e.useCallback(($,U,C,z)=>{t(R=>{const F=R.ingredientSections.map(K=>{if(K.id!==$)return K;const G=[...K.items],q={...G[U],[C]:z};if(G[U]=q,["quantity","purchaseCost","unit","name","isAlcohol"].includes(C)){const V=parseFloat(q.quantity),P=parseFloat(q.purchaseCost),k=Ts(l,q.name),E=Fa(q,k),L=Number.isFinite(E)&&E>0?E:1;if(!isNaN(V)&&!isNaN(P)){let Y=0;const oe=q.unit?q.unit.trim().toLowerCase():"";oe==="g"||oe===""||oe==="ml"||oe===""||oe==="cc"||oe===""?Y=V/1e3*P:Y=V*P;const ge=Math.round(Y/L*100)/100;ge!==q.cost&&(q.cost=ge,G[U]=q)}}if(C==="name"){const V=s.get(nn(z)),P=Ts(l,z),k=Ja(P?.itemCategory);if(k){const E=Cx(q,k);Object.assign(q,E)}else V||(q.itemCategory=null);if(V){const E=typeof V=="object"?V.price:V,L=typeof V=="object"?V.vendor:null,Y=typeof V=="object"?V.unit:null,oe=typeof V=="object"?V.size:null;if(q.purchaseCostRef=E,q.vendorRef=L,P&&P.packetSize){const W=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:E;let Z=0;const ye=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(ye)?(Z=W/P.packetSize*1e3,q.unit="g"):["kg",""].includes(ye)?(Z=W/P.packetSize,q.unit="g"):["ml","","cc",""].includes(ye)?(Z=W/P.packetSize*1e3,q.unit="ml"):["l",""].includes(ye)?(Z=W/P.packetSize,q.unit="ml"):(Z=W/P.packetSize,q.unit=P.packetUnit),q.purchaseCost=Math.round(Z*100)/100}else{let W=E,Z=Y;oe&&oe>1&&(["g",""].includes((Y||"").toLowerCase())?(W=E/oe*1e3,Z="g"):["ml","","cc",""].includes((Y||"").toLowerCase())?(W=E/oe*1e3,Z="ml"):["kg",""].includes(Y?Y.toLowerCase():"")?(W=E/oe,Z="g"):["l",""].includes(Y?Y.toLowerCase():"")?(W=E/oe,Z="ml"):W=E/oe),q.purchaseCost||(q.purchaseCost=Math.round(W*100)/100),!q.unit&&Z&&(q.unit=Z)}const ge=parseFloat(q.quantity),B=parseFloat(q.purchaseCost);if(!isNaN(ge)&&!isNaN(B)){const W=Ts(l,q.name),Z=Fa(q,W),ye=Number.isFinite(Z)&&Z>0?Z:1,Me=q.unit?q.unit.trim().toLowerCase():"";let xe=0;Me==="g"||Me===""||Me==="ml"||Me===""||Me==="cc"||Me===""?xe=ge/1e3*B:xe=ge*B,q.cost=Math.round(xe/ye*100)/100}}else q.purchaseCostRef=null,q.vendorRef=null;G[U]=q}return{...K,items:G}});return{...R,ingredientSections:F}})},[l,s,t]),_=_e.useCallback(($,U,C)=>{t(z=>{const R=z.ingredientSections.map(F=>{if(F.id!==$)return F;const K=[...F.items],G={...K[U]};if(G.name=C.name,G.itemCategory=null,C.price)if(G.purchaseCostRef=C.price,G.vendorRef=C.source==="csv"?"CSV":"Master",C.source==="manual")if(C.size&&C.size>0){const k=(C.unit||"").trim().toLowerCase();if(["g",""].includes(k)){const E=C.price/C.size*1e3;G.purchaseCost=Math.round(E*100)/100,G.unit="g"}else if(["kg",""].includes(k)){const E=C.price/C.size;G.purchaseCost=Math.round(E*100)/100,G.unit="g"}else if(["ml","","cc",""].includes(k)){const E=C.price/C.size*1e3;G.purchaseCost=Math.round(E*100)/100,G.unit="ml"}else if(["l",""].includes(k)){const E=C.price/C.size;G.purchaseCost=Math.round(E*100)/100,G.unit="ml"}else{const E=C.price/C.size;G.purchaseCost=Math.round(E*100)/100,G.unit=C.unit}}else G.purchaseCost=C.price,G.unit=C.unit;else{const k=Ts(l,C.name);if(k&&k.packetSize){const E=k.lastPrice!==null&&k.lastPrice!==void 0&&k.lastPrice!==""?k.lastPrice:C.price;let L=0;const Y=(k.packetUnit||"").trim().toLowerCase();["g",""].includes(Y)?(L=E/k.packetSize*1e3,G.unit="g"):["kg",""].includes(Y)?(L=E/k.packetSize,G.unit="g"):["ml","","cc",""].includes(Y)?(L=E/k.packetSize*1e3,G.unit="ml"):["l",""].includes(Y)?(L=E/k.packetSize,G.unit="ml"):(L=E/k.packetSize,G.unit=k.packetUnit),G.purchaseCost=Math.round(L*100)/100}else G.purchaseCost=C.price,G.unit=C.unit}const q=Ja(C.itemCategory??C.item_category??Ts(l,C.name)?.itemCategory);if(q){const k=Cx(G,q);Object.assign(G,k)}const V=parseFloat(G.quantity),P=parseFloat(G.purchaseCost);if(!isNaN(V)&&!isNaN(P)){const k=Ts(l,G.name),E=Fa(G,k),L=Number.isFinite(E)&&E>0?E:1,Y=G.unit?G.unit.trim().toLowerCase():"";let oe=0;Y==="g"||Y===""||Y==="ml"||Y===""||Y==="cc"||Y===""?oe=V/1e3*P:oe=V*P,G.cost=Math.round(oe/L*100)/100}return K[U]=G,{...F,items:K}});return{...z,ingredientSections:R}})},[l,t]),N=_e.useCallback(($,U)=>{t(C=>({...C,ingredientSections:C.ingredientSections.map(z=>z.id===$?{...z,items:z.items.filter((R,F)=>F!==U)}:z)}))},[t]),j=$=>{const U={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(C=>({...C,ingredientSections:C.ingredientSections.map(z=>z.id===$?{...z,items:[...z.items,U]}:z)}))},T=()=>{t($=>({...$,ingredientSections:[...$.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},D=$=>{t(U=>({...U,ingredientSections:U.ingredientSections.filter(C=>C.id!==$)}))},M=($,U)=>{t(C=>({...C,ingredientSections:C.ingredientSections.map(z=>z.id===$?{...z,name:U}:z)}))};return i.jsxs(Ji,{sensors:p,collisionDetection:c0,onDragOver:m,onDragEnd:y,children:[i.jsxs("div",{className:"recipe-form-ingredients",children:[h.map($=>i.jsx(el,{id:$.id,items:$.items.map(U=>U.id),strategy:jo,children:i.jsxs(WE,{section:$,sections:h,onSectionChange:M,onRemoveSection:D,children:[$.items.map((U,C)=>(()=>{const z=Ts(l,U?.name),R=ub(z?.yieldPercent??z?.yield_percent??U?.yieldPercent??U?.yield_percent);return i.jsx(QE,{id:U.id,index:C,item:U,groupId:$.id,yieldPercentApplied:R,onChange:S,onRemove:N,handleSuggestionSelect:_,onOpenConversion:()=>d({isOpen:!0,groupId:$.id,index:C})},U.id)})()),i.jsx(le,{type:"button",variant:"ghost",onClick:()=>j($.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},$.id)),i.jsx(le,{type:"button",variant:"secondary",onClick:T,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(N0,{dropAnimation:{sideEffects:vp({styles:{active:{opacity:"0.5"}}})},children:null}),i.jsx(ob,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,groupId:null,index:null}),onApply:v,ingredientName:x?.name||"",currentCost:x?.purchaseCost,currentQuantity:x?.quantity,unit:x?.unit||"g",initialPurchaseCost:x?.purchase_cost,initialContentAmount:x?.content_amount})]})},XE=({id:n,index:t,item:s,groupId:l,onChange:o,onRemove:u})=>{const{attributes:d,listeners:h,setNodeRef:p,transform:m,transition:y,isDragging:v}=ll({id:n,data:{groupId:l,index:t}}),x={transform:Tr.Translate.toString(m),transition:y,opacity:v?.3:1,position:"relative",zIndex:v?999:"auto"};return i.jsxs("div",{ref:p,style:{...x,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[i.jsx("div",{...d,...h,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),i.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),i.jsx("div",{style:{flex:1},children:i.jsx(zt,{textarea:!0,value:s.text,onChange:S=>o(l,t,S.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}})}),i.jsx("div",{className:"remove-button-cell",children:i.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(l,t),title:"",children:""})})]})},ZE=({section:n,sections:t,onSectionChange:s,onRemoveSection:l,children:o})=>{const{setNodeRef:u}=Ho({id:n.id});return i.jsxs(tn,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[i.jsx(zt,{value:n.name,onChange:d=>s(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),i.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&i.jsx("button",{type:"button",onClick:()=>l(n.id),className:"group-delete-btn",children:""})})]}),i.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&i.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},eT=({formData:n,setFormData:t})=>{b.useEffect(()=>{if(!n.stepSections){const x=n.stepGroups||[{id:"default",name:""}],_=(n.steps||[]||[]).map(D=>typeof D=="string"?{id:crypto.randomUUID(),text:D}:D),N=x.map(D=>({id:D.id,name:D.name,items:_.filter(M=>D.id==="default"&&!M.groupId?!0:M.groupId===D.id)})),j=new Set(N.flatMap(D=>D.items.map(M=>M.id))),T=_.filter(D=>!j.has(D.id));T.length>0&&(N.length>0?N[0].items.push(...T):N.push({id:"default",name:"",items:T})),N.length===0&&N.push({id:crypto.randomUUID(),name:"",items:[]}),t(D=>({...D,stepSections:N}))}},[n.steps,n.stepGroups,n.stepSections,t]);const s=n.stepSections||[],l=sl(gr(Po,{activationConstraint:{distance:10}}),gr(qo,{activationConstraint:{delay:250,tolerance:5}}),gr(al,{coordinateGetter:Hu})),o=({active:x,over:S})=>{if(!S)return;const _=x.id,N=S.id,j=s.find(D=>D.items.some(M=>M.id===_)),T=s.find(D=>D.items.some(M=>M.id===N))||s.find(D=>D.id===N);!j||!T||j===T||t(D=>{const M=j.items,$=T.items,U=M.findIndex(R=>R.id===_),C=$.findIndex(R=>R.id===N);let z;if(N===T.id)z=$.length+1;else{const F=S&&x.rect.current.translated&&x.rect.current.translated.top>S.rect.top+S.rect.height?1:0;z=C>=0?C+F:$.length+1}return{...D,stepSections:D.stepSections.map(R=>R.id===j.id?{...R,items:M.filter(F=>F.id!==_)}:R.id===T.id?{...R,items:[...$.slice(0,z),M[U],...$.slice(z,$.length)]}:R)}})},u=({active:x,over:S})=>{if(!S)return;const _=x.id,N=S.id,j=s.find(D=>D.items.some(M=>M.id===_)),T=s.find(D=>D.items.some(M=>M.id===N))||s.find(D=>D.id===N);if(j&&T&&j===T){const D=j.items.findIndex($=>$.id===_),M=T.items.findIndex($=>$.id===N);D!==M&&t($=>({...$,stepSections:$.stepSections.map(U=>U.id===j.id?{...U,items:Xi(U.items,D,M)}:U)}))}},d=(x,S,_)=>{t(N=>({...N,stepSections:N.stepSections.map(j=>{if(j.id!==x)return j;const T=[...j.items];return T[S]={...T[S],text:_},{...j,items:T}})}))},h=(x,S)=>{t(_=>({..._,stepSections:_.stepSections.map(N=>N.id===x?{...N,items:N.items.filter((j,T)=>T!==S)}:N)}))},p=x=>{const S={id:crypto.randomUUID(),text:""};t(_=>({..._,stepSections:_.stepSections.map(N=>N.id===x?{...N,items:[...N.items,S]}:N)}))},m=()=>{t(x=>({...x,stepSections:[...x.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},y=x=>{t(S=>({...S,stepSections:S.stepSections.filter(_=>_.id!==x)}))},v=(x,S)=>{t(_=>({..._,stepSections:_.stepSections.map(N=>N.id===x?{...N,name:S}:N)}))};return i.jsxs(Ji,{sensors:l,collisionDetection:c0,onDragOver:o,onDragEnd:u,children:[i.jsxs("div",{className:"recipe-form-steps",children:[s.map(x=>i.jsx(el,{id:x.id,items:x.items.map(S=>S.id),strategy:jo,children:i.jsxs(ZE,{section:x,sections:s,onSectionChange:v,onRemoveSection:y,children:[x.items.map((S,_)=>i.jsx(XE,{id:S.id,index:_,item:S,groupId:x.id,onChange:d,onRemove:h},S.id)),i.jsx(le,{type:"button",variant:"ghost",onClick:()=>p(x.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},x.id)),i.jsx(le,{type:"button",variant:"secondary",onClick:m,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),i.jsx(N0,{dropAnimation:{sideEffects:vp({styles:{active:{opacity:"0.5"}}})},children:null})]})},db=({onClose:n,onImport:t,initialMode:s="url"})=>{const l=Zi(),[o,u]=b.useState(s),[d,h]=b.useState(null),[p,m]=b.useState(""),[y,v]=b.useState(""),[x,S]=b.useState(null),[_,N]=b.useState(null),[j,T]=b.useState(!1),[D,M]=b.useState(!1),[$,U]=b.useState(null),[C,z]=b.useState(!1),R=b.useRef(null),F=b.useRef(null),K=b.useRef(null),G=b.useRef(null),q=()=>{G.current&&(clearTimeout(G.current),G.current=null)},V=(O="")=>{if(q(),K.current){try{K.current.abort()}catch{}K.current=null}M(!1),O&&U(O)};b.useEffect(()=>()=>{if(q(),K.current){try{K.current.abort()}catch{}K.current=null}},[]),b.useEffect(()=>{if(!x){N(null);return}const O=URL.createObjectURL(x);return N(O),()=>URL.revokeObjectURL(O)},[x]);const P=O=>new Promise(J=>{if(!O||typeof O!="object")return J(O);const ce=String(O.type||"").toLowerCase();if(!ce.startsWith("image/"))return J(O);const Se=2e6,ke=2e3,Be=.9,Le=String(O.name||"").toLowerCase(),Ge=ce.includes("heic")||ce.includes("heif")||Le.endsWith(".heic")||Le.endsWith(".heif"),pe=URL.createObjectURL(O);let Ye=!1;const rt=mt=>{if(!Ye){Ye=!0;try{URL.revokeObjectURL(pe)}catch{}J(mt)}},ft=setTimeout(()=>rt(O),15e3),St=new Image;St.onload=()=>{const mt=St.naturalWidth||St.width||0,Dt=St.naturalHeight||St.height||0;if(!mt||!Dt)return clearTimeout(ft),rt(O);const Vt=Math.min(1,ke/Math.max(mt,Dt)),wt=Math.max(1,Math.round(mt*Vt)),ie=Math.max(1,Math.round(Dt*Vt)),je=Vt<1,Ce=Ge||O.size>Se;if(!je&&!Ce)return clearTimeout(ft),rt(O);const Ue=document.createElement("canvas");Ue.width=wt,Ue.height=ie;const st=Ue.getContext("2d");if(!st)return clearTimeout(ft),rt(O);st.drawImage(St,0,0,wt,ie),Ue.toBlob(ct=>{if(clearTimeout(ft),!ct)return rt(O);const Rt=String(O.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);rt(new File([ct],`${Rt}.jpg`,{type:"image/jpeg"}))},"image/jpeg",Be)},St.onerror=()=>{clearTimeout(ft),rt(O)},St.src=pe}),k=async O=>{if(O){if(!String(O.type||"").startsWith("image/")){U("");return}U(null),T(!0);try{const J=await P(O);S(J||O)}finally{T(!1)}}},E=()=>R.current?.click?.(),L=()=>F.current?.click?.(),Y=O=>{O.preventDefault(),O.stopPropagation(),O.type==="dragenter"||O.type==="dragover"?z(!0):O.type==="dragleave"&&z(!1)},oe=O=>{if(O.preventDefault(),O.stopPropagation(),z(!1),O.dataTransfer.files&&O.dataTransfer.files[0]){const J=O.dataTransfer.files[0];J.type.startsWith("image/")&&k(J)}},ge=O=>/[---]/.test(O||""),B=async O=>{try{const J=[];J.push(O.name||""),J.push(O.description||"");const ce=[];Array.isArray(O.ingredients)&&O.ingredients.forEach((Ye,rt)=>{Ye.name&&(J.push(Ye.name),ce.push(rt))});const Se=[];if(Array.isArray(O.steps)&&O.steps.forEach((Ye,rt)=>{J.push(Ye),Se.push(rt)}),J.length===0)return O;const{data:ke,error:Be}=await Re.functions.invoke("translate",{body:{text:J,target_lang:"JA"}});if(Be)throw Be;const Le=ke.translations.map(Ye=>Ye.text);let Ge=0;const pe={...O};return pe.name=Le[Ge++]||pe.name,pe.description=Le[Ge++]||pe.description,ce.length>0&&(pe.ingredients=pe.ingredients.map((Ye,rt)=>{const ft=ce.indexOf(rt);return ft!==-1?{...Ye,name:Le[Ge+ft]}:Ye}),Ge+=ce.length),Se.length>0&&(pe.steps=pe.steps.map((Ye,rt)=>{const ft=Se.indexOf(rt);return ft!==-1?Le[Ge+ft]:Ye})),pe}catch(J){return console.error("Translation failed:",J),l.warning(""),O}},[W,Z]=b.useState([]),ye=async(O,J)=>{const ce="REDACTED_GOOGLE_API_KEY";if(O.size>4e6)return null;const ke=await O.arrayBuffer(),Be=btoa(new Uint8Array(ke).reduce((St,mt)=>St+String.fromCharCode(mt),"")),Le=O.type||"image/jpeg",pe=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${ce}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`


: 
- 
- 

JSONJSON
\`\`\`json
{
  "title": "",
  "description": "",
  "ingredients": [
    { "name": "", "quantity": "", "unit": "", "group": null }
  ],
  "steps": ["1...", "2..."]
}
\`\`\`


- 115ml, 15ml, 1200ml 
- 
- `},{inline_data:{mime_type:Le,data:Be}}]}]}),signal:J});if(!pe.ok){const St=await pe.text();throw console.error("Gemini API Error:",pe.status,St),new Error(`Gemini API Error: ${pe.status}`)}const rt=(await pe.json()).candidates?.[0]?.content?.parts?.[0]?.text;if(!rt)throw new Error("Gemini");let ft=rt;return ft.includes("```json")?ft=ft.split("```json")[1].split("```")[0]:ft.includes("```")&&(ft=ft.split("```")[1].split("```")[0]),{recipe:JSON.parse(ft.trim()),rawText:rt}},Me=async()=>{M(!0),U(null),Z([]);try{let O,J="";if(o==="url"){if(!y)return;J=y;const{data:ke,error:Be}=await Re.functions.invoke("scrape-recipe",{body:{url:y}});if(Be)throw Be;O=ke}else{if(!x)return;q();const ke=new AbortController;K.current=ke;const Be=12e4;G.current=setTimeout(()=>{V("")},Be);const Le="REDACTED_GOOGLE_API_KEY";let Ge=!1;if(Le){Z(pe=>[...pe," Gemini API..."]);try{const pe=await ye(x,ke.signal);pe&&pe.recipe&&pe.recipe.title&&(Z(Ye=>[...Ye," "]),O={recipe:pe.recipe,rawText:pe.rawText},Ge=!0)}catch(pe){if(pe.name==="AbortError")throw pe;console.warn("Direct Gemini failed, falling back to Edge Function:",pe.message),Z(Ye=>[...Ye,` API: ${pe.message}`])}}if(!Ge){Z(Dt=>[...Dt," ..."]);const pe=new FormData;pe.append("image",x);const{data:{session:Ye}}=await Re.auth.getSession(),ft="http://127.0.0.1:54321/functions/v1/analyze-image",St={Authorization:`Bearer ${Ye?.access_token||"sb_publishable_ACJWlzQHlZjBrEguHvfOxg_3BJgxAaH"}`};let mt;try{mt=await fetch(ft,{method:"POST",headers:St,body:pe,signal:ke.signal})}catch(Dt){throw console.error("Network Error:",Dt),new Error("")}if(!mt.ok){const Dt=mt.status;throw new Error(`Server Error: ${mt.statusText} (${Dt})`)}if(!mt.body)O=await mt.json();else{const Dt=mt.body.getReader(),Vt=new TextDecoder;let wt=null,ie="",je=!1;for(;;){const{done:Ce,value:Ue}=await Dt.read();if(Ce)break;ie+=Vt.decode(Ue,{stream:!0});const st=ie.split(`

`);ie=st.pop()||"";for(const ct of st){const Rt=ct.trim();if(Rt.startsWith("data: "))try{const Jt=JSON.parse(Rt.slice(6));if(Jt.type==="log")Z(wn=>[...wn,Jt.message]);else if(Jt.type==="result")wt=Jt,je=!0;else if(Jt.type==="error")throw new Error(Jt.message)}catch(Jt){if(Jt.message&&!Jt.message.includes("Failed to parse"))throw Jt;console.warn("Failed to parse SSE event",Jt)}}if(je)break}try{await Dt.cancel()}catch{}if(!wt)throw new Error("");O=wt}}}if(O.error)throw new Error(O.error);if(!O.recipe)throw new Error("No recipe found");let ce=O.recipe;if(ce.name=ce.name||ce.title||"",ce.recipeYield=ce.recipeYield||ce.servings||"",ce.description=ce.description||"",!ce.ingredients&&ce.recipeIngredient&&(ce.ingredients=ce.recipeIngredient),Array.isArray(ce.ingredients)){const ke=["","","method","instructions","steps","preparation"],Be=[],Le=[];ce.ingredients.forEach(Ge=>{const pe=(Ge.group||"").trim().toLowerCase();if(pe&&ke.some(Ye=>pe===Ye||pe.includes(Ye))){const Ye=Ge.name||Ge.text||"";Ye&&Le.push(Ye)}else Be.push(Ge)}),Le.length>0&&(console.log("Extracted steps from ingredients:",Le),ce.ingredients=Be,ce.steps=Array.isArray(ce.steps)?ce.steps:[],ce.steps=[...ce.steps,...Le])}const Se=(ce.name||"")+(ce.steps?ce.steps.slice(0,3).join(""):"");if(Se&&!ge(Se)){h(ce),m(J),u("confirm-translation"),M(!1);return}t(ce,J),n()}catch(O){if(console.error("Import failed details:",O),O?.name==="AbortError")return;const J=O.message||"Import failed. Please try again.";U(J)}finally{q(),K.current=null,o!=="confirm-translation"&&M(!1)}},xe=async O=>{M(!0);try{let J=d;O&&(J=await B(d)),t(J,p),n()}catch(J){console.error("Translation flow error:",J),U("Translation failed. Importing original."),t(d,p),n()}finally{M(!1)}},ae=O=>{const J=O.target.files[0];J&&k(J),O.target.value=""};return i.jsxs("div",{className:"modal-overlay fade-in",children:[D&&i.jsxs("div",{className:"loading-overlay",children:[i.jsx("div",{className:"spinner"}),i.jsx("p",{children:"..."}),W.length>0&&i.jsx("div",{className:"progress-log-container",children:i.jsxs("div",{className:"progress-log",children:[W.map((O,J)=>i.jsx("div",{className:"log-entry",children:i.jsx("span",{className:"log-message",children:O})},J)),i.jsx("div",{ref:O=>O?.scrollIntoView({behavior:"smooth"})})]})}),i.jsx("div",{style:{marginTop:"0.9rem",display:"flex",justifyContent:"center"},children:i.jsx(le,{type:"button",variant:"secondary",onClick:()=>V(),children:""})})]}),i.jsxs(tn,{className:"import-modal-card",children:[i.jsx("h3",{className:"modal-title",children:o==="confirm-translation"?"":""}),o==="confirm-translation"?i.jsxs("div",{className:"translation-confirm-content",children:[i.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),i.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),i.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),i.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[i.jsx(le,{type:"button",variant:"primary",onClick:()=>xe(!0),isLoading:D,style:{width:"100%"},children:""}),i.jsx(le,{type:"button",variant:"secondary",onClick:()=>xe(!1),disabled:D,style:{width:"100%"},children:""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"import-mode-tabs",children:[i.jsx("button",{type:"button",onClick:()=>u("url"),className:`tab-btn tab-import-web ${o==="url"?"active":""}`,children:" Web URL"}),i.jsx("button",{type:"button",onClick:()=>u("image"),className:`tab-btn tab-import-image ${o==="image"?"active":""}`,children:"  (Best Effort)"})]}),o==="url"?i.jsxs(i.Fragment,{children:[i.jsx("p",{children:"URL"}),i.jsx("input",{type:"url",placeholder:"https://...",value:y,onChange:O=>v(O.target.value),className:"import-url-input",autoFocus:!0})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{children:""}),i.jsxs("div",{className:"image-upload-wrapper",children:[i.jsx("input",{ref:R,type:"file",accept:"image/*",capture:"environment",onChange:ae,className:"image-upload-input"}),i.jsx("input",{ref:F,type:"file",accept:"image/*",onChange:ae,className:"image-upload-input"}),i.jsx("div",{onDragEnter:Y,onDragLeave:Y,onDragOver:Y,onDrop:oe,className:`image-upload-label ${C?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{D||j||L()},onKeyDown:O=>{D||j||(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),L())},children:_?i.jsx("img",{src:_,alt:"Preview",className:"image-upload-preview"}):C?"":""}),i.jsxs("div",{className:"image-upload-actions",children:[i.jsx(le,{type:"button",variant:"secondary",onClick:E,disabled:D||j,children:""}),i.jsx(le,{type:"button",variant:"secondary",onClick:L,disabled:D||j,children:""})]})]}),j&&i.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),$&&i.jsx("p",{className:"error-text",children:$}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(le,{type:"button",variant:"ghost",onClick:n,disabled:D,children:""}),i.jsx(le,{type:"button",variant:"primary",onClick:Me,isLoading:D,disabled:j||(o==="url"?!y:!x),children:""})]})]})]})]})},Ex=({onSave:n,onCancel:t,initialData:s})=>{const l=s||{},[o,u]=b.useState("ingredients"),[d,h]=b.useState(null),[p,m]=b.useState(new Map);_e.useEffect(()=>{(async()=>{const P=await nr.fetchPriceList();m(P)})()},[]);const y=b.useMemo(()=>{const V=l.steps||[""];let P=l.stepGroups||[];const k=V.some(L=>typeof L=="object"&&L.group);if(P.length===0&&k){const L=new Map;V.forEach(Y=>{typeof Y=="object"&&Y.group&&!L.has(Y.group)&&L.set(Y.group,crypto.randomUUID())}),P=Array.from(L.entries()).map(([Y,oe])=>({id:oe,name:Y}))}return{steps:V.map(L=>{const Y=typeof L=="string"?L:L.text||"",oe=typeof L=="object"&&L.id?L.id:crypto.randomUUID();let ge=typeof L=="object"?L.groupId:void 0;const B=typeof L=="object"?L.group:void 0;if(!ge&&B&&P.length>0){const W=P.find(Z=>Z.name===B);W&&(ge=W.id)}return{id:oe,text:Y,groupId:ge}}),stepGroups:P}},[l]),v=y.steps,x=y.stepGroups,S=b.useMemo(()=>{const V=l.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let P=l.ingredientGroups||[];if(P.length===0&&V.some(E=>E.group)){const E=new Map;V.forEach(L=>{L.group&&!E.has(L.group)&&E.set(L.group,crypto.randomUUID())}),P=Array.from(E.entries()).map(([L,Y])=>({id:Y,name:L})),E.size>0&&V.some(L=>!L.group)}return{ingredients:V.map(E=>{const L=typeof E=="string"?{name:E,quantity:"",unit:"",cost:"",purchaseCost:""}:{...E,cost:E.cost||"",purchaseCost:E.purchaseCost||""};let Y=L.groupId;if(!Y&&L.group&&P.length>0){const oe=P.find(ge=>ge.name===L.group);oe&&(Y=oe.id)}return{...L,id:L.id||crypto.randomUUID(),groupId:Y}}),ingredientGroups:P}},[l]),_=S.ingredients,N=S.ingredientGroups,[j,T]=b.useState({title:l.title||"",description:l.description||"",image:l.image||"",imageFile:null,storeName:l.storeName||"",servings:l.servings||"",ingredients:_,ingredientGroups:N,steps:v,stepGroups:x,tags:l.tags||[""],course:l.course||"",category:l.category||"",type:l.type||"normal",flours:l.flours||[],breadIngredients:l.breadIngredients||[],sourceUrl:l.sourceUrl||""}),[D,M]=b.useState(!1),$=(V,P="")=>{const k=new Map,E=V.ingredients||[];E.forEach(Z=>{let ye=Z.group||"";ye==="Main"&&(ye=""),k.has(ye)||k.set(ye,crypto.randomUUID())});const L=Array.from(k.entries()).map(([Z,ye])=>({id:ye,name:Z})),Y=E.map(Z=>{let ye=Z.group||"";ye==="Main"&&(ye="");let Me;return k.has(ye)&&(Me=k.get(ye)),{id:crypto.randomUUID(),name:Z.name||"",quantity:Z.quantity||"",unit:Z.unit||"",cost:"",purchaseCost:"",groupId:Me}}),oe=new Map,ge=V.steps||[];ge.forEach(Z=>{typeof Z=="object"&&Z.group&&Z.group!=="Main"&&(oe.has(Z.group)||oe.set(Z.group,crypto.randomUUID()))});const B=Array.from(oe.entries()).map(([Z,ye])=>({id:ye,name:Z})),W=ge.map(Z=>{const ye=typeof Z=="object",Me=ye?Z.text||"":Z,xe=ye?Z.group:null;let ae;return xe&&oe.has(xe)&&(ae=oe.get(xe)),{id:crypto.randomUUID(),text:Me,groupId:ae}});T(Z=>({...Z,title:V.name||Z.title,description:V.description||Z.description,category:P?"URL":V.category||Z.category,image:V.image||Z.image,servings:V.recipeYield||Z.servings,ingredients:Y,ingredientGroups:L,steps:W,stepGroups:B,ingredientSections:void 0,stepSections:void 0,sourceUrl:P||Z.sourceUrl})),h(null),u("ingredients")},U=V=>{V.preventDefault(),V.stopPropagation(),V.type==="dragenter"||V.type==="dragover"?M(!0):V.type==="dragleave"&&M(!1)},C=V=>{if(V.preventDefault(),V.stopPropagation(),M(!1),V.dataTransfer.files&&V.dataTransfer.files[0]){const P=V.dataTransfer.files[0];P.type.startsWith("image/")&&T(k=>({...k,imageFile:P,image:URL.createObjectURL(P)}))}},z=V=>{const{id:P,value:k}=V.target;T(E=>({...E,[P]:k}))},R=V=>{const P=V.target.files[0];P&&T(k=>({...k,imageFile:P,image:URL.createObjectURL(P)}))},F=b.useMemo(()=>{if(j.type==="bread")return(j.flours?.length||0)+(j.breadIngredients?.length||0);const V=j.ingredientSections||[];return V.length>0?V.reduce((P,k)=>P+(k?.items?.length||0),0):j.ingredients?.length||0},[j.breadIngredients,j.flours,j.ingredientSections,j.ingredients,j.type]),K=b.useMemo(()=>{const V=j.stepSections||[];return V.length>0?V.reduce((P,k)=>P+(k?.items?.length||0),0):j.steps?.length||0},[j.stepSections,j.steps]),G=V=>{V.preventDefault();let P=[],k=[];if(j.type==="bread")P=j.ingredients.map(B=>{const{id:W,...Z}=B;return Z});else{const B=j.ingredientSections||[];B.length===0&&j.ingredients.length>0?P=j.ingredients.map(W=>{const{id:Z,...ye}=W;return ye}):(P=B.flatMap(W=>W.items.map(Z=>({...Z,groupId:W.id}))).map(W=>{const{id:Z,...ye}=W;return ye}),k=B.map(W=>({id:W.id,name:W.name})))}const E=new Set(j.tags||[]);j.course&&E.add(j.course),j.category&&E.add(j.category),j.type==="bread"&&E.add("");const L=Array.from(E).filter(Boolean);let Y=[],oe=[];const ge=j.stepSections||[];ge.length===0&&j.steps.length>0?Y=j.steps.map(B=>typeof B=="string"?{text:B}:B):(Y=ge.flatMap(B=>B.items.map(W=>({text:W.text,groupId:B.id}))),oe=ge.map(B=>({id:B.id,name:B.name}))),n({...j,ingredients:P,ingredientGroups:k,steps:Y,stepGroups:oe,image:j.imageFile||j.image,id:l.id||Date.now(),tags:L,ingredientSections:void 0,stepSections:void 0})},q=!!l?.id;return i.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:G,children:[d&&i.jsx(db,{onClose:()=>h(null),onImport:$,initialMode:d}),i.jsxs("div",{className:"recipe-form-mock__page",children:[i.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:i.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[i.jsxs("div",{className:"recipe-form-mock__crumb",children:[i.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),i.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),i.jsx("span",{className:"recipe-form-mock__crumb-page",children:q?"":""})]}),i.jsxs("div",{className:"recipe-form-mock__actions",children:[i.jsx(le,{type:"button",variant:"ghost",onClick:t,children:""}),i.jsx(le,{type:"submit",variant:"primary",children:""})]})]})}),i.jsxs("div",{className:"recipe-form-mock__sheet",children:[i.jsxs("header",{className:"recipe-form-mock__doc",children:[i.jsxs("div",{className:"recipe-form-mock__doc-title",children:[i.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:j.title,onChange:z,placeholder:"",required:!0}),i.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),i.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(zt,{label:"",id:"course",value:j.course,onChange:z,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"course-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(zt,{label:"",id:"category",value:j.category,onChange:z,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),i.jsxs("datalist",{id:"category-options",children:[i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""}),i.jsx("option",{value:""})]})]}),i.jsxs("div",{className:"recipe-form-mock__meta-field",children:[i.jsx(zt,{label:"",id:"storeName",value:j.storeName,onChange:z,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),i.jsx("datalist",{id:"store-options",children:xu.map(V=>i.jsx("option",{value:V},V))})]}),i.jsx("div",{className:"recipe-form-mock__meta-field",children:i.jsx(zt,{label:"",id:"servings",value:j.servings,onChange:z,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),i.jsxs("div",{className:"recipe-form-mock__grid",children:[i.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsx(zt,{label:"",id:"description",textarea:!0,value:j.description,onChange:z,placeholder:"..."}),i.jsx(zt,{label:"URL",id:"sourceUrl",value:j.sourceUrl||"",onChange:z,placeholder:"https://example.com/recipe/..."})]}),i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:`recipe-form-mock__image-drop ${D?"is-active":""}`,onDragEnter:U,onDragLeave:U,onDragOver:U,onDrop:C,children:[j.image?i.jsxs("div",{className:"recipe-form-mock__image-preview",children:[i.jsx("img",{src:j.image,alt:"",onError:V=>{V.target.style.display="none"}}),i.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>T(V=>({...V,image:"",imageFile:null})),title:"",children:""})]}):i.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",i.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),i.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"recipe-form-mock__image-input"})]})]}),!l?.id&&i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("div",{className:"recipe-form-mock__import-actions",children:[i.jsx(le,{variant:"secondary",type:"button",onClick:()=>h("url"),children:"URL"}),i.jsx(le,{variant:"secondary",type:"button",onClick:()=>h("image"),children:""})]}),i.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),i.jsxs(tn,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[i.jsx("div",{className:"recipe-form-mock__card-title",children:""}),i.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[i.jsx("li",{children:""}),i.jsx("li",{children:""}),i.jsx("li",{children:""})]})]})]}),i.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:i.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[i.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[i.jsxs("div",{className:"recipe-form-mock__nav",children:[i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:F.toLocaleString()})]}),i.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${o==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",i.jsx("span",{className:"recipe-form-mock__nav-count",children:K.toLocaleString()})]})]}),i.jsx("div",{className:"recipe-form-mock__workspace-right",children:o==="ingredients"?i.jsxs("div",{className:"recipe-form-mock__segmented",children:[i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="normal"?"active":""}`,onClick:()=>T(V=>({...V,type:"normal"})),children:""}),i.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${j.type==="bread"?"active":""}`,onClick:()=>T(V=>({...V,type:"bread"})),children:""})]}):i.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),i.jsx("div",{className:"recipe-form-mock__workspace-body",children:o==="ingredients"?i.jsx("div",{className:"recipe-form-mock__editor-surface",children:j.type==="bread"?i.jsx(PE,{formData:j,setFormData:T}):i.jsx(JE,{formData:j,setFormData:T,priceList:p})}):i.jsx("div",{className:"recipe-form-mock__editor-surface",children:i.jsx(eT,{formData:j,setFormData:T})})})]})})]})]})]})]})},tT="modulepreload",nT=function(n){return"/app/"+n},Tx={},bu=function(t,s,l){let o=Promise.resolve();if(s&&s.length>0){let p=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");o=p(s.map(m=>{if(m=nT(m),m in Tx)return;Tx[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":tT,y||(x.as="script"),x.crossOrigin="",x.href=m,h&&x.setAttribute("nonce",h),document.head.appendChild(x),y)return new Promise((S,_)=>{x.addEventListener("load",S),x.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(d){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=d,window.dispatchEvent(h),!h.defaultPrevented)throw d}return o.then(d=>{for(const h of d||[])h.status==="rejected"&&u(h.reason);return t().catch(u)})},rT=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},Qi={async fetchAllProfiles(){try{const{data:t,error:s}=await Re.rpc("admin_list_profiles");if(!s&&Array.isArray(t))return t;s&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",s)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const n=await Re.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await Re.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const l=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let o=null;if(l)try{const{data:d,error:h}=await Re.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(h)throw h;if(d){const p=rT(d);if(p)return p}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),o=d}const u=await Re.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(o&&l)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${o.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await Re.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminResetPassword(n,t){const{data:s,error:l}=await Re.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(l)throw l;if(s?.error)throw new Error(s.error);return s},async sendPasswordResetEmail(n){const{error:t}=await Re.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(t)throw t;return!0}},Rx="csv_unit_overrides",kx=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),Du={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:s,error:l}=await Re.from(Rx).select("ingredient_name,csv_unit").eq("user_id",t);if(l){if(kx(l))return new Map;throw l}const o=new Map;return(s||[]).forEach(u=>{u?.ingredient_name&&o.set(String(u.ingredient_name),String(u.csv_unit||""))}),o}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,s=null){const l=s||await this._getCurrentUserId();if(!l)throw new Error("");const o=String(n||"").trim(),u=String(t||"").trim();if(!o)throw new Error("");if(!u)throw new Error("");const{data:d,error:h}=await Re.from(Rx).upsert({user_id:l,ingredient_name:o,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(h)throw kx(h)?new Error("DB csv_unit_overrides "):h;return d}},sT=()=>{const n=Zi(),{user:t}=os(),[s,l]=b.useState([]),[o,u]=b.useState(""),[d,h]=b.useState("all"),[p,m]=b.useState(null),[y,v]=b.useState(!1),[x,S]=b.useState(new Map),[_,N]=b.useState(new Map),[j,T]=b.useState({}),[D,M]=b.useState(!1),[$,U]=b.useState([]),[C,z]=b.useState(!1),[R,F]=b.useState(""),[K,G]=b.useState(""),[q,V]=b.useState(!1),[P,k]=b.useState(!1),[E,L]=b.useState(null),[Y,oe]=b.useState(!1),ge="manual",B=ie=>{const je=String(ie||"").trim();return!je||je==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(je)?je:"food"},W=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:ge,label:""}],Z=b.useCallback(ie=>{const je=nn(ie);return je?x?.has(je):!1},[x]),ye=_e.useMemo(()=>{const ie={all:s.length,food:0,alcohol:0,soft_drink:0,supplies:0,[ge]:0};return s.forEach(je=>{const Ce=B(je?.itemCategory);ie[Ce]=(ie[Ce]||0)+1,Z(je?.ingredientName)||(ie[ge]=(ie[ge]||0)+1)}),ie},[s,Z]),Me=b.useCallback(async()=>{v(!0);try{const[ie,je,Ce]=await Promise.all([Pn.getAllConversions(),nr.fetchPriceList(),Du.getAll()]),Ue=Array.from(ie.values()).map(st=>({...st,clientId:st.ingredientName,isNew:!1,isEditing:!1}));S(je||new Map),N(Ce||new Map),l(Ue.sort((st,ct)=>st.ingredientName.localeCompare(ct.ingredientName,"ja")))}catch(ie){n.error(""),console.error("Failed to load ingredients:",ie)}v(!1)},[n]);b.useEffect(()=>{const ie=setTimeout(()=>{Me()},0);return()=>clearTimeout(ie)},[Me]);const xe=()=>{const ie=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,je=["food","alcohol","soft_drink","supplies"].includes(d)?d:"food",Ce={clientId:ie,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:je,isNew:!0,isEditing:!0};l(Ue=>[Ce,...Ue.map(st=>({...st,isEditing:!1}))]),m(ie)},ae=b.useCallback(ie=>s.findIndex(je=>je?.clientId===ie),[s]),O=async ie=>{const je=ae(ie);if(je<0)return;const Ce=s[je];if(!Ce.ingredientName||!Ce.packetSize||!Ce.lastPrice){n.warning("");return}const Ue=parseFloat(Ce.yieldPercent),st=Number.isFinite(Ue)?Ue:100;if(st<=0||st>100){n.warning("% 1100 ");return}try{await Pn.saveConversion(Ce.ingredientName,Ce.packetSize,Ce.packetUnit,Ce.lastPrice,Ce.itemCategory,Ce.vendor,st),n.success(""),Me(),m(null)}catch(ct){n.error(""),console.error("Save error:",ct)}},J=async ie=>{const je=ae(ie);if(je<0)return;const Ce=s[je],Ue=Ce?.ingredientName;if(Ce.isNew){l(st=>st.filter(ct=>ct?.clientId!==ie)),m(null);return}try{await Pn.deleteConversion(Ue),n.success(""),Me()}catch(st){n.error(""),console.error("Delete error:",st)}},ce=ie=>{m(ie),l(je=>je.map(Ce=>({...Ce,isEditing:Ce?.clientId===ie})))},Se=ie=>{const je=ae(ie);je<0||(s[je].isNew?l(Ce=>Ce.filter(Ue=>Ue?.clientId!==ie)):Me(),m(null))},ke=(ie,je,Ce)=>{l(Ue=>Ue.map(st=>st?.clientId!==ie?st:{...st,[je]:Ce}))},Be=ie=>{const je=parseFloat(ie.lastPrice),Ce=parseFloat(ie.packetSize);if(!je||!Ce)return"-";const Ue=ie.packetUnit?ie.packetUnit.trim().toLowerCase():"";return Ue==="g"||Ue===""?`${Math.round(je/Ce*1e3).toLocaleString()}/kg`:Ue==="ml"||Ue==="cc"||Ue===""||Ue===""?`${Math.round(je/Ce*1e3).toLocaleString()}/L`:`${Math.round(je/Ce).toLocaleString()}/${ie.packetUnit}`},Le=s.filter(ie=>{const je=String(ie?.ingredientName||"");return je.toLowerCase().includes(o.toLowerCase())?d==="all"?!0:d===ge?!Z(je):B(ie?.itemCategory)===d:!1}),Ge=d!=="all"||String(o||"").trim()!=="",pe=ie=>{const je=nn(ie);if(!je)return"-";const Ue=(x?.get(je)||null)?.unit;return Ue?String(Ue):"-"},Ye=ie=>{const je=nn(ie);if(!je)return"";const Ue=(x?.get(je)||null)?.vendor;return Ue?String(Ue):""},rt=ie=>{const je=String(ie?.vendor||"").trim();return je||Ye(ie?.ingredientName)},ft=ie=>{const je=(ie??"").toString().trim();if(!je)return"";if(Object.prototype.hasOwnProperty.call(j,je))return j[je];const Ce=_?.get(je);if(Ce)return String(Ce);const Ue=pe(je);return Ue==="-"?"":Ue},St=ie=>{const je=(ie??"").toString().trim();if(!je)return"-";const Ce=_?.get(je);return Ce?String(Ce):pe(je)},mt=async(ie,je)=>{const Ce=(ie??"").toString().trim(),Ue=(je??"").toString().trim();if(Ce){if(!Ue){T(st=>{const ct={...st};return delete ct[Ce],ct});return}try{await Du.upsert(Ce,Ue),N(st=>{const ct=new Map(st);return ct.set(Ce,Ue),ct}),n.success("CSV")}catch(st){console.error(st),n.error(st?.message||"")}}},Dt=async()=>{if(t?.role==="admin"){M(!0),F(""),U([]),G(""),V(!1),L(null),oe(!1),z(!0);try{const ie=await Qi.fetchAllProfiles();U(ie||[])}catch(ie){console.error(ie),F("")}finally{z(!1)}}},Vt=()=>{P||(oe(!1),M(!1))},wt=async()=>{if(!(!K||P)){k(!0),L({type:"info",message:"..."});try{const ie=await Pn.adminCopyIngredientMasterToUser(K,{overwrite:q}),je=ie?.unit_conversions||{},Ce=ie?.csv_unit_overrides||{},Ue=`: ${Number(je.source_total||0).toLocaleString()}   ${Number(je.copied||0).toLocaleString()} /  ${Number(je.updated||0).toLocaleString()} /  ${Number(je.skipped||0).toLocaleString()}`,st=`(CSV): ${Number(Ce.source_total||0).toLocaleString()}   ${Number(Ce.copied||0).toLocaleString()} /  ${Number(Ce.updated||0).toLocaleString()} /  ${Number(Ce.skipped||0).toLocaleString()}`;L({type:"success",message:`
${Ue}
${st}`}),n.success("")}catch(ie){console.error(ie),L({type:"error",message:`: ${String(ie?.message||ie)}`}),n.error("")}finally{k(!1)}}};return i.jsxs("div",{className:"ingredient-master-container",children:[i.jsxs("div",{className:"master-header",children:[i.jsx("h3",{children:" "}),i.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[t?.role==="admin"&&i.jsx(le,{variant:"secondary",onClick:Dt,disabled:p!==null||y||P,title:p!==null?"":void 0,children:""}),i.jsx(le,{variant:"primary",onClick:xe,disabled:p!==null,children:"+ "})]})]}),i.jsx("div",{className:"master-search",children:i.jsx(zt,{placeholder:"...",value:o,onChange:ie=>u(ie.target.value)})}),i.jsxs("div",{className:"ingredient-master-stats",children:[i.jsxs("span",{children:[": ",i.jsx("strong",{children:(s.length||0).toLocaleString()})," "]}),Ge&&i.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",i.jsx("strong",{children:(Le.length||0).toLocaleString()})," "]})]}),i.jsx("div",{className:"ingredient-category-tabs",children:W.map(ie=>i.jsxs("button",{type:"button",className:`ingredient-category-tab ${d===ie.key?"active":""}`,onClick:()=>h(ie.key),disabled:p!==null,title:p!==null?"":void 0,children:[ie.label," (",(ye[ie.key]??0).toLocaleString(),")"]},ie.key))}),y?i.jsx("div",{className:"master-loading",children:"..."}):i.jsx("div",{className:"master-table-wrapper",children:i.jsxs("table",{className:"master-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{children:""}),i.jsx("th",{children:"%"}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:Le.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"8",style:{textAlign:"center",color:"#999"},children:Ge?"":""})}):Le.map((ie,je)=>{const Ce=ie?.clientId??ie?.ingredientName??String(je),Ue=Ye(ie?.ingredientName),st=String(ie?.vendor||"").trim(),ct=ie?.isEditing&&!!Ue&&Ue!==st,Rt=rt(ie),wn=B(ie?.itemCategory)==="food";return i.jsxs("tr",{className:ie.isEditing?"editing":"",children:[i.jsx("td",{children:ie.isEditing?i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx(zt,{value:ie.ingredientName,onChange:jt=>ke(Ce,"ingredientName",jt.target.value),placeholder:": ",disabled:!ie.isNew,wrapperClassName:"input-group--no-margin"}),i.jsx(zt,{value:ie.vendor||"",onChange:jt=>ke(Ce,"vendor",jt.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),ct&&i.jsxs("div",{className:"ingredient-subtext",children:["CSV: ",Ue]})]}):i.jsxs("div",{className:"ingredient-name-cell",children:[i.jsx("div",{children:ie.ingredientName}),Rt&&i.jsx("div",{className:"ingredient-subtext",children:Rt})]})}),i.jsx("td",{children:ie.isEditing?i.jsx(zt,{type:"number",value:ie.lastPrice,onChange:jt=>ke(Ce,"lastPrice",jt.target.value),placeholder:": 500"}):`${parseFloat(ie.lastPrice||0).toLocaleString()}`}),i.jsx("td",{children:ie.isEditing?i.jsxs("div",{className:"input-with-hint",children:[i.jsx(zt,{type:"number",value:ie.packetSize,onChange:jt=>ke(Ce,"packetSize",jt.target.value),placeholder:["","","","PC","","",""].includes(ie.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(ie.packetUnit)&&i.jsxs("span",{className:"unit-hint",children:["1",ie.packetUnit,"1"]})]}):ie.packetSize}),i.jsx("td",{children:ie.isEditing?i.jsxs("select",{value:ie.packetUnit,onChange:jt=>ke(Ce,"packetUnit",jt.target.value),className:"unit-select",children:[i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"cc",children:"cc"})]}):ie.packetUnit}),i.jsx("td",{className:"csv-unit-cell",children:ie.isEditing?i.jsx(zt,{value:ft(ie.ingredientName),onChange:jt=>{const rn=(ie.ingredientName??"").toString().trim(),cn=jt.target.value;T(vn=>({...vn,[rn]:cn}))},onBlur:jt=>mt(ie.ingredientName,jt.target.value),placeholder:pe(ie.ingredientName)==="-"?"":`CSV: ${pe(ie.ingredientName)}`}):i.jsx("span",{children:St(ie.ingredientName)})}),i.jsx("td",{className:"normalized-cost",children:Be(ie)}),i.jsx("td",{children:wn?ie.isEditing?i.jsx(zt,{type:"number",value:ie.yieldPercent??"",onChange:jt=>ke(Ce,"yieldPercent",jt.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const jt=parseFloat(ie.yieldPercent);if(!Number.isFinite(jt)||jt<=0)return"-";const rn=Math.round(jt*10)/10;return`${Number.isInteger(rn)?Math.round(rn):rn}%`})():i.jsx("span",{style:{color:"#999"},children:"-"})}),i.jsx("td",{children:i.jsx("div",{className:"action-buttons",children:ie.isEditing?i.jsxs(i.Fragment,{children:[i.jsx(le,{variant:"primary",size:"sm",onClick:()=>O(Ce),children:""}),i.jsx(le,{variant:"ghost",size:"sm",onClick:()=>Se(Ce),children:""})]}):i.jsxs(i.Fragment,{children:[i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>ce(Ce),disabled:p!==null,children:""}),i.jsx(le,{variant:"ghost",size:"sm",onClick:()=>J(Ce),disabled:p!==null,children:""})]})})})]},Ce)})})]})}),i.jsx("div",{className:"master-info",children:i.jsx("p",{children:" "})}),i.jsx(Cn,{isOpen:D,onClose:Vt,title:"",size:"medium",showCloseButton:!P,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",i.jsx("br",{}),i.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),Y?i.jsxs(i.Fragment,{children:[(()=>{const ie=$.find(Ce=>String(Ce?.id)===String(K)),je=ie?`${ie.display_id}${ie.email?` (${ie.email})`:""}`:K?String(K).slice(0,8):"-";return i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",i.jsx("strong",{children:je}),i.jsx("br",{}),": ",i.jsx("strong",{children:q?"":""})]})]})})(),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(le,{variant:"ghost",onClick:()=>oe(!1),disabled:P,children:""}),i.jsx(le,{variant:"primary",onClick:wt,disabled:!K||P,children:P?"...":""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),C?i.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):i.jsxs("select",{value:K,onChange:ie=>G(ie.target.value),disabled:P||!!R,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:P?"#f3f4f6":"white"},children:[i.jsx("option",{value:"",children:"..."}),$.filter(ie=>String(ie?.id)&&String(ie?.id)!==String(t?.id)).map(ie=>i.jsxs("option",{value:ie.id,children:[ie.display_id,ie.email?` (${ie.email})`:"",ie.role==="admin"?" []":""]},ie.id))]}),R&&i.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:R})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[i.jsx("input",{type:"checkbox",checked:q,onChange:ie=>V(ie.target.checked),disabled:P}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(le,{variant:"ghost",onClick:Vt,disabled:P,children:""}),i.jsx(le,{variant:"primary",onClick:()=>oe(!0),disabled:!K||P||C||!!R,children:""})]})]}),P&&i.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),E?.message&&i.jsx("div",{className:`status-msg ${E.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:E.message})]})})]})},fu="__all_vendors__",hb="__unknown_vendor__",so="__all_categories__",Df="food",wu=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],rp=wu.reduce((n,t)=>(n[t.value]=t.label,n),{}),iT=new Set(["","","","","PC","","",""]),$i=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const s=Number(t);return Number.isFinite(s)?s:null},Ax=n=>(typeof n=="string"?n.trim():"")||hb,Ha=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?Df:rp[t]?t:Df},aT=()=>{const[n,t]=b.useState([]),[s,l]=b.useState(!0),[o,u]=b.useState(null),[d,h]=b.useState(null),[p,m]=b.useState("all"),[y,v]=b.useState({key:null,direction:"asc"}),[x,S]=b.useState(""),[_,N]=b.useState(so),[j,T]=b.useState(fu),[D,M]=b.useState(!1),[$,U]=b.useState(null),C=b.useRef(null),z=Zi(),[R,F]=b.useState({isOpen:!1,title:"",message:"",onConfirm:null}),K=()=>{h(O=>!O||O.phase==="running"?O:null)};b.useEffect(()=>{G()},[]);const G=async()=>{l(!0),U(null);try{console.log("Starting data load for CsvToMasterImporter...");const[O,J]=await Promise.all([nr.getPriceListArray().catch(Se=>(console.error("Error fetching price list:",Se),[])),Pn.getAllConversions().catch(Se=>(console.error("Error fetching conversions:",Se),new Map))]);if(console.log("Data fetched:",{csvCount:O?.length,masterSize:J?.size}),!Array.isArray(O))throw new Error("CSV");if(!(J instanceof Map))throw new Error("Map");const ce=[];for(const Se of O){if(!Se||!Se.name)continue;const ke=J.get(Se.name),Be=Ha(ke?.itemCategory),Le=ke?.packetSize??"",Ge=ke?.packetUnit||Se.unit||"",pe=ke?.lastPrice??"",Ye=ke?Le:iT.has(Ge)?1:"";ce.push({name:Se.name,csvPrice:Se.price,csvUnit:Se.unit,csvVendor:Se.vendor,masterCategory:Be,masterSize:Le,masterUnit:Ge,masterPrice:pe,isRegistered:!!ke,inputSize:Ye,inputUnit:Ge,inputPrice:ke?pe:Se.price??"",inputCategory:Be,isModified:!1})}console.log("Merge completed. Items:",ce.length),t(ce)}catch(O){console.error("Failed to load data for importer:",O),U(O.message||"")}finally{l(!1)}},q=async O=>{u(O.name);try{const J=$i(O.inputSize),ce=$i(O.inputPrice);if(J===null||J<=0){z.error("");return}if(!O.inputUnit){z.error("");return}if(!O.inputCategory){z.error("");return}await Pn.saveConversion(O.name,J,O.inputUnit,ce,O.inputCategory),t(Se=>Se.map(ke=>ke.name===O.name?{...ke,isRegistered:!0,isModified:!1,masterSize:J,masterUnit:O.inputUnit,masterPrice:ce??"",masterCategory:O.inputCategory,inputCategory:O.inputCategory}:ke)),z.success("")}catch(J){console.error("Failed to save ingredient:",J),z.error("")}finally{u(null)}},V=async O=>{F(J=>({...J,isOpen:!1}));try{const J=O.filter(ie=>{const je=$i(ie.inputSize);return!(je!==null&&je>0)||!ie.inputUnit||!ie.inputCategory});if(J.length>0){const ie=J.slice(0,5).map(Ce=>Ce.name).join(""),je=J.length>5?` ${J.length-5}`:"";z.error(`: ${ie}${je}`);return}u("bulk");const ce=O.length;h({phase:"running",total:ce,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const Se=5,ke=120;let Be=0,Le=0,Ge=0,pe=0;const Ye=[],rt=[],ft=(ie=!1,je="")=>{const Ce=Date.now();!ie&&Ce-pe<ke||(pe=Ce,h(Ue=>!Ue||Ue.phase!=="running"?Ue:{...Ue,processed:Be,success:Le,failed:Ge,currentName:je||Ue.currentName}))};let St=0;const mt=async()=>{for(;;){const ie=St++;if(ie>=O.length)return;const je=O[ie],Ce=je?.name?String(je.name):"";try{const Ue=$i(je.inputSize),st=$i(je.inputPrice);if(Ue===null||Ue<=0)throw new Error("Invalid size");if(!je.inputUnit)throw new Error("Invalid unit");if(!je.inputCategory)throw new Error("Invalid category");await Pn.saveConversion(je.name,Ue,je.inputUnit,st,je.inputCategory),Le++,Ye.push(je)}catch(Ue){Ge++,rt.push(Ce||`#${ie+1}`),console.error(`Failed to save ${Ce}:`,Ue)}finally{Be++,ft(!1,Ce)}}},Dt=Math.min(Se,O.length);await Promise.all(Array.from({length:Dt},()=>mt())),ft(!0);const Vt=new Set(Ye.map(ie=>ie.name)),wt=new Map(O.map(ie=>[ie.name,ie]));t(ie=>ie.map(je=>{if(Vt.has(je.name)){const Ce=wt.get(je.name);return{...je,isRegistered:!0,isModified:!1,masterSize:$i(Ce.inputSize)??"",masterUnit:Ce.inputUnit,masterPrice:$i(Ce.inputPrice)??"",masterCategory:Ce.inputCategory,inputCategory:Ce.inputCategory}}return je})),Ge===0?z.success(`${Le} `):z.warning(`:  ${Le}  /  ${Ge} `),h({phase:"done",total:ce,processed:Be,success:Le,failed:Ge,currentName:"",failedNames:rt.slice(0,10)})}catch(J){console.error("Bulk save error:",J),z.error(""),h(ce=>({phase:"error",total:ce?.total??O.length,processed:ce?.processed??0,success:ce?.success??0,failed:ce?.failed??0,currentName:"",failedNames:ce?.failedNames??[],errorMessage:J?.message?String(J.message):""}))}finally{u(null)}},P=()=>{const O=n.filter(J=>J.isModified);O.length!==0&&F({isOpen:!0,title:"",message:`${O.length} `,onConfirm:()=>V(O)})},k=(O,J,ce)=>{t(Se=>Se.map(ke=>ke.name===O?{...ke,[J]:ce,isModified:!0}:ke))},E=O=>{(O.key==="ArrowUp"||O.key==="ArrowDown")&&O.preventDefault()},L=O=>{v(J=>J.key===O?{key:O,direction:J.direction==="asc"?"desc":"asc"}:{key:O,direction:"asc"})},Y=O=>y.key!==O?"":y.direction==="asc"?" ":" ",oe=b.useMemo(()=>{const O=new Map;n.forEach(ce=>{const Se=Ax(ce.csvVendor),ke=Se===hb?"":Se,Be=O.get(Se);Be?Be.count+=1:O.set(Se,{key:Se,label:ke,count:1})});const J=Array.from(O.values()).sort((ce,Se)=>ce.label.localeCompare(Se.label,"ja"));return[{key:fu,label:"",count:n.length},...J]},[n]);b.useEffect(()=>{oe.some(J=>J.key===j)||T(fu)},[oe,j]),b.useEffect(()=>{if(!D)return;const O=ce=>{C.current&&!C.current.contains(ce.target)&&M(!1)},J=ce=>{ce.key==="Escape"&&M(!1)};return document.addEventListener("mousedown",O),document.addEventListener("touchstart",O),document.addEventListener("keydown",J),()=>{document.removeEventListener("mousedown",O),document.removeEventListener("touchstart",O),document.removeEventListener("keydown",J)}},[D]);const ge=b.useMemo(()=>j===fu?n:n.filter(O=>Ax(O.csvVendor)===j),[n,j]),B=b.useMemo(()=>{const O={[so]:ge.length};return wu.forEach(J=>{O[J.value]=0}),ge.forEach(J=>{const ce=Ha(J.inputCategory);O[ce]=(O[ce]||0)+1}),O},[ge]),W=b.useMemo(()=>_===so?ge:ge.filter(O=>Ha(O.inputCategory)===_),[ge,_]),Z=b.useMemo(()=>({all:W.length,unregistered:W.filter(O=>!O.isRegistered).length,registered:W.filter(O=>O.isRegistered).length}),[W]),ye=b.useMemo(()=>oe.find(O=>O.key===j)||oe[0],[oe,j]),Me=b.useMemo(()=>W.filter(O=>!(p==="unregistered"&&O.isRegistered||p==="registered"&&!O.isRegistered||x&&!O.name.includes(x))),[W,p,x]),xe=b.useMemo(()=>{if(!y.key)return Me;const O=Se=>String(Se??""),J=Se=>{const ke=parseFloat(Se);return Number.isFinite(ke)?ke:Number.NEGATIVE_INFINITY},ce=[...Me];return ce.sort((Se,ke)=>{let Be=0;switch(y.key){case"name":Be=O(Se.name).localeCompare(O(ke.name),"ja");break;case"csvPrice":Be=J(Se.csvPrice)-J(ke.csvPrice);break;case"inputCategory":{const Le=rp[Ha(Se.inputCategory)]||"",Ge=rp[Ha(ke.inputCategory)]||"";Be=Le.localeCompare(Ge,"ja");break}case"inputSize":Be=J(Se.inputSize)-J(ke.inputSize);break;case"inputUnit":Be=O(Se.inputUnit).localeCompare(O(ke.inputUnit),"ja");break;case"inputPrice":Be=J(Se.inputPrice)-J(ke.inputPrice);break;default:Be=0;break}return Be===0&&(Be=O(Se.name).localeCompare(O(ke.name),"ja")),y.direction==="asc"?Be:-Be}),ce},[Me,y]),ae=n.filter(O=>O.isModified).length;return s?i.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):$?i.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[i.jsx("h3",{children:""}),i.jsx("p",{children:$}),i.jsx(le,{variant:"secondary",onClick:G,children:""})]}):i.jsxs("div",{className:"csv-importer",children:[i.jsxs("div",{className:"importer-header",children:[i.jsx(zt,{placeholder:"...",value:x,onChange:O=>S(O.target.value),style:{maxWidth:"300px"}}),i.jsxs("div",{className:"filter-buttons",children:[i.jsxs(le,{variant:p==="all"?"primary":"secondary",onClick:()=>m("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",Z.all,")"]}),i.jsxs(le,{variant:p==="unregistered"?"primary":"secondary",onClick:()=>m("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",Z.unregistered,")"]}),i.jsxs(le,{variant:p==="registered"?"primary":"secondary",onClick:()=>m("registered"),size:"sm",children:[" (",Z.registered,")"]})]}),i.jsxs("div",{className:"vendor-dropdown",ref:C,children:[i.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>M(O=>!O),"aria-haspopup":"listbox","aria-expanded":D,children:[i.jsxs("span",{children:[": ",ye?.label," (",ye?.count??0,")"]}),i.jsx("span",{className:`vendor-dropdown-chevron ${D?"open":""}`,children:""})]}),D&&i.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:oe.map(O=>i.jsxs("button",{type:"button",className:`vendor-tab ${j===O.key?"active":""}`,onClick:()=>{T(O.key),M(!1)},role:"option","aria-selected":j===O.key,children:[O.label," (",O.count,")"]},O.key))})]}),i.jsxs("div",{className:"category-filter-row",children:[i.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),i.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:_,onChange:O=>N(O.target.value),children:[i.jsxs("option",{value:so,children:[" (",B[so]||0,")"]}),wu.map(O=>i.jsxs("option",{value:O.value,children:[O.label," (",B[O.value]||0,")"]},O.value))]})]}),i.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[ae>0&&i.jsx(le,{variant:"primary",size:"sm",onClick:P,disabled:o!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o==="bulk"?"...":`(${ae})`}),i.jsx(le,{variant:"secondary",size:"sm",onClick:G,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{style:{width:"22%"},onClick:()=>L("name"),children:[" (CSV)",Y("name")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>L("csvPrice"),children:[" (CSV)",Y("csvPrice")]}),i.jsxs("th",{style:{width:"14%"},onClick:()=>L("inputCategory"),children:[" ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputCategory")]}),i.jsxs("th",{style:{width:"18%"},onClick:()=>L("inputSize"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputSize")]}),i.jsxs("th",{style:{width:"13%"},onClick:()=>L("inputUnit"),children:[" () ",i.jsx("span",{style:{color:"red"},children:"*"}),Y("inputUnit")]}),i.jsxs("th",{style:{width:"12%"},onClick:()=>L("inputPrice"),children:[" ()",Y("inputPrice")]}),i.jsx("th",{style:{width:"7%"},children:""})]})}),i.jsx("tbody",{children:xe.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:""})}):xe.map(O=>i.jsxs("tr",{style:{backgroundColor:O.isModified?"#fff8e1":O.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[i.jsxs("td",{style:{fontWeight:"500"},children:[O.name,O.csvVendor&&i.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:O.csvVendor})]}),i.jsxs("td",{children:[O.csvPrice?`${O.csvPrice.toLocaleString()} `:"-",O.csvUnit&&i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",O.csvUnit]})]}),i.jsx("td",{children:i.jsx("select",{className:"input-field",value:Ha(O.inputCategory),onChange:J=>k(O.name,"inputCategory",J.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:wu.map(J=>i.jsx("option",{value:J.value,children:J.label},J.value))})}),i.jsx("td",{children:i.jsx(zt,{type:"number",value:O.inputSize,onChange:J=>k(O.name,"inputSize",J.target.value),onKeyDown:E,placeholder:["","","","PC","","",""].includes(O.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),i.jsx("td",{children:i.jsxs("select",{className:"input-field",value:O.inputUnit,onChange:J=>k(O.name,"inputUnit",J.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","","","","","PC","","",""].includes(O.inputUnit)&&O.inputUnit&&i.jsxs("option",{value:O.inputUnit,children:[O.inputUnit," (CSV)"]}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"g",children:"g"}),i.jsx("option",{value:"kg",children:"kg"}),i.jsx("option",{value:"ml",children:"ml"}),i.jsx("option",{value:"L",children:"L"}),i.jsx("option",{value:"cc",children:"cc"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"PC",children:"PC"}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""}),i.jsx("option",{value:"",children:""})]})}),i.jsx("td",{children:i.jsx(zt,{type:"number",value:O.inputPrice,onChange:J=>k(O.name,"inputPrice",J.target.value),placeholder:"",style:{width:"100%"}})}),i.jsx("td",{children:i.jsx(le,{variant:O.isRegistered?"secondary":"primary",size:"sm",onClick:()=>q(O),disabled:o===O.name||o==="bulk",block:!0,children:o===O.name?"...":O.isRegistered?"":""})})]},O.name))})]})}),i.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[i.jsx("p",{children:" CSV"}),i.jsx("p",{children:" "})]}),i.jsxs(Cn,{isOpen:R.isOpen,onClose:()=>F({...R,isOpen:!1}),title:R.title,size:"small",children:[i.jsx("div",{style:{marginBottom:"1.5rem"},children:R.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[i.jsx(le,{variant:"secondary",onClick:()=>F({...R,isOpen:!1}),children:""}),i.jsx(le,{variant:"primary",onClick:R.onConfirm,children:""})]})]}),i.jsx(Cn,{isOpen:!!d,onClose:K,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?i.jsxs("div",{className:"bulk-progress",children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:""}),i.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),i.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&i.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&i.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),i.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[i.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(le,{variant:"primary",onClick:K,children:""})})]}):i.jsxs("div",{className:"bulk-progress",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),i.jsxs("div",{className:"bulk-progress-meta",children:[i.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),i.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),i.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),i.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:i.jsx(le,{variant:"primary",onClick:K,children:""})})]})})]})},Ox=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},lT=({onBack:n})=>{const[t,s]=Lo(),{user:l}=os(),[o,u]=b.useState("price"),[d,h]=b.useState(null),[p,m]=b.useState({type:"",message:""}),[y,v]=b.useState(!1),[x,S]=b.useState([]),[_,N]=b.useState(!1),[j,T]=b.useState(null),[D,M]=b.useState({type:"",message:""}),[$,U]=b.useState(null),[C,z]=b.useState(!1),[R,F]=b.useState(!1),[K,G]=b.useState(!1),[q,V]=b.useState([]),[P,k]=b.useState(!1),[E,L]=b.useState(""),[Y,oe]=b.useState(""),[ge,B]=b.useState(!1),[W,Z]=b.useState({total:0,done:0,current:""}),[ye,Me]=b.useState(null),[xe,ae]=b.useState(!1),[O,J]=b.useState(!1),[ce,Se]=b.useState(new Map),[ke,Be]=b.useState([]),[Le,Ge]=b.useState(""),[pe,Ye]=b.useState(""),[rt,ft]=b.useState(""),St=_e.useMemo(()=>{if(!Le)return[];const me=ce.get(Le)||[],He=new Set;return me.forEach(Xe=>{const Ve=Ox(Xe?.dateStr);Ve&&He.add(Ve)}),Array.from(He).sort((Xe,Ve)=>Ve.localeCompare(Xe))},[ce,Le]);b.useEffect(()=>{if(rt){if(!Le){ft("");return}St.length>0&&!St.includes(rt)&&ft("")}},[St,rt,Le]);const[mt,Dt]=b.useState({key:"dateStr",direction:"desc"}),[Vt,wt]=b.useState("");b.useEffect(()=>{const me=t.get("tab");(me==="price"||me==="ingredients"||me==="csv-import"||me==="duplicates")&&u(me)},[]);const ie=me=>{let He="asc";mt.key===me&&mt.direction==="asc"&&(He="desc"),Dt({key:me,direction:He})},je=_e.useMemo(()=>{let me=[...x];if(Vt){const He=Vt.toLowerCase().trim();me=me.filter(Xe=>Xe.name&&Xe.name.toLowerCase().includes(He)||Xe.vendor&&Xe.vendor.toLowerCase().includes(He)||Xe.dateStr&&Xe.dateStr.includes(He))}return mt.key&&me.sort((He,Xe)=>{let Ve=He[mt.key]||"",et=Xe[mt.key]||"";return Ve<et?mt.direction==="asc"?-1:1:Ve>et?mt.direction==="asc"?1:-1:0}),me},[x,mt,Vt]),[Ce,Ue]=b.useState([]);b.useEffect(()=>{ct()},[]);const st=async()=>{J(!0);try{const He=await nr.fetchPriceHistory()||new Map;Se(He);const Xe=[];for(const[Ve,et]of He.entries()){const Mt=new Set,vt=[];if((et||[]).forEach(ne=>{const te=[String(ne?.dateStr||""),String(ne?.price??""),String(ne?.incomingQty??""),String(ne?.unit||""),String(ne?.vendor||""),String(ne?.displayName||"")].join("|");Mt.has(te)||(Mt.add(te),vt.push(ne))}),vt.length<2)continue;vt.sort((ne,te)=>String(ne?.dateStr||"").localeCompare(String(te?.dateStr||"")));const kt=vt[vt.length-1]||{},Ze=vt.map(ne=>Number(ne?.price)).filter(ne=>Number.isFinite(ne)),Bt=Ze.length?Math.min(...Ze):null,Qe=Ze.length?Math.max(...Ze):null,Ut=new Set(vt.map(ne=>String(ne?.dateStr||""))).size,Xt=new Set(vt.map(ne=>String(ne?.displayName||""))).size;let Qt=0;for(let ne=1;ne<vt.length;ne++){const te=Number(vt[ne-1]?.price),he=Number(vt[ne]?.price);Number.isFinite(te)&&Number.isFinite(he)&&te!==he&&Qt++}Xe.push({key:Ve,name:kt?.displayName||Ve,lastDate:kt?.dateStr||"",lastPrice:Number.isFinite(Number(kt?.price))?Number(kt?.price):null,lastIncomingQty:Number.isFinite(Number(kt?.incomingQty))?Number(kt?.incomingQty):null,unit:kt?.unit||"",vendor:kt?.vendor||"",rows:vt.length,dates:Ut,nameVariants:Xt,minPrice:Bt,maxPrice:Qe,changes:Qt})}Xe.sort((Ve,et)=>{const Mt=String(Ve?.lastDate||""),vt=String(et?.lastDate||"");return Mt!==vt?vt.localeCompare(Mt):(et?.changes||0)!==(Ve?.changes||0)?(et?.changes||0)-(Ve?.changes||0):(et?.rows||0)!==(Ve?.rows||0)?(et?.rows||0)-(Ve?.rows||0):String(Ve?.name||"").localeCompare(String(et?.name||""),"ja")}),Be(Xe),Le&&!He.has(Le)&&Ge("")}catch(me){console.error(me)}finally{J(!1)}};b.useEffect(()=>{o==="duplicates"&&st()},[o]);const ct=async()=>{N(!0);try{const me=await nr.getPriceListArray();S(me);const He=await nr.getFileList();Ue(He)}catch(me){console.error("Failed to load price data",me)}finally{N(!1)}},Rt=me=>{me.target.files&&me.target.files[0]&&(h(me.target.files[0]),m({type:"",message:""}))},Jt=async()=>{if(!d)return;v(!0),m({type:"info",message:"..."});const me=await nr.uploadPriceList(d);if(me.success){m({type:"success",message:"..."});try{const{recipeService:Xe}=await bu(async()=>{const{recipeService:Mt}=await Promise.resolve().then(()=>yf);return{recipeService:Mt}},[]),Ve=await nr.fetchPriceList(),et=await Xe.updateRecipeCosts(Ve);m({type:"success",message:`${et}`})}catch(Xe){console.error("Cost update failed",Xe),m({type:"warning",message:""})}h(null);const He=document.getElementById("csv-upload-input");He&&(He.value=""),ct()}else m({type:"error",message:`: ${me.error.message}`});v(!1)},wn=me=>{T({message:`${me}
`,onConfirm:async()=>{v(!0);const He=await nr.deletePriceFile(me);v(!1),He.success?(m({type:"success",message:""}),ct()):m({type:"error",message:`: ${He.error.message}`})}})},jt=me=>{me&&(U(me),z(!0),M({type:"",message:""}))},rn=()=>{if(R)return;z(!1),U(null);const me=document.getElementById("backup-upload-input");me&&(me.value="")},cn=async()=>{const me=$;if(!(!me||R)){F(!0),M({type:"info",message:"..."});try{const He=await me.text(),Xe=JSON.parse(He),{recipeService:Ve}=await bu(async()=>{const{recipeService:kt}=await Promise.resolve().then(()=>yf);return{recipeService:kt}},void 0),et=await Ve.importRecipes(Xe),Mt=Number(et?.count||0),vt=Array.isArray(et?.errors)?et.errors.length:0;M({type:vt>0?"warning":"success",message:`: ${Mt}${vt>0?` / : ${vt}`:""}`}),z(!1),U(null)}catch(He){console.error(He),M({type:"error",message:""})}finally{F(!1);const He=document.getElementById("backup-upload-input");He&&(He.value="")}}},vn=async()=>{G(!0),Me(null),Z({total:0,done:0,current:""}),oe(""),L(""),ae(!1),k(!0);try{const me=await Qi.fetchAllProfiles();V(me||[])}catch(me){console.error(me),V([]),L("")}finally{k(!1)}},Ln=()=>{ge||(ae(!1),G(!1))},ar=async()=>{if(!(!Y||ge)){B(!0),Me({type:"info",message:"..."}),Z({total:0,done:0,current:""});try{const me=await nr.copyPriceFilesToUser({targetUserId:Y,onProgress:({total:Ve,done:et,current:Mt})=>{Z({total:Ve||0,done:et||0,current:Mt||""})}}),He=me?.copied?.length??0,Xe=me?.failed?.length??0;Me({type:Xe>0?"error":"success",message:`: ${He}${Xe>0?` / : ${Xe}`:""}`,failed:me?.failed||[]})}catch(me){console.error(me),Me({type:"error",message:`: ${String(me?.message||me)}`})}finally{B(!1)}}};return i.jsxs("div",{className:["dashboard-container","fade-in",o==="ingredients"||o==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[i.jsxs("div",{className:"dashboard-header",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),i.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[o==="csv-import"&&i.jsx(le,{variant:"secondary",onClick:()=>s({view:"inventory"}),title:"",children:" "}),i.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),i.jsx("div",{className:"tabs-container",children:i.jsxs("div",{className:"tabs",children:[i.jsx("button",{className:`tab ${o==="price"?"active":""}`,onClick:()=>u("price"),children:" "}),i.jsx("button",{className:`tab ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:" "}),i.jsx("button",{className:`tab ${o==="csv-import"?"active":""}`,onClick:()=>u("csv-import"),children:" CSV"}),i.jsx("button",{className:`tab ${o==="duplicates"?"active":""}`,onClick:()=>u("duplicates"),children:" "})]})}),o==="ingredients"?i.jsx(sT,{}):o==="csv-import"?i.jsx(aT,{}):o==="duplicates"?i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[ke.length.toLocaleString(),""]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[i.jsx(zt,{placeholder:"...",value:pe,onChange:me=>Ye(me.target.value),style:{flex:1,fontSize:"0.9rem"}}),i.jsx(le,{variant:"secondary",size:"sm",onClick:st,disabled:O,title:"",children:""})]}),i.jsx("div",{className:"dup-list",children:O?i.jsx("div",{className:"dup-empty",children:"..."}):ke.length===0?i.jsx("div",{className:"dup-empty",children:"2"}):ke.filter(me=>{const He=String(pe||"").trim();return He?String(me?.name||"").includes(He):!0}).map(me=>{const He=me.key===Le,Xe=me.minPrice!==null&&me.maxPrice!==null&&me.minPrice!==me.maxPrice;return i.jsxs("button",{type:"button",className:`dup-item ${He?"active":""}`,onClick:()=>Ge(me.key),children:[i.jsxs("div",{className:"dup-item-top",children:[i.jsx("div",{className:"dup-item-name",title:me.name,children:me.name}),Xe&&i.jsx("span",{className:"dup-badge",children:""})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[": ",me.lastDate||"-"]}),i.jsxs("span",{children:[": ",me.rows,""]}),i.jsxs("span",{children:[": ",me.dates,""]})]}),i.jsxs("div",{className:"dup-item-meta",children:[i.jsxs("span",{children:[me.lastPrice!==null?`${Math.round(me.lastPrice).toLocaleString()}`:"-",me.unit?` / ${me.unit}`:""]}),i.jsxs("span",{children:[": ",me.lastIncomingQty!==null?Math.round(me.lastIncomingQty).toLocaleString():"-"]}),me.vendor?i.jsxs("span",{title:me.vendor,children:[": ",me.vendor]}):i.jsx("span",{children:": -"})]}),me.nameVariants>1&&i.jsxs("div",{className:"dup-item-note",children:[": ",me.nameVariants,""]})]},me.key)})})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:Le?"":""})}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsxs("select",{value:rt,onChange:me=>ft(me.target.value),disabled:!Le,title:Le?"":"",className:"dup-month-select",children:[i.jsx("option",{value:"",children:""}),St.map(me=>i.jsx("option",{value:me,children:me.replace("-","/")},me))]}),i.jsx(le,{variant:"secondary",size:"sm",onClick:st,disabled:O,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:(()=>{if(!Le)return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const me=ce.get(Le)||[],He=new Set,Xe=[];me.forEach(Ze=>{const Bt=[String(Ze?.dateStr||""),String(Ze?.price??""),String(Ze?.incomingQty??""),String(Ze?.unit||""),String(Ze?.vendor||""),String(Ze?.displayName||""),String(Ze?.sourceFile||"")].join("|");He.has(Bt)||(He.add(Bt),Xe.push(Ze))}),Xe.sort((Ze,Bt)=>String(Ze?.dateStr||"").localeCompare(String(Bt?.dateStr||"")));const Ve=rt?Xe.filter(Ze=>Ox(Ze?.dateStr)===rt):Xe,et=Ve.map((Ze,Bt)=>{const Qe=Bt>0?Ve[Bt-1]:null,Ut=Qe?Number(Qe?.price):NaN,Xt=Number(Ze?.price);let Qt=null,ne=null;return Number.isFinite(Ut)&&Number.isFinite(Xt)&&(Qt=Xt-Ut,ne=Ut!==0?Qt/Ut*100:null),{...Ze,_diff:Qt,_pct:ne}}),Mt=Ve.reduce((Ze,Bt)=>{const Qe=Number(Bt?.incomingQty);return Ze+(Number.isFinite(Qe)?Qe:0)},0),vt=Ve.reduce((Ze,Bt)=>{const Qe=Number(Bt?.incomingQty),Ut=Number(Bt?.price);return!Number.isFinite(Qe)||!Number.isFinite(Ut)?Ze:Ze+Qe*Ut},0),kt=[...et].reverse();return i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"120px"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:"CSV"}),i.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),i.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),i.jsx("tbody",{children:kt.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"7",className:"no-data",children:rt?`${rt}`:""})}):kt.map((Ze,Bt)=>{const Qe=Ze?._diff,Ut=Ze?._pct,Xt=Qe==null||!Number.isFinite(Qe)?"-":`${Qe>=0?"+":""}${Math.round(Qe).toLocaleString()}`,Qt=Ut==null||!Number.isFinite(Ut)?"":` (${Ut>=0?"+":""}${Ut.toFixed(1)}%)`,ne=Qe==null||!Number.isFinite(Qe)?"#888":Qe>0?"#c92a2a":Qe<0?"#2b8a3e":"#666",te=Number(Ze?.price),he=Number.isFinite(te)?`${Math.round(te).toLocaleString()}`:"-",Ee=Number(Ze?.incomingQty),Ie=Number.isFinite(Ee)?Math.round(Ee).toLocaleString():"-",Je=Number.isFinite(Ee)&&Number.isFinite(te)?Ee*te:NaN,Ke=Number.isFinite(Je)?`${Math.round(Je).toLocaleString()}`:"-";return i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:Ze?.dateStr||"-"}),i.jsx("td",{children:Ze?.vendor||"-"}),i.jsx("td",{style:{fontWeight:500},children:Ze?.displayName||"-"}),i.jsx("td",{className:"col-number",children:Ie}),i.jsxs("td",{className:"col-number",children:[he,Ze?.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",Ze.unit]})]}),i.jsx("td",{className:"col-number",children:Ke}),i.jsxs("td",{className:"col-number",style:{color:ne},children:[Xt,Qt]})]},`${Ze?.dateStr||"d"}-${Bt}`)})}),kt.length>0&&i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",rt?`${rt}`:""]}),i.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(Mt).toLocaleString()}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),i.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(vt).toLocaleString()]}),i.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):i.jsxs("div",{className:"dashboard-content",children:[i.jsxs("aside",{className:"dashboard-sidebar",children:[i.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[i.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),i.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const me=await bu(()=>Promise.resolve().then(()=>yf),void 0).then(et=>et.recipeService.exportAllRecipes()),He=new Blob([JSON.stringify(me,null,2)],{type:"application/json"}),Xe=URL.createObjectURL(He),Ve=document.createElement("a");Ve.href=Xe,Ve.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Ve),Ve.click(),document.body.removeChild(Ve),URL.revokeObjectURL(Xe)}catch(me){M({type:"error",message:""}),console.error(me)}},children:" JSON"})]}),i.jsxs("div",{children:[i.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),i.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:me=>{const He=me.target.files?.[0];He&&jt(He)}}),i.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:y||R,children:" "}),D.message&&i.jsx("div",{className:`status-msg ${D.type}`,style:{marginTop:"10px"},children:D.message})]})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("div",{className:"upload-area",children:[i.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",i.jsx("br",{}),i.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",i.jsx("br",{})," 2: "]})]}),i.jsx("input",{type:"file",accept:".csv",onChange:Rt,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),i.jsx(le,{variant:"primary",onClick:Jt,disabled:!d||y,className:"upload-btn",size:"sm",block:!0,children:y?"...":""})]}),p.message&&i.jsx("div",{className:`status-msg ${p.type}`,children:p.message})]}),l?.role==="admin"&&i.jsxs("div",{className:"sidebar-card",children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",i.jsx("br",{}),i.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),i.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",Ce.length,""]}),i.jsx("div",{style:{marginTop:"0.75rem"},children:i.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:vn,disabled:ge||y,title:"",children:""})})]}),i.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[i.jsxs("div",{className:"sidebar-title",children:[i.jsx("span",{children:""})," ",i.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Ce.length,""]})]}),Ce.length===0?i.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):i.jsx("div",{className:"file-list",children:Ce.map(me=>i.jsxs("div",{className:"file-list-item",children:[i.jsx("span",{className:"file-name",title:me.name,children:me.name}),i.jsx(le,{variant:"danger",size:"sm",onClick:()=>wn(me.name),disabled:y,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},me.name))})]}),i.jsxs("div",{className:"sidebar-card",children:[i.jsx("div",{className:"sidebar-title",children:" "}),i.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[i.jsx("li",{style:{marginBottom:"4px"},children:""}),i.jsx("li",{style:{marginBottom:"4px"},children:" "}),i.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),i.jsxs("main",{className:"dashboard-main",children:[i.jsxs("div",{className:"main-toolbar",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),i.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",je.length.toLocaleString()," "]})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i.jsx(zt,{placeholder:" (, , )...",value:Vt,onChange:me=>wt(me.target.value),style:{width:"250px",fontSize:"0.9rem"}}),i.jsx(le,{variant:"secondary",size:"sm",onClick:ct,children:" "})]})]}),i.jsx("div",{className:"table-wrapper",children:_?i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):i.jsxs("table",{className:"enterprise-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsxs("th",{onClick:()=>ie("dateStr"),style:{width:"120px"},children:[" ",mt.key==="dateStr"&&(mt.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>ie("vendor"),children:[" ",mt.key==="vendor"&&(mt.direction==="asc"?"":"")]}),i.jsxs("th",{onClick:()=>ie("name"),children:[" ",mt.key==="name"&&(mt.direction==="asc"?"":"")]}),i.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),i.jsx("tbody",{children:je.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",className:"no-data",children:""})}):je.map((me,He)=>i.jsxs("tr",{children:[i.jsx("td",{className:"col-date",children:me.dateStr||"-"}),i.jsx("td",{children:me.vendor||"-"}),i.jsx("td",{style:{fontWeight:"500"},children:me.name}),i.jsxs("td",{className:"col-number",children:[me.price?me.price.toLocaleString():"-",me.unit&&i.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",me.unit]})]})]},He))})]})})]})]}),i.jsx(Cn,{isOpen:C,onClose:rn,title:" / ",size:"medium",showCloseButton:!R,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",i.jsx("br",{}),i.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:$?.name||"-"})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(le,{variant:"ghost",onClick:rn,disabled:R,children:""}),i.jsx(le,{variant:"primary",onClick:cn,disabled:!$||R,children:R?"...":""})]}),R&&i.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),D.message&&i.jsx("div",{className:`status-msg ${D.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:D.message})]})}),i.jsx(Cn,{isOpen:K,onClose:Ln,title:"",size:"medium",showCloseButton:!ge,children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",i.jsx("br",{}),i.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",i.jsx("code",{children:"_copy"})," "]})]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",i.jsx("strong",{style:{color:"#111827"},children:l?.displayId||""})," / : ",Ce.length,""]}),xe?i.jsxs(i.Fragment,{children:[(()=>{const me=q.find(Xe=>String(Xe?.id)===String(Y)),He=me?`${me.display_id}${me.email?` (${me.email})`:""}`:Y?String(Y).slice(0,8):"-";return i.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[i.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),i.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",i.jsx("strong",{children:He}),i.jsx("br",{}),": ",i.jsx("strong",{children:Ce.length.toLocaleString()})," CSV",i.jsx("br",{}),": ",i.jsx("code",{children:"_copy"})," "]})]})})(),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(le,{variant:"ghost",onClick:()=>ae(!1),disabled:ge,children:""}),i.jsx(le,{variant:"primary",onClick:ar,disabled:!Y||ge,children:ge?"...":""})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),P?i.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):i.jsxs("select",{value:Y,onChange:me=>oe(me.target.value),disabled:ge||!!E,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:ge?"#f3f4f6":"white"},children:[i.jsx("option",{value:"",children:"..."}),q.filter(me=>String(me?.id)&&String(me?.id)!==String(l?.id)).map(me=>i.jsxs("option",{value:me.id,children:[me.display_id,me.email?` (${me.email})`:"",me.role==="admin"?" []":""]},me.id))]}),E&&i.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:E})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[i.jsx(le,{variant:"ghost",onClick:Ln,disabled:ge,children:""}),i.jsx(le,{variant:"primary",onClick:()=>ae(!0),disabled:!Y||ge||P||!!E,children:""})]})]}),ge&&i.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[i.jsxs("div",{className:"bulk-progress-head",children:[i.jsx("div",{className:"bulk-progress-spinner"}),i.jsxs("div",{children:[i.jsx("div",{className:"bulk-progress-title",children:"..."}),i.jsx("div",{className:"bulk-progress-subtitle",children:W.total?`${W.done} / ${W.total}`:"..."})]})]}),i.jsx("div",{className:"bulk-progress-bar",children:i.jsx("div",{className:"bulk-progress-bar-inner",style:{width:W.total?`${Math.round(W.done/W.total*100)}%`:"0%"}})}),i.jsx("div",{className:"bulk-progress-current",title:W.current,children:W.current})]}),ye?.message&&i.jsx("div",{className:`status-msg ${ye.type||"info"}`,children:ye.message}),Array.isArray(ye?.failed)&&ye.failed.length>0&&i.jsxs("div",{className:"bulk-progress-failures",children:[i.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",ye.failed.length,""]}),i.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:ye.failed.slice(0,10).map((me,He)=>i.jsxs("li",{children:[me?.file||"-",": ",me?.errorMessage||"unknown error"]},`${me?.file||"f"}-${He}`))}),ye.failed.length>10&&i.jsxs("div",{style:{marginTop:"6px"},children:["... ",ye.failed.length-10,""]})]})]})}),j&&i.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>T(null),children:i.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:me=>me.stopPropagation(),children:[i.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),i.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:j.message}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[i.jsx(le,{variant:"ghost",onClick:()=>T(null),children:""}),i.jsx(le,{variant:"danger",onClick:()=>{j.onConfirm(),T(null)},children:""})]})]})})]})},oT=({recipes:n,recentIds:t,onSelect:s})=>{if(!t||t.length===0)return null;const l=t.map(o=>n.find(u=>u.id===o)).filter(Boolean).slice(0,7);return l.length===0?null:i.jsxs("div",{className:"recent-recipes",children:[i.jsx("h3",{className:"recent-header",children:""}),i.jsx("div",{className:"recent-list",children:l.map(o=>i.jsxs("div",{className:"recent-item",onClick:()=>s(o),children:[i.jsx("div",{className:"recent-thumbnail",children:o.image?i.jsx("img",{src:o.image,alt:o.title}):i.jsx("div",{className:"recent-placeholder"})}),i.jsx("div",{className:"recent-info",children:i.jsx("div",{className:"recent-title",children:o.title})})]},o.id))})]})},cT=({onBack:n})=>(b.useEffect(()=>{window.scrollTo(0,0)},[]),i.jsxs("div",{className:"levain-guide-container",children:[i.jsxs("header",{className:"levain-guide-header",children:[i.jsx("h1",{children:"LEVAIN GUIDE"}),i.jsx("p",{className:"subtitle",children:" "}),i.jsx("p",{className:"subtitle",children:""}),i.jsx("div",{className:"divider"})]}),i.jsxs("main",{className:"levain-guide-main",children:[i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("p",{children:"Levain"}),i.jsx("h3",{children:""}),i.jsx("p",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",i.jsx("br",{}),i.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",i.jsx("br",{}),i.jsx("strong",{children:""})," Acetobacter aceti "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:["",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",i.jsx("br",{}),"(   +  + )"]}),"",i.jsx("br",{}),i.jsxs("div",{className:"formula",children:["CHO  2CHO",i.jsx("br",{}),"(  )"]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"- 7-10"}),i.jsxs("div",{className:"timeline",children:[i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),i.jsx("p",{children:"100g + 100ml 20-22"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsx("p",{children:"100g  50g50g + 50ml"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),i.jsx("p",{children:"50%50g + 50ml "}),i.jsxs("div",{className:"success-box",children:[" ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]}),i.jsxs("div",{className:"timeline-item",children:[i.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),i.jsx("p",{children:"1150%1:1"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 15",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," pH 3.5-4.0"]})]})]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:"(ml)"}),i.jsx("th",{children:"(g)"}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"2"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"100"}),i.jsx("td",{children:"0"}),i.jsx("td",{children:""})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"5-8"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-4"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"15-18"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"3-5"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25-28"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"2-3"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"30"}),i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:"1-2"})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"1"}),i.jsx("br",{}),"100g50g + 50ml"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"8-12"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"2%100ml2g"}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 12 8:00"}),i.jsx("br",{}),"50g25g + 25ml "]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  14:00"}),i.jsx("br",{}),"25g + 25ml 2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:"Day 1  20:00"}),i.jsx("br",{}),""]})]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:" "})," ",i.jsx("br",{}),"",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:" "})," pH",i.jsx("br",{}),"pH 3.5-4.0pH"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"18"}),i.jsx("td",{children:"16-24"}),i.jsx("td",{children:"1"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"12-16"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"24-26"}),i.jsx("td",{children:"8-12"}),i.jsx("td",{children:"2"})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"28"}),i.jsx("td",{children:"4-8"}),i.jsx("td",{children:"2"})]})]})]})})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"1"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 22",i.jsx("br",{}),"2. 12",i.jsx("br",{}),"3. 1",i.jsx("br",{}),"4. 1-2"]}),i.jsx("h3",{children:"2"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," pH",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," "]}),i.jsx("h3",{children:"3"}),i.jsxs("div",{className:"warning-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. 15",i.jsx("br",{}),"3. 80%"]}),i.jsx("h3",{children:"4"}),i.jsxs("div",{className:"success-box",children:["",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""})," "]}),i.jsx("h3",{children:"5"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{}),"1. 1:0.8",i.jsx("br",{}),"2. ",i.jsx("br",{}),"3. "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:"pH"}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"pH4-8.0"}),i.jsx("br",{}),i.jsx("br",{})," pH 7.0",i.jsx("br",{})," pH 4.5-5.5",i.jsx("br",{})," pH 3.5-4.0",i.jsx("br",{})," pH 3.0"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"science-box",children:[i.jsx("strong",{children:"pH 3.8-4.0"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 3.5"})," ",i.jsx("br",{}),i.jsx("strong",{children:"pH 4.5"})," "]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," 1",i.jsx("br",{})," ",i.jsx("br",{})," -203"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:"15-20"}),i.jsx("td",{children:"18-20"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"25+"}),i.jsx("td",{children:"22-24"}),i.jsx("td",{children:""}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"18-22"}),i.jsx("td",{children:"20-22"}),i.jsx("td",{children:"1-2"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:"5-15"}),i.jsx("td",{children:"18"}),i.jsx("td",{children:"2-3"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 24",i.jsx("br",{})," ",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," 18",i.jsx("br",{})," "]}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"step-list",children:[i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""})," ",i.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{}),"100g + 50g + 150ml 12-24",i.jsx("br",{}),"11-2"]}),i.jsxs("div",{className:"step",children:[i.jsx("strong",{children:""}),i.jsx("br",{})," ",i.jsx("br",{})," ",i.jsx("br",{})," "]})]})]})]}),i.jsxs("div",{className:"levain-section",children:[i.jsx("h2",{children:""}),i.jsxs("div",{className:"levain-content",children:[i.jsx("h3",{children:""}),i.jsxs("div",{className:"highlight-box",children:[i.jsx("strong",{children:"100ml"}),i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," 110 to 110 CFU/ml",i.jsx("br",{})," pH3.5-4.0",i.jsx("br",{})," 0.5-1.5%",i.jsx("br",{})," 0.3-0.8%"]}),i.jsx("h3",{children:""}),i.jsx("div",{className:"comparison-table-container",children:i.jsxs("table",{className:"levain-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{children:""})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"15-25% ()"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"5-15%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"20-30%"}),i.jsx("td",{children:""})]}),i.jsxs("tr",{children:[i.jsx("td",{children:""}),i.jsx("td",{children:"30-50%"}),i.jsx("td",{children:""})]})]})]})}),i.jsx("h3",{children:""}),i.jsxs("div",{className:"formula",children:[" 18   - 8",i.jsx("br",{}),i.jsx("br",{}),"",i.jsx("br",{})," 2018  (20-8) = 1.5",i.jsx("br",{})," 2418  (24-8) = 1.125",i.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),i.jsxs("footer",{className:"levain-footer",children:[i.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),i.jsx("p",{children:""})]}),i.jsxs("button",{className:"levain-back-button",onClick:n,children:[i.jsx("span",{children:""})," "]})]})),uT=({onBack:n})=>{const{user:t,patchCurrentUserProfile:s}=os(),[l,o]=b.useState([]),[u,d]=b.useState(!0),[h,p]=b.useState(null),[m,y]=b.useState(null),[v,x]=b.useState(""),[S,_]=b.useState(""),[N,j]=b.useState(""),[T,D]=b.useState(""),[M,$]=b.useState(!1),[U,C]=b.useState(!1),[z,R]=b.useState(new Set);b.useEffect(()=>{F()},[]);const F=async()=>{try{d(!0);const k=await Qi.fetchAllProfiles();o(k)}catch(k){console.error(k),p("")}finally{d(!1)}},K=l.filter(k=>k.role==="admin"),G=l.filter(k=>k.role!=="admin"),q=(k,E)=>{R(L=>{const Y=new Set(L);return E?Y.add(k):Y.delete(k),Y})},V=async(k,E)=>{const L=!!k.show_master_recipes;p(null),o(Y=>Y.map(oe=>oe.id===k.id?{...oe,show_master_recipes:E}:oe)),k.id===t?.id&&s?.({showMasterRecipes:E}),q(k.id,!0);try{const oe=!!(await Qi.updateProfile(k.id,{show_master_recipes:E}))?.show_master_recipes;o(ge=>ge.map(B=>B.id===k.id?{...B,show_master_recipes:oe}:B)),k.id===t?.id&&s?.({showMasterRecipes:oe})}catch(Y){console.error(Y),o(oe=>oe.map(ge=>ge.id===k.id?{...ge,show_master_recipes:L}:ge)),k.id===t?.id&&s?.({showMasterRecipes:L}),p("RLS")}finally{q(k.id,!1)}},P=({user:k,isAdmin:E})=>i.jsxs(tn,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[i.jsxs("div",{children:[i.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[k.display_id," ",E&&i.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),k.email&&i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:k.email}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date(k.created_at).toLocaleString()]}),i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",k.updated_at?new Date(k.updated_at).toLocaleString():"---"]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:k.show_master_recipes||!1,disabled:z.has(k.id),onChange:L=>V(k,L.target.checked)}),""]}),i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>{y({id:k.id,display_id:k.display_id,email:k.email}),x(""),_(""),j(""),D("")},style:{whiteSpace:"nowrap"},children:""})]})]},k.id);return i.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",height:"100%",overflowY:"auto"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[i.jsx("h2",{children:""}),i.jsx(le,{variant:"ghost",onClick:n,children:""})]}),h&&i.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:h}),u?i.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[K.length>0&&i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:K.map(k=>i.jsx(P,{user:k,isAdmin:!0},k.id))})]}),i.jsxs("div",{children:[i.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:G.length>0?G.map(k=>i.jsx(P,{user:k,isAdmin:!1},k.id)):i.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),i.jsx(Cn,{isOpen:!!m,onClose:()=>{M||y(null)},title:": ",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[i.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",m?.display_id||m?.email||m?.id]}),m?.email&&i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:m.email}),i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),N&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:N}),T&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:T}),i.jsxs("div",{style:{display:"grid",gap:"10px"},children:[i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:v,onChange:k=>x(k.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),i.jsx("input",{type:"password",value:S,onChange:k=>_(k.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[i.jsx(le,{variant:"ghost",onClick:()=>y(null),disabled:M,children:""}),i.jsx(le,{variant:"secondary",isLoading:U,disabled:!m?.email||M,onClick:async()=>{if(j(""),D(""),!m?.email){j("");return}C(!0);try{await Qi.sendPasswordResetEmail(m.email),D("")}catch(k){console.error(k),j(k?.message||"")}finally{C(!1)}},style:{whiteSpace:"nowrap"},children:""}),i.jsx(le,{variant:"danger",isLoading:M,onClick:async()=>{if(j(""),D(""),!!m?.id){if(!v||v.length<8){j("8");return}if(v!==S){j("");return}$(!0);try{await Qi.adminResetPassword(m.id,v),D(""),x(""),_("")}catch(k){console.error(k);const E=k?.message||"";/FunctionsHttpError|not found|404/i.test(E)||/admin-reset-password/i.test(E)?j(""):j(E)}finally{$(!1)}}},children:""})]})]})})]})},Rs="inventory_items",Pi="inventory_snapshots",io="deleted_inventory_snapshots",Ga=(n,t)=>{const s=String(n?.message||"");return String(n?.code||"")==="42703"?s.toLowerCase().includes(String(t).toLowerCase()):s.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&s.toLowerCase().includes("does not exist")},er={getAll:async n=>{if(!n)return[];const{data:t,error:s}=await Re.from(Rs).select("*").eq("user_id",n).order("created_at",{ascending:!0});return s?(console.error("Error fetching inventory:",s),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:s,isPhantom:l,_master:o,_csv:u,...d}=t,h=t?.tax10_override??t?.tax10Override,p={...d,user_id:n,tax10:!!t.tax10,tax10_override:!!h,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0},m=async x=>Re.from(Rs).insert([x]).select().single();let{data:y,error:v}=await m(p);if(v){const x=Ga(v,"tax10"),S=Ga(v,"tax10_override");if(x||S){const _={...p};x&&delete _.tax10,S&&delete _.tax10_override,{data:y,error:v}=await m(_)}}if(v)throw console.error("Error adding item:",v),v;return y},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:s,isPhantom:l,created_at:o,_master:u,_csv:d,...h}=t,p=t?.tax10_override??t?.tax10Override,m={...h,tax10:!!t.tax10,tax10_override:!!p,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()},y=async S=>Re.from(Rs).update(S).eq("id",t.id).eq("user_id",n).select().single();let{data:v,error:x}=await y(m);if(x){const S=Ga(x,"tax10"),_=Ga(x,"tax10_override");if(S||_){const N={...m};S&&delete N.tax10,_&&delete N.tax10_override,{data:v,error:x}=await y(N)}}if(x)throw console.error("Error updating item:",x),x;return v},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:s}=await Re.from(Rs).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error deleting item:",s),s},adjustStock:async(n,t,s)=>{if(!n)throw new Error("User ID is required");const{data:l,error:o}=await Re.from(Rs).select("quantity").eq("id",t).eq("user_id",n).single();if(o||!l)throw new Error("Item not found");const u=Math.max(0,(l.quantity||0)+s),{data:d,error:h}=await Re.from(Rs).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(h)throw h;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await Re.from(Rs).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:s}=await Re.from("ignored_items").select("name").eq("user_id",n);return s?(console.error("Error fetching ignored items:",s),new Set):new Set(t.map(l=>l.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:s}=await Re.from("ignored_items").insert([{user_id:n,name:t}]).select();if(s&&s.code!=="23505")throw console.error("Error ignoring item:",s),s},getSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await Re.from(Pi).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return s?(console.error("Error fetching snapshots:",s),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:s}=await Re.from(io).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return s?(console.error("Error fetching deleted snapshots:",s),[]):t||[]},createSnapshot:async(n,t,s,l)=>{if(!n)throw new Error("User ID is required");let o=null,u=null;const d=await Re.from(Pi).insert([{user_id:n,title:t,items:s,total_value:l,snapshot_date:new Date().toISOString()}]).select().single();if(o=d.data??null,u=d.error??null,u&&Ga(u,"user_id")){const h=await Re.from(Pi).insert([{title:t,items:s,total_value:l,snapshot_date:new Date().toISOString()}]).select().single();o=h.data??null,u=h.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return o},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:s,error:l}=await Re.from(Pi).select("*").eq("id",t).eq("user_id",n).single();if(l||!s)throw console.error("Error fetching snapshot for delete:",l),l||new Error("Snapshot not found");const{error:o}=await Re.from(io).insert([{original_id:s.id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at,deleted_at:new Date().toISOString()}]);if(o)throw console.error("Error moving snapshot to trash:",o),o;const{error:u}=await Re.from(Pi).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:s,error:l}=await Re.from(io).select("*").eq("id",t).eq("user_id",n).single();if(l||!s)throw console.error("Error fetching deleted snapshot:",l),l||new Error("Deleted snapshot not found");let o=null;{const{error:d}=await Re.from(Pi).insert([{id:s.original_id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);o=d}if(o){const{error:d}=await Re.from(Pi).insert([{user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await Re.from(io).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:s}=await Re.from(io).delete().eq("id",t).eq("user_id",n);if(s)throw console.error("Error hard deleting snapshot from trash:",s),s;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await Re.from(Rs).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(Ga(t.error,"user_id")){const s=await Re.from(Rs).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(s.error)throw console.error("Error resetting quantities (fallback):",s.error),s.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},Vi=n=>{const t=String(n??"").trim();if(!t)return"";const s=t.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s},dT=(n,t)=>{const s=Vi(n),l=Vi(t);if(!s||!l)return null;if(s===l)return 1;if(s==="kg"&&l==="g")return 1e3;if(s==="g"&&l==="kg")return 1/1e3;const o=s==="cc"?"ml":s,u=l==="cc"?"ml":l;return o==="l"&&u==="ml"?1e3:o==="ml"&&u==="l"?1/1e3:null},hT=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},ao=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},fT=({item:n,isLowStock:t,onUpdateQuantity:s,onDelete:l,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const[h,p]=_e.useState(n.quantity===""?"":parseFloat(n.quantity)||0),m=V=>{const P=String(V||"").trim();return P?P==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(P)?P:"":""},y={food:"",alcohol:"",soft_drink:"",supplies:""};_e.useEffect(()=>{p(n.quantity===""?"":parseFloat(n.quantity)||0)},[n.quantity]);const v=parseFloat(n.price)||0,x=(()=>{if(!Number.isFinite(v)||v<=0)return"-";const V=n?._csv?.unit,P=String(V||"").trim(),k=String(n?.unit||"").trim();if(!P)return`${ao(v)}`;const E=Vi(k),L=Vi(P);if(L===E)return`${ao(v)}/${P}`;const Y=dT(L,E);if(Y!==null)return`${ao(v*Y)}/${P}`;const oe=parseFloat(n?._master?.packetSize),ge=String(n?._master?.packetUnit||"").trim(),B=Vi(ge);return hT(P)&&Number.isFinite(oe)&&oe>0&&B===E?`${ao(v*oe)}/${P}`:`${ao(v)}/${k||"-"}`})(),S=m(n?._master?.itemCategory),_=S==="alcohol"||S==="supplies",N=n?.tax10_override===!0||n?.tax10_override===1||n?.tax10_override==="1"||n?.tax10_override==="true",j=S?N?n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true":_:n?.tax10===!0||n?.tax10===1||n?.tax10==="1"||n?.tax10==="true",T=S?N?`${y[S]||S}: ${_?"10%":"8%"}/ `:`${y[S]||S}${j?"10%":"8%"}`:"10%",D=j?1.1:1.08,M=h===""?0:parseFloat(h),$=v*M*D,U=_e.useMemo(()=>{const V=n?._master?.packetSize,P=n?._master?.packetUnit,k=parseFloat(V);return!Number.isFinite(k)||k<=0?"-":`${Number.isInteger(k)?k.toLocaleString():k.toLocaleString(void 0,{maximumFractionDigits:3})}${P?String(P):""}`},[n?._master?.packetSize,n?._master?.packetUnit]),C=()=>{const V=parseFloat(h);!isNaN(V)&&V!==n.quantity&&s(n.id,V)},z=V=>{V&&setTimeout(()=>{try{V.select()}catch{}},0)},R=V=>{const k=V?.closest?.("table")||document;return Array.from(k.querySelectorAll("input.inventory-quantity-input"))},F=(V,P)=>{const k=R(V).filter(Y=>!Y.disabled),E=k.indexOf(V);if(E<0)return!1;const L=k[E+P];return L?(requestAnimationFrame(()=>{try{L.scrollIntoView({block:"nearest"})}catch{}L.focus(),z(L)}),!0):!1},K=V=>{if(V.key==="Enter"){V.preventDefault(),F(V.currentTarget,V.shiftKey?-1:1),V.currentTarget.blur();return}V.key==="Tab"&&F(V.currentTarget,V.shiftKey?-1:1)&&(V.preventDefault(),V.currentTarget.blur())},G=n?._master?.packetUnit||"",q=!!G&&Vi(G)!==Vi(n?.unit);return i.jsxs("tr",{className:t(n)?"low-stock":"",children:[i.jsx("td",{style:{textAlign:"center"},children:i.jsx("input",{type:"checkbox",checked:j,onChange:V=>o&&o(n,V.target.checked),title:T,className:"inventory-tax-checkbox"})}),i.jsxs("td",{children:[n.name,t(n)&&i.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),i.jsx("td",{style:{textAlign:"right"},children:x}),i.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:U}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[i.jsx("input",{type:"text",inputMode:"decimal",value:h,onChange:V=>p(lb(V.target.value)),className:"inventory-quantity-input no-print",onBlur:C,onKeyDown:K,onFocus:V=>z(V.target),onClick:V=>z(V.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),i.jsx("span",{className:"print-only",style:{display:"none"},children:h})]}),i.jsx("td",{children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[i.jsx("span",{children:n.unit}),q&&typeof d=="function"&&i.jsx("button",{type:"button",onClick:()=>d(n),title:`${G}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),i.jsx("td",{style:{textAlign:"right"},children:$>0?`${Math.round($).toLocaleString()}`:"-"}),i.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:n.vendor||"-"}),i.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof u=="function"&&i.jsx("button",{type:"button",onClick:()=>u(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),i.jsx("button",{onClick:()=>l(n),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},pT=({items:n,loading:t,onDelete:s,onUpdateQuantity:l,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:h,isOver:p}=Ho({id:"inventory-list-droppable"}),m=_=>_.threshold>0&&_.quantity<=_.threshold,[y,v]=_e.useState({key:null,direction:"asc"}),x=_=>{v(N=>N.key===_?{key:_,direction:N.direction==="asc"?"desc":"asc"}:{key:_,direction:"asc"})},S=_e.useMemo(()=>{if(!y.key)return n;const _=[...n];return y.key==="vendor"&&_.sort((N,j)=>{const T=(N?.vendor||"").toString(),D=(j?.vendor||"").toString(),M=T.localeCompare(D,"ja");if(M!==0)return y.direction==="asc"?M:-M;const $=(N?.name||"").toString(),U=(j?.name||"").toString(),C=$.localeCompare(U,"ja");return y.direction==="asc"?C:-C}),_},[n,y]);return i.jsxs("div",{ref:h,className:`inventory-list-droppable ${p?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:p?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[i.jsx("div",{className:"inventory-table-container",children:t?i.jsx("p",{children:"Loading..."}):i.jsxs("table",{className:"inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"}),i.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),i.jsx("th",{style:{width:"40px"}})]})}),i.jsxs("tbody",{children:[S.map(_=>i.jsx(fT,{item:_,isLowStock:m,onUpdateQuantity:l,onEdit:u,onDelete:s,onToggleTax:o,onRequestUnitSync:d},_.id)),S.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"9",style:{textAlign:"center",color:"#888",padding:"2rem"},children:p?"":""})})]}),i.jsx("tfoot",{children:(()=>{const _=n.reduce((N,j)=>{const T=parseFloat(j.price)||0,D=j.quantity===""?0:parseFloat(j.quantity)||0,M=j?.tax10===!0||j?.tax10===1||j?.tax10==="1"||j?.tax10==="true"?1.1:1.08,$=T*D;return N.net+=$,N.taxed+=$*M,N},{net:0,taxed:0});return i.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[i.jsx("td",{colSpan:"6",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(_.net).toLocaleString()," / ",Math.round(_.taxed).toLocaleString()]}),i.jsx("td",{colSpan:"2"})]})})()})]})}),p&&i.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},mT=({onBack:n})=>{const{user:t}=os(),s=t?.id,[,l]=Lo(),[o,u]=b.useState([]),[d,h]=b.useState([]),[p,m]=b.useState([]),[y,v]=b.useState([]),[x,S]=b.useState(new Map),[_,N]=b.useState(new Map),[j,T]=b.useState(new Set),[D,M]=b.useState(!0),[$,U]=b.useState(""),[C,z]=b.useState(!1),[R,F]=b.useState(null),[K,G]=b.useState(!1),[q,V]=b.useState(null),[P,k]=b.useState(!1),[E,L]=b.useState(!1),[Y,oe]=b.useState(""),[ge,B]=b.useState(!1),[W,Z]=b.useState(!0),[ye,Me]=b.useState(!1),[xe,ae]=b.useState(null),[O,J]=b.useState("history"),[ce,Se]=b.useState(null),[ke,Be]=b.useState(""),[Le,Ge]=b.useState(!1),[pe,Ye]=b.useState(null),[rt,ft]=b.useState(!0),[St,mt]=b.useState({key:"name",direction:"asc"}),[Dt,Vt]=b.useState(!1),[wt,ie]=b.useState(null),[je,Ce]=b.useState(new Set),[Ue,st]=b.useState(!1),[ct,Rt]=b.useState(null),[Jt,wn]=b.useState(null),[jt,rn]=b.useState(!1),cn=sl(gr(Pu,{activationConstraint:{distance:8}})),[vn,Ln]=b.useState("all"),[ar,me]=b.useState(new Set),[He,Xe]=b.useState(""),[Ve,et]=b.useState(""),[Mt,vt]=b.useState({}),[kt,Ze]=b.useState(""),Bt=({row:I,onVendorClick:X,isSelected:se})=>{const{attributes:be,listeners:Ae,setNodeRef:Oe,setActivatorNodeRef:$e,transform:qe,transition:We,isDragging:nt}=ll({id:I.vendor,data:{type:"summary-row"}}),ut={transform:Tr.Transform.toString(qe),transition:We,opacity:nt?.6:1};return i.jsxs("tr",{ref:Oe,style:ut,...be,className:se?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[i.jsx("td",{className:"inventory-summary__drag",children:i.jsx("span",{ref:$e,...Ae,className:"inventory-summary__drag-handle",title:"",children:""})}),i.jsx("td",{children:i.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>X?.(I.vendor),"aria-expanded":!!se,children:[i.jsx("span",{children:I.vendor}),i.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:se?"":""})]})}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(I.total||0).toLocaleString()]})]})};b.useEffect(()=>{s&&(Ln("all"),U(""),Qe())},[s]);const Qe=async(I=!1)=>{I||M(!0);try{const[X,se,be,Ae,Oe,$e,qe]=await Promise.all([er.getAll(s),nr.getPriceListArray(),er.getIgnoredItems(s),er.getSnapshots(s),er.getDeletedSnapshots(s),Pn.getAllConversions(),Du.getAll(s)]);u(X),v(se),T(be),h(Ae||[]),m(Oe||[]),S($e||new Map),N(qe||new Map);const We=Pe=>{if(!Pe)return-1;const pn=new Date(Pe).getTime();return Number.isFinite(pn)?pn:-1},nt=(Pe,gt)=>{const pn=Math.max(We(Pe?.updated_at),We(Pe?.updatedAt),We(Pe?.created_at),We(Pe?.createdAt)),dn=Math.max(We(gt?.updated_at),We(gt?.updatedAt),We(gt?.created_at),We(gt?.createdAt));return pn!==dn&&dn>pn?gt:Pe},ut=new Map;(X||[]).forEach(Pe=>{const gt=String(Pe?.vendor??"").trim()||"__no_vendor__",pn=nn(Pe?.name)||String(Pe?.name??"").trim();if(!pn)return;const dn=`${gt}@@${pn}`,Fs=ut.get(dn);if(!Fs){ut.set(dn,Pe);return}ut.set(dn,nt(Fs,Pe))});const pt=new Set(Array.from(ut.values()).map(Pe=>Pe.id));me(pt)}catch(X){console.error("Failed to load data:",X)}finally{I||M(!1)}},Ut=I=>{if(!I)return"-";const X=new Date(I);if(Number.isNaN(X.getTime()))return String(I);const se=X.getFullYear(),be=String(X.getMonth()+1).padStart(2,"0"),Ae=String(X.getDate()).padStart(2,"0"),Oe=String(X.getHours()).padStart(2,"0"),$e=String(X.getMinutes()).padStart(2,"0");return`${se}/${be}/${Ae} ${Oe}:${$e}`},Xt=I=>{const X=I?.items;return Array.isArray(X)?X:X?[]:[]},Qt=I=>{const X=I?.snapshot_date||I?.created_at;if(!X)return null;const se=new Date(X);return Number.isNaN(se.getTime())?null:se},ne=_e.useMemo(()=>new Set([""]),[]),te=I=>{const X=String(I??"").trim();return ne.has(X)},he=I=>I===!0||I===1||I==="1"||I==="true",Ee=I=>{const X=String(I??"").trim();if(!X)return"";const se=X.toLowerCase();return se===""?"g":se===""?"ml":se===""?"cc":se===""?"kg":se===""?"l":se},Ie=(I,X)=>{const se=parseFloat(I?.lastPrice),be=parseFloat(I?.packetSize),Ae=Ee(I?.packetUnit),Oe=Ee(X||Ae);if(!Number.isFinite(se)||!Number.isFinite(be)||be<=0||!Ae)return null;const $e=se/be;if(Oe===Ae)return $e;if(Ae==="g"&&Oe==="kg")return $e*1e3;if(Ae==="kg"&&Oe==="g")return $e/1e3;const qe=Ae==="cc"?"ml":Ae,We=Oe==="cc"?"ml":Oe;return qe==="ml"&&We==="l"?$e*1e3:qe==="l"&&We==="ml"?$e/1e3:null},Je=(I,X)=>{const se=Ee(I),be=Ee(X);if(!se||!be)return null;if(se===be)return 1;if(se==="kg"&&be==="g")return 1e3;if(se==="g"&&be==="kg")return 1/1e3;const Ae=se==="cc"?"ml":se,Oe=be==="cc"?"ml":be;return Ae==="l"&&Oe==="ml"?1e3:Ae==="ml"&&Oe==="l"?1/1e3:null},Ke=I=>{const X=String(I||"").trim();return X?X==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(X)?X:"":""},H=I=>{const X=Ke(I);return X==="alcohol"||X==="supplies"},ze=I=>{const X=Ke(I);return X==="food"?"":X==="alcohol"||X==="soft_drink"?"":X==="supplies"?"":""},Fe=I=>{const X=Ke(I);return X==="food"?"food":X==="alcohol"||X==="soft_drink"?"drink":X==="supplies"?"supplies":"unknown"},_t=I=>I==="food"?"":I==="drink"?"":I==="supplies"?"":"",De=I=>he(I?.tax10)?1.1:1.08,dt=I=>I?`${I.getFullYear()}-${String(I.getMonth()+1).padStart(2,"0")}`:"",Ft=I=>{if(!I)return-1;const se=new Date(I).getTime();return Number.isFinite(se)?se:-1},Nn=I=>{const X=[I?.updated_at,I?.updatedAt,I?.created_at,I?.createdAt];for(const se of X){const be=Ft(se);if(be>=0)return be}return-1},Et=_e.useMemo(()=>{const I=new Map;return d.forEach(X=>{const se=Qt(X);if(!se)return;const be=dt(se);I.has(be)||I.set(be,{key:be,year:se.getFullYear(),month:se.getMonth()+1})}),Array.from(I.values()).sort((X,se)=>se.key.localeCompare(X.key)).map(X=>({...X,label:`${X.year}${X.month}`}))},[d]);b.useEffect(()=>{if(Et.length===0){He&&Xe("");return}if(He&&Et.some(se=>se.key===He))return;const I=dt(new Date),X=Et.find(se=>se.key===I)?.key||Et[0].key;Xe(X)},[Et,He]),b.useEffect(()=>{if(Et.length===0){Ve&&et("");return}if(Ve&&Et.some(se=>se.key===Ve))return;const I=dt(new Date),X=Et.find(se=>se.key===I)?.key||Et[0].key;et(X)},[Et,Ve]);const Vn=_e.useMemo(()=>{if(!Ve)return null;const[I,X]=Ve.split("-"),se=parseInt(I,10),be=parseInt(X,10);if(!Number.isFinite(se)||!Number.isFinite(be))return null;const Ae=qe=>String(qe).padStart(2,"0"),Oe=new Date(se,be-1,1),$e=new Date(se,be,0);return{year:se,month:be,start:Oe,end:$e,rangeLabel:`${se}/${Ae(be)}/01${se}/${Ae(be)}/${Ae($e.getDate())}`}},[Ve]),sn=_e.useMemo(()=>Ve?d.map(I=>({snapshot:I,date:Qt(I)})).filter(I=>I.date&&dt(I.date)===Ve).sort((I,X)=>X.date-I.date).map(I=>I.snapshot):d,[d,Ve]),Nt=_e.useMemo(()=>{if(!He)return null;const[I,X]=He.split("-"),se=parseInt(I,10),be=parseInt(X,10);if(!Number.isFinite(se)||!Number.isFinite(be))return null;const Ae=qe=>String(qe).padStart(2,"0"),Oe=new Date(se,be-1,1),$e=new Date(se,be,0);return{year:se,month:be,start:Oe,end:$e,rangeLabel:`${se}/${Ae(be)}/01${se}/${Ae(be)}/${Ae($e.getDate())}`}},[He]),Pr=_e.useMemo(()=>He?d.map(I=>({snapshot:I,date:Qt(I)})).filter(I=>I.date&&dt(I.date)===He).sort((I,X)=>X.date-I.date).map(I=>I.snapshot):[],[d,He]),Kn=Pr[0]||null,yr=He||(Kn?.id?`snapshot:${Kn.id}`:""),qr=_e.useMemo(()=>{const I=new Map;return Pr.forEach(X=>{const se=Qt(X)?.getTime()||-1;Xt(X).forEach((Ae,Oe)=>{const $e=(Ae?.vendor||"").toString().trim();if(te($e))return;const qe=$e||"",We=String(Ae?.name||"").trim();if(!We)return;const nt=`${qe}::${We}`,ut={item:{...Ae,vendor:qe},snapshotMs:se,itemUpdatedMs:Nn(Ae),rowIndex:Oe},pt=I.get(nt);if(!pt){I.set(nt,ut);return}if(ut.snapshotMs!==pt.snapshotMs){ut.snapshotMs>pt.snapshotMs&&I.set(nt,ut);return}if(ut.itemUpdatedMs!==pt.itemUpdatedMs){ut.itemUpdatedMs>pt.itemUpdatedMs&&I.set(nt,ut);return}ut.rowIndex>=pt.rowIndex&&I.set(nt,ut)})}),Array.from(I.values()).map(X=>X.item)},[Pr,te]),ea=_e.useMemo(()=>{const I=new Map;return qr.forEach(X=>{const se=(X?.vendor||"").toString().trim(),be=se||"";if(te(se))return;const Ae=parseFloat(X?.price)||0,Oe=X?.quantity===""?0:parseFloat(X?.quantity)||0,$e=Ae*Oe,qe=$e*De(X),We=I.get(be)||{vendor:be,net:0,taxed:0};We.net+=$e,We.taxed+=qe,I.set(be,We)}),Array.from(I.values()).map(X=>({vendor:X.vendor,net:X.net,taxed:X.taxed,total:X.taxed}))},[qr,te,De]),cs=_e.useMemo(()=>{const I=new Map;return ea.forEach(X=>{I.set(X.vendor,X)}),I},[ea]),ol=_e.useMemo(()=>{const I=new Map;try{for(const[X,se]of(x||new Map).entries()){const be=String(X??"").trim();be&&I.set(be,se)}}catch{}return I},[x]),cl=_e.useCallback(I=>{const X=Ke(I?.itemCategory??I?.item_category);if(X)return X;const se=String(I?.name??"").trim();if(!se)return"";const be=ol.get(se);return Ke(be?.itemCategory??be?.item_category)},[ol]),ta=_e.useMemo(()=>{const I=new Map;qr.forEach((X,se)=>{const be=(X?.vendor||"").toString().trim(),Ae=be||"";if(te(be))return;const Oe=parseFloat(X?.price)||0,$e=X?.quantity===""?0:parseFloat(X?.quantity)||0,qe=Oe*$e,We=qe*De(X),nt=cl(X),ut=Fe(nt),pt=I.get(Ae)||{vendor:Ae,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};pt.totals[ut]+=We,pt.totals.net+=qe,pt.totals.taxed+=We,pt.rows.push({id:X?.id||`${Ae}-${X?.name||"item"}-${se}`,name:X?.name||"",unit:X?.unit||"",quantity:$e,price:Oe,taxed:We,itemCategory:nt,breakdownKey:ut}),I.set(Ae,pt)});for(const X of I.values())X.rows.sort((se,be)=>{const Ae={food:0,drink:1,unknown:2,supplies:3},Oe=Ae[se?.breakdownKey]??2,$e=Ae[be?.breakdownKey]??2;if(Oe!==$e)return Oe-$e;const qe=(se?.name||"").toString(),We=(be?.name||"").toString();return qe.localeCompare(We,"ja")});return I},[qr,te,De,cl]),Is=_e.useMemo(()=>ea.slice().sort((I,X)=>X.taxed!==I.taxed?X.taxed-I.taxed:I.vendor.localeCompare(X.vendor,"ja")).map(I=>I.vendor),[ea]),cr=_e.useMemo(()=>{if(!yr)return Is;const I=Mt[yr],X=new Set(cs.keys()),se=Array.isArray(I)?I.filter(Ae=>X.has(Ae)):[],be=Is.filter(Ae=>!se.includes(Ae));return[...se,...be]},[Mt,yr,Is,cs]),Yn=_e.useMemo(()=>cr.map(I=>cs.get(I)).filter(Boolean),[cr,cs]),ul=Yn.reduce((I,X)=>(I.net+=X.net||0,I.taxed+=X.taxed||0,I),{net:0,taxed:0});b.useEffect(()=>{kt&&(cs.has(kt)||Ze(""))},[kt,cs]);const Qu=I=>{Ze(X=>X===I?"":I)},dl=I=>{I?.id&&s&&(Ge(!1),Ye(null),Be(""),Se({title:"",message:`${I.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Ge(!0),Ye({type:"move",id:I.id});try{await er.deleteSnapshotToTrash(s,I.id),await Qe(!0),Rt({title:"",message:"",type:"success"})}catch(X){console.error(X),Rt({title:"",message:"()",type:"error"})}finally{Ge(!1),Ye(null),Se(null)}}}))},Vo=I=>{I?.id&&s&&(Ge(!1),Ye(null),Be(""),Se({title:"",message:`${I.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Ge(!0),Ye({type:"restore",id:I.id});try{await er.restoreSnapshotFromTrash(s,I.id),await Qe(!0),Rt({title:"",message:"",type:"success"})}catch(X){console.error(X),Rt({title:"",message:"",type:"error"})}finally{Ge(!1),Ye(null),Se(null)}}}))},na=I=>{I?.id&&s&&(Ge(!1),Ye(null),Be(""),Se({title:" ",message:`${I.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Ge(!0),Ye({type:"hard-delete",id:I.id});try{await er.hardDeleteSnapshotFromTrash(s,I.id),await Qe(!0),Rt({title:"",message:"",type:"success"})}catch(X){console.error(X),Rt({title:"",message:"",type:"error"})}finally{Ge(!1),Ye(null),Se(null)}}}))},hl=I=>{if(!I)return;const X=Xt(I).filter(Pe=>!te(Pe?.vendor)),se=["","","","","()",""],be=X.map(Pe=>{const gt=parseFloat(Pe?.price)||0,pn=Pe?.quantity===""?0:parseFloat(Pe?.quantity)||0,dn=Math.round(gt*pn*De(Pe));return[Pe?.name??"",gt||"",Pe?.unit??"",Pe?.quantity??"",dn||"",Pe?.vendor??""]}),Ae=Pe=>{const gt=String(Pe??"");return gt.includes(",")||gt.includes('"')||gt.includes(`
`)||gt.includes("\r")?`"${gt.replace(/"/g,'""')}"`:gt},Oe=[se.map(Ae).join(","),...be.map(Pe=>Pe.map(Ae).join(","))].join(`
`),$e=new Uint8Array([239,187,191]),qe=new Blob([$e,Oe],{type:"text/csv"}),We=URL.createObjectURL(qe),nt=(I.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),ut=(I.snapshot_date?new Date(I.snapshot_date):new Date).toISOString().slice(0,10),pt=document.createElement("a");pt.href=We,pt.download=`InventorySnapshot_${ut}_${nt}.csv`,document.body.appendChild(pt),pt.click(),document.body.removeChild(pt),URL.revokeObjectURL(We)},ur=()=>{if(!Kn)return;const I=["","()"],X=Yn.map(Pe=>[Pe.vendor,Math.round(Pe.total||0)]),se=Pe=>{const gt=String(Pe??"");return gt.includes(",")||gt.includes('"')||gt.includes(`
`)||gt.includes("\r")?`"${gt.replace(/"/g,'""')}"`:gt},be=[I.map(se).join(","),...X.map(Pe=>Pe.map(se).join(","))].join(`
`),Ae=new Uint8Array([239,187,191]),Oe=new Blob([Ae,be],{type:"text/csv"}),$e=URL.createObjectURL(Oe),qe=(Kn.snapshot_date?new Date(Kn.snapshot_date):new Date).toISOString().slice(0,10),We=Kn.title||"inventory_summary",nt=Nt?`${Nt.year}${String(Nt.month).padStart(2,"0")}`:qe,ut=We.toString().replace(/[\\/:*?"<>|]/g,"_"),pt=document.createElement("a");pt.href=$e,pt.download=`InventorySummary_${nt}_${ut}.csv`,document.body.appendChild(pt),pt.click(),document.body.removeChild(pt),URL.revokeObjectURL($e)},fl=I=>{if(!I?.vendor)return;const X=["","","","","","()",""],se=(I.rows||[]).map(Pe=>{const gt=Pe.itemCategory?ze(Pe.itemCategory):_t(Pe.breakdownKey);return[Pe.name||"",gt,Math.round(Pe.price||0),Pe.unit||"",Number(Pe.quantity||0),Math.round(Pe.taxed||0),I.vendor]}),be=Pe=>{const gt=String(Pe??"");return gt.includes(",")||gt.includes('"')||gt.includes(`
`)||gt.includes("\r")?`"${gt.replace(/"/g,'""')}"`:gt},Ae=[X.map(be).join(","),...se.map(Pe=>Pe.map(be).join(","))].join(`
`),Oe=new Uint8Array([239,187,191]),$e=new Blob([Oe,Ae],{type:"text/csv"}),qe=URL.createObjectURL($e),We=(Kn?.snapshot_date?new Date(Kn.snapshot_date):new Date).toISOString().slice(0,10),nt=Nt?`${Nt.year}${String(Nt.month).padStart(2,"0")}`:We,ut=I.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),pt=document.createElement("a");pt.href=qe,pt.download=`InventorySummary_${nt}_${ut}.csv`,document.body.appendChild(pt),pt.click(),document.body.removeChild(pt),URL.revokeObjectURL(qe)},Bs=_e.useMemo(()=>{const I=it=>it?it.toString().trim():"",X=it=>nn(it),se=new Set;try{for(const it of(j||new Set).values()){const lt=X(it);lt&&se.add(lt)}}catch{}const be=new Set;try{for(const it of(je||new Set).values()){const lt=X(it);lt&&be.add(lt)}}catch{}const Ae=new Map;try{for(const[it,lt]of(x||new Map).entries()){const Ct=X(it);Ct&&Ae.set(Ct,lt)}}catch{}const Oe=new Map;try{(y||[]).forEach(it=>{const lt=X(it?.name);lt&&Oe.set(lt,it)})}catch{}const $e=new Map;try{for(const[it,lt]of(_||new Map).entries()){const Ct=X(it);Ct&&$e.set(Ct,lt)}}catch{}const qe=it=>{const lt=String(it??"").trim();if(!lt)return"";const Ct=lt.toLowerCase();return Ct===""?"g":Ct===""?"ml":Ct===""?"cc":Ct===""?"kg":Ct===""?"l":Ct},We=(it,lt)=>{const Ct=parseFloat(it?.lastPrice),hn=parseFloat(it?.packetSize),En=qe(it?.packetUnit),kn=qe(lt||En);if(!Number.isFinite(Ct)||!Number.isFinite(hn)||hn<=0||!En)return null;const $t=Ct/hn;if(kn===En)return $t;if(En==="g"&&kn==="kg")return $t*1e3;if(En==="kg"&&kn==="g")return $t/1e3;const rr=En==="cc"?"ml":En,An=kn==="cc"?"ml":kn;return rr==="ml"&&An==="l"?$t*1e3:rr==="l"&&An==="ml"?$t/1e3:null},nt=it=>{const lt=String(it??"").trim();return lt?["","","","","","","","pc","PC",""].includes(lt):!1},ut=it=>{const lt=X(it?.name),Ct=lt?Ae.get(lt):null,hn=lt?Oe.get(lt):null,En=lt&&$e.has(lt)?String($e.get(lt)||""):String(hn?.unit||""),kn={...it};if(kn.name=I(kn.name),kn.vendor=I(kn.vendor),kn._csv={unit:En,price:hn?.price??null,vendor:I(hn?.vendor)||null,dateStr:hn?.dateStr??null},!Ct)return kn;const $t={...kn},rr=Ke(Ct?.itemCategory),An=Ct.packetUnit||"",ds=parseFloat(Ct.packetSize),es=An?We(Ct,An):null;if($t.isPhantom)An&&es!==null&&($t.unit=An,$t.price=es);else{if(!!An&&Number.isFinite(ds)&&ds>0&&(nt($t.unit)||!$t.unit)&&es!==null){const hs=$t.quantity;if(hs!==""&&hs!==null&&hs!==void 0){const bi=parseFloat(hs);Number.isFinite(bi)&&($t.quantity=bi*ds)}const aa=$t.threshold;if(aa!==""&&aa!==null&&aa!==void 0){const bi=parseFloat(aa);Number.isFinite(bi)&&($t.threshold=bi*ds)}$t.unit=An}else(An&&es!==null||!$t.unit&&An)&&($t.unit=An);if(es!==null&&qe($t.unit)===qe(An))$t.price=es;else{const hs=We(Ct,$t.unit||An);hs!==null&&($t.price=hs)}}const Hs=he($t?.tax10_override??$t?.tax10Override),yl=rr?H(rr):null;return $t._master={packetSize:Ct.packetSize,packetUnit:Ct.packetUnit,lastPrice:Ct.lastPrice,itemCategory:rr||null,tax10Auto:yl,tax10Override:Hs,updatedAt:Ct.updatedAt},rr&&($t.tax10_override=Hs,!Hs&&yl!==null&&($t.tax10=yl)),$t},pt=o.map(ut),Pe=new Map;pt.forEach(it=>{const lt=X(it?.name);lt&&Pe.set(lt,it)});const gt=[...pt];y.forEach((it,lt)=>{const Ct=String(it?.name??""),hn=I(Ct),En=X(Ct);if(En&&!(j.has(Ct)||hn&&j.has(hn)||se.has(En))&&!Pe.has(En)){const kn={id:`phantom-${lt}`,isPhantom:!0,name:hn,quantity:"",unit:it.unit||"",category:"",price:it.price,vendor:I(it.vendor),threshold:0,tax10:!1,tax10_override:!1};gt.push(ut(kn))}});const pn=gt.filter(it=>{const lt=String(it?.name??""),Ct=I(lt),hn=X(lt);return!(j.has(lt)||Ct&&j.has(Ct)||hn&&se.has(hn)||je.has(lt)||Ct&&je.has(Ct)||hn&&be.has(hn)||te(it.vendor))}),dn=it=>{if(!it)return-1;const Ct=new Date(it).getTime();return Number.isFinite(Ct)?Ct:-1},Fs=(it,lt)=>{const Ct=!!it?.isPhantom,hn=!!lt?.isPhantom;if(Ct!==hn)return Ct?lt:it;const En=Math.max(dn(it?.updated_at),dn(it?.updatedAt),dn(it?.created_at),dn(it?.createdAt)),kn=Math.max(dn(lt?.updated_at),dn(lt?.updatedAt),dn(lt?.created_at),dn(lt?.createdAt));if(En!==kn)return kn>En?lt:it;const $t=it?.quantity,rr=lt?.quantity,An=$t===""||$t===null||$t===void 0?null:parseFloat($t),ds=rr===""||rr===null||rr===void 0?null:parseFloat(rr),es=An!==null&&Number.isFinite(An),Hs=ds!==null&&Number.isFinite(ds);return es!==Hs&&Hs?lt:it},Zr=new Map;return pn.forEach(it=>{const lt=X(it?.name)||I(it?.name);if(!lt)return;const hn=`${I(it?.vendor)||"__no_vendor__"}@@${lt}`,En=Zr.get(hn);if(!En){Zr.set(hn,it);return}Zr.set(hn,Fs(En,it))}),Array.from(Zr.values())},[o,y,j,je,x,_,te]),pl=I=>{const{active:X,over:se}=I;if(!se)return;if(X?.data?.current?.type==="summary-row"){if(!yr)return;const Ae=X.id,Oe=se.id;if(!Ae||!Oe||Ae===Oe)return;const $e=cr,qe=$e.indexOf(Ae),We=$e.indexOf(Oe);if(qe<0||We<0)return;const nt=Xi($e,qe,We);vt(ut=>({...ut,[yr]:nt}));return}if(se.id==="inventory-list-droppable"){const Ae=X.data.current.item;if(X.data.current.type==="csv-item"){const Oe=String(Ae?.name??"").trim(),$e=nn(Oe);let qe=null;if(x&&x.size>0&&$e&&(qe=x.get(Oe)||null,!qe)){for(const[pt,Pe]of x.entries())if(nn(pt)===$e){qe=Pe;break}}const We=qe?.packetUnit||Ae.unit,nt=qe?Ie(qe,We):null,ut=nt!==null?nt:qe?.lastPrice!==null&&qe?.lastPrice!==void 0&&qe?.lastPrice!==""?qe.lastPrice:Ae.price;F({name:Ae.name,price:ut,unit:We,category:"",threshold:0,quantity:0,vendor:Ae.vendor,tax10:he(Ae?.tax10),isNewFromCsv:!0}),z(!0)}}},$s=async I=>{if(I.preventDefault(),!s)return;const X=new FormData(I.target),se={name:X.get("name"),quantity:parseFloat(X.get("quantity")),unit:X.get("unit"),category:X.get("category"),threshold:parseFloat(X.get("threshold")),vendor:R.vendor||"",price:R.price||0,tax10:he(R?.tax10)};try{R.id&&!R.isPhantom?await er.update(s,{...R,...se}):await er.add(s,se),z(!1),F(null),Qe()}catch(be){console.error("Failed to save item:",be),Rt({title:"",message:"",type:"error"})}},Ko=I=>{ie(I),Vt(!0)},Yo=I=>{!I||I.isPhantom||!I?._master?.packetUnit||(V(I),G(!0))},us=()=>{P||(G(!1),V(null))},Qo=async({convertQuantity:I})=>{if(!s)return;const X=q;if(!X||X.isPhantom)return;const se=X?._master?.packetUnit;if(!se)return;const be=se,Ae=Ie(X?._master,be);if(Ae===null){Rt({title:"",message:"/",type:"error"});return}let Oe=X.quantity,$e=X.threshold;if(I){const qe=Je(X.unit,be);if(!qe){Rt({title:"",message:"kgg / lml ",type:"error"});return}const We=X.quantity===""?null:parseFloat(X.quantity);We!==null&&Number.isFinite(We)&&(Oe=We*qe);const nt=X.threshold===""?null:parseFloat(X.threshold);nt!==null&&Number.isFinite(nt)&&($e=nt*qe)}k(!0);try{await er.update(s,{id:X.id,unit:be,price:Ae,quantity:Oe===""?0:parseFloat(Oe)||0,threshold:$e===""?0:parseFloat($e)||0,tax10:he(X?.tax10)}),await Qe(!0),G(!1),V(null)}catch(qe){console.error("Failed to sync unit:",qe),Rt({title:"",message:"",type:"error"})}finally{k(!1)}},Wo=async()=>{if(wt)try{const X=(se=>se?se.toString().trim():"")(wt?.name);X&&Ce(se=>{const be=new Set(se);return be.add(X),be}),Vt(!1),ie(null)}catch(I){console.error("Failed to delete/ignore item:",I)}},Jo=async(I,X)=>{try{if(!s)return;const se=Bs.find(be=>be.id===I);if(!se)return;if(se.isPhantom){const be={name:se.name.trim(),quantity:X,unit:se.unit,category:se.category||"",price:se.price,vendor:se.vendor,threshold:0,tax10:he(se?.tax10)},Ae=await er.add(s,be);await Qe(!0),me(Oe=>{const $e=new Set(Oe);return $e.add(Ae.id),$e})}else u(be=>be.map(Ae=>Ae.id!==I?Ae:{...Ae,quantity:X,unit:se.unit??Ae.unit,price:se.price??Ae.price,threshold:se.threshold??Ae.threshold})),me(be=>{const Ae=new Set(be);return Ae.add(I),Ae}),await er.update(s,{...se,quantity:X})}catch(se){console.error(se);const be=se?.message||se?.error_description||(typeof se=="string"?se:null)||(()=>{try{return JSON.stringify(se)}catch{return null}})()||"";Rt({title:"",message:`
${be}`,type:"error"}),Qe()}},ra=async(I,X)=>{try{if(!s||!I)return;const se=!!X;if(I.isPhantom){const be={name:I.name.trim(),quantity:I.quantity===""?0:parseFloat(I.quantity)||0,unit:I.unit,category:I.category||"",price:I.price,vendor:I.vendor,threshold:0,tax10:se,tax10_override:!0};await er.add(s,be),await Qe(!0)}else u(be=>be.map(Ae=>Ae.id===I.id?{...Ae,tax10:se,tax10_override:!0}:Ae)),await er.update(s,{...I,tax10:se,tax10_override:!0})}catch(se){console.error(se);const be=se?.message||se?.error_description||(typeof se=="string"?se:null)||(()=>{try{return JSON.stringify(se)}catch{return null}})()||"";Rt({title:"",message:`
${be}`,type:"error"}),Qe()}},Wu=(I,X)=>{if(X===!0){wn({item:I});return}ra(I,X)},Xo=()=>{jt||wn(null)},sa=async()=>{const I=Jt?.item;if(I){rn(!0);try{await ra(I,!0),wn(null)}finally{rn(!1)}}},Fr=async()=>{if(!ge&&Y&&s){B(!0);try{const I=Bs.filter(se=>!se.isPhantom).map(se=>{const be={...se};return delete be.isPhantom,delete be._master,delete be._csv,be}),X=I.reduce((se,be)=>{const Ae=parseFloat(be.price)||0,Oe=be.quantity===""?0:parseFloat(be.quantity)||0;return se+Ae*Oe*De(be)},0);await er.createSnapshot(s,Y,I,X),W?(await er.resetStockQuantities(s),await Qe(),me(new Set)):await Qe(!0),L(!1),st(!0)}catch(I){console.error("Failed to complete inventory:",I);const X=I?.message||I?.error_description||(typeof I=="string"?I:null)||(()=>{try{return JSON.stringify(I)}catch{return null}})()||"";Rt({title:"",message:`
${X}`,type:"error"})}finally{B(!1)}}},ml=()=>{const I=["","","","","()",""],X=ia.map(We=>{const nt=parseFloat(We.price)||0,ut=We.quantity===""?0:parseFloat(We.quantity)||0,pt=Math.round(nt*ut*De(We));return[We.name,nt,We.unit,We.quantity,pt,We.vendor||""]}),se=[I.join(","),...X.map(We=>We.map(nt=>{const ut=String(nt??"");return ut.includes(",")||ut.includes('"')||ut.includes(`
`)?`"${ut.replace(/"/g,'""')}"`:ut}).join(","))].join(`
`),be=new Uint8Array([239,187,191]),Ae=new Blob([be,se],{type:"text/csv"}),Oe=document.createElement("a"),$e=URL.createObjectURL(Ae),qe=new Date().toISOString().split("T")[0];Oe.href=$e,Oe.download=`Inventory_${qe}.csv`,document.body.appendChild(Oe),Oe.click(),document.body.removeChild(Oe),URL.revokeObjectURL($e)},gl=["","","","","","","","","","","",""],Ps=[...new Set(Bs.map(I=>I.vendor).filter(I=>I&&!te(I)))].sort(),qs=Bs.some(I=>!I.vendor),xi=vn==="summary",ia=Bs.filter(I=>I.name.toLowerCase().includes($.toLowerCase())?vn==="all"||vn==="summary"?!0:vn==="inventory-check"?ar.has(I.id)||!I.isPhantom:vn==="other"?!I.vendor:I.vendor===vn:!1);return C?i.jsxs("div",{className:"inventory-edit-container fade-in",children:[i.jsx("div",{className:"container-header",children:i.jsx("h2",{className:"section-title",children:R&&!R.isNewFromCsv?"":""})}),i.jsx(tn,{className:"edit-form-card",children:i.jsxs("form",{onSubmit:$s,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(zt,{name:"name",defaultValue:R?.name,required:!0,placeholder:": "})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(zt,{name:"quantity",type:"number",step:"0.01",defaultValue:R?.quantity,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(zt,{name:"unit",defaultValue:R?.unit||"g",required:!0,placeholder:"g, ml, ..."})]})]}),i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:""}),i.jsx(zt,{name:"category",defaultValue:R?.category,list:"category-list",placeholder:"",autoComplete:"off"}),i.jsx("datalist",{id:"category-list",children:gl.map(I=>i.jsx("option",{value:I},I))})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:" ()"}),i.jsx(zt,{name:"threshold",type:"number",step:"0.01",defaultValue:R?.threshold||0})]})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx(le,{variant:"ghost",type:"button",onClick:()=>{z(!1),F(null)},children:""}),i.jsx(le,{variant:"primary",type:"submit",children:""})]})]})})]}):i.jsx(Ji,{onDragEnd:pl,sensors:cn,autoScroll:!1,children:i.jsxs("div",{className:"inventory-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsxs("div",{className:"header-actions inventory-header-actions",children:[i.jsx(le,{variant:"ghost",onClick:n,children:" "}),i.jsx(le,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>l({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),i.jsx(le,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const I=new Date;oe(`${I.getFullYear()}${I.getMonth()+1} `),Z(!0),L(!0)},children:" "}),i.jsx(le,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{ae(null),J("history"),Me(!0)},title:"",children:" "}),i.jsx(le,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{F(null),z(!0)},children:"+ "})]})]}),i.jsx("div",{className:"inventory-split-layout",children:i.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[i.jsxs("div",{className:"inventory-controls",children:[xi?i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsx("select",{className:"inventory-controls__select",value:He,onChange:I=>Xe(I.target.value),disabled:Et.length===0,children:Et.length===0?i.jsx("option",{value:"",children:""}):Et.map(I=>i.jsx("option",{value:I.key,children:I.label},I.key))})]}),Nt&&i.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",Nt.rangeLabel]})]}):i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[i.jsxs("div",{className:"inventory-controls__field",children:[i.jsx("label",{className:"inventory-controls__label",children:":"}),i.jsxs("select",{className:"inventory-controls__select",value:vn==="inventory-check"?"":vn,onChange:I=>{I.target.value&&Ln(I.target.value)},children:[i.jsx("option",{value:"all",children:""}),i.jsx("option",{value:"",disabled:!0,children:""}),i.jsxs("optgroup",{label:"",children:[Ps.map(I=>i.jsx("option",{value:I,children:I},I)),qs&&i.jsx("option",{value:"other",children:""})]})]})]}),i.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:$,onChange:I=>U(I.target.value)})]}),i.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[i.jsxs("button",{className:"inventory-controls__btn",onClick:()=>Ln("inventory-check"),"data-active":vn==="inventory-check"?"true":"false",children:["  (",ar.size,")"]}),i.jsx("button",{className:"inventory-controls__btn",onClick:()=>Ln("summary"),"data-active":vn==="summary"?"true":"false",children:" "}),!xi&&i.jsx("button",{className:"inventory-controls__btn",onClick:ml,title:"CSV",children:" CSV (.csv)"}),!xi&&vn==="inventory-check"&&i.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),xi?i.jsxs("div",{className:"inventory-summary",children:[i.jsx("div",{className:"inventory-summary__header",children:i.jsxs("div",{children:[i.jsx("div",{className:"inventory-summary__title",children:""}),Nt&&i.jsxs("div",{className:"inventory-summary__meta",children:[": ",Nt.rangeLabel]}),Kn?i.jsxs("div",{className:"inventory-summary__meta",children:[": ",Kn.title||"","",Ut(Kn.snapshot_date),""]}):i.jsx("div",{className:"inventory-summary__meta",children:""}),Pr.length>1&&i.jsxs("div",{className:"inventory-summary__note",children:[" ",Pr.length," "]})]})}),Kn?i.jsxs("div",{className:"inventory-summary__table-wrap",children:[i.jsx("div",{className:"inventory-summary__actions",children:i.jsx(le,{variant:"secondary",size:"sm",onClick:ur,children:" CSV (.csv)"})}),i.jsxs("table",{className:"inventory-summary__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40px"}}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx(el,{items:cr,strategy:jo,children:i.jsxs("tbody",{children:[Yn.map(I=>{const X=kt===I.vendor,se=ta.get(I.vendor)||null;return i.jsxs(_e.Fragment,{children:[i.jsx(Bt,{row:I,onVendorClick:Qu,isSelected:X}),X&&se&&i.jsxs("tr",{className:"inventory-summary__detail-row",children:[i.jsx("td",{}),i.jsx("td",{colSpan:"2",children:i.jsxs("div",{className:"inventory-summary__inline-detail",children:[i.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[i.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[se.vendor," "]}),i.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>fl(se),disabled:!se.rows||se.rows.length===0,children:" CSV"}),i.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(se.totals.taxed||0).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(be=>i.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:_t(be)}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(se.totals[be]||0).toLocaleString()]})]},be)),se.totals.unknown>0&&i.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[i.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),i.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(se.totals.unknown).toLocaleString()]})]})]}),i.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(se.totals.net||0).toLocaleString()]}),i.jsx("div",{className:"inventory-summary__inline-items-wrap",children:i.jsxs("table",{className:"inventory-summary__inline-items-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),i.jsx("tbody",{children:se.rows.map((be,Ae)=>{const Oe=be.itemCategory?ze(be.itemCategory):_t(be.breakdownKey),$e=Ae>0?se.rows[Ae-1]:null,qe=!!$e&&$e.breakdownKey!==be.breakdownKey;return i.jsxs("tr",{className:qe?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[i.jsx("td",{children:be.name||"-"}),i.jsx("td",{children:Oe}),i.jsxs("td",{style:{textAlign:"right"},children:["",Number(be.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),i.jsxs("td",{style:{textAlign:"right"},children:[Number(be.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),be.unit?` ${be.unit}`:""]}),i.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(be.taxed||0).toLocaleString()]})]},be.id)})})]})})]})})]})]},I.vendor)}),Yn.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),i.jsx("tfoot",{children:i.jsxs("tr",{children:[i.jsx("td",{}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),i.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(ul.net).toLocaleString()," / ",Math.round(ul.taxed).toLocaleString()]})]})})]})]}):i.jsx("div",{className:"inventory-summary__empty",children:""})]}):i.jsx(pT,{items:ia,loading:D,onSearch:U,searchQuery:$,onEdit:I=>{F(I),z(!0)},onDelete:Ko,onUpdateQuantity:Jo,onToggleTax:Wu,onRequestUnitSync:Yo})]})}),i.jsx(Cn,{isOpen:!!Jt,onClose:Xo,title:"10%",size:"small",showCloseButton:!jt,children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",Jt?.item?.name||"","",i.jsx("strong",{children:"10%"}),""]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[i.jsx(le,{variant:"secondary",onClick:Xo,disabled:jt,children:""}),i.jsx(le,{variant:"primary",onClick:sa,disabled:jt,children:jt?"...":""})]})]})}),i.jsx(Cn,{isOpen:E,onClose:()=>{ge||L(!1)},title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),i.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[i.jsx("strong",{children:":"}),i.jsx("br",{}),"1. ",i.jsx("br",{}),"2. ",W?i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:"()0"}),""]}):i.jsxs(i.Fragment,{children:[i.jsx("strong",{children:""}),""]}),i.jsx("br",{}),""]}),i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:W,disabled:ge,onChange:()=>Z(!0)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:"0"}),""]})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[i.jsx("input",{type:"radio",name:"inventory-reset",checked:!W,disabled:ge,onChange:()=>Z(!1)}),i.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",i.jsx("strong",{children:""}),""]})]}),i.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),i.jsxs("div",{style:{marginBottom:"20px"},children:[i.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),i.jsx("input",{type:"text",value:Y,onChange:I=>oe(I.target.value),disabled:ge,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx("button",{onClick:()=>{ge||L(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:ge?"not-allowed":"pointer",opacity:ge?.6:1,fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Fr,disabled:ge,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:ge?"#94a3b8":"#2ecc71",color:"white",cursor:ge?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:ge?"...":W?"":""})]}),ge&&i.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),i.jsxs(Cn,{isOpen:ye,onClose:()=>Me(!1),title:" ",size:"large",children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[i.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:O==="history"?i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:sn.length})," "]}):i.jsxs(i.Fragment,{children:[": ",i.jsx("strong",{children:p.length})," "]})}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",gap:"6px"},children:[i.jsx("button",{type:"button",onClick:()=>J("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:O==="history"?"#111":"#fff",color:O==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),i.jsx("button",{type:"button",onClick:()=>J("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:O==="trash"?"#111":"#fff",color:O==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Qe(!0),title:"",children:" "})]})]}),O==="history"&&i.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),i.jsx("select",{value:Ve,onChange:I=>et(I.target.value),disabled:Et.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:Et.length===0?i.jsx("option",{value:"",children:""}):Et.map(I=>i.jsx("option",{value:I.key,children:I.label},I.key))})]}),Vn&&i.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",Vn.rangeLabel]})]}),O==="history"&&sn.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):O==="trash"&&p.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:O==="trash"?"":""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),i.jsx("tbody",{children:(O==="history"?sn:p).map(I=>{const X=Xt(I).filter(ut=>!te(ut?.vendor)),se=X.length,be=Math.round(X.reduce((ut,pt)=>{const Pe=parseFloat(pt?.price)||0,gt=pt?.quantity===""?0:parseFloat(pt?.quantity)||0;return ut+Pe*gt*De(pt)},0)),Ae=O==="trash"?`trash-${I.id}`:I.id,Oe=Ut(O==="trash"?I.deleted_at:I.snapshot_date),$e=pe?.type==="move"&&pe?.id===I.id,qe=pe?.type==="restore"&&pe?.id===I.id,We=pe?.type==="hard-delete"&&pe?.id===I.id,nt=$e||qe||We;return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Oe}),i.jsx("td",{style:{padding:"10px"},children:I.title||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:se.toLocaleString()}),i.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",be.toLocaleString()]}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:O==="history"?i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>hl(I),disabled:se===0||nt,title:se===0?"items CSV":"CSV",children:" CSV"}),i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>ae(I),disabled:nt,children:""}),i.jsx(le,{variant:"danger",size:"sm",onClick:()=>dl(I),disabled:nt,title:"",children:$e?"...":""})]}):i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>hl(I),disabled:se===0||nt,children:" CSV"}),i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>ae(I),disabled:nt,children:""}),i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Vo(I),disabled:nt,title:"",children:qe?"...":""}),i.jsx(le,{variant:"danger",size:"sm",onClick:()=>na(I),disabled:nt,title:"",children:We?"...":""})]})})]},Ae)})})]})})]}),i.jsx(Cn,{isOpen:!!ce,onClose:()=>{Le||Se(null)},title:ce?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:ce?.message}),ce?.requireText&&i.jsxs("div",{style:{marginTop:"14px"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",i.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:ce.requireText})," "]}),i.jsx("input",{type:"text",value:ke,onChange:I=>Be(I.target.value),placeholder:ce.requireText,disabled:Le,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx(le,{variant:"ghost",disabled:Le,onClick:()=>{Le||Se(null)},children:""}),i.jsx(le,{variant:"danger",disabled:Le||!!ce?.requireText&&ke!==ce.requireText,onClick:()=>ce?.onConfirm&&ce.onConfirm(),children:Le?ce?.loadingLabel||"...":ce?.confirmLabel||""})]})]})}),i.jsx(Cn,{isOpen:!!xe,onClose:()=>ae(null),title:xe?` ${xe.title||""}`:" ",size:"large",children:(()=>{const I=xe;if(!I)return null;const be=[...Xt(I).filter(Oe=>te(Oe?.vendor)?!1:rt?(Oe?.quantity===""?0:parseFloat(Oe?.quantity)||0)!==0:!0)].sort((Oe,$e)=>{const qe=St.direction==="desc"?-1:1;if(St.key==="vendor"){const gt=(Oe?.vendor||"").toString(),pn=($e?.vendor||"").toString(),dn=gt.localeCompare(pn,"ja");if(dn!==0)return dn*qe;const Fs=(Oe?.name||"").toString(),Zr=($e?.name||"").toString();return Fs.localeCompare(Zr,"ja")*qe}const We=(Oe?.name||"").toString(),nt=($e?.name||"").toString(),ut=We.localeCompare(nt,"ja");if(ut!==0)return ut*qe;const pt=(Oe?.vendor||"").toString(),Pe=($e?.vendor||"").toString();return pt.localeCompare(Pe,"ja")*qe}),Ae=be.reduce((Oe,$e)=>{const qe=parseFloat($e?.price)||0,We=$e?.quantity===""?0:parseFloat($e?.quantity)||0,nt=qe*We;return Oe.net+=nt,Oe.taxed+=nt*De($e),Oe},{net:0,taxed:0});return i.jsxs("div",{children:[i.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[i.jsxs("div",{children:[": ",i.jsx("strong",{children:Ut(I.snapshot_date)})]}),i.jsxs("div",{children:[": ",i.jsx("strong",{children:be.length.toLocaleString()})]}),i.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",i.jsxs("strong",{children:["",Math.round(Ae.net).toLocaleString()," / ",Math.round(Ae.taxed).toLocaleString()]})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[i.jsx("input",{type:"checkbox",checked:rt,onChange:Oe=>ft(Oe.target.checked)}),"0"]}),i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>hl(I),children:" CSV (.csv)"})]}),be.length===0?i.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):i.jsx("div",{style:{overflowX:"auto"},children:i.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[i.jsx("thead",{children:i.jsxs("tr",{style:{background:"#f0f0f0"},children:[i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),i.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),i.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{mt(Oe=>Oe.key==="vendor"?{key:"vendor",direction:Oe.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",St.key==="vendor"&&(St.direction==="asc"?"":"")]})]})}),i.jsx("tbody",{children:be.map((Oe,$e)=>{const qe=parseFloat(Oe?.price)||0,We=Oe?.quantity===""?0:parseFloat(Oe?.quantity)||0,nt=Math.round(qe*We*De(Oe)),ut=cl(Oe),pt=ze(ut);return i.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[i.jsxs("td",{style:{padding:"10px"},children:[Oe?.name||"-",he(Oe?.tax10)&&i.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),i.jsx("td",{style:{padding:"10px"},children:pt}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:qe?`${Number(qe).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:Oe?.unit||"-"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:We?We.toLocaleString():"0"}),i.jsx("td",{style:{padding:"10px",textAlign:"right"},children:nt?`${nt.toLocaleString()}`:"-"}),i.jsx("td",{style:{padding:"10px"},children:Oe?.vendor||"-"})]},Oe?.id||`${Oe?.name||"item"}-${$e}`)})})]})})]})})()}),i.jsx(Cn,{isOpen:K,onClose:us,title:"",size:"small",children:(()=>{const I=q,X=I?._master?.packetUnit||"",se=I?.unit||"",be=Je(se,X),Ae=be!==null&&be!==1,Oe=parseFloat(I?.price)||0,$e=I?.quantity===""?0:parseFloat(I?.quantity)||0,qe=I?De(I):1.08,We=Oe*$e*qe,nt=X?Ie(I?._master,X):null,ut=nt===null?null:nt*$e*qe,pt=nt===null||!Ae?null:nt*($e*be)*qe,Pe=pn=>`${Math.round(pn).toLocaleString()}`,gt=pn=>Number.isInteger(pn)?pn.toLocaleString():pn.toLocaleString(void 0,{maximumFractionDigits:3});return i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[i.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:I?.name||"-"}),i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",gt($e)," ",se," /  ",Oe.toLocaleString()," /  ",Pe(We)]}),!!X&&i.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",X]})]}),i.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:i.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",i.jsx("br",{}),""]})}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[i.jsx(le,{variant:"ghost",type:"button",onClick:us,disabled:P,children:""}),i.jsx(le,{variant:"secondary",type:"button",onClick:()=>Qo({convertQuantity:!1}),isLoading:P,disabled:P||!X||nt===null,title:ut===null?"":`:  ${Pe(ut)}`,children:""}),Ae&&i.jsx(le,{variant:"primary",type:"button",onClick:()=>Qo({convertQuantity:!0}),isLoading:P,disabled:P||!X||nt===null,title:pt===null?"":`:  ${Pe(pt)}`,children:""})]})]})})()}),i.jsx(Cn,{isOpen:Dt,onClose:()=>Vt(!1),title:"",size:"small",children:i.jsxs("div",{style:{color:"#333"},children:[i.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",i.jsx("strong",{children:wt?.name}),""]}),i.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",i.jsx("strong",{children:""}),"",i.jsx("br",{}),"CSV"]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx("button",{onClick:()=>Vt(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),i.jsx("button",{onClick:Wo,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),i.jsx(Cn,{isOpen:Ue,onClose:()=>st(!1),title:" ",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[i.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),i.jsxs("h3",{style:{marginBottom:"1rem"},children:[Y," "]}),i.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",i.jsx("br",{}),""]}),i.jsx("button",{onClick:()=>st(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),i.jsx(Cn,{isOpen:!!ct,onClose:()=>Rt(null),title:ct?.title||"",size:"small",children:i.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[ct?.type==="success"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),ct?.type==="error"&&i.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),i.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:ct?.message}),i.jsx("button",{onClick:()=>Rt(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:ct?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},lo="app-data",gT="incoming-deliveries",yT=n=>{const t=String(n||"").trim();return t&&t.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},vT=n=>{const t=String(n),s=t.lastIndexOf(".");return s<=0?t:t.slice(0,s)},xT=async n=>{if(!n)return"";const t=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},ls={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${gT}`},_filePath(n,t){const s=this._folderPath(n),l=String(t||"").replace(/^\/+/,"");return`${s}/${l}`},async listJsonFiles(n=null){const t=n||await this._getCurrentUserId();if(!t)return[];const s=this._folderPath(t),{data:l,error:o}=await Re.storage.from(lo).list(s,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return o?(console.error("Failed to list incoming deliveries:",o),[]):(l||[]).filter(u=>String(u?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=this._filePath(s,n),{data:o,error:u}=await Re.storage.from(lo).download(l);if(u)throw u;const d=await xT(o);return JSON.parse(d)},async saveDeliverySet({pdfFile:n,parsed:t},s=null){const l=s||await this._getCurrentUserId();if(!l)throw new Error("");if(!n)throw new Error("PDF");if(!t)throw new Error("");const o=new Date,u=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}_${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,d=yT(vT(n.name||"delivery")),h=`${u}_${d}`,p=this._filePath(l,`${h}.pdf`),m=this._filePath(l,`${h}.json`),y={...t,_meta:{savedAt:o.toISOString(),originalFileName:n.name||null}},[v,x]=await Promise.all([Re.storage.from(lo).upload(p,n,{upsert:!1,contentType:"application/pdf"}),Re.storage.from(lo).upload(m,new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(v.error)throw v.error;if(x.error)throw x.error;return{baseName:h,pdfPath:p,jsonPath:m}},async deleteDeliverySet(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=String(n||"").trim();if(!l)throw new Error("baseName ");const o=this._filePath(s,`${l}.pdf`),u=this._filePath(s,`${l}.json`),{data:d,error:h}=await Re.storage.from(lo).remove([o,u]);if(h)throw h;return d}},bT="/app/assets/pdf.worker-DU8cYlj-.js",wT=n=>typeof n=="string"&&n.trim().length>0,As=n=>String(n??"").replace(/\u0000/g,"").trim(),fo=n=>{const t=String(n??"").trim();if(!t)return null;const s=t.replace(/[,\s]/g,""),l=Number(s);return Number.isFinite(l)?l:null},oo=n=>{const t=String(n??"").trim();if(!t)return null;const s=t.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return s?s[2]?`${s[1]} ${s[2]}`:s[1]:null},ST=n=>{const t=String(n??"").trim();return!!(!t||t==="/"||t.startsWith("")||t.includes(""))},jT=(n,t)=>{const s=String(n??"").trim(),l=s.match(/^No\.?\s*(\d{3,})\s*$/);if(l?.[1])return{slipNo:l[1],consumeNext:!1};if(/^No\.?\s*$/.test(s)){const o=String(t??"").trim();if(/^\d{3,}$/.test(o))return{slipNo:o,consumeNext:!0}}return null},sp=n=>{const t=String(n??"").trim();return t?!!/^No\.?\s*(\d{3,})?\s*$/.test(t):!1},_T=(n,t)=>{const s=As(n[t]);if(!s||sp(s)||s===""||s===""||s===""||s==="No"||s===""||s===""||s===""||s===""||s===""||s==="")return null;let l=t+1;const o=fo(n[l]);if(o==null)return null;l+=1;const u=fo(n[l]);if(u==null)return null;l+=1;const d=As(n[l]);if(!d)return null;l+=1;let h=null,p=null,m=null;const y=fo(n[l]);for(y!=null?(p=y,l+=1,m=As(n[l]),l+=1):(h=As(n[l])||null,l+=1,p=fo(n[l]),l+=1,m=As(n[l]),l+=1);l<n.length;){const S=As(n[l]);if(S===""||S===""){l+=1;continue}break}let v=null;const x=As(n[l]);return/^\d+$/.test(x)&&(v=parseInt(x,10),l+=1),{item:{no:v,code:null,name:s,unitPrice:o,deliveryQty:u,deliveryUnit:d,spec:h,orderQty:p,orderUnit:m},nextIndex:l}},CT=n=>{const t=(n||[]).map(As).filter(d=>!ST(d)),s={title:t.find(d=>d.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let d=0;d<t.length;d+=1){const h=t[d],p=h.match(/^?\s*(.+)$/);if(p?.[1]&&!s.outputAt){s.outputAt=oo(p[1])||p[1].trim();continue}const m=h.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);m&&!s.rangeFrom&&(s.rangeFrom=m[1],s.rangeTo=m[2])}const l=new Map;let o=null;for(let d=0;d<t.length;d+=1){const h=t[d],p=t[d+1],m=jT(h,p);if(m?.slipNo){const y=m.slipNo;m.consumeNext&&(d+=1);const v=l.get(y);v?o=v:(o={slipNo:y,vendor:null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},l.set(y,o));continue}if(o){if(h===""||h.startsWith("")){const y=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);y?.[1]?o.slipDate=y[1]:oo(p)&&(o.slipDate=oo(p));continue}if(/^(||)/.test(h)&&!h.includes("")&&!h.includes("")&&!h.includes("")){let y=3;(h.startsWith("")||h.startsWith("")||h.startsWith(""))&&(y=4);let v=h.slice(y).trim();if((v.startsWith(":")||v.startsWith(""))&&(v=v.slice(1).trim()),!v)wT(p)&&!o.vendor&&!/^\d+$/.test(p)&&!p.includes("")&&(o.vendor=p.trim());else{const x=v.match(/^(\d+)\s+(.+)$/);x&&(v=x[2].trim()),v&&!o.vendor&&(o.vendor=v)}continue}if(h===""){const y=fo(p);y!=null&&(o.total=y);continue}if(h===""||h.startsWith("")){const y=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);y?.[1]?o.deliveryDate=y[1]:oo(p)&&(o.deliveryDate=oo(p)?.slice(0,10));continue}if(h.startsWith("")){const v=h.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(v&&v!=="No"){o.comment=v;continue}const x=[];for(let _=d+1;_<t.length;_+=1){const N=t[_];if(N){if(sp(N)||N==="No"||N===""||N===""||N===""||N===""||N===""||N===""||N==="")break;x.push(N)}}const S=x.join(" ").trim();S&&S!=="No"&&(o.comment=S);continue}if(h===""||h===""){let y=d+1;for(;y<t.length;){const v=t[y];if(sp(v)||v==="")break;const x=_T(t,y);if(!x){y+=1;continue}o.items.push(x.item),y=x.nextIndex}d=y-1}}}const u=Array.from(l.values()).sort((d,h)=>String(d.slipNo).localeCompare(String(h.slipNo),"ja"));return{report:s,slips:u}},Dx=async n=>{if(!n)throw new Error("PDF");const t=await n.arrayBuffer(),s=await bu(()=>import("./pdf-DFnRBpll.js").then(h=>h.p),[]),l=s?.default&&s.default.getDocument?s.default:s;if(!l?.getDocument)throw new Error("PDF");l?.GlobalWorkerOptions&&(l.GlobalWorkerOptions.workerSrc=bT);const o=await l.getDocument({data:new Uint8Array(t)}).promise,u=[];for(let h=1;h<=o.numPages;h+=1){const m=await(await o.getPage(h)).getTextContent();for(const y of m.items||[]){const v=As(y?.str);v&&u.push(v)}}const d=CT(u);if(!d?.slips||d.slips.length===0)throw new Error("PDFPDF");return d},Mf=n=>String(n||"").replace(/\.json$/i,""),Mx=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const s=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${s}/${l}/${o} ${u}:${d}`},NT=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},ET=n=>String(n||"").trim(),TT=({onBack:n})=>{const[t,s]=Lo(),[l,o]=_e.useState(!0),[u,d]=_e.useState([]),[h,p]=_e.useState(null),[m,y]=_e.useState(!1),[v,x]=_e.useState(!1),[S,_]=_e.useState(null),[N,j]=_e.useState(!1),[T,D]=_e.useState(""),[M,$]=_e.useState(null),[U,C]=_e.useState(!1),[z,R]=_e.useState(null),[F,K]=_e.useState(!1),[G,q]=_e.useState(!1),[V,P]=_e.useState(null),k=_e.useCallback(async()=>{o(!0),D("");try{const ae=await ls.listJsonFiles();d(ae||[])}catch(ae){console.error(ae),D(""),d([])}finally{o(!1)}},[]);_e.useEffect(()=>{k()},[k]);const E=ae=>{ae.preventDefault(),y(!0)},L=ae=>{ae.preventDefault(),y(!1)},Y=ae=>{ae.preventDefault(),y(!1);const O=ae.dataTransfer.files?.[0];O&&O.type==="application/pdf"?(p(O),_(null),P(null),D(""),oe(O)):O&&D("PDF")},oe=async ae=>{if(ae){D(""),x(!0),_(null),P(null);try{const O=await Dx(ae);_(O||null)}catch(O){console.error(O),D(`PDF:
${O?.message||String(O)}`)}finally{x(!1)}}},ge=async()=>{if(h){D(""),x(!0),_(null),P(null);try{const ae=await Dx(h);_(ae||null)}catch(ae){console.error(ae),D(`PDF:
${ae?.message||String(ae)}`)}finally{x(!1)}}},B=async()=>{if(!(!h||!S)){D(""),j(!0);try{await ls.saveDeliverySet({pdfFile:h,parsed:S}),p(null),_(null),await k()}catch(ae){console.error(ae),D(`: ${ae?.message||String(ae)}`)}finally{j(!1)}}},W=async ae=>{const O=Mf(ae);C(!0),D("");try{const J=await ls.downloadJson(ae);$({baseName:O,data:J})}catch(J){console.error(J),D(`: ${J?.message||String(J)}`)}finally{C(!1)}},Z=async()=>{if(z?.baseName){K(!0),D("");try{await ls.deleteDeliverySet(z.baseName),R(null),await k()}catch(ae){console.error(ae),D(`: ${ae?.message||String(ae)}`)}finally{K(!1)}}},ye=ae=>{const O=new Map,J=(Se,ke)=>{const Be=String(Se?.name||"").trim();if(!Be)return;const Le=ET(Se?.deliveryUnit||Se?.unit||Se?.unitName||""),Ge=NT(Se?.deliveryQty??Se?.quantity??Se?.qty);if(!Number.isFinite(Ge)||Ge===null)return;const pe=String(ke||"").trim(),Ye=`${pe}@@${nn(Be)}@@${Le||""}`,rt=O.get(Ye);rt?rt.qty+=Ge:O.set(Ye,{vendor:pe,name:Be,unit:Le,qty:Ge})};return(ae?.slips||ae?.receipts||[]).forEach(Se=>{const ke=Se?.vendor||"";(Se?.items||[]).forEach(Le=>J(Le,ke))}),Array.from(O.values()).sort((Se,ke)=>Se.vendor!==ke.vendor?Se.vendor.localeCompare(ke.vendor,"ja"):Se.name!==ke.name?Se.name.localeCompare(ke.name,"ja"):String(Se.unit||"").localeCompare(String(ke.unit||""),"ja"))},Me=async()=>{q(!0),D(""),P(null);try{const ae=await ls.listJsonFiles();if(!ae||ae.length===0){P([]);return}const O=[];for(const Se of ae){const ke=Se?.name;if(ke)try{const Be=await ls.downloadJson(ke);O.push(Be)}catch(Be){console.warn("Failed to download:",ke,Be)}}const J=new Map;O.forEach(Se=>{ye(Se).forEach(Be=>{const Le=`${Be.vendor}@@${nn(Be.name)}@@${Be.unit||""}`,Ge=J.get(Le);Ge?Ge.qty+=Be.qty:J.set(Le,{...Be})})});const ce=Array.from(J.values()).sort((Se,ke)=>Se.vendor!==ke.vendor?Se.vendor.localeCompare(ke.vendor,"ja"):Se.name!==ke.name?Se.name.localeCompare(ke.name,"ja"):String(Se.unit||"").localeCompare(String(ke.unit||""),"ja"));P(ce)}catch(ae){console.error(ae),D(`: ${ae?.message||String(ae)}`)}finally{q(!1)}},xe=S?.slips||S?.receipts||[];return i.jsxs("div",{className:"incoming-deliveries",children:[i.jsxs("div",{className:"incoming-deliveries__header",children:[i.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsx(le,{variant:"secondary",onClick:()=>s({view:"incoming-stock"}),children:" "}),i.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),T&&i.jsx(tn,{className:"incoming-deliveries__error",children:T}),i.jsxs(tn,{className:"incoming-deliveries__card",children:[i.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",cE]}),i.jsxs("div",{className:"incoming-deliveries__upload",children:[i.jsxs("div",{className:`incoming-deliveries__upload-zone ${m?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:E,onDragLeave:L,onDrop:Y,children:[i.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:m?"var(--color-primary)":"inherit"},children:m?"":"PDF"}),i.jsx("input",{type:"file",accept:"application/pdf",onChange:ae=>{const O=ae.target.files?.[0]||null;p(O),_(null),P(null),D("")},style:{width:"100%"}})]}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[i.jsx(le,{variant:"secondary",onClick:ge,disabled:!h||v||N,children:v?"":""}),i.jsx(le,{variant:"primary",onClick:B,disabled:!h||!S||N||v,children:N?"":""})]})]}),S&&i.jsxs("div",{className:"incoming-deliveries__preview",children:[i.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",i.jsx("strong",{children:S?.report?.outputAt||S?.report?.outputDate||"-"})]}),i.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",i.jsx("strong",{children:xe.length})]}),xe.slice(0,3).map((ae,O)=>i.jsxs("div",{className:"incoming-deliveries__slip",children:[i.jsxs("div",{className:"incoming-deliveries__slip-head",children:[i.jsx("div",{style:{fontWeight:700},children:ae?.vendor||""}),i.jsxs("div",{style:{opacity:.85},children:["No: ",ae?.slipNo||"-"," / : ",ae?.deliveryDate||"-"]})]}),i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"52%"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%"},children:""})]})}),i.jsx("tbody",{children:(ae?.items||[]).slice(0,6).map((J,ce)=>i.jsxs("tr",{children:[i.jsx("td",{children:J?.name||"-"}),i.jsx("td",{style:{textAlign:"right"},children:J?.unitPrice!=null?`${Math.round(J.unitPrice).toLocaleString()}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:J?.deliveryQty!=null?J.deliveryQty:"-"}),i.jsx("td",{children:J?.deliveryUnit||"-"})]},`${J?.no||ce}`))})]}),(ae?.items||[]).length>6&&i.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(ae?.items||[]).length-6)," "]})]},`${ae?.slipNo||ae?.id||O}`)),xe.length>3&&i.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),i.jsxs(tn,{className:"incoming-deliveries__card",children:[i.jsxs("div",{className:"incoming-deliveries__list-head",children:[i.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsx(le,{variant:"secondary",onClick:k,disabled:l||G,children:""}),i.jsx(le,{variant:"secondary",onClick:Me,disabled:l||G,children:G?"":""})]})]}),l?i.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):u.length===0?i.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):i.jsx("div",{className:"incoming-deliveries__file-list",children:u.map(ae=>i.jsxs("div",{className:"incoming-deliveries__file-row",children:[i.jsxs("div",{className:"incoming-deliveries__file-info",children:[i.jsx("div",{style:{fontWeight:700},children:Mf(ae.name)}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",Mx(ae.updated_at||ae.created_at)]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>W(ae.name),disabled:U||F,children:U?"":""}),i.jsx(le,{variant:"ghost",size:"sm",onClick:()=>R({baseName:Mf(ae.name)}),disabled:F,children:""})]})]},ae.name))}),V&&i.jsxs("div",{className:"incoming-deliveries__aggregate",children:[i.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),V.length===0?i.jsx("div",{style:{opacity:.85},children:""}):i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{children:"/"}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{children:""})]})}),i.jsx("tbody",{children:V.slice(0,60).map(ae=>i.jsxs("tr",{children:[i.jsx("td",{children:ae.vendor||"-"}),i.jsx("td",{children:ae.name}),i.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(ae.qty)?ae.qty:"-"}),i.jsx("td",{children:ae.unit||"-"})]},`${ae.vendor}@@${ae.name}@@${ae.unit||""}`))})]}),V.length>60&&i.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),i.jsx(Cn,{isOpen:!!M,onClose:()=>$(null),title:"PDF ",size:"large",children:M?.data?i.jsxs("div",{children:[i.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",Mx(M.data?._meta?.savedAt),M.data?._meta?.originalFileName?` / : ${M.data._meta.originalFileName}`:""]}),(M.data?.slips||M.data?.receipts||[]).map((ae,O)=>i.jsxs("div",{style:{marginBottom:"16px"},children:[i.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[ae?.vendor||"","No: ",ae?.slipNo||"-"," / : ",ae?.deliveryDate||"-",""]}),i.jsxs("table",{className:"incoming-deliveries__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"52%"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"16%"},children:""})]})}),i.jsx("tbody",{children:(ae?.items||[]).map((J,ce)=>i.jsxs("tr",{children:[i.jsx("td",{children:J?.name||"-"}),i.jsx("td",{style:{textAlign:"right"},children:J?.unitPrice!=null?`${Math.round(J.unitPrice).toLocaleString()}`:"-"}),i.jsx("td",{style:{textAlign:"right"},children:J?.deliveryQty!=null?J.deliveryQty:"-"}),i.jsx("td",{children:J?.deliveryUnit||"-"})]},`${J?.no||ce}`))})]})]},`${ae?.slipNo||O}`))]}):i.jsx("div",{style:{opacity:.8},children:""})}),i.jsx(Cn,{isOpen:!!z,onClose:()=>R(null),title:"",size:"small",children:i.jsxs("div",{style:{lineHeight:1.6},children:[i.jsxs("p",{style:{marginTop:0},children:["",z?.baseName,""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx(le,{variant:"ghost",onClick:()=>R(null),disabled:F,children:""}),i.jsx(le,{variant:"danger",onClick:Z,disabled:F,children:F?"":""})]})]})})]})},fi="app-data",RT="incoming-stock",kT="stock.json",AT="applied",OT=async n=>{if(!n)return"";const t=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},Wi=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},Ao=n=>String(n||"").trim(),Oo=(n,t,s)=>`${String(s||"").trim()}@@${nn(n)}@@${Ao(t)}`,fb=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===404)return!0;const l=String(n?.message||"").toLowerCase();return l.includes("not found")||l.includes("object not found")},DT=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===409)return!0;const l=String(n?.message||"").toLowerCase();return l.includes("already exists")||l.includes("duplicate")||l.includes("409")},MT=async n=>{if(!n||typeof n!="object")return null;const t=typeof n.clone=="function"?n.clone():n;if(!t||typeof t.json!="function")return null;try{return await t.json()}catch{return null}},zT=async n=>{if(fb(n))return!0;const t=n?.originalError,s=typeof t?.status=="number"?t.status:null;if(s===404)return!0;if(s===400){const l=await MT(t),o=l?.statusCode??null,u=typeof o=="string"?parseInt(o,10):o,d=String(l?.error||"").toLowerCase(),h=String(l?.message||"").toLowerCase();if(u===404&&(d==="not_found"||h.includes("object not found")))return!0}return!1},UT=n=>{const t=new Map;return(n?.slips||n?.receipts||[]).forEach(l=>{const o=String(l?.vendor||"").trim();(l?.items||[]).forEach(u=>{const d=String(u?.name||"").trim();if(!d)return;const h=Ao(u?.deliveryUnit||u?.unit||u?.unitName||""),p=Wi(u?.deliveryQty??u?.quantity??u?.qty);if(p==null)return;const m=Oo(d,h,o),y=t.get(m);y?y.quantity+=p:t.set(m,{vendor:o,name:d,unit:h,quantity:p})})}),Array.from(t.values()).filter(l=>Number.isFinite(l.quantity))},LT=(n,t,s)=>{const l=new Map;return(n||[]).forEach(o=>{const u=String(o?.name||"").trim();if(!u)return;const d=Ao(o?.unit||""),h=String(o?.vendor||"").trim(),p=Wi(o?.quantity)??0;l.set(Oo(u,d,h),{vendor:h,name:u,unit:d,quantity:p,updatedAt:o?.updatedAt||null})}),t.forEach(o=>{const u=Oo(o.name,o.unit,o.vendor),d=l.get(u);d?(d.quantity=Math.max(0,(Wi(d.quantity)??0)+(Wi(o.quantity)??0)),d.updatedAt=s):l.set(u,{vendor:o.vendor,name:o.name,unit:Ao(o.unit),quantity:Math.max(0,Wi(o.quantity)??0),updatedAt:s})}),Array.from(l.values()).sort((o,u)=>o.vendor!==u.vendor?o.vendor.localeCompare(u.vendor,"ja"):o.name!==u.name?o.name.localeCompare(u.name,"ja"):String(o.unit||"").localeCompare(String(u.unit||""),"ja"))},qi={async _getCurrentUserId(){const{data:n,error:t}=await Re.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${RT}`},_stockPath(n){return`${this._folderPath(n)}/${kT}`},_appliedFolder(n){return`${this._folderPath(n)}/${AT}`},_appliedMarkerPath(n,t){const s=this._appliedFolder(n),l=String(t||"").trim();if(!l)throw new Error("baseName is required");return`${s}/${l}.json`},async listAppliedBaseNames(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Set;const s=this._appliedFolder(t),{data:l,error:o}=await Re.storage.from(fi).list(s,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(o)return fb(o)?new Set:(console.error("Failed to list applied markers:",o),new Set);const u=new Set;return(l||[]).forEach(d=>{const h=String(d?.name||"");h.toLowerCase().endsWith(".json")&&u.add(h.replace(/\.json$/i,""))}),u},async loadStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const s=this._stockPath(t),{data:l,error:o}=await Re.storage.from(fi).download(s);if(o){if(await zT(o))return{_meta:{version:1,updatedAt:null},items:[]};throw o}const u=await OT(l),d=JSON.parse(u||"{}"),h=Array.isArray(d?.items)?d.items:[];return{_meta:{version:1,updatedAt:d?._meta?.updatedAt||null},items:h}},async saveStock(n,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const l=this._stockPath(s),o={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(n?.items)?n.items:[]},{error:u}=await Re.storage.from(fi).upload(l,new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(u)throw u;return o},async applyDeliverySet({baseName:n,parsed:t},s=null){const l=s||await this._getCurrentUserId();if(!l)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("baseName ");if(!t)throw new Error("");const u=UT(t),d=new Date().toISOString(),h=this._appliedMarkerPath(l,o),p={baseName:o,appliedAt:d,slipCount:(t?.slips||t?.receipts||[]).length||0,itemCount:u.length},m=await Re.storage.from(fi).upload(h,new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(m.error){if(DT(m.error))return{status:"already_applied"};throw m.error}try{const y=await this.loadStock(l),v=LT(y.items||[],u,d);return await this.saveStock({items:v},l),{status:"applied",addedCount:u.length}}catch(y){try{await Re.storage.from(fi).remove([h])}catch{}throw y}},async updateStockItem({name:n,unit:t,vendor:s,delta:l},o=null){const u=o||await this._getCurrentUserId();if(!u)throw new Error("");const d=String(n||"").trim();if(!d)throw new Error("");const h=Ao(t),p=String(s||"").trim(),m=Oo(d,h,p),y=Wi(l);if(y===null||!Number.isFinite(y))throw new Error("");const x=(await this.loadStock(u)).items||[],S=new Date().toISOString();let _=!1;const N=x.map(j=>{if(Oo(j.name,j.unit,j.vendor)===m){_=!0;const D=Math.max(0,(Wi(j.quantity)??0)+y);return{...j,quantity:D,updatedAt:S}}return j});if(!_)throw new Error("");return await this.saveStock({items:N},u),{status:"updated",name:d,unit:h}},async clearStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const s=this._stockPath(t),l={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await Re.storage.from(fi).upload(s,new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const o=this._appliedFolder(t),{data:u}=await Re.storage.from(fi).list(o,{limit:1e3});if(u?.length){const d=u.map(h=>`${o}/${h.name}`);await Re.storage.from(fi).remove(d)}return{status:"cleared"}}},zf=n=>String(n||"").replace(/\.json$/i,""),IT=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const s=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${s}/${l}/${o} ${u}:${d}`},BT=({onBack:n})=>{const[t,s]=Lo(),[l,o]=_e.useState(!0),[u,d]=_e.useState(""),[h,p]=_e.useState([]),[m,y]=_e.useState(new Set),[v,x]=_e.useState({items:[]}),[S,_]=_e.useState(null),[N,j]=_e.useState("need_order"),[T,D]=_e.useState(!1),[M,$]=_e.useState(null),[U,C]=_e.useState(""),[z,R]=_e.useState(!1),F=_e.useCallback(async()=>{o(!0),d("");try{const[k,E,L]=await Promise.all([ls.listJsonFiles(),qi.listAppliedBaseNames(),qi.loadStock()]);p(k||[]),y(E||new Set),x(L||{items:[]})}catch(k){console.error(k),d(k?.message||String(k))}finally{o(!1)}},[]);_e.useEffect(()=>{F()},[F]);const K=async k=>{const E=zf(k);_(E),d("");try{const L=await ls.downloadJson(k);(await qi.applyDeliverySet({baseName:E,parsed:L}))?.status==="already_applied"&&d("PDF"),await F()}catch(L){console.error(L),d(L?.message||String(L))}finally{_(null)}},G=async()=>{_("all"),d("");try{const k=await ls.listJsonFiles(),E=await qi.listAppliedBaseNames();for(const L of k||[]){const Y=L?.name;if(!Y)continue;const oe=zf(Y);if(E.has(oe))continue;const ge=await ls.downloadJson(Y);(await qi.applyDeliverySet({baseName:oe,parsed:ge}))?.status==="applied"&&E.add(oe)}await F()}catch(k){console.error(k),d(k?.message||String(k))}finally{_(null)}},q=k=>{$(k),C(""),D(!0),d("")},V=k=>{C(E=>{const Y=(parseFloat(E)||0)+k;return String(Math.round(Y*100)/100)})},P=async()=>{if(!M)return;const k=Number(U);if(!U||isNaN(k)||k<=0){d("");return}R(!0),d("");try{await qi.updateStockItem({name:M.name,unit:M.unit,vendor:M.vendor,delta:-k}),x(E=>({...E,items:(E.items||[]).map(L=>{if(L.name===M.name&&(L.unit||"")===(M.unit||"")&&(L.vendor||"")===(M.vendor||"")){const oe=Math.max(0,(L.quantity||0)-k);return{...L,quantity:Math.round(oe*1e3)/1e3}}return L})})),D(!1),$(null)}catch(E){console.error(E),d(E?.message||String(E))}finally{R(!1)}};return i.jsxs("div",{className:"incoming-stock",children:[i.jsxs("div",{className:"incoming-stock__header",children:[i.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx(le,{variant:"secondary",onClick:()=>s({view:"incoming-deliveries"}),children:" PDF"}),i.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),u&&i.jsx(tn,{className:"incoming-stock__error",children:u}),i.jsxs(tn,{className:"incoming-stock__card",children:[i.jsxs("div",{className:"incoming-stock__card-head",children:[i.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),i.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[i.jsx(le,{variant:"secondary",onClick:F,disabled:l||!!S,children:""}),i.jsx(le,{variant:"primary",onClick:G,disabled:l||!!S,children:S==="all"?"":""}),i.jsx(le,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:async()=>{if(window.confirm(`
PDF`)){_("clearing"),d("");try{await qi.clearStock(),await F()}catch(k){console.error(k),d(": "+(k.message||String(k)))}finally{_(null)}}},disabled:l||!!S||!v?.items?.length,children:" "})]})]}),l?i.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):h.length===0?i.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):i.jsx("div",{className:"incoming-stock__file-list",children:h.map(k=>{const E=zf(k?.name),L=m.has(E);return i.jsxs("div",{className:"incoming-stock__file-row",children:[i.jsxs("div",{className:"incoming-stock__file-info",children:[i.jsx("div",{style:{fontWeight:700},children:E}),i.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",IT(k.updated_at||k.created_at)]})]}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[L?i.jsx("span",{className:"incoming-stock__badge",children:""}):i.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),i.jsx(le,{variant:L?"secondary":"primary",size:"sm",onClick:()=>K(k.name),disabled:!!S||L,children:S===E?"":L?"":""})]})]},k.name)})}),!l&&i.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",i.jsx("strong",{children:m.size}),"  / PDF: ",i.jsx("strong",{children:h.length})," "]})]}),i.jsxs(tn,{className:"incoming-stock__card",children:[i.jsx("div",{className:"incoming-stock__card-head",children:i.jsx("h3",{className:"incoming-stock__section-title",children:""})}),i.jsxs("div",{className:"incoming-stock__tabs",children:[i.jsxs("button",{className:`incoming-stock__tab-button ${N==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>j("need_order"),children:[" ",i.jsx("span",{className:"incoming-stock__tab-count",children:(v?.items||[]).filter(k=>(k.quantity||0)<=0).length})]}),Array.from(new Set((v?.items||[]).map(k=>k.vendor||""))).sort().map(k=>i.jsx("button",{className:`incoming-stock__tab-button ${N===k?"incoming-stock__tab-button--active":""}`,onClick:()=>j(k),children:k},k))]}),(()=>{let k=[];if(N==="need_order")k=(v?.items||[]).filter(E=>(E.quantity||0)<=0);else{const E=N===""?"":N;k=(v?.items||[]).filter(L=>(L.vendor||"")===E)}return k.length===0?i.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:N==="need_order"?"0":""}):i.jsx("div",{className:"incoming-stock__table-wrap",children:i.jsxs("table",{className:"incoming-stock__table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"50%"},children:"/"}),i.jsx("th",{style:{width:"20%",textAlign:"right"},children:""}),i.jsx("th",{style:{width:"10%"},children:""}),i.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),i.jsx("tbody",{children:k.map(E=>i.jsxs("tr",{children:[i.jsxs("td",{children:[i.jsx("div",{style:{fontWeight:500},children:E.name}),N==="need_order"&&E.vendor&&i.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:E.vendor})]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(E.quantity||0)<=0?"#ef4444":"inherit"},children:Number.isFinite(E.quantity)?E.quantity:"-"}),i.jsx("td",{children:E.unit||"-"}),i.jsx("td",{style:{textAlign:"center"},children:i.jsx(le,{variant:"secondary",size:"sm",onClick:()=>q(E),children:"/"})})]},`${E.vendor}@@${E.name}@@${E.unit||""}`))})]})})})()]}),i.jsx(Cn,{isOpen:T,onClose:()=>D(!1),title:"",children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsx("div",{style:{fontWeight:"bold"},children:M?.name})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsxs("div",{children:[M?.quantity," ",M?.unit]})]}),i.jsxs("div",{children:[i.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i.jsx(zt,{type:"number",value:U,onChange:k=>C(k.target.value),placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px"},autoFocus:!0}),i.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:M?.unit})]}),i.jsxs("div",{className:"incoming-stock__calc-grid",children:[i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(.1),children:"+0.1"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(.5),children:"+0.5"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(1),children:"+1"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(5),children:"+5"}),i.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(10),children:"+10"}),i.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>C(""),children:""})]})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[i.jsx(le,{variant:"ghost",onClick:()=>D(!1),disabled:z,children:""}),i.jsx(le,{variant:"primary",onClick:P,disabled:z||!U,children:z?"":""})]})]})})]})},pb=n=>`planner_data_${n}`,co=n=>{try{if(!n)return{};let t=localStorage.getItem(pb(n));return t?JSON.parse(t):{}}catch{return{}}},pu=(n,t)=>{n&&localStorage.setItem(pb(n),JSON.stringify(t))},Qa={getAll:async n=>co(n),cleanupInvalidPlans:async(n,t)=>{const s=co(n);let l=!1;const o=new Set(t);return Object.keys(s).forEach(u=>{const d=s[u].length;s[u]=s[u].filter(h=>o.has(h.recipeId)),s[u].length!==d&&(l=!0),s[u].length===0&&(delete s[u],l=!0)}),l&&pu(n,s),s},addMeal:async(n,t,s,l)=>{const o=co(n);o[t]||(o[t]=[]);const u={id:Date.now().toString(),recipeId:s,type:l,note:""};return o[t].push(u),pu(n,o),u},removeMeal:async(n,t,s)=>{const l=co(n);l[t]&&(l[t]=l[t].filter(o=>o.id!==s),l[t].length===0&&delete l[t],pu(n,l))},updateMeal:async(n,t,s,l)=>{const o=co(n);if(o[t]){const u=o[t].findIndex(d=>d.id===s);u!==-1&&(o[t][u]={...o[t][u],...l},pu(n,o))}}},$T=({recipe:n})=>{const{attributes:t,listeners:s,setNodeRef:l,transform:o}=yp({id:`recipe-${n.id}`,data:{recipe:n}}),u=o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:l,style:u,...s,...t,className:"draggable-recipe",children:n.title})},PT=({meal:n,dateStr:t,children:s})=>{const{attributes:l,listeners:o,setNodeRef:u,transform:d}=yp({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),h=d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0;return i.jsx("div",{ref:u,style:h,...o,...l,className:"draggable-meal-wrapper",children:s})},qT=({dateStr:n,dayNum:t,isToday:s,isOutside:l,children:o})=>{const{setNodeRef:u,isOver:d}=Ho({id:`date-${n}`,data:{dateStr:n}});return i.jsxs("div",{ref:u,className:`calendar-cell ${s?"today":""} ${l?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[i.jsx("div",{className:"day-number",children:t}),o]})},FT=({onBack:n,onSelectRecipe:t})=>{const{user:s}=os(),l=Zi(),[o,u]=b.useState([]),[d,h]=b.useState({}),[p,m]=b.useState(new Date),[y,v]=b.useState(""),[x,S]=b.useState(!1),[_,N]=b.useState(null),j=sl(gr(Pu,{activationConstraint:{distance:8}})),T=b.useCallback(async()=>{const K=await xn.fetchRecipes(s);if(u(K),s?.id){const G=K.map(V=>V.id),q=await Qa.cleanupInvalidPlans(s.id,G);h(q)}},[s]);b.useEffect(()=>{const K=setTimeout(()=>{T()},0);return()=>clearTimeout(K)},[T]);const D=async K=>{const{active:G,over:q}=K;if(q&&q.id.startsWith("date-")){const V=q.data.current.dateStr;if(G.id.startsWith("recipe-")){const P=G.data.current.recipe;await Qa.addMeal(s.id,V,P.id,"dinner"),T()}else if(G.id.startsWith("meal-")){const{meal:P,dateStr:k}=G.data.current;if(k===V)return;await Qa.addMeal(s.id,V,P.recipeId,P.type||"dinner"),await Qa.removeMeal(s.id,k,P.id),T()}}},M=async(K,G,q)=>{q&&q.stopPropagation(),N({dateStr:K,mealId:G}),S(!0)},$=async()=>{if(!_)return;const{dateStr:K,mealId:G}=_;S(!1),N(null);try{await Qa.removeMeal(s.id,K,G),await T(),l.success("")}catch(q){l.error(""),console.error("Delete meal error:",q)}},U=()=>{S(!1),N(null)},C=()=>{const K=p.getFullYear(),G=p.getMonth(),q=new Date(K,G,1),V=new Date(K,G+1,0),P=[],k=q.getDay();for(let L=k-1;L>=0;L--){const Y=new Date(K,G,-L);P.push({date:Y,isOutside:!0})}for(let L=1;L<=V.getDate();L++){const Y=new Date(K,G,L);P.push({date:Y,isOutside:!1})}const E=42-P.length;for(let L=1;L<=E;L++){const Y=new Date(K,G+1,L);P.push({date:Y,isOutside:!0})}return P},z=K=>`${K.getFullYear()}-${String(K.getMonth()+1).padStart(2,"0")}-${String(K.getDate()).padStart(2,"0")}`,R=o.filter(K=>K.title.toLowerCase().includes(y.toLowerCase())),F=K=>{m(new Date(p.getFullYear(),p.getMonth()+K,1))};return i.jsxs("div",{className:"planner-container fade-in",children:[x&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," "]}),i.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",i.jsx("br",{}),i.jsx("strong",{children:""})]}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(le,{variant:"ghost",onClick:U,children:""}),i.jsx(le,{variant:"danger",onClick:$,children:""})]})]})}),i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(le,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx(Ji,{onDragEnd:D,sensors:j,children:i.jsxs("div",{className:"planner-layout",children:[i.jsxs("div",{className:"recipe-sidebar",children:[i.jsx("div",{className:"sidebar-search",children:i.jsx(zt,{placeholder:"...",value:y,onChange:K=>v(K.target.value)})}),i.jsx("div",{className:"draggable-list",children:R.map(K=>i.jsx($T,{recipe:K},K.id))})]}),i.jsxs("div",{className:"planner-calendar",children:[i.jsxs("div",{className:"calendar-header",children:[i.jsx(le,{variant:"ghost",onClick:()=>F(-1),children:" "}),i.jsxs("h3",{style:{margin:0},children:[p.getFullYear()," ",p.getMonth()+1,""]}),i.jsx(le,{variant:"ghost",onClick:()=>F(1),children:" "})]}),i.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(K=>i.jsx("div",{className:"calendar-day-header",children:K},K)),C().map((K,G)=>{const q=z(K.date),V=d[q]||[],P=q===z(new Date);return i.jsx(qT,{dateStr:q,dayNum:K.date.getDate(),isToday:P,isOutside:K.isOutside,children:V.map(k=>{const E=o.find(L=>L.id===k.recipeId);return i.jsx(PT,{meal:k,dateStr:q,children:i.jsxs("div",{className:"planned-meal",title:E?.title,onClick:()=>E&&t&&t(E),children:[i.jsx("span",{children:E?.title||"Unknown"}),i.jsx("span",{className:"delete-meal-btn",onPointerDown:L=>{L.stopPropagation()},onClick:L=>M(q,k.id,L),children:""})]})},k.id)})},G)})]})]})]})})]})},HT=({onBack:n})=>{const{user:t}=os(),s=Zi(),[l,o]=b.useState(new Date().toISOString().slice(0,10)),[u,d]=b.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[h,p]=b.useState([]),[m,y]=b.useState(!1),[v,x]=b.useState(!1),[S,_]=b.useState(!1),[N,j]=b.useState(!1),T=async()=>{y(!0);try{if(!t?.id){s.error(""),y(!1);return}const C=await Qa.getAll(t.id),z=new Date(l),R=new Date(u);R.setHours(23,59,59,999);const F=[];if(Object.keys(C).forEach(xe=>{const ae=new Date(xe);ae>=z&&ae<=R&&C[xe].forEach(O=>{F.push(O.recipeId)})}),F.length===0){s.info(""),x(!1);return}const K=await xn.fetchRecipes(t),G=F.map(xe=>K.find(ae=>ae.id===xe)).filter(Boolean),q=xe=>(xe??"").toString().trim(),V=xe=>{const ae=q(xe);if(!ae)return"";const O=ae.toLowerCase();return O===""?"g":O===""?"ml":O===""?"cc":O===""?"kg":O===""?"l":O},P=xe=>{const ae=q(xe);return ae?["","","","","","","","PC","pc",""].includes(ae):!1},k=(xe,ae)=>{const O=parseFloat(xe)||0,J=V(ae);return J==="kg"?{qty:O*1e3,unit:"g"}:J==="g"?{qty:O,unit:"g"}:J==="l"?{qty:O*1e3,unit:"ml"}:J==="cc"?{qty:O,unit:"ml"}:J==="ml"?{qty:O,unit:"ml"}:{qty:O,unit:q(ae)||""}},E=(xe,ae,O,J)=>{const ce=q(O),Se=parseFloat(ae)||0;if(!J)return k(Se,ce);const ke=parseFloat(J.packetSize),Be=V(J.packetUnit);if(!Number.isFinite(ke)||ke<=0||!Be)return k(Se,ce);if(["g","kg","ml","cc","l"].includes(Be)&&P(ce)){const Ge=Se*ke;return k(Ge,Be)}return k(Se,ce)},[L,Y,oe,ge]=await Promise.all([Pn.getAllConversions(),nr.fetchPriceList(t.id),er.getAll(t.id),Du.getAll(t.id)]),B=new Map;try{for(const[xe,ae]of(L||new Map).entries()){const O=nn(xe);O&&(B.has(O)||B.set(O,ae))}}catch{}const W=new Map;try{for(const[xe,ae]of(ge||new Map).entries()){const O=nn(xe);O&&(W.has(O)||W.set(O,ae))}}catch{}const Z=new Map;try{(oe||[]).forEach(xe=>{const ae=nn(xe?.name);ae&&(Z.has(ae)||Z.set(ae,xe))})}catch{}const ye={};G.forEach(xe=>{[...xe.ingredients||[],...xe.flours||[],...xe.breadIngredients||[]].forEach(J=>{if(!J.name)return;const ce=q(J.name),Se=nn(ce),ke=(Se?B.get(Se):null)||L?.get(ce)||null,Be=E(ce,J.quantity,J.unit,ke),Le=Be.qty||0,Ge=Be.unit||"";ye[ce]||(ye[ce]={quantity:0,unit:Ge,count:0}),ye[ce].quantity+=Le})});const Me=Object.keys(ye).map(xe=>{const ae=ye[xe],O=nn(xe),J=(O?B.get(O):null)||L?.get(xe)||null,ce=O&&Y?.get(O)||null,Se=O&&Z.get(O)||null,ke=E(xe,Se?.quantity??0,Se?.unit??ae.unit,J),Be=ae.quantity||0,Le=ke.qty||0,Ge=ae.unit||ke.unit||"",pe=Le-Be,Ye=parseFloat(J?.packetSize),rt=q(J?.packetUnit),ft=Number.isFinite(Ye)&&Ye>0&&!!rt,St=ft?Ye*.2:0,mt=ft?pe<St:!1,Dt=ce?.unit?String(ce.unit).trim():"",Vt=O&&W.has(O)?String(W.get(O)).trim():"",wt=Vt||""||Dt||""||"",ie=(J?.lastPrice!==null&&J?.lastPrice!==void 0&&J?.lastPrice!==""?parseFloat(J.lastPrice):null)??(ce?.price!==null&&ce?.price!==void 0?parseFloat(ce.price):null);let je=null,Ce=0,Ue=Ge;if(ft){const ct=Math.max(0,St-pe);je=Math.ceil(ct/Ye),mt&&je<1&&(je=1),Ce=je,Ue=wt}else Ce=Math.max(0,Be-Le),Ue=Ge;const st=ft?mt:Ce>.01;return{name:xe,required:Be,stock:Le,remaining:pe,unit:Ge,shouldShow:st,toOrder:Ce,orderUnit:Ue,orderPacks:je,packSize:ft?Ye:null,packUnit:ft?rt:null,packPrice:Number.isFinite(ie)?ie:null,vendor:ce?.vendor||Se?.vendor||""}}).filter(xe=>xe.shouldShow);p(Me),x(!0)}catch(C){console.error(C),s.error("")}finally{y(!1)}},D=()=>{_(!0)},M=()=>{j(!0)},$=()=>h.map(C=>{if(Number.isFinite(C.orderPacks)&&C.orderPacks!==null){const z=C.packSize&&C.packUnit?`1${C.orderUnit}=${C.packSize}${C.packUnit}`:"";return`${C.name}: ${C.orderPacks}${C.orderUnit}${z}`}return`${C.name}: ${Number(C.toOrder||0).toFixed(1)}${C.unit}`}).join(`
`),U=async()=>{const C=document.getElementById("copy-textarea");if(C){C.select();try{await navigator.clipboard.writeText(C.value),s.success("")}catch{document.execCommand("copy"),s.success("")}}};return i.jsxs("div",{className:"order-list-container fade-in",children:[i.jsxs("div",{className:"container-header",children:[i.jsx("h2",{className:"section-title",children:" "}),i.jsx("div",{className:"header-actions",children:i.jsx(le,{variant:"ghost",onClick:n,children:" "})})]}),i.jsx("div",{className:"filter-card",children:i.jsxs("div",{className:"date-range-inputs",children:[i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:l,onChange:C=>o(C.target.value)})]}),i.jsx("span",{children:""}),i.jsxs("div",{children:[i.jsx("label",{children:""}),i.jsx("input",{type:"date",value:u,onChange:C=>d(C.target.value)})]}),i.jsx(le,{variant:"primary",onClick:T,disabled:m,children:m?"...":""})]})}),v&&i.jsxs("div",{className:"order-results",children:[i.jsxs("div",{className:"results-header",children:[i.jsxs("h3",{children:[" (",h.length,")"]}),i.jsxs("div",{className:"result-actions",children:[i.jsx(le,{variant:"secondary",onClick:D,children:" "}),i.jsx(le,{variant:"secondary",onClick:M,children:" "})]})]}),i.jsxs("table",{className:"order-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:h.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):h.map((C,z)=>i.jsxs("tr",{children:[i.jsx("td",{children:C.name}),i.jsxs("td",{style:{textAlign:"right"},children:[C.required.toFixed(1)," ",C.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,C.remaining??0).toFixed(1)," ",C.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(C.orderPacks)&&C.orderPacks!==null?i.jsxs(i.Fragment,{children:[C.orderPacks,C.orderUnit,C.packSize&&C.packUnit&&i.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",C.orderUnit," = ",Number(C.packSize).toLocaleString(),C.packUnit,C.packPrice?` / ${Math.round(C.packPrice).toLocaleString()}`:""]})]}):i.jsxs(i.Fragment,{children:[C.toOrder.toFixed(1)," ",i.jsx("span",{style:{fontSize:"0.8em"},children:C.unit})]})})]},z))})]})]}),i.jsx(Cn,{isOpen:S,onClose:()=>_(!1),title:" ",size:"medium",children:i.jsxs("div",{className:"copy-modal-content",children:[i.jsx("p",{className:"copy-instructions",children:""}),i.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:$(),onClick:C=>C.target.select()}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(le,{variant:"primary",onClick:U,children:" "}),i.jsx(le,{variant:"ghost",onClick:()=>_(!1),children:""})]})]})}),i.jsx(Cn,{isOpen:N,onClose:()=>j(!1),title:" ",size:"large",children:i.jsxs("div",{className:"print-preview-content",children:[i.jsxs("div",{className:"print-preview-header",children:[i.jsx("h3",{children:""}),i.jsxs("p",{className:"print-period",children:[": ",l,"  ",u]})]}),i.jsxs("table",{className:"print-preview-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""}),i.jsx("th",{style:{textAlign:"right"},children:""})]})}),i.jsx("tbody",{children:h.map((C,z)=>i.jsxs("tr",{children:[i.jsx("td",{children:C.name}),i.jsxs("td",{style:{textAlign:"right"},children:[C.required.toFixed(1)," ",C.unit]}),i.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,C.remaining??0).toFixed(1)," ",C.unit]}),i.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(C.orderPacks)&&C.orderPacks!==null?`${C.orderPacks}${C.orderUnit}`:`${C.toOrder.toFixed(1)} ${C.unit}`})]},z))})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx(le,{variant:"primary",onClick:()=>window.print(),children:" "}),i.jsx(le,{variant:"ghost",onClick:()=>j(!1),children:""})]})]})})]})},uo=async(n,t,s)=>{let l=null;try{const o=new Promise((u,d)=>{l=setTimeout(()=>d(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{l&&clearTimeout(l)}},zx=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},GT=({children:n})=>{const[t,s]=b.useState(null),[l,o]=b.useState(!0),[u,d]=b.useState(!1),h=b.useCallback(async j=>{if(!j){s(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const T=j.id,D=j.email||"";try{const G=localStorage.getItem("auth_user_cache");if(G){const q=JSON.parse(G);q&&q.id===T&&s(q)}}catch(G){console.warn("[Auth] Failed to load cache",G)}let M=null,$=0;const U=3;for(;$<U;)try{const[G,q]=await Promise.all([uo(Re.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",T).single().then(k=>({data:k,error:null})).catch(k=>({data:null,error:k})),2500,"profiles.select(with_email)").catch(k=>({data:null,error:k})),uo(Re.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",T).single().then(k=>({data:k,error:null})).catch(k=>({data:null,error:k})),2500,"profiles.select").catch(k=>({data:null,error:k}))]);let V=null,P=null;if(G?.data?.data?(V=G.data.data,P=null):q?.data?.data?(V=q.data.data,P=null):P=G?.error??q?.error??new Error("Profile fetch failed"),P)if(P.code==="PGRST116"){const k=j.user_metadata&&j.user_metadata.display_id?String(j.user_metadata.display_id):zx(D)||T.slice(0,8);let E=null,L=null;const Y=await uo(Re.from("profiles").insert([{id:T,display_id:k,email:D||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),8e3,"profiles.insert(with_email)");if(E=Y?.data??null,L=Y?.error??null,L&&String(L.message||"").toLowerCase().includes("email")){const oe=await uo(Re.from("profiles").insert([{id:T,display_id:k,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),8e3,"profiles.insert");E=oe?.data??null,L=oe?.error??null}if(L)throw L;M=E}else throw P;else M=V;if(M&&Object.prototype.hasOwnProperty.call(M,"email")&&D&&!M.email)try{await Re.from("profiles").update({email:D}).eq("id",T)}catch(k){console.warn("Failed to backfill profile email",k)}break}catch(G){console.error(`Failed to load/create profile (Attempt ${$+1}/${U}):`,G),$++,$<U&&await new Promise(q=>setTimeout(q,500*$))}const C=M?.display_id||zx(D)||T.slice(0,8),z=M?.role||"user",R=String(z).trim().toLowerCase(),F=M?.show_master_recipes===!0,K={id:T,email:D,displayId:C,role:R,showMasterRecipes:F};s(K);try{localStorage.setItem("auth_user_cache",JSON.stringify(K))}catch(G){console.warn("[Auth] Failed to save cache",G)}},[]);b.useEffect(()=>{let j=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:T}=Re.auth.onAuthStateChange(async(M,$)=>{M==="PASSWORD_RECOVERY"&&d(!0);try{await h($?.user||null)}catch(U){console.error("Auth state change handler failed:",U)}});return j=T?.subscription,(async()=>{try{const{data:M}=await uo(Re.auth.getSession(),5e3,"auth.getSession");await h(M?.session?.user||null)}catch(M){console.error("Auth init failed:",M)}finally{o(!1)}})(),()=>{try{j?.unsubscribe?.()}catch{}}},[h]);const p=b.useCallback(async(j,T)=>{const{error:D}=await Re.auth.signInWithPassword({email:j,password:T});if(D)throw console.error("Login error:",D),new Error("")},[]),m=b.useCallback(async(j,T,D)=>{const{data:M,error:$}=await Re.auth.signUp({email:j,password:T,options:{data:{display_id:D}}});if($)throw console.error("SignUp error:",$),new Error($.message||"");const U=M?.user;if(U?.id){let C=null;C=(await Re.from("profiles").insert([{id:U.id,display_id:D,email:j||null,role:"user",show_master_recipes:!1}]))?.error??null,C&&String(C.message||"").toLowerCase().includes("email")&&(C=(await Re.from("profiles").insert([{id:U.id,display_id:D,role:"user",show_master_recipes:!1}]))?.error??null),C&&C.code!=="23505"&&console.error("Profile create error:",C)}return{needsEmailConfirmation:!M?.session}},[]),y=b.useCallback(async()=>{await Re.auth.signOut(),s(null),d(!1)},[]),v=b.useCallback(j=>{!j||typeof j!="object"||s(T=>T&&{...T,...j})},[]),x=b.useCallback(async j=>{const{error:T}=await Re.auth.resetPasswordForEmail(j,{redirectTo:window.location.origin});if(T)throw console.error("Password reset email error:",T),new Error("");return!0},[]),S=b.useCallback(async j=>{const{error:T}=await Re.auth.updateUser({password:j});if(T)throw console.error("Update password error:",T),new Error("");return!0},[]),_=b.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),N=b.useMemo(()=>({user:t,loading:l,login:p,register:m,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:S,finishPasswordRecovery:_}),[t,l,p,m,y,v,x,u,S,_]);return i.jsx(X0.Provider,{value:N,children:n})},VT=({id:n,message:t,type:s="info",onClose:l})=>{b.useEffect(()=>{const u=setTimeout(()=>{l(n)},3e3);return()=>clearTimeout(u)},[n,l]);const o=()=>{switch(s){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return i.jsxs("div",{className:`toast toast-${s}`,children:[i.jsx("div",{className:"toast-icon",children:o()}),i.jsx("div",{className:"toast-message",children:t}),i.jsx("button",{className:"toast-close",onClick:()=>l(n),"aria-label":"",children:""})]})},KT=({toasts:n,onRemove:t})=>n.length===0?null:i.jsx("div",{className:"toast-container",children:n.map(s=>i.jsx(VT,{id:s.id,message:s.message,type:s.type,onClose:t},s.id))}),YT=({children:n})=>{const[t,s]=b.useState([]),l=b.useCallback((d,h="info")=>{const p=Date.now()+Math.random();s(m=>[...m,{id:p,message:d,type:h}].slice(-5))},[]),o=b.useCallback(d=>{s(h=>h.filter(p=>p.id!==d))},[]),u={showToast:l,success:d=>l(d,"success"),error:d=>l(d,"error"),warning:d=>l(d,"warning"),info:d=>l(d,"info")};return i.jsxs(Z0.Provider,{value:u,children:[n,i.jsx(KT,{toasts:t,onRemove:o})]})},QT=()=>{const[n,t]=b.useState(!0),[s,l]=b.useState(!1),[o,u]=b.useState(""),[d,h]=b.useState(""),[p,m]=b.useState(""),[y,v]=b.useState(""),[x,S]=b.useState(""),[_,N]=b.useState(!1),[j,T]=b.useState(!1);_e.useEffect(()=>{const R=localStorage.getItem("savedEmail"),F=localStorage.getItem("savedPassword");R&&(u(R),F&&h(F),T(!0))},[]);const{login:D,register:M,sendPasswordResetEmail:$}=os(),U=async R=>{R.preventDefault(),v(""),S(""),N(!0);try{await D(o.trim(),d),j?(localStorage.setItem("savedEmail",o.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(F){v(F.message||"")}finally{N(!1)}},C=async R=>{R.preventDefault(),v(""),S(""),N(!0);try{if(!p.trim()){v("ID: yoshito");return}(await M(o.trim(),d,p.trim()))?.needsEmailConfirmation?S(""):S(""),t(!0),h("")}catch(F){v(F.message||"")}finally{N(!1)}},z=async R=>{R.preventDefault(),v(""),S(""),N(!0);try{await $(o.trim()),S(""),l(!1)}catch(F){v(F.message||"")}finally{N(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(tn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[i.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",i.jsx("br",{}),"Management"]}),i.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:s?"":n?"":""})]}),y&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),i.jsxs("form",{onSubmit:s?z:n?U:C,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"email",value:o,onChange:R=>u(R.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:d,onChange:R=>h(R.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&!n&&i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",i.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),i.jsx("input",{type:"text",value:p,onChange:R=>m(R.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),i.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!s&&i.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[i.jsx("input",{type:"checkbox",id:"rememberMe",checked:j,onChange:R=>T(R.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),i.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),i.jsx(le,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:_,children:s?"":n?"":""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s?i.jsx("button",{type:"button",onClick:()=>{l(!1),v(""),S("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):i.jsx("button",{type:"button",onClick:()=>{l(!0),v(""),S("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!s&&i.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),S("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},WT=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:s}=os(),[l,o]=_e.useState(""),[u,d]=_e.useState(""),[h,p]=_e.useState(""),[m,y]=_e.useState(""),[v,x]=_e.useState(!1),S=async _=>{if(_.preventDefault(),p(""),y(""),!l||l.length<8){p("8");return}if(l!==u){p("");return}x(!0);try{await n(l),y(""),t()}catch(N){console.error(N),p(N.message||"")}finally{x(!1)}};return i.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:i.jsxs(tn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[i.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),i.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),h&&i.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:h}),m&&i.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),i.jsxs("form",{onSubmit:S,children:[i.jsxs("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:l,onChange:_=>o(_.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsxs("div",{style:{marginBottom:"1.5rem"},children:[i.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),i.jsx("input",{type:"password",value:u,onChange:_=>d(_.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),i.jsx(le,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),i.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[i.jsx(le,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),i.jsx(le,{variant:"ghost",onClick:s,style:{flex:1},children:""})]})]})})},Uf=({label:n,subLabel:t,variant:s="screen",showLogo:l=!0})=>i.jsxs("div",{className:s==="screen"?"loading-screen":"loading-inline",children:[l&&i.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),i.jsxs("div",{className:"loading-text",children:[n,i.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[i.jsx("span",{children:"."}),i.jsx("span",{children:"."}),i.jsx("span",{children:"."})]})]}),i.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&i.jsx("div",{className:"loading-subtext",children:t})]});function JT(){const{user:n,logout:t,loading:s,isPasswordRecovery:l}=os(),o=Zi(),[u,d]=Lo(),[h,p]=b.useState([]),[m,y]=b.useState(!0),[v,x]=b.useState(0),[S,_]=b.useState([]),[N,j]=b.useState(!1),[T,D]=b.useState({}),[M,$]=b.useState({}),[U,C]=b.useState(!1),z=u.get("view"),R=(z==="create-mock"?"create":z)||"list",F=u.get("id"),K=h.find(H=>String(H.id)===F)||null,[G,q]=b.useState(null),[V,P]=b.useState(!1),[k,E]=b.useState(""),[L,Y]=b.useState(null),[oe,ge]=b.useState(null),[B,W]=b.useState(""),[Z,ye]=b.useState("none"),[Me,xe]=b.useState(!1),[ae,O]=b.useState(!1),[J,ce]=b.useState(new Set),[Se,ke]=b.useState("normal"),[Be,Le]=b.useState(!1),[Ge,pe]=b.useState(!1),[Ye,rt]=b.useState(null),[ft,St]=b.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),mt={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};b.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const H=window.matchMedia("(max-width: 700px)"),ze=()=>St(!!H.matches);return ze(),H.addEventListener?H.addEventListener("change",ze):H.addListener(ze),()=>{H.removeEventListener?H.removeEventListener("change",ze):H.removeListener(ze)}},[]),b.useEffect(()=>{if(!ft||!mt[R]||typeof window>"u")return;const H=`pc-recommend-shown:${R}`;try{if(window.sessionStorage.getItem(H)==="1")return;window.sessionStorage.setItem(H,"1")}catch{}rt(R)},[R,ft]),b.useEffect(()=>{R!=="list"&&ye("none")},[R]),b.useEffect(()=>{if(!s){j(!1);return}const H=setTimeout(()=>j(!0),3500);return()=>clearTimeout(H)},[s]),b.useEffect(()=>{if(h.length>0||R==="trash")return;let H=n?.id;if(!H)try{H=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!H)return;const ze=xn.getCachedRecipes(H);ze&&ze.length>0&&(p(ze),C(!0),y(!1))},[n?.id]),b.useEffect(()=>{s||n&&(async()=>{try{const H=R==="trash"?vt():Ue();await Promise.all([H,Ce(),ie()])}catch(H){console.error("Error during initial data load:",H)}})()},[s,n?.id]),b.useEffect(()=>{if(s)return;if(!n||n.role!=="admin"){D({}),$({});return}let H=!1;return(async()=>{try{const ze=await Qi.fetchAllProfiles();if(H)return;const Fe={},_t={};for(const De of ze||[])De?.id&&(Fe[String(De.id)]=De),De?.display_id&&(_t[String(De.display_id)]=De);D(Fe),$(_t)}catch(ze){console.warn("Failed to load profiles for admin owner labels",ze)}})(),()=>{H=!0}},[s,n?.id,n?.role]);const Dt=H=>{const Fe=(H?.tags||[]).find(dt=>dt&&dt.startsWith("owner:"));if(!Fe)return"/";const _t=String(Fe.slice(6)),De=T[_t]||M[_t]||null;return De?De.display_id||De.email||_t:_t.length>12?`${_t.slice(0,8)}`:_t},Vt=sl(gr(Po,{activationConstraint:{distance:10}}),gr(qo,{activationConstraint:{delay:1e3,tolerance:5}}),gr(al,{coordinateGetter:Hu})),wt=H=>{const{active:ze,over:Fe}=H;ze.id!==Fe.id&&p(_t=>{const De=_t.findIndex(Et=>Et.id===ze.id),dt=_t.findIndex(Et=>Et.id===Fe.id);if(De===-1||dt===-1)return _t;const Ft=Xi(_t,De,dt),Nn=Ft.map((Et,Vn)=>({id:Et.id,order_index:Vn}));return xn.updateOrder(Nn).catch(Et=>console.error("Order update failed",Et)),Ft})},ie=async()=>{try{const H=await xn.fetchRecentRecipes();_(H||[])}catch(H){console.error("Failed to load history:",H)}},je=async H=>{const ze=[H,...S.filter(Fe=>Fe!==H)].slice(0,20);_(ze);try{await xn.addToHistory(H)}catch(Fe){console.error("Failed to sync history",Fe)}},Ce=async()=>{try{const H=await xn.getDeletedCount();x(H||0)}catch(H){console.error("Failed to load trash count:",H)}},Ue=async()=>{try{U||y(!0);const H=await xn.fetchRecipes(n,{timeoutMs:15e3,includeIngredients:!1,includeSources:!1});p(H||[])}catch(H){console.error("Failed to fetch recipes:",H),o.error(`

(${H?.message||"unknown error"})`)}finally{y(!1),C(!1)}},st=H=>(H||"").toString().replace(/\s+/g," ").trim(),ct=H=>st(H).toLowerCase(),Rt="__NO_STORE__",Jt="__OTHER_STORE__",wn=[...new Set(h.map(H=>st(H.course)).filter(Boolean))],jt=[...new Set(h.map(H=>st(H.category)).filter(Boolean))],rn=h.reduce((H,ze)=>{const Fe=ct(ze.storeName);return Fe&&(H[Fe]=(H[Fe]||0)+1),H},{}),cn=new Set(xu.map(H=>ct(H)).filter(Boolean)),vn=h.reduce((H,ze)=>ct(ze.storeName)?H:H+1,0),Ln=h.reduce((H,ze)=>{const Fe=ct(ze.storeName);return Fe?cn.has(Fe)?H:H+1:H},0),ar=h.reduce((H,ze)=>{const Fe=ct(ze.course);return Fe&&(H[Fe]=(H[Fe]||0)+1),H},{}),me=h.reduce((H,ze)=>{const Fe=ct(ze.category);return Fe&&(H[Fe]=(H[Fe]||0)+1),H},{}),He=h.filter(H=>{const ze=ct(k),Fe=k===""||k==="recent"&&S.includes(H.id)||H.tags&&H.tags.includes(k)||k===Rt&&!ct(H.storeName)||k===Jt&&ct(H.storeName)&&!cn.has(ct(H.storeName))||H.category&&ct(H.category)===ze||H.course&&ct(H.course)===ze||H.storeName&&ct(H.storeName)===ze,_t=B.toLowerCase().trim(),De=!_t||H.title.toLowerCase().includes(_t)||H.description&&H.description.toLowerCase().includes(_t)||H.ingredients&&H.ingredients.some(dt=>dt.name.toLowerCase().includes(_t));return Fe&&De}),Xe=k===""&&!B.trim()&&R==="list",Ve=(H,ze={})=>{d({view:"detail",id:H.id,...ze})},et=async(H,ze=!1)=>{try{if(H.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&H.tags.some(_t=>_t==="owner:yoshito")){o.warning("");return}ze?(await xn.restoreRecipe(H.id),(R==="trash"||R==="detail")&&(d({view:"trash"}),vt()),o.success("")):(await xn.deleteRecipe(H.id),p(h.filter(Fe=>Fe.id!==H.id)),d({view:"list"}),Ce())}catch(Fe){console.error("Failed to delete/restore recipe:",Fe),o.error("")}finally{Ce()}},Mt=async H=>{try{await xn.hardDeleteRecipe(H.id),p(h.filter(ze=>ze.id!==H.id)),d({view:"trash"}),o.success(""),vt(),Ce()}catch(ze){console.error("Failed to hard delete recipe:",ze),o.error("")}},vt=async()=>{try{y(!0);const H=await xn.fetchDeletedRecipes();p(H||[]),E("")}catch(H){console.error("Failed to fetch deleted recipes:",H)}finally{y(!1)}},kt=()=>{d({view:"trash"}),vt()},Ze=()=>{d({view:"list"}),Ue()},Bt=async(H,ze)=>{try{let Fe,_t=ze;if(ze&&n.role!=="admin"){const De=H.tags?.find(Ft=>Ft.startsWith("owner:"));De===`owner:${n.id}`||n.displayId&&De===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${De||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),_t=!1)}_t?(Fe=await xn.updateRecipe(H,n),p(h.map(De=>De.id===Fe.id?Fe:De))):(Fe=await xn.createRecipe(H,n),p([Fe,...h])),d(_t?{view:"detail",id:Fe.id}:{view:"detail",id:Fe.id})}catch(Fe){console.error("Failed to save recipe:",Fe),o.error(`
: ${Fe.message||Fe.error_description||JSON.stringify(Fe)}`)}};b.useEffect(()=>{let H=!1;return(async()=>{if(R!=="edit"||!F){q(null),P(!1);return}P(!0);try{const Fe=await xn.getRecipe(F);if(H)return;q(Fe)}catch(Fe){if(console.error("Failed to load edit recipe details",Fe),H)return;q(K),o.warning("")}finally{H||P(!1)}})(),()=>{H=!0}},[R,F]);const Qe=(H,ze="")=>{const _t=["","baker","","","","dough","fermentation"].some(sn=>(H.title||"").toLowerCase().includes(sn)),De=["flour","","","","","","","","",""],dt=["yeast","","",""],Ft=H.ingredients||[],Nn=Ft.some(sn=>dt.some(Nt=>(sn.name||"").toLowerCase().includes(Nt))),Et=Ft.some(sn=>De.some(Nt=>(sn.name||"").toLowerCase().includes(Nt))&&!sn.name.includes(""));if(Ft.some(sn=>sn.quantity&&String(sn.quantity).includes("%")||sn.unit&&String(sn.unit).includes("%"))||Nn||_t&&Et){H.type="bread",H.flours=[],H.breadIngredients=[];const sn=["flour","","","","","","","",""];if(Ft.forEach(Nt=>{sn.some(Kn=>(Nt.name||"").includes(Kn))?H.flours.push(Nt):H.breadIngredients.push(Nt)}),H.flours.length===0&&Ft.length>0){const Nt=Ft[0];(Nt.name||"").includes("")&&(H.flours.push(Nt),H.breadIngredients=H.breadIngredients.filter(Pr=>Pr!==Nt))}}H.sourceUrl=ze,ze&&(H.category="URL"),ge(H),d({view:"create"})},Ut=()=>{O(!ae),ce(new Set)},Xt=H=>{const ze=new Set(J);ze.has(H)?ze.delete(H):ze.add(H),ce(ze)},Qt=()=>{Le(!0)},ne=()=>{Le(!1)},te=async()=>{Le(!1);try{y(!0),R==="trash"?(await Promise.all(Array.from(J).map(H=>xn.hardDeleteRecipe(H))),vt()):(await Promise.all(Array.from(J).map(H=>xn.deleteRecipe(H))),p(h.filter(H=>!J.has(H.id))),Ce()),ce(new Set),O(!1),o.success("")}catch(H){console.error("Bulk delete failed",H),o.warning(""),R==="trash"?vt():Ue()}finally{y(!1)}},he=()=>{J.size!==0&&pe(!0)},Ee=()=>{pe(!1)},Ie=async()=>{pe(!1);try{y(!0);for(const H of J)await xn.restoreRecipe(H);p(h.filter(H=>!J.has(H.id))),Ce(),O(!1),ce(new Set),o.success(""),vt()}catch(H){console.error("Bulk restore failed",H),o.warning(""),vt()}finally{y(!1)}},Je=()=>{const H=He.map(ze=>ze.id);ce(new Set(H))},Ke=H=>{p([H,...h]),d({view:"edit",id:H.id})};if(b.useEffect(()=>{s||n&&(R==="trash"?vt():R==="list"&&Ue())},[R,s,n?.id]),s&&!N){let H=!1;try{const ze=JSON.parse(localStorage.getItem("auth_user_cache")||"null");ze?.id&&(H=!!xn.getCachedRecipes(ze.id))}catch{}if(!H)return i.jsx(Uf,{label:"",subLabel:""})}return n?l?i.jsx(WT,{}):i.jsxs(Hj,{children:[Be&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",J.size,"",R==="trash"?"":""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:R==="trash"?"":""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(le,{variant:"ghost",onClick:ne,children:""}),i.jsx(le,{variant:"danger",onClick:te,children:R==="trash"?"":""})]})]})}),Ge&&i.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsxs(tn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[i.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[i.jsx("span",{children:""})," ",J.size,""]}),i.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),i.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[i.jsx(le,{variant:"ghost",onClick:Ee,children:""}),i.jsx(le,{variant:"secondary",onClick:Ie,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),i.jsx(Cn,{isOpen:!!Ye,onClose:()=>rt(null),title:"PC",size:"small",children:i.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[i.jsx("p",{style:{marginTop:0},children:mt[Ye]?i.jsxs(i.Fragment,{children:["",i.jsx("strong",{children:mt[Ye]}),"/"]}):i.jsx(i.Fragment,{children:"/"})}),i.jsxs("p",{style:{marginBottom:0},children:["",i.jsx("strong",{children:"PC"}),""]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[i.jsx(le,{variant:"ghost",onClick:()=>{rt(null),d({view:"list"})},children:""}),i.jsx(le,{variant:"primary",onClick:()=>rt(null),children:"OK"})]})]})}),(R==="list"||R==="trash")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"container-header",children:[i.jsxs("h2",{className:"section-title",children:[R==="trash"?" ()":"",R==="list"&&i.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",h.length,")"]})]}),i.jsx("div",{className:"header-actions",children:R==="list"||R==="trash"?i.jsxs(i.Fragment,{children:[ae?i.jsxs(i.Fragment,{children:[i.jsx(le,{variant:"ghost",onClick:Ut,children:""}),i.jsx(le,{variant:"secondary",onClick:Je,children:""}),R==="trash"&&i.jsxs(le,{variant:"secondary",onClick:he,disabled:J.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",J.size,")"]}),i.jsxs(le,{variant:"danger",onClick:Qt,disabled:J.size===0,children:[R==="trash"?"":""," (",J.size,")"]})]}):i.jsx(i.Fragment,{children:R==="list"?i.jsx(i.Fragment,{children:i.jsx(le,{onClick:()=>{ge(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):i.jsx(le,{variant:"ghost",onClick:Ze,children:" "})}),i.jsx("button",{className:"mobile-menu-toggle",onClick:()=>xe(!Me),"aria-label":"",children:""}),i.jsxs("div",{className:`secondary-actions ${Me?"open":""}`,children:[i.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>xe(!1),"aria-label":"",children:""}),i.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[i.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&i.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&i.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),i.jsxs(le,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),i.jsxs(le,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),R==="list"&&i.jsxs(i.Fragment,{children:[i.jsxs(le,{variant:"secondary",onClick:()=>{Y("url"),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),i.jsxs(le,{variant:"secondary",onClick:()=>{Y("image"),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsx("div",{className:"pc-recommend-note",children:i.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),i.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"inventory"}),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"incoming-deliveries"}),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),i.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"incoming-stock"}),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"planner"}),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"data"}),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&i.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"users"}),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"order-list"}),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"})]}),!ae&&i.jsxs(le,{variant:"ghost",onClick:()=>{Ut(),xe(!1)},className:"danger-text",children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," ",R==="trash"?"":""]}),R==="list"&&i.jsxs(le,{variant:"ghost",onClick:()=>{kt(),xe(!1)},style:{position:"relative"},children:[i.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&i.jsx("span",{className:"trash-badge",children:v})]}),i.jsxs(le,{variant:"ghost",onClick:()=>{Ze(),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),i.jsx("div",{className:"menu-divider"}),i.jsxs(le,{variant:"ghost",onClick:()=>{t(),xe(!1)},children:[i.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]}),i.jsx("div",{className:`menu-backdrop ${Me?"open":""}`,onClick:()=>xe(!1),"aria-hidden":"true"})]}):null})]}),R==="list"&&i.jsxs("div",{className:"list-toolbar",children:[i.jsxs("div",{className:"search-container search-container--compact",children:[i.jsx("span",{className:"search-icon",children:""}),i.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:B,onChange:H=>W(H.target.value)})]}),i.jsxs("div",{className:"public-recipe-toggles",children:[i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${Z==="mine"?"active":""}`,"aria-pressed":Z==="mine",onClick:()=>ye("mine"),children:" "}),i.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${Z==="others"?"active":""}`,"aria-pressed":Z==="others",onClick:()=>ye("others"),children:" "}),Z!=="none"&&i.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>ye("none"),children:" "})]})]}),i.jsxs("div",{className:"tag-filter-container",children:[i.jsxs("select",{className:"store-filter-select",value:k===Rt?Rt:k===Jt?Jt:xu.includes(k)?k:"",onChange:H=>E(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),xu.map(H=>i.jsxs("option",{value:H,children:[H," (",rn[ct(H)]||0,")"]},H)),i.jsxs("option",{value:Rt,children:[" (",vn,")"]}),i.jsxs("option",{value:Jt,children:[" (",Ln,")"]})]}),i.jsxs("select",{className:"store-filter-select",value:wn.includes(k)?k:"",onChange:H=>E(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),wn.sort().map(H=>i.jsxs("option",{value:H,children:[H," (",ar[ct(H)]||0,")"]},H))]}),i.jsxs("select",{className:"store-filter-select",value:jt.includes(k)?k:"",onChange:H=>E(H.target.value||""),children:[i.jsx("option",{value:"",children:""}),jt.sort().map(H=>i.jsxs("option",{value:H,children:[H," (",me[ct(H)]||0,")"]},H))]}),i.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[i.jsx("button",{className:`tag-filter-btn ${Se==="normal"?"active":""}`,onClick:()=>ke("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),i.jsx("button",{className:`tag-filter-btn ${Se==="all"?"active":""}`,onClick:()=>ke("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),m?i.jsx(Uf,{label:U?"":"",subLabel:U?void 0:"",variant:"inline",showLogo:!1}):h.length===0?i.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[R==="trash"?"":"",k!==""&&i.jsx("p",{children:""})]}):i.jsxs("div",{className:"main-content-wrapper",children:[R==="list"&&i.jsx("div",{className:"recent-list-wrapper",children:i.jsx(oT,{recipes:h,recentIds:S,onSelect:Ve})}),i.jsx("div",{className:"recipe-list-container",children:R==="list"?i.jsx(Ji,{sensors:Vt,collisionDetection:$f,onDragEnd:wt,children:i.jsx(Mv,{recipes:He,onSelectRecipe:Ve,isSelectMode:ae,selectedIds:J,onToggleSelection:Xt,disableDrag:!Xe,displayMode:Se,publicRecipeView:Z,showOwner:n?.role==="admin",ownerLabelFn:Dt,currentUser:n})}):i.jsx(Mv,{recipes:He,onSelectRecipe:Ve,isSelectMode:ae,selectedIds:J,onToggleSelection:Xt,disableDrag:!0,displayMode:Se,publicRecipeView:Z,showOwner:n?.role==="admin",ownerLabelFn:Dt,currentUser:n})})]})]}),R==="detail"&&K&&i.jsx(UE,{recipe:K,ownerLabel:n?.role==="admin"?Dt(K):void 0,isDeleted:!!K.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):K.deletedAt?kt():Ze()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?Ze:void 0,onEdit:()=>d({view:"edit",id:K.id,from:u.get("from")}),onDelete:et,onView:je,onHardDelete:Mt,onDuplicate:Ke}),R==="edit"&&F&&(V?i.jsx(Uf,{label:"",subLabel:"URL"}):G&&i.jsx(Ex,{initialData:G,onCancel:()=>d({view:"detail",id:F}),onSave:H=>Bt(H,!0)},`edit-${F}`)),R==="create"&&i.jsx(Ex,{initialData:oe,onCancel:()=>{d({view:"list"}),ge(null)},onSave:H=>Bt(H,!1)},oe?"create-form-imported":"create-form"),L&&i.jsx(db,{initialMode:L,onClose:()=>Y(null),onImport:Qe}),(R==="data"||R==="data-management")&&i.jsx(lT,{onBack:()=>d({view:"list"})}),R==="levain-guide"&&i.jsx(cT,{onBack:()=>d({view:"list"})}),R==="users"&&n?.role==="admin"&&i.jsx(uT,{onBack:()=>d({view:"list"})}),R==="inventory"&&i.jsx(mT,{onBack:()=>d({view:"list"})}),R==="incoming-deliveries"&&i.jsx(TT,{onBack:()=>d({view:"list"})}),R==="incoming-stock"&&i.jsx(BT,{onBack:()=>d({view:"list"})}),R==="planner"&&i.jsx(FT,{onBack:()=>d({view:"list"}),onSelectRecipe:H=>Ve(H,{from:"planner"})}),R==="order-list"&&i.jsx(HT,{onBack:()=>d({view:"list"})})]}):i.jsx(QT,{})}function XT(){return i.jsx(YT,{children:i.jsx(GT,{children:i.jsx(JT,{})})})}class ZT extends _e.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,s){console.error("Uncaught error:",t,s),this.setState({error:t,errorInfo:s})}render(){return this.state.hasError?i.jsxs("div",{style:{padding:"2rem",color:"red"},children:[i.jsx("h1",{children:""}),i.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),i.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),i.jsx("br",{}),i.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}fS.createRoot(document.getElementById("root")).render(i.jsx(b.StrictMode,{children:i.jsx(ZT,{children:i.jsx(Mj,{children:i.jsx(XT,{})})})}));export{Ux as a,eR as c,tR as g};
