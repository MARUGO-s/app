(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(o){if(o.ep)return;o.ep=!0;const u=i(o);fetch(o.href,u)}})();var SA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function jA(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var i=function a(){var o=!1;try{o=this instanceof a}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(a){var o=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(i,a,o.get?o:{enumerable:!0,get:function(){return n[a]}})}),i}var vf={exports:{}},Co={};var Av;function GS(){if(Av)return Co;Av=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(a,o,u){var d=null;if(u!==void 0&&(d=""+u),o.key!==void 0&&(d=""+o.key),"key"in o){u={};for(var f in o)f!=="key"&&(u[f]=o[f])}else u=o;return o=u.ref,{$$typeof:n,type:a,key:d,ref:o!==void 0?o:null,props:u}}return Co.Fragment=t,Co.jsx=i,Co.jsxs=i,Co}var Rv;function KS(){return Rv||(Rv=1,vf.exports=GS()),vf.exports}var s=KS(),xf={exports:{}},$t={};var Ov;function YS(){if(Ov)return $t;Ov=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function b(q){return q===null||typeof q!="object"?null:(q=x&&q[x]||q["@@iterator"],typeof q=="function"?q:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,S={};function N(q,Y,ae){this.props=q,this.context=Y,this.refs=S,this.updater=ae||_}N.prototype.isReactComponent={},N.prototype.setState=function(q,Y){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,Y,"setState")},N.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function k(){}k.prototype=N.prototype;function D(q,Y,ae){this.props=q,this.context=Y,this.refs=S,this.updater=ae||_}var L=D.prototype=new k;L.constructor=D,C(L,N.prototype),L.isPureReactComponent=!0;var $=Array.isArray;function E(){}var A={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function M(q,Y,ae){var xe=ae.ref;return{$$typeof:n,type:q,key:Y,ref:xe!==void 0?xe:null,props:ae}}function V(q,Y){return M(q.type,Y,q.props)}function U(q){return typeof q=="object"&&q!==null&&q.$$typeof===n}function F(q){var Y={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(ae){return Y[ae]})}var ne=/\/+/g;function P(q,Y){return typeof q=="object"&&q!==null&&q.key!=null?F(""+q.key):Y.toString(36)}function B(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(E,E):(q.status="pending",q.then(function(Y){q.status==="pending"&&(q.status="fulfilled",q.value=Y)},function(Y){q.status==="pending"&&(q.status="rejected",q.reason=Y)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function T(q,Y,ae,xe,ve){var Ee=typeof q;(Ee==="undefined"||Ee==="boolean")&&(q=null);var he=!1;if(q===null)he=!0;else switch(Ee){case"bigint":case"string":case"number":he=!0;break;case"object":switch(q.$$typeof){case n:case t:he=!0;break;case y:return he=q._init,T(he(q._payload),Y,ae,xe,ve)}}if(he)return ve=ve(q),he=xe===""?"."+P(q,0):xe,$(ve)?(ae="",he!=null&&(ae=he.replace(ne,"$&/")+"/"),T(ve,Y,ae,"",function(Z){return Z})):ve!=null&&(U(ve)&&(ve=V(ve,ae+(ve.key==null||q&&q.key===ve.key?"":(""+ve.key).replace(ne,"$&/")+"/")+he)),Y.push(ve)),1;he=0;var G=xe===""?".":xe+":";if($(q))for(var ge=0;ge<q.length;ge++)xe=q[ge],Ee=G+P(xe,ge),he+=T(xe,Y,ae,Ee,ve);else if(ge=b(q),typeof ge=="function")for(q=ge.call(q),ge=0;!(xe=q.next()).done;)xe=xe.value,Ee=G+P(xe,ge++),he+=T(xe,Y,ae,Ee,ve);else if(Ee==="object"){if(typeof q.then=="function")return T(B(q),Y,ae,xe,ve);throw Y=String(q),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return he}function z(q,Y,ae){if(q==null)return q;var xe=[],ve=0;return T(q,xe,"","",function(Ee){return Y.call(ae,Ee,ve++)}),xe}function H(q){if(q._status===-1){var Y=q._result;Y=Y(),Y.then(function(ae){(q._status===0||q._status===-1)&&(q._status=1,q._result=ae)},function(ae){(q._status===0||q._status===-1)&&(q._status=2,q._result=ae)}),q._status===-1&&(q._status=0,q._result=Y)}if(q._status===1)return q._result.default;throw q._result}var J=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},de={map:z,forEach:function(q,Y,ae){z(q,function(){Y.apply(this,arguments)},ae)},count:function(q){var Y=0;return z(q,function(){Y++}),Y},toArray:function(q){return z(q,function(Y){return Y})||[]},only:function(q){if(!U(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return $t.Activity=v,$t.Children=de,$t.Component=N,$t.Fragment=i,$t.Profiler=o,$t.PureComponent=D,$t.StrictMode=a,$t.Suspense=h,$t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,$t.__COMPILER_RUNTIME={__proto__:null,c:function(q){return A.H.useMemoCache(q)}},$t.cache=function(q){return function(){return q.apply(null,arguments)}},$t.cacheSignal=function(){return null},$t.cloneElement=function(q,Y,ae){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var xe=C({},q.props),ve=q.key;if(Y!=null)for(Ee in Y.key!==void 0&&(ve=""+Y.key),Y)!R.call(Y,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&Y.ref===void 0||(xe[Ee]=Y[Ee]);var Ee=arguments.length-2;if(Ee===1)xe.children=ae;else if(1<Ee){for(var he=Array(Ee),G=0;G<Ee;G++)he[G]=arguments[G+2];xe.children=he}return M(q.type,ve,xe)},$t.createContext=function(q){return q={$$typeof:d,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:u,_context:q},q},$t.createElement=function(q,Y,ae){var xe,ve={},Ee=null;if(Y!=null)for(xe in Y.key!==void 0&&(Ee=""+Y.key),Y)R.call(Y,xe)&&xe!=="key"&&xe!=="__self"&&xe!=="__source"&&(ve[xe]=Y[xe]);var he=arguments.length-2;if(he===1)ve.children=ae;else if(1<he){for(var G=Array(he),ge=0;ge<he;ge++)G[ge]=arguments[ge+2];ve.children=G}if(q&&q.defaultProps)for(xe in he=q.defaultProps,he)ve[xe]===void 0&&(ve[xe]=he[xe]);return M(q,Ee,ve)},$t.createRef=function(){return{current:null}},$t.forwardRef=function(q){return{$$typeof:f,render:q}},$t.isValidElement=U,$t.lazy=function(q){return{$$typeof:y,_payload:{_status:-1,_result:q},_init:H}},$t.memo=function(q,Y){return{$$typeof:m,type:q,compare:Y===void 0?null:Y}},$t.startTransition=function(q){var Y=A.T,ae={};A.T=ae;try{var xe=q(),ve=A.S;ve!==null&&ve(ae,xe),typeof xe=="object"&&xe!==null&&typeof xe.then=="function"&&xe.then(E,J)}catch(Ee){J(Ee)}finally{Y!==null&&ae.types!==null&&(Y.types=ae.types),A.T=Y}},$t.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},$t.use=function(q){return A.H.use(q)},$t.useActionState=function(q,Y,ae){return A.H.useActionState(q,Y,ae)},$t.useCallback=function(q,Y){return A.H.useCallback(q,Y)},$t.useContext=function(q){return A.H.useContext(q)},$t.useDebugValue=function(){},$t.useDeferredValue=function(q,Y){return A.H.useDeferredValue(q,Y)},$t.useEffect=function(q,Y){return A.H.useEffect(q,Y)},$t.useEffectEvent=function(q){return A.H.useEffectEvent(q)},$t.useId=function(){return A.H.useId()},$t.useImperativeHandle=function(q,Y,ae){return A.H.useImperativeHandle(q,Y,ae)},$t.useInsertionEffect=function(q,Y){return A.H.useInsertionEffect(q,Y)},$t.useLayoutEffect=function(q,Y){return A.H.useLayoutEffect(q,Y)},$t.useMemo=function(q,Y){return A.H.useMemo(q,Y)},$t.useOptimistic=function(q,Y){return A.H.useOptimistic(q,Y)},$t.useReducer=function(q,Y,ae){return A.H.useReducer(q,Y,ae)},$t.useRef=function(q){return A.H.useRef(q)},$t.useState=function(q){return A.H.useState(q)},$t.useSyncExternalStore=function(q,Y,ae){return A.H.useSyncExternalStore(q,Y,ae)},$t.useTransition=function(){return A.H.useTransition()},$t.version="19.2.3",$t}var Dv;function tc(){return Dv||(Dv=1,xf.exports=YS()),xf.exports}var w=tc();const _e=_0(w);var bf={exports:{}},No={},wf={exports:{}},Sf={};var Mv;function WS(){return Mv||(Mv=1,(function(n){function t(T,z){var H=T.length;T.push(z);e:for(;0<H;){var J=H-1>>>1,de=T[J];if(0<o(de,z))T[J]=z,T[H]=de,H=J;else break e}}function i(T){return T.length===0?null:T[0]}function a(T){if(T.length===0)return null;var z=T[0],H=T.pop();if(H!==z){T[0]=H;e:for(var J=0,de=T.length,q=de>>>1;J<q;){var Y=2*(J+1)-1,ae=T[Y],xe=Y+1,ve=T[xe];if(0>o(ae,H))xe<de&&0>o(ve,ae)?(T[J]=ve,T[xe]=H,J=xe):(T[J]=ae,T[Y]=H,J=Y);else if(xe<de&&0>o(ve,H))T[J]=ve,T[xe]=H,J=xe;else break e}}return z}function o(T,z){var H=T.sortIndex-z.sortIndex;return H!==0?H:T.id-z.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,f=d.now();n.unstable_now=function(){return d.now()-f}}var h=[],m=[],y=1,v=null,x=3,b=!1,_=!1,C=!1,S=!1,N=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function L(T){for(var z=i(m);z!==null;){if(z.callback===null)a(m);else if(z.startTime<=T)a(m),z.sortIndex=z.expirationTime,t(h,z);else break;z=i(m)}}function $(T){if(C=!1,L(T),!_)if(i(h)!==null)_=!0,E||(E=!0,F());else{var z=i(m);z!==null&&B($,z.startTime-T)}}var E=!1,A=-1,R=5,M=-1;function V(){return S?!0:!(n.unstable_now()-M<R)}function U(){if(S=!1,E){var T=n.unstable_now();M=T;var z=!0;try{e:{_=!1,C&&(C=!1,k(A),A=-1),b=!0;var H=x;try{t:{for(L(T),v=i(h);v!==null&&!(v.expirationTime>T&&V());){var J=v.callback;if(typeof J=="function"){v.callback=null,x=v.priorityLevel;var de=J(v.expirationTime<=T);if(T=n.unstable_now(),typeof de=="function"){v.callback=de,L(T),z=!0;break t}v===i(h)&&a(h),L(T)}else a(h);v=i(h)}if(v!==null)z=!0;else{var q=i(m);q!==null&&B($,q.startTime-T),z=!1}}break e}finally{v=null,x=H,b=!1}z=void 0}}finally{z?F():E=!1}}}var F;if(typeof D=="function")F=function(){D(U)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,P=ne.port2;ne.port1.onmessage=U,F=function(){P.postMessage(null)}}else F=function(){N(U,0)};function B(T,z){A=N(function(){T(n.unstable_now())},z)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(T){T.callback=null},n.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<T?Math.floor(1e3/T):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(T){switch(x){case 1:case 2:case 3:var z=3;break;default:z=x}var H=x;x=z;try{return T()}finally{x=H}},n.unstable_requestPaint=function(){S=!0},n.unstable_runWithPriority=function(T,z){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var H=x;x=T;try{return z()}finally{x=H}},n.unstable_scheduleCallback=function(T,z,H){var J=n.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?J+H:J):H=J,T){case 1:var de=-1;break;case 2:de=250;break;case 5:de=1073741823;break;case 4:de=1e4;break;default:de=5e3}return de=H+de,T={id:y++,callback:z,priorityLevel:T,startTime:H,expirationTime:de,sortIndex:-1},H>J?(T.sortIndex=H,t(m,T),i(h)===null&&T===i(m)&&(C?(k(A),A=-1):C=!0,B($,H-J))):(T.sortIndex=de,t(h,T),_||b||(_=!0,E||(E=!0,F()))),T},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(T){var z=x;return function(){var H=x;x=z;try{return T.apply(this,arguments)}finally{x=H}}}})(Sf)),Sf}var zv;function QS(){return zv||(zv=1,wf.exports=WS()),wf.exports}var jf={exports:{}},or={};var Lv;function JS(){if(Lv)return or;Lv=1;var n=tc();function t(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(h,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:h,containerInfo:m,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return or.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,or.createPortal=function(h,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return u(h,m,null,y)},or.flushSync=function(h){var m=d.T,y=a.p;try{if(d.T=null,a.p=2,h)return h()}finally{d.T=m,a.p=y,a.d.f()}},or.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,a.d.C(h,m))},or.prefetchDNS=function(h){typeof h=="string"&&a.d.D(h)},or.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var y=m.as,v=f(y,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,b=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?a.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:b}):y==="script"&&a.d.X(h,{crossOrigin:v,integrity:x,fetchPriority:b,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},or.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=f(m.as,m.crossOrigin);a.d.M(h,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&a.d.M(h)},or.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=f(y,m.crossOrigin);a.d.L(h,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},or.preloadModule=function(h,m){if(typeof h=="string")if(m){var y=f(m.as,m.crossOrigin);a.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else a.d.m(h)},or.requestFormReset=function(h){a.d.r(h)},or.unstable_batchedUpdates=function(h,m){return h(m)},or.useFormState=function(h,m,y){return d.H.useFormState(h,m,y)},or.useFormStatus=function(){return d.H.useHostTransitionStatus()},or.version="19.2.3",or}var Uv;function C0(){if(Uv)return jf.exports;Uv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),jf.exports=JS(),jf.exports}var Iv;function XS(){if(Iv)return No;Iv=1;var n=QS(),t=tc(),i=C0();function a(e){var r="https://react.dev/errors/"+e;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var r=e,l=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,(r.flags&4098)!==0&&(l=r.return),e=r.return;while(e)}return r.tag===3?l:null}function d(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function f(e){if(e.tag===31){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(a(188))}function m(e){var r=e.alternate;if(!r){if(r=u(e),r===null)throw Error(a(188));return r!==e?null:e}for(var l=e,c=r;;){var p=l.return;if(p===null)break;var g=p.alternate;if(g===null){if(c=p.return,c!==null){l=c;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===l)return h(p),e;if(g===c)return h(p),r;g=g.sibling}throw Error(a(188))}if(l.return!==c.return)l=p,c=g;else{for(var j=!1,O=p.child;O;){if(O===l){j=!0,l=p,c=g;break}if(O===c){j=!0,c=p,l=g;break}O=O.sibling}if(!j){for(O=g.child;O;){if(O===l){j=!0,l=g,c=p;break}if(O===c){j=!0,c=g,l=p;break}O=O.sibling}if(!j)throw Error(a(189))}}if(l.alternate!==c)throw Error(a(190))}if(l.tag!==3)throw Error(a(188));return l.stateNode.current===l?e:r}function y(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e;for(e=e.child;e!==null;){if(r=y(e),r!==null)return r;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),D=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function F(e){return e===null||typeof e!="object"?null:(e=U&&e[U]||e["@@iterator"],typeof e=="function"?e:null)}var ne=Symbol.for("react.client.reference");function P(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===ne?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case C:return"Fragment";case N:return"Profiler";case S:return"StrictMode";case $:return"Suspense";case E:return"SuspenseList";case M:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case D:return e.displayName||"Context";case k:return(e._context.displayName||"Context")+".Consumer";case L:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case A:return r=e.displayName||null,r!==null?r:P(e.type)||"Memo";case R:r=e._payload,e=e._init;try{return P(e(r))}catch{}}return null}var B=Array.isArray,T=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H={pending:!1,data:null,method:null,action:null},J=[],de=-1;function q(e){return{current:e}}function Y(e){0>de||(e.current=J[de],J[de]=null,de--)}function ae(e,r){de++,J[de]=e.current,e.current=r}var xe=q(null),ve=q(null),Ee=q(null),he=q(null);function G(e,r){switch(ae(Ee,r),ae(ve,e),ae(xe,null),r.nodeType){case 9:case 11:e=(e=r.documentElement)&&(e=e.namespaceURI)?Zy(e):0;break;default:if(e=r.tagName,r=r.namespaceURI)r=Zy(r),e=ev(r,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Y(xe),ae(xe,e)}function ge(){Y(xe),Y(ve),Y(Ee)}function Z(e){e.memoizedState!==null&&ae(he,e);var r=xe.current,l=ev(r,e.type);r!==l&&(ae(ve,e),ae(xe,l))}function Ce(e){ve.current===e&&(Y(xe),Y(ve)),he.current===e&&(Y(he),wo._currentValue=H)}var be,We;function Re(e){if(be===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);be=r&&r[1]||"",We=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+be+e+We}var Pe=!1;function Ze(e,r){if(!e||Pe)return"";Pe=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(r){var Me=function(){throw Error()};if(Object.defineProperty(Me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Me,[])}catch(je){var ye=je}Reflect.construct(e,[],Me)}else{try{Me.call()}catch(je){ye=je}e.call(Me.prototype)}}else{try{throw Error()}catch(je){ye=je}(Me=e())&&typeof Me.catch=="function"&&Me.catch(function(){})}}catch(je){if(je&&ye&&typeof je.stack=="string")return[je.stack,ye.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),j=g[0],O=g[1];if(j&&O){var K=j.split(`
`),me=O.split(`
`);for(p=c=0;c<K.length&&!K[c].includes("DetermineComponentFrameRoot");)c++;for(;p<me.length&&!me[p].includes("DetermineComponentFrameRoot");)p++;if(c===K.length||p===me.length)for(c=K.length-1,p=me.length-1;1<=c&&0<=p&&K[c]!==me[p];)p--;for(;1<=c&&0<=p;c--,p--)if(K[c]!==me[p]){if(c!==1||p!==1)do if(c--,p--,0>p||K[c]!==me[p]){var ke=`
`+K[c].replace(" at new "," at ");return e.displayName&&ke.includes("<anonymous>")&&(ke=ke.replace("<anonymous>",e.displayName)),ke}while(1<=c&&0<=p);break}}}finally{Pe=!1,Error.prepareStackTrace=l}return(l=e?e.displayName||e.name:"")?Re(l):""}function rt(e,r){switch(e.tag){case 26:case 27:case 5:return Re(e.type);case 16:return Re("Lazy");case 13:return e.child!==r&&r!==null?Re("Suspense Fallback"):Re("Suspense");case 19:return Re("SuspenseList");case 0:case 15:return Ze(e.type,!1);case 11:return Ze(e.type.render,!1);case 1:return Ze(e.type,!0);case 31:return Re("Activity");default:return""}}function qe(e){try{var r="",l=null;do r+=rt(e,l),l=e,e=e.return;while(e);return r}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var Ae=Object.prototype.hasOwnProperty,Se=n.unstable_scheduleCallback,te=n.unstable_cancelCallback,Be=n.unstable_shouldYield,ut=n.unstable_requestPaint,Ct=n.unstable_now,Rt=n.unstable_getCurrentPriorityLevel,mt=n.unstable_ImmediatePriority,Ot=n.unstable_UserBlockingPriority,jt=n.unstable_NormalPriority,ft=n.unstable_LowPriority,Vt=n.unstable_IdlePriority,an=n.log,xn=n.unstable_setDisableYieldValue,Mt=null,nn=null;function cn(e){if(typeof an=="function"&&xn(e),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(Mt,e)}catch{}}var Gt=Math.clz32?Math.clz32:ee,Xn=Math.log,ar=Math.LN2;function ee(e){return e>>>=0,e===0?32:31-(Xn(e)/ar|0)|0}var De=256,Te=262144,Ue=4194304;function He(e){var r=e&42;if(r!==0)return r;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function it(e,r,l){var c=e.pendingLanes;if(c===0)return 0;var p=0,g=e.suspendedLanes,j=e.pingedLanes;e=e.warmLanes;var O=c&134217727;return O!==0?(c=O&~g,c!==0?p=He(c):(j&=O,j!==0?p=He(j):l||(l=O&~e,l!==0&&(p=He(l))))):(O=c&~g,O!==0?p=He(O):j!==0?p=He(j):l||(l=c&~e,l!==0&&(p=He(l)))),p===0?0:r!==0&&r!==p&&(r&g)===0&&(g=p&-p,l=r&-r,g>=l||g===32&&(l&4194048)!==0)?r:p}function gt(e,r){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&r)===0}function Lt(e,r){switch(e){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pt(){var e=Ue;return Ue<<=1,(Ue&62914560)===0&&(Ue=4194304),e}function dn(e){for(var r=[],l=0;31>l;l++)r.push(e);return r}function ue(e,r){e.pendingLanes|=r,r!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ke(e,r,l,c,p,g){var j=e.pendingLanes;e.pendingLanes=l,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=l,e.entangledLanes&=l,e.errorRecoveryDisabledLanes&=l,e.shellSuspendCounter=0;var O=e.entanglements,K=e.expirationTimes,me=e.hiddenUpdates;for(l=j&~l;0<l;){var ke=31-Gt(l),Me=1<<ke;O[ke]=0,K[ke]=-1;var ye=me[ke];if(ye!==null)for(me[ke]=null,ke=0;ke<ye.length;ke++){var je=ye[ke];je!==null&&(je.lane&=-536870913)}l&=~Me}c!==0&&at(e,c,0),g!==0&&p===0&&e.tag!==0&&(e.suspendedLanes|=g&~(j&~r))}function at(e,r,l){e.pendingLanes|=r,e.suspendedLanes&=~r;var c=31-Gt(r);e.entangledLanes|=r,e.entanglements[c]=e.entanglements[c]|1073741824|l&261930}function Ye(e,r){var l=e.entangledLanes|=r;for(e=e.entanglements;l;){var c=31-Gt(l),p=1<<c;p&r|e[c]&r&&(e[c]|=r),l&=~p}}function kt(e,r){var l=r&-r;return l=(l&42)!==0?1:xt(l),(l&(e.suspendedLanes|r))!==0?0:l}function xt(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Dt(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Ft(){var e=z.p;return e!==0?e:(e=window.event,e===void 0?32:jv(e.type))}function ot(e,r){var l=z.p;try{return z.p=e,r()}finally{z.p=l}}var re=Math.random().toString(36).slice(2),$e="__reactFiber$"+re,Ve="__reactProps$"+re,_t="__reactContainer$"+re,W="__reactEvents$"+re,X="__reactListeners$"+re,oe="__reactHandles$"+re,fe="__reactResources$"+re,ze="__reactMarker$"+re;function Fe(e){delete e[$e],delete e[Ve],delete e[W],delete e[X],delete e[oe]}function Je(e){var r=e[$e];if(r)return r;for(var l=e.parentNode;l;){if(r=l[_t]||l[$e]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(e=lv(e);e!==null;){if(l=e[$e])return l;e=lv(e)}return r}e=l,l=e.parentNode}return null}function Qe(e){if(e=e[$e]||e[_t]){var r=e.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return e}return null}function wt(e){var r=e.tag;if(r===5||r===26||r===27||r===6)return e.stateNode;throw Error(a(33))}function St(e){var r=e[fe];return r||(r=e[fe]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function It(e){e[ze]=!0}var et=new Set,Nt={};function Qt(e,r){un(e,r),un(e+"Capture",r)}function un(e,r){for(Nt[e]=r,e=0;e<r.length;e++)et.add(r[e])}var Kn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sr={},Jr={};function Mr(e){return Ae.call(Jr,e)?!0:Ae.call(Sr,e)?!1:Kn.test(e)?Jr[e]=!0:(Sr[e]=!0,!1)}function Ui(e,r,l){if(Mr(r))if(l===null)e.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":e.removeAttribute(r);return;case"boolean":var c=r.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(r);return}}e.setAttribute(r,""+l)}}function Ws(e,r,l){if(l===null)e.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(r);return}e.setAttribute(r,""+l)}}function Xr(e,r,l,c){if(c===null)e.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(l);return}e.setAttributeNS(r,l,""+c)}}function lr(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ii(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Sa(e,r,l){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,r);if(!e.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,g=c.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return p.call(this)},set:function(j){l=""+j,g.call(this,j)}}),Object.defineProperty(e,r,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(j){l=""+j},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function ja(e){if(!e._valueTracker){var r=Ii(e)?"checked":"value";e._valueTracker=Sa(e,r,""+e[r])}}function hc(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var l=r.getValue(),c="";return e&&(c=Ii(e)?e.checked?"true":"false":e.value),e=c,e!==l?(r.setValue(e),!0):!1}function _a(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var bd=/[\n"\\]/g;function fr(e){return e.replace(bd,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Bi(e,r,l,c,p,g,j,O){e.name="",j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?e.type=j:e.removeAttribute("type"),r!=null?j==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+lr(r)):e.value!==""+lr(r)&&(e.value=""+lr(r)):j!=="submit"&&j!=="reset"||e.removeAttribute("value"),r!=null?Ol(e,j,lr(r)):l!=null?Ol(e,j,lr(l)):c!=null&&e.removeAttribute("value"),p==null&&g!=null&&(e.defaultChecked=!!g),p!=null&&(e.checked=p&&typeof p!="function"&&typeof p!="symbol"),O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?e.name=""+lr(O):e.removeAttribute("name")}function fc(e,r,l,c,p,g,j,O){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),r!=null||l!=null){if(!(g!=="submit"&&g!=="reset"||r!=null)){ja(e);return}l=l!=null?""+lr(l):"",r=r!=null?""+lr(r):l,O||r===e.value||(e.value=r),e.defaultValue=r}c=c??p,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=O?e.checked:!!c,e.defaultChecked=!!c,j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(e.name=j),ja(e)}function Ol(e,r,l){r==="number"&&_a(e.ownerDocument)===e||e.defaultValue===""+l||(e.defaultValue=""+l)}function zr(e,r,l,c){if(e=e.options,r){r={};for(var p=0;p<l.length;p++)r["$"+l[p]]=!0;for(l=0;l<e.length;l++)p=r.hasOwnProperty("$"+e[l].value),e[l].selected!==p&&(e[l].selected=p),p&&c&&(e[l].defaultSelected=!0)}else{for(l=""+lr(l),r=null,p=0;p<e.length;p++){if(e[p].value===l){e[p].selected=!0,c&&(e[p].defaultSelected=!0);return}r!==null||e[p].disabled||(r=e[p])}r!==null&&(r.selected=!0)}}function pc(e,r,l){if(r!=null&&(r=""+lr(r),r!==e.value&&(e.value=r),l==null)){e.defaultValue!==r&&(e.defaultValue=r);return}e.defaultValue=l!=null?""+lr(l):""}function mc(e,r,l,c){if(r==null){if(c!=null){if(l!=null)throw Error(a(92));if(B(c)){if(1<c.length)throw Error(a(93));c=c[0]}l=c}l==null&&(l=""),r=l}l=lr(r),e.defaultValue=l,c=e.textContent,c===l&&c!==""&&c!==null&&(e.value=c),ja(e)}function Qs(e,r){if(r){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=r;return}}e.textContent=r}var wd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Dl(e,r,l){var c=r.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="":c?e.setProperty(r,l):typeof l!="number"||l===0||wd.has(r)?r==="float"?e.cssFloat=l:e[r]=(""+l).trim():e[r]=l+"px"}function Ml(e,r,l){if(r!=null&&typeof r!="object")throw Error(a(62));if(e=e.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||r!=null&&r.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var p in r)c=r[p],r.hasOwnProperty(p)&&l[p]!==c&&Dl(e,p,c)}else for(var g in r)r.hasOwnProperty(g)&&Dl(e,g,r[g])}function zl(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sd=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ca(e){return gc.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Lr(){}var Ll=null;function Ul(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Js=null,Xs=null;function Il(e){var r=Qe(e);if(r&&(e=r.stateNode)){var l=e[Ve]||null;e:switch(e=r.stateNode,r.type){case"input":if(Bi(e,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),r=l.name,l.type==="radio"&&r!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+fr(""+r)+'"][type="radio"]'),r=0;r<l.length;r++){var c=l[r];if(c!==e&&c.form===e.form){var p=c[Ve]||null;if(!p)throw Error(a(90));Bi(c,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(r=0;r<l.length;r++)c=l[r],c.form===e.form&&hc(c)}break e;case"textarea":pc(e,l.value,l.defaultValue);break e;case"select":r=l.value,r!=null&&zr(e,!!l.multiple,r,!1)}}}var Bl=!1;function $i(e,r,l){if(Bl)return e(r,l);Bl=!0;try{var c=e(r);return c}finally{if(Bl=!1,(Js!==null||Xs!==null)&&(Xc(),Js&&(r=Js,e=Xs,Xs=Js=null,Il(r),e)))for(r=0;r<e.length;r++)Il(e[r])}}function Zs(e,r){var l=e.stateNode;if(l===null)return null;var c=l[Ve]||null;if(c===null)return null;l=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(a(231,r,typeof l));return l}var Zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),I=!1;if(Zr)try{var Q={};Object.defineProperty(Q,"passive",{get:function(){I=!0}}),window.addEventListener("test",Q,Q),window.removeEventListener("test",Q,Q)}catch{I=!1}var ie=null,we=null,Le=null;function Ie(){if(Le)return Le;var e,r=we,l=r.length,c,p="value"in ie?ie.value:ie.textContent,g=p.length;for(e=0;e<l&&r[e]===p[e];e++);var j=l-e;for(c=1;c<=j&&r[l-c]===p[g-c];c++);return Le=p.slice(e,1<c?1-c:void 0)}function Ge(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function Xe(){return!0}function tt(){return!1}function st(e){function r(l,c,p,g,j){this._reactName=l,this._targetInst=p,this.type=c,this.nativeEvent=g,this.target=j,this.currentTarget=null;for(var O in e)e.hasOwnProperty(O)&&(l=e[O],this[O]=l?l(g):g[O]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?Xe:tt,this.isPropagationStopped=tt,this}return v(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Xe)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Xe)},persist:function(){},isPersistent:Xe}),r}var ct={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pt=st(ct),nt=v({},ct,{view:0,detail:0}),Ut=st(nt),Cn,Nn,Ur,es=v({},nt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ti,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ur&&(Ur&&e.type==="mousemove"?(Cn=e.screenX-Ur.screenX,Nn=e.screenY-Ur.screenY):Nn=Cn=0,Ur=e),Cn)},movementY:function(e){return"movementY"in e?e.movementY:Nn}}),ht=st(es),bt=v({},es,{dataTransfer:0}),Bt=st(bt),Sn=v({},nt,{relatedTarget:0}),kn=st(Sn),Ln=v({},ct,{animationName:0,elapsedTime:0,pseudoElement:0}),Jt=st(Ln),pr=v({},ct,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Un=st(pr),ws=v({},ct,{data:0}),ts=st(ws),ei={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$l={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ss(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=rm[e])?!!r[e]:!1}function ti(){return Ss}var Pi=v({},nt,{key:function(e){if(e.key){var r=ei[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=Ge(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?$l[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ti,charCode:function(e){return e.type==="keypress"?Ge(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ge(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),sw=st(Pi),iw=v({},es,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sm=st(iw),aw=v({},nt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ti}),lw=st(aw),ow=v({},ct,{propertyName:0,elapsedTime:0,pseudoElement:0}),cw=st(ow),uw=v({},es,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),dw=st(uw),hw=v({},ct,{newState:0,oldState:0}),fw=st(hw),pw=[9,13,27,32],jd=Zr&&"CompositionEvent"in window,Pl=null;Zr&&"documentMode"in document&&(Pl=document.documentMode);var mw=Zr&&"TextEvent"in window&&!Pl,im=Zr&&(!jd||Pl&&8<Pl&&11>=Pl),am=" ",lm=!1;function om(e,r){switch(e){case"keyup":return pw.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Na=!1;function gw(e,r){switch(e){case"compositionend":return cm(r);case"keypress":return r.which!==32?null:(lm=!0,am);case"textInput":return e=r.data,e===am&&lm?null:e;default:return null}}function yw(e,r){if(Na)return e==="compositionend"||!jd&&om(e,r)?(e=Ie(),Le=we=ie=null,Na=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return im&&r.locale!=="ko"?null:r.data;default:return null}}var vw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function um(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!vw[e.type]:r==="textarea"}function dm(e,r,l,c){Js?Xs?Xs.push(c):Xs=[c]:Js=c,r=iu(r,"onChange"),0<r.length&&(l=new pt("onChange","change",null,l,c),e.push({event:l,listeners:r}))}var ql=null,Fl=null;function xw(e){Ky(e,0)}function yc(e){var r=wt(e);if(hc(r))return e}function hm(e,r){if(e==="change")return r}var fm=!1;if(Zr){var _d;if(Zr){var Cd="oninput"in document;if(!Cd){var pm=document.createElement("div");pm.setAttribute("oninput","return;"),Cd=typeof pm.oninput=="function"}_d=Cd}else _d=!1;fm=_d&&(!document.documentMode||9<document.documentMode)}function mm(){ql&&(ql.detachEvent("onpropertychange",gm),Fl=ql=null)}function gm(e){if(e.propertyName==="value"&&yc(Fl)){var r=[];dm(r,Fl,e,Ul(e)),$i(xw,r)}}function bw(e,r,l){e==="focusin"?(mm(),ql=r,Fl=l,ql.attachEvent("onpropertychange",gm)):e==="focusout"&&mm()}function ww(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return yc(Fl)}function Sw(e,r){if(e==="click")return yc(r)}function jw(e,r){if(e==="input"||e==="change")return yc(r)}function _w(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var jr=typeof Object.is=="function"?Object.is:_w;function Hl(e,r){if(jr(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var l=Object.keys(e),c=Object.keys(r);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var p=l[c];if(!Ae.call(r,p)||!jr(e[p],r[p]))return!1}return!0}function ym(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function vm(e,r){var l=ym(e);e=0;for(var c;l;){if(l.nodeType===3){if(c=e+l.textContent.length,e<=r&&c>=r)return{node:l,offset:r-e};e=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=ym(l)}}function xm(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?xm(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function bm(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var r=_a(e.document);r instanceof e.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)e=r.contentWindow;else break;r=_a(e.document)}return r}function Nd(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}var Cw=Zr&&"documentMode"in document&&11>=document.documentMode,Ea=null,Ed=null,Vl=null,kd=!1;function wm(e,r,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;kd||Ea==null||Ea!==_a(c)||(c=Ea,"selectionStart"in c&&Nd(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Vl&&Hl(Vl,c)||(Vl=c,c=iu(Ed,"onSelect"),0<c.length&&(r=new pt("onSelect","select",null,r,l),e.push({event:r,listeners:c}),r.target=Ea)))}function qi(e,r){var l={};return l[e.toLowerCase()]=r.toLowerCase(),l["Webkit"+e]="webkit"+r,l["Moz"+e]="moz"+r,l}var ka={animationend:qi("Animation","AnimationEnd"),animationiteration:qi("Animation","AnimationIteration"),animationstart:qi("Animation","AnimationStart"),transitionrun:qi("Transition","TransitionRun"),transitionstart:qi("Transition","TransitionStart"),transitioncancel:qi("Transition","TransitionCancel"),transitionend:qi("Transition","TransitionEnd")},Td={},Sm={};Zr&&(Sm=document.createElement("div").style,"AnimationEvent"in window||(delete ka.animationend.animation,delete ka.animationiteration.animation,delete ka.animationstart.animation),"TransitionEvent"in window||delete ka.transitionend.transition);function Fi(e){if(Td[e])return Td[e];if(!ka[e])return e;var r=ka[e],l;for(l in r)if(r.hasOwnProperty(l)&&l in Sm)return Td[e]=r[l];return e}var jm=Fi("animationend"),_m=Fi("animationiteration"),Cm=Fi("animationstart"),Nw=Fi("transitionrun"),Ew=Fi("transitionstart"),kw=Fi("transitioncancel"),Nm=Fi("transitionend"),Em=new Map,Ad="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ad.push("scrollEnd");function ns(e,r){Em.set(e,r),Qt(r,[e])}var vc=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Ir=[],Ta=0,Rd=0;function xc(){for(var e=Ta,r=Rd=Ta=0;r<e;){var l=Ir[r];Ir[r++]=null;var c=Ir[r];Ir[r++]=null;var p=Ir[r];Ir[r++]=null;var g=Ir[r];if(Ir[r++]=null,c!==null&&p!==null){var j=c.pending;j===null?p.next=p:(p.next=j.next,j.next=p),c.pending=p}g!==0&&km(l,p,g)}}function bc(e,r,l,c){Ir[Ta++]=e,Ir[Ta++]=r,Ir[Ta++]=l,Ir[Ta++]=c,Rd|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function Od(e,r,l,c){return bc(e,r,l,c),wc(e)}function Hi(e,r){return bc(e,null,null,r),wc(e)}function km(e,r,l){e.lanes|=l;var c=e.alternate;c!==null&&(c.lanes|=l);for(var p=!1,g=e.return;g!==null;)g.childLanes|=l,c=g.alternate,c!==null&&(c.childLanes|=l),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(p=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,p&&r!==null&&(p=31-Gt(l),e=g.hiddenUpdates,c=e[p],c===null?e[p]=[r]:c.push(r),r.lane=l|536870912),g):null}function wc(e){if(50<po)throw po=0,Ph=null,Error(a(185));for(var r=e.return;r!==null;)e=r,r=e.return;return e.tag===3?e.stateNode:null}var Aa={};function Tw(e,r,l,c){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _r(e,r,l,c){return new Tw(e,r,l,c)}function Dd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function js(e,r){var l=e.alternate;return l===null?(l=_r(e.tag,r,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=r,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&65011712,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,r=e.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l.refCleanup=e.refCleanup,l}function Tm(e,r){e.flags&=65011714;var l=e.alternate;return l===null?(e.childLanes=0,e.lanes=r,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=l.childLanes,e.lanes=l.lanes,e.child=l.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=l.memoizedProps,e.memoizedState=l.memoizedState,e.updateQueue=l.updateQueue,e.type=l.type,r=l.dependencies,e.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),e}function Sc(e,r,l,c,p,g){var j=0;if(c=e,typeof e=="function")Dd(e)&&(j=1);else if(typeof e=="string")j=MS(e,l,xe.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case M:return e=_r(31,l,r,p),e.elementType=M,e.lanes=g,e;case C:return Vi(l.children,p,g,r);case S:j=8,p|=24;break;case N:return e=_r(12,l,r,p|2),e.elementType=N,e.lanes=g,e;case $:return e=_r(13,l,r,p),e.elementType=$,e.lanes=g,e;case E:return e=_r(19,l,r,p),e.elementType=E,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case D:j=10;break e;case k:j=9;break e;case L:j=11;break e;case A:j=14;break e;case R:j=16,c=null;break e}j=29,l=Error(a(130,e===null?"null":typeof e,"")),c=null}return r=_r(j,l,r,p),r.elementType=e,r.type=c,r.lanes=g,r}function Vi(e,r,l,c){return e=_r(7,e,c,r),e.lanes=l,e}function Md(e,r,l){return e=_r(6,e,null,r),e.lanes=l,e}function Am(e){var r=_r(18,null,null,0);return r.stateNode=e,r}function zd(e,r,l){return r=_r(4,e.children!==null?e.children:[],e.key,r),r.lanes=l,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}var Rm=new WeakMap;function Br(e,r){if(typeof e=="object"&&e!==null){var l=Rm.get(e);return l!==void 0?l:(r={value:e,source:r,stack:qe(r)},Rm.set(e,r),r)}return{value:e,source:r,stack:qe(r)}}var Ra=[],Oa=0,jc=null,Gl=0,$r=[],Pr=0,ni=null,ps=1,ms="";function _s(e,r){Ra[Oa++]=Gl,Ra[Oa++]=jc,jc=e,Gl=r}function Om(e,r,l){$r[Pr++]=ps,$r[Pr++]=ms,$r[Pr++]=ni,ni=e;var c=ps;e=ms;var p=32-Gt(c)-1;c&=~(1<<p),l+=1;var g=32-Gt(r)+p;if(30<g){var j=p-p%5;g=(c&(1<<j)-1).toString(32),c>>=j,p-=j,ps=1<<32-Gt(r)+p|l<<p|c,ms=g+e}else ps=1<<g|l<<p|c,ms=e}function Ld(e){e.return!==null&&(_s(e,1),Om(e,1,0))}function Ud(e){for(;e===jc;)jc=Ra[--Oa],Ra[Oa]=null,Gl=Ra[--Oa],Ra[Oa]=null;for(;e===ni;)ni=$r[--Pr],$r[Pr]=null,ms=$r[--Pr],$r[Pr]=null,ps=$r[--Pr],$r[Pr]=null}function Dm(e,r){$r[Pr++]=ps,$r[Pr++]=ms,$r[Pr++]=ni,ps=r.id,ms=r.overflow,ni=e}var Zn=null,jn=null,en=!1,ri=null,qr=!1,Id=Error(a(519));function si(e){var r=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Kl(Br(r,e)),Id}function Mm(e){var r=e.stateNode,l=e.type,c=e.memoizedProps;switch(r[$e]=e,r[Ve]=c,l){case"dialog":Yt("cancel",r),Yt("close",r);break;case"iframe":case"object":case"embed":Yt("load",r);break;case"video":case"audio":for(l=0;l<go.length;l++)Yt(go[l],r);break;case"source":Yt("error",r);break;case"img":case"image":case"link":Yt("error",r),Yt("load",r);break;case"details":Yt("toggle",r);break;case"input":Yt("invalid",r),fc(r,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Yt("invalid",r);break;case"textarea":Yt("invalid",r),mc(r,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||r.textContent===""+l||c.suppressHydrationWarning===!0||Jy(r.textContent,l)?(c.popover!=null&&(Yt("beforetoggle",r),Yt("toggle",r)),c.onScroll!=null&&Yt("scroll",r),c.onScrollEnd!=null&&Yt("scrollend",r),c.onClick!=null&&(r.onclick=Lr),r=!0):r=!1,r||si(e,!0)}function zm(e){for(Zn=e.return;Zn;)switch(Zn.tag){case 5:case 31:case 13:qr=!1;return;case 27:case 3:qr=!0;return;default:Zn=Zn.return}}function Da(e){if(e!==Zn)return!1;if(!en)return zm(e),en=!0,!1;var r=e.tag,l;if((l=r!==3&&r!==27)&&((l=r===5)&&(l=e.type,l=!(l!=="form"&&l!=="button")||nf(e.type,e.memoizedProps)),l=!l),l&&jn&&si(e),zm(e),r===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));jn=av(e)}else if(r===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));jn=av(e)}else r===27?(r=jn,vi(e.type)?(e=of,of=null,jn=e):jn=r):jn=Zn?Hr(e.stateNode.nextSibling):null;return!0}function Gi(){jn=Zn=null,en=!1}function Bd(){var e=ri;return e!==null&&(vr===null?vr=e:vr.push.apply(vr,e),ri=null),e}function Kl(e){ri===null?ri=[e]:ri.push(e)}var $d=q(null),Ki=null,Cs=null;function ii(e,r,l){ae($d,r._currentValue),r._currentValue=l}function Ns(e){e._currentValue=$d.current,Y($d)}function Pd(e,r,l){for(;e!==null;){var c=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),e===l)break;e=e.return}}function qd(e,r,l,c){var p=e.child;for(p!==null&&(p.return=e);p!==null;){var g=p.dependencies;if(g!==null){var j=p.child;g=g.firstContext;e:for(;g!==null;){var O=g;g=p;for(var K=0;K<r.length;K++)if(O.context===r[K]){g.lanes|=l,O=g.alternate,O!==null&&(O.lanes|=l),Pd(g.return,l,e),c||(j=null);break e}g=O.next}}else if(p.tag===18){if(j=p.return,j===null)throw Error(a(341));j.lanes|=l,g=j.alternate,g!==null&&(g.lanes|=l),Pd(j,l,e),j=null}else j=p.child;if(j!==null)j.return=p;else for(j=p;j!==null;){if(j===e){j=null;break}if(p=j.sibling,p!==null){p.return=j.return,j=p;break}j=j.return}p=j}}function Ma(e,r,l,c){e=null;for(var p=r,g=!1;p!==null;){if(!g){if((p.flags&524288)!==0)g=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var j=p.alternate;if(j===null)throw Error(a(387));if(j=j.memoizedProps,j!==null){var O=p.type;jr(p.pendingProps.value,j.value)||(e!==null?e.push(O):e=[O])}}else if(p===he.current){if(j=p.alternate,j===null)throw Error(a(387));j.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(e!==null?e.push(wo):e=[wo])}p=p.return}e!==null&&qd(r,e,l,c),r.flags|=262144}function _c(e){for(e=e.firstContext;e!==null;){if(!jr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Yi(e){Ki=e,Cs=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function er(e){return Lm(Ki,e)}function Cc(e,r){return Ki===null&&Yi(e),Lm(e,r)}function Lm(e,r){var l=r._currentValue;if(r={context:r,memoizedValue:l,next:null},Cs===null){if(e===null)throw Error(a(308));Cs=r,e.dependencies={lanes:0,firstContext:r},e.flags|=524288}else Cs=Cs.next=r;return l}var Aw=typeof AbortController<"u"?AbortController:function(){var e=[],r=this.signal={aborted:!1,addEventListener:function(l,c){e.push(c)}};this.abort=function(){r.aborted=!0,e.forEach(function(l){return l()})}},Rw=n.unstable_scheduleCallback,Ow=n.unstable_NormalPriority,In={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Fd(){return{controller:new Aw,data:new Map,refCount:0}}function Yl(e){e.refCount--,e.refCount===0&&Rw(Ow,function(){e.controller.abort()})}var Wl=null,Hd=0,za=0,La=null;function Dw(e,r){if(Wl===null){var l=Wl=[];Hd=0,za=Kh(),La={status:"pending",value:void 0,then:function(c){l.push(c)}}}return Hd++,r.then(Um,Um),r}function Um(){if(--Hd===0&&Wl!==null){La!==null&&(La.status="fulfilled");var e=Wl;Wl=null,za=0,La=null;for(var r=0;r<e.length;r++)(0,e[r])()}}function Mw(e,r){var l=[],c={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return e.then(function(){c.status="fulfilled",c.value=r;for(var p=0;p<l.length;p++)(0,l[p])(r)},function(p){for(c.status="rejected",c.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),c}var Im=T.S;T.S=function(e,r){wy=Ct(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&Dw(e,r),Im!==null&&Im(e,r)};var Wi=q(null);function Vd(){var e=Wi.current;return e!==null?e:yn.pooledCache}function Nc(e,r){r===null?ae(Wi,Wi.current):ae(Wi,r.pool)}function Bm(){var e=Vd();return e===null?null:{parent:In._currentValue,pool:e}}var Ua=Error(a(460)),Gd=Error(a(474)),Ec=Error(a(542)),kc={then:function(){}};function $m(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Pm(e,r,l){switch(l=e[l],l===void 0?e.push(r):l!==r&&(r.then(Lr,Lr),r=l),r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,Fm(e),e;default:if(typeof r.status=="string")r.then(Lr,Lr);else{if(e=yn,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=r,e.status="pending",e.then(function(c){if(r.status==="pending"){var p=r;p.status="fulfilled",p.value=c}},function(c){if(r.status==="pending"){var p=r;p.status="rejected",p.reason=c}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw e=r.reason,Fm(e),e}throw Ji=r,Ua}}function Qi(e){try{var r=e._init;return r(e._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Ji=l,Ua):l}}var Ji=null;function qm(){if(Ji===null)throw Error(a(459));var e=Ji;return Ji=null,e}function Fm(e){if(e===Ua||e===Ec)throw Error(a(483))}var Ia=null,Ql=0;function Tc(e){var r=Ql;return Ql+=1,Ia===null&&(Ia=[]),Pm(Ia,e,r)}function Jl(e,r){r=r.props.ref,e.ref=r!==void 0?r:null}function Ac(e,r){throw r.$$typeof===x?Error(a(525)):(e=Object.prototype.toString.call(r),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)))}function Hm(e){function r(ce,se){if(e){var pe=ce.deletions;pe===null?(ce.deletions=[se],ce.flags|=16):pe.push(se)}}function l(ce,se){if(!e)return null;for(;se!==null;)r(ce,se),se=se.sibling;return null}function c(ce){for(var se=new Map;ce!==null;)ce.key!==null?se.set(ce.key,ce):se.set(ce.index,ce),ce=ce.sibling;return se}function p(ce,se){return ce=js(ce,se),ce.index=0,ce.sibling=null,ce}function g(ce,se,pe){return ce.index=pe,e?(pe=ce.alternate,pe!==null?(pe=pe.index,pe<se?(ce.flags|=67108866,se):pe):(ce.flags|=67108866,se)):(ce.flags|=1048576,se)}function j(ce){return e&&ce.alternate===null&&(ce.flags|=67108866),ce}function O(ce,se,pe,Oe){return se===null||se.tag!==6?(se=Md(pe,ce.mode,Oe),se.return=ce,se):(se=p(se,pe),se.return=ce,se)}function K(ce,se,pe,Oe){var vt=pe.type;return vt===C?ke(ce,se,pe.props.children,Oe,pe.key):se!==null&&(se.elementType===vt||typeof vt=="object"&&vt!==null&&vt.$$typeof===R&&Qi(vt)===se.type)?(se=p(se,pe.props),Jl(se,pe),se.return=ce,se):(se=Sc(pe.type,pe.key,pe.props,null,ce.mode,Oe),Jl(se,pe),se.return=ce,se)}function me(ce,se,pe,Oe){return se===null||se.tag!==4||se.stateNode.containerInfo!==pe.containerInfo||se.stateNode.implementation!==pe.implementation?(se=zd(pe,ce.mode,Oe),se.return=ce,se):(se=p(se,pe.children||[]),se.return=ce,se)}function ke(ce,se,pe,Oe,vt){return se===null||se.tag!==7?(se=Vi(pe,ce.mode,Oe,vt),se.return=ce,se):(se=p(se,pe),se.return=ce,se)}function Me(ce,se,pe){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return se=Md(""+se,ce.mode,pe),se.return=ce,se;if(typeof se=="object"&&se!==null){switch(se.$$typeof){case b:return pe=Sc(se.type,se.key,se.props,null,ce.mode,pe),Jl(pe,se),pe.return=ce,pe;case _:return se=zd(se,ce.mode,pe),se.return=ce,se;case R:return se=Qi(se),Me(ce,se,pe)}if(B(se)||F(se))return se=Vi(se,ce.mode,pe,null),se.return=ce,se;if(typeof se.then=="function")return Me(ce,Tc(se),pe);if(se.$$typeof===D)return Me(ce,Cc(ce,se),pe);Ac(ce,se)}return null}function ye(ce,se,pe,Oe){var vt=se!==null?se.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return vt!==null?null:O(ce,se,""+pe,Oe);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case b:return pe.key===vt?K(ce,se,pe,Oe):null;case _:return pe.key===vt?me(ce,se,pe,Oe):null;case R:return pe=Qi(pe),ye(ce,se,pe,Oe)}if(B(pe)||F(pe))return vt!==null?null:ke(ce,se,pe,Oe,null);if(typeof pe.then=="function")return ye(ce,se,Tc(pe),Oe);if(pe.$$typeof===D)return ye(ce,se,Cc(ce,pe),Oe);Ac(ce,pe)}return null}function je(ce,se,pe,Oe,vt){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return ce=ce.get(pe)||null,O(se,ce,""+Oe,vt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case b:return ce=ce.get(Oe.key===null?pe:Oe.key)||null,K(se,ce,Oe,vt);case _:return ce=ce.get(Oe.key===null?pe:Oe.key)||null,me(se,ce,Oe,vt);case R:return Oe=Qi(Oe),je(ce,se,pe,Oe,vt)}if(B(Oe)||F(Oe))return ce=ce.get(pe)||null,ke(se,ce,Oe,vt,null);if(typeof Oe.then=="function")return je(ce,se,pe,Tc(Oe),vt);if(Oe.$$typeof===D)return je(ce,se,pe,Cc(se,Oe),vt);Ac(se,Oe)}return null}function lt(ce,se,pe,Oe){for(var vt=null,rn=null,dt=se,Ht=se=0,Zt=null;dt!==null&&Ht<pe.length;Ht++){dt.index>Ht?(Zt=dt,dt=null):Zt=dt.sibling;var sn=ye(ce,dt,pe[Ht],Oe);if(sn===null){dt===null&&(dt=Zt);break}e&&dt&&sn.alternate===null&&r(ce,dt),se=g(sn,se,Ht),rn===null?vt=sn:rn.sibling=sn,rn=sn,dt=Zt}if(Ht===pe.length)return l(ce,dt),en&&_s(ce,Ht),vt;if(dt===null){for(;Ht<pe.length;Ht++)dt=Me(ce,pe[Ht],Oe),dt!==null&&(se=g(dt,se,Ht),rn===null?vt=dt:rn.sibling=dt,rn=dt);return en&&_s(ce,Ht),vt}for(dt=c(dt);Ht<pe.length;Ht++)Zt=je(dt,ce,Ht,pe[Ht],Oe),Zt!==null&&(e&&Zt.alternate!==null&&dt.delete(Zt.key===null?Ht:Zt.key),se=g(Zt,se,Ht),rn===null?vt=Zt:rn.sibling=Zt,rn=Zt);return e&&dt.forEach(function(ji){return r(ce,ji)}),en&&_s(ce,Ht),vt}function Et(ce,se,pe,Oe){if(pe==null)throw Error(a(151));for(var vt=null,rn=null,dt=se,Ht=se=0,Zt=null,sn=pe.next();dt!==null&&!sn.done;Ht++,sn=pe.next()){dt.index>Ht?(Zt=dt,dt=null):Zt=dt.sibling;var ji=ye(ce,dt,sn.value,Oe);if(ji===null){dt===null&&(dt=Zt);break}e&&dt&&ji.alternate===null&&r(ce,dt),se=g(ji,se,Ht),rn===null?vt=ji:rn.sibling=ji,rn=ji,dt=Zt}if(sn.done)return l(ce,dt),en&&_s(ce,Ht),vt;if(dt===null){for(;!sn.done;Ht++,sn=pe.next())sn=Me(ce,sn.value,Oe),sn!==null&&(se=g(sn,se,Ht),rn===null?vt=sn:rn.sibling=sn,rn=sn);return en&&_s(ce,Ht),vt}for(dt=c(dt);!sn.done;Ht++,sn=pe.next())sn=je(dt,ce,Ht,sn.value,Oe),sn!==null&&(e&&sn.alternate!==null&&dt.delete(sn.key===null?Ht:sn.key),se=g(sn,se,Ht),rn===null?vt=sn:rn.sibling=sn,rn=sn);return e&&dt.forEach(function(VS){return r(ce,VS)}),en&&_s(ce,Ht),vt}function gn(ce,se,pe,Oe){if(typeof pe=="object"&&pe!==null&&pe.type===C&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case b:e:{for(var vt=pe.key;se!==null;){if(se.key===vt){if(vt=pe.type,vt===C){if(se.tag===7){l(ce,se.sibling),Oe=p(se,pe.props.children),Oe.return=ce,ce=Oe;break e}}else if(se.elementType===vt||typeof vt=="object"&&vt!==null&&vt.$$typeof===R&&Qi(vt)===se.type){l(ce,se.sibling),Oe=p(se,pe.props),Jl(Oe,pe),Oe.return=ce,ce=Oe;break e}l(ce,se);break}else r(ce,se);se=se.sibling}pe.type===C?(Oe=Vi(pe.props.children,ce.mode,Oe,pe.key),Oe.return=ce,ce=Oe):(Oe=Sc(pe.type,pe.key,pe.props,null,ce.mode,Oe),Jl(Oe,pe),Oe.return=ce,ce=Oe)}return j(ce);case _:e:{for(vt=pe.key;se!==null;){if(se.key===vt)if(se.tag===4&&se.stateNode.containerInfo===pe.containerInfo&&se.stateNode.implementation===pe.implementation){l(ce,se.sibling),Oe=p(se,pe.children||[]),Oe.return=ce,ce=Oe;break e}else{l(ce,se);break}else r(ce,se);se=se.sibling}Oe=zd(pe,ce.mode,Oe),Oe.return=ce,ce=Oe}return j(ce);case R:return pe=Qi(pe),gn(ce,se,pe,Oe)}if(B(pe))return lt(ce,se,pe,Oe);if(F(pe)){if(vt=F(pe),typeof vt!="function")throw Error(a(150));return pe=vt.call(pe),Et(ce,se,pe,Oe)}if(typeof pe.then=="function")return gn(ce,se,Tc(pe),Oe);if(pe.$$typeof===D)return gn(ce,se,Cc(ce,pe),Oe);Ac(ce,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,se!==null&&se.tag===6?(l(ce,se.sibling),Oe=p(se,pe),Oe.return=ce,ce=Oe):(l(ce,se),Oe=Md(pe,ce.mode,Oe),Oe.return=ce,ce=Oe),j(ce)):l(ce,se)}return function(ce,se,pe,Oe){try{Ql=0;var vt=gn(ce,se,pe,Oe);return Ia=null,vt}catch(dt){if(dt===Ua||dt===Ec)throw dt;var rn=_r(29,dt,null,ce.mode);return rn.lanes=Oe,rn.return=ce,rn}}}var Xi=Hm(!0),Vm=Hm(!1),ai=!1;function Kd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Yd(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function li(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function oi(e,r,l){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(ln&2)!==0){var p=c.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),c.pending=r,r=wc(e),km(e,null,l),r}return bc(e,c,r,l),wc(e)}function Xl(e,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194048)!==0)){var c=r.lanes;c&=e.pendingLanes,l|=c,r.lanes=l,Ye(e,l)}}function Wd(e,r){var l=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var p=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var j={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};g===null?p=g=j:g=g.next=j,l=l.next}while(l!==null);g===null?p=g=r:g=g.next=r}else p=g=r;l={baseState:c.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=r:e.next=r,l.lastBaseUpdate=r}var Qd=!1;function Zl(){if(Qd){var e=La;if(e!==null)throw e}}function eo(e,r,l,c){Qd=!1;var p=e.updateQueue;ai=!1;var g=p.firstBaseUpdate,j=p.lastBaseUpdate,O=p.shared.pending;if(O!==null){p.shared.pending=null;var K=O,me=K.next;K.next=null,j===null?g=me:j.next=me,j=K;var ke=e.alternate;ke!==null&&(ke=ke.updateQueue,O=ke.lastBaseUpdate,O!==j&&(O===null?ke.firstBaseUpdate=me:O.next=me,ke.lastBaseUpdate=K))}if(g!==null){var Me=p.baseState;j=0,ke=me=K=null,O=g;do{var ye=O.lane&-536870913,je=ye!==O.lane;if(je?(Xt&ye)===ye:(c&ye)===ye){ye!==0&&ye===za&&(Qd=!0),ke!==null&&(ke=ke.next={lane:0,tag:O.tag,payload:O.payload,callback:null,next:null});e:{var lt=e,Et=O;ye=r;var gn=l;switch(Et.tag){case 1:if(lt=Et.payload,typeof lt=="function"){Me=lt.call(gn,Me,ye);break e}Me=lt;break e;case 3:lt.flags=lt.flags&-65537|128;case 0:if(lt=Et.payload,ye=typeof lt=="function"?lt.call(gn,Me,ye):lt,ye==null)break e;Me=v({},Me,ye);break e;case 2:ai=!0}}ye=O.callback,ye!==null&&(e.flags|=64,je&&(e.flags|=8192),je=p.callbacks,je===null?p.callbacks=[ye]:je.push(ye))}else je={lane:ye,tag:O.tag,payload:O.payload,callback:O.callback,next:null},ke===null?(me=ke=je,K=Me):ke=ke.next=je,j|=ye;if(O=O.next,O===null){if(O=p.shared.pending,O===null)break;je=O,O=je.next,je.next=null,p.lastBaseUpdate=je,p.shared.pending=null}}while(!0);ke===null&&(K=Me),p.baseState=K,p.firstBaseUpdate=me,p.lastBaseUpdate=ke,g===null&&(p.shared.lanes=0),fi|=j,e.lanes=j,e.memoizedState=Me}}function Gm(e,r){if(typeof e!="function")throw Error(a(191,e));e.call(r)}function Km(e,r){var l=e.callbacks;if(l!==null)for(e.callbacks=null,e=0;e<l.length;e++)Gm(l[e],r)}var Ba=q(null),Rc=q(0);function Ym(e,r){e=zs,ae(Rc,e),ae(Ba,r),zs=e|r.baseLanes}function Jd(){ae(Rc,zs),ae(Ba,Ba.current)}function Xd(){zs=Rc.current,Y(Ba),Y(Rc)}var Cr=q(null),Fr=null;function ci(e){var r=e.alternate;ae(Dn,Dn.current&1),ae(Cr,e),Fr===null&&(r===null||Ba.current!==null||r.memoizedState!==null)&&(Fr=e)}function Zd(e){ae(Dn,Dn.current),ae(Cr,e),Fr===null&&(Fr=e)}function Wm(e){e.tag===22?(ae(Dn,Dn.current),ae(Cr,e),Fr===null&&(Fr=e)):ui()}function ui(){ae(Dn,Dn.current),ae(Cr,Cr.current)}function Nr(e){Y(Cr),Fr===e&&(Fr=null),Y(Dn)}var Dn=q(0);function Oc(e){for(var r=e;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||af(l)||lf(l)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Es=0,qt=null,pn=null,Bn=null,Dc=!1,$a=!1,Zi=!1,Mc=0,to=0,Pa=null,zw=0;function An(){throw Error(a(321))}function eh(e,r){if(r===null)return!1;for(var l=0;l<r.length&&l<e.length;l++)if(!jr(e[l],r[l]))return!1;return!0}function th(e,r,l,c,p,g){return Es=g,qt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,T.H=e===null||e.memoizedState===null?Og:gh,Zi=!1,g=l(c,p),Zi=!1,$a&&(g=Jm(r,l,c,p)),Qm(e),g}function Qm(e){T.H=so;var r=pn!==null&&pn.next!==null;if(Es=0,Bn=pn=qt=null,Dc=!1,to=0,Pa=null,r)throw Error(a(300));e===null||$n||(e=e.dependencies,e!==null&&_c(e)&&($n=!0))}function Jm(e,r,l,c){qt=e;var p=0;do{if($a&&(Pa=null),to=0,$a=!1,25<=p)throw Error(a(301));if(p+=1,Bn=pn=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}T.H=Dg,g=r(l,c)}while($a);return g}function Lw(){var e=T.H,r=e.useState()[0];return r=typeof r.then=="function"?no(r):r,e=e.useState()[0],(pn!==null?pn.memoizedState:null)!==e&&(qt.flags|=1024),r}function nh(){var e=Mc!==0;return Mc=0,e}function rh(e,r,l){r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~l}function sh(e){if(Dc){for(e=e.memoizedState;e!==null;){var r=e.queue;r!==null&&(r.pending=null),e=e.next}Dc=!1}Es=0,Bn=pn=qt=null,$a=!1,to=Mc=0,Pa=null}function dr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bn===null?qt.memoizedState=Bn=e:Bn=Bn.next=e,Bn}function Mn(){if(pn===null){var e=qt.alternate;e=e!==null?e.memoizedState:null}else e=pn.next;var r=Bn===null?qt.memoizedState:Bn.next;if(r!==null)Bn=r,pn=e;else{if(e===null)throw qt.alternate===null?Error(a(467)):Error(a(310));pn=e,e={memoizedState:pn.memoizedState,baseState:pn.baseState,baseQueue:pn.baseQueue,queue:pn.queue,next:null},Bn===null?qt.memoizedState=Bn=e:Bn=Bn.next=e}return Bn}function zc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function no(e){var r=to;return to+=1,Pa===null&&(Pa=[]),e=Pm(Pa,e,r),r=qt,(Bn===null?r.memoizedState:Bn.next)===null&&(r=r.alternate,T.H=r===null||r.memoizedState===null?Og:gh),e}function Lc(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return no(e);if(e.$$typeof===D)return er(e)}throw Error(a(438,String(e)))}function ih(e){var r=null,l=qt.updateQueue;if(l!==null&&(r=l.memoCache),r==null){var c=qt.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(r={data:c.data.map(function(p){return p.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),l===null&&(l=zc(),qt.updateQueue=l),l.memoCache=r,l=r.data[r.index],l===void 0)for(l=r.data[r.index]=Array(e),c=0;c<e;c++)l[c]=V;return r.index++,l}function ks(e,r){return typeof r=="function"?r(e):r}function Uc(e){var r=Mn();return ah(r,pn,e)}function ah(e,r,l){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=l;var p=e.baseQueue,g=c.pending;if(g!==null){if(p!==null){var j=p.next;p.next=g.next,g.next=j}r.baseQueue=p=g,c.pending=null}if(g=e.baseState,p===null)e.memoizedState=g;else{r=p.next;var O=j=null,K=null,me=r,ke=!1;do{var Me=me.lane&-536870913;if(Me!==me.lane?(Xt&Me)===Me:(Es&Me)===Me){var ye=me.revertLane;if(ye===0)K!==null&&(K=K.next={lane:0,revertLane:0,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),Me===za&&(ke=!0);else if((Es&ye)===ye){me=me.next,ye===za&&(ke=!0);continue}else Me={lane:0,revertLane:me.revertLane,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},K===null?(O=K=Me,j=g):K=K.next=Me,qt.lanes|=ye,fi|=ye;Me=me.action,Zi&&l(g,Me),g=me.hasEagerState?me.eagerState:l(g,Me)}else ye={lane:Me,revertLane:me.revertLane,gesture:me.gesture,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},K===null?(O=K=ye,j=g):K=K.next=ye,qt.lanes|=Me,fi|=Me;me=me.next}while(me!==null&&me!==r);if(K===null?j=g:K.next=O,!jr(g,e.memoizedState)&&($n=!0,ke&&(l=La,l!==null)))throw l;e.memoizedState=g,e.baseState=j,e.baseQueue=K,c.lastRenderedState=g}return p===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function lh(e){var r=Mn(),l=r.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=e;var c=l.dispatch,p=l.pending,g=r.memoizedState;if(p!==null){l.pending=null;var j=p=p.next;do g=e(g,j.action),j=j.next;while(j!==p);jr(g,r.memoizedState)||($n=!0),r.memoizedState=g,r.baseQueue===null&&(r.baseState=g),l.lastRenderedState=g}return[g,c]}function Xm(e,r,l){var c=qt,p=Mn(),g=en;if(g){if(l===void 0)throw Error(a(407));l=l()}else l=r();var j=!jr((pn||p).memoizedState,l);if(j&&(p.memoizedState=l,$n=!0),p=p.queue,uh(tg.bind(null,c,p,e),[e]),p.getSnapshot!==r||j||Bn!==null&&Bn.memoizedState.tag&1){if(c.flags|=2048,qa(9,{destroy:void 0},eg.bind(null,c,p,l,r),null),yn===null)throw Error(a(349));g||(Es&127)!==0||Zm(c,r,l)}return l}function Zm(e,r,l){e.flags|=16384,e={getSnapshot:r,value:l},r=qt.updateQueue,r===null?(r=zc(),qt.updateQueue=r,r.stores=[e]):(l=r.stores,l===null?r.stores=[e]:l.push(e))}function eg(e,r,l,c){r.value=l,r.getSnapshot=c,ng(r)&&rg(e)}function tg(e,r,l){return l(function(){ng(r)&&rg(e)})}function ng(e){var r=e.getSnapshot;e=e.value;try{var l=r();return!jr(e,l)}catch{return!0}}function rg(e){var r=Hi(e,2);r!==null&&xr(r,e,2)}function oh(e){var r=dr();if(typeof e=="function"){var l=e;if(e=l(),Zi){cn(!0);try{l()}finally{cn(!1)}}}return r.memoizedState=r.baseState=e,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:e},r}function sg(e,r,l,c){return e.baseState=l,ah(e,pn,typeof c=="function"?c:ks)}function Uw(e,r,l,c,p){if($c(e))throw Error(a(485));if(e=r.action,e!==null){var g={payload:p,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(j){g.listeners.push(j)}};T.T!==null?l(!0):g.isTransition=!1,c(g),l=r.pending,l===null?(g.next=r.pending=g,ig(r,g)):(g.next=l.next,r.pending=l.next=g)}}function ig(e,r){var l=r.action,c=r.payload,p=e.state;if(r.isTransition){var g=T.T,j={};T.T=j;try{var O=l(p,c),K=T.S;K!==null&&K(j,O),ag(e,r,O)}catch(me){ch(e,r,me)}finally{g!==null&&j.types!==null&&(g.types=j.types),T.T=g}}else try{g=l(p,c),ag(e,r,g)}catch(me){ch(e,r,me)}}function ag(e,r,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){lg(e,r,c)},function(c){return ch(e,r,c)}):lg(e,r,l)}function lg(e,r,l){r.status="fulfilled",r.value=l,og(r),e.state=l,r=e.pending,r!==null&&(l=r.next,l===r?e.pending=null:(l=l.next,r.next=l,ig(e,l)))}function ch(e,r,l){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do r.status="rejected",r.reason=l,og(r),r=r.next;while(r!==c)}e.action=null}function og(e){e=e.listeners;for(var r=0;r<e.length;r++)(0,e[r])()}function cg(e,r){return r}function ug(e,r){if(en){var l=yn.formState;if(l!==null){e:{var c=qt;if(en){if(jn){t:{for(var p=jn,g=qr;p.nodeType!==8;){if(!g){p=null;break t}if(p=Hr(p.nextSibling),p===null){p=null;break t}}g=p.data,p=g==="F!"||g==="F"?p:null}if(p){jn=Hr(p.nextSibling),c=p.data==="F!";break e}}si(c)}c=!1}c&&(r=l[0])}}return l=dr(),l.memoizedState=l.baseState=r,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cg,lastRenderedState:r},l.queue=c,l=Tg.bind(null,qt,c),c.dispatch=l,c=oh(!1),g=mh.bind(null,qt,!1,c.queue),c=dr(),p={state:r,dispatch:null,action:e,pending:null},c.queue=p,l=Uw.bind(null,qt,p,g,l),p.dispatch=l,c.memoizedState=e,[r,l,!1]}function dg(e){var r=Mn();return hg(r,pn,e)}function hg(e,r,l){if(r=ah(e,r,cg)[0],e=Uc(ks)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var c=no(r)}catch(j){throw j===Ua?Ec:j}else c=r;r=Mn();var p=r.queue,g=p.dispatch;return l!==r.memoizedState&&(qt.flags|=2048,qa(9,{destroy:void 0},Iw.bind(null,p,l),null)),[c,g,e]}function Iw(e,r){e.action=r}function fg(e){var r=Mn(),l=pn;if(l!==null)return hg(r,l,e);Mn(),r=r.memoizedState,l=Mn();var c=l.queue.dispatch;return l.memoizedState=e,[r,c,!1]}function qa(e,r,l,c){return e={tag:e,create:l,deps:c,inst:r,next:null},r=qt.updateQueue,r===null&&(r=zc(),qt.updateQueue=r),l=r.lastEffect,l===null?r.lastEffect=e.next=e:(c=l.next,l.next=e,e.next=c,r.lastEffect=e),e}function pg(){return Mn().memoizedState}function Ic(e,r,l,c){var p=dr();qt.flags|=e,p.memoizedState=qa(1|r,{destroy:void 0},l,c===void 0?null:c)}function Bc(e,r,l,c){var p=Mn();c=c===void 0?null:c;var g=p.memoizedState.inst;pn!==null&&c!==null&&eh(c,pn.memoizedState.deps)?p.memoizedState=qa(r,g,l,c):(qt.flags|=e,p.memoizedState=qa(1|r,g,l,c))}function mg(e,r){Ic(8390656,8,e,r)}function uh(e,r){Bc(2048,8,e,r)}function Bw(e){qt.flags|=4;var r=qt.updateQueue;if(r===null)r=zc(),qt.updateQueue=r,r.events=[e];else{var l=r.events;l===null?r.events=[e]:l.push(e)}}function gg(e){var r=Mn().memoizedState;return Bw({ref:r,nextImpl:e}),function(){if((ln&2)!==0)throw Error(a(440));return r.impl.apply(void 0,arguments)}}function yg(e,r){return Bc(4,2,e,r)}function vg(e,r){return Bc(4,4,e,r)}function xg(e,r){if(typeof r=="function"){e=e();var l=r(e);return function(){typeof l=="function"?l():r(null)}}if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function bg(e,r,l){l=l!=null?l.concat([e]):null,Bc(4,4,xg.bind(null,r,e),l)}function dh(){}function wg(e,r){var l=Mn();r=r===void 0?null:r;var c=l.memoizedState;return r!==null&&eh(r,c[1])?c[0]:(l.memoizedState=[e,r],e)}function Sg(e,r){var l=Mn();r=r===void 0?null:r;var c=l.memoizedState;if(r!==null&&eh(r,c[1]))return c[0];if(c=e(),Zi){cn(!0);try{e()}finally{cn(!1)}}return l.memoizedState=[c,r],c}function hh(e,r,l){return l===void 0||(Es&1073741824)!==0&&(Xt&261930)===0?e.memoizedState=r:(e.memoizedState=l,e=jy(),qt.lanes|=e,fi|=e,l)}function jg(e,r,l,c){return jr(l,r)?l:Ba.current!==null?(e=hh(e,l,c),jr(e,r)||($n=!0),e):(Es&42)===0||(Es&1073741824)!==0&&(Xt&261930)===0?($n=!0,e.memoizedState=l):(e=jy(),qt.lanes|=e,fi|=e,r)}function _g(e,r,l,c,p){var g=z.p;z.p=g!==0&&8>g?g:8;var j=T.T,O={};T.T=O,mh(e,!1,r,l);try{var K=p(),me=T.S;if(me!==null&&me(O,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var ke=Mw(K,c);ro(e,r,ke,Tr(e))}else ro(e,r,c,Tr(e))}catch(Me){ro(e,r,{then:function(){},status:"rejected",reason:Me},Tr())}finally{z.p=g,j!==null&&O.types!==null&&(j.types=O.types),T.T=j}}function $w(){}function fh(e,r,l,c){if(e.tag!==5)throw Error(a(476));var p=Cg(e).queue;_g(e,p,r,H,l===null?$w:function(){return Ng(e),l(c)})}function Cg(e){var r=e.memoizedState;if(r!==null)return r;r={memoizedState:H,baseState:H,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:H},next:null};var l={};return r.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:l},next:null},e.memoizedState=r,e=e.alternate,e!==null&&(e.memoizedState=r),r}function Ng(e){var r=Cg(e);r.next===null&&(r=e.alternate.memoizedState),ro(e,r.next.queue,{},Tr())}function ph(){return er(wo)}function Eg(){return Mn().memoizedState}function kg(){return Mn().memoizedState}function Pw(e){for(var r=e.return;r!==null;){switch(r.tag){case 24:case 3:var l=Tr();e=li(l);var c=oi(r,e,l);c!==null&&(xr(c,r,l),Xl(c,r,l)),r={cache:Fd()},e.payload=r;return}r=r.return}}function qw(e,r,l){var c=Tr();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},$c(e)?Ag(r,l):(l=Od(e,r,l,c),l!==null&&(xr(l,e,c),Rg(l,r,c)))}function Tg(e,r,l){var c=Tr();ro(e,r,l,c)}function ro(e,r,l,c){var p={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if($c(e))Ag(r,p);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=r.lastRenderedReducer,g!==null))try{var j=r.lastRenderedState,O=g(j,l);if(p.hasEagerState=!0,p.eagerState=O,jr(O,j))return bc(e,r,p,0),yn===null&&xc(),!1}catch{}if(l=Od(e,r,p,c),l!==null)return xr(l,e,c),Rg(l,r,c),!0}return!1}function mh(e,r,l,c){if(c={lane:2,revertLane:Kh(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},$c(e)){if(r)throw Error(a(479))}else r=Od(e,l,c,2),r!==null&&xr(r,e,2)}function $c(e){var r=e.alternate;return e===qt||r!==null&&r===qt}function Ag(e,r){$a=Dc=!0;var l=e.pending;l===null?r.next=r:(r.next=l.next,l.next=r),e.pending=r}function Rg(e,r,l){if((l&4194048)!==0){var c=r.lanes;c&=e.pendingLanes,l|=c,r.lanes=l,Ye(e,l)}}var so={readContext:er,use:Lc,useCallback:An,useContext:An,useEffect:An,useImperativeHandle:An,useLayoutEffect:An,useInsertionEffect:An,useMemo:An,useReducer:An,useRef:An,useState:An,useDebugValue:An,useDeferredValue:An,useTransition:An,useSyncExternalStore:An,useId:An,useHostTransitionStatus:An,useFormState:An,useActionState:An,useOptimistic:An,useMemoCache:An,useCacheRefresh:An};so.useEffectEvent=An;var Og={readContext:er,use:Lc,useCallback:function(e,r){return dr().memoizedState=[e,r===void 0?null:r],e},useContext:er,useEffect:mg,useImperativeHandle:function(e,r,l){l=l!=null?l.concat([e]):null,Ic(4194308,4,xg.bind(null,r,e),l)},useLayoutEffect:function(e,r){return Ic(4194308,4,e,r)},useInsertionEffect:function(e,r){Ic(4,2,e,r)},useMemo:function(e,r){var l=dr();r=r===void 0?null:r;var c=e();if(Zi){cn(!0);try{e()}finally{cn(!1)}}return l.memoizedState=[c,r],c},useReducer:function(e,r,l){var c=dr();if(l!==void 0){var p=l(r);if(Zi){cn(!0);try{l(r)}finally{cn(!1)}}}else p=r;return c.memoizedState=c.baseState=p,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:p},c.queue=e,e=e.dispatch=qw.bind(null,qt,e),[c.memoizedState,e]},useRef:function(e){var r=dr();return e={current:e},r.memoizedState=e},useState:function(e){e=oh(e);var r=e.queue,l=Tg.bind(null,qt,r);return r.dispatch=l,[e.memoizedState,l]},useDebugValue:dh,useDeferredValue:function(e,r){var l=dr();return hh(l,e,r)},useTransition:function(){var e=oh(!1);return e=_g.bind(null,qt,e.queue,!0,!1),dr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,r,l){var c=qt,p=dr();if(en){if(l===void 0)throw Error(a(407));l=l()}else{if(l=r(),yn===null)throw Error(a(349));(Xt&127)!==0||Zm(c,r,l)}p.memoizedState=l;var g={value:l,getSnapshot:r};return p.queue=g,mg(tg.bind(null,c,g,e),[e]),c.flags|=2048,qa(9,{destroy:void 0},eg.bind(null,c,g,l,r),null),l},useId:function(){var e=dr(),r=yn.identifierPrefix;if(en){var l=ms,c=ps;l=(c&~(1<<32-Gt(c)-1)).toString(32)+l,r="_"+r+"R_"+l,l=Mc++,0<l&&(r+="H"+l.toString(32)),r+="_"}else l=zw++,r="_"+r+"r_"+l.toString(32)+"_";return e.memoizedState=r},useHostTransitionStatus:ph,useFormState:ug,useActionState:ug,useOptimistic:function(e){var r=dr();r.memoizedState=r.baseState=e;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=l,r=mh.bind(null,qt,!0,l),l.dispatch=r,[e,r]},useMemoCache:ih,useCacheRefresh:function(){return dr().memoizedState=Pw.bind(null,qt)},useEffectEvent:function(e){var r=dr(),l={impl:e};return r.memoizedState=l,function(){if((ln&2)!==0)throw Error(a(440));return l.impl.apply(void 0,arguments)}}},gh={readContext:er,use:Lc,useCallback:wg,useContext:er,useEffect:uh,useImperativeHandle:bg,useInsertionEffect:yg,useLayoutEffect:vg,useMemo:Sg,useReducer:Uc,useRef:pg,useState:function(){return Uc(ks)},useDebugValue:dh,useDeferredValue:function(e,r){var l=Mn();return jg(l,pn.memoizedState,e,r)},useTransition:function(){var e=Uc(ks)[0],r=Mn().memoizedState;return[typeof e=="boolean"?e:no(e),r]},useSyncExternalStore:Xm,useId:Eg,useHostTransitionStatus:ph,useFormState:dg,useActionState:dg,useOptimistic:function(e,r){var l=Mn();return sg(l,pn,e,r)},useMemoCache:ih,useCacheRefresh:kg};gh.useEffectEvent=gg;var Dg={readContext:er,use:Lc,useCallback:wg,useContext:er,useEffect:uh,useImperativeHandle:bg,useInsertionEffect:yg,useLayoutEffect:vg,useMemo:Sg,useReducer:lh,useRef:pg,useState:function(){return lh(ks)},useDebugValue:dh,useDeferredValue:function(e,r){var l=Mn();return pn===null?hh(l,e,r):jg(l,pn.memoizedState,e,r)},useTransition:function(){var e=lh(ks)[0],r=Mn().memoizedState;return[typeof e=="boolean"?e:no(e),r]},useSyncExternalStore:Xm,useId:Eg,useHostTransitionStatus:ph,useFormState:fg,useActionState:fg,useOptimistic:function(e,r){var l=Mn();return pn!==null?sg(l,pn,e,r):(l.baseState=e,[e,l.queue.dispatch])},useMemoCache:ih,useCacheRefresh:kg};Dg.useEffectEvent=gg;function yh(e,r,l,c){r=e.memoizedState,l=l(c,r),l=l==null?r:v({},r,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var vh={enqueueSetState:function(e,r,l){e=e._reactInternals;var c=Tr(),p=li(c);p.payload=r,l!=null&&(p.callback=l),r=oi(e,p,c),r!==null&&(xr(r,e,c),Xl(r,e,c))},enqueueReplaceState:function(e,r,l){e=e._reactInternals;var c=Tr(),p=li(c);p.tag=1,p.payload=r,l!=null&&(p.callback=l),r=oi(e,p,c),r!==null&&(xr(r,e,c),Xl(r,e,c))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var l=Tr(),c=li(l);c.tag=2,r!=null&&(c.callback=r),r=oi(e,c,l),r!==null&&(xr(r,e,l),Xl(r,e,l))}};function Mg(e,r,l,c,p,g,j){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,j):r.prototype&&r.prototype.isPureReactComponent?!Hl(l,c)||!Hl(p,g):!0}function zg(e,r,l,c){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,c),r.state!==e&&vh.enqueueReplaceState(r,r.state,null)}function ea(e,r){var l=r;if("ref"in r){l={};for(var c in r)c!=="ref"&&(l[c]=r[c])}if(e=e.defaultProps){l===r&&(l=v({},l));for(var p in e)l[p]===void 0&&(l[p]=e[p])}return l}function Lg(e){vc(e)}function Ug(e){console.error(e)}function Ig(e){vc(e)}function Pc(e,r){try{var l=e.onUncaughtError;l(r.value,{componentStack:r.stack})}catch(c){setTimeout(function(){throw c})}}function Bg(e,r,l){try{var c=e.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function xh(e,r,l){return l=li(l),l.tag=3,l.payload={element:null},l.callback=function(){Pc(e,r)},l}function $g(e){return e=li(e),e.tag=3,e}function Pg(e,r,l,c){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var g=c.value;e.payload=function(){return p(g)},e.callback=function(){Bg(r,l,c)}}var j=l.stateNode;j!==null&&typeof j.componentDidCatch=="function"&&(e.callback=function(){Bg(r,l,c),typeof p!="function"&&(pi===null?pi=new Set([this]):pi.add(this));var O=c.stack;this.componentDidCatch(c.value,{componentStack:O!==null?O:""})})}function Fw(e,r,l,c,p){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(r=l.alternate,r!==null&&Ma(r,l,p,!0),l=Cr.current,l!==null){switch(l.tag){case 31:case 13:return Fr===null?Zc():l.alternate===null&&Rn===0&&(Rn=3),l.flags&=-257,l.flags|=65536,l.lanes=p,c===kc?l.flags|=16384:(r=l.updateQueue,r===null?l.updateQueue=new Set([c]):r.add(c),Hh(e,c,p)),!1;case 22:return l.flags|=65536,c===kc?l.flags|=16384:(r=l.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=r):(l=r.retryQueue,l===null?r.retryQueue=new Set([c]):l.add(c)),Hh(e,c,p)),!1}throw Error(a(435,l.tag))}return Hh(e,c,p),Zc(),!1}if(en)return r=Cr.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=p,c!==Id&&(e=Error(a(422),{cause:c}),Kl(Br(e,l)))):(c!==Id&&(r=Error(a(423),{cause:c}),Kl(Br(r,l))),e=e.current.alternate,e.flags|=65536,p&=-p,e.lanes|=p,c=Br(c,l),p=xh(e.stateNode,c,p),Wd(e,p),Rn!==4&&(Rn=2)),!1;var g=Error(a(520),{cause:c});if(g=Br(g,l),fo===null?fo=[g]:fo.push(g),Rn!==4&&(Rn=2),r===null)return!0;c=Br(c,l),l=r;do{switch(l.tag){case 3:return l.flags|=65536,e=p&-p,l.lanes|=e,e=xh(l.stateNode,c,e),Wd(l,e),!1;case 1:if(r=l.type,g=l.stateNode,(l.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(pi===null||!pi.has(g))))return l.flags|=65536,p&=-p,l.lanes|=p,p=$g(p),Pg(p,e,l,c),Wd(l,p),!1}l=l.return}while(l!==null);return!1}var bh=Error(a(461)),$n=!1;function tr(e,r,l,c){r.child=e===null?Vm(r,null,l,c):Xi(r,e.child,l,c)}function qg(e,r,l,c,p){l=l.render;var g=r.ref;if("ref"in c){var j={};for(var O in c)O!=="ref"&&(j[O]=c[O])}else j=c;return Yi(r),c=th(e,r,l,j,g,p),O=nh(),e!==null&&!$n?(rh(e,r,p),Ts(e,r,p)):(en&&O&&Ld(r),r.flags|=1,tr(e,r,c,p),r.child)}function Fg(e,r,l,c,p){if(e===null){var g=l.type;return typeof g=="function"&&!Dd(g)&&g.defaultProps===void 0&&l.compare===null?(r.tag=15,r.type=g,Hg(e,r,g,c,p)):(e=Sc(l.type,null,c,r,r.mode,p),e.ref=r.ref,e.return=r,r.child=e)}if(g=e.child,!kh(e,p)){var j=g.memoizedProps;if(l=l.compare,l=l!==null?l:Hl,l(j,c)&&e.ref===r.ref)return Ts(e,r,p)}return r.flags|=1,e=js(g,c),e.ref=r.ref,e.return=r,r.child=e}function Hg(e,r,l,c,p){if(e!==null){var g=e.memoizedProps;if(Hl(g,c)&&e.ref===r.ref)if($n=!1,r.pendingProps=c=g,kh(e,p))(e.flags&131072)!==0&&($n=!0);else return r.lanes=e.lanes,Ts(e,r,p)}return wh(e,r,l,c,p)}function Vg(e,r,l,c){var p=c.children,g=e!==null?e.memoizedState:null;if(e===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((r.flags&128)!==0){if(g=g!==null?g.baseLanes|l:l,e!==null){for(c=r.child=e.child,p=0;c!==null;)p=p|c.lanes|c.childLanes,c=c.sibling;c=p&~g}else c=0,r.child=null;return Gg(e,r,g,l,c)}if((l&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},e!==null&&Nc(r,g!==null?g.cachePool:null),g!==null?Ym(r,g):Jd(),Wm(r);else return c=r.lanes=536870912,Gg(e,r,g!==null?g.baseLanes|l:l,l,c)}else g!==null?(Nc(r,g.cachePool),Ym(r,g),ui(),r.memoizedState=null):(e!==null&&Nc(r,null),Jd(),ui());return tr(e,r,p,l),r.child}function io(e,r){return e!==null&&e.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function Gg(e,r,l,c,p){var g=Vd();return g=g===null?null:{parent:In._currentValue,pool:g},r.memoizedState={baseLanes:l,cachePool:g},e!==null&&Nc(r,null),Jd(),Wm(r),e!==null&&Ma(e,r,c,!0),r.childLanes=p,null}function qc(e,r){return r=Hc({mode:r.mode,children:r.children},e.mode),r.ref=e.ref,e.child=r,r.return=e,r}function Kg(e,r,l){return Xi(r,e.child,null,l),e=qc(r,r.pendingProps),e.flags|=2,Nr(r),r.memoizedState=null,e}function Hw(e,r,l){var c=r.pendingProps,p=(r.flags&128)!==0;if(r.flags&=-129,e===null){if(en){if(c.mode==="hidden")return e=qc(r,c),r.lanes=536870912,io(null,e);if(Zd(r),(e=jn)?(e=iv(e,qr),e=e!==null&&e.data==="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:ni!==null?{id:ps,overflow:ms}:null,retryLane:536870912,hydrationErrors:null},l=Am(e),l.return=r,r.child=l,Zn=r,jn=null)):e=null,e===null)throw si(r);return r.lanes=536870912,null}return qc(r,c)}var g=e.memoizedState;if(g!==null){var j=g.dehydrated;if(Zd(r),p)if(r.flags&256)r.flags&=-257,r=Kg(e,r,l);else if(r.memoizedState!==null)r.child=e.child,r.flags|=128,r=null;else throw Error(a(558));else if($n||Ma(e,r,l,!1),p=(l&e.childLanes)!==0,$n||p){if(c=yn,c!==null&&(j=kt(c,l),j!==0&&j!==g.retryLane))throw g.retryLane=j,Hi(e,j),xr(c,e,j),bh;Zc(),r=Kg(e,r,l)}else e=g.treeContext,jn=Hr(j.nextSibling),Zn=r,en=!0,ri=null,qr=!1,e!==null&&Dm(r,e),r=qc(r,c),r.flags|=4096;return r}return e=js(e.child,{mode:c.mode,children:c.children}),e.ref=r.ref,r.child=e,e.return=r,e}function Fc(e,r){var l=r.ref;if(l===null)e!==null&&e.ref!==null&&(r.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(a(284));(e===null||e.ref!==l)&&(r.flags|=4194816)}}function wh(e,r,l,c,p){return Yi(r),l=th(e,r,l,c,void 0,p),c=nh(),e!==null&&!$n?(rh(e,r,p),Ts(e,r,p)):(en&&c&&Ld(r),r.flags|=1,tr(e,r,l,p),r.child)}function Yg(e,r,l,c,p,g){return Yi(r),r.updateQueue=null,l=Jm(r,c,l,p),Qm(e),c=nh(),e!==null&&!$n?(rh(e,r,g),Ts(e,r,g)):(en&&c&&Ld(r),r.flags|=1,tr(e,r,l,g),r.child)}function Wg(e,r,l,c,p){if(Yi(r),r.stateNode===null){var g=Aa,j=l.contextType;typeof j=="object"&&j!==null&&(g=er(j)),g=new l(c,g),r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=vh,r.stateNode=g,g._reactInternals=r,g=r.stateNode,g.props=c,g.state=r.memoizedState,g.refs={},Kd(r),j=l.contextType,g.context=typeof j=="object"&&j!==null?er(j):Aa,g.state=r.memoizedState,j=l.getDerivedStateFromProps,typeof j=="function"&&(yh(r,l,j,c),g.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(j=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),j!==g.state&&vh.enqueueReplaceState(g,g.state,null),eo(r,c,g,p),Zl(),g.state=r.memoizedState),typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!0}else if(e===null){g=r.stateNode;var O=r.memoizedProps,K=ea(l,O);g.props=K;var me=g.context,ke=l.contextType;j=Aa,typeof ke=="object"&&ke!==null&&(j=er(ke));var Me=l.getDerivedStateFromProps;ke=typeof Me=="function"||typeof g.getSnapshotBeforeUpdate=="function",O=r.pendingProps!==O,ke||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(O||me!==j)&&zg(r,g,c,j),ai=!1;var ye=r.memoizedState;g.state=ye,eo(r,c,g,p),Zl(),me=r.memoizedState,O||ye!==me||ai?(typeof Me=="function"&&(yh(r,l,Me,c),me=r.memoizedState),(K=ai||Mg(r,l,K,c,ye,me,j))?(ke||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=me),g.props=c,g.state=me,g.context=j,c=K):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{g=r.stateNode,Yd(e,r),j=r.memoizedProps,ke=ea(l,j),g.props=ke,Me=r.pendingProps,ye=g.context,me=l.contextType,K=Aa,typeof me=="object"&&me!==null&&(K=er(me)),O=l.getDerivedStateFromProps,(me=typeof O=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(j!==Me||ye!==K)&&zg(r,g,c,K),ai=!1,ye=r.memoizedState,g.state=ye,eo(r,c,g,p),Zl();var je=r.memoizedState;j!==Me||ye!==je||ai||e!==null&&e.dependencies!==null&&_c(e.dependencies)?(typeof O=="function"&&(yh(r,l,O,c),je=r.memoizedState),(ke=ai||Mg(r,l,ke,c,ye,je,K)||e!==null&&e.dependencies!==null&&_c(e.dependencies))?(me||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,je,K),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,je,K)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||j===e.memoizedProps&&ye===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&ye===e.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=je),g.props=c,g.state=je,g.context=K,c=ke):(typeof g.componentDidUpdate!="function"||j===e.memoizedProps&&ye===e.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&ye===e.memoizedState||(r.flags|=1024),c=!1)}return g=c,Fc(e,r),c=(r.flags&128)!==0,g||c?(g=r.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:g.render(),r.flags|=1,e!==null&&c?(r.child=Xi(r,e.child,null,p),r.child=Xi(r,null,l,p)):tr(e,r,l,p),r.memoizedState=g.state,e=r.child):e=Ts(e,r,p),e}function Qg(e,r,l,c){return Gi(),r.flags|=256,tr(e,r,l,c),r.child}var Sh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function jh(e){return{baseLanes:e,cachePool:Bm()}}function _h(e,r,l){return e=e!==null?e.childLanes&~l:0,r&&(e|=kr),e}function Jg(e,r,l){var c=r.pendingProps,p=!1,g=(r.flags&128)!==0,j;if((j=g)||(j=e!==null&&e.memoizedState===null?!1:(Dn.current&2)!==0),j&&(p=!0,r.flags&=-129),j=(r.flags&32)!==0,r.flags&=-33,e===null){if(en){if(p?ci(r):ui(),(e=jn)?(e=iv(e,qr),e=e!==null&&e.data!=="&"?e:null,e!==null&&(r.memoizedState={dehydrated:e,treeContext:ni!==null?{id:ps,overflow:ms}:null,retryLane:536870912,hydrationErrors:null},l=Am(e),l.return=r,r.child=l,Zn=r,jn=null)):e=null,e===null)throw si(r);return lf(e)?r.lanes=32:r.lanes=536870912,null}var O=c.children;return c=c.fallback,p?(ui(),p=r.mode,O=Hc({mode:"hidden",children:O},p),c=Vi(c,p,l,null),O.return=r,c.return=r,O.sibling=c,r.child=O,c=r.child,c.memoizedState=jh(l),c.childLanes=_h(e,j,l),r.memoizedState=Sh,io(null,c)):(ci(r),Ch(r,O))}var K=e.memoizedState;if(K!==null&&(O=K.dehydrated,O!==null)){if(g)r.flags&256?(ci(r),r.flags&=-257,r=Nh(e,r,l)):r.memoizedState!==null?(ui(),r.child=e.child,r.flags|=128,r=null):(ui(),O=c.fallback,p=r.mode,c=Hc({mode:"visible",children:c.children},p),O=Vi(O,p,l,null),O.flags|=2,c.return=r,O.return=r,c.sibling=O,r.child=c,Xi(r,e.child,null,l),c=r.child,c.memoizedState=jh(l),c.childLanes=_h(e,j,l),r.memoizedState=Sh,r=io(null,c));else if(ci(r),lf(O)){if(j=O.nextSibling&&O.nextSibling.dataset,j)var me=j.dgst;j=me,c=Error(a(419)),c.stack="",c.digest=j,Kl({value:c,source:null,stack:null}),r=Nh(e,r,l)}else if($n||Ma(e,r,l,!1),j=(l&e.childLanes)!==0,$n||j){if(j=yn,j!==null&&(c=kt(j,l),c!==0&&c!==K.retryLane))throw K.retryLane=c,Hi(e,c),xr(j,e,c),bh;af(O)||Zc(),r=Nh(e,r,l)}else af(O)?(r.flags|=192,r.child=e.child,r=null):(e=K.treeContext,jn=Hr(O.nextSibling),Zn=r,en=!0,ri=null,qr=!1,e!==null&&Dm(r,e),r=Ch(r,c.children),r.flags|=4096);return r}return p?(ui(),O=c.fallback,p=r.mode,K=e.child,me=K.sibling,c=js(K,{mode:"hidden",children:c.children}),c.subtreeFlags=K.subtreeFlags&65011712,me!==null?O=js(me,O):(O=Vi(O,p,l,null),O.flags|=2),O.return=r,c.return=r,c.sibling=O,r.child=c,io(null,c),c=r.child,O=e.child.memoizedState,O===null?O=jh(l):(p=O.cachePool,p!==null?(K=In._currentValue,p=p.parent!==K?{parent:K,pool:K}:p):p=Bm(),O={baseLanes:O.baseLanes|l,cachePool:p}),c.memoizedState=O,c.childLanes=_h(e,j,l),r.memoizedState=Sh,io(e.child,c)):(ci(r),l=e.child,e=l.sibling,l=js(l,{mode:"visible",children:c.children}),l.return=r,l.sibling=null,e!==null&&(j=r.deletions,j===null?(r.deletions=[e],r.flags|=16):j.push(e)),r.child=l,r.memoizedState=null,l)}function Ch(e,r){return r=Hc({mode:"visible",children:r},e.mode),r.return=e,e.child=r}function Hc(e,r){return e=_r(22,e,null,r),e.lanes=0,e}function Nh(e,r,l){return Xi(r,e.child,null,l),e=Ch(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function Xg(e,r,l){e.lanes|=r;var c=e.alternate;c!==null&&(c.lanes|=r),Pd(e.return,r,l)}function Eh(e,r,l,c,p,g){var j=e.memoizedState;j===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:p,treeForkCount:g}:(j.isBackwards=r,j.rendering=null,j.renderingStartTime=0,j.last=c,j.tail=l,j.tailMode=p,j.treeForkCount=g)}function Zg(e,r,l){var c=r.pendingProps,p=c.revealOrder,g=c.tail;c=c.children;var j=Dn.current,O=(j&2)!==0;if(O?(j=j&1|2,r.flags|=128):j&=1,ae(Dn,j),tr(e,r,c,l),c=en?Gl:0,!O&&e!==null&&(e.flags&128)!==0)e:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Xg(e,l,r);else if(e.tag===19)Xg(e,l,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break e;for(;e.sibling===null;){if(e.return===null||e.return===r)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(p){case"forwards":for(l=r.child,p=null;l!==null;)e=l.alternate,e!==null&&Oc(e)===null&&(p=l),l=l.sibling;l=p,l===null?(p=r.child,r.child=null):(p=l.sibling,l.sibling=null),Eh(r,!1,p,l,g,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,p=r.child,r.child=null;p!==null;){if(e=p.alternate,e!==null&&Oc(e)===null){r.child=p;break}e=p.sibling,p.sibling=l,l=p,p=e}Eh(r,!0,l,null,g,c);break;case"together":Eh(r,!1,null,null,void 0,c);break;default:r.memoizedState=null}return r.child}function Ts(e,r,l){if(e!==null&&(r.dependencies=e.dependencies),fi|=r.lanes,(l&r.childLanes)===0)if(e!==null){if(Ma(e,r,l,!1),(l&r.childLanes)===0)return null}else return null;if(e!==null&&r.child!==e.child)throw Error(a(153));if(r.child!==null){for(e=r.child,l=js(e,e.pendingProps),r.child=l,l.return=r;e.sibling!==null;)e=e.sibling,l=l.sibling=js(e,e.pendingProps),l.return=r;l.sibling=null}return r.child}function kh(e,r){return(e.lanes&r)!==0?!0:(e=e.dependencies,!!(e!==null&&_c(e)))}function Vw(e,r,l){switch(r.tag){case 3:G(r,r.stateNode.containerInfo),ii(r,In,e.memoizedState.cache),Gi();break;case 27:case 5:Z(r);break;case 4:G(r,r.stateNode.containerInfo);break;case 10:ii(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,Zd(r),null;break;case 13:var c=r.memoizedState;if(c!==null)return c.dehydrated!==null?(ci(r),r.flags|=128,null):(l&r.child.childLanes)!==0?Jg(e,r,l):(ci(r),e=Ts(e,r,l),e!==null?e.sibling:null);ci(r);break;case 19:var p=(e.flags&128)!==0;if(c=(l&r.childLanes)!==0,c||(Ma(e,r,l,!1),c=(l&r.childLanes)!==0),p){if(c)return Zg(e,r,l);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),ae(Dn,Dn.current),c)break;return null;case 22:return r.lanes=0,Vg(e,r,l,r.pendingProps);case 24:ii(r,In,e.memoizedState.cache)}return Ts(e,r,l)}function ey(e,r,l){if(e!==null)if(e.memoizedProps!==r.pendingProps)$n=!0;else{if(!kh(e,l)&&(r.flags&128)===0)return $n=!1,Vw(e,r,l);$n=(e.flags&131072)!==0}else $n=!1,en&&(r.flags&1048576)!==0&&Om(r,Gl,r.index);switch(r.lanes=0,r.tag){case 16:e:{var c=r.pendingProps;if(e=Qi(r.elementType),r.type=e,typeof e=="function")Dd(e)?(c=ea(e,c),r.tag=1,r=Wg(null,r,e,c,l)):(r.tag=0,r=wh(null,r,e,c,l));else{if(e!=null){var p=e.$$typeof;if(p===L){r.tag=11,r=qg(null,r,e,c,l);break e}else if(p===A){r.tag=14,r=Fg(null,r,e,c,l);break e}}throw r=P(e)||e,Error(a(306,r,""))}}return r;case 0:return wh(e,r,r.type,r.pendingProps,l);case 1:return c=r.type,p=ea(c,r.pendingProps),Wg(e,r,c,p,l);case 3:e:{if(G(r,r.stateNode.containerInfo),e===null)throw Error(a(387));c=r.pendingProps;var g=r.memoizedState;p=g.element,Yd(e,r),eo(r,c,null,l);var j=r.memoizedState;if(c=j.cache,ii(r,In,c),c!==g.cache&&qd(r,[In],l,!0),Zl(),c=j.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:j.cache},r.updateQueue.baseState=g,r.memoizedState=g,r.flags&256){r=Qg(e,r,c,l);break e}else if(c!==p){p=Br(Error(a(424)),r),Kl(p),r=Qg(e,r,c,l);break e}else for(e=r.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,jn=Hr(e.firstChild),Zn=r,en=!0,ri=null,qr=!0,l=Vm(r,null,c,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Gi(),c===p){r=Ts(e,r,l);break e}tr(e,r,c,l)}r=r.child}return r;case 26:return Fc(e,r),e===null?(l=dv(r.type,null,r.pendingProps,null))?r.memoizedState=l:en||(l=r.type,e=r.pendingProps,c=au(Ee.current).createElement(l),c[$e]=r,c[Ve]=e,nr(c,l,e),It(c),r.stateNode=c):r.memoizedState=dv(r.type,e.memoizedProps,r.pendingProps,e.memoizedState),null;case 27:return Z(r),e===null&&en&&(c=r.stateNode=ov(r.type,r.pendingProps,Ee.current),Zn=r,qr=!0,p=jn,vi(r.type)?(of=p,jn=Hr(c.firstChild)):jn=p),tr(e,r,r.pendingProps.children,l),Fc(e,r),e===null&&(r.flags|=4194304),r.child;case 5:return e===null&&en&&((p=c=jn)&&(c=wS(c,r.type,r.pendingProps,qr),c!==null?(r.stateNode=c,Zn=r,jn=Hr(c.firstChild),qr=!1,p=!0):p=!1),p||si(r)),Z(r),p=r.type,g=r.pendingProps,j=e!==null?e.memoizedProps:null,c=g.children,nf(p,g)?c=null:j!==null&&nf(p,j)&&(r.flags|=32),r.memoizedState!==null&&(p=th(e,r,Lw,null,null,l),wo._currentValue=p),Fc(e,r),tr(e,r,c,l),r.child;case 6:return e===null&&en&&((e=l=jn)&&(l=SS(l,r.pendingProps,qr),l!==null?(r.stateNode=l,Zn=r,jn=null,e=!0):e=!1),e||si(r)),null;case 13:return Jg(e,r,l);case 4:return G(r,r.stateNode.containerInfo),c=r.pendingProps,e===null?r.child=Xi(r,null,c,l):tr(e,r,c,l),r.child;case 11:return qg(e,r,r.type,r.pendingProps,l);case 7:return tr(e,r,r.pendingProps,l),r.child;case 8:return tr(e,r,r.pendingProps.children,l),r.child;case 12:return tr(e,r,r.pendingProps.children,l),r.child;case 10:return c=r.pendingProps,ii(r,r.type,c.value),tr(e,r,c.children,l),r.child;case 9:return p=r.type._context,c=r.pendingProps.children,Yi(r),p=er(p),c=c(p),r.flags|=1,tr(e,r,c,l),r.child;case 14:return Fg(e,r,r.type,r.pendingProps,l);case 15:return Hg(e,r,r.type,r.pendingProps,l);case 19:return Zg(e,r,l);case 31:return Hw(e,r,l);case 22:return Vg(e,r,l,r.pendingProps);case 24:return Yi(r),c=er(In),e===null?(p=Vd(),p===null&&(p=yn,g=Fd(),p.pooledCache=g,g.refCount++,g!==null&&(p.pooledCacheLanes|=l),p=g),r.memoizedState={parent:c,cache:p},Kd(r),ii(r,In,p)):((e.lanes&l)!==0&&(Yd(e,r),eo(r,null,null,l),Zl()),p=e.memoizedState,g=r.memoizedState,p.parent!==c?(p={parent:c,cache:c},r.memoizedState=p,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=p),ii(r,In,c)):(c=g.cache,ii(r,In,c),c!==p.cache&&qd(r,[In],l,!0))),tr(e,r,r.pendingProps.children,l),r.child;case 29:throw r.pendingProps}throw Error(a(156,r.tag))}function As(e){e.flags|=4}function Th(e,r,l,c,p){if((r=(e.mode&32)!==0)&&(r=!1),r){if(e.flags|=16777216,(p&335544128)===p)if(e.stateNode.complete)e.flags|=8192;else if(Ey())e.flags|=8192;else throw Ji=kc,Gd}else e.flags&=-16777217}function ty(e,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!gv(r))if(Ey())e.flags|=8192;else throw Ji=kc,Gd}function Vc(e,r){r!==null&&(e.flags|=4),e.flags&16384&&(r=e.tag!==22?Pt():536870912,e.lanes|=r,Ga|=r)}function ao(e,r){if(!en)switch(e.tailMode){case"hidden":r=e.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function _n(e){var r=e.alternate!==null&&e.alternate.child===e.child,l=0,c=0;if(r)for(var p=e.child;p!==null;)l|=p.lanes|p.childLanes,c|=p.subtreeFlags&65011712,c|=p.flags&65011712,p.return=e,p=p.sibling;else for(p=e.child;p!==null;)l|=p.lanes|p.childLanes,c|=p.subtreeFlags,c|=p.flags,p.return=e,p=p.sibling;return e.subtreeFlags|=c,e.childLanes=l,r}function Gw(e,r,l){var c=r.pendingProps;switch(Ud(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _n(r),null;case 1:return _n(r),null;case 3:return l=r.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),r.memoizedState.cache!==c&&(r.flags|=2048),Ns(In),ge(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(Da(r)?As(r):e===null||e.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Bd())),_n(r),null;case 26:var p=r.type,g=r.memoizedState;return e===null?(As(r),g!==null?(_n(r),ty(r,g)):(_n(r),Th(r,p,null,c,l))):g?g!==e.memoizedState?(As(r),_n(r),ty(r,g)):(_n(r),r.flags&=-16777217):(e=e.memoizedProps,e!==c&&As(r),_n(r),Th(r,p,e,c,l)),null;case 27:if(Ce(r),l=Ee.current,p=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&As(r);else{if(!c){if(r.stateNode===null)throw Error(a(166));return _n(r),null}e=xe.current,Da(r)?Mm(r):(e=ov(p,c,l),r.stateNode=e,As(r))}return _n(r),null;case 5:if(Ce(r),p=r.type,e!==null&&r.stateNode!=null)e.memoizedProps!==c&&As(r);else{if(!c){if(r.stateNode===null)throw Error(a(166));return _n(r),null}if(g=xe.current,Da(r))Mm(r);else{var j=au(Ee.current);switch(g){case 1:g=j.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:g=j.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":g=j.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":g=j.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":g=j.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof c.is=="string"?j.createElement("select",{is:c.is}):j.createElement("select"),c.multiple?g.multiple=!0:c.size&&(g.size=c.size);break;default:g=typeof c.is=="string"?j.createElement(p,{is:c.is}):j.createElement(p)}}g[$e]=r,g[Ve]=c;e:for(j=r.child;j!==null;){if(j.tag===5||j.tag===6)g.appendChild(j.stateNode);else if(j.tag!==4&&j.tag!==27&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===r)break e;for(;j.sibling===null;){if(j.return===null||j.return===r)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}r.stateNode=g;e:switch(nr(g,p,c),p){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&As(r)}}return _n(r),Th(r,r.type,e===null?null:e.memoizedProps,r.pendingProps,l),null;case 6:if(e&&r.stateNode!=null)e.memoizedProps!==c&&As(r);else{if(typeof c!="string"&&r.stateNode===null)throw Error(a(166));if(e=Ee.current,Da(r)){if(e=r.stateNode,l=r.memoizedProps,c=null,p=Zn,p!==null)switch(p.tag){case 27:case 5:c=p.memoizedProps}e[$e]=r,e=!!(e.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||Jy(e.nodeValue,l)),e||si(r,!0)}else e=au(e).createTextNode(c),e[$e]=r,r.stateNode=e}return _n(r),null;case 31:if(l=r.memoizedState,e===null||e.memoizedState!==null){if(c=Da(r),l!==null){if(e===null){if(!c)throw Error(a(318));if(e=r.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[$e]=r}else Gi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;_n(r),e=!1}else l=Bd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=l),e=!0;if(!e)return r.flags&256?(Nr(r),r):(Nr(r),null);if((r.flags&128)!==0)throw Error(a(558))}return _n(r),null;case 13:if(c=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(p=Da(r),c!==null&&c.dehydrated!==null){if(e===null){if(!p)throw Error(a(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(a(317));p[$e]=r}else Gi(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;_n(r),p=!1}else p=Bd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=p),p=!0;if(!p)return r.flags&256?(Nr(r),r):(Nr(r),null)}return Nr(r),(r.flags&128)!==0?(r.lanes=l,r):(l=c!==null,e=e!==null&&e.memoizedState!==null,l&&(c=r.child,p=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(p=c.alternate.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==p&&(c.flags|=2048)),l!==e&&l&&(r.child.flags|=8192),Vc(r,r.updateQueue),_n(r),null);case 4:return ge(),e===null&&Jh(r.stateNode.containerInfo),_n(r),null;case 10:return Ns(r.type),_n(r),null;case 19:if(Y(Dn),c=r.memoizedState,c===null)return _n(r),null;if(p=(r.flags&128)!==0,g=c.rendering,g===null)if(p)ao(c,!1);else{if(Rn!==0||e!==null&&(e.flags&128)!==0)for(e=r.child;e!==null;){if(g=Oc(e),g!==null){for(r.flags|=128,ao(c,!1),e=g.updateQueue,r.updateQueue=e,Vc(r,e),r.subtreeFlags=0,e=l,l=r.child;l!==null;)Tm(l,e),l=l.sibling;return ae(Dn,Dn.current&1|2),en&&_s(r,c.treeForkCount),r.child}e=e.sibling}c.tail!==null&&Ct()>Qc&&(r.flags|=128,p=!0,ao(c,!1),r.lanes=4194304)}else{if(!p)if(e=Oc(g),e!==null){if(r.flags|=128,p=!0,e=e.updateQueue,r.updateQueue=e,Vc(r,e),ao(c,!0),c.tail===null&&c.tailMode==="hidden"&&!g.alternate&&!en)return _n(r),null}else 2*Ct()-c.renderingStartTime>Qc&&l!==536870912&&(r.flags|=128,p=!0,ao(c,!1),r.lanes=4194304);c.isBackwards?(g.sibling=r.child,r.child=g):(e=c.last,e!==null?e.sibling=g:r.child=g,c.last=g)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=Ct(),e.sibling=null,l=Dn.current,ae(Dn,p?l&1|2:l&1),en&&_s(r,c.treeForkCount),e):(_n(r),null);case 22:case 23:return Nr(r),Xd(),c=r.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(r.flags|=8192):c&&(r.flags|=8192),c?(l&536870912)!==0&&(r.flags&128)===0&&(_n(r),r.subtreeFlags&6&&(r.flags|=8192)):_n(r),l=r.updateQueue,l!==null&&Vc(r,l.retryQueue),l=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),c=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),c!==l&&(r.flags|=2048),e!==null&&Y(Wi),null;case 24:return l=null,e!==null&&(l=e.memoizedState.cache),r.memoizedState.cache!==l&&(r.flags|=2048),Ns(In),_n(r),null;case 25:return null;case 30:return null}throw Error(a(156,r.tag))}function Kw(e,r){switch(Ud(r),r.tag){case 1:return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return Ns(In),ge(),e=r.flags,(e&65536)!==0&&(e&128)===0?(r.flags=e&-65537|128,r):null;case 26:case 27:case 5:return Ce(r),null;case 31:if(r.memoizedState!==null){if(Nr(r),r.alternate===null)throw Error(a(340));Gi()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 13:if(Nr(r),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(a(340));Gi()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return Y(Dn),null;case 4:return ge(),null;case 10:return Ns(r.type),null;case 22:case 23:return Nr(r),Xd(),e!==null&&Y(Wi),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 24:return Ns(In),null;case 25:return null;default:return null}}function ny(e,r){switch(Ud(r),r.tag){case 3:Ns(In),ge();break;case 26:case 27:case 5:Ce(r);break;case 4:ge();break;case 31:r.memoizedState!==null&&Nr(r);break;case 13:Nr(r);break;case 19:Y(Dn);break;case 10:Ns(r.type);break;case 22:case 23:Nr(r),Xd(),e!==null&&Y(Wi);break;case 24:Ns(In)}}function lo(e,r){try{var l=r.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var p=c.next;l=p;do{if((l.tag&e)===e){c=void 0;var g=l.create,j=l.inst;c=g(),j.destroy=c}l=l.next}while(l!==p)}}catch(O){fn(r,r.return,O)}}function di(e,r,l){try{var c=r.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var g=p.next;c=g;do{if((c.tag&e)===e){var j=c.inst,O=j.destroy;if(O!==void 0){j.destroy=void 0,p=r;var K=l,me=O;try{me()}catch(ke){fn(p,K,ke)}}}c=c.next}while(c!==g)}}catch(ke){fn(r,r.return,ke)}}function ry(e){var r=e.updateQueue;if(r!==null){var l=e.stateNode;try{Km(r,l)}catch(c){fn(e,e.return,c)}}}function sy(e,r,l){l.props=ea(e.type,e.memoizedProps),l.state=e.memoizedState;try{l.componentWillUnmount()}catch(c){fn(e,r,c)}}function oo(e,r){try{var l=e.ref;if(l!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof l=="function"?e.refCleanup=l(c):l.current=c}}catch(p){fn(e,r,p)}}function gs(e,r){var l=e.ref,c=e.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(p){fn(e,r,p)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){fn(e,r,p)}else l.current=null}function iy(e){var r=e.type,l=e.memoizedProps,c=e.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(p){fn(e,e.return,p)}}function Ah(e,r,l){try{var c=e.stateNode;mS(c,e.type,l,r),c[Ve]=r}catch(p){fn(e,e.return,p)}}function ay(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&vi(e.type)||e.tag===4}function Rh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ay(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&vi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Oh(e,r,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(e,r):(r=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,r.appendChild(e),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=Lr));else if(c!==4&&(c===27&&vi(e.type)&&(l=e.stateNode,r=null),e=e.child,e!==null))for(Oh(e,r,l),e=e.sibling;e!==null;)Oh(e,r,l),e=e.sibling}function Gc(e,r,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,r?l.insertBefore(e,r):l.appendChild(e);else if(c!==4&&(c===27&&vi(e.type)&&(l=e.stateNode),e=e.child,e!==null))for(Gc(e,r,l),e=e.sibling;e!==null;)Gc(e,r,l),e=e.sibling}function ly(e){var r=e.stateNode,l=e.memoizedProps;try{for(var c=e.type,p=r.attributes;p.length;)r.removeAttributeNode(p[0]);nr(r,c,l),r[$e]=e,r[Ve]=l}catch(g){fn(e,e.return,g)}}var Rs=!1,Pn=!1,Dh=!1,oy=typeof WeakSet=="function"?WeakSet:Set,Yn=null;function Yw(e,r){if(e=e.containerInfo,ef=fu,e=bm(e),Nd(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var p=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var j=0,O=-1,K=-1,me=0,ke=0,Me=e,ye=null;t:for(;;){for(var je;Me!==l||p!==0&&Me.nodeType!==3||(O=j+p),Me!==g||c!==0&&Me.nodeType!==3||(K=j+c),Me.nodeType===3&&(j+=Me.nodeValue.length),(je=Me.firstChild)!==null;)ye=Me,Me=je;for(;;){if(Me===e)break t;if(ye===l&&++me===p&&(O=j),ye===g&&++ke===c&&(K=j),(je=Me.nextSibling)!==null)break;Me=ye,ye=Me.parentNode}Me=je}l=O===-1||K===-1?null:{start:O,end:K}}else l=null}l=l||{start:0,end:0}}else l=null;for(tf={focusedElem:e,selectionRange:l},fu=!1,Yn=r;Yn!==null;)if(r=Yn,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,Yn=e;else for(;Yn!==null;){switch(r=Yn,g=r.alternate,e=r.flags,r.tag){case 0:if((e&4)!==0&&(e=r.updateQueue,e=e!==null?e.events:null,e!==null))for(l=0;l<e.length;l++)p=e[l],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,l=r,p=g.memoizedProps,g=g.memoizedState,c=l.stateNode;try{var lt=ea(l.type,p);e=c.getSnapshotBeforeUpdate(lt,g),c.__reactInternalSnapshotBeforeUpdate=e}catch(Et){fn(l,l.return,Et)}}break;case 3:if((e&1024)!==0){if(e=r.stateNode.containerInfo,l=e.nodeType,l===9)sf(e);else if(l===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":sf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=r.sibling,e!==null){e.return=r.return,Yn=e;break}Yn=r.return}}function cy(e,r,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:Ds(e,l),c&4&&lo(5,l);break;case 1:if(Ds(e,l),c&4)if(e=l.stateNode,r===null)try{e.componentDidMount()}catch(j){fn(l,l.return,j)}else{var p=ea(l.type,r.memoizedProps);r=r.memoizedState;try{e.componentDidUpdate(p,r,e.__reactInternalSnapshotBeforeUpdate)}catch(j){fn(l,l.return,j)}}c&64&&ry(l),c&512&&oo(l,l.return);break;case 3:if(Ds(e,l),c&64&&(e=l.updateQueue,e!==null)){if(r=null,l.child!==null)switch(l.child.tag){case 27:case 5:r=l.child.stateNode;break;case 1:r=l.child.stateNode}try{Km(e,r)}catch(j){fn(l,l.return,j)}}break;case 27:r===null&&c&4&&ly(l);case 26:case 5:Ds(e,l),r===null&&c&4&&iy(l),c&512&&oo(l,l.return);break;case 12:Ds(e,l);break;case 31:Ds(e,l),c&4&&hy(e,l);break;case 13:Ds(e,l),c&4&&fy(e,l),c&64&&(e=l.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(l=rS.bind(null,l),jS(e,l))));break;case 22:if(c=l.memoizedState!==null||Rs,!c){r=r!==null&&r.memoizedState!==null||Pn,p=Rs;var g=Pn;Rs=c,(Pn=r)&&!g?Ms(e,l,(l.subtreeFlags&8772)!==0):Ds(e,l),Rs=p,Pn=g}break;case 30:break;default:Ds(e,l)}}function uy(e){var r=e.alternate;r!==null&&(e.alternate=null,uy(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&Fe(r)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var En=null,mr=!1;function Os(e,r,l){for(l=l.child;l!==null;)dy(e,r,l),l=l.sibling}function dy(e,r,l){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(Mt,l)}catch{}switch(l.tag){case 26:Pn||gs(l,r),Os(e,r,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Pn||gs(l,r);var c=En,p=mr;vi(l.type)&&(En=l.stateNode,mr=!1),Os(e,r,l),vo(l.stateNode),En=c,mr=p;break;case 5:Pn||gs(l,r);case 6:if(c=En,p=mr,En=null,Os(e,r,l),En=c,mr=p,En!==null)if(mr)try{(En.nodeType===9?En.body:En.nodeName==="HTML"?En.ownerDocument.body:En).removeChild(l.stateNode)}catch(g){fn(l,r,g)}else try{En.removeChild(l.stateNode)}catch(g){fn(l,r,g)}break;case 18:En!==null&&(mr?(e=En,rv(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,l.stateNode),el(e)):rv(En,l.stateNode));break;case 4:c=En,p=mr,En=l.stateNode.containerInfo,mr=!0,Os(e,r,l),En=c,mr=p;break;case 0:case 11:case 14:case 15:di(2,l,r),Pn||di(4,l,r),Os(e,r,l);break;case 1:Pn||(gs(l,r),c=l.stateNode,typeof c.componentWillUnmount=="function"&&sy(l,r,c)),Os(e,r,l);break;case 21:Os(e,r,l);break;case 22:Pn=(c=Pn)||l.memoizedState!==null,Os(e,r,l),Pn=c;break;default:Os(e,r,l)}}function hy(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{el(e)}catch(l){fn(r,r.return,l)}}}function fy(e,r){if(r.memoizedState===null&&(e=r.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{el(e)}catch(l){fn(r,r.return,l)}}function Ww(e){switch(e.tag){case 31:case 13:case 19:var r=e.stateNode;return r===null&&(r=e.stateNode=new oy),r;case 22:return e=e.stateNode,r=e._retryCache,r===null&&(r=e._retryCache=new oy),r;default:throw Error(a(435,e.tag))}}function Kc(e,r){var l=Ww(e);r.forEach(function(c){if(!l.has(c)){l.add(c);var p=sS.bind(null,e,c);c.then(p,p)}})}function gr(e,r){var l=r.deletions;if(l!==null)for(var c=0;c<l.length;c++){var p=l[c],g=e,j=r,O=j;e:for(;O!==null;){switch(O.tag){case 27:if(vi(O.type)){En=O.stateNode,mr=!1;break e}break;case 5:En=O.stateNode,mr=!1;break e;case 3:case 4:En=O.stateNode.containerInfo,mr=!0;break e}O=O.return}if(En===null)throw Error(a(160));dy(g,j,p),En=null,mr=!1,g=p.alternate,g!==null&&(g.return=null),p.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)py(r,e),r=r.sibling}var rs=null;function py(e,r){var l=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:gr(r,e),yr(e),c&4&&(di(3,e,e.return),lo(3,e),di(5,e,e.return));break;case 1:gr(r,e),yr(e),c&512&&(Pn||l===null||gs(l,l.return)),c&64&&Rs&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(l=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var p=rs;if(gr(r,e),yr(e),c&512&&(Pn||l===null||gs(l,l.return)),c&4){var g=l!==null?l.memoizedState:null;if(c=e.memoizedState,l===null)if(c===null)if(e.stateNode===null){e:{c=e.type,l=e.memoizedProps,p=p.ownerDocument||p;t:switch(c){case"title":g=p.getElementsByTagName("title")[0],(!g||g[ze]||g[$e]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=p.createElement(c),p.head.insertBefore(g,p.querySelector("head > title"))),nr(g,c,l),g[$e]=e,It(g),c=g;break e;case"link":var j=pv("link","href",p).get(c+(l.href||""));if(j){for(var O=0;O<j.length;O++)if(g=j[O],g.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&g.getAttribute("rel")===(l.rel==null?null:l.rel)&&g.getAttribute("title")===(l.title==null?null:l.title)&&g.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){j.splice(O,1);break t}}g=p.createElement(c),nr(g,c,l),p.head.appendChild(g);break;case"meta":if(j=pv("meta","content",p).get(c+(l.content||""))){for(O=0;O<j.length;O++)if(g=j[O],g.getAttribute("content")===(l.content==null?null:""+l.content)&&g.getAttribute("name")===(l.name==null?null:l.name)&&g.getAttribute("property")===(l.property==null?null:l.property)&&g.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&g.getAttribute("charset")===(l.charSet==null?null:l.charSet)){j.splice(O,1);break t}}g=p.createElement(c),nr(g,c,l),p.head.appendChild(g);break;default:throw Error(a(468,c))}g[$e]=e,It(g),c=g}e.stateNode=c}else mv(p,e.type,e.stateNode);else e.stateNode=fv(p,c,e.memoizedProps);else g!==c?(g===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):g.count--,c===null?mv(p,e.type,e.stateNode):fv(p,c,e.memoizedProps)):c===null&&e.stateNode!==null&&Ah(e,e.memoizedProps,l.memoizedProps)}break;case 27:gr(r,e),yr(e),c&512&&(Pn||l===null||gs(l,l.return)),l!==null&&c&4&&Ah(e,e.memoizedProps,l.memoizedProps);break;case 5:if(gr(r,e),yr(e),c&512&&(Pn||l===null||gs(l,l.return)),e.flags&32){p=e.stateNode;try{Qs(p,"")}catch(lt){fn(e,e.return,lt)}}c&4&&e.stateNode!=null&&(p=e.memoizedProps,Ah(e,p,l!==null?l.memoizedProps:p)),c&1024&&(Dh=!0);break;case 6:if(gr(r,e),yr(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,l=e.stateNode;try{l.nodeValue=c}catch(lt){fn(e,e.return,lt)}}break;case 3:if(cu=null,p=rs,rs=lu(r.containerInfo),gr(r,e),rs=p,yr(e),c&4&&l!==null&&l.memoizedState.isDehydrated)try{el(r.containerInfo)}catch(lt){fn(e,e.return,lt)}Dh&&(Dh=!1,my(e));break;case 4:c=rs,rs=lu(e.stateNode.containerInfo),gr(r,e),yr(e),rs=c;break;case 12:gr(r,e),yr(e);break;case 31:gr(r,e),yr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Kc(e,c)));break;case 13:gr(r,e),yr(e),e.child.flags&8192&&e.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Wc=Ct()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Kc(e,c)));break;case 22:p=e.memoizedState!==null;var K=l!==null&&l.memoizedState!==null,me=Rs,ke=Pn;if(Rs=me||p,Pn=ke||K,gr(r,e),Pn=ke,Rs=me,yr(e),c&8192)e:for(r=e.stateNode,r._visibility=p?r._visibility&-2:r._visibility|1,p&&(l===null||K||Rs||Pn||ta(e)),l=null,r=e;;){if(r.tag===5||r.tag===26){if(l===null){K=l=r;try{if(g=K.stateNode,p)j=g.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none";else{O=K.stateNode;var Me=K.memoizedProps.style,ye=Me!=null&&Me.hasOwnProperty("display")?Me.display:null;O.style.display=ye==null||typeof ye=="boolean"?"":(""+ye).trim()}}catch(lt){fn(K,K.return,lt)}}}else if(r.tag===6){if(l===null){K=r;try{K.stateNode.nodeValue=p?"":K.memoizedProps}catch(lt){fn(K,K.return,lt)}}}else if(r.tag===18){if(l===null){K=r;try{var je=K.stateNode;p?sv(je,!0):sv(K.stateNode,!1)}catch(lt){fn(K,K.return,lt)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===e)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;l===r&&(l=null),r=r.return}l===r&&(l=null),r.sibling.return=r.return,r=r.sibling}c&4&&(c=e.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,Kc(e,l))));break;case 19:gr(r,e),yr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Kc(e,c)));break;case 30:break;case 21:break;default:gr(r,e),yr(e)}}function yr(e){var r=e.flags;if(r&2){try{for(var l,c=e.return;c!==null;){if(ay(c)){l=c;break}c=c.return}if(l==null)throw Error(a(160));switch(l.tag){case 27:var p=l.stateNode,g=Rh(e);Gc(e,g,p);break;case 5:var j=l.stateNode;l.flags&32&&(Qs(j,""),l.flags&=-33);var O=Rh(e);Gc(e,O,j);break;case 3:case 4:var K=l.stateNode.containerInfo,me=Rh(e);Oh(e,me,K);break;default:throw Error(a(161))}}catch(ke){fn(e,e.return,ke)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function my(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var r=e;my(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),e=e.sibling}}function Ds(e,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)cy(e,r.alternate,r),r=r.sibling}function ta(e){for(e=e.child;e!==null;){var r=e;switch(r.tag){case 0:case 11:case 14:case 15:di(4,r,r.return),ta(r);break;case 1:gs(r,r.return);var l=r.stateNode;typeof l.componentWillUnmount=="function"&&sy(r,r.return,l),ta(r);break;case 27:vo(r.stateNode);case 26:case 5:gs(r,r.return),ta(r);break;case 22:r.memoizedState===null&&ta(r);break;case 30:ta(r);break;default:ta(r)}e=e.sibling}}function Ms(e,r,l){for(l=l&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var c=r.alternate,p=e,g=r,j=g.flags;switch(g.tag){case 0:case 11:case 15:Ms(p,g,l),lo(4,g);break;case 1:if(Ms(p,g,l),c=g,p=c.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(me){fn(c,c.return,me)}if(c=g,p=c.updateQueue,p!==null){var O=c.stateNode;try{var K=p.shared.hiddenCallbacks;if(K!==null)for(p.shared.hiddenCallbacks=null,p=0;p<K.length;p++)Gm(K[p],O)}catch(me){fn(c,c.return,me)}}l&&j&64&&ry(g),oo(g,g.return);break;case 27:ly(g);case 26:case 5:Ms(p,g,l),l&&c===null&&j&4&&iy(g),oo(g,g.return);break;case 12:Ms(p,g,l);break;case 31:Ms(p,g,l),l&&j&4&&hy(p,g);break;case 13:Ms(p,g,l),l&&j&4&&fy(p,g);break;case 22:g.memoizedState===null&&Ms(p,g,l),oo(g,g.return);break;case 30:break;default:Ms(p,g,l)}r=r.sibling}}function Mh(e,r){var l=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),e=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(e=r.memoizedState.cachePool.pool),e!==l&&(e!=null&&e.refCount++,l!=null&&Yl(l))}function zh(e,r){e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&Yl(e))}function ss(e,r,l,c){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)gy(e,r,l,c),r=r.sibling}function gy(e,r,l,c){var p=r.flags;switch(r.tag){case 0:case 11:case 15:ss(e,r,l,c),p&2048&&lo(9,r);break;case 1:ss(e,r,l,c);break;case 3:ss(e,r,l,c),p&2048&&(e=null,r.alternate!==null&&(e=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==e&&(r.refCount++,e!=null&&Yl(e)));break;case 12:if(p&2048){ss(e,r,l,c),e=r.stateNode;try{var g=r.memoizedProps,j=g.id,O=g.onPostCommit;typeof O=="function"&&O(j,r.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(K){fn(r,r.return,K)}}else ss(e,r,l,c);break;case 31:ss(e,r,l,c);break;case 13:ss(e,r,l,c);break;case 23:break;case 22:g=r.stateNode,j=r.alternate,r.memoizedState!==null?g._visibility&2?ss(e,r,l,c):co(e,r):g._visibility&2?ss(e,r,l,c):(g._visibility|=2,Fa(e,r,l,c,(r.subtreeFlags&10256)!==0||!1)),p&2048&&Mh(j,r);break;case 24:ss(e,r,l,c),p&2048&&zh(r.alternate,r);break;default:ss(e,r,l,c)}}function Fa(e,r,l,c,p){for(p=p&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var g=e,j=r,O=l,K=c,me=j.flags;switch(j.tag){case 0:case 11:case 15:Fa(g,j,O,K,p),lo(8,j);break;case 23:break;case 22:var ke=j.stateNode;j.memoizedState!==null?ke._visibility&2?Fa(g,j,O,K,p):co(g,j):(ke._visibility|=2,Fa(g,j,O,K,p)),p&&me&2048&&Mh(j.alternate,j);break;case 24:Fa(g,j,O,K,p),p&&me&2048&&zh(j.alternate,j);break;default:Fa(g,j,O,K,p)}r=r.sibling}}function co(e,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var l=e,c=r,p=c.flags;switch(c.tag){case 22:co(l,c),p&2048&&Mh(c.alternate,c);break;case 24:co(l,c),p&2048&&zh(c.alternate,c);break;default:co(l,c)}r=r.sibling}}var uo=8192;function Ha(e,r,l){if(e.subtreeFlags&uo)for(e=e.child;e!==null;)yy(e,r,l),e=e.sibling}function yy(e,r,l){switch(e.tag){case 26:Ha(e,r,l),e.flags&uo&&e.memoizedState!==null&&zS(l,rs,e.memoizedState,e.memoizedProps);break;case 5:Ha(e,r,l);break;case 3:case 4:var c=rs;rs=lu(e.stateNode.containerInfo),Ha(e,r,l),rs=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=uo,uo=16777216,Ha(e,r,l),uo=c):Ha(e,r,l));break;default:Ha(e,r,l)}}function vy(e){var r=e.alternate;if(r!==null&&(e=r.child,e!==null)){r.child=null;do r=e.sibling,e.sibling=null,e=r;while(e!==null)}}function ho(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];Yn=c,by(c,e)}vy(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)xy(e),e=e.sibling}function xy(e){switch(e.tag){case 0:case 11:case 15:ho(e),e.flags&2048&&di(9,e,e.return);break;case 3:ho(e);break;case 12:ho(e);break;case 22:var r=e.stateNode;e.memoizedState!==null&&r._visibility&2&&(e.return===null||e.return.tag!==13)?(r._visibility&=-3,Yc(e)):ho(e);break;default:ho(e)}}function Yc(e){var r=e.deletions;if((e.flags&16)!==0){if(r!==null)for(var l=0;l<r.length;l++){var c=r[l];Yn=c,by(c,e)}vy(e)}for(e=e.child;e!==null;){switch(r=e,r.tag){case 0:case 11:case 15:di(8,r,r.return),Yc(r);break;case 22:l=r.stateNode,l._visibility&2&&(l._visibility&=-3,Yc(r));break;default:Yc(r)}e=e.sibling}}function by(e,r){for(;Yn!==null;){var l=Yn;switch(l.tag){case 0:case 11:case 15:di(8,l,r);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Yl(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,Yn=c;else e:for(l=e;Yn!==null;){c=Yn;var p=c.sibling,g=c.return;if(uy(c),c===l){Yn=null;break e}if(p!==null){p.return=g,Yn=p;break e}Yn=g}}}var Qw={getCacheForType:function(e){var r=er(In),l=r.data.get(e);return l===void 0&&(l=e(),r.data.set(e,l)),l},cacheSignal:function(){return er(In).controller.signal}},Jw=typeof WeakMap=="function"?WeakMap:Map,ln=0,yn=null,Kt=null,Xt=0,hn=0,Er=null,hi=!1,Va=!1,Lh=!1,zs=0,Rn=0,fi=0,na=0,Uh=0,kr=0,Ga=0,fo=null,vr=null,Ih=!1,Wc=0,wy=0,Qc=1/0,Jc=null,pi=null,Fn=0,mi=null,Ka=null,Ls=0,Bh=0,$h=null,Sy=null,po=0,Ph=null;function Tr(){return(ln&2)!==0&&Xt!==0?Xt&-Xt:T.T!==null?Kh():Ft()}function jy(){if(kr===0)if((Xt&536870912)===0||en){var e=Te;Te<<=1,(Te&3932160)===0&&(Te=262144),kr=e}else kr=536870912;return e=Cr.current,e!==null&&(e.flags|=32),kr}function xr(e,r,l){(e===yn&&(hn===2||hn===9)||e.cancelPendingCommit!==null)&&(Ya(e,0),gi(e,Xt,kr,!1)),ue(e,l),((ln&2)===0||e!==yn)&&(e===yn&&((ln&2)===0&&(na|=l),Rn===4&&gi(e,Xt,kr,!1)),ys(e))}function _y(e,r,l){if((ln&6)!==0)throw Error(a(327));var c=!l&&(r&127)===0&&(r&e.expiredLanes)===0||gt(e,r),p=c?eS(e,r):Fh(e,r,!0),g=c;do{if(p===0){Va&&!c&&gi(e,r,0,!1);break}else{if(l=e.current.alternate,g&&!Xw(l)){p=Fh(e,r,!1),g=!1;continue}if(p===2){if(g=r,e.errorRecoveryDisabledLanes&g)var j=0;else j=e.pendingLanes&-536870913,j=j!==0?j:j&536870912?536870912:0;if(j!==0){r=j;e:{var O=e;p=fo;var K=O.current.memoizedState.isDehydrated;if(K&&(Ya(O,j).flags|=256),j=Fh(O,j,!1),j!==2){if(Lh&&!K){O.errorRecoveryDisabledLanes|=g,na|=g,p=4;break e}g=vr,vr=p,g!==null&&(vr===null?vr=g:vr.push.apply(vr,g))}p=j}if(g=!1,p!==2)continue}}if(p===1){Ya(e,0),gi(e,r,0,!0);break}e:{switch(c=e,g=p,g){case 0:case 1:throw Error(a(345));case 4:if((r&4194048)!==r)break;case 6:gi(c,r,kr,!hi);break e;case 2:vr=null;break;case 3:case 5:break;default:throw Error(a(329))}if((r&62914560)===r&&(p=Wc+300-Ct(),10<p)){if(gi(c,r,kr,!hi),it(c,0,!0)!==0)break e;Ls=r,c.timeoutHandle=tv(Cy.bind(null,c,l,vr,Jc,Ih,r,kr,na,Ga,hi,g,"Throttled",-0,0),p);break e}Cy(c,l,vr,Jc,Ih,r,kr,na,Ga,hi,g,null,-0,0)}}break}while(!0);ys(e)}function Cy(e,r,l,c,p,g,j,O,K,me,ke,Me,ye,je){if(e.timeoutHandle=-1,Me=r.subtreeFlags,Me&8192||(Me&16785408)===16785408){Me={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Lr},yy(r,g,Me);var lt=(g&62914560)===g?Wc-Ct():(g&4194048)===g?wy-Ct():0;if(lt=LS(Me,lt),lt!==null){Ls=g,e.cancelPendingCommit=lt(Dy.bind(null,e,r,g,l,c,p,j,O,K,ke,Me,null,ye,je)),gi(e,g,j,!me);return}}Dy(e,r,g,l,c,p,j,O,K)}function Xw(e){for(var r=e;;){var l=r.tag;if((l===0||l===11||l===15)&&r.flags&16384&&(l=r.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var p=l[c],g=p.getSnapshot;p=p.value;try{if(!jr(g(),p))return!1}catch{return!1}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function gi(e,r,l,c){r&=~Uh,r&=~na,e.suspendedLanes|=r,e.pingedLanes&=~r,c&&(e.warmLanes|=r),c=e.expirationTimes;for(var p=r;0<p;){var g=31-Gt(p),j=1<<g;c[g]=-1,p&=~j}l!==0&&at(e,l,r)}function Xc(){return(ln&6)===0?(mo(0),!1):!0}function qh(){if(Kt!==null){if(hn===0)var e=Kt.return;else e=Kt,Cs=Ki=null,sh(e),Ia=null,Ql=0,e=Kt;for(;e!==null;)ny(e.alternate,e),e=e.return;Kt=null}}function Ya(e,r){var l=e.timeoutHandle;l!==-1&&(e.timeoutHandle=-1,vS(l)),l=e.cancelPendingCommit,l!==null&&(e.cancelPendingCommit=null,l()),Ls=0,qh(),yn=e,Kt=l=js(e.current,null),Xt=r,hn=0,Er=null,hi=!1,Va=gt(e,r),Lh=!1,Ga=kr=Uh=na=fi=Rn=0,vr=fo=null,Ih=!1,(r&8)!==0&&(r|=r&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=r;0<c;){var p=31-Gt(c),g=1<<p;r|=e[p],c&=~g}return zs=r,xc(),l}function Ny(e,r){qt=null,T.H=so,r===Ua||r===Ec?(r=qm(),hn=3):r===Gd?(r=qm(),hn=4):hn=r===bh?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,Er=r,Kt===null&&(Rn=1,Pc(e,Br(r,e.current)))}function Ey(){var e=Cr.current;return e===null?!0:(Xt&4194048)===Xt?Fr===null:(Xt&62914560)===Xt||(Xt&536870912)!==0?e===Fr:!1}function ky(){var e=T.H;return T.H=so,e===null?so:e}function Ty(){var e=T.A;return T.A=Qw,e}function Zc(){Rn=4,hi||(Xt&4194048)!==Xt&&Cr.current!==null||(Va=!0),(fi&134217727)===0&&(na&134217727)===0||yn===null||gi(yn,Xt,kr,!1)}function Fh(e,r,l){var c=ln;ln|=2;var p=ky(),g=Ty();(yn!==e||Xt!==r)&&(Jc=null,Ya(e,r)),r=!1;var j=Rn;e:do try{if(hn!==0&&Kt!==null){var O=Kt,K=Er;switch(hn){case 8:qh(),j=6;break e;case 3:case 2:case 9:case 6:Cr.current===null&&(r=!0);var me=hn;if(hn=0,Er=null,Wa(e,O,K,me),l&&Va){j=0;break e}break;default:me=hn,hn=0,Er=null,Wa(e,O,K,me)}}Zw(),j=Rn;break}catch(ke){Ny(e,ke)}while(!0);return r&&e.shellSuspendCounter++,Cs=Ki=null,ln=c,T.H=p,T.A=g,Kt===null&&(yn=null,Xt=0,xc()),j}function Zw(){for(;Kt!==null;)Ay(Kt)}function eS(e,r){var l=ln;ln|=2;var c=ky(),p=Ty();yn!==e||Xt!==r?(Jc=null,Qc=Ct()+500,Ya(e,r)):Va=gt(e,r);e:do try{if(hn!==0&&Kt!==null){r=Kt;var g=Er;t:switch(hn){case 1:hn=0,Er=null,Wa(e,r,g,1);break;case 2:case 9:if($m(g)){hn=0,Er=null,Ry(r);break}r=function(){hn!==2&&hn!==9||yn!==e||(hn=7),ys(e)},g.then(r,r);break e;case 3:hn=7;break e;case 4:hn=5;break e;case 7:$m(g)?(hn=0,Er=null,Ry(r)):(hn=0,Er=null,Wa(e,r,g,7));break;case 5:var j=null;switch(Kt.tag){case 26:j=Kt.memoizedState;case 5:case 27:var O=Kt;if(j?gv(j):O.stateNode.complete){hn=0,Er=null;var K=O.sibling;if(K!==null)Kt=K;else{var me=O.return;me!==null?(Kt=me,eu(me)):Kt=null}break t}}hn=0,Er=null,Wa(e,r,g,5);break;case 6:hn=0,Er=null,Wa(e,r,g,6);break;case 8:qh(),Rn=6;break e;default:throw Error(a(462))}}tS();break}catch(ke){Ny(e,ke)}while(!0);return Cs=Ki=null,T.H=c,T.A=p,ln=l,Kt!==null?0:(yn=null,Xt=0,xc(),Rn)}function tS(){for(;Kt!==null&&!Be();)Ay(Kt)}function Ay(e){var r=ey(e.alternate,e,zs);e.memoizedProps=e.pendingProps,r===null?eu(e):Kt=r}function Ry(e){var r=e,l=r.alternate;switch(r.tag){case 15:case 0:r=Yg(l,r,r.pendingProps,r.type,void 0,Xt);break;case 11:r=Yg(l,r,r.pendingProps,r.type.render,r.ref,Xt);break;case 5:sh(r);default:ny(l,r),r=Kt=Tm(r,zs),r=ey(l,r,zs)}e.memoizedProps=e.pendingProps,r===null?eu(e):Kt=r}function Wa(e,r,l,c){Cs=Ki=null,sh(r),Ia=null,Ql=0;var p=r.return;try{if(Fw(e,p,r,l,Xt)){Rn=1,Pc(e,Br(l,e.current)),Kt=null;return}}catch(g){if(p!==null)throw Kt=p,g;Rn=1,Pc(e,Br(l,e.current)),Kt=null;return}r.flags&32768?(en||c===1?e=!0:Va||(Xt&536870912)!==0?e=!1:(hi=e=!0,(c===2||c===9||c===3||c===6)&&(c=Cr.current,c!==null&&c.tag===13&&(c.flags|=16384))),Oy(r,e)):eu(r)}function eu(e){var r=e;do{if((r.flags&32768)!==0){Oy(r,hi);return}e=r.return;var l=Gw(r.alternate,r,zs);if(l!==null){Kt=l;return}if(r=r.sibling,r!==null){Kt=r;return}Kt=r=e}while(r!==null);Rn===0&&(Rn=5)}function Oy(e,r){do{var l=Kw(e.alternate,e);if(l!==null){l.flags&=32767,Kt=l;return}if(l=e.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!r&&(e=e.sibling,e!==null)){Kt=e;return}Kt=e=l}while(e!==null);Rn=6,Kt=null}function Dy(e,r,l,c,p,g,j,O,K){e.cancelPendingCommit=null;do tu();while(Fn!==0);if((ln&6)!==0)throw Error(a(327));if(r!==null){if(r===e.current)throw Error(a(177));if(g=r.lanes|r.childLanes,g|=Rd,Ke(e,l,g,j,O,K),e===yn&&(Kt=yn=null,Xt=0),Ka=r,mi=e,Ls=l,Bh=g,$h=p,Sy=c,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,iS(jt,function(){return Iy(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||c){c=T.T,T.T=null,p=z.p,z.p=2,j=ln,ln|=4;try{Yw(e,r,l)}finally{ln=j,z.p=p,T.T=c}}Fn=1,My(),zy(),Ly()}}function My(){if(Fn===1){Fn=0;var e=mi,r=Ka,l=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||l){l=T.T,T.T=null;var c=z.p;z.p=2;var p=ln;ln|=4;try{py(r,e);var g=tf,j=bm(e.containerInfo),O=g.focusedElem,K=g.selectionRange;if(j!==O&&O&&O.ownerDocument&&xm(O.ownerDocument.documentElement,O)){if(K!==null&&Nd(O)){var me=K.start,ke=K.end;if(ke===void 0&&(ke=me),"selectionStart"in O)O.selectionStart=me,O.selectionEnd=Math.min(ke,O.value.length);else{var Me=O.ownerDocument||document,ye=Me&&Me.defaultView||window;if(ye.getSelection){var je=ye.getSelection(),lt=O.textContent.length,Et=Math.min(K.start,lt),gn=K.end===void 0?Et:Math.min(K.end,lt);!je.extend&&Et>gn&&(j=gn,gn=Et,Et=j);var ce=vm(O,Et),se=vm(O,gn);if(ce&&se&&(je.rangeCount!==1||je.anchorNode!==ce.node||je.anchorOffset!==ce.offset||je.focusNode!==se.node||je.focusOffset!==se.offset)){var pe=Me.createRange();pe.setStart(ce.node,ce.offset),je.removeAllRanges(),Et>gn?(je.addRange(pe),je.extend(se.node,se.offset)):(pe.setEnd(se.node,se.offset),je.addRange(pe))}}}}for(Me=[],je=O;je=je.parentNode;)je.nodeType===1&&Me.push({element:je,left:je.scrollLeft,top:je.scrollTop});for(typeof O.focus=="function"&&O.focus(),O=0;O<Me.length;O++){var Oe=Me[O];Oe.element.scrollLeft=Oe.left,Oe.element.scrollTop=Oe.top}}fu=!!ef,tf=ef=null}finally{ln=p,z.p=c,T.T=l}}e.current=r,Fn=2}}function zy(){if(Fn===2){Fn=0;var e=mi,r=Ka,l=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||l){l=T.T,T.T=null;var c=z.p;z.p=2;var p=ln;ln|=4;try{cy(e,r.alternate,r)}finally{ln=p,z.p=c,T.T=l}}Fn=3}}function Ly(){if(Fn===4||Fn===3){Fn=0,ut();var e=mi,r=Ka,l=Ls,c=Sy;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?Fn=5:(Fn=0,Ka=mi=null,Uy(e,e.pendingLanes));var p=e.pendingLanes;if(p===0&&(pi=null),Dt(l),r=r.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(Mt,r,void 0,(r.current.flags&128)===128)}catch{}if(c!==null){r=T.T,p=z.p,z.p=2,T.T=null;try{for(var g=e.onRecoverableError,j=0;j<c.length;j++){var O=c[j];g(O.value,{componentStack:O.stack})}}finally{T.T=r,z.p=p}}(Ls&3)!==0&&tu(),ys(e),p=e.pendingLanes,(l&261930)!==0&&(p&42)!==0?e===Ph?po++:(po=0,Ph=e):po=0,mo(0)}}function Uy(e,r){(e.pooledCacheLanes&=r)===0&&(r=e.pooledCache,r!=null&&(e.pooledCache=null,Yl(r)))}function tu(){return My(),zy(),Ly(),Iy()}function Iy(){if(Fn!==5)return!1;var e=mi,r=Bh;Bh=0;var l=Dt(Ls),c=T.T,p=z.p;try{z.p=32>l?32:l,T.T=null,l=$h,$h=null;var g=mi,j=Ls;if(Fn=0,Ka=mi=null,Ls=0,(ln&6)!==0)throw Error(a(331));var O=ln;if(ln|=4,xy(g.current),gy(g,g.current,j,l),ln=O,mo(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(Mt,g)}catch{}return!0}finally{z.p=p,T.T=c,Uy(e,r)}}function By(e,r,l){r=Br(l,r),r=xh(e.stateNode,r,2),e=oi(e,r,2),e!==null&&(ue(e,2),ys(e))}function fn(e,r,l){if(e.tag===3)By(e,e,l);else for(;r!==null;){if(r.tag===3){By(r,e,l);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(pi===null||!pi.has(c))){e=Br(l,e),l=$g(2),c=oi(r,l,2),c!==null&&(Pg(l,c,r,e),ue(c,2),ys(c));break}}r=r.return}}function Hh(e,r,l){var c=e.pingCache;if(c===null){c=e.pingCache=new Jw;var p=new Set;c.set(r,p)}else p=c.get(r),p===void 0&&(p=new Set,c.set(r,p));p.has(l)||(Lh=!0,p.add(l),e=nS.bind(null,e,r,l),r.then(e,e))}function nS(e,r,l){var c=e.pingCache;c!==null&&c.delete(r),e.pingedLanes|=e.suspendedLanes&l,e.warmLanes&=~l,yn===e&&(Xt&l)===l&&(Rn===4||Rn===3&&(Xt&62914560)===Xt&&300>Ct()-Wc?(ln&2)===0&&Ya(e,0):Uh|=l,Ga===Xt&&(Ga=0)),ys(e)}function $y(e,r){r===0&&(r=Pt()),e=Hi(e,r),e!==null&&(ue(e,r),ys(e))}function rS(e){var r=e.memoizedState,l=0;r!==null&&(l=r.retryLane),$y(e,l)}function sS(e,r){var l=0;switch(e.tag){case 31:case 13:var c=e.stateNode,p=e.memoizedState;p!==null&&(l=p.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(r),$y(e,l)}function iS(e,r){return Se(e,r)}var nu=null,Qa=null,Vh=!1,ru=!1,Gh=!1,yi=0;function ys(e){e!==Qa&&e.next===null&&(Qa===null?nu=Qa=e:Qa=Qa.next=e),ru=!0,Vh||(Vh=!0,lS())}function mo(e,r){if(!Gh&&ru){Gh=!0;do for(var l=!1,c=nu;c!==null;){if(e!==0){var p=c.pendingLanes;if(p===0)var g=0;else{var j=c.suspendedLanes,O=c.pingedLanes;g=(1<<31-Gt(42|e)+1)-1,g&=p&~(j&~O),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(l=!0,Hy(c,g))}else g=Xt,g=it(c,c===yn?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||gt(c,g)||(l=!0,Hy(c,g));c=c.next}while(l);Gh=!1}}function aS(){Py()}function Py(){ru=Vh=!1;var e=0;yi!==0&&yS()&&(e=yi);for(var r=Ct(),l=null,c=nu;c!==null;){var p=c.next,g=qy(c,r);g===0?(c.next=null,l===null?nu=p:l.next=p,p===null&&(Qa=l)):(l=c,(e!==0||(g&3)!==0)&&(ru=!0)),c=p}Fn!==0&&Fn!==5||mo(e),yi!==0&&(yi=0)}function qy(e,r){for(var l=e.suspendedLanes,c=e.pingedLanes,p=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var j=31-Gt(g),O=1<<j,K=p[j];K===-1?((O&l)===0||(O&c)!==0)&&(p[j]=Lt(O,r)):K<=r&&(e.expiredLanes|=O),g&=~O}if(r=yn,l=Xt,l=it(e,e===r?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,l===0||e===r&&(hn===2||hn===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&te(c),e.callbackNode=null,e.callbackPriority=0;if((l&3)===0||gt(e,l)){if(r=l&-l,r===e.callbackPriority)return r;switch(c!==null&&te(c),Dt(l)){case 2:case 8:l=Ot;break;case 32:l=jt;break;case 268435456:l=Vt;break;default:l=jt}return c=Fy.bind(null,e),l=Se(l,c),e.callbackPriority=r,e.callbackNode=l,r}return c!==null&&c!==null&&te(c),e.callbackPriority=2,e.callbackNode=null,2}function Fy(e,r){if(Fn!==0&&Fn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var l=e.callbackNode;if(tu()&&e.callbackNode!==l)return null;var c=Xt;return c=it(e,e===yn?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(_y(e,c,r),qy(e,Ct()),e.callbackNode!=null&&e.callbackNode===l?Fy.bind(null,e):null)}function Hy(e,r){if(tu())return null;_y(e,r,!0)}function lS(){xS(function(){(ln&6)!==0?Se(mt,aS):Py()})}function Kh(){if(yi===0){var e=za;e===0&&(e=De,De<<=1,(De&261888)===0&&(De=256)),yi=e}return yi}function Vy(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ca(""+e)}function Gy(e,r){var l=r.ownerDocument.createElement("input");return l.name=r.name,l.value=r.value,e.id&&l.setAttribute("form",e.id),r.parentNode.insertBefore(l,r),e=new FormData(e),l.parentNode.removeChild(l),e}function oS(e,r,l,c,p){if(r==="submit"&&l&&l.stateNode===p){var g=Vy((p[Ve]||null).action),j=c.submitter;j&&(r=(r=j[Ve]||null)?Vy(r.formAction):j.getAttribute("formAction"),r!==null&&(g=r,j=null));var O=new pt("action","action",null,c,p);e.push({event:O,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(yi!==0){var K=j?Gy(p,j):new FormData(p);fh(l,{pending:!0,data:K,method:p.method,action:g},null,K)}}else typeof g=="function"&&(O.preventDefault(),K=j?Gy(p,j):new FormData(p),fh(l,{pending:!0,data:K,method:p.method,action:g},g,K))},currentTarget:p}]})}}for(var Yh=0;Yh<Ad.length;Yh++){var Wh=Ad[Yh],cS=Wh.toLowerCase(),uS=Wh[0].toUpperCase()+Wh.slice(1);ns(cS,"on"+uS)}ns(jm,"onAnimationEnd"),ns(_m,"onAnimationIteration"),ns(Cm,"onAnimationStart"),ns("dblclick","onDoubleClick"),ns("focusin","onFocus"),ns("focusout","onBlur"),ns(Nw,"onTransitionRun"),ns(Ew,"onTransitionStart"),ns(kw,"onTransitionCancel"),ns(Nm,"onTransitionEnd"),un("onMouseEnter",["mouseout","mouseover"]),un("onMouseLeave",["mouseout","mouseover"]),un("onPointerEnter",["pointerout","pointerover"]),un("onPointerLeave",["pointerout","pointerover"]),Qt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var go="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(go));function Ky(e,r){r=(r&4)!==0;for(var l=0;l<e.length;l++){var c=e[l],p=c.event;c=c.listeners;e:{var g=void 0;if(r)for(var j=c.length-1;0<=j;j--){var O=c[j],K=O.instance,me=O.currentTarget;if(O=O.listener,K!==g&&p.isPropagationStopped())break e;g=O,p.currentTarget=me;try{g(p)}catch(ke){vc(ke)}p.currentTarget=null,g=K}else for(j=0;j<c.length;j++){if(O=c[j],K=O.instance,me=O.currentTarget,O=O.listener,K!==g&&p.isPropagationStopped())break e;g=O,p.currentTarget=me;try{g(p)}catch(ke){vc(ke)}p.currentTarget=null,g=K}}}}function Yt(e,r){var l=r[W];l===void 0&&(l=r[W]=new Set);var c=e+"__bubble";l.has(c)||(Yy(r,e,2,!1),l.add(c))}function Qh(e,r,l){var c=0;r&&(c|=4),Yy(l,e,c,r)}var su="_reactListening"+Math.random().toString(36).slice(2);function Jh(e){if(!e[su]){e[su]=!0,et.forEach(function(l){l!=="selectionchange"&&(dS.has(l)||Qh(l,!1,e),Qh(l,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[su]||(r[su]=!0,Qh("selectionchange",!1,r))}}function Yy(e,r,l,c){switch(jv(r)){case 2:var p=BS;break;case 8:p=$S;break;default:p=ff}l=p.bind(null,r,l,e),p=void 0,!I||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),c?p!==void 0?e.addEventListener(r,l,{capture:!0,passive:p}):e.addEventListener(r,l,!0):p!==void 0?e.addEventListener(r,l,{passive:p}):e.addEventListener(r,l,!1)}function Xh(e,r,l,c,p){var g=c;if((r&1)===0&&(r&2)===0&&c!==null)e:for(;;){if(c===null)return;var j=c.tag;if(j===3||j===4){var O=c.stateNode.containerInfo;if(O===p)break;if(j===4)for(j=c.return;j!==null;){var K=j.tag;if((K===3||K===4)&&j.stateNode.containerInfo===p)return;j=j.return}for(;O!==null;){if(j=Je(O),j===null)return;if(K=j.tag,K===5||K===6||K===26||K===27){c=g=j;continue e}O=O.parentNode}}c=c.return}$i(function(){var me=g,ke=Ul(l),Me=[];e:{var ye=Em.get(e);if(ye!==void 0){var je=pt,lt=e;switch(e){case"keypress":if(Ge(l)===0)break e;case"keydown":case"keyup":je=sw;break;case"focusin":lt="focus",je=kn;break;case"focusout":lt="blur",je=kn;break;case"beforeblur":case"afterblur":je=kn;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":je=ht;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":je=Bt;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":je=lw;break;case jm:case _m:case Cm:je=Jt;break;case Nm:je=cw;break;case"scroll":case"scrollend":je=Ut;break;case"wheel":je=dw;break;case"copy":case"cut":case"paste":je=Un;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":je=sm;break;case"toggle":case"beforetoggle":je=fw}var Et=(r&4)!==0,gn=!Et&&(e==="scroll"||e==="scrollend"),ce=Et?ye!==null?ye+"Capture":null:ye;Et=[];for(var se=me,pe;se!==null;){var Oe=se;if(pe=Oe.stateNode,Oe=Oe.tag,Oe!==5&&Oe!==26&&Oe!==27||pe===null||ce===null||(Oe=Zs(se,ce),Oe!=null&&Et.push(yo(se,Oe,pe))),gn)break;se=se.return}0<Et.length&&(ye=new je(ye,lt,null,l,ke),Me.push({event:ye,listeners:Et}))}}if((r&7)===0){e:{if(ye=e==="mouseover"||e==="pointerover",je=e==="mouseout"||e==="pointerout",ye&&l!==Ll&&(lt=l.relatedTarget||l.fromElement)&&(Je(lt)||lt[_t]))break e;if((je||ye)&&(ye=ke.window===ke?ke:(ye=ke.ownerDocument)?ye.defaultView||ye.parentWindow:window,je?(lt=l.relatedTarget||l.toElement,je=me,lt=lt?Je(lt):null,lt!==null&&(gn=u(lt),Et=lt.tag,lt!==gn||Et!==5&&Et!==27&&Et!==6)&&(lt=null)):(je=null,lt=me),je!==lt)){if(Et=ht,Oe="onMouseLeave",ce="onMouseEnter",se="mouse",(e==="pointerout"||e==="pointerover")&&(Et=sm,Oe="onPointerLeave",ce="onPointerEnter",se="pointer"),gn=je==null?ye:wt(je),pe=lt==null?ye:wt(lt),ye=new Et(Oe,se+"leave",je,l,ke),ye.target=gn,ye.relatedTarget=pe,Oe=null,Je(ke)===me&&(Et=new Et(ce,se+"enter",lt,l,ke),Et.target=pe,Et.relatedTarget=gn,Oe=Et),gn=Oe,je&&lt)t:{for(Et=hS,ce=je,se=lt,pe=0,Oe=ce;Oe;Oe=Et(Oe))pe++;Oe=0;for(var vt=se;vt;vt=Et(vt))Oe++;for(;0<pe-Oe;)ce=Et(ce),pe--;for(;0<Oe-pe;)se=Et(se),Oe--;for(;pe--;){if(ce===se||se!==null&&ce===se.alternate){Et=ce;break t}ce=Et(ce),se=Et(se)}Et=null}else Et=null;je!==null&&Wy(Me,ye,je,Et,!1),lt!==null&&gn!==null&&Wy(Me,gn,lt,Et,!0)}}e:{if(ye=me?wt(me):window,je=ye.nodeName&&ye.nodeName.toLowerCase(),je==="select"||je==="input"&&ye.type==="file")var rn=hm;else if(um(ye))if(fm)rn=jw;else{rn=ww;var dt=bw}else je=ye.nodeName,!je||je.toLowerCase()!=="input"||ye.type!=="checkbox"&&ye.type!=="radio"?me&&zl(me.elementType)&&(rn=hm):rn=Sw;if(rn&&(rn=rn(e,me))){dm(Me,rn,l,ke);break e}dt&&dt(e,ye,me),e==="focusout"&&me&&ye.type==="number"&&me.memoizedProps.value!=null&&Ol(ye,"number",ye.value)}switch(dt=me?wt(me):window,e){case"focusin":(um(dt)||dt.contentEditable==="true")&&(Ea=dt,Ed=me,Vl=null);break;case"focusout":Vl=Ed=Ea=null;break;case"mousedown":kd=!0;break;case"contextmenu":case"mouseup":case"dragend":kd=!1,wm(Me,l,ke);break;case"selectionchange":if(Cw)break;case"keydown":case"keyup":wm(Me,l,ke)}var Ht;if(jd)e:{switch(e){case"compositionstart":var Zt="onCompositionStart";break e;case"compositionend":Zt="onCompositionEnd";break e;case"compositionupdate":Zt="onCompositionUpdate";break e}Zt=void 0}else Na?om(e,l)&&(Zt="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(Zt="onCompositionStart");Zt&&(im&&l.locale!=="ko"&&(Na||Zt!=="onCompositionStart"?Zt==="onCompositionEnd"&&Na&&(Ht=Ie()):(ie=ke,we="value"in ie?ie.value:ie.textContent,Na=!0)),dt=iu(me,Zt),0<dt.length&&(Zt=new ts(Zt,e,null,l,ke),Me.push({event:Zt,listeners:dt}),Ht?Zt.data=Ht:(Ht=cm(l),Ht!==null&&(Zt.data=Ht)))),(Ht=mw?gw(e,l):yw(e,l))&&(Zt=iu(me,"onBeforeInput"),0<Zt.length&&(dt=new ts("onBeforeInput","beforeinput",null,l,ke),Me.push({event:dt,listeners:Zt}),dt.data=Ht)),oS(Me,e,me,l,ke)}Ky(Me,r)})}function yo(e,r,l){return{instance:e,listener:r,currentTarget:l}}function iu(e,r){for(var l=r+"Capture",c=[];e!==null;){var p=e,g=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||g===null||(p=Zs(e,l),p!=null&&c.unshift(yo(e,p,g)),p=Zs(e,r),p!=null&&c.push(yo(e,p,g))),e.tag===3)return c;e=e.return}return[]}function hS(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Wy(e,r,l,c,p){for(var g=r._reactName,j=[];l!==null&&l!==c;){var O=l,K=O.alternate,me=O.stateNode;if(O=O.tag,K!==null&&K===c)break;O!==5&&O!==26&&O!==27||me===null||(K=me,p?(me=Zs(l,g),me!=null&&j.unshift(yo(l,me,K))):p||(me=Zs(l,g),me!=null&&j.push(yo(l,me,K)))),l=l.return}j.length!==0&&e.push({event:r,listeners:j})}var fS=/\r\n?/g,pS=/\u0000|\uFFFD/g;function Qy(e){return(typeof e=="string"?e:""+e).replace(fS,`
`).replace(pS,"")}function Jy(e,r){return r=Qy(r),Qy(e)===r}function mn(e,r,l,c,p,g){switch(l){case"children":typeof c=="string"?r==="body"||r==="textarea"&&c===""||Qs(e,c):(typeof c=="number"||typeof c=="bigint")&&r!=="body"&&Qs(e,""+c);break;case"className":Ws(e,"class",c);break;case"tabIndex":Ws(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Ws(e,l,c);break;case"style":Ml(e,c,g);break;case"data":if(r!=="object"){Ws(e,"data",c);break}case"src":case"href":if(c===""&&(r!=="a"||l!=="href")){e.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=Ca(""+c),e.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(l==="formAction"?(r!=="input"&&mn(e,r,"name",p.name,p,null),mn(e,r,"formEncType",p.formEncType,p,null),mn(e,r,"formMethod",p.formMethod,p,null),mn(e,r,"formTarget",p.formTarget,p,null)):(mn(e,r,"encType",p.encType,p,null),mn(e,r,"method",p.method,p,null),mn(e,r,"target",p.target,p,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=Ca(""+c),e.setAttribute(l,c);break;case"onClick":c!=null&&(e.onclick=Lr);break;case"onScroll":c!=null&&Yt("scroll",e);break;case"onScrollEnd":c!=null&&Yt("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(p.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}l=Ca(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""+c):e.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""):e.removeAttribute(l);break;case"capture":case"download":c===!0?e.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,c):e.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(l,c):e.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(l):e.setAttribute(l,c);break;case"popover":Yt("beforetoggle",e),Yt("toggle",e),Ui(e,"popover",c);break;case"xlinkActuate":Xr(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Xr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Xr(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Xr(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Xr(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Xr(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Ui(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Sd.get(l)||l,Ui(e,l,c))}}function Zh(e,r,l,c,p,g){switch(l){case"style":Ml(e,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(p.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"children":typeof c=="string"?Qs(e,c):(typeof c=="number"||typeof c=="bigint")&&Qs(e,""+c);break;case"onScroll":c!=null&&Yt("scroll",e);break;case"onScrollEnd":c!=null&&Yt("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Lr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Nt.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),r=l.slice(2,p?l.length-7:void 0),g=e[Ve]||null,g=g!=null?g[l]:null,typeof g=="function"&&e.removeEventListener(r,g,p),typeof c=="function")){typeof g!="function"&&g!==null&&(l in e?e[l]=null:e.hasAttribute(l)&&e.removeAttribute(l)),e.addEventListener(r,c,p);break e}l in e?e[l]=c:c===!0?e.setAttribute(l,""):Ui(e,l,c)}}}function nr(e,r,l){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Yt("error",e),Yt("load",e);var c=!1,p=!1,g;for(g in l)if(l.hasOwnProperty(g)){var j=l[g];if(j!=null)switch(g){case"src":c=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,r));default:mn(e,r,g,j,l,null)}}p&&mn(e,r,"srcSet",l.srcSet,l,null),c&&mn(e,r,"src",l.src,l,null);return;case"input":Yt("invalid",e);var O=g=j=p=null,K=null,me=null;for(c in l)if(l.hasOwnProperty(c)){var ke=l[c];if(ke!=null)switch(c){case"name":p=ke;break;case"type":j=ke;break;case"checked":K=ke;break;case"defaultChecked":me=ke;break;case"value":g=ke;break;case"defaultValue":O=ke;break;case"children":case"dangerouslySetInnerHTML":if(ke!=null)throw Error(a(137,r));break;default:mn(e,r,c,ke,l,null)}}fc(e,g,O,K,me,j,p,!1);return;case"select":Yt("invalid",e),c=j=g=null;for(p in l)if(l.hasOwnProperty(p)&&(O=l[p],O!=null))switch(p){case"value":g=O;break;case"defaultValue":j=O;break;case"multiple":c=O;default:mn(e,r,p,O,l,null)}r=g,l=j,e.multiple=!!c,r!=null?zr(e,!!c,r,!1):l!=null&&zr(e,!!c,l,!0);return;case"textarea":Yt("invalid",e),g=p=c=null;for(j in l)if(l.hasOwnProperty(j)&&(O=l[j],O!=null))switch(j){case"value":c=O;break;case"defaultValue":p=O;break;case"children":g=O;break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(a(91));break;default:mn(e,r,j,O,l,null)}mc(e,c,p,g);return;case"option":for(K in l)l.hasOwnProperty(K)&&(c=l[K],c!=null)&&(K==="selected"?e.selected=c&&typeof c!="function"&&typeof c!="symbol":mn(e,r,K,c,l,null));return;case"dialog":Yt("beforetoggle",e),Yt("toggle",e),Yt("cancel",e),Yt("close",e);break;case"iframe":case"object":Yt("load",e);break;case"video":case"audio":for(c=0;c<go.length;c++)Yt(go[c],e);break;case"image":Yt("error",e),Yt("load",e);break;case"details":Yt("toggle",e);break;case"embed":case"source":case"link":Yt("error",e),Yt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in l)if(l.hasOwnProperty(me)&&(c=l[me],c!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,r));default:mn(e,r,me,c,l,null)}return;default:if(zl(r)){for(ke in l)l.hasOwnProperty(ke)&&(c=l[ke],c!==void 0&&Zh(e,r,ke,c,l,void 0));return}}for(O in l)l.hasOwnProperty(O)&&(c=l[O],c!=null&&mn(e,r,O,c,l,null))}function mS(e,r,l,c){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,g=null,j=null,O=null,K=null,me=null,ke=null;for(je in l){var Me=l[je];if(l.hasOwnProperty(je)&&Me!=null)switch(je){case"checked":break;case"value":break;case"defaultValue":K=Me;default:c.hasOwnProperty(je)||mn(e,r,je,null,c,Me)}}for(var ye in c){var je=c[ye];if(Me=l[ye],c.hasOwnProperty(ye)&&(je!=null||Me!=null))switch(ye){case"type":g=je;break;case"name":p=je;break;case"checked":me=je;break;case"defaultChecked":ke=je;break;case"value":j=je;break;case"defaultValue":O=je;break;case"children":case"dangerouslySetInnerHTML":if(je!=null)throw Error(a(137,r));break;default:je!==Me&&mn(e,r,ye,je,c,Me)}}Bi(e,j,O,K,me,ke,g,p);return;case"select":je=j=O=ye=null;for(g in l)if(K=l[g],l.hasOwnProperty(g)&&K!=null)switch(g){case"value":break;case"multiple":je=K;default:c.hasOwnProperty(g)||mn(e,r,g,null,c,K)}for(p in c)if(g=c[p],K=l[p],c.hasOwnProperty(p)&&(g!=null||K!=null))switch(p){case"value":ye=g;break;case"defaultValue":O=g;break;case"multiple":j=g;default:g!==K&&mn(e,r,p,g,c,K)}r=O,l=j,c=je,ye!=null?zr(e,!!l,ye,!1):!!c!=!!l&&(r!=null?zr(e,!!l,r,!0):zr(e,!!l,l?[]:"",!1));return;case"textarea":je=ye=null;for(O in l)if(p=l[O],l.hasOwnProperty(O)&&p!=null&&!c.hasOwnProperty(O))switch(O){case"value":break;case"children":break;default:mn(e,r,O,null,c,p)}for(j in c)if(p=c[j],g=l[j],c.hasOwnProperty(j)&&(p!=null||g!=null))switch(j){case"value":ye=p;break;case"defaultValue":je=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(a(91));break;default:p!==g&&mn(e,r,j,p,c,g)}pc(e,ye,je);return;case"option":for(var lt in l)ye=l[lt],l.hasOwnProperty(lt)&&ye!=null&&!c.hasOwnProperty(lt)&&(lt==="selected"?e.selected=!1:mn(e,r,lt,null,c,ye));for(K in c)ye=c[K],je=l[K],c.hasOwnProperty(K)&&ye!==je&&(ye!=null||je!=null)&&(K==="selected"?e.selected=ye&&typeof ye!="function"&&typeof ye!="symbol":mn(e,r,K,ye,c,je));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Et in l)ye=l[Et],l.hasOwnProperty(Et)&&ye!=null&&!c.hasOwnProperty(Et)&&mn(e,r,Et,null,c,ye);for(me in c)if(ye=c[me],je=l[me],c.hasOwnProperty(me)&&ye!==je&&(ye!=null||je!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(a(137,r));break;default:mn(e,r,me,ye,c,je)}return;default:if(zl(r)){for(var gn in l)ye=l[gn],l.hasOwnProperty(gn)&&ye!==void 0&&!c.hasOwnProperty(gn)&&Zh(e,r,gn,void 0,c,ye);for(ke in c)ye=c[ke],je=l[ke],!c.hasOwnProperty(ke)||ye===je||ye===void 0&&je===void 0||Zh(e,r,ke,ye,c,je);return}}for(var ce in l)ye=l[ce],l.hasOwnProperty(ce)&&ye!=null&&!c.hasOwnProperty(ce)&&mn(e,r,ce,null,c,ye);for(Me in c)ye=c[Me],je=l[Me],!c.hasOwnProperty(Me)||ye===je||ye==null&&je==null||mn(e,r,Me,ye,c,je)}function Xy(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function gS(){if(typeof performance.getEntriesByType=="function"){for(var e=0,r=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var p=l[c],g=p.transferSize,j=p.initiatorType,O=p.duration;if(g&&O&&Xy(j)){for(j=0,O=p.responseEnd,c+=1;c<l.length;c++){var K=l[c],me=K.startTime;if(me>O)break;var ke=K.transferSize,Me=K.initiatorType;ke&&Xy(Me)&&(K=K.responseEnd,j+=ke*(K<O?1:(O-me)/(K-me)))}if(--c,r+=8*(g+j)/(p.duration/1e3),e++,10<e)break}}if(0<e)return r/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var ef=null,tf=null;function au(e){return e.nodeType===9?e:e.ownerDocument}function Zy(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ev(e,r){if(e===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&r==="foreignObject"?0:e}function nf(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var rf=null;function yS(){var e=window.event;return e&&e.type==="popstate"?e===rf?!1:(rf=e,!0):(rf=null,!1)}var tv=typeof setTimeout=="function"?setTimeout:void 0,vS=typeof clearTimeout=="function"?clearTimeout:void 0,nv=typeof Promise=="function"?Promise:void 0,xS=typeof queueMicrotask=="function"?queueMicrotask:typeof nv<"u"?function(e){return nv.resolve(null).then(e).catch(bS)}:tv;function bS(e){setTimeout(function(){throw e})}function vi(e){return e==="head"}function rv(e,r){var l=r,c=0;do{var p=l.nextSibling;if(e.removeChild(l),p&&p.nodeType===8)if(l=p.data,l==="/$"||l==="/&"){if(c===0){e.removeChild(p),el(r);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")vo(e.ownerDocument.documentElement);else if(l==="head"){l=e.ownerDocument.head,vo(l);for(var g=l.firstChild;g;){var j=g.nextSibling,O=g.nodeName;g[ze]||O==="SCRIPT"||O==="STYLE"||O==="LINK"&&g.rel.toLowerCase()==="stylesheet"||l.removeChild(g),g=j}}else l==="body"&&vo(e.ownerDocument.body);l=p}while(l);el(r)}function sv(e,r){var l=e;e=0;do{var c=l.nextSibling;if(l.nodeType===1?r?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(r?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(e===0)break;e--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||e++;l=c}while(l)}function sf(e){var r=e.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var l=r;switch(r=r.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":sf(l),Fe(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}e.removeChild(l)}}function wS(e,r,l,c){for(;e.nodeType===1;){var p=l;if(e.nodeName.toLowerCase()!==r.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[ze])switch(r){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==p.rel||e.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||e.getAttribute("title")!==(p.title==null?null:p.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(p.src==null?null:p.src)||e.getAttribute("type")!==(p.type==null?null:p.type)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(r==="input"&&e.type==="hidden"){var g=p.name==null?null:""+p.name;if(p.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=Hr(e.nextSibling),e===null)break}return null}function SS(e,r,l){if(r==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!l||(e=Hr(e.nextSibling),e===null))return null;return e}function iv(e,r){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!r||(e=Hr(e.nextSibling),e===null))return null;return e}function af(e){return e.data==="$?"||e.data==="$~"}function lf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function jS(e,r){var l=e.ownerDocument;if(e.data==="$~")e._reactRetry=r;else if(e.data!=="$?"||l.readyState!=="loading")r();else{var c=function(){r(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function Hr(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return e}var of=null;function av(e){e=e.nextSibling;for(var r=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"||l==="/&"){if(r===0)return Hr(e.nextSibling);r--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||r++}e=e.nextSibling}return null}function lv(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(r===0)return e;r--}else l!=="/$"&&l!=="/&"||r++}e=e.previousSibling}return null}function ov(e,r,l){switch(r=au(l),e){case"html":if(e=r.documentElement,!e)throw Error(a(452));return e;case"head":if(e=r.head,!e)throw Error(a(453));return e;case"body":if(e=r.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function vo(e){for(var r=e.attributes;r.length;)e.removeAttributeNode(r[0]);Fe(e)}var Vr=new Map,cv=new Set;function lu(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Us=z.d;z.d={f:_S,r:CS,D:NS,C:ES,L:kS,m:TS,X:RS,S:AS,M:OS};function _S(){var e=Us.f(),r=Xc();return e||r}function CS(e){var r=Qe(e);r!==null&&r.tag===5&&r.type==="form"?Ng(r):Us.r(e)}var Ja=typeof document>"u"?null:document;function uv(e,r,l){var c=Ja;if(c&&typeof r=="string"&&r){var p=fr(r);p='link[rel="'+e+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),cv.has(p)||(cv.add(p),e={rel:e,crossOrigin:l,href:r},c.querySelector(p)===null&&(r=c.createElement("link"),nr(r,"link",e),It(r),c.head.appendChild(r)))}}function NS(e){Us.D(e),uv("dns-prefetch",e,null)}function ES(e,r){Us.C(e,r),uv("preconnect",e,r)}function kS(e,r,l){Us.L(e,r,l);var c=Ja;if(c&&e&&r){var p='link[rel="preload"][as="'+fr(r)+'"]';r==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+fr(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+fr(l.imageSizes)+'"]')):p+='[href="'+fr(e)+'"]';var g=p;switch(r){case"style":g=Xa(e);break;case"script":g=Za(e)}Vr.has(g)||(e=v({rel:"preload",href:r==="image"&&l&&l.imageSrcSet?void 0:e,as:r},l),Vr.set(g,e),c.querySelector(p)!==null||r==="style"&&c.querySelector(xo(g))||r==="script"&&c.querySelector(bo(g))||(r=c.createElement("link"),nr(r,"link",e),It(r),c.head.appendChild(r)))}}function TS(e,r){Us.m(e,r);var l=Ja;if(l&&e){var c=r&&typeof r.as=="string"?r.as:"script",p='link[rel="modulepreload"][as="'+fr(c)+'"][href="'+fr(e)+'"]',g=p;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Za(e)}if(!Vr.has(g)&&(e=v({rel:"modulepreload",href:e},r),Vr.set(g,e),l.querySelector(p)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(bo(g)))return}c=l.createElement("link"),nr(c,"link",e),It(c),l.head.appendChild(c)}}}function AS(e,r,l){Us.S(e,r,l);var c=Ja;if(c&&e){var p=St(c).hoistableStyles,g=Xa(e);r=r||"default";var j=p.get(g);if(!j){var O={loading:0,preload:null};if(j=c.querySelector(xo(g)))O.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":r},l),(l=Vr.get(g))&&cf(e,l);var K=j=c.createElement("link");It(K),nr(K,"link",e),K._p=new Promise(function(me,ke){K.onload=me,K.onerror=ke}),K.addEventListener("load",function(){O.loading|=1}),K.addEventListener("error",function(){O.loading|=2}),O.loading|=4,ou(j,r,c)}j={type:"stylesheet",instance:j,count:1,state:O},p.set(g,j)}}}function RS(e,r){Us.X(e,r);var l=Ja;if(l&&e){var c=St(l).hoistableScripts,p=Za(e),g=c.get(p);g||(g=l.querySelector(bo(p)),g||(e=v({src:e,async:!0},r),(r=Vr.get(p))&&uf(e,r),g=l.createElement("script"),It(g),nr(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function OS(e,r){Us.M(e,r);var l=Ja;if(l&&e){var c=St(l).hoistableScripts,p=Za(e),g=c.get(p);g||(g=l.querySelector(bo(p)),g||(e=v({src:e,async:!0,type:"module"},r),(r=Vr.get(p))&&uf(e,r),g=l.createElement("script"),It(g),nr(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function dv(e,r,l,c){var p=(p=Ee.current)?lu(p):null;if(!p)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(r=Xa(l.href),l=St(p).hoistableStyles,c=l.get(r),c||(c={type:"style",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){e=Xa(l.href);var g=St(p).hoistableStyles,j=g.get(e);if(j||(p=p.ownerDocument||p,j={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,j),(g=p.querySelector(xo(e)))&&!g._p&&(j.instance=g,j.state.loading=5),Vr.has(e)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Vr.set(e,l),g||DS(p,e,l,j.state))),r&&c===null)throw Error(a(528,""));return j}if(r&&c!==null)throw Error(a(529,""));return null;case"script":return r=l.async,l=l.src,typeof l=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=Za(l),l=St(p).hoistableScripts,c=l.get(r),c||(c={type:"script",instance:null,count:0,state:null},l.set(r,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Xa(e){return'href="'+fr(e)+'"'}function xo(e){return'link[rel="stylesheet"]['+e+"]"}function hv(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function DS(e,r,l,c){e.querySelector('link[rel="preload"][as="style"]['+r+"]")?c.loading=1:(r=e.createElement("link"),c.preload=r,r.addEventListener("load",function(){return c.loading|=1}),r.addEventListener("error",function(){return c.loading|=2}),nr(r,"link",l),It(r),e.head.appendChild(r))}function Za(e){return'[src="'+fr(e)+'"]'}function bo(e){return"script[async]"+e}function fv(e,r,l){if(r.count++,r.instance===null)switch(r.type){case"style":var c=e.querySelector('style[data-href~="'+fr(l.href)+'"]');if(c)return r.instance=c,It(c),c;var p=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),It(c),nr(c,"style",p),ou(c,l.precedence,e),r.instance=c;case"stylesheet":p=Xa(l.href);var g=e.querySelector(xo(p));if(g)return r.state.loading|=4,r.instance=g,It(g),g;c=hv(l),(p=Vr.get(p))&&cf(c,p),g=(e.ownerDocument||e).createElement("link"),It(g);var j=g;return j._p=new Promise(function(O,K){j.onload=O,j.onerror=K}),nr(g,"link",c),r.state.loading|=4,ou(g,l.precedence,e),r.instance=g;case"script":return g=Za(l.src),(p=e.querySelector(bo(g)))?(r.instance=p,It(p),p):(c=l,(p=Vr.get(g))&&(c=v({},l),uf(c,p)),e=e.ownerDocument||e,p=e.createElement("script"),It(p),nr(p,"link",c),e.head.appendChild(p),r.instance=p);case"void":return null;default:throw Error(a(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(c=r.instance,r.state.loading|=4,ou(c,l.precedence,e));return r.instance}function ou(e,r,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=c.length?c[c.length-1]:null,g=p,j=0;j<c.length;j++){var O=c[j];if(O.dataset.precedence===r)g=O;else if(g!==p)break}g?g.parentNode.insertBefore(e,g.nextSibling):(r=l.nodeType===9?l.head:l,r.insertBefore(e,r.firstChild))}function cf(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.title==null&&(e.title=r.title)}function uf(e,r){e.crossOrigin==null&&(e.crossOrigin=r.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=r.referrerPolicy),e.integrity==null&&(e.integrity=r.integrity)}var cu=null;function pv(e,r,l){if(cu===null){var c=new Map,p=cu=new Map;p.set(l,c)}else p=cu,c=p.get(l),c||(c=new Map,p.set(l,c));if(c.has(e))return c;for(c.set(e,null),l=l.getElementsByTagName(e),p=0;p<l.length;p++){var g=l[p];if(!(g[ze]||g[$e]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var j=g.getAttribute(r)||"";j=e+j;var O=c.get(j);O?O.push(g):c.set(j,[g])}}return c}function mv(e,r,l){e=e.ownerDocument||e,e.head.insertBefore(l,r==="title"?e.querySelector("head > title"):null)}function MS(e,r,l){if(l===1||r.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(e=r.disabled,typeof r.precedence=="string"&&e==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function gv(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function zS(e,r,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var p=Xa(c.href),g=r.querySelector(xo(p));if(g){r=g._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(e.count++,e=uu.bind(e),r.then(e,e)),l.state.loading|=4,l.instance=g,It(g);return}g=r.ownerDocument||r,c=hv(c),(p=Vr.get(p))&&cf(c,p),g=g.createElement("link"),It(g);var j=g;j._p=new Promise(function(O,K){j.onload=O,j.onerror=K}),nr(g,"link",c),l.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(l,r),(r=l.state.preload)&&(l.state.loading&3)===0&&(e.count++,l=uu.bind(e),r.addEventListener("load",l),r.addEventListener("error",l))}}var df=0;function LS(e,r){return e.stylesheets&&e.count===0&&hu(e,e.stylesheets),0<e.count||0<e.imgCount?function(l){var c=setTimeout(function(){if(e.stylesheets&&hu(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+r);0<e.imgBytes&&df===0&&(df=62500*gS());var p=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&hu(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>df?50:800)+r);return e.unsuspend=l,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(p)}}:null}function uu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)hu(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var du=null;function hu(e,r){e.stylesheets=null,e.unsuspend!==null&&(e.count++,du=new Map,r.forEach(US,e),du=null,uu.call(e))}function US(e,r){if(!(r.state.loading&4)){var l=du.get(e);if(l)var c=l.get(null);else{l=new Map,du.set(e,l);for(var p=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<p.length;g++){var j=p[g];(j.nodeName==="LINK"||j.getAttribute("media")!=="not all")&&(l.set(j.dataset.precedence,j),c=j)}c&&l.set(null,c)}p=r.instance,j=p.getAttribute("data-precedence"),g=l.get(j)||c,g===c&&l.set(null,p),l.set(j,p),this.count++,c=uu.bind(this),p.addEventListener("load",c),p.addEventListener("error",c),g?g.parentNode.insertBefore(p,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(p,e.firstChild)),r.state.loading|=4}}var wo={$$typeof:D,Provider:null,Consumer:null,_currentValue:H,_currentValue2:H,_threadCount:0};function IS(e,r,l,c,p,g,j,O,K){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=dn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dn(0),this.hiddenUpdates=dn(null),this.identifierPrefix=c,this.onUncaughtError=p,this.onCaughtError=g,this.onRecoverableError=j,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function yv(e,r,l,c,p,g,j,O,K,me,ke,Me){return e=new IS(e,r,l,j,K,me,ke,Me,O),r=1,g===!0&&(r|=24),g=_r(3,null,null,r),e.current=g,g.stateNode=e,r=Fd(),r.refCount++,e.pooledCache=r,r.refCount++,g.memoizedState={element:c,isDehydrated:l,cache:r},Kd(g),e}function vv(e){return e?(e=Aa,e):Aa}function xv(e,r,l,c,p,g){p=vv(p),c.context===null?c.context=p:c.pendingContext=p,c=li(r),c.payload={element:l},g=g===void 0?null:g,g!==null&&(c.callback=g),l=oi(e,c,r),l!==null&&(xr(l,e,r),Xl(l,e,r))}function bv(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<r?l:r}}function hf(e,r){bv(e,r),(e=e.alternate)&&bv(e,r)}function wv(e){if(e.tag===13||e.tag===31){var r=Hi(e,67108864);r!==null&&xr(r,e,67108864),hf(e,67108864)}}function Sv(e){if(e.tag===13||e.tag===31){var r=Tr();r=xt(r);var l=Hi(e,r);l!==null&&xr(l,e,r),hf(e,r)}}var fu=!0;function BS(e,r,l,c){var p=T.T;T.T=null;var g=z.p;try{z.p=2,ff(e,r,l,c)}finally{z.p=g,T.T=p}}function $S(e,r,l,c){var p=T.T;T.T=null;var g=z.p;try{z.p=8,ff(e,r,l,c)}finally{z.p=g,T.T=p}}function ff(e,r,l,c){if(fu){var p=pf(c);if(p===null)Xh(e,r,c,pu,l),_v(e,c);else if(qS(p,e,r,l,c))c.stopPropagation();else if(_v(e,c),r&4&&-1<PS.indexOf(e)){for(;p!==null;){var g=Qe(p);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var j=He(g.pendingLanes);if(j!==0){var O=g;for(O.pendingLanes|=2,O.entangledLanes|=2;j;){var K=1<<31-Gt(j);O.entanglements[1]|=K,j&=~K}ys(g),(ln&6)===0&&(Qc=Ct()+500,mo(0))}}break;case 31:case 13:O=Hi(g,2),O!==null&&xr(O,g,2),Xc(),hf(g,2)}if(g=pf(c),g===null&&Xh(e,r,c,pu,l),g===p)break;p=g}p!==null&&c.stopPropagation()}else Xh(e,r,c,null,l)}}function pf(e){return e=Ul(e),mf(e)}var pu=null;function mf(e){if(pu=null,e=Je(e),e!==null){var r=u(e);if(r===null)e=null;else{var l=r.tag;if(l===13){if(e=d(r),e!==null)return e;e=null}else if(l===31){if(e=f(r),e!==null)return e;e=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null)}}return pu=e,null}function jv(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Rt()){case mt:return 2;case Ot:return 8;case jt:case ft:return 32;case Vt:return 268435456;default:return 32}default:return 32}}var gf=!1,xi=null,bi=null,wi=null,So=new Map,jo=new Map,Si=[],PS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _v(e,r){switch(e){case"focusin":case"focusout":xi=null;break;case"dragenter":case"dragleave":bi=null;break;case"mouseover":case"mouseout":wi=null;break;case"pointerover":case"pointerout":So.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":jo.delete(r.pointerId)}}function _o(e,r,l,c,p,g){return e===null||e.nativeEvent!==g?(e={blockedOn:r,domEventName:l,eventSystemFlags:c,nativeEvent:g,targetContainers:[p]},r!==null&&(r=Qe(r),r!==null&&wv(r)),e):(e.eventSystemFlags|=c,r=e.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),e)}function qS(e,r,l,c,p){switch(r){case"focusin":return xi=_o(xi,e,r,l,c,p),!0;case"dragenter":return bi=_o(bi,e,r,l,c,p),!0;case"mouseover":return wi=_o(wi,e,r,l,c,p),!0;case"pointerover":var g=p.pointerId;return So.set(g,_o(So.get(g)||null,e,r,l,c,p)),!0;case"gotpointercapture":return g=p.pointerId,jo.set(g,_o(jo.get(g)||null,e,r,l,c,p)),!0}return!1}function Cv(e){var r=Je(e.target);if(r!==null){var l=u(r);if(l!==null){if(r=l.tag,r===13){if(r=d(l),r!==null){e.blockedOn=r,ot(e.priority,function(){Sv(l)});return}}else if(r===31){if(r=f(l),r!==null){e.blockedOn=r,ot(e.priority,function(){Sv(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function mu(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var l=pf(e.nativeEvent);if(l===null){l=e.nativeEvent;var c=new l.constructor(l.type,l);Ll=c,l.target.dispatchEvent(c),Ll=null}else return r=Qe(l),r!==null&&wv(r),e.blockedOn=l,!1;r.shift()}return!0}function Nv(e,r,l){mu(e)&&l.delete(r)}function FS(){gf=!1,xi!==null&&mu(xi)&&(xi=null),bi!==null&&mu(bi)&&(bi=null),wi!==null&&mu(wi)&&(wi=null),So.forEach(Nv),jo.forEach(Nv)}function gu(e,r){e.blockedOn===r&&(e.blockedOn=null,gf||(gf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,FS)))}var yu=null;function Ev(e){yu!==e&&(yu=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){yu===e&&(yu=null);for(var r=0;r<e.length;r+=3){var l=e[r],c=e[r+1],p=e[r+2];if(typeof c!="function"){if(mf(c||l)===null)continue;break}var g=Qe(l);g!==null&&(e.splice(r,3),r-=3,fh(g,{pending:!0,data:p,method:l.method,action:c},c,p))}}))}function el(e){function r(K){return gu(K,e)}xi!==null&&gu(xi,e),bi!==null&&gu(bi,e),wi!==null&&gu(wi,e),So.forEach(r),jo.forEach(r);for(var l=0;l<Si.length;l++){var c=Si[l];c.blockedOn===e&&(c.blockedOn=null)}for(;0<Si.length&&(l=Si[0],l.blockedOn===null);)Cv(l),l.blockedOn===null&&Si.shift();if(l=(e.ownerDocument||e).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var p=l[c],g=l[c+1],j=p[Ve]||null;if(typeof g=="function")j||Ev(l);else if(j){var O=null;if(g&&g.hasAttribute("formAction")){if(p=g,j=g[Ve]||null)O=j.formAction;else if(mf(p)!==null)continue}else O=j.action;typeof O=="function"?l[c+1]=O:(l.splice(c,3),c-=3),Ev(l)}}}function kv(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(j){return p=j})},focusReset:"manual",scroll:"manual"})}function r(){p!==null&&(p(),p=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,p=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),p!==null&&(p(),p=null)}}}function yf(e){this._internalRoot=e}vu.prototype.render=yf.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(a(409));var l=r.current,c=Tr();xv(l,c,e,r,null,null)},vu.prototype.unmount=yf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;xv(e.current,2,null,e,null,null),Xc(),r[_t]=null}};function vu(e){this._internalRoot=e}vu.prototype.unstable_scheduleHydration=function(e){if(e){var r=Ft();e={blockedOn:null,target:e,priority:r};for(var l=0;l<Si.length&&r!==0&&r<Si[l].priority;l++);Si.splice(l,0,e),l===0&&Cv(e)}};var Tv=t.version;if(Tv!=="19.2.3")throw Error(a(527,Tv,"19.2.3"));z.findDOMNode=function(e){var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=m(r),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var HS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xu.isDisabled&&xu.supportsFiber)try{Mt=xu.inject(HS),nn=xu}catch{}}return No.createRoot=function(e,r){if(!o(e))throw Error(a(299));var l=!1,c="",p=Lg,g=Ug,j=Ig;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onUncaughtError!==void 0&&(p=r.onUncaughtError),r.onCaughtError!==void 0&&(g=r.onCaughtError),r.onRecoverableError!==void 0&&(j=r.onRecoverableError)),r=yv(e,1,!1,null,null,l,c,null,p,g,j,kv),e[_t]=r.current,Jh(e),new yf(r)},No.hydrateRoot=function(e,r,l){if(!o(e))throw Error(a(299));var c=!1,p="",g=Lg,j=Ug,O=Ig,K=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(g=l.onUncaughtError),l.onCaughtError!==void 0&&(j=l.onCaughtError),l.onRecoverableError!==void 0&&(O=l.onRecoverableError),l.formState!==void 0&&(K=l.formState)),r=yv(e,1,!0,r,l??null,c,p,K,g,j,O,kv),r.context=vv(null),l=r.current,c=Tr(),c=xt(c),p=li(c),p.callback=null,oi(l,p,c),l=c,r.current.lanes=l,ue(r,l),ys(r),e[_t]=r.current,Jh(e),new vu(r)},No.version="19.2.3",No}var Bv;function ZS(){if(Bv)return bf.exports;Bv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),bf.exports=XS(),bf.exports}var ej=ZS();var $v="popstate";function tj(n={}){function t(a,o){let{pathname:u,search:d,hash:f}=a.location;return cp("",{pathname:u,search:d,hash:f},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function i(a,o){return typeof o=="string"?o:Ho(o)}return rj(t,i,null,n)}function Gn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Wr(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function nj(){return Math.random().toString(36).substring(2,10)}function Pv(n,t){return{usr:n.state,key:n.key,idx:t}}function cp(n,t,i=null,a){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?nc(t):t,state:i,key:t&&t.key||a||nj()}}function Ho({pathname:n="/",search:t="",hash:i=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(n+=i.charAt(0)==="#"?i:"#"+i),n}function nc(n){let t={};if(n){let i=n.indexOf("#");i>=0&&(t.hash=n.substring(i),n=n.substring(0,i));let a=n.indexOf("?");a>=0&&(t.search=n.substring(a),n=n.substring(0,a)),n&&(t.pathname=n)}return t}function rj(n,t,i,a={}){let{window:o=document.defaultView,v5Compat:u=!1}=a,d=o.history,f="POP",h=null,m=y();m==null&&(m=0,d.replaceState({...d.state,idx:m},""));function y(){return(d.state||{idx:null}).idx}function v(){f="POP";let S=y(),N=S==null?null:S-m;m=S,h&&h({action:f,location:C.location,delta:N})}function x(S,N){f="PUSH";let k=cp(C.location,S,N);m=y()+1;let D=Pv(k,m),L=C.createHref(k);try{d.pushState(D,"",L)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;o.location.assign(L)}u&&h&&h({action:f,location:C.location,delta:1})}function b(S,N){f="REPLACE";let k=cp(C.location,S,N);m=y();let D=Pv(k,m),L=C.createHref(k);d.replaceState(D,"",L),u&&h&&h({action:f,location:C.location,delta:0})}function _(S){return sj(S)}let C={get action(){return f},get location(){return n(o,d)},listen(S){if(h)throw new Error("A history only accepts one active listener");return o.addEventListener($v,v),h=S,()=>{o.removeEventListener($v,v),h=null}},createHref(S){return t(o,S)},createURL:_,encodeLocation(S){let N=_(S);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:x,replace:b,go(S){return d.go(S)}};return C}function sj(n,t=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Gn(i,"No window.location.(origin|href) available to create URL");let a=typeof n=="string"?n:Ho(n);return a=a.replace(/ $/,"%20"),!t&&a.startsWith("//")&&(a=i+a),new URL(a,i)}function N0(n,t,i="/"){return ij(n,t,i,!1)}function ij(n,t,i,a){let o=typeof t=="string"?nc(t):t,u=Hs(o.pathname||"/",i);if(u==null)return null;let d=E0(n);aj(d);let f=null;for(let h=0;f==null&&h<d.length;++h){let m=yj(u);f=mj(d[h],m,a)}return f}function E0(n,t=[],i=[],a="",o=!1){let u=(d,f,h=o,m)=>{let y={relativePath:m===void 0?d.path||"":m,caseSensitive:d.caseSensitive===!0,childrenIndex:f,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(a)&&h)return;Gn(y.relativePath.startsWith(a),`Absolute route path "${y.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(a.length)}let v=Fs([a,y.relativePath]),x=i.concat(y);d.children&&d.children.length>0&&(Gn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),E0(d.children,t,x,v,h)),!(d.path==null&&!d.index)&&t.push({path:v,score:fj(v,d.index),routesMeta:x})};return n.forEach((d,f)=>{if(d.path===""||!d.path?.includes("?"))u(d,f);else for(let h of k0(d.path))u(d,f,!0,h)}),t}function k0(n){let t=n.split("/");if(t.length===0)return[];let[i,...a]=t,o=i.endsWith("?"),u=i.replace(/\?$/,"");if(a.length===0)return o?[u,""]:[u];let d=k0(a.join("/")),f=[];return f.push(...d.map(h=>h===""?u:[u,h].join("/"))),o&&f.push(...d),f.map(h=>n.startsWith("/")&&h===""?"/":h)}function aj(n){n.sort((t,i)=>t.score!==i.score?i.score-t.score:pj(t.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}var lj=/^:[\w-]+$/,oj=3,cj=2,uj=1,dj=10,hj=-2,qv=n=>n==="*";function fj(n,t){let i=n.split("/"),a=i.length;return i.some(qv)&&(a+=hj),t&&(a+=cj),i.filter(o=>!qv(o)).reduce((o,u)=>o+(lj.test(u)?oj:u===""?uj:dj),a)}function pj(n,t){return n.length===t.length&&n.slice(0,-1).every((a,o)=>a===t[o])?n[n.length-1]-t[t.length-1]:0}function mj(n,t,i=!1){let{routesMeta:a}=n,o={},u="/",d=[];for(let f=0;f<a.length;++f){let h=a[f],m=f===a.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=qu({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},y),x=h.route;if(!v&&m&&i&&!a[a.length-1].route.index&&(v=qu({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},y)),!v)return null;Object.assign(o,v.params),d.push({params:o,pathname:Fs([u,v.pathname]),pathnameBase:wj(Fs([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=Fs([u,v.pathnameBase]))}return d}function qu(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[i,a]=gj(n.path,n.caseSensitive,n.end),o=t.match(i);if(!o)return null;let u=o[0],d=u.replace(/(.)\/+$/,"$1"),f=o.slice(1);return{params:a.reduce((m,{paramName:y,isOptional:v},x)=>{if(y==="*"){let _=f[x]||"";d=u.slice(0,u.length-_.length).replace(/(.)\/+$/,"$1")}const b=f[x];return v&&!b?m[y]=void 0:m[y]=(b||"").replace(/%2F/g,"/"),m},{}),pathname:u,pathnameBase:d,pattern:n}}function gj(n,t=!1,i=!0){Wr(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let a=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,f,h)=>(a.push({paramName:f,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(a.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),a]}function yj(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Wr(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Hs(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,a=n.charAt(i);return a&&a!=="/"?null:n.slice(i)||"/"}var T0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vj=n=>T0.test(n);function xj(n,t="/"){let{pathname:i,search:a="",hash:o=""}=typeof n=="string"?nc(n):n,u;if(i)if(vj(i))u=i;else{if(i.includes("//")){let d=i;i=i.replace(/\/\/+/g,"/"),Wr(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${i}`)}i.startsWith("/")?u=Fv(i.substring(1),"/"):u=Fv(i,t)}else u=t;return{pathname:u,search:Sj(a),hash:jj(o)}}function Fv(n,t){let i=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?i.length>1&&i.pop():o!=="."&&i.push(o)}),i.length>1?i.join("/"):"/"}function _f(n,t,i,a){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function bj(n){return n.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function A0(n){let t=bj(n);return t.map((i,a)=>a===t.length-1?i.pathname:i.pathnameBase)}function R0(n,t,i,a=!1){let o;typeof n=="string"?o=nc(n):(o={...n},Gn(!o.pathname||!o.pathname.includes("?"),_f("?","pathname","search",o)),Gn(!o.pathname||!o.pathname.includes("#"),_f("#","pathname","hash",o)),Gn(!o.search||!o.search.includes("#"),_f("#","search","hash",o)));let u=n===""||o.pathname==="",d=u?"/":o.pathname,f;if(d==null)f=i;else{let v=t.length-1;if(!a&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;o.pathname=x.join("/")}f=v>=0?t[v]:"/"}let h=xj(o,f),m=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&i.endsWith("/");return!h.pathname.endsWith("/")&&(m||y)&&(h.pathname+="/"),h}var Fs=n=>n.join("/").replace(/\/\/+/g,"/"),wj=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),Sj=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,jj=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,_j=class{constructor(n,t,i,a=!1){this.status=n,this.statusText=t||"",this.internal=a,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}};function Cj(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function Nj(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var O0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function D0(n,t){let i=n;if(typeof i!="string"||!T0.test(i))return{absoluteURL:void 0,isExternal:!1,to:i};let a=i,o=!1;if(O0)try{let u=new URL(window.location.href),d=i.startsWith("//")?new URL(u.protocol+i):new URL(i),f=Hs(d.pathname,t);d.origin===u.origin&&f!=null?i=f+d.search+d.hash:o=!0}catch{Wr(!1,`<Link to="${i}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:o,to:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var M0=["POST","PUT","PATCH","DELETE"];new Set(M0);var Ej=["GET",...M0];new Set(Ej);var Cl=w.createContext(null);Cl.displayName="DataRouter";var sd=w.createContext(null);sd.displayName="DataRouterState";var kj=w.createContext(!1),z0=w.createContext({isTransitioning:!1});z0.displayName="ViewTransition";var Tj=w.createContext(new Map);Tj.displayName="Fetchers";var Aj=w.createContext(null);Aj.displayName="Await";var Qr=w.createContext(null);Qr.displayName="Navigation";var id=w.createContext(null);id.displayName="Location";var Gs=w.createContext({outlet:null,matches:[],isDataRoute:!1});Gs.displayName="Route";var Mp=w.createContext(null);Mp.displayName="RouteError";var L0="REACT_ROUTER_ERROR",Rj="REDIRECT",Oj="ROUTE_ERROR_RESPONSE";function Dj(n){if(n.startsWith(`${L0}:${Rj}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function Mj(n){if(n.startsWith(`${L0}:${Oj}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new _j(t.status,t.statusText,t.data)}catch{}}function zj(n,{relative:t}={}){Gn(rc(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:a}=w.useContext(Qr),{hash:o,pathname:u,search:d}=sc(n,{relative:t}),f=u;return i!=="/"&&(f=u==="/"?i:Fs([i,u])),a.createHref({pathname:f,search:d,hash:o})}function rc(){return w.useContext(id)!=null}function Ks(){return Gn(rc(),"useLocation() may be used only in the context of a <Router> component."),w.useContext(id).location}var U0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function I0(n){w.useContext(Qr).static||w.useLayoutEffect(n)}function B0(){let{isDataRoute:n}=w.useContext(Gs);return n?Yj():Lj()}function Lj(){Gn(rc(),"useNavigate() may be used only in the context of a <Router> component.");let n=w.useContext(Cl),{basename:t,navigator:i}=w.useContext(Qr),{matches:a}=w.useContext(Gs),{pathname:o}=Ks(),u=JSON.stringify(A0(a)),d=w.useRef(!1);return I0(()=>{d.current=!0}),w.useCallback((h,m={})=>{if(Wr(d.current,U0),!d.current)return;if(typeof h=="number"){i.go(h);return}let y=R0(h,JSON.parse(u),o,m.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Fs([t,y.pathname])),(m.replace?i.replace:i.push)(y,m.state,m)},[t,i,u,o,n])}w.createContext(null);function sc(n,{relative:t}={}){let{matches:i}=w.useContext(Gs),{pathname:a}=Ks(),o=JSON.stringify(A0(i));return w.useMemo(()=>R0(n,JSON.parse(o),a,t==="path"),[n,o,a,t])}function Uj(n,t,i,a,o){Gn(rc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=w.useContext(Qr),{matches:d}=w.useContext(Gs),f=d[d.length-1],h=f?f.params:{},m=f?f.pathname:"/",y=f?f.pathnameBase:"/",v=f&&f.route;{let k=v&&v.path||"";P0(m,!v||k.endsWith("*")||k.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${k}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${k}"> to <Route path="${k==="/"?"*":`${k}/*`}">.`)}let x=Ks(),b;b=x;let _=b.pathname||"/",C=_;if(y!=="/"){let k=y.replace(/^\//,"").split("/");C="/"+_.replace(/^\//,"").split("/").slice(k.length).join("/")}let S=N0(n,{pathname:C});return Wr(v||S!=null,`No routes matched location "${b.pathname}${b.search}${b.hash}" `),Wr(S==null||S[S.length-1].route.element!==void 0||S[S.length-1].route.Component!==void 0||S[S.length-1].route.lazy!==void 0,`Matched leaf route at location "${b.pathname}${b.search}${b.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),qj(S&&S.map(k=>Object.assign({},k,{params:Object.assign({},h,k.params),pathname:Fs([y,u.encodeLocation?u.encodeLocation(k.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?y:Fs([y,u.encodeLocation?u.encodeLocation(k.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:k.pathnameBase])})),d,i,a,o)}function Ij(){let n=Kj(),t=Cj(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),i=n instanceof Error?n.stack:null,a="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:a},u={padding:"2px 4px",backgroundColor:a},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=w.createElement(w.Fragment,null,w.createElement("p",null," Hey developer "),w.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",w.createElement("code",{style:u},"ErrorBoundary")," or"," ",w.createElement("code",{style:u},"errorElement")," prop on your route.")),w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},t),i?w.createElement("pre",{style:o},i):null,d)}var Bj=w.createElement(Ij,null),$0=class extends w.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const i=Mj(n.digest);i&&(n=i)}let t=n!==void 0?w.createElement(Gs.Provider,{value:this.props.routeContext},w.createElement(Mp.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?w.createElement($j,{error:n},t):t}};$0.contextType=kj;var Cf=new WeakMap;function $j({children:n,error:t}){let{basename:i}=w.useContext(Qr);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let a=Dj(t.digest);if(a){let o=Cf.get(t);if(o)throw o;let u=D0(a.location,i);if(O0&&!Cf.get(t))if(u.isExternal||a.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:a.replace}));throw Cf.set(t,d),d}return w.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function Pj({routeContext:n,match:t,children:i}){let a=w.useContext(Cl);return a&&a.static&&a.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=t.route.id),w.createElement(Gs.Provider,{value:n},i)}function qj(n,t=[],i=null,a=null,o=null){if(n==null){if(!i)return null;if(i.errors)n=i.matches;else if(t.length===0&&!i.initialized&&i.matches.length>0)n=i.matches;else return null}let u=n,d=i?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);Gn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let f=!1,h=-1;if(i)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(h=y),v.route.id){let{loaderData:x,errors:b}=i,_=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!b||b[v.route.id]===void 0);if(v.route.lazy||_){f=!0,h>=0?u=u.slice(0,h+1):u=[u[0]];break}}}let m=i&&a?(y,v)=>{a(y,{location:i.location,params:i.matches?.[0]?.params??{},unstable_pattern:Nj(i.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let b,_=!1,C=null,S=null;i&&(b=d&&v.route.id?d[v.route.id]:void 0,C=v.route.errorElement||Bj,f&&(h<0&&x===0?(P0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),_=!0,S=null):h===x&&(_=!0,S=v.route.hydrateFallbackElement||null)));let N=t.concat(u.slice(0,x+1)),k=()=>{let D;return b?D=C:_?D=S:v.route.Component?D=w.createElement(v.route.Component,null):v.route.element?D=v.route.element:D=y,w.createElement(Pj,{match:v,routeContext:{outlet:y,matches:N,isDataRoute:i!=null},children:D})};return i&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?w.createElement($0,{location:i.location,revalidation:i.revalidation,component:C,error:b,children:k(),routeContext:{outlet:null,matches:N,isDataRoute:!0},onError:m}):k()},null)}function zp(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Fj(n){let t=w.useContext(Cl);return Gn(t,zp(n)),t}function Hj(n){let t=w.useContext(sd);return Gn(t,zp(n)),t}function Vj(n){let t=w.useContext(Gs);return Gn(t,zp(n)),t}function Lp(n){let t=Vj(n),i=t.matches[t.matches.length-1];return Gn(i.route.id,`${n} can only be used on routes that contain a unique "id"`),i.route.id}function Gj(){return Lp("useRouteId")}function Kj(){let n=w.useContext(Mp),t=Hj("useRouteError"),i=Lp("useRouteError");return n!==void 0?n:t.errors?.[i]}function Yj(){let{router:n}=Fj("useNavigate"),t=Lp("useNavigate"),i=w.useRef(!1);return I0(()=>{i.current=!0}),w.useCallback(async(o,u={})=>{Wr(i.current,U0),i.current&&(typeof o=="number"?await n.navigate(o):await n.navigate(o,{fromRouteId:t,...u}))},[n,t])}var Hv={};function P0(n,t,i){!t&&!Hv[n]&&(Hv[n]=!0,Wr(!1,i))}w.memo(Wj);function Wj({routes:n,future:t,state:i,onError:a}){return Uj(n,void 0,i,a,t)}function Qj({basename:n="/",children:t=null,location:i,navigationType:a="POP",navigator:o,static:u=!1,unstable_useTransitions:d}){Gn(!rc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=n.replace(/^\/*/,"/"),h=w.useMemo(()=>({basename:f,navigator:o,static:u,unstable_useTransitions:d,future:{}}),[f,o,u,d]);typeof i=="string"&&(i=nc(i));let{pathname:m="/",search:y="",hash:v="",state:x=null,key:b="default"}=i,_=w.useMemo(()=>{let C=Hs(m,f);return C==null?null:{location:{pathname:C,search:y,hash:v,state:x,key:b},navigationType:a}},[f,m,y,v,x,b,a]);return Wr(_!=null,`<Router basename="${f}"> is not able to match the URL "${m}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:w.createElement(Qr.Provider,{value:h},w.createElement(id.Provider,{children:t,value:_}))}var Lu="get",Uu="application/x-www-form-urlencoded";function ad(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function Jj(n){return ad(n)&&n.tagName.toLowerCase()==="button"}function Xj(n){return ad(n)&&n.tagName.toLowerCase()==="form"}function Zj(n){return ad(n)&&n.tagName.toLowerCase()==="input"}function e_(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function t_(n,t){return n.button===0&&(!t||t==="_self")&&!e_(n)}function up(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,i)=>{let a=n[i];return t.concat(Array.isArray(a)?a.map(o=>[i,o]):[[i,a]])},[]))}function n_(n,t){let i=up(n);return t&&t.forEach((a,o)=>{i.has(o)||t.getAll(o).forEach(u=>{i.append(o,u)})}),i}var bu=null;function r_(){if(bu===null)try{new FormData(document.createElement("form"),0),bu=!1}catch{bu=!0}return bu}var s_=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Nf(n){return n!=null&&!s_.has(n)?(Wr(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Uu}"`),null):n}function i_(n,t){let i,a,o,u,d;if(Xj(n)){let f=n.getAttribute("action");a=f?Hs(f,t):null,i=n.getAttribute("method")||Lu,o=Nf(n.getAttribute("enctype"))||Uu,u=new FormData(n)}else if(Jj(n)||Zj(n)&&(n.type==="submit"||n.type==="image")){let f=n.form;if(f==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=n.getAttribute("formaction")||f.getAttribute("action");if(a=h?Hs(h,t):null,i=n.getAttribute("formmethod")||f.getAttribute("method")||Lu,o=Nf(n.getAttribute("formenctype"))||Nf(f.getAttribute("enctype"))||Uu,u=new FormData(f,n),!r_()){let{name:m,type:y,value:v}=n;if(y==="image"){let x=m?`${m}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else m&&u.append(m,v)}}else{if(ad(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=Lu,a=null,o=Uu,d=n}return u&&o==="text/plain"&&(d=u,u=void 0),{action:a,method:i.toLowerCase(),encType:o,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Up(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function a_(n,t,i){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return a.pathname==="/"?a.pathname=`_root.${i}`:t&&Hs(a.pathname,t)==="/"?a.pathname=`${t.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function l_(n,t){if(n.id in t)return t[n.id];try{let i=await import(n.module);return t[n.id]=i,i}catch(i){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function o_(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function c_(n,t,i){let a=await Promise.all(n.map(async o=>{let u=t.routes[o.route.id];if(u){let d=await l_(u,i);return d.links?d.links():[]}return[]}));return f_(a.flat(1).filter(o_).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function Vv(n,t,i,a,o,u){let d=(h,m)=>i[m]?h.route.id!==i[m].route.id:!0,f=(h,m)=>i[m].pathname!==h.pathname||i[m].route.path?.endsWith("*")&&i[m].params["*"]!==h.params["*"];return u==="assets"?t.filter((h,m)=>d(h,m)||f(h,m)):u==="data"?t.filter((h,m)=>{let y=a.routes[h.route.id];if(!y||!y.hasLoader)return!1;if(d(h,m)||f(h,m))return!0;if(h.route.shouldRevalidate){let v=h.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:i[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function u_(n,t,{includeHydrateFallback:i}={}){return d_(n.map(a=>{let o=t.routes[a.route.id];if(!o)return[];let u=[o.module];return o.clientActionModule&&(u=u.concat(o.clientActionModule)),o.clientLoaderModule&&(u=u.concat(o.clientLoaderModule)),i&&o.hydrateFallbackModule&&(u=u.concat(o.hydrateFallbackModule)),o.imports&&(u=u.concat(o.imports)),u}).flat(1))}function d_(n){return[...new Set(n)]}function h_(n){let t={},i=Object.keys(n).sort();for(let a of i)t[a]=n[a];return t}function f_(n,t){let i=new Set;return new Set(t),n.reduce((a,o)=>{let u=JSON.stringify(h_(o));return i.has(u)||(i.add(u),a.push({key:u,link:o})),a},[])}function q0(){let n=w.useContext(Cl);return Up(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function p_(){let n=w.useContext(sd);return Up(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Ip=w.createContext(void 0);Ip.displayName="FrameworkContext";function F0(){let n=w.useContext(Ip);return Up(n,"You must render this element inside a <HydratedRouter> element"),n}function m_(n,t){let i=w.useContext(Ip),[a,o]=w.useState(!1),[u,d]=w.useState(!1),{onFocus:f,onBlur:h,onMouseEnter:m,onMouseLeave:y,onTouchStart:v}=t,x=w.useRef(null);w.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let C=N=>{N.forEach(k=>{d(k.isIntersecting)})},S=new IntersectionObserver(C,{threshold:.5});return x.current&&S.observe(x.current),()=>{S.disconnect()}}},[n]),w.useEffect(()=>{if(a){let C=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(C)}}},[a]);let b=()=>{o(!0)},_=()=>{o(!1),d(!1)};return i?n!=="intent"?[u,x,{}]:[u,x,{onFocus:Eo(f,b),onBlur:Eo(h,_),onMouseEnter:Eo(m,b),onMouseLeave:Eo(y,_),onTouchStart:Eo(v,b)}]:[!1,x,{}]}function Eo(n,t){return i=>{n&&n(i),i.defaultPrevented||t(i)}}function g_({page:n,...t}){let{router:i}=q0(),a=w.useMemo(()=>N0(i.routes,n,i.basename),[i.routes,n,i.basename]);return a?w.createElement(v_,{page:n,matches:a,...t}):null}function y_(n){let{manifest:t,routeModules:i}=F0(),[a,o]=w.useState([]);return w.useEffect(()=>{let u=!1;return c_(n,t,i).then(d=>{u||o(d)}),()=>{u=!0}},[n,t,i]),a}function v_({page:n,matches:t,...i}){let a=Ks(),{manifest:o,routeModules:u}=F0(),{basename:d}=q0(),{loaderData:f,matches:h}=p_(),m=w.useMemo(()=>Vv(n,t,h,o,a,"data"),[n,t,h,o,a]),y=w.useMemo(()=>Vv(n,t,h,o,a,"assets"),[n,t,h,o,a]),v=w.useMemo(()=>{if(n===a.pathname+a.search+a.hash)return[];let _=new Set,C=!1;if(t.forEach(N=>{let k=o.routes[N.route.id];!k||!k.hasLoader||(!m.some(D=>D.route.id===N.route.id)&&N.route.id in f&&u[N.route.id]?.shouldRevalidate||k.hasClientLoader?C=!0:_.add(N.route.id))}),_.size===0)return[];let S=a_(n,d,"data");return C&&_.size>0&&S.searchParams.set("_routes",t.filter(N=>_.has(N.route.id)).map(N=>N.route.id).join(",")),[S.pathname+S.search]},[d,f,a,o,m,t,n,u]),x=w.useMemo(()=>u_(y,o),[y,o]),b=y_(y);return w.createElement(w.Fragment,null,v.map(_=>w.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...i})),x.map(_=>w.createElement("link",{key:_,rel:"modulepreload",href:_,...i})),b.map(({key:_,link:C})=>w.createElement("link",{key:_,nonce:i.nonce,...C})))}function x_(...n){return t=>{n.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}var b_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{b_&&(window.__reactRouterVersion="7.11.0")}catch{}function w_({basename:n,children:t,unstable_useTransitions:i,window:a}){let o=w.useRef();o.current==null&&(o.current=tj({window:a,v5Compat:!0}));let u=o.current,[d,f]=w.useState({action:u.action,location:u.location}),h=w.useCallback(m=>{i===!1?f(m):w.startTransition(()=>f(m))},[i]);return w.useLayoutEffect(()=>u.listen(h),[u,h]),w.createElement(Qj,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:i})}var H0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,V0=w.forwardRef(function({onClick:t,discover:i="render",prefetch:a="none",relative:o,reloadDocument:u,replace:d,state:f,target:h,to:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...b},_){let{basename:C,unstable_useTransitions:S}=w.useContext(Qr),N=typeof m=="string"&&H0.test(m),k=D0(m,C);m=k.to;let D=zj(m,{relative:o}),[L,$,E]=m_(a,b),A=C_(m,{replace:d,state:f,target:h,preventScrollReset:y,relative:o,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:S});function R(V){t&&t(V),V.defaultPrevented||A(V)}let M=w.createElement("a",{...b,...E,href:k.absoluteURL||D,onClick:k.isExternal||u?t:R,ref:x_(_,$),target:h,"data-discover":!N&&i==="render"?"true":void 0});return L&&!N?w.createElement(w.Fragment,null,M,w.createElement(g_,{page:D})):M});V0.displayName="Link";var S_=w.forwardRef(function({"aria-current":t="page",caseSensitive:i=!1,className:a="",end:o=!1,style:u,to:d,viewTransition:f,children:h,...m},y){let v=sc(d,{relative:m.relative}),x=Ks(),b=w.useContext(sd),{navigator:_,basename:C}=w.useContext(Qr),S=b!=null&&A_(v)&&f===!0,N=_.encodeLocation?_.encodeLocation(v).pathname:v.pathname,k=x.pathname,D=b&&b.navigation&&b.navigation.location?b.navigation.location.pathname:null;i||(k=k.toLowerCase(),D=D?D.toLowerCase():null,N=N.toLowerCase()),D&&C&&(D=Hs(D,C)||D);const L=N!=="/"&&N.endsWith("/")?N.length-1:N.length;let $=k===N||!o&&k.startsWith(N)&&k.charAt(L)==="/",E=D!=null&&(D===N||!o&&D.startsWith(N)&&D.charAt(N.length)==="/"),A={isActive:$,isPending:E,isTransitioning:S},R=$?t:void 0,M;typeof a=="function"?M=a(A):M=[a,$?"active":null,E?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let V=typeof u=="function"?u(A):u;return w.createElement(V0,{...m,"aria-current":R,className:M,ref:y,style:V,to:d,viewTransition:f},typeof h=="function"?h(A):h)});S_.displayName="NavLink";var j_=w.forwardRef(({discover:n="render",fetcherKey:t,navigate:i,reloadDocument:a,replace:o,state:u,method:d=Lu,action:f,onSubmit:h,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...b},_)=>{let{unstable_useTransitions:C}=w.useContext(Qr),S=k_(),N=T_(f,{relative:m}),k=d.toLowerCase()==="get"?"get":"post",D=typeof f=="string"&&H0.test(f),L=$=>{if(h&&h($),$.defaultPrevented)return;$.preventDefault();let E=$.nativeEvent.submitter,A=E?.getAttribute("formmethod")||d,R=()=>S(E||$.currentTarget,{fetcherKey:t,method:A,navigate:i,replace:o,state:u,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});C&&i!==!1?w.startTransition(()=>R()):R()};return w.createElement("form",{ref:_,method:k,action:N,onSubmit:a?h:L,...b,"data-discover":!D&&n==="render"?"true":void 0})});j_.displayName="Form";function __(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function G0(n){let t=w.useContext(Cl);return Gn(t,__(n)),t}function C_(n,{target:t,replace:i,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:h}={}){let m=B0(),y=Ks(),v=sc(n,{relative:u});return w.useCallback(x=>{if(t_(x,t)){x.preventDefault();let b=i!==void 0?i:Ho(y)===Ho(v),_=()=>m(n,{replace:b,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f});h?w.startTransition(()=>_()):_()}},[y,m,v,i,a,t,n,o,u,d,f,h])}function ic(n){Wr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=w.useRef(up(n)),i=w.useRef(!1),a=Ks(),o=w.useMemo(()=>n_(a.search,i.current?null:t.current),[a.search]),u=B0(),d=w.useCallback((f,h)=>{const m=up(typeof f=="function"?f(new URLSearchParams(o)):f);i.current=!0,u("?"+m,h)},[u,o]);return[o,d]}var N_=0,E_=()=>`__${String(++N_)}__`;function k_(){let{router:n}=G0("useSubmit"),{basename:t}=w.useContext(Qr),i=Gj(),a=n.fetch,o=n.navigate;return w.useCallback(async(u,d={})=>{let{action:f,method:h,encType:m,formData:y,body:v}=i_(u,t);if(d.navigate===!1){let x=d.fetcherKey||E_();await a(x,i,d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||h,formEncType:d.encType||m,flushSync:d.flushSync})}else await o(d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||h,formEncType:d.encType||m,replace:d.replace,state:d.state,fromRouteId:i,flushSync:d.flushSync,viewTransition:d.viewTransition})},[a,o,t,i])}function T_(n,{relative:t}={}){let{basename:i}=w.useContext(Qr),a=w.useContext(Gs);Gn(a,"useFormAction must be used inside a RouteContext");let[o]=a.matches.slice(-1),u={...sc(n||".",{relative:t})},d=Ks();if(n==null){u.search=d.search;let f=new URLSearchParams(u.search),h=f.getAll("index");if(h.some(y=>y==="")){f.delete("index"),h.filter(v=>v).forEach(v=>f.append("index",v));let y=f.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&o.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(u.pathname=u.pathname==="/"?i:Fs([i,u.pathname])),Ho(u)}function A_(n,{relative:t}={}){let i=w.useContext(z0);Gn(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=G0("useViewTransitionState"),o=sc(n,{relative:t});if(!i.isTransitioning)return!1;let u=Hs(i.currentLocation.pathname,a)||i.currentLocation.pathname,d=Hs(i.nextLocation.pathname,a)||i.nextLocation.pathname;return qu(o.pathname,d)!=null||qu(o.pathname,u)!=null}var pa=C0();const R_=({children:n})=>(Ks(),s.jsxs("div",{className:"app-layout",children:[s.jsx("header",{className:"app-header",children:s.jsx("div",{className:"container app-header__content",children:s.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),s.jsx("main",{className:"container app-main",children:n}),s.jsx("footer",{className:"app-footer",children:s.jsx("div",{className:"container",children:s.jsx("p",{children:" 2026 recipe management"})})})]})),on=({children:n,className:t="",hoverable:i=!1,...a})=>s.jsx("div",{className:`glass-card ${i?"glass-card--hoverable":""} ${t}`,...a,children:n}),le=({children:n,variant:t="primary",size:i="md",isLoading:a,block:o,className:u="",...d})=>{const f=["btn",`btn--${t}`,`btn--${i}`,o?"btn--block":"",a?"btn--loading":"",u].filter(Boolean).join(" ");return s.jsxs("button",{className:f,disabled:a,...d,children:[a&&s.jsx("span",{className:"btn__spinner"}),s.jsx("span",{className:"btn__content",children:n})]})};function O_(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return w.useMemo(()=>a=>{t.forEach(o=>o(a))},t)}const ld=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Nl(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function Bp(n){return"nodeType"in n}function hr(n){var t,i;return n?Nl(n)?n:Bp(n)&&(t=(i=n.ownerDocument)==null?void 0:i.defaultView)!=null?t:window:window}function $p(n){const{Document:t}=hr(n);return n instanceof t}function ac(n){return Nl(n)?!1:n instanceof hr(n).HTMLElement}function K0(n){return n instanceof hr(n).SVGElement}function El(n){return n?Nl(n)?n.document:Bp(n)?$p(n)?n:ac(n)||K0(n)?n.ownerDocument:document:document:document}const ds=ld?w.useLayoutEffect:w.useEffect;function od(n){const t=w.useRef(n);return ds(()=>{t.current=n}),w.useCallback(function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t.current==null?void 0:t.current(...a)},[])}function D_(){const n=w.useRef(null),t=w.useCallback((a,o)=>{n.current=setInterval(a,o)},[]),i=w.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,i]}function Vo(n,t){t===void 0&&(t=[n]);const i=w.useRef(n);return ds(()=>{i.current!==n&&(i.current=n)},t),i}function lc(n,t){const i=w.useRef();return w.useMemo(()=>{const a=n(i.current);return i.current=a,a},[...t])}function Fu(n){const t=od(n),i=w.useRef(null),a=w.useCallback(o=>{o!==i.current&&t?.(o,i.current),i.current=o},[]);return[i,a]}function Hu(n){const t=w.useRef();return w.useEffect(()=>{t.current=n},[n]),t.current}let Ef={};function oc(n,t){return w.useMemo(()=>{if(t)return t;const i=Ef[n]==null?0:Ef[n]+1;return Ef[n]=i,n+"-"+i},[n,t])}function Y0(n){return function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return a.reduce((u,d)=>{const f=Object.entries(d);for(const[h,m]of f){const y=u[h];y!=null&&(u[h]=y+n*m)}return u},{...t})}}const xl=Y0(1),Go=Y0(-1);function M_(n){return"clientX"in n&&"clientY"in n}function cd(n){if(!n)return!1;const{KeyboardEvent:t}=hr(n.target);return t&&n instanceof t}function z_(n){if(!n)return!1;const{TouchEvent:t}=hr(n.target);return t&&n instanceof t}function Vu(n){if(z_(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:i}=n.touches[0];return{x:t,y:i}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:i}=n.changedTouches[0];return{x:t,y:i}}}return M_(n)?{x:n.clientX,y:n.clientY}:null}const wr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:i}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(i?Math.round(i):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:i}=n;return"scaleX("+t+") scaleY("+i+")"}},Transform:{toString(n){if(n)return[wr.Translate.toString(n),wr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:i,easing:a}=n;return t+" "+i+"ms "+a}}}),Gv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function L_(n){return n.matches(Gv)?n:n.querySelector(Gv)}const U_={display:"none"};function I_(n){let{id:t,value:i}=n;return _e.createElement("div",{id:t,style:U_},i)}function B_(n){let{id:t,announcement:i,ariaLiveType:a="assertive"}=n;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return _e.createElement("div",{id:t,style:o,role:"status","aria-live":a,"aria-atomic":!0},i)}function $_(){const[n,t]=w.useState("");return{announce:w.useCallback(a=>{a!=null&&t(a)},[]),announcement:n}}const W0=w.createContext(null);function P_(n){const t=w.useContext(W0);w.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function q_(){const[n]=w.useState(()=>new Set),t=w.useCallback(a=>(n.add(a),()=>n.delete(a)),[n]);return[w.useCallback(a=>{let{type:o,event:u}=a;n.forEach(d=>{var f;return(f=d[o])==null?void 0:f.call(d,u)})},[n]),t]}const F_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},H_={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:i}=n;return i?"Draggable item "+t.id+" was moved over droppable area "+i.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:i}=n;return i?"Draggable item "+t.id+" was dropped over droppable area "+i.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function V_(n){let{announcements:t=H_,container:i,hiddenTextDescribedById:a,screenReaderInstructions:o=F_}=n;const{announce:u,announcement:d}=$_(),f=oc("DndLiveRegion"),[h,m]=w.useState(!1);if(w.useEffect(()=>{m(!0)},[]),P_(w.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:b}=v;t.onDragMove&&u(t.onDragMove({active:x,over:b}))},onDragOver(v){let{active:x,over:b}=v;u(t.onDragOver({active:x,over:b}))},onDragEnd(v){let{active:x,over:b}=v;u(t.onDragEnd({active:x,over:b}))},onDragCancel(v){let{active:x,over:b}=v;u(t.onDragCancel({active:x,over:b}))}}),[u,t])),!h)return null;const y=_e.createElement(_e.Fragment,null,_e.createElement(I_,{id:a,value:o.draggable}),_e.createElement(B_,{id:f,announcement:d}));return i?pa.createPortal(y,i):y}var Vn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Vn||(Vn={}));function Gu(){}function ur(n,t){return w.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function ba(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return w.useMemo(()=>[...t].filter(a=>a!=null),[...t])}const hs=Object.freeze({x:0,y:0});function Pp(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function G_(n,t){const i=Vu(n);if(!i)return"0 0";const a={x:(i.x-t.left)/t.width*100,y:(i.y-t.top)/t.height*100};return a.x+"% "+a.y+"%"}function qp(n,t){let{data:{value:i}}=n,{data:{value:a}}=t;return i-a}function K_(n,t){let{data:{value:i}}=n,{data:{value:a}}=t;return a-i}function dp(n){let{left:t,top:i,height:a,width:o}=n;return[{x:t,y:i},{x:t+o,y:i},{x:t,y:i+a},{x:t+o,y:i+a}]}function Q0(n,t){if(!n||n.length===0)return null;const[i]=n;return i[t]}function Kv(n,t,i){return t===void 0&&(t=n.left),i===void 0&&(i=n.top),{x:t+n.width*.5,y:i+n.height*.5}}const Ku=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=Kv(t,t.left,t.top),u=[];for(const d of a){const{id:f}=d,h=i.get(f);if(h){const m=Pp(Kv(h),o);u.push({id:f,data:{droppableContainer:d,value:m}})}}return u.sort(qp)},Y_=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=dp(t),u=[];for(const d of a){const{id:f}=d,h=i.get(f);if(h){const m=dp(h),y=o.reduce((x,b,_)=>x+Pp(m[_],b),0),v=Number((y/4).toFixed(4));u.push({id:f,data:{droppableContainer:d,value:v}})}}return u.sort(qp)};function W_(n,t){const i=Math.max(t.top,n.top),a=Math.max(t.left,n.left),o=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=o-a,f=u-i;if(a<o&&i<u){const h=t.width*t.height,m=n.width*n.height,y=d*f,v=y/(h+m-y);return Number(v.toFixed(4))}return 0}const Q_=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=[];for(const u of a){const{id:d}=u,f=i.get(d);if(f){const h=W_(f,t);h>0&&o.push({id:d,data:{droppableContainer:u,value:h}})}}return o.sort(K_)};function J_(n,t){const{top:i,left:a,bottom:o,right:u}=t;return i<=n.y&&n.y<=o&&a<=n.x&&n.x<=u}const J0=n=>{let{droppableContainers:t,droppableRects:i,pointerCoordinates:a}=n;if(!a)return[];const o=[];for(const u of t){const{id:d}=u,f=i.get(d);if(f&&J_(a,f)){const m=dp(f).reduce((v,x)=>v+Pp(a,x),0),y=Number((m/4).toFixed(4));o.push({id:d,data:{droppableContainer:u,value:y}})}}return o.sort(qp)};function X_(n,t,i){return{...n,scaleX:t&&i?t.width/i.width:1,scaleY:t&&i?t.height/i.height:1}}function X0(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:hs}function Z_(n){return function(i){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];return o.reduce((d,f)=>({...d,top:d.top+n*f.y,bottom:d.bottom+n*f.y,left:d.left+n*f.x,right:d.right+n*f.x}),{...i})}}const e1=Z_(1);function Z0(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function t1(n,t,i){const a=Z0(t);if(!a)return n;const{scaleX:o,scaleY:u,x:d,y:f}=a,h=n.left-d-(1-o)*parseFloat(i),m=n.top-f-(1-u)*parseFloat(i.slice(i.indexOf(" ")+1)),y=o?n.width/o:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:m,right:h+y,bottom:m+v,left:h}}const n1={ignoreTransform:!1};function kl(n,t){t===void 0&&(t=n1);let i=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:m,transformOrigin:y}=hr(n).getComputedStyle(n);m&&(i=t1(i,m,y))}const{top:a,left:o,width:u,height:d,bottom:f,right:h}=i;return{top:a,left:o,width:u,height:d,bottom:f,right:h}}function Yv(n){return kl(n,{ignoreTransform:!0})}function r1(n){const t=n.innerWidth,i=n.innerHeight;return{top:0,left:0,right:t,bottom:i,width:t,height:i}}function s1(n,t){return t===void 0&&(t=hr(n).getComputedStyle(n)),t.position==="fixed"}function i1(n,t){t===void 0&&(t=hr(n).getComputedStyle(n));const i=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const u=t[o];return typeof u=="string"?i.test(u):!1})}function ud(n,t){const i=[];function a(o){if(t!=null&&i.length>=t||!o)return i;if($p(o)&&o.scrollingElement!=null&&!i.includes(o.scrollingElement))return i.push(o.scrollingElement),i;if(!ac(o)||K0(o)||i.includes(o))return i;const u=hr(n).getComputedStyle(o);return o!==n&&i1(o,u)&&i.push(o),s1(o,u)?i:a(o.parentNode)}return n?a(n):i}function eb(n){const[t]=ud(n,1);return t??null}function kf(n){return!ld||!n?null:Nl(n)?n:Bp(n)?$p(n)||n===El(n).scrollingElement?window:ac(n)?n:null:null}function tb(n){return Nl(n)?n.scrollX:n.scrollLeft}function nb(n){return Nl(n)?n.scrollY:n.scrollTop}function hp(n){return{x:tb(n),y:nb(n)}}var Qn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Qn||(Qn={}));function rb(n){return!ld||!n?!1:n===document.scrollingElement}function sb(n){const t={x:0,y:0},i=rb(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},a={x:n.scrollWidth-i.width,y:n.scrollHeight-i.height},o=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=a.y,f=n.scrollLeft>=a.x;return{isTop:o,isLeft:u,isBottom:d,isRight:f,maxScroll:a,minScroll:t}}const a1={x:.2,y:.2};function l1(n,t,i,a,o){let{top:u,left:d,right:f,bottom:h}=i;a===void 0&&(a=10),o===void 0&&(o=a1);const{isTop:m,isBottom:y,isLeft:v,isRight:x}=sb(n),b={x:0,y:0},_={x:0,y:0},C={height:t.height*o.y,width:t.width*o.x};return!m&&u<=t.top+C.height?(b.y=Qn.Backward,_.y=a*Math.abs((t.top+C.height-u)/C.height)):!y&&h>=t.bottom-C.height&&(b.y=Qn.Forward,_.y=a*Math.abs((t.bottom-C.height-h)/C.height)),!x&&f>=t.right-C.width?(b.x=Qn.Forward,_.x=a*Math.abs((t.right-C.width-f)/C.width)):!v&&d<=t.left+C.width&&(b.x=Qn.Backward,_.x=a*Math.abs((t.left+C.width-d)/C.width)),{direction:b,speed:_}}function o1(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:i,right:a,bottom:o}=n.getBoundingClientRect();return{top:t,left:i,right:a,bottom:o,width:n.clientWidth,height:n.clientHeight}}function ib(n){return n.reduce((t,i)=>xl(t,hp(i)),hs)}function c1(n){return n.reduce((t,i)=>t+tb(i),0)}function u1(n){return n.reduce((t,i)=>t+nb(i),0)}function ab(n,t){if(t===void 0&&(t=kl),!n)return;const{top:i,left:a,bottom:o,right:u}=t(n);eb(n)&&(o<=0||u<=0||i>=window.innerHeight||a>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const d1=[["x",["left","right"],c1],["y",["top","bottom"],u1]];class Fp{constructor(t,i){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=ud(i),o=ib(a);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,f]of d1)for(const h of d)Object.defineProperty(this,h,{get:()=>{const m=f(a),y=o[u]-m;return this.rect[h]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Bo{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(i=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...i)})},this.target=t}add(t,i,a){var o;(o=this.target)==null||o.addEventListener(t,i,a),this.listeners.push([t,i,a])}}function h1(n){const{EventTarget:t}=hr(n);return n instanceof t?n:El(n)}function Tf(n,t){const i=Math.abs(n.x),a=Math.abs(n.y);return typeof t=="number"?Math.sqrt(i**2+a**2)>t:"x"in t&&"y"in t?i>t.x&&a>t.y:"x"in t?i>t.x:"y"in t?a>t.y:!1}var Yr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Yr||(Yr={}));function Wv(n){n.preventDefault()}function f1(n){n.stopPropagation()}var tn;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(tn||(tn={}));const lb={start:[tn.Space,tn.Enter],cancel:[tn.Esc],end:[tn.Space,tn.Enter,tn.Tab]},p1=(n,t)=>{let{currentCoordinates:i}=t;switch(n.code){case tn.Right:return{...i,x:i.x+25};case tn.Left:return{...i,x:i.x-25};case tn.Down:return{...i,y:i.y+25};case tn.Up:return{...i,y:i.y-25}}};class Tl{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:i}}=t;this.props=t,this.listeners=new Bo(El(i)),this.windowListeners=new Bo(hr(i)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Yr.Resize,this.handleCancel),this.windowListeners.add(Yr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Yr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:i}=this.props,a=t.node.current;a&&ab(a),i(hs)}handleKeyDown(t){if(cd(t)){const{active:i,context:a,options:o}=this.props,{keyboardCodes:u=lb,coordinateGetter:d=p1,scrollBehavior:f="smooth"}=o,{code:h}=t;if(u.end.includes(h)){this.handleEnd(t);return}if(u.cancel.includes(h)){this.handleCancel(t);return}const{collisionRect:m}=a.current,y=m?{x:m.left,y:m.top}:hs;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:i,context:a.current,currentCoordinates:y});if(v){const x=Go(v,y),b={x:0,y:0},{scrollableAncestors:_}=a.current;for(const C of _){const S=t.code,{isTop:N,isRight:k,isLeft:D,isBottom:L,maxScroll:$,minScroll:E}=sb(C),A=o1(C),R={x:Math.min(S===tn.Right?A.right-A.width/2:A.right,Math.max(S===tn.Right?A.left:A.left+A.width/2,v.x)),y:Math.min(S===tn.Down?A.bottom-A.height/2:A.bottom,Math.max(S===tn.Down?A.top:A.top+A.height/2,v.y))},M=S===tn.Right&&!k||S===tn.Left&&!D,V=S===tn.Down&&!L||S===tn.Up&&!N;if(M&&R.x!==v.x){const U=C.scrollLeft+x.x,F=S===tn.Right&&U<=$.x||S===tn.Left&&U>=E.x;if(F&&!x.y){C.scrollTo({left:U,behavior:f});return}F?b.x=C.scrollLeft-U:b.x=S===tn.Right?C.scrollLeft-$.x:C.scrollLeft-E.x,b.x&&C.scrollBy({left:-b.x,behavior:f});break}else if(V&&R.y!==v.y){const U=C.scrollTop+x.y,F=S===tn.Down&&U<=$.y||S===tn.Up&&U>=E.y;if(F&&!x.x){C.scrollTo({top:U,behavior:f});return}F?b.y=C.scrollTop-U:b.y=S===tn.Down?C.scrollTop-$.y:C.scrollTop-E.y,b.y&&C.scrollBy({top:-b.y,behavior:f});break}}this.handleMove(t,xl(Go(v,this.referenceCoordinates),b))}}}handleMove(t,i){const{onMove:a}=this.props;t.preventDefault(),a(i)}handleEnd(t){const{onEnd:i}=this.props;t.preventDefault(),this.detach(),i()}handleCancel(t){const{onCancel:i}=this.props;t.preventDefault(),this.detach(),i()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Tl.activators=[{eventName:"onKeyDown",handler:(n,t,i)=>{let{keyboardCodes:a=lb,onActivation:o}=t,{active:u}=i;const{code:d}=n.nativeEvent;if(a.start.includes(d)){const f=u.activatorNode.current;return f&&n.target!==f?!1:(n.preventDefault(),o?.({event:n.nativeEvent}),!0)}return!1}}];function Qv(n){return!!(n&&"distance"in n)}function Jv(n){return!!(n&&"delay"in n)}class Hp{constructor(t,i,a){var o;a===void 0&&(a=h1(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=i;const{event:u}=t,{target:d}=u;this.props=t,this.events=i,this.document=El(d),this.documentListeners=new Bo(this.document),this.listeners=new Bo(a),this.windowListeners=new Bo(hr(d)),this.initialCoordinates=(o=Vu(u))!=null?o:hs,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:i,bypassActivationConstraint:a}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Yr.Resize,this.handleCancel),this.windowListeners.add(Yr.DragStart,Wv),this.windowListeners.add(Yr.VisibilityChange,this.handleCancel),this.windowListeners.add(Yr.ContextMenu,Wv),this.documentListeners.add(Yr.Keydown,this.handleKeydown),i){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Jv(i)){this.timeoutId=setTimeout(this.handleStart,i.delay),this.handlePending(i);return}if(Qv(i)){this.handlePending(i);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,i){const{active:a,onPending:o}=this.props;o(a,t,this.initialCoordinates,i)}handleStart(){const{initialCoordinates:t}=this,{onStart:i}=this.props;t&&(this.activated=!0,this.documentListeners.add(Yr.Click,f1,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Yr.SelectionChange,this.removeTextSelection),i(t))}handleMove(t){var i;const{activated:a,initialCoordinates:o,props:u}=this,{onMove:d,options:{activationConstraint:f}}=u;if(!o)return;const h=(i=Vu(t))!=null?i:hs,m=Go(o,h);if(!a&&f){if(Qv(f)){if(f.tolerance!=null&&Tf(m,f.tolerance))return this.handleCancel();if(Tf(m,f.distance))return this.handleStart()}if(Jv(f)&&Tf(m,f.tolerance))return this.handleCancel();this.handlePending(f,m);return}t.cancelable&&t.preventDefault(),d(h)}handleEnd(){const{onAbort:t,onEnd:i}=this.props;this.detach(),this.activated||t(this.props.active),i()}handleCancel(){const{onAbort:t,onCancel:i}=this.props;this.detach(),this.activated||t(this.props.active),i()}handleKeydown(t){t.code===tn.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const m1={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class dd extends Hp{constructor(t){const{event:i}=t,a=El(i.target);super(t,m1,a)}}dd.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;return!i.isPrimary||i.button!==0?!1:(a?.({event:i}),!0)}}];const g1={move:{name:"mousemove"},end:{name:"mouseup"}};var fp;(function(n){n[n.RightClick=2]="RightClick"})(fp||(fp={}));class Al extends Hp{constructor(t){super(t,g1,El(t.event.target))}}Al.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;return i.button===fp.RightClick?!1:(a?.({event:i}),!0)}}];const Af={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Rl extends Hp{constructor(t){super(t,Af)}static setup(){return window.addEventListener(Af.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Af.move.name,t)};function t(){}}}Rl.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;const{touches:o}=i;return o.length>1?!1:(a?.({event:i}),!0)}}];var $o;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})($o||($o={}));var Yu;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Yu||(Yu={}));function y1(n){let{acceleration:t,activator:i=$o.Pointer,canScroll:a,draggingRect:o,enabled:u,interval:d=5,order:f=Yu.TreeOrder,pointerCoordinates:h,scrollableAncestors:m,scrollableAncestorRects:y,delta:v,threshold:x}=n;const b=x1({delta:v,disabled:!u}),[_,C]=D_(),S=w.useRef({x:0,y:0}),N=w.useRef({x:0,y:0}),k=w.useMemo(()=>{switch(i){case $o.Pointer:return h?{top:h.y,bottom:h.y,left:h.x,right:h.x}:null;case $o.DraggableRect:return o}},[i,o,h]),D=w.useRef(null),L=w.useCallback(()=>{const E=D.current;if(!E)return;const A=S.current.x*N.current.x,R=S.current.y*N.current.y;E.scrollBy(A,R)},[]),$=w.useMemo(()=>f===Yu.TreeOrder?[...m].reverse():m,[f,m]);w.useEffect(()=>{if(!u||!m.length||!k){C();return}for(const E of $){if(a?.(E)===!1)continue;const A=m.indexOf(E),R=y[A];if(!R)continue;const{direction:M,speed:V}=l1(E,R,k,t,x);for(const U of["x","y"])b[U][M[U]]||(V[U]=0,M[U]=0);if(V.x>0||V.y>0){C(),D.current=E,_(L,d),S.current=V,N.current=M;return}}S.current={x:0,y:0},N.current={x:0,y:0},C()},[t,L,a,C,u,d,JSON.stringify(k),JSON.stringify(b),_,m,$,y,JSON.stringify(x)])}const v1={x:{[Qn.Backward]:!1,[Qn.Forward]:!1},y:{[Qn.Backward]:!1,[Qn.Forward]:!1}};function x1(n){let{delta:t,disabled:i}=n;const a=Hu(t);return lc(o=>{if(i||!a||!o)return v1;const u={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[Qn.Backward]:o.x[Qn.Backward]||u.x===-1,[Qn.Forward]:o.x[Qn.Forward]||u.x===1},y:{[Qn.Backward]:o.y[Qn.Backward]||u.y===-1,[Qn.Forward]:o.y[Qn.Forward]||u.y===1}}},[i,t,a])}function b1(n,t){const i=t!=null?n.get(t):void 0,a=i?i.node.current:null;return lc(o=>{var u;return t==null?null:(u=a??o)!=null?u:null},[a,t])}function w1(n,t){return w.useMemo(()=>n.reduce((i,a)=>{const{sensor:o}=a,u=o.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,a)}));return[...i,...u]},[]),[n,t])}var Ko;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Ko||(Ko={}));var pp;(function(n){n.Optimized="optimized"})(pp||(pp={}));const Xv=new Map;function S1(n,t){let{dragging:i,dependencies:a,config:o}=t;const[u,d]=w.useState(null),{frequency:f,measure:h,strategy:m}=o,y=w.useRef(n),v=S(),x=Vo(v),b=w.useCallback(function(N){N===void 0&&(N=[]),!x.current&&d(k=>k===null?N:k.concat(N.filter(D=>!k.includes(D))))},[x]),_=w.useRef(null),C=lc(N=>{if(v&&!i)return Xv;if(!N||N===Xv||y.current!==n||u!=null){const k=new Map;for(let D of n){if(!D)continue;if(u&&u.length>0&&!u.includes(D.id)&&D.rect.current){k.set(D.id,D.rect.current);continue}const L=D.node.current,$=L?new Fp(h(L),L):null;D.rect.current=$,$&&k.set(D.id,$)}return k}return N},[n,u,i,v,h]);return w.useEffect(()=>{y.current=n},[n]),w.useEffect(()=>{v||b()},[i,v]),w.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),w.useEffect(()=>{v||typeof f!="number"||_.current!==null||(_.current=setTimeout(()=>{b(),_.current=null},f))},[f,v,b,...a]),{droppableRects:C,measureDroppableContainers:b,measuringScheduled:u!=null};function S(){switch(m){case Ko.Always:return!1;case Ko.BeforeDragging:return i;default:return!i}}}function Vp(n,t){return lc(i=>n?i||(typeof t=="function"?t(n):n):null,[t,n])}function j1(n,t){return Vp(n,t)}function _1(n){let{callback:t,disabled:i}=n;const a=od(t),o=w.useMemo(()=>{if(i||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(a)},[a,i]);return w.useEffect(()=>()=>o?.disconnect(),[o]),o}function hd(n){let{callback:t,disabled:i}=n;const a=od(t),o=w.useMemo(()=>{if(i||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(a)},[i]);return w.useEffect(()=>()=>o?.disconnect(),[o]),o}function C1(n){return new Fp(kl(n),n)}function Zv(n,t,i){t===void 0&&(t=C1);const[a,o]=w.useState(null);function u(){o(h=>{if(!n)return null;if(n.isConnected===!1){var m;return(m=h??i)!=null?m:null}const y=t(n);return JSON.stringify(h)===JSON.stringify(y)?h:y})}const d=_1({callback(h){if(n)for(const m of h){const{type:y,target:v}=m;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),f=hd({callback:u});return ds(()=>{u(),n?(f?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(f?.disconnect(),d?.disconnect())},[n]),a}function N1(n){const t=Vp(n);return X0(n,t)}const ex=[];function E1(n){const t=w.useRef(n),i=lc(a=>n?a&&a!==ex&&n&&t.current&&n.parentNode===t.current.parentNode?a:ud(n):ex,[n]);return w.useEffect(()=>{t.current=n},[n]),i}function k1(n){const[t,i]=w.useState(null),a=w.useRef(n),o=w.useCallback(u=>{const d=kf(u.target);d&&i(f=>f?(f.set(d,hp(d)),new Map(f)):null)},[]);return w.useEffect(()=>{const u=a.current;if(n!==u){d(u);const f=n.map(h=>{const m=kf(h);return m?(m.addEventListener("scroll",o,{passive:!0}),[m,hp(m)]):null}).filter(h=>h!=null);i(f.length?new Map(f):null),a.current=n}return()=>{d(n),d(u)};function d(f){f.forEach(h=>{const m=kf(h);m?.removeEventListener("scroll",o)})}},[o,n]),w.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>xl(u,d),hs):ib(n):hs,[n,t])}function tx(n,t){t===void 0&&(t=[]);const i=w.useRef(null);return w.useEffect(()=>{i.current=null},t),w.useEffect(()=>{const a=n!==hs;a&&!i.current&&(i.current=n),!a&&i.current&&(i.current=null)},[n]),i.current?Go(n,i.current):hs}function T1(n){w.useEffect(()=>{if(!ld)return;const t=n.map(i=>{let{sensor:a}=i;return a.setup==null?void 0:a.setup()});return()=>{for(const i of t)i?.()}},n.map(t=>{let{sensor:i}=t;return i}))}function A1(n,t){return w.useMemo(()=>n.reduce((i,a)=>{let{eventName:o,handler:u}=a;return i[o]=d=>{u(d,t)},i},{}),[n,t])}function ob(n){return w.useMemo(()=>n?r1(n):null,[n])}const nx=[];function R1(n,t){t===void 0&&(t=kl);const[i]=n,a=ob(i?hr(i):null),[o,u]=w.useState(nx);function d(){u(()=>n.length?n.map(h=>rb(h)?a:new Fp(t(h),h)):nx)}const f=hd({callback:d});return ds(()=>{f?.disconnect(),d(),n.forEach(h=>f?.observe(h))},[n]),o}function cb(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return ac(t)?t:n}function O1(n){let{measure:t}=n;const[i,a]=w.useState(null),o=w.useCallback(m=>{for(const{target:y}of m)if(ac(y)){a(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=hd({callback:o}),d=w.useCallback(m=>{const y=cb(m);u?.disconnect(),y&&u?.observe(y),a(y?t(y):null)},[t,u]),[f,h]=Fu(d);return w.useMemo(()=>({nodeRef:f,rect:i,setRef:h}),[i,f,h])}const D1=[{sensor:dd,options:{}},{sensor:Tl,options:{}}],M1={current:{}},Iu={draggable:{measure:Yv},droppable:{measure:Yv,strategy:Ko.WhileDragging,frequency:pp.Optimized},dragOverlay:{measure:kl}};class Po extends Map{get(t){var i;return t!=null&&(i=super.get(t))!=null?i:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:i}=t;return!i})}getNodeFor(t){var i,a;return(i=(a=this.get(t))==null?void 0:a.node.current)!=null?i:void 0}}const z1={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Po,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Gu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Iu,measureDroppableContainers:Gu,windowRect:null,measuringScheduled:!1},ub={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Gu,draggableNodes:new Map,over:null,measureDroppableContainers:Gu},cc=w.createContext(ub),db=w.createContext(z1);function L1(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Po}}}function U1(n,t){switch(t.type){case Vn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Vn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case Vn.DragEnd:case Vn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Vn.RegisterDroppable:{const{element:i}=t,{id:a}=i,o=new Po(n.droppable.containers);return o.set(a,i),{...n,droppable:{...n.droppable,containers:o}}}case Vn.SetDroppableDisabled:{const{id:i,key:a,disabled:o}=t,u=n.droppable.containers.get(i);if(!u||a!==u.key)return n;const d=new Po(n.droppable.containers);return d.set(i,{...u,disabled:o}),{...n,droppable:{...n.droppable,containers:d}}}case Vn.UnregisterDroppable:{const{id:i,key:a}=t,o=n.droppable.containers.get(i);if(!o||a!==o.key)return n;const u=new Po(n.droppable.containers);return u.delete(i),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function I1(n){let{disabled:t}=n;const{active:i,activatorEvent:a,draggableNodes:o}=w.useContext(cc),u=Hu(a),d=Hu(i?.id);return w.useEffect(()=>{if(!t&&!a&&u&&d!=null){if(!cd(u)||document.activeElement===u.target)return;const f=o.get(d);if(!f)return;const{activatorNode:h,node:m}=f;if(!h.current&&!m.current)return;requestAnimationFrame(()=>{for(const y of[h.current,m.current]){if(!y)continue;const v=L_(y);if(v){v.focus();break}}})}},[a,t,o,d,u]),null}function hb(n,t){let{transform:i,...a}=t;return n!=null&&n.length?n.reduce((o,u)=>u({transform:o,...a}),i):i}function B1(n){return w.useMemo(()=>({draggable:{...Iu.draggable,...n?.draggable},droppable:{...Iu.droppable,...n?.droppable},dragOverlay:{...Iu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function $1(n){let{activeNode:t,measure:i,initialRect:a,config:o=!0}=n;const u=w.useRef(!1),{x:d,y:f}=typeof o=="boolean"?{x:o,y:o}:o;ds(()=>{if(!d&&!f||!t){u.current=!1;return}if(u.current||!a)return;const m=t?.node.current;if(!m||m.isConnected===!1)return;const y=i(m),v=X0(y,a);if(d||(v.x=0),f||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=eb(m);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,f,a,i])}const fd=w.createContext({...hs,scaleX:1,scaleY:1});var Ei;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Ei||(Ei={}));const Di=w.memo(function(t){var i,a,o,u;let{id:d,accessibility:f,autoScroll:h=!0,children:m,sensors:y=D1,collisionDetection:v=Q_,measuring:x,modifiers:b,..._}=t;const C=w.useReducer(U1,void 0,L1),[S,N]=C,[k,D]=q_(),[L,$]=w.useState(Ei.Uninitialized),E=L===Ei.Initialized,{draggable:{active:A,nodes:R,translate:M},droppable:{containers:V}}=S,U=A!=null?R.get(A):null,F=w.useRef({initial:null,translated:null}),ne=w.useMemo(()=>{var Ue;return A!=null?{id:A,data:(Ue=U?.data)!=null?Ue:M1,rect:F}:null},[A,U]),P=w.useRef(null),[B,T]=w.useState(null),[z,H]=w.useState(null),J=Vo(_,Object.values(_)),de=oc("DndDescribedBy",d),q=w.useMemo(()=>V.getEnabled(),[V]),Y=B1(x),{droppableRects:ae,measureDroppableContainers:xe,measuringScheduled:ve}=S1(q,{dragging:E,dependencies:[M.x,M.y],config:Y.droppable}),Ee=b1(R,A),he=w.useMemo(()=>z?Vu(z):null,[z]),G=Te(),ge=j1(Ee,Y.draggable.measure);$1({activeNode:A!=null?R.get(A):null,config:G.layoutShiftCompensation,initialRect:ge,measure:Y.draggable.measure});const Z=Zv(Ee,Y.draggable.measure,ge),Ce=Zv(Ee?Ee.parentElement:null),be=w.useRef({activatorEvent:null,active:null,activeNode:Ee,collisionRect:null,collisions:null,droppableRects:ae,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:V,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),We=V.getNodeFor((i=be.current.over)==null?void 0:i.id),Re=O1({measure:Y.dragOverlay.measure}),Pe=(a=Re.nodeRef.current)!=null?a:Ee,Ze=E?(o=Re.rect)!=null?o:Z:null,rt=!!(Re.nodeRef.current&&Re.rect),qe=N1(rt?null:Z),Ae=ob(Pe?hr(Pe):null),Se=E1(E?We??Ee:null),te=R1(Se),Be=hb(b,{transform:{x:M.x-qe.x,y:M.y-qe.y,scaleX:1,scaleY:1},activatorEvent:z,active:ne,activeNodeRect:Z,containerNodeRect:Ce,draggingNodeRect:Ze,over:be.current.over,overlayNodeRect:Re.rect,scrollableAncestors:Se,scrollableAncestorRects:te,windowRect:Ae}),ut=he?xl(he,M):null,Ct=k1(Se),Rt=tx(Ct),mt=tx(Ct,[Z]),Ot=xl(Be,Rt),jt=Ze?e1(Ze,Be):null,ft=ne&&jt?v({active:ne,collisionRect:jt,droppableRects:ae,droppableContainers:q,pointerCoordinates:ut}):null,Vt=Q0(ft,"id"),[an,xn]=w.useState(null),Mt=rt?Be:xl(Be,mt),nn=X_(Mt,(u=an?.rect)!=null?u:null,Z),cn=w.useRef(null),Gt=w.useCallback((Ue,He)=>{let{sensor:it,options:gt}=He;if(P.current==null)return;const Lt=R.get(P.current);if(!Lt)return;const Pt=Ue.nativeEvent,dn=new it({active:P.current,activeNode:Lt,event:Pt,options:gt,context:be,onAbort(Ke){if(!R.get(Ke))return;const{onDragAbort:Ye}=J.current,kt={id:Ke};Ye?.(kt),k({type:"onDragAbort",event:kt})},onPending(Ke,at,Ye,kt){if(!R.get(Ke))return;const{onDragPending:Dt}=J.current,Ft={id:Ke,constraint:at,initialCoordinates:Ye,offset:kt};Dt?.(Ft),k({type:"onDragPending",event:Ft})},onStart(Ke){const at=P.current;if(at==null)return;const Ye=R.get(at);if(!Ye)return;const{onDragStart:kt}=J.current,xt={activatorEvent:Pt,active:{id:at,data:Ye.data,rect:F}};pa.unstable_batchedUpdates(()=>{kt?.(xt),$(Ei.Initializing),N({type:Vn.DragStart,initialCoordinates:Ke,active:at}),k({type:"onDragStart",event:xt}),T(cn.current),H(Pt)})},onMove(Ke){N({type:Vn.DragMove,coordinates:Ke})},onEnd:ue(Vn.DragEnd),onCancel:ue(Vn.DragCancel)});cn.current=dn;function ue(Ke){return async function(){const{active:Ye,collisions:kt,over:xt,scrollAdjustedTranslate:Dt}=be.current;let Ft=null;if(Ye&&Dt){const{cancelDrop:ot}=J.current;Ft={activatorEvent:Pt,active:Ye,collisions:kt,delta:Dt,over:xt},Ke===Vn.DragEnd&&typeof ot=="function"&&await Promise.resolve(ot(Ft))&&(Ke=Vn.DragCancel)}P.current=null,pa.unstable_batchedUpdates(()=>{N({type:Ke}),$(Ei.Uninitialized),xn(null),T(null),H(null),cn.current=null;const ot=Ke===Vn.DragEnd?"onDragEnd":"onDragCancel";if(Ft){const re=J.current[ot];re?.(Ft),k({type:ot,event:Ft})}})}}},[R]),Xn=w.useCallback((Ue,He)=>(it,gt)=>{const Lt=it.nativeEvent,Pt=R.get(gt);if(P.current!==null||!Pt||Lt.dndKit||Lt.defaultPrevented)return;const dn={active:Pt};Ue(it,He.options,dn)===!0&&(Lt.dndKit={capturedBy:He.sensor},P.current=gt,Gt(it,He))},[R,Gt]),ar=w1(y,Xn);T1(y),ds(()=>{Z&&L===Ei.Initializing&&$(Ei.Initialized)},[Z,L]),w.useEffect(()=>{const{onDragMove:Ue}=J.current,{active:He,activatorEvent:it,collisions:gt,over:Lt}=be.current;if(!He||!it)return;const Pt={active:He,activatorEvent:it,collisions:gt,delta:{x:Ot.x,y:Ot.y},over:Lt};pa.unstable_batchedUpdates(()=>{Ue?.(Pt),k({type:"onDragMove",event:Pt})})},[Ot.x,Ot.y]),w.useEffect(()=>{const{active:Ue,activatorEvent:He,collisions:it,droppableContainers:gt,scrollAdjustedTranslate:Lt}=be.current;if(!Ue||P.current==null||!He||!Lt)return;const{onDragOver:Pt}=J.current,dn=gt.get(Vt),ue=dn&&dn.rect.current?{id:dn.id,rect:dn.rect.current,data:dn.data,disabled:dn.disabled}:null,Ke={active:Ue,activatorEvent:He,collisions:it,delta:{x:Lt.x,y:Lt.y},over:ue};pa.unstable_batchedUpdates(()=>{xn(ue),Pt?.(Ke),k({type:"onDragOver",event:Ke})})},[Vt]),ds(()=>{be.current={activatorEvent:z,active:ne,activeNode:Ee,collisionRect:jt,collisions:ft,droppableRects:ae,draggableNodes:R,draggingNode:Pe,draggingNodeRect:Ze,droppableContainers:V,over:an,scrollableAncestors:Se,scrollAdjustedTranslate:Ot},F.current={initial:Ze,translated:jt}},[ne,Ee,ft,jt,R,Pe,Ze,ae,V,an,Se,Ot]),y1({...G,delta:M,draggingRect:jt,pointerCoordinates:ut,scrollableAncestors:Se,scrollableAncestorRects:te});const ee=w.useMemo(()=>({active:ne,activeNode:Ee,activeNodeRect:Z,activatorEvent:z,collisions:ft,containerNodeRect:Ce,dragOverlay:Re,draggableNodes:R,droppableContainers:V,droppableRects:ae,over:an,measureDroppableContainers:xe,scrollableAncestors:Se,scrollableAncestorRects:te,measuringConfiguration:Y,measuringScheduled:ve,windowRect:Ae}),[ne,Ee,Z,z,ft,Ce,Re,R,V,ae,an,xe,Se,te,Y,ve,Ae]),De=w.useMemo(()=>({activatorEvent:z,activators:ar,active:ne,activeNodeRect:Z,ariaDescribedById:{draggable:de},dispatch:N,draggableNodes:R,over:an,measureDroppableContainers:xe}),[z,ar,ne,Z,N,de,R,an,xe]);return _e.createElement(W0.Provider,{value:D},_e.createElement(cc.Provider,{value:De},_e.createElement(db.Provider,{value:ee},_e.createElement(fd.Provider,{value:nn},m)),_e.createElement(I1,{disabled:f?.restoreFocus===!1})),_e.createElement(V_,{...f,hiddenTextDescribedById:de}));function Te(){const Ue=B?.autoScrollEnabled===!1,He=typeof h=="object"?h.enabled===!1:h===!1,it=E&&!Ue&&!He;return typeof h=="object"?{...h,enabled:it}:{enabled:it}}}),P1=w.createContext(null),rx="button",q1="Draggable";function Gp(n){let{id:t,data:i,disabled:a=!1,attributes:o}=n;const u=oc(q1),{activators:d,activatorEvent:f,active:h,activeNodeRect:m,ariaDescribedById:y,draggableNodes:v,over:x}=w.useContext(cc),{role:b=rx,roleDescription:_="draggable",tabIndex:C=0}=o??{},S=h?.id===t,N=w.useContext(S?fd:P1),[k,D]=Fu(),[L,$]=Fu(),E=A1(d,t),A=Vo(i);ds(()=>(v.set(t,{id:t,key:u,node:k,activatorNode:L,data:A}),()=>{const M=v.get(t);M&&M.key===u&&v.delete(t)}),[v,t]);const R=w.useMemo(()=>({role:b,tabIndex:C,"aria-disabled":a,"aria-pressed":S&&b===rx?!0:void 0,"aria-roledescription":_,"aria-describedby":y.draggable}),[a,b,C,S,_,y.draggable]);return{active:h,activatorEvent:f,activeNodeRect:m,attributes:R,isDragging:S,listeners:a?void 0:E,node:k,over:x,setNodeRef:D,setActivatorNodeRef:$,transform:N}}function fb(){return w.useContext(db)}const F1="Droppable",H1={timeout:25};function uc(n){let{data:t,disabled:i=!1,id:a,resizeObserverConfig:o}=n;const u=oc(F1),{active:d,dispatch:f,over:h,measureDroppableContainers:m}=w.useContext(cc),y=w.useRef({disabled:i}),v=w.useRef(!1),x=w.useRef(null),b=w.useRef(null),{disabled:_,updateMeasurementsFor:C,timeout:S}={...H1,...o},N=Vo(C??a),k=w.useCallback(()=>{if(!v.current){v.current=!0;return}b.current!=null&&clearTimeout(b.current),b.current=setTimeout(()=>{m(Array.isArray(N.current)?N.current:[N.current]),b.current=null},S)},[S]),D=hd({callback:k,disabled:_||!d}),L=w.useCallback((R,M)=>{D&&(M&&(D.unobserve(M),v.current=!1),R&&D.observe(R))},[D]),[$,E]=Fu(L),A=Vo(t);return w.useEffect(()=>{!D||!$.current||(D.disconnect(),v.current=!1,D.observe($.current))},[$,D]),w.useEffect(()=>(f({type:Vn.RegisterDroppable,element:{id:a,key:u,disabled:i,node:$,rect:x,data:A}}),()=>f({type:Vn.UnregisterDroppable,key:u,id:a})),[a]),w.useEffect(()=>{i!==y.current.disabled&&(f({type:Vn.SetDroppableDisabled,id:a,key:u,disabled:i}),y.current.disabled=i)},[a,u,i,f]),{active:d,rect:x,isOver:h?.id===a,node:$,over:h,setNodeRef:E}}function V1(n){let{animation:t,children:i}=n;const[a,o]=w.useState(null),[u,d]=w.useState(null),f=Hu(i);return!i&&!a&&f&&o(f),ds(()=>{if(!u)return;const h=a?.key,m=a?.props.id;if(h==null||m==null){o(null);return}Promise.resolve(t(m,u)).then(()=>{o(null)})},[t,a,u]),_e.createElement(_e.Fragment,null,i,a?w.cloneElement(a,{ref:d}):null)}const G1={x:0,y:0,scaleX:1,scaleY:1};function K1(n){let{children:t}=n;return _e.createElement(cc.Provider,{value:ub},_e.createElement(fd.Provider,{value:G1},t))}const Y1={position:"fixed",touchAction:"none"},W1=n=>cd(n)?"transform 250ms ease":void 0,Q1=w.forwardRef((n,t)=>{let{as:i,activatorEvent:a,adjustScale:o,children:u,className:d,rect:f,style:h,transform:m,transition:y=W1}=n;if(!f)return null;const v=o?m:{...m,scaleX:1,scaleY:1},x={...Y1,width:f.width,height:f.height,top:f.top,left:f.left,transform:wr.Transform.toString(v),transformOrigin:o&&a?G_(a,f):void 0,transition:typeof y=="function"?y(a):y,...h};return _e.createElement(i,{className:d,style:x,ref:t},u)}),Kp=n=>t=>{let{active:i,dragOverlay:a}=t;const o={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[f,h]of Object.entries(u.active))h!==void 0&&(o[f]=i.node.style.getPropertyValue(f),i.node.style.setProperty(f,h));if(u!=null&&u.dragOverlay)for(const[f,h]of Object.entries(u.dragOverlay))h!==void 0&&a.node.style.setProperty(f,h);return d!=null&&d.active&&i.node.classList.add(d.active),d!=null&&d.dragOverlay&&a.node.classList.add(d.dragOverlay),function(){for(const[h,m]of Object.entries(o))i.node.style.setProperty(h,m);d!=null&&d.active&&i.node.classList.remove(d.active)}},J1=n=>{let{transform:{initial:t,final:i}}=n;return[{transform:wr.Transform.toString(t)},{transform:wr.Transform.toString(i)}]},X1={duration:250,easing:"ease",keyframes:J1,sideEffects:Kp({styles:{active:{opacity:"0"}}})};function Z1(n){let{config:t,draggableNodes:i,droppableContainers:a,measuringConfiguration:o}=n;return od((u,d)=>{if(t===null)return;const f=i.get(u);if(!f)return;const h=f.node.current;if(!h)return;const m=cb(d);if(!m)return;const{transform:y}=hr(d).getComputedStyle(d),v=Z0(y);if(!v)return;const x=typeof t=="function"?t:eC(t);return ab(h,o.draggable.measure),x({active:{id:u,data:f.data,node:h,rect:o.draggable.measure(h)},draggableNodes:i,dragOverlay:{node:d,rect:o.dragOverlay.measure(m)},droppableContainers:a,measuringConfiguration:o,transform:v})})}function eC(n){const{duration:t,easing:i,sideEffects:a,keyframes:o}={...X1,...n};return u=>{let{active:d,dragOverlay:f,transform:h,...m}=u;if(!t)return;const y={x:f.rect.left-d.rect.left,y:f.rect.top-d.rect.top},v={scaleX:h.scaleX!==1?d.rect.width*h.scaleX/f.rect.width:1,scaleY:h.scaleY!==1?d.rect.height*h.scaleY/f.rect.height:1},x={x:h.x-y.x,y:h.y-y.y,...v},b=o({...m,active:d,dragOverlay:f,transform:{initial:h,final:x}}),[_]=b,C=b[b.length-1];if(JSON.stringify(_)===JSON.stringify(C))return;const S=a?.({active:d,dragOverlay:f,...m}),N=f.node.animate(b,{duration:t,easing:i,fill:"forwards"});return new Promise(k=>{N.onfinish=()=>{S?.(),k()}})}}let sx=0;function tC(n){return w.useMemo(()=>{if(n!=null)return sx++,sx},[n])}const Yp=_e.memo(n=>{let{adjustScale:t=!1,children:i,dropAnimation:a,style:o,transition:u,modifiers:d,wrapperElement:f="div",className:h,zIndex:m=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:b,draggableNodes:_,droppableContainers:C,dragOverlay:S,over:N,measuringConfiguration:k,scrollableAncestors:D,scrollableAncestorRects:L,windowRect:$}=fb(),E=w.useContext(fd),A=tC(v?.id),R=hb(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:b,draggingNodeRect:S.rect,over:N,overlayNodeRect:S.rect,scrollableAncestors:D,scrollableAncestorRects:L,transform:E,windowRect:$}),M=Vp(x),V=Z1({config:a,draggableNodes:_,droppableContainers:C,measuringConfiguration:k}),U=M?S.setRef:void 0;return _e.createElement(K1,null,_e.createElement(V1,{animation:V},v&&A?_e.createElement(Q1,{key:A,id:v.id,ref:U,as:f,activatorEvent:y,adjustScale:t,className:h,transition:u,rect:M,style:{zIndex:m,...o},transform:R},i):null))});function zi(n,t,i){const a=n.slice();return a.splice(i<0?a.length+i:i,0,a.splice(t,1)[0]),a}function nC(n,t){return n.reduce((i,a,o)=>{const u=t.get(a);return u&&(i[o]=u),i},Array(n.length))}function wu(n){return n!==null&&n>=0}function rC(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(n[i]!==t[i])return!1;return!0}function sC(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const Wp=n=>{let{rects:t,activeIndex:i,overIndex:a,index:o}=n;const u=zi(t,a,i),d=t[o],f=u[o];return!f||!d?null:{x:f.left-d.left,y:f.top-d.top,scaleX:f.width/d.width,scaleY:f.height/d.height}},Su={scaleX:1,scaleY:1},Sl=n=>{var t;let{activeIndex:i,activeNodeRect:a,index:o,rects:u,overIndex:d}=n;const f=(t=u[i])!=null?t:a;if(!f)return null;if(o===i){const m=u[d];return m?{x:0,y:i<d?m.top+m.height-(f.top+f.height):m.top-f.top,...Su}:null}const h=iC(u,o,i);return o>i&&o<=d?{x:0,y:-f.height-h,...Su}:o<i&&o>=d?{x:0,y:f.height+h,...Su}:{x:0,y:0,...Su}};function iC(n,t,i){const a=n[t],o=n[t-1],u=n[t+1];return a?i<t?o?a.top-(o.top+o.height):u?u.top-(a.top+a.height):0:u?u.top-(a.top+a.height):o?a.top-(o.top+o.height):0:0}const pb="Sortable",mb=_e.createContext({activeIndex:-1,containerId:pb,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Wp,disabled:{draggable:!1,droppable:!1}});function xa(n){let{children:t,id:i,items:a,strategy:o=Wp,disabled:u=!1}=n;const{active:d,dragOverlay:f,droppableRects:h,over:m,measureDroppableContainers:y}=fb(),v=oc(pb,i),x=f.rect!==null,b=w.useMemo(()=>a.map(E=>typeof E=="object"&&"id"in E?E.id:E),[a]),_=d!=null,C=d?b.indexOf(d.id):-1,S=m?b.indexOf(m.id):-1,N=w.useRef(b),k=!rC(b,N.current),D=S!==-1&&C===-1||k,L=sC(u);ds(()=>{k&&_&&y(b)},[k,b,_,y]),w.useEffect(()=>{N.current=b},[b]);const $=w.useMemo(()=>({activeIndex:C,containerId:v,disabled:L,disableTransforms:D,items:b,overIndex:S,useDragOverlay:x,sortedRects:nC(b,h),strategy:o}),[C,v,L.draggable,L.droppable,D,b,S,h,x,o]);return _e.createElement(mb.Provider,{value:$},t)}const aC=n=>{let{id:t,items:i,activeIndex:a,overIndex:o}=n;return zi(i,a,o).indexOf(t)},lC=n=>{let{containerId:t,isSorting:i,wasDragging:a,index:o,items:u,newIndex:d,previousItems:f,previousContainerId:h,transition:m}=n;return!m||!a||f!==u&&o===d?!1:i?!0:d!==o&&t===h},oC={duration:200,easing:"ease"},gb="transform",cC=wr.Transition.toString({property:gb,duration:0,easing:"linear"}),uC={roleDescription:"sortable"};function dC(n){let{disabled:t,index:i,node:a,rect:o}=n;const[u,d]=w.useState(null),f=w.useRef(i);return ds(()=>{if(!t&&i!==f.current&&a.current){const h=o.current;if(h){const m=kl(a.current,{ignoreTransform:!0}),y={x:h.left-m.left,y:h.top-m.top,scaleX:h.width/m.width,scaleY:h.height/m.height};(y.x||y.y)&&d(y)}}i!==f.current&&(f.current=i)},[t,i,a,o]),w.useEffect(()=>{u&&d(null)},[u]),u}function wa(n){let{animateLayoutChanges:t=lC,attributes:i,disabled:a,data:o,getNewIndex:u=aC,id:d,strategy:f,resizeObserverConfig:h,transition:m=oC}=n;const{items:y,containerId:v,activeIndex:x,disabled:b,disableTransforms:_,sortedRects:C,overIndex:S,useDragOverlay:N,strategy:k}=w.useContext(mb),D=hC(a,b),L=y.indexOf(d),$=w.useMemo(()=>({sortable:{containerId:v,index:L,items:y},...o}),[v,o,L,y]),E=w.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:A,node:R,isOver:M,setNodeRef:V}=uc({id:d,data:$,disabled:D.droppable,resizeObserverConfig:{updateMeasurementsFor:E,...h}}),{active:U,activatorEvent:F,activeNodeRect:ne,attributes:P,setNodeRef:B,listeners:T,isDragging:z,over:H,setActivatorNodeRef:J,transform:de}=Gp({id:d,data:$,attributes:{...uC,...i},disabled:D.draggable}),q=O_(V,B),Y=!!U,ae=Y&&!_&&wu(x)&&wu(S),xe=!N&&z,ve=xe&&ae?de:null,he=ae?ve??(f??k)({rects:C,activeNodeRect:ne,activeIndex:x,overIndex:S,index:L}):null,G=wu(x)&&wu(S)?u({id:d,items:y,activeIndex:x,overIndex:S}):L,ge=U?.id,Z=w.useRef({activeId:ge,items:y,newIndex:G,containerId:v}),Ce=y!==Z.current.items,be=t({active:U,containerId:v,isDragging:z,isSorting:Y,id:d,index:L,items:y,newIndex:Z.current.newIndex,previousItems:Z.current.items,previousContainerId:Z.current.containerId,transition:m,wasDragging:Z.current.activeId!=null}),We=dC({disabled:!be,index:L,node:R,rect:A});return w.useEffect(()=>{Y&&Z.current.newIndex!==G&&(Z.current.newIndex=G),v!==Z.current.containerId&&(Z.current.containerId=v),y!==Z.current.items&&(Z.current.items=y)},[Y,G,v,y]),w.useEffect(()=>{if(ge===Z.current.activeId)return;if(ge!=null&&Z.current.activeId==null){Z.current.activeId=ge;return}const Pe=setTimeout(()=>{Z.current.activeId=ge},50);return()=>clearTimeout(Pe)},[ge]),{active:U,activeIndex:x,attributes:P,data:$,rect:A,index:L,newIndex:G,items:y,isOver:M,isSorting:Y,isDragging:z,listeners:T,node:R,overIndex:S,over:H,setNodeRef:q,setActivatorNodeRef:J,setDroppableNodeRef:V,setDraggableNodeRef:B,transform:We??he,transition:Re()};function Re(){if(We||Ce&&Z.current.newIndex===L)return cC;if(!(xe&&!cd(F)||!m)&&(Y||be))return wr.Transition.toString({...m,property:gb})}}function hC(n,t){var i,a;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(i=n?.draggable)!=null?i:t.draggable,droppable:(a=n?.droppable)!=null?a:t.droppable}}function Wu(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const fC=[tn.Down,tn.Right,tn.Up,tn.Left],pd=(n,t)=>{let{context:{active:i,collisionRect:a,droppableRects:o,droppableContainers:u,over:d,scrollableAncestors:f}}=t;if(fC.includes(n.code)){if(n.preventDefault(),!i||!a)return;const h=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=o.get(v.id);if(x)switch(n.code){case tn.Down:a.top<x.top&&h.push(v);break;case tn.Up:a.top>x.top&&h.push(v);break;case tn.Left:a.left>x.left&&h.push(v);break;case tn.Right:a.left<x.left&&h.push(v);break}});const m=Y_({collisionRect:a,droppableRects:o,droppableContainers:h});let y=Q0(m,"id");if(y===d?.id&&m.length>1&&(y=m[1].id),y!=null){const v=u.get(i.id),x=u.get(y),b=x?o.get(x.id):null,_=x?.node.current;if(_&&b&&v&&x){const S=ud(_).some((E,A)=>f[A]!==E),N=yb(v,x),k=pC(v,x),D=S||!N?{x:0,y:0}:{x:k?a.width-b.width:0,y:k?a.height-b.height:0},L={x:b.left,y:b.top};return D.x&&D.y?L:Go(L,D)}}}};function yb(n,t){return!Wu(n)||!Wu(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function pC(n,t){return!Wu(n)||!Wu(t)||!yb(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const mC=()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1,gC=(n,{mobile:t=!1}={})=>{if(!n||typeof n!="string"||n.startsWith("data:")||n.startsWith("blob:"))return n;if(n.includes("/storage/v1/object/public/")){const i=t?360:640,a=t?55:68,o=n.includes("?")?"&":"?";return`${n}${o}width=${i}&quality=${a}&resize=contain`}return n},ix=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},Mi=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],yC=({recipe:n,isSelected:t,isSelectMode:i,onSelectRecipe:a,onToggleSelection:o,disableDrag:u,showOwner:d,ownerLabelFn:f,index:h=0,mobileView:m=!1})=>{const{attributes:y,listeners:v,setNodeRef:x,transform:b,transition:_,isDragging:C}=wa({id:n.id,disabled:u}),S={transform:wr.Transform.toString(b),transition:_,opacity:C?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"},N=m?4:8,k=h<N?"eager":"lazy",D=h<N?"high":"low",L=gC(n.image,{mobile:m});return s.jsx("div",{ref:x,style:S,...y,...v,children:s.jsxs(on,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some($=>/|Dessert/i.test($))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{i?o(n.id):a(n)},children:[s.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?s.jsx("img",{src:L,alt:n.title,className:"recipe-card__image",loading:k,decoding:"async",fetchPriority:D,sizes:m?"(max-width: 700px) 45vw, 320px":"(max-width: 1024px) 33vw, 280px"}):s.jsx("div",{className:"recipe-card__image placeholder"}),s.jsx("div",{className:"recipe-card__overlay"}),i&&s.jsx("div",{className:"recipe-card__selection-overlay",children:s.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),s.jsx("div",{className:"recipe-card__tags",children:(()=>{const $=Mi(n.tags);if($.length===0)return null;const E=$.filter(M=>!M.startsWith("owner:"));return(E.includes("URL")?["URL"]:E).slice(0,1).map((M,V)=>s.jsx("span",{className:"recipe-tag",children:M},`${M}-${V}`))})()})]}),s.jsxs("div",{className:"recipe-card__content",children:[s.jsx("h3",{className:"recipe-title",children:n.title}),s.jsx("p",{className:"recipe-desc",children:n.description}),s.jsxs("div",{className:"recipe-meta",children:[n.storeName&&s.jsxs("span",{children:[" ",n.storeName]}),d&&typeof f=="function"&&s.jsxs("span",{className:"recipe-owner",children:[" ",f(n)]}),s.jsxs("div",{className:"recipe-dates",children:[s.jsxs("span",{className:"recipe-date",children:[" : ",ix(n.created_at)]}),n.updated_at&&s.jsxs("span",{className:"recipe-date",children:[" : ",ix(n.updated_at)]})]})]})]})]})})},ax=n=>{const t=Mi(n.tags);return n.type==="bread"||t.some(i=>/|Bread/i.test(i))},lx=n=>{const t=a=>/|Dessert/i.test(a),i=Mi(n.tags);return/|Dessert/i.test(n.category||"")||i.some(t)},ox=n=>{const t=Mi(n.tags);return/|Sauce/i.test(n.category||"")||t.some(i=>/|Sauce/i.test(i))},cx=n=>{const t=Mi(n.tags);return/||Decor/i.test(n.category||"")||t.some(i=>/||Decor/i.test(i))},ux=n=>{const t=n.category||"",i=Mi(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||i.some(a=>/|Dressing||Vinaigrette||Mayonnaise/i.test(a))},dx=n=>{const t=n.filter(v=>ax(v)),i=n.filter(v=>!ax(v)),a=i.filter(v=>ox(v)),o=i.filter(v=>!ox(v)),u=o.filter(v=>cx(v)),d=o.filter(v=>!cx(v)),f=d.filter(v=>ux(v)),h=d.filter(v=>!ux(v)),m=h.filter(v=>lx(v));return{cookingRecipes:h.filter(v=>!lx(v)),breadRecipes:t,dessertRecipes:m,sauceRecipes:a,dressingRecipes:f,decorationRecipes:u}},hx=({recipes:n,onSelectRecipe:t,isSelectMode:i,selectedIds:a,onToggleSelection:o,disableDrag:u,displayMode:d="normal",publicRecipeView:f="none",showOwner:h=!1,ownerLabelFn:m,currentUser:y=null})=>{const[v,x]=w.useState({}),[b,_]=w.useState(()=>mC());_e.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const z=window.matchMedia("(max-width: 700px)"),H=()=>_(!!z.matches);return H(),z.addEventListener?z.addEventListener("change",H):z.addListener(H),()=>{z.removeEventListener?z.removeEventListener("change",H):z.removeListener(H)}},[]);const C=z=>{x(H=>({...H,[z]:!H[z]}))},S=z=>Mi(z?.tags).map(J=>J.toLowerCase()).includes("public"),N=z=>{if(!y)return!1;const H=Mi(z?.tags).filter(de=>de.startsWith("owner:"));if(H.length===0)return!1;const J=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return H.some(de=>J.has(de))},k=n.filter(z=>S(z)),D=k.filter(z=>N(z)),L=k.filter(z=>!N(z)),$=n.filter(z=>!S(z)),{cookingRecipes:E,breadRecipes:A,dessertRecipes:R,sauceRecipes:M,dressingRecipes:V,decorationRecipes:U}=dx($),[F,ne]=w.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);_e.useEffect(()=>{const z=()=>{window.innerWidth>=1024?ne(9):ne(8)};return window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]);const P=(z,H,J,de,{showWhenEmpty:q=!1,emptyMessage:Y=""}={})=>{if(H.length===0&&!q)return null;const ae=d==="all";let xe=H,ve=!1,Ee=!1;return ae||(ve=v[de],Ee=H.length>F,xe=ve?H:H.slice(0,F)),s.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[s.jsxs("h3",{onClick:()=>!ae&&Ee&&C(de),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!ae&&Ee?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[s.jsx("span",{children:J})," ",z,s.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",H.length,")"]}),!ae&&Ee&&s.jsx("span",{className:"section-toggle-btn",children:ve?" ":" "})]}),s.jsx("div",{className:"recipe-grid",children:s.jsx(xa,{items:xe.map(he=>he.id),strategy:Wp,children:xe.map((he,G)=>{const ge=a&&a.has(he.id);return s.jsx(yC,{recipe:he,isSelected:ge,isSelectMode:i,onSelectRecipe:t,onToggleSelection:o,disableDrag:u,showOwner:h,ownerLabelFn:m,index:G,mobileView:b},he.id)})})}),H.length===0&&s.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:Y||`${z}`})]})},B=()=>{if(f!=="mine"&&f!=="others")return null;const z=f==="mine",H=z?"":"",J=z?"":"",de=z?"public-mine":"public-others",q=z?D:L,Y=z?"":"",ae=dx(q);return s.jsxs("div",{className:"public-recipes-block",children:[s.jsxs("div",{className:"public-recipes-block__header",children:[s.jsx("span",{children:J}),s.jsx("span",{children:H}),s.jsxs("span",{className:"public-recipes-block__count",children:["(",q.length,")"]})]}),q.length===0?s.jsx("div",{className:"public-recipes-block__empty",children:Y}):s.jsxs(s.Fragment,{children:[P("",ae.cookingRecipes,"",`${de}-cooking`),P("",ae.breadRecipes,"",`${de}-bread`),P("",ae.dessertRecipes,"",`${de}-dessert`),P("",ae.sauceRecipes,"",`${de}-sauce`),P("",ae.dressingRecipes,"",`${de}-dressing`),P("",ae.decorationRecipes,"",`${de}-decoration`)]})]})},T=f==="none"&&k.length>0&&$.length===0;return s.jsxs("div",{className:"recipe-list-container",children:[B(),T&&s.jsx("div",{className:"recipe-list-empty-hint",children:""}),P("",E,"","cooking"),P("",A,"","bread"),P("",R,"","dessert"),P("",M,"","sauce"),P("",V,"","dressing"),P("",U,"","decoration"),n.length===0&&s.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},wn=({isOpen:n,onClose:t,title:i,children:a,size:o="medium",showCloseButton:u=!0})=>{if(w.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),w.useEffect(()=>{const f=h=>{h.key==="Escape"&&n&&t()};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[n,t]),!n)return null;const d=f=>{f.target===f.currentTarget&&t()};return s.jsx("div",{className:"modal-overlay",onClick:d,children:s.jsxs("div",{className:`modal-content modal-${o}`,children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h3",{className:"modal-title",children:i}),u&&s.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),s.jsx("div",{className:"modal-body",children:a})]})})};function md(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(n);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(n,a[o])&&(i[a[o]]=n[a[o]]);return i}function vC(n,t,i,a){function o(u){return u instanceof i?u:new i(function(d){d(u)})}return new(i||(i=Promise))(function(u,d){function f(y){try{m(a.next(y))}catch(v){d(v)}}function h(y){try{m(a.throw(y))}catch(v){d(v)}}function m(y){y.done?u(y.value):o(y.value).then(f,h)}m((a=a.apply(n,t||[])).next())})}const xC=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class Qp extends Error{constructor(t,i="FunctionsError",a){super(t),this.name=i,this.context=a}}class bC extends Qp{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class fx extends Qp{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class px extends Qp{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var mp;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(mp||(mp={}));class wC{constructor(t,{headers:i={},customFetch:a,region:o=mp.Any}={}){this.url=t,this.headers=i,this.region=o,this.fetch=xC(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return vC(this,arguments,void 0,function*(i,a={}){var o;let u,d;try{const{headers:f,method:h,body:m,signal:y,timeout:v}=a;let x={},{region:b}=a;b||(b=this.region);const _=new URL(`${this.url}/${i}`);b&&b!=="any"&&(x["x-region"]=b,_.searchParams.set("forceFunctionRegion",b));let C;m&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",C=m):typeof m=="string"?(x["Content-Type"]="text/plain",C=m):typeof FormData<"u"&&m instanceof FormData?C=m:(x["Content-Type"]="application/json",C=JSON.stringify(m)):C=m;let S=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(S=d.signal,y.addEventListener("abort",()=>d.abort())):S=d.signal);const N=yield this.fetch(_.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),f),body:C,signal:S}).catch($=>{throw new bC($)}),k=N.headers.get("x-relay-error");if(k&&k==="true")throw new fx(N);if(!N.ok)throw new px(N);let D=((o=N.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),L;return D==="application/json"?L=yield N.json():D==="application/octet-stream"||D==="application/pdf"?L=yield N.blob():D==="text/event-stream"?L=N:D==="multipart/form-data"?L=yield N.formData():L=yield N.text(),{data:L,error:null,response:N}}catch(f){return{data:null,error:f,response:f instanceof px||f instanceof fx?f.context:void 0}}finally{u&&clearTimeout(u)}})}}var SC=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},jC=class{constructor(n){var t,i;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(i=n.isMaybeSingle)!==null&&i!==void 0?i:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var i=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let o=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,f=null,h=null,m=u.status,y=u.statusText;if(u.ok){var v,x;if(i.method!=="HEAD"){var b;const N=await u.text();N===""||(i.headers.get("Accept")==="text/csv"||i.headers.get("Accept")&&(!((b=i.headers.get("Accept"))===null||b===void 0)&&b.includes("application/vnd.pgrst.plan+text"))?f=N:f=JSON.parse(N))}const C=(v=i.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),S=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");C&&S&&S.length>1&&(h=parseInt(S[1])),i.isMaybeSingle&&i.method==="GET"&&Array.isArray(f)&&(f.length>1?(d={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,m=406,y="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{var _;const C=await u.text();try{d=JSON.parse(C),Array.isArray(d)&&u.status===404&&(f=[],d=null,m=200,y="OK")}catch{u.status===404&&C===""?(m=204,y="No Content"):d={message:C}}if(d&&i.isMaybeSingle&&(!(d==null||(_=d.details)===null||_===void 0)&&_.includes("0 rows"))&&(d=null,m=200,y="OK"),d&&i.shouldThrowOnError)throw new SC(d)}return{error:d,data:f,count:h,status:m,statusText:y}});return this.shouldThrowOnError||(o=o.catch(u=>{var d;let f="";const h=u?.cause;if(h){var m,y,v,x;const _=(m=h?.message)!==null&&m!==void 0?m:"",C=(y=h?.code)!==null&&y!==void 0?y:"";f=`${(v=u?.name)!==null&&v!==void 0?v:"FetchError"}: ${u?.message}`,f+=`

Caused by: ${(x=h?.name)!==null&&x!==void 0?x:"Error"}: ${_}`,C&&(f+=` (${C})`),h?.stack&&(f+=`
${h.stack}`)}else{var b;f=(b=u?.stack)!==null&&b!==void 0?b:""}return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:f,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),o.then(n,t)}returns(){return this}overrideTypes(){return this}},_C=class extends jC{select(n){let t=!1;const i=(n??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:i,foreignTable:a,referencedTable:o=a}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:i=t}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,t,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:i=!1,buffers:a=!1,wal:o=!1,format:u="text"}={}){var d;const f=[n?"analyze":null,t?"verbose":null,i?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),h=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${h}"; options=${f};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const mx=new RegExp("[,()]");var fl=class extends _C{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const i=Array.from(new Set(t)).map(a=>typeof a=="string"&&mx.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`in.(${i})`),this}notIn(n,t){const i=Array.from(new Set(t)).map(a=>typeof a=="string"&&mx.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`not.in.(${i})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:i,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const u=i===void 0?"":`(${i})`;return this.url.searchParams.append(n,`${o}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,i])=>{this.url.searchParams.append(t,`eq.${i}`)}),this}not(n,t,i){return this.url.searchParams.append(n,`not.${t}.${i}`),this}or(n,{foreignTable:t,referencedTable:i=t}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${n})`),this}filter(n,t,i){return this.url.searchParams.append(n,`${t}.${i}`),this}},CC=class{constructor(n,{headers:t={},schema:i,fetch:a}){this.url=n,this.headers=new Headers(t),this.schema=i,this.fetch=a}select(n,t){const{head:i=!1,count:a}=t??{},o=i?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(f=>/\s/.test(f)&&!u?"":(f==='"'&&(u=!u),f)).join("");return this.url.searchParams.set("select",d),a&&this.headers.append("Prefer",`count=${a}`),new fl({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:t,defaultToNull:i=!0}={}){var a;const o="POST";if(t&&this.headers.append("Prefer",`count=${t}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(u.length>0){const d=[...new Set(u)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new fl({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(n,{onConflict:t,ignoreDuplicates:i=!1,count:a,defaultToNull:o=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const f=n.reduce((h,m)=>h.concat(Object.keys(m)),[]);if(f.length>0){const h=[...new Set(f)].map(m=>`"${m}"`);this.url.searchParams.set("columns",h.join(","))}}return new fl({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(n,{count:t}={}){var i;const a="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new fl({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:n}={}){var t;const i="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new fl({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},NC=class vb{constructor(t,{headers:i={},schema:a,fetch:o}={}){this.url=t,this.headers=new Headers(i),this.schemaName=a,this.fetch=o}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new CC(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new vb(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,i={},{head:a=!1,get:o=!1,count:u}={}){var d;let f;const h=new URL(`${this.url}/rpc/${t}`);let m;a||o?(f=a?"HEAD":"GET",Object.entries(i).filter(([v,x])=>x!==void 0).map(([v,x])=>[v,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([v,x])=>{h.searchParams.append(v,x)})):(f="POST",m=i);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new fl({method:f,url:h,headers:y,schema:this.schemaName,body:m,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}};class EC{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const i=process.versions;if(i&&i.node){const a=i.node,o=parseInt(a.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let i=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(i+=`

Suggested solution: ${t.workaround}`),new Error(i)}static createWebSocket(t,i){const a=this.getWebSocketConstructor();return new a(t,i)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const kC="2.89.0",TC=`realtime-js/${kC}`,xb="1.0.0",AC="2.0.0",gx=xb,gp=1e4,RC=1e3,OC=100;var ki;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(ki||(ki={}));var Hn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Hn||(Hn={}));var cs;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(cs||(cs={}));var yp;(function(n){n.websocket="websocket"})(yp||(yp={}));var da;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(da||(da={}));class DC{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,i){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return i(this._binaryEncodeUserBroadcastPush(t));let a=[t.join_ref,t.ref,t.topic,t.event,t.payload];return i(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(t){var i;return this._isArrayBuffer((i=t.payload)===null||i===void 0?void 0:i.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var i,a;const o=(a=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var i,a;const o=(a=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&a!==void 0?a:{},d=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,i,a){var o,u;const d=t.topic,f=(o=t.ref)!==null&&o!==void 0?o:"",h=(u=t.join_ref)!==null&&u!==void 0?u:"",m=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(h.length>255)throw new Error(`joinRef length ${h.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`ref length ${f.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`userEvent length ${m.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+f.length+d.length+m.length+v.length,b=new ArrayBuffer(this.HEADER_LENGTH+x);let _=new DataView(b),C=0;_.setUint8(C++,this.KINDS.userBroadcastPush),_.setUint8(C++,h.length),_.setUint8(C++,f.length),_.setUint8(C++,d.length),_.setUint8(C++,m.length),_.setUint8(C++,v.length),_.setUint8(C++,i),Array.from(h,N=>_.setUint8(C++,N.charCodeAt(0))),Array.from(f,N=>_.setUint8(C++,N.charCodeAt(0))),Array.from(d,N=>_.setUint8(C++,N.charCodeAt(0))),Array.from(m,N=>_.setUint8(C++,N.charCodeAt(0))),Array.from(v,N=>_.setUint8(C++,N.charCodeAt(0)));var S=new Uint8Array(b.byteLength+a.byteLength);return S.set(new Uint8Array(b),0),S.set(new Uint8Array(a),b.byteLength),S.buffer}decode(t,i){if(this._isArrayBuffer(t)){let a=this._binaryDecode(t);return i(a)}if(typeof t=="string"){const a=JSON.parse(t),[o,u,d,f,h]=a;return i({join_ref:o,ref:u,topic:d,event:f,payload:h})}return i({})}_binaryDecode(t){const i=new DataView(t),a=i.getUint8(0),o=new TextDecoder;if(a===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,i,o)}_decodeUserBroadcast(t,i,a){const o=i.getUint8(1),u=i.getUint8(2),d=i.getUint8(3),f=i.getUint8(4);let h=this.HEADER_LENGTH+4;const m=a.decode(t.slice(h,h+o));h=h+o;const y=a.decode(t.slice(h,h+u));h=h+u;const v=a.decode(t.slice(h,h+d));h=h+d;const x=t.slice(h,t.byteLength),b=f===this.JSON_ENCODING?JSON.parse(a.decode(x)):x,_={type:this.BROADCAST_EVENT,event:y,payload:b};return d>0&&(_.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(t){var i;return t instanceof ArrayBuffer||((i=t?.constructor)===null||i===void 0?void 0:i.name)==="ArrayBuffer"}_pick(t,i){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([a])=>i.includes(a)))}}class bb{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var bn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(bn||(bn={}));const yx=(n,t,i={})=>{var a;const o=(a=i.skipTypes)!==null&&a!==void 0?a:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=MC(d,n,t,o),u),{}):{}},MC=(n,t,i,a)=>{const o=t.find(f=>f.name===n),u=o?.type,d=i[n];return u&&!a.includes(u)?wb(u,d):vp(d)},wb=(n,t)=>{if(n.charAt(0)==="_"){const i=n.slice(1,n.length);return IC(t,i)}switch(n){case bn.bool:return zC(t);case bn.float4:case bn.float8:case bn.int2:case bn.int4:case bn.int8:case bn.numeric:case bn.oid:return LC(t);case bn.json:case bn.jsonb:return UC(t);case bn.timestamp:return BC(t);case bn.abstime:case bn.date:case bn.daterange:case bn.int4range:case bn.int8range:case bn.money:case bn.reltime:case bn.text:case bn.time:case bn.timestamptz:case bn.timetz:case bn.tsrange:case bn.tstzrange:return vp(t);default:return vp(t)}},vp=n=>n,zC=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},LC=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},UC=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},IC=(n,t)=>{if(typeof n!="string")return n;const i=n.length-1,a=n[i];if(n[0]==="{"&&a==="}"){let u;const d=n.slice(1,i);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(f=>wb(t,f))}return n},BC=n=>typeof n=="string"?n.replace(" ","T"):n,Sb=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Rf{constructor(t,i,a={},o=gp){this.channel=t,this.event=i,this.payload=a,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var a;return this._hasReceived(t)&&i((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var vx;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(vx||(vx={}));class qo{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=i?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},o=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=qo.syncState(this.state,o,u,d),this.pendingDiffs.forEach(h=>{this.state=qo.syncDiff(this.state,h,u,d)}),this.pendingDiffs=[],f()}),this.channel._on(a.diff,{},o=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=qo.syncDiff(this.state,o,u,d),f())}),this.onJoin((o,u,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:u,newPresences:d})}),this.onLeave((o,u,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,a,o){const u=this.cloneDeep(t),d=this.transformState(i),f={},h={};return this.map(u,(m,y)=>{d[m]||(h[m]=y)}),this.map(d,(m,y)=>{const v=u[m];if(v){const x=y.map(S=>S.presence_ref),b=v.map(S=>S.presence_ref),_=y.filter(S=>b.indexOf(S.presence_ref)<0),C=v.filter(S=>x.indexOf(S.presence_ref)<0);_.length>0&&(f[m]=_),C.length>0&&(h[m]=C)}else f[m]=y}),this.syncDiff(u,{joins:f,leaves:h},a,o)}static syncDiff(t,i,a,o){const{joins:u,leaves:d}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return a||(a=()=>{}),o||(o=()=>{}),this.map(u,(f,h)=>{var m;const y=(m=t[f])!==null&&m!==void 0?m:[];if(t[f]=this.cloneDeep(h),y.length>0){const v=t[f].map(b=>b.presence_ref),x=y.filter(b=>v.indexOf(b.presence_ref)<0);t[f].unshift(...x)}a(f,y,h)}),this.map(d,(f,h)=>{let m=t[f];if(!m)return;const y=h.map(v=>v.presence_ref);m=m.filter(v=>y.indexOf(v.presence_ref)<0),t[f]=m,o(f,m,h),m.length===0&&delete t[f]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(a=>i(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,a)=>{const o=t[a];return"metas"in o?i[a]=o.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):i[a]=o,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var xx;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(xx||(xx={}));var Fo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Fo||(Fo={}));var Ps;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Ps||(Ps={}));class yl{constructor(t,i={config:{}},a){var o,u;if(this.topic=t,this.params=i,this.socket=a,this.bindings={},this.state=Hn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new Rf(this,cs.join,this.params,this.timeout),this.rejoinTimer=new bb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Hn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Hn.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Hn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Hn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Hn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(cs.reply,{},(d,f)=>{this._trigger(this._replyEventName(f),d)}),this.presence=new qo(this),this.broadcastEndpointURL=Sb(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,i=this.timeout){var a,o,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Hn.closed){const{config:{broadcast:d,presence:f,private:h}}=this.params,m=(o=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(b=>b.filter))!==null&&o!==void 0?o:[],y=!!this.bindings[Fo.PRESENCE]&&this.bindings[Fo.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},f),{enabled:y}),postgres_changes:m,private:h};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(b=>t?.(Ps.CHANNEL_ERROR,b)),this._onClose(()=>t?.(Ps.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:b})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),b===void 0){t?.(Ps.SUBSCRIBED);return}else{const C=this.bindings.postgres_changes,S=(_=C?.length)!==null&&_!==void 0?_:0,N=[];for(let k=0;k<S;k++){const D=C[k],{filter:{event:L,schema:$,table:E,filter:A}}=D,R=b&&b[k];if(R&&R.event===L&&yl.isFilterValueEqual(R.schema,$)&&yl.isFilterValueEqual(R.table,E)&&yl.isFilterValueEqual(R.filter,A))N.push(Object.assign(Object.assign({},D),{id:R.id}));else{this.unsubscribe(),this.state=Hn.errored,t?.(Ps.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=N,t&&t(Ps.SUBSCRIBED);return}}).receive("error",b=>{this.state=Hn.errored,t?.(Ps.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{t?.(Ps.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,a){return this.state===Hn.joined&&t===Fo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,i,a)}async httpSend(t,i,a={}){var o;if(i==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:i,private:this.private}]})},f=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=a.timeout)!==null&&o!==void 0?o:this.timeout);if(f.status===202)return{success:!0};let h=f.statusText;try{const m=await f.json();h=m.error||m.message||h}catch{}return Promise.reject(new Error(h))}async send(t,i={}){var a,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,f={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(f.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:f,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(a=i.timeout)!==null&&a!==void 0?a:this.timeout);return await((o=m.body)===null||o===void 0?void 0:o.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,f,h;const m=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((h=(f=(d=this.params)===null||d===void 0?void 0:d.config)===null||f===void 0?void 0:f.broadcast)===null||h===void 0)&&h.ack)&&u("ok"),m.receive("ok",()=>u("ok")),m.receive("error",()=>u("error")),m.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Hn.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(cs.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(o=>{a=new Rf(this,cs.leave,{},t),a.receive("ok",()=>{i(),o("ok")}).receive("timeout",()=>{i(),o("timed out")}).receive("error",()=>{o("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Hn.closed,this.bindings={}}async _fetchWithTimeout(t,i,a){const o=new AbortController,u=setTimeout(()=>o.abort(),a),d=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:o.signal}));return clearTimeout(u),d}_push(t,i,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Rf(this,t,i,a);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>OC){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(t,i,a){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,a){var o,u;const d=t.toLocaleLowerCase(),{close:f,error:h,leave:m,join:y}=cs;if(a&&[f,h,m,y].indexOf(d)>=0&&a!==this._joinRef())return;let x=this._onMessage(d,i,a);if(i&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(b=>{var _,C,S;return((_=b.filter)===null||_===void 0?void 0:_.event)==="*"||((S=(C=b.filter)===null||C===void 0?void 0:C.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===d}).map(b=>b.callback(x,a)):(u=this.bindings[d])===null||u===void 0||u.filter(b=>{var _,C,S,N,k,D;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in b){const L=b.id,$=(_=b.filter)===null||_===void 0?void 0:_.event;return L&&((C=i.ids)===null||C===void 0?void 0:C.includes(L))&&($==="*"||$?.toLocaleLowerCase()===((S=i.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const L=(k=(N=b?.filter)===null||N===void 0?void 0:N.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return L==="*"||L===((D=i?.event)===null||D===void 0?void 0:D.toLocaleLowerCase())}else return b.type.toLocaleLowerCase()===d}).map(b=>{if(typeof x=="object"&&"ids"in x){const _=x.data,{schema:C,table:S,commit_timestamp:N,type:k,errors:D}=_;x=Object.assign(Object.assign({},{schema:C,table:S,commit_timestamp:N,eventType:k,new:{},old:{},errors:D}),this._getPayloadRecords(_))}b.callback(x,a)})}_isClosed(){return this.state===Hn.closed}_isJoined(){return this.state===Hn.joined}_isJoining(){return this.state===Hn.joining}_isLeaving(){return this.state===Hn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,a){const o=t.toLocaleLowerCase(),u={type:o,filter:i,callback:a};return this.bindings[o]?this.bindings[o].push(u):this.bindings[o]=[u],this}_off(t,i){const a=t.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(o=>{var u;return!(((u=o.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===a&&yl.isEqual(o.filter,i))})),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(t[a]!==i[a])return!1;return!0}static isFilterValueEqual(t,i){return(t??void 0)===(i??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(cs.close,{},t)}_onError(t){this._on(cs.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Hn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=yx(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=yx(t.columns,t.old_record)),i}}const Of=()=>{},ju={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},$C=[1e3,2e3,5e3,1e4],PC=1e4,qC=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class FC{constructor(t,i){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=gp,this.transport=null,this.heartbeatIntervalMs=ju.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Of,this.ref=0,this.reconnectTimer=null,this.vsn=gx,this.logger=Of,this.conn=null,this.sendBuffer=[],this.serializer=new DC,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...u)=>o(...u):(...u)=>fetch(...u),!(!((a=i?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${t}/${yp.websocket}`,this.httpEndpoint=Sb(t),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=EC.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const i=t.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,i??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,i,a){this.logger(t,i,a)}connectionState(){switch(this.conn&&this.conn.readyState){case ki.connecting:return da.Connecting;case ki.open:return da.Open;case ki.closing:return da.Closing;default:return da.Closed}}isConnected(){return this.connectionState()===da.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,i={config:{}}){const a=`realtime:${t}`,o=this.getChannels().find(u=>u.topic===a);if(o)return o;{const u=new yl(`realtime:${t}`,i,this);return this.channels.push(u),u}}push(t){const{topic:i,event:a,payload:o,ref:u}=t,d=()=>{this.encode(t,f=>{var h;(h=this.conn)===null||h===void 0||h.send(f)})};this.log("push",`${i} ${a} (${u})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(RC,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},ju.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply")try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error")}catch(m){this.log("error","error in heartbeat callback",m)}i.ref&&i.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:a,event:o,payload:u,ref:d}=i,f=d?`(${d})`:"",h=u.status||"";this.log("receive",`${h} ${a} ${o} ${f}`.trim(),u),this.channels.filter(m=>m._isMember(a)).forEach(m=>m._trigger(o,u,d)),this._triggerStateCallbacks("message",i)})}_clearTimer(t){var i;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===ki.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ki.open||this.conn.readyState===ki.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(i=>{this.log("error","error waiting for auth on connect",i),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this._terminateWorker()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var i;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(cs.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const a=t.match(/\?/)?"&":"?",o=new URLSearchParams(i);return`${t}${a}${o}`}_workerObjectUrl(t){let i;if(t)i=t;else{const a=new Blob([qC],{type:"application/javascript"});i=URL.createObjectURL(a)}return i}_setConnectionState(t,i=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(t=null){let i,a=!1;if(t)i=t,a=!0;else if(this.accessToken)try{i=await this.accessToken()}catch(o){this.log("error","Error fetching access token from callback",o),i=this.accessTokenValue}else i=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(o=>{const u={access_token:i,version:TC};i&&o.updateJoinPayload(u),o.joinedOnce&&o._isJoined()&&o._push(cs.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(i=>{this.log("error",`Error setting auth in ${t}`,i)})}_triggerStateCallbacks(t,i){try{this.stateChangeCallbacks[t].forEach(a=>{try{a(i)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(a){this.log("error",`error triggering ${t} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new bb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ju.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var i,a,o,u,d,f,h,m,y,v,x,b;switch(this.transport=(i=t?.transport)!==null&&i!==void 0?i:null,this.timeout=(a=t?.timeout)!==null&&a!==void 0?a:gp,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:ju.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(f=t?.heartbeatCallback)!==null&&f!==void 0?f:Of,this.vsn=(h=t?.vsn)!==null&&h!==void 0?h:gx,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=t?.reconnectAfterMs)!==null&&m!==void 0?m:(_=>$C[_-1]||PC),this.vsn){case xb:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((_,C)=>C(JSON.stringify(_))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((_,C)=>C(JSON.parse(_)));break;case AC:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(b=t?.decode)!==null&&b!==void 0?b:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var Yo=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function HC(n,t,i){const a=new URL(t,n);if(i)for(const[o,u]of Object.entries(i))u!==void 0&&a.searchParams.set(o,u);return a.toString()}async function VC(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function GC(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:i,path:a,query:o,body:u,headers:d}){const f=HC(n.baseUrl,a,o),h=await VC(n.auth),m=await t(f,{method:i,headers:{...u?{"Content-Type":"application/json"}:{},...h,...d},body:u?JSON.stringify(u):void 0}),y=await m.text(),v=(m.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!m.ok){const b=v?x:void 0,_=b?.error;throw new Yo(_?.message??`Request failed with status ${m.status}`,{status:m.status,icebergType:_?.type,icebergCode:_?.code,details:b})}return{status:m.status,headers:m.headers,data:x}}}}function _u(n){return n.join("")}var KC=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:_u(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(n,t){const i={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:i})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${_u(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${_u(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${_u(n.namespace)}`}),!0}catch(t){if(t instanceof Yo&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(i){if(i instanceof Yo&&i.status===409)return;throw i}}};function tl(n){return n.join("")}var YC=class{constructor(n,t="",i){this.client=n,this.prefix=t,this.accessDelegation=i}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const i={};return this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables`,body:t,headers:i})).data.metadata}async updateTable(n,t){const i=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":i.data["metadata-location"],metadata:i.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(i){if(i instanceof Yo&&i.status===404)return!1;throw i}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(i){if(i instanceof Yo&&i.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw i}}},WC=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const i=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=GC({baseUrl:i,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new KC(this.client,t),this.tableOps=new YC(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},gd=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function Tn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var QC=class extends gd{constructor(n,t,i){super(n),this.name="StorageApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},xp=class extends gd{constructor(n,t){super(n),this.name="StorageUnknownError",this.originalError=t}};const Jp=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),JC=()=>Response,bp=n=>{if(Array.isArray(n))return n.map(i=>bp(i));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([i,a])=>{const o=i.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[o]=bp(a)}),t},XC=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},ZC=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Wo(n){"@babel/helpers - typeof";return Wo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wo(n)}function eN(n,t){if(Wo(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(Wo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function tN(n){var t=eN(n,"string");return Wo(t)=="symbol"?t:t+""}function nN(n,t,i){return(t=tN(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function bx(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function At(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?bx(Object(i),!0).forEach(function(a){nN(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):bx(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}const Df=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},rN=async(n,t,i)=>{n instanceof await JC()&&!i?.noResolveJson?n.json().then(a=>{const o=n.status||500,u=a?.statusCode||o+"";t(new QC(Df(a),o,u))}).catch(a=>{t(new xp(Df(a),a))}):t(new xp(Df(n),n))},sN=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"||!a?o:(XC(a)?(o.headers=At({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,t?.duplex&&(o.duplex=t.duplex),At(At({},o),i))};async function dc(n,t,i,a,o,u){return new Promise((d,f)=>{n(i,sN(t,a,o,u)).then(h=>{if(!h.ok)throw h;return a?.noResolveJson?h:h.json()}).then(h=>d(h)).catch(h=>rN(h,f,a))})}async function Qo(n,t,i,a){return dc(n,"GET",t,i,a)}async function os(n,t,i,a,o){return dc(n,"POST",t,a,o,i)}async function wp(n,t,i,a,o){return dc(n,"PUT",t,a,o,i)}async function iN(n,t,i,a){return dc(n,"HEAD",t,At(At({},i),{},{noResolveJson:!0}),a)}async function Xp(n,t,i,a,o){return dc(n,"DELETE",t,a,o,i)}var aN=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Tn(t))return{data:null,error:t};throw t}}};let jb;jb=Symbol.toStringTag;var lN=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[jb]="BlobDownloadBuilder",this.promise=null}asStream(){return new aN(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Tn(t))return{data:null,error:t};throw t}}};const oN={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},wx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var cN=class{constructor(n,t={},i,a){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.bucketId=i,this.fetch=Jp(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,t,i,a){var o=this;try{let u;const d=At(At({},wx),a);let f=At(At({},o.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const h=d.metadata;typeof Blob<"u"&&i instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),h&&u.append("metadata",o.encodeMetadata(h)),u.append("",i)):typeof FormData<"u"&&i instanceof FormData?(u=i,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),h&&!u.has("metadata")&&u.append("metadata",o.encodeMetadata(h))):(u=i,f["cache-control"]=`max-age=${d.cacheControl}`,f["content-type"]=d.contentType,h&&(f["x-metadata"]=o.toBase64(o.encodeMetadata(h))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),a?.headers&&(f=At(At({},f),a.headers));const m=o._removeEmptyFolders(t),y=o._getFinalPath(m),v=await(n=="PUT"?wp:os)(o.fetch,`${o.url}/object/${y}`,u,At({headers:f},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:m,id:v.Id,fullPath:v.Key},error:null}}catch(u){if(o.shouldThrowOnError)throw u;if(Tn(u))return{data:null,error:u};throw u}}async upload(n,t,i){return this.uploadOrUpdate("POST",n,t,i)}async uploadToSignedUrl(n,t,i,a){var o=this;const u=o._removeEmptyFolders(n),d=o._getFinalPath(u),f=new URL(o.url+`/object/upload/sign/${d}`);f.searchParams.set("token",t);try{let h;const m=At({upsert:wx.upsert},a),y=At(At({},o.headers),{"x-upsert":String(m.upsert)});return typeof Blob<"u"&&i instanceof Blob?(h=new FormData,h.append("cacheControl",m.cacheControl),h.append("",i)):typeof FormData<"u"&&i instanceof FormData?(h=i,h.append("cacheControl",m.cacheControl)):(h=i,y["cache-control"]=`max-age=${m.cacheControl}`,y["content-type"]=m.contentType),{data:{path:u,fullPath:(await wp(o.fetch,f.toString(),h,{headers:y})).Key},error:null}}catch(h){if(o.shouldThrowOnError)throw h;if(Tn(h))return{data:null,error:h};throw h}}async createSignedUploadUrl(n,t){var i=this;try{let a=i._getFinalPath(n);const o=At({},i.headers);t?.upsert&&(o["x-upsert"]="true");const u=await os(i.fetch,`${i.url}/object/upload/sign/${a}`,{},{headers:o}),d=new URL(i.url+u.url),f=d.searchParams.get("token");if(!f)throw new gd("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:f},error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Tn(a))return{data:null,error:a};throw a}}async update(n,t,i){return this.uploadOrUpdate("PUT",n,t,i)}async move(n,t,i){var a=this;try{return{data:await os(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:a.headers}),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Tn(o))return{data:null,error:o};throw o}}async copy(n,t,i){var a=this;try{return{data:{path:(await os(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:a.headers})).Key},error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Tn(o))return{data:null,error:o};throw o}}async createSignedUrl(n,t,i){var a=this;try{let o=a._getFinalPath(n),u=await os(a.fetch,`${a.url}/object/sign/${o}`,At({expiresIn:t},i?.transform?{transform:i.transform}:{}),{headers:a.headers});const d=i?.download?`&download=${i.download===!0?"":i.download}`:"";return u={signedUrl:encodeURI(`${a.url}${u.signedURL}${d}`)},{data:u,error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Tn(o))return{data:null,error:o};throw o}}async createSignedUrls(n,t,i){var a=this;try{const o=await os(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:t,paths:n},{headers:a.headers}),u=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:o.map(d=>At(At({},d),{},{signedUrl:d.signedURL?encodeURI(`${a.url}${d.signedURL}${u}`):null})),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Tn(o))return{data:null,error:o};throw o}}download(n,t){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(t?.transform||{}),o=a?`?${a}`:"",u=this._getFinalPath(n),d=()=>Qo(this.fetch,`${this.url}/${i}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new lN(d,this.shouldThrowOnError)}async info(n){var t=this;const i=t._getFinalPath(n);try{return{data:bp(await Qo(t.fetch,`${t.url}/object/info/${i}`,{headers:t.headers})),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Tn(a))return{data:null,error:a};throw a}}async exists(n){var t=this;const i=t._getFinalPath(n);try{return await iN(t.fetch,`${t.url}/object/${i}`,{headers:t.headers}),{data:!0,error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Tn(a)&&a instanceof xp){const o=a.originalError;if([400,404].includes(o?.status))return{data:!1,error:a}}throw a}}getPublicUrl(n,t){const i=this._getFinalPath(n),a=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&a.push(o);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&a.push(d);let f=a.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${i}${f}`)}}}async remove(n){var t=this;try{return{data:await Xp(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Tn(i))return{data:null,error:i};throw i}}async list(n,t,i){var a=this;try{const o=At(At(At({},oN),t),{},{prefix:n||""});return{data:await os(a.fetch,`${a.url}/object/list/${a.bucketId}`,o,{headers:a.headers},i),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Tn(o))return{data:null,error:o};throw o}}async listV2(n,t){var i=this;try{const a=At({},n);return{data:await os(i.fetch,`${i.url}/object/list-v2/${i.bucketId}`,a,{headers:i.headers},t),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Tn(a))return{data:null,error:a};throw a}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const _b="2.89.0",Cb={"X-Client-Info":`storage-js/${_b}`};var uN=class{constructor(n,t={},i,a){this.shouldThrowOnError=!1;const o=new URL(n);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=At(At({},Cb),t),this.fetch=Jp(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var t=this;try{const i=t.listBucketOptionsToQueryString(n);return{data:await Qo(t.fetch,`${t.url}/bucket${i}`,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Tn(i))return{data:null,error:i};throw i}}async getBucket(n){var t=this;try{return{data:await Qo(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Tn(i))return{data:null,error:i};throw i}}async createBucket(n,t={public:!1}){var i=this;try{return{data:await os(i.fetch,`${i.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Tn(a))return{data:null,error:a};throw a}}async updateBucket(n,t){var i=this;try{return{data:await wp(i.fetch,`${i.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Tn(a))return{data:null,error:a};throw a}}async emptyBucket(n){var t=this;try{return{data:await os(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Tn(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await Xp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Tn(i))return{data:null,error:i};throw i}}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},dN=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=At(At({},Cb),t),this.fetch=Jp(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await os(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Tn(i))return{data:null,error:i};throw i}}async listBuckets(n){var t=this;try{const i=new URLSearchParams;n?.limit!==void 0&&i.set("limit",n.limit.toString()),n?.offset!==void 0&&i.set("offset",n.offset.toString()),n?.sortColumn&&i.set("sortColumn",n.sortColumn),n?.sortOrder&&i.set("sortOrder",n.sortOrder),n?.search&&i.set("search",n.search);const a=i.toString(),o=a?`${t.url}/bucket?${a}`:`${t.url}/bucket`;return{data:await Qo(t.fetch,o,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Tn(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await Xp(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Tn(i))return{data:null,error:i};throw i}}from(n){var t=this;if(!ZC(n))throw new gd("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const i=new WC({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(i,{get(o,u){const d=o[u];return typeof d!="function"?d:async(...f)=>{try{return{data:await d.apply(o,f),error:null}}catch(h){if(a)throw h;return{data:null,error:h}}}}})}};const Zp={"X-Client-Info":`storage-js/${_b}`,"Content-Type":"application/json"};var Nb=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Or(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var Mf=class extends Nb{constructor(n,t,i){super(n),this.name="StorageVectorsApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},hN=class extends Nb{constructor(n,t){super(n),this.name="StorageVectorsUnknownError",this.originalError=t}};const em=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),fN=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Sx=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),pN=async(n,t,i)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!i?.noResolveJson){const a=n.status||500,o=n;if(typeof o.json=="function")o.json().then(u=>{const d=u?.statusCode||u?.code||a+"";t(new Mf(Sx(u),a,d))}).catch(()=>{const u=a+"";t(new Mf(o.statusText||`HTTP ${a} error`,a,u))});else{const u=a+"";t(new Mf(o.statusText||`HTTP ${a} error`,a,u))}}else t(new hN(Sx(n),n))},mN=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return a?(fN(a)?(o.headers=At({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,At(At({},o),i)):o};async function gN(n,t,i,a,o,u){return new Promise((d,f)=>{n(i,mN(t,a,o,u)).then(h=>{if(!h.ok)throw h;if(a?.noResolveJson)return h;const m=h.headers.get("content-type");return!m||!m.includes("application/json")?{}:h.json()}).then(h=>d(h)).catch(h=>pN(h,f,a))})}async function Dr(n,t,i,a,o){return gN(n,"POST",t,a,o,i)}var yN=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=At(At({},Zp),t),this.fetch=em(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async getIndex(n,t){var i=this;try{return{data:await Dr(i.fetch,`${i.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Or(a))return{data:null,error:a};throw a}}async listIndexes(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async deleteIndex(n,t){var i=this;try{return{data:await Dr(i.fetch,`${i.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:i.headers})||{},error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Or(a))return{data:null,error:a};throw a}}},vN=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=At(At({},Zp),t),this.fetch=em(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var t=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Dr(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async getVectors(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async listVectors(n){var t=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await Dr(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async queryVectors(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async deleteVectors(n){var t=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Dr(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}},xN=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=At(At({},Zp),t),this.fetch=em(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async getBucket(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async listBuckets(n={}){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}},bN=class extends xN{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new wN(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,i=this;return t().call(i,n)}async getBucket(n){var t=()=>super.getBucket,i=this;return t().call(i,n)}async listBuckets(n={}){var t=()=>super.listBuckets,i=this;return t().call(i,n)}async deleteBucket(n){var t=()=>super.deleteBucket,i=this;return t().call(i,n)}},wN=class extends yN{constructor(n,t,i,a){super(n,t,a),this.vectorBucketName=i}async createIndex(n){var t=()=>super.createIndex,i=this;return t().call(i,At(At({},n),{},{vectorBucketName:i.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,i=this;return t().call(i,At(At({},n),{},{vectorBucketName:i.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,i=this;return t().call(i,i.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,i=this;return t().call(i,i.vectorBucketName,n)}index(n){return new SN(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},SN=class extends vN{constructor(n,t,i,a,o){super(n,t,o),this.vectorBucketName=i,this.indexName=a}async putVectors(n){var t=()=>super.putVectors,i=this;return t().call(i,At(At({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async getVectors(n){var t=()=>super.getVectors,i=this;return t().call(i,At(At({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,i=this;return t().call(i,At(At({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,i=this;return t().call(i,At(At({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,i=this;return t().call(i,At(At({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}},jN=class extends uN{constructor(n,t={},i,a){super(n,t,i,a)}from(n){return new cN(this.url,this.headers,n,this.fetch)}get vectors(){return new bN(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new dN(this.url+"/iceberg",this.headers,this.fetch)}};const Eb="2.89.0",pl=30*1e3,Sp=3,zf=Sp*pl,_N="http://localhost:9999",CN="supabase.auth.token",NN={"X-Client-Info":`gotrue-js/${Eb}`},jp="X-Supabase-Api-Version",kb={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},EN=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,kN=600*1e3;class Jo extends Error{constructor(t,i,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=a}}function yt(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class TN extends Jo{constructor(t,i,a){super(t,i,a),this.name="AuthApiError",this.status=i,this.code=a}}function AN(n){return yt(n)&&n.name==="AuthApiError"}class ha extends Jo{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class Ys extends Jo{constructor(t,i,a,o){super(t,a,o),this.name=i,this.status=a}}class Ar extends Ys{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function RN(n){return yt(n)&&n.name==="AuthSessionMissingError"}class nl extends Ys{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Cu extends Ys{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Nu extends Ys{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ON(n){return yt(n)&&n.name==="AuthImplicitGrantRedirectError"}class jx extends Ys{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class DN extends Ys{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class _p extends Ys{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function Lf(n){return yt(n)&&n.name==="AuthRetryableFetchError"}class _x extends Ys{constructor(t,i,a){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=a}}class Cp extends Ys{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Qu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Cx=` 	
\r=`.split(""),MN=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<Cx.length;t+=1)n[Cx[t].charCodeAt(0)]=-2;for(let t=0;t<Qu.length;t+=1)n[Qu[t].charCodeAt(0)]=t;return n})();function Nx(n,t,i){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;i(Qu[a]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;i(Qu[a]),t.queuedBits-=6}}function Tb(n,t,i){const a=MN[n];if(a>-1)for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)i(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Ex(n){const t=[],i=d=>{t.push(String.fromCodePoint(d))},a={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},u=d=>{UN(d,a,i)};for(let d=0;d<n.length;d+=1)Tb(n.charCodeAt(d),o,u);return t.join("")}function zN(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function LN(n,t){for(let i=0;i<n.length;i+=1){let a=n.charCodeAt(i);if(a>55295&&a<=56319){const o=(a-55296)*1024&65535;a=(n.charCodeAt(i+1)-56320&65535|o)+65536,i+=1}zN(a,t)}}function UN(n,t,i){if(t.utf8seq===0){if(n<=127){i(n);return}for(let a=1;a<6;a+=1)if((n>>7-a&1)===0){t.utf8seq=a;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&i(t.codepoint)}}function bl(n){const t=[],i={queue:0,queuedBits:0},a=o=>{t.push(o)};for(let o=0;o<n.length;o+=1)Tb(n.charCodeAt(o),i,a);return new Uint8Array(t)}function IN(n){const t=[];return LN(n,i=>t.push(i)),new Uint8Array(t)}function ma(n){const t=[],i={queue:0,queuedBits:0},a=o=>{t.push(o)};return n.forEach(o=>Nx(o,i,a)),Nx(null,i,a),t.join("")}function BN(n){return Math.round(Date.now()/1e3)+n}function $N(){return Symbol("auth-callback")}const sr=()=>typeof window<"u"&&typeof document<"u",ra={tested:!1,writable:!1},Ab=()=>{if(!sr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ra.tested)return ra.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ra.tested=!0,ra.writable=!0}catch{ra.tested=!0,ra.writable=!1}return ra.writable};function PN(n){const t={},i=new URL(n);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((o,u)=>{t[u]=o})}catch{}return i.searchParams.forEach((a,o)=>{t[o]=a}),t}const Rb=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),qN=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",ml=async(n,t,i)=>{await n.setItem(t,JSON.stringify(i))},sa=async(n,t)=>{const i=await n.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},rr=async(n,t)=>{await n.removeItem(t)};class yd{constructor(){this.promise=new yd.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}yd.promiseConstructor=Promise;function Uf(n){const t=n.split(".");if(t.length!==3)throw new Cp("Invalid JWT structure");for(let a=0;a<t.length;a++)if(!EN.test(t[a]))throw new Cp("JWT not in base64url format");return{header:JSON.parse(Ex(t[0])),payload:JSON.parse(Ex(t[1])),signature:bl(t[2]),raw:{header:t[0],payload:t[1]}}}async function FN(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function HN(n,t){return new Promise((a,o)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){a(d);return}}catch(d){if(!t(u,d)){o(d);return}}})()})}function VN(n){return("0"+n.toString(16)).substr(-2)}function GN(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=i.length;let o="";for(let u=0;u<56;u++)o+=i.charAt(Math.floor(Math.random()*a));return o}return crypto.getRandomValues(t),Array.from(t,VN).join("")}async function KN(n){const i=new TextEncoder().encode(n),a=await crypto.subtle.digest("SHA-256",i),o=new Uint8Array(a);return Array.from(o).map(u=>String.fromCharCode(u)).join("")}async function YN(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const i=await KN(n);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function rl(n,t,i=!1){const a=GN();let o=a;i&&(o+="/PASSWORD_RECOVERY"),await ml(n,`${t}-code-verifier`,o);const u=await YN(a);return[u,a===u?"plain":"s256"]}const WN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function QN(n){const t=n.headers.get(jp);if(!t||!t.match(WN))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function JN(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function XN(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ZN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function sl(n){if(!ZN.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function If(){const n={};return new Proxy(n,{get:(t,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const a=i.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function eE(n,t){return new Proxy(n,{get:(i,a,o)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const u=a.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(i,a,o)}return!t.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(i,a,o)}})}function kx(n){return JSON.parse(JSON.stringify(n))}const ua=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),tE=[502,503,504];async function Tx(n){var t;if(!qN(n))throw new _p(ua(n),0);if(tE.includes(n.status))throw new _p(ua(n),n.status);let i;try{i=await n.json()}catch(u){throw new ha(ua(u),u)}let a;const o=QN(n);if(o&&o.getTime()>=kb["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?a=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(a=i.error_code),a){if(a==="weak_password")throw new _x(ua(i),n.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new Ar}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new _x(ua(i),n.status,i.weak_password.reasons);throw new TN(ua(i),n.status||500,a)}const nE=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(a),Object.assign(Object.assign({},o),i))};async function Tt(n,t,i,a){var o;const u=Object.assign({},a?.headers);u[jp]||(u[jp]=kb["2024-01-01"].name),a?.jwt&&(u.Authorization=`Bearer ${a.jwt}`);const d=(o=a?.query)!==null&&o!==void 0?o:{};a?.redirectTo&&(d.redirect_to=a.redirectTo);const f=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",h=await rE(n,t,i+f,{headers:u,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(h):{data:Object.assign({},h),error:null}}async function rE(n,t,i,a,o,u){const d=nE(t,a,o,u);let f;try{f=await n(i,Object.assign({},d))}catch(h){throw console.error(h),new _p(ua(h),0)}if(f.ok||await Tx(f),a?.noResolveJson)return f;try{return await f.json()}catch(h){await Tx(h)}}function is(n){var t;let i=null;aE(n)&&(i=Object.assign({},n),n.expires_at||(i.expires_at=BN(n.expires_in)));const a=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:i,user:a},error:null}}function Ax(n){const t=is(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0)&&(t.data.weak_password=n.weak_password),t}function Ai(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function sE(n){return{data:n,error:null}}function iE(n){const{action_link:t,email_otp:i,hashed_token:a,redirect_to:o,verification_type:u}=n,d=md(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:t,email_otp:i,hashed_token:a,redirect_to:o,verification_type:u},h=Object.assign({},d);return{data:{properties:f,user:h},error:null}}function Rx(n){return n}function aE(n){return n.access_token&&n.refresh_token&&n.expires_in}const Bf=["global","local","others"];class lE{constructor({url:t="",headers:i={},fetch:a}){this.url=t,this.headers=i,this.fetch=Rb(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,i=Bf[0]){if(Bf.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Bf.join(", ")}`);try{return await Tt(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(yt(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,i={}){try{return await Tt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:Ai})}catch(a){if(yt(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:i}=t,a=md(t,["options"]),o=Object.assign(Object.assign({},a),i);return"newEmail"in a&&(o.new_email=a?.newEmail,delete o.newEmail),await Tt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:iE,redirectTo:i?.redirectTo})}catch(i){if(yt(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await Tt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ai})}catch(i){if(yt(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,a,o,u,d,f,h;try{const m={nextPage:null,lastPage:0,total:0},y=await Tt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:Rx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,b=(h=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&h!==void 0?h:[];return b.length>0&&(b.forEach(_=>{const C=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(_.split(";")[1].split("=")[1]);m[`${S}Page`]=C}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(yt(m))return{data:{users:[]},error:m};throw m}}async getUserById(t){sl(t);try{return await Tt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ai})}catch(i){if(yt(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){sl(t);try{return await Tt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:Ai})}catch(a){if(yt(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,i=!1){sl(t);try{return await Tt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:Ai})}catch(a){if(yt(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){sl(t.userId);try{const{data:i,error:a}=await Tt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:i,error:a}}catch(i){if(yt(i))return{data:null,error:i};throw i}}async _deleteFactor(t){sl(t.userId),sl(t.id);try{return{data:await Tt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(yt(i))return{data:null,error:i};throw i}}async _listOAuthClients(t){var i,a,o,u,d,f,h;try{const m={nextPage:null,lastPage:0,total:0},y=await Tt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:Rx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,b=(h=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&h!==void 0?h:[];return b.length>0&&(b.forEach(_=>{const C=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(_.split(";")[1].split("=")[1]);m[`${S}Page`]=C}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(yt(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(t){try{return await Tt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(yt(i))return{data:null,error:i};throw i}}async _getOAuthClient(t){try{return await Tt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(yt(i))return{data:null,error:i};throw i}}async _updateOAuthClient(t,i){try{return await Tt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:i,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(yt(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(t){try{return await Tt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(i){if(yt(i))return{data:null,error:i};throw i}}async _regenerateOAuthClientSecret(t){try{return await Tt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(yt(i))return{data:null,error:i};throw i}}}function Ox(n={}){return{getItem:t=>n[t]||null,setItem:(t,i)=>{n[t]=i},removeItem:t=>{delete n[t]}}}const il={debug:!!(globalThis&&Ab()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Ob extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class oE extends Ob{}async function cE(n,t,i){il.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const a=new globalThis.AbortController;return t>0&&setTimeout(()=>{a.abort(),il.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async o=>{if(o){il.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await i()}finally{il.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(t===0)throw il.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new oE(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(il.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}function uE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Db(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function dE(n){return parseInt(n,16)}function hE(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,a=>a.toString(16).padStart(2,"0")).join("")}function fE(n){var t;const{chainId:i,domain:a,expirationTime:o,issuedAt:u=new Date,nonce:d,notBefore:f,requestId:h,resources:m,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const b=Db(n.address),_=y?`${y}://${a}`:a,C=n.statement?`${n.statement}
`:"",S=`${_} wants you to sign in with your Ethereum account:
${b}

${C}`;let N=`URI: ${v}
Version: ${x}
Chain ID: ${i}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(o&&(N+=`
Expiration Time: ${o.toISOString()}`),f&&(N+=`
Not Before: ${f.toISOString()}`),h&&(N+=`
Request ID: ${h}`),m){let k=`
Resources:`;for(const D of m){if(!D||typeof D!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${D}`);k+=`
- ${D}`}N+=k}return`${S}
${N}`}class qn extends Error{constructor({message:t,code:i,cause:a,name:o}){var u;super(t,{cause:a}),this.__isWebAuthnError=!0,this.name=(u=o??(a instanceof Error?a.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=i}}class Ju extends qn{constructor(t,i){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i,message:t}),this.name="WebAuthnUnknownError",this.originalError=i}}function pE({error:n,options:t}){var i,a,o;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new qn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((i=u.authenticatorSelection)===null||i===void 0?void 0:i.requireResidentKey)===!0)return new qn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((a=u.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new qn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((o=u.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new qn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new qn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new qn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(f=>f.type==="public-key").length===0?new qn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new qn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(Mb(d)){if(u.rp.id!==d)return new qn({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new qn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new qn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new qn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new qn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function mE({error:n,options:t}){const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new qn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new qn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const a=window.location.hostname;if(Mb(a)){if(i.rpId!==a)return new qn({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new qn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new qn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new qn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class gE{createNewAbortSignal(){if(this.controller){const i=new Error("Cancelling existing WebAuthn API call for new one");i.name="AbortError",this.controller.abort(i)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const yE=new gE;function vE(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:i,excludeCredentials:a}=n,o=md(n,["challenge","user","excludeCredentials"]),u=bl(t).buffer,d=Object.assign(Object.assign({},i),{id:bl(i.id).buffer}),f=Object.assign(Object.assign({},o),{challenge:u,user:d});if(a&&a.length>0){f.excludeCredentials=new Array(a.length);for(let h=0;h<a.length;h++){const m=a[h];f.excludeCredentials[h]=Object.assign(Object.assign({},m),{id:bl(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return f}function xE(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:i}=n,a=md(n,["challenge","allowCredentials"]),o=bl(t).buffer,u=Object.assign(Object.assign({},a),{challenge:o});if(i&&i.length>0){u.allowCredentials=new Array(i.length);for(let d=0;d<i.length;d++){const f=i[d];u.allowCredentials[d]=Object.assign(Object.assign({},f),{id:bl(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function bE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const i=n;return{id:n.id,rawId:n.id,response:{attestationObject:ma(new Uint8Array(n.response.attestationObject)),clientDataJSON:ma(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function wE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const i=n,a=n.getClientExtensionResults(),o=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:ma(new Uint8Array(o.authenticatorData)),clientDataJSON:ma(new Uint8Array(o.clientDataJSON)),signature:ma(new Uint8Array(o.signature)),userHandle:o.userHandle?ma(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Mb(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Dx(){var n,t;return!!(sr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function SE(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Ju("Browser returned unexpected credential type",t)}:{data:null,error:new Ju("Empty credential response",t)}}catch(t){return{data:null,error:pE({error:t,options:n})}}}async function jE(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Ju("Browser returned unexpected credential type",t)}:{data:null,error:new Ju("Empty credential response",t)}}catch(t){return{data:null,error:mE({error:t,options:n})}}}const _E={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},CE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Xu(...n){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),i=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),a={};for(const o of n)if(o)for(const u in o){const d=o[u];if(d!==void 0)if(Array.isArray(d))a[u]=d;else if(i(d))a[u]=d;else if(t(d)){const f=a[u];t(f)?a[u]=Xu(f,d):a[u]=Xu(d)}else a[u]=d}return a}function NE(n,t){return Xu(_E,n,t||{})}function EE(n,t){return Xu(CE,n,t||{})}class kE{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:i,friendlyName:a,signal:o},u){try{const{data:d,error:f}=await this.client.mfa.challenge({factorId:t,webauthn:i});if(!d)return{data:null,error:f};const h=o??yE.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:m}=d.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${a}`),m.displayName||(m.displayName=m.name)}switch(d.webauthn.type){case"create":{const m=NE(d.webauthn.credential_options.publicKey,u?.create),{data:y,error:v}=await SE({publicKey:m,signal:h});return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}case"request":{const m=EE(d.webauthn.credential_options.publicKey,u?.request),{data:y,error:v}=await jE(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:m,signal:h}));return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}}}catch(d){return yt(d)?{data:null,error:d}:{data:null,error:new ha("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:i,webauthn:a}){return this.client.mfa.verify({factorId:i,challengeId:t,webauthn:a})}async _authenticate({factorId:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!i)return{data:null,error:new Jo("rpId is required for WebAuthn authentication")};try{if(!Dx())return{data:null,error:new ha("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this.challenge({factorId:t,webauthn:{rpId:i,rpOrigins:a},signal:o},{request:u});if(!d)return{data:null,error:f};const{webauthn:h}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:h.type,rpId:i,rpOrigins:a,credential_response:h.credential_response}})}catch(d){return yt(d)?{data:null,error:d}:{data:null,error:new ha("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!i)return{data:null,error:new Jo("rpId is required for WebAuthn registration")};try{if(!Dx())return{data:null,error:new ha("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:f};const{data:h,error:m}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:i,rpOrigins:a},signal:o},{create:u});return h?this._verify({factorId:d.id,challengeId:h.challengeId,webauthn:{rpId:i,rpOrigins:a,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:m}}catch(d){return yt(d)?{data:null,error:d}:{data:null,error:new ha("Unexpected error in register",d)}}}}uE();const TE={url:_N,storageKey:CN,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:NN,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Mx(n,t,i){return await i()}const al={};class Xo{get jwks(){var t,i;return(i=(t=al[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(t){al[this.storageKey]=Object.assign(Object.assign({},al[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,i;return(i=(t=al[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){al[this.storageKey]=Object.assign(Object.assign({},al[this.storageKey]),{cachedAt:t})}constructor(t){var i,a,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},TE),t);if(this.storageKey=u.storageKey,this.instanceID=(i=Xo.nextInstanceID[this.storageKey])!==null&&i!==void 0?i:0,Xo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&sr()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new lE({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=Rb(u.fetch),this.lock=u.lock||Mx,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:this.persistSession&&sr()&&(!((a=globalThis?.navigator)===null||a===void 0)&&a.locks)?this.lock=cE:this.lock=Mx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new kE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:Ab()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ox(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=Ox(this.memoryStorage)),sr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Eb}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let i={},a="none";if(sr()&&(i=PN(window.location.href),this._isImplicitGrantCallback(i)?a="implicit":await this._isPKCECallback(i)&&(a="pkce")),sr()&&this.detectSessionInUrl&&a!=="none"){const{data:o,error:u}=await this._getSessionFromURL(i,a);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),ON(u)){const h=(t=u.details)===null||t===void 0?void 0:t.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:d,redirectType:f}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",f),await this._saveSession(d),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return yt(i)?this._returnResult({error:i}):this._returnResult({error:new ha("Unexpected error during initialization",i)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,a,o;try{const u=await Tt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(i=t?.options)===null||i===void 0?void 0:i.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:is}),{data:d,error:f}=u;if(f||!d)return this._returnResult({data:{user:null,session:null},error:f});const h=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(u){if(yt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var i,a,o;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let b=null,_=null;this.flowType==="pkce"&&([b,_]=await rl(this.storage,this.storageKey)),u=await Tt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(i=x?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:b,code_challenge_method:_},xform:is})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await Tt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(a=x?.data)!==null&&a!==void 0?a:{},channel:(o=x?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:is})}else throw new Cu("You must provide either an email or phone number and a password");const{data:d,error:f}=u;if(f||!d)return await rr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:f});const h=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(u){if(await rr(this.storage,`${this.storageKey}-code-verifier`),yt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let i;if("email"in t){const{email:u,password:d,options:f}=t;i=await Tt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Ax})}else if("phone"in t){const{phone:u,password:d,options:f}=t;i=await Tt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Ax})}else throw new Cu("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!a||!a.session||!a.user){const u=new nl;return this._returnResult({data:{user:null,session:null},error:u})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:o})}catch(i){if(yt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOAuth(t){var i,a,o,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:i}=t;switch(i){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(t){var i,a,o,u,d,f,h,m,y,v,x;let b,_;if("message"in t)b=t.message,_=t.signature;else{const{chain:C,wallet:S,statement:N,options:k}=t;let D;if(sr())if(typeof S=="object")D=S;else{const M=window;if("ethereum"in M&&typeof M.ethereum=="object"&&"request"in M.ethereum&&typeof M.ethereum.request=="function")D=M.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!k?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");D=S}const L=new URL((i=k?.url)!==null&&i!==void 0?i:window.location.href),$=await D.request({method:"eth_requestAccounts"}).then(M=>M).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!$||$.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const E=Db($[0]);let A=(a=k?.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!A){const M=await D.request({method:"eth_chainId"});A=dE(M)}const R={domain:L.host,address:E,statement:N,uri:L.href,version:"1",chainId:A,nonce:(o=k?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(u=k?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(f=k?.signInWithEthereum)===null||f===void 0?void 0:f.expirationTime,notBefore:(h=k?.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(m=k?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(y=k?.signInWithEthereum)===null||y===void 0?void 0:y.resources};b=fE(R),_=await D.request({method:"personal_sign",params:[hE(b),E]})}try{const{data:C,error:S}=await Tt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:b,signature:_},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:is});if(S)throw S;if(!C||!C.session||!C.user){const N=new nl;return this._returnResult({data:{user:null,session:null},error:N})}return C.session&&(await this._saveSession(C.session),await this._notifyAllSubscribers("SIGNED_IN",C.session)),this._returnResult({data:Object.assign({},C),error:S})}catch(C){if(yt(C))return this._returnResult({data:{user:null,session:null},error:C});throw C}}async signInWithSolana(t){var i,a,o,u,d,f,h,m,y,v,x,b;let _,C;if("message"in t)_=t.message,C=t.signature;else{const{chain:S,wallet:N,statement:k,options:D}=t;let L;if(sr())if(typeof N=="object")L=N;else{const E=window;if("solana"in E&&typeof E.solana=="object"&&("signIn"in E.solana&&typeof E.solana.signIn=="function"||"signMessage"in E.solana&&typeof E.solana.signMessage=="function"))L=E.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!D?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");L=N}const $=new URL((i=D?.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in L&&L.signIn){const E=await L.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},D?.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),k?{statement:k}:null));let A;if(Array.isArray(E)&&E[0]&&typeof E[0]=="object")A=E[0];else if(E&&typeof E=="object"&&"signedMessage"in E&&"signature"in E)A=E;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)_=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),C=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in L)||typeof L.signMessage!="function"||!("publicKey"in L)||typeof L!="object"||!L.publicKey||!("toBase58"in L.publicKey)||typeof L.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${$.host} wants you to sign in with your Solana account:`,L.publicKey.toBase58(),...k?["",k,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(o=(a=D?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((u=D?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${D.signInWithSolana.notBefore}`]:[],...!((d=D?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${D.signInWithSolana.expirationTime}`]:[],...!((f=D?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${D.signInWithSolana.chainId}`]:[],...!((h=D?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${D.signInWithSolana.nonce}`]:[],...!((m=D?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${D.signInWithSolana.requestId}`]:[],...!((v=(y=D?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...D.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const E=await L.signMessage(new TextEncoder().encode(_),"utf8");if(!E||!(E instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");C=E}}try{const{data:S,error:N}=await Tt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:ma(C)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(b=t.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:is});if(N)throw N;if(!S||!S.session||!S.user){const k=new nl;return this._returnResult({data:{user:null,session:null},error:k})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:N})}catch(S){if(yt(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(t){const i=await sa(this.storage,`${this.storageKey}-code-verifier`),[a,o]=(i??"").split("/");try{if(!a&&this.flowType==="pkce")throw new DN;const{data:u,error:d}=await Tt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:is});if(await rr(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const f=new nl;return this._returnResult({data:{user:null,session:null,redirectType:null},error:f})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:o??null}),error:d})}catch(u){if(await rr(this.storage,`${this.storageKey}-code-verifier`),yt(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:i,provider:a,token:o,access_token:u,nonce:d}=t,f=await Tt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:o,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:is}),{data:h,error:m}=f;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!h||!h.session||!h.user){const y=new nl;return this._returnResult({data:{user:null,session:null},error:y})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:m})}catch(i){if(yt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOtp(t){var i,a,o,u,d;try{if("email"in t){const{email:f,options:h}=t;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await rl(this.storage,this.storageKey));const{error:v}=await Tt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(i=h?.data)!==null&&i!==void 0?i:{},create_user:(a=h?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:m,code_challenge_method:y},redirectTo:h?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:f,options:h}=t,{data:m,error:y}=await Tt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(o=h?.data)!==null&&o!==void 0?o:{},create_user:(u=h?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(d=h?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:y})}throw new Cu("You must provide either an email or phone number.")}catch(f){if(await rr(this.storage,`${this.storageKey}-code-verifier`),yt(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async verifyOtp(t){var i,a;try{let o,u;"options"in t&&(o=(i=t.options)===null||i===void 0?void 0:i.redirectTo,u=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:d,error:f}=await Tt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:o,xform:is});if(f)throw f;if(!d)throw new Error("An error occurred on token verification.");const h=d.session,m=d.user;return h?.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(o){if(yt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var i,a,o,u,d;try{let f=null,h=null;this.flowType==="pkce"&&([f,h]=await rl(this.storage,this.storageKey));const m=await Tt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&a!==void 0?a:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:h}),headers:this.headers,xform:sE});return!((u=m.data)===null||u===void 0)&&u.url&&sr()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(f){if(await rr(this.storage,`${this.storageKey}-code-verifier`),yt(f))return this._returnResult({data:null,error:f});throw f}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;if(a)throw a;if(!i)throw new Ar;const{error:o}=await Tt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(yt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:a,type:o,options:u}=t,{error:d}=await Tt(this.fetch,"POST",i,{headers:this.headers,body:{email:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:a,type:o,options:u}=t,{data:d,error:f}=await Tt(this.fetch,"POST",i,{headers:this.headers,body:{phone:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:f})}throw new Cu("You must provide either an email or phone number and a type")}catch(i){if(yt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await a,await i()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=i();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await sa(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at*1e3-Date.now()<zf:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.userStorage){const d=await sa(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=If()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=eE(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const i=await this._acquireLock(-1,async()=>await this._getUser());return i.data.user&&(this.suppressGetSessionWarning=!0),i}async _getUser(t){try{return t?await Tt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ai}):await this._useSession(async i=>{var a,o,u;const{data:d,error:f}=i;if(f)throw f;return!(!((a=d.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ar}:await Tt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:void 0,xform:Ai})})}catch(i){if(yt(i))return RN(i)&&(await this._removeSession(),await rr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:i});throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async a=>{const{data:o,error:u}=a;if(u)throw u;if(!o.session)throw new Ar;const d=o.session;let f=null,h=null;this.flowType==="pkce"&&t.email!=null&&([f,h]=await rl(this.storage,this.storageKey));const{data:m,error:y}=await Tt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:f,code_challenge_method:h}),jwt:d.access_token,xform:Ai});if(y)throw y;return d.user=m.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(a){if(await rr(this.storage,`${this.storageKey}-code-verifier`),yt(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ar;const i=Date.now()/1e3;let a=i,o=!0,u=null;const{payload:d}=Uf(t.access_token);if(d.exp&&(a=d.exp,o=a<=i),o){const{data:f,error:h}=await this._callRefreshToken(t.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!f)return{data:{user:null,session:null},error:null};u=f}else{const{data:f,error:h}=await this._getUser(t.access_token);if(h)throw h;u={access_token:t.access_token,refresh_token:t.refresh_token,user:f.user,token_type:"bearer",expires_in:a-i,expires_at:a},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(i){if(yt(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var a;if(!t){const{data:d,error:f}=i;if(f)throw f;t=(a=d.session)!==null&&a!==void 0?a:void 0}if(!t?.refresh_token)throw new Ar;const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(i){if(yt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async _getSessionFromURL(t,i){try{if(!sr())throw new Nu("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Nu(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new jx("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Nu("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new jx("No code detected.");const{data:k,error:D}=await this._exchangeCodeForSession(t.code);if(D)throw D;const L=new URL(window.location.href);return L.searchParams.delete("code"),window.history.replaceState(window.history.state,"",L.toString()),{data:{session:k.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:o,access_token:u,refresh_token:d,expires_in:f,expires_at:h,token_type:m}=t;if(!u||!f||!d||!m)throw new Nu("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(f);let x=y+v;h&&(x=parseInt(h));const b=x-y;b*1e3<=pl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${b}s, should have been closer to ${v}s`);const _=x-v;y-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,x,y):y-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,x,y);const{data:C,error:S}=await this._getUser(u);if(S)throw S;const N={provider_token:a,provider_refresh_token:o,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:m,user:C.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:N,redirectType:t.type},error:null})}catch(a){if(yt(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await sa(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({error:u});const d=(a=o.session)===null||a===void 0?void 0:a.access_token;if(d){const{error:f}=await this.admin.signOut(d,t);if(f&&!(AN(f)&&(f.status===404||f.status===401||f.status===403)))return this._returnResult({error:f})}return t!=="others"&&(await this._removeSession(),await rr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const i=$N(),a={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async i=>{var a,o;try{const{data:{session:u},error:d}=i;if(d)throw d;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,i={}){let a=null,o=null;this.flowType==="pkce"&&([a,o]=await rl(this.storage,this.storageKey,!0));try{return await Tt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:o,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(u){if(await rr(this.storage,`${this.storageKey}-code-verifier`),yt(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:i,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(i){if(yt(i))return this._returnResult({data:null,error:i});throw i}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var i;try{const{data:a,error:o}=await this._useSession(async u=>{var d,f,h,m,y;const{data:v,error:x}=u;if(x)throw x;const b=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(f=t.options)===null||f===void 0?void 0:f.scopes,queryParams:(h=t.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await Tt(this.fetch,"GET",b,{headers:this.headers,jwt:(y=(m=v.session)===null||m===void 0?void 0:m.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return sr()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(a?.url),this._returnResult({data:{provider:t.provider,url:a?.url},error:null})}catch(a){if(yt(a))return this._returnResult({data:{provider:t.provider,url:null},error:a});throw a}}async linkIdentityIdToken(t){return await this._useSession(async i=>{var a;try{const{error:o,data:{session:u}}=i;if(o)throw o;const{options:d,provider:f,token:h,access_token:m,nonce:y}=t,v=await Tt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=u?.access_token)!==null&&a!==void 0?a:void 0,body:{provider:f,id_token:h,access_token:m,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:is}),{data:x,error:b}=v;return b?this._returnResult({data:{user:null,session:null},error:b}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new nl}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:b}))}catch(o){if(await rr(this.storage,`${this.storageKey}-code-verifier`),yt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async i=>{var a,o;const{data:u,error:d}=i;if(d)throw d;return await Tt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(a=u.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0})})}catch(i){if(yt(i))return this._returnResult({data:null,error:i});throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const a=Date.now();return await HN(async o=>(o>0&&await FN(200*Math.pow(2,o-1)),this._debug(i,"refreshing attempt",o),await Tt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:is})),(o,u)=>{const d=200*Math.pow(2,o);return u&&Lf(u)&&Date.now()+d-a<pl})}catch(a){if(this._debug(i,"error",a),yt(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",a),sr()&&!i.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t,i;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const o=await sa(this.storage,this.storageKey);if(o&&this.userStorage){let d=await sa(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await ml(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d?.user)!==null&&t!==void 0?t:If()}else if(o&&!o.user&&!o.user){const d=await sa(this.storage,this.storageKey+"-user");d&&d?.user?(o.user=d.user,await rr(this.storage,this.storageKey+"-user"),await ml(this.storage,this.storageKey,o)):o.user=If()}if(this._debug(a,"session from storage",o),!this._isValidSession(o)){this._debug(a,"session is not valid"),o!==null&&await this._removeSession();return}const u=((i=o.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<zf;if(this._debug(a,`session has${u?"":" not"} expired with margin of ${zf}s`),u){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),Lf(d)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:f}=await this._getUser(o.access_token);!f&&d?.user?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(a,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(a,"error",o),console.error(o);return}finally{this._debug(a,"end")}}async _callRefreshToken(t){var i,a;if(!t)throw new Ar;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new yd;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new Ar;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const f={data:u.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(u){if(this._debug(o,"error",u),yt(u)){const d={data:null,error:u};return Lf(u)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(d),d}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(u),u}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,i,a=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",i,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:i});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(t,i)}catch(h){u.push(h)}});if(await Promise.all(d),u.length>0){for(let f=0;f<u.length;f+=1)console.error(u[f]);throw u[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await rr(this.storage,`${this.storageKey}-code-verifier`);const i=Object.assign({},t),a=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&i.user&&await ml(this.userStorage,this.storageKey+"-user",{user:i.user});const o=Object.assign({},i);delete o.user;const u=kx(o);await ml(this.storage,this.storageKey,u)}else{const o=kx(i);await ml(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await rr(this.storage,this.storageKey),await rr(this.storage,this.storageKey+"-code-verifier"),await rr(this.storage,this.storageKey+"-user"),this.userStorage&&await rr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&sr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),pl);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:a}}=i;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((a.expires_at*1e3-t)/pl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${pl}ms, refresh threshold is ${Sp} ticks`),o<=Sp&&await this._callRefreshToken(a.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Ob)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!sr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,a){const o=[`provider=${encodeURIComponent(i)}`];if(a?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&o.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[u,d]=await rl(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(f.toString())}if(a?.queryParams){const u=new URLSearchParams(a.queryParams);o.push(u.toString())}return a?.skipBrowserRedirect&&o.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;return u?this._returnResult({data:null,error:u}):await Tt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token})})}catch(i){if(yt(i))return this._returnResult({data:null,error:i});throw i}}async _enroll(t){try{return await this._useSession(async i=>{var a,o;const{data:u,error:d}=i;if(d)return this._returnResult({data:null,error:d});const f=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:h,error:m}=await Tt(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(a=u?.session)===null||a===void 0?void 0:a.access_token});return m?this._returnResult({data:null,error:m}):(t.factorType==="totp"&&h.type==="totp"&&(!((o=h?.totp)===null||o===void 0)&&o.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(i){if(yt(i))return this._returnResult({data:null,error:i});throw i}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?bE(t.webauthn.credential_response):wE(t.webauthn.credential_response)})}:{code:t.code}),{data:f,error:h}=await Tt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+f.expires_in},f)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",f),this._returnResult({data:f,error:h}))})}catch(i){if(yt(i))return this._returnResult({data:null,error:i});throw i}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({data:null,error:u});const d=await Tt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});if(d.error)return d;const{data:f}=d;if(f.type!=="webauthn")return{data:f,error:null};switch(f.webauthn.type){case"create":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:vE(f.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:xE(f.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(i){if(yt(i))return this._returnResult({data:null,error:i});throw i}})}async _challengeAndVerify(t){const{data:i,error:a}=await this._challenge({factorId:t.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){var t;const{data:{user:i},error:a}=await this.getUser();if(a)return{data:null,error:a};const o={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=i?.factors)!==null&&t!==void 0?t:[])o.all.push(u),u.status==="verified"&&o[u.factor_type].push(u);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,i;const{data:{session:a},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=Uf(a.access_token);let d=null;u.aal&&(d=u.aal);let f=d;((i=(t=a.user.factors)===null||t===void 0?void 0:t.filter(y=>y.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(f="aal2");const m=u.amr||[];return{data:{currentLevel:d,nextLevel:f,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;return o?this._returnResult({data:null,error:o}):a?await Tt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:a.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Ar})})}catch(i){if(yt(i))return this._returnResult({data:null,error:i});throw i}}async _approveAuthorization(t,i){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Ar});const d=await Tt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&sr()&&!i?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(yt(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(t,i){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Ar});const d=await Tt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&sr()&&!i?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(yt(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;return a?this._returnResult({data:null,error:a}):i?await Tt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Ar})})}catch(t){if(yt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;return o?this._returnResult({data:null,error:o}):a?(await Tt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ar})})}catch(i){if(yt(i))return this._returnResult({data:null,error:i});throw i}}async fetchJwk(t,i={keys:[]}){let a=i.keys.find(f=>f.kid===t);if(a)return a;const o=Date.now();if(a=this.jwks.keys.find(f=>f.kid===t),a&&this.jwks_cached_at+kN>o)return a;const{data:u,error:d}=await Tt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=o,a=u.keys.find(f=>f.kid===t),!a)?null:a}async getClaims(t,i={}){try{let a=t;if(!a){const{data:b,error:_}=await this.getSession();if(_||!b.session)return this._returnResult({data:null,error:_});a=b.session.access_token}const{header:o,payload:u,signature:d,raw:{header:f,payload:h}}=Uf(a);i?.allowExpired||JN(u.exp);const m=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,i?.keys?{keys:i.keys}:i?.jwks);if(!m){const{error:b}=await this.getUser(a);if(b)throw b;return{data:{claims:u,header:o,signature:d},error:null}}const y=XN(o.alg),v=await crypto.subtle.importKey("jwk",m,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,IN(`${f}.${h}`)))throw new Cp("Invalid JWT signature");return{data:{claims:u,header:o,signature:d},error:null}}catch(a){if(yt(a))return this._returnResult({data:null,error:a});throw a}}}Xo.nextInstanceID={};const AE=Xo,RE="2.89.0";let Lo="";typeof Deno<"u"?Lo="deno":typeof document<"u"?Lo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Lo="react-native":Lo="node";const OE={"X-Client-Info":`supabase-js-${Lo}/${RE}`},DE={headers:OE},ME={schema:"public"},zE={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},LE={};function Zo(n){"@babel/helpers - typeof";return Zo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zo(n)}function UE(n,t){if(Zo(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(Zo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function IE(n){var t=UE(n,"string");return Zo(t)=="symbol"?t:t+""}function BE(n,t,i){return(t=IE(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function zx(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function On(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zx(Object(i),!0).forEach(function(a){BE(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):zx(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}const $E=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),PE=()=>Headers,qE=(n,t,i)=>{const a=$E(i),o=PE();return async(u,d)=>{var f;const h=(f=await t())!==null&&f!==void 0?f:n;let m=new o(d?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${h}`),a(u,On(On({},d),{},{headers:m}))}};function FE(n){return n.endsWith("/")?n:n+"/"}function HE(n,t){var i,a;const{db:o,auth:u,realtime:d,global:f}=n,{db:h,auth:m,realtime:y,global:v}=t,x={db:On(On({},h),o),auth:On(On({},m),u),realtime:On(On({},y),d),storage:{},global:On(On(On({},v),f),{},{headers:On(On({},(i=v?.headers)!==null&&i!==void 0?i:{}),(a=f?.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function VE(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(FE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var GE=class extends AE{constructor(n){super(n)}},KE=class{constructor(n,t,i){var a,o;this.supabaseUrl=n,this.supabaseKey=t;const u=VE(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,f={db:ME,realtime:LE,auth:On(On({},zE),{},{storageKey:d}),global:DE},h=HE(i??{},f);if(this.storageKey=(a=h.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken)this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var m;this.auth=this._initSupabaseAuthClient((m=h.auth)!==null&&m!==void 0?m:{},this.headers,h.global.fetch)}this.fetch=qE(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(On({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&this.accessToken().then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new NC(new URL("rest/v1",u).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new jN(this.storageUrl.href,this.headers,this.fetch,i?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new wC(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,i)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,i;if(n.accessToken)return await n.accessToken();const{data:a}=await n.auth.getSession();return(t=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:i,storage:a,userStorage:o,storageKey:u,flowType:d,lock:f,debug:h,throwOnError:m},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new GE({url:this.authUrl.href,headers:On(On({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:i,storage:a,userStorage:o,flowType:d,lock:f,debug:h,throwOnError:m,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new FC(this.realtimeUrl.href,On(On({},n),{},{params:On(On({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,i){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const YE=(n,t,i)=>new KE(n,t,i);function WE(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}WE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const $f={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var QE={};const zb=n=>{if(typeof import.meta<"u"&&$f&&$f[n])return $f[n];const t=QE;return t&&t[n]?t[n]:null},Lb=zb("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",JE=zb("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",XE=Lb,Ne=YE(Lb,JE),ZE=2,Pf=n=>{if(typeof n!="string")return!1;const t=n.trim();return t?!/^[\d-\s.,+\-/%~]+$/.test(t):!1},Lx={async translateRecipe(n,t="EN-US"){const i=[],a=[],o=(h,m)=>{const y=typeof h=="string"?h:String(h??"");i.push(y),a.push((v,x)=>{m(x,v||y,y)})},u=h=>Array.isArray(h)?h.map(m=>m&&typeof m=="object"?{...m}:m):h,d={...n,ingredients:u(n.ingredients),flours:u(n.flours),breadIngredients:u(n.breadIngredients),steps:u(n.steps),ingredientGroups:u(n.ingredientGroups),stepGroups:u(n.stepGroups)};if(o(n.title||n.name||"",(h,m)=>{h.title=m,(h.name!==void 0||n.name!==void 0)&&(h.name=m)}),o(n.description||"",(h,m)=>{h.description=m}),n.course&&o(n.course,(h,m)=>{h.course=m}),n.category&&o(n.category,(h,m)=>{h.category=m}),n.storeName&&o(n.storeName,(h,m)=>{h.storeName=m}),Array.isArray(n.ingredientGroups)&&n.ingredientGroups.forEach((h,m)=>{const y=h?.name;y&&o(y,(v,x)=>{v.ingredientGroups?.[m]&&(v.ingredientGroups[m].name=x)})}),Array.isArray(n.stepGroups)&&n.stepGroups.forEach((h,m)=>{const y=h?.name;y&&o(y,(v,x)=>{v.stepGroups?.[m]&&(v.stepGroups[m].name=x)})}),n.type==="bread"?((n.flours||[]).forEach((h,m)=>{!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.flours?.[m]&&(y.flours[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.flours?.[m]&&(y.flours[m].unit=v)}),Pf(h.quantity)&&o(h.quantity,(y,v)=>{y.flours?.[m]&&(y.flours[m].quantity=v)}))}),(n.breadIngredients||[]).forEach((h,m)=>{!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].unit=v)}),Pf(h.quantity)&&o(h.quantity,(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].quantity=v)}))})):(n.ingredients||[]).forEach((h,m)=>{if(typeof h=="string"){o(h,(y,v)=>{Array.isArray(y.ingredients)&&(y.ingredients[m]=v)});return}!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].unit=v)}),Pf(h.quantity)&&o(h.quantity,(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].quantity=v)}))}),(n.steps||[]).forEach((h,m)=>{const y=typeof h=="object"&&h!==null?h.text||"":h||"";o(y,(v,x)=>{const b=v.steps?.[m];if(typeof b=="object"&&b!==null){b.text=x;return}Array.isArray(v.steps)&&(v.steps[m]=x)})}),!i.some(h=>String(h||"").trim().length>0))return n;try{const h=await this.translateList(i,t);return a.forEach((m,y)=>{m(h[y],d)}),d.__translationVersion=ZE,d}catch(h){throw console.error("Translation failed:",h),h}},async translateList(n,t){const i=(n||[]).map(u=>typeof u=="string"?u:String(u??""));if(!i.some(u=>u.trim().length>0))return i;const{data:a,error:o}=await Ne.functions.invoke("translate",{body:{text:i,target_lang:t}});if(o)throw console.error("Supabase Function Invocation Error:",o),new Error(`Translation Error: ${o.message}`);if(a&&a.error)throw console.error("Edge Function returned error:",a.error),new Error(`Translation Error: ${a.error}`);if(!Array.isArray(a?.translations))throw console.error("Edge Function returned invalid payload:",a),new Error("Translation Error: invalid response payload");return a.translations.map(u=>u.text)}},Wt=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},Eu=async(n,t,i)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${i||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},Bu=n=>{if(Array.isArray(n))return n.map(i=>String(i)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const i=t.slice(1,-1);return i?i.split(",").map(a=>a.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},ek=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],i=Object.values(t)[0];return Bu(i)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return Bu(t)}return Bu(n)},Ub=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const i=Bu(t);return i.length>0?i:t.split(",").map(a=>a.trim()).filter(Boolean)}return[]},Ux=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),i=String(n.message||"").toLowerCase(),a=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||i.includes("row-level security")||i.includes("permission denied")||i.includes("violates row-level security")||i.includes("invalid input syntax")||i.includes("column")||a.includes("row-level security")?!1:i.includes("failed to fetch")||i.includes("network")||i.includes("timeout")||i.includes("timed out")||i.includes("load failed")},Ib="recipe_list_cache",tk=300*1e3,qf=(n,t)=>{try{const i=(n||[]).map(a=>({id:a.id,title:a.title,description:a.description,image:a.image,servings:a.servings,course:a.course,category:a.category,storeName:a.storeName,store_name:a.store_name,tags:a.tags,created_at:a.created_at,updated_at:a.updated_at,type:a.type,sourceUrl:a.sourceUrl}));localStorage.setItem(Ib,JSON.stringify({userId:t,updatedAt:Date.now(),recipes:i}))}catch{}},nk=n=>{try{const t=localStorage.getItem(Ib);if(!t)return null;const i=JSON.parse(t);return i.userId!==n||Date.now()-i.updatedAt>tk?null:i.recipes||null}catch{return null}},vn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(n){return nk(n)},saveCachedRecipes(n,t){qf(n,t)},async _resolveShowMasterPreference(n,t=15e3){const i=n?.showMasterRecipes===!0,a=n?.id;if(!a)return i;const o=this._showMasterPrefCache.get(a),u=Date.now();if(o&&o.value!==i)return this._showMasterPrefCache.set(a,{value:i,updatedAt:u}),i;if(o&&u-o.updatedAt<3e4)return o.value;try{const{data:d,error:f}=await Eu(Ne.from("profiles").select("show_master_recipes").eq("id",a).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(f)throw f;const h=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(a,{value:h,updatedAt:u}),h}catch{return this._showMasterPrefCache.set(a,{value:i,updatedAt:u}),i}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:i,error:a}=await Eu(Ne.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(a)throw a;const o=ek(i),u=new Set(o.length>0?o:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const i=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:i,updatedAt:t},i}},async fetchRecipes(n,{timeoutMs:t=15e3,includeIngredients:i=!0,includeSources:a=!0,offset:o=0,limit:u=null,skipCacheSave:d=!1,returnMeta:f=!1}={}){if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const h=n.role==="admin",m=h?Promise.resolve(!1):this._resolveShowMasterPreference(n,t),y=Number.isInteger(o)&&o>=0?o:0,v=Number.isInteger(u)&&u>0?u:null;let x=0,b=[];const _=async(U,{withOrderIndex:F,queryTimeoutMs:ne})=>{let P=Ne.from("recipes").select(U);F?P=P.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):P=P.order("created_at",{ascending:!1}),v!=null&&(P=P.range(y,y+v-1));const{data:B,error:T}=await Eu(P,ne,"recipes.select(list)");if(T)throw T;return x=Array.isArray(B)?B.length:0,(B||[]).map(as)},C=i?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`,S=i?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${a?",recipe_sources(url)":""}`,N=i?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",k=i?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let D=null;const L=`recipe_query_pattern:${i?"ing":"noing"}:${a?"src":"nosrc"}`,$=this._queryPatternCache.get(L),E=Math.max(2500,t);if($)try{b=await _($.spec,{withOrderIndex:$.withOrderIndex,queryTimeoutMs:E})}catch(U){console.warn("Cached query pattern failed, re-detecting...",U),this._queryPatternCache.delete(L),D=U}else{const F=Math.max(2500,Math.round(t/(i?[C,S,N,k]:[C,S,k]).length));try{b=await _(C,{withOrderIndex:!0,queryTimeoutMs:F}),this._queryPatternCache.set(L,{spec:C,withOrderIndex:!0})}catch(ne){D=ne;try{b=await _(S,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(L,{spec:S,withOrderIndex:!1})}catch(P){D=P;try{b=await _(N,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(L,{spec:N,withOrderIndex:!1})}catch(B){D=B;try{b=await _(k,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(L,{spec:k,withOrderIndex:!1})}catch(T){D=T,b=[]}}}}}if(b.length===0&&D)try{const U=localStorage.getItem("local_recipes");if(U){const F=JSON.parse(U).map(ne=>typeof as=="function"?as(ne):ne);b=v!=null?F.slice(y,y+v):F,x=b.length}else throw D}catch{throw D}if(h)return d||qf(b,n.id),f?{recipes:b,hasMoreRaw:v!=null?x===v:!1}:b;const A=[String(n.id)];n.displayId&&A.push(String(n.displayId));const R=await m,M=R?await this._resolveMasterOwnerTags(t):new Set,V=b.filter(U=>{const F=Ub(U.tags),ne=F.filter(z=>z&&z.startsWith("owner:"));if(ne.length===0)return!0;const P=ne.some(z=>M.has(z));if(R&&P)return!0;const B=ne.some(z=>A.some(H=>z===`owner:${H}`)),T=F.includes("public");return!!(B||T)});return d||qf(V,n.id),f?{recipes:V,hasMoreRaw:v!=null?x===v:!1}:V},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),a=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:o}=await Ne.storage.from("recipe-images").upload(a,n);if(o)throw o;const{data:u}=Ne.storage.from("recipe-images").getPublicUrl(a);return u.publicUrl},async getRecipe(n){try{const{data:t,error:i}=await Eu(Ne.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(i)throw i;return as(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const i=localStorage.getItem("local_recipes");if(i){const o=JSON.parse(i).find(u=>u.id==n);if(o)return as(o)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:i,created_at:a,sourceUrl:o,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const h=(u.tags||[]).filter(m=>!m.startsWith("owner:"));u.tags=[...h,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=ku(u);try{const{data:f,error:h}=await Ne.from("recipes").insert([d]).select().single();if(h)throw h;if(o){const{error:m}=await Ne.from("recipe_sources").insert([{recipe_id:f.id,url:o}]);m&&console.error("Failed to save source URL:",m)}return as({...f,recipe_sources:o?[{url:o}]:[]})}catch(f){if(!Ux(f))throw f;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",f);const h=Date.now(),m={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=ku(m);y.id=h,y.created_at=m.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),f}return as(y)}},async updateRecipe(n){const{id:t,created_at:i,sourceUrl:a,...o}=n;o.image instanceof File&&(o.image=await this.uploadImage(o.image));const u=ku(o);o.steps===void 0&&delete u.steps,o.tags===void 0&&delete u.tags,o.ingredients!==void 0||o.type!==void 0||o.ingredientGroups!==void 0||o.flours!==void 0||o.breadIngredients!==void 0||o.stepGroups!==void 0||delete u.ingredients;try{const{data:f,error:h}=await Ne.from("recipes").update(u).eq("id",n.id).select().single();if(h)throw h;if(a!==void 0&&(await Ne.from("recipe_sources").delete().eq("recipe_id",n.id),a)){const{error:m}=await Ne.from("recipe_sources").insert([{recipe_id:n.id,url:a}]);m&&console.error("Failed to update source URL:",m)}return as({...f,recipe_sources:a?[{url:a}]:[]})}catch(f){if(!Ux(f))throw f;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",f);const h=localStorage.getItem("local_recipes");if(h){let m=JSON.parse(h);const y=m.findIndex(v=>v.id==n.id);if(y!==-1){const v={...m[y],...u,updated_at:new Date().toISOString()};return m[y]=v,localStorage.setItem("local_recipes",JSON.stringify(m)),as(v)}}throw f}},async duplicateRecipe(n,t){const{id:i,created_at:a,updated_at:o,image:u,...d}=n;d.title=`${d.title} ()`;let f=null;if(u)try{const h=u.split("/").pop(),m=`copy-${Date.now()}-${h}`,{error:y}=await Ne.storage.from("recipe-images").copy(h,m);if(y)console.warn("Image copy failed, using original URL:",y),f=u;else{const{data:v}=Ne.storage.from("recipe-images").getPublicUrl(m);f=v.publicUrl}}catch(h){console.warn("Image copy logic error:",h),f=u}return d.image=f,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await Ne.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(rk)},async getDeletedCount(){const{count:n,error:t}=await Ne.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:i}=await Ne.from("recipes").select("*").eq("id",n).single();if(i)throw i;const{error:a}=await Ne.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Ne.from("recipes").delete().eq("id",n);if(o)throw o;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const i=localStorage.getItem("local_recipes");if(i){let a=JSON.parse(i);const o=a.length;if(a=a.filter(u=>u.id!=n),a.length<o)return localStorage.setItem("local_recipes",JSON.stringify(a)),!0}throw t}},async restoreRecipe(n){const{data:t,error:i}=await Ne.from("deleted_recipes").select("*").eq("id",n).single();if(i)throw i;const{error:a}=await Ne.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Ne.from("deleted_recipes").delete().eq("id",n);if(o)throw o;return!0},async hardDeleteRecipe(n){const{error:t}=await Ne.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await Ne.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(i=>i.recipe_id)},async addToHistory(n){const{error:t}=await Ne.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(i=>Ne.from("recipes").update({order_index:i.order_index}).eq("id",i.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,i=[];for(const a of n)try{await this.createRecipe(a),t++}catch(o){console.error("Import failed for recipe:",a.title,o),i.push({title:a.title,error:o.message})}return{success:!0,count:t,errors:i}},async updateRecipeCosts(n){const{data:t,error:i}=await Ne.from("recipes").select("*");if(i)throw i;let a=0;const o=[];for(const u of t){const d=as(u);let f=!1;const h=m=>m.map(y=>{if(!y.name)return y;const v=n.get(Wt(y.name));if(v&&y.purchaseCost!==v.price){f=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const b=parseFloat(x.quantity)||0;x.cost=Math.round(b/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const b=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*b)}return x}return y});if(d.type==="bread"){const m=h(d.flours||[]),y=h(d.breadIngredients||[]);f&&(d.flours=m,d.breadIngredients=y)}else{const m=h(d.ingredients||[]);f&&(d.ingredients=m)}if(f){const m=ku(d);o.push(Ne.from("recipes").update(m).eq("id",d.id)),a++}}return o.length>0&&await Promise.all(o),a}},ku=n=>{let t=n.ingredients||[];const i={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(i.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const o=n.steps||[],u=n.stepGroups.map(d=>({...d,count:o.filter(f=>f.groupId===d.id).length}));i.stepGroups=u}if(n.type==="bread"){const o=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[i,...o,...u]}else t=[i,...t];const a=(n.steps||[]).map(o=>typeof o=="string"?o:o.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:a,tags:n.tags||[]}},as=n=>{const t=n.ingredients||[];let i="normal",a=[],o=[],u=[],d=[],f=t;const h=Ub(n.tags);if(Array.isArray(t)&&t.length>0&&t[0]&&typeof t[0]=="object"&&t[0]._meta){const v=t[0];i=v.type||"normal",v.groups&&(u=v.groups),v.stepGroups&&(d=v.stepGroups);const x=t.slice(1);i==="bread"?(a=x.filter(b=>b._group==="flour").map(b=>{const{_group:_,...C}=b;return C}),o=x.filter(b=>b._group==="other").map(b=>{const{_group:_,...C}=b;return C}),f=[...a,...o]):f=x}else n.ingredients_meta&&(i=n.ingredients_meta.type||"normal",Array.isArray(n.ingredients_meta.groups)&&(u=n.ingredients_meta.groups),Array.isArray(n.ingredients_meta.stepGroups)&&(d=n.ingredients_meta.stepGroups),f=Array.isArray(t)?t:[]);let y=n.steps||[];if(d.length>0&&Array.isArray(y)){let v=0;y=y.map(b=>({text:b}));const x=[];for(d.forEach(b=>{const _=b.count||0;for(let C=0;C<_;C++)v<y.length&&(x.push({...y[v],text:y[v].text,groupId:b.id}),v++)});v<y.length;)x.push({...y[v],groupId:"default"}),v++;y=x}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:i,flours:a,breadIngredients:o,ingredientGroups:u,stepGroups:d,ingredients:f,steps:y.length>0&&typeof y[0]=="object"?y:n.steps,tags:h,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},rk=n=>({...as(n),deletedAt:n.deleted_at,originalId:n.original_id}),Ff=Object.freeze(Object.defineProperty({__proto__:null,recipeService:vn},Symbol.toStringTag,{value:"Module"})),Hf="food",sk="food_alcohol",ik=new Set(["food","alcohol","soft_drink","supplies"]),Tu=n=>{const t=String(n||"").trim();return!t||t===sk?Hf:ik.has(t)?t:Hf},zn={async _getCurrentUserId(){const{data:n,error:t}=await Ne.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,i,a=null,o=null,u=void 0,d=void 0){try{const f=await this._getCurrentUserId();if(!f)throw new Error("");const h={user_id:f,ingredient_name:n,packet_size:parseFloat(t),packet_unit:i,last_price:a?parseFloat(a):null,updated_at:new Date().toISOString()};if(o&&(h.item_category=Tu(o)),u!==void 0){const x=String(u??"").trim();h.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let b=Number.isFinite(x)?x:100;b<=0&&(b=100),b>100&&(b=100),h.yield_percent=b}const m=async x=>Ne.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await m(h);if(v){const x=String(v.message||""),b=!!h.item_category&&x.includes("item_category"),_=Object.prototype.hasOwnProperty.call(h,"vendor")&&x.includes("vendor"),C=Object.prototype.hasOwnProperty.call(h,"yield_percent")&&x.includes("yield_percent");if(b||_||C){const S={...h};b&&delete S.item_category,_&&delete S.vendor,C&&delete S.yield_percent,{data:y,error:v}=await m(S)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:Tu(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(f){throw console.error("Error saving conversion:",f),f}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:i,error:a}=await Ne.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return a?(a.code==="PGRST116"||console.warn("Error fetching conversion:",a),null):{ingredientName:i.ingredient_name,packetSize:i.packet_size,packetUnit:i.packet_unit,lastPrice:i.last_price,vendor:i.vendor||"",itemCategory:Tu(i.item_category),yieldPercent:i.yield_percent===null||i.yield_percent===void 0?100:i.yield_percent,updatedAt:i.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:i}=await Ne.from("unit_conversions").select("*").eq("user_id",n);if(i)throw i;const a=new Map;return t.forEach(o=>{a.set(o.ingredient_name,{ingredientName:o.ingredient_name,packetSize:o.packet_size,packetUnit:o.packet_unit,lastPrice:o.last_price,vendor:o.vendor||"",itemCategory:Tu(o.item_category),yieldPercent:o.yield_percent===null||o.yield_percent===void 0?100:o.yield_percent,updatedAt:o.updated_at})}),a}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:i}=await Ne.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(i)throw i;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(n,{overwrite:t=!1}={}){const i=String(n||"").trim();if(!i)throw new Error("");const{data:a,error:o}=await Ne.rpc("admin_copy_ingredient_master",{target_profile_id:i,overwrite:t===!0});if(o)throw o;return a}},Bb=w.createContext(null),fs=()=>w.useContext(Bb),$b=w.createContext(null),Li=()=>{const n=w.useContext($b);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},Zu=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],ak=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var ll={},Vf={exports:{}},Gf,Ix;function lk(){if(Ix)return Gf;Ix=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Gf=n,Gf}var Kf,Bx;function ok(){if(Bx)return Kf;Bx=1;var n=lk();function t(){}function i(){}return i.resetWarningCache=t,Kf=function(){function a(d,f,h,m,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}a.isRequired=a;function o(){return a}var u={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:o,element:a,elementType:a,instanceOf:o,node:a,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:i,resetWarningCache:t};return u.PropTypes=u,u},Kf}var $x;function Pb(){return $x||($x=1,Vf.exports=ok()()),Vf.exports}var Yf,Px;function qb(){return Px||(Px=1,Yf={L:1,M:0,Q:3,H:2}),Yf}var Wf,qx;function Fb(){return qx||(qx=1,Wf={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),Wf}var Qf,Fx;function ck(){if(Fx)return Qf;Fx=1;var n=Fb();function t(i){this.mode=n.MODE_8BIT_BYTE,this.data=i}return t.prototype={getLength:function(i){return this.data.length},write:function(i){for(var a=0;a<this.data.length;a++)i.put(this.data.charCodeAt(a),8)}},Qf=t,Qf}var Jf,Hx;function uk(){if(Hx)return Jf;Hx=1;var n=qb();function t(i,a){this.totalCount=i,this.dataCount=a}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(i,a){var o=t.getRsBlockTable(i,a);if(o==null)throw new Error("bad rs block @ typeNumber:"+i+"/errorCorrectLevel:"+a);for(var u=o.length/3,d=new Array,f=0;f<u;f++)for(var h=o[f*3+0],m=o[f*3+1],y=o[f*3+2],v=0;v<h;v++)d.push(new t(m,y));return d},t.getRsBlockTable=function(i,a){switch(a){case n.L:return t.RS_BLOCK_TABLE[(i-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(i-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(i-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(i-1)*4+3];default:return}},Jf=t,Jf}var Xf,Vx;function dk(){if(Vx)return Xf;Vx=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var i=Math.floor(t/8);return(this.buffer[i]>>>7-t%8&1)==1},put:function(t,i){for(var a=0;a<i;a++)this.putBit((t>>>i-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var i=Math.floor(this.length/8);this.buffer.length<=i&&this.buffer.push(0),t&&(this.buffer[i]|=128>>>this.length%8),this.length++}},Xf=n,Xf}var Zf,Gx;function Hb(){if(Gx)return Zf;Gx=1;for(var n={glog:function(i){if(i<1)throw new Error("glog("+i+")");return n.LOG_TABLE[i]},gexp:function(i){for(;i<0;)i+=255;for(;i>=256;)i-=255;return n.EXP_TABLE[i]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return Zf=n,Zf}var ep,Kx;function Vb(){if(Kx)return ep;Kx=1;var n=Hb();function t(i,a){if(i.length==null)throw new Error(i.length+"/"+a);for(var o=0;o<i.length&&i[o]==0;)o++;this.num=new Array(i.length-o+a);for(var u=0;u<i.length-o;u++)this.num[u]=i[u+o]}return t.prototype={get:function(i){return this.num[i]},getLength:function(){return this.num.length},multiply:function(i){for(var a=new Array(this.getLength()+i.getLength()-1),o=0;o<this.getLength();o++)for(var u=0;u<i.getLength();u++)a[o+u]^=n.gexp(n.glog(this.get(o))+n.glog(i.get(u)));return new t(a,0)},mod:function(i){if(this.getLength()-i.getLength()<0)return this;for(var a=n.glog(this.get(0))-n.glog(i.get(0)),o=new Array(this.getLength()),u=0;u<this.getLength();u++)o[u]=this.get(u);for(var u=0;u<i.getLength();u++)o[u]^=n.gexp(n.glog(i.get(u))+a);return new t(o,0).mod(i)}},ep=t,ep}var tp,Yx;function hk(){if(Yx)return tp;Yx=1;var n=Fb(),t=Vb(),i=Hb(),a={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;o.getBCHDigit(d)-o.getBCHDigit(o.G15)>=0;)d^=o.G15<<o.getBCHDigit(d)-o.getBCHDigit(o.G15);return(u<<10|d)^o.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;o.getBCHDigit(d)-o.getBCHDigit(o.G18)>=0;)d^=o.G18<<o.getBCHDigit(d)-o.getBCHDigit(o.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return o.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,f){switch(u){case a.PATTERN000:return(d+f)%2==0;case a.PATTERN001:return d%2==0;case a.PATTERN010:return f%3==0;case a.PATTERN011:return(d+f)%3==0;case a.PATTERN100:return(Math.floor(d/2)+Math.floor(f/3))%2==0;case a.PATTERN101:return d*f%2+d*f%3==0;case a.PATTERN110:return(d*f%2+d*f%3)%2==0;case a.PATTERN111:return(d*f%3+(d+f)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),f=0;f<u;f++)d=d.multiply(new t([1,i.gexp(f)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),f=0,h=0;h<d;h++)for(var m=0;m<d;m++){for(var y=0,v=u.isDark(h,m),x=-1;x<=1;x++)if(!(h+x<0||d<=h+x))for(var b=-1;b<=1;b++)m+b<0||d<=m+b||x==0&&b==0||v==u.isDark(h+x,m+b)&&y++;y>5&&(f+=3+y-5)}for(var h=0;h<d-1;h++)for(var m=0;m<d-1;m++){var _=0;u.isDark(h,m)&&_++,u.isDark(h+1,m)&&_++,u.isDark(h,m+1)&&_++,u.isDark(h+1,m+1)&&_++,(_==0||_==4)&&(f+=3)}for(var h=0;h<d;h++)for(var m=0;m<d-6;m++)u.isDark(h,m)&&!u.isDark(h,m+1)&&u.isDark(h,m+2)&&u.isDark(h,m+3)&&u.isDark(h,m+4)&&!u.isDark(h,m+5)&&u.isDark(h,m+6)&&(f+=40);for(var m=0;m<d;m++)for(var h=0;h<d-6;h++)u.isDark(h,m)&&!u.isDark(h+1,m)&&u.isDark(h+2,m)&&u.isDark(h+3,m)&&u.isDark(h+4,m)&&!u.isDark(h+5,m)&&u.isDark(h+6,m)&&(f+=40);for(var C=0,m=0;m<d;m++)for(var h=0;h<d;h++)u.isDark(h,m)&&C++;var S=Math.abs(100*C/d/d-50)/5;return f+=S*10,f}};return tp=o,tp}var np,Wx;function fk(){if(Wx)return np;Wx=1;var n=ck(),t=uk(),i=dk(),a=hk(),o=Vb();function u(f,h){this.typeNumber=f,this.errorCorrectLevel=h,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(f){var h=new n(f);this.dataList.push(h),this.dataCache=null},d.isDark=function(f,h){if(f<0||this.moduleCount<=f||h<0||this.moduleCount<=h)throw new Error(f+","+h);return this.modules[f][h]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var f=1;for(f=1;f<40;f++){for(var h=t.getRSBlocks(f,this.errorCorrectLevel),m=new i,y=0,v=0;v<h.length;v++)y+=h[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];m.put(x.mode,4),m.put(x.getLength(),a.getLengthInBits(x.mode,f)),x.write(m)}if(m.getLengthInBits()<=y*8)break}this.typeNumber=f}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(f,h){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++){this.modules[m]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[m][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(f,h),this.typeNumber>=7&&this.setupTypeNumber(f),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,h)},d.setupPositionProbePattern=function(f,h){for(var m=-1;m<=7;m++)if(!(f+m<=-1||this.moduleCount<=f+m))for(var y=-1;y<=7;y++)h+y<=-1||this.moduleCount<=h+y||(0<=m&&m<=6&&(y==0||y==6)||0<=y&&y<=6&&(m==0||m==6)||2<=m&&m<=4&&2<=y&&y<=4?this.modules[f+m][h+y]=!0:this.modules[f+m][h+y]=!1)},d.getBestMaskPattern=function(){for(var f=0,h=0,m=0;m<8;m++){this.makeImpl(!0,m);var y=a.getLostPoint(this);(m==0||f>y)&&(f=y,h=m)}return h},d.createMovieClip=function(f,h,m){var y=f.createEmptyMovieClip(h,m),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var b=x*v,_=0;_<this.modules[x].length;_++){var C=_*v,S=this.modules[x][_];S&&(y.beginFill(0,100),y.moveTo(C,b),y.lineTo(C+v,b),y.lineTo(C+v,b+v),y.lineTo(C,b+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var f=8;f<this.moduleCount-8;f++)this.modules[f][6]==null&&(this.modules[f][6]=f%2==0);for(var h=8;h<this.moduleCount-8;h++)this.modules[6][h]==null&&(this.modules[6][h]=h%2==0)},d.setupPositionAdjustPattern=function(){for(var f=a.getPatternPosition(this.typeNumber),h=0;h<f.length;h++)for(var m=0;m<f.length;m++){var y=f[h],v=f[m];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var b=-2;b<=2;b++)x==-2||x==2||b==-2||b==2||x==0&&b==0?this.modules[y+x][v+b]=!0:this.modules[y+x][v+b]=!1}},d.setupTypeNumber=function(f){for(var h=a.getBCHTypeNumber(this.typeNumber),m=0;m<18;m++){var y=!f&&(h>>m&1)==1;this.modules[Math.floor(m/3)][m%3+this.moduleCount-8-3]=y}for(var m=0;m<18;m++){var y=!f&&(h>>m&1)==1;this.modules[m%3+this.moduleCount-8-3][Math.floor(m/3)]=y}},d.setupTypeInfo=function(f,h){for(var m=this.errorCorrectLevel<<3|h,y=a.getBCHTypeInfo(m),v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!f},d.mapData=function(f,h){for(var m=-1,y=this.moduleCount-1,v=7,x=0,b=this.moduleCount-1;b>0;b-=2)for(b==6&&b--;;){for(var _=0;_<2;_++)if(this.modules[y][b-_]==null){var C=!1;x<f.length&&(C=(f[x]>>>v&1)==1);var S=a.getMask(h,y,b-_);S&&(C=!C),this.modules[y][b-_]=C,v--,v==-1&&(x++,v=7)}if(y+=m,y<0||this.moduleCount<=y){y-=m,m=-m;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(f,h,m){for(var y=t.getRSBlocks(f,h),v=new i,x=0;x<m.length;x++){var b=m[x];v.put(b.mode,4),v.put(b.getLength(),a.getLengthInBits(b.mode,f)),b.write(v)}for(var _=0,x=0;x<y.length;x++)_+=y[x].dataCount;if(v.getLengthInBits()>_*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+_*8+")");for(v.getLengthInBits()+4<=_*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=_*8||(v.put(u.PAD0,8),v.getLengthInBits()>=_*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(f,h){for(var m=0,y=0,v=0,x=new Array(h.length),b=new Array(h.length),_=0;_<h.length;_++){var C=h[_].dataCount,S=h[_].totalCount-C;y=Math.max(y,C),v=Math.max(v,S),x[_]=new Array(C);for(var N=0;N<x[_].length;N++)x[_][N]=255&f.buffer[N+m];m+=C;var k=a.getErrorCorrectPolynomial(S),D=new o(x[_],k.getLength()-1),L=D.mod(k);b[_]=new Array(k.getLength()-1);for(var N=0;N<b[_].length;N++){var $=N+L.getLength()-b[_].length;b[_][N]=$>=0?L.get($):0}}for(var E=0,N=0;N<h.length;N++)E+=h[N].totalCount;for(var A=new Array(E),R=0,N=0;N<y;N++)for(var _=0;_<h.length;_++)N<x[_].length&&(A[R++]=x[_][N]);for(var N=0;N<v;N++)for(var _=0;_<h.length;_++)N<b[_].length&&(A[R++]=b[_][N]);return A},np=u,np}var Au={},Qx;function pk(){if(Qx)return Au;Qx=1,Object.defineProperty(Au,"__esModule",{value:!0});var n=Object.assign||function(m){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(m[x]=v[x])}return m},t=Pb(),i=u(t),a=tc(),o=u(a);function u(m){return m&&m.__esModule?m:{default:m}}function d(m,y){var v={};for(var x in m)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(m,x)&&(v[x]=m[x]);return v}var f={bgColor:i.default.oneOfType([i.default.object,i.default.string]).isRequired,bgD:i.default.string.isRequired,fgColor:i.default.oneOfType([i.default.object,i.default.string]).isRequired,fgD:i.default.string.isRequired,size:i.default.number.isRequired,title:i.default.string,viewBoxSize:i.default.number.isRequired,xmlns:i.default.string},h=(0,a.forwardRef)(function(m,y){var v=m.bgColor,x=m.bgD,b=m.fgD,_=m.fgColor,C=m.size,S=m.title,N=m.viewBoxSize,k=m.xmlns,D=k===void 0?"http://www.w3.org/2000/svg":k,L=d(m,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return o.default.createElement("svg",n({},L,{height:C,ref:y,viewBox:"0 0 "+N+" "+N,width:C,xmlns:D}),S?o.default.createElement("title",null,S):null,o.default.createElement("path",{d:x,fill:v}),o.default.createElement("path",{d:b,fill:_}))});return h.displayName="QRCodeSvg",h.propTypes=f,Au.default=h,Au}var Jx;function mk(){if(Jx)return ll;Jx=1,Object.defineProperty(ll,"__esModule",{value:!0}),ll.QRCode=void 0;var n=Object.assign||function(C){for(var S=1;S<arguments.length;S++){var N=arguments[S];for(var k in N)Object.prototype.hasOwnProperty.call(N,k)&&(C[k]=N[k])}return C},t=Pb(),i=v(t),a=qb(),o=v(a),u=fk(),d=v(u),f=tc(),h=v(f),m=pk(),y=v(m);function v(C){return C&&C.__esModule?C:{default:C}}function x(C,S){var N={};for(var k in C)S.indexOf(k)>=0||Object.prototype.hasOwnProperty.call(C,k)&&(N[k]=C[k]);return N}var b={bgColor:i.default.oneOfType([i.default.object,i.default.string]),fgColor:i.default.oneOfType([i.default.object,i.default.string]),level:i.default.string,size:i.default.number,value:i.default.string.isRequired},_=(0,f.forwardRef)(function(C,S){var N=C.bgColor,k=N===void 0?"#FFFFFF":N,D=C.fgColor,L=D===void 0?"#000000":D,$=C.level,E=$===void 0?"L":$,A=C.size,R=A===void 0?256:A,M=C.value,V=x(C,["bgColor","fgColor","level","size","value"]),U=new d.default(-1,o.default[E]);U.addData(M),U.make();var F=U.modules;return h.default.createElement(y.default,n({},V,{bgColor:k,bgD:F.map(function(ne,P){return ne.map(function(B,T){return B?"":"M "+T+" "+P+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:L,fgD:F.map(function(ne,P){return ne.map(function(B,T){return B?"M "+T+" "+P+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:S,size:R,viewBoxSize:F.length}))});return ll.QRCode=_,_.displayName="QRCode",_.propTypes=b,ll.default=_,ll}var gk=mk();const Xx=_0(gk),Zx=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},yk=n=>{if(n==null)return NaN;if(typeof n=="number")return Number.isFinite(n)?n:NaN;const t=String(n).trim().replace(/[,\s]/g,"");if(!t)return NaN;const i=parseFloat(t);return Number.isFinite(i)?i:NaN},vs=(n,{maximumFractionDigits:t=1}={})=>{const i=yk(n);return Number.isFinite(i)?`${i.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}`:null},vk=new Set(["food","alcohol","soft_drink","supplies"]),Gb=new Set(["alcohol","supplies"]),Kb=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":vk.has(t)?t:"":""},Np=n=>{const t=Kb(n?.itemCategory??n?.item_category);return t?Gb.has(t):!!n?.isAlcohol},ia=n=>Np(n)?1.1:1.08,e0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),xk=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=e0(t);if(!a)return null;for(const[o,u]of n.entries())if(e0(o)===a)return u;return null},Vs=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},bk=n=>{const t=Vs(n);return!Number.isFinite(t)||t<=0||t>100?100:t},wk=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return bk(i)/100},Sk=(n,t,i)=>{const a=Vs(n),o=Vs(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},t0=(n,t,i,{defaultWeightWhenUnitEmpty:a=!1,forceWeightBased:o=!1,yieldRate:u=1}={})=>{const d=Vs(n),f=Vs(t);if(!Number.isFinite(d)||!Number.isFinite(f))return NaN;const h=Number.isFinite(u)&&u>0?u:1,m=String(i||"").trim().toLowerCase();return o||!m&&a||["g","","ml","","cc",""].includes(m)?d/1e3*f/h:d*f/h},jk=(n,t)=>{const i=Vs(n?.purchaseCost),a=Vs(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},_k=2,gl=Object.freeze({course:"",category:"",storeName:"",servings:"",ingredients:"",ingredientName:"",quantity:"",quantityGram:" (g)",unit:"",purchase:"",cost:"",totalCost:"",instructions:"",sourceRecipe:"",flourGroup:"",otherIngredients:"",scaleMultiplier:"",noSteps:"",print:"",close:""}),n0=Object.keys(gl),Ck=({recipe:n,ownerLabel:t,onBack:i,onEdit:a,onDelete:o,onHardDelete:u,isDeleted:d,onView:f,onDuplicate:h,backLabel:m,onList:y})=>{const{user:v}=fs(),x=Li(),[b,_]=_e.useState(!1),[C,S]=_e.useState(!1),[N,k]=_e.useState(!1),[D,L]=_e.useState(new Set),[$,E]=_e.useState(new Set),[A,R]=_e.useState(new Set),[M,V]=_e.useState({}),[U,F]=_e.useState("ORIGINAL"),[ne,P]=_e.useState(!1),[B,T]=_e.useState(!0),[z,H]=_e.useState(!1),[J,de]=_e.useState(new Map),[q,Y]=_e.useState({}),[ae,xe]=_e.useState(""),[ve,Ee]=_e.useState(1),[he,G]=_e.useState(""),[ge,Z]=_e.useState(""),Ce=_e.useMemo(()=>{const W=parseFloat(ve);return isNaN(W)?1:W},[ve]),be=(W,X)=>{if(!W)return"";const oe=parseFloat(W);if(isNaN(oe))return W;const fe=oe*parseFloat(X);return Number.isInteger(fe)?fe.toString():fe.toFixed(1).replace(/\.0$/,"")},We=(W,X)=>{if(!W)return"";const oe=parseFloat(W);return isNaN(oe)?W:(oe*parseFloat(X)).toFixed(2).replace(/\.00$/,"")},[Re,Pe]=_e.useState(n),[Ze,rt]=_e.useState(!1),qe=Re||n,Ae=U==="ORIGINAL"?Re:M[U]||Re,Se=U==="ORIGINAL"||U==="JA"?gl:q[U]||gl,te=W=>Se[W]||gl[W]||W;_e.useEffect(()=>{let W=!0;return zn.getAllConversions().then(X=>{W&&de(X)}).catch(()=>{W&&de(new Map)}),()=>{W=!1}},[]);const Be=_e.useMemo(()=>{const W=(X,oe={})=>{if(!X||typeof X!="object")return X;const fe=xk(J,X.name),ze=Kb(X.itemCategory??X.item_category??fe?.itemCategory),Fe=wk(X,fe);let Je=X;if(ze&&(Je={...Je,itemCategory:ze,isAlcohol:Gb.has(ze)}),!fe||!fe.packetSize){const et=String(X.unit||"").trim();if(oe.forceWeightBased||oe.defaultWeightWhenUnitEmpty&&!et){const Qt=t0(X.quantity,Je.purchaseCost,X.unit,{...oe,yieldRate:Fe}),un=Number.isFinite(Qt)?Math.round(Qt*100)/100:NaN,Kn=Vs(Je.cost);if(Number.isFinite(un)&&(!Number.isFinite(Kn)||Math.abs(Kn-un)>.01))return{...Je,cost:un}}return Je}const wt=[fe.lastPrice,X.purchaseCostRef,X.purchase_cost,X.purchaseCost].find(et=>Number.isFinite(Vs(et))),St=Sk(wt,fe.packetSize,fe.packetUnit);if(!Number.isFinite(St)||!jk(X,St))return Je;const It=t0(X.quantity,St,X.unit,{...oe,yieldRate:Fe});return{...Je,purchaseCost:Math.round(St*100)/100,cost:Number.isFinite(It)?Math.round(It*100)/100:Je.cost}};return{...Ae,ingredients:(Ae.ingredients||[]).map(X=>W(X)),flours:(Ae.flours||[]).map(X=>W(X,{forceWeightBased:!0})),breadIngredients:(Ae.breadIngredients||[]).map(X=>W(X,{forceWeightBased:!0}))}},[J,Ae]);_e.useEffect(()=>{Pe(n),!n.steps&&!d&&(rt(!0),vn.getRecipe(n.id).then(W=>{Pe(W)}).catch(W=>{console.error("Failed to load details",W)}).finally(()=>{rt(!1)}))},[n,d]);const[ut,Ct]=_e.useState(n.tags?.includes("public")||!1),Rt=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),Ot=!(n.tags&&n.tags.some(W=>W.startsWith("owner:")))||Rt,jt=async()=>{const W=!ut;try{const X=n.tags||[];let oe;W?oe=[...X,"public"]:oe=X.filter(fe=>fe!=="public"),Ct(W),await vn.updateRecipe({id:n.id,tags:oe})}catch(X){console.error("Failed to toggle public",X),x.error(""),Ct(!W)}},ft=(W,X,oe=!1)=>U==="ORIGINAL"||!B||!X||W===X?W:s.jsxs(s.Fragment,{children:[W,oe?s.jsx("br",{}):" ",s.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",X,")"]})]}),Vt=(W,X)=>{const oe=String(W??"").trim(),fe=String(X??"").trim();return U==="ORIGINAL"||!B||!fe||oe===fe?oe||fe:`${oe}${fe}`},an=W=>!W||!Array.isArray(W.steps)?!1:W.type==="bread"?Array.isArray(W.flours)&&Array.isArray(W.breadIngredients):Array.isArray(W.ingredients),xn=(W,X)=>!W||!X||W.__translationVersion!==_k||Array.isArray(X.steps)&&!Array.isArray(W.steps)?!1:X.type==="bread"?!((X.flours||[]).length>0&&(W.flours||[]).length===0||(X.breadIngredients||[]).length>0&&(W.breadIngredients||[]).length===0):!((X.ingredients||[]).length>0&&(W.ingredients||[]).length===0),Mt=async W=>{const X=W.target.value;if(F(X),X==="ORIGINAL")return;let oe=Re||n;if(!d&&n?.id&&!an(oe))try{rt(!0);const Fe=await vn.getRecipe(n.id);Fe&&(oe=Fe,Pe(Fe))}catch(Fe){console.error("Failed to load full recipe for translation",Fe)}finally{rt(!1)}const fe=M[X]&&xn(M[X],oe),ze=X!=="JA"&&!q[X];if(!(fe&&!ze)){P(!0);try{let Fe=null;if(await Promise.all([(async()=>{if(!fe)try{const Je=await Lx.translateRecipe(oe,X);V(Qe=>({...Qe,[X]:Je}))}catch(Je){Fe=Je}})(),(async()=>{if(ze)try{const Je=await Lx.translateList(n0.map(wt=>gl[wt]),X),Qe=n0.reduce((wt,St,It)=>(wt[St]=Je[It]||gl[St],wt),{});Y(wt=>({...wt,[X]:Qe}))}catch(Je){console.error("Failed to translate UI labels",Je)}})()]),Fe)throw Fe}catch(Fe){console.error(Fe),x.error(""),F("ORIGINAL")}finally{P(!1)}}},nn=W=>{L(X=>{const oe=new Set(X);return oe.has(W)?oe.delete(W):oe.add(W),oe})},cn=W=>{E(X=>{const oe=new Set(X);return oe.has(W)?oe.delete(W):oe.add(W),oe})},Gt=W=>{R(X=>{const oe=new Set(X);return oe.has(W)?oe.delete(W):oe.add(W),oe})};_e.useEffect(()=>{window.scrollTo(0,0),f&&n&&!d&&f(n.id);const W=document.title;return n&&n.title&&(document.title=n.title),V({}),F("ORIGINAL"),L(new Set),E(new Set),R(new Set),Ct(n.tags?.includes("public")||!1),()=>{document.title=W}},[n.id,n.title]),_e.useEffect(()=>{n&&n.servings?Z(n.servings.toString()):Z(""),G("")},[n]);const Xn=()=>{_(!0)},ar=()=>{_(!1),o(n)},ee=()=>{_(!1)},De=()=>{k(!0)},Te=()=>{k(!1),u(n)},Ue=()=>{k(!1)},He=()=>{S(!0)},it=async()=>{S(!1);try{const W=await vn.duplicateRecipe(n,v);h&&h(W)}catch(W){console.error("Duplication failed",W),x.error("")}},gt=()=>{S(!1)},Lt=_e.useRef(null),Pt=_e.useRef(null),dn=W=>{Pt.current=null,Lt.current=W.targetTouches[0].clientX},ue=W=>{Pt.current=W.targetTouches[0].clientX},Ke=()=>{if(!Lt.current||!Pt.current)return;const W=Lt.current-Pt.current,X=Lt.current<50,oe=W<-100;X&&oe&&i()},at=W=>{const X=Math.round(parseFloat(W)),oe=parseFloat(he),fe=parseFloat(ge);let ze=null,Fe=null,Je=null;return!isNaN(X)&&!isNaN(fe)&&fe>0&&(Je=X/fe),!isNaN(X)&&!isNaN(oe)&&!isNaN(fe)&&oe>0&&fe>0&&(Fe=oe*fe,ze=X/Fe*100),s.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[s.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("span",{children:["  ",s.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),s.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[s.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),s.jsx("input",{type:"number",value:he,onChange:Qe=>G(Qe.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[s.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),s.jsx("input",{type:"number",value:ge,onChange:Qe=>Z(Qe.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Je!==null&&s.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:ze!==null?ze>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${ze!==null?ze>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:ze!==null?"6px":"0"},children:["1(): ",s.jsxs("strong",{children:["",Je.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),ze!==null&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",Fe.toLocaleString()]}),s.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(Fe-X).toLocaleString()]}),s.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:ze>40?"#d32f2f":"#2e7d32"},children:[": ",ze.toFixed(1),"%"]})]})]})]})]})},Ye=Be.ingredients||[];let kt=Ae.steps||[];const xt=W=>String(W||"").trim().toLowerCase(),Dt=W=>{const X=xt(W);return X?["","","steps","method"].some(oe=>X===oe||X.includes(oe)):!1};if(!kt.length&&Ae.ingredientGroups){const W=Ae.ingredientGroups.find(X=>Dt(X.name));if(W)kt=Ye.filter(oe=>oe.groupId===W.id).map(oe=>typeof oe=="string"?oe:{...oe,text:oe.name||oe.text||""});else{const X=Ye.filter(oe=>Dt(oe.group)||Dt(oe.groupName));X.length&&(kt=X.map(oe=>typeof oe=="string"?oe:{...oe,text:oe.name||oe.text||""}))}}const Ft=kt,ot=_e.useMemo(()=>{const W=Ae.ingredientGroups||[],X=["","steps","method",""],oe=Qe=>String(Qe||"").trim().toLowerCase(),fe=new Set(W.filter(Qe=>X.includes(oe(Qe.name))).map(Qe=>Qe.id)),ze=W.filter(Qe=>!fe.has(Qe.id));if(!ze.length)return[{id:"default",name:null,items:Ye.filter(Qe=>!fe.has(Qe.groupId))}];const Fe=ze.map(Qe=>{const wt=Ye.filter(St=>St.groupId===Qe.id);return{id:Qe.id,name:Qe.name===""?null:Qe.name,items:wt}}).filter(Qe=>Qe.items.length>0),Je=Ye.filter(Qe=>Qe.groupId?fe.has(Qe.groupId)?!1:!ze.some(wt=>wt.id===Qe.groupId):!0);return Je.length&&Fe.push({id:"ungrouped",name:null,items:Je}),Fe.length?Fe:[{id:"default",name:null,items:Ye.filter(Qe=>!fe.has(Qe.groupId))}]},[Ae.ingredientGroups,Ye]),re=_e.useMemo(()=>{if(Ae.type!=="bread")return null;const W=Be.flours||[],X=Be.breadIngredients||[],oe=W.reduce((et,Nt)=>et+(parseFloat(Nt.quantity)||0),0),fe=oe+X.reduce((et,Nt)=>et+(parseFloat(Nt.quantity)||0),0),ze=parseFloat(ae),Fe=ze&&fe?ze/fe:1,Je=et=>oe?((parseFloat(et)||0)/oe*100).toFixed(1):"0.0",Qe=et=>ze?((parseFloat(et)||0)*Fe).toFixed(1):et,wt=et=>{const Nt=parseFloat(et)||0;if(!ze)return Nt;const Qt=Nt*Fe;return Math.round(Qt*100)/100},St=et=>{const Nt=wt(et);return Number.isFinite(Nt)?Nt.toLocaleString(void 0,{maximumFractionDigits:2}):""},It=et=>et.reduce((Nt,Qt)=>{const Kn=(parseFloat(Qt.cost)||0)*(ze?Fe:1),Sr=ia(Qt);return Nt+Kn*Sr},0);return{flours:W,others:X,totalFlour:oe,grandTotal:fe,calcPercent:Je,getScaledQtyValue:Qe,getScaledCostValue:wt,formatCostValue:St,scaleFactor:Fe,totalTaxIncluded:It(W)+It(X)}},[Be.breadIngredients,Be.flours,Ae.type,ae]),$e=_e.useMemo(()=>Ae.type==="bread"?0:Ye.reduce((W,X)=>{const fe=(parseFloat(X.cost)||0)*Ce,ze=ia(X);return W+fe*ze},0),[Ae.type,Ye,Ce]),Ve=Ae.type==="bread"?re?Math.round(re.totalTaxIncluded).toLocaleString():"0":Math.round($e).toLocaleString(),_t=Ae.description||qe.description;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:dn,onTouchMove:ue,onTouchEnd:Ke,children:[C&&s.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(on,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[s.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),s.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(le,{variant:"ghost",onClick:gt,children:""}),s.jsx(le,{variant:"primary",onClick:it,children:""})]})]})}),N&&s.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(on,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[s.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),s.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",s.jsx("br",{}),""]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(le,{variant:"ghost",onClick:Ue,children:""}),s.jsx(le,{variant:"danger",onClick:Te,children:""})]})]})}),b&&s.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(on,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[s.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),s.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",s.jsx("br",{}),s.jsx("small",{style:{color:"#666"},children:""})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(le,{variant:"ghost",onClick:ee,children:""}),s.jsx(le,{variant:"danger",onClick:ar,children:""})]})]})}),s.jsxs("div",{className:"recipe-detail__header",children:[s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsx(le,{variant:"secondary",onClick:i,size:"sm",children:m||" "}),y&&s.jsx(le,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&s.jsxs("div",{className:"recipe-detail__actions",children:[Ot&&(v?.displayId==="yoshito"||v?.role==="admin")&&s.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:s.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:ut,onChange:jt,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),s.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:ut?"#4CAF50":"#888"},children:ut?"":""})]})}),!Ot&&s.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),s.jsxs("select",{className:"language-select",value:U,onChange:Mt,disabled:ne,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[s.jsx("option",{value:"ORIGINAL",children:" Original ()"}),ak.map(W=>s.jsx("option",{value:W.code,children:W.label},W.code))]}),U!=="ORIGINAL"&&s.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[s.jsx("input",{type:"checkbox",checked:B,onChange:W=>T(W.target.checked),style:{marginRight:"4px"}}),""]}),s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>H(!0),children:" "}),s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),s.jsx(le,{variant:"secondary",size:"sm",onClick:He,children:""}),Ot&&s.jsxs(s.Fragment,{children:[s.jsx(le,{variant:"secondary",size:"sm",onClick:a,children:""}),s.jsx(le,{variant:"danger",size:"sm",onClick:Xn,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&s.jsxs("div",{className:"recipe-detail__actions",children:[s.jsx(le,{variant:"ghost",size:"sm",onClick:De,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),s.jsx(le,{variant:"primary",size:"sm",onClick:()=>o(n,!0),children:""})]})]}),s.jsx("div",{className:"recipe-detail__hero",children:Ae.image?s.jsx("img",{src:Ae.image,alt:Ae.title,className:"recipe-detail__image"}):s.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),s.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[s.jsx("h1",{children:ft(Ae.title,qe.title)}),s.jsx("p",{className:"recipe-detail__desc",children:ft(Ae.description,qe.description,!0)}),v?.role==="admin"&&t&&s.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),s.jsxs("div",{className:"recipe-detail__meta",children:[Ae.course&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("course")}),s.jsx("span",{className:"meta-value",children:ft(Ae.course,qe.course)})]}),Ae.category&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("category")}),s.jsx("span",{className:"meta-value",children:ft(Ae.category,qe.category)})]}),Ae.storeName&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("storeName")}),s.jsx("span",{className:"meta-value",children:ft(Ae.storeName,qe.storeName)})]}),s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("servings")}),s.jsxs("span",{className:"meta-value",children:[Ae.servings,""]})]})]}),Ae.sourceUrl&&s.jsxs("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[s.jsx("div",{style:{fontSize:"0.85rem"},children:s.jsxs("a",{href:Ae.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",s.jsx("span",{className:"screen-only",children:te("sourceRecipe")}),s.jsx("span",{className:"print-only",children:te("sourceRecipe")})]})}),s.jsx("div",{style:{background:"white",padding:"4px",width:"fit-content"},children:s.jsx(Xx,{value:Ae.sourceUrl,size:128,style:{display:"block"}})})]})]}),s.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[s.jsxs("span",{children:[" : ",Zx(n.created_at)]}),n.updated_at&&s.jsxs("span",{children:[" : ",Zx(n.updated_at)]})]}),s.jsx("div",{className:"recipe-detail__content",children:s.jsxs("div",{className:"recipe-detail__main",children:[s.jsxs("section",{className:"detail-section",children:[s.jsx("h2",{children:te("ingredients")}),s.jsx(on,{className:"ingredients-card",children:Ae.type==="bread"?s.jsx("div",{className:"bread-detail-view",children:(()=>{const W=Be.flours||[],X=Be.breadIngredients||[],oe=W.reduce((et,Nt)=>et+(parseFloat(Nt.quantity)||0),0),fe=oe+X.reduce((et,Nt)=>et+(parseFloat(Nt.quantity)||0),0),ze=oe?(fe/oe*100).toFixed(1):"0.0",Fe=et=>oe?((parseFloat(et)||0)/oe*100).toFixed(1):"0.0",Je=parseFloat(ae),Qe=Je&&fe?Je/fe:1,wt=et=>Je?((parseFloat(et)||0)*Qe).toFixed(1):et,St=et=>{const Nt=parseFloat(et)||0;if(!Je)return Nt;const Qt=Nt*Qe;return Math.round(Qt*100)/100},It=et=>Number.isFinite(et)?et.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),s.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[fe.toLocaleString(),"g"]}),s.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",ze,"%)"]})]}),s.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[s.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx("input",{id:"target-total-input",type:"number",value:ae,onChange:et=>xe(et.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),s.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),ae&&s.jsx(le,{variant:"ghost",size:"sm",onClick:()=>xe(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),ae&&s.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",Qe.toFixed(3)," "]})]}),s.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[s.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[s.jsx("span",{children:te("flourGroup")}),s.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",ae?wt(oe):oe,"g (100%)"]})]}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantityGram")}),s.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("purchase")}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("cost")})]})}),s.jsx("tbody",{children:W.map((et,Nt)=>{const Qt=qe.flours?.[Nt]||{};return s.jsxs("tr",{children:[s.jsx("td",{children:s.jsxs("div",{className:"ingredient-name",children:[s.jsx("input",{type:"checkbox",id:`flour-${Nt}`}),s.jsx("label",{htmlFor:`flour-${Nt}`,children:ft(et.name,Qt?.name)})]})}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:ae?s.jsx("span",{style:{color:"var(--color-primary)"},children:wt(et.quantity)}):et.quantity}),s.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[Fe(et.quantity),"%"]}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(et.purchaseCost)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:et.cost?`${It(St(et.cost))}`:"-"})]},Nt)})})]})]}),s.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[s.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:te("otherIngredients")}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantityGram")}),s.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("purchase")}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("cost")})]})}),s.jsx("tbody",{children:X.map((et,Nt)=>{const Qt=qe.breadIngredients?.[Nt]||{};return s.jsxs("tr",{children:[s.jsx("td",{children:s.jsxs("div",{className:"ingredient-name",children:[s.jsx("input",{type:"checkbox",id:`ingredient-${Nt}`}),s.jsx("label",{htmlFor:`ingredient-${Nt}`,children:ft(et.name,Qt?.name)})]})}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:ae?s.jsx("span",{style:{color:"var(--color-primary)"},children:wt(et.quantity)}):et.quantity}),s.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[Fe(et.quantity),"%"]}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(et.purchaseCost)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:et.cost?`${It(St(et.cost))}`:"-"})]},Nt)})})]}),s.jsxs("div",{className:"cost-summary",children:[s.jsxs("span",{className:"cost-summary__label",children:[te("totalCost"),":"]}),s.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const et=Qt=>Qt.reduce((un,Kn)=>{const Sr=parseFloat(Kn.cost)||0,Jr=ia(Kn),Mr=Sr*Qe;return un+Mr*Jr},0),Nt=et(W)+et(X);return Math.round(Nt).toLocaleString()})()]}),s.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const et=Qt=>Qt.reduce((un,Kn)=>{const Sr=parseFloat(Kn.cost)||0,Jr=ia(Kn),Mr=Sr*Qe;return un+Mr*Jr},0),Nt=et(W)+et(X);return at(Nt)})()]})]})})()}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[s.jsxs("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:[te("scaleMultiplier"),":"]}),s.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),s.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:ve,onChange:W=>Ee(W.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(ve)!==1&&s.jsx(le,{variant:"ghost",size:"sm",onClick:()=>Ee("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const W=Ae.ingredientGroups&&Ae.ingredientGroups.length>0?Ae.ingredientGroups:null;return W?W.map(X=>{const oe=Ye.filter(fe=>fe.groupId===X.id);return oe.length===0||["","Steps","Method",""].includes(X.name)?null:s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(X.name)?"none":"block"},children:X.name}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40%"},children:te("ingredientName")}),s.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:te("quantity")}),s.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:te("unit")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("purchase")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("cost")})]})}),s.jsx("tbody",{children:oe.map((fe,ze)=>{const Fe=Ye.indexOf(fe),Je=qe.ingredients?.[Fe],Qe=typeof fe=="string"?fe:fe.name,wt=Je?typeof Je=="string"?Je:Je.name:"",St=typeof fe=="object"?fe.unit:"",It=Je&&typeof Je=="object"?Je.unit:"",et=be(fe.quantity,ve),Nt=We(fe.cost,ve),Qt=String(ve)!=="1";return s.jsxs("tr",{className:"ingredient-row",children:[s.jsx("td",{children:s.jsxs("div",{className:"ingredient-name",children:[s.jsx("input",{type:"checkbox",id:`ing-${X.id}-${ze}`}),s.jsx("label",{htmlFor:`ing-${X.id}-${ze}`,children:ft(Qe,wt)})]})}),s.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Qt?"bold":"normal",color:Qt?"var(--color-primary)":"inherit"},children:et}),s.jsx("td",{style:{paddingLeft:"0.5rem"},children:ft(St,It)}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(fe.purchaseCost)??"-"}),s.jsxs("td",{style:{textAlign:"right"},children:[vs(Nt)??"-",Np(fe)&&s.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},ze)})})]})]},X.id)}):s.jsxs(s.Fragment,{children:[s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40%"},children:te("ingredientName")}),s.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:te("quantity")}),s.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:te("unit")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("purchase")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("cost")})]})}),s.jsx("tbody",{children:Ye.map((X,oe)=>{const fe=qe.ingredients?.[oe],ze=typeof X=="string"?X:X.name,Fe=fe?typeof fe=="string"?fe:fe.name:"",Je=typeof X=="object"?X.unit:"",Qe=fe&&typeof fe=="object"?fe.unit:"",wt=be(X.quantity,ve),St=We(X.cost,ve),It=String(ve)!=="1";return s.jsxs("tr",{className:"ingredient-row",children:[s.jsx("td",{children:s.jsxs("div",{className:"ingredient-name",children:[s.jsx("input",{type:"checkbox",id:`ing-${oe}`}),s.jsx("label",{htmlFor:`ing-${oe}`,children:ft(ze,Fe)})]})}),s.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:It?"bold":"normal",color:It?"var(--color-primary)":"inherit"},children:wt}),s.jsx("td",{style:{paddingLeft:"0.5rem"},children:ft(Je,Qe)}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(X.purchaseCost)??"-"}),s.jsxs("td",{style:{textAlign:"right"},children:[vs(St)??"-",Np(X)&&s.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},oe)})})]}),s.jsxs("div",{className:"cost-summary",children:[s.jsxs("span",{className:"cost-summary__label",children:[te("totalCost"),":"]}),s.jsxs("span",{className:"cost-summary__value",children:["",Math.round((oe=>oe.reduce((fe,ze)=>{const Fe=parseFloat(ze.cost)||0,Je=ia(ze),Qe=We(Fe,ve),wt=parseFloat(Qe)||0;return fe+wt*Je},0))(Ye)).toLocaleString()]})]})]})})(),s.jsx("div",{className:"screen-only no-print",children:s.jsxs("div",{className:"cost-summary",children:[s.jsxs("span",{className:"cost-summary__label",children:[te("totalCost"),":"]}),s.jsxs("span",{className:"cost-summary__value",children:["",Math.round((X=>X.reduce((oe,fe)=>{const ze=parseFloat(fe.cost)||0,Fe=ia(fe),Je=We(ze,ve),Qe=parseFloat(Je)||0;return oe+Qe*Fe},0))(Ye)).toLocaleString()]}),s.jsx("span",{className:"cost-summary__note",children:"()"})]})}),s.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const X=(oe=>oe.reduce((fe,ze)=>{const Fe=parseFloat(ze.cost)||0,Je=ia(ze),Qe=parseFloat(We(Fe,ve))||0;return fe+Qe*Je},0))(Ye);return at(X)})()]})})]}),s.jsxs("section",{className:"detail-section",children:[s.jsx("h2",{children:te("instructions")}),(()=>{const W=Ae.stepGroups&&Ae.stepGroups.length>0?Ae.stepGroups:null,X=W&&Ft.some(oe=>!oe||typeof oe!="object"||!oe.groupId?!1:W.some(fe=>fe.id===oe.groupId));return W&&X?s.jsx("div",{className:"steps-container",children:W.map(oe=>{const fe=Ft.filter(ze=>(typeof ze=="object"?ze.groupId:null)===oe.id);return fe.length===0?null:s.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[oe.name!==""&&oe.name!=="Steps"&&s.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:oe.name}),s.jsx("div",{className:"steps-list",children:fe.map((ze,Fe)=>{const Je=Ft.indexOf(ze),Qe=typeof ze=="object"?ze.text:ze,wt=qe.steps?.[Je],St=typeof wt=="object"?wt.text:wt,It=et=>et?et.replace(/<[^>]*>?/gm,""):"";return s.jsxs(on,{className:`step-card ${D.has(Je)?"is-completed":""}`,onClick:()=>nn(Je),children:[s.jsx("div",{className:"step-number",children:Je+1}),s.jsx("p",{className:"step-text",children:ft(It(Qe),It(St),!0)})]},Fe)})})]},oe.id)})}):s.jsx("div",{className:"steps-list",children:Ft.map((oe,fe)=>{const ze=typeof oe=="object"?oe.text:oe,Fe=qe.steps?.[fe],Je=typeof Fe=="object"?Fe.text:Fe;return s.jsxs(on,{className:`step-card ${D.has(fe)?"is-completed":""}`,onClick:()=>nn(fe),children:[s.jsx("div",{className:"step-number",children:fe+1}),s.jsx("p",{className:"step-text",children:ft(ze,Je,!0)})]},fe)})})})()]})]})}),s.jsx(wn,{isOpen:z,onClose:()=>H(!1),title:" ",size:"large",children:s.jsxs("div",{className:"print-preview-recipe",children:[s.jsx("div",{className:"preview-header",children:s.jsx("h2",{children:Ae.title})}),s.jsxs("div",{className:"preview-meta",children:[Ae.course&&s.jsxs("div",{children:[s.jsx("strong",{children:":"})," ",Ae.course]}),Ae.category&&s.jsxs("div",{children:[s.jsx("strong",{children:":"})," ",Ae.category]}),Ae.storeName&&s.jsxs("div",{children:[s.jsx("strong",{children:":"})," ",Ae.storeName]}),Ae.servings&&s.jsxs("div",{children:[s.jsx("strong",{children:":"})," ",Ae.servings,""]})]}),Ae.description&&s.jsx("div",{className:"preview-description",children:s.jsx("p",{children:Ae.description})}),s.jsx("div",{className:"preview-controls",children:Ae.type==="bread"?s.jsxs("div",{className:"preview-control-row",children:[s.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),s.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:ae,onChange:W=>xe(W.target.value),placeholder:"1000"}),ae&&s.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>xe(""),children:""}),re?.grandTotal?s.jsxs("span",{className:"preview-control-note",children:[": ",re.grandTotal.toLocaleString(),"g"]}):null]}):s.jsxs("div",{className:"preview-control-row",children:[s.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:te("scaleMultiplier")}),s.jsx("span",{className:"preview-control-mult",children:""}),s.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:ve,onChange:W=>Ee(W.target.value),placeholder:"1"}),String(ve)!=="1"&&s.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>Ee("1"),children:""})]})}),s.jsxs("div",{className:"preview-section",children:[s.jsx("h3",{children:te("ingredients")}),Ae.type==="bread"?s.jsxs("div",{className:"preview-ingredients-bread",children:[s.jsxs("div",{className:"bread-group",children:[s.jsx("h4",{children:te("flourGroup")}),s.jsxs("table",{className:"preview-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantity")})]})}),s.jsx("tbody",{children:(Be.flours||[]).map((W,X)=>{const oe=`flour-${X}`,fe=re?re.getScaledQtyValue(W.quantity):W.quantity;return s.jsxs("tr",{className:A.has(oe)?"is-completed":"",onClick:()=>Gt(oe),role:"button",tabIndex:0,onKeyDown:ze=>{(ze.key==="Enter"||ze.key===" ")&&(ze.preventDefault(),Gt(oe))},children:[s.jsx("td",{children:W.name}),s.jsxs("td",{style:{textAlign:"right"},children:[fe,"g"]})]},X)})})]})]}),s.jsxs("div",{className:"bread-group",children:[s.jsx("h4",{children:te("otherIngredients")}),s.jsxs("table",{className:"preview-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantity")})]})}),s.jsx("tbody",{children:(Be.breadIngredients||[]).map((W,X)=>{const oe=`bread-${X}`,fe=re?re.getScaledQtyValue(W.quantity):W.quantity;return s.jsxs("tr",{className:A.has(oe)?"is-completed":"",onClick:()=>Gt(oe),role:"button",tabIndex:0,onKeyDown:ze=>{(ze.key==="Enter"||ze.key===" ")&&(ze.preventDefault(),Gt(oe))},children:[s.jsx("td",{children:W.name}),s.jsxs("td",{style:{textAlign:"right"},children:[fe,"g"]})]},X)})})]})]})]}):s.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const W=Ae.ingredientGroups&&Ae.ingredientGroups.length>0?Ae.ingredientGroups:null;return W?W.map(X=>{const oe=Ye.filter(fe=>fe.groupId===X.id);return oe.length===0||["","Steps","Method",""].includes(X.name)?null:s.jsxs("div",{className:"ingredient-group",children:[s.jsx("h4",{children:X.name}),s.jsxs("table",{className:"preview-table preview-table--normal",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantity")}),s.jsx("th",{children:te("unit")})]})}),s.jsx("tbody",{children:oe.map((fe,ze)=>{const Fe=`${X.id}-${ze}`,Je=typeof fe=="string"?fe:fe.name,Qe=typeof fe=="object"?be(fe.quantity,Ce):"",wt=typeof fe=="object"?fe.unit:"";return s.jsxs("tr",{className:A.has(Fe)?"is-completed":"",onClick:()=>Gt(Fe),role:"button",tabIndex:0,onKeyDown:St=>{(St.key==="Enter"||St.key===" ")&&(St.preventDefault(),Gt(Fe))},children:[s.jsx("td",{children:Je}),s.jsx("td",{style:{textAlign:"right"},children:Qe}),s.jsx("td",{children:wt})]},ze)})})]})]},X.id)}):s.jsxs("table",{className:"preview-table preview-table--normal",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantity")}),s.jsx("th",{children:te("unit")})]})}),s.jsx("tbody",{children:Ye.map((X,oe)=>{const fe=`ungrouped-${oe}`,ze=typeof X=="string"?X:X.name,Fe=typeof X=="object"?be(X.quantity,Ce):"",Je=typeof X=="object"?X.unit:"";return s.jsxs("tr",{className:A.has(fe)?"is-completed":"",onClick:()=>Gt(fe),role:"button",tabIndex:0,onKeyDown:Qe=>{(Qe.key==="Enter"||Qe.key===" ")&&(Qe.preventDefault(),Gt(fe))},children:[s.jsx("td",{children:ze}),s.jsx("td",{style:{textAlign:"right"},children:Fe}),s.jsx("td",{children:Je})]},oe)})})]})})()})]}),Ft.length>0&&s.jsxs("div",{className:"preview-section",children:[s.jsx("h3",{children:te("instructions")}),s.jsx("ol",{className:"preview-steps",children:Ft.map((W,X)=>{const oe=typeof W=="object"?W.text:W;return s.jsx("li",{className:$.has(X)?"is-completed":"",onClick:()=>cn(X),role:"button",tabIndex:0,onKeyDown:fe=>{(fe.key==="Enter"||fe.key===" ")&&(fe.preventDefault(),cn(X))},children:oe},X)})})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsxs(le,{variant:"primary",onClick:()=>window.print(),children:[" ",te("print")]}),s.jsx(le,{variant:"ghost",onClick:()=>H(!1),children:te("close")})]})]})})]}),s.jsxs("div",{className:"print-layout",children:[s.jsx("div",{className:"recipe-detail__hero",children:Ae.image?s.jsx("img",{src:Ae.image,alt:Ae.title,className:"recipe-detail__image"}):s.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),s.jsxs("div",{className:"recipe-detail__title-card",children:[s.jsx("h1",{children:Vt(Ae.title,qe.title)}),_t&&s.jsx("p",{className:"recipe-detail__desc",children:Vt(_t,qe.description)})]}),s.jsxs("div",{className:"recipe-detail__meta",children:[Ae.category&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("category")}),s.jsx("span",{className:"meta-value",children:Vt(Ae.category,qe.category)})]}),Ae.storeName&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("storeName")}),s.jsx("span",{className:"meta-value meta-value--store",children:Vt(Ae.storeName,qe.storeName)})]}),Ae.course&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("course")}),s.jsx("span",{className:"meta-value",children:Vt(Ae.course,qe.course)})]}),Ae.servings&&s.jsxs("div",{className:"meta-item",children:[s.jsx("span",{className:"meta-label",children:te("servings")}),s.jsx("span",{className:"meta-value",children:Vt(`${Ae.servings}`,qe.servings?`${qe.servings}`:"")})]})]}),Ae.sourceUrl&&s.jsxs("div",{className:"print-layout__source",children:[s.jsx("div",{className:"print-layout__source-label",children:te("sourceRecipe")}),s.jsx("div",{className:"print-layout__source-qr",children:s.jsx(Xx,{value:Ae.sourceUrl,size:84,style:{display:"block"}})})]}),s.jsxs("div",{className:"recipe-detail__main",children:[s.jsxs("section",{className:"detail-section",children:[s.jsx("h2",{children:te("ingredients")}),Ae.type==="bread"&&re?s.jsxs("div",{children:[s.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:te("flourGroup")}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantityGram")}),s.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("purchase")}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("cost")})]})}),s.jsx("tbody",{children:re.flours.map((W,X)=>{const oe=qe.flours?.[X]||{},fe=re.getScaledQtyValue(W.quantity),ze=ae?"":oe.quantity;return s.jsxs("tr",{children:[s.jsx("td",{children:Vt(W.name,oe.name)}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Vt(fe,ze)}),s.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[re.calcPercent(W.quantity),"%"]}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(W.purchaseCost)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:W.cost?`${re.formatCostValue(W.cost)}`:"-"})]},`print-flour-${X}`)})})]})]}),s.jsxs("div",{className:"bread-section",children:[s.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:te("otherIngredients")}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:te("ingredientName")}),s.jsx("th",{style:{textAlign:"right"},children:te("quantityGram")}),s.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("purchase")}),s.jsx("th",{style:{textAlign:"right",width:"80px"},children:te("cost")})]})}),s.jsx("tbody",{children:re.others.map((W,X)=>{const oe=qe.breadIngredients?.[X]||{},fe=re.getScaledQtyValue(W.quantity),ze=ae?"":oe.quantity;return s.jsxs("tr",{children:[s.jsx("td",{children:Vt(W.name,oe.name)}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Vt(fe,ze)}),s.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[re.calcPercent(W.quantity),"%"]}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(W.purchaseCost)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:W.cost?`${re.formatCostValue(W.cost)}`:"-"})]},`print-others-${X}`)})})]})]})]}):ot.map(W=>{const X=qe.ingredientGroups?.find(oe=>oe.id===W.id)?.name||"";return s.jsxs("div",{style:{marginBottom:"1.2rem"},children:[W.name&&s.jsx("div",{className:"print-group-heading",children:Vt(W.name,X)}),s.jsxs("table",{className:"ingredients-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40%"},children:te("ingredientName")}),s.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:te("quantity")}),s.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:te("unit")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("purchase")}),s.jsx("th",{style:{width:"15%",textAlign:"right"},children:te("cost")})]})}),s.jsx("tbody",{children:W.items.map((oe,fe)=>{const ze=typeof oe=="object"?oe.quantity:"",Fe=typeof oe=="object"?oe.unit:"",Je=typeof oe=="object"?oe.purchaseCost:null,Qe=typeof oe=="object"?oe.cost:null,wt=typeof oe=="string"?oe:oe.name,St=typeof oe=="object"?be(oe.quantity,Ce):ze,It=Ye.indexOf(oe),et=qe.ingredients?.[It],Nt=et?typeof et=="string"?et:et.name:"",Qt=et&&typeof et=="object"?et.unit:"",un=String(Ce)==="1"&&et&&typeof et=="object"?et.quantity:"";return s.jsxs("tr",{children:[s.jsx("td",{children:Vt(wt,Nt)}),s.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:Vt(St,un)}),s.jsx("td",{style:{paddingLeft:"0.5rem"},children:Vt(Fe,Qt)}),s.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(Je)??"-"}),s.jsx("td",{style:{textAlign:"right"},children:vs(Qe)??"-"})]},`print-ing-${W.id}-${fe}`)})})]})]},W.id)}),s.jsxs("div",{className:"cost-summary",children:[s.jsxs("span",{className:"cost-summary__label",children:[te("totalCost"),":"]}),s.jsxs("span",{className:"cost-summary__value",children:["",Ve]}),s.jsx("span",{className:"cost-summary__note",children:"()"})]}),s.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),s.jsxs("section",{className:"detail-section",children:[s.jsx("h2",{children:te("instructions")}),Ft.length>0?s.jsx("div",{className:"steps-list",children:Ft.map((W,X)=>{const oe=typeof W=="object"?W.text:W,fe=qe.steps?.[X],ze=typeof fe=="object"?fe?.text:fe;return s.jsxs("div",{className:"step-card",children:[s.jsx("div",{className:"step-number",children:X+1}),s.jsx("p",{className:"step-text",children:Vt(oe,ze)})]},`print-step-${X}`)})}):s.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:te("noSteps")})]})]})]})]})},Yb=n=>{if(n==null)return"";let t=String(n);return t=t.replace(/[-]/g,i=>String.fromCharCode(i.charCodeAt(0)-65248)),t=t.replace(/[--]/g,i=>String.fromCharCode(i.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},zt=({label:n,id:t,error:i,textarea:a,...o})=>{const u=a?"textarea":"input",d=o.type==="number"||o.inputMode==="decimal"||o.inputMode==="numeric",f=h=>{if(!o.onChange)return;if(!d){o.onChange(h);return}const m=h?.target?.value??"",y=Yb(m);if(y===m){o.onChange(h);return}o.onChange({target:{id:h?.target?.id,name:h?.target?.name,value:y}})};return s.jsxs("div",{className:`input-group ${i?"input-group--error":""} ${o.wrapperClassName||""}`,children:[n&&s.jsx("label",{htmlFor:t,className:"input-label",children:n}),s.jsx(u,{id:t,className:`input-field ${o.className||""}`,style:o.style,...o,onChange:f}),i&&s.jsx("span",{className:"input-error",children:i})]})},xs="app-data",ir={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await Ne.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const i=String(t||"").replace(/^\/+/,"");return`${n}/${i}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:i}=await Ne.storage.from(xs).list(n);if(i)return console.warn("Failed to list price files:",i.message),[];if(!t||t.length===0)return[];const a=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:f,error:h}=await Ne.storage.from(xs).download(d);if(h)return console.error(`Failed to download ${u.name}:`,h),null;const m=await f.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(m)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(m)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(a)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const i=this._cacheByUserId.get(t);if(i)return i;try{const a=new Map,o=await this._downloadAllCsvTexts(t);if(!o||o.length===0)return new Map;for(const{text:u}of o){if(!u)continue;const d=this.parseCSV(u);for(const[f,h]of d)if(a.has(f)){const m=a.get(f);(h?.dateStr||"")>(m?.dateStr||"")&&a.set(f,h)}else a.set(f,h)}return this._cacheByUserId.set(t,a),a}catch(a){return console.error("Error in fetchPriceList:",a),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:i,error:a}=await Ne.storage.from(xs).list(t);if(a)throw a;return i.filter(o=>String(o?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=n.name;this.clearCache(i);const o=this._getUserScopedPath(i,a),{data:u,error:d}=await Ne.storage.from(xs).upload(o,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(i){return console.error("Error uploading price list:",i),{success:!1,error:i}}},async deletePriceFile(n,t=null){try{const i=t||await this._getCurrentUserId();if(!i)throw new Error("");this.clearCache(i);const a=this._getUserScopedPath(i,n),{data:o,error:u}=await Ne.storage.from(xs).remove([a]);if(u)throw u;if(!o||o.length===0)throw new Error("");return{success:!0,data:o}}catch(i){return console.error("Error deleting price file:",i),{success:!1,error:i}}},_splitFileName(n){const t=String(n||""),i=t.lastIndexOf(".");return i<=0?{base:t,ext:""}:{base:t.slice(0,i),ext:t.slice(i)}},_makeCopyFileName(n,t){const i=String(n||"");if(!t?.has?.(i))return i;const{base:a,ext:o}=this._splitFileName(i),u=a||i||"price";let d=1;for(;d<1e3;){const f=d===1?"_copy":`_copy${d}`,h=`${u}${f}${o}`;if(!t.has(h))return h;d++}return`${u}_copy_${Date.now()}${o}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:t=null,onProgress:i=null}={}){const a=t||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("");if(o===a)throw new Error("");const{data:u,error:d}=await Ne.storage.from(xs).list(a);if(d)throw d;const f=(u||[]).map(b=>b?.name).filter(Boolean).filter(b=>String(b).toLowerCase().endsWith(".csv")),{data:h,error:m}=await Ne.storage.from(xs).list(o);let y=new Set;if(m){const b=String(m?.message||"").toLowerCase();if(b.includes("not found")||b.includes("404"))y=new Set;else throw m}else y=new Set((h||[]).map(b=>b?.name).filter(Boolean));const v={sourceUserId:a,targetUserId:o,copied:[],skipped:[],failed:[]},x=f.length;i?.({phase:"start",total:x,done:0,current:""});for(let b=0;b<f.length;b++){const _=f[b],C=this._makeCopyFileName(_,y);y.add(C);const S=this._getUserScopedPath(a,_),N=this._getUserScopedPath(o,C);i?.({phase:"progress",total:x,done:b,current:`${_}  ${C}`,fromFile:_,toFile:C});try{const{data:k,error:D}=await Ne.storage.from(xs).download(S);if(D)throw D;if(!k)throw new Error("");const{error:L}=await Ne.storage.from(xs).upload(N,k,{upsert:!1,contentType:"text/csv"});if(L){const $=String(L?.message||"").toLowerCase();if($.includes("already exists")||$.includes("exists")||$.includes("409")){let E=0,A=L;for(;E<5;){E++;const R=this._makeCopyFileName(_,y);y.add(R);const M=this._getUserScopedPath(o,R),{error:V}=await Ne.storage.from(xs).upload(M,k,{upsert:!1,contentType:"text/csv"});if(!V){v.copied.push({fromFile:_,toFile:R}),A=null;break}A=V}if(A)throw A;continue}throw L}v.copied.push({fromFile:_,toFile:C})}catch(k){console.error("copyPriceFilesToUser failed:",k),v.failed.push({file:_,errorMessage:String(k?.message||k)})}i?.({phase:"progress",total:x,done:b+1,current:`${_}  ${C}`,fromFile:_,toFile:C})}return i?.({phase:"done",total:x,done:x,current:"",result:v}),this.clearCache(o),v},parseCSV(n){const t=new Map,i=n.split(/\r?\n/).filter(o=>o.trim());if(i.length===0)return t;if(i.some(o=>o.startsWith("D,")||o.startsWith('"D",')))for(let o of i){const u=[];let d="",f=!1;for(let S=0;S<o.length;S++){const N=o[S];N==='"'?f=!f:N===","&&!f?(u.push(d),d=""):d+=N}u.push(d);const h=u.map(S=>(S=S.trim(),S.startsWith('"')&&S.endsWith('"')?S.slice(1,-1):S));if(h[0]!=="D")continue;const m=h[1],y=h[8],v=h[14],x=h[18],b=h[20],_=String(v??"").trim(),C=Wt(_);if(C&&x){const S=parseFloat(x);if(!isNaN(S)){const N={price:S,vendor:y,unit:b,dateStr:m,displayName:_};if(t.has(C)){const k=t.get(C);(m||"")>=(k?.dateStr||"")&&t.set(C,N)}else t.set(C,N)}}}else{let o={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(i[0].split(",").map(h=>h.trim().replace(/^"|"$/g,"")).forEach((h,m)=>{["","","","","name","item"].some(y=>h.includes(y))&&(o.name=m),["","","","","price","cost"].some(y=>h.includes(y))&&(o.price=m),["","unit"].some(y=>h.includes(y))&&(o.unit=m),["","","","vendor","supplier"].some(y=>h.includes(y))&&(o.vendor=m)}),o.name===-1&&o.price===-1){o={name:0,price:1,unit:2,vendor:3};const h=i[0].split(",");isNaN(parseFloat(h[1]))&&(u=1)}else u=1;const f=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let h=u;h<i.length;h++){const m=i[h],y=[];let v="",x=!1;for(let L=0;L<m.length;L++){const $=m[L];$==='"'?x=!x:$===","&&!x?(y.push(v),v=""):v+=$}y.push(v);const b=y.map(L=>(L=L.trim(),L.startsWith('"')&&L.endsWith('"')?L.slice(1,-1):L)),_=o.name>-1?b[o.name]:null,C=o.price>-1?b[o.price]:null,S=o.unit>-1?b[o.unit]:"",N=o.vendor>-1?b[o.vendor]:"",k=String(_??"").trim(),D=Wt(k);if(D&&C){const L=parseFloat(C.replace(/[^0-9.]/g,""));isNaN(L)||t.set(D,{price:L,vendor:N,unit:S,dateStr:f,displayName:k})}}}return t},parseCSVEntries(n,t=""){const i=[],a=n.split(/\r?\n/).filter(x=>x.trim());if(a.length===0)return i;const o=x=>{const b=String(x??"").trim();if(!b)return null;const _=parseFloat(b.replace(/[^0-9.]/g,""));return Number.isFinite(_)?_:null},u=x=>{const b=[];let _="",C=!1;for(let S=0;S<x.length;S++){const N=x[S];N==='"'?C=!C:N===","&&!C?(b.push(_),_=""):_+=N}return b.push(_),b.map(S=>(S=S.trim(),S.startsWith('"')&&S.endsWith('"')?S.slice(1,-1):S))},d=x=>{const b=String(x??"").trim();if(!b)return"";const _=b.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(_)return`${_[1]}/${String(_[2]).padStart(2,"0")}/${String(_[3]).padStart(2,"0")}`;const C=b.match(/^(\d{4})(\d{2})(\d{2})$/);return C?`${C[1]}/${C[2]}/${C[3]}`:b};if(a.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of a){const b=u(x);if(b[0]!=="D")continue;const _=d(b[1]),C=b[8],S=b[14],N=b[18],k=o(b[19]),D=b[20],L=String(S??"").trim(),$=Wt(L);if(!$||!N)continue;const E=o(N);Number.isFinite(E)&&i.push({key:$,displayName:L,price:E,vendor:C,unit:D,dateStr:_,incomingQty:k,sourceFile:t})}return i}let h={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},m=0;if(a[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,b)=>{const _=String(x||"").toLowerCase();["","","","","name","item"].some(C=>_.includes(C))&&(h.name=b),["","","","","price","cost"].some(C=>_.includes(C))&&(h.price=b),["","unit"].some(C=>_.includes(C))&&(h.unit=b),["","","","vendor","supplier"].some(C=>_.includes(C))&&(h.vendor=b),["","","","date"].some(C=>_.includes(C))&&(h.date=b),["","","","","","qty","quantity"].some(C=>_.includes(C))&&(h.quantity=b)}),h.name===-1&&h.price===-1){h={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=a[0].split(",");isNaN(parseFloat(x[1]))&&(m=1)}else m=1;const v=d(new Date().toISOString().slice(0,10));for(let x=m;x<a.length;x++){const b=u(a[x]),_=h.name>-1?b[h.name]:null,C=h.price>-1?b[h.price]:null,S=h.unit>-1?b[h.unit]:"",N=h.vendor>-1?b[h.vendor]:"",k=h.date>-1?b[h.date]:"",D=h.quantity>-1?o(b[h.quantity]):null,L=String(_??"").trim(),$=Wt(L);if(!$||!C)continue;const E=o(C);Number.isFinite(E)&&i.push({key:$,displayName:L,price:E,vendor:N,unit:S,dateStr:d(k)||v,incomingQty:D,sourceFile:t})}return i},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const i=this._historyCacheByUserId.get(t);if(i)return i;try{const a=await this._downloadAllCsvTexts(t);if(!a||a.length===0)return new Map;const o=new Map;for(const{fileName:u,text:d}of a){if(!d)continue;this.parseCSVEntries(d,u).forEach(h=>{const m=h?.key;m&&(o.has(m)||o.set(m,[]),o.get(m).push(h))})}for(const u of o.values())u.sort((d,f)=>{const h=String(d?.dateStr||""),m=String(f?.dateStr||"");if(h!==m)return h.localeCompare(m);const y=Number(d?.price),v=Number(f?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(f?.sourceFile||""))});return this._historyCacheByUserId.set(t,o),o}catch(a){return console.error("Error in fetchPriceHistory:",a),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),i=[];for(const[a,o]of t.entries())if(o&&typeof o=="object"){const{displayName:u,...d}=o;i.push({name:u||a,...d})}else i.push({name:a,price:o});return i.sort((a,o)=>a.dateStr&&o.dateStr?o.dateStr.localeCompare(a.dateStr):a.name.localeCompare(o.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(Wt(n))||null}},ec={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:i}=await Ne.rpc("search_ingredients",{search_query:n,max_results:15});return i?(console.warn(" Database search failed:",i),console.warn("Error message:",i.message),console.warn("Error code:",i.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){const t=String(n||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const i=t.toLowerCase(),a=Wt(t);try{const o=await this._searchFromDatabase(i);if(o&&Array.isArray(o)){this._lastDbResults=o,this._lastDbQuery=i;const d=o.map(S=>({name:S.ingredient_name,price:S.last_price,size:S.packet_size,unit:S.packet_unit,itemCategory:S.item_category||null,source:"manual",displaySource:" "}));if(d.length===0)return await this._fallbackSearch(i);if(!this._csvCache){const S=await ir.getPriceListArray();this._csvCache=S.map(N=>({name:N.name,price:N.price,size:null,unit:N.unit,source:"csv",displaySource:" CSV"}))}const f=S=>{if(!a)return null;const N=String(S||"").indexOf(a);return N<0?null:{tier:S===a?0:N===0?1:2,idx:N,len:String(S||"").length}},h=(S,N)=>S.score.tier!==N.score.tier?S.score.tier-N.score.tier:S.score.idx!==N.score.idx?S.score.idx-N.score.idx:S.score.len!==N.score.len?S.score.len-N.score.len:S.name.localeCompare(N.name,"ja"),m=(S,N,k)=>{let D=0;for(;D<S.length&&h(S[D],N)<=0;)D++;S.splice(D,0,N),S.length>k&&S.pop()},v=Math.max(0,15-d.length),x=new Set(d.map(S=>Wt(S.name))),b=[],_=new Set;if(v>0)for(const S of this._csvCache){const N=Wt(S?.name);if(!N||x.has(N)||_.has(N))continue;const k=f(N);k&&(_.add(N),m(b,{...S,nameKey:N,score:k},v))}const C=b.map(S=>({name:S.name,price:S.price,size:S.size,unit:S.unit,source:S.source,displaySource:S.displaySource}));return[...d,...C]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",o);const u=await this._fallbackSearch(i);return console.log(" Fallback search returned:",u.length,"results"),u}catch(o){return console.error("Error searching ingredients:",o),[]}},async _fallbackSearch(n){try{const t=Wt(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[h,m]=await Promise.all([ir.getPriceListArray(),zn.getAllConversions()]);console.log(" CSV Data rows:",h.length),console.log(" Manual Data items:",m.size);const y=Array.from(m.values()).map(_=>({name:_.ingredientName,price:_.lastPrice,size:_.packetSize,unit:_.packetUnit,itemCategory:_.itemCategory||null,source:"manual",displaySource:" "})),v=h.map(_=>({name:_.name,price:_.price,size:null,unit:_.unit,source:"csv",displaySource:" CSV"})),x=new Set(y.map(_=>_.name)),b=v.filter(_=>!x.has(_.name));this._csvCache=[...y,...b],console.log(" Cache built. Total items:",this._csvCache.length)}const i=h=>{if(!t)return null;const m=String(h||"").indexOf(t);return m<0?null:{tier:h===t?0:m===0?1:2,idx:m,len:String(h||"").length}},a=(h,m)=>h.score.tier!==m.score.tier?h.score.tier-m.score.tier:h.score.idx!==m.score.idx?h.score.idx-m.score.idx:h.score.len!==m.score.len?h.score.len-m.score.len:h.name.localeCompare(m.name,"ja"),o=(h,m,y)=>{let v=0;for(;v<h.length&&a(h[v],m)<=0;)v++;h.splice(v,0,m),h.length>y&&h.pop()},u=15,d=[],f=new Set;for(const h of this._csvCache){const m=Wt(h?.name);if(!m||f.has(m))continue;const y=i(m);y&&(f.add(m),o(d,{...h,nameKey:m,score:y},u))}return d.map(h=>({name:h.name,price:h.price,size:h.size,unit:h.unit,itemCategory:h.itemCategory||null,source:h.source,displaySource:h.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},vd=({value:n,onChange:t,placeholder:i,disabled:a,onSelect:o,name:u,required:d=!1})=>{const[f,h]=w.useState([]),[m,y]=w.useState(!1),[v,x]=w.useState(-1),b=w.useRef(null),_=w.useRef(null),[C,S]=w.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),N=w.useCallback(()=>{if(b.current){const A=b.current.getBoundingClientRect(),R=8,M=4,V=A.top-R,U=window.innerHeight-A.bottom-R,ne=(V>=180||V>=U)&&V>=110,P=Math.max(110,Math.min(280,ne?V-M:U-M)),B=A.left,T=Math.max(220,window.innerWidth-R*2),z=Math.min(Math.max(A.width,220),T),H=Math.min(Math.max(R,B),window.innerWidth-R-z);S({top:ne?A.top-M:A.bottom+M,left:H,width:z,maxHeight:P,placeAbove:ne})}},[]);w.useEffect(()=>{const A=V=>{b.current&&!b.current.contains(V.target)&&_.current&&!_.current.contains(V.target)&&y(!1)},R=V=>{_.current&&_.current.contains(V.target)||y(!1)},M=()=>{m&&N()};return document.addEventListener("mousedown",A),window.addEventListener("scroll",R,{capture:!0}),window.addEventListener("resize",M),()=>{document.removeEventListener("mousedown",A),window.removeEventListener("scroll",R,{capture:!0}),window.removeEventListener("resize",M)}},[m,N]),w.useEffect(()=>{m&&N()},[m,f,N]);const k=w.useRef(0),D=w.useRef(null),L=async A=>{const R=A.target.value;if(t(A),D.current&&clearTimeout(D.current),R.length===0){y(!1);return}D.current=setTimeout(async()=>{if(R.length>0){const M=++k.current;console.log(" AutocompleteInput: Fetching suggestions for:",R);const V=await ec.search(R);console.log(" AutocompleteInput: Got",V.length,"suggestions"),M===k.current&&(h(V),y(V.length>0),x(-1))}},150)},$=A=>{const R={target:{value:A.name}};t(R),y(!1),o&&o(A)},E=A=>{m&&(A.key==="ArrowDown"?(A.preventDefault(),x(R=>R<f.length-1?R+1:R)):A.key==="ArrowUp"?(A.preventDefault(),x(R=>R>0?R-1:-1)):A.key==="Enter"?v>=0&&(A.preventDefault(),$(f[v])):A.key==="Escape"&&y(!1))};return s.jsxs("div",{className:"autocomplete-wrapper",ref:b,children:[s.jsx("input",{type:"text",className:"input-field autocomplete-input",name:u,value:n,onChange:L,onKeyDown:E,onFocus:async()=>{if(n&&n.length>0){N();const A=await ec.search(n);h(A),y(A.length>0)}else N()},placeholder:i,disabled:a,required:d}),m&&pa.createPortal(s.jsx("ul",{className:"suggestions-list",ref:_,style:{position:"fixed",top:`${C.top}px`,left:`${C.left}px`,width:`${C.width}px`,maxHeight:`${C.maxHeight}px`,transform:C.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:f.map((A,R)=>s.jsxs("li",{className:`suggestion-item ${R===v?"selected":""}`,onClick:()=>$(A),onMouseEnter:()=>x(R),children:[s.jsxs("div",{className:"suggestion-main",children:[s.jsx("span",{className:"suggestion-name",children:A.name}),A?.source&&A.source!=="manual"&&s.jsx("span",{className:"suggestion-source",children:A.displaySource})]}),s.jsxs("div",{className:"suggestion-details",children:[A.price&&`${Number(A.price).toLocaleString()}`,A.size&&` / ${A.size}${A.unit}`,!A.size&&A.unit&&` / ${A.unit}`]})]},`${A.source}-${R}`))}),document.body)]})},Wb=({isOpen:n,onClose:t,onApply:i,ingredientName:a,currentCost:o,currentQuantity:u,unit:d="g",initialPurchaseCost:f,initialContentAmount:h})=>{const[m,y]=w.useState(""),[v,x]=w.useState(""),[b,_]=w.useState(d),[C,S]=w.useState(""),[N,k]=w.useState(!1),[D,L]=w.useState(!1),$=w.useCallback(async()=>{if(L(!0),S(""),f&&h){y(f),x(h);const U=await zn.getConversion(a);if(U)_(U.packetUnit||d),S(U.vendor||"");else{_(d);try{const F=await ir.getPrice(a);S(F?.vendor||"")}catch{}}}else{const U=await zn.getConversion(a);if(U)x(U.packetSize),_(U.packetUnit||d),U.lastPrice&&y(U.lastPrice),S(U.vendor||"");else try{const F=await ir.getPrice(a);if(F)if(y(o||F.price),S(F.vendor||""),F.unit){const ne=F.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(ne){let P=ne[1]?parseFloat(ne[1]):1,B=ne[2]?ne[2].trim().toLowerCase():"";B==="kg"?(P*=1e3,B="g"):B==="l"?(P*=1e3,B="ml"):B==="pk"||B==="pack"?B="":B==="bag"?B="":(B==="pc"||B==="pcs")&&(B=""),x(P),_(B||d)}else x(1),_(F.unit)}else x(""),_(d);else x(""),y(o||""),_(d),S("")}catch(F){console.warn("Failed to load master price:",F),x(""),y(o||""),_(d),S("")}}L(!1)},[a,f,h,d,o]);w.useEffect(()=>{if(!n||!a)return;const U=setTimeout(()=>{$()},0);return()=>clearTimeout(U)},[n,a,$]);const E=()=>{const U=parseFloat(m),F=parseFloat(v);return!U||!F?0:["g","ml","cc"].includes(b)?U/F*1e3:U/F},A=async()=>{const U=E();if(N&&v)try{await zn.saveConversion(a,v,b,m,null,C)}catch(F){console.error("Failed to save default conversion:",F)}i(U,b,m,v,C),t()};if(!n)return null;const R=E(),M=u?R*(u/(["g","ml"].includes(d)?1e3:1)):0,V=s.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:s.jsx("div",{className:"unit-conversion-modal__card",onClick:U=>U.stopPropagation(),children:s.jsxs("div",{className:"unit-conversion-modal__body",children:[s.jsx("h3",{className:"unit-conversion-modal__title",children:""}),s.jsxs("div",{className:"unit-conversion-modal__field",children:[s.jsx("span",{className:"unit-conversion-modal__label",children:""}),s.jsx("div",{className:"unit-conversion-modal__value",children:a||"()"})]}),s.jsxs("div",{className:"unit-conversion-modal__inputs",children:[s.jsxs("div",{children:[s.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),s.jsx("input",{type:"number",value:m,onChange:U=>y(U.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"unit-conversion-modal__label",children:""}),s.jsxs("div",{className:"unit-conversion-modal__row",children:[s.jsx("input",{type:"number",value:v,onChange:U=>x(U.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),s.jsxs("select",{value:b,onChange:U=>_(U.target.value),className:"unit-conversion-modal__select",children:[s.jsx("option",{value:"g",children:"g"}),s.jsx("option",{value:"ml",children:"ml"}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:"p"}),s.jsx("option",{value:"cc",children:"cc"}),!["g","ml","","","","","","cc"].includes(b)&&s.jsx("option",{value:b,children:b})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"unit-conversion-modal__label",children:""}),s.jsx("input",{type:"text",value:C,onChange:U=>S(U.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),s.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:D?s.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[s.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),s.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(R).toLocaleString()]})]}),u&&s.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[s.jsxs("span",{children:[" (",u,d,"):"]}),s.jsxs("span",{children:["",Math.round(M).toLocaleString()]})]})]})}),s.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[s.jsx("input",{type:"checkbox",id:"saveDefault",checked:N,onChange:U=>k(U.target.checked)}),s.jsxs("span",{children:["(",v,b,")"]})]}),s.jsxs("div",{className:"unit-conversion-modal__actions",children:[s.jsx(le,{type:"button",variant:"secondary",onClick:t,disabled:D,children:""}),s.jsx(le,{type:"button",variant:"primary",onClick:A,disabled:!m||!v||D,children:""})]})]})})});return pa.createPortal(V,document.body)},Nk=new Set(["food","alcohol","soft_drink","supplies"]),Ek=new Set(["alcohol","supplies"]),Qb={food:"",alcohol:"",soft_drink:"",supplies:""},Ri=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":Nk.has(t)?t:"":""},xd=n=>Ek.has(n),rp=(n,t)=>{const i=Ri(t);return i?{...n,itemCategory:i,isAlcohol:xd(i)}:{...n,itemCategory:null}},Jn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},Ep=n=>{const t=Jn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},aa=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return Ep(i)/100},kk=(n,t,i)=>{const a=Jn(n),o=Jn(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},r0=(n,t,i,a=!1,o=1)=>{const u=Jn(n),d=Jn(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const f=Number.isFinite(o)&&o>0?o:1;if(a)return u/1e3*d/f;const h=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(h)||!h?u/1e3*d/f:u*d/f},Tk=(n,t)=>{const i=Jn(n?.purchaseCost),a=Jn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},s0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Gr=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=s0(t);if(!a)return null;for(const[o,u]of n.entries())if(s0(o)===a)return u;return null},Ak=({formData:n,setFormData:t})=>{const[i,a]=w.useState(new Map),[o,u]=w.useState({isOpen:!1,type:null,index:null}),[d,f]=w.useState(new Map);w.useEffect(()=>{(async()=>{const[A,R]=await Promise.all([ir.fetchPriceList(),zn.getAllConversions()]);a(A),f(R)})()},[]);const m=(E=>E.reduce((A,R)=>A+(parseFloat(R.quantity)||0),0))(n.flours||[]),y=E=>!m||m===0?0:((parseFloat(E)||0)/m*100).toFixed(1);w.useEffect(()=>{if(d.size===0)return;const E=(M=[])=>{let V=!1;return{adjusted:M.map(F=>{if(!F||typeof F!="object")return F;const ne=Gr(d,F.name);let P=F;const B=Ri(F.itemCategory??F.item_category??ne?.itemCategory);if(B){const de=xd(B);(Ri(F.itemCategory??F.item_category)!==B||!!F.isAlcohol!==de)&&(P={...P,itemCategory:B,isAlcohol:de})}const T=aa(F,ne),z=r0(F.quantity,P.purchaseCost,F.unit,!0,T),H=Number.isFinite(z)?Math.round(z*100)/100:NaN,J=Jn(P.cost);if(Number.isFinite(H)&&(!Number.isFinite(J)||Math.abs(J-H)>.01)&&(P={...P,cost:H}),ne&&ne.packetSize){const q=[ne.lastPrice,F.purchaseCostRef,F.purchase_cost,F.purchaseCost].find(ae=>Number.isFinite(Jn(ae))),Y=kk(q,ne.packetSize,ne.packetUnit);if(Number.isFinite(Y)&&Tk(F,Y)){const ae=aa(F,ne),xe=Math.round(Y*100)/100,ve=r0(F.quantity,xe,F.unit,!0,ae),Ee=Number.isFinite(ve)?Math.round(ve*100)/100:P.cost,he=Jn(P.purchaseCost),G=Jn(P.cost),ge=!Number.isFinite(he)||Math.abs(he-xe)>.01,Z=Number.isFinite(Jn(Ee))&&(!Number.isFinite(G)||Math.abs(G-Ee)>.01);(ge||Z)&&(P={...P,purchaseCost:xe,cost:Ee})}}return P!==F&&(V=!0),P}),changed:V}},A=E(n.flours||[]),R=E(n.breadIngredients||[]);!A.changed&&!R.changed||t(M=>({...M,flours:A.adjusted,breadIngredients:R.adjusted}))},[d,n.breadIngredients,n.flours,t]);const v=(E,A,R)=>{const M=[...n.flours||[]];if(M[E]={...M[E],[A]:R},A==="name"){const V=i.get(Wt(R));if(V){const U=typeof V=="object"?V.price:V,F=typeof V=="object"?V.vendor:null,ne=typeof V=="object"?V.unit:null;M[E].purchaseCostRef=U,M[E].vendorRef=F;const P=Gr(d,R);if(P&&P.packetSize){let T=0;const z=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:U,H=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(H)?T=z/P.packetSize*1e3:["kg",""].includes(H)?T=z/P.packetSize:["ml","","cc",""].includes(H)?T=z/P.packetSize*1e3:(["l",""].includes(H),T=z/P.packetSize),M[E].purchaseCost=Math.round(T*100)/100,M[E].unit="g"}else M[E].purchaseCost||(M[E].purchaseCost=U,!M[E].unit&&ne&&(M[E].unit=ne));const B=Ri(P?.itemCategory);B?M[E]=rp(M[E],B):M[E].itemCategory=null}else M[E].purchaseCostRef=null,M[E].vendorRef=null,M[E].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(A)||A==="name"){const V=M[E],U=parseFloat(V.quantity),F=parseFloat(V.purchaseCost);if(!isNaN(U)&&!isNaN(F)){let ne=0;const P=(V.unit||"").trim().toLowerCase();P==="g"||P===""||P==="ml"||P===""||P==="cc"||P===""||!P?ne=U/1e3*F:ne=U*F;const B=Gr(d,V.name),T=aa(V,B),z=Number.isFinite(T)&&T>0?T:1,H=Math.round(ne/z*100)/100;H!==V.cost&&(M[E].cost=H)}}t(V=>({...V,flours:M}))},x=(E,A,R)=>{const M=[...n.breadIngredients||[]];if(M[E]={...M[E],[A]:R},A==="name"){const V=i.get(Wt(R));if(V){const U=typeof V=="object"?V.price:V,F=typeof V=="object"?V.vendor:null,ne=typeof V=="object"?V.unit:null;M[E].purchaseCostRef=U,M[E].vendorRef=F;const P=Gr(d,R);if(P&&P.packetSize){let T=0;const z=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:U,H=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(H)?(T=z/P.packetSize*1e3,M[E].unit="g"):["kg",""].includes(H)?(T=z/P.packetSize,M[E].unit="g"):["ml","","cc",""].includes(H)?(T=z/P.packetSize*1e3,M[E].unit="ml"):["l",""].includes(H)?(T=z/P.packetSize,M[E].unit="ml"):(T=z/P.packetSize,M[E].unit=P.packetUnit),M[E].purchaseCost=Math.round(T*100)/100}else M[E].purchaseCost||(M[E].purchaseCost=U,!M[E].unit&&ne&&(M[E].unit=ne));const B=Ri(P?.itemCategory);B?M[E]=rp(M[E],B):M[E].itemCategory=null}else M[E].purchaseCostRef=null,M[E].vendorRef=null,M[E].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(A)||A==="name"){const V=M[E],U=parseFloat(V.quantity),F=parseFloat(V.purchaseCost);if(!isNaN(U)&&!isNaN(F)){let ne=0;const P=V.unit?V.unit.trim().toLowerCase():"g";P==="g"||P===""||P==="ml"||P===""||P==="cc"||P===""?ne=U/1e3*F:ne=U*F;const B=Gr(d,V.name),T=aa(V,B),z=Number.isFinite(T)&&T>0?T:1,H=Math.round(ne/z*100)/100;H!==V.cost&&(M[E].cost=H)}}t(V=>({...V,breadIngredients:M}))},b=()=>{t(E=>({...E,flours:[...E.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},_=()=>{t(E=>({...E,breadIngredients:[...E.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},C=E=>{t(A=>({...A,flours:A.flours.filter((R,M)=>M!==E)}))},S=E=>{t(A=>({...A,breadIngredients:A.breadIngredients.filter((R,M)=>M!==E)}))},N=ba(ur(Al,{activationConstraint:{distance:10}}),ur(Rl,{activationConstraint:{delay:250,tolerance:5}}),ur(Tl,{coordinateGetter:pd})),k=E=>{const{active:A,over:R}=E;A.id!==R.id&&t(M=>{const U=M.flours.some(P=>P.id===A.id)?"flours":"breadIngredients",F=M[U].findIndex(P=>P.id===A.id),ne=M[U].findIndex(P=>P.id===R.id);return F!==-1&&ne!==-1?{...M,[U]:zi(M[U],F,ne)}:M})};w.useEffect(()=>{if(!n.flours)t(E=>({...E,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const E=n.flours.map(A=>A.id?A:{...A,id:crypto.randomUUID()});JSON.stringify(E)!==JSON.stringify(n.flours)&&t(A=>({...A,flours:E}))}if(!n.breadIngredients)t(E=>({...E,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const E=n.breadIngredients.map(A=>A.id?A:{...A,id:crypto.randomUUID()});JSON.stringify(E)!==JSON.stringify(n.breadIngredients)&&t(A=>({...A,breadIngredients:E}))}},[]);const D=(E,A,R,M)=>{const{type:V,index:U}=o;t(F=>{if(V==="flour"){const ne=[...F.flours],P={...ne[U],purchaseCost:E,unit:A,purchase_cost:R,content_amount:M},B=parseFloat(P.quantity),T=parseFloat(E);if(!isNaN(B)&&!isNaN(T)){let z=0;A==="g"||A===""?z=B/1e3*T:z=B*T;const H=Gr(d,P.name),J=aa(P,H),de=Number.isFinite(J)&&J>0?J:1;P.cost=Math.round(z/de*100)/100}return ne[U]=P,zn.getAllConversions().then(z=>f(z)),ec.invalidateCache(),{...F,flours:ne}}else if(V==="ingredient"){const ne=[...F.breadIngredients],P={...ne[U],purchaseCost:E,unit:A,purchase_cost:R,content_amount:M},B=parseFloat(P.quantity),T=parseFloat(E);if(!isNaN(B)&&!isNaN(T)){let z=0;A==="g"||A===""?z=B/1e3*T:z=B*T;const H=Gr(d,P.name),J=aa(P,H),de=Number.isFinite(J)&&J>0?J:1;P.cost=Math.round(z/de*100)/100}return ne[U]=P,zn.getAllConversions().then(z=>f(z)),ec.invalidateCache(),{...F,breadIngredients:ne}}return F})},L=(E,A,R)=>{R&&t(M=>{const V=E==="flour"?"flours":"breadIngredients",U=[...M[V]||[]],F={...U[A]};if(F.name=R.name,F.itemCategory=null,R.price!==void 0&&R.price!==null&&R.price!==""){F.purchaseCostRef=R.price,F.vendorRef=R.source==="csv"?"CSV":"Master";let T=R.price,z=R.unit;if(R.source==="manual")if(R.size&&R.size>0){const H=(R.unit||"").trim().toLowerCase();["g",""].includes(H)?(T=R.price/R.size*1e3,z="g"):["kg",""].includes(H)?(T=R.price/R.size,z="g"):["ml","","cc",""].includes(H)?(T=R.price/R.size*1e3,z="ml"):["l",""].includes(H)?(T=R.price/R.size,z="ml"):(T=R.price/R.size,z=R.unit)}else T=R.price,z=R.unit;else{const H=Gr(d,R.name);if(H&&H.packetSize){const J=H.lastPrice!==null&&H.lastPrice!==void 0&&H.lastPrice!==""?H.lastPrice:R.price,de=(H.packetUnit||"").trim().toLowerCase();["g",""].includes(de)?(T=J/H.packetSize*1e3,z="g"):["kg",""].includes(de)?(T=J/H.packetSize,z="g"):["ml","","cc",""].includes(de)?(T=J/H.packetSize*1e3,z="ml"):["l",""].includes(de)?(T=J/H.packetSize,z="ml"):(T=J/H.packetSize,z=H.packetUnit)}else T=R.price,z=R.unit}F.purchaseCost=Math.round(T*100)/100,E==="flour"?F.unit="g":z&&(F.unit=z)}const ne=Ri(R.itemCategory??R.item_category??Gr(d,R.name)?.itemCategory);if(ne){const T=rp(F,ne);Object.assign(F,T)}const P=parseFloat(F.quantity),B=parseFloat(F.purchaseCost);if(!isNaN(P)&&!isNaN(B)){const T=Gr(d,F.name),z=aa(F,T),H=Number.isFinite(z)&&z>0?z:1,J=(F.unit||"").trim().toLowerCase();let de=0;J==="g"||J===""||J==="ml"||J===""||J==="cc"||J===""?de=P/1e3*B:de=P*B,F.cost=Math.round(de/H*100)/100}return U[A]=F,{...M,[V]:U}})},$=o.isOpen&&o.index!==null?o.type==="flour"?n.flours[o.index]:n.breadIngredients[o.index]:null;return s.jsxs("div",{className:"bread-form",children:[s.jsxs(on,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[s.jsxs("div",{className:"bread-header",children:[s.jsxs("h3",{children:[" (Total: ",m,"g)"]}),s.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),s.jsxs("div",{className:"recipe-scroll-wrapper",children:[s.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[s.jsx("span",{})," ",s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{className:"text-center",children:"%"}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),s.jsx("span",{})]}),s.jsx("div",{className:"bread-grid-body",children:s.jsx(Di,{sensors:N,collisionDetection:Ku,onDragEnd:k,id:"flours-dnd",children:s.jsx(xa,{items:n.flours||[],strategy:Sl,children:(n.flours||[]).map((E,A)=>{const R=Gr(d,E?.name),M=Ep(R?.yieldPercent??R?.yield_percent??E?.yieldPercent??E?.yield_percent);return s.jsx(Rk,{id:E.id,index:A,item:E,yieldPercentApplied:M,onChange:v,onRemove:C,onSelect:L,calculatePercentage:y,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:A})},E.id)})})})})]}),s.jsx(le,{type:"button",variant:"secondary",size:"sm",onClick:b,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),s.jsxs(on,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[s.jsxs("div",{className:"bread-header",children:[s.jsx("h3",{children:""}),s.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),s.jsxs("div",{className:"recipe-scroll-wrapper",children:[s.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[s.jsx("span",{})," ",s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{className:"text-center",children:"%"}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),s.jsx("span",{})]}),s.jsx("div",{className:"bread-grid-body",children:s.jsx(Di,{sensors:N,collisionDetection:Ku,onDragEnd:k,id:"breadIngredients-dnd",children:s.jsx(xa,{items:n.breadIngredients||[],strategy:Sl,children:(n.breadIngredients||[]).map((E,A)=>{const R=Gr(d,E?.name),M=Ep(R?.yieldPercent??R?.yield_percent??E?.yieldPercent??E?.yield_percent);return s.jsx(Ok,{id:E.id,index:A,item:E,yieldPercentApplied:M,onChange:x,onRemove:S,onSelect:L,calculatePercentage:y,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:A})},E.id)})})})})]}),s.jsx(le,{type:"button",variant:"secondary",size:"sm",onClick:_,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),s.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:s.jsx(le,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),s.jsx(Wb,{isOpen:o.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:D,ingredientName:$?.name||"",currentCost:$?.purchaseCost,currentQuantity:$?.quantity,unit:$?.unit||"g",initialPurchaseCost:$?.purchase_cost,initialContentAmount:$?.content_amount})]})},Rk=({id:n,index:t,item:i,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:f,floursLength:h,onOpenConversion:m})=>{const y=Ri(i.itemCategory??i.item_category),v=!!y,x=Qb[y]||"",b=v?`${x}${xd(y)?"10%":"8%"}`:"",{attributes:_,listeners:C,setNodeRef:S,transform:N,transition:k,isDragging:D}=wa({id:n}),L={transform:wr.Transform.toString(N),transition:k,opacity:D?.5:1,position:"relative",zIndex:D?999:"auto"};return s.jsxs("div",{ref:S,style:L,className:"form-ingredient-row--bread",children:[s.jsx("div",{..._,...C,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),s.jsx("div",{className:"ingredient-name",children:s.jsx(vd,{value:i.name,onChange:$=>o(t,"name",$.target.value),onSelect:$=>d("flour",t,$),placeholder:": "})}),s.jsx("div",{className:"ingredient-qty",children:s.jsx(zt,{type:"number",step:"any",value:i.quantity,onChange:$=>o(t,"quantity",$.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),s.jsx("div",{className:"ingredient-unit",children:s.jsx(zt,{value:i.unit,onChange:$=>o(t,"unit",$.target.value),placeholder:"",style:{width:"100%",textAlign:"center"},wrapperClassName:"input-group--no-margin"})}),s.jsxs("div",{className:"bread-percent",children:[f(i.quantity),"%"]}),s.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[s.jsx(zt,{type:"number",step:"any",value:i.purchaseCost||"",onChange:$=>o(t,"purchaseCost",$.target.value),placeholder:i.purchaseCostRef?`Ref: ${i.purchaseCostRef}`:"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:i.purchaseCostRef?`: ${i.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),s.jsx("button",{type:"button",onClick:m,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&s.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",i.purchaseCostRef," ",i.vendorRef&&`(${i.vendorRef})`]})]}),s.jsxs("div",{className:"ingredient-cost",children:[s.jsx(zt,{type:"number",step:"any",value:i.cost||"",onChange:$=>o(t,"cost",$.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Jn(a))&&Jn(a)<99.999&&s.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const $=Jn(a),E=Math.round($*10)/10;return`${Number.isInteger(E)?Math.round(E):E}%`})()]})]}),s.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx("input",{type:"checkbox",checked:i.isAlcohol||!1,onChange:$=>o(t,"isAlcohol",$.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${b}`:"10%"})}),s.jsx("div",{className:"remove-button-cell",children:h>1&&s.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},Ok=({id:n,index:t,item:i,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:f,onOpenConversion:h})=>{const m=Ri(i.itemCategory??i.item_category),y=!!m,v=Qb[m]||"",x=y?`${v}${xd(m)?"10%":"8%"}`:"",{attributes:b,listeners:_,setNodeRef:C,transform:S,transition:N,isDragging:k}=wa({id:n}),D={transform:wr.Transform.toString(S),transition:N,opacity:k?.5:1,position:"relative",zIndex:k?999:"auto"};return s.jsxs("div",{ref:C,style:D,className:"form-ingredient-row--bread",children:[s.jsx("div",{...b,..._,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),s.jsx("div",{className:"ingredient-name",children:s.jsx(vd,{value:i.name,onChange:L=>o(t,"name",L.target.value),onSelect:L=>d("ingredient",t,L),placeholder:": "})}),s.jsx("div",{className:"ingredient-qty",children:s.jsx(zt,{type:"number",step:"any",value:i.quantity,onChange:L=>o(t,"quantity",L.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),s.jsx("div",{className:"ingredient-unit",children:s.jsx(zt,{value:i.unit,onChange:L=>o(t,"unit",L.target.value),placeholder:"",style:{width:"100%",textAlign:"center"},wrapperClassName:"input-group--no-margin"})}),s.jsxs("div",{className:"bread-percent",children:[f(i.quantity),"%"]}),s.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[s.jsx(zt,{type:"number",step:"any",value:i.purchaseCost||"",onChange:L=>o(t,"purchaseCost",L.target.value),placeholder:i.purchaseCostRef?`Ref: ${i.purchaseCostRef}`:"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:i.purchaseCostRef?`: ${i.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),s.jsx("button",{type:"button",onClick:h,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&s.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",i.purchaseCostRef," ",i.vendorRef&&`(${i.vendorRef})`]})]}),s.jsxs("div",{className:"ingredient-cost",children:[s.jsx(zt,{type:"number",step:"any",value:i.cost||"",onChange:L=>o(t,"cost",L.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Jn(a))&&Jn(a)<99.999&&s.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const L=Jn(a),$=Math.round(L*10)/10;return`${Number.isInteger($)?Math.round($):$}%`})()]})]}),s.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx("input",{type:"checkbox",checked:i.isAlcohol||!1,onChange:L=>o(t,"isAlcohol",L.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),s.jsx("div",{className:"remove-button-cell",children:s.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},Dk=new Set(["food","alcohol","soft_drink","supplies"]),Mk=new Set(["alcohol","supplies"]),zk={food:"",alcohol:"",soft_drink:"",supplies:""},vl=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":Dk.has(t)?t:"":""},ed=n=>Mk.has(n),i0=(n,t)=>{const i=vl(t);return i?{...n,itemCategory:i,isAlcohol:ed(i)}:{...n,itemCategory:null}},a0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Is=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=a0(t);if(!a)return null;for(const[o,u]of n.entries())if(a0(o)===a)return u;return null},cr=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},Jb=n=>{const t=cr(n);return!Number.isFinite(t)||t<=0||t>100?100:t},ol=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return Jb(i)/100},Lk=(n,t,i)=>{const a=cr(n),o=cr(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:(["kg","","l",""].includes(u),a/o)},sp=(n,t,i,a=1)=>{const o=cr(n),u=cr(t);if(!Number.isFinite(o)||!Number.isFinite(u))return NaN;const d=String(i||"").trim().toLowerCase();let f=0;["g","","ml","","cc",""].includes(d)?f=o/1e3*u:f=o*u;const h=Number.isFinite(a)&&a>0?a:1;return f/h},Uk=(n,t)=>{const i=cr(n?.purchaseCost),a=cr(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},Ik=_e.memo(({id:n,index:t,item:i,groupId:a,yieldPercentApplied:o,onChange:u,onRemove:d,handleSuggestionSelect:f,onOpenConversion:h})=>{const m=vl(i.itemCategory??i.item_category),y=!!m,v=zk[m]||"",x=y?`${v}${ed(m)?"10%":"8%"}`:"",b=y?ed(m):!!i.isAlcohol,{attributes:_,listeners:C,setNodeRef:S,transform:N,transition:k,isDragging:D}=wa({id:n,data:{groupId:a,index:t}}),L={transform:wr.Translate.toString(N),transition:k,opacity:D?.3:1,position:"relative",zIndex:D?999:"auto"};return s.jsxs("div",{ref:S,style:L,className:"form-ingredient-row",children:[s.jsx("div",{..._,...C,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),s.jsx("div",{className:"ingredient-name",children:s.jsx(vd,{value:i.name,onChange:$=>u(a,t,"name",$.target.value),onSelect:$=>f(a,t,$),placeholder:""})}),s.jsx("div",{className:"ingredient-qty",children:s.jsx(zt,{value:i.quantity,onChange:$=>u(a,t,"quantity",$.target.value),placeholder:"0",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),s.jsx("div",{className:"ingredient-unit",children:s.jsx(zt,{value:i.unit,onChange:$=>u(a,t,"unit",$.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),s.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[s.jsx(zt,{type:"number",value:i.purchaseCost,onChange:$=>u(a,t,"purchaseCost",$.target.value),step:"0.01",placeholder:i.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},title:i.purchaseCostRef?`: ${i.purchaseCostRef}${i.vendorRef?` (${i.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),s.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:h,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&s.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",i.purchaseCostRef]})]}),s.jsxs("div",{className:"ingredient-cost","data-label":"",children:[s.jsx(zt,{type:"number",step:"0.01",value:i.cost,onChange:$=>u(a,t,"cost",$.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(cr(o))&&cr(o)<99.999&&s.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const $=cr(o),E=Math.round($*10)/10;return`${Number.isInteger(E)?Math.round(E):E}%`})()]})]}),s.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx("input",{type:"checkbox",checked:b,onChange:$=>u(a,t,"isAlcohol",$.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),s.jsx("div",{className:"remove-button-cell",children:s.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(a,t),children:""})})]})},(n,t)=>n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),Bk=({section:n,sections:t,onSectionChange:i,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=uc({id:n.id});return s.jsxs(on,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[s.jsx(zt,{value:n.name,onChange:d=>i(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),s.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&s.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),s.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[s.jsx("span",{}),s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{children:""}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},children:""}),s.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),s.jsx("span",{})]}),s.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&s.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},$k=({formData:n,setFormData:t,priceList:i})=>{const[a,o]=w.useState(new Map);w.useEffect(()=>{zn.getAllConversions().then(L=>o(L))},[]);const[u,d]=w.useState({isOpen:!1,groupId:null,index:null});w.useEffect(()=>{if(!n.ingredientSections){const L=n.ingredientGroups||[{id:"default",name:""}],$=n.ingredients||[],E=L.map(M=>({id:M.id,name:M.name,items:$.filter(V=>M.id==="default"&&!V.groupId?!0:V.groupId===M.id)})),A=new Set(E.flatMap(M=>M.items.map(V=>V.id))),R=$.filter(M=>!A.has(M.id));R.length>0&&(E.length>0?E[0].items.push(...R):E.push({id:"default",name:"",items:R})),E.length===0&&E.push({id:crypto.randomUUID(),name:"",items:[]}),t(M=>({...M,ingredientSections:E}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const f=n.ingredientSections||[];w.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||a.size===0)return;let L=!1;const $=n.ingredientSections.map(E=>{const A=E.items.map(R=>{if(!R||typeof R!="object")return R;const M=Is(a,R.name);let V=R;const U=vl(R.itemCategory??R.item_category??M?.itemCategory);if(U){const ne=ed(U);(vl(R.itemCategory??R.item_category)!==U||!!R.isAlcohol!==ne)&&(V={...V,itemCategory:U,isAlcohol:ne})}if(M&&M.packetSize){const P=[M.lastPrice,R.purchaseCostRef,R.purchase_cost,R.purchaseCost].find(T=>Number.isFinite(cr(T))),B=Lk(P,M.packetSize,M.packetUnit);if(Number.isFinite(B)&&Uk(R,B)){const T=ol(R,M),z=Math.round(B*100)/100,H=sp(R.quantity,z,R.unit,T),J=Number.isFinite(H)?Math.round(H*100)/100:V.cost,de=cr(V.purchaseCost),q=cr(V.cost),Y=!Number.isFinite(de)||Math.abs(de-z)>.01,ae=Number.isFinite(cr(J))&&(!Number.isFinite(q)||Math.abs(q-J)>.01);(Y||ae)&&(V={...V,purchaseCost:z,cost:J})}}const F=ol(R,M);if(Number.isFinite(F)&&F>0&&Math.abs(F-1)>1e-4){const ne=sp(R.quantity,V.purchaseCost,R.unit,F),P=sp(R.quantity,V.purchaseCost,R.unit,1),B=cr(V.cost);if(Number.isFinite(ne)&&(!Number.isFinite(B)||Number.isFinite(P)&&Math.abs(B-P)<=.01)){const z=Math.round(ne*100)/100,H=cr(V.cost);(!Number.isFinite(H)||Math.abs(H-z)>.01)&&(V={...V,cost:z})}}return V!==R&&(L=!0),V});return A!==E.items?{...E,items:A}:E});L&&t(E=>({...E,ingredientSections:$}))},[a,n.ingredientSections,t]);const h=ba(ur(Al,{activationConstraint:{distance:10}}),ur(Rl,{activationConstraint:{delay:250,tolerance:5}}),ur(Tl,{coordinateGetter:pd})),m=({active:L,over:$})=>{if(!$)return;const E=L.id,A=$.id,R=f.find(V=>V.items.some(U=>U.id===E)),M=f.find(V=>V.items.some(U=>U.id===A))||f.find(V=>V.id===A);!R||!M||R===M||t(V=>{const U=R.items,F=M.items,ne=U.findIndex(T=>T.id===E),P=F.findIndex(T=>T.id===A);let B;if(A===M.id)B=F.length+1;else{const z=$&&L.rect.current.translated&&L.rect.current.translated.top>$.rect.top+$.rect.height?1:0;B=P>=0?P+z:F.length+1}return{...V,ingredientSections:V.ingredientSections.map(T=>T.id===R.id?{...T,items:U.filter(z=>z.id!==E)}:T.id===M.id?{...T,items:[...F.slice(0,B),U[ne],...F.slice(B,F.length)]}:T)}})},y=({active:L,over:$})=>{if(!$)return;const E=L.id,A=$.id,R=f.find(V=>V.items.some(U=>U.id===E)),M=f.find(V=>V.items.some(U=>U.id===A))||f.find(V=>V.id===A);if(R&&M&&R===M){const V=R.items.findIndex(F=>F.id===E),U=M.items.findIndex(F=>F.id===A);V!==U&&t(F=>({...F,ingredientSections:F.ingredientSections.map(ne=>ne.id===R.id?{...ne,items:zi(ne.items,V,U)}:ne)}))}},v=(L,$,E,A)=>{const{groupId:R,index:M}=u;R!==null&&M!==null&&t(V=>{const U=V.ingredientSections.map(F=>{if(F.id!==R)return F;const ne=[...F.items],P={...ne[M],purchaseCost:L,unit:$,purchase_cost:E,content_amount:A},B=parseFloat(P.quantity),T=parseFloat(L);if(!isNaN(B)&&!isNaN(T)){const z=Is(a,P.name),H=ol(P,z),J=$?$.trim().toLowerCase():"";let de=0;J==="g"||J===""||J==="ml"||J===""||J==="cc"||J===""?de=B/1e3*T:de=B*T;const q=Number.isFinite(H)&&H>0?H:1;P.cost=Math.round(de/q*100)/100}return ne[M]=P,{...F,items:ne}});return zn.getAllConversions().then(F=>o(F)),ec.invalidateCache(),{...V,ingredientSections:U}})},x=u.isOpen&&u.groupId!==null&&u.index!==null?f.find(L=>L.id===u.groupId)?.items[u.index]:null,b=_e.useCallback((L,$,E,A)=>{t(R=>{const M=R.ingredientSections.map(V=>{if(V.id!==L)return V;const U=[...V.items],F={...U[$],[E]:A};if(U[$]=F,["quantity","purchaseCost","unit","name","isAlcohol"].includes(E)){const ne=parseFloat(F.quantity),P=parseFloat(F.purchaseCost),B=Is(a,F.name),T=ol(F,B),z=Number.isFinite(T)&&T>0?T:1;if(!isNaN(ne)&&!isNaN(P)){let H=0;const J=F.unit?F.unit.trim().toLowerCase():"";J==="g"||J===""||J==="ml"||J===""||J==="cc"||J===""?H=ne/1e3*P:H=ne*P;const de=Math.round(H/z*100)/100;de!==F.cost&&(F.cost=de,U[$]=F)}}if(E==="name"){const ne=i.get(Wt(A)),P=Is(a,A),B=vl(P?.itemCategory);if(B){const T=i0(F,B);Object.assign(F,T)}else ne||(F.itemCategory=null);if(ne){const T=typeof ne=="object"?ne.price:ne,z=typeof ne=="object"?ne.vendor:null,H=typeof ne=="object"?ne.unit:null,J=typeof ne=="object"?ne.size:null;if(F.purchaseCostRef=T,F.vendorRef=z,P&&P.packetSize){const Y=P.lastPrice!==null&&P.lastPrice!==void 0&&P.lastPrice!==""?P.lastPrice:T;let ae=0;const xe=(P.packetUnit||"").trim().toLowerCase();["g",""].includes(xe)?(ae=Y/P.packetSize*1e3,F.unit="g"):["kg",""].includes(xe)?(ae=Y/P.packetSize,F.unit="g"):["ml","","cc",""].includes(xe)?(ae=Y/P.packetSize*1e3,F.unit="ml"):["l",""].includes(xe)?(ae=Y/P.packetSize,F.unit="ml"):(ae=Y/P.packetSize,F.unit=P.packetUnit),F.purchaseCost=Math.round(ae*100)/100}else{let Y=T,ae=H;J&&J>1&&(["g",""].includes((H||"").toLowerCase())?(Y=T/J*1e3,ae="g"):["ml","","cc",""].includes((H||"").toLowerCase())?(Y=T/J*1e3,ae="ml"):["kg",""].includes(H?H.toLowerCase():"")?(Y=T/J,ae="g"):["l",""].includes(H?H.toLowerCase():"")?(Y=T/J,ae="ml"):Y=T/J),F.purchaseCost||(F.purchaseCost=Math.round(Y*100)/100),!F.unit&&ae&&(F.unit=ae)}const de=parseFloat(F.quantity),q=parseFloat(F.purchaseCost);if(!isNaN(de)&&!isNaN(q)){const Y=Is(a,F.name),ae=ol(F,Y),xe=Number.isFinite(ae)&&ae>0?ae:1,ve=F.unit?F.unit.trim().toLowerCase():"";let Ee=0;ve==="g"||ve===""||ve==="ml"||ve===""||ve==="cc"||ve===""?Ee=de/1e3*q:Ee=de*q,F.cost=Math.round(Ee/xe*100)/100}}else F.purchaseCostRef=null,F.vendorRef=null;U[$]=F}return{...V,items:U}});return{...R,ingredientSections:M}})},[a,i,t]),_=_e.useCallback((L,$,E)=>{t(A=>{const R=A.ingredientSections.map(M=>{if(M.id!==L)return M;const V=[...M.items],U={...V[$]};if(U.name=E.name,U.itemCategory=null,E.price)if(U.purchaseCostRef=E.price,U.vendorRef=E.source==="csv"?"CSV":"Master",E.source==="manual")if(E.size&&E.size>0){const B=(E.unit||"").trim().toLowerCase();if(["g",""].includes(B)){const T=E.price/E.size*1e3;U.purchaseCost=Math.round(T*100)/100,U.unit="g"}else if(["kg",""].includes(B)){const T=E.price/E.size;U.purchaseCost=Math.round(T*100)/100,U.unit="g"}else if(["ml","","cc",""].includes(B)){const T=E.price/E.size*1e3;U.purchaseCost=Math.round(T*100)/100,U.unit="ml"}else if(["l",""].includes(B)){const T=E.price/E.size;U.purchaseCost=Math.round(T*100)/100,U.unit="ml"}else{const T=E.price/E.size;U.purchaseCost=Math.round(T*100)/100,U.unit=E.unit}}else U.purchaseCost=E.price,U.unit=E.unit;else{const B=Is(a,E.name);if(B&&B.packetSize){const T=B.lastPrice!==null&&B.lastPrice!==void 0&&B.lastPrice!==""?B.lastPrice:E.price;let z=0;const H=(B.packetUnit||"").trim().toLowerCase();["g",""].includes(H)?(z=T/B.packetSize*1e3,U.unit="g"):["kg",""].includes(H)?(z=T/B.packetSize,U.unit="g"):["ml","","cc",""].includes(H)?(z=T/B.packetSize*1e3,U.unit="ml"):["l",""].includes(H)?(z=T/B.packetSize,U.unit="ml"):(z=T/B.packetSize,U.unit=B.packetUnit),U.purchaseCost=Math.round(z*100)/100}else U.purchaseCost=E.price,U.unit=E.unit}const F=vl(E.itemCategory??E.item_category??Is(a,E.name)?.itemCategory);if(F){const B=i0(U,F);Object.assign(U,B)}const ne=parseFloat(U.quantity),P=parseFloat(U.purchaseCost);if(!isNaN(ne)&&!isNaN(P)){const B=Is(a,U.name),T=ol(U,B),z=Number.isFinite(T)&&T>0?T:1,H=U.unit?U.unit.trim().toLowerCase():"";let J=0;H==="g"||H===""||H==="ml"||H===""||H==="cc"||H===""?J=ne/1e3*P:J=ne*P,U.cost=Math.round(J/z*100)/100}return V[$]=U,{...M,items:V}});return{...A,ingredientSections:R}})},[a,t]),C=_e.useCallback((L,$)=>{t(E=>({...E,ingredientSections:E.ingredientSections.map(A=>A.id===L?{...A,items:A.items.filter((R,M)=>M!==$)}:A)}))},[t]),S=L=>{const $={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(E=>({...E,ingredientSections:E.ingredientSections.map(A=>A.id===L?{...A,items:[...A.items,$]}:A)}))},N=()=>{t(L=>({...L,ingredientSections:[...L.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},k=L=>{t($=>({...$,ingredientSections:$.ingredientSections.filter(E=>E.id!==L)}))},D=(L,$)=>{t(E=>({...E,ingredientSections:E.ingredientSections.map(A=>A.id===L?{...A,name:$}:A)}))};return s.jsxs(Di,{sensors:h,collisionDetection:J0,onDragOver:m,onDragEnd:y,children:[s.jsxs("div",{className:"recipe-form-ingredients",children:[f.map(L=>s.jsx(xa,{id:L.id,items:L.items.map($=>$.id),strategy:Sl,children:s.jsxs(Bk,{section:L,sections:f,onSectionChange:D,onRemoveSection:k,children:[L.items.map(($,E)=>(()=>{const A=Is(a,$?.name),R=Jb(A?.yieldPercent??A?.yield_percent??$?.yieldPercent??$?.yield_percent);return s.jsx(Ik,{id:$.id,index:E,item:$,groupId:L.id,yieldPercentApplied:R,onChange:b,onRemove:C,handleSuggestionSelect:_,onOpenConversion:()=>d({isOpen:!0,groupId:L.id,index:E})},$.id)})()),s.jsx(le,{type:"button",variant:"ghost",onClick:()=>S(L.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},L.id)),s.jsx(le,{type:"button",variant:"secondary",onClick:N,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),s.jsx(Yp,{dropAnimation:{sideEffects:Kp({styles:{active:{opacity:"0.5"}}})},children:null}),s.jsx(Wb,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,groupId:null,index:null}),onApply:v,ingredientName:x?.name||"",currentCost:x?.purchaseCost,currentQuantity:x?.quantity,unit:x?.unit||"g",initialPurchaseCost:x?.purchase_cost,initialContentAmount:x?.content_amount})]})},Pk=n=>new Promise((t,i)=>{const a=new FileReader;a.onerror=()=>i(new Error("")),a.onload=()=>{const o=String(a.result||""),u=o.includes(",")?o.split(",")[1]:o;t(u)},a.readAsDataURL(n)}),qk={async transcribe(n,{mimeType:t,fileName:i,language:a="ja"}={}){if(!(n instanceof Blob))throw new Error("");const o=await Pk(n);if(!o)throw new Error("");const{data:u,error:d}=await Ne.functions.invoke("transcribe-avalon",{body:{audioBase64:o,mimeType:t||n.type||"audio/webm",fileName:i||"voice-input.webm",language:a}});if(d)throw new Error(d.message||"");if(u?.success!==!0)throw new Error(u?.error||"");return String(u?.text||"").trim()}},Fk=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"],Hk=()=>{if(typeof MediaRecorder>"u")return"";for(const n of Fk)if(MediaRecorder.isTypeSupported(n))return n;return""},Vk=()=>typeof window>"u"?!1:!!(navigator?.mediaDevices?.getUserMedia&&typeof window.MediaRecorder<"u"),Gk=n=>String(n||"").trim(),Kk=(n,t)=>{const i=String(n||"").trim(),a=Gk(t);return a?i?/[.!?]$/.test(i)?`${i}
${a}`:`${i}
${a}`:a:i},Xb=({onTranscript:n,getCurrentValue:t,disabled:i=!1,size:a="sm",className:o="",label:u="",language:d="ja"})=>{const f=Li(),[h,m]=w.useState(!1),[y,v]=w.useState(!1),x=w.useRef(null),b=w.useRef(null),_=w.useRef([]),C=w.useRef(!0),S=w.useRef(!1),N=()=>{const A=b.current;A&&A.getTracks().forEach(R=>R.stop()),b.current=null},k=()=>{x.current=null,_.current=[]},D=async()=>{if(!h||y)return;const A=x.current;if(A)try{A.state!=="inactive"&&A.stop()}catch(R){console.error("[VoiceInputButton] failed to stop recorder:",R),N(),k(),m(!1),f.error("")}},L=async()=>{if(!(i||h||y)){if(!Vk()){f.error("");return}try{S.current=!1;const A=await navigator.mediaDevices.getUserMedia({audio:!0});b.current=A;const R=Hk(),M=R?new MediaRecorder(A,{mimeType:R}):new MediaRecorder(A);_.current=[],M.ondataavailable=V=>{V?.data?.size>0&&_.current.push(V.data)},M.onerror=V=>{console.error("[VoiceInputButton] MediaRecorder error:",V?.error||V),N(),k(),m(!1),v(!1),f.error("")},M.onstop=async()=>{if(S.current){N(),k(),C.current&&(m(!1),v(!1));return}C.current&&(m(!1),v(!0));try{const V=M.mimeType||R||"audio/webm",U=new Blob(_.current,{type:V});if(U.size===0)throw new Error("");const F=await qk.transcribe(U,{mimeType:V,fileName:`voice-input.${V.includes("mp4")?"m4a":"webm"}`,language:d});if(!F){f.warning("");return}const ne=typeof t=="function"?t():"",P=Kk(ne,F);n?.(P,F),f.success("")}catch(V){console.error("[VoiceInputButton] transcription failed:",V),f.error(V?.message||"")}finally{N(),k(),C.current&&v(!1)}},x.current=M,M.start(),m(!0)}catch(A){if(console.error("[VoiceInputButton] failed to start recording:",A),N(),k(),A?.name==="NotAllowedError"||A?.name==="SecurityError"){f.error("");return}f.error("")}}};w.useEffect(()=>()=>{C.current=!1,S.current=!0;try{x.current&&x.current.state!=="inactive"&&x.current.stop()}catch{}N(),k()},[]);const $=()=>{if(!(i||y)){if(h){D();return}L()}},E=y?"...":h?"":u;return s.jsxs(le,{type:"button",variant:"secondary",size:a,onClick:$,disabled:i||y,className:["voice-input-btn",h?"is-recording":"",o].filter(Boolean).join(" "),title:h?"":"",children:[h?"":""," ",E]})},Yk=({id:n,index:t,item:i,groupId:a,voiceInputEnabled:o,onChange:u,onRemove:d,onVoiceAppend:f})=>{const{attributes:h,listeners:m,setNodeRef:y,transform:v,transition:x,isDragging:b}=wa({id:n,data:{groupId:a,index:t}}),_={transform:wr.Translate.toString(v),transition:x,opacity:b?.3:1,position:"relative",zIndex:b?999:"auto"};return s.jsxs("div",{ref:y,style:{..._,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[s.jsx("div",{...h,...m,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),s.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),s.jsxs("div",{style:{flex:1},children:[s.jsx(zt,{textarea:!0,value:i.text,onChange:C=>u(a,t,C.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}}),o&&s.jsx("div",{className:"step-row__voice-action",children:s.jsx(Xb,{label:"",getCurrentValue:()=>i.text,onTranscript:C=>f(a,t,C)})})]}),s.jsx("div",{className:"remove-button-cell",children:s.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(a,t),title:"",children:""})})]})},Wk=({section:n,sections:t,onSectionChange:i,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=uc({id:n.id});return s.jsxs(on,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[s.jsx(zt,{value:n.name,onChange:d=>i(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),s.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&s.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),s.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&s.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},Qk=({formData:n,setFormData:t,voiceInputEnabled:i=!1})=>{w.useEffect(()=>{if(!n.stepSections){const _=n.stepGroups||[{id:"default",name:""}],S=(n.steps||[]||[]).map(L=>typeof L=="string"?{id:crypto.randomUUID(),text:L}:L),N=_.map(L=>({id:L.id,name:L.name,items:S.filter($=>L.id==="default"&&!$.groupId?!0:$.groupId===L.id)})),k=new Set(N.flatMap(L=>L.items.map($=>$.id))),D=S.filter(L=>!k.has(L.id));D.length>0&&(N.length>0?N[0].items.push(...D):N.push({id:"default",name:"",items:D})),N.length===0&&N.push({id:crypto.randomUUID(),name:"",items:[]}),t(L=>({...L,stepSections:N}))}},[n.steps,n.stepGroups,n.stepSections,t]);const a=n.stepSections||[],o=ba(ur(Al,{activationConstraint:{distance:10}}),ur(Rl,{activationConstraint:{delay:250,tolerance:5}}),ur(Tl,{coordinateGetter:pd})),u=({active:_,over:C})=>{if(!C)return;const S=_.id,N=C.id,k=a.find(L=>L.items.some($=>$.id===S)),D=a.find(L=>L.items.some($=>$.id===N))||a.find(L=>L.id===N);!k||!D||k===D||t(L=>{const $=k.items,E=D.items,A=$.findIndex(V=>V.id===S),R=E.findIndex(V=>V.id===N);let M;if(N===D.id)M=E.length+1;else{const U=C&&_.rect.current.translated&&_.rect.current.translated.top>C.rect.top+C.rect.height?1:0;M=R>=0?R+U:E.length+1}return{...L,stepSections:L.stepSections.map(V=>V.id===k.id?{...V,items:$.filter(U=>U.id!==S)}:V.id===D.id?{...V,items:[...E.slice(0,M),$[A],...E.slice(M,E.length)]}:V)}})},d=({active:_,over:C})=>{if(!C)return;const S=_.id,N=C.id,k=a.find(L=>L.items.some($=>$.id===S)),D=a.find(L=>L.items.some($=>$.id===N))||a.find(L=>L.id===N);if(k&&D&&k===D){const L=k.items.findIndex(E=>E.id===S),$=D.items.findIndex(E=>E.id===N);L!==$&&t(E=>({...E,stepSections:E.stepSections.map(A=>A.id===k.id?{...A,items:zi(A.items,L,$)}:A)}))}},f=(_,C,S)=>{t(N=>({...N,stepSections:N.stepSections.map(k=>{if(k.id!==_)return k;const D=[...k.items];return D[C]={...D[C],text:S},{...k,items:D}})}))},h=(_,C)=>{t(S=>({...S,stepSections:S.stepSections.map(N=>N.id===_?{...N,items:N.items.filter((k,D)=>D!==C)}:N)}))},m=(_,C,S)=>{t(N=>({...N,stepSections:N.stepSections.map(k=>{if(k.id!==_)return k;const D=[...k.items];return D[C]={...D[C],text:S},{...k,items:D}})}))},y=_=>{const C={id:crypto.randomUUID(),text:""};t(S=>({...S,stepSections:S.stepSections.map(N=>N.id===_?{...N,items:[...N.items,C]}:N)}))},v=()=>{t(_=>({..._,stepSections:[..._.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},x=_=>{t(C=>({...C,stepSections:C.stepSections.filter(S=>S.id!==_)}))},b=(_,C)=>{t(S=>({...S,stepSections:S.stepSections.map(N=>N.id===_?{...N,name:C}:N)}))};return s.jsxs(Di,{sensors:o,collisionDetection:J0,onDragOver:u,onDragEnd:d,children:[s.jsxs("div",{className:"recipe-form-steps",children:[a.map(_=>s.jsx(xa,{id:_.id,items:_.items.map(C=>C.id),strategy:Sl,children:s.jsxs(Wk,{section:_,sections:a,onSectionChange:b,onRemoveSection:x,children:[_.items.map((C,S)=>s.jsx(Yk,{id:C.id,index:S,item:C,groupId:_.id,voiceInputEnabled:i,onChange:f,onRemove:h,onVoiceAppend:m},C.id)),s.jsx(le,{type:"button",variant:"ghost",onClick:()=>y(_.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},_.id)),s.jsx(le,{type:"button",variant:"secondary",onClick:v,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),s.jsx(Yp,{dropAnimation:{sideEffects:Kp({styles:{active:{opacity:"0.5"}}})},children:null})]})},l0="voice_input_enabled",Jk=15*1e3,td=new Map,Ru=(n,t)=>{td.set(n,{value:t===!0,expiresAt:Date.now()+Jk})},Xk=n=>{const t=td.get(n);return t?Date.now()>t.expiresAt?(td.delete(n),null):t.value:null},Zk=async n=>{const{data:t,error:i}=await Ne.rpc("get_feature_flag",{p_key:n});if(i)throw i;return t===!0},eT=async n=>{const{data:t,error:i}=await Ne.from("app_feature_flags").select("enabled").eq("feature_key",n).maybeSingle();if(i)throw i;return t?.enabled===!0},kp={async getFlag(n,{force:t=!1}={}){if(!t){const i=Xk(n);if(i!==null)return i}try{const i=await Zk(n);return Ru(n,i),i}catch(i){console.warn("[featureFlagService] RPC get_feature_flag failed, fallback to table:",i);const a=await eT(n);return Ru(n,a),a}},async setFlag(n,t){const i=t===!0;try{const{data:a,error:o}=await Ne.rpc("admin_set_feature_flag",{p_key:n,p_enabled:i});if(o)throw o;return Ru(n,a?.enabled===!0),a?.enabled===!0}catch(a){console.warn("[featureFlagService] RPC admin_set_feature_flag failed, fallback to table:",a);const{data:o,error:u}=await Ne.from("app_feature_flags").upsert({feature_key:n,enabled:i,updated_at:new Date().toISOString()},{onConflict:"feature_key"}).select("enabled").single();if(u)throw u;const d=o?.enabled===!0;return Ru(n,d),d}},async getVoiceInputEnabled(n){return this.getFlag(l0,n)},async setVoiceInputEnabled(n){return this.setFlag(l0,n)},clearCache(){td.clear()}},Zb=({onClose:n,onImport:t,initialMode:i="url"})=>{const a=Li(),[o,u]=w.useState(i),[d,f]=w.useState(null),[h,m]=w.useState(""),[y,v]=w.useState(""),[x,b]=w.useState(null),[_,C]=w.useState(null),[S,N]=w.useState("auto"),[k,D]=w.useState(!1),[L,$]=w.useState(!1),[E,A]=w.useState(null),[R,M]=w.useState(!1),V=w.useRef(null),U=w.useRef(null),F=w.useRef(null),ne=w.useRef(null),P=()=>{ne.current&&(clearTimeout(ne.current),ne.current=null)},B=(Z="")=>{if(P(),F.current){try{F.current.abort()}catch{}F.current=null}$(!1),Z&&A(Z)};w.useEffect(()=>()=>{if(P(),F.current){try{F.current.abort()}catch{}F.current=null}},[]),w.useEffect(()=>{if(!x){C(null);return}const Z=URL.createObjectURL(x);return C(Z),()=>URL.revokeObjectURL(Z)},[x]);const T=Z=>new Promise(Ce=>{if(!Z||typeof Z!="object")return Ce(Z);const be=String(Z.type||"").toLowerCase();if(!be.startsWith("image/"))return Ce(Z);const We=2e6,Re=2e3,Pe=.9,Ze=String(Z.name||"").toLowerCase(),rt=be.includes("heic")||be.includes("heif")||Ze.endsWith(".heic")||Ze.endsWith(".heif"),qe=URL.createObjectURL(Z);let Ae=!1;const Se=ut=>{if(!Ae){Ae=!0;try{URL.revokeObjectURL(qe)}catch{}Ce(ut)}},te=setTimeout(()=>Se(Z),15e3),Be=new Image;Be.onload=()=>{const ut=Be.naturalWidth||Be.width||0,Ct=Be.naturalHeight||Be.height||0;if(!ut||!Ct)return clearTimeout(te),Se(Z);const Rt=Math.min(1,Re/Math.max(ut,Ct)),mt=Math.max(1,Math.round(ut*Rt)),Ot=Math.max(1,Math.round(Ct*Rt)),jt=Rt<1,ft=rt||Z.size>We;if(!jt&&!ft)return clearTimeout(te),Se(Z);const Vt=document.createElement("canvas");Vt.width=mt,Vt.height=Ot;const an=Vt.getContext("2d");if(!an)return clearTimeout(te),Se(Z);an.drawImage(Be,0,0,mt,Ot),Vt.toBlob(xn=>{if(clearTimeout(te),!xn)return Se(Z);const Mt=String(Z.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);Se(new File([xn],`${Mt}.jpg`,{type:"image/jpeg"}))},"image/jpeg",Pe)},Be.onerror=()=>{clearTimeout(te),Se(Z)},Be.src=qe}),z=async Z=>{if(Z){if(!String(Z.type||"").startsWith("image/")){A("");return}A(null),D(!0);try{const Ce=await T(Z);b(Ce||Z)}finally{D(!1)}}},H=()=>V.current?.click?.(),J=()=>U.current?.click?.(),de=Z=>{Z.preventDefault(),Z.stopPropagation(),Z.type==="dragenter"||Z.type==="dragover"?M(!0):Z.type==="dragleave"&&M(!1)},q=Z=>{if(Z.preventDefault(),Z.stopPropagation(),M(!1),Z.dataTransfer.files&&Z.dataTransfer.files[0]){const Ce=Z.dataTransfer.files[0];Ce.type.startsWith("image/")&&z(Ce)}},Y=Z=>/[---]/.test(Z||""),ae=Z=>typeof Z=="string"?Z.trim():Z&&typeof Z=="object"?String(Z.text||Z.name||"").trim():"",xe=async Z=>{try{const Ce=[];Ce.push((Z.name||Z.title||"").trim()),Ce.push((Z.description||"").trim());const be=[];Array.isArray(Z.ingredients)&&Z.ingredients.forEach((Se,te)=>{if(typeof Se=="string"){const ut=Se.trim();if(!ut)return;Ce.push(ut),be.push(te);return}const Be=String(Se?.name||Se?.text||"").trim();Be&&(Ce.push(Be),be.push(te))});const We=[];if(Array.isArray(Z.steps)&&Z.steps.forEach((Se,te)=>{const Be=ae(Se);Be&&(Ce.push(Be),We.push(te))}),!Ce.some(Se=>String(Se||"").trim()))return Z;const{data:Re,error:Pe}=await Ne.functions.invoke("translate",{body:{text:Ce,target_lang:"JA"}});if(Pe)throw Pe;if(!Array.isArray(Re?.translations))throw new Error("Invalid translation response payload");const Ze=Re.translations.map(Se=>Se.text);let rt=0;const qe={...Z},Ae=Ze[rt++]||qe.name||qe.title||"";if(qe.name=Ae,qe.title=Ae,qe.description=Ze[rt++]||qe.description,be.length>0){const Se=new Map;be.forEach((te,Be)=>{Se.set(te,Ze[rt+Be])}),qe.ingredients=qe.ingredients.map((te,Be)=>{const ut=Se.get(Be);return ut?typeof te=="string"?ut:te&&typeof te=="object"?{...te,name:ut}:te:te}),rt+=be.length}if(We.length>0){const Se=new Map;We.forEach((te,Be)=>{Se.set(te,Ze[rt+Be])}),qe.steps=qe.steps.map((te,Be)=>{const ut=Se.get(Be);return ut?te&&typeof te=="object"?{...te,text:ut}:ut:te})}return qe}catch(Ce){return console.error("Translation failed:",Ce),a.warning(""),Z}},[ve,Ee]=w.useState([]),he=async()=>{$(!0),A(null),Ee([]);try{let Z,Ce="";if(o==="url"){if(!y)return;Ce=y;const{data:Pe,error:Ze}=await Ne.functions.invoke("scrape-recipe",{body:{url:y}});if(Ze)throw Ze;Z=Pe}else{if(!x)return;P();const Pe=new AbortController;F.current=Pe;const Ze=12e4;ne.current=setTimeout(()=>{B("")},Ze),Ee(ut=>[...ut," ..."]);const rt=new FormData;rt.append("image",x),rt.append("engine",S);const{data:{session:qe}}=await Ne.auth.getSession();if(!qe?.access_token)throw new Error("");const Se=`${Ne.supabaseUrl||"https://hocbnifuactbvmyjraxy.supabase.co"}/functions/v1/analyze-image`,te={Authorization:`Bearer ${qe.access_token}`};let Be;try{Be=await fetch(Se,{method:"POST",headers:te,body:rt,signal:Pe.signal})}catch(ut){throw console.error("Network Error:",ut),new Error("")}if(!Be.ok){const ut=Be.status;throw new Error(`Server Error: ${Be.statusText} (${ut})`)}if(!Be.body)Z=await Be.json();else{const ut=Be.body.getReader(),Ct=new TextDecoder;let Rt=null,mt="",Ot=!1;for(;;){const{done:jt,value:ft}=await ut.read();if(jt)break;mt+=Ct.decode(ft,{stream:!0});const Vt=mt.split(`

`);mt=Vt.pop()||"";for(const an of Vt){const xn=an.trim();if(xn.startsWith("data: "))try{const Mt=JSON.parse(xn.slice(6));if(Mt.type==="log")Ee(nn=>[...nn,Mt.message]);else if(Mt.type==="result")Rt=Mt,Ot=!0;else if(Mt.type==="error")throw new Error(Mt.message)}catch(Mt){if(Mt.message&&!Mt.message.includes("Failed to parse"))throw Mt;console.warn("Failed to parse SSE event",Mt)}}if(Ot)break}try{await ut.cancel()}catch{}if(!Rt)throw new Error("");Z=Rt}}if(Z.error)throw new Error(Z.error);if(!Z.recipe)throw new Error("No recipe found");let be=Z.recipe;if(be.title=be.title||be.name||"",be.name=be.name||be.title||"",be.recipeYield=be.recipeYield||be.servings||"",be.description=be.description||"",!be.ingredients&&be.recipeIngredient&&(be.ingredients=be.recipeIngredient),Array.isArray(be.ingredients)){const Pe=["","","method","instructions","steps","preparation"],Ze=[],rt=[];be.ingredients.forEach(qe=>{const Ae=(qe.group||"").trim().toLowerCase();if(Ae&&Pe.some(Se=>Ae===Se||Ae.includes(Se))){const Se=qe.name||qe.text||"";Se&&rt.push(Se)}else Ze.push(qe)}),rt.length>0&&(console.log("Extracted steps from ingredients:",rt),be.ingredients=Ze,be.steps=Array.isArray(be.steps)?be.steps:[],be.steps=[...be.steps,...rt])}const We=Array.isArray(be.steps)?be.steps.slice(0,3).map(Pe=>ae(Pe)).join(""):"",Re=`${be.name||be.title||""}${We}`;if(Re&&!Y(Re)){f(be),m(Ce),u("confirm-translation"),$(!1);return}t(be,Ce),n()}catch(Z){if(console.error("Import failed details:",Z),Z?.name==="AbortError")return;const Ce=Z.message||"Import failed. Please try again.";A(Ce)}finally{P(),F.current=null,o!=="confirm-translation"&&$(!1)}},G=async Z=>{$(!0);try{let Ce=d;Z&&(Ce=await xe(d)),t(Ce,h),n()}catch(Ce){console.error("Translation flow error:",Ce),A("Translation failed. Importing original."),t(d,h),n()}finally{$(!1)}},ge=Z=>{const Ce=Z.target.files[0];Ce&&z(Ce),Z.target.value=""};return s.jsxs("div",{className:"modal-overlay fade-in",children:[L&&s.jsxs("div",{className:"loading-overlay",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"..."}),ve.length>0&&s.jsx("div",{className:"progress-log-container",children:s.jsxs("div",{className:"progress-log",children:[ve.map((Z,Ce)=>s.jsx("div",{className:"log-entry",children:s.jsx("span",{className:"log-message",children:Z})},Ce)),s.jsx("div",{ref:Z=>Z?.scrollIntoView({behavior:"smooth"})})]})}),s.jsx("div",{style:{marginTop:"0.9rem",display:"flex",justifyContent:"center"},children:s.jsx(le,{type:"button",variant:"secondary",onClick:()=>B(),children:""})})]}),s.jsxs(on,{className:"import-modal-card",children:[s.jsx("h3",{className:"modal-title",children:o==="confirm-translation"?"":""}),o==="confirm-translation"?s.jsxs("div",{className:"translation-confirm-content",children:[s.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[s.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),s.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),s.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",s.jsx("br",{}),s.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),s.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[s.jsx(le,{type:"button",variant:"primary",onClick:()=>G(!0),isLoading:L,style:{width:"100%"},children:""}),s.jsx(le,{type:"button",variant:"secondary",onClick:()=>G(!1),disabled:L,style:{width:"100%"},children:""})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"import-mode-tabs",children:[s.jsx("button",{type:"button",onClick:()=>u("url"),className:`tab-btn tab-import-web ${o==="url"?"active":""}`,children:" Web URL"}),s.jsx("button",{type:"button",onClick:()=>u("image"),className:`tab-btn tab-import-image ${o==="image"?"active":""}`,children:"  (Best Effort)"})]}),o==="url"?s.jsxs(s.Fragment,{children:[s.jsx("p",{children:"URL"}),s.jsx("input",{type:"url",placeholder:"https://...",value:y,onChange:Z=>v(Z.target.value),className:"import-url-input",autoFocus:!0})]}):s.jsxs(s.Fragment,{children:[s.jsx("p",{children:""}),s.jsxs("div",{className:"image-engine-panel",children:[s.jsxs("label",{className:"image-engine-label",children:["",s.jsxs("select",{className:"image-engine-select",value:S,onChange:Z=>N(Z.target.value),disabled:L||k,children:[s.jsx("option",{value:"auto",children:""}),s.jsx("option",{value:"gemini",children:"Gemini"}),s.jsx("option",{value:"groq",children:"/Groq"}),s.jsx("option",{value:"groq_vision",children:"Groq"})]})]}),s.jsx("div",{className:"image-engine-help",children:"Gemini/GroqAzure OCROCRGroqGroqOCRGroq"})]}),s.jsxs("div",{className:"image-upload-wrapper",children:[s.jsx("input",{ref:V,type:"file",accept:"image/*",capture:"environment",onChange:ge,className:"image-upload-input"}),s.jsx("input",{ref:U,type:"file",accept:"image/*",onChange:ge,className:"image-upload-input"}),s.jsx("div",{onDragEnter:de,onDragLeave:de,onDragOver:de,onDrop:q,className:`image-upload-label ${R?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{L||k||J()},onKeyDown:Z=>{L||k||(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),J())},children:_?s.jsx("img",{src:_,alt:"Preview",className:"image-upload-preview"}):R?"":""}),s.jsxs("div",{className:"image-upload-actions",children:[s.jsx(le,{type:"button",variant:"secondary",onClick:H,disabled:L||k,children:""}),s.jsx(le,{type:"button",variant:"secondary",onClick:J,disabled:L||k,children:""})]})]}),k&&s.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),E&&s.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto"},children:E}),s.jsxs("div",{className:"modal-actions",children:[s.jsx(le,{type:"button",variant:"ghost",onClick:n,disabled:L,children:""}),s.jsx(le,{type:"button",variant:"primary",onClick:he,isLoading:L,disabled:k||(o==="url"?!y:!x),children:""})]})]})]})]})},o0=({onSave:n,onCancel:t,initialData:i})=>{const a=i||{},[o,u]=w.useState("ingredients"),[d,f]=w.useState(null),[h,m]=w.useState(new Map);_e.useEffect(()=>{(async()=>{const T=await ir.fetchPriceList();m(T)})()},[]);const y=w.useMemo(()=>{const B=a.steps||[""];let T=a.stepGroups||[];const z=B.some(J=>typeof J=="object"&&J.group);if(T.length===0&&z){const J=new Map;B.forEach(de=>{typeof de=="object"&&de.group&&!J.has(de.group)&&J.set(de.group,crypto.randomUUID())}),T=Array.from(J.entries()).map(([de,q])=>({id:q,name:de}))}return{steps:B.map(J=>{const de=typeof J=="string"?J:J.text||"",q=typeof J=="object"&&J.id?J.id:crypto.randomUUID();let Y=typeof J=="object"?J.groupId:void 0;const ae=typeof J=="object"?J.group:void 0;if(!Y&&ae&&T.length>0){const xe=T.find(ve=>ve.name===ae);xe&&(Y=xe.id)}return{id:q,text:de,groupId:Y}}),stepGroups:T}},[a]),v=y.steps,x=y.stepGroups,b=w.useMemo(()=>{const B=a.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let T=a.ingredientGroups||[];if(T.length===0&&B.some(H=>H.group)){const H=new Map;B.forEach(J=>{J.group&&!H.has(J.group)&&H.set(J.group,crypto.randomUUID())}),T=Array.from(H.entries()).map(([J,de])=>({id:de,name:J})),H.size>0&&B.some(J=>!J.group)}return{ingredients:B.map(H=>{const J=typeof H=="string"?{name:H,quantity:"",unit:"",cost:"",purchaseCost:""}:{...H,cost:H.cost||"",purchaseCost:H.purchaseCost||""};let de=J.groupId;if(!de&&J.group&&T.length>0){const q=T.find(Y=>Y.name===J.group);q&&(de=q.id)}return{...J,id:J.id||crypto.randomUUID(),groupId:de}}),ingredientGroups:T}},[a]),_=b.ingredients,C=b.ingredientGroups,[S,N]=w.useState({title:a.title||"",description:a.description||"",image:a.image||"",imageFile:null,storeName:a.storeName||"",servings:a.servings||"",ingredients:_,ingredientGroups:C,steps:v,stepGroups:x,tags:a.tags||[""],course:a.course||"",category:a.category||"",type:a.type||"normal",flours:a.flours||[],breadIngredients:a.breadIngredients||[],sourceUrl:a.sourceUrl||""}),[k,D]=w.useState(!1),[L,$]=w.useState(!1);w.useEffect(()=>{let B=!0;return(async()=>{try{const z=await kp.getVoiceInputEnabled();B&&$(z)}catch(z){console.warn("[RecipeForm] failed to load voice input feature flag:",z),B&&$(!1)}})(),()=>{B=!1}},[]);const E=(B,T="")=>{const z=new Map,H=B.ingredients||[];H.forEach(ve=>{let Ee=ve.group||"";Ee==="Main"&&(Ee=""),z.has(Ee)||z.set(Ee,crypto.randomUUID())});const J=Array.from(z.entries()).map(([ve,Ee])=>({id:Ee,name:ve})),de=H.map(ve=>{let Ee=ve.group||"";Ee==="Main"&&(Ee="");let he;return z.has(Ee)&&(he=z.get(Ee)),{id:crypto.randomUUID(),name:ve.name||"",quantity:ve.quantity||"",unit:ve.unit||"",cost:"",purchaseCost:"",groupId:he}}),q=new Map,Y=B.steps||[];Y.forEach(ve=>{typeof ve=="object"&&ve.group&&ve.group!=="Main"&&(q.has(ve.group)||q.set(ve.group,crypto.randomUUID()))});const ae=Array.from(q.entries()).map(([ve,Ee])=>({id:Ee,name:ve})),xe=Y.map(ve=>{const Ee=typeof ve=="object",he=Ee?ve.text||"":ve,G=Ee?ve.group:null;let ge;return G&&q.has(G)&&(ge=q.get(G)),{id:crypto.randomUUID(),text:he,groupId:ge}});N(ve=>({...ve,title:B.name||B.title||ve.title,description:B.description||ve.description,category:T?"URL":B.category||ve.category,image:B.image||ve.image,servings:B.recipeYield||B.servings||ve.servings,ingredients:de,ingredientGroups:J,steps:xe,stepGroups:ae,ingredientSections:void 0,stepSections:void 0,sourceUrl:T||ve.sourceUrl})),f(null),u("ingredients")},A=B=>{B.preventDefault(),B.stopPropagation(),B.type==="dragenter"||B.type==="dragover"?D(!0):B.type==="dragleave"&&D(!1)},R=B=>{if(B.preventDefault(),B.stopPropagation(),D(!1),B.dataTransfer.files&&B.dataTransfer.files[0]){const T=B.dataTransfer.files[0];T.type.startsWith("image/")&&N(z=>({...z,imageFile:T,image:URL.createObjectURL(T)}))}},M=B=>{const{id:T,value:z}=B.target;N(H=>({...H,[T]:z}))},V=B=>{const T=B.target.files[0];T&&N(z=>({...z,imageFile:T,image:URL.createObjectURL(T)}))},U=w.useMemo(()=>{if(S.type==="bread")return(S.flours?.length||0)+(S.breadIngredients?.length||0);const B=S.ingredientSections||[];return B.length>0?B.reduce((T,z)=>T+(z?.items?.length||0),0):S.ingredients?.length||0},[S.breadIngredients,S.flours,S.ingredientSections,S.ingredients,S.type]),F=w.useMemo(()=>{const B=S.stepSections||[];return B.length>0?B.reduce((T,z)=>T+(z?.items?.length||0),0):S.steps?.length||0},[S.stepSections,S.steps]),ne=B=>{B.preventDefault();let T=[],z=[];if(S.type==="bread")T=S.ingredients.map(ae=>{const{id:xe,...ve}=ae;return ve});else{const ae=S.ingredientSections||[];ae.length===0&&S.ingredients.length>0?T=S.ingredients.map(xe=>{const{id:ve,...Ee}=xe;return Ee}):(T=ae.flatMap(xe=>xe.items.map(ve=>({...ve,groupId:xe.id}))).map(xe=>{const{id:ve,...Ee}=xe;return Ee}),z=ae.map(xe=>({id:xe.id,name:xe.name})))}const H=new Set(S.tags||[]);S.course&&H.add(S.course),S.category&&H.add(S.category),S.type==="bread"&&H.add("");const J=Array.from(H).filter(Boolean);let de=[],q=[];const Y=S.stepSections||[];Y.length===0&&S.steps.length>0?de=S.steps.map(ae=>typeof ae=="string"?{text:ae}:ae):(de=Y.flatMap(ae=>ae.items.map(xe=>({text:xe.text,groupId:ae.id}))),q=Y.map(ae=>({id:ae.id,name:ae.name}))),n({...S,ingredients:T,ingredientGroups:z,steps:de,stepGroups:q,image:S.imageFile||S.image,id:a.id||Date.now(),tags:J,ingredientSections:void 0,stepSections:void 0})},P=!!a?.id;return s.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:ne,children:[d&&s.jsx(Zb,{onClose:()=>f(null),onImport:E,initialMode:d}),s.jsxs("div",{className:"recipe-form-mock__page",children:[s.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:s.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[s.jsxs("div",{className:"recipe-form-mock__crumb",children:[s.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),s.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),s.jsx("span",{className:"recipe-form-mock__crumb-page",children:P?"":""})]}),s.jsxs("div",{className:"recipe-form-mock__actions",children:[s.jsx(le,{type:"button",variant:"ghost",onClick:t,children:""}),s.jsx(le,{type:"submit",variant:"primary",children:""})]})]})}),s.jsxs("div",{className:"recipe-form-mock__sheet",children:[s.jsxs("header",{className:"recipe-form-mock__doc",children:[s.jsxs("div",{className:"recipe-form-mock__doc-title",children:[s.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:S.title,onChange:M,placeholder:"",required:!0}),s.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),s.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[s.jsxs("div",{className:"recipe-form-mock__meta-field",children:[s.jsx(zt,{label:"",id:"course",value:S.course,onChange:M,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),s.jsxs("datalist",{id:"course-options",children:[s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""})]})]}),s.jsxs("div",{className:"recipe-form-mock__meta-field",children:[s.jsx(zt,{label:"",id:"category",value:S.category,onChange:M,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),s.jsxs("datalist",{id:"category-options",children:[s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""}),s.jsx("option",{value:""})]})]}),s.jsxs("div",{className:"recipe-form-mock__meta-field",children:[s.jsx(zt,{label:"",id:"storeName",value:S.storeName,onChange:M,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),s.jsx("datalist",{id:"store-options",children:Zu.map(B=>s.jsx("option",{value:B},B))})]}),s.jsx("div",{className:"recipe-form-mock__meta-field",children:s.jsx(zt,{label:"",id:"servings",value:S.servings,onChange:M,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),s.jsxs("div",{className:"recipe-form-mock__grid",children:[s.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[s.jsxs(on,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[s.jsx("div",{className:"recipe-form-mock__card-title",children:""}),s.jsx(zt,{label:"",id:"description",textarea:!0,value:S.description,onChange:M,placeholder:"..."}),L&&s.jsx("div",{className:"recipe-form__voice-action",children:s.jsx(Xb,{label:"",getCurrentValue:()=>S.description,onTranscript:B=>N(T=>({...T,description:B}))})}),s.jsx(zt,{label:"URL",id:"sourceUrl",value:S.sourceUrl||"",onChange:M,placeholder:"https://example.com/recipe/..."})]}),s.jsxs(on,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[s.jsx("div",{className:"recipe-form-mock__card-title",children:""}),s.jsxs("div",{className:`recipe-form-mock__image-drop ${k?"is-active":""}`,onDragEnter:A,onDragLeave:A,onDragOver:A,onDrop:R,children:[S.image?s.jsxs("div",{className:"recipe-form-mock__image-preview",children:[s.jsx("img",{src:S.image,alt:"",onError:B=>{B.target.style.display="none"}}),s.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>N(B=>({...B,image:"",imageFile:null})),title:"",children:""})]}):s.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",s.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),s.jsx("input",{type:"file",accept:"image/*",onChange:V,className:"recipe-form-mock__image-input"})]})]}),!a?.id&&s.jsxs(on,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[s.jsx("div",{className:"recipe-form-mock__card-title",children:""}),s.jsxs("div",{className:"recipe-form-mock__import-actions",children:[s.jsx(le,{variant:"secondary",type:"button",onClick:()=>f("url"),children:"URL"}),s.jsx(le,{variant:"secondary",type:"button",onClick:()=>f("image"),children:""})]}),s.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),s.jsxs(on,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[s.jsx("div",{className:"recipe-form-mock__card-title",children:""}),s.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[s.jsx("li",{children:""}),s.jsx("li",{children:""}),s.jsx("li",{children:""})]})]})]}),s.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:s.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[s.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[s.jsxs("div",{className:"recipe-form-mock__nav",children:[s.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",s.jsx("span",{className:"recipe-form-mock__nav-count",children:U.toLocaleString()})]}),s.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${o==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",s.jsx("span",{className:"recipe-form-mock__nav-count",children:F.toLocaleString()})]})]}),s.jsx("div",{className:"recipe-form-mock__workspace-right",children:o==="ingredients"?s.jsxs("div",{className:"recipe-form-mock__segmented",children:[s.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${S.type==="normal"?"active":""}`,onClick:()=>N(B=>({...B,type:"normal"})),children:""}),s.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${S.type==="bread"?"active":""}`,onClick:()=>N(B=>({...B,type:"bread"})),children:""})]}):s.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),s.jsx("div",{className:"recipe-form-mock__workspace-body",children:o==="ingredients"?s.jsx("div",{className:"recipe-form-mock__editor-surface",children:S.type==="bread"?s.jsx(Ak,{formData:S,setFormData:N}):s.jsx($k,{formData:S,setFormData:N,priceList:h})}):s.jsx("div",{className:"recipe-form-mock__editor-surface",children:s.jsx(Qk,{formData:S,setFormData:N,voiceInputEnabled:L})})})]})})]})]})]})]})},tT="modulepreload",nT=function(n){return"/app/"+n},c0={},$u=function(t,i,a){let o=Promise.resolve();if(i&&i.length>0){let h=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");o=h(i.map(m=>{if(m=nT(m),m in c0)return;c0[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":tT,y||(x.as="script"),x.crossOrigin="",x.href=m,f&&x.setAttribute("nonce",f),document.head.appendChild(x),y)return new Promise((b,_)=>{x.addEventListener("load",b),x.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return o.then(d=>{for(const f of d||[])f.status==="rejected"&&u(f.reason);return t().catch(u)})},rT=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},ga={async fetchAllProfiles(){try{const{data:t,error:i}=await Ne.rpc("admin_list_profiles");if(!i&&Array.isArray(t))return t;i&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",i)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const n=await Ne.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await Ne.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const a=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let o=null;if(a)try{const{data:d,error:f}=await Ne.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(f)throw f;if(d){const h=rT(d);if(h)return h}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),o=d}const u=await Ne.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(o&&a)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${o.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await Ne.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminResetPassword(n,t){const{data:i,error:a}=await Ne.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(a)throw a;if(i?.error)throw new Error(i.error);return i},async sendPasswordResetEmail(n){const{error:t}=await Ne.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(t)throw t;return!0}},u0="csv_unit_overrides",d0=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),nd={async _getCurrentUserId(){const{data:n,error:t}=await Ne.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:i,error:a}=await Ne.from(u0).select("ingredient_name,csv_unit").eq("user_id",t);if(a){if(d0(a))return new Map;throw a}const o=new Map;return(i||[]).forEach(u=>{u?.ingredient_name&&o.set(String(u.ingredient_name),String(u.csv_unit||""))}),o}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim(),u=String(t||"").trim();if(!o)throw new Error("");if(!u)throw new Error("");const{data:d,error:f}=await Ne.from(u0).upsert({user_id:a,ingredient_name:o,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(f)throw d0(f)?new Error("DB csv_unit_overrides "):f;return d}},h0="ingredient_vendor_orders",f0=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),p0={async getAll(n){const t=String(n||"").trim();if(!t)return[];const{data:i,error:a}=await Ne.from(h0).select("vendor_name,sort_order").eq("user_id",t).order("sort_order",{ascending:!0}).order("vendor_name",{ascending:!0});if(a){if(f0(a))return[];throw a}return(i||[]).map(o=>String(o?.vendor_name||"").trim()).filter(Boolean)},async saveOrder(n,t){const i=String(n||"").trim();if(!i)throw new Error("User ID is required");const a=[],o=new Set;if((t||[]).forEach(h=>{const m=String(h||"").trim();!m||o.has(m)||(o.add(m),a.push(m))}),a.length===0)return;const u=new Date().toISOString(),d=a.map((h,m)=>({user_id:i,vendor_name:h,sort_order:m,updated_at:u})),{error:f}=await Ne.from(h0).upsert(d,{onConflict:"user_id,vendor_name"});if(f)throw f0(f)?new Error("DB ingredient_vendor_orders "):f}},ko="manual",To="__all__",la="__unassigned__",sT=({vendorKey:n,label:t,count:i,active:a,disabled:o,onSelect:u})=>{const{attributes:d,listeners:f,setNodeRef:h,transform:m,transition:y,isDragging:v}=wa({id:n,data:{type:"vendor-order-item"},disabled:!!o}),x={transform:wr.Transform.toString(m),transition:y,opacity:v?.7:1};return s.jsxs("li",{ref:h,style:x,className:`vendor-order-item ${a?"active":""} ${o?"disabled":""}`,onClick:()=>{o||u(n)},role:"button",tabIndex:o?-1:0,onKeyDown:b=>{o||(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),u(n))},"aria-label":`${t} `,children:[s.jsxs("span",{className:"vendor-order-item__label",title:t,children:[t,s.jsxs("span",{className:"vendor-order-item__count",children:["(",Number(i||0).toLocaleString(),")"]})]}),s.jsx("span",{className:"vendor-order-item__handle",...o?{}:d,...o?{}:f,title:"","aria-label":`${t} `,children:""})]})},iT=()=>{const n=Li(),{user:t}=fs(),i=t?.id||null,[a,o]=w.useState([]),[u,d]=w.useState(""),[f,h]=w.useState("all"),[m,y]=w.useState(!1),[v,x]=w.useState(To),[b,_]=w.useState([]),[C,S]=w.useState(!1),[N,k]=w.useState(null),[D,L]=w.useState(!1),[$,E]=w.useState(new Map),[A,R]=w.useState(new Map),[M,V]=w.useState({}),[U,F]=w.useState(!1),[ne,P]=w.useState([]),[B,T]=w.useState(!1),[z,H]=w.useState(""),[J,de]=w.useState(""),[q,Y]=w.useState(!1),[ae,xe]=w.useState(!1),[ve,Ee]=w.useState(null),[he,G]=w.useState(!1),ge=ee=>{const De=String(ee||"").trim();return!De||De==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(De)?De:"food"},Z=ee=>{const De=ge(ee);return De==="food"?"8%":De==="soft_drink"?"8%":De==="alcohol"?"10%":De==="supplies"?"10%":"8%"},Ce=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:ko,label:""}],be=w.useCallback(ee=>{const De=Wt(ee);return De?$?.has(De):!1},[$]),We=_e.useMemo(()=>{const ee={all:a.length,food:0,alcohol:0,soft_drink:0,supplies:0,[ko]:0};return a.forEach(De=>{const Te=ge(De?.itemCategory);ee[Te]=(ee[Te]||0)+1,be(De?.ingredientName)||(ee[ko]=(ee[ko]||0)+1)}),ee},[a,be]),Re=w.useCallback(async()=>{L(!0);try{let ee=await zn.getAllConversions();if((ee?.size||0)===0){await new Promise(Ue=>setTimeout(Ue,350));const Te=await zn.getAllConversions();(Te?.size||0)>0&&(ee=Te)}const De=Array.from(ee.values()).map(Te=>({...Te,clientId:Te.ingredientName,isNew:!1,isEditing:!1}));o(De.sort((Te,Ue)=>String(Te?.ingredientName||"").localeCompare(String(Ue?.ingredientName||""),"ja"))),L(!1),Promise.allSettled([ir.fetchPriceList(),nd.getAll()]).then(([Te,Ue])=>{Te.status==="fulfilled"?E(Te.value||new Map):(E(new Map),console.warn("Failed to load CSV prices (ingredient master still available):",Te.reason)),Ue.status==="fulfilled"?R(Ue.value||new Map):(R(new Map),console.warn("Failed to load CSV unit overrides (ingredient master still available):",Ue.reason))}).catch(Te=>{console.warn("Failed to load auxiliary ingredient master data:",Te),E(new Map),R(new Map)})}catch(ee){n.error(""),console.error("Failed to load ingredients:",ee),L(!1)}},[n]);w.useEffect(()=>{const ee=setTimeout(()=>{Re()},0);return()=>clearTimeout(ee)},[Re]),w.useEffect(()=>{let ee=!0;return(async()=>{if(!i){ee&&_([]);return}try{const Te=await p0.getAll(i);ee&&_(Te)}catch(Te){console.error("Failed to load vendor order:",Te),ee&&_([])}})(),()=>{ee=!1}},[i]);const Pe=()=>{const ee=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,De=["food","alcohol","soft_drink","supplies"].includes(f)?f:"food",Te={clientId:ee,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:De,isNew:!0,isEditing:!0};o(Ue=>[Te,...Ue.map(He=>({...He,isEditing:!1}))]),k(ee)},Ze=w.useCallback(ee=>a.findIndex(De=>De?.clientId===ee),[a]),rt=async ee=>{const De=Ze(ee);if(De<0)return;const Te=a[De];if(!Te.ingredientName||!Te.packetSize||!Te.lastPrice){n.warning("");return}const Ue=parseFloat(Te.yieldPercent),He=Number.isFinite(Ue)?Ue:100;if(He<=0||He>100){n.warning("% 1100 ");return}try{await zn.saveConversion(Te.ingredientName,Te.packetSize,Te.packetUnit,Te.lastPrice,Te.itemCategory,Te.vendor,He),n.success(""),Re(),k(null)}catch(it){n.error(""),console.error("Save error:",it)}},qe=async ee=>{const De=Ze(ee);if(De<0)return;const Te=a[De],Ue=Te?.ingredientName;if(Te.isNew){o(He=>He.filter(it=>it?.clientId!==ee)),k(null);return}try{await zn.deleteConversion(Ue),n.success(""),Re()}catch(He){n.error(""),console.error("Delete error:",He)}},Ae=ee=>{k(ee),o(De=>De.map(Te=>({...Te,isEditing:Te?.clientId===ee})))},Se=ee=>{const De=Ze(ee);De<0||(a[De].isNew?o(Te=>Te.filter(Ue=>Ue?.clientId!==ee)):Re(),k(null))},te=(ee,De,Te)=>{o(Ue=>Ue.map(He=>He?.clientId!==ee?He:{...He,[De]:Te}))},Be=ee=>{const De=parseFloat(ee.lastPrice),Te=parseFloat(ee.packetSize);if(!De||!Te)return"-";const Ue=ee.packetUnit?ee.packetUnit.trim().toLowerCase():"";return Ue==="g"||Ue===""?`${Math.round(De/Te*1e3).toLocaleString()}/kg`:Ue==="ml"||Ue==="cc"||Ue===""||Ue===""?`${Math.round(De/Te*1e3).toLocaleString()}/L`:`${Math.round(De/Te).toLocaleString()}/${ee.packetUnit}`},ut=a.filter(ee=>{const De=String(ee?.ingredientName||"");return De.toLowerCase().includes(u.toLowerCase())?f==="all"?!0:f===ko?!be(De):ge(ee?.itemCategory)===f:!1}),Ct=_e.useMemo(()=>{const ee=new Map;a.forEach(it=>{const gt=String(it?.ingredientName||"").trim();if(!gt)return;const Lt=Wt(gt);if(!Lt)return;const Pt=ee.get(Lt)||[];Pt.push({clientId:it?.clientId,name:gt}),ee.set(Lt,Pt)});const De=new Set,Te=new Set,Ue=new Map,He=[];for(const[it,gt]of ee.entries()){if(!Array.isArray(gt)||gt.length<2)continue;De.add(it),gt.forEach(Pt=>{Pt?.clientId&&Te.add(Pt.clientId)});const Lt=Array.from(new Set(gt.map(Pt=>Pt?.name).filter(Boolean)));Ue.set(it,Lt),He.push({key:it,names:Lt,rows:gt.length})}return He.sort((it,gt)=>{const Lt=String(it?.names?.[0]||""),Pt=String(gt?.names?.[0]||"");return Lt.localeCompare(Pt,"ja")}),{duplicateKeys:De,duplicateClientIds:Te,keyToNames:Ue,groups:He}},[a]);w.useEffect(()=>{m&&(Ct?.groups?.length||0)===0&&y(!1)},[m,Ct]);const Rt=f!=="all"||String(u||"").trim()!=="",mt=ee=>{const De=Wt(ee);if(!De)return"-";const Ue=($?.get(De)||null)?.unit;return Ue?String(Ue):"-"},Ot=w.useCallback(ee=>{const De=Wt(ee);if(!De)return"";const Ue=($?.get(De)||null)?.vendor;return Ue?String(Ue):""},[$]),jt=_e.useCallback(ee=>{const De=String(ee?.vendor||"").trim();if(De)return De;const Te=Ot(ee?.ingredientName);return Te||la},[Ot]),ft=_e.useMemo(()=>{const ee=new Map;ut.forEach(He=>{const it=jt(He);ee.set(it,(ee.get(it)||0)+1)});const De=new Set(ee.keys()),Te=Array.from(ee.entries()).map(([He,it])=>({key:He,count:it})),Ue=new Map((b||[]).map((He,it)=>[He,it]));return Te.sort((He,it)=>{const gt=Ue.has(He.key)?Ue.get(He.key):Number.MAX_SAFE_INTEGER,Lt=Ue.has(it.key)?Ue.get(it.key):Number.MAX_SAFE_INTEGER;return gt!==Lt?gt-Lt:He.key===la&&it.key!==la?1:it.key===la&&He.key!==la?-1:String(He.key).localeCompare(String(it.key),"ja")}),{total:ut.length,vendorKeys:De,entries:Te}},[ut,jt,b]);w.useEffect(()=>{const ee=(ft?.entries||[]).map(De=>De.key);_(De=>{const Te=Array.isArray(De)?De:[],Ue=Te.filter(gt=>ee.includes(gt)),He=ee.filter(gt=>!Ue.includes(gt)),it=[...Ue,...He];return it.length===Te.length&&it.every((gt,Lt)=>gt===Te[Lt])?Te:it})},[ft]);const Vt=ba(ur(dd,{activationConstraint:{distance:6}})),an=w.useCallback(async ee=>{if(N!==null)return;const{active:De,over:Te}=ee;if(!De?.id||!Te?.id||De.id===Te.id)return;const Ue=(ft?.entries||[]).map(ue=>ue.key),He=Ue.indexOf(De.id),it=Ue.indexOf(Te.id);if(He<0||it<0)return;const gt=zi(Ue,He,it),Pt=(Array.isArray(b)?b:[]).filter(ue=>!Ue.includes(ue)),dn=[...gt,...Pt];if(_(dn),!!i)try{await p0.saveOrder(i,dn)}catch(ue){console.error("Failed to save vendor order:",ue),n.error(ue?.message||"")}},[N,i,ft,n,b]);w.useEffect(()=>{v!==To&&(ft?.vendorKeys?.has?.(v)||x(To))},[v,ft]);const xn=_e.useMemo(()=>{let ee=ut.filter(De=>{const Te=De?.clientId,Ue=!!N&&Te===N;return!(m&&!(Ct?.duplicateClientIds||new Set).has(Te)&&!Ue||v!==To&&!(jt(De)===v)&&!Ue)});if(N&&!ee.some(De=>De?.clientId===N)){const De=a.find(Te=>Te?.clientId===N);De&&(ee=[De,...ee])}return ee},[ut,m,Ct,v,jt,N,a]),Mt=ee=>{const De=(ee??"").toString().trim();if(!De)return"";if(Object.prototype.hasOwnProperty.call(M,De))return M[De];const Te=A?.get(De);if(Te)return String(Te);const Ue=mt(De);return Ue==="-"?"":Ue},nn=ee=>{const De=(ee??"").toString().trim();if(!De)return"-";const Te=A?.get(De);return Te?String(Te):mt(De)},cn=async(ee,De)=>{const Te=(ee??"").toString().trim(),Ue=(De??"").toString().trim();if(Te){if(!Ue){V(He=>{const it={...He};return delete it[Te],it});return}try{await nd.upsert(Te,Ue),R(He=>{const it=new Map(He);return it.set(Te,Ue),it}),n.success("CSV")}catch(He){console.error(He),n.error(He?.message||"")}}},Gt=async()=>{if(t?.role==="admin"){F(!0),H(""),P([]),de(""),Y(!1),Ee(null),G(!1),T(!0);try{const ee=await ga.fetchAllProfiles();P(ee||[])}catch(ee){console.error(ee),H("")}finally{T(!1)}}},Xn=()=>{ae||(G(!1),F(!1))},ar=async()=>{if(!(!J||ae)){xe(!0),Ee({type:"info",message:"..."});try{const ee=await zn.adminCopyIngredientMasterToUser(J,{overwrite:q}),De=ee?.unit_conversions||{},Te=ee?.csv_unit_overrides||{},Ue=`: ${Number(De.source_total||0).toLocaleString()}   ${Number(De.copied||0).toLocaleString()} /  ${Number(De.updated||0).toLocaleString()} /  ${Number(De.skipped||0).toLocaleString()}`,He=`(CSV): ${Number(Te.source_total||0).toLocaleString()}   ${Number(Te.copied||0).toLocaleString()} /  ${Number(Te.updated||0).toLocaleString()} /  ${Number(Te.skipped||0).toLocaleString()}`;Ee({type:"success",message:`
${Ue}
${He}`}),n.success("")}catch(ee){console.error(ee),Ee({type:"error",message:`: ${String(ee?.message||ee)}`}),n.error("")}finally{xe(!1)}}};return s.jsxs("div",{className:"ingredient-master-container",children:[s.jsxs("div",{className:"master-header",children:[s.jsx("h3",{children:" "}),s.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[t?.role==="admin"&&s.jsx(le,{variant:"secondary",onClick:Gt,disabled:N!==null||D||ae,title:N!==null?"":void 0,children:""}),s.jsx(le,{variant:"primary",onClick:Pe,disabled:N!==null,children:"+ "})]})]}),s.jsx("div",{className:"master-search",children:s.jsx(zt,{placeholder:"...",value:u,onChange:ee=>d(ee.target.value)})}),s.jsxs("div",{className:"ingredient-master-stats",children:[s.jsxs("span",{children:[": ",s.jsx("strong",{children:(a.length||0).toLocaleString()})," "]}),Rt&&s.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",s.jsx("strong",{children:(ut.length||0).toLocaleString()})," "]}),s.jsxs("button",{type:"button",className:`ingredient-dup-toggle ${m?"active":""}`,onClick:()=>y(ee=>!ee),disabled:N!==null||(Ct?.groups?.length||0)===0,title:N!==null?"":(Ct?.groups?.length||0)===0?"":"",children:[": ",s.jsx("strong",{children:(Ct?.groups?.length||0).toLocaleString()})," "]})]}),s.jsx("div",{className:"ingredient-category-tabs",children:Ce.map(ee=>s.jsxs("button",{type:"button",className:`ingredient-category-tab ${f===ee.key?"active":""}`,onClick:()=>h(ee.key),disabled:N!==null,title:N!==null?"":void 0,children:[ee.label," (",(We[ee.key]??0).toLocaleString(),")"]},ee.key))}),s.jsxs("div",{className:"ingredient-vendor-filter-row",children:[s.jsx("label",{htmlFor:"ingredient-vendor-filter",className:"ingredient-vendor-filter-label",children:""}),s.jsxs("select",{id:"ingredient-vendor-filter",value:v,onChange:ee=>x(ee.target.value),disabled:N!==null,className:"ingredient-vendor-select",title:N!==null?"":"",children:[s.jsxs("option",{value:To,children:[" (",(ft?.total||0).toLocaleString(),")"]}),(ft?.entries||[]).map(({key:ee,count:De})=>{const Te=ee===la?"":ee;return s.jsxs("option",{value:ee,children:[Te," (",Number(De||0).toLocaleString(),")"]},ee)})]}),s.jsx("button",{type:"button",className:`ingredient-vendor-order-toggle ${C?"active":""}`,onClick:()=>S(ee=>!ee),disabled:N!==null,title:N!==null?"":"",children:C?"":""})]}),C&&s.jsxs("div",{className:"ingredient-vendor-order-panel",children:[s.jsx("div",{className:"ingredient-vendor-order-title",children:""}),(ft?.entries||[]).length===0?s.jsx("div",{className:"ingredient-vendor-order-empty",children:""}):s.jsx(Di,{sensors:Vt,collisionDetection:Ku,onDragEnd:an,children:s.jsx(xa,{items:(ft?.entries||[]).map(ee=>ee.key),strategy:Sl,children:s.jsx("ul",{className:"vendor-order-list",children:(ft?.entries||[]).map(({key:ee,count:De})=>{const Te=ee===la?"":ee;return s.jsx(sT,{vendorKey:ee,label:Te,count:De,active:v===ee,disabled:N!==null,onSelect:x},ee)})})})})]}),D?s.jsx("div",{className:"master-loading",children:"..."}):s.jsx("div",{className:"master-table-wrapper",children:s.jsxs("table",{className:"master-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"master-col-no",children:"No"}),s.jsx("th",{children:""}),s.jsx("th",{className:"master-col-category",children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:"CSV"}),s.jsx("th",{children:""}),s.jsx("th",{children:"%"}),s.jsx("th",{children:""})]})}),s.jsx("tbody",{children:xn.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#999"},children:m?"":Rt?"":""})}):xn.map((ee,De)=>{const Te=ee?.clientId??ee?.ingredientName??String(De),Ue=Ot(ee?.ingredientName),He=String(ee?.vendor||"").trim(),it=ee?.isEditing&&!!Ue&&Ue!==He,gt=He||Ue||"",Lt=He?"vendor-tag--master":Ue?"vendor-tag--csv":"vendor-tag--empty",Pt=gt?He&&Ue&&Ue!==He?`: ${He} / CSV: ${Ue}`:He?"":"CSV":"",dn=ge(ee?.itemCategory),ue=dn==="food",Ke=Wt(ee?.ingredientName),at=!!Ke&&Ct?.duplicateKeys?.has?.(Ke),Ye=Ke&&Ct?.keyToNames?.get?.(Ke)||null,kt=at&&Array.isArray(Ye)&&Ye.length>0?`: ${Ye.join(" / ")}`:"";return s.jsxs("tr",{className:[ee.isEditing?"editing":"",at?"duplicate":""].filter(Boolean).join(" "),children:[s.jsx("td",{className:"master-col-no",children:s.jsx("span",{className:"master-col-no__text",children:De+1})}),s.jsx("td",{children:ee.isEditing?s.jsxs("div",{className:"ingredient-name-cell",children:[s.jsx(zt,{value:ee.ingredientName,onChange:xt=>te(Te,"ingredientName",xt.target.value),placeholder:": ",disabled:!ee.isNew,wrapperClassName:"input-group--no-margin"}),s.jsx(zt,{value:ee.vendor||"",onChange:xt=>te(Te,"vendor",xt.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),it&&s.jsx("div",{className:"ingredient-vendor-tags",children:s.jsxs("span",{className:"vendor-tag vendor-tag--csv",title:"CSV",children:[": ",Ue]})})]}):s.jsxs("div",{className:"ingredient-name-cell",children:[s.jsxs("div",{className:"ingredient-name-row",children:[s.jsx("span",{children:ee.ingredientName}),at&&s.jsx("span",{className:"ingredient-dup-badge",title:kt,children:""})]}),s.jsx("div",{className:"ingredient-vendor-tags",children:s.jsxs("span",{className:`vendor-tag ${Lt}`,title:Pt,children:[": ",gt||"-"]})})]})}),s.jsx("td",{className:"master-col-category",children:ee.isEditing?s.jsxs("select",{value:dn,onChange:xt=>te(Te,"itemCategory",xt.target.value),className:"category-select",children:[s.jsx("option",{value:"food",children:"8%"}),s.jsx("option",{value:"soft_drink",children:"8%"}),s.jsx("option",{value:"alcohol",children:"10%"}),s.jsx("option",{value:"supplies",children:"10%"})]}):s.jsx("span",{title:"",children:Z(ee?.itemCategory)})}),s.jsx("td",{children:ee.isEditing?s.jsx(zt,{type:"number",value:ee.lastPrice,onChange:xt=>te(Te,"lastPrice",xt.target.value),placeholder:": 500"}):`${parseFloat(ee.lastPrice||0).toLocaleString()}`}),s.jsx("td",{children:ee.isEditing?s.jsxs("div",{className:"input-with-hint",children:[s.jsx(zt,{type:"number",value:ee.packetSize,onChange:xt=>te(Te,"packetSize",xt.target.value),placeholder:["","","","PC","","",""].includes(ee.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(ee.packetUnit)&&s.jsxs("span",{className:"unit-hint",children:["1",ee.packetUnit,"1"]})]}):ee.packetSize}),s.jsx("td",{children:ee.isEditing?s.jsxs("select",{value:ee.packetUnit,onChange:xt=>te(Te,"packetUnit",xt.target.value),className:"unit-select",children:[s.jsx("option",{value:"g",children:"g"}),s.jsx("option",{value:"ml",children:"ml"}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"cc",children:"cc"})]}):ee.packetUnit}),s.jsx("td",{className:"csv-unit-cell",children:ee.isEditing?s.jsx(zt,{value:Mt(ee.ingredientName),onChange:xt=>{const Dt=(ee.ingredientName??"").toString().trim(),Ft=xt.target.value;V(ot=>({...ot,[Dt]:Ft}))},onBlur:xt=>cn(ee.ingredientName,xt.target.value),placeholder:mt(ee.ingredientName)==="-"?"":`CSV: ${mt(ee.ingredientName)}`}):s.jsx("span",{children:nn(ee.ingredientName)})}),s.jsx("td",{className:"normalized-cost",children:Be(ee)}),s.jsx("td",{children:ue?ee.isEditing?s.jsx(zt,{type:"number",value:ee.yieldPercent??"",onChange:xt=>te(Te,"yieldPercent",xt.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const xt=parseFloat(ee.yieldPercent);if(!Number.isFinite(xt)||xt<=0)return"-";const Dt=Math.round(xt*10)/10;return`${Number.isInteger(Dt)?Math.round(Dt):Dt}%`})():s.jsx("span",{style:{color:"#999"},children:"-"})}),s.jsx("td",{children:s.jsx("div",{className:"action-buttons",children:ee.isEditing?s.jsxs(s.Fragment,{children:[s.jsx(le,{variant:"primary",size:"sm",onClick:()=>rt(Te),children:""}),s.jsx(le,{variant:"ghost",size:"sm",onClick:()=>Se(Te),children:""})]}):s.jsxs(s.Fragment,{children:[s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Ae(Te),disabled:N!==null,children:""}),s.jsx(le,{variant:"ghost",size:"sm",onClick:()=>qe(Te),disabled:N!==null,children:""})]})})})]},Te)})})]})}),s.jsx("div",{className:"master-info",children:s.jsx("p",{children:" "})}),s.jsx(wn,{isOpen:U,onClose:Xn,title:"",size:"medium",showCloseButton:!ae,children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",s.jsx("br",{}),s.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),he?s.jsxs(s.Fragment,{children:[(()=>{const ee=ne.find(Te=>String(Te?.id)===String(J)),De=ee?`${ee.display_id}${ee.email?` (${ee.email})`:""}`:J?String(J).slice(0,8):"-";return s.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),s.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",s.jsx("strong",{children:De}),s.jsx("br",{}),": ",s.jsx("strong",{children:q?"":""})]})]})})(),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>G(!1),disabled:ae,children:""}),s.jsx(le,{variant:"primary",onClick:ar,disabled:!J||ae,children:ae?"...":""})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),B?s.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):s.jsxs("select",{value:J,onChange:ee=>de(ee.target.value),disabled:ae||!!z,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:ae?"#f3f4f6":"white"},children:[s.jsx("option",{value:"",children:"..."}),ne.filter(ee=>String(ee?.id)&&String(ee?.id)!==String(t?.id)).map(ee=>s.jsxs("option",{value:ee.id,children:[ee.display_id,ee.email?` (${ee.email})`:"",ee.role==="admin"?" []":""]},ee.id))]}),z&&s.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:z})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[s.jsx("input",{type:"checkbox",checked:q,onChange:ee=>Y(ee.target.checked),disabled:ae}),""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[s.jsx(le,{variant:"ghost",onClick:Xn,disabled:ae,children:""}),s.jsx(le,{variant:"primary",onClick:()=>G(!0),disabled:!J||ae||B||!!z,children:""})]})]}),ae&&s.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:s.jsxs("div",{className:"bulk-progress-head",children:[s.jsx("div",{className:"bulk-progress-spinner"}),s.jsxs("div",{children:[s.jsx("div",{className:"bulk-progress-title",children:"..."}),s.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),ve?.message&&s.jsx("div",{className:`status-msg ${ve.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:ve.message})]})})]})},Ou="__all_vendors__",ew="__unknown_vendor__",Ao="__all_categories__",ip="food",Pu=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],Tp=Pu.reduce((n,t)=>(n[t.value]=t.label,n),{}),aT=new Set(["","","","","PC","","",""]),oa=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const i=Number(t);return Number.isFinite(i)?i:null},m0=n=>(typeof n=="string"?n.trim():"")||ew,cl=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?ip:Tp[t]?t:ip},lT=()=>{const[n,t]=w.useState([]),[i,a]=w.useState(!0),[o,u]=w.useState(null),[d,f]=w.useState(null),[h,m]=w.useState("all"),[y,v]=w.useState({key:null,direction:"asc"}),[x,b]=w.useState(""),[_,C]=w.useState(Ao),[S,N]=w.useState(Ou),[k,D]=w.useState(!1),[L,$]=w.useState(null),E=w.useRef(null),A=Li(),[R,M]=w.useState({isOpen:!1,title:"",message:"",onConfirm:null}),V=()=>{f(G=>!G||G.phase==="running"?G:null)};w.useEffect(()=>{U()},[]);const U=async()=>{a(!0),$(null);try{console.log("Starting data load for CsvToMasterImporter...");const[G,ge]=await Promise.all([ir.getPriceListArray().catch(Ce=>(console.error("Error fetching price list:",Ce),[])),zn.getAllConversions().catch(Ce=>(console.error("Error fetching conversions:",Ce),new Map))]);if(console.log("Data fetched:",{csvCount:G?.length,masterSize:ge?.size}),!Array.isArray(G))throw new Error("CSV");if(!(ge instanceof Map))throw new Error("Map");const Z=[];for(const Ce of G){if(!Ce||!Ce.name)continue;const be=ge.get(Ce.name),We=cl(be?.itemCategory),Re=be?.packetSize??"",Pe=be?.packetUnit||Ce.unit||"",Ze=be?.lastPrice??"",rt=be?Re:aT.has(Pe)?1:"";Z.push({name:Ce.name,csvPrice:Ce.price,csvUnit:Ce.unit,csvVendor:Ce.vendor,masterCategory:We,masterSize:Re,masterUnit:Pe,masterPrice:Ze,isRegistered:!!be,inputSize:rt,inputUnit:Pe,inputPrice:be?Ze:Ce.price??"",inputCategory:We,isModified:!1})}console.log("Merge completed. Items:",Z.length),t(Z)}catch(G){console.error("Failed to load data for importer:",G),$(G.message||"")}finally{a(!1)}},F=async G=>{u(G.name);try{const ge=oa(G.inputSize),Z=oa(G.inputPrice);if(ge===null||ge<=0){A.error("");return}if(!G.inputUnit){A.error("");return}if(!G.inputCategory){A.error("");return}await zn.saveConversion(G.name,ge,G.inputUnit,Z,G.inputCategory),t(Ce=>Ce.map(be=>be.name===G.name?{...be,isRegistered:!0,isModified:!1,masterSize:ge,masterUnit:G.inputUnit,masterPrice:Z??"",masterCategory:G.inputCategory,inputCategory:G.inputCategory}:be)),A.success("")}catch(ge){console.error("Failed to save ingredient:",ge),A.error("")}finally{u(null)}},ne=async G=>{M(ge=>({...ge,isOpen:!1}));try{const ge=G.filter(Rt=>{const mt=oa(Rt.inputSize);return!(mt!==null&&mt>0)||!Rt.inputUnit||!Rt.inputCategory});if(ge.length>0){const Rt=ge.slice(0,5).map(Ot=>Ot.name).join(""),mt=ge.length>5?` ${ge.length-5}`:"";A.error(`: ${Rt}${mt}`);return}u("bulk");const Z=G.length;f({phase:"running",total:Z,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const Ce=5,be=120;let We=0,Re=0,Pe=0,Ze=0;const rt=[],qe=[],Ae=(Rt=!1,mt="")=>{const Ot=Date.now();!Rt&&Ot-Ze<be||(Ze=Ot,f(jt=>!jt||jt.phase!=="running"?jt:{...jt,processed:We,success:Re,failed:Pe,currentName:mt||jt.currentName}))};let Se=0;const te=async()=>{for(;;){const Rt=Se++;if(Rt>=G.length)return;const mt=G[Rt],Ot=mt?.name?String(mt.name):"";try{const jt=oa(mt.inputSize),ft=oa(mt.inputPrice);if(jt===null||jt<=0)throw new Error("Invalid size");if(!mt.inputUnit)throw new Error("Invalid unit");if(!mt.inputCategory)throw new Error("Invalid category");await zn.saveConversion(mt.name,jt,mt.inputUnit,ft,mt.inputCategory),Re++,rt.push(mt)}catch(jt){Pe++,qe.push(Ot||`#${Rt+1}`),console.error(`Failed to save ${Ot}:`,jt)}finally{We++,Ae(!1,Ot)}}},Be=Math.min(Ce,G.length);await Promise.all(Array.from({length:Be},()=>te())),Ae(!0);const ut=new Set(rt.map(Rt=>Rt.name)),Ct=new Map(G.map(Rt=>[Rt.name,Rt]));t(Rt=>Rt.map(mt=>{if(ut.has(mt.name)){const Ot=Ct.get(mt.name);return{...mt,isRegistered:!0,isModified:!1,masterSize:oa(Ot.inputSize)??"",masterUnit:Ot.inputUnit,masterPrice:oa(Ot.inputPrice)??"",masterCategory:Ot.inputCategory,inputCategory:Ot.inputCategory}}return mt})),Pe===0?A.success(`${Re} `):A.warning(`:  ${Re}  /  ${Pe} `),f({phase:"done",total:Z,processed:We,success:Re,failed:Pe,currentName:"",failedNames:qe.slice(0,10)})}catch(ge){console.error("Bulk save error:",ge),A.error(""),f(Z=>({phase:"error",total:Z?.total??G.length,processed:Z?.processed??0,success:Z?.success??0,failed:Z?.failed??0,currentName:"",failedNames:Z?.failedNames??[],errorMessage:ge?.message?String(ge.message):""}))}finally{u(null)}},P=()=>{const G=n.filter(ge=>ge.isModified);G.length!==0&&M({isOpen:!0,title:"",message:`${G.length} `,onConfirm:()=>ne(G)})},B=(G,ge,Z)=>{t(Ce=>Ce.map(be=>be.name===G?{...be,[ge]:Z,isModified:!0}:be))},T=G=>{(G.key==="ArrowUp"||G.key==="ArrowDown")&&G.preventDefault()},z=G=>{v(ge=>ge.key===G?{key:G,direction:ge.direction==="asc"?"desc":"asc"}:{key:G,direction:"asc"})},H=G=>y.key!==G?"":y.direction==="asc"?" ":" ",J=w.useMemo(()=>{const G=new Map;n.forEach(Z=>{const Ce=m0(Z.csvVendor),be=Ce===ew?"":Ce,We=G.get(Ce);We?We.count+=1:G.set(Ce,{key:Ce,label:be,count:1})});const ge=Array.from(G.values()).sort((Z,Ce)=>Z.label.localeCompare(Ce.label,"ja"));return[{key:Ou,label:"",count:n.length},...ge]},[n]);w.useEffect(()=>{J.some(ge=>ge.key===S)||N(Ou)},[J,S]),w.useEffect(()=>{if(!k)return;const G=Z=>{E.current&&!E.current.contains(Z.target)&&D(!1)},ge=Z=>{Z.key==="Escape"&&D(!1)};return document.addEventListener("mousedown",G),document.addEventListener("touchstart",G),document.addEventListener("keydown",ge),()=>{document.removeEventListener("mousedown",G),document.removeEventListener("touchstart",G),document.removeEventListener("keydown",ge)}},[k]);const de=w.useMemo(()=>S===Ou?n:n.filter(G=>m0(G.csvVendor)===S),[n,S]),q=w.useMemo(()=>{const G={[Ao]:de.length};return Pu.forEach(ge=>{G[ge.value]=0}),de.forEach(ge=>{const Z=cl(ge.inputCategory);G[Z]=(G[Z]||0)+1}),G},[de]),Y=w.useMemo(()=>_===Ao?de:de.filter(G=>cl(G.inputCategory)===_),[de,_]),ae=w.useMemo(()=>({all:Y.length,unregistered:Y.filter(G=>!G.isRegistered).length,registered:Y.filter(G=>G.isRegistered).length}),[Y]),xe=w.useMemo(()=>J.find(G=>G.key===S)||J[0],[J,S]),ve=w.useMemo(()=>Y.filter(G=>!(h==="unregistered"&&G.isRegistered||h==="registered"&&!G.isRegistered||x&&!G.name.includes(x))),[Y,h,x]),Ee=w.useMemo(()=>{if(!y.key)return ve;const G=Ce=>String(Ce??""),ge=Ce=>{const be=parseFloat(Ce);return Number.isFinite(be)?be:Number.NEGATIVE_INFINITY},Z=[...ve];return Z.sort((Ce,be)=>{let We=0;switch(y.key){case"name":We=G(Ce.name).localeCompare(G(be.name),"ja");break;case"csvPrice":We=ge(Ce.csvPrice)-ge(be.csvPrice);break;case"inputCategory":{const Re=Tp[cl(Ce.inputCategory)]||"",Pe=Tp[cl(be.inputCategory)]||"";We=Re.localeCompare(Pe,"ja");break}case"inputSize":We=ge(Ce.inputSize)-ge(be.inputSize);break;case"inputUnit":We=G(Ce.inputUnit).localeCompare(G(be.inputUnit),"ja");break;case"inputPrice":We=ge(Ce.inputPrice)-ge(be.inputPrice);break;default:We=0;break}return We===0&&(We=G(Ce.name).localeCompare(G(be.name),"ja")),y.direction==="asc"?We:-We}),Z},[ve,y]),he=n.filter(G=>G.isModified).length;return i?s.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):L?s.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[s.jsx("h3",{children:""}),s.jsx("p",{children:L}),s.jsx(le,{variant:"secondary",onClick:U,children:""})]}):s.jsxs("div",{className:"csv-importer",children:[s.jsxs("div",{className:"importer-header",children:[s.jsx(zt,{placeholder:"...",value:x,onChange:G=>b(G.target.value),style:{maxWidth:"300px"}}),s.jsxs("div",{className:"filter-buttons",children:[s.jsxs(le,{variant:h==="all"?"primary":"secondary",onClick:()=>m("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",ae.all,")"]}),s.jsxs(le,{variant:h==="unregistered"?"primary":"secondary",onClick:()=>m("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",ae.unregistered,")"]}),s.jsxs(le,{variant:h==="registered"?"primary":"secondary",onClick:()=>m("registered"),size:"sm",children:[" (",ae.registered,")"]})]}),s.jsxs("div",{className:"vendor-dropdown",ref:E,children:[s.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>D(G=>!G),"aria-haspopup":"listbox","aria-expanded":k,children:[s.jsxs("span",{children:[": ",xe?.label," (",xe?.count??0,")"]}),s.jsx("span",{className:`vendor-dropdown-chevron ${k?"open":""}`,children:""})]}),k&&s.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:J.map(G=>s.jsxs("button",{type:"button",className:`vendor-tab ${S===G.key?"active":""}`,onClick:()=>{N(G.key),D(!1)},role:"option","aria-selected":S===G.key,children:[G.label," (",G.count,")"]},G.key))})]}),s.jsxs("div",{className:"category-filter-row",children:[s.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),s.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:_,onChange:G=>C(G.target.value),children:[s.jsxs("option",{value:Ao,children:[" (",q[Ao]||0,")"]}),Pu.map(G=>s.jsxs("option",{value:G.value,children:[G.label," (",q[G.value]||0,")"]},G.value))]})]}),s.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[he>0&&s.jsx(le,{variant:"primary",size:"sm",onClick:P,disabled:o!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o==="bulk"?"...":`(${he})`}),s.jsx(le,{variant:"secondary",size:"sm",onClick:U,children:" "})]})]}),s.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:s.jsxs("table",{className:"enterprise-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{style:{width:"22%"},onClick:()=>z("name"),children:[" (CSV)",H("name")]}),s.jsxs("th",{style:{width:"14%"},onClick:()=>z("csvPrice"),children:[" (CSV)",H("csvPrice")]}),s.jsxs("th",{style:{width:"14%"},onClick:()=>z("inputCategory"),children:[" ",s.jsx("span",{style:{color:"red"},children:"*"}),H("inputCategory")]}),s.jsxs("th",{style:{width:"18%"},onClick:()=>z("inputSize"),children:[" () ",s.jsx("span",{style:{color:"red"},children:"*"}),H("inputSize")]}),s.jsxs("th",{style:{width:"13%"},onClick:()=>z("inputUnit"),children:[" () ",s.jsx("span",{style:{color:"red"},children:"*"}),H("inputUnit")]}),s.jsxs("th",{style:{width:"12%"},onClick:()=>z("inputPrice"),children:[" ()",H("inputPrice")]}),s.jsx("th",{style:{width:"7%"},children:""})]})}),s.jsx("tbody",{children:Ee.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"7",className:"no-data",children:""})}):Ee.map(G=>s.jsxs("tr",{style:{backgroundColor:G.isModified?"#fff8e1":G.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[s.jsxs("td",{style:{fontWeight:"500"},children:[G.name,G.csvVendor&&s.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:G.csvVendor})]}),s.jsxs("td",{children:[G.csvPrice?`${G.csvPrice.toLocaleString()} `:"-",G.csvUnit&&s.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",G.csvUnit]})]}),s.jsx("td",{children:s.jsx("select",{className:"input-field",value:cl(G.inputCategory),onChange:ge=>B(G.name,"inputCategory",ge.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:Pu.map(ge=>s.jsx("option",{value:ge.value,children:ge.label},ge.value))})}),s.jsx("td",{children:s.jsx(zt,{type:"number",value:G.inputSize,onChange:ge=>B(G.name,"inputSize",ge.target.value),onKeyDown:T,placeholder:["","","","PC","","",""].includes(G.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),s.jsx("td",{children:s.jsxs("select",{className:"input-field",value:G.inputUnit,onChange:ge=>B(G.name,"inputUnit",ge.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","","","","","PC","","",""].includes(G.inputUnit)&&G.inputUnit&&s.jsxs("option",{value:G.inputUnit,children:[G.inputUnit," (CSV)"]}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"g",children:"g"}),s.jsx("option",{value:"kg",children:"kg"}),s.jsx("option",{value:"ml",children:"ml"}),s.jsx("option",{value:"L",children:"L"}),s.jsx("option",{value:"cc",children:"cc"}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"PC",children:"PC"}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""}),s.jsx("option",{value:"",children:""})]})}),s.jsx("td",{children:s.jsx(zt,{type:"number",value:G.inputPrice,onChange:ge=>B(G.name,"inputPrice",ge.target.value),placeholder:"",style:{width:"100%"}})}),s.jsx("td",{children:s.jsx(le,{variant:G.isRegistered?"secondary":"primary",size:"sm",onClick:()=>F(G),disabled:o===G.name||o==="bulk",block:!0,children:o===G.name?"...":G.isRegistered?"":""})})]},G.name))})]})}),s.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[s.jsx("p",{children:" CSV"}),s.jsx("p",{children:" "})]}),s.jsxs(wn,{isOpen:R.isOpen,onClose:()=>M({...R,isOpen:!1}),title:R.title,size:"small",children:[s.jsx("div",{style:{marginBottom:"1.5rem"},children:R.message}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[s.jsx(le,{variant:"secondary",onClick:()=>M({...R,isOpen:!1}),children:""}),s.jsx(le,{variant:"primary",onClick:R.onConfirm,children:""})]})]}),s.jsx(wn,{isOpen:!!d,onClose:V,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?s.jsxs("div",{className:"bulk-progress",children:[s.jsxs("div",{className:"bulk-progress-head",children:[s.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("div",{className:"bulk-progress-title",children:""}),s.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),s.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:s.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),s.jsxs("div",{className:"bulk-progress-meta",children:[s.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&s.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?s.jsxs("div",{className:"bulk-progress",children:[s.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&s.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),s.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[s.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),s.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:s.jsx(le,{variant:"primary",onClick:V,children:""})})]}):s.jsxs("div",{className:"bulk-progress",children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),s.jsxs("div",{className:"bulk-progress-meta",children:[s.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),s.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&s.jsxs("div",{className:"bulk-progress-failures",children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),s.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),s.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:s.jsx(le,{variant:"primary",onClick:V,children:""})})]})})]})},g0=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},oT=({onBack:n})=>{const[t,i]=ic(),{user:a}=fs(),[o,u]=w.useState("price"),[d,f]=w.useState(null),[h,m]=w.useState({type:"",message:""}),[y,v]=w.useState(!1),[x,b]=w.useState([]),[_,C]=w.useState(!1),[S,N]=w.useState(null),[k,D]=w.useState({type:"",message:""}),[L,$]=w.useState(null),[E,A]=w.useState(!1),[R,M]=w.useState(!1),[V,U]=w.useState(!1),[F,ne]=w.useState([]),[P,B]=w.useState(!1),[T,z]=w.useState(""),[H,J]=w.useState(""),[de,q]=w.useState(!1),[Y,ae]=w.useState({total:0,done:0,current:""}),[xe,ve]=w.useState(null),[Ee,he]=w.useState(!1),[G,ge]=w.useState(!1),[Z,Ce]=w.useState(!1),[be,We]=w.useState(!1),[Re,Pe]=w.useState({type:"",message:""}),[Ze,rt]=w.useState(!1),[qe,Ae]=w.useState(new Map),[Se,te]=w.useState([]),[Be,ut]=w.useState(""),[Ct,Rt]=w.useState(""),[mt,Ot]=w.useState(""),jt=_e.useMemo(()=>{if(!Be)return[];const ue=qe.get(Be)||[],Ke=new Set;return ue.forEach(at=>{const Ye=g0(at?.dateStr);Ye&&Ke.add(Ye)}),Array.from(Ke).sort((at,Ye)=>Ye.localeCompare(at))},[qe,Be]);w.useEffect(()=>{if(mt){if(!Be){Ot("");return}jt.length>0&&!jt.includes(mt)&&Ot("")}},[jt,mt,Be]);const[ft,Vt]=w.useState({key:"dateStr",direction:"desc"}),[an,xn]=w.useState("");w.useEffect(()=>{const ue=t.get("tab");(ue==="price"||ue==="ingredients"||ue==="csv-import"||ue==="duplicates")&&u(ue)},[]);const Mt=ue=>{let Ke="asc";ft.key===ue&&ft.direction==="asc"&&(Ke="desc"),Vt({key:ue,direction:Ke})},nn=_e.useMemo(()=>{let ue=[...x];if(an){const Ke=an.toLowerCase().trim();ue=ue.filter(at=>at.name&&at.name.toLowerCase().includes(Ke)||at.vendor&&at.vendor.toLowerCase().includes(Ke)||at.dateStr&&at.dateStr.includes(Ke))}return ft.key&&ue.sort((Ke,at)=>{let Ye=Ke[ft.key]||"",kt=at[ft.key]||"";return Ye<kt?ft.direction==="asc"?-1:1:Ye>kt?ft.direction==="asc"?1:-1:0}),ue},[x,ft,an]),[cn,Gt]=w.useState([]);w.useEffect(()=>{ee()},[]),w.useEffect(()=>{let ue=!0;return(async()=>{if(o==="price"){if(a?.role!=="admin"){ue&&(ge(!1),We(!1));return}ge(!0);try{const at=await kp.getVoiceInputEnabled({force:!0});if(!ue)return;We(at),Pe({type:"",message:""})}catch(at){if(console.error("Failed to load voice feature flag:",at),!ue)return;Pe({type:"error",message:""})}finally{ue&&ge(!1)}}})(),()=>{ue=!1}},[o,a?.id,a?.role]);const Xn=async ue=>{if(!(a?.role!=="admin"||Z)){Ce(!0),Pe({type:"info",message:"..."});try{const Ke=await kp.setVoiceInputEnabled(ue);We(Ke),Pe({type:"success",message:`${Ke?"":""}`})}catch(Ke){console.error("Failed to save voice feature flag:",Ke),Pe({type:"error",message:""})}finally{Ce(!1)}}},ar=async()=>{rt(!0);try{const Ke=await ir.fetchPriceHistory()||new Map;Ae(Ke);const at=[];for(const[Ye,kt]of Ke.entries()){const xt=new Set,Dt=[];if((kt||[]).forEach(X=>{const oe=[String(X?.dateStr||""),String(X?.price??""),String(X?.incomingQty??""),String(X?.unit||""),String(X?.vendor||""),String(X?.displayName||"")].join("|");xt.has(oe)||(xt.add(oe),Dt.push(X))}),Dt.length<2)continue;Dt.sort((X,oe)=>String(X?.dateStr||"").localeCompare(String(oe?.dateStr||"")));const Ft=Dt[Dt.length-1]||{},ot=Dt.map(X=>Number(X?.price)).filter(X=>Number.isFinite(X)),re=ot.length?Math.min(...ot):null,$e=ot.length?Math.max(...ot):null,Ve=new Set(Dt.map(X=>String(X?.dateStr||""))).size,_t=new Set(Dt.map(X=>String(X?.displayName||""))).size;let W=0;for(let X=1;X<Dt.length;X++){const oe=Number(Dt[X-1]?.price),fe=Number(Dt[X]?.price);Number.isFinite(oe)&&Number.isFinite(fe)&&oe!==fe&&W++}at.push({key:Ye,name:Ft?.displayName||Ye,lastDate:Ft?.dateStr||"",lastPrice:Number.isFinite(Number(Ft?.price))?Number(Ft?.price):null,lastIncomingQty:Number.isFinite(Number(Ft?.incomingQty))?Number(Ft?.incomingQty):null,unit:Ft?.unit||"",vendor:Ft?.vendor||"",rows:Dt.length,dates:Ve,nameVariants:_t,minPrice:re,maxPrice:$e,changes:W})}at.sort((Ye,kt)=>{const xt=String(Ye?.lastDate||""),Dt=String(kt?.lastDate||"");return xt!==Dt?Dt.localeCompare(xt):(kt?.changes||0)!==(Ye?.changes||0)?(kt?.changes||0)-(Ye?.changes||0):(kt?.rows||0)!==(Ye?.rows||0)?(kt?.rows||0)-(Ye?.rows||0):String(Ye?.name||"").localeCompare(String(kt?.name||""),"ja")}),te(at),Be&&!Ke.has(Be)&&ut("")}catch(ue){console.error(ue)}finally{rt(!1)}};w.useEffect(()=>{o==="duplicates"&&ar()},[o]);const ee=async()=>{C(!0);try{const ue=await ir.getPriceListArray();b(ue);const Ke=await ir.getFileList();Gt(Ke)}catch(ue){console.error("Failed to load price data",ue)}finally{C(!1)}},De=ue=>{ue.target.files&&ue.target.files[0]&&(f(ue.target.files[0]),m({type:"",message:""}))},Te=async()=>{if(!d)return;v(!0),m({type:"info",message:"..."});const ue=await ir.uploadPriceList(d);if(ue.success){m({type:"success",message:"..."});try{const{recipeService:at}=await $u(async()=>{const{recipeService:xt}=await Promise.resolve().then(()=>Ff);return{recipeService:xt}},[]),Ye=await ir.fetchPriceList(),kt=await at.updateRecipeCosts(Ye);m({type:"success",message:`${kt}`})}catch(at){console.error("Cost update failed",at),m({type:"warning",message:""})}f(null);const Ke=document.getElementById("csv-upload-input");Ke&&(Ke.value=""),ee()}else m({type:"error",message:`: ${ue.error.message}`});v(!1)},Ue=ue=>{N({message:`${ue}
`,onConfirm:async()=>{v(!0);const Ke=await ir.deletePriceFile(ue);v(!1),Ke.success?(m({type:"success",message:""}),ee()):m({type:"error",message:`: ${Ke.error.message}`})}})},He=ue=>{ue&&($(ue),A(!0),D({type:"",message:""}))},it=()=>{if(R)return;A(!1),$(null);const ue=document.getElementById("backup-upload-input");ue&&(ue.value="")},gt=async()=>{const ue=L;if(!(!ue||R)){M(!0),D({type:"info",message:"..."});try{const Ke=await ue.text(),at=JSON.parse(Ke),{recipeService:Ye}=await $u(async()=>{const{recipeService:Ft}=await Promise.resolve().then(()=>Ff);return{recipeService:Ft}},void 0),kt=await Ye.importRecipes(at),xt=Number(kt?.count||0),Dt=Array.isArray(kt?.errors)?kt.errors.length:0;D({type:Dt>0?"warning":"success",message:`: ${xt}${Dt>0?` / : ${Dt}`:""}`}),A(!1),$(null)}catch(Ke){console.error(Ke),D({type:"error",message:""})}finally{M(!1);const Ke=document.getElementById("backup-upload-input");Ke&&(Ke.value="")}}},Lt=async()=>{U(!0),ve(null),ae({total:0,done:0,current:""}),J(""),z(""),he(!1),B(!0);try{const ue=await ga.fetchAllProfiles();ne(ue||[])}catch(ue){console.error(ue),ne([]),z("")}finally{B(!1)}},Pt=()=>{de||(he(!1),U(!1))},dn=async()=>{if(!(!H||de)){q(!0),ve({type:"info",message:"..."}),ae({total:0,done:0,current:""});try{const ue=await ir.copyPriceFilesToUser({targetUserId:H,onProgress:({total:Ye,done:kt,current:xt})=>{ae({total:Ye||0,done:kt||0,current:xt||""})}}),Ke=ue?.copied?.length??0,at=ue?.failed?.length??0;ve({type:at>0?"error":"success",message:`: ${Ke}${at>0?` / : ${at}`:""}`,failed:ue?.failed||[]})}catch(ue){console.error(ue),ve({type:"error",message:`: ${String(ue?.message||ue)}`})}finally{q(!1)}}};return s.jsxs("div",{className:["dashboard-container","fade-in",o==="ingredients"||o==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[s.jsxs("div",{className:"dashboard-header",children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[s.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),s.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),s.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[o==="csv-import"&&s.jsx(le,{variant:"secondary",onClick:()=>i({view:"inventory"}),title:"",children:" "}),s.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),s.jsx("div",{className:"tabs-container",children:s.jsxs("div",{className:"tabs",children:[s.jsx("button",{className:`tab ${o==="price"?"active":""}`,onClick:()=>u("price"),children:" "}),s.jsx("button",{className:`tab ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:" "}),s.jsx("button",{className:`tab ${o==="csv-import"?"active":""}`,onClick:()=>u("csv-import"),children:" CSV"}),s.jsx("button",{className:`tab ${o==="duplicates"?"active":""}`,onClick:()=>u("duplicates"),children:" "})]})}),a?.role==="admin"&&o==="price"&&s.jsxs("div",{className:"voice-feature-card",children:[s.jsxs("div",{className:"voice-feature-card__left",children:[s.jsx("div",{className:"voice-feature-card__title",children:" Avalon API"}),s.jsx("div",{className:"voice-feature-card__desc",children:"ON/OFF"})]}),s.jsxs("div",{className:"voice-feature-card__right",children:[s.jsxs("label",{className:`voice-feature-switch ${be?"is-on":""}`,children:[s.jsx("input",{type:"checkbox",checked:be,onChange:ue=>Xn(ue.target.checked),disabled:G||Z}),s.jsx("span",{className:"voice-feature-switch__slider"})]}),s.jsx("div",{className:"voice-feature-card__state",children:G?"...":be?": ":": "})]}),Re.message&&s.jsx("div",{className:`status-msg ${Re.type||"info"}`,style:{marginTop:"10px",width:"100%"},children:Re.message})]}),o==="ingredients"?s.jsx(iT,{}):o==="csv-import"?s.jsx(lT,{}):o==="duplicates"?s.jsxs("div",{className:"dashboard-content",children:[s.jsxs("aside",{className:"dashboard-sidebar",children:[s.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[s.jsxs("div",{className:"sidebar-title",children:[s.jsx("span",{children:""})," ",s.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Se.length.toLocaleString(),""]})]}),s.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[s.jsx(zt,{placeholder:"...",value:Ct,onChange:ue=>Rt(ue.target.value),style:{flex:1,fontSize:"0.9rem"}}),s.jsx(le,{variant:"secondary",size:"sm",onClick:ar,disabled:Ze,title:"",children:""})]}),s.jsx("div",{className:"dup-list",children:Ze?s.jsx("div",{className:"dup-empty",children:"..."}):Se.length===0?s.jsx("div",{className:"dup-empty",children:"2"}):Se.filter(ue=>{const Ke=String(Ct||"").trim();return Ke?String(ue?.name||"").includes(Ke):!0}).map(ue=>{const Ke=ue.key===Be,at=ue.minPrice!==null&&ue.maxPrice!==null&&ue.minPrice!==ue.maxPrice;return s.jsxs("button",{type:"button",className:`dup-item ${Ke?"active":""}`,onClick:()=>ut(ue.key),children:[s.jsxs("div",{className:"dup-item-top",children:[s.jsx("div",{className:"dup-item-name",title:ue.name,children:ue.name}),at&&s.jsx("span",{className:"dup-badge",children:""})]}),s.jsxs("div",{className:"dup-item-meta",children:[s.jsxs("span",{children:[": ",ue.lastDate||"-"]}),s.jsxs("span",{children:[": ",ue.rows,""]}),s.jsxs("span",{children:[": ",ue.dates,""]})]}),s.jsxs("div",{className:"dup-item-meta",children:[s.jsxs("span",{children:[ue.lastPrice!==null?`${Math.round(ue.lastPrice).toLocaleString()}`:"-",ue.unit?` / ${ue.unit}`:""]}),s.jsxs("span",{children:[": ",ue.lastIncomingQty!==null?Math.round(ue.lastIncomingQty).toLocaleString():"-"]}),ue.vendor?s.jsxs("span",{title:ue.vendor,children:[": ",ue.vendor]}):s.jsx("span",{children:": -"})]}),ue.nameVariants>1&&s.jsxs("div",{className:"dup-item-note",children:[": ",ue.nameVariants,""]})]},ue.key)})})]}),s.jsxs("div",{className:"sidebar-card",children:[s.jsx("div",{className:"sidebar-title",children:" "}),s.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[s.jsx("li",{style:{marginBottom:"4px"},children:""}),s.jsx("li",{style:{marginBottom:"4px"},children:""}),s.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),s.jsxs("main",{className:"dashboard-main",children:[s.jsxs("div",{className:"main-toolbar",children:[s.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:s.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:Be?"":""})}),s.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[s.jsxs("select",{value:mt,onChange:ue=>Ot(ue.target.value),disabled:!Be,title:Be?"":"",className:"dup-month-select",children:[s.jsx("option",{value:"",children:""}),jt.map(ue=>s.jsx("option",{value:ue,children:ue.replace("-","/")},ue))]}),s.jsx(le,{variant:"secondary",size:"sm",onClick:ar,disabled:Ze,children:" "})]})]}),s.jsx("div",{className:"table-wrapper",children:(()=>{if(!Be)return s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const ue=qe.get(Be)||[],Ke=new Set,at=[];ue.forEach(ot=>{const re=[String(ot?.dateStr||""),String(ot?.price??""),String(ot?.incomingQty??""),String(ot?.unit||""),String(ot?.vendor||""),String(ot?.displayName||""),String(ot?.sourceFile||"")].join("|");Ke.has(re)||(Ke.add(re),at.push(ot))}),at.sort((ot,re)=>String(ot?.dateStr||"").localeCompare(String(re?.dateStr||"")));const Ye=mt?at.filter(ot=>g0(ot?.dateStr)===mt):at,kt=Ye.map((ot,re)=>{const $e=re>0?Ye[re-1]:null,Ve=$e?Number($e?.price):NaN,_t=Number(ot?.price);let W=null,X=null;return Number.isFinite(Ve)&&Number.isFinite(_t)&&(W=_t-Ve,X=Ve!==0?W/Ve*100:null),{...ot,_diff:W,_pct:X}}),xt=Ye.reduce((ot,re)=>{const $e=Number(re?.incomingQty);return ot+(Number.isFinite($e)?$e:0)},0),Dt=Ye.reduce((ot,re)=>{const $e=Number(re?.incomingQty),Ve=Number(re?.price);return!Number.isFinite($e)||!Number.isFinite(Ve)?ot:ot+$e*Ve},0),Ft=[...kt].reverse();return s.jsxs("table",{className:"enterprise-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"120px"},children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:"CSV"}),s.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),s.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),s.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),s.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),s.jsx("tbody",{children:Ft.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"7",className:"no-data",children:mt?`${mt}`:""})}):Ft.map((ot,re)=>{const $e=ot?._diff,Ve=ot?._pct,_t=$e==null||!Number.isFinite($e)?"-":`${$e>=0?"+":""}${Math.round($e).toLocaleString()}`,W=Ve==null||!Number.isFinite(Ve)?"":` (${Ve>=0?"+":""}${Ve.toFixed(1)}%)`,X=$e==null||!Number.isFinite($e)?"#888":$e>0?"#c92a2a":$e<0?"#2b8a3e":"#666",oe=Number(ot?.price),fe=Number.isFinite(oe)?`${Math.round(oe).toLocaleString()}`:"-",ze=Number(ot?.incomingQty),Fe=Number.isFinite(ze)?Math.round(ze).toLocaleString():"-",Je=Number.isFinite(ze)&&Number.isFinite(oe)?ze*oe:NaN,Qe=Number.isFinite(Je)?`${Math.round(Je).toLocaleString()}`:"-";return s.jsxs("tr",{children:[s.jsx("td",{className:"col-date",children:ot?.dateStr||"-"}),s.jsx("td",{children:ot?.vendor||"-"}),s.jsx("td",{style:{fontWeight:500},children:ot?.displayName||"-"}),s.jsx("td",{className:"col-number",children:Fe}),s.jsxs("td",{className:"col-number",children:[fe,ot?.unit&&s.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",ot.unit]})]}),s.jsx("td",{className:"col-number",children:Qe}),s.jsxs("td",{className:"col-number",style:{color:X},children:[_t,W]})]},`${ot?.dateStr||"d"}-${re}`)})}),Ft.length>0&&s.jsx("tfoot",{children:s.jsxs("tr",{children:[s.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",mt?`${mt}`:""]}),s.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(xt).toLocaleString()}),s.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),s.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(Dt).toLocaleString()]}),s.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):s.jsxs("div",{className:"dashboard-content",children:[s.jsxs("aside",{className:"dashboard-sidebar",children:[s.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[s.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[s.jsx("span",{children:""})," "]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),s.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const ue=await $u(()=>Promise.resolve().then(()=>Ff),void 0).then(kt=>kt.recipeService.exportAllRecipes()),Ke=new Blob([JSON.stringify(ue,null,2)],{type:"application/json"}),at=URL.createObjectURL(Ke),Ye=document.createElement("a");Ye.href=at,Ye.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Ye),Ye.click(),document.body.removeChild(Ye),URL.revokeObjectURL(at)}catch(ue){D({type:"error",message:""}),console.error(ue)}},children:" JSON"})]}),s.jsxs("div",{children:[s.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),s.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:ue=>{const Ke=ue.target.files?.[0];Ke&&He(Ke)}}),s.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:y||R,children:" "}),k.message&&s.jsx("div",{className:`status-msg ${k.type}`,style:{marginTop:"10px"},children:k.message})]})]}),s.jsxs("div",{className:"sidebar-card",children:[s.jsxs("div",{className:"sidebar-title",children:[s.jsx("span",{children:""})," "]}),s.jsxs("div",{className:"upload-area",children:[s.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",s.jsx("br",{}),s.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",s.jsx("br",{})," 2: "]})]}),s.jsx("input",{type:"file",accept:".csv",onChange:De,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),s.jsx(le,{variant:"primary",onClick:Te,disabled:!d||y,className:"upload-btn",size:"sm",block:!0,children:y?"...":""})]}),h.message&&s.jsx("div",{className:`status-msg ${h.type}`,children:h.message})]}),a?.role==="admin"&&s.jsxs("div",{className:"sidebar-card",children:[s.jsxs("div",{className:"sidebar-title",children:[s.jsx("span",{children:""})," "]}),s.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",s.jsx("br",{}),s.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),s.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",cn.length,""]}),s.jsx("div",{style:{marginTop:"0.75rem"},children:s.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:Lt,disabled:de||y,title:"",children:""})})]}),s.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[s.jsxs("div",{className:"sidebar-title",children:[s.jsx("span",{children:""})," ",s.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[cn.length,""]})]}),cn.length===0?s.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):s.jsx("div",{className:"file-list",children:cn.map(ue=>s.jsxs("div",{className:"file-list-item",children:[s.jsx("span",{className:"file-name",title:ue.name,children:ue.name}),s.jsx(le,{variant:"danger",size:"sm",onClick:()=>Ue(ue.name),disabled:y,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},ue.name))})]}),s.jsxs("div",{className:"sidebar-card",children:[s.jsx("div",{className:"sidebar-title",children:" "}),s.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[s.jsx("li",{style:{marginBottom:"4px"},children:""}),s.jsx("li",{style:{marginBottom:"4px"},children:" "}),s.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),s.jsxs("main",{className:"dashboard-main",children:[s.jsxs("div",{className:"main-toolbar",children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[s.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),s.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",nn.length.toLocaleString()," "]})]}),s.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[s.jsx(zt,{placeholder:" (, , )...",value:an,onChange:ue=>xn(ue.target.value),style:{width:"250px",fontSize:"0.9rem"}}),s.jsx(le,{variant:"secondary",size:"sm",onClick:ee,children:" "})]})]}),s.jsx("div",{className:"table-wrapper",children:_?s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):s.jsxs("table",{className:"enterprise-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{onClick:()=>Mt("dateStr"),style:{width:"120px"},children:[" ",ft.key==="dateStr"&&(ft.direction==="asc"?"":"")]}),s.jsxs("th",{onClick:()=>Mt("vendor"),children:[" ",ft.key==="vendor"&&(ft.direction==="asc"?"":"")]}),s.jsxs("th",{onClick:()=>Mt("name"),children:[" ",ft.key==="name"&&(ft.direction==="asc"?"":"")]}),s.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),s.jsx("tbody",{children:nn.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"4",className:"no-data",children:""})}):nn.map((ue,Ke)=>s.jsxs("tr",{children:[s.jsx("td",{className:"col-date",children:ue.dateStr||"-"}),s.jsx("td",{children:ue.vendor||"-"}),s.jsx("td",{style:{fontWeight:"500"},children:ue.name}),s.jsxs("td",{className:"col-number",children:[ue.price?ue.price.toLocaleString():"-",ue.unit&&s.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",ue.unit]})]})]},Ke))})]})})]})]}),s.jsx(wn,{isOpen:E,onClose:it,title:" / ",size:"medium",showCloseButton:!R,children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",s.jsx("br",{}),s.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),s.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),s.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:L?.name||"-"})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[s.jsx(le,{variant:"ghost",onClick:it,disabled:R,children:""}),s.jsx(le,{variant:"primary",onClick:gt,disabled:!L||R,children:R?"...":""})]}),R&&s.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:s.jsxs("div",{className:"bulk-progress-head",children:[s.jsx("div",{className:"bulk-progress-spinner"}),s.jsxs("div",{children:[s.jsx("div",{className:"bulk-progress-title",children:"..."}),s.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),k.message&&s.jsx("div",{className:`status-msg ${k.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:k.message})]})}),s.jsx(wn,{isOpen:V,onClose:Pt,title:"",size:"medium",showCloseButton:!de,children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",s.jsx("br",{}),s.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",s.jsx("code",{children:"_copy"})," "]})]}),s.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",s.jsx("strong",{style:{color:"#111827"},children:a?.displayId||""})," / : ",cn.length,""]}),Ee?s.jsxs(s.Fragment,{children:[(()=>{const ue=F.find(at=>String(at?.id)===String(H)),Ke=ue?`${ue.display_id}${ue.email?` (${ue.email})`:""}`:H?String(H).slice(0,8):"-";return s.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[s.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),s.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",s.jsx("strong",{children:Ke}),s.jsx("br",{}),": ",s.jsx("strong",{children:cn.length.toLocaleString()})," CSV",s.jsx("br",{}),": ",s.jsx("code",{children:"_copy"})," "]})]})})(),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>he(!1),disabled:de,children:""}),s.jsx(le,{variant:"primary",onClick:dn,disabled:!H||de,children:de?"...":""})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),P?s.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):s.jsxs("select",{value:H,onChange:ue=>J(ue.target.value),disabled:de||!!T,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:de?"#f3f4f6":"white"},children:[s.jsx("option",{value:"",children:"..."}),F.filter(ue=>String(ue?.id)&&String(ue?.id)!==String(a?.id)).map(ue=>s.jsxs("option",{value:ue.id,children:[ue.display_id,ue.email?` (${ue.email})`:"",ue.role==="admin"?" []":""]},ue.id))]}),T&&s.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:T})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[s.jsx(le,{variant:"ghost",onClick:Pt,disabled:de,children:""}),s.jsx(le,{variant:"primary",onClick:()=>he(!0),disabled:!H||de||P||!!T,children:""})]})]}),de&&s.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[s.jsxs("div",{className:"bulk-progress-head",children:[s.jsx("div",{className:"bulk-progress-spinner"}),s.jsxs("div",{children:[s.jsx("div",{className:"bulk-progress-title",children:"..."}),s.jsx("div",{className:"bulk-progress-subtitle",children:Y.total?`${Y.done} / ${Y.total}`:"..."})]})]}),s.jsx("div",{className:"bulk-progress-bar",children:s.jsx("div",{className:"bulk-progress-bar-inner",style:{width:Y.total?`${Math.round(Y.done/Y.total*100)}%`:"0%"}})}),s.jsx("div",{className:"bulk-progress-current",title:Y.current,children:Y.current})]}),xe?.message&&s.jsx("div",{className:`status-msg ${xe.type||"info"}`,children:xe.message}),Array.isArray(xe?.failed)&&xe.failed.length>0&&s.jsxs("div",{className:"bulk-progress-failures",children:[s.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",xe.failed.length,""]}),s.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:xe.failed.slice(0,10).map((ue,Ke)=>s.jsxs("li",{children:[ue?.file||"-",": ",ue?.errorMessage||"unknown error"]},`${ue?.file||"f"}-${Ke}`))}),xe.failed.length>10&&s.jsxs("div",{style:{marginTop:"6px"},children:["... ",xe.failed.length-10,""]})]})]})}),S&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>N(null),children:s.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:ue=>ue.stopPropagation(),children:[s.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),s.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:S.message}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>N(null),children:""}),s.jsx(le,{variant:"danger",onClick:()=>{S.onConfirm(),N(null)},children:""})]})]})})]})},cT=({recipes:n,recentIds:t,onSelect:i})=>{if(!t||t.length===0)return null;const a=t.map(o=>n.find(u=>u.id===o)).filter(Boolean).slice(0,7);return a.length===0?null:s.jsxs("div",{className:"recent-recipes",children:[s.jsx("h3",{className:"recent-header",children:""}),s.jsx("div",{className:"recent-list",children:a.map(o=>s.jsxs("div",{className:"recent-item",onClick:()=>i(o),children:[s.jsx("div",{className:"recent-thumbnail",children:o.image?s.jsx("img",{src:o.image,alt:o.title}):s.jsx("div",{className:"recent-placeholder"})}),s.jsx("div",{className:"recent-info",children:s.jsx("div",{className:"recent-title",children:o.title})})]},o.id))})]})},uT=({onBack:n})=>(w.useEffect(()=>{window.scrollTo(0,0)},[]),s.jsxs("div",{className:"levain-guide-container",children:[s.jsxs("header",{className:"levain-guide-header",children:[s.jsx("h1",{children:"LEVAIN GUIDE"}),s.jsx("p",{className:"subtitle",children:" "}),s.jsx("p",{className:"subtitle",children:""}),s.jsx("div",{className:"divider"})]}),s.jsxs("main",{className:"levain-guide-main",children:[s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("p",{children:"Levain"}),s.jsx("h3",{children:""}),s.jsx("p",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",s.jsx("br",{}),s.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",s.jsx("br",{}),s.jsx("strong",{children:""})," Acetobacter aceti "]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"science-box",children:["",s.jsx("br",{}),s.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",s.jsx("br",{}),"(   +  + )"]}),"",s.jsx("br",{}),s.jsxs("div",{className:"formula",children:["CHO  2CHO",s.jsx("br",{}),"(  )"]})]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[" ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," "]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:"- 7-10"}),s.jsxs("div",{className:"timeline",children:[s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),s.jsx("p",{children:"100g + 100ml 20-22"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""})," "]})]}),s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),s.jsx("p",{children:"50%50g + 50ml "}),s.jsx("p",{children:"100g  50g50g + 50ml"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),s.jsx("p",{children:"50%50g + 50ml "}),s.jsxs("div",{className:"success-box",children:[" ",s.jsx("br",{})," ",s.jsx("br",{})," "]})]}),s.jsxs("div",{className:"timeline-item",children:[s.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),s.jsx("p",{children:"1150%1:1"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""}),s.jsx("br",{})," 15",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," pH 3.5-4.0"]})]})]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:"(g)"}),s.jsx("th",{children:"(ml)"}),s.jsx("th",{children:"(g)"}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"0"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"2"}),s.jsx("td",{children:"1"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"100"}),s.jsx("td",{children:"0"}),s.jsx("td",{children:""})]})]})]})})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"5-8"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"2-4"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"15-18"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"1-2"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"20-22"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"3-5"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"25-28"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"2-3"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"30"}),s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:"1-2"})]})]})]})}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"step-list",children:[s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:"1"}),s.jsx("br",{}),"100g50g + 50ml"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""}),s.jsx("br",{}),"8-12"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""}),s.jsx("br",{}),""]})]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"science-box",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""})," "]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:"2%100ml2g"}),s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," "]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:"2"}),s.jsxs("div",{className:"step-list",children:[s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:"Day 12 8:00"}),s.jsx("br",{}),"50g25g + 25ml "]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:"Day 1  14:00"}),s.jsx("br",{}),"25g + 25ml 2"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:"Day 1  20:00"}),s.jsx("br",{}),""]})]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"warning-box",children:[s.jsx("strong",{children:" "})," ",s.jsx("br",{}),"",s.jsx("br",{}),s.jsx("br",{}),s.jsx("strong",{children:" "})," pH",s.jsx("br",{}),"pH 3.5-4.0pH"]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"18"}),s.jsx("td",{children:"16-24"}),s.jsx("td",{children:"1"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"20-22"}),s.jsx("td",{children:"12-16"}),s.jsx("td",{children:"2"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"24-26"}),s.jsx("td",{children:"8-12"}),s.jsx("td",{children:"2"})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"28"}),s.jsx("td",{children:"4-8"}),s.jsx("td",{children:"2"})]})]})]})})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:"1"}),s.jsxs("div",{className:"warning-box",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{}),"1. 22",s.jsx("br",{}),"2. 12",s.jsx("br",{}),"3. 1",s.jsx("br",{}),"4. 1-2"]}),s.jsx("h3",{children:"2"}),s.jsxs("div",{className:"warning-box",children:[s.jsx("strong",{children:""})," pH",s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{})," ",s.jsx("br",{})," "]}),s.jsx("h3",{children:"3"}),s.jsxs("div",{className:"warning-box",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{}),"1. ",s.jsx("br",{}),"2. 15",s.jsx("br",{}),"3. 80%"]}),s.jsx("h3",{children:"4"}),s.jsxs("div",{className:"success-box",children:["",s.jsx("br",{}),s.jsx("br",{}),s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""})," "]}),s.jsx("h3",{children:"5"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{}),"1. 1:0.8",s.jsx("br",{}),"2. ",s.jsx("br",{}),"3. "]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:"pH"}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:"pH4-8.0"}),s.jsx("br",{}),s.jsx("br",{})," pH 7.0",s.jsx("br",{})," pH 4.5-5.5",s.jsx("br",{})," pH 3.5-4.0",s.jsx("br",{})," pH 3.0"]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]})]})]})}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"science-box",children:[s.jsx("strong",{children:"pH 3.8-4.0"})," ",s.jsx("br",{}),s.jsx("strong",{children:"pH 3.5"})," ",s.jsx("br",{}),s.jsx("strong",{children:"pH 4.5"})," "]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""}),s.jsx("br",{})," 1",s.jsx("br",{})," ",s.jsx("br",{})," -203"]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:"15-20"}),s.jsx("td",{children:"18-20"}),s.jsx("td",{children:"1-2"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"25+"}),s.jsx("td",{children:"22-24"}),s.jsx("td",{children:""}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"18-22"}),s.jsx("td",{children:"20-22"}),s.jsx("td",{children:"1-2"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:"5-15"}),s.jsx("td",{children:"18"}),s.jsx("td",{children:"2-3"}),s.jsx("td",{children:""})]})]})]})}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:""}),s.jsx("br",{})," ",s.jsx("br",{})," 24",s.jsx("br",{})," ",s.jsx("br",{}),s.jsx("br",{}),s.jsx("strong",{children:""}),s.jsx("br",{})," ",s.jsx("br",{})," 18",s.jsx("br",{})," "]}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"step-list",children:[s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""})," ",s.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""}),s.jsx("br",{}),"100g + 50g + 150ml 12-24",s.jsx("br",{}),"11-2"]}),s.jsxs("div",{className:"step",children:[s.jsx("strong",{children:""}),s.jsx("br",{})," ",s.jsx("br",{})," ",s.jsx("br",{})," "]})]})]})]}),s.jsxs("div",{className:"levain-section",children:[s.jsx("h2",{children:""}),s.jsxs("div",{className:"levain-content",children:[s.jsx("h3",{children:""}),s.jsxs("div",{className:"highlight-box",children:[s.jsx("strong",{children:"100ml"}),s.jsx("br",{})," 110 to 110 CFU/ml",s.jsx("br",{})," 110 to 110 CFU/ml",s.jsx("br",{})," pH3.5-4.0",s.jsx("br",{})," 0.5-1.5%",s.jsx("br",{})," 0.3-0.8%"]}),s.jsx("h3",{children:""}),s.jsx("div",{className:"comparison-table-container",children:s.jsxs("table",{className:"levain-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"15-25% ()"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"5-15%"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"20-30%"}),s.jsx("td",{children:""})]}),s.jsxs("tr",{children:[s.jsx("td",{children:""}),s.jsx("td",{children:"30-50%"}),s.jsx("td",{children:""})]})]})]})}),s.jsx("h3",{children:""}),s.jsxs("div",{className:"formula",children:[" 18   - 8",s.jsx("br",{}),s.jsx("br",{}),"",s.jsx("br",{})," 2018  (20-8) = 1.5",s.jsx("br",{})," 2418  (24-8) = 1.125",s.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),s.jsxs("footer",{className:"levain-footer",children:[s.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),s.jsx("p",{children:""})]}),s.jsxs("button",{className:"levain-back-button",onClick:n,children:[s.jsx("span",{children:""})," "]})]})),dT=({onBack:n})=>{const{user:t,patchCurrentUserProfile:i}=fs(),[a,o]=w.useState([]),[u,d]=w.useState(!0),[f,h]=w.useState(null),[m,y]=w.useState(null),[v,x]=w.useState(""),[b,_]=w.useState(""),[C,S]=w.useState(""),[N,k]=w.useState(""),[D,L]=w.useState(!1),[$,E]=w.useState(!1),[A,R]=w.useState(new Set);w.useEffect(()=>{M()},[]);const M=async()=>{try{d(!0);const B=await ga.fetchAllProfiles();o(B)}catch(B){console.error(B),h("")}finally{d(!1)}},V=a.filter(B=>B.role==="admin"),U=a.filter(B=>B.role!=="admin"),F=(B,T)=>{R(z=>{const H=new Set(z);return T?H.add(B):H.delete(B),H})},ne=async(B,T)=>{const z=!!B.show_master_recipes;h(null),o(H=>H.map(J=>J.id===B.id?{...J,show_master_recipes:T}:J)),B.id===t?.id&&i?.({showMasterRecipes:T}),F(B.id,!0);try{const J=!!(await ga.updateProfile(B.id,{show_master_recipes:T}))?.show_master_recipes;o(de=>de.map(q=>q.id===B.id?{...q,show_master_recipes:J}:q)),B.id===t?.id&&i?.({showMasterRecipes:J})}catch(H){console.error(H),o(J=>J.map(de=>de.id===B.id?{...de,show_master_recipes:z}:de)),B.id===t?.id&&i?.({showMasterRecipes:z}),h("RLS")}finally{F(B.id,!1)}},P=({user:B,isAdmin:T})=>s.jsxs(on,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[s.jsxs("div",{children:[s.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[B.display_id," ",T&&s.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),B.email&&s.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:B.email}),s.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date(B.created_at).toLocaleString()]}),s.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",B.updated_at?new Date(B.updated_at).toLocaleString():"---"]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[s.jsx("input",{type:"checkbox",checked:B.show_master_recipes||!1,disabled:A.has(B.id),onChange:z=>ne(B,z.target.checked)}),""]}),s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>{y({id:B.id,display_id:B.display_id,email:B.email}),x(""),_(""),S(""),k("")},style:{whiteSpace:"nowrap"},children:""})]})]},B.id);return s.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",height:"100%",overflowY:"auto"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[s.jsx("h2",{children:""}),s.jsx(le,{variant:"ghost",onClick:n,children:""})]}),f&&s.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:f}),u?s.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[V.length>0&&s.jsxs("div",{children:[s.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:V.map(B=>s.jsx(P,{user:B,isAdmin:!0},B.id))})]}),s.jsxs("div",{children:[s.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:U.length>0?U.map(B=>s.jsx(P,{user:B,isAdmin:!1},B.id)):s.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),s.jsx(wn,{isOpen:!!m,onClose:()=>{D||y(null)},title:": ",size:"small",children:s.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[s.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",m?.display_id||m?.email||m?.id]}),m?.email&&s.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:m.email}),s.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),C&&s.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:C}),N&&s.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:N}),s.jsxs("div",{style:{display:"grid",gap:"10px"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),s.jsx("input",{type:"password",value:v,onChange:B=>x(B.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),s.jsx("input",{type:"password",value:b,onChange:B=>_(B.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),s.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>y(null),disabled:D,children:""}),s.jsx(le,{variant:"secondary",isLoading:$,disabled:!m?.email||D,onClick:async()=>{if(S(""),k(""),!m?.email){S("");return}E(!0);try{await ga.sendPasswordResetEmail(m.email),k("")}catch(B){console.error(B),S(B?.message||"")}finally{E(!1)}},style:{whiteSpace:"nowrap"},children:""}),s.jsx(le,{variant:"danger",isLoading:D,onClick:async()=>{if(S(""),k(""),!!m?.id){if(!v||v.length<8){S("8");return}if(v!==b){S("");return}L(!0);try{await ga.adminResetPassword(m.id,v),k(""),x(""),_("")}catch(B){console.error(B);const T=B?.message||"";/FunctionsHttpError|not found|404/i.test(T)||/admin-reset-password/i.test(T)?S(""):S(T)}finally{L(!1)}}},children:""})]})]})})]})},bs="inventory_items",ca="inventory_snapshots",Ro="deleted_inventory_snapshots",ul=(n,t)=>{const i=String(n?.message||"");return String(n?.code||"")==="42703"?i.toLowerCase().includes(String(t).toLowerCase()):i.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&i.toLowerCase().includes("does not exist")},Wn={getAll:async n=>{if(!n)return[];const{data:t,error:i}=await Ne.from(bs).select("*").eq("user_id",n).order("created_at",{ascending:!0});return i?(console.error("Error fetching inventory:",i),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:i,isPhantom:a,_master:o,_csv:u,...d}=t,f=t?.tax10_override??t?.tax10Override,h=Object.prototype.hasOwnProperty.call(t||{},"tax10"),m=Object.prototype.hasOwnProperty.call(t||{},"tax10_override")||Object.prototype.hasOwnProperty.call(t||{},"tax10Override"),y=String(d?.name??"").trim(),v=String(d?.vendor??"").trim(),x={...d,name:y,vendor:v||null,user_id:n,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0};h&&(x.tax10=!!t.tax10),m&&(x.tax10_override=!!f);const b=async S=>Ne.from(bs).insert([S]).select().single();let{data:_,error:C}=await b(x);if(C){const S=ul(C,"tax10"),N=ul(C,"tax10_override");if(S||N){const k={...x};S&&delete k.tax10,N&&delete k.tax10_override,{data:_,error:C}=await b(k)}}if(C&&String(C?.code||"")==="23505"){let S=Ne.from(bs).select("*").eq("user_id",n).eq("name",y).order("updated_at",{ascending:!1}).order("id",{ascending:!1}).limit(1);v?S=S.eq("vendor",v):S=S.is("vendor",null);const{data:N,error:k}=await S;if(!k&&Array.isArray(N)&&N.length>0){const D=N[0];return await Wn.update(n,{...D,...x,id:D.id})}}if(C)throw console.error("Error adding item:",C),C;return _},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:i,isPhantom:a,created_at:o,_master:u,_csv:d,...f}=t,h=t?.tax10_override??t?.tax10Override,m=Object.prototype.hasOwnProperty.call(t||{},"tax10"),y=Object.prototype.hasOwnProperty.call(t||{},"tax10_override")||Object.prototype.hasOwnProperty.call(t||{},"tax10Override"),v={...f,name:Object.prototype.hasOwnProperty.call(f||{},"name")?String(f.name??"").trim():f.name,vendor:Object.prototype.hasOwnProperty.call(f||{},"vendor")?String(f.vendor??"").trim()||null:f.vendor,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()};m&&(v.tax10=!!t.tax10),y&&(v.tax10_override=!!h);const x=async C=>Ne.from(bs).update(C).eq("id",t.id).eq("user_id",n).select().single();let{data:b,error:_}=await x(v);if(_){const C=ul(_,"tax10"),S=ul(_,"tax10_override");if(C||S){const N={...v};C&&delete N.tax10,S&&delete N.tax10_override,{data:b,error:_}=await x(N)}}if(_)throw console.error("Error updating item:",_),_;return b},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:i}=await Ne.from(bs).delete().eq("id",t).eq("user_id",n);if(i)throw console.error("Error deleting item:",i),i},adjustStock:async(n,t,i)=>{if(!n)throw new Error("User ID is required");const{data:a,error:o}=await Ne.from(bs).select("quantity").eq("id",t).eq("user_id",n).single();if(o||!a)throw new Error("Item not found");const u=Math.max(0,(a.quantity||0)+i),{data:d,error:f}=await Ne.from(bs).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(f)throw f;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await Ne.from(bs).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:i}=await Ne.from("ignored_items").select("name").eq("user_id",n);return i?(console.error("Error fetching ignored items:",i),new Set):new Set(t.map(a=>a.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:i}=await Ne.from("ignored_items").insert([{user_id:n,name:t}]).select();if(i&&i.code!=="23505")throw console.error("Error ignoring item:",i),i},getSnapshots:async n=>{if(!n)return[];const{data:t,error:i}=await Ne.from(ca).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return i?(console.error("Error fetching snapshots:",i),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:i}=await Ne.from(Ro).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return i?(console.error("Error fetching deleted snapshots:",i),[]):t||[]},createSnapshot:async(n,t,i,a)=>{if(!n)throw new Error("User ID is required");let o=null,u=null;const d=await Ne.from(ca).insert([{user_id:n,title:t,items:i,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();if(o=d.data??null,u=d.error??null,u&&ul(u,"user_id")){const f=await Ne.from(ca).insert([{title:t,items:i,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();o=f.data??null,u=f.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return o},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:i,error:a}=await Ne.from(ca).select("*").eq("id",t).eq("user_id",n).single();if(a||!i)throw console.error("Error fetching snapshot for delete:",a),a||new Error("Snapshot not found");const{error:o}=await Ne.from(Ro).insert([{original_id:i.id,user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at,deleted_at:new Date().toISOString()}]);if(o)throw console.error("Error moving snapshot to trash:",o),o;const{error:u}=await Ne.from(ca).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:i,error:a}=await Ne.from(Ro).select("*").eq("id",t).eq("user_id",n).single();if(a||!i)throw console.error("Error fetching deleted snapshot:",a),a||new Error("Deleted snapshot not found");let o=null;{const{error:d}=await Ne.from(ca).insert([{id:i.original_id,user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at}]);o=d}if(o){const{error:d}=await Ne.from(ca).insert([{user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await Ne.from(Ro).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:i}=await Ne.from(Ro).delete().eq("id",t).eq("user_id",n);if(i)throw console.error("Error hard deleting snapshot from trash:",i),i;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await Ne.from(bs).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(ul(t.error,"user_id")){const i=await Ne.from(bs).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(i.error)throw console.error("Error resetting quantities (fallback):",i.error),i.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},fa=n=>{const t=String(n??"").trim();if(!t)return"";const i=t.toLowerCase();return i===""?"g":i===""?"ml":i===""?"cc":i===""?"kg":i===""?"l":i},hT=(n,t)=>{const i=fa(n),a=fa(t);if(!i||!a)return null;if(i===a)return 1;if(i==="kg"&&a==="g")return 1e3;if(i==="g"&&a==="kg")return 1/1e3;const o=i==="cc"?"ml":i,u=a==="cc"?"ml":a;return o==="l"&&u==="ml"?1e3:o==="ml"&&u==="l"?1/1e3:null},fT=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},Oo=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},pT=({index:n,item:t,isLowStock:i,onUpdateQuantity:a,onDelete:o,onToggleTax:u,onEdit:d,onRequestUnitSync:f})=>{const[h,m]=_e.useState(t.quantity===""?"":parseFloat(t.quantity)||0),y=P=>{const B=String(P||"").trim();return B?B==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(B)?B:"":""},v={food:"",alcohol:"",soft_drink:"",supplies:""};_e.useEffect(()=>{m(t.quantity===""?"":parseFloat(t.quantity)||0)},[t.quantity]);const x=parseFloat(t.price)||0,b=(()=>{if(!Number.isFinite(x)||x<=0)return"-";const P=t?._csv?.unit,B=String(P||"").trim(),T=String(t?.unit||"").trim();if(!B)return`${Oo(x)}`;const z=fa(T),H=fa(B);if(H===z)return`${Oo(x)}/${B}`;const J=hT(H,z);if(J!==null)return`${Oo(x*J)}/${B}`;const de=parseFloat(t?._master?.packetSize),q=String(t?._master?.packetUnit||"").trim(),Y=fa(q);return fT(B)&&Number.isFinite(de)&&de>0&&Y===z?`${Oo(x*de)}/${B}`:`${Oo(x)}/${T||"-"}`})(),_=y(t?._master?.itemCategory),C=_==="alcohol"||_==="supplies",S=t?.tax10_override===!0||t?.tax10_override===1||t?.tax10_override==="1"||t?.tax10_override==="true",N=_?S?t?.tax10===!0||t?.tax10===1||t?.tax10==="1"||t?.tax10==="true":C:t?.tax10===!0||t?.tax10===1||t?.tax10==="1"||t?.tax10==="true",k=_?S?`${v[_]||_}: ${C?"10%":"8%"}/ `:`${v[_]||_}${N?"10%":"8%"}`:"10%",D=N?1.1:1.08,L=h===""?0:parseFloat(h),$=x*L*D,E=_e.useMemo(()=>{const P=t?._master?.packetSize,B=t?._master?.packetUnit,T=parseFloat(P);return!Number.isFinite(T)||T<=0?"-":`${Number.isInteger(T)?T.toLocaleString():T.toLocaleString(void 0,{maximumFractionDigits:3})}${B?String(B):""}`},[t?._master?.packetSize,t?._master?.packetUnit]),A=()=>{const P=parseFloat(h);!isNaN(P)&&P!==t.quantity&&a(t.id,P)},R=P=>{P&&setTimeout(()=>{try{P.select()}catch{}},0)},M=P=>{const T=P?.closest?.("table")||document;return Array.from(T.querySelectorAll("input.inventory-quantity-input"))},V=(P,B)=>{const T=M(P).filter(J=>!J.disabled),z=T.indexOf(P);if(z<0)return!1;const H=T[z+B];return H?(requestAnimationFrame(()=>{try{H.scrollIntoView({block:"nearest"})}catch{}H.focus(),R(H)}),!0):!1},U=P=>{if(P.key==="Enter"){P.preventDefault(),V(P.currentTarget,P.shiftKey?-1:1),P.currentTarget.blur();return}P.key==="Tab"&&V(P.currentTarget,P.shiftKey?-1:1)&&(P.preventDefault(),P.currentTarget.blur()),(P.key==="ArrowUp"||P.key==="ArrowDown")&&V(P.currentTarget,P.key==="ArrowUp"?-1:1)&&(P.preventDefault(),P.currentTarget.blur())},F=t?._master?.packetUnit||"",ne=!!F&&fa(F)!==fa(t?.unit);return s.jsxs("tr",{className:i(t)?"low-stock":"",children:[s.jsx("td",{style:{textAlign:"center",color:"#6b7280",fontVariantNumeric:"tabular-nums"},children:Number.isFinite(n)?n+1:""}),s.jsx("td",{style:{textAlign:"center"},children:s.jsx("input",{type:"checkbox",checked:N,onChange:P=>u&&u(t,P.target.checked),title:k,className:"inventory-tax-checkbox"})}),s.jsxs("td",{children:[t.name,i(t)&&s.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),s.jsx("td",{style:{textAlign:"right"},children:b}),s.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:E}),s.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[s.jsx("input",{type:"text",inputMode:"decimal",value:h,onChange:P=>m(Yb(P.target.value)),className:"inventory-quantity-input no-print",onBlur:A,onKeyDown:U,onFocus:P=>R(P.target),onClick:P=>R(P.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),s.jsx("span",{className:"print-only",style:{display:"none"},children:h})]}),s.jsx("td",{children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx("span",{children:t.unit}),ne&&typeof f=="function"&&s.jsx("button",{type:"button",onClick:()=>f(t),title:`${F}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),s.jsx("td",{style:{textAlign:"right"},children:$>0?`${Math.round($).toLocaleString()}`:"-"}),s.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:t.vendor||"-"}),s.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof d=="function"&&s.jsx("button",{type:"button",onClick:()=>d(t),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),s.jsx("button",{onClick:()=>o(t),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},mT=({items:n,loading:t,onDelete:i,onUpdateQuantity:a,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:f,isOver:h}=uc({id:"inventory-list-droppable"}),m=_=>_.threshold>0&&_.quantity<=_.threshold,[y,v]=_e.useState({key:null,direction:"asc"}),x=_=>{v(C=>C.key===_?{key:_,direction:C.direction==="asc"?"desc":"asc"}:{key:_,direction:"asc"})},b=_e.useMemo(()=>{if(!y.key)return n;const _=[...n];return y.key==="vendor"&&_.sort((C,S)=>{const N=(C?.vendor||"").toString(),k=(S?.vendor||"").toString(),D=N.localeCompare(k,"ja");if(D!==0)return y.direction==="asc"?D:-D;const L=(C?.name||"").toString(),$=(S?.name||"").toString(),E=L.localeCompare($,"ja");return y.direction==="asc"?E:-E}),_},[n,y]);return s.jsxs("div",{ref:f,className:`inventory-list-droppable ${h?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:h?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[s.jsx("div",{className:"inventory-table-container",children:t?s.jsx("p",{children:"Loading..."}):s.jsxs("table",{className:"inventory-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{textAlign:"center",width:"44px"},children:"No"}),s.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:"()"}),s.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),s.jsx("th",{style:{width:"40px"}})]})}),s.jsxs("tbody",{children:[b.map((_,C)=>s.jsx(pT,{index:C,item:_,isLowStock:m,onUpdateQuantity:a,onEdit:u,onDelete:i,onToggleTax:o,onRequestUnitSync:d},_.id)),b.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#888",padding:"2rem"},children:h?"":""})})]}),s.jsx("tfoot",{children:(()=>{const _=n.reduce((C,S)=>{const N=parseFloat(S.price)||0,k=S.quantity===""?0:parseFloat(S.quantity)||0,D=S?.tax10===!0||S?.tax10===1||S?.tax10==="1"||S?.tax10==="true"?1.1:1.08,L=N*k;return C.net+=L,C.taxed+=L*D,C},{net:0,taxed:0});return s.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[s.jsx("td",{colSpan:"7",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),s.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(_.net).toLocaleString()," / ",Math.round(_.taxed).toLocaleString()]}),s.jsx("td",{colSpan:"2"})]})})()})]})}),h&&s.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},gT=({onBack:n})=>{const{user:t}=fs(),i=t?.id,[,a]=ic(),[o,u]=w.useState([]),[d,f]=w.useState([]),[h,m]=w.useState([]),[y,v]=w.useState([]),[x,b]=w.useState(new Map),[_,C]=w.useState(new Map),[S,N]=w.useState(new Set),[k,D]=w.useState(!0),[L,$]=w.useState(""),[E,A]=w.useState(!1),[R,M]=w.useState(null),[V,U]=w.useState(""),[F,ne]=w.useState(!1),[P,B]=w.useState(null),[T,z]=w.useState(!1),[H,J]=w.useState(!1),[de,q]=w.useState(""),[Y,ae]=w.useState(!1),[xe,ve]=w.useState(!0),[Ee,he]=w.useState(!1),[G,ge]=w.useState(null),[Z,Ce]=w.useState("history"),[be,We]=w.useState(null),[Re,Pe]=w.useState(""),[Ze,rt]=w.useState(!1),[qe,Ae]=w.useState(null),[Se,te]=w.useState(!0),[Be,ut]=w.useState({key:"name",direction:"asc"}),[Ct,Rt]=w.useState(!1),[mt,Ot]=w.useState(null),[jt,ft]=w.useState(new Set),[Vt,an]=w.useState(!1),[xn,Mt]=w.useState(null),[nn,cn]=w.useState(null),[Gt,Xn]=w.useState(!1),ar=ba(ur(dd,{activationConstraint:{distance:8}})),[ee,De]=w.useState("all"),[Te,Ue]=w.useState(new Set),[He,it]=w.useState(""),[gt,Lt]=w.useState(""),[Pt,dn]=w.useState({});w.useEffect(()=>{U(R&&R.name||"")},[R]);const[ue,Ke]=w.useState(""),at=({row:I,onVendorClick:Q,isSelected:ie})=>{const{attributes:we,listeners:Le,setNodeRef:Ie,setActivatorNodeRef:Ge,transform:Xe,transition:tt,isDragging:st}=wa({id:I.vendor,data:{type:"summary-row"}}),ct={transform:wr.Transform.toString(Xe),transition:tt,opacity:st?.6:1};return s.jsxs("tr",{ref:Ie,style:ct,...we,className:ie?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[s.jsx("td",{className:"inventory-summary__drag",children:s.jsx("span",{ref:Ge,...Le,className:"inventory-summary__drag-handle",title:"",children:""})}),s.jsx("td",{children:s.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>Q?.(I.vendor),"aria-expanded":!!ie,children:[s.jsx("span",{children:I.vendor}),s.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:ie?"":""})]})}),s.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(I.total||0).toLocaleString()]})]})};w.useEffect(()=>{i&&(De("all"),$(""),Ye())},[i]);const Ye=async(I=!1)=>{I||D(!0);try{const[Q,ie,we,Le,Ie,Ge,Xe]=await Promise.all([Wn.getAll(i),ir.getPriceListArray(),Wn.getIgnoredItems(i),Wn.getSnapshots(i),Wn.getDeletedSnapshots(i),zn.getAllConversions(),nd.getAll(i)]);u(Q),v(ie),N(we),f(Le||[]),m(Ie||[]),b(Ge||new Map),C(Xe||new Map);const tt=nt=>{if(!nt)return-1;const Cn=new Date(nt).getTime();return Number.isFinite(Cn)?Cn:-1},st=(nt,Ut)=>{const Cn=Math.max(tt(nt?.updated_at),tt(nt?.updatedAt),tt(nt?.created_at),tt(nt?.createdAt)),Nn=Math.max(tt(Ut?.updated_at),tt(Ut?.updatedAt),tt(Ut?.created_at),tt(Ut?.createdAt));return Cn!==Nn&&Nn>Cn?Ut:nt},ct=new Map;(Q||[]).forEach(nt=>{const Ut=String(nt?.vendor??"").trim()||"__no_vendor__",Cn=Wt(nt?.name)||String(nt?.name??"").trim();if(!Cn)return;const Nn=`${Ut}@@${Cn}`,Ur=ct.get(Nn);if(!Ur){ct.set(Nn,nt);return}ct.set(Nn,st(Ur,nt))});const pt=new Set(Array.from(ct.values()).map(nt=>nt.id));Ue(pt)}catch(Q){console.error("Failed to load data:",Q)}finally{I||D(!1)}},kt=I=>{if(!I)return"-";const Q=new Date(I);if(Number.isNaN(Q.getTime()))return String(I);const ie=Q.getFullYear(),we=String(Q.getMonth()+1).padStart(2,"0"),Le=String(Q.getDate()).padStart(2,"0"),Ie=String(Q.getHours()).padStart(2,"0"),Ge=String(Q.getMinutes()).padStart(2,"0");return`${ie}/${we}/${Le} ${Ie}:${Ge}`},xt=I=>{const Q=I?.items;return Array.isArray(Q)?Q:Q?[]:[]},Dt=I=>{const Q=I?.snapshot_date||I?.created_at;if(!Q)return null;const ie=new Date(Q);return Number.isNaN(ie.getTime())?null:ie},Ft=_e.useMemo(()=>new Set([""]),[]),ot=I=>{const Q=String(I??"").trim();return Ft.has(Q)},re=I=>I===!0||I===1||I==="1"||I==="true",$e=I=>{const Q=String(I??"").trim();if(!Q)return"";const ie=Q.toLowerCase();return ie===""?"g":ie===""?"ml":ie===""?"cc":ie===""?"kg":ie===""?"l":ie},Ve=(I,Q)=>{const ie=parseFloat(I?.lastPrice),we=parseFloat(I?.packetSize),Le=$e(I?.packetUnit),Ie=$e(Q||Le);if(!Number.isFinite(ie)||!Number.isFinite(we)||we<=0||!Le)return null;const Ge=ie/we;if(Ie===Le)return Ge;if(Le==="g"&&Ie==="kg")return Ge*1e3;if(Le==="kg"&&Ie==="g")return Ge/1e3;const Xe=Le==="cc"?"ml":Le,tt=Ie==="cc"?"ml":Ie;return Xe==="ml"&&tt==="l"?Ge*1e3:Xe==="l"&&tt==="ml"?Ge/1e3:null},_t=(I,Q)=>{const ie=$e(I),we=$e(Q);if(!ie||!we)return null;if(ie===we)return 1;if(ie==="kg"&&we==="g")return 1e3;if(ie==="g"&&we==="kg")return 1/1e3;const Le=ie==="cc"?"ml":ie,Ie=we==="cc"?"ml":we;return Le==="l"&&Ie==="ml"?1e3:Le==="ml"&&Ie==="l"?1/1e3:null},W=I=>{const Q=String(I||"").trim();return Q?Q==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(Q)?Q:"":""},X=I=>{const Q=W(I);return Q==="alcohol"||Q==="supplies"},oe=I=>{const Q=W(I);return Q==="food"?"":Q==="alcohol"||Q==="soft_drink"?"":Q==="supplies"?"":""},fe=I=>{const Q=W(I);return Q==="food"?"food":Q==="alcohol"||Q==="soft_drink"?"drink":Q==="supplies"?"supplies":"unknown"},ze=I=>I==="food"?"":I==="drink"?"":I==="supplies"?"":"",Fe=I=>re(I?.tax10)?1.1:1.08,Je=I=>I?`${I.getFullYear()}-${String(I.getMonth()+1).padStart(2,"0")}`:"",Qe=I=>{if(!I)return-1;const ie=new Date(I).getTime();return Number.isFinite(ie)?ie:-1},wt=I=>{const Q=[I?.updated_at,I?.updatedAt,I?.created_at,I?.createdAt];for(const ie of Q){const we=Qe(ie);if(we>=0)return we}return-1},St=_e.useMemo(()=>{const I=new Map;return d.forEach(Q=>{const ie=Dt(Q);if(!ie)return;const we=Je(ie);I.has(we)||I.set(we,{key:we,year:ie.getFullYear(),month:ie.getMonth()+1})}),Array.from(I.values()).sort((Q,ie)=>ie.key.localeCompare(Q.key)).map(Q=>({...Q,label:`${Q.year}${Q.month}`}))},[d]);w.useEffect(()=>{if(St.length===0){He&&it("");return}if(He&&St.some(ie=>ie.key===He))return;const I=Je(new Date),Q=St.find(ie=>ie.key===I)?.key||St[0].key;it(Q)},[St,He]),w.useEffect(()=>{if(St.length===0){gt&&Lt("");return}if(gt&&St.some(ie=>ie.key===gt))return;const I=Je(new Date),Q=St.find(ie=>ie.key===I)?.key||St[0].key;Lt(Q)},[St,gt]);const It=_e.useMemo(()=>{if(!gt)return null;const[I,Q]=gt.split("-"),ie=parseInt(I,10),we=parseInt(Q,10);if(!Number.isFinite(ie)||!Number.isFinite(we))return null;const Le=Xe=>String(Xe).padStart(2,"0"),Ie=new Date(ie,we-1,1),Ge=new Date(ie,we,0);return{year:ie,month:we,start:Ie,end:Ge,rangeLabel:`${ie}/${Le(we)}/01${ie}/${Le(we)}/${Le(Ge.getDate())}`}},[gt]),et=_e.useMemo(()=>gt?d.map(I=>({snapshot:I,date:Dt(I)})).filter(I=>I.date&&Je(I.date)===gt).sort((I,Q)=>Q.date-I.date).map(I=>I.snapshot):d,[d,gt]),Nt=_e.useMemo(()=>{if(!He)return null;const[I,Q]=He.split("-"),ie=parseInt(I,10),we=parseInt(Q,10);if(!Number.isFinite(ie)||!Number.isFinite(we))return null;const Le=Xe=>String(Xe).padStart(2,"0"),Ie=new Date(ie,we-1,1),Ge=new Date(ie,we,0);return{year:ie,month:we,start:Ie,end:Ge,rangeLabel:`${ie}/${Le(we)}/01${ie}/${Le(we)}/${Le(Ge.getDate())}`}},[He]),Qt=_e.useMemo(()=>He?d.map(I=>({snapshot:I,date:Dt(I)})).filter(I=>I.date&&Je(I.date)===He).sort((I,Q)=>Q.date-I.date).map(I=>I.snapshot):[],[d,He]),un=Qt[0]||null,Kn=He||(un?.id?`snapshot:${un.id}`:""),Sr=_e.useMemo(()=>{const I=new Map;return Qt.forEach(Q=>{const ie=Dt(Q)?.getTime()||-1;xt(Q).forEach((Le,Ie)=>{const Ge=(Le?.vendor||"").toString().trim();if(ot(Ge))return;const Xe=Ge||"",tt=String(Le?.name||"").trim();if(!tt)return;const st=`${Xe}::${tt}`,ct={item:{...Le,vendor:Xe},snapshotMs:ie,itemUpdatedMs:wt(Le),rowIndex:Ie},pt=I.get(st);if(!pt){I.set(st,ct);return}if(ct.snapshotMs!==pt.snapshotMs){ct.snapshotMs>pt.snapshotMs&&I.set(st,ct);return}if(ct.itemUpdatedMs!==pt.itemUpdatedMs){ct.itemUpdatedMs>pt.itemUpdatedMs&&I.set(st,ct);return}ct.rowIndex>=pt.rowIndex&&I.set(st,ct)})}),Array.from(I.values()).map(Q=>Q.item)},[Qt,ot]),Jr=_e.useMemo(()=>{const I=new Map;return Sr.forEach(Q=>{const ie=(Q?.vendor||"").toString().trim(),we=ie||"";if(ot(ie))return;const Le=parseFloat(Q?.price)||0,Ie=Q?.quantity===""?0:parseFloat(Q?.quantity)||0,Ge=Le*Ie,Xe=Ge*Fe(Q),tt=I.get(we)||{vendor:we,net:0,taxed:0};tt.net+=Ge,tt.taxed+=Xe,I.set(we,tt)}),Array.from(I.values()).map(Q=>({vendor:Q.vendor,net:Q.net,taxed:Q.taxed,total:Q.taxed}))},[Sr,ot,Fe]),Mr=_e.useMemo(()=>{const I=new Map;return Jr.forEach(Q=>{I.set(Q.vendor,Q)}),I},[Jr]),Ui=_e.useMemo(()=>{const I=new Map;try{for(const[Q,ie]of(x||new Map).entries()){const we=String(Q??"").trim();we&&I.set(we,ie)}}catch{}return I},[x]),Ws=_e.useCallback(I=>{const Q=W(I?.itemCategory??I?.item_category);if(Q)return Q;const ie=String(I?.name??"").trim();if(!ie)return"";const we=Ui.get(ie);return W(we?.itemCategory??we?.item_category)},[Ui]),Xr=_e.useMemo(()=>{const I=new Map;Sr.forEach((Q,ie)=>{const we=(Q?.vendor||"").toString().trim(),Le=we||"";if(ot(we))return;const Ie=parseFloat(Q?.price)||0,Ge=Q?.quantity===""?0:parseFloat(Q?.quantity)||0,Xe=Ie*Ge,tt=Xe*Fe(Q),st=Ws(Q),ct=fe(st),pt=I.get(Le)||{vendor:Le,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};pt.totals[ct]+=tt,pt.totals.net+=Xe,pt.totals.taxed+=tt,pt.rows.push({id:Q?.id||`${Le}-${Q?.name||"item"}-${ie}`,name:Q?.name||"",unit:Q?.unit||"",quantity:Ge,price:Ie,taxed:tt,itemCategory:st,breakdownKey:ct}),I.set(Le,pt)});for(const Q of I.values())Q.rows.sort((ie,we)=>{const Le={food:0,drink:1,unknown:2,supplies:3},Ie=Le[ie?.breakdownKey]??2,Ge=Le[we?.breakdownKey]??2;if(Ie!==Ge)return Ie-Ge;const Xe=(ie?.name||"").toString(),tt=(we?.name||"").toString();return Xe.localeCompare(tt,"ja")});return I},[Sr,ot,Fe,Ws]),lr=_e.useMemo(()=>Jr.slice().sort((I,Q)=>Q.taxed!==I.taxed?Q.taxed-I.taxed:I.vendor.localeCompare(Q.vendor,"ja")).map(I=>I.vendor),[Jr]),Ii=_e.useMemo(()=>{if(!Kn)return lr;const I=Pt[Kn],Q=new Set(Mr.keys()),ie=Array.isArray(I)?I.filter(Le=>Q.has(Le)):[],we=lr.filter(Le=>!ie.includes(Le));return[...ie,...we]},[Pt,Kn,lr,Mr]),Sa=_e.useMemo(()=>Ii.map(I=>Mr.get(I)).filter(Boolean),[Ii,Mr]),ja=Sa.reduce((I,Q)=>(I.net+=Q.net||0,I.taxed+=Q.taxed||0,I),{net:0,taxed:0});w.useEffect(()=>{ue&&(Mr.has(ue)||Ke(""))},[ue,Mr]);const hc=I=>{Ke(Q=>Q===I?"":I)},_a=I=>{I?.id&&i&&(rt(!1),Ae(null),Pe(""),We({title:"",message:`${I.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{rt(!0),Ae({type:"move",id:I.id});try{await Wn.deleteSnapshotToTrash(i,I.id),await Ye(!0),Mt({title:"",message:"",type:"success"})}catch(Q){console.error(Q),Mt({title:"",message:"()",type:"error"})}finally{rt(!1),Ae(null),We(null)}}}))},bd=I=>{I?.id&&i&&(rt(!1),Ae(null),Pe(""),We({title:"",message:`${I.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{rt(!0),Ae({type:"restore",id:I.id});try{await Wn.restoreSnapshotFromTrash(i,I.id),await Ye(!0),Mt({title:"",message:"",type:"success"})}catch(Q){console.error(Q),Mt({title:"",message:"",type:"error"})}finally{rt(!1),Ae(null),We(null)}}}))},fr=I=>{I?.id&&i&&(rt(!1),Ae(null),Pe(""),We({title:" ",message:`${I.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{rt(!0),Ae({type:"hard-delete",id:I.id});try{await Wn.hardDeleteSnapshotFromTrash(i,I.id),await Ye(!0),Mt({title:"",message:"",type:"success"})}catch(Q){console.error(Q),Mt({title:"",message:"",type:"error"})}finally{rt(!1),Ae(null),We(null)}}}))},Bi=I=>{if(!I)return;const Q=xt(I).filter(nt=>!ot(nt?.vendor)),ie=["","","","","()",""],we=Q.map(nt=>{const Ut=parseFloat(nt?.price)||0,Cn=nt?.quantity===""?0:parseFloat(nt?.quantity)||0,Nn=Math.round(Ut*Cn*Fe(nt));return[nt?.name??"",Ut||"",nt?.unit??"",nt?.quantity??"",Nn||"",nt?.vendor??""]}),Le=nt=>{const Ut=String(nt??"");return Ut.includes(",")||Ut.includes('"')||Ut.includes(`
`)||Ut.includes("\r")?`"${Ut.replace(/"/g,'""')}"`:Ut},Ie=[ie.map(Le).join(","),...we.map(nt=>nt.map(Le).join(","))].join(`
`),Ge=new Uint8Array([239,187,191]),Xe=new Blob([Ge,Ie],{type:"text/csv"}),tt=URL.createObjectURL(Xe),st=(I.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),ct=(I.snapshot_date?new Date(I.snapshot_date):new Date).toISOString().slice(0,10),pt=document.createElement("a");pt.href=tt,pt.download=`InventorySnapshot_${ct}_${st}.csv`,document.body.appendChild(pt),pt.click(),document.body.removeChild(pt),URL.revokeObjectURL(tt)},fc=()=>{if(!un)return;const I=["","()"],Q=Sa.map(nt=>[nt.vendor,Math.round(nt.total||0)]),ie=nt=>{const Ut=String(nt??"");return Ut.includes(",")||Ut.includes('"')||Ut.includes(`
`)||Ut.includes("\r")?`"${Ut.replace(/"/g,'""')}"`:Ut},we=[I.map(ie).join(","),...Q.map(nt=>nt.map(ie).join(","))].join(`
`),Le=new Uint8Array([239,187,191]),Ie=new Blob([Le,we],{type:"text/csv"}),Ge=URL.createObjectURL(Ie),Xe=(un.snapshot_date?new Date(un.snapshot_date):new Date).toISOString().slice(0,10),tt=un.title||"inventory_summary",st=Nt?`${Nt.year}${String(Nt.month).padStart(2,"0")}`:Xe,ct=tt.toString().replace(/[\\/:*?"<>|]/g,"_"),pt=document.createElement("a");pt.href=Ge,pt.download=`InventorySummary_${st}_${ct}.csv`,document.body.appendChild(pt),pt.click(),document.body.removeChild(pt),URL.revokeObjectURL(Ge)},Ol=I=>{if(!I?.vendor)return;const Q=["","","","","","()",""],ie=(I.rows||[]).map(nt=>{const Ut=nt.itemCategory?oe(nt.itemCategory):ze(nt.breakdownKey);return[nt.name||"",Ut,Math.round(nt.price||0),nt.unit||"",Number(nt.quantity||0),Math.round(nt.taxed||0),I.vendor]}),we=nt=>{const Ut=String(nt??"");return Ut.includes(",")||Ut.includes('"')||Ut.includes(`
`)||Ut.includes("\r")?`"${Ut.replace(/"/g,'""')}"`:Ut},Le=[Q.map(we).join(","),...ie.map(nt=>nt.map(we).join(","))].join(`
`),Ie=new Uint8Array([239,187,191]),Ge=new Blob([Ie,Le],{type:"text/csv"}),Xe=URL.createObjectURL(Ge),tt=(un?.snapshot_date?new Date(un.snapshot_date):new Date).toISOString().slice(0,10),st=Nt?`${Nt.year}${String(Nt.month).padStart(2,"0")}`:tt,ct=I.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),pt=document.createElement("a");pt.href=Xe,pt.download=`InventorySummary_${st}_${ct}.csv`,document.body.appendChild(pt),pt.click(),document.body.removeChild(pt),URL.revokeObjectURL(Xe)},zr=_e.useMemo(()=>{const I=ht=>ht?ht.toString().trim():"",Q=ht=>Wt(ht),ie=new Set;try{for(const ht of(S||new Set).values()){const bt=Q(ht);bt&&ie.add(bt)}}catch{}const we=new Set;try{for(const ht of(jt||new Set).values()){const bt=Q(ht);bt&&we.add(bt)}}catch{}const Le=new Map;try{for(const[ht,bt]of(x||new Map).entries()){const Bt=Q(ht);Bt&&Le.set(Bt,bt)}}catch{}const Ie=new Map;try{(y||[]).forEach(ht=>{const bt=Q(ht?.name);bt&&Ie.set(bt,ht)})}catch{}const Ge=new Map;try{for(const[ht,bt]of(_||new Map).entries()){const Bt=Q(ht);Bt&&Ge.set(Bt,bt)}}catch{}const Xe=ht=>{const bt=String(ht??"").trim();if(!bt)return"";const Bt=bt.toLowerCase();return Bt===""?"g":Bt===""?"ml":Bt===""?"cc":Bt===""?"kg":Bt===""?"l":Bt},tt=(ht,bt)=>{const Bt=parseFloat(ht?.lastPrice),Sn=parseFloat(ht?.packetSize),kn=Xe(ht?.packetUnit),Ln=Xe(bt||kn);if(!Number.isFinite(Bt)||!Number.isFinite(Sn)||Sn<=0||!kn)return null;const Jt=Bt/Sn;if(Ln===kn)return Jt;if(kn==="g"&&Ln==="kg")return Jt*1e3;if(kn==="kg"&&Ln==="g")return Jt/1e3;const pr=kn==="cc"?"ml":kn,Un=Ln==="cc"?"ml":Ln;return pr==="ml"&&Un==="l"?Jt*1e3:pr==="l"&&Un==="ml"?Jt/1e3:null},st=ht=>{const bt=String(ht??"").trim();return bt?["","","","","","","","pc","PC",""].includes(bt):!1},ct=ht=>{const bt=Q(ht?.name),Bt=bt?Le.get(bt):null,Sn=bt?Ie.get(bt):null,kn=bt&&Ge.has(bt)?String(Ge.get(bt)||""):String(Sn?.unit||""),Ln={...ht};if(Ln.name=I(Ln.name),Ln.vendor=I(Ln.vendor),Ln._csv={unit:kn,price:Sn?.price??null,vendor:I(Sn?.vendor)||null,dateStr:Sn?.dateStr??null},!Bt)return Ln;const Jt={...Ln},pr=W(Bt?.itemCategory),Un=Bt.packetUnit||"",ws=parseFloat(Bt.packetSize),ts=Un?tt(Bt,Un):null;if(Jt.isPhantom)Un&&ts!==null&&(Jt.unit=Un,Jt.price=ts);else{if(!!Un&&Number.isFinite(ws)&&ws>0&&(st(Jt.unit)||!Jt.unit)&&ts!==null){const Ss=Jt.quantity;if(Ss!==""&&Ss!==null&&Ss!==void 0){const Pi=parseFloat(Ss);Number.isFinite(Pi)&&(Jt.quantity=Pi*ws)}const ti=Jt.threshold;if(ti!==""&&ti!==null&&ti!==void 0){const Pi=parseFloat(ti);Number.isFinite(Pi)&&(Jt.threshold=Pi*ws)}Jt.unit=Un}else(Un&&ts!==null||!Jt.unit&&Un)&&(Jt.unit=Un);if(ts!==null&&Xe(Jt.unit)===Xe(Un))Jt.price=ts;else{const Ss=tt(Bt,Jt.unit||Un);Ss!==null&&(Jt.price=Ss)}}const ei=re(Jt?.tax10_override??Jt?.tax10Override),$l=pr?X(pr):null;return Jt._master={packetSize:Bt.packetSize,packetUnit:Bt.packetUnit,lastPrice:Bt.lastPrice,itemCategory:pr||null,tax10Auto:$l,tax10Override:ei,updatedAt:Bt.updatedAt},pr&&(Jt.tax10_override=ei,!ei&&$l!==null&&(Jt.tax10=$l)),Jt},pt=o.map(ct),nt=new Map;pt.forEach(ht=>{const bt=Q(ht?.name);bt&&nt.set(bt,ht)});const Ut=[...pt];y.forEach((ht,bt)=>{const Bt=String(ht?.name??""),Sn=I(Bt),kn=Q(Bt);if(kn&&!(S.has(Bt)||Sn&&S.has(Sn)||ie.has(kn))&&!nt.has(kn)){const Ln={id:`phantom-${bt}`,isPhantom:!0,name:Sn,quantity:"",unit:ht.unit||"",category:"",price:ht.price,vendor:I(ht.vendor),threshold:0,tax10:!1,tax10_override:!1};Ut.push(ct(Ln))}});const Cn=Ut.filter(ht=>{const bt=String(ht?.name??""),Bt=I(bt),Sn=Q(bt);return!(S.has(bt)||Bt&&S.has(Bt)||Sn&&ie.has(Sn)||jt.has(bt)||Bt&&jt.has(Bt)||Sn&&we.has(Sn)||ot(ht.vendor))}),Nn=ht=>{if(!ht)return-1;const Bt=new Date(ht).getTime();return Number.isFinite(Bt)?Bt:-1},Ur=(ht,bt)=>{const Bt=!!ht?.isPhantom,Sn=!!bt?.isPhantom;if(Bt!==Sn)return Bt?bt:ht;const kn=Math.max(Nn(ht?.updated_at),Nn(ht?.updatedAt),Nn(ht?.created_at),Nn(ht?.createdAt)),Ln=Math.max(Nn(bt?.updated_at),Nn(bt?.updatedAt),Nn(bt?.created_at),Nn(bt?.createdAt));if(kn!==Ln)return Ln>kn?bt:ht;const Jt=ht?.quantity,pr=bt?.quantity,Un=Jt===""||Jt===null||Jt===void 0?null:parseFloat(Jt),ws=pr===""||pr===null||pr===void 0?null:parseFloat(pr),ts=Un!==null&&Number.isFinite(Un),ei=ws!==null&&Number.isFinite(ws);return ts!==ei&&ei?bt:ht},es=new Map;return Cn.forEach(ht=>{const bt=Q(ht?.name)||I(ht?.name);if(!bt)return;const Sn=`${I(ht?.vendor)||"__no_vendor__"}@@${bt}`,kn=es.get(Sn);if(!kn){es.set(Sn,ht);return}es.set(Sn,Ur(kn,ht))}),Array.from(es.values())},[o,y,S,jt,x,_,ot]),pc=I=>{const{active:Q,over:ie}=I;if(!ie)return;if(Q?.data?.current?.type==="summary-row"){if(!Kn)return;const Le=Q.id,Ie=ie.id;if(!Le||!Ie||Le===Ie)return;const Ge=Ii,Xe=Ge.indexOf(Le),tt=Ge.indexOf(Ie);if(Xe<0||tt<0)return;const st=zi(Ge,Xe,tt);dn(ct=>({...ct,[Kn]:st}));return}if(ie.id==="inventory-list-droppable"){const Le=Q.data.current.item;if(Q.data.current.type==="csv-item"){const Ie=String(Le?.name??"").trim(),Ge=Wt(Ie);let Xe=null;if(x&&x.size>0&&Ge&&(Xe=x.get(Ie)||null,!Xe)){for(const[pt,nt]of x.entries())if(Wt(pt)===Ge){Xe=nt;break}}const tt=Xe?.packetUnit||Le.unit,st=Xe?Ve(Xe,tt):null,ct=st!==null?st:Xe?.lastPrice!==null&&Xe?.lastPrice!==void 0&&Xe?.lastPrice!==""?Xe.lastPrice:Le.price;M({name:Le.name,price:ct,unit:tt,category:"",threshold:0,quantity:0,vendor:Le.vendor,tax10:re(Le?.tax10),isNewFromCsv:!0}),A(!0),U(Le.name||"")}}},mc=async I=>{if(I.preventDefault(),!i)return;const Q=new FormData(I.target),ie=Q.get("name"),we=parseFloat(Q.get("quantity")),Le=Q.get("unit"),Ie=Q.get("category"),Ge=parseFloat(Q.get("threshold")),Xe=Q.get("vendor"),tt=parseFloat(Q.get("price")),st=Q.get("packetSize"),ct=Q.get("packetUnit"),pt={name:ie,quantity:Number.isFinite(we)?we:0,unit:Le,category:Ie,threshold:Number.isFinite(Ge)?Ge:0,vendor:Xe||R?.vendor||"",price:Number.isFinite(tt)?tt:R?.price||0,tax10:re(R?.tax10)};try{if(st&&ct){const nt=parseFloat(st);Number.isFinite(nt)&&nt>0&&await zn.saveConversion(ie,nt,ct,Number.isFinite(tt)?tt:null,Ie,Xe)}R?.id&&!R.isPhantom?await Wn.update(i,{...R,...pt}):await Wn.add(i,pt),A(!1),M(null),Ye()}catch(nt){console.error("Failed to save item:",nt),Mt({title:"",message:"",type:"error"})}},Qs=I=>{Ot(I),Rt(!0)},wd=I=>{!I||I.isPhantom||!I?._master?.packetUnit||(B(I),ne(!0))},Dl=()=>{T||(ne(!1),B(null))},Ml=async({convertQuantity:I})=>{if(!i)return;const Q=P;if(!Q||Q.isPhantom)return;const ie=Q?._master?.packetUnit;if(!ie)return;const we=ie,Le=Ve(Q?._master,we);if(Le===null){Mt({title:"",message:"/",type:"error"});return}let Ie=Q.quantity,Ge=Q.threshold;if(I){const Xe=_t(Q.unit,we);if(!Xe){Mt({title:"",message:"kgg / lml ",type:"error"});return}const tt=Q.quantity===""?null:parseFloat(Q.quantity);tt!==null&&Number.isFinite(tt)&&(Ie=tt*Xe);const st=Q.threshold===""?null:parseFloat(Q.threshold);st!==null&&Number.isFinite(st)&&(Ge=st*Xe)}z(!0);try{await Wn.update(i,{id:Q.id,unit:we,price:Le,quantity:Ie===""?0:parseFloat(Ie)||0,threshold:Ge===""?0:parseFloat(Ge)||0,tax10:re(Q?.tax10)}),await Ye(!0),ne(!1),B(null)}catch(Xe){console.error("Failed to sync unit:",Xe),Mt({title:"",message:"",type:"error"})}finally{z(!1)}},zl=async()=>{if(mt)try{const Q=(ie=>ie?ie.toString().trim():"")(mt?.name);Q&&ft(ie=>{const we=new Set(ie);return we.add(Q),we}),Rt(!1),Ot(null)}catch(I){console.error("Failed to delete/ignore item:",I)}},Sd=async(I,Q)=>{try{if(!i)return;const ie=zr.find(we=>we.id===I);if(!ie)return;if(ie.isPhantom){const we={name:ie.name.trim(),quantity:Q,unit:ie.unit,category:ie.category||"",price:ie.price,vendor:ie.vendor,threshold:0,tax10:re(ie?.tax10)},Le=await Wn.add(i,we);await Ye(!0),Ue(Ie=>{const Ge=new Set(Ie);return Ge.add(Le.id),Ge})}else u(we=>we.map(Le=>Le.id!==I?Le:{...Le,quantity:Q,unit:ie.unit??Le.unit,price:ie.price??Le.price,threshold:ie.threshold??Le.threshold})),Ue(we=>{const Le=new Set(we);return Le.add(I),Le}),await Wn.update(i,{...ie,quantity:Q})}catch(ie){console.error(ie);const we=ie?.message||ie?.error_description||(typeof ie=="string"?ie:null)||(()=>{try{return JSON.stringify(ie)}catch{return null}})()||"";Mt({title:"",message:`
${we}`,type:"error"}),Ye()}},gc=async(I,Q)=>{try{if(!i||!I)return;const ie=!!Q;if(I.isPhantom){const we={name:I.name.trim(),quantity:I.quantity===""?0:parseFloat(I.quantity)||0,unit:I.unit,category:I.category||"",price:I.price,vendor:I.vendor,threshold:0,tax10:ie,tax10_override:!0};await Wn.add(i,we),await Ye(!0)}else{const we=new Date().toISOString();u(Le=>Le.map(Ie=>Ie.id===I.id?{...Ie,tax10:ie,tax10_override:!0,updated_at:we,updatedAt:we}:Ie)),await Wn.update(i,{...I,tax10:ie,tax10_override:!0}),await Ye(!0)}}catch(ie){console.error(ie);const we=ie?.message||ie?.error_description||(typeof ie=="string"?ie:null)||(()=>{try{return JSON.stringify(ie)}catch{return null}})()||"";Mt({title:"",message:`
${we}`,type:"error"}),Ye()}},Ca=(I,Q)=>{if(Q===!0){cn({item:I});return}gc(I,Q)},Lr=()=>{Gt||cn(null)},Ll=async()=>{const I=nn?.item;if(I){Xn(!0);try{await gc(I,!0),cn(null)}finally{Xn(!1)}}},Ul=async()=>{if(!Y&&de&&i){ae(!0);try{const I=zr.filter(ie=>!ie.isPhantom).map(ie=>{const we={...ie};return delete we.isPhantom,delete we._master,delete we._csv,we}),Q=I.reduce((ie,we)=>{const Le=parseFloat(we.price)||0,Ie=we.quantity===""?0:parseFloat(we.quantity)||0;return ie+Le*Ie*Fe(we)},0);await Wn.createSnapshot(i,de,I,Q),xe?(await Wn.resetStockQuantities(i),await Ye(),Ue(new Set)):await Ye(!0),J(!1),an(!0)}catch(I){console.error("Failed to complete inventory:",I);const Q=I?.message||I?.error_description||(typeof I=="string"?I:null)||(()=>{try{return JSON.stringify(I)}catch{return null}})()||"";Mt({title:"",message:`
${Q}`,type:"error"})}finally{ae(!1)}}},Js=()=>{const I=["","","","","()",""],Q=Zs.map(tt=>{const st=parseFloat(tt.price)||0,ct=tt.quantity===""?0:parseFloat(tt.quantity)||0,pt=Math.round(st*ct*Fe(tt));return[tt.name,st,tt.unit,tt.quantity,pt,tt.vendor||""]}),ie=[I.join(","),...Q.map(tt=>tt.map(st=>{const ct=String(st??"");return ct.includes(",")||ct.includes('"')||ct.includes(`
`)?`"${ct.replace(/"/g,'""')}"`:ct}).join(","))].join(`
`),we=new Uint8Array([239,187,191]),Le=new Blob([we,ie],{type:"text/csv"}),Ie=document.createElement("a"),Ge=URL.createObjectURL(Le),Xe=new Date().toISOString().split("T")[0];Ie.href=Ge,Ie.download=`Inventory_${Xe}.csv`,document.body.appendChild(Ie),Ie.click(),document.body.removeChild(Ie),URL.revokeObjectURL(Ge)},Xs=["","","","","","","","","","","",""],Il=[...new Set(zr.map(I=>I.vendor).filter(I=>I&&!ot(I)))].sort(),Bl=zr.some(I=>!I.vendor),$i=ee==="summary",Zs=zr.filter(I=>I.name.toLowerCase().includes(L.toLowerCase())?ee==="all"||ee==="summary"?!0:ee==="inventory-check"?Te.has(I.id)||!I.isPhantom:ee==="other"?!I.vendor:I.vendor===ee:!1),Zr=I=>{if(!I)return;const Q=Wt(I.name);let ie=null;if(x&&x.size>0&&Q&&(ie=x.get(I.name)||null,!ie)){for(const[we,Le]of x.entries())if(Wt(we)===Q){ie=Le;break}}if(ie){const we=ie.packetUnit||R?.unit||"",Le=ie.packetUnit?Ve(ie,we):null,Ie=Le!==null?Le:ie.lastPrice||R?.price||0;M(Ge=>({...Ge,name:I.name,price:Ie,unit:we,vendor:ie.vendor||Ge?.vendor||"",_master:{packetSize:ie.packetSize,packetUnit:ie.packetUnit,lastPrice:ie.lastPrice,itemCategory:ie.itemCategory,updatedAt:ie.updatedAt}}))}else M(we=>({...we,name:I.name}))};if(E){const I=R?._master?.packetSize||"",Q=R?._master?.packetUnit||"";return s.jsxs("div",{className:"inventory-edit-container fade-in",children:[s.jsx("div",{className:"container-header",children:s.jsx("h2",{className:"section-title",children:R&&!R.isNewFromCsv?"":""})}),s.jsx(on,{className:"edit-form-card",children:s.jsxs("form",{onSubmit:mc,children:[s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:[" ",s.jsx("span",{className:"badge-required",children:""})]}),s.jsx(vd,{name:"name",required:!0,value:V,onChange:ie=>U(ie.target.value),onSelect:Zr,placeholder:": "})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:""}),s.jsx(zt,{name:"vendor",defaultValue:R?.vendor,list:"vendor-list",placeholder:": "}),s.jsx("datalist",{id:"vendor-list",children:Il.filter(ie=>ie!=="").map(ie=>s.jsx("option",{value:ie},ie))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:" ()"}),s.jsx(zt,{name:"price",type:"number",step:"1",defaultValue:R?.price,placeholder:"0"})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:[" ",s.jsx("span",{className:"badge-required",children:""})]}),s.jsx(zt,{name:"quantity",type:"number",step:"0.01",defaultValue:R?.quantity,required:!0})]}),s.jsxs("div",{className:"form-group",children:[s.jsxs("label",{children:[" ",s.jsx("span",{className:"badge-required",children:""})]}),s.jsx(zt,{name:"unit",defaultValue:R?.unit||"pc",required:!0,placeholder:"g, ml, , pc..."})]})]}),s.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[s.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px",color:"#495057"},children:["  ()",s.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",marginLeft:"8px",color:"#868e96"},children:" 1pc = 400g "})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{style:{fontSize:"0.85rem"},children:" (1)"}),s.jsx(zt,{name:"packetSize",type:"number",step:"0.01",defaultValue:I,placeholder:": 400"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{style:{fontSize:"0.85rem"},children:""}),s.jsx(zt,{name:"packetUnit",defaultValue:Q,placeholder:": g"})]})]})]}),s.jsxs("div",{className:"form-row",style:{marginTop:"16px"},children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:""}),s.jsx(zt,{name:"category",defaultValue:R?.category,list:"category-list",placeholder:"",autoComplete:"off"}),s.jsx("datalist",{id:"category-list",children:Xs.map(ie=>s.jsx("option",{value:ie},ie))})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:" ()"}),s.jsx(zt,{name:"threshold",type:"number",step:"0.01",defaultValue:R?.threshold||0})]})]}),s.jsxs("div",{className:"form-actions",children:[s.jsx(le,{variant:"ghost",type:"button",onClick:()=>{A(!1),M(null)},children:""}),s.jsx(le,{variant:"primary",type:"submit",children:""})]})]})})]})}return s.jsx(Di,{onDragEnd:pc,sensors:ar,autoScroll:!1,children:s.jsxs("div",{className:"inventory-container fade-in",children:[s.jsxs("div",{className:"container-header",children:[s.jsx("h2",{className:"section-title",children:" "}),s.jsxs("div",{className:"header-actions inventory-header-actions",children:[s.jsx(le,{variant:"ghost",onClick:n,children:" "}),s.jsx(le,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>a({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),s.jsx(le,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const I=new Date;q(`${I.getFullYear()}${I.getMonth()+1} `),ve(!0),J(!0)},children:" "}),s.jsx(le,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{ge(null),Ce("history"),he(!0)},title:"",children:" "}),s.jsx(le,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{M(null),U(""),A(!0)},children:"+ "})]})]}),s.jsx("div",{className:"inventory-split-layout",children:s.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[s.jsxs("div",{className:"inventory-controls",children:[$i?s.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[s.jsxs("div",{className:"inventory-controls__field",children:[s.jsx("label",{className:"inventory-controls__label",children:":"}),s.jsx("select",{className:"inventory-controls__select",value:He,onChange:I=>it(I.target.value),disabled:St.length===0,children:St.length===0?s.jsx("option",{value:"",children:""}):St.map(I=>s.jsx("option",{value:I.key,children:I.label},I.key))})]}),Nt&&s.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",Nt.rangeLabel]})]}):s.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[s.jsxs("div",{className:"inventory-controls__field",children:[s.jsx("label",{className:"inventory-controls__label",children:":"}),s.jsxs("select",{className:"inventory-controls__select",value:ee==="inventory-check"?"":ee,onChange:I=>{I.target.value&&De(I.target.value)},children:[s.jsx("option",{value:"all",children:""}),s.jsx("option",{value:"",disabled:!0,children:""}),s.jsxs("optgroup",{label:"",children:[Il.map(I=>s.jsx("option",{value:I,children:I},I)),Bl&&s.jsx("option",{value:"other",children:""})]})]})]}),s.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:L,onChange:I=>$(I.target.value)})]}),s.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[s.jsxs("button",{className:"inventory-controls__btn",onClick:()=>De("inventory-check"),"data-active":ee==="inventory-check"?"true":"false",children:["  (",Te.size,")"]}),s.jsx("button",{className:"inventory-controls__btn",onClick:()=>De("summary"),"data-active":ee==="summary"?"true":"false",children:" "}),!$i&&s.jsx("button",{className:"inventory-controls__btn",onClick:Js,title:"CSV",children:" CSV (.csv)"}),!$i&&ee==="inventory-check"&&s.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),$i?s.jsxs("div",{className:"inventory-summary",children:[s.jsx("div",{className:"inventory-summary__header",children:s.jsxs("div",{children:[s.jsx("div",{className:"inventory-summary__title",children:""}),Nt&&s.jsxs("div",{className:"inventory-summary__meta",children:[": ",Nt.rangeLabel]}),un?s.jsxs("div",{className:"inventory-summary__meta",children:[": ",un.title||"","",kt(un.snapshot_date),""]}):s.jsx("div",{className:"inventory-summary__meta",children:""}),Qt.length>1&&s.jsxs("div",{className:"inventory-summary__note",children:[" ",Qt.length," "]})]})}),un?s.jsxs("div",{className:"inventory-summary__table-wrap",children:[s.jsx("div",{className:"inventory-summary__actions",children:s.jsx(le,{variant:"secondary",size:"sm",onClick:fc,children:" CSV (.csv)"})}),s.jsxs("table",{className:"inventory-summary__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"40px"}}),s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),s.jsx(xa,{items:Ii,strategy:Sl,children:s.jsxs("tbody",{children:[Sa.map(I=>{const Q=ue===I.vendor,ie=Xr.get(I.vendor)||null;return s.jsxs(_e.Fragment,{children:[s.jsx(at,{row:I,onVendorClick:hc,isSelected:Q}),Q&&ie&&s.jsxs("tr",{className:"inventory-summary__detail-row",children:[s.jsx("td",{}),s.jsx("td",{colSpan:"2",children:s.jsxs("div",{className:"inventory-summary__inline-detail",children:[s.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[s.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[ie.vendor," "]}),s.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Ol(ie),disabled:!ie.rows||ie.rows.length===0,children:" CSV"}),s.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(ie.totals.taxed||0).toLocaleString()]})]})]}),s.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(we=>s.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[s.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:ze(we)}),s.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ie.totals[we]||0).toLocaleString()]})]},we)),ie.totals.unknown>0&&s.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[s.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),s.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ie.totals.unknown).toLocaleString()]})]})]}),s.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(ie.totals.net||0).toLocaleString()]}),s.jsx("div",{className:"inventory-summary__inline-items-wrap",children:s.jsxs("table",{className:"inventory-summary__inline-items-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),s.jsx("tbody",{children:ie.rows.map((we,Le)=>{const Ie=we.itemCategory?oe(we.itemCategory):ze(we.breakdownKey),Ge=Le>0?ie.rows[Le-1]:null,Xe=!!Ge&&Ge.breakdownKey!==we.breakdownKey;return s.jsxs("tr",{className:Xe?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[s.jsx("td",{children:we.name||"-"}),s.jsx("td",{children:Ie}),s.jsxs("td",{style:{textAlign:"right"},children:["",Number(we.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),s.jsxs("td",{style:{textAlign:"right"},children:[Number(we.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),we.unit?` ${we.unit}`:""]}),s.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(we.taxed||0).toLocaleString()]})]},we.id)})})]})})]})})]})]},I.vendor)}),Sa.length===0&&s.jsx("tr",{children:s.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),s.jsx("tfoot",{children:s.jsxs("tr",{children:[s.jsx("td",{}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),s.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(ja.net).toLocaleString()," / ",Math.round(ja.taxed).toLocaleString()]})]})})]})]}):s.jsx("div",{className:"inventory-summary__empty",children:""})]}):s.jsx(mT,{items:Zs,loading:k,onSearch:$,searchQuery:L,onEdit:I=>{M(I),U(I?.name||""),A(!0)},onDelete:Qs,onUpdateQuantity:Sd,onToggleTax:Ca,onRequestUnitSync:wd})]})}),s.jsx(wn,{isOpen:!!nn,onClose:Lr,title:"10%",size:"small",showCloseButton:!Gt,children:s.jsxs("div",{style:{color:"#333"},children:[s.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",nn?.item?.name||"","",s.jsx("strong",{children:"10%"}),""]}),s.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[s.jsx(le,{variant:"secondary",onClick:Lr,disabled:Gt,children:""}),s.jsx(le,{variant:"primary",onClick:Ll,disabled:Gt,children:Gt?"...":""})]})]})}),s.jsx(wn,{isOpen:H,onClose:()=>{Y||J(!1)},title:" ",size:"small",children:s.jsxs("div",{style:{color:"#333"},children:[s.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),s.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[s.jsx("strong",{children:":"}),s.jsx("br",{}),"1. ",s.jsx("br",{}),"2. ",xe?s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:"()0"}),""]}):s.jsxs(s.Fragment,{children:[s.jsx("strong",{children:""}),""]}),s.jsx("br",{}),""]}),s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[s.jsx("input",{type:"radio",name:"inventory-reset",checked:xe,disabled:Y,onChange:()=>ve(!0)}),s.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",s.jsx("strong",{children:"0"}),""]})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[s.jsx("input",{type:"radio",name:"inventory-reset",checked:!xe,disabled:Y,onChange:()=>ve(!1)}),s.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",s.jsx("strong",{children:""}),""]})]}),s.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),s.jsx("input",{type:"text",value:de,onChange:I=>q(I.target.value),disabled:Y,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[s.jsx("button",{onClick:()=>{Y||J(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:Y?"not-allowed":"pointer",opacity:Y?.6:1,fontSize:"0.9rem"},children:""}),s.jsx("button",{onClick:Ul,disabled:Y,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:Y?"#94a3b8":"#2ecc71",color:"white",cursor:Y?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:Y?"...":xe?"":""})]}),Y&&s.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),s.jsxs(wn,{isOpen:Ee,onClose:()=>he(!1),title:" ",size:"large",children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[s.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:Z==="history"?s.jsxs(s.Fragment,{children:[": ",s.jsx("strong",{children:et.length})," "]}):s.jsxs(s.Fragment,{children:[": ",s.jsx("strong",{children:h.length})," "]})}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[s.jsxs("div",{style:{display:"flex",gap:"6px"},children:[s.jsx("button",{type:"button",onClick:()=>Ce("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:Z==="history"?"#111":"#fff",color:Z==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),s.jsx("button",{type:"button",onClick:()=>Ce("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:Z==="trash"?"#111":"#fff",color:Z==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Ye(!0),title:"",children:" "})]})]}),Z==="history"&&s.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),s.jsx("select",{value:gt,onChange:I=>Lt(I.target.value),disabled:St.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:St.length===0?s.jsx("option",{value:"",children:""}):St.map(I=>s.jsx("option",{value:I.key,children:I.label},I.key))})]}),It&&s.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",It.rangeLabel]})]}),Z==="history"&&et.length===0?s.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):Z==="trash"&&h.length===0?s.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):s.jsx("div",{style:{overflowX:"auto"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{background:"#f0f0f0"},children:[s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:Z==="trash"?"":""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),s.jsx("tbody",{children:(Z==="history"?et:h).map(I=>{const Q=xt(I).filter(ct=>!ot(ct?.vendor)),ie=Q.length,we=Math.round(Q.reduce((ct,pt)=>{const nt=parseFloat(pt?.price)||0,Ut=pt?.quantity===""?0:parseFloat(pt?.quantity)||0;return ct+nt*Ut*Fe(pt)},0)),Le=Z==="trash"?`trash-${I.id}`:I.id,Ie=kt(Z==="trash"?I.deleted_at:I.snapshot_date),Ge=qe?.type==="move"&&qe?.id===I.id,Xe=qe?.type==="restore"&&qe?.id===I.id,tt=qe?.type==="hard-delete"&&qe?.id===I.id,st=Ge||Xe||tt;return s.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[s.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Ie}),s.jsx("td",{style:{padding:"10px"},children:I.title||"-"}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:ie.toLocaleString()}),s.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",we.toLocaleString()]}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Z==="history"?s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Bi(I),disabled:ie===0||st,title:ie===0?"items CSV":"CSV",children:" CSV"}),s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>ge(I),disabled:st,children:""}),s.jsx(le,{variant:"danger",size:"sm",onClick:()=>_a(I),disabled:st,title:"",children:Ge?"...":""})]}):s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Bi(I),disabled:ie===0||st,children:" CSV"}),s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>ge(I),disabled:st,children:""}),s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>bd(I),disabled:st,title:"",children:Xe?"...":""}),s.jsx(le,{variant:"danger",size:"sm",onClick:()=>fr(I),disabled:st,title:"",children:tt?"...":""})]})})]},Le)})})]})})]}),s.jsx(wn,{isOpen:!!be,onClose:()=>{Ze||We(null)},title:be?.title||"",size:"small",children:s.jsxs("div",{style:{color:"#333"},children:[s.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:be?.message}),be?.requireText&&s.jsxs("div",{style:{marginTop:"14px"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",s.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:be.requireText})," "]}),s.jsx("input",{type:"text",value:Re,onChange:I=>Pe(I.target.value),placeholder:be.requireText,disabled:Ze,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[s.jsx(le,{variant:"ghost",disabled:Ze,onClick:()=>{Ze||We(null)},children:""}),s.jsx(le,{variant:"danger",disabled:Ze||!!be?.requireText&&Re!==be.requireText,onClick:()=>be?.onConfirm&&be.onConfirm(),children:Ze?be?.loadingLabel||"...":be?.confirmLabel||""})]})]})}),s.jsx(wn,{isOpen:!!G,onClose:()=>ge(null),title:G?` ${G.title||""}`:" ",size:"large",children:(()=>{const I=G;if(!I)return null;const we=[...xt(I).filter(Ie=>ot(Ie?.vendor)?!1:Se?(Ie?.quantity===""?0:parseFloat(Ie?.quantity)||0)!==0:!0)].sort((Ie,Ge)=>{const Xe=Be.direction==="desc"?-1:1;if(Be.key==="vendor"){const Ut=(Ie?.vendor||"").toString(),Cn=(Ge?.vendor||"").toString(),Nn=Ut.localeCompare(Cn,"ja");if(Nn!==0)return Nn*Xe;const Ur=(Ie?.name||"").toString(),es=(Ge?.name||"").toString();return Ur.localeCompare(es,"ja")*Xe}const tt=(Ie?.name||"").toString(),st=(Ge?.name||"").toString(),ct=tt.localeCompare(st,"ja");if(ct!==0)return ct*Xe;const pt=(Ie?.vendor||"").toString(),nt=(Ge?.vendor||"").toString();return pt.localeCompare(nt,"ja")*Xe}),Le=we.reduce((Ie,Ge)=>{const Xe=parseFloat(Ge?.price)||0,tt=Ge?.quantity===""?0:parseFloat(Ge?.quantity)||0,st=Xe*tt;return Ie.net+=st,Ie.taxed+=st*Fe(Ge),Ie},{net:0,taxed:0});return s.jsxs("div",{children:[s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[s.jsxs("div",{children:[": ",s.jsx("strong",{children:kt(I.snapshot_date)})]}),s.jsxs("div",{children:[": ",s.jsx("strong",{children:we.length.toLocaleString()})]}),s.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",s.jsxs("strong",{children:["",Math.round(Le.net).toLocaleString()," / ",Math.round(Le.taxed).toLocaleString()]})]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[s.jsx("input",{type:"checkbox",checked:Se,onChange:Ie=>te(Ie.target.checked)}),"0"]}),s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Bi(I),children:" CSV (.csv)"})]}),we.length===0?s.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):s.jsx("div",{style:{overflowX:"auto"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{background:"#f0f0f0"},children:[s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),s.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),s.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{ut(Ie=>Ie.key==="vendor"?{key:"vendor",direction:Ie.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",Be.key==="vendor"&&(Be.direction==="asc"?"":"")]})]})}),s.jsx("tbody",{children:we.map((Ie,Ge)=>{const Xe=parseFloat(Ie?.price)||0,tt=Ie?.quantity===""?0:parseFloat(Ie?.quantity)||0,st=Math.round(Xe*tt*Fe(Ie)),ct=Ws(Ie),pt=oe(ct);return s.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[s.jsxs("td",{style:{padding:"10px"},children:[Ie?.name||"-",re(Ie?.tax10)&&s.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),s.jsx("td",{style:{padding:"10px"},children:pt}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Xe?`${Number(Xe).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),s.jsx("td",{style:{padding:"10px"},children:Ie?.unit||"-"}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:tt?tt.toLocaleString():"0"}),s.jsx("td",{style:{padding:"10px",textAlign:"right"},children:st?`${st.toLocaleString()}`:"-"}),s.jsx("td",{style:{padding:"10px"},children:Ie?.vendor||"-"})]},Ie?.id||`${Ie?.name||"item"}-${Ge}`)})})]})})]})})()}),s.jsx(wn,{isOpen:F,onClose:Dl,title:"",size:"small",children:(()=>{const I=P,Q=I?._master?.packetUnit||"",ie=I?.unit||"",we=_t(ie,Q),Le=we!==null&&we!==1,Ie=parseFloat(I?.price)||0,Ge=I?.quantity===""?0:parseFloat(I?.quantity)||0,Xe=I?Fe(I):1.08,tt=Ie*Ge*Xe,st=Q?Ve(I?._master,Q):null,ct=st===null?null:st*Ge*Xe,pt=st===null||!Le?null:st*(Ge*we)*Xe,nt=Cn=>`${Math.round(Cn).toLocaleString()}`,Ut=Cn=>Number.isInteger(Cn)?Cn.toLocaleString():Cn.toLocaleString(void 0,{maximumFractionDigits:3});return s.jsxs("div",{style:{color:"#333"},children:[s.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[s.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:I?.name||"-"}),s.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",Ut(Ge)," ",ie," /  ",Ie.toLocaleString()," /  ",nt(tt)]}),!!Q&&s.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",Q]})]}),s.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:s.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",s.jsx("br",{}),""]})}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[s.jsx(le,{variant:"ghost",type:"button",onClick:Dl,disabled:T,children:""}),s.jsx(le,{variant:"secondary",type:"button",onClick:()=>Ml({convertQuantity:!1}),isLoading:T,disabled:T||!Q||st===null,title:ct===null?"":`:  ${nt(ct)}`,children:""}),Le&&s.jsx(le,{variant:"primary",type:"button",onClick:()=>Ml({convertQuantity:!0}),isLoading:T,disabled:T||!Q||st===null,title:pt===null?"":`:  ${nt(pt)}`,children:""})]})]})})()}),s.jsx(wn,{isOpen:Ct,onClose:()=>Rt(!1),title:"",size:"small",children:s.jsxs("div",{style:{color:"#333"},children:[s.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",s.jsx("strong",{children:mt?.name}),""]}),s.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",s.jsx("strong",{children:""}),"",s.jsx("br",{}),"CSV"]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[s.jsx("button",{onClick:()=>Rt(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),s.jsx("button",{onClick:zl,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),s.jsx(wn,{isOpen:Vt,onClose:()=>an(!1),title:" ",size:"small",children:s.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[s.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),s.jsxs("h3",{style:{marginBottom:"1rem"},children:[de," "]}),s.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",s.jsx("br",{}),""]}),s.jsx("button",{onClick:()=>an(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),s.jsx(wn,{isOpen:!!xn,onClose:()=>Mt(null),title:xn?.title||"",size:"small",children:s.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[xn?.type==="success"&&s.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),xn?.type==="error"&&s.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),s.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:xn?.message}),s.jsx("button",{onClick:()=>Mt(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:xn?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},Do="app-data",yT="incoming-deliveries",vT=n=>{const t=String(n||"").trim();return t&&t.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},xT=n=>{const t=String(n),i=t.lastIndexOf(".");return i<=0?t:t.slice(0,i)},bT=async n=>{if(!n)return"";const t=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},us={async _getCurrentUserId(){const{data:n,error:t}=await Ne.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${yT}`},_filePath(n,t){const i=this._folderPath(n),a=String(t||"").replace(/^\/+/,"");return`${i}/${a}`},async listJsonFiles(n=null){const t=n||await this._getCurrentUserId();if(!t)return[];const i=this._folderPath(t),{data:a,error:o}=await Ne.storage.from(Do).list(i,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return o?(console.error("Failed to list incoming deliveries:",o),[]):(a||[]).filter(u=>String(u?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._filePath(i,n),{data:o,error:u}=await Ne.storage.from(Do).download(a);if(u)throw u;const d=await bT(o);return JSON.parse(d)},async saveDeliverySet({pdfFile:n,parsed:t},i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");if(!n)throw new Error("PDF");if(!t)throw new Error("");const o=new Date,u=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}_${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,d=vT(xT(n.name||"delivery")),f=`${u}_${d}`,h=this._filePath(a,`${f}.pdf`),m=this._filePath(a,`${f}.json`),y={...t,_meta:{savedAt:o.toISOString(),originalFileName:n.name||null}},[v,x]=await Promise.all([Ne.storage.from(Do).upload(h,n,{upsert:!1,contentType:"application/pdf"}),Ne.storage.from(Do).upload(m,new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(v.error)throw v.error;if(x.error)throw x.error;return{baseName:f,pdfPath:h,jsonPath:m}},async deleteDeliverySet(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=String(n||"").trim();if(!a)throw new Error("baseName ");const o=this._filePath(i,`${a}.pdf`),u=this._filePath(i,`${a}.json`),{data:d,error:f}=await Ne.storage.from(Do).remove([o,u]);if(f)throw f;return d}},wT="/app/assets/pdf.worker-DU8cYlj-.js",ST=n=>typeof n=="string"&&n.trim().length>0,qs=n=>String(n??"").replace(/\u0000/g,"").trim(),Uo=n=>{const t=String(n??"").trim();if(!t)return null;const i=t.replace(/[,\s]/g,""),a=Number(i);return Number.isFinite(a)?a:null},Mo=n=>{const t=String(n??"").trim();if(!t)return null;const i=t.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return i?i[2]?`${i[1]} ${i[2]}`:i[1]:null},jT=n=>{const t=String(n??"").trim();return!!(!t||t==="/"||t.startsWith("")||t.includes(""))},_T=(n,t)=>{const i=String(n??"").trim(),a=i.match(/^No\.?\s*(\d{3,})\s*$/);if(a?.[1])return{slipNo:a[1],consumeNext:!1};if(/^No\.?\s*$/.test(i)){const o=String(t??"").trim();if(/^\d{3,}$/.test(o))return{slipNo:o,consumeNext:!0}}return null},Ap=n=>{const t=String(n??"").trim();return t?!!/^No\.?\s*(\d{3,})?\s*$/.test(t):!1},CT=(n,t)=>{const i=qs(n[t]);if(!i||Ap(i)||i===""||i===""||i===""||i==="No"||i===""||i===""||i===""||i===""||i===""||i==="")return null;let a=t+1;const o=Uo(n[a]);if(o==null)return null;a+=1;const u=Uo(n[a]);if(u==null)return null;a+=1;const d=qs(n[a]);if(!d)return null;a+=1;let f=null,h=null,m=null;const y=Uo(n[a]);for(y!=null?(h=y,a+=1,m=qs(n[a]),a+=1):(f=qs(n[a])||null,a+=1,h=Uo(n[a]),a+=1,m=qs(n[a]),a+=1);a<n.length;){const b=qs(n[a]);if(b===""||b===""){a+=1;continue}break}let v=null;const x=qs(n[a]);return/^\d+$/.test(x)&&(v=parseInt(x,10),a+=1),{item:{no:v,code:null,name:i,unitPrice:o,deliveryQty:u,deliveryUnit:d,spec:f,orderQty:h,orderUnit:m},nextIndex:a}},NT=n=>{const t=(n||[]).map(qs).filter(f=>!jT(f)),i={title:t.find(f=>f.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let f=0;f<t.length;f+=1){const h=t[f],m=h.match(/^?\s*(.+)$/);if(m?.[1]&&!i.outputAt){i.outputAt=Mo(m[1])||m[1].trim();continue}const y=h.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);y&&!i.rangeFrom&&(i.rangeFrom=y[1],i.rangeTo=y[2])}const a=new Map;let o=null,u=null;for(let f=0;f<t.length;f+=1){const h=t[f],m=t[f+1],y=_T(h,m);if(y?.slipNo){const v=y.slipNo;y.consumeNext&&(f+=1);const x=a.get(v);x?o=x:(o={slipNo:v,vendor:u||null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},a.set(v,o));continue}if(/^(||)/.test(h)&&!h.includes("")&&!h.includes("")&&!h.includes("")){let v=3;(h.startsWith("")||h.startsWith("")||h.startsWith(""))&&(v=4);let x=h.slice(v).trim();(x.startsWith(":")||x.startsWith(""))&&(x=x.slice(1).trim());let b=null;if(!x)ST(m)&&!/^\d+$/.test(m)&&!m.includes("")&&(b=m.trim());else{const _=x.match(/^(\d+)\s+(.+)$/);_&&(x=_[2].trim()),b=x}b&&(o?o.vendor||(o.vendor=b):u=b);continue}if(o){if(h===""||h.startsWith("")){const v=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.slipDate=v[1]:Mo(m)&&(o.slipDate=Mo(m));continue}if(h===""){const v=Uo(m);v!=null&&(o.total=v);continue}if(h===""||h.startsWith("")){const v=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.deliveryDate=v[1]:Mo(m)&&(o.deliveryDate=Mo(m)?.slice(0,10));continue}if(h.startsWith("")){const x=h.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(x&&x!=="No"){o.comment=x;continue}const b=[];for(let C=f+1;C<t.length;C+=1){const S=t[C];if(S){if(Ap(S)||S==="No"||S===""||S===""||S===""||S===""||S===""||S===""||S==="")break;b.push(S)}}const _=b.join(" ").trim();_&&_!=="No"&&(o.comment=_);continue}if(h===""||h===""){let v=f+1;for(;v<t.length;){const x=t[v];if(Ap(x)||x==="")break;const b=CT(t,v);if(!b){v+=1;continue}o.items.push(b.item),v=b.nextIndex}f=v-1}}}const d=Array.from(a.values()).sort((f,h)=>String(f.slipNo).localeCompare(String(h.slipNo),"ja"));return{report:i,slips:d}},y0=async n=>{if(!n)throw new Error("PDF");const t=await n.arrayBuffer(),i=await $u(()=>import("./pdf-DJLjSHyj.js").then(f=>f.p),[]),a=i?.default&&i.default.getDocument?i.default:i;if(!a?.getDocument)throw new Error("PDF");a?.GlobalWorkerOptions&&(a.GlobalWorkerOptions.workerSrc=wT);const o=await a.getDocument({data:new Uint8Array(t)}).promise,u=[];for(let f=1;f<=o.numPages;f+=1){const m=await(await o.getPage(f)).getTextContent();for(const y of m.items||[]){const v=qs(y?.str);v&&u.push(v)}}const d=NT(u);if(!d?.slips||d.slips.length===0)throw new Error("PDFPDF");return d},ap=n=>String(n||"").replace(/\.json$/i,""),v0=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${i}/${a}/${o} ${u}:${d}`},ET=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},kT=n=>String(n||"").trim(),TT=({onBack:n})=>{const[t,i]=ic(),[a,o]=_e.useState(!0),[u,d]=_e.useState([]),[f,h]=_e.useState(null),[m,y]=_e.useState(!1),[v,x]=_e.useState(!1),[b,_]=_e.useState(null),[C,S]=_e.useState(!1),[N,k]=_e.useState(""),[D,L]=_e.useState(null),[$,E]=_e.useState(!1),[A,R]=_e.useState(null),[M,V]=_e.useState(!1),[U,F]=_e.useState(!1),[ne,P]=_e.useState(null),B=_e.useCallback(async()=>{o(!0),k("");try{const he=await us.listJsonFiles();d(he||[])}catch(he){console.error(he),k(""),d([])}finally{o(!1)}},[]);_e.useEffect(()=>{B()},[B]);const T=he=>{he.preventDefault(),y(!0)},z=he=>{he.preventDefault(),y(!1)},H=he=>{he.preventDefault(),y(!1);const G=he.dataTransfer.files?.[0];G&&G.type==="application/pdf"?(h(G),_(null),P(null),k(""),J(G)):G&&k("PDF")},J=async he=>{if(he){k(""),x(!0),_(null),P(null);try{const G=await y0(he);_(G||null)}catch(G){console.error(G),k(`PDF:
${G?.message||String(G)}`)}finally{x(!1)}}},de=async()=>{if(f){k(""),x(!0),_(null),P(null);try{const he=await y0(f);_(he||null)}catch(he){console.error(he),k(`PDF:
${he?.message||String(he)}`)}finally{x(!1)}}},q=async()=>{if(!(!f||!b)){k(""),S(!0);try{await us.saveDeliverySet({pdfFile:f,parsed:b}),h(null),_(null),await B()}catch(he){console.error(he),k(`: ${he?.message||String(he)}`)}finally{S(!1)}}},Y=async he=>{const G=ap(he);E(!0),k("");try{const ge=await us.downloadJson(he);L({baseName:G,data:ge})}catch(ge){console.error(ge),k(`: ${ge?.message||String(ge)}`)}finally{E(!1)}},ae=async()=>{if(A?.baseName){V(!0),k("");try{await us.deleteDeliverySet(A.baseName),R(null),await B()}catch(he){console.error(he),k(`: ${he?.message||String(he)}`)}finally{V(!1)}}},xe=he=>{const G=new Map,ge=(Ce,be)=>{const We=String(Ce?.name||"").trim();if(!We)return;const Re=kT(Ce?.deliveryUnit||Ce?.unit||Ce?.unitName||""),Pe=ET(Ce?.deliveryQty??Ce?.quantity??Ce?.qty);if(!Number.isFinite(Pe)||Pe===null)return;const Ze=String(be||"").trim(),rt=`${Ze}@@${Wt(We)}@@${Re||""}`,qe=G.get(rt);qe?qe.qty+=Pe:G.set(rt,{vendor:Ze,name:We,unit:Re,qty:Pe})};return(he?.slips||he?.receipts||[]).forEach(Ce=>{const be=Ce?.vendor||"";(Ce?.items||[]).forEach(Re=>ge(Re,be))}),Array.from(G.values()).sort((Ce,be)=>Ce.vendor!==be.vendor?Ce.vendor.localeCompare(be.vendor,"ja"):Ce.name!==be.name?Ce.name.localeCompare(be.name,"ja"):String(Ce.unit||"").localeCompare(String(be.unit||""),"ja"))},ve=async()=>{F(!0),k(""),P(null);try{const he=await us.listJsonFiles();if(!he||he.length===0){P([]);return}const G=[];for(const Ce of he){const be=Ce?.name;if(be)try{const We=await us.downloadJson(be);G.push(We)}catch(We){console.warn("Failed to download:",be,We)}}const ge=new Map;G.forEach(Ce=>{xe(Ce).forEach(We=>{const Re=`${We.vendor}@@${Wt(We.name)}@@${We.unit||""}`,Pe=ge.get(Re);Pe?Pe.qty+=We.qty:ge.set(Re,{...We})})});const Z=Array.from(ge.values()).sort((Ce,be)=>Ce.vendor!==be.vendor?Ce.vendor.localeCompare(be.vendor,"ja"):Ce.name!==be.name?Ce.name.localeCompare(be.name,"ja"):String(Ce.unit||"").localeCompare(String(be.unit||""),"ja"));P(Z)}catch(he){console.error(he),k(`: ${he?.message||String(he)}`)}finally{F(!1)}},Ee=b?.slips||b?.receipts||[];return s.jsxs("div",{className:"incoming-deliveries",children:[s.jsxs("div",{className:"incoming-deliveries__header",children:[s.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),s.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[s.jsx(le,{variant:"secondary",onClick:()=>i({view:"incoming-stock"}),children:" "}),s.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),N&&s.jsx(on,{className:"incoming-deliveries__error",children:N}),s.jsxs(on,{className:"incoming-deliveries__card",children:[s.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),s.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",XE]}),s.jsxs("div",{className:"incoming-deliveries__upload",children:[s.jsxs("div",{className:`incoming-deliveries__upload-zone ${m?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:T,onDragLeave:z,onDrop:H,children:[s.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:m?"var(--color-primary)":"inherit"},children:m?"":"PDF"}),s.jsx("input",{type:"file",accept:"application/pdf",onChange:he=>{const G=he.target.files?.[0]||null;h(G),_(null),P(null),k("")},style:{width:"100%"}})]}),s.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[s.jsx(le,{variant:"secondary",onClick:de,disabled:!f||v||C,children:v?"":""}),s.jsx(le,{variant:"primary",onClick:q,disabled:!f||!b||C||v,children:C?"":""})]})]}),b&&s.jsxs("div",{className:"incoming-deliveries__preview",children:[s.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",s.jsx("strong",{children:b?.report?.outputAt||b?.report?.outputDate||"-"})]}),s.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",s.jsx("strong",{children:Ee.length})]}),Ee.slice(0,3).map((he,G)=>s.jsxs("div",{className:"incoming-deliveries__slip",children:[s.jsxs("div",{className:"incoming-deliveries__slip-head",children:[s.jsx("div",{style:{fontWeight:700},children:he?.vendor||""}),s.jsxs("div",{style:{opacity:.85},children:["No: ",he?.slipNo||"-"," / : ",he?.deliveryDate||"-"]})]}),s.jsxs("table",{className:"incoming-deliveries__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"52%"},children:""}),s.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"16%"},children:""})]})}),s.jsx("tbody",{children:(he?.items||[]).slice(0,6).map((ge,Z)=>s.jsxs("tr",{children:[s.jsx("td",{children:ge?.name||"-"}),s.jsx("td",{style:{textAlign:"right"},children:ge?.unitPrice!=null?`${Math.round(ge.unitPrice).toLocaleString()}`:"-"}),s.jsx("td",{style:{textAlign:"right"},children:ge?.deliveryQty!=null?ge.deliveryQty:"-"}),s.jsx("td",{children:ge?.deliveryUnit||"-"})]},`${ge?.no||Z}`))})]}),(he?.items||[]).length>6&&s.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(he?.items||[]).length-6)," "]})]},`${he?.slipNo||he?.id||G}`)),Ee.length>3&&s.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),s.jsxs(on,{className:"incoming-deliveries__card",children:[s.jsxs("div",{className:"incoming-deliveries__list-head",children:[s.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),s.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[s.jsx(le,{variant:"secondary",onClick:B,disabled:a||U,children:""}),s.jsx(le,{variant:"secondary",onClick:ve,disabled:a||U,children:U?"":""})]})]}),a?s.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):u.length===0?s.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):s.jsx("div",{className:"incoming-deliveries__file-list",children:u.map(he=>s.jsxs("div",{className:"incoming-deliveries__file-row",children:[s.jsxs("div",{className:"incoming-deliveries__file-info",children:[s.jsx("div",{style:{fontWeight:700},children:ap(he.name)}),s.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",v0(he.updated_at||he.created_at)]})]}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Y(he.name),disabled:$||M,children:$?"":""}),s.jsx(le,{variant:"ghost",size:"sm",onClick:()=>R({baseName:ap(he.name)}),disabled:M,children:""})]})]},he.name))}),ne&&s.jsxs("div",{className:"incoming-deliveries__aggregate",children:[s.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),ne.length===0?s.jsx("div",{style:{opacity:.85},children:""}):s.jsxs("table",{className:"incoming-deliveries__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:"/"}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{children:""})]})}),s.jsx("tbody",{children:ne.slice(0,60).map(he=>s.jsxs("tr",{children:[s.jsx("td",{children:he.vendor||"-"}),s.jsx("td",{children:he.name}),s.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(he.qty)?he.qty:"-"}),s.jsx("td",{children:he.unit||"-"})]},`${he.vendor}@@${he.name}@@${he.unit||""}`))})]}),ne.length>60&&s.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),s.jsx(wn,{isOpen:!!D,onClose:()=>L(null),title:"PDF ",size:"large",children:D?.data?s.jsxs("div",{children:[s.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",v0(D.data?._meta?.savedAt),D.data?._meta?.originalFileName?` / : ${D.data._meta.originalFileName}`:""]}),(D.data?.slips||D.data?.receipts||[]).map((he,G)=>s.jsxs("div",{style:{marginBottom:"16px"},children:[s.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[he?.vendor||"","No: ",he?.slipNo||"-"," / : ",he?.deliveryDate||"-",""]}),s.jsxs("table",{className:"incoming-deliveries__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"52%"},children:""}),s.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"16%"},children:""})]})}),s.jsx("tbody",{children:(he?.items||[]).map((ge,Z)=>s.jsxs("tr",{children:[s.jsx("td",{children:ge?.name||"-"}),s.jsx("td",{style:{textAlign:"right"},children:ge?.unitPrice!=null?`${Math.round(ge.unitPrice).toLocaleString()}`:"-"}),s.jsx("td",{style:{textAlign:"right"},children:ge?.deliveryQty!=null?ge.deliveryQty:"-"}),s.jsx("td",{children:ge?.deliveryUnit||"-"})]},`${ge?.no||Z}`))})]})]},`${he?.slipNo||G}`))]}):s.jsx("div",{style:{opacity:.8},children:""})}),s.jsx(wn,{isOpen:!!A,onClose:()=>R(null),title:"",size:"small",children:s.jsxs("div",{style:{lineHeight:1.6},children:[s.jsxs("p",{style:{marginTop:0},children:["",A?.baseName,""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>R(null),disabled:M,children:""}),s.jsx(le,{variant:"danger",onClick:ae,disabled:M,children:M?"":""})]})]})})]})},Bs="app-data",AT="incoming-stock",RT="stock.json",OT="applied",ya=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},jl=n=>String(n||"").trim(),va=(n,t,i)=>`${String(i||"").trim()}@@${Wt(n)}@@${jl(t)}`,lp=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===404)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("not found")||a.includes("object not found")},DT=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===409)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("already exists")||a.includes("duplicate")||a.includes("409")},MT=n=>{const t=new Map;return(n?.slips||n?.receipts||[]).forEach(a=>{const o=String(a?.vendor||"").trim();(a?.items||[]).forEach(u=>{const d=String(u?.name||"").trim();if(!d)return;const f=jl(u?.deliveryUnit||u?.unit||u?.unitName||""),h=ya(u?.deliveryQty??u?.quantity??u?.qty);if(h==null)return;const m=va(d,f,o),y=t.get(m);y?y.quantity+=h:t.set(m,{vendor:o,name:d,unit:f,quantity:h})})}),Array.from(t.values()).filter(a=>Number.isFinite(a.quantity))},zT=(n,t,i)=>{const a=new Map;return(n||[]).forEach(o=>{const u=String(o?.name||"").trim();if(!u)return;const d=jl(o?.unit||""),f=String(o?.vendor||"").trim(),h=ya(o?.quantity)??0;a.set(va(u,d,f),{vendor:f,name:u,unit:d,quantity:h,updatedAt:o?.updatedAt||null})}),t.forEach(o=>{const u=va(o.name,o.unit,o.vendor),d=a.get(u);d?(d.quantity=Math.max(0,(ya(d.quantity)??0)+(ya(o.quantity)??0)),d.updatedAt=i):a.set(u,{vendor:o.vendor,name:o.name,unit:jl(o.unit),quantity:Math.max(0,ya(o.quantity)??0),updatedAt:i})}),Array.from(a.values()).sort((o,u)=>o.vendor!==u.vendor?o.vendor.localeCompare(u.vendor,"ja"):o.name!==u.name?o.name.localeCompare(u.name,"ja"):String(o.unit||"").localeCompare(String(u.unit||""),"ja"))},$s={async _getCurrentUserId(){const{data:n,error:t}=await Ne.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${AT}`},_stockPath(n){return`${this._folderPath(n)}/${RT}`},_appliedFolder(n){return`${this._folderPath(n)}/${OT}`},_appliedMarkerPath(n,t){const i=this._appliedFolder(n),a=String(t||"").trim();if(!a)throw new Error("baseName is required");return`${i}/${a}.json`},async listAppliedBaseNames(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Set;const i=this._appliedFolder(t),{data:a,error:o}=await Ne.storage.from(Bs).list(i,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(o)return lp(o)?new Set:(console.error("Failed to list applied markers:",o),new Set);const u=new Set;return(a||[]).forEach(d=>{const f=String(d?.name||"");f.toLowerCase().endsWith(".json")&&u.add(f.replace(/\.json$/i,""))}),u},async loadStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const i=this._stockPath(t),{data:a,error:o}=await Ne.storage.from(Bs).createSignedUrl(i,60);if(o){if(lp(o))return{_meta:{version:1,updatedAt:null},items:[]};throw o}try{const u=await fetch(a.signedUrl,{cache:"no-store"});if(!u.ok){if(u.status===404)return{_meta:{version:1,updatedAt:null},items:[]};throw new Error(`Failed to fetch stock: ${u.status} ${u.statusText}`)}const d=await u.text(),f=JSON.parse(d||"{}"),h=Array.isArray(f?.items)?f.items:[];return{_meta:{version:1,updatedAt:f?._meta?.updatedAt||null},items:h}}catch(u){throw console.warn("loadStock fetch failed",u),u}},async saveStock(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._stockPath(i),o={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(n?.items)?n.items:[]},{error:u}=await Ne.storage.from(Bs).upload(a,new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(u)throw u;return o},async applyDeliverySet({baseName:n,parsed:t},i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("baseName ");if(!t)throw new Error("");const u=MT(t),d=new Date().toISOString(),f=this._appliedMarkerPath(a,o),h={baseName:o,appliedAt:d,slipCount:(t?.slips||t?.receipts||[]).length||0,itemCount:u.length},m=await Ne.storage.from(Bs).upload(f,new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(m.error){if(DT(m.error))return{status:"already_applied"};throw m.error}try{const y=await this.loadStock(a),v=zT(y.items||[],u,d);return await this.saveStock({items:v},a),{status:"applied",addedCount:u.length}}catch(y){try{await Ne.storage.from(Bs).remove([f])}catch{}throw y}},async updateStockItem({name:n,unit:t,vendor:i,delta:a},o=null){const u=o||await this._getCurrentUserId();if(!u)throw new Error("");const d=String(n||"").trim();if(!d)throw new Error("");const f=jl(t),h=String(i||"").trim(),m=va(d,f,h),y=ya(a);if(y===null||!Number.isFinite(y))throw new Error("");const x=(await this.loadStock(u)).items||[],b=new Date().toISOString();let _=!1;const C=x.map(S=>{if(va(S.name,S.unit,S.vendor)===m){_=!0;const k=Math.max(0,(ya(S.quantity)??0)+y);return{...S,quantity:k,updatedAt:b}}return S});if(!_)throw new Error("");return await this.saveStock({items:C},u),{status:"updated",name:d,unit:f}},async deleteStockItem({name:n,unit:t,vendor:i},a=null){const o=a||await this._getCurrentUserId();if(!o)throw new Error("");const u=String(n||"").trim();if(!u)throw new Error("");const d=jl(t),f=String(i||"").trim(),h=va(u,d,f),y=(await this.loadStock(o)).items||[],v=y.filter(x=>va(x.name,x.unit,x.vendor)!==h);return v.length,y.length,await this.saveStock({items:v},o),{status:"deleted",name:u}},async clearStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const i=this._stockPath(t),a={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await Ne.storage.from(Bs).upload(i,new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const o=this._appliedFolder(t),{data:u}=await Ne.storage.from(Bs).list(o,{limit:1e3});if(u?.length){const d=u.map(f=>`${o}/${f.name}`);await Ne.storage.from(Bs).remove(d)}return{status:"cleared"}},async deleteAppliedMarker(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._appliedMarkerPath(i,n),{error:o}=await Ne.storage.from(Bs).remove([a]);if(o){if(lp(o))return{status:"not_found"};throw o}return{status:"deleted"}}},Oi="meal_plans",LT="planner_data",_i="",x0=20,Ti=[],UT=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,tw=n=>`planner_data_${n}`,Ci=n=>{Ti[Ti.length-1]!==n&&(Ti.push(n),Ti.length>x0&&Ti.splice(0,Ti.length-x0))},br=(n,t=null)=>{if(n==null||n==="")return t;const i=Number(n);return Number.isFinite(i)?i:t},Rp=(n,t)=>{const i=String(n?.message||"").toLowerCase();return String(n?.code||"")==="42703"?i.includes(`column "${String(t).toLowerCase()}"`):i.includes(`column "${String(t).toLowerCase()}"`)&&i.includes("does not exist")},Ni=n=>{try{if(!n)return{};const t=localStorage.getItem(tw(n));if(t)return JSON.parse(t);const i=localStorage.getItem(LT);if(i){const a=JSON.parse(i);return ls(n,a),a}return{}}catch{return{}}},ls=(n,t)=>{n&&localStorage.setItem(tw(n),JSON.stringify(t))},IT=()=>`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,wl=n=>{if(typeof n=="number")return n;const t=Number(n);return Number.isFinite(t)?t:n},BT=n=>({id:String(n.id),recipeId:wl(n.recipe_id??n.recipeId),type:n.meal_type??n.type??"dinner",note:n.note??"",multiplier:br(n.multiplier,1),totalWeight:br(n.total_weight??n.totalWeight,null)}),$T=n=>n?typeof n=="string"?n.slice(0,10):n instanceof Date?n.toISOString().slice(0,10):String(n).slice(0,10):"",PT=n=>{const t={};return(n||[]).forEach(i=>{const a=$T(i.plan_date??i.planDate);a&&(t[a]||(t[a]=[]),t[a].push(BT(i)))}),t},qT=(n,t)=>{const i=[];return Object.keys(t||{}).forEach(a=>{(t[a]||[]).forEach(u=>{i.push({user_id:n,plan_date:a,recipe_id:wl(u.recipeId),meal_type:u.type||"dinner",note:u.note||"",multiplier:br(u.multiplier,1),total_weight:br(u.totalWeight,null)})})}),i},FT=n=>({...n,date_str:n.plan_date,type:n.meal_type}),HT=n=>{const{date_str:t,type:i,...a}=n;return a},tm=async n=>{if(!n||n.length===0)return;const t=n.map(FT);let{error:i}=await Ne.from(Oi).insert(t);if(i&&(Rp(i,"date_str")||Rp(i,"type"))){const a=t.map(HT);({error:i}=await Ne.from(Oi).insert(a))}if(i)throw i},b0=n=>UT.test(String(n||"")),zo=n=>{if(n==null||n==="")return"";if(typeof n=="number")return String(n);const t=Number(n);return Number.isFinite(t)?String(t):String(n)},rd=(n,t)=>{const i=zo(t?.recipeId),a=zo(t?.type||"dinner"),o=zo(t?.note||""),u=zo(br(t?.multiplier,1)),d=zo(br(t?.totalWeight,null));return`${n}|${i}|${a}|${o}|${u}|${d}`},VT=(n,t)=>{const i={};Object.keys(n||{}).forEach(o=>{i[o]=[...n[o]||[]]});const a=new Set;return Object.keys(n||{}).forEach(o=>{(n[o]||[]).forEach(u=>{a.add(rd(o,u))})}),Object.keys(t||{}).forEach(o=>{(t[o]||[]).forEach(d=>{const f=rd(o,d);a.has(f)||(i[o]||(i[o]=[]),i[o].push(d),a.add(f))})}),i},GT=(n,t,i)=>{const a={...n||{}};return a[t]||(a[t]=[]),a[t]=[...a[t],i],a},KT=(n,t,i)=>{const a={...n||{}};return a[t]&&(a[t]=(a[t]||[]).filter(o=>String(o.id)!==String(i)),a[t].length===0&&delete a[t]),a},YT=(n,t,i,a)=>{const o={...n||{}};return o[t]&&(o[t]=o[t].map(u=>String(u.id)!==String(i)?u:{...u,...a})),o},WT=(n,t,i)=>{const a={...n||{}};return Object.keys(a).forEach(o=>{o>=t&&o<=i&&delete a[o]}),a},QT=(n,t)=>{const i=new Set((t||[]).map(d=>String(d))),a={},o=[];let u=!1;return Object.keys(n||{}).forEach(d=>{const f=n[d]||[],h=f.filter(m=>{const y=i.has(String(m.recipeId));return y||o.push(String(m.id)),y});h.length>0&&(a[d]=h),h.length!==f.length&&(u=!0)}),{nextPlans:u?a:n,invalidIds:o,hasChanges:u}},nm=async n=>{const{data:t,error:i}=await Ne.from(Oi).select("id, plan_date, recipe_id, meal_type, note, multiplier, total_weight, created_at").eq("user_id",n).order("plan_date",{ascending:!0}).order("created_at",{ascending:!0});if(i)throw i;return PT(t||[])},JT=async(n,t)=>{const i=qT(n,t);return i.length===0?null:(await tm(i),nm(n))},XT=async(n,t)=>{const i=Ni(n);if(!Object.keys(i).some(f=>(i[f]||[]).some(h=>!b0(h?.id))))return t;const o=new Set;Object.keys(t||{}).forEach(f=>{(t[f]||[]).forEach(h=>{o.add(rd(f,h))})});const u=[];Object.keys(i||{}).forEach(f=>{(i[f]||[]).forEach(h=>{if(b0(h?.id))return;const m=rd(f,h);o.has(m)||(u.push({user_id:n,plan_date:f,recipe_id:wl(h.recipeId),meal_type:h.type||"dinner",note:h.note||"",multiplier:br(h.multiplier,1),total_weight:br(h.totalWeight,null)}),o.add(m))})}),u.length>0&&await tm(u);const d=await nm(n);return ls(n,d),d},Kr={consumeWarnings:()=>{const n=[...Ti];return Ti.length=0,n},getAll:async n=>{if(!n)return{};try{const t=await nm(n);if(Object.keys(t).length===0){const i=Ni(n);if(Object.keys(i).length>0)try{const a=await JT(n,i);if(a)return ls(n,a),a}catch{return Ci(_i),ls(n,i),i}}try{const i=await XT(n,t);return ls(n,i),i}catch(i){console.warn("plannerService.getAll: failed to sync local fallback meals",i),Ci(_i);const a=Ni(n),o=VT(t,a);return ls(n,o),o}}catch(t){return console.warn("plannerService.getAll: falling back to localStorage",t),Ci(_i),Ni(n)}},cleanupInvalidPlans:async(n,t)=>{if(!n)return{};if(!Array.isArray(t)||t.length===0)return Kr.getAll(n);const i=await Kr.getAll(n),{nextPlans:a,invalidIds:o,hasChanges:u}=QT(i,t);if(!u)return i;try{if(o.length>0)for(let f=0;f<o.length;f+=200){const h=o.slice(f,f+200),{error:m}=await Ne.from(Oi).delete().eq("user_id",n).in("id",h);if(m)throw m}}catch(d){console.warn("plannerService.cleanupInvalidPlans: delete fallback to localStorage",d),Ci(_i)}return ls(n,a),a},addMeal:async(n,t,i,a,o={})=>{if(!n)return null;const u={id:IT(),recipeId:wl(i),type:a||"dinner",note:"",multiplier:br(o?.multiplier,1),totalWeight:br(o?.totalWeight,null)},d=Ni(n),f=GT(d,t,u);ls(n,f);try{const h={user_id:n,plan_date:t,recipe_id:wl(i),meal_type:a||"dinner",note:"",multiplier:br(o?.multiplier,1),total_weight:br(o?.totalWeight,null)};return await tm([h]),u}catch(h){return console.warn("plannerService.addMeal: insert fallback to localStorage",h),Ci(_i),u}},removeMeal:async(n,t,i)=>{if(!n)return;try{const{error:u}=await Ne.from(Oi).delete().eq("id",String(i)).eq("user_id",n);if(u)throw u}catch(u){console.warn("plannerService.removeMeal: delete fallback to localStorage",u),Ci(_i)}const a=Ni(n),o=KT(a,t,i);ls(n,o)},updateMeal:async(n,t,i,a)=>{if(!n)return;const o={};Object.prototype.hasOwnProperty.call(a,"recipeId")&&(o.recipe_id=wl(a.recipeId)),Object.prototype.hasOwnProperty.call(a,"type")&&(o.meal_type=a.type||"dinner",o.type=o.meal_type),Object.prototype.hasOwnProperty.call(a,"note")&&(o.note=a.note||""),Object.prototype.hasOwnProperty.call(a,"multiplier")&&(o.multiplier=br(a.multiplier,1)),Object.prototype.hasOwnProperty.call(a,"totalWeight")&&(o.total_weight=br(a.totalWeight,null));try{if(Object.keys(o).length>0){let{error:f}=await Ne.from(Oi).update(o).eq("id",String(i)).eq("user_id",n);if(f&&Rp(f,"type")){const{type:h,...m}=o;({error:f}=await Ne.from(Oi).update(m).eq("id",String(i)).eq("user_id",n))}if(f)throw f}}catch(f){console.warn("plannerService.updateMeal: update fallback to localStorage",f),Ci(_i)}const u=Ni(n),d=YT(u,t,i,a);ls(n,d)},clearPeriod:async(n,t,i)=>{if(!n)return;try{const{error:u}=await Ne.from(Oi).delete().eq("user_id",n).gte("plan_date",t).lte("plan_date",i);if(u)throw u}catch(u){console.warn("plannerService.clearPeriod: delete fallback to localStorage",u),Ci(_i)}const a=Ni(n),o=WT(a,t,i);ls(n,o)}},_l=n=>(n??"").toString().trim(),nw=n=>{const t=_l(n);if(!t)return"";const i=t.toLowerCase();return i===""?"g":i===""?"ml":i===""?"cc":i===""?"kg":i===""?"l":i},ZT=n=>{const t=_l(n);return t?["","","","","","","","PC","pc",""].includes(t):!1},Io=(n,t)=>{const i=parseFloat(n)||0,a=nw(t);return a==="kg"?{qty:i*1e3,unit:"g"}:a==="g"?{qty:i,unit:"g"}:a==="l"?{qty:i*1e3,unit:"ml"}:a==="cc"?{qty:i,unit:"ml"}:a==="ml"?{qty:i,unit:"ml"}:{qty:i,unit:_l(t)||""}},w0=(n,t,i,a)=>{const o=_l(i),u=parseFloat(t)||0;if(!a)return Io(u,o);const d=parseFloat(a.packetSize),f=nw(a.packetUnit);if(!Number.isFinite(d)||d<=0||!f)return Io(u,o);if(["g","kg","ml","cc","l"].includes(f)&&ZT(o)){const m=u*d;return Io(m,f)}return Io(u,o)},Op={async calculateShortages(n,t,i,a={}){if(!n?.id)throw new Error("User required");const o=a?.includeRecipeBreakdown===!0,u=await Kr.getAll(n.id),d=new Date(t),f=new Date(i);f.setHours(23,59,59,999);const h=[];if(Object.keys(u).forEach(E=>{const A=new Date(E);A>=d&&A<=f&&u[E].forEach(R=>{h.push(R)})}),h.length===0)return o?{items:[],recipeBreakdown:[]}:[];const[m,y,v,x,b]=await Promise.all([vn.fetchRecipes(n),zn.getAllConversions(),ir.fetchPriceList(n.id),Wn.getAll(n.id),nd.getAll(n.id)]),_=new Map;m.forEach(E=>_.set(E.id,E));const C=new Map;try{for(const[E,A]of(y||new Map).entries()){const R=Wt(E);R&&(C.has(R)||C.set(R,A))}}catch{}const S=new Map;try{for(const[E,A]of(b||new Map).entries()){const R=Wt(E);R&&(S.has(R)||S.set(R,A))}}catch{}const N=new Map;try{(x||[]).forEach(E=>{const A=Wt(E?.name);A&&(N.has(A)||N.set(A,E))})}catch{}const k={},D=new Map;h.forEach(E=>{const A=_.get(E.recipeId);if(!A)return;let R=null;if(o){const F=String(A.id);D.has(F)||D.set(F,{recipeId:A.id,recipeTitle:A.title||`Recipe ${A.id}`,itemMap:new Map}),R=D.get(F)}let M=1;if(E.totalWeight&&E.totalWeight>0){let F=0;(A.ingredients||[]).forEach(ne=>{const{qty:P,unit:B}=Io(ne.quantity,ne.unit);(B==="g"||B==="ml")&&(F+=P)}),F>0&&(M=E.totalWeight/F)}else E.multiplier&&E.multiplier>0&&(M=E.multiplier);[...A.ingredients||[]].forEach(F=>{if(!F.name)return;const ne=_l(F.name),P=Wt(ne),B=(P?C.get(P):null)||y?.get(ne)||null,T=(parseFloat(F.quantity)||0)*M,z=w0(ne,T,F.unit,B),H=z.qty||0,J=z.unit||"";if(k[ne]||(k[ne]={quantity:0,unit:J,count:0}),k[ne].quantity+=H,o&&R){const de=P||ne,q=R.itemMap.get(de);q?(q.required+=H,!q.unit&&J&&(q.unit=J)):R.itemMap.set(de,{ingredientKey:de,name:ne,required:H,unit:J})}})});const L=Object.keys(k).map(E=>{const A=k[E],R=Wt(E),M=(R?C.get(R):null)||y?.get(E)||null,V=R&&v?.get(R)||null,U=R&&N.get(R)||null,F=w0(E,U?.quantity??0,U?.unit??A.unit,M),ne=A.quantity||0,P=F.qty||0,B=A.unit||F.unit||"",T=P-ne,z=parseFloat(M?.packetSize),H=_l(M?.packetUnit),J=Number.isFinite(z)&&z>0&&!!H,de=J?z*.2:0,q=J?T<de:!1,Y=V?.unit?String(V.unit).trim():"",ae=R&&S.has(R)?String(S.get(R)).trim():"",xe=ae||""||Y||""||"",ve=(M?.lastPrice!==null&&M?.lastPrice!==void 0&&M?.lastPrice!==""?parseFloat(M.lastPrice):null)??(V?.price!==null&&V?.price!==void 0?parseFloat(V.price):null);let Ee=null,he=0,G=B;if(J){const Z=Math.max(0,de-T);Ee=Math.ceil(Z/z),q&&Ee<1&&(Ee=1),he=Ee,G=xe}else he=Math.max(0,ne-P),G=B;const ge=J?q:he>.01;return{name:E,required:ne,stock:P,remaining:T,unit:B,shouldShow:ge,toOrder:he,orderUnit:G,orderPacks:Ee,packSize:J?z:null,packUnit:J?H:null,packPrice:Number.isFinite(ve)?ve:null,vendor:V?.vendor||U?.vendor||""}}).filter(E=>E.shouldShow);if(!o)return L;const $=Array.from(D.values()).map(E=>({recipeId:E.recipeId,recipeTitle:E.recipeTitle,items:Array.from(E.itemMap.values()).filter(A=>Number(A.required||0)>1e-4)}));return{items:L,recipeBreakdown:$}}},Du=n=>String(n||"").replace(/\.json$/i,""),eA=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${i}/${a}/${o} ${u}:${d}`},tA=({onBack:n})=>{const{user:t}=fs(),[i,a]=ic(),[o,u]=_e.useState(!0),[d,f]=_e.useState(""),[h,m]=_e.useState([]),[y,v]=_e.useState(new Set),[x,b]=_e.useState({items:[]}),[_,C]=_e.useState([]),[S,N]=_e.useState(null),[k,D]=_e.useState("need_order"),[L,$]=_e.useState(!1),[E,A]=_e.useState(null),[R,M]=_e.useState(""),[V,U]=_e.useState(!1),F=_e.useCallback(async()=>{u(!0),f("");try{const Se=new Date,te=new Date(Se);te.setDate(Se.getDate()+7);const[Be,ut,Ct,Rt]=await Promise.all([us.listJsonFiles(),$s.listAppliedBaseNames(),$s.loadStock(),t?.id?Op.calculateShortages(t,Se.toISOString(),te.toISOString()):Promise.resolve([])]);m(Be||[]),v(ut||new Set),b(Ct||{items:[]}),C(Rt||[])}catch(Se){console.error(Se),f(Se?.message||String(Se))}finally{u(!1)}},[t]);_e.useEffect(()=>{F()},[F]);const ne=_e.useMemo(()=>{const Se=new Map;return(_||[]).forEach(te=>{const Be=`${te.vendor||""}@@${te.name}@@${te.unit||""}`;Se.set(Be,{...te,quantity:te.stock,isShortage:!0,reason:` (: ${te.required.toFixed(1)}${te.unit})`})}),(x?.items||[]).forEach(te=>{if((te.quantity||0)<=0){const Be=`${te.vendor||""}@@${te.name}@@${te.unit||""}`;Se.has(Be)||Se.set(Be,{...te,isShortage:!1})}}),Array.from(Se.values()).sort((te,Be)=>te.isShortage!==Be.isShortage?te.isShortage?-1:1:(te.vendor||"").localeCompare(Be.vendor||""))},[_,x]),P=async Se=>{const te=Du(Se);N(te),f("");try{const Be=await us.downloadJson(Se);(await $s.applyDeliverySet({baseName:te,parsed:Be}))?.status==="already_applied"&&f("PDF"),await F()}catch(Be){console.error(Be),f(Be?.message||String(Be))}finally{N(null)}},B=async()=>{N("all"),f("");try{const Se=await us.listJsonFiles(),te=await $s.listAppliedBaseNames();for(const Be of Se||[]){const ut=Be?.name;if(!ut)continue;const Ct=Du(ut);if(te.has(Ct))continue;const Rt=await us.downloadJson(ut);(await $s.applyDeliverySet({baseName:Ct,parsed:Rt}))?.status==="applied"&&te.add(Ct)}await F()}catch(Se){console.error(Se),f(Se?.message||String(Se))}finally{N(null)}},T=Se=>{A(Se),M(""),$(!0),f("")},z=Se=>{M(te=>{const ut=(parseFloat(te)||0)+Se;return String(Math.round(ut*1e3)/1e3)})},H=async()=>{if(!E)return;const Se=Number(R);if(!R||isNaN(Se)||Se<=0){f("");return}U(!0),f("");try{await $s.updateStockItem({name:E.name,unit:E.unit,vendor:E.vendor,delta:-Se}),await F(),$(!1),A(null)}catch(te){console.error(te),f(te?.message||String(te))}finally{U(!1)}},[J,de]=_e.useState(!1),[q,Y]=_e.useState(null),[ae,xe]=_e.useState(!1),[ve,Ee]=_e.useState(!1),[he,G]=_e.useState(!1),ge=Se=>{Y(Se),de(!0),f("")},Z=async()=>{if(q){xe(!0),f("");try{await $s.deleteStockItem({name:q.name,unit:q.unit,vendor:q.vendor}),await F(),de(!1),Y(null)}catch(Se){console.error(Se),f(": "+(Se.message||String(Se)))}finally{xe(!1)}}},[Ce,be]=_e.useState(!1),[We,Re]=_e.useState(null),[Pe,Ze]=_e.useState(!1),rt=Se=>{const te=Du(Se.name);Re({name:Se.name,baseName:te}),be(!0),f("")},qe=async()=>{if(We){Ze(!0),f("");try{await us.deleteDeliverySet(We.baseName),await $s.deleteAppliedMarker(We.baseName),await F(),be(!1),Re(null)}catch(Se){console.error(Se),f("PDF: "+(Se.message||String(Se)))}finally{Ze(!1)}}},Ae=async()=>{G(!0),f("");try{await $s.clearStock(),await F(),Ee(!1)}catch(Se){console.error(Se),f(": "+(Se.message||String(Se)))}finally{G(!1)}};return s.jsxs("div",{className:"incoming-stock",children:[s.jsxs("div",{className:"incoming-stock__header",children:[s.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),s.jsxs("div",{style:{display:"flex",gap:"10px"},children:[s.jsx(le,{variant:"secondary",onClick:()=>a({view:"incoming-deliveries"}),children:" PDF"}),s.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),d&&s.jsx(on,{className:"incoming-stock__error",children:d}),s.jsxs(on,{className:"incoming-stock__card",children:[s.jsxs("div",{className:"incoming-stock__card-head",children:[s.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),s.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[s.jsx(le,{variant:"secondary",onClick:F,disabled:o||!!S,children:""}),s.jsx(le,{variant:"primary",onClick:B,disabled:o||!!S,children:S==="all"?"":""}),s.jsx(le,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:()=>Ee(!0),disabled:o||!!S||!x?.items?.length,children:" "})]})]}),o?s.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):h.length===0?s.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):s.jsx("div",{className:"incoming-stock__file-list",children:h.map(Se=>{const te=Du(Se?.name),Be=y.has(te);return s.jsxs("div",{className:"incoming-stock__file-row",children:[s.jsxs("div",{className:"incoming-stock__file-info",children:[s.jsx("div",{style:{fontWeight:700},children:te}),s.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",eA(Se.updated_at||Se.created_at)]})]}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[Be?s.jsx("span",{className:"incoming-stock__badge",children:""}):s.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),s.jsx(le,{variant:Be?"secondary":"primary",size:"sm",onClick:()=>P(Se.name),disabled:!!S||Be,children:S===te?"":Be?"":""}),s.jsx(le,{variant:"ghost",size:"sm",style:{color:"#d32f2f",marginLeft:"4px"},onClick:()=>rt(Se),disabled:!!S,title:"PDF",children:""})]})]},Se.name)})}),!o&&s.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",s.jsx("strong",{children:y.size}),"  / PDF: ",s.jsx("strong",{children:h.length})," "]})]}),s.jsxs(on,{className:"incoming-stock__card",children:[s.jsx("div",{className:"incoming-stock__card-head",children:s.jsx("h3",{className:"incoming-stock__section-title",children:""})}),s.jsxs("div",{className:"incoming-stock__tabs",children:[s.jsxs("button",{className:`incoming-stock__tab-button ${k==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>D("need_order"),children:[" ",s.jsx("span",{className:"incoming-stock__tab-count",children:ne.length})]}),Array.from(new Set((x?.items||[]).map(Se=>Se.vendor||""))).sort().map(Se=>s.jsx("button",{className:`incoming-stock__tab-button ${k===Se?"incoming-stock__tab-button--active":""}`,onClick:()=>D(Se),children:Se},Se))]}),(()=>{let Se=[];if(k==="need_order")Se=ne;else{const te=k===""?"":k;Se=(x?.items||[]).filter(Be=>(Be.vendor||"")===te)}return Se.length===0?s.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:k==="need_order"?"0":""}):s.jsx("div",{className:"incoming-stock__table-wrap",children:s.jsxs("table",{className:"incoming-stock__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{style:{width:"45%"},children:"/"}),s.jsx("th",{style:{width:"25%",textAlign:"right"},children:""}),s.jsx("th",{style:{width:"10%"},children:""}),s.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),s.jsx("tbody",{children:Se.map(te=>s.jsxs("tr",{style:te.isShortage?{backgroundColor:"#fff5f5"}:{},children:[s.jsxs("td",{children:[s.jsxs("div",{style:{fontWeight:500},children:[te.name,te.isShortage&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#d32f2f",border:"1px solid #d32f2f",borderRadius:"4px",padding:"1px 4px",verticalAlign:"middle"},children:""})]}),te.reason&&s.jsxs("div",{style:{fontSize:"0.8rem",color:"#d32f2f",marginTop:"2px"},children:[te.reason,"  : ",te.toOrder,te.orderUnit]}),!te.reason&&k==="need_order"&&te.vendor&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:te.vendor})]}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(te.quantity||0)<=0||te.isShortage?"#d32f2f":"inherit"},children:Number.isFinite(te.quantity)?te.quantity:"-"}),s.jsx("td",{children:te.unit||"-"}),s.jsx("td",{style:{textAlign:"center"},children:s.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[s.jsx(le,{variant:"secondary",size:"sm",onClick:()=>T(te),children:"/"}),s.jsx(le,{variant:"ghost",size:"sm",style:{color:"#d32f2f"},onClick:()=>ge(te),children:""})]})})]},`${te.vendor}@@${te.name}@@${te.unit||""}`))})]})})})()]}),s.jsx(wn,{isOpen:L,onClose:()=>$(!1),title:"",children:s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),s.jsx("div",{style:{fontWeight:"bold"},children:E?.name})]}),s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),s.jsxs("div",{children:[E?.quantity," ",E?.unit]})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),s.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[s.jsx(zt,{type:"text",inputMode:"decimal",value:R,onChange:Se=>M(Se.target.value),readOnly:!0,placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px",textAlign:"center",backgroundColor:"#f9f9f9",cursor:"default"}}),s.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:E?.unit})]}),s.jsxs("div",{className:"incoming-stock__calc-grid",children:[s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(.001),children:"+0.001"}),s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(.01),children:"+0.01"}),s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(.1),children:"+0.1"}),s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(.5),children:"+0.5"}),s.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>z(1),children:"+1"}),s.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>M(""),children:""})]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>$(!1),disabled:V,children:""}),s.jsx(le,{variant:"primary",onClick:H,disabled:V||!R,children:V?"":""})]})]})}),s.jsx(wn,{isOpen:J,onClose:()=>de(!1),title:"",size:"small",children:s.jsxs("div",{style:{lineHeight:1.6},children:[s.jsxs("p",{style:{marginTop:0},children:["",q?.name,"",s.jsx("br",{}),s.jsx("span",{style:{fontSize:"0.85rem",color:"#666"},children:""})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>de(!1),disabled:ae,children:""}),s.jsx(le,{variant:"danger",onClick:Z,disabled:ae,children:ae?"":""})]})]})}),s.jsx(wn,{isOpen:Ce,onClose:()=>be(!1),title:"PDF",size:"small",children:s.jsxs("div",{style:{lineHeight:1.6},children:[s.jsxs("p",{style:{marginTop:0},children:["",We?.baseName,""]}),s.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["",s.jsx("strong",{children:""}),"",s.jsx("br",{}),""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>be(!1),disabled:Pe,children:""}),s.jsx(le,{variant:"danger",onClick:qe,disabled:Pe,children:Pe?"":""})]})]})}),s.jsx(wn,{isOpen:ve,onClose:()=>Ee(!1),title:"",size:"small",children:s.jsxs("div",{style:{lineHeight:1.6},children:[s.jsx("p",{style:{marginTop:0,fontWeight:"bold",color:"#d32f2f"},children:""}),s.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["PDF",s.jsx("br",{}),""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>Ee(!1),disabled:he,children:""}),s.jsx(le,{variant:"danger",onClick:Ae,disabled:he,children:he?"":""})]})]})}),s.jsx(wn,{isOpen:!!S,onClose:()=>{},title:"",size:"small",showCloseButton:!1,children:s.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[s.jsx("div",{className:"incoming-stock__spinner"}),s.jsx("p",{style:{margin:"0 0 8px",fontWeight:"bold"},children:"PDF..."}),s.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",margin:0},children:[S==="all"?"":"",s.jsx("br",{}),""]})]})})]})},rw=n=>{const{totalWeight:t,multiplier:i}=n||{};return t?`${t}g`:i&&i!==1?`x${i}`:""},nA=({recipe:n})=>{const{attributes:t,listeners:i,setNodeRef:a,transform:o,isDragging:u}=Gp({id:`recipe-${n.id}`,data:{recipe:n}}),d=u?{opacity:.35}:o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,position:"relative",zIndex:999}:void 0;return s.jsx("div",{ref:a,style:d,...i,...t,className:"draggable-recipe",children:n.title})},rA=({meal:n,dateStr:t,children:i})=>{const{attributes:a,listeners:o,setNodeRef:u,transform:d,isDragging:f}=Gp({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),h=f?{opacity:.35}:d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0,m=rw(n);return s.jsxs("div",{ref:u,style:h,...o,...a,className:"draggable-meal-wrapper",children:[i,m&&s.jsx("div",{style:{position:"absolute",bottom:"2px",right:"4px",fontSize:"0.75rem",fontWeight:"bold",color:"#666",backgroundColor:"rgba(255,255,255,0.8)",padding:"0 2px",borderRadius:"2px",pointerEvents:"none"},children:m})]})},sA=({dateStr:n,dayNum:t,isToday:i,isOutside:a,children:o})=>{const{setNodeRef:u,isOver:d}=uc({id:`date-${n}`,data:{dateStr:n}});return s.jsxs("div",{ref:u,className:`calendar-cell ${i?"today":""} ${a?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[s.jsx("div",{className:"day-number",children:t}),o]})},dl=n=>`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,iA=({onBack:n,onSelectRecipe:t,onNavigateToOrderList:i})=>{const{user:a}=fs(),o=Li(),u=w.useRef(o),[d,f]=w.useState([]),[h,m]=w.useState({}),[y,v]=w.useState(new Date),[x,b]=w.useState(""),[_,C]=w.useState(!1),[S,N]=w.useState(null),[k,D]=w.useState(!1),[L,$]=w.useState(null),[E,A]=w.useState(1),[R,M]=w.useState(""),[V,U]=w.useState(null),[F,ne]=w.useState(!1),[P,B]=w.useState(dl(new Date)),[T,z]=w.useState(dl(new Date)),H=ba(ur(Al,{activationConstraint:{distance:6}}),ur(Rl,{activationConstraint:{delay:70,tolerance:8}}));w.useEffect(()=>{u.current=o},[o]);const J=w.useCallback(()=>{const Re=Kr.consumeWarnings?.()||[];Re.length!==0&&[...new Set(Re)].forEach(Pe=>{u.current.warning(Pe)})},[]),de=w.useCallback(async()=>{if(!a){f([]),m({});return}let Re=[];try{Re=await vn.fetchRecipes(a)}catch(Pe){console.error("Planner: failed to fetch recipes",Pe),u.current.error(""),Re=[]}if(f(Re),a?.id)try{let Pe;if(Array.isArray(Re)&&Re.length>0){const Ze=Re.map(rt=>rt.id);Pe=await Kr.cleanupInvalidPlans(a.id,Ze)}else Pe=await Kr.getAll(a.id);m(Pe)}finally{J()}},[J,a]);w.useEffect(()=>{const Re=setTimeout(()=>{de()},0);return()=>clearTimeout(Re)},[de]);const q=w.useCallback(Re=>{const Pe=Re?.active;if(!Pe?.id){U(null);return}const Ze=String(Pe.id);if(Ze.startsWith("recipe-")){const rt=Pe.data.current?.recipe;U({kind:"recipe",title:rt?.title||"",qtyStr:""});return}if(Ze.startsWith("meal-")){const rt=Pe.data.current?.meal,qe=d.find(Ae=>Ae.id===rt?.recipeId);U({kind:"meal",title:qe?.title||"Unknown",qtyStr:rw(rt)});return}U(null)},[d]),Y=w.useCallback(()=>{U(null)},[]),ae=async Re=>{const{active:Pe,over:Ze}=Re;try{if(!Ze)return;if(Ze.id.startsWith("date-")){const rt=Ze.data.current.dateStr;if(Pe.id.startsWith("recipe-")){const qe=Pe.data.current.recipe;$({type:"new",recipe:qe,targetDateStr:rt}),A(1),M(""),D(!0)}else if(Pe.id.startsWith("meal-")){const{meal:qe,dateStr:Ae}=Pe.data.current;if(Ae===rt)return;const Se={multiplier:qe.multiplier,totalWeight:qe.totalWeight};await Kr.addMeal(a.id,rt,qe.recipeId,qe.type||"dinner",Se),await Kr.removeMeal(a.id,Ae,qe.id),de()}}}finally{U(null)}},xe=async()=>{if(!L)return;const{type:Re,recipe:Pe,targetDateStr:Ze}=L;if(Re==="new"){const rt={};if(Pe.type==="bread"){const qe=parseFloat(R);rt.totalWeight=Number.isFinite(qe)?qe:null,rt.multiplier=1}else{const qe=parseFloat(E);rt.multiplier=Number.isFinite(qe)?qe:1,rt.totalWeight=null}await Kr.addMeal(a.id,Ze,Pe.id,"dinner",rt)}D(!1),$(null),de()},ve=()=>{D(!1),$(null)},Ee=async(Re,Pe,Ze)=>{Ze&&Ze.stopPropagation(),N({dateStr:Re,mealId:Pe}),C(!0)},he=async()=>{if(!S)return;const{dateStr:Re,mealId:Pe}=S;C(!1),N(null);try{await Kr.removeMeal(a.id,Re,Pe),await de(),o.success("")}catch(Ze){o.error(""),console.error("Delete meal error:",Ze)}},G=()=>{C(!1),N(null)},ge=()=>{B(dl(new Date)),z(dl(new Date)),ne(!0)},Z=async()=>{if(a?.id)try{await Kr.clearPeriod(a.id,P,T),await de(),ne(!1),o.success(`${P}${T}`)}catch(Re){console.error(Re),o.error("")}},Ce=()=>{const Re=y.getFullYear(),Pe=y.getMonth(),Ze=new Date(Re,Pe,1),rt=new Date(Re,Pe+1,0),qe=[],Ae=Ze.getDay();for(let te=Ae-1;te>=0;te--){const Be=new Date(Re,Pe,-te);qe.push({date:Be,isOutside:!0})}for(let te=1;te<=rt.getDate();te++){const Be=new Date(Re,Pe,te);qe.push({date:Be,isOutside:!1})}const Se=42-qe.length;for(let te=1;te<=Se;te++){const Be=new Date(Re,Pe+1,te);qe.push({date:Be,isOutside:!0})}return qe},be=d.filter(Re=>Re.title.toLowerCase().includes(x.toLowerCase())),We=Re=>{v(new Date(y.getFullYear(),y.getMonth()+Re,1))};return s.jsxs("div",{className:`planner-container fade-in ${V?"dragging":""}`,children:[_&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(on,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[s.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:""})," "]}),s.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",s.jsx("br",{}),s.jsx("strong",{children:""})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(le,{variant:"ghost",onClick:G,children:""}),s.jsx(le,{variant:"danger",onClick:he,children:""})]})]})}),F&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(on,{style:{width:"90%",maxWidth:"500px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[s.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:""})," "]}),s.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",s.jsx("br",{}),s.jsx("strong",{children:""})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1.5rem"},children:[s.jsxs("div",{style:{flex:1},children:[s.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),s.jsx(zt,{type:"date",value:P,onChange:Re=>B(Re.target.value)})]}),s.jsx("span",{style:{paddingTop:"24px"},children:""}),s.jsxs("div",{style:{flex:1},children:[s.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),s.jsx(zt,{type:"date",value:T,onChange:Re=>z(Re.target.value)})]})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[s.jsx(le,{variant:"ghost",onClick:()=>ne(!1),children:""}),s.jsx(le,{variant:"danger",onClick:Z,children:""})]})]})}),k&&L&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(on,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",backgroundColor:"white"},children:[s.jsx("h3",{style:{marginTop:0},children:L.recipe.type==="bread"?"":""}),s.jsx("p",{style:{margin:"1rem 0",color:"#666"},children:L.recipe.title}),s.jsx("div",{style:{marginBottom:"1.5rem"},children:L.recipe.type==="bread"?s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:" (g)"}),s.jsx(zt,{type:"number",value:R,onChange:Re=>M(Re.target.value),placeholder:": 1200",autoFocus:!0}),s.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:" "})]}):s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:""}),s.jsx(zt,{type:"number",step:"0.1",value:E,onChange:Re=>A(Re.target.value),placeholder:": 1, 1.5, 2",autoFocus:!0}),s.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:"  (1 = )"})]})}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[s.jsx(le,{variant:"ghost",onClick:ve,children:""}),s.jsx(le,{variant:"primary",onClick:xe,children:""})]})]})}),s.jsxs("div",{className:"container-header",children:[s.jsx("h2",{className:"section-title",children:" "}),s.jsxs("div",{className:"header-actions",children:[s.jsx(le,{variant:"secondary",onClick:i,style:{marginRight:"8px"},children:" "}),s.jsx(le,{variant:"danger",onClick:ge,style:{marginRight:"8px"},children:" "}),s.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),s.jsxs(Di,{sensors:H,onDragStart:q,onDragCancel:Y,onDragEnd:ae,autoScroll:!0,children:[s.jsxs("div",{className:"planner-layout",children:[s.jsxs("div",{className:"recipe-sidebar",children:[s.jsx("div",{className:"sidebar-search",children:s.jsx(zt,{placeholder:"...",value:x,onChange:Re=>b(Re.target.value)})}),s.jsx("div",{className:"draggable-list",children:be.map(Re=>s.jsx(nA,{recipe:Re},Re.id))})]}),s.jsxs("div",{className:"planner-calendar",children:[s.jsxs("div",{className:"calendar-header",children:[s.jsx(le,{variant:"ghost",onClick:()=>We(-1),children:" "}),s.jsxs("h3",{style:{margin:0},children:[y.getFullYear()," ",y.getMonth()+1,""]}),s.jsx(le,{variant:"ghost",onClick:()=>We(1),children:" "})]}),s.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(Re=>s.jsx("div",{className:"calendar-day-header",children:Re},Re)),Ce().map((Re,Pe)=>{const Ze=dl(Re.date),rt=h[Ze]||[],qe=Ze===dl(new Date);return s.jsx(sA,{dateStr:Ze,dayNum:Re.date.getDate(),isToday:qe,isOutside:Re.isOutside,children:rt.map(Ae=>{const Se=d.find(te=>te.id===Ae.recipeId);return s.jsx(rA,{meal:Ae,dateStr:Ze,children:s.jsxs("div",{className:"planned-meal",title:Se?.title,onClick:()=>Se&&t&&t(Se),children:[s.jsx("span",{children:Se?.title||"Unknown"}),s.jsx("span",{className:"delete-meal-btn",onPointerDown:te=>{te.stopPropagation()},onClick:te=>Ee(Ze,Ae.id,te),children:""})]})},Ae.id)})},Pe)})]})]})]}),s.jsx(Yp,{children:V?s.jsxs("div",{className:`drag-overlay-card ${V.kind==="meal"?"meal":""}`,children:[s.jsx("span",{className:"drag-overlay-title",children:V.title}),V.qtyStr&&s.jsx("span",{className:"drag-overlay-qty",children:V.qtyStr})]}):null})]})]})},aA=({onBack:n,onNavigateToPlanner:t})=>{const{user:i}=fs(),a=Li(),[o,u]=w.useState(new Date().toISOString().slice(0,10)),[d,f]=w.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[h,m]=w.useState([]),[y,v]=w.useState([]),[x,b]=w.useState(!1),[_,C]=w.useState(!1),[S,N]=w.useState(!1),[k,D]=w.useState(!1);_e.useEffect(()=>{window.plannerService=Kr,window.shortageService=Op,window.recipeService=vn},[]);const L=_e.useMemo(()=>{const U=new Set;return(h||[]).forEach(F=>{const ne=Wt(F?.name);U.add(ne||F?.name||"")}),U},[h]),$=_e.useMemo(()=>{const U=new Map;return(h||[]).forEach(F=>{const ne=Wt(F?.name)||F?.name||"";ne&&(U.has(ne)||U.set(ne,F))}),U},[h]),E=async()=>{b(!0);try{if(!i?.id){a.error(""),b(!1);return}const U=await Op.calculateShortages(i,o,d,{includeRecipeBreakdown:!0}),F=Array.isArray(U)?U:U?.items||[],ne=Array.isArray(U)?[]:U?.recipeBreakdown||[];F.length,m(F),v(ne),C(!0)}catch(U){console.error(U),a.error(": "+(U.message||String(U)))}finally{b(!1)}},A=()=>{N(!0)},R=()=>{D(!0)},M=()=>h.map(U=>{if(Number.isFinite(U.orderPacks)&&U.orderPacks!==null){const F=U.packSize&&U.packUnit?`1${U.orderUnit}=${U.packSize}${U.packUnit}`:"";return`${U.name}: ${U.orderPacks}${U.orderUnit}${F}`}return`${U.name}: ${Number(U.toOrder||0).toFixed(1)}${U.unit}`}).join(`
`),V=async()=>{const U=document.getElementById("copy-textarea");if(U){U.select();try{await navigator.clipboard.writeText(U.value),a.success("")}catch{document.execCommand("copy"),a.success("")}}};return s.jsxs("div",{className:"order-list-container fade-in",children:[s.jsxs("div",{className:"container-header",children:[s.jsx("h2",{className:"section-title",children:" "}),s.jsxs("div",{className:"header-actions",children:[s.jsx(le,{variant:"secondary",onClick:t,style:{marginRight:"8px"},children:" "}),s.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),s.jsx("div",{className:"filter-card",children:s.jsxs("div",{className:"date-range-inputs",children:[s.jsxs("div",{children:[s.jsx("label",{children:""}),s.jsx("input",{type:"date",value:o,onChange:U=>u(U.target.value)})]}),s.jsx("span",{children:""}),s.jsxs("div",{children:[s.jsx("label",{children:""}),s.jsx("input",{type:"date",value:d,onChange:U=>f(U.target.value)})]}),s.jsx(le,{variant:"primary",onClick:E,disabled:x,children:x?"...":""})]})}),_&&s.jsxs("div",{className:"order-results",children:[s.jsxs("div",{className:"results-header",children:[s.jsxs("h3",{children:[" (",h.length,")"]}),s.jsxs("div",{className:"result-actions",children:[s.jsx(le,{variant:"secondary",onClick:A,children:" "}),s.jsx(le,{variant:"secondary",onClick:R,children:" "})]})]}),s.jsxs("table",{className:"order-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""})]})}),s.jsx("tbody",{children:h.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):h.map((U,F)=>s.jsxs("tr",{children:[s.jsx("td",{children:U.name}),s.jsxs("td",{style:{textAlign:"right"},children:[U.required.toFixed(1)," ",U.unit]}),s.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,U.remaining??0).toFixed(1)," ",U.unit]}),s.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(U.orderPacks)&&U.orderPacks!==null?s.jsxs(s.Fragment,{children:[U.orderPacks,U.orderUnit,U.packSize&&U.packUnit&&s.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",U.orderUnit," = ",Number(U.packSize).toLocaleString(),U.packUnit,U.packPrice?` / ${Math.round(U.packPrice).toLocaleString()}`:""]})]}):s.jsxs(s.Fragment,{children:[U.toOrder.toFixed(1)," ",s.jsx("span",{style:{fontSize:"0.8em"},children:U.unit})]})})]},F))})]})]}),s.jsx(wn,{isOpen:S,onClose:()=>N(!1),title:" ",size:"medium",children:s.jsxs("div",{className:"copy-modal-content",children:[s.jsx("p",{className:"copy-instructions",children:""}),s.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:M(),onClick:U=>U.target.select()}),s.jsxs("div",{className:"modal-actions",children:[s.jsx(le,{variant:"primary",onClick:V,children:" "}),s.jsx(le,{variant:"ghost",onClick:()=>N(!1),children:""})]})]})}),s.jsx(wn,{isOpen:k,onClose:()=>D(!1),title:" ",size:"large",children:s.jsxs("div",{className:"print-preview-content",children:[s.jsxs("div",{className:"print-preview-header",children:[s.jsx("h3",{children:""}),s.jsxs("p",{className:"print-period",children:[": ",o,"  ",d]})]}),y.length>0&&s.jsxs("div",{className:"recipe-breakdown-print",children:[s.jsx("h4",{children:" "}),y.map((U,F)=>{const ne=(U.items||[]).filter(P=>{const B=P.ingredientKey||Wt(P.name)||P.name;return L.has(B)});return ne.length===0?null:s.jsxs("section",{className:"recipe-breakdown-section",children:[s.jsx("div",{className:"recipe-breakdown-section-title",children:U.recipeTitle}),s.jsxs("table",{className:"recipe-breakdown-table",children:[s.jsxs("colgroup",{children:[s.jsx("col",{className:"rb-col-name"}),s.jsx("col",{className:"rb-col-required"}),s.jsx("col",{className:"rb-col-stock"}),s.jsx("col",{className:"rb-col-spec"})]}),s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""}),s.jsx("th",{style:{textAlign:"right"},children:""})]})}),s.jsx("tbody",{children:ne.map((P,B)=>{const T=P.ingredientKey||Wt(P.name)||P.name,z=$.get(T),H=z?.unit||P.unit||"",J=Math.max(0,Number(z?.remaining??0)),de=(z?.vendor||"").trim(),q=z?.packSize&&z?.packUnit?`1${z.orderUnit||""} = ${Number(z.packSize).toLocaleString()}${z.packUnit}${z.packPrice?` / ${Math.round(z.packPrice).toLocaleString()}`:""}`:"-";return s.jsxs("tr",{children:[s.jsxs("td",{children:[P.name,de&&s.jsxs("span",{className:"recipe-material-vendor",children:["",de]})]}),s.jsxs("td",{style:{textAlign:"right"},children:[Number(P.required||0).toFixed(1)," ",P.unit||""]}),s.jsxs("td",{style:{textAlign:"right"},children:[J.toFixed(1)," ",H]}),s.jsx("td",{style:{textAlign:"right",color:"#666",fontWeight:"normal"},children:q})]},`${P.ingredientKey||P.name||B}-${B}`)})})]})]},`${U.recipeId||U.recipeTitle||F}`)})]}),y.length===0&&s.jsx("p",{style:{margin:0,fontSize:"0.95rem",color:"#374151"},children:""}),s.jsxs("div",{className:"modal-actions",children:[s.jsx(le,{variant:"primary",onClick:()=>window.print(),children:" "}),s.jsx(le,{variant:"ghost",onClick:()=>D(!1),children:""})]})]})})]})};function lA(){const[n,t]=w.useState([]),[i,a]=w.useState(!0),[o,u]=w.useState({apiName:"all",status:"all",dateFrom:"",dateTo:""}),[d,f]=w.useState({totalCalls:0,successRate:0,totalCost:0,byApi:{}});w.useEffect(()=>{h()},[o]);async function h(){a(!0);try{let b=Ne.from("api_usage_logs").select("*").order("created_at",{ascending:!1}).limit(500);o.apiName!=="all"&&(b=b.eq("api_name",o.apiName)),o.status!=="all"&&(b=b.eq("status",o.status)),o.dateFrom&&(b=b.gte("created_at",o.dateFrom)),o.dateTo&&(b=b.lte("created_at",o.dateTo+"T23:59:59"));const{data:_,error:C}=await b;if(C)throw C;t(_||[]),m(_||[])}catch(b){console.error(":",b),alert("")}finally{a(!1)}}function m(b){const _=b.length,C=b.filter(k=>k.status==="success").length,S=b.reduce((k,D)=>k+(D.estimated_cost_jpy||0),0),N=b.reduce((k,D)=>(k[D.api_name]||(k[D.api_name]={count:0,cost:0}),k[D.api_name].count++,k[D.api_name].cost+=D.estimated_cost_jpy||0,k),{});f({totalCalls:_,successRate:_>0?(C/_*100).toFixed(1):0,totalCost:S.toFixed(2),byApi:N})}function y(b){return new Date(b).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function v(b){return{success:" ",error:" ",rate_limited:" "}[b]||b}async function x(){const b=[["","API","","","ID","","(ms)","()",""].join(",")];n.forEach(k=>{b.push([y(k.created_at),k.api_name,k.endpoint,k.model_name||"",k.user_id||"",k.status,k.duration_ms||"",k.estimated_cost_jpy||"",(k.error_message||"").replace(/,/g,"")].join(","))});const _=b.join(`
`),C=new Blob(["\uFEFF"+_],{type:"text/csv;charset=utf-8;"}),S=URL.createObjectURL(C),N=document.createElement("a");N.href=S,N.download=`api_usage_logs_${new Date().toISOString().split("T")[0]}.csv`,N.click()}return s.jsxs("div",{className:"api-usage-logs",children:[s.jsxs("div",{className:"logs-header",children:[s.jsx("h1",{children:" API"}),s.jsx("button",{onClick:x,className:"export-btn",children:" CSV"})]}),s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:""}),s.jsx("div",{className:"stat-value",children:d.totalCalls.toLocaleString()})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:""}),s.jsxs("div",{className:"stat-value",children:[d.successRate,"%"]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-label",children:""}),s.jsxs("div",{className:"stat-value",children:["",parseFloat(d.totalCost).toLocaleString()]})]})]}),s.jsxs("div",{className:"api-stats",children:[s.jsx("h3",{children:"API"}),s.jsx("div",{className:"api-stats-grid",children:Object.entries(d.byApi).map(([b,_])=>s.jsxs("div",{className:"api-stat-item",children:[s.jsx("div",{className:"api-stat-name",children:b}),s.jsxs("div",{className:"api-stat-details",children:[s.jsxs("span",{children:[_.count,""]}),s.jsxs("span",{children:["",_.cost.toFixed(2)]})]})]},b))})]}),s.jsxs("div",{className:"filters",children:[s.jsxs("select",{value:o.apiName,onChange:b=>u({...o,apiName:b.target.value}),children:[s.jsx("option",{value:"all",children:"API"}),s.jsx("option",{value:"gemini",children:"Gemini"}),s.jsx("option",{value:"openai",children:"OpenAI"}),s.jsx("option",{value:"deepl",children:"DeepL"}),s.jsx("option",{value:"azure",children:"Azure"}),s.jsx("option",{value:"groq",children:"Groq"}),s.jsx("option",{value:"avalon",children:"Avalon"})]}),s.jsxs("select",{value:o.status,onChange:b=>u({...o,status:b.target.value}),children:[s.jsx("option",{value:"all",children:""}),s.jsx("option",{value:"success",children:""}),s.jsx("option",{value:"error",children:""}),s.jsx("option",{value:"rate_limited",children:""})]}),s.jsx("input",{type:"date",value:o.dateFrom,onChange:b=>u({...o,dateFrom:b.target.value}),placeholder:""}),s.jsx("input",{type:"date",value:o.dateTo,onChange:b=>u({...o,dateTo:b.target.value}),placeholder:""}),s.jsx("button",{onClick:h,className:"refresh-btn",children:" "})]}),i?s.jsx("div",{className:"loading",children:"..."}):s.jsxs("div",{className:"logs-table-container",children:[s.jsxs("table",{className:"logs-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:""}),s.jsx("th",{children:"API"}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""}),s.jsx("th",{children:""})]})}),s.jsx("tbody",{children:n.map(b=>s.jsxs("tr",{className:`status-${b.status}`,children:[s.jsx("td",{children:y(b.created_at)}),s.jsx("td",{children:s.jsx("span",{className:`api-badge api-${b.api_name}`,children:b.api_name})}),s.jsx("td",{children:b.endpoint}),s.jsx("td",{children:s.jsx("code",{children:b.model_name||"-"})}),s.jsx("td",{children:b.user_email||b.user_id?.substring(0,8)||"-"}),s.jsx("td",{children:v(b.status)}),s.jsx("td",{children:b.duration_ms?`${b.duration_ms}ms`:"-"}),s.jsx("td",{children:b.input_tokens||b.output_tokens?s.jsxs("span",{className:"tokens",children:[b.input_tokens?`${b.input_tokens}`:"",b.output_tokens?` ${b.output_tokens}`:""]}):"-"}),s.jsx("td",{children:b.estimated_cost_jpy?s.jsxs("span",{className:"cost",children:["",b.estimated_cost_jpy]}):"-"}),s.jsx("td",{className:"error-cell",children:b.error_message?s.jsxs("span",{className:"error-msg",title:b.error_message,children:[b.error_message.substring(0,50),"..."]}):"-"})]},b.id))})]}),n.length===0&&s.jsx("div",{className:"no-logs",children:""})]})]})}const hl=async(n,t,i)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${i||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},S0=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},oA=({children:n})=>{const[t,i]=w.useState(null),[a,o]=w.useState(!0),[u,d]=w.useState(!1),f=w.useCallback(async S=>{if(!S){i(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const N=S.id,k=S.email||"";let D=null;try{const ne=localStorage.getItem("auth_user_cache");if(ne){const P=JSON.parse(ne);P&&P.id===N&&(D=P,i(P))}}catch(ne){console.warn("[Auth] Failed to load cache",ne)}let L=null,$=0;const E=3;for(;$<E;)try{const[ne,P]=await Promise.all([hl(Ne.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",N).single().then(z=>({data:z,error:null})).catch(z=>({data:null,error:z})),2500,"profiles.select(with_email)").catch(z=>({data:null,error:z})),hl(Ne.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",N).single().then(z=>({data:z,error:null})).catch(z=>({data:null,error:z})),2500,"profiles.select").catch(z=>({data:null,error:z}))]);let B=null,T=null;if(ne?.data?.data?(B=ne.data.data,T=null):P?.data?.data?(B=P.data.data,T=null):T=ne?.error??P?.error??new Error("Profile fetch failed"),T)if(T.code==="PGRST116"){const z=S.user_metadata&&S.user_metadata.display_id?String(S.user_metadata.display_id):S0(k)||N.slice(0,8);let H=null,J=null;const de=await hl(Ne.from("profiles").insert([{id:N,display_id:z,email:k||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),8e3,"profiles.insert(with_email)");if(H=de?.data??null,J=de?.error??null,J&&String(J.message||"").toLowerCase().includes("email")){const q=await hl(Ne.from("profiles").insert([{id:N,display_id:z,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),8e3,"profiles.insert");H=q?.data??null,J=q?.error??null}if(J)throw J;L=H}else throw T;else L=B;if(L&&Object.prototype.hasOwnProperty.call(L,"email")&&k&&!L.email)try{await Ne.from("profiles").update({email:k}).eq("id",N)}catch(z){console.warn("Failed to backfill profile email",z)}break}catch(ne){console.error(`Failed to load/create profile (Attempt ${$+1}/${E}):`,ne),$++,$<E&&await new Promise(P=>setTimeout(P,500*$))}const A=(S?.user_metadata?.display_id||"").toString().trim(),R=L?.display_id||A||""||D?.displayId||""||S0(k)||N.slice(0,8),M=L?.role||S?.app_metadata?.role||D?.role||"user",V=String(M).trim().toLowerCase(),U=L?.show_master_recipes===!0||L?.show_master_recipes==null&&D?.showMasterRecipes===!0,F={id:N,email:k,displayId:R,role:V,showMasterRecipes:U};i(F);try{localStorage.setItem("auth_user_cache",JSON.stringify(F))}catch(ne){console.warn("[Auth] Failed to save cache",ne)}},[]);w.useEffect(()=>{let S=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:N}=Ne.auth.onAuthStateChange(async(D,L)=>{D==="PASSWORD_RECOVERY"&&d(!0);try{await f(L?.user||null)}catch($){console.error("Auth state change handler failed:",$)}});return S=N?.subscription,(async()=>{try{const{data:D}=await hl(Ne.auth.getSession(),5e3,"auth.getSession");await f(D?.session?.user||null)}catch(D){console.error("Auth init failed:",D)}finally{o(!1)}})(),()=>{try{S?.unsubscribe?.()}catch{}}},[f]);const h=w.useCallback(async(S,N)=>{const{error:k}=await Ne.auth.signInWithPassword({email:S,password:N});if(k)throw console.error("Login error:",k),new Error("")},[]),m=w.useCallback(async(S,N,k)=>{const{data:D,error:L}=await Ne.auth.signUp({email:S,password:N,options:{data:{display_id:k}}});if(L)throw console.error("SignUp error:",L),new Error(L.message||"");const $=D?.user;if($?.id){let E=null;E=(await Ne.from("profiles").insert([{id:$.id,display_id:k,email:S||null,role:"user",show_master_recipes:!1}]))?.error??null,E&&String(E.message||"").toLowerCase().includes("email")&&(E=(await Ne.from("profiles").insert([{id:$.id,display_id:k,role:"user",show_master_recipes:!1}]))?.error??null),E&&E.code!=="23505"&&console.error("Profile create error:",E)}return{needsEmailConfirmation:!D?.session}},[]),y=w.useCallback(async()=>{i(null),d(!1);try{localStorage.removeItem("auth_user_cache")}catch{}try{const{error:S}=await hl(Ne.auth.signOut({scope:"local"}),3e3,"auth.signOut(local)");S&&console.warn("Logout (local scope) returned error:",S)}catch(S){console.warn("Logout (local scope) failed/timed out:",S)}},[]),v=w.useCallback(S=>{!S||typeof S!="object"||i(N=>N&&{...N,...S})},[]),x=w.useCallback(async S=>{const{error:N}=await Ne.auth.resetPasswordForEmail(S,{redirectTo:window.location.origin});if(N)throw console.error("Password reset email error:",N),new Error("");return!0},[]),b=w.useCallback(async S=>{const{error:N}=await Ne.auth.updateUser({password:S});if(N)throw console.error("Update password error:",N),new Error("");return!0},[]),_=w.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),C=w.useMemo(()=>({user:t,loading:a,login:h,register:m,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:b,finishPasswordRecovery:_}),[t,a,h,m,y,v,x,u,b,_]);return s.jsx(Bb.Provider,{value:C,children:n})},cA=({id:n,message:t,type:i="info",onClose:a})=>{w.useEffect(()=>{const u=setTimeout(()=>{a(n)},3e3);return()=>clearTimeout(u)},[n,a]);const o=()=>{switch(i){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return s.jsxs("div",{className:`toast toast-${i}`,children:[s.jsx("div",{className:"toast-icon",children:o()}),s.jsx("div",{className:"toast-message",children:t}),s.jsx("button",{className:"toast-close",onClick:()=>a(n),"aria-label":"",children:""})]})},uA=({toasts:n,onRemove:t})=>n.length===0?null:s.jsx("div",{className:"toast-container",children:n.map(i=>s.jsx(cA,{id:i.id,message:i.message,type:i.type,onClose:t},i.id))}),dA=({children:n})=>{const[t,i]=w.useState([]),a=w.useCallback((d,f="info")=>{const h=Date.now()+Math.random();i(m=>[...m,{id:h,message:d,type:f}].slice(-5))},[]),o=w.useCallback(d=>{i(f=>f.filter(h=>h.id!==d))},[]),u={showToast:a,success:d=>a(d,"success"),error:d=>a(d,"error"),warning:d=>a(d,"warning"),info:d=>a(d,"info")};return s.jsxs($b.Provider,{value:u,children:[n,s.jsx(uA,{toasts:t,onRemove:o})]})},hA=()=>{const[n,t]=w.useState(!0),[i,a]=w.useState(!1),[o,u]=w.useState(""),[d,f]=w.useState(""),[h,m]=w.useState(""),[y,v]=w.useState(""),[x,b]=w.useState(""),[_,C]=w.useState(!1),[S,N]=w.useState(!1);_e.useEffect(()=>{const R=localStorage.getItem("savedEmail"),M=localStorage.getItem("savedPassword");R&&(u(R),M&&f(M),N(!0))},[]);const{login:k,register:D,sendPasswordResetEmail:L}=fs(),$=async R=>{R.preventDefault(),v(""),b(""),C(!0);try{await k(o.trim(),d),S?(localStorage.setItem("savedEmail",o.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(M){v(M.message||"")}finally{C(!1)}},E=async R=>{R.preventDefault(),v(""),b(""),C(!0);try{if(!h.trim()){v("ID: yoshito");return}(await D(o.trim(),d,h.trim()))?.needsEmailConfirmation?b(""):b(""),t(!0),f("")}catch(M){v(M.message||"")}finally{C(!1)}},A=async R=>{R.preventDefault(),v(""),b(""),C(!0);try{await L(o.trim()),b(""),a(!1)}catch(M){v(M.message||"")}finally{C(!1)}};return s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:s.jsxs(on,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[s.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[s.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",s.jsx("br",{}),"Management"]}),s.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:i?"":n?"":""})]}),y&&s.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&s.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),s.jsxs("form",{onSubmit:i?A:n?$:E,children:[s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),s.jsx("input",{type:"email",value:o,onChange:R=>u(R.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!i&&s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),s.jsx("input",{type:"password",value:d,onChange:R=>f(R.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!i&&!n&&s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",s.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),s.jsx("input",{type:"text",value:h,onChange:R=>m(R.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),s.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!i&&s.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[s.jsx("input",{type:"checkbox",id:"rememberMe",checked:S,onChange:R=>N(R.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),s.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),s.jsx(le,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:_,children:i?"":n?"":""})]}),s.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i?s.jsx("button",{type:"button",onClick:()=>{a(!1),v(""),b("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):s.jsx("button",{type:"button",onClick:()=>{a(!0),v(""),b("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!i&&s.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),b("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},fA=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:i}=fs(),[a,o]=_e.useState(""),[u,d]=_e.useState(""),[f,h]=_e.useState(""),[m,y]=_e.useState(""),[v,x]=_e.useState(!1),b=async _=>{if(_.preventDefault(),h(""),y(""),!a||a.length<8){h("8");return}if(a!==u){h("");return}x(!0);try{await n(a),y(""),t()}catch(C){console.error(C),h(C.message||"")}finally{x(!1)}};return s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:s.jsxs(on,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[s.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),s.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),f&&s.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:f}),m&&s.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),s.jsxs("form",{onSubmit:b,children:[s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),s.jsx("input",{type:"password",value:a,onChange:_=>o(_.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),s.jsx("input",{type:"password",value:u,onChange:_=>d(_.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),s.jsx(le,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),s.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),s.jsx(le,{variant:"ghost",onClick:i,style:{flex:1},children:""})]})]})})},op=({label:n,subLabel:t,variant:i="screen",showLogo:a=!0})=>s.jsxs("div",{className:i==="screen"?"loading-screen":"loading-inline",children:[a&&s.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),s.jsxs("div",{className:"loading-text",children:[n,s.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[s.jsx("span",{children:"."}),s.jsx("span",{children:"."}),s.jsx("span",{children:"."})]})]}),s.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&s.jsx("div",{className:"loading-subtext",children:t})]}),pA=24,mA=120,gA=64,yA=180,Mu="__NO_STORE__",zu="__OTHER_STORE__",vA=(n,t)=>{const i=new Set((n||[]).map(o=>String(o.id))),a=[...n||[]];for(const o of t||[]){const u=String(o.id);i.has(u)||(i.add(u),a.push(o))}return a},Dp=n=>(n||"").toString().replace(/\s+/g," ").trim(),Rr=n=>Dp(n).toLowerCase(),j0=new Set(Zu.map(n=>Rr(n)).filter(Boolean));function xA(){const{user:n,logout:t,loading:i,isPasswordRecovery:a}=fs(),o=Li(),[u,d]=ic(),[f,h]=w.useState([]),[m,y]=w.useState(!0),[v,x]=w.useState(0),[b,_]=w.useState([]),[C,S]=w.useState(!1),[N,k]=w.useState({}),[D,L]=w.useState({}),[$,E]=w.useState(!1),A=w.useRef(0),R=u.get("view"),M=(R==="create-mock"?"create":R)||"list",V=u.get("id"),U=f.find(re=>String(re.id)===V)||null,[F,ne]=w.useState(null),[P,B]=w.useState(!1),[T,z]=w.useState(""),[H,J]=w.useState(null),[de,q]=w.useState(null),[Y,ae]=w.useState(""),[xe,ve]=w.useState("none"),[Ee,he]=w.useState(!1),[G,ge]=w.useState(!1),[Z,Ce]=w.useState(new Set),[be,We]=w.useState("normal"),[Re,Pe]=w.useState(!1),[Ze,rt]=w.useState(!1),[qe,Ae]=w.useState(null),[Se,te]=w.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),Be={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};w.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const re=window.matchMedia("(max-width: 700px)"),$e=()=>te(!!re.matches);return $e(),re.addEventListener?re.addEventListener("change",$e):re.addListener($e),()=>{re.removeEventListener?re.removeEventListener("change",$e):re.removeListener($e)}},[]),w.useEffect(()=>{if(!Se||!Be[M]||typeof window>"u")return;const re=`pc-recommend-shown:${M}`;try{if(window.sessionStorage.getItem(re)==="1")return;window.sessionStorage.setItem(re,"1")}catch{}Ae(M)},[M,Se]),w.useEffect(()=>{M!=="list"&&ve("none")},[M]),w.useEffect(()=>{if(typeof document>"u"||!Ee)return;const re=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=re}},[Ee]),w.useEffect(()=>{if(!i){S(!1);return}const re=setTimeout(()=>S(!0),3500);return()=>clearTimeout(re)},[i]),w.useEffect(()=>{if(f.length>0||M==="trash")return;let re=n?.id;if(!re)try{re=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!re)return;const $e=vn.getCachedRecipes(re);$e&&$e.length>0&&(h($e),E(!0),y(!1))},[n?.id]),w.useEffect(()=>{i||n&&(jt(),mt())},[i,n?.id]),w.useEffect(()=>{if(i)return;if(!n||n.role!=="admin"){k({}),L({});return}let re=!1;return(async()=>{try{const $e=await ga.fetchAllProfiles();if(re)return;const Ve={},_t={};for(const W of $e||[])W?.id&&(Ve[String(W.id)]=W),W?.display_id&&(_t[String(W.display_id)]=W);k(Ve),L(_t)}catch($e){console.warn("Failed to load profiles for admin owner labels",$e)}})(),()=>{re=!0}},[i,n?.id,n?.role]);const ut=re=>{const Ve=(re?.tags||[]).find(X=>X&&X.startsWith("owner:"));if(!Ve)return"/";const _t=String(Ve.slice(6)),W=N[_t]||D[_t]||null;return W?W.display_id||W.email||_t:_t.length>12?`${_t.slice(0,8)}`:_t},Ct=ba(ur(Al,{activationConstraint:{distance:10}}),ur(Rl,{activationConstraint:{delay:1e3,tolerance:5}}),ur(Tl,{coordinateGetter:pd})),Rt=re=>{const{active:$e,over:Ve}=re;$e.id!==Ve.id&&h(_t=>{const W=_t.findIndex(ze=>ze.id===$e.id),X=_t.findIndex(ze=>ze.id===Ve.id);if(W===-1||X===-1)return _t;const oe=zi(_t,W,X),fe=oe.map((ze,Fe)=>({id:ze.id,order_index:Fe}));return vn.updateOrder(fe).catch(ze=>console.error("Order update failed",ze)),oe})},mt=async()=>{try{const re=await vn.fetchRecentRecipes();_(re||[])}catch(re){console.error("Failed to load history:",re)}},Ot=async re=>{const $e=[re,...b.filter(Ve=>Ve!==re)].slice(0,20);_($e);try{await vn.addToHistory(re)}catch(Ve){console.error("Failed to sync history",Ve)}},jt=async()=>{try{const re=await vn.getDeletedCount();x(re||0)}catch(re){console.error("Failed to load trash count:",re)}},ft=async()=>{if(!n)return;const re=A.current+1;A.current=re;const $e=()=>A.current!==re,Ve=Se?pA:mA,_t=Se?gA:yA;try{$||y(!0);const W=await vn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:0,limit:Ve,skipCacheSave:!0,returnMeta:!0});if($e())return;let X=W?.recipes||[],oe=W?.hasMoreRaw===!0,fe=Ve;h(X);let ze=!1;for(!$&&(X.length>0||!oe)&&(y(!1),ze=!0);oe;){const Fe=await vn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:fe,limit:_t,skipCacheSave:!0,returnMeta:!0});if($e())return;const Je=Fe?.recipes||[];if(Je.length>0&&(X=vA(X,Je),h(X),!$&&!ze&&(y(!1),ze=!0)),fe+=_t,oe=Fe?.hasMoreRaw===!0,Je.length===0&&!oe)break}if($e())return;vn.saveCachedRecipes(X,n.id)}catch(W){if($e())return;console.error("Failed to fetch recipes:",W),o.error(`

(${W?.message||"unknown error"})`)}finally{$e()||(y(!1),E(!1))}},{allCourses:Vt,allCategories:an,storeCounts:xn,noStoreCount:Mt,otherStoreCount:nn,courseCounts:cn,categoryCounts:Gt}=w.useMemo(()=>{const re=[...new Set(f.map(fe=>Dp(fe.course)).filter(Boolean))],$e=[...new Set(f.map(fe=>Dp(fe.category)).filter(Boolean))],Ve=f.reduce((fe,ze)=>{const Fe=Rr(ze.storeName);return Fe&&(fe[Fe]=(fe[Fe]||0)+1),fe},{}),_t=f.reduce((fe,ze)=>Rr(ze.storeName)?fe:fe+1,0),W=f.reduce((fe,ze)=>{const Fe=Rr(ze.storeName);return Fe?j0.has(Fe)?fe:fe+1:fe},0),X=f.reduce((fe,ze)=>{const Fe=Rr(ze.course);return Fe&&(fe[Fe]=(fe[Fe]||0)+1),fe},{}),oe=f.reduce((fe,ze)=>{const Fe=Rr(ze.category);return Fe&&(fe[Fe]=(fe[Fe]||0)+1),fe},{});return{allCourses:re,allCategories:$e,storeCounts:Ve,noStoreCount:_t,otherStoreCount:W,courseCounts:X,categoryCounts:oe}},[f]),Xn=w.useMemo(()=>{const re=Rr(T),$e=Y.toLowerCase().trim();return f.filter(Ve=>{const _t=Rr(Ve.storeName);return T===""||T==="recent"&&b.includes(Ve.id)||Ve.tags&&Ve.tags.includes(T)||T===Mu&&!_t||T===zu&&_t&&!j0.has(_t)||Ve.category&&Rr(Ve.category)===re||Ve.course&&Rr(Ve.course)===re||Ve.storeName&&_t===re?$e?(Ve.title||"").toLowerCase().includes($e)||Ve.description&&Ve.description.toLowerCase().includes($e)||Array.isArray(Ve.ingredients)&&Ve.ingredients.some(X=>(X?.name||"").toLowerCase().includes($e)):!0:!1})},[f,T,b,Y]),ar=T===""&&!Y.trim()&&M==="list",ee=(re,$e={})=>{d({view:"detail",id:re.id,...$e})},De=async(re,$e=!1)=>{try{if(re.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&re.tags.some(_t=>_t==="owner:yoshito")){o.warning("");return}$e?(await vn.restoreRecipe(re.id),(M==="trash"||M==="detail")&&(d({view:"trash"}),Ue()),o.success("")):(await vn.deleteRecipe(re.id),h(f.filter(Ve=>Ve.id!==re.id)),d({view:"list"}),jt())}catch(Ve){console.error("Failed to delete/restore recipe:",Ve),o.error("")}finally{jt()}},Te=async re=>{try{await vn.hardDeleteRecipe(re.id),h(f.filter($e=>$e.id!==re.id)),d({view:"trash"}),o.success(""),Ue(),jt()}catch($e){console.error("Failed to hard delete recipe:",$e),o.error("")}},Ue=async()=>{try{A.current+=1,y(!0);const re=await vn.fetchDeletedRecipes();h(re||[]),z("")}catch(re){console.error("Failed to fetch deleted recipes:",re)}finally{y(!1)}},He=()=>{d({view:"trash"})},it=()=>{d({view:"list"})},gt=async()=>{he(!1);try{await t()}catch(re){console.error("Logout failed:",re),o.warning("")}},Lt=async(re,$e)=>{try{let Ve,_t=$e;if($e&&n.role!=="admin"){const W=re.tags?.find(oe=>oe.startsWith("owner:"));W===`owner:${n.id}`||n.displayId&&W===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${W||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),_t=!1)}_t?(Ve=await vn.updateRecipe(re,n),h(f.map(W=>W.id===Ve.id?Ve:W))):(Ve=await vn.createRecipe(re,n),h([Ve,...f])),d(_t?{view:"detail",id:Ve.id}:{view:"detail",id:Ve.id})}catch(Ve){console.error("Failed to save recipe:",Ve),o.error(`
: ${Ve.message||Ve.error_description||JSON.stringify(Ve)}`)}};w.useEffect(()=>{let re=!1;return(async()=>{if(M!=="edit"||!V){ne(null),B(!1);return}B(!0);try{const Ve=await vn.getRecipe(V);if(re)return;ne(Ve)}catch(Ve){if(console.error("Failed to load edit recipe details",Ve),re)return;ne(U),o.warning("")}finally{re||B(!1)}})(),()=>{re=!0}},[M,V]);const Pt=(re,$e="")=>{const Ve=["","baker","","","","dough","fermentation"],_t=re.title||re.name||"",W=Ve.some(Qe=>_t.toLowerCase().includes(Qe)),X=["flour","","","","","","","","",""],oe=["yeast","","",""],fe=re.ingredients||[],ze=fe.some(Qe=>oe.some(wt=>(Qe.name||"").toLowerCase().includes(wt))),Fe=fe.some(Qe=>X.some(wt=>(Qe.name||"").toLowerCase().includes(wt))&&!Qe.name.includes(""));if(fe.some(Qe=>Qe.quantity&&String(Qe.quantity).includes("%")||Qe.unit&&String(Qe.unit).includes("%"))||ze||W&&Fe){re.type="bread",re.flours=[],re.breadIngredients=[];const Qe=["flour","","","","","","","",""];if(fe.forEach(wt=>{Qe.some(It=>(wt.name||"").includes(It))?re.flours.push(wt):re.breadIngredients.push(wt)}),re.flours.length===0&&fe.length>0){const wt=fe[0];(wt.name||"").includes("")&&(re.flours.push(wt),re.breadIngredients=re.breadIngredients.filter(St=>St!==wt))}}re.sourceUrl=$e,$e&&(re.category="URL"),q(re),d({view:"create"})},dn=()=>{ge(!G),Ce(new Set)},ue=re=>{const $e=new Set(Z);$e.has(re)?$e.delete(re):$e.add(re),Ce($e)},Ke=()=>{Pe(!0)},at=()=>{Pe(!1)},Ye=async()=>{Pe(!1);try{y(!0),M==="trash"?(await Promise.all(Array.from(Z).map(re=>vn.hardDeleteRecipe(re))),Ue()):(await Promise.all(Array.from(Z).map(re=>vn.deleteRecipe(re))),h(f.filter(re=>!Z.has(re.id))),jt()),Ce(new Set),ge(!1),o.success("")}catch(re){console.error("Bulk delete failed",re),o.warning(""),M==="trash"?Ue():ft()}finally{y(!1)}},kt=()=>{Z.size!==0&&rt(!0)},xt=()=>{rt(!1)},Dt=async()=>{rt(!1);try{y(!0);for(const re of Z)await vn.restoreRecipe(re);h(f.filter(re=>!Z.has(re.id))),jt(),ge(!1),Ce(new Set),o.success(""),Ue()}catch(re){console.error("Bulk restore failed",re),o.warning(""),Ue()}finally{y(!1)}},Ft=()=>{const re=Xn.map($e=>$e.id);Ce(new Set(re))},ot=re=>{h([re,...f]),d({view:"edit",id:re.id})};if(w.useEffect(()=>{i||n&&(M==="trash"?Ue():M==="list"&&ft())},[M,i,n?.id]),i&&!C){let re=!1;try{const $e=JSON.parse(localStorage.getItem("auth_user_cache")||"null");$e?.id&&(re=!!vn.getCachedRecipes($e.id))}catch{}if(!re)return s.jsx(op,{label:"",subLabel:""})}return n?a?s.jsx(fA,{}):s.jsxs(R_,{children:[Re&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(on,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[s.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:""})," ",Z.size,"",M==="trash"?"":""]}),s.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:M==="trash"?"":""}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(le,{variant:"ghost",onClick:at,children:""}),s.jsx(le,{variant:"danger",onClick:Ye,children:M==="trash"?"":""})]})]})}),Ze&&s.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(on,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[s.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[s.jsx("span",{children:""})," ",Z.size,""]}),s.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[s.jsx(le,{variant:"ghost",onClick:xt,children:""}),s.jsx(le,{variant:"secondary",onClick:Dt,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),s.jsx(wn,{isOpen:!!qe,onClose:()=>Ae(null),title:"PC",size:"small",children:s.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[s.jsx("p",{style:{marginTop:0},children:Be[qe]?s.jsxs(s.Fragment,{children:["",s.jsx("strong",{children:Be[qe]}),"/"]}):s.jsx(s.Fragment,{children:"/"})}),s.jsxs("p",{style:{marginBottom:0},children:["",s.jsx("strong",{children:"PC"}),""]}),s.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[s.jsx(le,{variant:"ghost",onClick:()=>{Ae(null),d({view:"list"})},children:""}),s.jsx(le,{variant:"primary",onClick:()=>Ae(null),children:"OK"})]})]})}),(M==="list"||M==="trash")&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"container-header",children:[s.jsxs("h2",{className:"section-title",children:[M==="trash"?" ()":"",M==="list"&&s.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",f.length,")"]})]}),s.jsx("div",{className:"header-actions",children:M==="list"||M==="trash"?s.jsxs(s.Fragment,{children:[G?s.jsxs(s.Fragment,{children:[s.jsx(le,{variant:"ghost",onClick:dn,children:""}),s.jsx(le,{variant:"secondary",onClick:Ft,children:""}),M==="trash"&&s.jsxs(le,{variant:"secondary",onClick:kt,disabled:Z.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",Z.size,")"]}),s.jsxs(le,{variant:"danger",onClick:Ke,disabled:Z.size===0,children:[M==="trash"?"":""," (",Z.size,")"]})]}):s.jsx(s.Fragment,{children:M==="list"?s.jsx(s.Fragment,{children:s.jsx(le,{onClick:()=>{q(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):s.jsx(le,{variant:"ghost",onClick:it,children:" "})}),s.jsx("button",{className:"mobile-menu-toggle",onClick:()=>he(!Ee),"aria-label":"",children:""}),s.jsxs("div",{className:`secondary-actions ${Ee?"open":""}`,children:[s.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>he(!1),"aria-label":"",children:""}),s.jsxs("div",{className:"secondary-actions-content",children:[s.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[s.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&s.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&s.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),s.jsxs(le,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),s.jsxs(le,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),M==="list"&&s.jsxs(s.Fragment,{children:[s.jsxs(le,{variant:"secondary",onClick:()=>{J("url"),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),s.jsxs(le,{variant:"secondary",onClick:()=>{J("image"),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),s.jsx("div",{className:"pc-recommend-note",children:s.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),s.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"inventory"}),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"incoming-deliveries"}),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),s.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"incoming-stock"}),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"planner"}),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),s.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"data"}),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&s.jsxs(s.Fragment,{children:[s.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"users"}),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"api-logs"}),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," API"]})]}),s.jsx("div",{className:"menu-divider"}),s.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"order-list"}),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"})]}),!G&&s.jsxs(le,{variant:"ghost",onClick:()=>{dn(),he(!1)},className:"danger-text",children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," ",M==="trash"?"":""]}),M==="list"&&s.jsxs(le,{variant:"ghost",onClick:()=>{He(),he(!1)},style:{position:"relative"},children:[s.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&s.jsx("span",{className:"trash-badge",children:v})]}),s.jsxs(le,{variant:"ghost",onClick:()=>{it(),he(!1)},children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),s.jsx("div",{className:"menu-divider"}),s.jsxs(le,{variant:"ghost",onClick:gt,children:[s.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]})]}),s.jsx("div",{className:`menu-backdrop ${Ee?"open":""}`,onClick:()=>he(!1),"aria-hidden":"true"})]}):null})]}),M==="list"&&s.jsxs("div",{className:"list-toolbar",children:[s.jsxs("div",{className:"search-container search-container--compact",children:[s.jsx("span",{className:"search-icon",children:""}),s.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:Y,onChange:re=>ae(re.target.value)})]}),s.jsxs("div",{className:"public-recipe-toggles",children:[s.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${xe==="mine"?"active":""}`,"aria-pressed":xe==="mine",onClick:()=>ve("mine"),children:" "}),s.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${xe==="others"?"active":""}`,"aria-pressed":xe==="others",onClick:()=>ve("others"),children:" "}),xe!=="none"&&s.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>ve("none"),children:" "})]})]}),s.jsxs("div",{className:"tag-filter-container",children:[s.jsxs("select",{className:"store-filter-select",value:T===Mu?Mu:T===zu?zu:Zu.includes(T)?T:"",onChange:re=>z(re.target.value||""),children:[s.jsx("option",{value:"",children:""}),Zu.map(re=>s.jsxs("option",{value:re,children:[re," (",xn[Rr(re)]||0,")"]},re)),s.jsxs("option",{value:Mu,children:[" (",Mt,")"]}),s.jsxs("option",{value:zu,children:[" (",nn,")"]})]}),s.jsxs("select",{className:"store-filter-select",value:Vt.includes(T)?T:"",onChange:re=>z(re.target.value||""),children:[s.jsx("option",{value:"",children:""}),Vt.sort().map(re=>s.jsxs("option",{value:re,children:[re," (",cn[Rr(re)]||0,")"]},re))]}),s.jsxs("select",{className:"store-filter-select",value:an.includes(T)?T:"",onChange:re=>z(re.target.value||""),children:[s.jsx("option",{value:"",children:""}),an.sort().map(re=>s.jsxs("option",{value:re,children:[re," (",Gt[Rr(re)]||0,")"]},re))]}),s.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[s.jsx("button",{className:`tag-filter-btn ${be==="normal"?"active":""}`,onClick:()=>We("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),s.jsx("button",{className:`tag-filter-btn ${be==="all"?"active":""}`,onClick:()=>We("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),m?s.jsx(op,{label:$?"":"",subLabel:$?void 0:"",variant:"inline",showLogo:!1}):f.length===0?s.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[M==="trash"?"":"",T!==""&&s.jsx("p",{children:""})]}):s.jsxs("div",{className:"main-content-wrapper",children:[M==="list"&&s.jsx("div",{className:"recent-list-wrapper",children:s.jsx(cT,{recipes:f,recentIds:b,onSelect:ee})}),s.jsx("div",{className:"recipe-list-container",children:M==="list"?s.jsx(Di,{sensors:Ct,collisionDetection:Ku,onDragEnd:Rt,children:s.jsx(hx,{recipes:Xn,onSelectRecipe:ee,isSelectMode:G,selectedIds:Z,onToggleSelection:ue,disableDrag:!ar,displayMode:be,publicRecipeView:xe,showOwner:n?.role==="admin",ownerLabelFn:ut,currentUser:n})}):s.jsx(hx,{recipes:Xn,onSelectRecipe:ee,isSelectMode:G,selectedIds:Z,onToggleSelection:ue,disableDrag:!0,displayMode:be,publicRecipeView:xe,showOwner:n?.role==="admin",ownerLabelFn:ut,currentUser:n})})]})]}),M==="detail"&&U&&s.jsx(Ck,{recipe:U,ownerLabel:n?.role==="admin"?ut(U):void 0,isDeleted:!!U.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):U.deletedAt?He():it()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?it:void 0,onEdit:()=>d({view:"edit",id:U.id,from:u.get("from")}),onDelete:De,onView:Ot,onHardDelete:Te,onDuplicate:ot}),M==="edit"&&V&&(P?s.jsx(op,{label:"",subLabel:"URL"}):F&&s.jsx(o0,{initialData:F,onCancel:()=>d({view:"detail",id:V}),onSave:re=>Lt(re,!0)},`edit-${V}`)),M==="create"&&s.jsx(o0,{initialData:de,onCancel:()=>{d({view:"list"}),q(null)},onSave:re=>Lt(re,!1)},de?"create-form-imported":"create-form"),H&&s.jsx(Zb,{initialMode:H,onClose:()=>J(null),onImport:Pt}),(M==="data"||M==="data-management")&&s.jsx(oT,{onBack:()=>d({view:"list"})}),M==="levain-guide"&&s.jsx(uT,{onBack:()=>d({view:"list"})}),M==="users"&&n?.role==="admin"&&s.jsx(dT,{onBack:()=>d({view:"list"})}),M==="inventory"&&s.jsx(gT,{onBack:()=>d({view:"list"})}),M==="incoming-deliveries"&&s.jsx(TT,{onBack:()=>d({view:"list"})}),M==="incoming-stock"&&s.jsx(tA,{onBack:()=>d({view:"list"})}),M==="planner"&&s.jsx(iA,{onBack:()=>d({view:"list"}),onSelectRecipe:re=>ee(re,{from:"planner"}),onNavigateToOrderList:()=>d({view:"order-list"})}),M==="order-list"&&s.jsx(aA,{onBack:()=>d({view:"list"}),onNavigateToPlanner:()=>d({view:"planner"})}),M==="api-logs"&&n?.role==="admin"&&s.jsxs(s.Fragment,{children:[s.jsx(lA,{}),s.jsx("div",{style:{padding:"20px",textAlign:"center"},children:s.jsx(le,{onClick:()=>d({view:"list"}),children:" "})})]})]}):s.jsx(hA,{})}function bA(){return s.jsx(dA,{children:s.jsx(oA,{children:s.jsx(xA,{})})})}class wA extends _e.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,i){console.error("Uncaught error:",t,i),this.setState({error:t,errorInfo:i})}render(){return this.state.hasError?s.jsxs("div",{style:{padding:"2rem",color:"red"},children:[s.jsx("h1",{children:""}),s.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),s.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),s.jsx("br",{}),s.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}ej.createRoot(document.getElementById("root")).render(s.jsx(w.StrictMode,{children:s.jsx(wA,{children:s.jsx(w_,{children:s.jsx(bA,{})})})}));export{_0 as a,SA as c,jA as g};
