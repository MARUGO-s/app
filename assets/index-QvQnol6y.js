(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function s(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(o){if(o.ep)return;o.ep=!0;const c=s(o);fetch(o.href,c)}})();var Lu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nm(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function pR(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var s=function a(){var o=!1;try{o=this instanceof a}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(e).forEach(function(a){var o=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(s,a,o.get?o:{enumerable:!0,get:function(){return e[a]}})}),s}var Uf={exports:{}},Fl={};var Xv;function ES(){if(Xv)return Fl;Xv=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function s(a,o,c){var u=null;if(c!==void 0&&(u=""+c),o.key!==void 0&&(u=""+o.key),"key"in o){c={};for(var h in o)h!=="key"&&(c[h]=o[h])}else c=o;return o=c.ref,{$$typeof:e,type:a,key:u,ref:o!==void 0?o:null,props:c}}return Fl.Fragment=t,Fl.jsx=s,Fl.jsxs=s,Fl}var Zv;function NS(){return Zv||(Zv=1,Uf.exports=ES()),Uf.exports}var r=NS(),Bf={exports:{}},Lt={};var e0;function AS(){if(e0)return Lt;e0=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),x=Symbol.iterator;function v(A){return A===null||typeof A!="object"?null:(A=x&&A[x]||A["@@iterator"],typeof A=="function"?A:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,_={};function j(A,U,X){this.props=A,this.context=U,this.refs=_,this.updater=X||S}j.prototype.isReactComponent={},j.prototype.setState=function(A,U){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,U,"setState")},j.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function E(){}E.prototype=j.prototype;function T(A,U,X){this.props=A,this.context=U,this.refs=_,this.updater=X||S}var R=T.prototype=new E;R.constructor=T,w(R,j.prototype),R.isPureReactComponent=!0;var B=Array.isArray;function F(){}var $={H:null,A:null,T:null,S:null},M=Object.prototype.hasOwnProperty;function z(A,U,X){var se=X.ref;return{$$typeof:e,type:A,key:U,ref:se!==void 0?se:null,props:X}}function P(A,U){return z(A.type,U,A.props)}function H(A){return typeof A=="object"&&A!==null&&A.$$typeof===e}function O(A){var U={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(X){return U[X]})}var q=/\/+/g;function C(A,U){return typeof A=="object"&&A!==null&&A.key!=null?O(""+A.key):U.toString(36)}function I(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(F,F):(A.status="pending",A.then(function(U){A.status==="pending"&&(A.status="fulfilled",A.value=U)},function(U){A.status==="pending"&&(A.status="rejected",A.reason=U)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function L(A,U,X,se,oe){var Ce=typeof A;(Ce==="undefined"||Ce==="boolean")&&(A=null);var ue=!1;if(A===null)ue=!0;else switch(Ce){case"bigint":case"string":case"number":ue=!0;break;case"object":switch(A.$$typeof){case e:case t:ue=!0;break;case m:return ue=A._init,L(ue(A._payload),U,X,se,oe)}}if(ue)return oe=oe(A),ue=se===""?"."+C(A,0):se,B(oe)?(X="",ue!=null&&(X=ue.replace(q,"$&/")+"/"),L(oe,U,X,"",function(Le){return Le})):oe!=null&&(H(oe)&&(oe=P(oe,X+(oe.key==null||A&&A.key===oe.key?"":(""+oe.key).replace(q,"$&/")+"/")+ue)),U.push(oe)),1;ue=0;var ne=se===""?".":se+":";if(B(A))for(var we=0;we<A.length;we++)se=A[we],Ce=ne+C(se,we),ue+=L(se,U,X,Ce,oe);else if(we=v(A),typeof we=="function")for(A=we.call(A),we=0;!(se=A.next()).done;)se=se.value,Ce=ne+C(se,we++),ue+=L(se,U,X,Ce,oe);else if(Ce==="object"){if(typeof A.then=="function")return L(I(A),U,X,se,oe);throw U=String(A),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return ue}function V(A,U,X){if(A==null)return A;var se=[],oe=0;return L(A,se,"","",function(Ce){return U.call(X,Ce,oe++)}),se}function G(A){if(A._status===-1){var U=A._result;U=U(),U.then(function(X){(A._status===0||A._status===-1)&&(A._status=1,A._result=X)},function(X){(A._status===0||A._status===-1)&&(A._status=2,A._result=X)}),A._status===-1&&(A._status=0,A._result=U)}if(A._status===1)return A._result.default;throw A._result}var Y=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)},Z={map:V,forEach:function(A,U,X){V(A,function(){U.apply(this,arguments)},X)},count:function(A){var U=0;return V(A,function(){U++}),U},toArray:function(A){return V(A,function(U){return U})||[]},only:function(A){if(!H(A))throw Error("React.Children.only expected to receive a single React element child.");return A}};return Lt.Activity=g,Lt.Children=Z,Lt.Component=j,Lt.Fragment=s,Lt.Profiler=o,Lt.PureComponent=T,Lt.StrictMode=a,Lt.Suspense=f,Lt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Lt.__COMPILER_RUNTIME={__proto__:null,c:function(A){return $.H.useMemoCache(A)}},Lt.cache=function(A){return function(){return A.apply(null,arguments)}},Lt.cacheSignal=function(){return null},Lt.cloneElement=function(A,U,X){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var se=w({},A.props),oe=A.key;if(U!=null)for(Ce in U.key!==void 0&&(oe=""+U.key),U)!M.call(U,Ce)||Ce==="key"||Ce==="__self"||Ce==="__source"||Ce==="ref"&&U.ref===void 0||(se[Ce]=U[Ce]);var Ce=arguments.length-2;if(Ce===1)se.children=X;else if(1<Ce){for(var ue=Array(Ce),ne=0;ne<Ce;ne++)ue[ne]=arguments[ne+2];se.children=ue}return z(A.type,oe,se)},Lt.createContext=function(A){return A={$$typeof:u,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:c,_context:A},A},Lt.createElement=function(A,U,X){var se,oe={},Ce=null;if(U!=null)for(se in U.key!==void 0&&(Ce=""+U.key),U)M.call(U,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(oe[se]=U[se]);var ue=arguments.length-2;if(ue===1)oe.children=X;else if(1<ue){for(var ne=Array(ue),we=0;we<ue;we++)ne[we]=arguments[we+2];oe.children=ne}if(A&&A.defaultProps)for(se in ue=A.defaultProps,ue)oe[se]===void 0&&(oe[se]=ue[se]);return z(A,Ce,oe)},Lt.createRef=function(){return{current:null}},Lt.forwardRef=function(A){return{$$typeof:h,render:A}},Lt.isValidElement=H,Lt.lazy=function(A){return{$$typeof:m,_payload:{_status:-1,_result:A},_init:G}},Lt.memo=function(A,U){return{$$typeof:p,type:A,compare:U===void 0?null:U}},Lt.startTransition=function(A){var U=$.T,X={};$.T=X;try{var se=A(),oe=$.S;oe!==null&&oe(X,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(F,Y)}catch(Ce){Y(Ce)}finally{U!==null&&X.types!==null&&(U.types=X.types),$.T=U}},Lt.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Lt.use=function(A){return $.H.use(A)},Lt.useActionState=function(A,U,X){return $.H.useActionState(A,U,X)},Lt.useCallback=function(A,U){return $.H.useCallback(A,U)},Lt.useContext=function(A){return $.H.useContext(A)},Lt.useDebugValue=function(){},Lt.useDeferredValue=function(A,U){return $.H.useDeferredValue(A,U)},Lt.useEffect=function(A,U){return $.H.useEffect(A,U)},Lt.useEffectEvent=function(A){return $.H.useEffectEvent(A)},Lt.useId=function(){return $.H.useId()},Lt.useImperativeHandle=function(A,U,X){return $.H.useImperativeHandle(A,U,X)},Lt.useInsertionEffect=function(A,U){return $.H.useInsertionEffect(A,U)},Lt.useLayoutEffect=function(A,U){return $.H.useLayoutEffect(A,U)},Lt.useMemo=function(A,U){return $.H.useMemo(A,U)},Lt.useOptimistic=function(A,U){return $.H.useOptimistic(A,U)},Lt.useReducer=function(A,U,X){return $.H.useReducer(A,U,X)},Lt.useRef=function(A){return $.H.useRef(A)},Lt.useState=function(A){return $.H.useState(A)},Lt.useSyncExternalStore=function(A,U,X){return $.H.useSyncExternalStore(A,U,X)},Lt.useTransition=function(){return $.H.useTransition()},Lt.version="19.2.3",Lt}var t0;function bc(){return t0||(t0=1,Bf.exports=AS()),Bf.exports}var k=bc();const Ue=nm(k);var Pf={exports:{}},Vl={},$f={exports:{}},qf={};var n0;function TS(){return n0||(n0=1,(function(e){function t(L,V){var G=L.length;L.push(V);e:for(;0<G;){var Y=G-1>>>1,Z=L[Y];if(0<o(Z,V))L[Y]=V,L[G]=Z,G=Y;else break e}}function s(L){return L.length===0?null:L[0]}function a(L){if(L.length===0)return null;var V=L[0],G=L.pop();if(G!==V){L[0]=G;e:for(var Y=0,Z=L.length,A=Z>>>1;Y<A;){var U=2*(Y+1)-1,X=L[U],se=U+1,oe=L[se];if(0>o(X,G))se<Z&&0>o(oe,X)?(L[Y]=oe,L[se]=G,Y=se):(L[Y]=X,L[U]=G,Y=U);else if(se<Z&&0>o(oe,G))L[Y]=oe,L[se]=G,Y=se;else break e}}return V}function o(L,V){var G=L.sortIndex-V.sortIndex;return G!==0?G:L.id-V.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var u=Date,h=u.now();e.unstable_now=function(){return u.now()-h}}var f=[],p=[],m=1,g=null,x=3,v=!1,S=!1,w=!1,_=!1,j=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function R(L){for(var V=s(p);V!==null;){if(V.callback===null)a(p);else if(V.startTime<=L)a(p),V.sortIndex=V.expirationTime,t(f,V);else break;V=s(p)}}function B(L){if(w=!1,R(L),!S)if(s(f)!==null)S=!0,F||(F=!0,O());else{var V=s(p);V!==null&&I(B,V.startTime-L)}}var F=!1,$=-1,M=5,z=-1;function P(){return _?!0:!(e.unstable_now()-z<M)}function H(){if(_=!1,F){var L=e.unstable_now();z=L;var V=!0;try{e:{S=!1,w&&(w=!1,E($),$=-1),v=!0;var G=x;try{t:{for(R(L),g=s(f);g!==null&&!(g.expirationTime>L&&P());){var Y=g.callback;if(typeof Y=="function"){g.callback=null,x=g.priorityLevel;var Z=Y(g.expirationTime<=L);if(L=e.unstable_now(),typeof Z=="function"){g.callback=Z,R(L),V=!0;break t}g===s(f)&&a(f),R(L)}else a(f);g=s(f)}if(g!==null)V=!0;else{var A=s(p);A!==null&&I(B,A.startTime-L),V=!1}}break e}finally{g=null,x=G,v=!1}V=void 0}}finally{V?O():F=!1}}}var O;if(typeof T=="function")O=function(){T(H)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,C=q.port2;q.port1.onmessage=H,O=function(){C.postMessage(null)}}else O=function(){j(H,0)};function I(L,V){$=j(function(){L(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return x},e.unstable_next=function(L){switch(x){case 1:case 2:case 3:var V=3;break;default:V=x}var G=x;x=V;try{return L()}finally{x=G}},e.unstable_requestPaint=function(){_=!0},e.unstable_runWithPriority=function(L,V){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var G=x;x=L;try{return V()}finally{x=G}},e.unstable_scheduleCallback=function(L,V,G){var Y=e.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?Y+G:Y):G=Y,L){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=G+Z,L={id:m++,callback:V,priorityLevel:L,startTime:G,expirationTime:Z,sortIndex:-1},G>Y?(L.sortIndex=G,t(p,L),s(f)===null&&L===s(p)&&(w?(E($),$=-1):w=!0,I(B,G-Y))):(L.sortIndex=Z,t(f,L),S||v||(S=!0,F||(F=!0,O()))),L},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(L){var V=x;return function(){var G=x;x=V;try{return L.apply(this,arguments)}finally{x=G}}}})(qf)),qf}var r0;function RS(){return r0||(r0=1,$f.exports=TS()),$f.exports}var Ff={exports:{}},Rr={};var s0;function OS(){if(s0)return Rr;s0=1;var e=bc();function t(f){var p="https://react.dev/errors/"+f;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)p+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var a={d:{f:s,r:function(){throw Error(t(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},o=Symbol.for("react.portal");function c(f,p,m){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:g==null?null:""+g,children:f,containerInfo:p,implementation:m}}var u=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,p){if(f==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Rr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Rr.createPortal=function(f,p){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(t(299));return c(f,p,null,m)},Rr.flushSync=function(f){var p=u.T,m=a.p;try{if(u.T=null,a.p=2,f)return f()}finally{u.T=p,a.p=m,a.d.f()}},Rr.preconnect=function(f,p){typeof f=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,a.d.C(f,p))},Rr.prefetchDNS=function(f){typeof f=="string"&&a.d.D(f)},Rr.preinit=function(f,p){if(typeof f=="string"&&p&&typeof p.as=="string"){var m=p.as,g=h(m,p.crossOrigin),x=typeof p.integrity=="string"?p.integrity:void 0,v=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;m==="style"?a.d.S(f,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:g,integrity:x,fetchPriority:v}):m==="script"&&a.d.X(f,{crossOrigin:g,integrity:x,fetchPriority:v,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Rr.preinitModule=function(f,p){if(typeof f=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var m=h(p.as,p.crossOrigin);a.d.M(f,{crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&a.d.M(f)},Rr.preload=function(f,p){if(typeof f=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var m=p.as,g=h(m,p.crossOrigin);a.d.L(f,m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Rr.preloadModule=function(f,p){if(typeof f=="string")if(p){var m=h(p.as,p.crossOrigin);a.d.m(f,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else a.d.m(f)},Rr.requestFormReset=function(f){a.d.r(f)},Rr.unstable_batchedUpdates=function(f,p){return f(p)},Rr.useFormState=function(f,p,m){return u.H.useFormState(f,p,m)},Rr.useFormStatus=function(){return u.H.useHostTransitionStatus()},Rr.version="19.2.3",Rr}var i0;function eb(){if(i0)return Ff.exports;i0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Ff.exports=OS(),Ff.exports}var a0;function DS(){if(a0)return Vl;a0=1;var e=RS(),t=bc(),s=eb();function a(n){var i="https://react.dev/errors/"+n;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function c(n){var i=n,l=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,(i.flags&4098)!==0&&(l=i.return),n=i.return;while(n)}return i.tag===3?l:null}function u(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function h(n){if(n.tag===31){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function f(n){if(c(n)!==n)throw Error(a(188))}function p(n){var i=n.alternate;if(!i){if(i=c(n),i===null)throw Error(a(188));return i!==n?null:n}for(var l=n,d=i;;){var y=l.return;if(y===null)break;var b=y.alternate;if(b===null){if(d=y.return,d!==null){l=d;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===l)return f(y),n;if(b===d)return f(y),i;b=b.sibling}throw Error(a(188))}if(l.return!==d.return)l=y,d=b;else{for(var D=!1,W=y.child;W;){if(W===l){D=!0,l=y,d=b;break}if(W===d){D=!0,d=y,l=b;break}W=W.sibling}if(!D){for(W=b.child;W;){if(W===l){D=!0,l=b,d=y;break}if(W===d){D=!0,d=b,l=y;break}W=W.sibling}if(!D)throw Error(a(189))}}if(l.alternate!==d)throw Error(a(190))}if(l.tag!==3)throw Error(a(188));return l.stateNode.current===l?n:i}function m(n){var i=n.tag;if(i===5||i===26||i===27||i===6)return n;for(n=n.child;n!==null;){if(i=m(n),i!==null)return i;n=n.sibling}return null}var g=Object.assign,x=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),T=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function O(n){return n===null||typeof n!="object"?null:(n=H&&n[H]||n["@@iterator"],typeof n=="function"?n:null)}var q=Symbol.for("react.client.reference");function C(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===q?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case w:return"Fragment";case j:return"Profiler";case _:return"StrictMode";case B:return"Suspense";case F:return"SuspenseList";case z:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case S:return"Portal";case T:return n.displayName||"Context";case E:return(n._context.displayName||"Context")+".Consumer";case R:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case $:return i=n.displayName||null,i!==null?i:C(n.type)||"Memo";case M:i=n._payload,n=n._init;try{return C(n(i))}catch{}}return null}var I=Array.isArray,L=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G={pending:!1,data:null,method:null,action:null},Y=[],Z=-1;function A(n){return{current:n}}function U(n){0>Z||(n.current=Y[Z],Y[Z]=null,Z--)}function X(n,i){Z++,Y[Z]=n.current,n.current=i}var se=A(null),oe=A(null),Ce=A(null),ue=A(null);function ne(n,i){switch(X(Ce,i),X(oe,n),X(se,null),i.nodeType){case 9:case 11:n=(n=i.documentElement)&&(n=n.namespaceURI)?_v(n):0;break;default:if(n=i.tagName,i=i.namespaceURI)i=_v(i),n=wv(i,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}U(se),X(se,n)}function we(){U(se),U(oe),U(Ce)}function Le(n){n.memoizedState!==null&&X(ue,n);var i=se.current,l=wv(i,n.type);i!==l&&(X(oe,n),X(se,l))}function ge(n){oe.current===n&&(U(se),U(oe)),ue.current===n&&(U(ue),Bl._currentValue=G)}var Te,de;function N(n){if(Te===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);Te=i&&i[1]||"",de=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Te+n+de}var ve=!1;function fe(n,i){if(!n||ve)return"";ve=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(i){var He=function(){throw Error()};if(Object.defineProperty(He.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(He,[])}catch(Pe){var Ie=Pe}Reflect.construct(n,[],He)}else{try{He.call()}catch(Pe){Ie=Pe}n.call(He.prototype)}}else{try{throw Error()}catch(Pe){Ie=Pe}(He=n())&&typeof He.catch=="function"&&He.catch(function(){})}}catch(Pe){if(Pe&&Ie&&typeof Pe.stack=="string")return[Pe.stack,Ie.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=d.DetermineComponentFrameRoot(),D=b[0],W=b[1];if(D&&W){var me=D.split(`
`),ze=W.split(`
`);for(y=d=0;d<me.length&&!me[d].includes("DetermineComponentFrameRoot");)d++;for(;y<ze.length&&!ze[y].includes("DetermineComponentFrameRoot");)y++;if(d===me.length||y===ze.length)for(d=me.length-1,y=ze.length-1;1<=d&&0<=y&&me[d]!==ze[y];)y--;for(;1<=d&&0<=y;d--,y--)if(me[d]!==ze[y]){if(d!==1||y!==1)do if(d--,y--,0>y||me[d]!==ze[y]){var Fe=`
`+me[d].replace(" at new "," at ");return n.displayName&&Fe.includes("<anonymous>")&&(Fe=Fe.replace("<anonymous>",n.displayName)),Fe}while(1<=d&&0<=y);break}}}finally{ve=!1,Error.prepareStackTrace=l}return(l=n?n.displayName||n.name:"")?N(l):""}function Q(n,i){switch(n.tag){case 26:case 27:case 5:return N(n.type);case 16:return N("Lazy");case 13:return n.child!==i&&i!==null?N("Suspense Fallback"):N("Suspense");case 19:return N("SuspenseList");case 0:case 15:return fe(n.type,!1);case 11:return fe(n.type.render,!1);case 1:return fe(n.type,!0);case 31:return N("Activity");default:return""}}function K(n){try{var i="",l=null;do i+=Q(n,l),l=n,n=n.return;while(n);return i}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var ie=Object.prototype.hasOwnProperty,re=e.unstable_scheduleCallback,ee=e.unstable_cancelCallback,le=e.unstable_shouldYield,ye=e.unstable_requestPaint,qe=e.unstable_now,Re=e.unstable_getCurrentPriorityLevel,$e=e.unstable_ImmediatePriority,Ke=e.unstable_UserBlockingPriority,Ye=e.unstable_NormalPriority,Et=e.unstable_LowPriority,Kt=e.unstable_IdlePriority,dt=e.log,bt=e.unstable_setDisableYieldValue,mt=null,$t=null;function on(n){if(typeof dt=="function"&&bt(n),$t&&typeof $t.setStrictMode=="function")try{$t.setStrictMode(mt,n)}catch{}}var Ot=Math.clz32?Math.clz32:Dt,gn=Math.log,Wt=Math.LN2;function Dt(n){return n>>>=0,n===0?32:31-(gn(n)/Wt|0)|0}var zn=256,hn=262144,Ct=4194304;function ht(n){var i=n&42;if(i!==0)return i;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Vt(n,i,l){var d=n.pendingLanes;if(d===0)return 0;var y=0,b=n.suspendedLanes,D=n.pingedLanes;n=n.warmLanes;var W=d&134217727;return W!==0?(d=W&~b,d!==0?y=ht(d):(D&=W,D!==0?y=ht(D):l||(l=W&~n,l!==0&&(y=ht(l))))):(W=d&~b,W!==0?y=ht(W):D!==0?y=ht(D):l||(l=d&~n,l!==0&&(y=ht(l)))),y===0?0:i!==0&&i!==y&&(i&b)===0&&(b=y&-y,l=i&-i,b>=l||b===32&&(l&4194048)!==0)?i:y}function qt(n,i){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&i)===0}function cn(n,i){switch(n){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ft(){var n=Ct;return Ct<<=1,(Ct&62914560)===0&&(Ct=4194304),n}function _n(n){for(var i=[],l=0;31>l;l++)i.push(n);return i}function xn(n,i){n.pendingLanes|=i,i!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function un(n,i,l,d,y,b){var D=n.pendingLanes;n.pendingLanes=l,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=l,n.entangledLanes&=l,n.errorRecoveryDisabledLanes&=l,n.shellSuspendCounter=0;var W=n.entanglements,me=n.expirationTimes,ze=n.hiddenUpdates;for(l=D&~l;0<l;){var Fe=31-Ot(l),He=1<<Fe;W[Fe]=0,me[Fe]=-1;var Ie=ze[Fe];if(Ie!==null)for(ze[Fe]=null,Fe=0;Fe<Ie.length;Fe++){var Pe=Ie[Fe];Pe!==null&&(Pe.lane&=-536870913)}l&=~He}d!==0&&Vn(n,d,0),b!==0&&y===0&&n.tag!==0&&(n.suspendedLanes|=b&~(D&~i))}function Vn(n,i,l){n.pendingLanes|=i,n.suspendedLanes&=~i;var d=31-Ot(i);n.entangledLanes|=i,n.entanglements[d]=n.entanglements[d]|1073741824|l&261930}function Ht(n,i){var l=n.entangledLanes|=i;for(n=n.entanglements;l;){var d=31-Ot(l),y=1<<d;y&i|n[d]&i&&(n[d]|=i),l&=~y}}function Cn(n,i){var l=i&-i;return l=(l&42)!==0?1:It(l),(l&(n.suspendedLanes|i))!==0?0:l}function It(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Tn(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function Kn(){var n=V.p;return n!==0?n:(n=window.event,n===void 0?32:Hv(n.type))}function dn(n,i){var l=V.p;try{return V.p=n,i()}finally{V.p=l}}var Xt=Math.random().toString(36).slice(2),ke="__reactFiber$"+Xt,te="__reactProps$"+Xt,je="__reactContainer$"+Xt,Oe="__reactEvents$"+Xt,We="__reactListeners$"+Xt,ae="__reactHandles$"+Xt,he="__reactResources$"+Xt,pe="__reactMarker$"+Xt;function Ne(n){delete n[ke],delete n[te],delete n[Oe],delete n[We],delete n[ae]}function Be(n){var i=n[ke];if(i)return i;for(var l=n.parentNode;l;){if(i=l[je]||l[ke]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(n=Av(n);n!==null;){if(l=n[ke])return l;n=Av(n)}return i}n=l,l=n.parentNode}return null}function it(n){if(n=n[ke]||n[je]){var i=n.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return n}return null}function et(n){var i=n.tag;if(i===5||i===26||i===27||i===6)return n.stateNode;throw Error(a(33))}function Xe(n){var i=n[he];return i||(i=n[he]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function lt(n){n[pe]=!0}var Mt=new Set,Tt={};function Ge(n,i){ct(n,i),ct(n+"Capture",i)}function ct(n,i){for(Tt[n]=i,n=0;n<i.length;n++)Mt.add(i[n])}var Zt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),In={},Xn={};function Nr(n){return ie.call(Xn,n)?!0:ie.call(In,n)?!1:Zt.test(n)?Xn[n]=!0:(In[n]=!0,!1)}function Hr(n,i,l){if(Nr(i))if(l===null)n.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":n.removeAttribute(i);return;case"boolean":var d=i.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){n.removeAttribute(i);return}}n.setAttribute(i,""+l)}}function zr(n,i,l){if(l===null)n.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(i);return}n.setAttribute(i,""+l)}}function Gr(n,i,l,d){if(d===null)n.removeAttribute(l);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(l);return}n.setAttributeNS(i,l,""+d)}}function mr(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ls(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Fs(n,i,l){var d=Object.getOwnPropertyDescriptor(n.constructor.prototype,i);if(!n.hasOwnProperty(i)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var y=d.get,b=d.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return y.call(this)},set:function(D){l=""+D,b.call(this,D)}}),Object.defineProperty(n,i,{enumerable:d.enumerable}),{getValue:function(){return l},setValue:function(D){l=""+D},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function wi(n){if(!n._valueTracker){var i=Ls(n)?"checked":"value";n._valueTracker=Fs(n,i,""+n[i])}}function qa(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var l=i.getValue(),d="";return n&&(d=Ls(n)?n.checked?"true":"false":n.value),n=d,n!==l?(i.setValue(n),!0):!1}function Vs(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var sl=/[\n"\\]/g;function Ar(n){return n.replace(sl,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Hs(n,i,l,d,y,b,D,W){n.name="",D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"?n.type=D:n.removeAttribute("type"),i!=null?D==="number"?(i===0&&n.value===""||n.value!=i)&&(n.value=""+mr(i)):n.value!==""+mr(i)&&(n.value=""+mr(i)):D!=="submit"&&D!=="reset"||n.removeAttribute("value"),i!=null?oa(n,D,mr(i)):l!=null?oa(n,D,mr(l)):d!=null&&n.removeAttribute("value"),y==null&&b!=null&&(n.defaultChecked=!!b),y!=null&&(n.checked=y&&typeof y!="function"&&typeof y!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?n.name=""+mr(W):n.removeAttribute("name")}function Fa(n,i,l,d,y,b,D,W){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(n.type=b),i!=null||l!=null){if(!(b!=="submit"&&b!=="reset"||i!=null)){wi(n);return}l=l!=null?""+mr(l):"",i=i!=null?""+mr(i):l,W||i===n.value||(n.value=i),n.defaultValue=i}d=d??y,d=typeof d!="function"&&typeof d!="symbol"&&!!d,n.checked=W?n.checked:!!d,n.defaultChecked=!!d,D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(n.name=D),wi(n)}function oa(n,i,l){i==="number"&&Vs(n.ownerDocument)===n||n.defaultValue===""+l||(n.defaultValue=""+l)}function Ir(n,i,l,d){if(n=n.options,i){i={};for(var y=0;y<l.length;y++)i["$"+l[y]]=!0;for(l=0;l<n.length;l++)y=i.hasOwnProperty("$"+n[l].value),n[l].selected!==y&&(n[l].selected=y),y&&d&&(n[l].defaultSelected=!0)}else{for(l=""+mr(l),i=null,y=0;y<n.length;y++){if(n[y].value===l){n[y].selected=!0,d&&(n[y].defaultSelected=!0);return}i!==null||n[y].disabled||(i=n[y])}i!==null&&(i.selected=!0)}}function Si(n,i,l){if(i!=null&&(i=""+mr(i),i!==n.value&&(n.value=i),l==null)){n.defaultValue!==i&&(n.defaultValue=i);return}n.defaultValue=l!=null?""+mr(l):""}function Va(n,i,l,d){if(i==null){if(d!=null){if(l!=null)throw Error(a(92));if(I(d)){if(1<d.length)throw Error(a(93));d=d[0]}l=d}l==null&&(l=""),i=l}l=mr(i),n.defaultValue=l,d=n.textContent,d===l&&d!==""&&d!==null&&(n.value=d),wi(n)}function zs(n,i){if(i){var l=n.firstChild;if(l&&l===n.lastChild&&l.nodeType===3){l.nodeValue=i;return}}n.textContent=i}var Se=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function nt(n,i,l){var d=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?d?n.setProperty(i,""):i==="float"?n.cssFloat="":n[i]="":d?n.setProperty(i,l):typeof l!="number"||l===0||Se.has(i)?i==="float"?n.cssFloat=l:n[i]=(""+l).trim():n[i]=l+"px"}function ft(n,i,l){if(i!=null&&typeof i!="object")throw Error(a(62));if(n=n.style,l!=null){for(var d in l)!l.hasOwnProperty(d)||i!=null&&i.hasOwnProperty(d)||(d.indexOf("--")===0?n.setProperty(d,""):d==="float"?n.cssFloat="":n[d]="");for(var y in i)d=i[y],i.hasOwnProperty(y)&&l[y]!==d&&nt(n,y,d)}else for(var b in i)i.hasOwnProperty(b)&&nt(n,b,i[b])}function Nt(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fn=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),cr=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ln(n){return cr.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function wn(){}var Ut=null;function Wn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var bn=null,Bn=null;function rs(n){var i=it(n);if(i&&(n=i.stateNode)){var l=n[te]||null;e:switch(n=i.stateNode,i.type){case"input":if(Hs(n,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=n;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Ar(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var d=l[i];if(d!==n&&d.form===n.form){var y=d[te]||null;if(!y)throw Error(a(90));Hs(d,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(i=0;i<l.length;i++)d=l[i],d.form===n.form&&qa(d)}break e;case"textarea":Si(n,l.value,l.defaultValue);break e;case"select":i=l.value,i!=null&&Ir(n,!!l.multiple,i,!1)}}}var Mr=!1;function nn(n,i,l){if(Mr)return n(i,l);Mr=!0;try{var d=n(i);return d}finally{if(Mr=!1,(bn!==null||Bn!==null)&&(hu(),bn&&(i=bn,n=Bn,Bn=bn=null,rs(i),n)))for(i=0;i<n.length;i++)rs(n[i])}}function Zn(n,i){var l=n.stateNode;if(l===null)return null;var d=l[te]||null;if(d===null)return null;l=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(n=n.type,d=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!d;break e;default:n=!1}if(n)return null;if(l&&typeof l!="function")throw Error(a(231,i,typeof l));return l}var Tr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),J=!1;if(Tr)try{var xe={};Object.defineProperty(xe,"passive",{get:function(){J=!0}}),window.addEventListener("test",xe,xe),window.removeEventListener("test",xe,xe)}catch{J=!1}var be=null,Me=null,Qe=null;function Je(){if(Qe)return Qe;var n,i=Me,l=i.length,d,y="value"in be?be.value:be.textContent,b=y.length;for(n=0;n<l&&i[n]===y[n];n++);var D=l-n;for(d=1;d<=D&&i[l-d]===y[b-d];d++);return Qe=y.slice(n,1<d?1-d:void 0)}function tt(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function rt(){return!0}function st(){return!1}function ot(n){function i(l,d,y,b,D){this._reactName=l,this._targetInst=y,this.type=d,this.nativeEvent=b,this.target=D,this.currentTarget=null;for(var W in n)n.hasOwnProperty(W)&&(l=n[W],this[W]=l?l(b):b[W]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?rt:st,this.isPropagationStopped=st,this}return g(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=rt)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=rt)},persist:function(){},isPersistent:rt}),i}var pt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vt=ot(pt),at=g({},pt,{view:0,detail:0}),Rt=ot(at),Pn,$n,ss,bs=g({},at,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ci,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ss&&(ss&&n.type==="mousemove"?(Pn=n.screenX-ss.screenX,$n=n.screenY-ss.screenY):$n=Pn=0,ss=n),Pn)},movementY:function(n){return"movementY"in n?n.movementY:$n}}),yt=ot(bs),wt=g({},bs,{dataTransfer:0}),At=ot(wt),On=g({},at,{relatedTarget:0}),Hn=ot(On),rr=g({},pt,{animationName:0,elapsedTime:0,pseudoElement:0}),Gt=ot(rr),xr=g({},pt,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Gn=ot(xr),Gs=g({},pt,{data:0}),_s=ot(Gs),ji={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},il={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ks(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=Cm[n])?!!i[n]:!1}function Ci(){return Ks}var la=g({},at,{key:function(n){if(n.key){var i=ji[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=tt(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?il[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ci,charCode:function(n){return n.type==="keypress"?tt(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?tt(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),B_=ot(la),P_=g({},bs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),km=ot(P_),$_=g({},at,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ci}),q_=ot($_),F_=g({},pt,{propertyName:0,elapsedTime:0,pseudoElement:0}),V_=ot(F_),H_=g({},bs,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),G_=ot(H_),K_=g({},pt,{newState:0,oldState:0}),W_=ot(K_),Y_=[9,13,27,32],Fd=Tr&&"CompositionEvent"in window,al=null;Tr&&"documentMode"in document&&(al=document.documentMode);var Q_=Tr&&"TextEvent"in window&&!al,Em=Tr&&(!Fd||al&&8<al&&11>=al),Nm=" ",Am=!1;function Tm(n,i){switch(n){case"keyup":return Y_.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rm(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ha=!1;function J_(n,i){switch(n){case"compositionend":return Rm(i);case"keypress":return i.which!==32?null:(Am=!0,Nm);case"textInput":return n=i.data,n===Nm&&Am?null:n;default:return null}}function X_(n,i){if(Ha)return n==="compositionend"||!Fd&&Tm(n,i)?(n=Je(),Qe=Me=be=null,Ha=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Em&&i.locale!=="ko"?null:i.data;default:return null}}var Z_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Om(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!Z_[n.type]:i==="textarea"}function Dm(n,i,l,d){bn?Bn?Bn.push(d):Bn=[d]:bn=d,i=xu(i,"onChange"),0<i.length&&(l=new vt("onChange","change",null,l,d),n.push({event:l,listeners:i}))}var ol=null,ll=null;function ew(n){mv(n,0)}function Rc(n){var i=et(n);if(qa(i))return n}function Lm(n,i){if(n==="change")return i}var zm=!1;if(Tr){var Vd;if(Tr){var Hd="oninput"in document;if(!Hd){var Im=document.createElement("div");Im.setAttribute("oninput","return;"),Hd=typeof Im.oninput=="function"}Vd=Hd}else Vd=!1;zm=Vd&&(!document.documentMode||9<document.documentMode)}function Mm(){ol&&(ol.detachEvent("onpropertychange",Um),ll=ol=null)}function Um(n){if(n.propertyName==="value"&&Rc(ll)){var i=[];Dm(i,ll,n,Wn(n)),nn(ew,i)}}function tw(n,i,l){n==="focusin"?(Mm(),ol=i,ll=l,ol.attachEvent("onpropertychange",Um)):n==="focusout"&&Mm()}function nw(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Rc(ll)}function rw(n,i){if(n==="click")return Rc(i)}function sw(n,i){if(n==="input"||n==="change")return Rc(i)}function iw(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var Kr=typeof Object.is=="function"?Object.is:iw;function cl(n,i){if(Kr(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var l=Object.keys(n),d=Object.keys(i);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var y=l[d];if(!ie.call(i,y)||!Kr(n[y],i[y]))return!1}return!0}function Bm(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Pm(n,i){var l=Bm(n);n=0;for(var d;l;){if(l.nodeType===3){if(d=n+l.textContent.length,n<=i&&d>=i)return{node:l,offset:i-n};n=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Bm(l)}}function $m(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?$m(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function qm(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var i=Vs(n.document);i instanceof n.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)n=i.contentWindow;else break;i=Vs(n.document)}return i}function Gd(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}var aw=Tr&&"documentMode"in document&&11>=document.documentMode,Ga=null,Kd=null,ul=null,Wd=!1;function Fm(n,i,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Wd||Ga==null||Ga!==Vs(d)||(d=Ga,"selectionStart"in d&&Gd(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),ul&&cl(ul,d)||(ul=d,d=xu(Kd,"onSelect"),0<d.length&&(i=new vt("onSelect","select",null,i,l),n.push({event:i,listeners:d}),i.target=Ga)))}function ca(n,i){var l={};return l[n.toLowerCase()]=i.toLowerCase(),l["Webkit"+n]="webkit"+i,l["Moz"+n]="moz"+i,l}var Ka={animationend:ca("Animation","AnimationEnd"),animationiteration:ca("Animation","AnimationIteration"),animationstart:ca("Animation","AnimationStart"),transitionrun:ca("Transition","TransitionRun"),transitionstart:ca("Transition","TransitionStart"),transitioncancel:ca("Transition","TransitionCancel"),transitionend:ca("Transition","TransitionEnd")},Yd={},Vm={};Tr&&(Vm=document.createElement("div").style,"AnimationEvent"in window||(delete Ka.animationend.animation,delete Ka.animationiteration.animation,delete Ka.animationstart.animation),"TransitionEvent"in window||delete Ka.transitionend.transition);function ua(n){if(Yd[n])return Yd[n];if(!Ka[n])return n;var i=Ka[n],l;for(l in i)if(i.hasOwnProperty(l)&&l in Vm)return Yd[n]=i[l];return n}var Hm=ua("animationend"),Gm=ua("animationiteration"),Km=ua("animationstart"),ow=ua("transitionrun"),lw=ua("transitionstart"),cw=ua("transitioncancel"),Wm=ua("transitionend"),Ym=new Map,Qd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Qd.push("scrollEnd");function ws(n,i){Ym.set(n,i),Ge(i,[n])}var Oc=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},is=[],Wa=0,Jd=0;function Dc(){for(var n=Wa,i=Jd=Wa=0;i<n;){var l=is[i];is[i++]=null;var d=is[i];is[i++]=null;var y=is[i];is[i++]=null;var b=is[i];if(is[i++]=null,d!==null&&y!==null){var D=d.pending;D===null?y.next=y:(y.next=D.next,D.next=y),d.pending=y}b!==0&&Qm(l,y,b)}}function Lc(n,i,l,d){is[Wa++]=n,is[Wa++]=i,is[Wa++]=l,is[Wa++]=d,Jd|=d,n.lanes|=d,n=n.alternate,n!==null&&(n.lanes|=d)}function Xd(n,i,l,d){return Lc(n,i,l,d),zc(n)}function da(n,i){return Lc(n,null,null,i),zc(n)}function Qm(n,i,l){n.lanes|=l;var d=n.alternate;d!==null&&(d.lanes|=l);for(var y=!1,b=n.return;b!==null;)b.childLanes|=l,d=b.alternate,d!==null&&(d.childLanes|=l),b.tag===22&&(n=b.stateNode,n===null||n._visibility&1||(y=!0)),n=b,b=b.return;return n.tag===3?(b=n.stateNode,y&&i!==null&&(y=31-Ot(l),n=b.hiddenUpdates,d=n[y],d===null?n[y]=[i]:d.push(i),i.lane=l|536870912),b):null}function zc(n){if(50<Ol)throw Ol=0,lf=null,Error(a(185));for(var i=n.return;i!==null;)n=i,i=n.return;return n.tag===3?n.stateNode:null}var Ya={};function uw(n,i,l,d){this.tag=n,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wr(n,i,l,d){return new uw(n,i,l,d)}function Zd(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Ws(n,i){var l=n.alternate;return l===null?(l=Wr(n.tag,i,n.key,n.mode),l.elementType=n.elementType,l.type=n.type,l.stateNode=n.stateNode,l.alternate=n,n.alternate=l):(l.pendingProps=i,l.type=n.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=n.flags&65011712,l.childLanes=n.childLanes,l.lanes=n.lanes,l.child=n.child,l.memoizedProps=n.memoizedProps,l.memoizedState=n.memoizedState,l.updateQueue=n.updateQueue,i=n.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=n.sibling,l.index=n.index,l.ref=n.ref,l.refCleanup=n.refCleanup,l}function Jm(n,i){n.flags&=65011714;var l=n.alternate;return l===null?(n.childLanes=0,n.lanes=i,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=l.childLanes,n.lanes=l.lanes,n.child=l.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=l.memoizedProps,n.memoizedState=l.memoizedState,n.updateQueue=l.updateQueue,n.type=l.type,i=l.dependencies,n.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),n}function Ic(n,i,l,d,y,b){var D=0;if(d=n,typeof n=="function")Zd(n)&&(D=1);else if(typeof n=="string")D=mS(n,l,se.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case z:return n=Wr(31,l,i,y),n.elementType=z,n.lanes=b,n;case w:return ha(l.children,y,b,i);case _:D=8,y|=24;break;case j:return n=Wr(12,l,i,y|2),n.elementType=j,n.lanes=b,n;case B:return n=Wr(13,l,i,y),n.elementType=B,n.lanes=b,n;case F:return n=Wr(19,l,i,y),n.elementType=F,n.lanes=b,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case T:D=10;break e;case E:D=9;break e;case R:D=11;break e;case $:D=14;break e;case M:D=16,d=null;break e}D=29,l=Error(a(130,n===null?"null":typeof n,"")),d=null}return i=Wr(D,l,i,y),i.elementType=n,i.type=d,i.lanes=b,i}function ha(n,i,l,d){return n=Wr(7,n,d,i),n.lanes=l,n}function eh(n,i,l){return n=Wr(6,n,null,i),n.lanes=l,n}function Xm(n){var i=Wr(18,null,null,0);return i.stateNode=n,i}function th(n,i,l){return i=Wr(4,n.children!==null?n.children:[],n.key,i),i.lanes=l,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}var Zm=new WeakMap;function as(n,i){if(typeof n=="object"&&n!==null){var l=Zm.get(n);return l!==void 0?l:(i={value:n,source:i,stack:K(i)},Zm.set(n,i),i)}return{value:n,source:i,stack:K(i)}}var Qa=[],Ja=0,Mc=null,dl=0,os=[],ls=0,ki=null,Is=1,Ms="";function Ys(n,i){Qa[Ja++]=dl,Qa[Ja++]=Mc,Mc=n,dl=i}function eg(n,i,l){os[ls++]=Is,os[ls++]=Ms,os[ls++]=ki,ki=n;var d=Is;n=Ms;var y=32-Ot(d)-1;d&=~(1<<y),l+=1;var b=32-Ot(i)+y;if(30<b){var D=y-y%5;b=(d&(1<<D)-1).toString(32),d>>=D,y-=D,Is=1<<32-Ot(i)+y|l<<y|d,Ms=b+n}else Is=1<<b|l<<y|d,Ms=n}function nh(n){n.return!==null&&(Ys(n,1),eg(n,1,0))}function rh(n){for(;n===Mc;)Mc=Qa[--Ja],Qa[Ja]=null,dl=Qa[--Ja],Qa[Ja]=null;for(;n===ki;)ki=os[--ls],os[ls]=null,Ms=os[--ls],os[ls]=null,Is=os[--ls],os[ls]=null}function tg(n,i){os[ls++]=Is,os[ls++]=Ms,os[ls++]=ki,Is=i.id,Ms=i.overflow,ki=n}var br=null,Mn=null,rn=!1,Ei=null,cs=!1,sh=Error(a(519));function Ni(n){var i=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw hl(as(i,n)),sh}function ng(n){var i=n.stateNode,l=n.type,d=n.memoizedProps;switch(i[ke]=n,i[te]=d,l){case"dialog":Qt("cancel",i),Qt("close",i);break;case"iframe":case"object":case"embed":Qt("load",i);break;case"video":case"audio":for(l=0;l<Ll.length;l++)Qt(Ll[l],i);break;case"source":Qt("error",i);break;case"img":case"image":case"link":Qt("error",i),Qt("load",i);break;case"details":Qt("toggle",i);break;case"input":Qt("invalid",i),Fa(i,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Qt("invalid",i);break;case"textarea":Qt("invalid",i),Va(i,d.value,d.defaultValue,d.children)}l=d.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||d.suppressHydrationWarning===!0||xv(i.textContent,l)?(d.popover!=null&&(Qt("beforetoggle",i),Qt("toggle",i)),d.onScroll!=null&&Qt("scroll",i),d.onScrollEnd!=null&&Qt("scrollend",i),d.onClick!=null&&(i.onclick=wn),i=!0):i=!1,i||Ni(n,!0)}function rg(n){for(br=n.return;br;)switch(br.tag){case 5:case 31:case 13:cs=!1;return;case 27:case 3:cs=!0;return;default:br=br.return}}function Xa(n){if(n!==br)return!1;if(!rn)return rg(n),rn=!0,!1;var i=n.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=n.type,l=!(l!=="form"&&l!=="button")||Sf(n.type,n.memoizedProps)),l=!l),l&&Mn&&Ni(n),rg(n),i===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(a(317));Mn=Nv(n)}else if(i===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(a(317));Mn=Nv(n)}else i===27?(i=Mn,qi(n.type)?(n=Nf,Nf=null,Mn=n):Mn=i):Mn=br?ds(n.stateNode.nextSibling):null;return!0}function fa(){Mn=br=null,rn=!1}function ih(){var n=Ei;return n!==null&&($r===null?$r=n:$r.push.apply($r,n),Ei=null),n}function hl(n){Ei===null?Ei=[n]:Ei.push(n)}var ah=A(null),pa=null,Qs=null;function Ai(n,i,l){X(ah,i._currentValue),i._currentValue=l}function Js(n){n._currentValue=ah.current,U(ah)}function oh(n,i,l){for(;n!==null;){var d=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),n===l)break;n=n.return}}function lh(n,i,l,d){var y=n.child;for(y!==null&&(y.return=n);y!==null;){var b=y.dependencies;if(b!==null){var D=y.child;b=b.firstContext;e:for(;b!==null;){var W=b;b=y;for(var me=0;me<i.length;me++)if(W.context===i[me]){b.lanes|=l,W=b.alternate,W!==null&&(W.lanes|=l),oh(b.return,l,n),d||(D=null);break e}b=W.next}}else if(y.tag===18){if(D=y.return,D===null)throw Error(a(341));D.lanes|=l,b=D.alternate,b!==null&&(b.lanes|=l),oh(D,l,n),D=null}else D=y.child;if(D!==null)D.return=y;else for(D=y;D!==null;){if(D===n){D=null;break}if(y=D.sibling,y!==null){y.return=D.return,D=y;break}D=D.return}y=D}}function Za(n,i,l,d){n=null;for(var y=i,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var D=y.alternate;if(D===null)throw Error(a(387));if(D=D.memoizedProps,D!==null){var W=y.type;Kr(y.pendingProps.value,D.value)||(n!==null?n.push(W):n=[W])}}else if(y===ue.current){if(D=y.alternate,D===null)throw Error(a(387));D.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(n!==null?n.push(Bl):n=[Bl])}y=y.return}n!==null&&lh(i,n,l,d),i.flags|=262144}function Uc(n){for(n=n.firstContext;n!==null;){if(!Kr(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ma(n){pa=n,Qs=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function _r(n){return sg(pa,n)}function Bc(n,i){return pa===null&&ma(n),sg(n,i)}function sg(n,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},Qs===null){if(n===null)throw Error(a(308));Qs=i,n.dependencies={lanes:0,firstContext:i},n.flags|=524288}else Qs=Qs.next=i;return l}var dw=typeof AbortController<"u"?AbortController:function(){var n=[],i=this.signal={aborted:!1,addEventListener:function(l,d){n.push(d)}};this.abort=function(){i.aborted=!0,n.forEach(function(l){return l()})}},hw=e.unstable_scheduleCallback,fw=e.unstable_NormalPriority,sr={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ch(){return{controller:new dw,data:new Map,refCount:0}}function fl(n){n.refCount--,n.refCount===0&&hw(fw,function(){n.controller.abort()})}var pl=null,uh=0,eo=0,to=null;function pw(n,i){if(pl===null){var l=pl=[];uh=0,eo=pf(),to={status:"pending",value:void 0,then:function(d){l.push(d)}}}return uh++,i.then(ig,ig),i}function ig(){if(--uh===0&&pl!==null){to!==null&&(to.status="fulfilled");var n=pl;pl=null,eo=0,to=null;for(var i=0;i<n.length;i++)(0,n[i])()}}function mw(n,i){var l=[],d={status:"pending",value:null,reason:null,then:function(y){l.push(y)}};return n.then(function(){d.status="fulfilled",d.value=i;for(var y=0;y<l.length;y++)(0,l[y])(i)},function(y){for(d.status="rejected",d.reason=y,y=0;y<l.length;y++)(0,l[y])(void 0)}),d}var ag=L.S;L.S=function(n,i){Fy=qe(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&pw(n,i),ag!==null&&ag(n,i)};var ga=A(null);function dh(){var n=ga.current;return n!==null?n:Rn.pooledCache}function Pc(n,i){i===null?X(ga,ga.current):X(ga,i.pool)}function og(){var n=dh();return n===null?null:{parent:sr._currentValue,pool:n}}var no=Error(a(460)),hh=Error(a(474)),$c=Error(a(542)),qc={then:function(){}};function lg(n){return n=n.status,n==="fulfilled"||n==="rejected"}function cg(n,i,l){switch(l=n[l],l===void 0?n.push(i):l!==i&&(i.then(wn,wn),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw n=i.reason,dg(n),n;default:if(typeof i.status=="string")i.then(wn,wn);else{if(n=Rn,n!==null&&100<n.shellSuspendCounter)throw Error(a(482));n=i,n.status="pending",n.then(function(d){if(i.status==="pending"){var y=i;y.status="fulfilled",y.value=d}},function(d){if(i.status==="pending"){var y=i;y.status="rejected",y.reason=d}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw n=i.reason,dg(n),n}throw va=i,no}}function ya(n){try{var i=n._init;return i(n._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(va=l,no):l}}var va=null;function ug(){if(va===null)throw Error(a(459));var n=va;return va=null,n}function dg(n){if(n===no||n===$c)throw Error(a(483))}var ro=null,ml=0;function Fc(n){var i=ml;return ml+=1,ro===null&&(ro=[]),cg(ro,n,i)}function gl(n,i){i=i.props.ref,n.ref=i!==void 0?i:null}function Vc(n,i){throw i.$$typeof===x?Error(a(525)):(n=Object.prototype.toString.call(i),Error(a(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n)))}function hg(n){function i(Ee,_e){if(n){var De=Ee.deletions;De===null?(Ee.deletions=[_e],Ee.flags|=16):De.push(_e)}}function l(Ee,_e){if(!n)return null;for(;_e!==null;)i(Ee,_e),_e=_e.sibling;return null}function d(Ee){for(var _e=new Map;Ee!==null;)Ee.key!==null?_e.set(Ee.key,Ee):_e.set(Ee.index,Ee),Ee=Ee.sibling;return _e}function y(Ee,_e){return Ee=Ws(Ee,_e),Ee.index=0,Ee.sibling=null,Ee}function b(Ee,_e,De){return Ee.index=De,n?(De=Ee.alternate,De!==null?(De=De.index,De<_e?(Ee.flags|=67108866,_e):De):(Ee.flags|=67108866,_e)):(Ee.flags|=1048576,_e)}function D(Ee){return n&&Ee.alternate===null&&(Ee.flags|=67108866),Ee}function W(Ee,_e,De,Ve){return _e===null||_e.tag!==6?(_e=eh(De,Ee.mode,Ve),_e.return=Ee,_e):(_e=y(_e,De),_e.return=Ee,_e)}function me(Ee,_e,De,Ve){var _t=De.type;return _t===w?Fe(Ee,_e,De.props.children,Ve,De.key):_e!==null&&(_e.elementType===_t||typeof _t=="object"&&_t!==null&&_t.$$typeof===M&&ya(_t)===_e.type)?(_e=y(_e,De.props),gl(_e,De),_e.return=Ee,_e):(_e=Ic(De.type,De.key,De.props,null,Ee.mode,Ve),gl(_e,De),_e.return=Ee,_e)}function ze(Ee,_e,De,Ve){return _e===null||_e.tag!==4||_e.stateNode.containerInfo!==De.containerInfo||_e.stateNode.implementation!==De.implementation?(_e=th(De,Ee.mode,Ve),_e.return=Ee,_e):(_e=y(_e,De.children||[]),_e.return=Ee,_e)}function Fe(Ee,_e,De,Ve,_t){return _e===null||_e.tag!==7?(_e=ha(De,Ee.mode,Ve,_t),_e.return=Ee,_e):(_e=y(_e,De),_e.return=Ee,_e)}function He(Ee,_e,De){if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return _e=eh(""+_e,Ee.mode,De),_e.return=Ee,_e;if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case v:return De=Ic(_e.type,_e.key,_e.props,null,Ee.mode,De),gl(De,_e),De.return=Ee,De;case S:return _e=th(_e,Ee.mode,De),_e.return=Ee,_e;case M:return _e=ya(_e),He(Ee,_e,De)}if(I(_e)||O(_e))return _e=ha(_e,Ee.mode,De,null),_e.return=Ee,_e;if(typeof _e.then=="function")return He(Ee,Fc(_e),De);if(_e.$$typeof===T)return He(Ee,Bc(Ee,_e),De);Vc(Ee,_e)}return null}function Ie(Ee,_e,De,Ve){var _t=_e!==null?_e.key:null;if(typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint")return _t!==null?null:W(Ee,_e,""+De,Ve);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case v:return De.key===_t?me(Ee,_e,De,Ve):null;case S:return De.key===_t?ze(Ee,_e,De,Ve):null;case M:return De=ya(De),Ie(Ee,_e,De,Ve)}if(I(De)||O(De))return _t!==null?null:Fe(Ee,_e,De,Ve,null);if(typeof De.then=="function")return Ie(Ee,_e,Fc(De),Ve);if(De.$$typeof===T)return Ie(Ee,_e,Bc(Ee,De),Ve);Vc(Ee,De)}return null}function Pe(Ee,_e,De,Ve,_t){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number"||typeof Ve=="bigint")return Ee=Ee.get(De)||null,W(_e,Ee,""+Ve,_t);if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case v:return Ee=Ee.get(Ve.key===null?De:Ve.key)||null,me(_e,Ee,Ve,_t);case S:return Ee=Ee.get(Ve.key===null?De:Ve.key)||null,ze(_e,Ee,Ve,_t);case M:return Ve=ya(Ve),Pe(Ee,_e,De,Ve,_t)}if(I(Ve)||O(Ve))return Ee=Ee.get(De)||null,Fe(_e,Ee,Ve,_t,null);if(typeof Ve.then=="function")return Pe(Ee,_e,De,Fc(Ve),_t);if(Ve.$$typeof===T)return Pe(Ee,_e,De,Bc(_e,Ve),_t);Vc(_e,Ve)}return null}function ut(Ee,_e,De,Ve){for(var _t=null,pn=null,gt=_e,Pt=_e=0,tn=null;gt!==null&&Pt<De.length;Pt++){gt.index>Pt?(tn=gt,gt=null):tn=gt.sibling;var mn=Ie(Ee,gt,De[Pt],Ve);if(mn===null){gt===null&&(gt=tn);break}n&&gt&&mn.alternate===null&&i(Ee,gt),_e=b(mn,_e,Pt),pn===null?_t=mn:pn.sibling=mn,pn=mn,gt=tn}if(Pt===De.length)return l(Ee,gt),rn&&Ys(Ee,Pt),_t;if(gt===null){for(;Pt<De.length;Pt++)gt=He(Ee,De[Pt],Ve),gt!==null&&(_e=b(gt,_e,Pt),pn===null?_t=gt:pn.sibling=gt,pn=gt);return rn&&Ys(Ee,Pt),_t}for(gt=d(gt);Pt<De.length;Pt++)tn=Pe(gt,Ee,Pt,De[Pt],Ve),tn!==null&&(n&&tn.alternate!==null&&gt.delete(tn.key===null?Pt:tn.key),_e=b(tn,_e,Pt),pn===null?_t=tn:pn.sibling=tn,pn=tn);return n&&gt.forEach(function(Ki){return i(Ee,Ki)}),rn&&Ys(Ee,Pt),_t}function St(Ee,_e,De,Ve){if(De==null)throw Error(a(151));for(var _t=null,pn=null,gt=_e,Pt=_e=0,tn=null,mn=De.next();gt!==null&&!mn.done;Pt++,mn=De.next()){gt.index>Pt?(tn=gt,gt=null):tn=gt.sibling;var Ki=Ie(Ee,gt,mn.value,Ve);if(Ki===null){gt===null&&(gt=tn);break}n&&gt&&Ki.alternate===null&&i(Ee,gt),_e=b(Ki,_e,Pt),pn===null?_t=Ki:pn.sibling=Ki,pn=Ki,gt=tn}if(mn.done)return l(Ee,gt),rn&&Ys(Ee,Pt),_t;if(gt===null){for(;!mn.done;Pt++,mn=De.next())mn=He(Ee,mn.value,Ve),mn!==null&&(_e=b(mn,_e,Pt),pn===null?_t=mn:pn.sibling=mn,pn=mn);return rn&&Ys(Ee,Pt),_t}for(gt=d(gt);!mn.done;Pt++,mn=De.next())mn=Pe(gt,Ee,Pt,mn.value,Ve),mn!==null&&(n&&mn.alternate!==null&&gt.delete(mn.key===null?Pt:mn.key),_e=b(mn,_e,Pt),pn===null?_t=mn:pn.sibling=mn,pn=mn);return n&&gt.forEach(function(kS){return i(Ee,kS)}),rn&&Ys(Ee,Pt),_t}function Nn(Ee,_e,De,Ve){if(typeof De=="object"&&De!==null&&De.type===w&&De.key===null&&(De=De.props.children),typeof De=="object"&&De!==null){switch(De.$$typeof){case v:e:{for(var _t=De.key;_e!==null;){if(_e.key===_t){if(_t=De.type,_t===w){if(_e.tag===7){l(Ee,_e.sibling),Ve=y(_e,De.props.children),Ve.return=Ee,Ee=Ve;break e}}else if(_e.elementType===_t||typeof _t=="object"&&_t!==null&&_t.$$typeof===M&&ya(_t)===_e.type){l(Ee,_e.sibling),Ve=y(_e,De.props),gl(Ve,De),Ve.return=Ee,Ee=Ve;break e}l(Ee,_e);break}else i(Ee,_e);_e=_e.sibling}De.type===w?(Ve=ha(De.props.children,Ee.mode,Ve,De.key),Ve.return=Ee,Ee=Ve):(Ve=Ic(De.type,De.key,De.props,null,Ee.mode,Ve),gl(Ve,De),Ve.return=Ee,Ee=Ve)}return D(Ee);case S:e:{for(_t=De.key;_e!==null;){if(_e.key===_t)if(_e.tag===4&&_e.stateNode.containerInfo===De.containerInfo&&_e.stateNode.implementation===De.implementation){l(Ee,_e.sibling),Ve=y(_e,De.children||[]),Ve.return=Ee,Ee=Ve;break e}else{l(Ee,_e);break}else i(Ee,_e);_e=_e.sibling}Ve=th(De,Ee.mode,Ve),Ve.return=Ee,Ee=Ve}return D(Ee);case M:return De=ya(De),Nn(Ee,_e,De,Ve)}if(I(De))return ut(Ee,_e,De,Ve);if(O(De)){if(_t=O(De),typeof _t!="function")throw Error(a(150));return De=_t.call(De),St(Ee,_e,De,Ve)}if(typeof De.then=="function")return Nn(Ee,_e,Fc(De),Ve);if(De.$$typeof===T)return Nn(Ee,_e,Bc(Ee,De),Ve);Vc(Ee,De)}return typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint"?(De=""+De,_e!==null&&_e.tag===6?(l(Ee,_e.sibling),Ve=y(_e,De),Ve.return=Ee,Ee=Ve):(l(Ee,_e),Ve=eh(De,Ee.mode,Ve),Ve.return=Ee,Ee=Ve),D(Ee)):l(Ee,_e)}return function(Ee,_e,De,Ve){try{ml=0;var _t=Nn(Ee,_e,De,Ve);return ro=null,_t}catch(gt){if(gt===no||gt===$c)throw gt;var pn=Wr(29,gt,null,Ee.mode);return pn.lanes=Ve,pn.return=Ee,pn}}}var xa=hg(!0),fg=hg(!1),Ti=!1;function fh(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ph(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Ri(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Oi(n,i,l){var d=n.updateQueue;if(d===null)return null;if(d=d.shared,(yn&2)!==0){var y=d.pending;return y===null?i.next=i:(i.next=y.next,y.next=i),d.pending=i,i=zc(n),Qm(n,null,l),i}return Lc(n,d,i,l),zc(n)}function yl(n,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var d=i.lanes;d&=n.pendingLanes,l|=d,i.lanes=l,Ht(n,l)}}function mh(n,i){var l=n.updateQueue,d=n.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var y=null,b=null;if(l=l.firstBaseUpdate,l!==null){do{var D={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};b===null?y=b=D:b=b.next=D,l=l.next}while(l!==null);b===null?y=b=i:b=b.next=i}else y=b=i;l={baseState:d.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:d.shared,callbacks:d.callbacks},n.updateQueue=l;return}n=l.lastBaseUpdate,n===null?l.firstBaseUpdate=i:n.next=i,l.lastBaseUpdate=i}var gh=!1;function vl(){if(gh){var n=to;if(n!==null)throw n}}function xl(n,i,l,d){gh=!1;var y=n.updateQueue;Ti=!1;var b=y.firstBaseUpdate,D=y.lastBaseUpdate,W=y.shared.pending;if(W!==null){y.shared.pending=null;var me=W,ze=me.next;me.next=null,D===null?b=ze:D.next=ze,D=me;var Fe=n.alternate;Fe!==null&&(Fe=Fe.updateQueue,W=Fe.lastBaseUpdate,W!==D&&(W===null?Fe.firstBaseUpdate=ze:W.next=ze,Fe.lastBaseUpdate=me))}if(b!==null){var He=y.baseState;D=0,Fe=ze=me=null,W=b;do{var Ie=W.lane&-536870913,Pe=Ie!==W.lane;if(Pe?(en&Ie)===Ie:(d&Ie)===Ie){Ie!==0&&Ie===eo&&(gh=!0),Fe!==null&&(Fe=Fe.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var ut=n,St=W;Ie=i;var Nn=l;switch(St.tag){case 1:if(ut=St.payload,typeof ut=="function"){He=ut.call(Nn,He,Ie);break e}He=ut;break e;case 3:ut.flags=ut.flags&-65537|128;case 0:if(ut=St.payload,Ie=typeof ut=="function"?ut.call(Nn,He,Ie):ut,Ie==null)break e;He=g({},He,Ie);break e;case 2:Ti=!0}}Ie=W.callback,Ie!==null&&(n.flags|=64,Pe&&(n.flags|=8192),Pe=y.callbacks,Pe===null?y.callbacks=[Ie]:Pe.push(Ie))}else Pe={lane:Ie,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Fe===null?(ze=Fe=Pe,me=He):Fe=Fe.next=Pe,D|=Ie;if(W=W.next,W===null){if(W=y.shared.pending,W===null)break;Pe=W,W=Pe.next,Pe.next=null,y.lastBaseUpdate=Pe,y.shared.pending=null}}while(!0);Fe===null&&(me=He),y.baseState=me,y.firstBaseUpdate=ze,y.lastBaseUpdate=Fe,b===null&&(y.shared.lanes=0),Mi|=D,n.lanes=D,n.memoizedState=He}}function pg(n,i){if(typeof n!="function")throw Error(a(191,n));n.call(i)}function mg(n,i){var l=n.callbacks;if(l!==null)for(n.callbacks=null,n=0;n<l.length;n++)pg(l[n],i)}var so=A(null),Hc=A(0);function gg(n,i){n=ai,X(Hc,n),X(so,i),ai=n|i.baseLanes}function yh(){X(Hc,ai),X(so,so.current)}function vh(){ai=Hc.current,U(so),U(Hc)}var Yr=A(null),us=null;function Di(n){var i=n.alternate;X(er,er.current&1),X(Yr,n),us===null&&(i===null||so.current!==null||i.memoizedState!==null)&&(us=n)}function xh(n){X(er,er.current),X(Yr,n),us===null&&(us=n)}function yg(n){n.tag===22?(X(er,er.current),X(Yr,n),us===null&&(us=n)):Li()}function Li(){X(er,er.current),X(Yr,Yr.current)}function Qr(n){U(Yr),us===n&&(us=null),U(er)}var er=A(0);function Gc(n){for(var i=n;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||kf(l)||Ef(l)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Xs=0,Bt=null,kn=null,ir=null,Kc=!1,io=!1,ba=!1,Wc=0,bl=0,ao=null,gw=0;function Yn(){throw Error(a(321))}function bh(n,i){if(i===null)return!1;for(var l=0;l<i.length&&l<n.length;l++)if(!Kr(n[l],i[l]))return!1;return!0}function _h(n,i,l,d,y,b){return Xs=b,Bt=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,L.H=n===null||n.memoizedState===null?ey:Ih,ba=!1,b=l(d,y),ba=!1,io&&(b=xg(i,l,d,y)),vg(n),b}function vg(n){L.H=Sl;var i=kn!==null&&kn.next!==null;if(Xs=0,ir=kn=Bt=null,Kc=!1,bl=0,ao=null,i)throw Error(a(300));n===null||ar||(n=n.dependencies,n!==null&&Uc(n)&&(ar=!0))}function xg(n,i,l,d){Bt=n;var y=0;do{if(io&&(ao=null),bl=0,io=!1,25<=y)throw Error(a(301));if(y+=1,ir=kn=null,n.updateQueue!=null){var b=n.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}L.H=ty,b=i(l,d)}while(io);return b}function yw(){var n=L.H,i=n.useState()[0];return i=typeof i.then=="function"?_l(i):i,n=n.useState()[0],(kn!==null?kn.memoizedState:null)!==n&&(Bt.flags|=1024),i}function wh(){var n=Wc!==0;return Wc=0,n}function Sh(n,i,l){i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~l}function jh(n){if(Kc){for(n=n.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}Kc=!1}Xs=0,ir=kn=Bt=null,io=!1,bl=Wc=0,ao=null}function Dr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ir===null?Bt.memoizedState=ir=n:ir=ir.next=n,ir}function tr(){if(kn===null){var n=Bt.alternate;n=n!==null?n.memoizedState:null}else n=kn.next;var i=ir===null?Bt.memoizedState:ir.next;if(i!==null)ir=i,kn=n;else{if(n===null)throw Bt.alternate===null?Error(a(467)):Error(a(310));kn=n,n={memoizedState:kn.memoizedState,baseState:kn.baseState,baseQueue:kn.baseQueue,queue:kn.queue,next:null},ir===null?Bt.memoizedState=ir=n:ir=ir.next=n}return ir}function Yc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function _l(n){var i=bl;return bl+=1,ao===null&&(ao=[]),n=cg(ao,n,i),i=Bt,(ir===null?i.memoizedState:ir.next)===null&&(i=i.alternate,L.H=i===null||i.memoizedState===null?ey:Ih),n}function Qc(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return _l(n);if(n.$$typeof===T)return _r(n)}throw Error(a(438,String(n)))}function Ch(n){var i=null,l=Bt.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var d=Bt.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(i={data:d.data.map(function(y){return y.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=Yc(),Bt.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(n),d=0;d<n;d++)l[d]=P;return i.index++,l}function Zs(n,i){return typeof i=="function"?i(n):i}function Jc(n){var i=tr();return kh(i,kn,n)}function kh(n,i,l){var d=n.queue;if(d===null)throw Error(a(311));d.lastRenderedReducer=l;var y=n.baseQueue,b=d.pending;if(b!==null){if(y!==null){var D=y.next;y.next=b.next,b.next=D}i.baseQueue=y=b,d.pending=null}if(b=n.baseState,y===null)n.memoizedState=b;else{i=y.next;var W=D=null,me=null,ze=i,Fe=!1;do{var He=ze.lane&-536870913;if(He!==ze.lane?(en&He)===He:(Xs&He)===He){var Ie=ze.revertLane;if(Ie===0)me!==null&&(me=me.next={lane:0,revertLane:0,gesture:null,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null}),He===eo&&(Fe=!0);else if((Xs&Ie)===Ie){ze=ze.next,Ie===eo&&(Fe=!0);continue}else He={lane:0,revertLane:ze.revertLane,gesture:null,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null},me===null?(W=me=He,D=b):me=me.next=He,Bt.lanes|=Ie,Mi|=Ie;He=ze.action,ba&&l(b,He),b=ze.hasEagerState?ze.eagerState:l(b,He)}else Ie={lane:He,revertLane:ze.revertLane,gesture:ze.gesture,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null},me===null?(W=me=Ie,D=b):me=me.next=Ie,Bt.lanes|=He,Mi|=He;ze=ze.next}while(ze!==null&&ze!==i);if(me===null?D=b:me.next=W,!Kr(b,n.memoizedState)&&(ar=!0,Fe&&(l=to,l!==null)))throw l;n.memoizedState=b,n.baseState=D,n.baseQueue=me,d.lastRenderedState=b}return y===null&&(d.lanes=0),[n.memoizedState,d.dispatch]}function Eh(n){var i=tr(),l=i.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=n;var d=l.dispatch,y=l.pending,b=i.memoizedState;if(y!==null){l.pending=null;var D=y=y.next;do b=n(b,D.action),D=D.next;while(D!==y);Kr(b,i.memoizedState)||(ar=!0),i.memoizedState=b,i.baseQueue===null&&(i.baseState=b),l.lastRenderedState=b}return[b,d]}function bg(n,i,l){var d=Bt,y=tr(),b=rn;if(b){if(l===void 0)throw Error(a(407));l=l()}else l=i();var D=!Kr((kn||y).memoizedState,l);if(D&&(y.memoizedState=l,ar=!0),y=y.queue,Th(Sg.bind(null,d,y,n),[n]),y.getSnapshot!==i||D||ir!==null&&ir.memoizedState.tag&1){if(d.flags|=2048,oo(9,{destroy:void 0},wg.bind(null,d,y,l,i),null),Rn===null)throw Error(a(349));b||(Xs&127)!==0||_g(d,i,l)}return l}function _g(n,i,l){n.flags|=16384,n={getSnapshot:i,value:l},i=Bt.updateQueue,i===null?(i=Yc(),Bt.updateQueue=i,i.stores=[n]):(l=i.stores,l===null?i.stores=[n]:l.push(n))}function wg(n,i,l,d){i.value=l,i.getSnapshot=d,jg(i)&&Cg(n)}function Sg(n,i,l){return l(function(){jg(i)&&Cg(n)})}function jg(n){var i=n.getSnapshot;n=n.value;try{var l=i();return!Kr(n,l)}catch{return!0}}function Cg(n){var i=da(n,2);i!==null&&qr(i,n,2)}function Nh(n){var i=Dr();if(typeof n=="function"){var l=n;if(n=l(),ba){on(!0);try{l()}finally{on(!1)}}}return i.memoizedState=i.baseState=n,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zs,lastRenderedState:n},i}function kg(n,i,l,d){return n.baseState=l,kh(n,kn,typeof d=="function"?d:Zs)}function vw(n,i,l,d,y){if(eu(n))throw Error(a(485));if(n=i.action,n!==null){var b={payload:y,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(D){b.listeners.push(D)}};L.T!==null?l(!0):b.isTransition=!1,d(b),l=i.pending,l===null?(b.next=i.pending=b,Eg(i,b)):(b.next=l.next,i.pending=l.next=b)}}function Eg(n,i){var l=i.action,d=i.payload,y=n.state;if(i.isTransition){var b=L.T,D={};L.T=D;try{var W=l(y,d),me=L.S;me!==null&&me(D,W),Ng(n,i,W)}catch(ze){Ah(n,i,ze)}finally{b!==null&&D.types!==null&&(b.types=D.types),L.T=b}}else try{b=l(y,d),Ng(n,i,b)}catch(ze){Ah(n,i,ze)}}function Ng(n,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(d){Ag(n,i,d)},function(d){return Ah(n,i,d)}):Ag(n,i,l)}function Ag(n,i,l){i.status="fulfilled",i.value=l,Tg(i),n.state=l,i=n.pending,i!==null&&(l=i.next,l===i?n.pending=null:(l=l.next,i.next=l,Eg(n,l)))}function Ah(n,i,l){var d=n.pending;if(n.pending=null,d!==null){d=d.next;do i.status="rejected",i.reason=l,Tg(i),i=i.next;while(i!==d)}n.action=null}function Tg(n){n=n.listeners;for(var i=0;i<n.length;i++)(0,n[i])()}function Rg(n,i){return i}function Og(n,i){if(rn){var l=Rn.formState;if(l!==null){e:{var d=Bt;if(rn){if(Mn){t:{for(var y=Mn,b=cs;y.nodeType!==8;){if(!b){y=null;break t}if(y=ds(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){Mn=ds(y.nextSibling),d=y.data==="F!";break e}}Ni(d)}d=!1}d&&(i=l[0])}}return l=Dr(),l.memoizedState=l.baseState=i,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rg,lastRenderedState:i},l.queue=d,l=Jg.bind(null,Bt,d),d.dispatch=l,d=Nh(!1),b=zh.bind(null,Bt,!1,d.queue),d=Dr(),y={state:i,dispatch:null,action:n,pending:null},d.queue=y,l=vw.bind(null,Bt,y,b,l),y.dispatch=l,d.memoizedState=n,[i,l,!1]}function Dg(n){var i=tr();return Lg(i,kn,n)}function Lg(n,i,l){if(i=kh(n,i,Rg)[0],n=Jc(Zs)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var d=_l(i)}catch(D){throw D===no?$c:D}else d=i;i=tr();var y=i.queue,b=y.dispatch;return l!==i.memoizedState&&(Bt.flags|=2048,oo(9,{destroy:void 0},xw.bind(null,y,l),null)),[d,b,n]}function xw(n,i){n.action=i}function zg(n){var i=tr(),l=kn;if(l!==null)return Lg(i,l,n);tr(),i=i.memoizedState,l=tr();var d=l.queue.dispatch;return l.memoizedState=n,[i,d,!1]}function oo(n,i,l,d){return n={tag:n,create:l,deps:d,inst:i,next:null},i=Bt.updateQueue,i===null&&(i=Yc(),Bt.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=n.next=n:(d=l.next,l.next=n,n.next=d,i.lastEffect=n),n}function Ig(){return tr().memoizedState}function Xc(n,i,l,d){var y=Dr();Bt.flags|=n,y.memoizedState=oo(1|i,{destroy:void 0},l,d===void 0?null:d)}function Zc(n,i,l,d){var y=tr();d=d===void 0?null:d;var b=y.memoizedState.inst;kn!==null&&d!==null&&bh(d,kn.memoizedState.deps)?y.memoizedState=oo(i,b,l,d):(Bt.flags|=n,y.memoizedState=oo(1|i,b,l,d))}function Mg(n,i){Xc(8390656,8,n,i)}function Th(n,i){Zc(2048,8,n,i)}function bw(n){Bt.flags|=4;var i=Bt.updateQueue;if(i===null)i=Yc(),Bt.updateQueue=i,i.events=[n];else{var l=i.events;l===null?i.events=[n]:l.push(n)}}function Ug(n){var i=tr().memoizedState;return bw({ref:i,nextImpl:n}),function(){if((yn&2)!==0)throw Error(a(440));return i.impl.apply(void 0,arguments)}}function Bg(n,i){return Zc(4,2,n,i)}function Pg(n,i){return Zc(4,4,n,i)}function $g(n,i){if(typeof i=="function"){n=n();var l=i(n);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function qg(n,i,l){l=l!=null?l.concat([n]):null,Zc(4,4,$g.bind(null,i,n),l)}function Rh(){}function Fg(n,i){var l=tr();i=i===void 0?null:i;var d=l.memoizedState;return i!==null&&bh(i,d[1])?d[0]:(l.memoizedState=[n,i],n)}function Vg(n,i){var l=tr();i=i===void 0?null:i;var d=l.memoizedState;if(i!==null&&bh(i,d[1]))return d[0];if(d=n(),ba){on(!0);try{n()}finally{on(!1)}}return l.memoizedState=[d,i],d}function Oh(n,i,l){return l===void 0||(Xs&1073741824)!==0&&(en&261930)===0?n.memoizedState=i:(n.memoizedState=l,n=Hy(),Bt.lanes|=n,Mi|=n,l)}function Hg(n,i,l,d){return Kr(l,i)?l:so.current!==null?(n=Oh(n,l,d),Kr(n,i)||(ar=!0),n):(Xs&42)===0||(Xs&1073741824)!==0&&(en&261930)===0?(ar=!0,n.memoizedState=l):(n=Hy(),Bt.lanes|=n,Mi|=n,i)}function Gg(n,i,l,d,y){var b=V.p;V.p=b!==0&&8>b?b:8;var D=L.T,W={};L.T=W,zh(n,!1,i,l);try{var me=y(),ze=L.S;if(ze!==null&&ze(W,me),me!==null&&typeof me=="object"&&typeof me.then=="function"){var Fe=mw(me,d);wl(n,i,Fe,Zr(n))}else wl(n,i,d,Zr(n))}catch(He){wl(n,i,{then:function(){},status:"rejected",reason:He},Zr())}finally{V.p=b,D!==null&&W.types!==null&&(D.types=W.types),L.T=D}}function _w(){}function Dh(n,i,l,d){if(n.tag!==5)throw Error(a(476));var y=Kg(n).queue;Gg(n,y,i,G,l===null?_w:function(){return Wg(n),l(d)})}function Kg(n){var i=n.memoizedState;if(i!==null)return i;i={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zs,lastRenderedState:G},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zs,lastRenderedState:l},next:null},n.memoizedState=i,n=n.alternate,n!==null&&(n.memoizedState=i),i}function Wg(n){var i=Kg(n);i.next===null&&(i=n.alternate.memoizedState),wl(n,i.next.queue,{},Zr())}function Lh(){return _r(Bl)}function Yg(){return tr().memoizedState}function Qg(){return tr().memoizedState}function ww(n){for(var i=n.return;i!==null;){switch(i.tag){case 24:case 3:var l=Zr();n=Ri(l);var d=Oi(i,n,l);d!==null&&(qr(d,i,l),yl(d,i,l)),i={cache:ch()},n.payload=i;return}i=i.return}}function Sw(n,i,l){var d=Zr();l={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},eu(n)?Xg(i,l):(l=Xd(n,i,l,d),l!==null&&(qr(l,n,d),Zg(l,i,d)))}function Jg(n,i,l){var d=Zr();wl(n,i,l,d)}function wl(n,i,l,d){var y={lane:d,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(eu(n))Xg(i,y);else{var b=n.alternate;if(n.lanes===0&&(b===null||b.lanes===0)&&(b=i.lastRenderedReducer,b!==null))try{var D=i.lastRenderedState,W=b(D,l);if(y.hasEagerState=!0,y.eagerState=W,Kr(W,D))return Lc(n,i,y,0),Rn===null&&Dc(),!1}catch{}if(l=Xd(n,i,y,d),l!==null)return qr(l,n,d),Zg(l,i,d),!0}return!1}function zh(n,i,l,d){if(d={lane:2,revertLane:pf(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},eu(n)){if(i)throw Error(a(479))}else i=Xd(n,l,d,2),i!==null&&qr(i,n,2)}function eu(n){var i=n.alternate;return n===Bt||i!==null&&i===Bt}function Xg(n,i){io=Kc=!0;var l=n.pending;l===null?i.next=i:(i.next=l.next,l.next=i),n.pending=i}function Zg(n,i,l){if((l&4194048)!==0){var d=i.lanes;d&=n.pendingLanes,l|=d,i.lanes=l,Ht(n,l)}}var Sl={readContext:_r,use:Qc,useCallback:Yn,useContext:Yn,useEffect:Yn,useImperativeHandle:Yn,useLayoutEffect:Yn,useInsertionEffect:Yn,useMemo:Yn,useReducer:Yn,useRef:Yn,useState:Yn,useDebugValue:Yn,useDeferredValue:Yn,useTransition:Yn,useSyncExternalStore:Yn,useId:Yn,useHostTransitionStatus:Yn,useFormState:Yn,useActionState:Yn,useOptimistic:Yn,useMemoCache:Yn,useCacheRefresh:Yn};Sl.useEffectEvent=Yn;var ey={readContext:_r,use:Qc,useCallback:function(n,i){return Dr().memoizedState=[n,i===void 0?null:i],n},useContext:_r,useEffect:Mg,useImperativeHandle:function(n,i,l){l=l!=null?l.concat([n]):null,Xc(4194308,4,$g.bind(null,i,n),l)},useLayoutEffect:function(n,i){return Xc(4194308,4,n,i)},useInsertionEffect:function(n,i){Xc(4,2,n,i)},useMemo:function(n,i){var l=Dr();i=i===void 0?null:i;var d=n();if(ba){on(!0);try{n()}finally{on(!1)}}return l.memoizedState=[d,i],d},useReducer:function(n,i,l){var d=Dr();if(l!==void 0){var y=l(i);if(ba){on(!0);try{l(i)}finally{on(!1)}}}else y=i;return d.memoizedState=d.baseState=y,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:y},d.queue=n,n=n.dispatch=Sw.bind(null,Bt,n),[d.memoizedState,n]},useRef:function(n){var i=Dr();return n={current:n},i.memoizedState=n},useState:function(n){n=Nh(n);var i=n.queue,l=Jg.bind(null,Bt,i);return i.dispatch=l,[n.memoizedState,l]},useDebugValue:Rh,useDeferredValue:function(n,i){var l=Dr();return Oh(l,n,i)},useTransition:function(){var n=Nh(!1);return n=Gg.bind(null,Bt,n.queue,!0,!1),Dr().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,i,l){var d=Bt,y=Dr();if(rn){if(l===void 0)throw Error(a(407));l=l()}else{if(l=i(),Rn===null)throw Error(a(349));(en&127)!==0||_g(d,i,l)}y.memoizedState=l;var b={value:l,getSnapshot:i};return y.queue=b,Mg(Sg.bind(null,d,b,n),[n]),d.flags|=2048,oo(9,{destroy:void 0},wg.bind(null,d,b,l,i),null),l},useId:function(){var n=Dr(),i=Rn.identifierPrefix;if(rn){var l=Ms,d=Is;l=(d&~(1<<32-Ot(d)-1)).toString(32)+l,i="_"+i+"R_"+l,l=Wc++,0<l&&(i+="H"+l.toString(32)),i+="_"}else l=gw++,i="_"+i+"r_"+l.toString(32)+"_";return n.memoizedState=i},useHostTransitionStatus:Lh,useFormState:Og,useActionState:Og,useOptimistic:function(n){var i=Dr();i.memoizedState=i.baseState=n;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=zh.bind(null,Bt,!0,l),l.dispatch=i,[n,i]},useMemoCache:Ch,useCacheRefresh:function(){return Dr().memoizedState=ww.bind(null,Bt)},useEffectEvent:function(n){var i=Dr(),l={impl:n};return i.memoizedState=l,function(){if((yn&2)!==0)throw Error(a(440));return l.impl.apply(void 0,arguments)}}},Ih={readContext:_r,use:Qc,useCallback:Fg,useContext:_r,useEffect:Th,useImperativeHandle:qg,useInsertionEffect:Bg,useLayoutEffect:Pg,useMemo:Vg,useReducer:Jc,useRef:Ig,useState:function(){return Jc(Zs)},useDebugValue:Rh,useDeferredValue:function(n,i){var l=tr();return Hg(l,kn.memoizedState,n,i)},useTransition:function(){var n=Jc(Zs)[0],i=tr().memoizedState;return[typeof n=="boolean"?n:_l(n),i]},useSyncExternalStore:bg,useId:Yg,useHostTransitionStatus:Lh,useFormState:Dg,useActionState:Dg,useOptimistic:function(n,i){var l=tr();return kg(l,kn,n,i)},useMemoCache:Ch,useCacheRefresh:Qg};Ih.useEffectEvent=Ug;var ty={readContext:_r,use:Qc,useCallback:Fg,useContext:_r,useEffect:Th,useImperativeHandle:qg,useInsertionEffect:Bg,useLayoutEffect:Pg,useMemo:Vg,useReducer:Eh,useRef:Ig,useState:function(){return Eh(Zs)},useDebugValue:Rh,useDeferredValue:function(n,i){var l=tr();return kn===null?Oh(l,n,i):Hg(l,kn.memoizedState,n,i)},useTransition:function(){var n=Eh(Zs)[0],i=tr().memoizedState;return[typeof n=="boolean"?n:_l(n),i]},useSyncExternalStore:bg,useId:Yg,useHostTransitionStatus:Lh,useFormState:zg,useActionState:zg,useOptimistic:function(n,i){var l=tr();return kn!==null?kg(l,kn,n,i):(l.baseState=n,[n,l.queue.dispatch])},useMemoCache:Ch,useCacheRefresh:Qg};ty.useEffectEvent=Ug;function Mh(n,i,l,d){i=n.memoizedState,l=l(d,i),l=l==null?i:g({},i,l),n.memoizedState=l,n.lanes===0&&(n.updateQueue.baseState=l)}var Uh={enqueueSetState:function(n,i,l){n=n._reactInternals;var d=Zr(),y=Ri(d);y.payload=i,l!=null&&(y.callback=l),i=Oi(n,y,d),i!==null&&(qr(i,n,d),yl(i,n,d))},enqueueReplaceState:function(n,i,l){n=n._reactInternals;var d=Zr(),y=Ri(d);y.tag=1,y.payload=i,l!=null&&(y.callback=l),i=Oi(n,y,d),i!==null&&(qr(i,n,d),yl(i,n,d))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var l=Zr(),d=Ri(l);d.tag=2,i!=null&&(d.callback=i),i=Oi(n,d,l),i!==null&&(qr(i,n,l),yl(i,n,l))}};function ny(n,i,l,d,y,b,D){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(d,b,D):i.prototype&&i.prototype.isPureReactComponent?!cl(l,d)||!cl(y,b):!0}function ry(n,i,l,d){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,d),i.state!==n&&Uh.enqueueReplaceState(i,i.state,null)}function _a(n,i){var l=i;if("ref"in i){l={};for(var d in i)d!=="ref"&&(l[d]=i[d])}if(n=n.defaultProps){l===i&&(l=g({},l));for(var y in n)l[y]===void 0&&(l[y]=n[y])}return l}function sy(n){Oc(n)}function iy(n){console.error(n)}function ay(n){Oc(n)}function tu(n,i){try{var l=n.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(d){setTimeout(function(){throw d})}}function oy(n,i,l){try{var d=n.onCaughtError;d(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function Bh(n,i,l){return l=Ri(l),l.tag=3,l.payload={element:null},l.callback=function(){tu(n,i)},l}function ly(n){return n=Ri(n),n.tag=3,n}function cy(n,i,l,d){var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var b=d.value;n.payload=function(){return y(b)},n.callback=function(){oy(i,l,d)}}var D=l.stateNode;D!==null&&typeof D.componentDidCatch=="function"&&(n.callback=function(){oy(i,l,d),typeof y!="function"&&(Ui===null?Ui=new Set([this]):Ui.add(this));var W=d.stack;this.componentDidCatch(d.value,{componentStack:W!==null?W:""})})}function jw(n,i,l,d,y){if(l.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(i=l.alternate,i!==null&&Za(i,l,y,!0),l=Yr.current,l!==null){switch(l.tag){case 31:case 13:return us===null?fu():l.alternate===null&&Qn===0&&(Qn=3),l.flags&=-257,l.flags|=65536,l.lanes=y,d===qc?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([d]):i.add(d),df(n,d,y)),!1;case 22:return l.flags|=65536,d===qc?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([d])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([d]):l.add(d)),df(n,d,y)),!1}throw Error(a(435,l.tag))}return df(n,d,y),fu(),!1}if(rn)return i=Yr.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=y,d!==sh&&(n=Error(a(422),{cause:d}),hl(as(n,l)))):(d!==sh&&(i=Error(a(423),{cause:d}),hl(as(i,l))),n=n.current.alternate,n.flags|=65536,y&=-y,n.lanes|=y,d=as(d,l),y=Bh(n.stateNode,d,y),mh(n,y),Qn!==4&&(Qn=2)),!1;var b=Error(a(520),{cause:d});if(b=as(b,l),Rl===null?Rl=[b]:Rl.push(b),Qn!==4&&(Qn=2),i===null)return!0;d=as(d,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,n=y&-y,l.lanes|=n,n=Bh(l.stateNode,d,n),mh(l,n),!1;case 1:if(i=l.type,b=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ui===null||!Ui.has(b))))return l.flags|=65536,y&=-y,l.lanes|=y,y=ly(y),cy(y,n,l,d),mh(l,y),!1}l=l.return}while(l!==null);return!1}var Ph=Error(a(461)),ar=!1;function wr(n,i,l,d){i.child=n===null?fg(i,null,l,d):xa(i,n.child,l,d)}function uy(n,i,l,d,y){l=l.render;var b=i.ref;if("ref"in d){var D={};for(var W in d)W!=="ref"&&(D[W]=d[W])}else D=d;return ma(i),d=_h(n,i,l,D,b,y),W=wh(),n!==null&&!ar?(Sh(n,i,y),ei(n,i,y)):(rn&&W&&nh(i),i.flags|=1,wr(n,i,d,y),i.child)}function dy(n,i,l,d,y){if(n===null){var b=l.type;return typeof b=="function"&&!Zd(b)&&b.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=b,hy(n,i,b,d,y)):(n=Ic(l.type,null,d,i,i.mode,y),n.ref=i.ref,n.return=i,i.child=n)}if(b=n.child,!Wh(n,y)){var D=b.memoizedProps;if(l=l.compare,l=l!==null?l:cl,l(D,d)&&n.ref===i.ref)return ei(n,i,y)}return i.flags|=1,n=Ws(b,d),n.ref=i.ref,n.return=i,i.child=n}function hy(n,i,l,d,y){if(n!==null){var b=n.memoizedProps;if(cl(b,d)&&n.ref===i.ref)if(ar=!1,i.pendingProps=d=b,Wh(n,y))(n.flags&131072)!==0&&(ar=!0);else return i.lanes=n.lanes,ei(n,i,y)}return $h(n,i,l,d,y)}function fy(n,i,l,d){var y=d.children,b=n!==null?n.memoizedState:null;if(n===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((i.flags&128)!==0){if(b=b!==null?b.baseLanes|l:l,n!==null){for(d=i.child=n.child,y=0;d!==null;)y=y|d.lanes|d.childLanes,d=d.sibling;d=y&~b}else d=0,i.child=null;return py(n,i,b,l,d)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},n!==null&&Pc(i,b!==null?b.cachePool:null),b!==null?gg(i,b):yh(),yg(i);else return d=i.lanes=536870912,py(n,i,b!==null?b.baseLanes|l:l,l,d)}else b!==null?(Pc(i,b.cachePool),gg(i,b),Li(),i.memoizedState=null):(n!==null&&Pc(i,null),yh(),Li());return wr(n,i,y,l),i.child}function jl(n,i){return n!==null&&n.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function py(n,i,l,d,y){var b=dh();return b=b===null?null:{parent:sr._currentValue,pool:b},i.memoizedState={baseLanes:l,cachePool:b},n!==null&&Pc(i,null),yh(),yg(i),n!==null&&Za(n,i,d,!0),i.childLanes=y,null}function nu(n,i){return i=su({mode:i.mode,children:i.children},n.mode),i.ref=n.ref,n.child=i,i.return=n,i}function my(n,i,l){return xa(i,n.child,null,l),n=nu(i,i.pendingProps),n.flags|=2,Qr(i),i.memoizedState=null,n}function Cw(n,i,l){var d=i.pendingProps,y=(i.flags&128)!==0;if(i.flags&=-129,n===null){if(rn){if(d.mode==="hidden")return n=nu(i,d),i.lanes=536870912,jl(null,n);if(xh(i),(n=Mn)?(n=Ev(n,cs),n=n!==null&&n.data==="&"?n:null,n!==null&&(i.memoizedState={dehydrated:n,treeContext:ki!==null?{id:Is,overflow:Ms}:null,retryLane:536870912,hydrationErrors:null},l=Xm(n),l.return=i,i.child=l,br=i,Mn=null)):n=null,n===null)throw Ni(i);return i.lanes=536870912,null}return nu(i,d)}var b=n.memoizedState;if(b!==null){var D=b.dehydrated;if(xh(i),y)if(i.flags&256)i.flags&=-257,i=my(n,i,l);else if(i.memoizedState!==null)i.child=n.child,i.flags|=128,i=null;else throw Error(a(558));else if(ar||Za(n,i,l,!1),y=(l&n.childLanes)!==0,ar||y){if(d=Rn,d!==null&&(D=Cn(d,l),D!==0&&D!==b.retryLane))throw b.retryLane=D,da(n,D),qr(d,n,D),Ph;fu(),i=my(n,i,l)}else n=b.treeContext,Mn=ds(D.nextSibling),br=i,rn=!0,Ei=null,cs=!1,n!==null&&tg(i,n),i=nu(i,d),i.flags|=4096;return i}return n=Ws(n.child,{mode:d.mode,children:d.children}),n.ref=i.ref,i.child=n,n.return=i,n}function ru(n,i){var l=i.ref;if(l===null)n!==null&&n.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(a(284));(n===null||n.ref!==l)&&(i.flags|=4194816)}}function $h(n,i,l,d,y){return ma(i),l=_h(n,i,l,d,void 0,y),d=wh(),n!==null&&!ar?(Sh(n,i,y),ei(n,i,y)):(rn&&d&&nh(i),i.flags|=1,wr(n,i,l,y),i.child)}function gy(n,i,l,d,y,b){return ma(i),i.updateQueue=null,l=xg(i,d,l,y),vg(n),d=wh(),n!==null&&!ar?(Sh(n,i,b),ei(n,i,b)):(rn&&d&&nh(i),i.flags|=1,wr(n,i,l,b),i.child)}function yy(n,i,l,d,y){if(ma(i),i.stateNode===null){var b=Ya,D=l.contextType;typeof D=="object"&&D!==null&&(b=_r(D)),b=new l(d,b),i.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Uh,i.stateNode=b,b._reactInternals=i,b=i.stateNode,b.props=d,b.state=i.memoizedState,b.refs={},fh(i),D=l.contextType,b.context=typeof D=="object"&&D!==null?_r(D):Ya,b.state=i.memoizedState,D=l.getDerivedStateFromProps,typeof D=="function"&&(Mh(i,l,D,d),b.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(D=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),D!==b.state&&Uh.enqueueReplaceState(b,b.state,null),xl(i,d,b,y),vl(),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308),d=!0}else if(n===null){b=i.stateNode;var W=i.memoizedProps,me=_a(l,W);b.props=me;var ze=b.context,Fe=l.contextType;D=Ya,typeof Fe=="object"&&Fe!==null&&(D=_r(Fe));var He=l.getDerivedStateFromProps;Fe=typeof He=="function"||typeof b.getSnapshotBeforeUpdate=="function",W=i.pendingProps!==W,Fe||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(W||ze!==D)&&ry(i,b,d,D),Ti=!1;var Ie=i.memoizedState;b.state=Ie,xl(i,d,b,y),vl(),ze=i.memoizedState,W||Ie!==ze||Ti?(typeof He=="function"&&(Mh(i,l,He,d),ze=i.memoizedState),(me=Ti||ny(i,l,me,d,Ie,ze,D))?(Fe||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(i.flags|=4194308)):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=ze),b.props=d,b.state=ze,b.context=D,d=me):(typeof b.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{b=i.stateNode,ph(n,i),D=i.memoizedProps,Fe=_a(l,D),b.props=Fe,He=i.pendingProps,Ie=b.context,ze=l.contextType,me=Ya,typeof ze=="object"&&ze!==null&&(me=_r(ze)),W=l.getDerivedStateFromProps,(ze=typeof W=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(D!==He||Ie!==me)&&ry(i,b,d,me),Ti=!1,Ie=i.memoizedState,b.state=Ie,xl(i,d,b,y),vl();var Pe=i.memoizedState;D!==He||Ie!==Pe||Ti||n!==null&&n.dependencies!==null&&Uc(n.dependencies)?(typeof W=="function"&&(Mh(i,l,W,d),Pe=i.memoizedState),(Fe=Ti||ny(i,l,Fe,d,Ie,Pe,me)||n!==null&&n.dependencies!==null&&Uc(n.dependencies))?(ze||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(d,Pe,me),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(d,Pe,me)),typeof b.componentDidUpdate=="function"&&(i.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof b.componentDidUpdate!="function"||D===n.memoizedProps&&Ie===n.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||D===n.memoizedProps&&Ie===n.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=Pe),b.props=d,b.state=Pe,b.context=me,d=Fe):(typeof b.componentDidUpdate!="function"||D===n.memoizedProps&&Ie===n.memoizedState||(i.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||D===n.memoizedProps&&Ie===n.memoizedState||(i.flags|=1024),d=!1)}return b=d,ru(n,i),d=(i.flags&128)!==0,b||d?(b=i.stateNode,l=d&&typeof l.getDerivedStateFromError!="function"?null:b.render(),i.flags|=1,n!==null&&d?(i.child=xa(i,n.child,null,y),i.child=xa(i,null,l,y)):wr(n,i,l,y),i.memoizedState=b.state,n=i.child):n=ei(n,i,y),n}function vy(n,i,l,d){return fa(),i.flags|=256,wr(n,i,l,d),i.child}var qh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Fh(n){return{baseLanes:n,cachePool:og()}}function Vh(n,i,l){return n=n!==null?n.childLanes&~l:0,i&&(n|=Xr),n}function xy(n,i,l){var d=i.pendingProps,y=!1,b=(i.flags&128)!==0,D;if((D=b)||(D=n!==null&&n.memoizedState===null?!1:(er.current&2)!==0),D&&(y=!0,i.flags&=-129),D=(i.flags&32)!==0,i.flags&=-33,n===null){if(rn){if(y?Di(i):Li(),(n=Mn)?(n=Ev(n,cs),n=n!==null&&n.data!=="&"?n:null,n!==null&&(i.memoizedState={dehydrated:n,treeContext:ki!==null?{id:Is,overflow:Ms}:null,retryLane:536870912,hydrationErrors:null},l=Xm(n),l.return=i,i.child=l,br=i,Mn=null)):n=null,n===null)throw Ni(i);return Ef(n)?i.lanes=32:i.lanes=536870912,null}var W=d.children;return d=d.fallback,y?(Li(),y=i.mode,W=su({mode:"hidden",children:W},y),d=ha(d,y,l,null),W.return=i,d.return=i,W.sibling=d,i.child=W,d=i.child,d.memoizedState=Fh(l),d.childLanes=Vh(n,D,l),i.memoizedState=qh,jl(null,d)):(Di(i),Hh(i,W))}var me=n.memoizedState;if(me!==null&&(W=me.dehydrated,W!==null)){if(b)i.flags&256?(Di(i),i.flags&=-257,i=Gh(n,i,l)):i.memoizedState!==null?(Li(),i.child=n.child,i.flags|=128,i=null):(Li(),W=d.fallback,y=i.mode,d=su({mode:"visible",children:d.children},y),W=ha(W,y,l,null),W.flags|=2,d.return=i,W.return=i,d.sibling=W,i.child=d,xa(i,n.child,null,l),d=i.child,d.memoizedState=Fh(l),d.childLanes=Vh(n,D,l),i.memoizedState=qh,i=jl(null,d));else if(Di(i),Ef(W)){if(D=W.nextSibling&&W.nextSibling.dataset,D)var ze=D.dgst;D=ze,d=Error(a(419)),d.stack="",d.digest=D,hl({value:d,source:null,stack:null}),i=Gh(n,i,l)}else if(ar||Za(n,i,l,!1),D=(l&n.childLanes)!==0,ar||D){if(D=Rn,D!==null&&(d=Cn(D,l),d!==0&&d!==me.retryLane))throw me.retryLane=d,da(n,d),qr(D,n,d),Ph;kf(W)||fu(),i=Gh(n,i,l)}else kf(W)?(i.flags|=192,i.child=n.child,i=null):(n=me.treeContext,Mn=ds(W.nextSibling),br=i,rn=!0,Ei=null,cs=!1,n!==null&&tg(i,n),i=Hh(i,d.children),i.flags|=4096);return i}return y?(Li(),W=d.fallback,y=i.mode,me=n.child,ze=me.sibling,d=Ws(me,{mode:"hidden",children:d.children}),d.subtreeFlags=me.subtreeFlags&65011712,ze!==null?W=Ws(ze,W):(W=ha(W,y,l,null),W.flags|=2),W.return=i,d.return=i,d.sibling=W,i.child=d,jl(null,d),d=i.child,W=n.child.memoizedState,W===null?W=Fh(l):(y=W.cachePool,y!==null?(me=sr._currentValue,y=y.parent!==me?{parent:me,pool:me}:y):y=og(),W={baseLanes:W.baseLanes|l,cachePool:y}),d.memoizedState=W,d.childLanes=Vh(n,D,l),i.memoizedState=qh,jl(n.child,d)):(Di(i),l=n.child,n=l.sibling,l=Ws(l,{mode:"visible",children:d.children}),l.return=i,l.sibling=null,n!==null&&(D=i.deletions,D===null?(i.deletions=[n],i.flags|=16):D.push(n)),i.child=l,i.memoizedState=null,l)}function Hh(n,i){return i=su({mode:"visible",children:i},n.mode),i.return=n,n.child=i}function su(n,i){return n=Wr(22,n,null,i),n.lanes=0,n}function Gh(n,i,l){return xa(i,n.child,null,l),n=Hh(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function by(n,i,l){n.lanes|=i;var d=n.alternate;d!==null&&(d.lanes|=i),oh(n.return,i,l)}function Kh(n,i,l,d,y,b){var D=n.memoizedState;D===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:y,treeForkCount:b}:(D.isBackwards=i,D.rendering=null,D.renderingStartTime=0,D.last=d,D.tail=l,D.tailMode=y,D.treeForkCount=b)}function _y(n,i,l){var d=i.pendingProps,y=d.revealOrder,b=d.tail;d=d.children;var D=er.current,W=(D&2)!==0;if(W?(D=D&1|2,i.flags|=128):D&=1,X(er,D),wr(n,i,d,l),d=rn?dl:0,!W&&n!==null&&(n.flags&128)!==0)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&by(n,l,i);else if(n.tag===19)by(n,l,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(y){case"forwards":for(l=i.child,y=null;l!==null;)n=l.alternate,n!==null&&Gc(n)===null&&(y=l),l=l.sibling;l=y,l===null?(y=i.child,i.child=null):(y=l.sibling,l.sibling=null),Kh(i,!1,y,l,b,d);break;case"backwards":case"unstable_legacy-backwards":for(l=null,y=i.child,i.child=null;y!==null;){if(n=y.alternate,n!==null&&Gc(n)===null){i.child=y;break}n=y.sibling,y.sibling=l,l=y,y=n}Kh(i,!0,l,null,b,d);break;case"together":Kh(i,!1,null,null,void 0,d);break;default:i.memoizedState=null}return i.child}function ei(n,i,l){if(n!==null&&(i.dependencies=n.dependencies),Mi|=i.lanes,(l&i.childLanes)===0)if(n!==null){if(Za(n,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(n!==null&&i.child!==n.child)throw Error(a(153));if(i.child!==null){for(n=i.child,l=Ws(n,n.pendingProps),i.child=l,l.return=i;n.sibling!==null;)n=n.sibling,l=l.sibling=Ws(n,n.pendingProps),l.return=i;l.sibling=null}return i.child}function Wh(n,i){return(n.lanes&i)!==0?!0:(n=n.dependencies,!!(n!==null&&Uc(n)))}function kw(n,i,l){switch(i.tag){case 3:ne(i,i.stateNode.containerInfo),Ai(i,sr,n.memoizedState.cache),fa();break;case 27:case 5:Le(i);break;case 4:ne(i,i.stateNode.containerInfo);break;case 10:Ai(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,xh(i),null;break;case 13:var d=i.memoizedState;if(d!==null)return d.dehydrated!==null?(Di(i),i.flags|=128,null):(l&i.child.childLanes)!==0?xy(n,i,l):(Di(i),n=ei(n,i,l),n!==null?n.sibling:null);Di(i);break;case 19:var y=(n.flags&128)!==0;if(d=(l&i.childLanes)!==0,d||(Za(n,i,l,!1),d=(l&i.childLanes)!==0),y){if(d)return _y(n,i,l);i.flags|=128}if(y=i.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),X(er,er.current),d)break;return null;case 22:return i.lanes=0,fy(n,i,l,i.pendingProps);case 24:Ai(i,sr,n.memoizedState.cache)}return ei(n,i,l)}function wy(n,i,l){if(n!==null)if(n.memoizedProps!==i.pendingProps)ar=!0;else{if(!Wh(n,l)&&(i.flags&128)===0)return ar=!1,kw(n,i,l);ar=(n.flags&131072)!==0}else ar=!1,rn&&(i.flags&1048576)!==0&&eg(i,dl,i.index);switch(i.lanes=0,i.tag){case 16:e:{var d=i.pendingProps;if(n=ya(i.elementType),i.type=n,typeof n=="function")Zd(n)?(d=_a(n,d),i.tag=1,i=yy(null,i,n,d,l)):(i.tag=0,i=$h(null,i,n,d,l));else{if(n!=null){var y=n.$$typeof;if(y===R){i.tag=11,i=uy(null,i,n,d,l);break e}else if(y===$){i.tag=14,i=dy(null,i,n,d,l);break e}}throw i=C(n)||n,Error(a(306,i,""))}}return i;case 0:return $h(n,i,i.type,i.pendingProps,l);case 1:return d=i.type,y=_a(d,i.pendingProps),yy(n,i,d,y,l);case 3:e:{if(ne(i,i.stateNode.containerInfo),n===null)throw Error(a(387));d=i.pendingProps;var b=i.memoizedState;y=b.element,ph(n,i),xl(i,d,null,l);var D=i.memoizedState;if(d=D.cache,Ai(i,sr,d),d!==b.cache&&lh(i,[sr],l,!0),vl(),d=D.element,b.isDehydrated)if(b={element:d,isDehydrated:!1,cache:D.cache},i.updateQueue.baseState=b,i.memoizedState=b,i.flags&256){i=vy(n,i,d,l);break e}else if(d!==y){y=as(Error(a(424)),i),hl(y),i=vy(n,i,d,l);break e}else for(n=i.stateNode.containerInfo,n.nodeType===9?n=n.body:n=n.nodeName==="HTML"?n.ownerDocument.body:n,Mn=ds(n.firstChild),br=i,rn=!0,Ei=null,cs=!0,l=fg(i,null,d,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(fa(),d===y){i=ei(n,i,l);break e}wr(n,i,d,l)}i=i.child}return i;case 26:return ru(n,i),n===null?(l=Dv(i.type,null,i.pendingProps,null))?i.memoizedState=l:rn||(l=i.type,n=i.pendingProps,d=bu(Ce.current).createElement(l),d[ke]=i,d[te]=n,Sr(d,l,n),lt(d),i.stateNode=d):i.memoizedState=Dv(i.type,n.memoizedProps,i.pendingProps,n.memoizedState),null;case 27:return Le(i),n===null&&rn&&(d=i.stateNode=Tv(i.type,i.pendingProps,Ce.current),br=i,cs=!0,y=Mn,qi(i.type)?(Nf=y,Mn=ds(d.firstChild)):Mn=y),wr(n,i,i.pendingProps.children,l),ru(n,i),n===null&&(i.flags|=4194304),i.child;case 5:return n===null&&rn&&((y=d=Mn)&&(d=nS(d,i.type,i.pendingProps,cs),d!==null?(i.stateNode=d,br=i,Mn=ds(d.firstChild),cs=!1,y=!0):y=!1),y||Ni(i)),Le(i),y=i.type,b=i.pendingProps,D=n!==null?n.memoizedProps:null,d=b.children,Sf(y,b)?d=null:D!==null&&Sf(y,D)&&(i.flags|=32),i.memoizedState!==null&&(y=_h(n,i,yw,null,null,l),Bl._currentValue=y),ru(n,i),wr(n,i,d,l),i.child;case 6:return n===null&&rn&&((n=l=Mn)&&(l=rS(l,i.pendingProps,cs),l!==null?(i.stateNode=l,br=i,Mn=null,n=!0):n=!1),n||Ni(i)),null;case 13:return xy(n,i,l);case 4:return ne(i,i.stateNode.containerInfo),d=i.pendingProps,n===null?i.child=xa(i,null,d,l):wr(n,i,d,l),i.child;case 11:return uy(n,i,i.type,i.pendingProps,l);case 7:return wr(n,i,i.pendingProps,l),i.child;case 8:return wr(n,i,i.pendingProps.children,l),i.child;case 12:return wr(n,i,i.pendingProps.children,l),i.child;case 10:return d=i.pendingProps,Ai(i,i.type,d.value),wr(n,i,d.children,l),i.child;case 9:return y=i.type._context,d=i.pendingProps.children,ma(i),y=_r(y),d=d(y),i.flags|=1,wr(n,i,d,l),i.child;case 14:return dy(n,i,i.type,i.pendingProps,l);case 15:return hy(n,i,i.type,i.pendingProps,l);case 19:return _y(n,i,l);case 31:return Cw(n,i,l);case 22:return fy(n,i,l,i.pendingProps);case 24:return ma(i),d=_r(sr),n===null?(y=dh(),y===null&&(y=Rn,b=ch(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=l),y=b),i.memoizedState={parent:d,cache:y},fh(i),Ai(i,sr,y)):((n.lanes&l)!==0&&(ph(n,i),xl(i,null,null,l),vl()),y=n.memoizedState,b=i.memoizedState,y.parent!==d?(y={parent:d,cache:d},i.memoizedState=y,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=y),Ai(i,sr,d)):(d=b.cache,Ai(i,sr,d),d!==y.cache&&lh(i,[sr],l,!0))),wr(n,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(a(156,i.tag))}function ti(n){n.flags|=4}function Yh(n,i,l,d,y){if((i=(n.mode&32)!==0)&&(i=!1),i){if(n.flags|=16777216,(y&335544128)===y)if(n.stateNode.complete)n.flags|=8192;else if(Yy())n.flags|=8192;else throw va=qc,hh}else n.flags&=-16777217}function Sy(n,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Uv(i))if(Yy())n.flags|=8192;else throw va=qc,hh}function iu(n,i){i!==null&&(n.flags|=4),n.flags&16384&&(i=n.tag!==22?Ft():536870912,n.lanes|=i,ho|=i)}function Cl(n,i){if(!rn)switch(n.tailMode){case"hidden":i=n.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?n.tail=null:l.sibling=null;break;case"collapsed":l=n.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:d.sibling=null}}function Un(n){var i=n.alternate!==null&&n.alternate.child===n.child,l=0,d=0;if(i)for(var y=n.child;y!==null;)l|=y.lanes|y.childLanes,d|=y.subtreeFlags&65011712,d|=y.flags&65011712,y.return=n,y=y.sibling;else for(y=n.child;y!==null;)l|=y.lanes|y.childLanes,d|=y.subtreeFlags,d|=y.flags,y.return=n,y=y.sibling;return n.subtreeFlags|=d,n.childLanes=l,i}function Ew(n,i,l){var d=i.pendingProps;switch(rh(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Un(i),null;case 1:return Un(i),null;case 3:return l=i.stateNode,d=null,n!==null&&(d=n.memoizedState.cache),i.memoizedState.cache!==d&&(i.flags|=2048),Js(sr),we(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(n===null||n.child===null)&&(Xa(i)?ti(i):n===null||n.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,ih())),Un(i),null;case 26:var y=i.type,b=i.memoizedState;return n===null?(ti(i),b!==null?(Un(i),Sy(i,b)):(Un(i),Yh(i,y,null,d,l))):b?b!==n.memoizedState?(ti(i),Un(i),Sy(i,b)):(Un(i),i.flags&=-16777217):(n=n.memoizedProps,n!==d&&ti(i),Un(i),Yh(i,y,n,d,l)),null;case 27:if(ge(i),l=Ce.current,y=i.type,n!==null&&i.stateNode!=null)n.memoizedProps!==d&&ti(i);else{if(!d){if(i.stateNode===null)throw Error(a(166));return Un(i),null}n=se.current,Xa(i)?ng(i):(n=Tv(y,d,l),i.stateNode=n,ti(i))}return Un(i),null;case 5:if(ge(i),y=i.type,n!==null&&i.stateNode!=null)n.memoizedProps!==d&&ti(i);else{if(!d){if(i.stateNode===null)throw Error(a(166));return Un(i),null}if(b=se.current,Xa(i))ng(i);else{var D=bu(Ce.current);switch(b){case 1:b=D.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=D.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=D.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=D.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=D.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof d.is=="string"?D.createElement("select",{is:d.is}):D.createElement("select"),d.multiple?b.multiple=!0:d.size&&(b.size=d.size);break;default:b=typeof d.is=="string"?D.createElement(y,{is:d.is}):D.createElement(y)}}b[ke]=i,b[te]=d;e:for(D=i.child;D!==null;){if(D.tag===5||D.tag===6)b.appendChild(D.stateNode);else if(D.tag!==4&&D.tag!==27&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===i)break e;for(;D.sibling===null;){if(D.return===null||D.return===i)break e;D=D.return}D.sibling.return=D.return,D=D.sibling}i.stateNode=b;e:switch(Sr(b,y,d),y){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&ti(i)}}return Un(i),Yh(i,i.type,n===null?null:n.memoizedProps,i.pendingProps,l),null;case 6:if(n&&i.stateNode!=null)n.memoizedProps!==d&&ti(i);else{if(typeof d!="string"&&i.stateNode===null)throw Error(a(166));if(n=Ce.current,Xa(i)){if(n=i.stateNode,l=i.memoizedProps,d=null,y=br,y!==null)switch(y.tag){case 27:case 5:d=y.memoizedProps}n[ke]=i,n=!!(n.nodeValue===l||d!==null&&d.suppressHydrationWarning===!0||xv(n.nodeValue,l)),n||Ni(i,!0)}else n=bu(n).createTextNode(d),n[ke]=i,i.stateNode=n}return Un(i),null;case 31:if(l=i.memoizedState,n===null||n.memoizedState!==null){if(d=Xa(i),l!==null){if(n===null){if(!d)throw Error(a(318));if(n=i.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(a(557));n[ke]=i}else fa(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Un(i),n=!1}else l=ih(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=l),n=!0;if(!n)return i.flags&256?(Qr(i),i):(Qr(i),null);if((i.flags&128)!==0)throw Error(a(558))}return Un(i),null;case 13:if(d=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(y=Xa(i),d!==null&&d.dehydrated!==null){if(n===null){if(!y)throw Error(a(318));if(y=i.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(a(317));y[ke]=i}else fa(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Un(i),y=!1}else y=ih(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=y),y=!0;if(!y)return i.flags&256?(Qr(i),i):(Qr(i),null)}return Qr(i),(i.flags&128)!==0?(i.lanes=l,i):(l=d!==null,n=n!==null&&n.memoizedState!==null,l&&(d=i.child,y=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(y=d.alternate.memoizedState.cachePool.pool),b=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(b=d.memoizedState.cachePool.pool),b!==y&&(d.flags|=2048)),l!==n&&l&&(i.child.flags|=8192),iu(i,i.updateQueue),Un(i),null);case 4:return we(),n===null&&vf(i.stateNode.containerInfo),Un(i),null;case 10:return Js(i.type),Un(i),null;case 19:if(U(er),d=i.memoizedState,d===null)return Un(i),null;if(y=(i.flags&128)!==0,b=d.rendering,b===null)if(y)Cl(d,!1);else{if(Qn!==0||n!==null&&(n.flags&128)!==0)for(n=i.child;n!==null;){if(b=Gc(n),b!==null){for(i.flags|=128,Cl(d,!1),n=b.updateQueue,i.updateQueue=n,iu(i,n),i.subtreeFlags=0,n=l,l=i.child;l!==null;)Jm(l,n),l=l.sibling;return X(er,er.current&1|2),rn&&Ys(i,d.treeForkCount),i.child}n=n.sibling}d.tail!==null&&qe()>uu&&(i.flags|=128,y=!0,Cl(d,!1),i.lanes=4194304)}else{if(!y)if(n=Gc(b),n!==null){if(i.flags|=128,y=!0,n=n.updateQueue,i.updateQueue=n,iu(i,n),Cl(d,!0),d.tail===null&&d.tailMode==="hidden"&&!b.alternate&&!rn)return Un(i),null}else 2*qe()-d.renderingStartTime>uu&&l!==536870912&&(i.flags|=128,y=!0,Cl(d,!1),i.lanes=4194304);d.isBackwards?(b.sibling=i.child,i.child=b):(n=d.last,n!==null?n.sibling=b:i.child=b,d.last=b)}return d.tail!==null?(n=d.tail,d.rendering=n,d.tail=n.sibling,d.renderingStartTime=qe(),n.sibling=null,l=er.current,X(er,y?l&1|2:l&1),rn&&Ys(i,d.treeForkCount),n):(Un(i),null);case 22:case 23:return Qr(i),vh(),d=i.memoizedState!==null,n!==null?n.memoizedState!==null!==d&&(i.flags|=8192):d&&(i.flags|=8192),d?(l&536870912)!==0&&(i.flags&128)===0&&(Un(i),i.subtreeFlags&6&&(i.flags|=8192)):Un(i),l=i.updateQueue,l!==null&&iu(i,l.retryQueue),l=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),d=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),d!==l&&(i.flags|=2048),n!==null&&U(ga),null;case 24:return l=null,n!==null&&(l=n.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),Js(sr),Un(i),null;case 25:return null;case 30:return null}throw Error(a(156,i.tag))}function Nw(n,i){switch(rh(i),i.tag){case 1:return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return Js(sr),we(),n=i.flags,(n&65536)!==0&&(n&128)===0?(i.flags=n&-65537|128,i):null;case 26:case 27:case 5:return ge(i),null;case 31:if(i.memoizedState!==null){if(Qr(i),i.alternate===null)throw Error(a(340));fa()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 13:if(Qr(i),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(a(340));fa()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return U(er),null;case 4:return we(),null;case 10:return Js(i.type),null;case 22:case 23:return Qr(i),vh(),n!==null&&U(ga),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 24:return Js(sr),null;case 25:return null;default:return null}}function jy(n,i){switch(rh(i),i.tag){case 3:Js(sr),we();break;case 26:case 27:case 5:ge(i);break;case 4:we();break;case 31:i.memoizedState!==null&&Qr(i);break;case 13:Qr(i);break;case 19:U(er);break;case 10:Js(i.type);break;case 22:case 23:Qr(i),vh(),n!==null&&U(ga);break;case 24:Js(sr)}}function kl(n,i){try{var l=i.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var y=d.next;l=y;do{if((l.tag&n)===n){d=void 0;var b=l.create,D=l.inst;d=b(),D.destroy=d}l=l.next}while(l!==y)}}catch(W){jn(i,i.return,W)}}function zi(n,i,l){try{var d=i.updateQueue,y=d!==null?d.lastEffect:null;if(y!==null){var b=y.next;d=b;do{if((d.tag&n)===n){var D=d.inst,W=D.destroy;if(W!==void 0){D.destroy=void 0,y=i;var me=l,ze=W;try{ze()}catch(Fe){jn(y,me,Fe)}}}d=d.next}while(d!==b)}}catch(Fe){jn(i,i.return,Fe)}}function Cy(n){var i=n.updateQueue;if(i!==null){var l=n.stateNode;try{mg(i,l)}catch(d){jn(n,n.return,d)}}}function ky(n,i,l){l.props=_a(n.type,n.memoizedProps),l.state=n.memoizedState;try{l.componentWillUnmount()}catch(d){jn(n,i,d)}}function El(n,i){try{var l=n.ref;if(l!==null){switch(n.tag){case 26:case 27:case 5:var d=n.stateNode;break;case 30:d=n.stateNode;break;default:d=n.stateNode}typeof l=="function"?n.refCleanup=l(d):l.current=d}}catch(y){jn(n,i,y)}}function Us(n,i){var l=n.ref,d=n.refCleanup;if(l!==null)if(typeof d=="function")try{d()}catch(y){jn(n,i,y)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(y){jn(n,i,y)}else l.current=null}function Ey(n){var i=n.type,l=n.memoizedProps,d=n.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&d.focus();break e;case"img":l.src?d.src=l.src:l.srcSet&&(d.srcset=l.srcSet)}}catch(y){jn(n,n.return,y)}}function Qh(n,i,l){try{var d=n.stateNode;Qw(d,n.type,l,i),d[te]=i}catch(y){jn(n,n.return,y)}}function Ny(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&qi(n.type)||n.tag===4}function Jh(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Ny(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&qi(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Xh(n,i,l){var d=n.tag;if(d===5||d===6)n=n.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(n,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(n),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=wn));else if(d!==4&&(d===27&&qi(n.type)&&(l=n.stateNode,i=null),n=n.child,n!==null))for(Xh(n,i,l),n=n.sibling;n!==null;)Xh(n,i,l),n=n.sibling}function au(n,i,l){var d=n.tag;if(d===5||d===6)n=n.stateNode,i?l.insertBefore(n,i):l.appendChild(n);else if(d!==4&&(d===27&&qi(n.type)&&(l=n.stateNode),n=n.child,n!==null))for(au(n,i,l),n=n.sibling;n!==null;)au(n,i,l),n=n.sibling}function Ay(n){var i=n.stateNode,l=n.memoizedProps;try{for(var d=n.type,y=i.attributes;y.length;)i.removeAttributeNode(y[0]);Sr(i,d,l),i[ke]=n,i[te]=l}catch(b){jn(n,n.return,b)}}var ni=!1,or=!1,Zh=!1,Ty=typeof WeakSet=="function"?WeakSet:Set,gr=null;function Aw(n,i){if(n=n.containerInfo,_f=Eu,n=qm(n),Gd(n)){if("selectionStart"in n)var l={start:n.selectionStart,end:n.selectionEnd};else e:{l=(l=n.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var y=d.anchorOffset,b=d.focusNode;d=d.focusOffset;try{l.nodeType,b.nodeType}catch{l=null;break e}var D=0,W=-1,me=-1,ze=0,Fe=0,He=n,Ie=null;t:for(;;){for(var Pe;He!==l||y!==0&&He.nodeType!==3||(W=D+y),He!==b||d!==0&&He.nodeType!==3||(me=D+d),He.nodeType===3&&(D+=He.nodeValue.length),(Pe=He.firstChild)!==null;)Ie=He,He=Pe;for(;;){if(He===n)break t;if(Ie===l&&++ze===y&&(W=D),Ie===b&&++Fe===d&&(me=D),(Pe=He.nextSibling)!==null)break;He=Ie,Ie=He.parentNode}He=Pe}l=W===-1||me===-1?null:{start:W,end:me}}else l=null}l=l||{start:0,end:0}}else l=null;for(wf={focusedElem:n,selectionRange:l},Eu=!1,gr=i;gr!==null;)if(i=gr,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,gr=n;else for(;gr!==null;){switch(i=gr,b=i.alternate,n=i.flags,i.tag){case 0:if((n&4)!==0&&(n=i.updateQueue,n=n!==null?n.events:null,n!==null))for(l=0;l<n.length;l++)y=n[l],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&b!==null){n=void 0,l=i,y=b.memoizedProps,b=b.memoizedState,d=l.stateNode;try{var ut=_a(l.type,y);n=d.getSnapshotBeforeUpdate(ut,b),d.__reactInternalSnapshotBeforeUpdate=n}catch(St){jn(l,l.return,St)}}break;case 3:if((n&1024)!==0){if(n=i.stateNode.containerInfo,l=n.nodeType,l===9)Cf(n);else if(l===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Cf(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(a(163))}if(n=i.sibling,n!==null){n.return=i.return,gr=n;break}gr=i.return}}function Ry(n,i,l){var d=l.flags;switch(l.tag){case 0:case 11:case 15:si(n,l),d&4&&kl(5,l);break;case 1:if(si(n,l),d&4)if(n=l.stateNode,i===null)try{n.componentDidMount()}catch(D){jn(l,l.return,D)}else{var y=_a(l.type,i.memoizedProps);i=i.memoizedState;try{n.componentDidUpdate(y,i,n.__reactInternalSnapshotBeforeUpdate)}catch(D){jn(l,l.return,D)}}d&64&&Cy(l),d&512&&El(l,l.return);break;case 3:if(si(n,l),d&64&&(n=l.updateQueue,n!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{mg(n,i)}catch(D){jn(l,l.return,D)}}break;case 27:i===null&&d&4&&Ay(l);case 26:case 5:si(n,l),i===null&&d&4&&Ey(l),d&512&&El(l,l.return);break;case 12:si(n,l);break;case 31:si(n,l),d&4&&Ly(n,l);break;case 13:si(n,l),d&4&&zy(n,l),d&64&&(n=l.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(l=Uw.bind(null,l),sS(n,l))));break;case 22:if(d=l.memoizedState!==null||ni,!d){i=i!==null&&i.memoizedState!==null||or,y=ni;var b=or;ni=d,(or=i)&&!b?ii(n,l,(l.subtreeFlags&8772)!==0):si(n,l),ni=y,or=b}break;case 30:break;default:si(n,l)}}function Oy(n){var i=n.alternate;i!==null&&(n.alternate=null,Oy(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&Ne(i)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var qn=null,Ur=!1;function ri(n,i,l){for(l=l.child;l!==null;)Dy(n,i,l),l=l.sibling}function Dy(n,i,l){if($t&&typeof $t.onCommitFiberUnmount=="function")try{$t.onCommitFiberUnmount(mt,l)}catch{}switch(l.tag){case 26:or||Us(l,i),ri(n,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:or||Us(l,i);var d=qn,y=Ur;qi(l.type)&&(qn=l.stateNode,Ur=!1),ri(n,i,l),Il(l.stateNode),qn=d,Ur=y;break;case 5:or||Us(l,i);case 6:if(d=qn,y=Ur,qn=null,ri(n,i,l),qn=d,Ur=y,qn!==null)if(Ur)try{(qn.nodeType===9?qn.body:qn.nodeName==="HTML"?qn.ownerDocument.body:qn).removeChild(l.stateNode)}catch(b){jn(l,i,b)}else try{qn.removeChild(l.stateNode)}catch(b){jn(l,i,b)}break;case 18:qn!==null&&(Ur?(n=qn,Cv(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,l.stateNode),bo(n)):Cv(qn,l.stateNode));break;case 4:d=qn,y=Ur,qn=l.stateNode.containerInfo,Ur=!0,ri(n,i,l),qn=d,Ur=y;break;case 0:case 11:case 14:case 15:zi(2,l,i),or||zi(4,l,i),ri(n,i,l);break;case 1:or||(Us(l,i),d=l.stateNode,typeof d.componentWillUnmount=="function"&&ky(l,i,d)),ri(n,i,l);break;case 21:ri(n,i,l);break;case 22:or=(d=or)||l.memoizedState!==null,ri(n,i,l),or=d;break;default:ri(n,i,l)}}function Ly(n,i){if(i.memoizedState===null&&(n=i.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{bo(n)}catch(l){jn(i,i.return,l)}}}function zy(n,i){if(i.memoizedState===null&&(n=i.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{bo(n)}catch(l){jn(i,i.return,l)}}function Tw(n){switch(n.tag){case 31:case 13:case 19:var i=n.stateNode;return i===null&&(i=n.stateNode=new Ty),i;case 22:return n=n.stateNode,i=n._retryCache,i===null&&(i=n._retryCache=new Ty),i;default:throw Error(a(435,n.tag))}}function ou(n,i){var l=Tw(n);i.forEach(function(d){if(!l.has(d)){l.add(d);var y=Bw.bind(null,n,d);d.then(y,y)}})}function Br(n,i){var l=i.deletions;if(l!==null)for(var d=0;d<l.length;d++){var y=l[d],b=n,D=i,W=D;e:for(;W!==null;){switch(W.tag){case 27:if(qi(W.type)){qn=W.stateNode,Ur=!1;break e}break;case 5:qn=W.stateNode,Ur=!1;break e;case 3:case 4:qn=W.stateNode.containerInfo,Ur=!0;break e}W=W.return}if(qn===null)throw Error(a(160));Dy(b,D,y),qn=null,Ur=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)Iy(i,n),i=i.sibling}var Ss=null;function Iy(n,i){var l=n.alternate,d=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Br(i,n),Pr(n),d&4&&(zi(3,n,n.return),kl(3,n),zi(5,n,n.return));break;case 1:Br(i,n),Pr(n),d&512&&(or||l===null||Us(l,l.return)),d&64&&ni&&(n=n.updateQueue,n!==null&&(d=n.callbacks,d!==null&&(l=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=l===null?d:l.concat(d))));break;case 26:var y=Ss;if(Br(i,n),Pr(n),d&512&&(or||l===null||Us(l,l.return)),d&4){var b=l!==null?l.memoizedState:null;if(d=n.memoizedState,l===null)if(d===null)if(n.stateNode===null){e:{d=n.type,l=n.memoizedProps,y=y.ownerDocument||y;t:switch(d){case"title":b=y.getElementsByTagName("title")[0],(!b||b[pe]||b[ke]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(d),y.head.insertBefore(b,y.querySelector("head > title"))),Sr(b,d,l),b[ke]=n,lt(b),d=b;break e;case"link":var D=Iv("link","href",y).get(d+(l.href||""));if(D){for(var W=0;W<D.length;W++)if(b=D[W],b.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&b.getAttribute("rel")===(l.rel==null?null:l.rel)&&b.getAttribute("title")===(l.title==null?null:l.title)&&b.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){D.splice(W,1);break t}}b=y.createElement(d),Sr(b,d,l),y.head.appendChild(b);break;case"meta":if(D=Iv("meta","content",y).get(d+(l.content||""))){for(W=0;W<D.length;W++)if(b=D[W],b.getAttribute("content")===(l.content==null?null:""+l.content)&&b.getAttribute("name")===(l.name==null?null:l.name)&&b.getAttribute("property")===(l.property==null?null:l.property)&&b.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&b.getAttribute("charset")===(l.charSet==null?null:l.charSet)){D.splice(W,1);break t}}b=y.createElement(d),Sr(b,d,l),y.head.appendChild(b);break;default:throw Error(a(468,d))}b[ke]=n,lt(b),d=b}n.stateNode=d}else Mv(y,n.type,n.stateNode);else n.stateNode=zv(y,d,n.memoizedProps);else b!==d?(b===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):b.count--,d===null?Mv(y,n.type,n.stateNode):zv(y,d,n.memoizedProps)):d===null&&n.stateNode!==null&&Qh(n,n.memoizedProps,l.memoizedProps)}break;case 27:Br(i,n),Pr(n),d&512&&(or||l===null||Us(l,l.return)),l!==null&&d&4&&Qh(n,n.memoizedProps,l.memoizedProps);break;case 5:if(Br(i,n),Pr(n),d&512&&(or||l===null||Us(l,l.return)),n.flags&32){y=n.stateNode;try{zs(y,"")}catch(ut){jn(n,n.return,ut)}}d&4&&n.stateNode!=null&&(y=n.memoizedProps,Qh(n,y,l!==null?l.memoizedProps:y)),d&1024&&(Zh=!0);break;case 6:if(Br(i,n),Pr(n),d&4){if(n.stateNode===null)throw Error(a(162));d=n.memoizedProps,l=n.stateNode;try{l.nodeValue=d}catch(ut){jn(n,n.return,ut)}}break;case 3:if(Su=null,y=Ss,Ss=_u(i.containerInfo),Br(i,n),Ss=y,Pr(n),d&4&&l!==null&&l.memoizedState.isDehydrated)try{bo(i.containerInfo)}catch(ut){jn(n,n.return,ut)}Zh&&(Zh=!1,My(n));break;case 4:d=Ss,Ss=_u(n.stateNode.containerInfo),Br(i,n),Pr(n),Ss=d;break;case 12:Br(i,n),Pr(n);break;case 31:Br(i,n),Pr(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,ou(n,d)));break;case 13:Br(i,n),Pr(n),n.child.flags&8192&&n.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(cu=qe()),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,ou(n,d)));break;case 22:y=n.memoizedState!==null;var me=l!==null&&l.memoizedState!==null,ze=ni,Fe=or;if(ni=ze||y,or=Fe||me,Br(i,n),or=Fe,ni=ze,Pr(n),d&8192)e:for(i=n.stateNode,i._visibility=y?i._visibility&-2:i._visibility|1,y&&(l===null||me||ni||or||wa(n)),l=null,i=n;;){if(i.tag===5||i.tag===26){if(l===null){me=l=i;try{if(b=me.stateNode,y)D=b.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none";else{W=me.stateNode;var He=me.memoizedProps.style,Ie=He!=null&&He.hasOwnProperty("display")?He.display:null;W.style.display=Ie==null||typeof Ie=="boolean"?"":(""+Ie).trim()}}catch(ut){jn(me,me.return,ut)}}}else if(i.tag===6){if(l===null){me=i;try{me.stateNode.nodeValue=y?"":me.memoizedProps}catch(ut){jn(me,me.return,ut)}}}else if(i.tag===18){if(l===null){me=i;try{var Pe=me.stateNode;y?kv(Pe,!0):kv(me.stateNode,!1)}catch(ut){jn(me,me.return,ut)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===n)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break e;for(;i.sibling===null;){if(i.return===null||i.return===n)break e;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}d&4&&(d=n.updateQueue,d!==null&&(l=d.retryQueue,l!==null&&(d.retryQueue=null,ou(n,l))));break;case 19:Br(i,n),Pr(n),d&4&&(d=n.updateQueue,d!==null&&(n.updateQueue=null,ou(n,d)));break;case 30:break;case 21:break;default:Br(i,n),Pr(n)}}function Pr(n){var i=n.flags;if(i&2){try{for(var l,d=n.return;d!==null;){if(Ny(d)){l=d;break}d=d.return}if(l==null)throw Error(a(160));switch(l.tag){case 27:var y=l.stateNode,b=Jh(n);au(n,b,y);break;case 5:var D=l.stateNode;l.flags&32&&(zs(D,""),l.flags&=-33);var W=Jh(n);au(n,W,D);break;case 3:case 4:var me=l.stateNode.containerInfo,ze=Jh(n);Xh(n,ze,me);break;default:throw Error(a(161))}}catch(Fe){jn(n,n.return,Fe)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function My(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var i=n;My(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),n=n.sibling}}function si(n,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Ry(n,i.alternate,i),i=i.sibling}function wa(n){for(n=n.child;n!==null;){var i=n;switch(i.tag){case 0:case 11:case 14:case 15:zi(4,i,i.return),wa(i);break;case 1:Us(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&ky(i,i.return,l),wa(i);break;case 27:Il(i.stateNode);case 26:case 5:Us(i,i.return),wa(i);break;case 22:i.memoizedState===null&&wa(i);break;case 30:wa(i);break;default:wa(i)}n=n.sibling}}function ii(n,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var d=i.alternate,y=n,b=i,D=b.flags;switch(b.tag){case 0:case 11:case 15:ii(y,b,l),kl(4,b);break;case 1:if(ii(y,b,l),d=b,y=d.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(ze){jn(d,d.return,ze)}if(d=b,y=d.updateQueue,y!==null){var W=d.stateNode;try{var me=y.shared.hiddenCallbacks;if(me!==null)for(y.shared.hiddenCallbacks=null,y=0;y<me.length;y++)pg(me[y],W)}catch(ze){jn(d,d.return,ze)}}l&&D&64&&Cy(b),El(b,b.return);break;case 27:Ay(b);case 26:case 5:ii(y,b,l),l&&d===null&&D&4&&Ey(b),El(b,b.return);break;case 12:ii(y,b,l);break;case 31:ii(y,b,l),l&&D&4&&Ly(y,b);break;case 13:ii(y,b,l),l&&D&4&&zy(y,b);break;case 22:b.memoizedState===null&&ii(y,b,l),El(b,b.return);break;case 30:break;default:ii(y,b,l)}i=i.sibling}}function ef(n,i){var l=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),n=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(n=i.memoizedState.cachePool.pool),n!==l&&(n!=null&&n.refCount++,l!=null&&fl(l))}function tf(n,i){n=null,i.alternate!==null&&(n=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==n&&(i.refCount++,n!=null&&fl(n))}function js(n,i,l,d){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Uy(n,i,l,d),i=i.sibling}function Uy(n,i,l,d){var y=i.flags;switch(i.tag){case 0:case 11:case 15:js(n,i,l,d),y&2048&&kl(9,i);break;case 1:js(n,i,l,d);break;case 3:js(n,i,l,d),y&2048&&(n=null,i.alternate!==null&&(n=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==n&&(i.refCount++,n!=null&&fl(n)));break;case 12:if(y&2048){js(n,i,l,d),n=i.stateNode;try{var b=i.memoizedProps,D=b.id,W=b.onPostCommit;typeof W=="function"&&W(D,i.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(me){jn(i,i.return,me)}}else js(n,i,l,d);break;case 31:js(n,i,l,d);break;case 13:js(n,i,l,d);break;case 23:break;case 22:b=i.stateNode,D=i.alternate,i.memoizedState!==null?b._visibility&2?js(n,i,l,d):Nl(n,i):b._visibility&2?js(n,i,l,d):(b._visibility|=2,lo(n,i,l,d,(i.subtreeFlags&10256)!==0||!1)),y&2048&&ef(D,i);break;case 24:js(n,i,l,d),y&2048&&tf(i.alternate,i);break;default:js(n,i,l,d)}}function lo(n,i,l,d,y){for(y=y&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var b=n,D=i,W=l,me=d,ze=D.flags;switch(D.tag){case 0:case 11:case 15:lo(b,D,W,me,y),kl(8,D);break;case 23:break;case 22:var Fe=D.stateNode;D.memoizedState!==null?Fe._visibility&2?lo(b,D,W,me,y):Nl(b,D):(Fe._visibility|=2,lo(b,D,W,me,y)),y&&ze&2048&&ef(D.alternate,D);break;case 24:lo(b,D,W,me,y),y&&ze&2048&&tf(D.alternate,D);break;default:lo(b,D,W,me,y)}i=i.sibling}}function Nl(n,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=n,d=i,y=d.flags;switch(d.tag){case 22:Nl(l,d),y&2048&&ef(d.alternate,d);break;case 24:Nl(l,d),y&2048&&tf(d.alternate,d);break;default:Nl(l,d)}i=i.sibling}}var Al=8192;function co(n,i,l){if(n.subtreeFlags&Al)for(n=n.child;n!==null;)By(n,i,l),n=n.sibling}function By(n,i,l){switch(n.tag){case 26:co(n,i,l),n.flags&Al&&n.memoizedState!==null&&gS(l,Ss,n.memoizedState,n.memoizedProps);break;case 5:co(n,i,l);break;case 3:case 4:var d=Ss;Ss=_u(n.stateNode.containerInfo),co(n,i,l),Ss=d;break;case 22:n.memoizedState===null&&(d=n.alternate,d!==null&&d.memoizedState!==null?(d=Al,Al=16777216,co(n,i,l),Al=d):co(n,i,l));break;default:co(n,i,l)}}function Py(n){var i=n.alternate;if(i!==null&&(n=i.child,n!==null)){i.child=null;do i=n.sibling,n.sibling=null,n=i;while(n!==null)}}function Tl(n){var i=n.deletions;if((n.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var d=i[l];gr=d,qy(d,n)}Py(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)$y(n),n=n.sibling}function $y(n){switch(n.tag){case 0:case 11:case 15:Tl(n),n.flags&2048&&zi(9,n,n.return);break;case 3:Tl(n);break;case 12:Tl(n);break;case 22:var i=n.stateNode;n.memoizedState!==null&&i._visibility&2&&(n.return===null||n.return.tag!==13)?(i._visibility&=-3,lu(n)):Tl(n);break;default:Tl(n)}}function lu(n){var i=n.deletions;if((n.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var d=i[l];gr=d,qy(d,n)}Py(n)}for(n=n.child;n!==null;){switch(i=n,i.tag){case 0:case 11:case 15:zi(8,i,i.return),lu(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,lu(i));break;default:lu(i)}n=n.sibling}}function qy(n,i){for(;gr!==null;){var l=gr;switch(l.tag){case 0:case 11:case 15:zi(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var d=l.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:fl(l.memoizedState.cache)}if(d=l.child,d!==null)d.return=l,gr=d;else e:for(l=n;gr!==null;){d=gr;var y=d.sibling,b=d.return;if(Oy(d),d===l){gr=null;break e}if(y!==null){y.return=b,gr=y;break e}gr=b}}}var Rw={getCacheForType:function(n){var i=_r(sr),l=i.data.get(n);return l===void 0&&(l=n(),i.data.set(n,l)),l},cacheSignal:function(){return _r(sr).controller.signal}},Ow=typeof WeakMap=="function"?WeakMap:Map,yn=0,Rn=null,Yt=null,en=0,Sn=0,Jr=null,Ii=!1,uo=!1,nf=!1,ai=0,Qn=0,Mi=0,Sa=0,rf=0,Xr=0,ho=0,Rl=null,$r=null,sf=!1,cu=0,Fy=0,uu=1/0,du=null,Ui=null,ur=0,Bi=null,fo=null,oi=0,af=0,of=null,Vy=null,Ol=0,lf=null;function Zr(){return(yn&2)!==0&&en!==0?en&-en:L.T!==null?pf():Kn()}function Hy(){if(Xr===0)if((en&536870912)===0||rn){var n=hn;hn<<=1,(hn&3932160)===0&&(hn=262144),Xr=n}else Xr=536870912;return n=Yr.current,n!==null&&(n.flags|=32),Xr}function qr(n,i,l){(n===Rn&&(Sn===2||Sn===9)||n.cancelPendingCommit!==null)&&(po(n,0),Pi(n,en,Xr,!1)),xn(n,l),((yn&2)===0||n!==Rn)&&(n===Rn&&((yn&2)===0&&(Sa|=l),Qn===4&&Pi(n,en,Xr,!1)),Bs(n))}function Gy(n,i,l){if((yn&6)!==0)throw Error(a(327));var d=!l&&(i&127)===0&&(i&n.expiredLanes)===0||qt(n,i),y=d?zw(n,i):uf(n,i,!0),b=d;do{if(y===0){uo&&!d&&Pi(n,i,0,!1);break}else{if(l=n.current.alternate,b&&!Dw(l)){y=uf(n,i,!1),b=!1;continue}if(y===2){if(b=i,n.errorRecoveryDisabledLanes&b)var D=0;else D=n.pendingLanes&-536870913,D=D!==0?D:D&536870912?536870912:0;if(D!==0){i=D;e:{var W=n;y=Rl;var me=W.current.memoizedState.isDehydrated;if(me&&(po(W,D).flags|=256),D=uf(W,D,!1),D!==2){if(nf&&!me){W.errorRecoveryDisabledLanes|=b,Sa|=b,y=4;break e}b=$r,$r=y,b!==null&&($r===null?$r=b:$r.push.apply($r,b))}y=D}if(b=!1,y!==2)continue}}if(y===1){po(n,0),Pi(n,i,0,!0);break}e:{switch(d=n,b=y,b){case 0:case 1:throw Error(a(345));case 4:if((i&4194048)!==i)break;case 6:Pi(d,i,Xr,!Ii);break e;case 2:$r=null;break;case 3:case 5:break;default:throw Error(a(329))}if((i&62914560)===i&&(y=cu+300-qe(),10<y)){if(Pi(d,i,Xr,!Ii),Vt(d,0,!0)!==0)break e;oi=i,d.timeoutHandle=Sv(Ky.bind(null,d,l,$r,du,sf,i,Xr,Sa,ho,Ii,b,"Throttled",-0,0),y);break e}Ky(d,l,$r,du,sf,i,Xr,Sa,ho,Ii,b,null,-0,0)}}break}while(!0);Bs(n)}function Ky(n,i,l,d,y,b,D,W,me,ze,Fe,He,Ie,Pe){if(n.timeoutHandle=-1,He=i.subtreeFlags,He&8192||(He&16785408)===16785408){He={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:wn},By(i,b,He);var ut=(b&62914560)===b?cu-qe():(b&4194048)===b?Fy-qe():0;if(ut=yS(He,ut),ut!==null){oi=b,n.cancelPendingCommit=ut(tv.bind(null,n,i,b,l,d,y,D,W,me,Fe,He,null,Ie,Pe)),Pi(n,b,D,!ze);return}}tv(n,i,b,l,d,y,D,W,me)}function Dw(n){for(var i=n;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var d=0;d<l.length;d++){var y=l[d],b=y.getSnapshot;y=y.value;try{if(!Kr(b(),y))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Pi(n,i,l,d){i&=~rf,i&=~Sa,n.suspendedLanes|=i,n.pingedLanes&=~i,d&&(n.warmLanes|=i),d=n.expirationTimes;for(var y=i;0<y;){var b=31-Ot(y),D=1<<b;d[b]=-1,y&=~D}l!==0&&Vn(n,l,i)}function hu(){return(yn&6)===0?(Dl(0),!1):!0}function cf(){if(Yt!==null){if(Sn===0)var n=Yt.return;else n=Yt,Qs=pa=null,jh(n),ro=null,ml=0,n=Yt;for(;n!==null;)jy(n.alternate,n),n=n.return;Yt=null}}function po(n,i){var l=n.timeoutHandle;l!==-1&&(n.timeoutHandle=-1,Zw(l)),l=n.cancelPendingCommit,l!==null&&(n.cancelPendingCommit=null,l()),oi=0,cf(),Rn=n,Yt=l=Ws(n.current,null),en=i,Sn=0,Jr=null,Ii=!1,uo=qt(n,i),nf=!1,ho=Xr=rf=Sa=Mi=Qn=0,$r=Rl=null,sf=!1,(i&8)!==0&&(i|=i&32);var d=n.entangledLanes;if(d!==0)for(n=n.entanglements,d&=i;0<d;){var y=31-Ot(d),b=1<<y;i|=n[y],d&=~b}return ai=i,Dc(),l}function Wy(n,i){Bt=null,L.H=Sl,i===no||i===$c?(i=ug(),Sn=3):i===hh?(i=ug(),Sn=4):Sn=i===Ph?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,Jr=i,Yt===null&&(Qn=1,tu(n,as(i,n.current)))}function Yy(){var n=Yr.current;return n===null?!0:(en&4194048)===en?us===null:(en&62914560)===en||(en&536870912)!==0?n===us:!1}function Qy(){var n=L.H;return L.H=Sl,n===null?Sl:n}function Jy(){var n=L.A;return L.A=Rw,n}function fu(){Qn=4,Ii||(en&4194048)!==en&&Yr.current!==null||(uo=!0),(Mi&134217727)===0&&(Sa&134217727)===0||Rn===null||Pi(Rn,en,Xr,!1)}function uf(n,i,l){var d=yn;yn|=2;var y=Qy(),b=Jy();(Rn!==n||en!==i)&&(du=null,po(n,i)),i=!1;var D=Qn;e:do try{if(Sn!==0&&Yt!==null){var W=Yt,me=Jr;switch(Sn){case 8:cf(),D=6;break e;case 3:case 2:case 9:case 6:Yr.current===null&&(i=!0);var ze=Sn;if(Sn=0,Jr=null,mo(n,W,me,ze),l&&uo){D=0;break e}break;default:ze=Sn,Sn=0,Jr=null,mo(n,W,me,ze)}}Lw(),D=Qn;break}catch(Fe){Wy(n,Fe)}while(!0);return i&&n.shellSuspendCounter++,Qs=pa=null,yn=d,L.H=y,L.A=b,Yt===null&&(Rn=null,en=0,Dc()),D}function Lw(){for(;Yt!==null;)Xy(Yt)}function zw(n,i){var l=yn;yn|=2;var d=Qy(),y=Jy();Rn!==n||en!==i?(du=null,uu=qe()+500,po(n,i)):uo=qt(n,i);e:do try{if(Sn!==0&&Yt!==null){i=Yt;var b=Jr;t:switch(Sn){case 1:Sn=0,Jr=null,mo(n,i,b,1);break;case 2:case 9:if(lg(b)){Sn=0,Jr=null,Zy(i);break}i=function(){Sn!==2&&Sn!==9||Rn!==n||(Sn=7),Bs(n)},b.then(i,i);break e;case 3:Sn=7;break e;case 4:Sn=5;break e;case 7:lg(b)?(Sn=0,Jr=null,Zy(i)):(Sn=0,Jr=null,mo(n,i,b,7));break;case 5:var D=null;switch(Yt.tag){case 26:D=Yt.memoizedState;case 5:case 27:var W=Yt;if(D?Uv(D):W.stateNode.complete){Sn=0,Jr=null;var me=W.sibling;if(me!==null)Yt=me;else{var ze=W.return;ze!==null?(Yt=ze,pu(ze)):Yt=null}break t}}Sn=0,Jr=null,mo(n,i,b,5);break;case 6:Sn=0,Jr=null,mo(n,i,b,6);break;case 8:cf(),Qn=6;break e;default:throw Error(a(462))}}Iw();break}catch(Fe){Wy(n,Fe)}while(!0);return Qs=pa=null,L.H=d,L.A=y,yn=l,Yt!==null?0:(Rn=null,en=0,Dc(),Qn)}function Iw(){for(;Yt!==null&&!le();)Xy(Yt)}function Xy(n){var i=wy(n.alternate,n,ai);n.memoizedProps=n.pendingProps,i===null?pu(n):Yt=i}function Zy(n){var i=n,l=i.alternate;switch(i.tag){case 15:case 0:i=gy(l,i,i.pendingProps,i.type,void 0,en);break;case 11:i=gy(l,i,i.pendingProps,i.type.render,i.ref,en);break;case 5:jh(i);default:jy(l,i),i=Yt=Jm(i,ai),i=wy(l,i,ai)}n.memoizedProps=n.pendingProps,i===null?pu(n):Yt=i}function mo(n,i,l,d){Qs=pa=null,jh(i),ro=null,ml=0;var y=i.return;try{if(jw(n,y,i,l,en)){Qn=1,tu(n,as(l,n.current)),Yt=null;return}}catch(b){if(y!==null)throw Yt=y,b;Qn=1,tu(n,as(l,n.current)),Yt=null;return}i.flags&32768?(rn||d===1?n=!0:uo||(en&536870912)!==0?n=!1:(Ii=n=!0,(d===2||d===9||d===3||d===6)&&(d=Yr.current,d!==null&&d.tag===13&&(d.flags|=16384))),ev(i,n)):pu(i)}function pu(n){var i=n;do{if((i.flags&32768)!==0){ev(i,Ii);return}n=i.return;var l=Ew(i.alternate,i,ai);if(l!==null){Yt=l;return}if(i=i.sibling,i!==null){Yt=i;return}Yt=i=n}while(i!==null);Qn===0&&(Qn=5)}function ev(n,i){do{var l=Nw(n.alternate,n);if(l!==null){l.flags&=32767,Yt=l;return}if(l=n.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(n=n.sibling,n!==null)){Yt=n;return}Yt=n=l}while(n!==null);Qn=6,Yt=null}function tv(n,i,l,d,y,b,D,W,me){n.cancelPendingCommit=null;do mu();while(ur!==0);if((yn&6)!==0)throw Error(a(327));if(i!==null){if(i===n.current)throw Error(a(177));if(b=i.lanes|i.childLanes,b|=Jd,un(n,l,b,D,W,me),n===Rn&&(Yt=Rn=null,en=0),fo=i,Bi=n,oi=l,af=b,of=y,Vy=d,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,Pw(Ye,function(){return av(),null})):(n.callbackNode=null,n.callbackPriority=0),d=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||d){d=L.T,L.T=null,y=V.p,V.p=2,D=yn,yn|=4;try{Aw(n,i,l)}finally{yn=D,V.p=y,L.T=d}}ur=1,nv(),rv(),sv()}}function nv(){if(ur===1){ur=0;var n=Bi,i=fo,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=L.T,L.T=null;var d=V.p;V.p=2;var y=yn;yn|=4;try{Iy(i,n);var b=wf,D=qm(n.containerInfo),W=b.focusedElem,me=b.selectionRange;if(D!==W&&W&&W.ownerDocument&&$m(W.ownerDocument.documentElement,W)){if(me!==null&&Gd(W)){var ze=me.start,Fe=me.end;if(Fe===void 0&&(Fe=ze),"selectionStart"in W)W.selectionStart=ze,W.selectionEnd=Math.min(Fe,W.value.length);else{var He=W.ownerDocument||document,Ie=He&&He.defaultView||window;if(Ie.getSelection){var Pe=Ie.getSelection(),ut=W.textContent.length,St=Math.min(me.start,ut),Nn=me.end===void 0?St:Math.min(me.end,ut);!Pe.extend&&St>Nn&&(D=Nn,Nn=St,St=D);var Ee=Pm(W,St),_e=Pm(W,Nn);if(Ee&&_e&&(Pe.rangeCount!==1||Pe.anchorNode!==Ee.node||Pe.anchorOffset!==Ee.offset||Pe.focusNode!==_e.node||Pe.focusOffset!==_e.offset)){var De=He.createRange();De.setStart(Ee.node,Ee.offset),Pe.removeAllRanges(),St>Nn?(Pe.addRange(De),Pe.extend(_e.node,_e.offset)):(De.setEnd(_e.node,_e.offset),Pe.addRange(De))}}}}for(He=[],Pe=W;Pe=Pe.parentNode;)Pe.nodeType===1&&He.push({element:Pe,left:Pe.scrollLeft,top:Pe.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<He.length;W++){var Ve=He[W];Ve.element.scrollLeft=Ve.left,Ve.element.scrollTop=Ve.top}}Eu=!!_f,wf=_f=null}finally{yn=y,V.p=d,L.T=l}}n.current=i,ur=2}}function rv(){if(ur===2){ur=0;var n=Bi,i=fo,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=L.T,L.T=null;var d=V.p;V.p=2;var y=yn;yn|=4;try{Ry(n,i.alternate,i)}finally{yn=y,V.p=d,L.T=l}}ur=3}}function sv(){if(ur===4||ur===3){ur=0,ye();var n=Bi,i=fo,l=oi,d=Vy;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?ur=5:(ur=0,fo=Bi=null,iv(n,n.pendingLanes));var y=n.pendingLanes;if(y===0&&(Ui=null),Tn(l),i=i.stateNode,$t&&typeof $t.onCommitFiberRoot=="function")try{$t.onCommitFiberRoot(mt,i,void 0,(i.current.flags&128)===128)}catch{}if(d!==null){i=L.T,y=V.p,V.p=2,L.T=null;try{for(var b=n.onRecoverableError,D=0;D<d.length;D++){var W=d[D];b(W.value,{componentStack:W.stack})}}finally{L.T=i,V.p=y}}(oi&3)!==0&&mu(),Bs(n),y=n.pendingLanes,(l&261930)!==0&&(y&42)!==0?n===lf?Ol++:(Ol=0,lf=n):Ol=0,Dl(0)}}function iv(n,i){(n.pooledCacheLanes&=i)===0&&(i=n.pooledCache,i!=null&&(n.pooledCache=null,fl(i)))}function mu(){return nv(),rv(),sv(),av()}function av(){if(ur!==5)return!1;var n=Bi,i=af;af=0;var l=Tn(oi),d=L.T,y=V.p;try{V.p=32>l?32:l,L.T=null,l=of,of=null;var b=Bi,D=oi;if(ur=0,fo=Bi=null,oi=0,(yn&6)!==0)throw Error(a(331));var W=yn;if(yn|=4,$y(b.current),Uy(b,b.current,D,l),yn=W,Dl(0,!1),$t&&typeof $t.onPostCommitFiberRoot=="function")try{$t.onPostCommitFiberRoot(mt,b)}catch{}return!0}finally{V.p=y,L.T=d,iv(n,i)}}function ov(n,i,l){i=as(l,i),i=Bh(n.stateNode,i,2),n=Oi(n,i,2),n!==null&&(xn(n,2),Bs(n))}function jn(n,i,l){if(n.tag===3)ov(n,n,l);else for(;i!==null;){if(i.tag===3){ov(i,n,l);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ui===null||!Ui.has(d))){n=as(l,n),l=ly(2),d=Oi(i,l,2),d!==null&&(cy(l,d,i,n),xn(d,2),Bs(d));break}}i=i.return}}function df(n,i,l){var d=n.pingCache;if(d===null){d=n.pingCache=new Ow;var y=new Set;d.set(i,y)}else y=d.get(i),y===void 0&&(y=new Set,d.set(i,y));y.has(l)||(nf=!0,y.add(l),n=Mw.bind(null,n,i,l),i.then(n,n))}function Mw(n,i,l){var d=n.pingCache;d!==null&&d.delete(i),n.pingedLanes|=n.suspendedLanes&l,n.warmLanes&=~l,Rn===n&&(en&l)===l&&(Qn===4||Qn===3&&(en&62914560)===en&&300>qe()-cu?(yn&2)===0&&po(n,0):rf|=l,ho===en&&(ho=0)),Bs(n)}function lv(n,i){i===0&&(i=Ft()),n=da(n,i),n!==null&&(xn(n,i),Bs(n))}function Uw(n){var i=n.memoizedState,l=0;i!==null&&(l=i.retryLane),lv(n,l)}function Bw(n,i){var l=0;switch(n.tag){case 31:case 13:var d=n.stateNode,y=n.memoizedState;y!==null&&(l=y.retryLane);break;case 19:d=n.stateNode;break;case 22:d=n.stateNode._retryCache;break;default:throw Error(a(314))}d!==null&&d.delete(i),lv(n,l)}function Pw(n,i){return re(n,i)}var gu=null,go=null,hf=!1,yu=!1,ff=!1,$i=0;function Bs(n){n!==go&&n.next===null&&(go===null?gu=go=n:go=go.next=n),yu=!0,hf||(hf=!0,qw())}function Dl(n,i){if(!ff&&yu){ff=!0;do for(var l=!1,d=gu;d!==null;){if(n!==0){var y=d.pendingLanes;if(y===0)var b=0;else{var D=d.suspendedLanes,W=d.pingedLanes;b=(1<<31-Ot(42|n)+1)-1,b&=y&~(D&~W),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(l=!0,hv(d,b))}else b=en,b=Vt(d,d===Rn?b:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(b&3)===0||qt(d,b)||(l=!0,hv(d,b));d=d.next}while(l);ff=!1}}function $w(){cv()}function cv(){yu=hf=!1;var n=0;$i!==0&&Xw()&&(n=$i);for(var i=qe(),l=null,d=gu;d!==null;){var y=d.next,b=uv(d,i);b===0?(d.next=null,l===null?gu=y:l.next=y,y===null&&(go=l)):(l=d,(n!==0||(b&3)!==0)&&(yu=!0)),d=y}ur!==0&&ur!==5||Dl(n),$i!==0&&($i=0)}function uv(n,i){for(var l=n.suspendedLanes,d=n.pingedLanes,y=n.expirationTimes,b=n.pendingLanes&-62914561;0<b;){var D=31-Ot(b),W=1<<D,me=y[D];me===-1?((W&l)===0||(W&d)!==0)&&(y[D]=cn(W,i)):me<=i&&(n.expiredLanes|=W),b&=~W}if(i=Rn,l=en,l=Vt(n,n===i?l:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d=n.callbackNode,l===0||n===i&&(Sn===2||Sn===9)||n.cancelPendingCommit!==null)return d!==null&&d!==null&&ee(d),n.callbackNode=null,n.callbackPriority=0;if((l&3)===0||qt(n,l)){if(i=l&-l,i===n.callbackPriority)return i;switch(d!==null&&ee(d),Tn(l)){case 2:case 8:l=Ke;break;case 32:l=Ye;break;case 268435456:l=Kt;break;default:l=Ye}return d=dv.bind(null,n),l=re(l,d),n.callbackPriority=i,n.callbackNode=l,i}return d!==null&&d!==null&&ee(d),n.callbackPriority=2,n.callbackNode=null,2}function dv(n,i){if(ur!==0&&ur!==5)return n.callbackNode=null,n.callbackPriority=0,null;var l=n.callbackNode;if(mu()&&n.callbackNode!==l)return null;var d=en;return d=Vt(n,n===Rn?d:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),d===0?null:(Gy(n,d,i),uv(n,qe()),n.callbackNode!=null&&n.callbackNode===l?dv.bind(null,n):null)}function hv(n,i){if(mu())return null;Gy(n,i,!0)}function qw(){eS(function(){(yn&6)!==0?re($e,$w):cv()})}function pf(){if($i===0){var n=eo;n===0&&(n=zn,zn<<=1,(zn&261888)===0&&(zn=256)),$i=n}return $i}function fv(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:ln(""+n)}function pv(n,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,n.id&&l.setAttribute("form",n.id),i.parentNode.insertBefore(l,i),n=new FormData(n),l.parentNode.removeChild(l),n}function Fw(n,i,l,d,y){if(i==="submit"&&l&&l.stateNode===y){var b=fv((y[te]||null).action),D=d.submitter;D&&(i=(i=D[te]||null)?fv(i.formAction):D.getAttribute("formAction"),i!==null&&(b=i,D=null));var W=new vt("action","action",null,d,y);n.push({event:W,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if($i!==0){var me=D?pv(y,D):new FormData(y);Dh(l,{pending:!0,data:me,method:y.method,action:b},null,me)}}else typeof b=="function"&&(W.preventDefault(),me=D?pv(y,D):new FormData(y),Dh(l,{pending:!0,data:me,method:y.method,action:b},b,me))},currentTarget:y}]})}}for(var mf=0;mf<Qd.length;mf++){var gf=Qd[mf],Vw=gf.toLowerCase(),Hw=gf[0].toUpperCase()+gf.slice(1);ws(Vw,"on"+Hw)}ws(Hm,"onAnimationEnd"),ws(Gm,"onAnimationIteration"),ws(Km,"onAnimationStart"),ws("dblclick","onDoubleClick"),ws("focusin","onFocus"),ws("focusout","onBlur"),ws(ow,"onTransitionRun"),ws(lw,"onTransitionStart"),ws(cw,"onTransitionCancel"),ws(Wm,"onTransitionEnd"),ct("onMouseEnter",["mouseout","mouseover"]),ct("onMouseLeave",["mouseout","mouseover"]),ct("onPointerEnter",["pointerout","pointerover"]),ct("onPointerLeave",["pointerout","pointerover"]),Ge("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ge("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ge("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ge("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ge("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ge("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ll="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ll));function mv(n,i){i=(i&4)!==0;for(var l=0;l<n.length;l++){var d=n[l],y=d.event;d=d.listeners;e:{var b=void 0;if(i)for(var D=d.length-1;0<=D;D--){var W=d[D],me=W.instance,ze=W.currentTarget;if(W=W.listener,me!==b&&y.isPropagationStopped())break e;b=W,y.currentTarget=ze;try{b(y)}catch(Fe){Oc(Fe)}y.currentTarget=null,b=me}else for(D=0;D<d.length;D++){if(W=d[D],me=W.instance,ze=W.currentTarget,W=W.listener,me!==b&&y.isPropagationStopped())break e;b=W,y.currentTarget=ze;try{b(y)}catch(Fe){Oc(Fe)}y.currentTarget=null,b=me}}}}function Qt(n,i){var l=i[Oe];l===void 0&&(l=i[Oe]=new Set);var d=n+"__bubble";l.has(d)||(gv(i,n,2,!1),l.add(d))}function yf(n,i,l){var d=0;i&&(d|=4),gv(l,n,d,i)}var vu="_reactListening"+Math.random().toString(36).slice(2);function vf(n){if(!n[vu]){n[vu]=!0,Mt.forEach(function(l){l!=="selectionchange"&&(Gw.has(l)||yf(l,!1,n),yf(l,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[vu]||(i[vu]=!0,yf("selectionchange",!1,i))}}function gv(n,i,l,d){switch(Hv(i)){case 2:var y=bS;break;case 8:y=_S;break;default:y=Df}l=y.bind(null,i,l,n),y=void 0,!J||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(y=!0),d?y!==void 0?n.addEventListener(i,l,{capture:!0,passive:y}):n.addEventListener(i,l,!0):y!==void 0?n.addEventListener(i,l,{passive:y}):n.addEventListener(i,l,!1)}function xf(n,i,l,d,y){var b=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var D=d.tag;if(D===3||D===4){var W=d.stateNode.containerInfo;if(W===y)break;if(D===4)for(D=d.return;D!==null;){var me=D.tag;if((me===3||me===4)&&D.stateNode.containerInfo===y)return;D=D.return}for(;W!==null;){if(D=Be(W),D===null)return;if(me=D.tag,me===5||me===6||me===26||me===27){d=b=D;continue e}W=W.parentNode}}d=d.return}nn(function(){var ze=b,Fe=Wn(l),He=[];e:{var Ie=Ym.get(n);if(Ie!==void 0){var Pe=vt,ut=n;switch(n){case"keypress":if(tt(l)===0)break e;case"keydown":case"keyup":Pe=B_;break;case"focusin":ut="focus",Pe=Hn;break;case"focusout":ut="blur",Pe=Hn;break;case"beforeblur":case"afterblur":Pe=Hn;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Pe=yt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Pe=At;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Pe=q_;break;case Hm:case Gm:case Km:Pe=Gt;break;case Wm:Pe=V_;break;case"scroll":case"scrollend":Pe=Rt;break;case"wheel":Pe=G_;break;case"copy":case"cut":case"paste":Pe=Gn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Pe=km;break;case"toggle":case"beforetoggle":Pe=W_}var St=(i&4)!==0,Nn=!St&&(n==="scroll"||n==="scrollend"),Ee=St?Ie!==null?Ie+"Capture":null:Ie;St=[];for(var _e=ze,De;_e!==null;){var Ve=_e;if(De=Ve.stateNode,Ve=Ve.tag,Ve!==5&&Ve!==26&&Ve!==27||De===null||Ee===null||(Ve=Zn(_e,Ee),Ve!=null&&St.push(zl(_e,Ve,De))),Nn)break;_e=_e.return}0<St.length&&(Ie=new Pe(Ie,ut,null,l,Fe),He.push({event:Ie,listeners:St}))}}if((i&7)===0){e:{if(Ie=n==="mouseover"||n==="pointerover",Pe=n==="mouseout"||n==="pointerout",Ie&&l!==Ut&&(ut=l.relatedTarget||l.fromElement)&&(Be(ut)||ut[je]))break e;if((Pe||Ie)&&(Ie=Fe.window===Fe?Fe:(Ie=Fe.ownerDocument)?Ie.defaultView||Ie.parentWindow:window,Pe?(ut=l.relatedTarget||l.toElement,Pe=ze,ut=ut?Be(ut):null,ut!==null&&(Nn=c(ut),St=ut.tag,ut!==Nn||St!==5&&St!==27&&St!==6)&&(ut=null)):(Pe=null,ut=ze),Pe!==ut)){if(St=yt,Ve="onMouseLeave",Ee="onMouseEnter",_e="mouse",(n==="pointerout"||n==="pointerover")&&(St=km,Ve="onPointerLeave",Ee="onPointerEnter",_e="pointer"),Nn=Pe==null?Ie:et(Pe),De=ut==null?Ie:et(ut),Ie=new St(Ve,_e+"leave",Pe,l,Fe),Ie.target=Nn,Ie.relatedTarget=De,Ve=null,Be(Fe)===ze&&(St=new St(Ee,_e+"enter",ut,l,Fe),St.target=De,St.relatedTarget=Nn,Ve=St),Nn=Ve,Pe&&ut)t:{for(St=Kw,Ee=Pe,_e=ut,De=0,Ve=Ee;Ve;Ve=St(Ve))De++;Ve=0;for(var _t=_e;_t;_t=St(_t))Ve++;for(;0<De-Ve;)Ee=St(Ee),De--;for(;0<Ve-De;)_e=St(_e),Ve--;for(;De--;){if(Ee===_e||_e!==null&&Ee===_e.alternate){St=Ee;break t}Ee=St(Ee),_e=St(_e)}St=null}else St=null;Pe!==null&&yv(He,Ie,Pe,St,!1),ut!==null&&Nn!==null&&yv(He,Nn,ut,St,!0)}}e:{if(Ie=ze?et(ze):window,Pe=Ie.nodeName&&Ie.nodeName.toLowerCase(),Pe==="select"||Pe==="input"&&Ie.type==="file")var pn=Lm;else if(Om(Ie))if(zm)pn=sw;else{pn=nw;var gt=tw}else Pe=Ie.nodeName,!Pe||Pe.toLowerCase()!=="input"||Ie.type!=="checkbox"&&Ie.type!=="radio"?ze&&Nt(ze.elementType)&&(pn=Lm):pn=rw;if(pn&&(pn=pn(n,ze))){Dm(He,pn,l,Fe);break e}gt&&gt(n,Ie,ze),n==="focusout"&&ze&&Ie.type==="number"&&ze.memoizedProps.value!=null&&oa(Ie,"number",Ie.value)}switch(gt=ze?et(ze):window,n){case"focusin":(Om(gt)||gt.contentEditable==="true")&&(Ga=gt,Kd=ze,ul=null);break;case"focusout":ul=Kd=Ga=null;break;case"mousedown":Wd=!0;break;case"contextmenu":case"mouseup":case"dragend":Wd=!1,Fm(He,l,Fe);break;case"selectionchange":if(aw)break;case"keydown":case"keyup":Fm(He,l,Fe)}var Pt;if(Fd)e:{switch(n){case"compositionstart":var tn="onCompositionStart";break e;case"compositionend":tn="onCompositionEnd";break e;case"compositionupdate":tn="onCompositionUpdate";break e}tn=void 0}else Ha?Tm(n,l)&&(tn="onCompositionEnd"):n==="keydown"&&l.keyCode===229&&(tn="onCompositionStart");tn&&(Em&&l.locale!=="ko"&&(Ha||tn!=="onCompositionStart"?tn==="onCompositionEnd"&&Ha&&(Pt=Je()):(be=Fe,Me="value"in be?be.value:be.textContent,Ha=!0)),gt=xu(ze,tn),0<gt.length&&(tn=new _s(tn,n,null,l,Fe),He.push({event:tn,listeners:gt}),Pt?tn.data=Pt:(Pt=Rm(l),Pt!==null&&(tn.data=Pt)))),(Pt=Q_?J_(n,l):X_(n,l))&&(tn=xu(ze,"onBeforeInput"),0<tn.length&&(gt=new _s("onBeforeInput","beforeinput",null,l,Fe),He.push({event:gt,listeners:tn}),gt.data=Pt)),Fw(He,n,ze,l,Fe)}mv(He,i)})}function zl(n,i,l){return{instance:n,listener:i,currentTarget:l}}function xu(n,i){for(var l=i+"Capture",d=[];n!==null;){var y=n,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=Zn(n,l),y!=null&&d.unshift(zl(n,y,b)),y=Zn(n,i),y!=null&&d.push(zl(n,y,b))),n.tag===3)return d;n=n.return}return[]}function Kw(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function yv(n,i,l,d,y){for(var b=i._reactName,D=[];l!==null&&l!==d;){var W=l,me=W.alternate,ze=W.stateNode;if(W=W.tag,me!==null&&me===d)break;W!==5&&W!==26&&W!==27||ze===null||(me=ze,y?(ze=Zn(l,b),ze!=null&&D.unshift(zl(l,ze,me))):y||(ze=Zn(l,b),ze!=null&&D.push(zl(l,ze,me)))),l=l.return}D.length!==0&&n.push({event:i,listeners:D})}var Ww=/\r\n?/g,Yw=/\u0000|\uFFFD/g;function vv(n){return(typeof n=="string"?n:""+n).replace(Ww,`
`).replace(Yw,"")}function xv(n,i){return i=vv(i),vv(n)===i}function En(n,i,l,d,y,b){switch(l){case"children":typeof d=="string"?i==="body"||i==="textarea"&&d===""||zs(n,d):(typeof d=="number"||typeof d=="bigint")&&i!=="body"&&zs(n,""+d);break;case"className":zr(n,"class",d);break;case"tabIndex":zr(n,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":zr(n,l,d);break;case"style":ft(n,d,b);break;case"data":if(i!=="object"){zr(n,"data",d);break}case"src":case"href":if(d===""&&(i!=="a"||l!=="href")){n.removeAttribute(l);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(l);break}d=ln(""+d),n.setAttribute(l,d);break;case"action":case"formAction":if(typeof d=="function"){n.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(l==="formAction"?(i!=="input"&&En(n,i,"name",y.name,y,null),En(n,i,"formEncType",y.formEncType,y,null),En(n,i,"formMethod",y.formMethod,y,null),En(n,i,"formTarget",y.formTarget,y,null)):(En(n,i,"encType",y.encType,y,null),En(n,i,"method",y.method,y,null),En(n,i,"target",y.target,y,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){n.removeAttribute(l);break}d=ln(""+d),n.setAttribute(l,d);break;case"onClick":d!=null&&(n.onclick=wn);break;case"onScroll":d!=null&&Qt("scroll",n);break;case"onScrollEnd":d!=null&&Qt("scrollend",n);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(a(61));if(l=d.__html,l!=null){if(y.children!=null)throw Error(a(60));n.innerHTML=l}}break;case"multiple":n.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":n.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){n.removeAttribute("xlink:href");break}l=ln(""+d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(l,""+d):n.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(l,""):n.removeAttribute(l);break;case"capture":case"download":d===!0?n.setAttribute(l,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?n.setAttribute(l,d):n.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?n.setAttribute(l,d):n.removeAttribute(l);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?n.removeAttribute(l):n.setAttribute(l,d);break;case"popover":Qt("beforetoggle",n),Qt("toggle",n),Hr(n,"popover",d);break;case"xlinkActuate":Gr(n,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Gr(n,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Gr(n,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Gr(n,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Gr(n,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Gr(n,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Gr(n,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Gr(n,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Gr(n,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":Hr(n,"is",d);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=fn.get(l)||l,Hr(n,l,d))}}function bf(n,i,l,d,y,b){switch(l){case"style":ft(n,d,b);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(a(61));if(l=d.__html,l!=null){if(y.children!=null)throw Error(a(60));n.innerHTML=l}}break;case"children":typeof d=="string"?zs(n,d):(typeof d=="number"||typeof d=="bigint")&&zs(n,""+d);break;case"onScroll":d!=null&&Qt("scroll",n);break;case"onScrollEnd":d!=null&&Qt("scrollend",n);break;case"onClick":d!=null&&(n.onclick=wn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Tt.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(y=l.endsWith("Capture"),i=l.slice(2,y?l.length-7:void 0),b=n[te]||null,b=b!=null?b[l]:null,typeof b=="function"&&n.removeEventListener(i,b,y),typeof d=="function")){typeof b!="function"&&b!==null&&(l in n?n[l]=null:n.hasAttribute(l)&&n.removeAttribute(l)),n.addEventListener(i,d,y);break e}l in n?n[l]=d:d===!0?n.setAttribute(l,""):Hr(n,l,d)}}}function Sr(n,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qt("error",n),Qt("load",n);var d=!1,y=!1,b;for(b in l)if(l.hasOwnProperty(b)){var D=l[b];if(D!=null)switch(b){case"src":d=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,i));default:En(n,i,b,D,l,null)}}y&&En(n,i,"srcSet",l.srcSet,l,null),d&&En(n,i,"src",l.src,l,null);return;case"input":Qt("invalid",n);var W=b=D=y=null,me=null,ze=null;for(d in l)if(l.hasOwnProperty(d)){var Fe=l[d];if(Fe!=null)switch(d){case"name":y=Fe;break;case"type":D=Fe;break;case"checked":me=Fe;break;case"defaultChecked":ze=Fe;break;case"value":b=Fe;break;case"defaultValue":W=Fe;break;case"children":case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(a(137,i));break;default:En(n,i,d,Fe,l,null)}}Fa(n,b,W,me,ze,D,y,!1);return;case"select":Qt("invalid",n),d=D=b=null;for(y in l)if(l.hasOwnProperty(y)&&(W=l[y],W!=null))switch(y){case"value":b=W;break;case"defaultValue":D=W;break;case"multiple":d=W;default:En(n,i,y,W,l,null)}i=b,l=D,n.multiple=!!d,i!=null?Ir(n,!!d,i,!1):l!=null&&Ir(n,!!d,l,!0);return;case"textarea":Qt("invalid",n),b=y=d=null;for(D in l)if(l.hasOwnProperty(D)&&(W=l[D],W!=null))switch(D){case"value":d=W;break;case"defaultValue":y=W;break;case"children":b=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(a(91));break;default:En(n,i,D,W,l,null)}Va(n,d,y,b);return;case"option":for(me in l)l.hasOwnProperty(me)&&(d=l[me],d!=null)&&(me==="selected"?n.selected=d&&typeof d!="function"&&typeof d!="symbol":En(n,i,me,d,l,null));return;case"dialog":Qt("beforetoggle",n),Qt("toggle",n),Qt("cancel",n),Qt("close",n);break;case"iframe":case"object":Qt("load",n);break;case"video":case"audio":for(d=0;d<Ll.length;d++)Qt(Ll[d],n);break;case"image":Qt("error",n),Qt("load",n);break;case"details":Qt("toggle",n);break;case"embed":case"source":case"link":Qt("error",n),Qt("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ze in l)if(l.hasOwnProperty(ze)&&(d=l[ze],d!=null))switch(ze){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,i));default:En(n,i,ze,d,l,null)}return;default:if(Nt(i)){for(Fe in l)l.hasOwnProperty(Fe)&&(d=l[Fe],d!==void 0&&bf(n,i,Fe,d,l,void 0));return}}for(W in l)l.hasOwnProperty(W)&&(d=l[W],d!=null&&En(n,i,W,d,l,null))}function Qw(n,i,l,d){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,D=null,W=null,me=null,ze=null,Fe=null;for(Pe in l){var He=l[Pe];if(l.hasOwnProperty(Pe)&&He!=null)switch(Pe){case"checked":break;case"value":break;case"defaultValue":me=He;default:d.hasOwnProperty(Pe)||En(n,i,Pe,null,d,He)}}for(var Ie in d){var Pe=d[Ie];if(He=l[Ie],d.hasOwnProperty(Ie)&&(Pe!=null||He!=null))switch(Ie){case"type":b=Pe;break;case"name":y=Pe;break;case"checked":ze=Pe;break;case"defaultChecked":Fe=Pe;break;case"value":D=Pe;break;case"defaultValue":W=Pe;break;case"children":case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(a(137,i));break;default:Pe!==He&&En(n,i,Ie,Pe,d,He)}}Hs(n,D,W,me,ze,Fe,b,y);return;case"select":Pe=D=W=Ie=null;for(b in l)if(me=l[b],l.hasOwnProperty(b)&&me!=null)switch(b){case"value":break;case"multiple":Pe=me;default:d.hasOwnProperty(b)||En(n,i,b,null,d,me)}for(y in d)if(b=d[y],me=l[y],d.hasOwnProperty(y)&&(b!=null||me!=null))switch(y){case"value":Ie=b;break;case"defaultValue":W=b;break;case"multiple":D=b;default:b!==me&&En(n,i,y,b,d,me)}i=W,l=D,d=Pe,Ie!=null?Ir(n,!!l,Ie,!1):!!d!=!!l&&(i!=null?Ir(n,!!l,i,!0):Ir(n,!!l,l?[]:"",!1));return;case"textarea":Pe=Ie=null;for(W in l)if(y=l[W],l.hasOwnProperty(W)&&y!=null&&!d.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:En(n,i,W,null,d,y)}for(D in d)if(y=d[D],b=l[D],d.hasOwnProperty(D)&&(y!=null||b!=null))switch(D){case"value":Ie=y;break;case"defaultValue":Pe=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(a(91));break;default:y!==b&&En(n,i,D,y,d,b)}Si(n,Ie,Pe);return;case"option":for(var ut in l)Ie=l[ut],l.hasOwnProperty(ut)&&Ie!=null&&!d.hasOwnProperty(ut)&&(ut==="selected"?n.selected=!1:En(n,i,ut,null,d,Ie));for(me in d)Ie=d[me],Pe=l[me],d.hasOwnProperty(me)&&Ie!==Pe&&(Ie!=null||Pe!=null)&&(me==="selected"?n.selected=Ie&&typeof Ie!="function"&&typeof Ie!="symbol":En(n,i,me,Ie,d,Pe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var St in l)Ie=l[St],l.hasOwnProperty(St)&&Ie!=null&&!d.hasOwnProperty(St)&&En(n,i,St,null,d,Ie);for(ze in d)if(Ie=d[ze],Pe=l[ze],d.hasOwnProperty(ze)&&Ie!==Pe&&(Ie!=null||Pe!=null))switch(ze){case"children":case"dangerouslySetInnerHTML":if(Ie!=null)throw Error(a(137,i));break;default:En(n,i,ze,Ie,d,Pe)}return;default:if(Nt(i)){for(var Nn in l)Ie=l[Nn],l.hasOwnProperty(Nn)&&Ie!==void 0&&!d.hasOwnProperty(Nn)&&bf(n,i,Nn,void 0,d,Ie);for(Fe in d)Ie=d[Fe],Pe=l[Fe],!d.hasOwnProperty(Fe)||Ie===Pe||Ie===void 0&&Pe===void 0||bf(n,i,Fe,Ie,d,Pe);return}}for(var Ee in l)Ie=l[Ee],l.hasOwnProperty(Ee)&&Ie!=null&&!d.hasOwnProperty(Ee)&&En(n,i,Ee,null,d,Ie);for(He in d)Ie=d[He],Pe=l[He],!d.hasOwnProperty(He)||Ie===Pe||Ie==null&&Pe==null||En(n,i,He,Ie,d,Pe)}function bv(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Jw(){if(typeof performance.getEntriesByType=="function"){for(var n=0,i=0,l=performance.getEntriesByType("resource"),d=0;d<l.length;d++){var y=l[d],b=y.transferSize,D=y.initiatorType,W=y.duration;if(b&&W&&bv(D)){for(D=0,W=y.responseEnd,d+=1;d<l.length;d++){var me=l[d],ze=me.startTime;if(ze>W)break;var Fe=me.transferSize,He=me.initiatorType;Fe&&bv(He)&&(me=me.responseEnd,D+=Fe*(me<W?1:(W-ze)/(me-ze)))}if(--d,i+=8*(b+D)/(y.duration/1e3),n++,10<n)break}}if(0<n)return i/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var _f=null,wf=null;function bu(n){return n.nodeType===9?n:n.ownerDocument}function _v(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function wv(n,i){if(n===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&i==="foreignObject"?0:n}function Sf(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var jf=null;function Xw(){var n=window.event;return n&&n.type==="popstate"?n===jf?!1:(jf=n,!0):(jf=null,!1)}var Sv=typeof setTimeout=="function"?setTimeout:void 0,Zw=typeof clearTimeout=="function"?clearTimeout:void 0,jv=typeof Promise=="function"?Promise:void 0,eS=typeof queueMicrotask=="function"?queueMicrotask:typeof jv<"u"?function(n){return jv.resolve(null).then(n).catch(tS)}:Sv;function tS(n){setTimeout(function(){throw n})}function qi(n){return n==="head"}function Cv(n,i){var l=i,d=0;do{var y=l.nextSibling;if(n.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"||l==="/&"){if(d===0){n.removeChild(y),bo(i);return}d--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")d++;else if(l==="html")Il(n.ownerDocument.documentElement);else if(l==="head"){l=n.ownerDocument.head,Il(l);for(var b=l.firstChild;b;){var D=b.nextSibling,W=b.nodeName;b[pe]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&b.rel.toLowerCase()==="stylesheet"||l.removeChild(b),b=D}}else l==="body"&&Il(n.ownerDocument.body);l=y}while(l);bo(i)}function kv(n,i){var l=n;n=0;do{var d=l.nextSibling;if(l.nodeType===1?i?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(i?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),d&&d.nodeType===8)if(l=d.data,l==="/$"){if(n===0)break;n--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||n++;l=d}while(l)}function Cf(n){var i=n.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Cf(l),Ne(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}n.removeChild(l)}}function nS(n,i,l,d){for(;n.nodeType===1;){var y=l;if(n.nodeName.toLowerCase()!==i.toLowerCase()){if(!d&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(d){if(!n[pe])switch(i){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(b=n.getAttribute("rel"),b==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(b!==y.rel||n.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||n.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||n.getAttribute("title")!==(y.title==null?null:y.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(b=n.getAttribute("src"),(b!==(y.src==null?null:y.src)||n.getAttribute("type")!==(y.type==null?null:y.type)||n.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(i==="input"&&n.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&n.getAttribute("name")===b)return n}else return n;if(n=ds(n.nextSibling),n===null)break}return null}function rS(n,i,l){if(i==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!l||(n=ds(n.nextSibling),n===null))return null;return n}function Ev(n,i){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!i||(n=ds(n.nextSibling),n===null))return null;return n}function kf(n){return n.data==="$?"||n.data==="$~"}function Ef(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function sS(n,i){var l=n.ownerDocument;if(n.data==="$~")n._reactRetry=i;else if(n.data!=="$?"||l.readyState!=="loading")i();else{var d=function(){i(),l.removeEventListener("DOMContentLoaded",d)};l.addEventListener("DOMContentLoaded",d),n._reactRetry=d}}function ds(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return n}var Nf=null;function Nv(n){n=n.nextSibling;for(var i=0;n;){if(n.nodeType===8){var l=n.data;if(l==="/$"||l==="/&"){if(i===0)return ds(n.nextSibling);i--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||i++}n=n.nextSibling}return null}function Av(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var l=n.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(i===0)return n;i--}else l!=="/$"&&l!=="/&"||i++}n=n.previousSibling}return null}function Tv(n,i,l){switch(i=bu(l),n){case"html":if(n=i.documentElement,!n)throw Error(a(452));return n;case"head":if(n=i.head,!n)throw Error(a(453));return n;case"body":if(n=i.body,!n)throw Error(a(454));return n;default:throw Error(a(451))}}function Il(n){for(var i=n.attributes;i.length;)n.removeAttributeNode(i[0]);Ne(n)}var hs=new Map,Rv=new Set;function _u(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var li=V.d;V.d={f:iS,r:aS,D:oS,C:lS,L:cS,m:uS,X:hS,S:dS,M:fS};function iS(){var n=li.f(),i=hu();return n||i}function aS(n){var i=it(n);i!==null&&i.tag===5&&i.type==="form"?Wg(i):li.r(n)}var yo=typeof document>"u"?null:document;function Ov(n,i,l){var d=yo;if(d&&typeof i=="string"&&i){var y=Ar(i);y='link[rel="'+n+'"][href="'+y+'"]',typeof l=="string"&&(y+='[crossorigin="'+l+'"]'),Rv.has(y)||(Rv.add(y),n={rel:n,crossOrigin:l,href:i},d.querySelector(y)===null&&(i=d.createElement("link"),Sr(i,"link",n),lt(i),d.head.appendChild(i)))}}function oS(n){li.D(n),Ov("dns-prefetch",n,null)}function lS(n,i){li.C(n,i),Ov("preconnect",n,i)}function cS(n,i,l){li.L(n,i,l);var d=yo;if(d&&n&&i){var y='link[rel="preload"][as="'+Ar(i)+'"]';i==="image"&&l&&l.imageSrcSet?(y+='[imagesrcset="'+Ar(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(y+='[imagesizes="'+Ar(l.imageSizes)+'"]')):y+='[href="'+Ar(n)+'"]';var b=y;switch(i){case"style":b=vo(n);break;case"script":b=xo(n)}hs.has(b)||(n=g({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:n,as:i},l),hs.set(b,n),d.querySelector(y)!==null||i==="style"&&d.querySelector(Ml(b))||i==="script"&&d.querySelector(Ul(b))||(i=d.createElement("link"),Sr(i,"link",n),lt(i),d.head.appendChild(i)))}}function uS(n,i){li.m(n,i);var l=yo;if(l&&n){var d=i&&typeof i.as=="string"?i.as:"script",y='link[rel="modulepreload"][as="'+Ar(d)+'"][href="'+Ar(n)+'"]',b=y;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=xo(n)}if(!hs.has(b)&&(n=g({rel:"modulepreload",href:n},i),hs.set(b,n),l.querySelector(y)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Ul(b)))return}d=l.createElement("link"),Sr(d,"link",n),lt(d),l.head.appendChild(d)}}}function dS(n,i,l){li.S(n,i,l);var d=yo;if(d&&n){var y=Xe(d).hoistableStyles,b=vo(n);i=i||"default";var D=y.get(b);if(!D){var W={loading:0,preload:null};if(D=d.querySelector(Ml(b)))W.loading=5;else{n=g({rel:"stylesheet",href:n,"data-precedence":i},l),(l=hs.get(b))&&Af(n,l);var me=D=d.createElement("link");lt(me),Sr(me,"link",n),me._p=new Promise(function(ze,Fe){me.onload=ze,me.onerror=Fe}),me.addEventListener("load",function(){W.loading|=1}),me.addEventListener("error",function(){W.loading|=2}),W.loading|=4,wu(D,i,d)}D={type:"stylesheet",instance:D,count:1,state:W},y.set(b,D)}}}function hS(n,i){li.X(n,i);var l=yo;if(l&&n){var d=Xe(l).hoistableScripts,y=xo(n),b=d.get(y);b||(b=l.querySelector(Ul(y)),b||(n=g({src:n,async:!0},i),(i=hs.get(y))&&Tf(n,i),b=l.createElement("script"),lt(b),Sr(b,"link",n),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(y,b))}}function fS(n,i){li.M(n,i);var l=yo;if(l&&n){var d=Xe(l).hoistableScripts,y=xo(n),b=d.get(y);b||(b=l.querySelector(Ul(y)),b||(n=g({src:n,async:!0,type:"module"},i),(i=hs.get(y))&&Tf(n,i),b=l.createElement("script"),lt(b),Sr(b,"link",n),l.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},d.set(y,b))}}function Dv(n,i,l,d){var y=(y=Ce.current)?_u(y):null;if(!y)throw Error(a(446));switch(n){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=vo(l.href),l=Xe(y).hoistableStyles,d=l.get(i),d||(d={type:"style",instance:null,count:0,state:null},l.set(i,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){n=vo(l.href);var b=Xe(y).hoistableStyles,D=b.get(n);if(D||(y=y.ownerDocument||y,D={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(n,D),(b=y.querySelector(Ml(n)))&&!b._p&&(D.instance=b,D.state.loading=5),hs.has(n)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},hs.set(n,l),b||pS(y,n,l,D.state))),i&&d===null)throw Error(a(528,""));return D}if(i&&d!==null)throw Error(a(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=xo(l),l=Xe(y).hoistableScripts,d=l.get(i),d||(d={type:"script",instance:null,count:0,state:null},l.set(i,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,n))}}function vo(n){return'href="'+Ar(n)+'"'}function Ml(n){return'link[rel="stylesheet"]['+n+"]"}function Lv(n){return g({},n,{"data-precedence":n.precedence,precedence:null})}function pS(n,i,l,d){n.querySelector('link[rel="preload"][as="style"]['+i+"]")?d.loading=1:(i=n.createElement("link"),d.preload=i,i.addEventListener("load",function(){return d.loading|=1}),i.addEventListener("error",function(){return d.loading|=2}),Sr(i,"link",l),lt(i),n.head.appendChild(i))}function xo(n){return'[src="'+Ar(n)+'"]'}function Ul(n){return"script[async]"+n}function zv(n,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var d=n.querySelector('style[data-href~="'+Ar(l.href)+'"]');if(d)return i.instance=d,lt(d),d;var y=g({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return d=(n.ownerDocument||n).createElement("style"),lt(d),Sr(d,"style",y),wu(d,l.precedence,n),i.instance=d;case"stylesheet":y=vo(l.href);var b=n.querySelector(Ml(y));if(b)return i.state.loading|=4,i.instance=b,lt(b),b;d=Lv(l),(y=hs.get(y))&&Af(d,y),b=(n.ownerDocument||n).createElement("link"),lt(b);var D=b;return D._p=new Promise(function(W,me){D.onload=W,D.onerror=me}),Sr(b,"link",d),i.state.loading|=4,wu(b,l.precedence,n),i.instance=b;case"script":return b=xo(l.src),(y=n.querySelector(Ul(b)))?(i.instance=y,lt(y),y):(d=l,(y=hs.get(b))&&(d=g({},l),Tf(d,y)),n=n.ownerDocument||n,y=n.createElement("script"),lt(y),Sr(y,"link",d),n.head.appendChild(y),i.instance=y);case"void":return null;default:throw Error(a(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(d=i.instance,i.state.loading|=4,wu(d,l.precedence,n));return i.instance}function wu(n,i,l){for(var d=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=d.length?d[d.length-1]:null,b=y,D=0;D<d.length;D++){var W=d[D];if(W.dataset.precedence===i)b=W;else if(b!==y)break}b?b.parentNode.insertBefore(n,b.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(n,i.firstChild))}function Af(n,i){n.crossOrigin==null&&(n.crossOrigin=i.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=i.referrerPolicy),n.title==null&&(n.title=i.title)}function Tf(n,i){n.crossOrigin==null&&(n.crossOrigin=i.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=i.referrerPolicy),n.integrity==null&&(n.integrity=i.integrity)}var Su=null;function Iv(n,i,l){if(Su===null){var d=new Map,y=Su=new Map;y.set(l,d)}else y=Su,d=y.get(l),d||(d=new Map,y.set(l,d));if(d.has(n))return d;for(d.set(n,null),l=l.getElementsByTagName(n),y=0;y<l.length;y++){var b=l[y];if(!(b[pe]||b[ke]||n==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var D=b.getAttribute(i)||"";D=n+D;var W=d.get(D);W?W.push(b):d.set(D,[b])}}return d}function Mv(n,i,l){n=n.ownerDocument||n,n.head.insertBefore(l,i==="title"?n.querySelector("head > title"):null)}function mS(n,i,l){if(l===1||i.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;return i.rel==="stylesheet"?(n=i.disabled,typeof i.precedence=="string"&&n==null):!0;case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function Uv(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function gS(n,i,l,d){if(l.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var y=vo(d.href),b=i.querySelector(Ml(y));if(b){i=b._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(n.count++,n=ju.bind(n),i.then(n,n)),l.state.loading|=4,l.instance=b,lt(b);return}b=i.ownerDocument||i,d=Lv(d),(y=hs.get(y))&&Af(d,y),b=b.createElement("link"),lt(b);var D=b;D._p=new Promise(function(W,me){D.onload=W,D.onerror=me}),Sr(b,"link",d),l.instance=b}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(l,i),(i=l.state.preload)&&(l.state.loading&3)===0&&(n.count++,l=ju.bind(n),i.addEventListener("load",l),i.addEventListener("error",l))}}var Rf=0;function yS(n,i){return n.stylesheets&&n.count===0&&ku(n,n.stylesheets),0<n.count||0<n.imgCount?function(l){var d=setTimeout(function(){if(n.stylesheets&&ku(n,n.stylesheets),n.unsuspend){var b=n.unsuspend;n.unsuspend=null,b()}},6e4+i);0<n.imgBytes&&Rf===0&&(Rf=62500*Jw());var y=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&ku(n,n.stylesheets),n.unsuspend)){var b=n.unsuspend;n.unsuspend=null,b()}},(n.imgBytes>Rf?50:800)+i);return n.unsuspend=l,function(){n.unsuspend=null,clearTimeout(d),clearTimeout(y)}}:null}function ju(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ku(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Cu=null;function ku(n,i){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Cu=new Map,i.forEach(vS,n),Cu=null,ju.call(n))}function vS(n,i){if(!(i.state.loading&4)){var l=Cu.get(n);if(l)var d=l.get(null);else{l=new Map,Cu.set(n,l);for(var y=n.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var D=y[b];(D.nodeName==="LINK"||D.getAttribute("media")!=="not all")&&(l.set(D.dataset.precedence,D),d=D)}d&&l.set(null,d)}y=i.instance,D=y.getAttribute("data-precedence"),b=l.get(D)||d,b===d&&l.set(null,y),l.set(D,y),this.count++,d=ju.bind(this),y.addEventListener("load",d),y.addEventListener("error",d),b?b.parentNode.insertBefore(y,b.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(y,n.firstChild)),i.state.loading|=4}}var Bl={$$typeof:T,Provider:null,Consumer:null,_currentValue:G,_currentValue2:G,_threadCount:0};function xS(n,i,l,d,y,b,D,W,me){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_n(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_n(0),this.hiddenUpdates=_n(null),this.identifierPrefix=d,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=D,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=me,this.incompleteTransitions=new Map}function Bv(n,i,l,d,y,b,D,W,me,ze,Fe,He){return n=new xS(n,i,l,D,me,ze,Fe,He,W),i=1,b===!0&&(i|=24),b=Wr(3,null,null,i),n.current=b,b.stateNode=n,i=ch(),i.refCount++,n.pooledCache=i,i.refCount++,b.memoizedState={element:d,isDehydrated:l,cache:i},fh(b),n}function Pv(n){return n?(n=Ya,n):Ya}function $v(n,i,l,d,y,b){y=Pv(y),d.context===null?d.context=y:d.pendingContext=y,d=Ri(i),d.payload={element:l},b=b===void 0?null:b,b!==null&&(d.callback=b),l=Oi(n,d,i),l!==null&&(qr(l,n,i),yl(l,n,i))}function qv(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var l=n.retryLane;n.retryLane=l!==0&&l<i?l:i}}function Of(n,i){qv(n,i),(n=n.alternate)&&qv(n,i)}function Fv(n){if(n.tag===13||n.tag===31){var i=da(n,67108864);i!==null&&qr(i,n,67108864),Of(n,67108864)}}function Vv(n){if(n.tag===13||n.tag===31){var i=Zr();i=It(i);var l=da(n,i);l!==null&&qr(l,n,i),Of(n,i)}}var Eu=!0;function bS(n,i,l,d){var y=L.T;L.T=null;var b=V.p;try{V.p=2,Df(n,i,l,d)}finally{V.p=b,L.T=y}}function _S(n,i,l,d){var y=L.T;L.T=null;var b=V.p;try{V.p=8,Df(n,i,l,d)}finally{V.p=b,L.T=y}}function Df(n,i,l,d){if(Eu){var y=Lf(d);if(y===null)xf(n,i,d,Nu,l),Gv(n,d);else if(SS(y,n,i,l,d))d.stopPropagation();else if(Gv(n,d),i&4&&-1<wS.indexOf(n)){for(;y!==null;){var b=it(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var D=ht(b.pendingLanes);if(D!==0){var W=b;for(W.pendingLanes|=2,W.entangledLanes|=2;D;){var me=1<<31-Ot(D);W.entanglements[1]|=me,D&=~me}Bs(b),(yn&6)===0&&(uu=qe()+500,Dl(0))}}break;case 31:case 13:W=da(b,2),W!==null&&qr(W,b,2),hu(),Of(b,2)}if(b=Lf(d),b===null&&xf(n,i,d,Nu,l),b===y)break;y=b}y!==null&&d.stopPropagation()}else xf(n,i,d,null,l)}}function Lf(n){return n=Wn(n),zf(n)}var Nu=null;function zf(n){if(Nu=null,n=Be(n),n!==null){var i=c(n);if(i===null)n=null;else{var l=i.tag;if(l===13){if(n=u(i),n!==null)return n;n=null}else if(l===31){if(n=h(i),n!==null)return n;n=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null)}}return Nu=n,null}function Hv(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Re()){case $e:return 2;case Ke:return 8;case Ye:case Et:return 32;case Kt:return 268435456;default:return 32}default:return 32}}var If=!1,Fi=null,Vi=null,Hi=null,Pl=new Map,$l=new Map,Gi=[],wS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Gv(n,i){switch(n){case"focusin":case"focusout":Fi=null;break;case"dragenter":case"dragleave":Vi=null;break;case"mouseover":case"mouseout":Hi=null;break;case"pointerover":case"pointerout":Pl.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":$l.delete(i.pointerId)}}function ql(n,i,l,d,y,b){return n===null||n.nativeEvent!==b?(n={blockedOn:i,domEventName:l,eventSystemFlags:d,nativeEvent:b,targetContainers:[y]},i!==null&&(i=it(i),i!==null&&Fv(i)),n):(n.eventSystemFlags|=d,i=n.targetContainers,y!==null&&i.indexOf(y)===-1&&i.push(y),n)}function SS(n,i,l,d,y){switch(i){case"focusin":return Fi=ql(Fi,n,i,l,d,y),!0;case"dragenter":return Vi=ql(Vi,n,i,l,d,y),!0;case"mouseover":return Hi=ql(Hi,n,i,l,d,y),!0;case"pointerover":var b=y.pointerId;return Pl.set(b,ql(Pl.get(b)||null,n,i,l,d,y)),!0;case"gotpointercapture":return b=y.pointerId,$l.set(b,ql($l.get(b)||null,n,i,l,d,y)),!0}return!1}function Kv(n){var i=Be(n.target);if(i!==null){var l=c(i);if(l!==null){if(i=l.tag,i===13){if(i=u(l),i!==null){n.blockedOn=i,dn(n.priority,function(){Vv(l)});return}}else if(i===31){if(i=h(l),i!==null){n.blockedOn=i,dn(n.priority,function(){Vv(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){n.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Au(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var l=Lf(n.nativeEvent);if(l===null){l=n.nativeEvent;var d=new l.constructor(l.type,l);Ut=d,l.target.dispatchEvent(d),Ut=null}else return i=it(l),i!==null&&Fv(i),n.blockedOn=l,!1;i.shift()}return!0}function Wv(n,i,l){Au(n)&&l.delete(i)}function jS(){If=!1,Fi!==null&&Au(Fi)&&(Fi=null),Vi!==null&&Au(Vi)&&(Vi=null),Hi!==null&&Au(Hi)&&(Hi=null),Pl.forEach(Wv),$l.forEach(Wv)}function Tu(n,i){n.blockedOn===i&&(n.blockedOn=null,If||(If=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,jS)))}var Ru=null;function Yv(n){Ru!==n&&(Ru=n,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Ru===n&&(Ru=null);for(var i=0;i<n.length;i+=3){var l=n[i],d=n[i+1],y=n[i+2];if(typeof d!="function"){if(zf(d||l)===null)continue;break}var b=it(l);b!==null&&(n.splice(i,3),i-=3,Dh(b,{pending:!0,data:y,method:l.method,action:d},d,y))}}))}function bo(n){function i(me){return Tu(me,n)}Fi!==null&&Tu(Fi,n),Vi!==null&&Tu(Vi,n),Hi!==null&&Tu(Hi,n),Pl.forEach(i),$l.forEach(i);for(var l=0;l<Gi.length;l++){var d=Gi[l];d.blockedOn===n&&(d.blockedOn=null)}for(;0<Gi.length&&(l=Gi[0],l.blockedOn===null);)Kv(l),l.blockedOn===null&&Gi.shift();if(l=(n.ownerDocument||n).$$reactFormReplay,l!=null)for(d=0;d<l.length;d+=3){var y=l[d],b=l[d+1],D=y[te]||null;if(typeof b=="function")D||Yv(l);else if(D){var W=null;if(b&&b.hasAttribute("formAction")){if(y=b,D=b[te]||null)W=D.formAction;else if(zf(y)!==null)continue}else W=D.action;typeof W=="function"?l[d+1]=W:(l.splice(d,3),d-=3),Yv(l)}}}function Qv(){function n(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(D){return y=D})},focusReset:"manual",scroll:"manual"})}function i(){y!==null&&(y(),y=null),d||setTimeout(l,20)}function l(){if(!d&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,y=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(l,100),function(){d=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),y!==null&&(y(),y=null)}}}function Mf(n){this._internalRoot=n}Ou.prototype.render=Mf.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(a(409));var l=i.current,d=Zr();$v(l,d,n,i,null,null)},Ou.prototype.unmount=Mf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;$v(n.current,2,null,n,null,null),hu(),i[je]=null}};function Ou(n){this._internalRoot=n}Ou.prototype.unstable_scheduleHydration=function(n){if(n){var i=Kn();n={blockedOn:null,target:n,priority:i};for(var l=0;l<Gi.length&&i!==0&&i<Gi[l].priority;l++);Gi.splice(l,0,n),l===0&&Kv(n)}};var Jv=t.version;if(Jv!=="19.2.3")throw Error(a(527,Jv,"19.2.3"));V.findDOMNode=function(n){var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(a(188)):(n=Object.keys(n).join(","),Error(a(268,n)));return n=p(i),n=n!==null?m(n):null,n=n===null?null:n.stateNode,n};var CS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Du=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Du.isDisabled&&Du.supportsFiber)try{mt=Du.inject(CS),$t=Du}catch{}}return Vl.createRoot=function(n,i){if(!o(n))throw Error(a(299));var l=!1,d="",y=sy,b=iy,D=ay;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onUncaughtError!==void 0&&(y=i.onUncaughtError),i.onCaughtError!==void 0&&(b=i.onCaughtError),i.onRecoverableError!==void 0&&(D=i.onRecoverableError)),i=Bv(n,1,!1,null,null,l,d,null,y,b,D,Qv),n[je]=i.current,vf(n),new Mf(i)},Vl.hydrateRoot=function(n,i,l){if(!o(n))throw Error(a(299));var d=!1,y="",b=sy,D=iy,W=ay,me=null;return l!=null&&(l.unstable_strictMode===!0&&(d=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(D=l.onCaughtError),l.onRecoverableError!==void 0&&(W=l.onRecoverableError),l.formState!==void 0&&(me=l.formState)),i=Bv(n,1,!0,i,l??null,d,y,me,b,D,W,Qv),i.context=Pv(null),l=i.current,d=Zr(),d=It(d),y=Ri(d),y.callback=null,Oi(l,y,d),l=d,i.current.lanes=l,xn(i,l),Bs(i),n[je]=i.current,vf(n),new Ou(i)},Vl.version="19.2.3",Vl}var o0;function LS(){if(o0)return Pf.exports;o0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Pf.exports=DS(),Pf.exports}var zS=LS();var l0="popstate";function IS(e={}){function t(a,o){let{pathname:c,search:u,hash:h}=a.location;return Rp("",{pathname:c,search:u,hash:h},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function s(a,o){return typeof o=="string"?o:cc(o)}return US(t,s,null,e)}function pr(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function ys(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function MS(){return Math.random().toString(36).substring(2,10)}function c0(e,t){return{usr:e.state,key:e.key,idx:t}}function Rp(e,t,s=null,a){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof t=="string"?_c(t):t,state:s,key:t&&t.key||a||MS()}}function cc({pathname:e="/",search:t="",hash:s=""}){return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function _c(e){let t={};if(e){let s=e.indexOf("#");s>=0&&(t.hash=e.substring(s),e=e.substring(0,s));let a=e.indexOf("?");a>=0&&(t.search=e.substring(a),e=e.substring(0,a)),e&&(t.pathname=e)}return t}function US(e,t,s,a={}){let{window:o=document.defaultView,v5Compat:c=!1}=a,u=o.history,h="POP",f=null,p=m();p==null&&(p=0,u.replaceState({...u.state,idx:p},""));function m(){return(u.state||{idx:null}).idx}function g(){h="POP";let _=m(),j=_==null?null:_-p;p=_,f&&f({action:h,location:w.location,delta:j})}function x(_,j){h="PUSH";let E=Rp(w.location,_,j);p=m()+1;let T=c0(E,p),R=w.createHref(E);try{u.pushState(T,"",R)}catch(B){if(B instanceof DOMException&&B.name==="DataCloneError")throw B;o.location.assign(R)}c&&f&&f({action:h,location:w.location,delta:1})}function v(_,j){h="REPLACE";let E=Rp(w.location,_,j);p=m();let T=c0(E,p),R=w.createHref(E);u.replaceState(T,"",R),c&&f&&f({action:h,location:w.location,delta:0})}function S(_){return BS(_)}let w={get action(){return h},get location(){return e(o,u)},listen(_){if(f)throw new Error("A history only accepts one active listener");return o.addEventListener(l0,g),f=_,()=>{o.removeEventListener(l0,g),f=null}},createHref(_){return t(o,_)},createURL:S,encodeLocation(_){let j=S(_);return{pathname:j.pathname,search:j.search,hash:j.hash}},push:x,replace:v,go(_){return u.go(_)}};return w}function BS(e,t=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),pr(s,"No window.location.(origin|href) available to create URL");let a=typeof e=="string"?e:cc(e);return a=a.replace(/ $/,"%20"),!t&&a.startsWith("//")&&(a=s+a),new URL(a,s)}function tb(e,t,s="/"){return PS(e,t,s,!1)}function PS(e,t,s,a){let o=typeof t=="string"?_c(t):t,c=yi(o.pathname||"/",s);if(c==null)return null;let u=nb(e);$S(u);let h=null;for(let f=0;h==null&&f<u.length;++f){let p=XS(c);h=QS(u[f],p,a)}return h}function nb(e,t=[],s=[],a="",o=!1){let c=(u,h,f=o,p)=>{let m={relativePath:p===void 0?u.path||"":p,caseSensitive:u.caseSensitive===!0,childrenIndex:h,route:u};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(a)&&f)return;pr(m.relativePath.startsWith(a),`Absolute route path "${m.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(a.length)}let g=gi([a,m.relativePath]),x=s.concat(m);u.children&&u.children.length>0&&(pr(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),nb(u.children,t,x,g,f)),!(u.path==null&&!u.index)&&t.push({path:g,score:WS(g,u.index),routesMeta:x})};return e.forEach((u,h)=>{if(u.path===""||!u.path?.includes("?"))c(u,h);else for(let f of rb(u.path))c(u,h,!0,f)}),t}function rb(e){let t=e.split("/");if(t.length===0)return[];let[s,...a]=t,o=s.endsWith("?"),c=s.replace(/\?$/,"");if(a.length===0)return o?[c,""]:[c];let u=rb(a.join("/")),h=[];return h.push(...u.map(f=>f===""?c:[c,f].join("/"))),o&&h.push(...u),h.map(f=>e.startsWith("/")&&f===""?"/":f)}function $S(e){e.sort((t,s)=>t.score!==s.score?s.score-t.score:YS(t.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}var qS=/^:[\w-]+$/,FS=3,VS=2,HS=1,GS=10,KS=-2,u0=e=>e==="*";function WS(e,t){let s=e.split("/"),a=s.length;return s.some(u0)&&(a+=KS),t&&(a+=VS),s.filter(o=>!u0(o)).reduce((o,c)=>o+(qS.test(c)?FS:c===""?HS:GS),a)}function YS(e,t){return e.length===t.length&&e.slice(0,-1).every((a,o)=>a===t[o])?e[e.length-1]-t[t.length-1]:0}function QS(e,t,s=!1){let{routesMeta:a}=e,o={},c="/",u=[];for(let h=0;h<a.length;++h){let f=a[h],p=h===a.length-1,m=c==="/"?t:t.slice(c.length)||"/",g=cd({path:f.relativePath,caseSensitive:f.caseSensitive,end:p},m),x=f.route;if(!g&&p&&s&&!a[a.length-1].route.index&&(g=cd({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},m)),!g)return null;Object.assign(o,g.params),u.push({params:o,pathname:gi([c,g.pathname]),pathnameBase:n1(gi([c,g.pathnameBase])),route:x}),g.pathnameBase!=="/"&&(c=gi([c,g.pathnameBase]))}return u}function cd(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[s,a]=JS(e.path,e.caseSensitive,e.end),o=t.match(s);if(!o)return null;let c=o[0],u=c.replace(/(.)\/+$/,"$1"),h=o.slice(1);return{params:a.reduce((p,{paramName:m,isOptional:g},x)=>{if(m==="*"){let S=h[x]||"";u=c.slice(0,c.length-S.length).replace(/(.)\/+$/,"$1")}const v=h[x];return g&&!v?p[m]=void 0:p[m]=(v||"").replace(/%2F/g,"/"),p},{}),pathname:c,pathnameBase:u,pattern:e}}function JS(e,t=!1,s=!0){ys(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let a=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,h,f)=>(a.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(a.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),a]}function XS(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return ys(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function yi(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,a=e.charAt(s);return a&&a!=="/"?null:e.slice(s)||"/"}var sb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ZS=e=>sb.test(e);function e1(e,t="/"){let{pathname:s,search:a="",hash:o=""}=typeof e=="string"?_c(e):e,c;if(s)if(ZS(s))c=s;else{if(s.includes("//")){let u=s;s=s.replace(/\/\/+/g,"/"),ys(!1,`Pathnames cannot have embedded double slashes - normalizing ${u} -> ${s}`)}s.startsWith("/")?c=d0(s.substring(1),"/"):c=d0(s,t)}else c=t;return{pathname:c,search:r1(a),hash:s1(o)}}function d0(e,t){let s=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?s.length>1&&s.pop():o!=="."&&s.push(o)}),s.length>1?s.join("/"):"/"}function Vf(e,t,s,a){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function t1(e){return e.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function ib(e){let t=t1(e);return t.map((s,a)=>a===t.length-1?s.pathname:s.pathnameBase)}function ab(e,t,s,a=!1){let o;typeof e=="string"?o=_c(e):(o={...e},pr(!o.pathname||!o.pathname.includes("?"),Vf("?","pathname","search",o)),pr(!o.pathname||!o.pathname.includes("#"),Vf("#","pathname","hash",o)),pr(!o.search||!o.search.includes("#"),Vf("#","search","hash",o)));let c=e===""||o.pathname==="",u=c?"/":o.pathname,h;if(u==null)h=s;else{let g=t.length-1;if(!a&&u.startsWith("..")){let x=u.split("/");for(;x[0]==="..";)x.shift(),g-=1;o.pathname=x.join("/")}h=g>=0?t[g]:"/"}let f=e1(o,h),p=u&&u!=="/"&&u.endsWith("/"),m=(c||u===".")&&s.endsWith("/");return!f.pathname.endsWith("/")&&(p||m)&&(f.pathname+="/"),f}var gi=e=>e.join("/").replace(/\/\/+/g,"/"),n1=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),r1=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,s1=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,i1=class{constructor(e,t,s,a=!1){this.status=e,this.statusText=t||"",this.internal=a,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function a1(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}function o1(e){return e.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var ob=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function lb(e,t){let s=e;if(typeof s!="string"||!sb.test(s))return{absoluteURL:void 0,isExternal:!1,to:s};let a=s,o=!1;if(ob)try{let c=new URL(window.location.href),u=s.startsWith("//")?new URL(c.protocol+s):new URL(s),h=yi(u.pathname,t);u.origin===c.origin&&h!=null?s=h+u.search+u.hash:o=!0}catch{ys(!1,`<Link to="${s}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:o,to:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var cb=["POST","PUT","PATCH","DELETE"];new Set(cb);var l1=["GET",...cb];new Set(l1);var Qo=k.createContext(null);Qo.displayName="DataRouter";var kd=k.createContext(null);kd.displayName="DataRouterState";var c1=k.createContext(!1),ub=k.createContext({isTransitioning:!1});ub.displayName="ViewTransition";var u1=k.createContext(new Map);u1.displayName="Fetchers";var d1=k.createContext(null);d1.displayName="Await";var vs=k.createContext(null);vs.displayName="Navigation";var Ed=k.createContext(null);Ed.displayName="Location";var xi=k.createContext({outlet:null,matches:[],isDataRoute:!1});xi.displayName="Route";var rm=k.createContext(null);rm.displayName="RouteError";var db="REACT_ROUTER_ERROR",h1="REDIRECT",f1="ROUTE_ERROR_RESPONSE";function p1(e){if(e.startsWith(`${db}:${h1}:{`))try{let t=JSON.parse(e.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function m1(e){if(e.startsWith(`${db}:${f1}:{`))try{let t=JSON.parse(e.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new i1(t.status,t.statusText,t.data)}catch{}}function g1(e,{relative:t}={}){pr(wc(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:a}=k.useContext(vs),{hash:o,pathname:c,search:u}=Sc(e,{relative:t}),h=c;return s!=="/"&&(h=c==="/"?s:gi([s,c])),a.createHref({pathname:h,search:u,hash:o})}function wc(){return k.useContext(Ed)!=null}function bi(){return pr(wc(),"useLocation() may be used only in the context of a <Router> component."),k.useContext(Ed).location}var hb="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function fb(e){k.useContext(vs).static||k.useLayoutEffect(e)}function pb(){let{isDataRoute:e}=k.useContext(xi);return e?A1():y1()}function y1(){pr(wc(),"useNavigate() may be used only in the context of a <Router> component.");let e=k.useContext(Qo),{basename:t,navigator:s}=k.useContext(vs),{matches:a}=k.useContext(xi),{pathname:o}=bi(),c=JSON.stringify(ib(a)),u=k.useRef(!1);return fb(()=>{u.current=!0}),k.useCallback((f,p={})=>{if(ys(u.current,hb),!u.current)return;if(typeof f=="number"){s.go(f);return}let m=ab(f,JSON.parse(c),o,p.relative==="path");e==null&&t!=="/"&&(m.pathname=m.pathname==="/"?t:gi([t,m.pathname])),(p.replace?s.replace:s.push)(m,p.state,p)},[t,s,c,o,e])}k.createContext(null);function Sc(e,{relative:t}={}){let{matches:s}=k.useContext(xi),{pathname:a}=bi(),o=JSON.stringify(ib(s));return k.useMemo(()=>ab(e,JSON.parse(o),a,t==="path"),[e,o,a,t])}function v1(e,t,s,a,o){pr(wc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=k.useContext(vs),{matches:u}=k.useContext(xi),h=u[u.length-1],f=h?h.params:{},p=h?h.pathname:"/",m=h?h.pathnameBase:"/",g=h&&h.route;{let E=g&&g.path||"";gb(p,!g||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let x=bi(),v;v=x;let S=v.pathname||"/",w=S;if(m!=="/"){let E=m.replace(/^\//,"").split("/");w="/"+S.replace(/^\//,"").split("/").slice(E.length).join("/")}let _=tb(e,{pathname:w});return ys(g||_!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),ys(_==null||_[_.length-1].route.element!==void 0||_[_.length-1].route.Component!==void 0||_[_.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),S1(_&&_.map(E=>Object.assign({},E,{params:Object.assign({},f,E.params),pathname:gi([m,c.encodeLocation?c.encodeLocation(E.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?m:gi([m,c.encodeLocation?c.encodeLocation(E.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathnameBase])})),u,s,a,o)}function x1(){let e=N1(),t=a1(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),s=e instanceof Error?e.stack:null,a="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:a},c={padding:"2px 4px",backgroundColor:a},u=null;return console.error("Error handled by React Router default ErrorBoundary:",e),u=k.createElement(k.Fragment,null,k.createElement("p",null," Hey developer "),k.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",k.createElement("code",{style:c},"ErrorBoundary")," or"," ",k.createElement("code",{style:c},"errorElement")," prop on your route.")),k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},t),s?k.createElement("pre",{style:o},s):null,u)}var b1=k.createElement(x1,null),mb=class extends k.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){let e=this.state.error;if(this.context&&typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){const s=m1(e.digest);s&&(e=s)}let t=e!==void 0?k.createElement(xi.Provider,{value:this.props.routeContext},k.createElement(rm.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?k.createElement(_1,{error:e},t):t}};mb.contextType=c1;var Hf=new WeakMap;function _1({children:e,error:t}){let{basename:s}=k.useContext(vs);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let a=p1(t.digest);if(a){let o=Hf.get(t);if(o)throw o;let c=lb(a.location,s);if(ob&&!Hf.get(t))if(c.isExternal||a.reloadDocument)window.location.href=c.absoluteURL||c.to;else{const u=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(c.to,{replace:a.replace}));throw Hf.set(t,u),u}return k.createElement("meta",{httpEquiv:"refresh",content:`0;url=${c.absoluteURL||c.to}`})}}return e}function w1({routeContext:e,match:t,children:s}){let a=k.useContext(Qo);return a&&a.static&&a.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=t.route.id),k.createElement(xi.Provider,{value:e},s)}function S1(e,t=[],s=null,a=null,o=null){if(e==null){if(!s)return null;if(s.errors)e=s.matches;else if(t.length===0&&!s.initialized&&s.matches.length>0)e=s.matches;else return null}let c=e,u=s?.errors;if(u!=null){let m=c.findIndex(g=>g.route.id&&u?.[g.route.id]!==void 0);pr(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),c=c.slice(0,Math.min(c.length,m+1))}let h=!1,f=-1;if(s)for(let m=0;m<c.length;m++){let g=c[m];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(f=m),g.route.id){let{loaderData:x,errors:v}=s,S=g.route.loader&&!x.hasOwnProperty(g.route.id)&&(!v||v[g.route.id]===void 0);if(g.route.lazy||S){h=!0,f>=0?c=c.slice(0,f+1):c=[c[0]];break}}}let p=s&&a?(m,g)=>{a(m,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:o1(s.matches),errorInfo:g})}:void 0;return c.reduceRight((m,g,x)=>{let v,S=!1,w=null,_=null;s&&(v=u&&g.route.id?u[g.route.id]:void 0,w=g.route.errorElement||b1,h&&(f<0&&x===0?(gb("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,_=null):f===x&&(S=!0,_=g.route.hydrateFallbackElement||null)));let j=t.concat(c.slice(0,x+1)),E=()=>{let T;return v?T=w:S?T=_:g.route.Component?T=k.createElement(g.route.Component,null):g.route.element?T=g.route.element:T=m,k.createElement(w1,{match:g,routeContext:{outlet:m,matches:j,isDataRoute:s!=null},children:T})};return s&&(g.route.ErrorBoundary||g.route.errorElement||x===0)?k.createElement(mb,{location:s.location,revalidation:s.revalidation,component:w,error:v,children:E(),routeContext:{outlet:null,matches:j,isDataRoute:!0},onError:p}):E()},null)}function sm(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function j1(e){let t=k.useContext(Qo);return pr(t,sm(e)),t}function C1(e){let t=k.useContext(kd);return pr(t,sm(e)),t}function k1(e){let t=k.useContext(xi);return pr(t,sm(e)),t}function im(e){let t=k1(e),s=t.matches[t.matches.length-1];return pr(s.route.id,`${e} can only be used on routes that contain a unique "id"`),s.route.id}function E1(){return im("useRouteId")}function N1(){let e=k.useContext(rm),t=C1("useRouteError"),s=im("useRouteError");return e!==void 0?e:t.errors?.[s]}function A1(){let{router:e}=j1("useNavigate"),t=im("useNavigate"),s=k.useRef(!1);return fb(()=>{s.current=!0}),k.useCallback(async(o,c={})=>{ys(s.current,hb),s.current&&(typeof o=="number"?await e.navigate(o):await e.navigate(o,{fromRouteId:t,...c}))},[e,t])}var h0={};function gb(e,t,s){!t&&!h0[e]&&(h0[e]=!0,ys(!1,s))}k.memo(T1);function T1({routes:e,future:t,state:s,onError:a}){return v1(e,void 0,s,a,t)}function R1({basename:e="/",children:t=null,location:s,navigationType:a="POP",navigator:o,static:c=!1,unstable_useTransitions:u}){pr(!wc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=e.replace(/^\/*/,"/"),f=k.useMemo(()=>({basename:h,navigator:o,static:c,unstable_useTransitions:u,future:{}}),[h,o,c,u]);typeof s=="string"&&(s=_c(s));let{pathname:p="/",search:m="",hash:g="",state:x=null,key:v="default"}=s,S=k.useMemo(()=>{let w=yi(p,h);return w==null?null:{location:{pathname:w,search:m,hash:g,state:x,key:v},navigationType:a}},[h,p,m,g,x,v,a]);return ys(S!=null,`<Router basename="${h}"> is not able to match the URL "${p}${m}${g}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:k.createElement(vs.Provider,{value:f},k.createElement(Ed.Provider,{children:t,value:S}))}var td="get",nd="application/x-www-form-urlencoded";function Nd(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement}function O1(e){return Nd(e)&&e.tagName.toLowerCase()==="button"}function D1(e){return Nd(e)&&e.tagName.toLowerCase()==="form"}function L1(e){return Nd(e)&&e.tagName.toLowerCase()==="input"}function z1(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function I1(e,t){return e.button===0&&(!t||t==="_self")&&!z1(e)}function Op(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,s)=>{let a=e[s];return t.concat(Array.isArray(a)?a.map(o=>[s,o]):[[s,a]])},[]))}function M1(e,t){let s=Op(e);return t&&t.forEach((a,o)=>{s.has(o)||t.getAll(o).forEach(c=>{s.append(o,c)})}),s}var zu=null;function U1(){if(zu===null)try{new FormData(document.createElement("form"),0),zu=!1}catch{zu=!0}return zu}var B1=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Gf(e){return e!=null&&!B1.has(e)?(ys(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${nd}"`),null):e}function P1(e,t){let s,a,o,c,u;if(D1(e)){let h=e.getAttribute("action");a=h?yi(h,t):null,s=e.getAttribute("method")||td,o=Gf(e.getAttribute("enctype"))||nd,c=new FormData(e)}else if(O1(e)||L1(e)&&(e.type==="submit"||e.type==="image")){let h=e.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=e.getAttribute("formaction")||h.getAttribute("action");if(a=f?yi(f,t):null,s=e.getAttribute("formmethod")||h.getAttribute("method")||td,o=Gf(e.getAttribute("formenctype"))||Gf(h.getAttribute("enctype"))||nd,c=new FormData(h,e),!U1()){let{name:p,type:m,value:g}=e;if(m==="image"){let x=p?`${p}.`:"";c.append(`${x}x`,"0"),c.append(`${x}y`,"0")}else p&&c.append(p,g)}}else{if(Nd(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=td,a=null,o=nd,u=e}return c&&o==="text/plain"&&(u=c,c=void 0),{action:a,method:s.toLowerCase(),encType:o,formData:c,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function am(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function $1(e,t,s){let a=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return a.pathname==="/"?a.pathname=`_root.${s}`:t&&yi(a.pathname,t)==="/"?a.pathname=`${t.replace(/\/$/,"")}/_root.${s}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${s}`,a}async function q1(e,t){if(e.id in t)return t[e.id];try{let s=await import(e.module);return t[e.id]=s,s}catch(s){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function F1(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function V1(e,t,s){let a=await Promise.all(e.map(async o=>{let c=t.routes[o.route.id];if(c){let u=await q1(c,s);return u.links?u.links():[]}return[]}));return W1(a.flat(1).filter(F1).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function f0(e,t,s,a,o,c){let u=(f,p)=>s[p]?f.route.id!==s[p].route.id:!0,h=(f,p)=>s[p].pathname!==f.pathname||s[p].route.path?.endsWith("*")&&s[p].params["*"]!==f.params["*"];return c==="assets"?t.filter((f,p)=>u(f,p)||h(f,p)):c==="data"?t.filter((f,p)=>{let m=a.routes[f.route.id];if(!m||!m.hasLoader)return!1;if(u(f,p)||h(f,p))return!0;if(f.route.shouldRevalidate){let g=f.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function H1(e,t,{includeHydrateFallback:s}={}){return G1(e.map(a=>{let o=t.routes[a.route.id];if(!o)return[];let c=[o.module];return o.clientActionModule&&(c=c.concat(o.clientActionModule)),o.clientLoaderModule&&(c=c.concat(o.clientLoaderModule)),s&&o.hydrateFallbackModule&&(c=c.concat(o.hydrateFallbackModule)),o.imports&&(c=c.concat(o.imports)),c}).flat(1))}function G1(e){return[...new Set(e)]}function K1(e){let t={},s=Object.keys(e).sort();for(let a of s)t[a]=e[a];return t}function W1(e,t){let s=new Set;return new Set(t),e.reduce((a,o)=>{let c=JSON.stringify(K1(o));return s.has(c)||(s.add(c),a.push({key:c,link:o})),a},[])}function yb(){let e=k.useContext(Qo);return am(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function Y1(){let e=k.useContext(kd);return am(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var om=k.createContext(void 0);om.displayName="FrameworkContext";function vb(){let e=k.useContext(om);return am(e,"You must render this element inside a <HydratedRouter> element"),e}function Q1(e,t){let s=k.useContext(om),[a,o]=k.useState(!1),[c,u]=k.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:p,onMouseLeave:m,onTouchStart:g}=t,x=k.useRef(null);k.useEffect(()=>{if(e==="render"&&u(!0),e==="viewport"){let w=j=>{j.forEach(E=>{u(E.isIntersecting)})},_=new IntersectionObserver(w,{threshold:.5});return x.current&&_.observe(x.current),()=>{_.disconnect()}}},[e]),k.useEffect(()=>{if(a){let w=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(w)}}},[a]);let v=()=>{o(!0)},S=()=>{o(!1),u(!1)};return s?e!=="intent"?[c,x,{}]:[c,x,{onFocus:Hl(h,v),onBlur:Hl(f,S),onMouseEnter:Hl(p,v),onMouseLeave:Hl(m,S),onTouchStart:Hl(g,v)}]:[!1,x,{}]}function Hl(e,t){return s=>{e&&e(s),s.defaultPrevented||t(s)}}function J1({page:e,...t}){let{router:s}=yb(),a=k.useMemo(()=>tb(s.routes,e,s.basename),[s.routes,e,s.basename]);return a?k.createElement(Z1,{page:e,matches:a,...t}):null}function X1(e){let{manifest:t,routeModules:s}=vb(),[a,o]=k.useState([]);return k.useEffect(()=>{let c=!1;return V1(e,t,s).then(u=>{c||o(u)}),()=>{c=!0}},[e,t,s]),a}function Z1({page:e,matches:t,...s}){let a=bi(),{manifest:o,routeModules:c}=vb(),{basename:u}=yb(),{loaderData:h,matches:f}=Y1(),p=k.useMemo(()=>f0(e,t,f,o,a,"data"),[e,t,f,o,a]),m=k.useMemo(()=>f0(e,t,f,o,a,"assets"),[e,t,f,o,a]),g=k.useMemo(()=>{if(e===a.pathname+a.search+a.hash)return[];let S=new Set,w=!1;if(t.forEach(j=>{let E=o.routes[j.route.id];!E||!E.hasLoader||(!p.some(T=>T.route.id===j.route.id)&&j.route.id in h&&c[j.route.id]?.shouldRevalidate||E.hasClientLoader?w=!0:S.add(j.route.id))}),S.size===0)return[];let _=$1(e,u,"data");return w&&S.size>0&&_.searchParams.set("_routes",t.filter(j=>S.has(j.route.id)).map(j=>j.route.id).join(",")),[_.pathname+_.search]},[u,h,a,o,p,t,e,c]),x=k.useMemo(()=>H1(m,o),[m,o]),v=X1(m);return k.createElement(k.Fragment,null,g.map(S=>k.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...s})),x.map(S=>k.createElement("link",{key:S,rel:"modulepreload",href:S,...s})),v.map(({key:S,link:w})=>k.createElement("link",{key:S,nonce:s.nonce,...w})))}function ej(...e){return t=>{e.forEach(s=>{typeof s=="function"?s(t):s!=null&&(s.current=t)})}}var tj=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{tj&&(window.__reactRouterVersion="7.11.0")}catch{}function nj({basename:e,children:t,unstable_useTransitions:s,window:a}){let o=k.useRef();o.current==null&&(o.current=IS({window:a,v5Compat:!0}));let c=o.current,[u,h]=k.useState({action:c.action,location:c.location}),f=k.useCallback(p=>{s===!1?h(p):k.startTransition(()=>h(p))},[s]);return k.useLayoutEffect(()=>c.listen(f),[c,f]),k.createElement(R1,{basename:e,children:t,location:u.location,navigationType:u.action,navigator:c,unstable_useTransitions:s})}var xb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,bb=k.forwardRef(function({onClick:t,discover:s="render",prefetch:a="none",relative:o,reloadDocument:c,replace:u,state:h,target:f,to:p,preventScrollReset:m,viewTransition:g,unstable_defaultShouldRevalidate:x,...v},S){let{basename:w,unstable_useTransitions:_}=k.useContext(vs),j=typeof p=="string"&&xb.test(p),E=lb(p,w);p=E.to;let T=g1(p,{relative:o}),[R,B,F]=Q1(a,v),$=aj(p,{replace:u,state:h,target:f,preventScrollReset:m,relative:o,viewTransition:g,unstable_defaultShouldRevalidate:x,unstable_useTransitions:_});function M(P){t&&t(P),P.defaultPrevented||$(P)}let z=k.createElement("a",{...v,...F,href:E.absoluteURL||T,onClick:E.isExternal||c?t:M,ref:ej(S,B),target:f,"data-discover":!j&&s==="render"?"true":void 0});return R&&!j?k.createElement(k.Fragment,null,z,k.createElement(J1,{page:T})):z});bb.displayName="Link";var rj=k.forwardRef(function({"aria-current":t="page",caseSensitive:s=!1,className:a="",end:o=!1,style:c,to:u,viewTransition:h,children:f,...p},m){let g=Sc(u,{relative:p.relative}),x=bi(),v=k.useContext(kd),{navigator:S,basename:w}=k.useContext(vs),_=v!=null&&dj(g)&&h===!0,j=S.encodeLocation?S.encodeLocation(g).pathname:g.pathname,E=x.pathname,T=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;s||(E=E.toLowerCase(),T=T?T.toLowerCase():null,j=j.toLowerCase()),T&&w&&(T=yi(T,w)||T);const R=j!=="/"&&j.endsWith("/")?j.length-1:j.length;let B=E===j||!o&&E.startsWith(j)&&E.charAt(R)==="/",F=T!=null&&(T===j||!o&&T.startsWith(j)&&T.charAt(j.length)==="/"),$={isActive:B,isPending:F,isTransitioning:_},M=B?t:void 0,z;typeof a=="function"?z=a($):z=[a,B?"active":null,F?"pending":null,_?"transitioning":null].filter(Boolean).join(" ");let P=typeof c=="function"?c($):c;return k.createElement(bb,{...p,"aria-current":M,className:z,ref:m,style:P,to:u,viewTransition:h},typeof f=="function"?f($):f)});rj.displayName="NavLink";var sj=k.forwardRef(({discover:e="render",fetcherKey:t,navigate:s,reloadDocument:a,replace:o,state:c,method:u=td,action:h,onSubmit:f,relative:p,preventScrollReset:m,viewTransition:g,unstable_defaultShouldRevalidate:x,...v},S)=>{let{unstable_useTransitions:w}=k.useContext(vs),_=cj(),j=uj(h,{relative:p}),E=u.toLowerCase()==="get"?"get":"post",T=typeof h=="string"&&xb.test(h),R=B=>{if(f&&f(B),B.defaultPrevented)return;B.preventDefault();let F=B.nativeEvent.submitter,$=F?.getAttribute("formmethod")||u,M=()=>_(F||B.currentTarget,{fetcherKey:t,method:$,navigate:s,replace:o,state:c,relative:p,preventScrollReset:m,viewTransition:g,unstable_defaultShouldRevalidate:x});w&&s!==!1?k.startTransition(()=>M()):M()};return k.createElement("form",{ref:S,method:E,action:j,onSubmit:a?f:R,...v,"data-discover":!T&&e==="render"?"true":void 0})});sj.displayName="Form";function ij(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function _b(e){let t=k.useContext(Qo);return pr(t,ij(e)),t}function aj(e,{target:t,replace:s,state:a,preventScrollReset:o,relative:c,viewTransition:u,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let p=pb(),m=bi(),g=Sc(e,{relative:c});return k.useCallback(x=>{if(I1(x,t)){x.preventDefault();let v=s!==void 0?s:cc(m)===cc(g),S=()=>p(e,{replace:v,state:a,preventScrollReset:o,relative:c,viewTransition:u,unstable_defaultShouldRevalidate:h});f?k.startTransition(()=>S()):S()}},[m,p,g,s,a,t,e,o,c,u,h,f])}function jc(e){ys(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=k.useRef(Op(e)),s=k.useRef(!1),a=bi(),o=k.useMemo(()=>M1(a.search,s.current?null:t.current),[a.search]),c=pb(),u=k.useCallback((h,f)=>{const p=Op(typeof h=="function"?h(new URLSearchParams(o)):h);s.current=!0,c("?"+p,f)},[c,o]);return[o,u]}var oj=0,lj=()=>`__${String(++oj)}__`;function cj(){let{router:e}=_b("useSubmit"),{basename:t}=k.useContext(vs),s=E1(),a=e.fetch,o=e.navigate;return k.useCallback(async(c,u={})=>{let{action:h,method:f,encType:p,formData:m,body:g}=P1(c,t);if(u.navigate===!1){let x=u.fetcherKey||lj();await a(x,s,u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:m,body:g,formMethod:u.method||f,formEncType:u.encType||p,flushSync:u.flushSync})}else await o(u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:m,body:g,formMethod:u.method||f,formEncType:u.encType||p,replace:u.replace,state:u.state,fromRouteId:s,flushSync:u.flushSync,viewTransition:u.viewTransition})},[a,o,t,s])}function uj(e,{relative:t}={}){let{basename:s}=k.useContext(vs),a=k.useContext(xi);pr(a,"useFormAction must be used inside a RouteContext");let[o]=a.matches.slice(-1),c={...Sc(e||".",{relative:t})},u=bi();if(e==null){c.search=u.search;let h=new URLSearchParams(c.search),f=h.getAll("index");if(f.some(m=>m==="")){h.delete("index"),f.filter(g=>g).forEach(g=>h.append("index",g));let m=h.toString();c.search=m?`?${m}`:""}}return(!e||e===".")&&o.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(c.pathname=c.pathname==="/"?s:gi([s,c.pathname])),cc(c)}function dj(e,{relative:t}={}){let s=k.useContext(ub);pr(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=_b("useViewTransitionState"),o=Sc(e,{relative:t});if(!s.isTransitioning)return!1;let c=yi(s.currentLocation.pathname,a)||s.currentLocation.pathname,u=yi(s.nextLocation.pathname,a)||s.nextLocation.pathname;return cd(o.pathname,u)!=null||cd(o.pathname,c)!=null}var za=eb();const hj=({children:e})=>(bi(),r.jsxs("div",{className:"app-layout",children:[r.jsx("header",{className:"app-header",children:r.jsx("div",{className:"container app-header__content",children:r.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),r.jsx("main",{className:"container app-main",children:e}),r.jsx("footer",{className:"app-footer",children:r.jsx("div",{className:"container",children:r.jsx("p",{children:" 2026 recipe management"})})})]})),vn=({children:e,className:t="",hoverable:s=!1,...a})=>r.jsx("div",{className:`glass-card ${s?"glass-card--hoverable":""} ${t}`,...a,children:e}),ce=({children:e,variant:t="primary",size:s="md",isLoading:a,block:o,className:c="",...u})=>{const h=["btn",`btn--${t}`,`btn--${s}`,o?"btn--block":"",a?"btn--loading":"",c].filter(Boolean).join(" ");return r.jsxs("button",{className:h,disabled:a,...u,children:[a&&r.jsx("span",{className:"btn__spinner"}),r.jsx("span",{className:"btn__content",children:e})]})};function fj(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return k.useMemo(()=>a=>{t.forEach(o=>o(a))},t)}const Ad=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Jo(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function lm(e){return"nodeType"in e}function Lr(e){var t,s;return e?Jo(e)?e:lm(e)&&(t=(s=e.ownerDocument)==null?void 0:s.defaultView)!=null?t:window:window}function cm(e){const{Document:t}=Lr(e);return e instanceof t}function Cc(e){return Jo(e)?!1:e instanceof Lr(e).HTMLElement}function wb(e){return e instanceof Lr(e).SVGElement}function Xo(e){return e?Jo(e)?e.document:lm(e)?cm(e)?e:Cc(e)||wb(e)?e.ownerDocument:document:document:document}const Os=Ad?k.useLayoutEffect:k.useEffect;function Td(e){const t=k.useRef(e);return Os(()=>{t.current=e}),k.useCallback(function(){for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];return t.current==null?void 0:t.current(...a)},[])}function pj(){const e=k.useRef(null),t=k.useCallback((a,o)=>{e.current=setInterval(a,o)},[]),s=k.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,s]}function uc(e,t){t===void 0&&(t=[e]);const s=k.useRef(e);return Os(()=>{s.current!==e&&(s.current=e)},t),s}function kc(e,t){const s=k.useRef();return k.useMemo(()=>{const a=e(s.current);return s.current=a,a},[...t])}function ud(e){const t=Td(e),s=k.useRef(null),a=k.useCallback(o=>{o!==s.current&&t?.(o,s.current),s.current=o},[]);return[s,a]}function dd(e){const t=k.useRef();return k.useEffect(()=>{t.current=e},[e]),t.current}let Kf={};function Ec(e,t){return k.useMemo(()=>{if(t)return t;const s=Kf[e]==null?0:Kf[e]+1;return Kf[e]=s,e+"-"+s},[e,t])}function Sb(e){return function(t){for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];return a.reduce((c,u)=>{const h=Object.entries(u);for(const[f,p]of h){const m=c[f];m!=null&&(c[f]=m+e*p)}return c},{...t})}}const $o=Sb(1),dc=Sb(-1);function mj(e){return"clientX"in e&&"clientY"in e}function Rd(e){if(!e)return!1;const{KeyboardEvent:t}=Lr(e.target);return t&&e instanceof t}function gj(e){if(!e)return!1;const{TouchEvent:t}=Lr(e.target);return t&&e instanceof t}function hd(e){if(gj(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:s}=e.touches[0];return{x:t,y:s}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:s}=e.changedTouches[0];return{x:t,y:s}}}return mj(e)?{x:e.clientX,y:e.clientY}:null}const Vr=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:s}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:s}=e;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(e){if(e)return[Vr.Translate.toString(e),Vr.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:s,easing:a}=e;return t+" "+s+"ms "+a}}}),p0="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function yj(e){return e.matches(p0)?e:e.querySelector(p0)}const vj={display:"none"};function xj(e){let{id:t,value:s}=e;return Ue.createElement("div",{id:t,style:vj},s)}function bj(e){let{id:t,announcement:s,ariaLiveType:a="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ue.createElement("div",{id:t,style:o,role:"status","aria-live":a,"aria-atomic":!0},s)}function _j(){const[e,t]=k.useState("");return{announce:k.useCallback(a=>{a!=null&&t(a)},[]),announcement:e}}const jb=k.createContext(null);function wj(e){const t=k.useContext(jb);k.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Sj(){const[e]=k.useState(()=>new Set),t=k.useCallback(a=>(e.add(a),()=>e.delete(a)),[e]);return[k.useCallback(a=>{let{type:o,event:c}=a;e.forEach(u=>{var h;return(h=u[o])==null?void 0:h.call(u,c)})},[e]),t]}const jj={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Cj={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function kj(e){let{announcements:t=Cj,container:s,hiddenTextDescribedById:a,screenReaderInstructions:o=jj}=e;const{announce:c,announcement:u}=_j(),h=Ec("DndLiveRegion"),[f,p]=k.useState(!1);if(k.useEffect(()=>{p(!0)},[]),wj(k.useMemo(()=>({onDragStart(g){let{active:x}=g;c(t.onDragStart({active:x}))},onDragMove(g){let{active:x,over:v}=g;t.onDragMove&&c(t.onDragMove({active:x,over:v}))},onDragOver(g){let{active:x,over:v}=g;c(t.onDragOver({active:x,over:v}))},onDragEnd(g){let{active:x,over:v}=g;c(t.onDragEnd({active:x,over:v}))},onDragCancel(g){let{active:x,over:v}=g;c(t.onDragCancel({active:x,over:v}))}}),[c,t])),!f)return null;const m=Ue.createElement(Ue.Fragment,null,Ue.createElement(xj,{id:a,value:o.draggable}),Ue.createElement(bj,{id:h,announcement:u}));return s?za.createPortal(m,s):m}var hr;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(hr||(hr={}));function fd(){}function Or(e,t){return k.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Pa(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return k.useMemo(()=>[...t].filter(a=>a!=null),[...t])}const Ds=Object.freeze({x:0,y:0});function um(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ej(e,t){const s=hd(e);if(!s)return"0 0";const a={x:(s.x-t.left)/t.width*100,y:(s.y-t.top)/t.height*100};return a.x+"% "+a.y+"%"}function dm(e,t){let{data:{value:s}}=e,{data:{value:a}}=t;return s-a}function Nj(e,t){let{data:{value:s}}=e,{data:{value:a}}=t;return a-s}function Dp(e){let{left:t,top:s,height:a,width:o}=e;return[{x:t,y:s},{x:t+o,y:s},{x:t,y:s+a},{x:t+o,y:s+a}]}function Cb(e,t){if(!e||e.length===0)return null;const[s]=e;return s[t]}function m0(e,t,s){return t===void 0&&(t=e.left),s===void 0&&(s=e.top),{x:t+e.width*.5,y:s+e.height*.5}}const pd=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:a}=e;const o=m0(t,t.left,t.top),c=[];for(const u of a){const{id:h}=u,f=s.get(h);if(f){const p=um(m0(f),o);c.push({id:h,data:{droppableContainer:u,value:p}})}}return c.sort(dm)},Aj=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:a}=e;const o=Dp(t),c=[];for(const u of a){const{id:h}=u,f=s.get(h);if(f){const p=Dp(f),m=o.reduce((x,v,S)=>x+um(p[S],v),0),g=Number((m/4).toFixed(4));c.push({id:h,data:{droppableContainer:u,value:g}})}}return c.sort(dm)};function Tj(e,t){const s=Math.max(t.top,e.top),a=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),c=Math.min(t.top+t.height,e.top+e.height),u=o-a,h=c-s;if(a<o&&s<c){const f=t.width*t.height,p=e.width*e.height,m=u*h,g=m/(f+p-m);return Number(g.toFixed(4))}return 0}const Rj=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:a}=e;const o=[];for(const c of a){const{id:u}=c,h=s.get(u);if(h){const f=Tj(h,t);f>0&&o.push({id:u,data:{droppableContainer:c,value:f}})}}return o.sort(Nj)};function Oj(e,t){const{top:s,left:a,bottom:o,right:c}=t;return s<=e.y&&e.y<=o&&a<=e.x&&e.x<=c}const kb=e=>{let{droppableContainers:t,droppableRects:s,pointerCoordinates:a}=e;if(!a)return[];const o=[];for(const c of t){const{id:u}=c,h=s.get(u);if(h&&Oj(a,h)){const p=Dp(h).reduce((g,x)=>g+um(a,x),0),m=Number((p/4).toFixed(4));o.push({id:u,data:{droppableContainer:c,value:m}})}}return o.sort(dm)};function Dj(e,t,s){return{...e,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}function Eb(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Ds}function Lj(e){return function(s){for(var a=arguments.length,o=new Array(a>1?a-1:0),c=1;c<a;c++)o[c-1]=arguments[c];return o.reduce((u,h)=>({...u,top:u.top+e*h.y,bottom:u.bottom+e*h.y,left:u.left+e*h.x,right:u.right+e*h.x}),{...s})}}const zj=Lj(1);function Nb(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ij(e,t,s){const a=Nb(t);if(!a)return e;const{scaleX:o,scaleY:c,x:u,y:h}=a,f=e.left-u-(1-o)*parseFloat(s),p=e.top-h-(1-c)*parseFloat(s.slice(s.indexOf(" ")+1)),m=o?e.width/o:e.width,g=c?e.height/c:e.height;return{width:m,height:g,top:p,right:f+m,bottom:p+g,left:f}}const Mj={ignoreTransform:!1};function Zo(e,t){t===void 0&&(t=Mj);let s=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:p,transformOrigin:m}=Lr(e).getComputedStyle(e);p&&(s=Ij(s,p,m))}const{top:a,left:o,width:c,height:u,bottom:h,right:f}=s;return{top:a,left:o,width:c,height:u,bottom:h,right:f}}function g0(e){return Zo(e,{ignoreTransform:!0})}function Uj(e){const t=e.innerWidth,s=e.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}function Bj(e,t){return t===void 0&&(t=Lr(e).getComputedStyle(e)),t.position==="fixed"}function Pj(e,t){t===void 0&&(t=Lr(e).getComputedStyle(e));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const c=t[o];return typeof c=="string"?s.test(c):!1})}function Od(e,t){const s=[];function a(o){if(t!=null&&s.length>=t||!o)return s;if(cm(o)&&o.scrollingElement!=null&&!s.includes(o.scrollingElement))return s.push(o.scrollingElement),s;if(!Cc(o)||wb(o)||s.includes(o))return s;const c=Lr(e).getComputedStyle(o);return o!==e&&Pj(o,c)&&s.push(o),Bj(o,c)?s:a(o.parentNode)}return e?a(e):s}function Ab(e){const[t]=Od(e,1);return t??null}function Wf(e){return!Ad||!e?null:Jo(e)?e:lm(e)?cm(e)||e===Xo(e).scrollingElement?window:Cc(e)?e:null:null}function Tb(e){return Jo(e)?e.scrollX:e.scrollLeft}function Rb(e){return Jo(e)?e.scrollY:e.scrollTop}function Lp(e){return{x:Tb(e),y:Rb(e)}}var vr;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(vr||(vr={}));function Ob(e){return!Ad||!e?!1:e===document.scrollingElement}function Db(e){const t={x:0,y:0},s=Ob(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},a={x:e.scrollWidth-s.width,y:e.scrollHeight-s.height},o=e.scrollTop<=t.y,c=e.scrollLeft<=t.x,u=e.scrollTop>=a.y,h=e.scrollLeft>=a.x;return{isTop:o,isLeft:c,isBottom:u,isRight:h,maxScroll:a,minScroll:t}}const $j={x:.2,y:.2};function qj(e,t,s,a,o){let{top:c,left:u,right:h,bottom:f}=s;a===void 0&&(a=10),o===void 0&&(o=$j);const{isTop:p,isBottom:m,isLeft:g,isRight:x}=Db(e),v={x:0,y:0},S={x:0,y:0},w={height:t.height*o.y,width:t.width*o.x};return!p&&c<=t.top+w.height?(v.y=vr.Backward,S.y=a*Math.abs((t.top+w.height-c)/w.height)):!m&&f>=t.bottom-w.height&&(v.y=vr.Forward,S.y=a*Math.abs((t.bottom-w.height-f)/w.height)),!x&&h>=t.right-w.width?(v.x=vr.Forward,S.x=a*Math.abs((t.right-w.width-h)/w.width)):!g&&u<=t.left+w.width&&(v.x=vr.Backward,S.x=a*Math.abs((t.left+w.width-u)/w.width)),{direction:v,speed:S}}function Fj(e){if(e===document.scrollingElement){const{innerWidth:c,innerHeight:u}=window;return{top:0,left:0,right:c,bottom:u,width:c,height:u}}const{top:t,left:s,right:a,bottom:o}=e.getBoundingClientRect();return{top:t,left:s,right:a,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Lb(e){return e.reduce((t,s)=>$o(t,Lp(s)),Ds)}function Vj(e){return e.reduce((t,s)=>t+Tb(s),0)}function Hj(e){return e.reduce((t,s)=>t+Rb(s),0)}function zb(e,t){if(t===void 0&&(t=Zo),!e)return;const{top:s,left:a,bottom:o,right:c}=t(e);Ab(e)&&(o<=0||c<=0||s>=window.innerHeight||a>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Gj=[["x",["left","right"],Vj],["y",["top","bottom"],Hj]];class hm{constructor(t,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=Od(s),o=Lb(a);this.rect={...t},this.width=t.width,this.height=t.height;for(const[c,u,h]of Gj)for(const f of u)Object.defineProperty(this,f,{get:()=>{const p=h(a),m=o[c]-p;return this.rect[f]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class sc{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...s)})},this.target=t}add(t,s,a){var o;(o=this.target)==null||o.addEventListener(t,s,a),this.listeners.push([t,s,a])}}function Kj(e){const{EventTarget:t}=Lr(e);return e instanceof t?e:Xo(e)}function Yf(e,t){const s=Math.abs(e.x),a=Math.abs(e.y);return typeof t=="number"?Math.sqrt(s**2+a**2)>t:"x"in t&&"y"in t?s>t.x&&a>t.y:"x"in t?s>t.x:"y"in t?a>t.y:!1}var ms;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(ms||(ms={}));function y0(e){e.preventDefault()}function Wj(e){e.stopPropagation()}var sn;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(sn||(sn={}));const Ib={start:[sn.Space,sn.Enter],cancel:[sn.Esc],end:[sn.Space,sn.Enter,sn.Tab]},Yj=(e,t)=>{let{currentCoordinates:s}=t;switch(e.code){case sn.Right:return{...s,x:s.x+25};case sn.Left:return{...s,x:s.x-25};case sn.Down:return{...s,y:s.y+25};case sn.Up:return{...s,y:s.y-25}}};class el{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:s}}=t;this.props=t,this.listeners=new sc(Xo(s)),this.windowListeners=new sc(Lr(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ms.Resize,this.handleCancel),this.windowListeners.add(ms.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ms.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:s}=this.props,a=t.node.current;a&&zb(a),s(Ds)}handleKeyDown(t){if(Rd(t)){const{active:s,context:a,options:o}=this.props,{keyboardCodes:c=Ib,coordinateGetter:u=Yj,scrollBehavior:h="smooth"}=o,{code:f}=t;if(c.end.includes(f)){this.handleEnd(t);return}if(c.cancel.includes(f)){this.handleCancel(t);return}const{collisionRect:p}=a.current,m=p?{x:p.left,y:p.top}:Ds;this.referenceCoordinates||(this.referenceCoordinates=m);const g=u(t,{active:s,context:a.current,currentCoordinates:m});if(g){const x=dc(g,m),v={x:0,y:0},{scrollableAncestors:S}=a.current;for(const w of S){const _=t.code,{isTop:j,isRight:E,isLeft:T,isBottom:R,maxScroll:B,minScroll:F}=Db(w),$=Fj(w),M={x:Math.min(_===sn.Right?$.right-$.width/2:$.right,Math.max(_===sn.Right?$.left:$.left+$.width/2,g.x)),y:Math.min(_===sn.Down?$.bottom-$.height/2:$.bottom,Math.max(_===sn.Down?$.top:$.top+$.height/2,g.y))},z=_===sn.Right&&!E||_===sn.Left&&!T,P=_===sn.Down&&!R||_===sn.Up&&!j;if(z&&M.x!==g.x){const H=w.scrollLeft+x.x,O=_===sn.Right&&H<=B.x||_===sn.Left&&H>=F.x;if(O&&!x.y){w.scrollTo({left:H,behavior:h});return}O?v.x=w.scrollLeft-H:v.x=_===sn.Right?w.scrollLeft-B.x:w.scrollLeft-F.x,v.x&&w.scrollBy({left:-v.x,behavior:h});break}else if(P&&M.y!==g.y){const H=w.scrollTop+x.y,O=_===sn.Down&&H<=B.y||_===sn.Up&&H>=F.y;if(O&&!x.x){w.scrollTo({top:H,behavior:h});return}O?v.y=w.scrollTop-H:v.y=_===sn.Down?w.scrollTop-B.y:w.scrollTop-F.y,v.y&&w.scrollBy({top:-v.y,behavior:h});break}}this.handleMove(t,$o(dc(g,this.referenceCoordinates),v))}}}handleMove(t,s){const{onMove:a}=this.props;t.preventDefault(),a(s)}handleEnd(t){const{onEnd:s}=this.props;t.preventDefault(),this.detach(),s()}handleCancel(t){const{onCancel:s}=this.props;t.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}el.activators=[{eventName:"onKeyDown",handler:(e,t,s)=>{let{keyboardCodes:a=Ib,onActivation:o}=t,{active:c}=s;const{code:u}=e.nativeEvent;if(a.start.includes(u)){const h=c.activatorNode.current;return h&&e.target!==h?!1:(e.preventDefault(),o?.({event:e.nativeEvent}),!0)}return!1}}];function v0(e){return!!(e&&"distance"in e)}function x0(e){return!!(e&&"delay"in e)}class fm{constructor(t,s,a){var o;a===void 0&&(a=Kj(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=s;const{event:c}=t,{target:u}=c;this.props=t,this.events=s,this.document=Xo(u),this.documentListeners=new sc(this.document),this.listeners=new sc(a),this.windowListeners=new sc(Lr(u)),this.initialCoordinates=(o=hd(c))!=null?o:Ds,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:s,bypassActivationConstraint:a}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(ms.Resize,this.handleCancel),this.windowListeners.add(ms.DragStart,y0),this.windowListeners.add(ms.VisibilityChange,this.handleCancel),this.windowListeners.add(ms.ContextMenu,y0),this.documentListeners.add(ms.Keydown,this.handleKeydown),s){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(x0(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(v0(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,s){const{active:a,onPending:o}=this.props;o(a,t,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:t}=this,{onStart:s}=this.props;t&&(this.activated=!0,this.documentListeners.add(ms.Click,Wj,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ms.SelectionChange,this.removeTextSelection),s(t))}handleMove(t){var s;const{activated:a,initialCoordinates:o,props:c}=this,{onMove:u,options:{activationConstraint:h}}=c;if(!o)return;const f=(s=hd(t))!=null?s:Ds,p=dc(o,f);if(!a&&h){if(v0(h)){if(h.tolerance!=null&&Yf(p,h.tolerance))return this.handleCancel();if(Yf(p,h.distance))return this.handleStart()}if(x0(h)&&Yf(p,h.tolerance))return this.handleCancel();this.handlePending(h,p);return}t.cancelable&&t.preventDefault(),u(f)}handleEnd(){const{onAbort:t,onEnd:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleCancel(){const{onAbort:t,onCancel:s}=this.props;this.detach(),this.activated||t(this.props.active),s()}handleKeydown(t){t.code===sn.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Qj={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Dd extends fm{constructor(t){const{event:s}=t,a=Xo(s.target);super(t,Qj,a)}}Dd.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:a}=t;return!s.isPrimary||s.button!==0?!1:(a?.({event:s}),!0)}}];const Jj={move:{name:"mousemove"},end:{name:"mouseup"}};var zp;(function(e){e[e.RightClick=2]="RightClick"})(zp||(zp={}));class tl extends fm{constructor(t){super(t,Jj,Xo(t.event.target))}}tl.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:a}=t;return s.button===zp.RightClick?!1:(a?.({event:s}),!0)}}];const Qf={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class nl extends fm{constructor(t){super(t,Qf)}static setup(){return window.addEventListener(Qf.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Qf.move.name,t)};function t(){}}}nl.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:a}=t;const{touches:o}=s;return o.length>1?!1:(a?.({event:s}),!0)}}];var ic;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(ic||(ic={}));var md;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(md||(md={}));function Xj(e){let{acceleration:t,activator:s=ic.Pointer,canScroll:a,draggingRect:o,enabled:c,interval:u=5,order:h=md.TreeOrder,pointerCoordinates:f,scrollableAncestors:p,scrollableAncestorRects:m,delta:g,threshold:x}=e;const v=eC({delta:g,disabled:!c}),[S,w]=pj(),_=k.useRef({x:0,y:0}),j=k.useRef({x:0,y:0}),E=k.useMemo(()=>{switch(s){case ic.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case ic.DraggableRect:return o}},[s,o,f]),T=k.useRef(null),R=k.useCallback(()=>{const F=T.current;if(!F)return;const $=_.current.x*j.current.x,M=_.current.y*j.current.y;F.scrollBy($,M)},[]),B=k.useMemo(()=>h===md.TreeOrder?[...p].reverse():p,[h,p]);k.useEffect(()=>{if(!c||!p.length||!E){w();return}for(const F of B){if(a?.(F)===!1)continue;const $=p.indexOf(F),M=m[$];if(!M)continue;const{direction:z,speed:P}=qj(F,M,E,t,x);for(const H of["x","y"])v[H][z[H]]||(P[H]=0,z[H]=0);if(P.x>0||P.y>0){w(),T.current=F,S(R,u),_.current=P,j.current=z;return}}_.current={x:0,y:0},j.current={x:0,y:0},w()},[t,R,a,w,c,u,JSON.stringify(E),JSON.stringify(v),S,p,B,m,JSON.stringify(x)])}const Zj={x:{[vr.Backward]:!1,[vr.Forward]:!1},y:{[vr.Backward]:!1,[vr.Forward]:!1}};function eC(e){let{delta:t,disabled:s}=e;const a=dd(t);return kc(o=>{if(s||!a||!o)return Zj;const c={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[vr.Backward]:o.x[vr.Backward]||c.x===-1,[vr.Forward]:o.x[vr.Forward]||c.x===1},y:{[vr.Backward]:o.y[vr.Backward]||c.y===-1,[vr.Forward]:o.y[vr.Forward]||c.y===1}}},[s,t,a])}function tC(e,t){const s=t!=null?e.get(t):void 0,a=s?s.node.current:null;return kc(o=>{var c;return t==null?null:(c=a??o)!=null?c:null},[a,t])}function nC(e,t){return k.useMemo(()=>e.reduce((s,a)=>{const{sensor:o}=a,c=o.activators.map(u=>({eventName:u.eventName,handler:t(u.handler,a)}));return[...s,...c]},[]),[e,t])}var hc;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(hc||(hc={}));var Ip;(function(e){e.Optimized="optimized"})(Ip||(Ip={}));const b0=new Map;function rC(e,t){let{dragging:s,dependencies:a,config:o}=t;const[c,u]=k.useState(null),{frequency:h,measure:f,strategy:p}=o,m=k.useRef(e),g=_(),x=uc(g),v=k.useCallback(function(j){j===void 0&&(j=[]),!x.current&&u(E=>E===null?j:E.concat(j.filter(T=>!E.includes(T))))},[x]),S=k.useRef(null),w=kc(j=>{if(g&&!s)return b0;if(!j||j===b0||m.current!==e||c!=null){const E=new Map;for(let T of e){if(!T)continue;if(c&&c.length>0&&!c.includes(T.id)&&T.rect.current){E.set(T.id,T.rect.current);continue}const R=T.node.current,B=R?new hm(f(R),R):null;T.rect.current=B,B&&E.set(T.id,B)}return E}return j},[e,c,s,g,f]);return k.useEffect(()=>{m.current=e},[e]),k.useEffect(()=>{g||v()},[s,g]),k.useEffect(()=>{c&&c.length>0&&u(null)},[JSON.stringify(c)]),k.useEffect(()=>{g||typeof h!="number"||S.current!==null||(S.current=setTimeout(()=>{v(),S.current=null},h))},[h,g,v,...a]),{droppableRects:w,measureDroppableContainers:v,measuringScheduled:c!=null};function _(){switch(p){case hc.Always:return!1;case hc.BeforeDragging:return s;default:return!s}}}function pm(e,t){return kc(s=>e?s||(typeof t=="function"?t(e):e):null,[t,e])}function sC(e,t){return pm(e,t)}function iC(e){let{callback:t,disabled:s}=e;const a=Td(t),o=k.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:c}=window;return new c(a)},[a,s]);return k.useEffect(()=>()=>o?.disconnect(),[o]),o}function Ld(e){let{callback:t,disabled:s}=e;const a=Td(t),o=k.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:c}=window;return new c(a)},[s]);return k.useEffect(()=>()=>o?.disconnect(),[o]),o}function aC(e){return new hm(Zo(e),e)}function _0(e,t,s){t===void 0&&(t=aC);const[a,o]=k.useState(null);function c(){o(f=>{if(!e)return null;if(e.isConnected===!1){var p;return(p=f??s)!=null?p:null}const m=t(e);return JSON.stringify(f)===JSON.stringify(m)?f:m})}const u=iC({callback(f){if(e)for(const p of f){const{type:m,target:g}=p;if(m==="childList"&&g instanceof HTMLElement&&g.contains(e)){c();break}}}}),h=Ld({callback:c});return Os(()=>{c(),e?(h?.observe(e),u?.observe(document.body,{childList:!0,subtree:!0})):(h?.disconnect(),u?.disconnect())},[e]),a}function oC(e){const t=pm(e);return Eb(e,t)}const w0=[];function lC(e){const t=k.useRef(e),s=kc(a=>e?a&&a!==w0&&e&&t.current&&e.parentNode===t.current.parentNode?a:Od(e):w0,[e]);return k.useEffect(()=>{t.current=e},[e]),s}function cC(e){const[t,s]=k.useState(null),a=k.useRef(e),o=k.useCallback(c=>{const u=Wf(c.target);u&&s(h=>h?(h.set(u,Lp(u)),new Map(h)):null)},[]);return k.useEffect(()=>{const c=a.current;if(e!==c){u(c);const h=e.map(f=>{const p=Wf(f);return p?(p.addEventListener("scroll",o,{passive:!0}),[p,Lp(p)]):null}).filter(f=>f!=null);s(h.length?new Map(h):null),a.current=e}return()=>{u(e),u(c)};function u(h){h.forEach(f=>{const p=Wf(f);p?.removeEventListener("scroll",o)})}},[o,e]),k.useMemo(()=>e.length?t?Array.from(t.values()).reduce((c,u)=>$o(c,u),Ds):Lb(e):Ds,[e,t])}function S0(e,t){t===void 0&&(t=[]);const s=k.useRef(null);return k.useEffect(()=>{s.current=null},t),k.useEffect(()=>{const a=e!==Ds;a&&!s.current&&(s.current=e),!a&&s.current&&(s.current=null)},[e]),s.current?dc(e,s.current):Ds}function uC(e){k.useEffect(()=>{if(!Ad)return;const t=e.map(s=>{let{sensor:a}=s;return a.setup==null?void 0:a.setup()});return()=>{for(const s of t)s?.()}},e.map(t=>{let{sensor:s}=t;return s}))}function dC(e,t){return k.useMemo(()=>e.reduce((s,a)=>{let{eventName:o,handler:c}=a;return s[o]=u=>{c(u,t)},s},{}),[e,t])}function Mb(e){return k.useMemo(()=>e?Uj(e):null,[e])}const j0=[];function hC(e,t){t===void 0&&(t=Zo);const[s]=e,a=Mb(s?Lr(s):null),[o,c]=k.useState(j0);function u(){c(()=>e.length?e.map(f=>Ob(f)?a:new hm(t(f),f)):j0)}const h=Ld({callback:u});return Os(()=>{h?.disconnect(),u(),e.forEach(f=>h?.observe(f))},[e]),o}function Ub(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Cc(t)?t:e}function fC(e){let{measure:t}=e;const[s,a]=k.useState(null),o=k.useCallback(p=>{for(const{target:m}of p)if(Cc(m)){a(g=>{const x=t(m);return g?{...g,width:x.width,height:x.height}:x});break}},[t]),c=Ld({callback:o}),u=k.useCallback(p=>{const m=Ub(p);c?.disconnect(),m&&c?.observe(m),a(m?t(m):null)},[t,c]),[h,f]=ud(u);return k.useMemo(()=>({nodeRef:h,rect:s,setRef:f}),[s,h,f])}const pC=[{sensor:Dd,options:{}},{sensor:el,options:{}}],mC={current:{}},rd={draggable:{measure:g0},droppable:{measure:g0,strategy:hc.WhileDragging,frequency:Ip.Optimized},dragOverlay:{measure:Zo}};class ac extends Map{get(t){var s;return t!=null&&(s=super.get(t))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:s}=t;return!s})}getNodeFor(t){var s,a;return(s=(a=this.get(t))==null?void 0:a.node.current)!=null?s:void 0}}const gC={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new ac,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:fd},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:rd,measureDroppableContainers:fd,windowRect:null,measuringScheduled:!1},Bb={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:fd,draggableNodes:new Map,over:null,measureDroppableContainers:fd},Nc=k.createContext(Bb),Pb=k.createContext(gC);function yC(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new ac}}}function vC(e,t){switch(t.type){case hr.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case hr.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case hr.DragEnd:case hr.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case hr.RegisterDroppable:{const{element:s}=t,{id:a}=s,o=new ac(e.droppable.containers);return o.set(a,s),{...e,droppable:{...e.droppable,containers:o}}}case hr.SetDroppableDisabled:{const{id:s,key:a,disabled:o}=t,c=e.droppable.containers.get(s);if(!c||a!==c.key)return e;const u=new ac(e.droppable.containers);return u.set(s,{...c,disabled:o}),{...e,droppable:{...e.droppable,containers:u}}}case hr.UnregisterDroppable:{const{id:s,key:a}=t,o=e.droppable.containers.get(s);if(!o||a!==o.key)return e;const c=new ac(e.droppable.containers);return c.delete(s),{...e,droppable:{...e.droppable,containers:c}}}default:return e}}function xC(e){let{disabled:t}=e;const{active:s,activatorEvent:a,draggableNodes:o}=k.useContext(Nc),c=dd(a),u=dd(s?.id);return k.useEffect(()=>{if(!t&&!a&&c&&u!=null){if(!Rd(c)||document.activeElement===c.target)return;const h=o.get(u);if(!h)return;const{activatorNode:f,node:p}=h;if(!f.current&&!p.current)return;requestAnimationFrame(()=>{for(const m of[f.current,p.current]){if(!m)continue;const g=yj(m);if(g){g.focus();break}}})}},[a,t,o,u,c]),null}function $b(e,t){let{transform:s,...a}=t;return e!=null&&e.length?e.reduce((o,c)=>c({transform:o,...a}),s):s}function bC(e){return k.useMemo(()=>({draggable:{...rd.draggable,...e?.draggable},droppable:{...rd.droppable,...e?.droppable},dragOverlay:{...rd.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function _C(e){let{activeNode:t,measure:s,initialRect:a,config:o=!0}=e;const c=k.useRef(!1),{x:u,y:h}=typeof o=="boolean"?{x:o,y:o}:o;Os(()=>{if(!u&&!h||!t){c.current=!1;return}if(c.current||!a)return;const p=t?.node.current;if(!p||p.isConnected===!1)return;const m=s(p),g=Eb(m,a);if(u||(g.x=0),h||(g.y=0),c.current=!0,Math.abs(g.x)>0||Math.abs(g.y)>0){const x=Ab(p);x&&x.scrollBy({top:g.y,left:g.x})}},[t,u,h,a,s])}const zd=k.createContext({...Ds,scaleX:1,scaleY:1});var Ji;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ji||(Ji={}));const ra=k.memo(function(t){var s,a,o,c;let{id:u,accessibility:h,autoScroll:f=!0,children:p,sensors:m=pC,collisionDetection:g=Rj,measuring:x,modifiers:v,...S}=t;const w=k.useReducer(vC,void 0,yC),[_,j]=w,[E,T]=Sj(),[R,B]=k.useState(Ji.Uninitialized),F=R===Ji.Initialized,{draggable:{active:$,nodes:M,translate:z},droppable:{containers:P}}=_,H=$!=null?M.get($):null,O=k.useRef({initial:null,translated:null}),q=k.useMemo(()=>{var Ct;return $!=null?{id:$,data:(Ct=H?.data)!=null?Ct:mC,rect:O}:null},[$,H]),C=k.useRef(null),[I,L]=k.useState(null),[V,G]=k.useState(null),Y=uc(S,Object.values(S)),Z=Ec("DndDescribedBy",u),A=k.useMemo(()=>P.getEnabled(),[P]),U=bC(x),{droppableRects:X,measureDroppableContainers:se,measuringScheduled:oe}=rC(A,{dragging:F,dependencies:[z.x,z.y],config:U.droppable}),Ce=tC(M,$),ue=k.useMemo(()=>V?hd(V):null,[V]),ne=hn(),we=sC(Ce,U.draggable.measure);_C({activeNode:$!=null?M.get($):null,config:ne.layoutShiftCompensation,initialRect:we,measure:U.draggable.measure});const Le=_0(Ce,U.draggable.measure,we),ge=_0(Ce?Ce.parentElement:null),Te=k.useRef({activatorEvent:null,active:null,activeNode:Ce,collisionRect:null,collisions:null,droppableRects:X,draggableNodes:M,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),de=P.getNodeFor((s=Te.current.over)==null?void 0:s.id),N=fC({measure:U.dragOverlay.measure}),ve=(a=N.nodeRef.current)!=null?a:Ce,fe=F?(o=N.rect)!=null?o:Le:null,Q=!!(N.nodeRef.current&&N.rect),K=oC(Q?null:Le),ie=Mb(ve?Lr(ve):null),re=lC(F?de??Ce:null),ee=hC(re),le=$b(v,{transform:{x:z.x-K.x,y:z.y-K.y,scaleX:1,scaleY:1},activatorEvent:V,active:q,activeNodeRect:Le,containerNodeRect:ge,draggingNodeRect:fe,over:Te.current.over,overlayNodeRect:N.rect,scrollableAncestors:re,scrollableAncestorRects:ee,windowRect:ie}),ye=ue?$o(ue,z):null,qe=cC(re),Re=S0(qe),$e=S0(qe,[Le]),Ke=$o(le,Re),Ye=fe?zj(fe,le):null,Et=q&&Ye?g({active:q,collisionRect:Ye,droppableRects:X,droppableContainers:A,pointerCoordinates:ye}):null,Kt=Cb(Et,"id"),[dt,bt]=k.useState(null),mt=Q?le:$o(le,$e),$t=Dj(mt,(c=dt?.rect)!=null?c:null,Le),on=k.useRef(null),Ot=k.useCallback((Ct,ht)=>{let{sensor:Vt,options:qt}=ht;if(C.current==null)return;const cn=M.get(C.current);if(!cn)return;const Ft=Ct.nativeEvent,_n=new Vt({active:C.current,activeNode:cn,event:Ft,options:qt,context:Te,onAbort(un){if(!M.get(un))return;const{onDragAbort:Ht}=Y.current,Cn={id:un};Ht?.(Cn),E({type:"onDragAbort",event:Cn})},onPending(un,Vn,Ht,Cn){if(!M.get(un))return;const{onDragPending:Tn}=Y.current,Kn={id:un,constraint:Vn,initialCoordinates:Ht,offset:Cn};Tn?.(Kn),E({type:"onDragPending",event:Kn})},onStart(un){const Vn=C.current;if(Vn==null)return;const Ht=M.get(Vn);if(!Ht)return;const{onDragStart:Cn}=Y.current,It={activatorEvent:Ft,active:{id:Vn,data:Ht.data,rect:O}};za.unstable_batchedUpdates(()=>{Cn?.(It),B(Ji.Initializing),j({type:hr.DragStart,initialCoordinates:un,active:Vn}),E({type:"onDragStart",event:It}),L(on.current),G(Ft)})},onMove(un){j({type:hr.DragMove,coordinates:un})},onEnd:xn(hr.DragEnd),onCancel:xn(hr.DragCancel)});on.current=_n;function xn(un){return async function(){const{active:Ht,collisions:Cn,over:It,scrollAdjustedTranslate:Tn}=Te.current;let Kn=null;if(Ht&&Tn){const{cancelDrop:dn}=Y.current;Kn={activatorEvent:Ft,active:Ht,collisions:Cn,delta:Tn,over:It},un===hr.DragEnd&&typeof dn=="function"&&await Promise.resolve(dn(Kn))&&(un=hr.DragCancel)}C.current=null,za.unstable_batchedUpdates(()=>{j({type:un}),B(Ji.Uninitialized),bt(null),L(null),G(null),on.current=null;const dn=un===hr.DragEnd?"onDragEnd":"onDragCancel";if(Kn){const Xt=Y.current[dn];Xt?.(Kn),E({type:dn,event:Kn})}})}}},[M]),gn=k.useCallback((Ct,ht)=>(Vt,qt)=>{const cn=Vt.nativeEvent,Ft=M.get(qt);if(C.current!==null||!Ft||cn.dndKit||cn.defaultPrevented)return;const _n={active:Ft};Ct(Vt,ht.options,_n)===!0&&(cn.dndKit={capturedBy:ht.sensor},C.current=qt,Ot(Vt,ht))},[M,Ot]),Wt=nC(m,gn);uC(m),Os(()=>{Le&&R===Ji.Initializing&&B(Ji.Initialized)},[Le,R]),k.useEffect(()=>{const{onDragMove:Ct}=Y.current,{active:ht,activatorEvent:Vt,collisions:qt,over:cn}=Te.current;if(!ht||!Vt)return;const Ft={active:ht,activatorEvent:Vt,collisions:qt,delta:{x:Ke.x,y:Ke.y},over:cn};za.unstable_batchedUpdates(()=>{Ct?.(Ft),E({type:"onDragMove",event:Ft})})},[Ke.x,Ke.y]),k.useEffect(()=>{const{active:Ct,activatorEvent:ht,collisions:Vt,droppableContainers:qt,scrollAdjustedTranslate:cn}=Te.current;if(!Ct||C.current==null||!ht||!cn)return;const{onDragOver:Ft}=Y.current,_n=qt.get(Kt),xn=_n&&_n.rect.current?{id:_n.id,rect:_n.rect.current,data:_n.data,disabled:_n.disabled}:null,un={active:Ct,activatorEvent:ht,collisions:Vt,delta:{x:cn.x,y:cn.y},over:xn};za.unstable_batchedUpdates(()=>{bt(xn),Ft?.(un),E({type:"onDragOver",event:un})})},[Kt]),Os(()=>{Te.current={activatorEvent:V,active:q,activeNode:Ce,collisionRect:Ye,collisions:Et,droppableRects:X,draggableNodes:M,draggingNode:ve,draggingNodeRect:fe,droppableContainers:P,over:dt,scrollableAncestors:re,scrollAdjustedTranslate:Ke},O.current={initial:fe,translated:Ye}},[q,Ce,Et,Ye,M,ve,fe,X,P,dt,re,Ke]),Xj({...ne,delta:z,draggingRect:Ye,pointerCoordinates:ye,scrollableAncestors:re,scrollableAncestorRects:ee});const Dt=k.useMemo(()=>({active:q,activeNode:Ce,activeNodeRect:Le,activatorEvent:V,collisions:Et,containerNodeRect:ge,dragOverlay:N,draggableNodes:M,droppableContainers:P,droppableRects:X,over:dt,measureDroppableContainers:se,scrollableAncestors:re,scrollableAncestorRects:ee,measuringConfiguration:U,measuringScheduled:oe,windowRect:ie}),[q,Ce,Le,V,Et,ge,N,M,P,X,dt,se,re,ee,U,oe,ie]),zn=k.useMemo(()=>({activatorEvent:V,activators:Wt,active:q,activeNodeRect:Le,ariaDescribedById:{draggable:Z},dispatch:j,draggableNodes:M,over:dt,measureDroppableContainers:se}),[V,Wt,q,Le,j,Z,M,dt,se]);return Ue.createElement(jb.Provider,{value:T},Ue.createElement(Nc.Provider,{value:zn},Ue.createElement(Pb.Provider,{value:Dt},Ue.createElement(zd.Provider,{value:$t},p)),Ue.createElement(xC,{disabled:h?.restoreFocus===!1})),Ue.createElement(kj,{...h,hiddenTextDescribedById:Z}));function hn(){const Ct=I?.autoScrollEnabled===!1,ht=typeof f=="object"?f.enabled===!1:f===!1,Vt=F&&!Ct&&!ht;return typeof f=="object"?{...f,enabled:Vt}:{enabled:Vt}}}),wC=k.createContext(null),C0="button",SC="Draggable";function mm(e){let{id:t,data:s,disabled:a=!1,attributes:o}=e;const c=Ec(SC),{activators:u,activatorEvent:h,active:f,activeNodeRect:p,ariaDescribedById:m,draggableNodes:g,over:x}=k.useContext(Nc),{role:v=C0,roleDescription:S="draggable",tabIndex:w=0}=o??{},_=f?.id===t,j=k.useContext(_?zd:wC),[E,T]=ud(),[R,B]=ud(),F=dC(u,t),$=uc(s);Os(()=>(g.set(t,{id:t,key:c,node:E,activatorNode:R,data:$}),()=>{const z=g.get(t);z&&z.key===c&&g.delete(t)}),[g,t]);const M=k.useMemo(()=>({role:v,tabIndex:w,"aria-disabled":a,"aria-pressed":_&&v===C0?!0:void 0,"aria-roledescription":S,"aria-describedby":m.draggable}),[a,v,w,_,S,m.draggable]);return{active:f,activatorEvent:h,activeNodeRect:p,attributes:M,isDragging:_,listeners:a?void 0:F,node:E,over:x,setNodeRef:T,setActivatorNodeRef:B,transform:j}}function qb(){return k.useContext(Pb)}const jC="Droppable",CC={timeout:25};function Ac(e){let{data:t,disabled:s=!1,id:a,resizeObserverConfig:o}=e;const c=Ec(jC),{active:u,dispatch:h,over:f,measureDroppableContainers:p}=k.useContext(Nc),m=k.useRef({disabled:s}),g=k.useRef(!1),x=k.useRef(null),v=k.useRef(null),{disabled:S,updateMeasurementsFor:w,timeout:_}={...CC,...o},j=uc(w??a),E=k.useCallback(()=>{if(!g.current){g.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{p(Array.isArray(j.current)?j.current:[j.current]),v.current=null},_)},[_]),T=Ld({callback:E,disabled:S||!u}),R=k.useCallback((M,z)=>{T&&(z&&(T.unobserve(z),g.current=!1),M&&T.observe(M))},[T]),[B,F]=ud(R),$=uc(t);return k.useEffect(()=>{!T||!B.current||(T.disconnect(),g.current=!1,T.observe(B.current))},[B,T]),k.useEffect(()=>(h({type:hr.RegisterDroppable,element:{id:a,key:c,disabled:s,node:B,rect:x,data:$}}),()=>h({type:hr.UnregisterDroppable,key:c,id:a})),[a]),k.useEffect(()=>{s!==m.current.disabled&&(h({type:hr.SetDroppableDisabled,id:a,key:c,disabled:s}),m.current.disabled=s)},[a,c,s,h]),{active:u,rect:x,isOver:f?.id===a,node:B,over:f,setNodeRef:F}}function kC(e){let{animation:t,children:s}=e;const[a,o]=k.useState(null),[c,u]=k.useState(null),h=dd(s);return!s&&!a&&h&&o(h),Os(()=>{if(!c)return;const f=a?.key,p=a?.props.id;if(f==null||p==null){o(null);return}Promise.resolve(t(p,c)).then(()=>{o(null)})},[t,a,c]),Ue.createElement(Ue.Fragment,null,s,a?k.cloneElement(a,{ref:u}):null)}const EC={x:0,y:0,scaleX:1,scaleY:1};function NC(e){let{children:t}=e;return Ue.createElement(Nc.Provider,{value:Bb},Ue.createElement(zd.Provider,{value:EC},t))}const AC={position:"fixed",touchAction:"none"},TC=e=>Rd(e)?"transform 250ms ease":void 0,RC=k.forwardRef((e,t)=>{let{as:s,activatorEvent:a,adjustScale:o,children:c,className:u,rect:h,style:f,transform:p,transition:m=TC}=e;if(!h)return null;const g=o?p:{...p,scaleX:1,scaleY:1},x={...AC,width:h.width,height:h.height,top:h.top,left:h.left,transform:Vr.Transform.toString(g),transformOrigin:o&&a?Ej(a,h):void 0,transition:typeof m=="function"?m(a):m,...f};return Ue.createElement(s,{className:u,style:x,ref:t},c)}),gm=e=>t=>{let{active:s,dragOverlay:a}=t;const o={},{styles:c,className:u}=e;if(c!=null&&c.active)for(const[h,f]of Object.entries(c.active))f!==void 0&&(o[h]=s.node.style.getPropertyValue(h),s.node.style.setProperty(h,f));if(c!=null&&c.dragOverlay)for(const[h,f]of Object.entries(c.dragOverlay))f!==void 0&&a.node.style.setProperty(h,f);return u!=null&&u.active&&s.node.classList.add(u.active),u!=null&&u.dragOverlay&&a.node.classList.add(u.dragOverlay),function(){for(const[f,p]of Object.entries(o))s.node.style.setProperty(f,p);u!=null&&u.active&&s.node.classList.remove(u.active)}},OC=e=>{let{transform:{initial:t,final:s}}=e;return[{transform:Vr.Transform.toString(t)},{transform:Vr.Transform.toString(s)}]},DC={duration:250,easing:"ease",keyframes:OC,sideEffects:gm({styles:{active:{opacity:"0"}}})};function LC(e){let{config:t,draggableNodes:s,droppableContainers:a,measuringConfiguration:o}=e;return Td((c,u)=>{if(t===null)return;const h=s.get(c);if(!h)return;const f=h.node.current;if(!f)return;const p=Ub(u);if(!p)return;const{transform:m}=Lr(u).getComputedStyle(u),g=Nb(m);if(!g)return;const x=typeof t=="function"?t:zC(t);return zb(f,o.draggable.measure),x({active:{id:c,data:h.data,node:f,rect:o.draggable.measure(f)},draggableNodes:s,dragOverlay:{node:u,rect:o.dragOverlay.measure(p)},droppableContainers:a,measuringConfiguration:o,transform:g})})}function zC(e){const{duration:t,easing:s,sideEffects:a,keyframes:o}={...DC,...e};return c=>{let{active:u,dragOverlay:h,transform:f,...p}=c;if(!t)return;const m={x:h.rect.left-u.rect.left,y:h.rect.top-u.rect.top},g={scaleX:f.scaleX!==1?u.rect.width*f.scaleX/h.rect.width:1,scaleY:f.scaleY!==1?u.rect.height*f.scaleY/h.rect.height:1},x={x:f.x-m.x,y:f.y-m.y,...g},v=o({...p,active:u,dragOverlay:h,transform:{initial:f,final:x}}),[S]=v,w=v[v.length-1];if(JSON.stringify(S)===JSON.stringify(w))return;const _=a?.({active:u,dragOverlay:h,...p}),j=h.node.animate(v,{duration:t,easing:s,fill:"forwards"});return new Promise(E=>{j.onfinish=()=>{_?.(),E()}})}}let k0=0;function IC(e){return k.useMemo(()=>{if(e!=null)return k0++,k0},[e])}const ym=Ue.memo(e=>{let{adjustScale:t=!1,children:s,dropAnimation:a,style:o,transition:c,modifiers:u,wrapperElement:h="div",className:f,zIndex:p=999}=e;const{activatorEvent:m,active:g,activeNodeRect:x,containerNodeRect:v,draggableNodes:S,droppableContainers:w,dragOverlay:_,over:j,measuringConfiguration:E,scrollableAncestors:T,scrollableAncestorRects:R,windowRect:B}=qb(),F=k.useContext(zd),$=IC(g?.id),M=$b(u,{activatorEvent:m,active:g,activeNodeRect:x,containerNodeRect:v,draggingNodeRect:_.rect,over:j,overlayNodeRect:_.rect,scrollableAncestors:T,scrollableAncestorRects:R,transform:F,windowRect:B}),z=pm(x),P=LC({config:a,draggableNodes:S,droppableContainers:w,measuringConfiguration:E}),H=z?_.setRef:void 0;return Ue.createElement(NC,null,Ue.createElement(kC,{animation:P},g&&$?Ue.createElement(RC,{key:$,id:g.id,ref:H,as:h,activatorEvent:m,adjustScale:t,className:f,transition:c,rect:z,style:{zIndex:p,...o},transform:M},s):null))});function aa(e,t,s){const a=e.slice();return a.splice(s<0?a.length+s:s,0,a.splice(t,1)[0]),a}function MC(e,t){return e.reduce((s,a,o)=>{const c=t.get(a);return c&&(s[o]=c),s},Array(e.length))}function Iu(e){return e!==null&&e>=0}function UC(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}function BC(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const vm=e=>{let{rects:t,activeIndex:s,overIndex:a,index:o}=e;const c=aa(t,a,s),u=t[o],h=c[o];return!h||!u?null:{x:h.left-u.left,y:h.top-u.top,scaleX:h.width/u.width,scaleY:h.height/u.height}},Mu={scaleX:1,scaleY:1},Ko=e=>{var t;let{activeIndex:s,activeNodeRect:a,index:o,rects:c,overIndex:u}=e;const h=(t=c[s])!=null?t:a;if(!h)return null;if(o===s){const p=c[u];return p?{x:0,y:s<u?p.top+p.height-(h.top+h.height):p.top-h.top,...Mu}:null}const f=PC(c,o,s);return o>s&&o<=u?{x:0,y:-h.height-f,...Mu}:o<s&&o>=u?{x:0,y:h.height+f,...Mu}:{x:0,y:0,...Mu}};function PC(e,t,s){const a=e[t],o=e[t-1],c=e[t+1];return a?s<t?o?a.top-(o.top+o.height):c?c.top-(a.top+a.height):0:c?c.top-(a.top+a.height):o?a.top-(o.top+o.height):0:0}const Fb="Sortable",Vb=Ue.createContext({activeIndex:-1,containerId:Fb,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:vm,disabled:{draggable:!1,droppable:!1}});function Ba(e){let{children:t,id:s,items:a,strategy:o=vm,disabled:c=!1}=e;const{active:u,dragOverlay:h,droppableRects:f,over:p,measureDroppableContainers:m}=qb(),g=Ec(Fb,s),x=h.rect!==null,v=k.useMemo(()=>a.map(F=>typeof F=="object"&&"id"in F?F.id:F),[a]),S=u!=null,w=u?v.indexOf(u.id):-1,_=p?v.indexOf(p.id):-1,j=k.useRef(v),E=!UC(v,j.current),T=_!==-1&&w===-1||E,R=BC(c);Os(()=>{E&&S&&m(v)},[E,v,S,m]),k.useEffect(()=>{j.current=v},[v]);const B=k.useMemo(()=>({activeIndex:w,containerId:g,disabled:R,disableTransforms:T,items:v,overIndex:_,useDragOverlay:x,sortedRects:MC(v,f),strategy:o}),[w,g,R.draggable,R.droppable,T,v,_,f,x,o]);return Ue.createElement(Vb.Provider,{value:B},t)}const $C=e=>{let{id:t,items:s,activeIndex:a,overIndex:o}=e;return aa(s,a,o).indexOf(t)},qC=e=>{let{containerId:t,isSorting:s,wasDragging:a,index:o,items:c,newIndex:u,previousItems:h,previousContainerId:f,transition:p}=e;return!p||!a||h!==c&&o===u?!1:s?!0:u!==o&&t===f},FC={duration:200,easing:"ease"},Hb="transform",VC=Vr.Transition.toString({property:Hb,duration:0,easing:"linear"}),HC={roleDescription:"sortable"};function GC(e){let{disabled:t,index:s,node:a,rect:o}=e;const[c,u]=k.useState(null),h=k.useRef(s);return Os(()=>{if(!t&&s!==h.current&&a.current){const f=o.current;if(f){const p=Zo(a.current,{ignoreTransform:!0}),m={x:f.left-p.left,y:f.top-p.top,scaleX:f.width/p.width,scaleY:f.height/p.height};(m.x||m.y)&&u(m)}}s!==h.current&&(h.current=s)},[t,s,a,o]),k.useEffect(()=>{c&&u(null)},[c]),c}function $a(e){let{animateLayoutChanges:t=qC,attributes:s,disabled:a,data:o,getNewIndex:c=$C,id:u,strategy:h,resizeObserverConfig:f,transition:p=FC}=e;const{items:m,containerId:g,activeIndex:x,disabled:v,disableTransforms:S,sortedRects:w,overIndex:_,useDragOverlay:j,strategy:E}=k.useContext(Vb),T=KC(a,v),R=m.indexOf(u),B=k.useMemo(()=>({sortable:{containerId:g,index:R,items:m},...o}),[g,o,R,m]),F=k.useMemo(()=>m.slice(m.indexOf(u)),[m,u]),{rect:$,node:M,isOver:z,setNodeRef:P}=Ac({id:u,data:B,disabled:T.droppable,resizeObserverConfig:{updateMeasurementsFor:F,...f}}),{active:H,activatorEvent:O,activeNodeRect:q,attributes:C,setNodeRef:I,listeners:L,isDragging:V,over:G,setActivatorNodeRef:Y,transform:Z}=mm({id:u,data:B,attributes:{...HC,...s},disabled:T.draggable}),A=fj(P,I),U=!!H,X=U&&!S&&Iu(x)&&Iu(_),se=!j&&V,oe=se&&X?Z:null,ue=X?oe??(h??E)({rects:w,activeNodeRect:q,activeIndex:x,overIndex:_,index:R}):null,ne=Iu(x)&&Iu(_)?c({id:u,items:m,activeIndex:x,overIndex:_}):R,we=H?.id,Le=k.useRef({activeId:we,items:m,newIndex:ne,containerId:g}),ge=m!==Le.current.items,Te=t({active:H,containerId:g,isDragging:V,isSorting:U,id:u,index:R,items:m,newIndex:Le.current.newIndex,previousItems:Le.current.items,previousContainerId:Le.current.containerId,transition:p,wasDragging:Le.current.activeId!=null}),de=GC({disabled:!Te,index:R,node:M,rect:$});return k.useEffect(()=>{U&&Le.current.newIndex!==ne&&(Le.current.newIndex=ne),g!==Le.current.containerId&&(Le.current.containerId=g),m!==Le.current.items&&(Le.current.items=m)},[U,ne,g,m]),k.useEffect(()=>{if(we===Le.current.activeId)return;if(we!=null&&Le.current.activeId==null){Le.current.activeId=we;return}const ve=setTimeout(()=>{Le.current.activeId=we},50);return()=>clearTimeout(ve)},[we]),{active:H,activeIndex:x,attributes:C,data:B,rect:$,index:R,newIndex:ne,items:m,isOver:z,isSorting:U,isDragging:V,listeners:L,node:M,overIndex:_,over:G,setNodeRef:A,setActivatorNodeRef:Y,setDroppableNodeRef:P,setDraggableNodeRef:I,transform:de??ue,transition:N()};function N(){if(de||ge&&Le.current.newIndex===R)return VC;if(!(se&&!Rd(O)||!p)&&(U||Te))return Vr.Transition.toString({...p,property:Hb})}}function KC(e,t){var s,a;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(s=e?.draggable)!=null?s:t.draggable,droppable:(a=e?.droppable)!=null?a:t.droppable}}function gd(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const WC=[sn.Down,sn.Right,sn.Up,sn.Left],Id=(e,t)=>{let{context:{active:s,collisionRect:a,droppableRects:o,droppableContainers:c,over:u,scrollableAncestors:h}}=t;if(WC.includes(e.code)){if(e.preventDefault(),!s||!a)return;const f=[];c.getEnabled().forEach(g=>{if(!g||g!=null&&g.disabled)return;const x=o.get(g.id);if(x)switch(e.code){case sn.Down:a.top<x.top&&f.push(g);break;case sn.Up:a.top>x.top&&f.push(g);break;case sn.Left:a.left>x.left&&f.push(g);break;case sn.Right:a.left<x.left&&f.push(g);break}});const p=Aj({collisionRect:a,droppableRects:o,droppableContainers:f});let m=Cb(p,"id");if(m===u?.id&&p.length>1&&(m=p[1].id),m!=null){const g=c.get(s.id),x=c.get(m),v=x?o.get(x.id):null,S=x?.node.current;if(S&&v&&g&&x){const _=Od(S).some((F,$)=>h[$]!==F),j=Gb(g,x),E=YC(g,x),T=_||!j?{x:0,y:0}:{x:E?a.width-v.width:0,y:E?a.height-v.height:0},R={x:v.left,y:v.top};return T.x&&T.y?R:dc(R,T)}}}};function Gb(e,t){return!gd(e)||!gd(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function YC(e,t){return!gd(e)||!gd(t)||!Gb(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}const QC=()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1,JC=(e,{mobile:t=!1}={})=>{if(!e||typeof e!="string"||e.startsWith("data:")||e.startsWith("blob:"))return e;if(e.includes("/storage/v1/object/public/")){const s=t?360:640,a=t?55:68,o=e.includes("?")?"&":"?";return`${e}${o}width=${s}&quality=${a}&resize=contain`}return e},E0=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},sa=e=>Array.isArray(e)?e.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof e=="string"?e.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],XC=({recipe:e,isSelected:t,isSelectMode:s,onSelectRecipe:a,onToggleSelection:o,disableDrag:c,showOwner:u,ownerLabelFn:h,index:f=0,mobileView:p=!1})=>{const{attributes:m,listeners:g,setNodeRef:x,transform:v,transition:S,isDragging:w}=$a({id:e.id,disabled:c}),_={transform:Vr.Transform.toString(v),transition:S,opacity:w?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:c?"default":"grab"},j=p?4:8,E=f<j?"eager":"lazy",T=f<j?"high":"low",R=JC(e.image,{mobile:p});return r.jsx("div",{ref:x,style:_,...m,...g,children:r.jsxs(vn,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${e.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(e.category||"")||e.tags&&e.tags.some(B=>/|Dessert/i.test(B))?"recipe-card--dessert":""} ${e.category==="URL"||e.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{s?o(e.id):a(e)},children:[r.jsxs("div",{className:"recipe-card__image-wrapper",children:[e.image?r.jsx("img",{src:R,alt:e.title,className:"recipe-card__image",loading:E,decoding:"async",fetchPriority:T,sizes:p?"(max-width: 700px) 45vw, 320px":"(max-width: 1024px) 33vw, 280px"}):r.jsx("div",{className:"recipe-card__image placeholder"}),r.jsx("div",{className:"recipe-card__overlay"}),s&&r.jsx("div",{className:"recipe-card__selection-overlay",children:r.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),r.jsx("div",{className:"recipe-card__tags",children:(()=>{const B=sa(e.tags);if(B.length===0)return null;const F=B.filter(z=>!z.startsWith("owner:"));return(F.includes("URL")?["URL"]:F).slice(0,1).map((z,P)=>r.jsx("span",{className:"recipe-tag",children:z},`${z}-${P}`))})()})]}),r.jsxs("div",{className:"recipe-card__content",children:[r.jsx("h3",{className:"recipe-title",children:e.title}),r.jsx("p",{className:"recipe-desc",children:e.description}),r.jsxs("div",{className:"recipe-meta",children:[e.storeName&&r.jsxs("span",{children:[" ",e.storeName]}),u&&typeof h=="function"&&r.jsxs("span",{className:"recipe-owner",children:[" ",h(e)]}),r.jsxs("div",{className:"recipe-dates",children:[r.jsxs("span",{className:"recipe-date",children:[" : ",E0(e.created_at)]}),e.updated_at&&r.jsxs("span",{className:"recipe-date",children:[" : ",E0(e.updated_at)]})]})]})]})]})})},N0=e=>{const t=sa(e.tags);return e.type==="bread"||t.some(s=>/|Bread/i.test(s))},A0=e=>{const t=a=>/|Dessert/i.test(a),s=sa(e.tags);return/|Dessert/i.test(e.category||"")||s.some(t)},T0=e=>{const t=sa(e.tags);return/|Sauce/i.test(e.category||"")||t.some(s=>/|Sauce/i.test(s))},R0=e=>{const t=sa(e.tags);return/||Decor/i.test(e.category||"")||t.some(s=>/||Decor/i.test(s))},O0=e=>{const t=e.category||"",s=sa(e.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||s.some(a=>/|Dressing||Vinaigrette||Mayonnaise/i.test(a))},D0=e=>{const t=e.filter(g=>N0(g)),s=e.filter(g=>!N0(g)),a=s.filter(g=>T0(g)),o=s.filter(g=>!T0(g)),c=o.filter(g=>R0(g)),u=o.filter(g=>!R0(g)),h=u.filter(g=>O0(g)),f=u.filter(g=>!O0(g)),p=f.filter(g=>A0(g));return{cookingRecipes:f.filter(g=>!A0(g)),breadRecipes:t,dessertRecipes:p,sauceRecipes:a,dressingRecipes:h,decorationRecipes:c}},L0=({recipes:e,onSelectRecipe:t,isSelectMode:s,selectedIds:a,onToggleSelection:o,disableDrag:c,displayMode:u="normal",publicRecipeView:h="none",showOwner:f=!1,ownerLabelFn:p,currentUser:m=null})=>{const[g,x]=k.useState({}),[v,S]=k.useState(()=>QC());Ue.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const G=window.matchMedia("(max-width: 700px)"),Y=()=>S(!!G.matches);return Y(),G.addEventListener?G.addEventListener("change",Y):G.addListener(Y),()=>{G.removeEventListener?G.removeEventListener("change",Y):G.removeListener(Y)}},[]);const w=G=>{x(Y=>({...Y,[G]:!Y[G]}))},_=G=>sa(G?.tags).map(Z=>Z.toLowerCase()).includes("public"),j=G=>{if(!m)return!1;const Y=sa(G?.tags).filter(A=>A.startsWith("owner:"));if(Y.length===0)return!1;const Z=new Set([m?.id?`owner:${m.id}`:null,m?.displayId?`owner:${m.displayId}`:null].filter(Boolean));return Y.some(A=>Z.has(A))},E=e.filter(G=>_(G)),T=E.filter(G=>j(G)),R=E.filter(G=>!j(G)),B=e.filter(G=>!_(G)),F=h!=="none"?h:E.length===0||B.length>0?"none":T.length>0?"mine":"others",{cookingRecipes:$,breadRecipes:M,dessertRecipes:z,sauceRecipes:P,dressingRecipes:H,decorationRecipes:O}=D0(B),[q,C]=k.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);Ue.useEffect(()=>{const G=()=>{window.innerWidth>=1024?C(9):C(8)};return window.addEventListener("resize",G),()=>window.removeEventListener("resize",G)},[]);const I=(G,Y,Z,A,{showWhenEmpty:U=!1,emptyMessage:X=""}={})=>{if(Y.length===0&&!U)return null;const se=u==="all";let oe=Y,Ce=!1,ue=!1;return se||(Ce=g[A],ue=Y.length>q,oe=Ce?Y:Y.slice(0,q)),r.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[r.jsxs("h3",{onClick:()=>!se&&ue&&w(A),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!se&&ue?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[r.jsx("span",{children:Z})," ",G,r.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",Y.length,")"]}),!se&&ue&&r.jsx("span",{className:"section-toggle-btn",children:Ce?" ":" "})]}),r.jsx("div",{className:"recipe-grid",children:r.jsx(Ba,{items:oe.map(ne=>ne.id),strategy:vm,children:oe.map((ne,we)=>{const Le=a&&a.has(ne.id);return r.jsx(XC,{recipe:ne,isSelected:Le,isSelectMode:s,onSelectRecipe:t,onToggleSelection:o,disableDrag:c,showOwner:f,ownerLabelFn:p,index:we,mobileView:v},ne.id)})})}),Y.length===0&&r.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:X||`${G}`})]})},L=()=>{if(F!=="mine"&&F!=="others")return null;const G=F==="mine",Y=G?"":"",Z=G?"":"",A=G?"public-mine":"public-others",U=G?T:R,X=G?"":"",se=D0(U);return r.jsxs("div",{className:"public-recipes-block",children:[r.jsxs("div",{className:"public-recipes-block__header",children:[r.jsx("span",{children:Z}),r.jsx("span",{children:Y}),r.jsxs("span",{className:"public-recipes-block__count",children:["(",U.length,")"]})]}),U.length===0?r.jsx("div",{className:"public-recipes-block__empty",children:X}):r.jsxs(r.Fragment,{children:[I("",se.cookingRecipes,"",`${A}-cooking`),I("",se.breadRecipes,"",`${A}-bread`),I("",se.dessertRecipes,"",`${A}-dessert`),I("",se.sauceRecipes,"",`${A}-sauce`),I("",se.dressingRecipes,"",`${A}-dressing`),I("",se.decorationRecipes,"",`${A}-decoration`)]})]})},V=F==="none"&&E.length>0&&B.length===0;return r.jsxs("div",{className:"recipe-list-container",children:[L(),V&&r.jsx("div",{className:"recipe-list-empty-hint",children:""}),I("",$,"","cooking"),I("",M,"","bread"),I("",z,"","dessert"),I("",P,"","sauce"),I("",H,"","dressing"),I("",O,"","decoration"),e.length===0&&r.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},an=({isOpen:e,onClose:t,title:s,children:a,size:o="medium",showCloseButton:c=!0})=>{if(k.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[e]),k.useEffect(()=>{const h=f=>{f.key==="Escape"&&e&&t()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[e,t]),!e)return null;const u=h=>{h.target===h.currentTarget&&t()};return r.jsx("div",{className:"modal-overlay",onClick:u,children:r.jsxs("div",{className:`modal-content modal-${o}`,children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"modal-title",children:s}),c&&r.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),r.jsx("div",{className:"modal-body",children:a})]})})};function Md(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(s[a[o]]=e[a[o]]);return s}function ZC(e,t,s,a){function o(c){return c instanceof s?c:new s(function(u){u(c)})}return new(s||(s=Promise))(function(c,u){function h(m){try{p(a.next(m))}catch(g){u(g)}}function f(m){try{p(a.throw(m))}catch(g){u(g)}}function p(m){m.done?c(m.value):o(m.value).then(h,f)}p((a=a.apply(e,t||[])).next())})}const ek=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class xm extends Error{constructor(t,s="FunctionsError",a){super(t),this.name=s,this.context=a}}class tk extends xm{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class z0 extends xm{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class I0 extends xm{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Mp;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(Mp||(Mp={}));class nk{constructor(t,{headers:s={},customFetch:a,region:o=Mp.Any}={}){this.url=t,this.headers=s,this.region=o,this.fetch=ek(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return ZC(this,arguments,void 0,function*(s,a={}){var o;let c,u;try{const{headers:h,method:f,body:p,signal:m,timeout:g}=a;let x={},{region:v}=a;v||(v=this.region);const S=new URL(`${this.url}/${s}`);v&&v!=="any"&&(x["x-region"]=v,S.searchParams.set("forceFunctionRegion",v));let w;p&&(h&&!Object.prototype.hasOwnProperty.call(h,"Content-Type")||!h)?typeof Blob<"u"&&p instanceof Blob||p instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",w=p):typeof p=="string"?(x["Content-Type"]="text/plain",w=p):typeof FormData<"u"&&p instanceof FormData?w=p:(x["Content-Type"]="application/json",w=JSON.stringify(p)):p&&typeof p!="string"&&!(typeof Blob<"u"&&p instanceof Blob)&&!(p instanceof ArrayBuffer)&&!(typeof FormData<"u"&&p instanceof FormData)?w=JSON.stringify(p):w=p;let _=m;g&&(u=new AbortController,c=setTimeout(()=>u.abort(),g),m?(_=u.signal,m.addEventListener("abort",()=>u.abort())):_=u.signal);const j=yield this.fetch(S.toString(),{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),h),body:w,signal:_}).catch(B=>{throw new tk(B)}),E=j.headers.get("x-relay-error");if(E&&E==="true")throw new z0(j);if(!j.ok)throw new I0(j);let T=((o=j.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),R;return T==="application/json"?R=yield j.json():T==="application/octet-stream"||T==="application/pdf"?R=yield j.blob():T==="text/event-stream"?R=j:T==="multipart/form-data"?R=yield j.formData():R=yield j.text(),{data:R,error:null,response:j}}catch(h){return{data:null,error:h,response:h instanceof I0||h instanceof z0?h.context:void 0}}finally{c&&clearTimeout(c)}})}}var rk=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},sk=class{constructor(e){var t,s,a;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(s=e.isMaybeSingle)!==null&&s!==void 0?s:!1,this.urlLengthLimit=(a=e.urlLengthLimit)!==null&&a!==void 0?a:8e3,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let o=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{let u=null,h=null,f=null,p=c.status,m=c.statusText;if(c.ok){var g,x;if(s.method!=="HEAD"){var v;const j=await c.text();j===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((v=s.headers.get("Accept"))===null||v===void 0)&&v.includes("application/vnd.pgrst.plan+text"))?h=j:h=JSON.parse(j))}const w=(g=s.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),_=(x=c.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");w&&_&&_.length>1&&(f=parseInt(_[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(h)&&(h.length>1?(u={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,f=null,p=406,m="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{var S;const w=await c.text();try{u=JSON.parse(w),Array.isArray(u)&&c.status===404&&(h=[],u=null,p=200,m="OK")}catch{c.status===404&&w===""?(p=204,m="No Content"):u={message:w}}if(u&&s.isMaybeSingle&&(!(u==null||(S=u.details)===null||S===void 0)&&S.includes("0 rows"))&&(u=null,p=200,m="OK"),u&&s.shouldThrowOnError)throw new rk(u)}return{error:u,data:h,count:f,status:p,statusText:m}});return this.shouldThrowOnError||(o=o.catch(c=>{var u;let h="",f="",p="";const m=c?.cause;if(m){var g,x,v,S;const j=(g=m?.message)!==null&&g!==void 0?g:"",E=(x=m?.code)!==null&&x!==void 0?x:"";h=`${(v=c?.name)!==null&&v!==void 0?v:"FetchError"}: ${c?.message}`,h+=`

Caused by: ${(S=m?.name)!==null&&S!==void 0?S:"Error"}: ${j}`,E&&(h+=` (${E})`),m?.stack&&(h+=`
${m.stack}`)}else{var w;h=(w=c?.stack)!==null&&w!==void 0?w:""}const _=this.url.toString().length;return c?.name==="AbortError"||c?.code==="ABORT_ERR"?(p="",f="Request was aborted (timeout or manual cancellation)",_>this.urlLengthLimit&&(f+=`. Note: Your request URL is ${_} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(m?.name==="HeadersOverflowError"||m?.code==="UND_ERR_HEADERS_OVERFLOW")&&(p="",f="HTTP headers exceeded server limits (typically 16KB)",_>this.urlLengthLimit&&(f+=`. Your request URL is ${_} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:h,hint:f,code:p},data:null,count:null,status:0,statusText:""}})),o.then(e,t)}returns(){return this}overrideTypes(){return this}},ik=class extends sk{select(e){let t=!1;const s=(e??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:a,referencedTable:o=a}={}){const c=o?`${o}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(a,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:a=s}={}){const o=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(c,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:a=!1,wal:o=!1,format:c="text"}={}){var u;const h=[e?"analyze":null,t?"verbose":null,s?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${f}"; options=${h};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const M0=new RegExp("[,()]");var Lo=class extends ik{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(a=>typeof a=="string"&&M0.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}notIn(e,t){const s=Array.from(new Set(t)).map(a=>typeof a=="string"&&M0.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(e,`not.in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const c=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${o}fts${c}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const a=s?`${s}.or`:"or";return this.url.searchParams.append(a,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}},ak=class{constructor(e,{headers:t={},schema:s,fetch:a,urlLengthLimit:o=8e3}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=a,this.urlLengthLimit=o}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:s=!1,count:a}=t??{},o=s?"HEAD":"GET";let c=!1;const u=(e??"*").split("").map(p=>/\s/.test(p)&&!c?"":(p==='"'&&(c=!c),p)).join(""),{url:h,headers:f}=this.cloneRequestState();return h.searchParams.set("select",u),a&&f.append("Prefer",`count=${a}`),new Lo({method:o,url:h,headers:f,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(e,{count:t,defaultToNull:s=!0}={}){var a;const o="POST",{url:c,headers:u}=this.cloneRequestState();if(t&&u.append("Prefer",`count=${t}`),s||u.append("Prefer","missing=default"),Array.isArray(e)){const h=e.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(h.length>0){const f=[...new Set(h)].map(p=>`"${p}"`);c.searchParams.set("columns",f.join(","))}}return new Lo({method:o,url:c,headers:u,schema:this.schema,body:e,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:a,defaultToNull:o=!0}={}){var c;const u="POST",{url:h,headers:f}=this.cloneRequestState();if(f.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&h.searchParams.set("on_conflict",t),a&&f.append("Prefer",`count=${a}`),o||f.append("Prefer","missing=default"),Array.isArray(e)){const p=e.reduce((m,g)=>m.concat(Object.keys(g)),[]);if(p.length>0){const m=[...new Set(p)].map(g=>`"${g}"`);h.searchParams.set("columns",m.join(","))}}return new Lo({method:u,url:h,headers:f,schema:this.schema,body:e,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch,urlLengthLimit:this.urlLengthLimit})}update(e,{count:t}={}){var s;const a="PATCH",{url:o,headers:c}=this.cloneRequestState();return t&&c.append("Prefer",`count=${t}`),new Lo({method:a,url:o,headers:c,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:e}={}){var t;const s="DELETE",{url:a,headers:o}=this.cloneRequestState();return e&&o.append("Prefer",`count=${e}`),new Lo({method:s,url:a,headers:o,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function fc(e){"@babel/helpers - typeof";return fc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fc(e)}function ok(e,t){if(fc(e)!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,t);if(fc(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lk(e){var t=ok(e,"string");return fc(t)=="symbol"?t:t+""}function ck(e,t,s){return(t=lk(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function U0(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),s.push.apply(s,a)}return s}function Uu(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?U0(Object(s),!0).forEach(function(a){ck(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):U0(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}var uk=class Kb{constructor(t,{headers:s={},schema:a,fetch:o,timeout:c,urlLengthLimit:u=8e3}={}){this.url=t,this.headers=new Headers(s),this.schemaName=a,this.urlLengthLimit=u;const h=o??globalThis.fetch;c!==void 0&&c>0?this.fetch=(f,p)=>{const m=new AbortController,g=setTimeout(()=>m.abort(),c),x=p?.signal;if(x){if(x.aborted)return clearTimeout(g),h(f,p);const v=()=>{clearTimeout(g),m.abort()};return x.addEventListener("abort",v,{once:!0}),h(f,Uu(Uu({},p),{},{signal:m.signal})).finally(()=>{clearTimeout(g),x.removeEventListener("abort",v)})}return h(f,Uu(Uu({},p),{},{signal:m.signal})).finally(()=>clearTimeout(g))}:this.fetch=h}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new ak(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new Kb(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,s={},{head:a=!1,get:o=!1,count:c}={}){var u;let h;const f=new URL(`${this.url}/rpc/${t}`);let p;const m=v=>v!==null&&typeof v=="object"&&(!Array.isArray(v)||v.some(m)),g=a&&Object.values(s).some(m);g?(h="POST",p=s):a||o?(h=a?"HEAD":"GET",Object.entries(s).filter(([v,S])=>S!==void 0).map(([v,S])=>[v,Array.isArray(S)?`{${S.join(",")}}`:`${S}`]).forEach(([v,S])=>{f.searchParams.append(v,S)})):(h="POST",p=s);const x=new Headers(this.headers);return g?x.set("Prefer",c?`count=${c},return=minimal`:"return=minimal"):c&&x.set("Prefer",`count=${c}`),new Lo({method:h,url:f,headers:x,schema:this.schemaName,body:p,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch,urlLengthLimit:this.urlLengthLimit})}};class dk{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const s=globalThis.process;if(s){const a=s.versions;if(a&&a.node){const o=a.node,c=parseInt(o.replace(/^v/,"").split(".")[0]);return c>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${c} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${c} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const a=this.getWebSocketConstructor();return new a(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const hk="2.97.0",fk=`realtime-js/${hk}`,pk="1.0.0",Wb="2.0.0",B0=Wb,Up=1e4,mk=1e3,gk=100;var Xi;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Xi||(Xi={}));var dr;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(dr||(dr={}));var As;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(As||(As={}));var Bp;(function(e){e.websocket="websocket"})(Bp||(Bp={}));var Oa;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Oa||(Oa={}));class yk{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,s){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return s(this._binaryEncodeUserBroadcastPush(t));let a=[t.join_ref,t.ref,t.topic,t.event,t.payload];return s(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(t){var s;return this._isArrayBuffer((s=t.payload)===null||s===void 0?void 0:s.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var s,a;const o=(a=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var s,a;const o=(a=(s=t.payload)===null||s===void 0?void 0:s.payload)!==null&&a!==void 0?a:{},u=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,u)}_encodeUserBroadcastPush(t,s,a){var o,c;const u=t.topic,h=(o=t.ref)!==null&&o!==void 0?o:"",f=(c=t.join_ref)!==null&&c!==void 0?c:"",p=t.payload.event,m=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},g=Object.keys(m).length===0?"":JSON.stringify(m);if(f.length>255)throw new Error(`joinRef length ${f.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`ref length ${h.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`topic length ${u.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`userEvent length ${p.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`metadata length ${g.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+f.length+h.length+u.length+p.length+g.length,v=new ArrayBuffer(this.HEADER_LENGTH+x);let S=new DataView(v),w=0;S.setUint8(w++,this.KINDS.userBroadcastPush),S.setUint8(w++,f.length),S.setUint8(w++,h.length),S.setUint8(w++,u.length),S.setUint8(w++,p.length),S.setUint8(w++,g.length),S.setUint8(w++,s),Array.from(f,j=>S.setUint8(w++,j.charCodeAt(0))),Array.from(h,j=>S.setUint8(w++,j.charCodeAt(0))),Array.from(u,j=>S.setUint8(w++,j.charCodeAt(0))),Array.from(p,j=>S.setUint8(w++,j.charCodeAt(0))),Array.from(g,j=>S.setUint8(w++,j.charCodeAt(0)));var _=new Uint8Array(v.byteLength+a.byteLength);return _.set(new Uint8Array(v),0),_.set(new Uint8Array(a),v.byteLength),_.buffer}decode(t,s){if(this._isArrayBuffer(t)){let a=this._binaryDecode(t);return s(a)}if(typeof t=="string"){const a=JSON.parse(t),[o,c,u,h,f]=a;return s({join_ref:o,ref:c,topic:u,event:h,payload:f})}return s({})}_binaryDecode(t){const s=new DataView(t),a=s.getUint8(0),o=new TextDecoder;if(a===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,s,o)}_decodeUserBroadcast(t,s,a){const o=s.getUint8(1),c=s.getUint8(2),u=s.getUint8(3),h=s.getUint8(4);let f=this.HEADER_LENGTH+4;const p=a.decode(t.slice(f,f+o));f=f+o;const m=a.decode(t.slice(f,f+c));f=f+c;const g=a.decode(t.slice(f,f+u));f=f+u;const x=t.slice(f,t.byteLength),v=h===this.JSON_ENCODING?JSON.parse(a.decode(x)):x,S={type:this.BROADCAST_EVENT,event:m,payload:v};return u>0&&(S.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:p,event:this.BROADCAST_EVENT,payload:S}}_isArrayBuffer(t){var s;return t instanceof ArrayBuffer||((s=t?.constructor)===null||s===void 0?void 0:s.name)==="ArrayBuffer"}_pick(t,s){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([a])=>s.includes(a)))}}class Yb{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Dn;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Dn||(Dn={}));const P0=(e,t,s={})=>{var a;const o=(a=s.skipTypes)!==null&&a!==void 0?a:[];return t?Object.keys(t).reduce((c,u)=>(c[u]=vk(u,e,t,o),c),{}):{}},vk=(e,t,s,a)=>{const o=t.find(h=>h.name===e),c=o?.type,u=s[e];return c&&!a.includes(c)?Qb(c,u):Pp(u)},Qb=(e,t)=>{if(e.charAt(0)==="_"){const s=e.slice(1,e.length);return wk(t,s)}switch(e){case Dn.bool:return xk(t);case Dn.float4:case Dn.float8:case Dn.int2:case Dn.int4:case Dn.int8:case Dn.numeric:case Dn.oid:return bk(t);case Dn.json:case Dn.jsonb:return _k(t);case Dn.timestamp:return Sk(t);case Dn.abstime:case Dn.date:case Dn.daterange:case Dn.int4range:case Dn.int8range:case Dn.money:case Dn.reltime:case Dn.text:case Dn.time:case Dn.timestamptz:case Dn.timetz:case Dn.tsrange:case Dn.tstzrange:return Pp(t);default:return Pp(t)}},Pp=e=>e,xk=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},bk=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},_k=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},wk=(e,t)=>{if(typeof e!="string")return e;const s=e.length-1,a=e[s];if(e[0]==="{"&&a==="}"){let c;const u=e.slice(1,s);try{c=JSON.parse("["+u+"]")}catch{c=u?u.split(","):[]}return c.map(h=>Qb(t,h))}return e},Sk=e=>typeof e=="string"?e.replace(" ","T"):e,Jb=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Jf{constructor(t,s,a={},o=Up){this.channel=t,this.event=s,this.payload=a,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var a;return this._hasReceived(t)&&s((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var $0;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})($0||($0={}));class oc{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},o=>{const{onJoin:c,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=oc.syncState(this.state,o,c,u),this.pendingDiffs.forEach(f=>{this.state=oc.syncDiff(this.state,f,c,u)}),this.pendingDiffs=[],h()}),this.channel._on(a.diff,{},o=>{const{onJoin:c,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=oc.syncDiff(this.state,o,c,u),h())}),this.onJoin((o,c,u)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:c,newPresences:u})}),this.onLeave((o,c,u)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:c,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,a,o){const c=this.cloneDeep(t),u=this.transformState(s),h={},f={};return this.map(c,(p,m)=>{u[p]||(f[p]=m)}),this.map(u,(p,m)=>{const g=c[p];if(g){const x=m.map(_=>_.presence_ref),v=g.map(_=>_.presence_ref),S=m.filter(_=>v.indexOf(_.presence_ref)<0),w=g.filter(_=>x.indexOf(_.presence_ref)<0);S.length>0&&(h[p]=S),w.length>0&&(f[p]=w)}else h[p]=m}),this.syncDiff(c,{joins:h,leaves:f},a,o)}static syncDiff(t,s,a,o){const{joins:c,leaves:u}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return a||(a=()=>{}),o||(o=()=>{}),this.map(c,(h,f)=>{var p;const m=(p=t[h])!==null&&p!==void 0?p:[];if(t[h]=this.cloneDeep(f),m.length>0){const g=t[h].map(v=>v.presence_ref),x=m.filter(v=>g.indexOf(v.presence_ref)<0);t[h].unshift(...x)}a(h,m,f)}),this.map(u,(h,f)=>{let p=t[h];if(!p)return;const m=f.map(g=>g.presence_ref);p=p.filter(g=>m.indexOf(g.presence_ref)<0),t[h]=p,o(h,p,f),p.length===0&&delete t[h]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(a=>s(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,a)=>{const o=t[a];return"metas"in o?s[a]=o.metas.map(c=>(c.presence_ref=c.phx_ref,delete c.phx_ref,delete c.phx_ref_prev,c)):s[a]=o,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var q0;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(q0||(q0={}));var lc;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(lc||(lc={}));var fi;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(fi||(fi={}));class Uo{constructor(t,s={config:{}},a){var o,c;if(this.topic=t,this.params=s,this.socket=a,this.bindings={},this.state=dr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new Jf(this,As.join,this.params,this.timeout),this.rejoinTimer=new Yb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=dr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(u=>u.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=dr.closed,this.socket._remove(this)}),this._onError(u=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,u),this.state=dr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=dr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",u=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,u),this.state=dr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(As.reply,{},(u,h)=>{this._trigger(this._replyEventName(h),u)}),this.presence=new oc(this),this.broadcastEndpointURL=Jb(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((c=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,s=this.timeout){var a,o,c;if(this.socket.isConnected()||this.socket.connect(),this.state==dr.closed){const{config:{broadcast:u,presence:h,private:f}}=this.params,p=(o=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(v=>v.filter))!==null&&o!==void 0?o:[],m=!!this.bindings[lc.PRESENCE]&&this.bindings[lc.PRESENCE].length>0||((c=this.params.config.presence)===null||c===void 0?void 0:c.enabled)===!0,g={},x={broadcast:u,presence:Object.assign(Object.assign({},h),{enabled:m}),postgres_changes:p,private:f};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(v=>t?.(fi.CHANNEL_ERROR,v)),this._onClose(()=>t?.(fi.CLOSED)),this.updateJoinPayload(Object.assign({config:x},g)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:v})=>{var S;if(this.socket._isManualToken()||this.socket.setAuth(),v===void 0){t?.(fi.SUBSCRIBED);return}else{const w=this.bindings.postgres_changes,_=(S=w?.length)!==null&&S!==void 0?S:0,j=[];for(let E=0;E<_;E++){const T=w[E],{filter:{event:R,schema:B,table:F,filter:$}}=T,M=v&&v[E];if(M&&M.event===R&&Uo.isFilterValueEqual(M.schema,B)&&Uo.isFilterValueEqual(M.table,F)&&Uo.isFilterValueEqual(M.filter,$))j.push(Object.assign(Object.assign({},T),{id:M.id}));else{this.unsubscribe(),this.state=dr.errored,t?.(fi.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=j,t&&t(fi.SUBSCRIBED);return}}).receive("error",v=>{this.state=dr.errored,t?.(fi.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{t?.(fi.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,a){return this.state===dr.joined&&t===lc.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,s,a)}async httpSend(t,s,a={}){var o;if(s==null)return Promise.reject("Payload is required for httpSend()");const c={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(c.Authorization=`Bearer ${this.socket.accessTokenValue}`);const u={method:"POST",headers:c,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:s,private:this.private}]})},h=await this._fetchWithTimeout(this.broadcastEndpointURL,u,(o=a.timeout)!==null&&o!==void 0?o:this.timeout);if(h.status===202)return{success:!0};let f=h.statusText;try{const p=await h.json();f=p.error||p.message||f}catch{}return Promise.reject(new Error(f))}async send(t,s={}){var a,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:c,payload:u}=t,h={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(h.Authorization=`Bearer ${this.socket.accessTokenValue}`);const f={method:"POST",headers:h,body:JSON.stringify({messages:[{topic:this.subTopic,event:c,payload:u,private:this.private}]})};try{const p=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(a=s.timeout)!==null&&a!==void 0?a:this.timeout);return await((o=p.body)===null||o===void 0?void 0:o.cancel()),p.ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(c=>{var u,h,f;const p=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((f=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&c("ok"),p.receive("ok",()=>c("ok")),p.receive("error",()=>c("error")),p.receive("timeout",()=>c("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=dr.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(As.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(o=>{a=new Jf(this,As.leave,{},t),a.receive("ok",()=>{s(),o("ok")}).receive("timeout",()=>{s(),o("timed out")}).receive("error",()=>{o("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=dr.closed,this.bindings={}}async _fetchWithTimeout(t,s,a){const o=new AbortController,c=setTimeout(()=>o.abort(),a),u=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:o.signal}));return clearTimeout(c),u}_push(t,s,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Jf(this,t,s,a);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>gk){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,a){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,a){var o,c;const u=t.toLocaleLowerCase(),{close:h,error:f,leave:p,join:m}=As;if(a&&[h,f,p,m].indexOf(u)>=0&&a!==this._joinRef())return;let x=this._onMessage(u,s,a);if(s&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(v=>{var S,w,_;return((S=v.filter)===null||S===void 0?void 0:S.event)==="*"||((_=(w=v.filter)===null||w===void 0?void 0:w.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===u}).map(v=>v.callback(x,a)):(c=this.bindings[u])===null||c===void 0||c.filter(v=>{var S,w,_,j,E,T;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in v){const R=v.id,B=(S=v.filter)===null||S===void 0?void 0:S.event;return R&&((w=s.ids)===null||w===void 0?void 0:w.includes(R))&&(B==="*"||B?.toLocaleLowerCase()===((_=s.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const R=(E=(j=v?.filter)===null||j===void 0?void 0:j.event)===null||E===void 0?void 0:E.toLocaleLowerCase();return R==="*"||R===((T=s?.event)===null||T===void 0?void 0:T.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===u}).map(v=>{if(typeof x=="object"&&"ids"in x){const S=x.data,{schema:w,table:_,commit_timestamp:j,type:E,errors:T}=S;x=Object.assign(Object.assign({},{schema:w,table:_,commit_timestamp:j,eventType:E,new:{},old:{},errors:T}),this._getPayloadRecords(S))}v.callback(x,a)})}_isClosed(){return this.state===dr.closed}_isJoined(){return this.state===dr.joined}_isJoining(){return this.state===dr.joining}_isLeaving(){return this.state===dr.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,a){const o=t.toLocaleLowerCase(),c={type:o,filter:s,callback:a};return this.bindings[o]?this.bindings[o].push(c):this.bindings[o]=[c],this}_off(t,s){const a=t.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(o=>{var c;return!(((c=o.type)===null||c===void 0?void 0:c.toLocaleLowerCase())===a&&Uo.isEqual(o.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const a in t)if(t[a]!==s[a])return!1;return!0}static isFilterValueEqual(t,s){return(t??void 0)===(s??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(As.close,{},t)}_onError(t){this._on(As.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=dr.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=P0(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=P0(t.columns,t.old_record)),s}}const Xf=()=>{},Bu={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},jk=[1e3,2e3,5e3,1e4],Ck=1e4,kk=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ek{constructor(t,s){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Up,this.transport=null,this.heartbeatIntervalMs=Bu.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Xf,this.ref=0,this.reconnectTimer=null,this.vsn=B0,this.logger=Xf,this.conn=null,this.sendBuffer=[],this.serializer=new yk,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=o=>o?(...c)=>o(...c):(...c)=>fetch(...c),!(!((a=s?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${Bp.websocket}`,this.httpEndpoint=Jb(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=dk.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,s??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,a){this.logger(t,s,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Xi.connecting:return Oa.Connecting;case Xi.open:return Oa.Open;case Xi.closing:return Oa.Closing;default:return Oa.Closed}}isConnected(){return this.connectionState()===Oa.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const a=`realtime:${t}`,o=this.getChannels().find(c=>c.topic===a);if(o)return o;{const c=new Uo(`realtime:${t}`,s,this);return this.channels.push(c),c}}push(t){const{topic:s,event:a,payload:o,ref:c}=t,u=()=>{this.encode(t,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${s} ${a} (${c})`,o),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(mk,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Bu.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply"&&s.ref&&s.ref===this.pendingHeartbeatRef){const p=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error",p)}catch(m){this.log("error","error in heartbeat callback",m)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:a,event:o,payload:c,ref:u}=s,h=u?`(${u})`:"",f=c.status||"";this.log("receive",`${f} ${a} ${o} ${h}`.trim(),c),this.channels.filter(p=>p._isMember(a)).forEach(p=>p._trigger(o,c,u)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Xi.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Xi.open||this.conn.readyState===Xi.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(s=>{this.log("error","error waiting for auth on connect",s),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this._terminateWorker()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error")}catch(s){this.log("error","error in heartbeat callback",s)}}_triggerChanError(){this.channels.forEach(t=>t._trigger(As.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const a=t.match(/\?/)?"&":"?",o=new URLSearchParams(s);return`${t}${a}${o}`}_workerObjectUrl(t){let s;if(t)s=t;else{const a=new Blob([kk],{type:"application/javascript"});s=URL.createObjectURL(a)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s,a=!1;if(t)s=t,a=!0;else if(this.accessToken)try{s=await this.accessToken()}catch(o){this.log("error","Error fetching access token from callback",o),s=this.accessTokenValue}else s=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(o=>{const c={access_token:s,version:fk};s&&o.updateJoinPayload(c),o.joinedOnce&&o._isJoined()&&o._push(As.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(s=>{this.log("error",`Error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(a=>{try{a(s)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(a){this.log("error",`error triggering ${t} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new Yb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Bu.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,a,o,c,u,h,f,p,m,g,x,v;switch(this.transport=(s=t?.transport)!==null&&s!==void 0?s:null,this.timeout=(a=t?.timeout)!==null&&a!==void 0?a:Up,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:Bu.HEARTBEAT_INTERVAL,this.worker=(c=t?.worker)!==null&&c!==void 0?c:!1,this.accessToken=(u=t?.accessToken)!==null&&u!==void 0?u:null,this.heartbeatCallback=(h=t?.heartbeatCallback)!==null&&h!==void 0?h:Xf,this.vsn=(f=t?.vsn)!==null&&f!==void 0?f:B0,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(p=t?.reconnectAfterMs)!==null&&p!==void 0?p:(S=>jk[S-1]||Ck),this.vsn){case pk:this.encode=(m=t?.encode)!==null&&m!==void 0?m:((S,w)=>w(JSON.stringify(S))),this.decode=(g=t?.decode)!==null&&g!==void 0?g:((S,w)=>w(JSON.parse(S)));break;case Wb:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(v=t?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var pc=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Nk(e,t,s){const a=new URL(t,e);if(s)for(const[o,c]of Object.entries(s))c!==void 0&&a.searchParams.set(o,c);return a.toString()}async function Ak(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function Tk(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:s,path:a,query:o,body:c,headers:u}){const h=Nk(e.baseUrl,a,o),f=await Ak(e.auth),p=await t(h,{method:s,headers:{...c?{"Content-Type":"application/json"}:{},...f,...u},body:c?JSON.stringify(c):void 0}),m=await p.text(),g=(p.headers.get("content-type")||"").includes("application/json"),x=g&&m?JSON.parse(m):m;if(!p.ok){const v=g?x:void 0,S=v?.error;throw new pc(S?.message??`Request failed with status ${p.status}`,{status:p.status,icebergType:S?.type,icebergCode:S?.code,details:v})}return{status:p.status,headers:p.headers,data:x}}}}function Pu(e){return e.join("")}var Rk=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Pu(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(e,t){const s={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Pu(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Pu(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Pu(e.namespace)}`}),!0}catch(t){if(t instanceof pc&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(s){if(s instanceof pc&&s.status===409)return;throw s}}};function _o(e){return e.join("")}var Ok=class{constructor(e,t="",s){this.client=e,this.prefix=t,this.accessDelegation=s}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${_o(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${_o(e.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(e,t){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${_o(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${_o(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${_o(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${_o(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(s){if(s instanceof pc&&s.status===404)return!1;throw s}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(s){if(s instanceof pc&&s.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw s}}},Dk=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const s=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=Tk({baseUrl:s,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new Rk(this.client,t),this.tableOps=new Ok(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},Ud=class extends Error{constructor(e,t="storage",s,a){super(e),this.__isStorageError=!0,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=s,this.statusCode=a}};function Bd(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var $u=class extends Ud{constructor(e,t,s,a="storage"){super(e,a,t,s),this.name=a==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Xb=class extends Ud{constructor(e,t,s="storage"){super(e,s),this.name=s==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const Lk=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),zk=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},$p=e=>{if(Array.isArray(e))return e.map(s=>$p(s));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([s,a])=>{const o=s.replace(/([-_][a-z])/gi,c=>c.toUpperCase().replace(/[-_]/g,""));t[o]=$p(a)}),t},Ik=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function mc(e){"@babel/helpers - typeof";return mc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mc(e)}function Mk(e,t){if(mc(e)!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,t);if(mc(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Uk(e){var t=Mk(e,"string");return mc(t)=="symbol"?t:t+""}function Bk(e,t,s){return(t=Uk(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function F0(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),s.push.apply(s,a)}return s}function jt(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?F0(Object(s),!0).forEach(function(a){Bk(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):F0(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}const V0=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},Pk=async(e,t,s,a)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!s?.noResolveJson){const o=e,c=o.status||500;if(typeof o.json=="function")o.json().then(u=>{const h=u?.statusCode||u?.code||c+"";t(new $u(V0(u),c,h,a))}).catch(()=>{if(a==="vectors"){const u=c+"";t(new $u(o.statusText||`HTTP ${c} error`,c,u,a))}else{const u=c+"";t(new $u(o.statusText||`HTTP ${c} error`,c,u,a))}});else{const u=c+"";t(new $u(o.statusText||`HTTP ${c} error`,c,u,a))}}else t(new Xb(V0(e),e,a))},$k=(e,t,s,a)=>{const o={method:e,headers:t?.headers||{}};return e==="GET"||e==="HEAD"||!a?jt(jt({},o),s):(zk(a)?(o.headers=jt({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,t?.duplex&&(o.duplex=t.duplex),jt(jt({},o),s))};async function Gl(e,t,s,a,o,c,u){return new Promise((h,f)=>{e(s,$k(t,a,o,c)).then(p=>{if(!p.ok)throw p;if(a?.noResolveJson)return p;if(u==="vectors"){const m=p.headers.get("content-type");if(p.headers.get("content-length")==="0"||p.status===204)return{};if(!m||!m.includes("application/json"))return{}}return p.json()}).then(p=>h(p)).catch(p=>Pk(p,f,a,u))})}function Zb(e="storage"){return{get:async(t,s,a,o)=>Gl(t,"GET",s,a,o,void 0,e),post:async(t,s,a,o,c)=>Gl(t,"POST",s,o,c,a,e),put:async(t,s,a,o,c)=>Gl(t,"PUT",s,o,c,a,e),head:async(t,s,a,o)=>Gl(t,"HEAD",s,jt(jt({},a),{},{noResolveJson:!0}),o,void 0,e),remove:async(t,s,a,o,c)=>Gl(t,"DELETE",s,o,c,a,e)}}const qk=Zb("storage"),{get:gc,post:Ns,put:qp,head:Fk,remove:bm}=qk,ns=Zb("vectors");var rl=class{constructor(e,t={},s,a="storage"){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.fetch=Lk(s),this.namespace=a}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=jt(jt({},this.headers),{},{[e]:t}),this}async handleOperation(e){var t=this;try{return{data:await e(),error:null}}catch(s){if(t.shouldThrowOnError)throw s;if(Bd(s))return{data:null,error:s};throw s}}},Vk=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Bd(t))return{data:null,error:t};throw t}}};let e_;e_=Symbol.toStringTag;var Hk=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[e_]="BlobDownloadBuilder",this.promise=null}asStream(){return new Vk(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Bd(t))return{data:null,error:t};throw t}}};const Gk={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},H0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Kk=class extends rl{constructor(e,t={},s,a){super(e,t,a,"storage"),this.bucketId=s}async uploadOrUpdate(e,t,s,a){var o=this;return o.handleOperation(async()=>{let c;const u=jt(jt({},H0),a);let h=jt(jt({},o.headers),e==="POST"&&{"x-upsert":String(u.upsert)});const f=u.metadata;typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),f&&c.append("metadata",o.encodeMetadata(f)),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.has("cacheControl")||c.append("cacheControl",u.cacheControl),f&&!c.has("metadata")&&c.append("metadata",o.encodeMetadata(f))):(c=s,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,f&&(h["x-metadata"]=o.toBase64(o.encodeMetadata(f))),(typeof ReadableStream<"u"&&c instanceof ReadableStream||c&&typeof c=="object"&&"pipe"in c&&typeof c.pipe=="function")&&!u.duplex&&(u.duplex="half")),a?.headers&&(h=jt(jt({},h),a.headers));const p=o._removeEmptyFolders(t),m=o._getFinalPath(p),g=await(e=="PUT"?qp:Ns)(o.fetch,`${o.url}/object/${m}`,c,jt({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{path:p,id:g.Id,fullPath:g.Key}})}async upload(e,t,s){return this.uploadOrUpdate("POST",e,t,s)}async uploadToSignedUrl(e,t,s,a){var o=this;const c=o._removeEmptyFolders(e),u=o._getFinalPath(c),h=new URL(o.url+`/object/upload/sign/${u}`);return h.searchParams.set("token",t),o.handleOperation(async()=>{let f;const p=jt({upsert:H0.upsert},a),m=jt(jt({},o.headers),{"x-upsert":String(p.upsert)});return typeof Blob<"u"&&s instanceof Blob?(f=new FormData,f.append("cacheControl",p.cacheControl),f.append("",s)):typeof FormData<"u"&&s instanceof FormData?(f=s,f.append("cacheControl",p.cacheControl)):(f=s,m["cache-control"]=`max-age=${p.cacheControl}`,m["content-type"]=p.contentType),{path:c,fullPath:(await qp(o.fetch,h.toString(),f,{headers:m})).Key}})}async createSignedUploadUrl(e,t){var s=this;return s.handleOperation(async()=>{let a=s._getFinalPath(e);const o=jt({},s.headers);t?.upsert&&(o["x-upsert"]="true");const c=await Ns(s.fetch,`${s.url}/object/upload/sign/${a}`,{},{headers:o}),u=new URL(s.url+c.url),h=u.searchParams.get("token");if(!h)throw new Ud("No token returned by API");return{signedUrl:u.toString(),path:e,token:h}})}async update(e,t,s){return this.uploadOrUpdate("PUT",e,t,s)}async move(e,t,s){var a=this;return a.handleOperation(async()=>await Ns(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:a.headers}))}async copy(e,t,s){var a=this;return a.handleOperation(async()=>({path:(await Ns(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:a.headers})).Key}))}async createSignedUrl(e,t,s){var a=this;return a.handleOperation(async()=>{let o=a._getFinalPath(e),c=await Ns(a.fetch,`${a.url}/object/sign/${o}`,jt({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:a.headers});const u=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{signedUrl:encodeURI(`${a.url}${c.signedURL}${u}`)}})}async createSignedUrls(e,t,s){var a=this;return a.handleOperation(async()=>{const o=await Ns(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:t,paths:e},{headers:a.headers}),c=s?.download?`&download=${s.download===!0?"":s.download}`:"";return o.map(u=>jt(jt({},u),{},{signedUrl:u.signedURL?encodeURI(`${a.url}${u.signedURL}${c}`):null}))})}download(e,t,s){const a=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),c=o?`?${o}`:"",u=this._getFinalPath(e),h=()=>gc(this.fetch,`${this.url}/${a}/${u}${c}`,{headers:this.headers,noResolveJson:!0},s);return new Hk(h,this.shouldThrowOnError)}async info(e){var t=this;const s=t._getFinalPath(e);return t.handleOperation(async()=>$p(await gc(t.fetch,`${t.url}/object/info/${s}`,{headers:t.headers})))}async exists(e){var t=this;const s=t._getFinalPath(e);try{return await Fk(t.fetch,`${t.url}/object/${s}`,{headers:t.headers}),{data:!0,error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Bd(a)&&a instanceof Xb){const o=a.originalError;if([400,404].includes(o?.status))return{data:!1,error:a}}throw a}}getPublicUrl(e,t){const s=this._getFinalPath(e),a=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&a.push(o);const c=typeof t?.transform<"u"?"render/image":"object",u=this.transformOptsToQueryString(t?.transform||{});u!==""&&a.push(u);let h=a.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${s}${h}`)}}}async remove(e){var t=this;return t.handleOperation(async()=>await bm(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}))}async list(e,t,s){var a=this;return a.handleOperation(async()=>{const o=jt(jt(jt({},Gk),t),{},{prefix:e||""});return await Ns(a.fetch,`${a.url}/object/list/${a.bucketId}`,o,{headers:a.headers},s)})}async listV2(e,t){var s=this;return s.handleOperation(async()=>{const a=jt({},e);return await Ns(s.fetch,`${s.url}/object/list-v2/${s.bucketId}`,a,{headers:s.headers},t)})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const Wk="2.97.0",Tc={"X-Client-Info":`storage-js/${Wk}`};var Yk=class extends rl{constructor(e,t={},s,a){const o=new URL(e);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase."));const c=o.href.replace(/\/$/,""),u=jt(jt({},Tc),t);super(c,u,s,"storage")}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const s=t.listBucketOptionsToQueryString(e);return await gc(t.fetch,`${t.url}/bucket${s}`,{headers:t.headers})})}async getBucket(e){var t=this;return t.handleOperation(async()=>await gc(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}))}async createBucket(e,t={public:!1}){var s=this;return s.handleOperation(async()=>await Ns(s.fetch,`${s.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}))}async updateBucket(e,t){var s=this;return s.handleOperation(async()=>await qp(s.fetch,`${s.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:s.headers}))}async emptyBucket(e){var t=this;return t.handleOperation(async()=>await Ns(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await bm(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},Qk=class extends rl{constructor(e,t={},s){const a=e.replace(/\/$/,""),o=jt(jt({},Tc),t);super(a,o,s,"storage")}async createBucket(e){var t=this;return t.handleOperation(async()=>await Ns(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}))}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const s=new URLSearchParams;e?.limit!==void 0&&s.set("limit",e.limit.toString()),e?.offset!==void 0&&s.set("offset",e.offset.toString()),e?.sortColumn&&s.set("sortColumn",e.sortColumn),e?.sortOrder&&s.set("sortOrder",e.sortOrder),e?.search&&s.set("search",e.search);const a=s.toString(),o=a?`${t.url}/bucket?${a}`:`${t.url}/bucket`;return await gc(t.fetch,o,{headers:t.headers})})}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await bm(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}from(e){var t=this;if(!Ik(e))throw new Ud("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const s=new Dk({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(s,{get(o,c){const u=o[c];return typeof u!="function"?u:async(...h)=>{try{return{data:await u.apply(o,h),error:null}}catch(f){if(a)throw f;return{data:null,error:f}}}}})}},Jk=class extends rl{constructor(e,t={},s){const a=e.replace(/\/$/,""),o=jt(jt({},Tc),{},{"Content-Type":"application/json"},t);super(a,o,s,"vectors")}async createIndex(e){var t=this;return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{})}async getIndex(e,t){var s=this;return s.handleOperation(async()=>await ns.post(s.fetch,`${s.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:s.headers}))}async listIndexes(e){var t=this;return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}))}async deleteIndex(e,t){var s=this;return s.handleOperation(async()=>await ns.post(s.fetch,`${s.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:s.headers})||{})}},Xk=class extends rl{constructor(e,t={},s){const a=e.replace(/\/$/,""),o=jt(jt({},Tc),{},{"Content-Type":"application/json"},t);super(a,o,s,"vectors")}async putVectors(e){var t=this;if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{})}async getVectors(e){var t=this;return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}))}async listVectors(e){var t=this;if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}))}async queryVectors(e){var t=this;return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}))}async deleteVectors(e){var t=this;if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{})}},Zk=class extends rl{constructor(e,t={},s){const a=e.replace(/\/$/,""),o=jt(jt({},Tc),{},{"Content-Type":"application/json"},t);super(a,o,s,"vectors")}async createBucket(e){var t=this;return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}async getBucket(e){var t=this;return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}))}async listBuckets(e={}){var t=this;return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await ns.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}},eE=class extends Zk{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new tE(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,s=this;return t().call(s,e)}async getBucket(e){var t=()=>super.getBucket,s=this;return t().call(s,e)}async listBuckets(e={}){var t=()=>super.listBuckets,s=this;return t().call(s,e)}async deleteBucket(e){var t=()=>super.deleteBucket,s=this;return t().call(s,e)}},tE=class extends Jk{constructor(e,t,s,a){super(e,t,a),this.vectorBucketName=s}async createIndex(e){var t=()=>super.createIndex,s=this;return t().call(s,jt(jt({},e),{},{vectorBucketName:s.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,s=this;return t().call(s,jt(jt({},e),{},{vectorBucketName:s.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,s=this;return t().call(s,s.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,s=this;return t().call(s,s.vectorBucketName,e)}index(e){return new nE(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},nE=class extends Xk{constructor(e,t,s,a,o){super(e,t,o),this.vectorBucketName=s,this.indexName=a}async putVectors(e){var t=()=>super.putVectors,s=this;return t().call(s,jt(jt({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async getVectors(e){var t=()=>super.getVectors,s=this;return t().call(s,jt(jt({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,s=this;return t().call(s,jt(jt({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,s=this;return t().call(s,jt(jt({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,s=this;return t().call(s,jt(jt({},e),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}},rE=class extends Yk{constructor(e,t={},s,a){super(e,t,s,a)}from(e){return new Kk(this.url,this.headers,e,this.fetch)}get vectors(){return new eE(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Qk(this.url+"/iceberg",this.headers,this.fetch)}};const t_="2.97.0",zo=30*1e3,Fp=3,Zf=Fp*zo,sE="http://localhost:9999",iE="supabase.auth.token",aE={"X-Client-Info":`gotrue-js/${t_}`},Vp="X-Supabase-Api-Version",n_={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},oE=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,lE=600*1e3;class yc extends Error{constructor(t,s,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=a}}function xt(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class cE extends yc{constructor(t,s,a){super(t,s,a),this.name="AuthApiError",this.status=s,this.code=a}}function uE(e){return xt(e)&&e.name==="AuthApiError"}class Da extends yc{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class _i extends yc{constructor(t,s,a,o){super(t,a,o),this.name=s,this.status=a}}class es extends _i{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function ep(e){return xt(e)&&e.name==="AuthSessionMissingError"}class wo extends _i{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qu extends _i{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Fu extends _i{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function dE(e){return xt(e)&&e.name==="AuthImplicitGrantRedirectError"}class G0 extends _i{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class hE extends _i{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Hp extends _i{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function tp(e){return xt(e)&&e.name==="AuthRetryableFetchError"}class K0 extends _i{constructor(t,s,a){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=a}}class Gp extends _i{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const yd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),W0=` 	
\r=`.split(""),fE=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<W0.length;t+=1)e[W0[t].charCodeAt(0)]=-2;for(let t=0;t<yd.length;t+=1)e[yd[t].charCodeAt(0)]=t;return e})();function Y0(e,t,s){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;s(yd[a]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;s(yd[a]),t.queuedBits-=6}}function r_(e,t,s){const a=fE[e];if(a>-1)for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function Q0(e){const t=[],s=u=>{t.push(String.fromCodePoint(u))},a={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},c=u=>{gE(u,a,s)};for(let u=0;u<e.length;u+=1)r_(e.charCodeAt(u),o,c);return t.join("")}function pE(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function mE(e,t){for(let s=0;s<e.length;s+=1){let a=e.charCodeAt(s);if(a>55295&&a<=56319){const o=(a-55296)*1024&65535;a=(e.charCodeAt(s+1)-56320&65535|o)+65536,s+=1}pE(a,t)}}function gE(e,t,s){if(t.utf8seq===0){if(e<=127){s(e);return}for(let a=1;a<6;a+=1)if((e>>7-a&1)===0){t.utf8seq=a;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function qo(e){const t=[],s={queue:0,queuedBits:0},a=o=>{t.push(o)};for(let o=0;o<e.length;o+=1)r_(e.charCodeAt(o),s,a);return new Uint8Array(t)}function yE(e){const t=[];return mE(e,s=>t.push(s)),new Uint8Array(t)}function Ia(e){const t=[],s={queue:0,queuedBits:0},a=o=>{t.push(o)};return e.forEach(o=>Y0(o,s,a)),Y0(null,s,a),t.join("")}function vE(e){return Math.round(Date.now()/1e3)+e}function xE(){return Symbol("auth-callback")}const kr=()=>typeof window<"u"&&typeof document<"u",ja={tested:!1,writable:!1},s_=()=>{if(!kr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ja.tested)return ja.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ja.tested=!0,ja.writable=!0}catch{ja.tested=!0,ja.writable=!1}return ja.writable};function bE(e){const t={},s=new URL(e);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((o,c)=>{t[c]=o})}catch{}return s.searchParams.forEach((a,o)=>{t[o]=a}),t}const i_=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),_E=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Io=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},Ca=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},jr=async(e,t)=>{await e.removeItem(t)};class Pd{constructor(){this.promise=new Pd.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}Pd.promiseConstructor=Promise;function Vu(e){const t=e.split(".");if(t.length!==3)throw new Gp("Invalid JWT structure");for(let a=0;a<t.length;a++)if(!oE.test(t[a]))throw new Gp("JWT not in base64url format");return{header:JSON.parse(Q0(t[0])),payload:JSON.parse(Q0(t[1])),signature:qo(t[2]),raw:{header:t[0],payload:t[1]}}}async function wE(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function SE(e,t){return new Promise((a,o)=>{(async()=>{for(let c=0;c<1/0;c++)try{const u=await e(c);if(!t(c,null,u)){a(u);return}}catch(u){if(!t(c,u)){o(u);return}}})()})}function jE(e){return("0"+e.toString(16)).substr(-2)}function CE(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=s.length;let o="";for(let c=0;c<56;c++)o+=s.charAt(Math.floor(Math.random()*a));return o}return crypto.getRandomValues(t),Array.from(t,jE).join("")}async function kE(e){const s=new TextEncoder().encode(e),a=await crypto.subtle.digest("SHA-256",s),o=new Uint8Array(a);return Array.from(o).map(c=>String.fromCharCode(c)).join("")}async function EE(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const s=await kE(e);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function So(e,t,s=!1){const a=CE();let o=a;s&&(o+="/PASSWORD_RECOVERY"),await Io(e,`${t}-code-verifier`,o);const c=await EE(a);return[c,a===c?"plain":"s256"]}const NE=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function AE(e){const t=e.headers.get(Vp);if(!t||!t.match(NE))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function TE(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function RE(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const OE=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function jo(e){if(!OE.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function np(){const e={};return new Proxy(e,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const a=s.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function DE(e,t){return new Proxy(e,{get:(s,a,o)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const c=a.toString();if(c==="Symbol(Symbol.toPrimitive)"||c==="Symbol(Symbol.toStringTag)"||c==="Symbol(util.inspect.custom)"||c==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(s,a,o)}return!t.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(s,a,o)}})}function J0(e){return JSON.parse(JSON.stringify(e))}const Ra=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),LE=[502,503,504];async function X0(e){var t;if(!_E(e))throw new Hp(Ra(e),0);if(LE.includes(e.status))throw new Hp(Ra(e),e.status);let s;try{s=await e.json()}catch(c){throw new Da(Ra(c),c)}let a;const o=AE(e);if(o&&o.getTime()>=n_["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?a=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(a=s.error_code),a){if(a==="weak_password")throw new K0(Ra(s),e.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new es}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((c,u)=>c&&typeof u=="string",!0))throw new K0(Ra(s),e.status,s.weak_password.reasons);throw new cE(Ra(s),e.status||500,a)}const zE=(e,t,s,a)=>{const o={method:e,headers:t?.headers||{}};return e==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(a),Object.assign(Object.assign({},o),s))};async function kt(e,t,s,a){var o;const c=Object.assign({},a?.headers);c[Vp]||(c[Vp]=n_["2024-01-01"].name),a?.jwt&&(c.Authorization=`Bearer ${a.jwt}`);const u=(o=a?.query)!==null&&o!==void 0?o:{};a?.redirectTo&&(u.redirect_to=a.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",f=await IE(e,t,s+h,{headers:c,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(f):{data:Object.assign({},f),error:null}}async function IE(e,t,s,a,o,c){const u=zE(t,a,o,c);let h;try{h=await e(s,Object.assign({},u))}catch(f){throw console.error(f),new Hp(Ra(f),0)}if(h.ok||await X0(h),a?.noResolveJson)return h;try{return await h.json()}catch(f){await X0(f)}}function Cs(e){var t;let s=null;BE(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=vE(e.expires_in)));const a=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:s,user:a},error:null}}function Z0(e){const t=Cs(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0)&&(t.data.weak_password=e.weak_password),t}function ea(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function ME(e){return{data:e,error:null}}function UE(e){const{action_link:t,email_otp:s,hashed_token:a,redirect_to:o,verification_type:c}=e,u=Md(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:t,email_otp:s,hashed_token:a,redirect_to:o,verification_type:c},f=Object.assign({},u);return{data:{properties:h,user:f},error:null}}function ex(e){return e}function BE(e){return e.access_token&&e.refresh_token&&e.expires_in}const rp=["global","local","others"];class PE{constructor({url:t="",headers:s={},fetch:a}){this.url=t,this.headers=s,this.fetch=i_(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,s=rp[0]){if(rp.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${rp.join(", ")}`);try{return await kt(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(xt(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,s={}){try{return await kt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:ea})}catch(a){if(xt(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:s}=t,a=Md(t,["options"]),o=Object.assign(Object.assign({},a),s);return"newEmail"in a&&(o.new_email=a?.newEmail,delete o.newEmail),await kt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:UE,redirectTo:s?.redirectTo})}catch(s){if(xt(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await kt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:ea})}catch(s){if(xt(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,a,o,c,u,h,f;try{const p={nextPage:null,lastPage:0,total:0},m=await kt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(c=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&c!==void 0?c:""},xform:ex});if(m.error)throw m.error;const g=await m.json(),x=(u=m.headers.get("x-total-count"))!==null&&u!==void 0?u:0,v=(f=(h=m.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return v.length>0&&(v.forEach(S=>{const w=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(S.split(";")[1].split("=")[1]);p[`${_}Page`]=w}),p.total=parseInt(x)),{data:Object.assign(Object.assign({},g),p),error:null}}catch(p){if(xt(p))return{data:{users:[]},error:p};throw p}}async getUserById(t){jo(t);try{return await kt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:ea})}catch(s){if(xt(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){jo(t);try{return await kt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:ea})}catch(a){if(xt(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,s=!1){jo(t);try{return await kt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:ea})}catch(a){if(xt(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){jo(t.userId);try{const{data:s,error:a}=await kt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:s,error:a}}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _deleteFactor(t){jo(t.userId),jo(t.id);try{return{data:await kt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _listOAuthClients(t){var s,a,o,c,u,h,f;try{const p={nextPage:null,lastPage:0,total:0},m=await kt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(c=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&c!==void 0?c:""},xform:ex});if(m.error)throw m.error;const g=await m.json(),x=(u=m.headers.get("x-total-count"))!==null&&u!==void 0?u:0,v=(f=(h=m.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return v.length>0&&(v.forEach(S=>{const w=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(S.split(";")[1].split("=")[1]);p[`${_}Page`]=w}),p.total=parseInt(x)),{data:Object.assign(Object.assign({},g),p),error:null}}catch(p){if(xt(p))return{data:{clients:[]},error:p};throw p}}async _createOAuthClient(t){try{return await kt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _getOAuthClient(t){try{return await kt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _updateOAuthClient(t,s){try{return await kt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:s,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(xt(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(t){try{return await kt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _regenerateOAuthClientSecret(t){try{return await kt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(xt(s))return{data:null,error:s};throw s}}}function tx(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Co={debug:!!(globalThis&&s_()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class a_ extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class nx extends a_{}async function $E(e,t,s){Co.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const a=new globalThis.AbortController;t>0&&setTimeout(()=>{a.abort(),Co.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve();try{return await globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async o=>{if(o){Co.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,o.name);try{return await s()}finally{Co.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,o.name)}}else{if(t===0)throw Co.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new nx(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Co.debug)try{const c=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(c,null,"  "))}catch(c){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",c)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}})}catch(o){throw o?.name==="AbortError"?new nx(`Acquiring an exclusive Navigator LockManager lock "${e}" timed out waiting ${t}ms`):o}}function qE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function o_(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function FE(e){return parseInt(e,16)}function VE(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,a=>a.toString(16).padStart(2,"0")).join("")}function HE(e){var t;const{chainId:s,domain:a,expirationTime:o,issuedAt:c=new Date,nonce:u,notBefore:h,requestId:f,resources:p,scheme:m,uri:g,version:x}=e;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(u&&u.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${u}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const v=o_(e.address),S=m?`${m}://${a}`:a,w=e.statement?`${e.statement}
`:"",_=`${S} wants you to sign in with your Ethereum account:
${v}

${w}`;let j=`URI: ${g}
Version: ${x}
Chain ID: ${s}${u?`
Nonce: ${u}`:""}
Issued At: ${c.toISOString()}`;if(o&&(j+=`
Expiration Time: ${o.toISOString()}`),h&&(j+=`
Not Before: ${h.toISOString()}`),f&&(j+=`
Request ID: ${f}`),p){let E=`
Resources:`;for(const T of p){if(!T||typeof T!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${T}`);E+=`
- ${T}`}j+=E}return`${_}
${j}`}class lr extends Error{constructor({message:t,code:s,cause:a,name:o}){var c;super(t,{cause:a}),this.__isWebAuthnError=!0,this.name=(c=o??(a instanceof Error?a.name:void 0))!==null&&c!==void 0?c:"Unknown Error",this.code=s}}class vd extends lr{constructor(t,s){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s,message:t}),this.name="WebAuthnUnknownError",this.originalError=s}}function GE({error:e,options:t}){var s,a,o;const{publicKey:c}=t;if(!c)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new lr({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((s=c.authenticatorSelection)===null||s===void 0?void 0:s.requireResidentKey)===!0)return new lr({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((a=c.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new lr({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((o=c.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new lr({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new lr({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new lr({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return c.pubKeyCredParams.filter(h=>h.type==="public-key").length===0?new lr({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new lr({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const u=window.location.hostname;if(l_(u)){if(c.rp.id!==u)return new lr({message:`The RP ID "${c.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new lr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(c.user.id.byteLength<1||c.user.id.byteLength>64)return new lr({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new lr({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new lr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function KE({error:e,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new lr({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new lr({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(l_(a)){if(s.rpId!==a)return new lr({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new lr({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new lr({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new lr({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class WE{createNewAbortSignal(){if(this.controller){const s=new Error("Cancelling existing WebAuthn API call for new one");s.name="AbortError",this.controller.abort(s)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const YE=new WE;function QE(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:s,excludeCredentials:a}=e,o=Md(e,["challenge","user","excludeCredentials"]),c=qo(t).buffer,u=Object.assign(Object.assign({},s),{id:qo(s.id).buffer}),h=Object.assign(Object.assign({},o),{challenge:c,user:u});if(a&&a.length>0){h.excludeCredentials=new Array(a.length);for(let f=0;f<a.length;f++){const p=a[f];h.excludeCredentials[f]=Object.assign(Object.assign({},p),{id:qo(p.id).buffer,type:p.type||"public-key",transports:p.transports})}}return h}function JE(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:s}=e,a=Md(e,["challenge","allowCredentials"]),o=qo(t).buffer,c=Object.assign(Object.assign({},a),{challenge:o});if(s&&s.length>0){c.allowCredentials=new Array(s.length);for(let u=0;u<s.length;u++){const h=s[u];c.allowCredentials[u]=Object.assign(Object.assign({},h),{id:qo(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return c}function XE(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const s=e;return{id:e.id,rawId:e.id,response:{attestationObject:Ia(new Uint8Array(e.response.attestationObject)),clientDataJSON:Ia(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function ZE(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const s=e,a=e.getClientExtensionResults(),o=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Ia(new Uint8Array(o.authenticatorData)),clientDataJSON:Ia(new Uint8Array(o.clientDataJSON)),signature:Ia(new Uint8Array(o.signature)),userHandle:o.userHandle?Ia(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(t=s.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function l_(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function rx(){var e,t;return!!(kr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function eN(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new vd("Browser returned unexpected credential type",t)}:{data:null,error:new vd("Empty credential response",t)}}catch(t){return{data:null,error:GE({error:t,options:e})}}}async function tN(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new vd("Browser returned unexpected credential type",t)}:{data:null,error:new vd("Empty credential response",t)}}catch(t){return{data:null,error:KE({error:t,options:e})}}}const nN={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},rN={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function xd(...e){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),s=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),a={};for(const o of e)if(o)for(const c in o){const u=o[c];if(u!==void 0)if(Array.isArray(u))a[c]=u;else if(s(u))a[c]=u;else if(t(u)){const h=a[c];t(h)?a[c]=xd(h,u):a[c]=xd(u)}else a[c]=u}return a}function sN(e,t){return xd(nN,e,t||{})}function iN(e,t){return xd(rN,e,t||{})}class aN{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:s,friendlyName:a,signal:o},c){var u;try{const{data:h,error:f}=await this.client.mfa.challenge({factorId:t,webauthn:s});if(!h)return{data:null,error:f};const p=o??YE.createNewAbortSignal();if(h.webauthn.type==="create"){const{user:m}=h.webauthn.credential_options.publicKey;if(!m.name){const g=a;if(g)m.name=`${m.id}:${g}`;else{const v=(await this.client.getUser()).data.user,S=((u=v?.user_metadata)===null||u===void 0?void 0:u.name)||v?.email||v?.id||"User";m.name=`${m.id}:${S}`}}m.displayName||(m.displayName=m.name)}switch(h.webauthn.type){case"create":{const m=sN(h.webauthn.credential_options.publicKey,c?.create),{data:g,error:x}=await eN({publicKey:m,signal:p});return g?{data:{factorId:t,challengeId:h.id,webauthn:{type:h.webauthn.type,credential_response:g}},error:null}:{data:null,error:x}}case"request":{const m=iN(h.webauthn.credential_options.publicKey,c?.request),{data:g,error:x}=await tN(Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:m,signal:p}));return g?{data:{factorId:t,challengeId:h.id,webauthn:{type:h.webauthn.type,credential_response:g}},error:null}:{data:null,error:x}}}}catch(h){return xt(h)?{data:null,error:h}:{data:null,error:new Da("Unexpected error in challenge",h)}}}async _verify({challengeId:t,factorId:s,webauthn:a}){return this.client.mfa.verify({factorId:s,challengeId:t,webauthn:a})}async _authenticate({factorId:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},c){if(!s)return{data:null,error:new yc("rpId is required for WebAuthn authentication")};try{if(!rx())return{data:null,error:new Da("Browser does not support WebAuthn",null)};const{data:u,error:h}=await this.challenge({factorId:t,webauthn:{rpId:s,rpOrigins:a},signal:o},{request:c});if(!u)return{data:null,error:h};const{webauthn:f}=u;return this._verify({factorId:t,challengeId:u.challengeId,webauthn:{type:f.type,rpId:s,rpOrigins:a,credential_response:f.credential_response}})}catch(u){return xt(u)?{data:null,error:u}:{data:null,error:new Da("Unexpected error in authenticate",u)}}}async _register({friendlyName:t,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},c){if(!s)return{data:null,error:new yc("rpId is required for WebAuthn registration")};try{if(!rx())return{data:null,error:new Da("Browser does not support WebAuthn",null)};const{data:u,error:h}=await this._enroll({friendlyName:t});if(!u)return await this.client.mfa.listFactors().then(m=>{var g;return(g=m.data)===null||g===void 0?void 0:g.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(m=>m?this.client.mfa.unenroll({factorId:m?.id}):void 0),{data:null,error:h};const{data:f,error:p}=await this._challenge({factorId:u.id,friendlyName:u.friendly_name,webauthn:{rpId:s,rpOrigins:a},signal:o},{create:c});return f?this._verify({factorId:u.id,challengeId:f.challengeId,webauthn:{rpId:s,rpOrigins:a,type:f.webauthn.type,credential_response:f.webauthn.credential_response}}):{data:null,error:p}}catch(u){return xt(u)?{data:null,error:u}:{data:null,error:new Da("Unexpected error in register",u)}}}}qE();const oN={url:sE,storageKey:iE,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:aE,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function sx(e,t,s){return await s()}const ko={};class vc{get jwks(){var t,s;return(s=(t=ko[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){ko[this.storageKey]=Object.assign(Object.assign({},ko[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=ko[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){ko[this.storageKey]=Object.assign(Object.assign({},ko[this.storageKey]),{cachedAt:t})}constructor(t){var s,a,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const c=Object.assign(Object.assign({},oN),t);if(this.storageKey=c.storageKey,this.instanceID=(s=vc.nextInstanceID[this.storageKey])!==null&&s!==void 0?s:0,vc.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!c.debug,typeof c.debug=="function"&&(this.logger=c.debug),this.instanceID>0&&kr()){const u=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(u),this.logDebugMessages&&console.trace(u)}if(this.persistSession=c.persistSession,this.autoRefreshToken=c.autoRefreshToken,this.admin=new PE({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=i_(c.fetch),this.lock=c.lock||sx,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,this.throwOnError=c.throwOnError,this.lockAcquireTimeout=c.lockAcquireTimeout,c.lock?this.lock=c.lock:this.persistSession&&kr()&&(!((a=globalThis?.navigator)===null||a===void 0)&&a.locks)?this.lock=$E:this.lock=sx,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new aN(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(c.storage?this.storage=c.storage:s_()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=tx(this.memoryStorage)),c.userStorage&&(this.userStorage=c.userStorage)):(this.memoryStorage={},this.storage=tx(this.memoryStorage)),kr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(u){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",u)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async u=>{this._debug("received broadcast notification from other tab or client",u);try{await this._notifyAllSubscribers(u.data.event,u.data.session,!1)}catch(h){this._debug("#broadcastChannel","error",h)}})}c.skipAutoInitialize||this.initialize().catch(u=>{this._debug("#initialize()","error",u)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${t_}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let s={},a="none";if(kr()&&(s=bE(window.location.href),this._isImplicitGrantCallback(s)?a="implicit":await this._isPKCECallback(s)&&(a="pkce")),kr()&&this.detectSessionInUrl&&a!=="none"){const{data:o,error:c}=await this._getSessionFromURL(s,a);if(c){if(this._debug("#_initialize()","error detecting session from URL",c),dE(c)){const f=(t=c.details)===null||t===void 0?void 0:t.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:c}}return{error:c}}const{session:u,redirectType:h}=o;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return xt(s)?this._returnResult({error:s}):this._returnResult({error:new Da("Unexpected error during initialization",s)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,a,o;try{const c=await kt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:Cs}),{data:u,error:h}=c;if(h||!u)return this._returnResult({data:{user:null,session:null},error:h});const f=u.session,p=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:p,session:f},error:null})}catch(c){if(xt(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signUp(t){var s,a,o;try{let c;if("email"in t){const{email:m,password:g,options:x}=t;let v=null,S=null;this.flowType==="pkce"&&([v,S]=await So(this.storage,this.storageKey)),c=await kt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:m,password:g,data:(s=x?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:v,code_challenge_method:S},xform:Cs})}else if("phone"in t){const{phone:m,password:g,options:x}=t;c=await kt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:g,data:(a=x?.data)!==null&&a!==void 0?a:{},channel:(o=x?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:Cs})}else throw new qu("You must provide either an email or phone number and a password");const{data:u,error:h}=c;if(h||!u)return await jr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:h});const f=u.session,p=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:p,session:f},error:null})}catch(c){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signInWithPassword(t){try{let s;if("email"in t){const{email:c,password:u,options:h}=t;s=await kt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:c,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Z0})}else if("phone"in t){const{phone:c,password:u,options:h}=t;s=await kt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:c,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Z0})}else throw new qu("You must provide either an email or phone number and a password");const{data:a,error:o}=s;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!a||!a.session||!a.user){const c=new wo;return this._returnResult({data:{user:null,session:null},error:c})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:o})}catch(s){if(xt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOAuth(t){var s,a,o,c;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(c=t.options)===null||c===void 0?void 0:c.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;switch(s){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(t){var s,a,o,c,u,h,f,p,m,g,x;let v,S;if("message"in t)v=t.message,S=t.signature;else{const{chain:w,wallet:_,statement:j,options:E}=t;let T;if(kr())if(typeof _=="object")T=_;else{const z=window;if("ethereum"in z&&typeof z.ethereum=="object"&&"request"in z.ethereum&&typeof z.ethereum.request=="function")T=z.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof _!="object"||!E?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=_}const R=new URL((s=E?.url)!==null&&s!==void 0?s:window.location.href),B=await T.request({method:"eth_requestAccounts"}).then(z=>z).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!B||B.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const F=o_(B[0]);let $=(a=E?.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!$){const z=await T.request({method:"eth_chainId"});$=FE(z)}const M={domain:R.host,address:F,statement:j,uri:R.href,version:"1",chainId:$,nonce:(o=E?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(u=(c=E?.signInWithEthereum)===null||c===void 0?void 0:c.issuedAt)!==null&&u!==void 0?u:new Date,expirationTime:(h=E?.signInWithEthereum)===null||h===void 0?void 0:h.expirationTime,notBefore:(f=E?.signInWithEthereum)===null||f===void 0?void 0:f.notBefore,requestId:(p=E?.signInWithEthereum)===null||p===void 0?void 0:p.requestId,resources:(m=E?.signInWithEthereum)===null||m===void 0?void 0:m.resources};v=HE(M),S=await T.request({method:"personal_sign",params:[VE(v),F]})}try{const{data:w,error:_}=await kt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:v,signature:S},!((g=t.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Cs});if(_)throw _;if(!w||!w.session||!w.user){const j=new wo;return this._returnResult({data:{user:null,session:null},error:j})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:_})}catch(w){if(xt(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithSolana(t){var s,a,o,c,u,h,f,p,m,g,x,v;let S,w;if("message"in t)S=t.message,w=t.signature;else{const{chain:_,wallet:j,statement:E,options:T}=t;let R;if(kr())if(typeof j=="object")R=j;else{const F=window;if("solana"in F&&typeof F.solana=="object"&&("signIn"in F.solana&&typeof F.solana.signIn=="function"||"signMessage"in F.solana&&typeof F.solana.signMessage=="function"))R=F.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!T?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");R=j}const B=new URL((s=T?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in R&&R.signIn){const F=await R.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},T?.signInWithSolana),{version:"1",domain:B.host,uri:B.href}),E?{statement:E}:null));let $;if(Array.isArray(F)&&F[0]&&typeof F[0]=="object")$=F[0];else if(F&&typeof F=="object"&&"signedMessage"in F&&"signature"in F)$=F;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in $&&"signature"in $&&(typeof $.signedMessage=="string"||$.signedMessage instanceof Uint8Array)&&$.signature instanceof Uint8Array)S=typeof $.signedMessage=="string"?$.signedMessage:new TextDecoder().decode($.signedMessage),w=$.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in R)||typeof R.signMessage!="function"||!("publicKey"in R)||typeof R!="object"||!R.publicKey||!("toBase58"in R.publicKey)||typeof R.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");S=[`${B.host} wants you to sign in with your Solana account:`,R.publicKey.toBase58(),...E?["",E,""]:[""],"Version: 1",`URI: ${B.href}`,`Issued At: ${(o=(a=T?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((c=T?.signInWithSolana)===null||c===void 0)&&c.notBefore?[`Not Before: ${T.signInWithSolana.notBefore}`]:[],...!((u=T?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${T.signInWithSolana.expirationTime}`]:[],...!((h=T?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${T.signInWithSolana.chainId}`]:[],...!((f=T?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${T.signInWithSolana.nonce}`]:[],...!((p=T?.signInWithSolana)===null||p===void 0)&&p.requestId?[`Request ID: ${T.signInWithSolana.requestId}`]:[],...!((g=(m=T?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||g===void 0)&&g.length?["Resources",...T.signInWithSolana.resources.map($=>`- ${$}`)]:[]].join(`
`);const F=await R.signMessage(new TextEncoder().encode(S),"utf8");if(!F||!(F instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");w=F}}try{const{data:_,error:j}=await kt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:S,signature:Ia(w)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(v=t.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:Cs});if(j)throw j;if(!_||!_.session||!_.user){const E=new wo;return this._returnResult({data:{user:null,session:null},error:E})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign({},_),error:j})}catch(_){if(xt(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async _exchangeCodeForSession(t){const s=await Ca(this.storage,`${this.storageKey}-code-verifier`),[a,o]=(s??"").split("/");try{if(!a&&this.flowType==="pkce")throw new hE;const{data:c,error:u}=await kt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:Cs});if(await jr(this.storage,`${this.storageKey}-code-verifier`),u)throw u;if(!c||!c.session||!c.user){const h=new wo;return this._returnResult({data:{user:null,session:null,redirectType:null},error:h})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:Object.assign(Object.assign({},c),{redirectType:o??null}),error:u})}catch(c){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(c))return this._returnResult({data:{user:null,session:null,redirectType:null},error:c});throw c}}async signInWithIdToken(t){try{const{options:s,provider:a,token:o,access_token:c,nonce:u}=t,h=await kt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:o,access_token:c,nonce:u,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Cs}),{data:f,error:p}=h;if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!f||!f.session||!f.user){const m=new wo;return this._returnResult({data:{user:null,session:null},error:m})}return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),this._returnResult({data:f,error:p})}catch(s){if(xt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOtp(t){var s,a,o,c,u;try{if("email"in t){const{email:h,options:f}=t;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await So(this.storage,this.storageKey));const{error:g}=await kt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(a=f?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:m},redirectTo:f?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}if("phone"in t){const{phone:h,options:f}=t,{data:p,error:m}=await kt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(o=f?.data)!==null&&o!==void 0?o:{},create_user:(c=f?.shouldCreateUser)!==null&&c!==void 0?c:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(u=f?.channel)!==null&&u!==void 0?u:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:p?.message_id},error:m})}throw new qu("You must provide either an email or phone number.")}catch(h){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async verifyOtp(t){var s,a;try{let o,c;"options"in t&&(o=(s=t.options)===null||s===void 0?void 0:s.redirectTo,c=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:u,error:h}=await kt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:c}}),redirectTo:o,xform:Cs});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const f=u.session,p=u.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),this._returnResult({data:{user:p,session:f},error:null})}catch(o){if(xt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var s,a,o,c,u;try{let h=null,f=null;this.flowType==="pkce"&&([h,f]=await So(this.storage,this.storageKey));const p=await kt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&a!==void 0?a:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:f}),headers:this.headers,xform:ME});return!((c=p.data)===null||c===void 0)&&c.url&&kr()&&!(!((u=t.options)===null||u===void 0)&&u.skipBrowserRedirect)&&window.location.assign(p.data.url),this._returnResult(p)}catch(h){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(h))return this._returnResult({data:null,error:h});throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:a}=t;if(a)throw a;if(!s)throw new es;const{error:o}=await kt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(xt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:a,type:o,options:c}=t,{error:u}=await kt(this.fetch,"POST",s,{headers:this.headers,body:{email:a,type:o,gotrue_meta_security:{captcha_token:c?.captchaToken}},redirectTo:c?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}else if("phone"in t){const{phone:a,type:o,options:c}=t,{data:u,error:h}=await kt(this.fetch,"POST",s,{headers:this.headers,body:{phone:a,type:o,gotrue_meta_security:{captcha_token:c?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:u?.message_id},error:h})}throw new qu("You must provide either an email or phone number and a type")}catch(s){if(xt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await a,await s()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=s();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Ca(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at*1e3-Date.now()<Zf:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.userStorage){const u=await Ca(this.userStorage,this.storageKey+"-user");u?.user?t.user=u.user:t.user=np()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const u={value:this.suppressGetSessionWarning};t.user=DE(t.user,u),u.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:c}=await this._callRefreshToken(t.refresh_token);return c?this._returnResult({data:{session:null},error:c}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const s=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return s.data.user&&(this.suppressGetSessionWarning=!0),s}async _getUser(t){try{return t?await kt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:ea}):await this._useSession(async s=>{var a,o,c;const{data:u,error:h}=s;if(h)throw h;return!(!((a=u.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new es}:await kt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(c=(o=u.session)===null||o===void 0?void 0:o.access_token)!==null&&c!==void 0?c:void 0,xform:ea})})}catch(s){if(xt(s))return ep(s)&&(await this._removeSession(),await jr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:s});throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async a=>{const{data:o,error:c}=a;if(c)throw c;if(!o.session)throw new es;const u=o.session;let h=null,f=null;this.flowType==="pkce"&&t.email!=null&&([h,f]=await So(this.storage,this.storageKey));const{data:p,error:m}=await kt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:h,code_challenge_method:f}),jwt:u.access_token,xform:ea});if(m)throw m;return u.user=p.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),this._returnResult({data:{user:u.user},error:null})})}catch(a){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new es;const s=Date.now()/1e3;let a=s,o=!0,c=null;const{payload:u}=Vu(t.access_token);if(u.exp&&(a=u.exp,o=a<=s),o){const{data:h,error:f}=await this._callRefreshToken(t.refresh_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!h)return{data:{user:null,session:null},error:null};c=h}else{const{data:h,error:f}=await this._getUser(t.access_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});c={access_token:t.access_token,refresh_token:t.refresh_token,user:h.user,token_type:"bearer",expires_in:a-s,expires_at:a},await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)}return this._returnResult({data:{user:c.user,session:c},error:null})}catch(s){if(xt(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var a;if(!t){const{data:u,error:h}=s;if(h)throw h;t=(a=u.session)!==null&&a!==void 0?a:void 0}if(!t?.refresh_token)throw new es;const{data:o,error:c}=await this._callRefreshToken(t.refresh_token);return c?this._returnResult({data:{user:null,session:null},error:c}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(s){if(xt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async _getSessionFromURL(t,s){try{if(!kr())throw new Fu("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Fu(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new G0("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Fu("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new G0("No code detected.");const{data:E,error:T}=await this._exchangeCodeForSession(t.code);if(T)throw T;const R=new URL(window.location.href);return R.searchParams.delete("code"),window.history.replaceState(window.history.state,"",R.toString()),{data:{session:E.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:o,access_token:c,refresh_token:u,expires_in:h,expires_at:f,token_type:p}=t;if(!c||!h||!u||!p)throw new Fu("No session defined in URL");const m=Math.round(Date.now()/1e3),g=parseInt(h);let x=m+g;f&&(x=parseInt(f));const v=x-m;v*1e3<=zo&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${v}s, should have been closer to ${g}s`);const S=x-g;m-S>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",S,x,m):m-S<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",S,x,m);const{data:w,error:_}=await this._getUser(c);if(_)throw _;const j={provider_token:a,provider_refresh_token:o,access_token:c,expires_in:g,expires_at:x,refresh_token:u,token_type:p,user:w.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:j,redirectType:t.type},error:null})}catch(a){if(xt(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Ca(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var a;const{data:o,error:c}=s;if(c&&!ep(c))return this._returnResult({error:c});const u=(a=o.session)===null||a===void 0?void 0:a.access_token;if(u){const{error:h}=await this.admin.signOut(u,t);if(h&&!(uE(h)&&(h.status===404||h.status===401||h.status===403)||ep(h)))return this._returnResult({error:h})}return t!=="others"&&(await this._removeSession(),await jr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const s=xE(),a={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,a),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async s=>{var a,o;try{const{data:{session:c},error:u}=s;if(u)throw u;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",c)),this._debug("INITIAL_SESSION","callback id",t,"session",c)}catch(c){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",c),console.error(c)}})}async resetPasswordForEmail(t,s={}){let a=null,o=null;this.flowType==="pkce"&&([a,o]=await So(this.storage,this.storageKey,!0));try{return await kt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:o,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(c){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(c))return this._returnResult({data:null,error:c});throw c}}async getUserIdentities(){var t;try{const{data:s,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var s;try{const{data:a,error:o}=await this._useSession(async c=>{var u,h,f,p,m;const{data:g,error:x}=c;if(x)throw x;const v=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(u=t.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=t.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=t.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await kt(this.fetch,"GET",v,{headers:this.headers,jwt:(m=(p=g.session)===null||p===void 0?void 0:p.access_token)!==null&&m!==void 0?m:void 0})});if(o)throw o;return kr()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(a?.url),this._returnResult({data:{provider:t.provider,url:a?.url},error:null})}catch(a){if(xt(a))return this._returnResult({data:{provider:t.provider,url:null},error:a});throw a}}async linkIdentityIdToken(t){return await this._useSession(async s=>{var a;try{const{error:o,data:{session:c}}=s;if(o)throw o;const{options:u,provider:h,token:f,access_token:p,nonce:m}=t,g=await kt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=c?.access_token)!==null&&a!==void 0?a:void 0,body:{provider:h,id_token:f,access_token:p,nonce:m,link_identity:!0,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Cs}),{data:x,error:v}=g;return v?this._returnResult({data:{user:null,session:null},error:v}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new wo}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:v}))}catch(o){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async s=>{var a,o;const{data:c,error:u}=s;if(u)throw u;return await kt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(a=c.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0})})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const a=Date.now();return await SE(async o=>(o>0&&await wE(200*Math.pow(2,o-1)),this._debug(s,"refreshing attempt",o),await kt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Cs})),(o,c)=>{const u=200*Math.pow(2,o);return c&&tp(c)&&Date.now()+u-a<zo})}catch(a){if(this._debug(s,"error",a),xt(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",a),kr()&&!s.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t,s;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const o=await Ca(this.storage,this.storageKey);if(o&&this.userStorage){let u=await Ca(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:o.user},await Io(this.userStorage,this.storageKey+"-user",u)),o.user=(t=u?.user)!==null&&t!==void 0?t:np()}else if(o&&!o.user&&!o.user){const u=await Ca(this.storage,this.storageKey+"-user");u&&u?.user?(o.user=u.user,await jr(this.storage,this.storageKey+"-user"),await Io(this.storage,this.storageKey,o)):o.user=np()}if(this._debug(a,"session from storage",o),!this._isValidSession(o)){this._debug(a,"session is not valid"),o!==null&&await this._removeSession();return}const c=((s=o.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Zf;if(this._debug(a,`session has${c?"":" not"} expired with margin of ${Zf}s`),c){if(this.autoRefreshToken&&o.refresh_token){const{error:u}=await this._callRefreshToken(o.refresh_token);u&&(console.error(u),tp(u)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(o.access_token);!h&&u?.user?(o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(a,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(a,"error",o),console.error(o);return}finally{this._debug(a,"end")}}async _callRefreshToken(t){var s,a;if(!t)throw new es;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Pd;const{data:c,error:u}=await this._refreshAccessToken(t);if(u)throw u;if(!c.session)throw new es;await this._saveSession(c.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",c.session);const h={data:c.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(c){if(this._debug(o,"error",c),xt(c)){const u={data:null,error:c};return tp(c)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(u),u}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(c),c}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,s,a=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",s,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:s});const c=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(t,s)}catch(f){c.push(f)}});if(await Promise.all(u),c.length>0){for(let h=0;h<c.length;h+=1)console.error(c[h]);throw c[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await jr(this.storage,`${this.storageKey}-code-verifier`);const s=Object.assign({},t),a=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&s.user&&await Io(this.userStorage,this.storageKey+"-user",{user:s.user});const o=Object.assign({},s);delete o.user;const c=J0(o);await Io(this.storage,this.storageKey,c)}else{const o=J0(s);await Io(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await jr(this.storage,this.storageKey),await jr(this.storage,this.storageKey+"-code-verifier"),await jr(this.storage,this.storageKey+"-user"),this.userStorage&&await jr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&kr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),zo);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const s=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=s,s&&typeof s=="object"&&typeof s.unref=="function"?s.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(s)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const s=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,s&&clearTimeout(s)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:a}}=s;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((a.expires_at*1e3-t)/zo);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${zo}ms, refresh threshold is ${Fp} ticks`),o<=Fp&&await this._callRefreshToken(a.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof a_)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!kr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(t){this._debug("#visibilityChangedCallback","error",t)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,a){const o=[`provider=${encodeURIComponent(s)}`];if(a?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&o.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[c,u]=await So(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(c)}`,code_challenge_method:`${encodeURIComponent(u)}`});o.push(h.toString())}if(a?.queryParams){const c=new URLSearchParams(a.queryParams);o.push(c.toString())}return a?.skipBrowserRedirect&&o.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var a;const{data:o,error:c}=s;return c?this._returnResult({data:null,error:c}):await kt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token})})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async _enroll(t){try{return await this._useSession(async s=>{var a,o;const{data:c,error:u}=s;if(u)return this._returnResult({data:null,error:u});const h=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:f,error:p}=await kt(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(a=c?.session)===null||a===void 0?void 0:a.access_token});return p?this._returnResult({data:null,error:p}):(t.factorType==="totp"&&f.type==="totp"&&(!((o=f?.totp)===null||o===void 0)&&o.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),this._returnResult({data:f,error:null}))})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async s=>{var a;const{data:o,error:c}=s;if(c)return this._returnResult({data:null,error:c});const u=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?XE(t.webauthn.credential_response):ZE(t.webauthn.credential_response)})}:{code:t.code}),{data:h,error:f}=await kt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:u,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});return f?this._returnResult({data:null,error:f}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+h.expires_in},h)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",h),this._returnResult({data:h,error:f}))})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async s=>{var a;const{data:o,error:c}=s;if(c)return this._returnResult({data:null,error:c});const u=await kt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});if(u.error)return u;const{data:h}=u;if(h.type!=="webauthn")return{data:h,error:null};switch(h.webauthn.type){case"create":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:QE(h.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:JE(h.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}})}async _challengeAndVerify(t){const{data:s,error:a}=await this._challenge({factorId:t.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){var t;const{data:{user:s},error:a}=await this.getUser();if(a)return{data:null,error:a};const o={all:[],phone:[],totp:[],webauthn:[]};for(const c of(t=s?.factors)!==null&&t!==void 0?t:[])o.all.push(c),c.status==="verified"&&o[c.factor_type].push(c);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(t){var s,a,o,c;if(t)try{const{payload:v}=Vu(t);let S=null;v.aal&&(S=v.aal);let w=S;const{data:{user:_},error:j}=await this.getUser(t);if(j)return this._returnResult({data:null,error:j});((a=(s=_?.factors)===null||s===void 0?void 0:s.filter(R=>R.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(w="aal2");const T=v.amr||[];return{data:{currentLevel:S,nextLevel:w,currentAuthenticationMethods:T},error:null}}catch(v){if(xt(v))return this._returnResult({data:null,error:v});throw v}const{data:{session:u},error:h}=await this.getSession();if(h)return this._returnResult({data:null,error:h});if(!u)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:f}=Vu(u.access_token);let p=null;f.aal&&(p=f.aal);let m=p;((c=(o=u.user.factors)===null||o===void 0?void 0:o.filter(v=>v.status==="verified"))!==null&&c!==void 0?c:[]).length>0&&(m="aal2");const x=f.amr||[];return{data:{currentLevel:p,nextLevel:m,currentAuthenticationMethods:x},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async s=>{const{data:{session:a},error:o}=s;return o?this._returnResult({data:null,error:o}):a?await kt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:a.access_token,xform:c=>({data:c,error:null})}):this._returnResult({data:null,error:new es})})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async _approveAuthorization(t,s){try{return await this._useSession(async a=>{const{data:{session:o},error:c}=a;if(c)return this._returnResult({data:null,error:c});if(!o)return this._returnResult({data:null,error:new es});const u=await kt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:h=>({data:h,error:null})});return u.data&&u.data.redirect_url&&kr()&&!s?.skipBrowserRedirect&&window.location.assign(u.data.redirect_url),u})}catch(a){if(xt(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(t,s){try{return await this._useSession(async a=>{const{data:{session:o},error:c}=a;if(c)return this._returnResult({data:null,error:c});if(!o)return this._returnResult({data:null,error:new es});const u=await kt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:h=>({data:h,error:null})});return u.data&&u.data.redirect_url&&kr()&&!s?.skipBrowserRedirect&&window.location.assign(u.data.redirect_url),u})}catch(a){if(xt(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:s},error:a}=t;return a?this._returnResult({data:null,error:a}):s?await kt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new es})})}catch(t){if(xt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async s=>{const{data:{session:a},error:o}=s;return o?this._returnResult({data:null,error:o}):a?(await kt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new es})})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(t,s={keys:[]}){let a=s.keys.find(h=>h.kid===t);if(a)return a;const o=Date.now();if(a=this.jwks.keys.find(h=>h.kid===t),a&&this.jwks_cached_at+lE>o)return a;const{data:c,error:u}=await kt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!c.keys||c.keys.length===0||(this.jwks=c,this.jwks_cached_at=o,a=c.keys.find(h=>h.kid===t),!a)?null:a}async getClaims(t,s={}){try{let a=t;if(!a){const{data:v,error:S}=await this.getSession();if(S||!v.session)return this._returnResult({data:null,error:S});a=v.session.access_token}const{header:o,payload:c,signature:u,raw:{header:h,payload:f}}=Vu(a);s?.allowExpired||TE(c.exp);const p=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!p){const{error:v}=await this.getUser(a);if(v)throw v;return{data:{claims:c,header:o,signature:u},error:null}}const m=RE(o.alg),g=await crypto.subtle.importKey("jwk",p,m,!0,["verify"]);if(!await crypto.subtle.verify(m,g,u,yE(`${h}.${f}`)))throw new Gp("Invalid JWT signature");return{data:{claims:c,header:o,signature:u},error:null}}catch(a){if(xt(a))return this._returnResult({data:null,error:a});throw a}}}vc.nextInstanceID={};const lN=vc,cN="2.97.0";let tc="";typeof Deno<"u"?tc="deno":typeof document<"u"?tc="web":typeof navigator<"u"&&navigator.product==="ReactNative"?tc="react-native":tc="node";const uN={"X-Client-Info":`supabase-js-${tc}/${cN}`},dN={headers:uN},hN={schema:"public"},fN={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},pN={};function xc(e){"@babel/helpers - typeof";return xc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xc(e)}function mN(e,t){if(xc(e)!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var a=s.call(e,t);if(xc(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gN(e){var t=mN(e,"string");return xc(t)=="symbol"?t:t+""}function yN(e,t,s){return(t=gN(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function ix(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),s.push.apply(s,a)}return s}function Jn(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?ix(Object(s),!0).forEach(function(a){yN(e,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ix(Object(s)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(s,a))})}return e}const vN=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),xN=()=>Headers,bN=(e,t,s)=>{const a=vN(s),o=xN();return async(c,u)=>{var h;const f=(h=await t())!==null&&h!==void 0?h:e;let p=new o(u?.headers);return p.has("apikey")||p.set("apikey",e),p.has("Authorization")||p.set("Authorization",`Bearer ${f}`),a(c,Jn(Jn({},u),{},{headers:p}))}};function _N(e){return e.endsWith("/")?e:e+"/"}function wN(e,t){var s,a;const{db:o,auth:c,realtime:u,global:h}=e,{db:f,auth:p,realtime:m,global:g}=t,x={db:Jn(Jn({},f),o),auth:Jn(Jn({},p),c),realtime:Jn(Jn({},m),u),storage:{},global:Jn(Jn(Jn({},g),h),{},{headers:Jn(Jn({},(s=g?.headers)!==null&&s!==void 0?s:{}),(a=h?.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return e.accessToken?x.accessToken=e.accessToken:delete x.accessToken,x}function SN(e){const t=e?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(_N(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var jN=class extends lN{constructor(e){super(e)}},CN=class{constructor(e,t,s){var a,o;this.supabaseUrl=e,this.supabaseKey=t;const c=SN(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,h={db:hN,realtime:pN,auth:Jn(Jn({},fN),{},{storageKey:u}),global:dN},f=wN(s??{},h);if(this.storageKey=(a=f.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=f.global.headers)!==null&&o!==void 0?o:{},f.accessToken)this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(m,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}});else{var p;this.auth=this._initSupabaseAuthClient((p=f.auth)!==null&&p!==void 0?p:{},this.headers,f.global.fetch)}this.fetch=bN(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Jn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(m=>this.realtime.setAuth(m)).catch(m=>console.warn("Failed to set initial Realtime auth token:",m)),this.rest=new uk(new URL("rest/v1",c).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch,timeout:f.db.timeout,urlLengthLimit:f.db.urlLengthLimit}),this.storage=new rE(this.storageUrl.href,this.headers,this.fetch,s?.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new nk(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,s;if(e.accessToken)return await e.accessToken();const{data:a}=await e.auth.getSession();return(t=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:a,userStorage:o,storageKey:c,flowType:u,lock:h,debug:f,throwOnError:p},m,g){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new jN({url:this.authUrl.href,headers:Jn(Jn({},x),m),storageKey:c,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:a,userStorage:o,flowType:u,lock:h,debug:f,throwOnError:p,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Ek(this.realtimeUrl.href,Jn(Jn({},e),{},{params:Jn(Jn({},{apikey:this.supabaseKey}),e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const kN=(e,t,s)=>new CN(e,t,s);function EN(){if(typeof window<"u")return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(t==null)return!1;const s=t.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}EN()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const sp={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var NN={};const c_=e=>{if(typeof import.meta<"u"&&sp&&sp[e])return sp[e];const t=NN;return t&&t[e]?t[e]:null},u_=c_("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",d_=c_("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",Fo=u_,sd=d_,Ae=kN(u_,d_),AN=2,ip=e=>{if(typeof e!="string")return!1;const t=e.trim();return t?!/^[\d-\s.,+\-/%~]+$/.test(t):!1},ax={async translateRecipe(e,t="EN-US"){const s=[],a=[],o=(f,p)=>{const m=typeof f=="string"?f:String(f??"");s.push(m),a.push((g,x)=>{p(x,g||m,m)})},c=f=>Array.isArray(f)?f.map(p=>p&&typeof p=="object"?{...p}:p):f,u={...e,ingredients:c(e.ingredients),flours:c(e.flours),breadIngredients:c(e.breadIngredients),steps:c(e.steps),ingredientGroups:c(e.ingredientGroups),stepGroups:c(e.stepGroups)};if(o(e.title||e.name||"",(f,p)=>{f.title=p,(f.name!==void 0||e.name!==void 0)&&(f.name=p)}),o(e.description||"",(f,p)=>{f.description=p}),e.course&&o(e.course,(f,p)=>{f.course=p}),e.category&&o(e.category,(f,p)=>{f.category=p}),e.storeName&&o(e.storeName,(f,p)=>{f.storeName=p}),Array.isArray(e.ingredientGroups)&&e.ingredientGroups.forEach((f,p)=>{const m=f?.name;m&&o(m,(g,x)=>{g.ingredientGroups?.[p]&&(g.ingredientGroups[p].name=x)})}),Array.isArray(e.stepGroups)&&e.stepGroups.forEach((f,p)=>{const m=f?.name;m&&o(m,(g,x)=>{g.stepGroups?.[p]&&(g.stepGroups[p].name=x)})}),e.type==="bread"?((e.flours||[]).forEach((f,p)=>{!f||typeof f!="object"||(o(f.name||"",(m,g)=>{m.flours?.[p]&&(m.flours[p].name=g)}),f.unit&&o(f.unit,(m,g)=>{m.flours?.[p]&&(m.flours[p].unit=g)}),ip(f.quantity)&&o(f.quantity,(m,g)=>{m.flours?.[p]&&(m.flours[p].quantity=g)}))}),(e.breadIngredients||[]).forEach((f,p)=>{!f||typeof f!="object"||(o(f.name||"",(m,g)=>{m.breadIngredients?.[p]&&(m.breadIngredients[p].name=g)}),f.unit&&o(f.unit,(m,g)=>{m.breadIngredients?.[p]&&(m.breadIngredients[p].unit=g)}),ip(f.quantity)&&o(f.quantity,(m,g)=>{m.breadIngredients?.[p]&&(m.breadIngredients[p].quantity=g)}))})):(e.ingredients||[]).forEach((f,p)=>{if(typeof f=="string"){o(f,(m,g)=>{Array.isArray(m.ingredients)&&(m.ingredients[p]=g)});return}!f||typeof f!="object"||(o(f.name||"",(m,g)=>{m.ingredients?.[p]&&typeof m.ingredients[p]=="object"&&(m.ingredients[p].name=g)}),f.unit&&o(f.unit,(m,g)=>{m.ingredients?.[p]&&typeof m.ingredients[p]=="object"&&(m.ingredients[p].unit=g)}),ip(f.quantity)&&o(f.quantity,(m,g)=>{m.ingredients?.[p]&&typeof m.ingredients[p]=="object"&&(m.ingredients[p].quantity=g)}))}),(e.steps||[]).forEach((f,p)=>{const m=typeof f=="object"&&f!==null?f.text||"":f||"";o(m,(g,x)=>{const v=g.steps?.[p];if(typeof v=="object"&&v!==null){v.text=x;return}Array.isArray(g.steps)&&(g.steps[p]=x)})}),!s.some(f=>String(f||"").trim().length>0))return e;try{const f=await this.translateList(s,t);return a.forEach((p,m)=>{p(f[m],u)}),u.__translationVersion=AN,u}catch(f){throw console.error("Translation failed:",f),f}},async translateList(e,t){const s=(e||[]).map(p=>typeof p=="string"?p:String(p??""));if(!s.some(p=>p.trim().length>0))return s;const a=`${Fo}/functions/v1/translate`,o=async p=>await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:sd,Authorization:`Bearer ${p}`},body:JSON.stringify({text:s,target_lang:t})}),c=async()=>{const{data:p}=await Ae.auth.getSession();if(p?.session?.access_token)return p.session.access_token;const{data:m,error:g}=await Ae.auth.refreshSession();if(g||!m?.session?.access_token){const x=g?.message||"",v=/refresh_token|session|expired|invalid|not found/i.test(x);throw new Error(v?"":x||"")}return m.session.access_token};let u=await c(),h=await o(u);if(h.status===401&&(u=await c(),h=await o(u)),!h.ok){const p=h.status;let m="";try{const g=await h.text();if(g)try{const x=JSON.parse(g);m=x?.error||x?.message||g}catch{m=g}}catch{}throw new Error(m||`Translation Error (${p})`)}const f=await h.json();if(f&&f.error)throw console.error("Edge Function returned error:",f.error),new Error(`Translation Error: ${f.error}`);if(!Array.isArray(f?.translations))throw console.error("Edge Function returned invalid payload:",f),new Error("Translation Error: invalid response payload");return f.translations.map(p=>p.text)}},Jt=e=>{const t=(e??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},Hu=async(e,t,s)=>{let a=null;try{const o=new Promise((c,u)=>{a=setTimeout(()=>u(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([e,o])}finally{a&&clearTimeout(a)}},id=e=>{if(Array.isArray(e))return e.map(s=>String(s)).filter(Boolean);if(typeof e!="string")return[];const t=e.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const s=t.slice(1,-1);return s?s.split(",").map(a=>a.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},TN=e=>{if(e==null)return[];if(Array.isArray(e)){if(e.every(t=>typeof t=="string"))return e.filter(Boolean);if(e.length===1&&e[0]&&typeof e[0]=="object"){const t=e[0],s=Object.values(t)[0];return id(s)}return[]}if(typeof e=="object"){const t=Object.values(e)[0];return id(t)}return id(e)},h_=e=>{if(Array.isArray(e))return e.map(t=>String(t)).filter(Boolean);if(typeof e=="string"){const t=e.trim();if(!t)return[];const s=id(t);return s.length>0?s:t.split(",").map(a=>a.trim()).filter(Boolean)}return[]},ox=e=>{if(!e)return!1;const t=String(e.code||"").toUpperCase(),s=String(e.message||"").toLowerCase(),a=String(e.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||s.includes("row-level security")||s.includes("permission denied")||s.includes("violates row-level security")||s.includes("invalid input syntax")||s.includes("column")||a.includes("row-level security")?!1:s.includes("failed to fetch")||s.includes("network")||s.includes("timeout")||s.includes("timed out")||s.includes("load failed")},f_="recipe_list_cache",RN=300*1e3,ap=(e,t)=>{try{const s=(e||[]).map(a=>({id:a.id,title:a.title,description:a.description,image:a.image,servings:a.servings,course:a.course,category:a.category,storeName:a.storeName,store_name:a.store_name,tags:a.tags,created_at:a.created_at,updated_at:a.updated_at,type:a.type,sourceUrl:a.sourceUrl}));localStorage.setItem(f_,JSON.stringify({userId:t,updatedAt:Date.now(),recipes:s}))}catch{}},ON=e=>{try{const t=localStorage.getItem(f_);if(!t)return null;const s=JSON.parse(t);return s.userId!==e||Date.now()-s.updatedAt>RN?null:s.recipes||null}catch{return null}},An={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(e){return ON(e)},saveCachedRecipes(e,t){ap(e,t)},async _resolveShowMasterPreference(e,t=15e3){const s=e?.showMasterRecipes===!0,a=e?.id;if(!a)return s;const o=this._showMasterPrefCache.get(a),c=Date.now();if(o&&o.value!==s)return this._showMasterPrefCache.set(a,{value:s,updatedAt:c}),s;if(o&&c-o.updatedAt<3e4)return o.value;try{const{data:u,error:h}=await Hu(Ae.from("profiles").select("show_master_recipes").eq("id",a).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(h)throw h;const f=u?.show_master_recipes===!0;return this._showMasterPrefCache.set(a,{value:f,updatedAt:c}),f}catch{return this._showMasterPrefCache.set(a,{value:s,updatedAt:c}),s}},async _resolveMasterOwnerTags(e=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:s,error:a}=await Hu(Ae.rpc("get_master_recipe_owner_tags"),Math.min(3e3,e/3),"rpc.get_master_recipe_owner_tags");if(a)throw a;const o=TN(s),c=new Set(o.length>0?o:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:c,updatedAt:t},c}catch{const s=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:s,updatedAt:t},s}},async fetchRecipes(e,{timeoutMs:t=15e3,includeIngredients:s=!0,includeSources:a=!0,offset:o=0,limit:c=null,skipCacheSave:u=!1,returnMeta:h=!1}={}){if(!e)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const f=e.role==="admin",p=f?Promise.resolve(!1):this._resolveShowMasterPreference(e,t),m=Number.isInteger(o)&&o>=0?o:0,g=Number.isInteger(c)&&c>0?c:null;let x=0,v=[];const S=async(H,{withOrderIndex:O,queryTimeoutMs:q})=>{let C=Ae.from("recipes").select(H);O?C=C.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):C=C.order("created_at",{ascending:!1}),g!=null&&(C=C.range(m,m+g-1));const{data:I,error:L}=await Hu(C,q,"recipes.select(list)");if(L)throw L;return x=Array.isArray(I)?I.length:0,(I||[]).map(ks)},w=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`,_=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${a?",recipe_sources(url)":""}`,j=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",E=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let T=null;const R=`recipe_query_pattern:${s?"ing":"noing"}:${a?"src":"nosrc"}`,B=this._queryPatternCache.get(R),F=Math.max(2500,t);if(B)try{v=await S(B.spec,{withOrderIndex:B.withOrderIndex,queryTimeoutMs:F})}catch(H){console.warn("Cached query pattern failed, re-detecting...",H),this._queryPatternCache.delete(R),T=H}else{const O=Math.max(2500,Math.round(t/(s?[w,_,j,E]:[w,_,E]).length));try{v=await S(w,{withOrderIndex:!0,queryTimeoutMs:O}),this._queryPatternCache.set(R,{spec:w,withOrderIndex:!0})}catch(q){T=q;try{v=await S(_,{withOrderIndex:!1,queryTimeoutMs:O}),this._queryPatternCache.set(R,{spec:_,withOrderIndex:!1})}catch(C){T=C;try{v=await S(j,{withOrderIndex:!1,queryTimeoutMs:O}),this._queryPatternCache.set(R,{spec:j,withOrderIndex:!1})}catch(I){T=I;try{v=await S(E,{withOrderIndex:!1,queryTimeoutMs:O}),this._queryPatternCache.set(R,{spec:E,withOrderIndex:!1})}catch(L){T=L,v=[]}}}}}if(v.length===0&&T)try{const H=localStorage.getItem("local_recipes");if(H){const O=JSON.parse(H).map(q=>typeof ks=="function"?ks(q):q);v=g!=null?O.slice(m,m+g):O,x=v.length}else throw T}catch{throw T}if(f)return u||ap(v,e.id),h?{recipes:v,hasMoreRaw:g!=null?x===g:!1}:v;const $=[String(e.id)];e.displayId&&$.push(String(e.displayId));const M=await p,z=M?await this._resolveMasterOwnerTags(t):new Set,P=v.filter(H=>{const O=h_(H.tags),q=O.filter(V=>V&&V.startsWith("owner:"));if(q.length===0)return!0;const C=q.some(V=>z.has(V));if(M&&C)return!0;const I=q.some(V=>$.some(G=>V===`owner:${G}`)),L=O.includes("public");return!!(I||L)});return u||ap(P,e.id),h?{recipes:P,hasMoreRaw:g!=null?x===g:!1}:P},_filterRecipesInApp(e,t){return this.fetchRecipes(t)},async uploadImage(e){const t=e.name.split(".").pop(),a=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:o}=await Ae.storage.from("recipe-images").upload(a,e);if(o)throw o;const{data:c}=Ae.storage.from("recipe-images").getPublicUrl(a);return c.publicUrl},async getRecipe(e){try{const{data:t,error:s}=await Hu(Ae.from("recipes").select("*, recipe_sources(url)").eq("id",e).single(),15e3,"recipes.select(detail)");if(s)throw s;return ks(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const s=localStorage.getItem("local_recipes");if(s){const o=JSON.parse(s).find(c=>c.id==e);if(o)return ks(o)}throw t}},async createRecipe(e,t){console.log("createRecipe called with user:",t);const{id:s,created_at:a,sourceUrl:o,...c}=e;if(c.image instanceof File&&(c.image=await this.uploadImage(c.image)),t){const f=(c.tags||[]).filter(p=>!p.startsWith("owner:"));c.tags=[...f,`owner:${t.id}`],console.log("Added owner tag. New tags:",c.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const u=Gu(c);try{const{data:h,error:f}=await Ae.from("recipes").insert([u]).select().single();if(f)throw f;if(o){const{error:p}=await Ae.from("recipe_sources").insert([{recipe_id:h.id,url:o}]);p&&console.error("Failed to save source URL:",p)}return ks({...h,recipe_sources:o?[{url:o}]:[]})}catch(h){if(!ox(h))throw h;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",h);const f=Date.now(),p={...c,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:c.tags||[]},m=Gu(p);m.id=f,m.created_at=p.created_at,console.log("Saving to LocalStorage:",m);try{const g=localStorage.getItem("local_recipes"),x=g?JSON.parse(g):[];x.push(m),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(g){throw console.error("Failed to save to LocalStorage:",g),h}return ks(m)}},async updateRecipe(e){const{id:t,created_at:s,sourceUrl:a,...o}=e;o.image instanceof File&&(o.image=await this.uploadImage(o.image));const c=Gu(o);o.steps===void 0&&delete c.steps,o.tags===void 0&&delete c.tags,o.ingredients!==void 0||o.type!==void 0||o.ingredientGroups!==void 0||o.flours!==void 0||o.breadIngredients!==void 0||o.stepGroups!==void 0||delete c.ingredients;try{const{data:h,error:f}=await Ae.from("recipes").update(c).eq("id",e.id).select().single();if(f)throw f;if(a!==void 0&&(await Ae.from("recipe_sources").delete().eq("recipe_id",e.id),a)){const{error:p}=await Ae.from("recipe_sources").insert([{recipe_id:e.id,url:a}]);p&&console.error("Failed to update source URL:",p)}return ks({...h,recipe_sources:a?[{url:a}]:[]})}catch(h){if(!ox(h))throw h;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",h);const f=localStorage.getItem("local_recipes");if(f){let p=JSON.parse(f);const m=p.findIndex(g=>g.id==e.id);if(m!==-1){const g={...p[m],...c,updated_at:new Date().toISOString()};return p[m]=g,localStorage.setItem("local_recipes",JSON.stringify(p)),ks(g)}}throw h}},async duplicateRecipe(e,t){const{id:s,created_at:a,updated_at:o,image:c,...u}=e;u.title=`${u.title} ()`;let h=null;if(c)try{const f=c.split("/").pop(),p=`copy-${Date.now()}-${f}`,{error:m}=await Ae.storage.from("recipe-images").copy(f,p);if(m)console.warn("Image copy failed, using original URL:",m),h=c;else{const{data:g}=Ae.storage.from("recipe-images").getPublicUrl(p);h=g.publicUrl}}catch(f){console.warn("Image copy logic error:",f),h=c}return u.image=h,await this.createRecipe(u,t)},async fetchDeletedRecipes(){const{data:e,error:t}=await Ae.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return e.map(DN)},async getDeletedCount(){const{count:e,error:t}=await Ae.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return e},async deleteRecipe(e){try{const{data:t,error:s}=await Ae.from("recipes").select("*").eq("id",e).single();if(s)throw s;const{error:a}=await Ae.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Ae.from("recipes").delete().eq("id",e);if(o)throw o;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const s=localStorage.getItem("local_recipes");if(s){let a=JSON.parse(s);const o=a.length;if(a=a.filter(c=>c.id!=e),a.length<o)return localStorage.setItem("local_recipes",JSON.stringify(a)),!0}throw t}},async restoreRecipe(e){const{data:t,error:s}=await Ae.from("deleted_recipes").select("*").eq("id",e).single();if(s)throw s;const{error:a}=await Ae.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await Ae.from("deleted_recipes").delete().eq("id",e);if(o)throw o;return!0},async hardDeleteRecipe(e){const{error:t}=await Ae.from("deleted_recipes").delete().eq("id",e);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:e,error:t}=await Ae.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return e.map(s=>s.recipe_id)},async addToHistory(e){const{error:t}=await Ae.from("recent_views").upsert({recipe_id:e,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(e){const t=e.map(s=>Ae.from("recipes").update({order_index:s.order_index}).eq("id",s.id));await Promise.all(t)},async exportAllRecipes(e){return await this.fetchRecipes(e)},async importRecipes(e){if(!Array.isArray(e))throw new Error("Invalid backup format");let t=0,s=[];for(const a of e)try{await this.createRecipe(a),t++}catch(o){console.error("Import failed for recipe:",a.title,o),s.push({title:a.title,error:o.message})}return{success:!0,count:t,errors:s}},async updateRecipeCosts(e){const{data:t,error:s}=await Ae.from("recipes").select("*");if(s)throw s;let a=0;const o=[];for(const c of t){const u=ks(c);let h=!1;const f=p=>p.map(m=>{if(!m.name)return m;const g=e.get(Jt(m.name));if(g&&m.purchaseCost!==g.price){h=!0;const x={...m,purchaseCost:g.price};if(u.type==="bread"){const v=parseFloat(x.quantity)||0;x.cost=Math.round(v/1e3*x.purchaseCost)}else if(m.cost&&m.purchaseCost){const v=m.cost/m.purchaseCost;x.cost=Math.round(x.purchaseCost*v)}return x}return m});if(u.type==="bread"){const p=f(u.flours||[]),m=f(u.breadIngredients||[]);h&&(u.flours=p,u.breadIngredients=m)}else{const p=f(u.ingredients||[]);h&&(u.ingredients=p)}if(h){const p=Gu(u);o.push(Ae.from("recipes").update(p).eq("id",u.id)),a++}}return o.length>0&&await Promise.all(o),a}},Gu=e=>{let t=e.ingredients||[];const s={_meta:!0,type:e.type||"normal"};if(e.ingredientGroups&&e.ingredientGroups.length>0&&(s.groups=e.ingredientGroups),e.stepGroups&&e.stepGroups.length>0){const o=e.steps||[],c=e.stepGroups.map(u=>({...u,count:o.filter(h=>h.groupId===u.id).length}));s.stepGroups=c}if(e.type==="bread"){const o=(e.flours||[]).map(u=>({...u,_group:"flour"})),c=(e.breadIngredients||[]).map(u=>({...u,_group:"other"}));t=[s,...o,...c]}else t=[s,...t];const a=(e.steps||[]).map(o=>typeof o=="string"?o:o.text);return{title:e.title,description:e.description,image:e.image,servings:e.servings,course:e.course,category:e.category,store_name:e.storeName,ingredients:t,steps:a,tags:e.tags||[]}},ks=e=>{const t=e.ingredients||[];let s="normal",a=[],o=[],c=[],u=[],h=t;const f=h_(e.tags);if(Array.isArray(t)&&t.length>0&&t[0]&&typeof t[0]=="object"&&t[0]._meta){const g=t[0];s=g.type||"normal",g.groups&&(c=g.groups),g.stepGroups&&(u=g.stepGroups);const x=t.slice(1);s==="bread"?(a=x.filter(v=>v._group==="flour").map(v=>{const{_group:S,...w}=v;return w}),o=x.filter(v=>v._group==="other").map(v=>{const{_group:S,...w}=v;return w}),h=[...a,...o]):h=x}else e.ingredients_meta&&(s=e.ingredients_meta.type||"normal",Array.isArray(e.ingredients_meta.groups)&&(c=e.ingredients_meta.groups),Array.isArray(e.ingredients_meta.stepGroups)&&(u=e.ingredients_meta.stepGroups),h=Array.isArray(t)?t:[]);let m=e.steps||[];if(u.length>0&&Array.isArray(m)){let g=0;m=m.map(v=>({text:v}));const x=[];for(u.forEach(v=>{const S=v.count||0;for(let w=0;w<S;w++)g<m.length&&(x.push({...m[g],text:m[g].text,groupId:v.id}),g++)});g<m.length;)x.push({...m[g],groupId:"default"}),g++;m=x}return{...e,prepTime:e.prep_time,cookTime:e.cook_time,storeName:e.store_name,type:s,flours:a,breadIngredients:o,ingredientGroups:c,stepGroups:u,ingredients:h,steps:m.length>0&&typeof m[0]=="object"?m:e.steps,tags:f,sourceUrl:e.recipe_sources&&e.recipe_sources.length>0?e.recipe_sources[0].url:""}},DN=e=>({...ks(e),deletedAt:e.deleted_at,originalId:e.original_id}),op=Object.freeze(Object.defineProperty({__proto__:null,recipeService:An},Symbol.toStringTag,{value:"Module"})),lp="food",LN="food_alcohol",zN=new Set(["food","alcohol","soft_drink","supplies"]),Ku=e=>{const t=String(e||"").trim();return!t||t===LN?lp:zN.has(t)?t:lp},Ln={async _getCurrentUserId(){const{data:e,error:t}=await Ae.auth.getUser();if(t)throw t;return e?.user?.id||null},async saveConversion(e,t,s,a=null,o=null,c=void 0,u=void 0){try{const h=await this._getCurrentUserId();if(!h)throw new Error("");const f={user_id:h,ingredient_name:e,packet_size:parseFloat(t),packet_unit:s,last_price:a?parseFloat(a):null,updated_at:new Date().toISOString()};if(o&&(f.item_category=Ku(o)),c!==void 0){const x=String(c??"").trim();f.vendor=x||null}if(u!==void 0){const x=parseFloat(u);let v=Number.isFinite(x)?x:100;v<=0&&(v=100),v>100&&(v=100),f.yield_percent=v}const p=async x=>Ae.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:m,error:g}=await p(f);if(g){const x=String(g.message||""),v=!!f.item_category&&x.includes("item_category"),S=Object.prototype.hasOwnProperty.call(f,"vendor")&&x.includes("vendor"),w=Object.prototype.hasOwnProperty.call(f,"yield_percent")&&x.includes("yield_percent");if(v||S||w){const _={...f};v&&delete _.item_category,S&&delete _.vendor,w&&delete _.yield_percent,{data:m,error:g}=await p(_)}}if(g)throw g;return{ingredientName:m.ingredient_name,packetSize:m.packet_size,packetUnit:m.packet_unit,lastPrice:m.last_price,vendor:m.vendor||"",itemCategory:Ku(m.item_category),yieldPercent:m.yield_percent===null||m.yield_percent===void 0?100:m.yield_percent,updatedAt:m.updated_at}}catch(h){throw console.error("Error saving conversion:",h),h}},async getConversion(e){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:s,error:a}=await Ae.from("unit_conversions").select("*").eq("ingredient_name",e).eq("user_id",t).single();return a?(a.code==="PGRST116"||console.warn("Error fetching conversion:",a),null):{ingredientName:s.ingredient_name,packetSize:s.packet_size,packetUnit:s.packet_unit,lastPrice:s.last_price,vendor:s.vendor||"",itemCategory:Ku(s.item_category),yieldPercent:s.yield_percent===null||s.yield_percent===void 0?100:s.yield_percent,updatedAt:s.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const e=await this._getCurrentUserId();if(!e)return new Map;const{data:t,error:s}=await Ae.from("unit_conversions").select("*").eq("user_id",e);if(s)throw s;const a=new Map;return t.forEach(o=>{a.set(o.ingredient_name,{ingredientName:o.ingredient_name,packetSize:o.packet_size,packetUnit:o.packet_unit,lastPrice:o.last_price,vendor:o.vendor||"",itemCategory:Ku(o.item_category),yieldPercent:o.yield_percent===null||o.yield_percent===void 0?100:o.yield_percent,updatedAt:o.updated_at})}),a}catch(e){return console.error("Error in getAllConversions:",e),new Map}},async deleteConversion(e){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:s}=await Ae.from("unit_conversions").delete().eq("ingredient_name",e).eq("user_id",t);if(s)throw s;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(e,{overwrite:t=!1}={}){const s=String(e||"").trim();if(!s)throw new Error("");const{data:a,error:o}=await Ae.rpc("admin_copy_ingredient_master",{target_profile_id:s,overwrite:t===!0});if(o)throw o;return a},async adminCopyMasterToAllUsers(){const e=await this._getCurrentUserId();if(!e)throw new Error("");const{error:t}=await Ae.rpc("admin_copy_master_to_all_users",{p_admin_id:e});if(t)throw t;return{success:!0}},async moveAllToTrash(){const e=await this._getCurrentUserId();if(!e)throw new Error("");const{data:t,error:s}=await Ae.from("unit_conversions").select("*").eq("user_id",e);if(s)throw s;const{data:a,error:o}=await Ae.from("csv_unit_overrides").select("*").eq("user_id",e);if(o)throw o;const c=(t||[]).length;if(c===0&&(a||[]).length===0)return{moved:0};const{error:u}=await Ae.from("trash_ingredient_master").insert([{user_id:e,label:`${new Date().toLocaleDateString("ja-JP")}`,snapshot_unit_conversions:t||[],snapshot_csv_unit_overrides:a||[]}]);if(u)throw u;if((t||[]).length>0){const{error:h}=await Ae.from("unit_conversions").delete().eq("user_id",e);if(h)throw h}if((a||[]).length>0){const{error:h}=await Ae.from("csv_unit_overrides").delete().eq("user_id",e);if(h)throw h}return{moved:c}},async adminClearAllNonAdminMaster(){if(!await this._getCurrentUserId())throw new Error("");const{data:t,error:s}=await Ae.rpc("admin_clear_all_non_admin_ingredient_master");if(s)throw s;return{deleted_unit_conversions:t.deleted_unit_conversions||0,deleted_csv_overrides:t.deleted_csv_overrides||0}},async adminClearTargetUserMaster(e){const t=await this._getCurrentUserId();if(!t)throw new Error("");if(e===t)throw new Error("");const{data:s,error:a}=await Ae.rpc("admin_clear_target_user_ingredient_master",{target_user_id:e});if(a)throw a;return{deleted_unit_conversions:s.deleted_unit_conversions||0,deleted_csv_overrides:s.deleted_csv_overrides||0}}},p_=k.createContext(null),xs=()=>k.useContext(p_),m_=k.createContext(null),qs=()=>{const e=k.useContext(m_);if(!e)throw new Error("useToast must be used within a ToastProvider");return e},bd=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],IN=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var Eo={},cp={exports:{}},up,lx;function MN(){if(lx)return up;lx=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return up=e,up}var dp,cx;function UN(){if(cx)return dp;cx=1;var e=MN();function t(){}function s(){}return s.resetWarningCache=t,dp=function(){function a(u,h,f,p,m,g){if(g!==e){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}a.isRequired=a;function o(){return a}var c={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:o,element:a,elementType:a,instanceOf:o,node:a,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:s,resetWarningCache:t};return c.PropTypes=c,c},dp}var ux;function g_(){return ux||(ux=1,cp.exports=UN()()),cp.exports}var hp,dx;function y_(){return dx||(dx=1,hp={L:1,M:0,Q:3,H:2}),hp}var fp,hx;function v_(){return hx||(hx=1,fp={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),fp}var pp,fx;function BN(){if(fx)return pp;fx=1;var e=v_();function t(s){this.mode=e.MODE_8BIT_BYTE,this.data=s}return t.prototype={getLength:function(s){return this.data.length},write:function(s){for(var a=0;a<this.data.length;a++)s.put(this.data.charCodeAt(a),8)}},pp=t,pp}var mp,px;function PN(){if(px)return mp;px=1;var e=y_();function t(s,a){this.totalCount=s,this.dataCount=a}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(s,a){var o=t.getRsBlockTable(s,a);if(o==null)throw new Error("bad rs block @ typeNumber:"+s+"/errorCorrectLevel:"+a);for(var c=o.length/3,u=new Array,h=0;h<c;h++)for(var f=o[h*3+0],p=o[h*3+1],m=o[h*3+2],g=0;g<f;g++)u.push(new t(p,m));return u},t.getRsBlockTable=function(s,a){switch(a){case e.L:return t.RS_BLOCK_TABLE[(s-1)*4+0];case e.M:return t.RS_BLOCK_TABLE[(s-1)*4+1];case e.Q:return t.RS_BLOCK_TABLE[(s-1)*4+2];case e.H:return t.RS_BLOCK_TABLE[(s-1)*4+3];default:return}},mp=t,mp}var gp,mx;function $N(){if(mx)return gp;mx=1;function e(){this.buffer=new Array,this.length=0}return e.prototype={get:function(t){var s=Math.floor(t/8);return(this.buffer[s]>>>7-t%8&1)==1},put:function(t,s){for(var a=0;a<s;a++)this.putBit((t>>>s-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),t&&(this.buffer[s]|=128>>>this.length%8),this.length++}},gp=e,gp}var yp,gx;function x_(){if(gx)return yp;gx=1;for(var e={glog:function(s){if(s<1)throw new Error("glog("+s+")");return e.LOG_TABLE[s]},gexp:function(s){for(;s<0;)s+=255;for(;s>=256;)s-=255;return e.EXP_TABLE[s]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)e.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)e.EXP_TABLE[t]=e.EXP_TABLE[t-4]^e.EXP_TABLE[t-5]^e.EXP_TABLE[t-6]^e.EXP_TABLE[t-8];for(var t=0;t<255;t++)e.LOG_TABLE[e.EXP_TABLE[t]]=t;return yp=e,yp}var vp,yx;function b_(){if(yx)return vp;yx=1;var e=x_();function t(s,a){if(s.length==null)throw new Error(s.length+"/"+a);for(var o=0;o<s.length&&s[o]==0;)o++;this.num=new Array(s.length-o+a);for(var c=0;c<s.length-o;c++)this.num[c]=s[c+o]}return t.prototype={get:function(s){return this.num[s]},getLength:function(){return this.num.length},multiply:function(s){for(var a=new Array(this.getLength()+s.getLength()-1),o=0;o<this.getLength();o++)for(var c=0;c<s.getLength();c++)a[o+c]^=e.gexp(e.glog(this.get(o))+e.glog(s.get(c)));return new t(a,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var a=e.glog(this.get(0))-e.glog(s.get(0)),o=new Array(this.getLength()),c=0;c<this.getLength();c++)o[c]=this.get(c);for(var c=0;c<s.getLength();c++)o[c]^=e.gexp(e.glog(s.get(c))+a);return new t(o,0).mod(s)}},vp=t,vp}var xp,vx;function qN(){if(vx)return xp;vx=1;var e=v_(),t=b_(),s=x_(),a={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(c){for(var u=c<<10;o.getBCHDigit(u)-o.getBCHDigit(o.G15)>=0;)u^=o.G15<<o.getBCHDigit(u)-o.getBCHDigit(o.G15);return(c<<10|u)^o.G15_MASK},getBCHTypeNumber:function(c){for(var u=c<<12;o.getBCHDigit(u)-o.getBCHDigit(o.G18)>=0;)u^=o.G18<<o.getBCHDigit(u)-o.getBCHDigit(o.G18);return c<<12|u},getBCHDigit:function(c){for(var u=0;c!=0;)u++,c>>>=1;return u},getPatternPosition:function(c){return o.PATTERN_POSITION_TABLE[c-1]},getMask:function(c,u,h){switch(c){case a.PATTERN000:return(u+h)%2==0;case a.PATTERN001:return u%2==0;case a.PATTERN010:return h%3==0;case a.PATTERN011:return(u+h)%3==0;case a.PATTERN100:return(Math.floor(u/2)+Math.floor(h/3))%2==0;case a.PATTERN101:return u*h%2+u*h%3==0;case a.PATTERN110:return(u*h%2+u*h%3)%2==0;case a.PATTERN111:return(u*h%3+(u+h)%2)%2==0;default:throw new Error("bad maskPattern:"+c)}},getErrorCorrectPolynomial:function(c){for(var u=new t([1],0),h=0;h<c;h++)u=u.multiply(new t([1,s.gexp(h)],0));return u},getLengthInBits:function(c,u){if(1<=u&&u<10)switch(c){case e.MODE_NUMBER:return 10;case e.MODE_ALPHA_NUM:return 9;case e.MODE_8BIT_BYTE:return 8;case e.MODE_KANJI:return 8;default:throw new Error("mode:"+c)}else if(u<27)switch(c){case e.MODE_NUMBER:return 12;case e.MODE_ALPHA_NUM:return 11;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 10;default:throw new Error("mode:"+c)}else if(u<41)switch(c){case e.MODE_NUMBER:return 14;case e.MODE_ALPHA_NUM:return 13;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 12;default:throw new Error("mode:"+c)}else throw new Error("type:"+u)},getLostPoint:function(c){for(var u=c.getModuleCount(),h=0,f=0;f<u;f++)for(var p=0;p<u;p++){for(var m=0,g=c.isDark(f,p),x=-1;x<=1;x++)if(!(f+x<0||u<=f+x))for(var v=-1;v<=1;v++)p+v<0||u<=p+v||x==0&&v==0||g==c.isDark(f+x,p+v)&&m++;m>5&&(h+=3+m-5)}for(var f=0;f<u-1;f++)for(var p=0;p<u-1;p++){var S=0;c.isDark(f,p)&&S++,c.isDark(f+1,p)&&S++,c.isDark(f,p+1)&&S++,c.isDark(f+1,p+1)&&S++,(S==0||S==4)&&(h+=3)}for(var f=0;f<u;f++)for(var p=0;p<u-6;p++)c.isDark(f,p)&&!c.isDark(f,p+1)&&c.isDark(f,p+2)&&c.isDark(f,p+3)&&c.isDark(f,p+4)&&!c.isDark(f,p+5)&&c.isDark(f,p+6)&&(h+=40);for(var p=0;p<u;p++)for(var f=0;f<u-6;f++)c.isDark(f,p)&&!c.isDark(f+1,p)&&c.isDark(f+2,p)&&c.isDark(f+3,p)&&c.isDark(f+4,p)&&!c.isDark(f+5,p)&&c.isDark(f+6,p)&&(h+=40);for(var w=0,p=0;p<u;p++)for(var f=0;f<u;f++)c.isDark(f,p)&&w++;var _=Math.abs(100*w/u/u-50)/5;return h+=_*10,h}};return xp=o,xp}var bp,xx;function FN(){if(xx)return bp;xx=1;var e=BN(),t=PN(),s=$N(),a=qN(),o=b_();function c(h,f){this.typeNumber=h,this.errorCorrectLevel=f,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var u=c.prototype;return u.addData=function(h){var f=new e(h);this.dataList.push(f),this.dataCache=null},u.isDark=function(h,f){if(h<0||this.moduleCount<=h||f<0||this.moduleCount<=f)throw new Error(h+","+f);return this.modules[h][f]},u.getModuleCount=function(){return this.moduleCount},u.make=function(){if(this.typeNumber<1){var h=1;for(h=1;h<40;h++){for(var f=t.getRSBlocks(h,this.errorCorrectLevel),p=new s,m=0,g=0;g<f.length;g++)m+=f[g].dataCount;for(var g=0;g<this.dataList.length;g++){var x=this.dataList[g];p.put(x.mode,4),p.put(x.getLength(),a.getLengthInBits(x.mode,h)),x.write(p)}if(p.getLengthInBits()<=m*8)break}this.typeNumber=h}this.makeImpl(!1,this.getBestMaskPattern())},u.makeImpl=function(h,f){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var p=0;p<this.moduleCount;p++){this.modules[p]=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++)this.modules[p][m]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(h,f),this.typeNumber>=7&&this.setupTypeNumber(h),this.dataCache==null&&(this.dataCache=c.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,f)},u.setupPositionProbePattern=function(h,f){for(var p=-1;p<=7;p++)if(!(h+p<=-1||this.moduleCount<=h+p))for(var m=-1;m<=7;m++)f+m<=-1||this.moduleCount<=f+m||(0<=p&&p<=6&&(m==0||m==6)||0<=m&&m<=6&&(p==0||p==6)||2<=p&&p<=4&&2<=m&&m<=4?this.modules[h+p][f+m]=!0:this.modules[h+p][f+m]=!1)},u.getBestMaskPattern=function(){for(var h=0,f=0,p=0;p<8;p++){this.makeImpl(!0,p);var m=a.getLostPoint(this);(p==0||h>m)&&(h=m,f=p)}return f},u.createMovieClip=function(h,f,p){var m=h.createEmptyMovieClip(f,p),g=1;this.make();for(var x=0;x<this.modules.length;x++)for(var v=x*g,S=0;S<this.modules[x].length;S++){var w=S*g,_=this.modules[x][S];_&&(m.beginFill(0,100),m.moveTo(w,v),m.lineTo(w+g,v),m.lineTo(w+g,v+g),m.lineTo(w,v+g),m.endFill())}return m},u.setupTimingPattern=function(){for(var h=8;h<this.moduleCount-8;h++)this.modules[h][6]==null&&(this.modules[h][6]=h%2==0);for(var f=8;f<this.moduleCount-8;f++)this.modules[6][f]==null&&(this.modules[6][f]=f%2==0)},u.setupPositionAdjustPattern=function(){for(var h=a.getPatternPosition(this.typeNumber),f=0;f<h.length;f++)for(var p=0;p<h.length;p++){var m=h[f],g=h[p];if(this.modules[m][g]==null)for(var x=-2;x<=2;x++)for(var v=-2;v<=2;v++)x==-2||x==2||v==-2||v==2||x==0&&v==0?this.modules[m+x][g+v]=!0:this.modules[m+x][g+v]=!1}},u.setupTypeNumber=function(h){for(var f=a.getBCHTypeNumber(this.typeNumber),p=0;p<18;p++){var m=!h&&(f>>p&1)==1;this.modules[Math.floor(p/3)][p%3+this.moduleCount-8-3]=m}for(var p=0;p<18;p++){var m=!h&&(f>>p&1)==1;this.modules[p%3+this.moduleCount-8-3][Math.floor(p/3)]=m}},u.setupTypeInfo=function(h,f){for(var p=this.errorCorrectLevel<<3|f,m=a.getBCHTypeInfo(p),g=0;g<15;g++){var x=!h&&(m>>g&1)==1;g<6?this.modules[g][8]=x:g<8?this.modules[g+1][8]=x:this.modules[this.moduleCount-15+g][8]=x}for(var g=0;g<15;g++){var x=!h&&(m>>g&1)==1;g<8?this.modules[8][this.moduleCount-g-1]=x:g<9?this.modules[8][15-g-1+1]=x:this.modules[8][15-g-1]=x}this.modules[this.moduleCount-8][8]=!h},u.mapData=function(h,f){for(var p=-1,m=this.moduleCount-1,g=7,x=0,v=this.moduleCount-1;v>0;v-=2)for(v==6&&v--;;){for(var S=0;S<2;S++)if(this.modules[m][v-S]==null){var w=!1;x<h.length&&(w=(h[x]>>>g&1)==1);var _=a.getMask(f,m,v-S);_&&(w=!w),this.modules[m][v-S]=w,g--,g==-1&&(x++,g=7)}if(m+=p,m<0||this.moduleCount<=m){m-=p,p=-p;break}}},c.PAD0=236,c.PAD1=17,c.createData=function(h,f,p){for(var m=t.getRSBlocks(h,f),g=new s,x=0;x<p.length;x++){var v=p[x];g.put(v.mode,4),g.put(v.getLength(),a.getLengthInBits(v.mode,h)),v.write(g)}for(var S=0,x=0;x<m.length;x++)S+=m[x].dataCount;if(g.getLengthInBits()>S*8)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+S*8+")");for(g.getLengthInBits()+4<=S*8&&g.put(0,4);g.getLengthInBits()%8!=0;)g.putBit(!1);for(;!(g.getLengthInBits()>=S*8||(g.put(c.PAD0,8),g.getLengthInBits()>=S*8));)g.put(c.PAD1,8);return c.createBytes(g,m)},c.createBytes=function(h,f){for(var p=0,m=0,g=0,x=new Array(f.length),v=new Array(f.length),S=0;S<f.length;S++){var w=f[S].dataCount,_=f[S].totalCount-w;m=Math.max(m,w),g=Math.max(g,_),x[S]=new Array(w);for(var j=0;j<x[S].length;j++)x[S][j]=255&h.buffer[j+p];p+=w;var E=a.getErrorCorrectPolynomial(_),T=new o(x[S],E.getLength()-1),R=T.mod(E);v[S]=new Array(E.getLength()-1);for(var j=0;j<v[S].length;j++){var B=j+R.getLength()-v[S].length;v[S][j]=B>=0?R.get(B):0}}for(var F=0,j=0;j<f.length;j++)F+=f[j].totalCount;for(var $=new Array(F),M=0,j=0;j<m;j++)for(var S=0;S<f.length;S++)j<x[S].length&&($[M++]=x[S][j]);for(var j=0;j<g;j++)for(var S=0;S<f.length;S++)j<v[S].length&&($[M++]=v[S][j]);return $},bp=c,bp}var Wu={},bx;function VN(){if(bx)return Wu;bx=1,Object.defineProperty(Wu,"__esModule",{value:!0});var e=Object.assign||function(p){for(var m=1;m<arguments.length;m++){var g=arguments[m];for(var x in g)Object.prototype.hasOwnProperty.call(g,x)&&(p[x]=g[x])}return p},t=g_(),s=c(t),a=bc(),o=c(a);function c(p){return p&&p.__esModule?p:{default:p}}function u(p,m){var g={};for(var x in p)m.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(p,x)&&(g[x]=p[x]);return g}var h={bgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,bgD:s.default.string.isRequired,fgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,fgD:s.default.string.isRequired,size:s.default.number.isRequired,title:s.default.string,viewBoxSize:s.default.number.isRequired,xmlns:s.default.string},f=(0,a.forwardRef)(function(p,m){var g=p.bgColor,x=p.bgD,v=p.fgD,S=p.fgColor,w=p.size,_=p.title,j=p.viewBoxSize,E=p.xmlns,T=E===void 0?"http://www.w3.org/2000/svg":E,R=u(p,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return o.default.createElement("svg",e({},R,{height:w,ref:m,viewBox:"0 0 "+j+" "+j,width:w,xmlns:T}),_?o.default.createElement("title",null,_):null,o.default.createElement("path",{d:x,fill:g}),o.default.createElement("path",{d:v,fill:S}))});return f.displayName="QRCodeSvg",f.propTypes=h,Wu.default=f,Wu}var _x;function HN(){if(_x)return Eo;_x=1,Object.defineProperty(Eo,"__esModule",{value:!0}),Eo.QRCode=void 0;var e=Object.assign||function(w){for(var _=1;_<arguments.length;_++){var j=arguments[_];for(var E in j)Object.prototype.hasOwnProperty.call(j,E)&&(w[E]=j[E])}return w},t=g_(),s=g(t),a=y_(),o=g(a),c=FN(),u=g(c),h=bc(),f=g(h),p=VN(),m=g(p);function g(w){return w&&w.__esModule?w:{default:w}}function x(w,_){var j={};for(var E in w)_.indexOf(E)>=0||Object.prototype.hasOwnProperty.call(w,E)&&(j[E]=w[E]);return j}var v={bgColor:s.default.oneOfType([s.default.object,s.default.string]),fgColor:s.default.oneOfType([s.default.object,s.default.string]),level:s.default.string,size:s.default.number,value:s.default.string.isRequired},S=(0,h.forwardRef)(function(w,_){var j=w.bgColor,E=j===void 0?"#FFFFFF":j,T=w.fgColor,R=T===void 0?"#000000":T,B=w.level,F=B===void 0?"L":B,$=w.size,M=$===void 0?256:$,z=w.value,P=x(w,["bgColor","fgColor","level","size","value"]),H=new u.default(-1,o.default[F]);H.addData(z),H.make();var O=H.modules;return f.default.createElement(m.default,e({},P,{bgColor:E,bgD:O.map(function(q,C){return q.map(function(I,L){return I?"":"M "+L+" "+C+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:R,fgD:O.map(function(q,C){return q.map(function(I,L){return I?"M "+L+" "+C+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:_,size:M,viewBoxSize:O.length}))});return Eo.QRCode=S,S.displayName="QRCode",S.propTypes=v,Eo.default=S,Eo}var GN=HN();const wx=nm(GN),Sx=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},KN=e=>{if(e==null)return NaN;if(typeof e=="number")return Number.isFinite(e)?e:NaN;const t=String(e).trim().replace(/[,\s]/g,"");if(!t)return NaN;const s=parseFloat(t);return Number.isFinite(s)?s:NaN},Ps=(e,{maximumFractionDigits:t=1}={})=>{const s=KN(e);return Number.isFinite(s)?`${s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}`:null},WN=new Set(["food","alcohol","soft_drink","supplies"]),__=new Set(["alcohol","supplies"]),w_=e=>{const t=String(e||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":WN.has(t)?t:"":""},Kp=e=>{const t=w_(e?.itemCategory??e?.item_category);return t?__.has(t):!!e?.isAlcohol},ka=e=>Kp(e)?1.1:1.08,jx=e=>String(e||"").trim().replace(/\s+/g," ").toLowerCase(),YN=(e,t)=>{if(!e||e.size===0||!t)return null;const s=e.get(t);if(s)return s;const a=jx(t);if(!a)return null;for(const[o,c]of e.entries())if(jx(o)===a)return c;return null},vi=e=>{const t=parseFloat(e);return Number.isFinite(t)?t:NaN},QN=e=>{const t=vi(e);return!Number.isFinite(t)||t<=0||t>100?100:t},JN=(e,t)=>{const s=t?.yieldPercent??t?.yield_percent??e?.yieldPercent??e?.yield_percent;return QN(s)/100},XN=(e,t,s)=>{const a=vi(e),o=vi(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const c=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(c)?a/o*1e3:["kg","","l",""].includes(c)?a/o:["cl",""].includes(c)?a/o*100:a/o},Cx=(e,t,s,{defaultWeightWhenUnitEmpty:a=!1,forceWeightBased:o=!1,yieldRate:c=1}={})=>{const u=vi(e),h=vi(t);if(!Number.isFinite(u)||!Number.isFinite(h))return NaN;const f=Number.isFinite(c)&&c>0?c:1,p=String(s||"").trim().toLowerCase();return o||!p&&a||["g","","ml","","cc",""].includes(p)?u/1e3*h/f:["cl",""].includes(p)?u*10/1e3*h/f:u*h/f},ZN=(e,t)=>{const s=vi(e?.purchaseCost),a=vi(e?.purchaseCostRef??e?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-t)>.01):!1},e2=2,Mo=Object.freeze({course:"",category:"",storeName:"",servings:"",ingredients:"",ingredientName:"",quantity:"",quantityGram:" (g)",unit:"",purchase:"",cost:"",totalCost:"",instructions:"",sourceRecipe:"",flourGroup:"",otherIngredients:"",scaleMultiplier:"",noSteps:"",print:"",close:""}),kx=Object.keys(Mo),t2=({recipe:e,ownerLabel:t,onBack:s,onEdit:a,onDelete:o,onHardDelete:c,isDeleted:u,onView:h,onDuplicate:f,backLabel:p,onList:m})=>{const{user:g}=xs(),x=qs(),[v,S]=Ue.useState(!1),[w,_]=Ue.useState(!1),[j,E]=Ue.useState(!1),[T,R]=Ue.useState(new Set),[B,F]=Ue.useState(new Set),[$,M]=Ue.useState(new Set),[z,P]=Ue.useState({}),[H,O]=Ue.useState("ORIGINAL"),[q,C]=Ue.useState(!1),[I,L]=Ue.useState(!0),[V,G]=Ue.useState(!1),[Y,Z]=Ue.useState(new Map),[A,U]=Ue.useState({}),[X,se]=Ue.useState(""),[oe,Ce]=Ue.useState(1),[ue,ne]=Ue.useState(""),[we,Le]=Ue.useState(""),ge=Ue.useMemo(()=>{const ae=parseFloat(oe);return isNaN(ae)?1:ae},[oe]),Te=(ae,he)=>{if(!ae)return"";const pe=parseFloat(ae);if(isNaN(pe))return ae;const Ne=pe*parseFloat(he);return Number.isInteger(Ne)?Ne.toString():Ne.toFixed(1).replace(/\.0$/,"")},de=(ae,he)=>{if(!ae)return"";const pe=parseFloat(ae);return isNaN(pe)?ae:(pe*parseFloat(he)).toFixed(2).replace(/\.00$/,"")},[N,ve]=Ue.useState(e),[fe,Q]=Ue.useState(!1),[K,ie]=Ue.useState(!1),re=N||e,ee=H==="ORIGINAL"?N:z[H]||N,le=H==="ORIGINAL"||H==="JA"?Mo:A[H]||Mo,ye=ae=>le[ae]||Mo[ae]||ae;Ue.useEffect(()=>{let ae=!0;return Ln.getAllConversions().then(he=>{ae&&Z(he)}).catch(()=>{ae&&Z(new Map)}),()=>{ae=!1}},[]);const qe=Ue.useMemo(()=>{const ae=(he,pe={})=>{if(!he||typeof he!="object")return he;const Ne=YN(Y,he.name),Be=w_(he.itemCategory??he.item_category??Ne?.itemCategory),it=JN(he,Ne);let et=he;if(Be&&(et={...et,itemCategory:Be,isAlcohol:__.has(Be)}),!Ne||!Ne.packetSize){const Ge=String(he.unit||"").trim();if(pe.forceWeightBased||pe.defaultWeightWhenUnitEmpty&&!Ge){const Zt=Cx(he.quantity,et.purchaseCost,he.unit,{...pe,yieldRate:it}),In=Number.isFinite(Zt)?Math.round(Zt*100)/100:NaN,Xn=vi(et.cost);if(Number.isFinite(In)&&(!Number.isFinite(Xn)||Math.abs(Xn-In)>.01))return{...et,cost:In}}return et}const lt=[Ne.lastPrice,he.purchaseCostRef,he.purchase_cost,he.purchaseCost].find(Ge=>Number.isFinite(vi(Ge))),Mt=XN(lt,Ne.packetSize,Ne.packetUnit);if(!Number.isFinite(Mt)||!ZN(he,Mt))return et;const Tt=Cx(he.quantity,Mt,he.unit,{...pe,yieldRate:it});return{...et,purchaseCost:Math.round(Mt*100)/100,cost:Number.isFinite(Tt)?Math.round(Tt*100)/100:et.cost}};return{...ee,ingredients:(ee.ingredients||[]).map(he=>ae(he)),flours:(ee.flours||[]).map(he=>ae(he,{forceWeightBased:!0})),breadIngredients:(ee.breadIngredients||[]).map(he=>ae(he,{forceWeightBased:!0}))}},[Y,ee]);Ue.useEffect(()=>{ve(e),!e.steps&&!u&&(Q(!0),An.getRecipe(e.id).then(ae=>{ve(ae)}).catch(ae=>{console.error("Failed to load details",ae)}).finally(()=>{Q(!1)}))},[e,u]);const[Re,$e]=Ue.useState(e.tags?.includes("public")||!1),Ke=g?.role==="admin"||e.tags&&e.tags.includes(`owner:${g?.id}`)||g?.displayId&&e.tags&&e.tags.includes(`owner:${g.displayId}`),Et=!(e.tags&&e.tags.some(ae=>ae.startsWith("owner:")))||Ke,Kt=async()=>{const ae=!Re;try{const he=e.tags||[];let pe;ae?pe=[...he,"public"]:pe=he.filter(Ne=>Ne!=="public"),$e(ae),await An.updateRecipe({id:e.id,tags:pe})}catch(he){console.error("Failed to toggle public",he),x.error(""),$e(!ae)}},dt=(ae,he,pe=!1)=>H==="ORIGINAL"||!I||!he||ae===he?ae:r.jsxs(r.Fragment,{children:[ae,pe?r.jsx("br",{}):" ",r.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",he,")"]})]}),bt=(ae,he)=>{const pe=String(ae??"").trim(),Ne=String(he??"").trim();return H==="ORIGINAL"||!I||!Ne||pe===Ne?pe||Ne:`${pe}${Ne}`},mt=ae=>!ae||!Array.isArray(ae.steps)?!1:ae.type==="bread"?Array.isArray(ae.flours)&&Array.isArray(ae.breadIngredients):Array.isArray(ae.ingredients),$t=(ae,he)=>!ae||!he||ae.__translationVersion!==e2||Array.isArray(he.steps)&&!Array.isArray(ae.steps)?!1:he.type==="bread"?!((he.flours||[]).length>0&&(ae.flours||[]).length===0||(he.breadIngredients||[]).length>0&&(ae.breadIngredients||[]).length===0):!((he.ingredients||[]).length>0&&(ae.ingredients||[]).length===0),on=async ae=>{const he=ae.target.value;if(O(he),he==="ORIGINAL")return;let pe=N||e;if(!u&&e?.id&&!mt(pe))try{Q(!0);const it=await An.getRecipe(e.id);it&&(pe=it,ve(it))}catch(it){console.error("Failed to load full recipe for translation",it)}finally{Q(!1)}const Ne=z[he]&&$t(z[he],pe),Be=he!=="JA"&&!A[he];if(!(Ne&&!Be)){C(!0);try{let it=null;if(await Promise.all([(async()=>{if(!Ne)try{const et=await ax.translateRecipe(pe,he);P(Xe=>({...Xe,[he]:et}))}catch(et){it=et}})(),(async()=>{if(Be)try{const et=await ax.translateList(kx.map(lt=>Mo[lt]),he),Xe=kx.reduce((lt,Mt,Tt)=>(lt[Mt]=et[Tt]||Mo[Mt],lt),{});U(lt=>({...lt,[he]:Xe}))}catch(et){console.error("Failed to translate UI labels",et)}})()]),it)throw it}catch(it){console.error(it),x.error(""),O("ORIGINAL")}finally{C(!1)}}},Ot=ae=>{R(he=>{const pe=new Set(he);return pe.has(ae)?pe.delete(ae):pe.add(ae),pe})},gn=ae=>{F(he=>{const pe=new Set(he);return pe.has(ae)?pe.delete(ae):pe.add(ae),pe})},Wt=ae=>{M(he=>{const pe=new Set(he);return pe.has(ae)?pe.delete(ae):pe.add(ae),pe})};Ue.useEffect(()=>{window.scrollTo(0,0),h&&e&&!u&&h(e.id);const ae=document.title;return e&&e.title&&(document.title=e.title),P({}),O("ORIGINAL"),R(new Set),F(new Set),M(new Set),$e(e.tags?.includes("public")||!1),()=>{document.title=ae}},[e.id,e.title]),Ue.useEffect(()=>{e&&e.servings?Le(e.servings.toString()):Le(""),ne("")},[e]);const Dt=()=>{S(!0)},zn=()=>{S(!1),o(e)},hn=()=>{S(!1)},Ct=()=>{E(!0)},ht=()=>{E(!1),c(e)},Vt=()=>{E(!1)},qt=()=>{_(!0)},cn=async()=>{_(!1);try{const ae=await An.duplicateRecipe(e,g);f&&f(ae)}catch(ae){console.error("Duplication failed",ae),x.error("")}},Ft=()=>{_(!1)},_n=Ue.useRef(null),xn=Ue.useRef(null),un=ae=>{xn.current=null,_n.current=ae.targetTouches[0].clientX},Vn=ae=>{xn.current=ae.targetTouches[0].clientX},Ht=()=>{if(!_n.current||!xn.current)return;const ae=_n.current-xn.current,he=_n.current<50,pe=ae<-100;he&&pe&&s()},Cn=ae=>{const he=Math.round(parseFloat(ae)),pe=parseFloat(ue),Ne=parseFloat(we);let Be=null,it=null,et=null;return!isNaN(he)&&!isNaN(Ne)&&Ne>0&&(et=he/Ne),!isNaN(he)&&!isNaN(pe)&&!isNaN(Ne)&&pe>0&&Ne>0&&(it=pe*Ne,Be=he/it*100),r.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[r.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{children:["  ",r.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),r.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[r.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),r.jsx("input",{type:"number",value:ue,onChange:Xe=>ne(Xe.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[r.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),r.jsx("input",{type:"number",value:we,onChange:Xe=>Le(Xe.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),et!==null&&r.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Be!==null?Be>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Be!==null?Be>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Be!==null?"6px":"0"},children:["1(): ",r.jsxs("strong",{children:["",et.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Be!==null&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",it.toLocaleString()]}),r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(it-he).toLocaleString()]}),r.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Be>40?"#d32f2f":"#2e7d32"},children:[": ",Be.toFixed(1),"%"]})]})]})]})]})},It=qe.ingredients||[];let Tn=ee.steps||[];const Kn=ae=>String(ae||"").trim().toLowerCase(),dn=ae=>{const he=Kn(ae);return he?["","","steps","method"].some(pe=>he===pe||he.includes(pe)):!1};if(!Tn.length&&ee.ingredientGroups){const ae=ee.ingredientGroups.find(he=>dn(he.name));if(ae)Tn=It.filter(pe=>pe.groupId===ae.id).map(pe=>typeof pe=="string"?pe:{...pe,text:pe.name||pe.text||""});else{const he=It.filter(pe=>dn(pe.group)||dn(pe.groupName));he.length&&(Tn=he.map(pe=>typeof pe=="string"?pe:{...pe,text:pe.name||pe.text||""}))}}const Xt=Tn,ke=Ue.useMemo(()=>{const ae=ee.ingredientGroups||[],he=["","steps","method",""],pe=Xe=>String(Xe||"").trim().toLowerCase(),Ne=new Set(ae.filter(Xe=>he.includes(pe(Xe.name))).map(Xe=>Xe.id)),Be=ae.filter(Xe=>!Ne.has(Xe.id));if(!Be.length)return[{id:"default",name:null,items:It.filter(Xe=>!Ne.has(Xe.groupId))}];const it=Be.map(Xe=>{const lt=It.filter(Mt=>Mt.groupId===Xe.id);return{id:Xe.id,name:Xe.name===""?null:Xe.name,items:lt}}).filter(Xe=>Xe.items.length>0),et=It.filter(Xe=>Xe.groupId?Ne.has(Xe.groupId)?!1:!Be.some(lt=>lt.id===Xe.groupId):!0);return et.length&&it.push({id:"ungrouped",name:null,items:et}),it.length?it:[{id:"default",name:null,items:It.filter(Xe=>!Ne.has(Xe.groupId))}]},[ee.ingredientGroups,It]),te=Ue.useMemo(()=>{if(ee.type!=="bread")return null;const ae=qe.flours||[],he=qe.breadIngredients||[],pe=ae.reduce((Ge,ct)=>Ge+(parseFloat(ct.quantity)||0),0),Ne=pe+he.reduce((Ge,ct)=>Ge+(parseFloat(ct.quantity)||0),0),Be=parseFloat(X),it=Be&&Ne?Be/Ne:1,et=Ge=>pe?((parseFloat(Ge)||0)/pe*100).toFixed(1):"0.0",Xe=Ge=>Be?((parseFloat(Ge)||0)*it).toFixed(1):Ge,lt=Ge=>{const ct=parseFloat(Ge)||0;if(!Be)return ct;const Zt=ct*it;return Math.round(Zt*100)/100},Mt=Ge=>{const ct=lt(Ge);return Number.isFinite(ct)?ct.toLocaleString(void 0,{maximumFractionDigits:2}):""},Tt=Ge=>Ge.reduce((ct,Zt)=>{const Xn=(parseFloat(Zt.cost)||0)*(Be?it:1),Nr=ka(Zt);return ct+Xn*Nr},0);return{flours:ae,others:he,totalFlour:pe,grandTotal:Ne,calcPercent:et,getScaledQtyValue:Xe,getScaledCostValue:lt,formatCostValue:Mt,scaleFactor:it,totalTaxIncluded:Tt(ae)+Tt(he)}},[qe.breadIngredients,qe.flours,ee.type,X]),je=Ue.useMemo(()=>ee.type==="bread"?0:It.reduce((ae,he)=>{const Ne=(parseFloat(he.cost)||0)*ge,Be=ka(he);return ae+Ne*Be},0),[ee.type,It,ge]),Oe=ee.type==="bread"?te?Math.round(te.totalTaxIncluded).toLocaleString():"0":Math.round(je).toLocaleString(),We=ee.description||re.description;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:un,onTouchMove:Vn,onTouchEnd:Ht,children:[w&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(vn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:Ft,children:""}),r.jsx(ce,{variant:"primary",onClick:cn,children:""})]})]})}),j&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(vn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:Vt,children:""}),r.jsx(ce,{variant:"danger",onClick:ht,children:""})]})]})}),v&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(vn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("small",{style:{color:"#666"},children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:hn,children:""}),r.jsx(ce,{variant:"danger",onClick:zn,children:""})]})]})}),r.jsxs("div",{className:"recipe-detail__header",children:[r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx(ce,{variant:"secondary",onClick:s,size:"sm",children:p||" "}),m&&r.jsx(ce,{variant:"secondary",onClick:m,size:"sm",children:""})]}),!u&&r.jsxs("div",{className:"recipe-detail__actions",children:[Et&&(g?.displayId==="yoshito"||g?.role==="admin")&&r.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:Re,onChange:Kt,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),r.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:Re?"#4CAF50":"#888"},children:Re?"":""})]})}),!Et&&r.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),r.jsxs("select",{className:"language-select",value:H,onChange:on,disabled:q,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[r.jsx("option",{value:"ORIGINAL",children:" Original ()"}),IN.map(ae=>r.jsx("option",{value:ae.code,children:ae.label},ae.code))]}),H!=="ORIGINAL"&&r.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:I,onChange:ae=>L(ae.target.checked),style:{marginRight:"4px"}}),""]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>G(!0),children:" "}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:qt,children:""}),Et&&r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:a,children:""}),r.jsx(ce,{variant:"danger",size:"sm",onClick:Dt,style:{marginLeft:"0.5rem"},children:""})]})]}),u&&r.jsxs("div",{className:"recipe-detail__actions",children:[r.jsx(ce,{variant:"ghost",size:"sm",onClick:Ct,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),r.jsx(ce,{variant:"primary",size:"sm",onClick:()=>o(e,!0),children:""})]})]}),r.jsx("div",{className:"recipe-detail__hero",children:ee.image?r.jsx("img",{src:ee.image,alt:ee.title,className:"recipe-detail__image"}):r.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),r.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[r.jsx("h1",{children:dt(ee.title,re.title)}),r.jsx("p",{className:"recipe-detail__desc",children:dt(ee.description,re.description,!0)}),g?.role==="admin"&&t&&r.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),r.jsxs("div",{className:"recipe-detail__meta",children:[ee.course&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:ye("course")}),r.jsx("span",{className:"meta-value",children:dt(ee.course,re.course)})]}),ee.category&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:ye("category")}),r.jsx("span",{className:"meta-value",children:dt(ee.category,re.category)})]}),ee.storeName&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:ye("storeName")}),r.jsx("span",{className:"meta-value",children:dt(ee.storeName,re.storeName)})]}),r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:ye("servings")}),r.jsxs("span",{className:"meta-value",children:[ee.servings,""]})]})]}),ee.sourceUrl&&r.jsx("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.jsxs("div",{style:{fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"12px"},children:[r.jsxs("a",{href:ee.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",r.jsx("span",{className:"screen-only",children:ye("sourceRecipe")}),r.jsx("span",{className:"print-only",children:ye("sourceRecipe")})]}),r.jsx("button",{onClick:()=>ie(!0),className:"screen-only",style:{background:"none",border:"none",padding:0,color:"var(--color-text-muted)",cursor:"pointer",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"4px",textDecoration:"underline"},children:" QR"})]})})]}),r.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[r.jsxs("span",{children:[" : ",Sx(e.created_at)]}),e.updated_at&&r.jsxs("span",{children:[" : ",Sx(e.updated_at)]})]}),r.jsx("div",{className:"recipe-detail__content",children:r.jsxs("div",{className:"recipe-detail__main",children:[r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:ye("ingredients")}),r.jsx(vn,{className:"ingredients-card",children:ee.type==="bread"?r.jsx("div",{className:"bread-detail-view",children:(()=>{const ae=qe.flours||[],he=qe.breadIngredients||[],pe=ae.reduce((Ge,ct)=>Ge+(parseFloat(ct.quantity)||0),0),Ne=pe+he.reduce((Ge,ct)=>Ge+(parseFloat(ct.quantity)||0),0),Be=pe?(Ne/pe*100).toFixed(1):"0.0",it=Ge=>pe?((parseFloat(Ge)||0)/pe*100).toFixed(1):"0.0",et=parseFloat(X),Xe=et&&Ne?et/Ne:1,lt=Ge=>et?((parseFloat(Ge)||0)*Xe).toFixed(1):Ge,Mt=Ge=>{const ct=parseFloat(Ge)||0;if(!et)return ct;const Zt=ct*Xe;return Math.round(Zt*100)/100},Tt=Ge=>Number.isFinite(Ge)?Ge.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),r.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[Ne.toLocaleString(),"g"]}),r.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Be,"%)"]})]}),r.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("input",{id:"target-total-input",type:"number",value:X,onChange:Ge=>se(Ge.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),r.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),X&&r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>se(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),X&&r.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",Xe.toFixed(3)," "]})]}),r.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[r.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[r.jsx("span",{children:ye("flourGroup")}),r.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",X?lt(pe):pe,"g (100%)"]})]}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:ye("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:ye("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:ye("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:ye("cost")})]})}),r.jsx("tbody",{children:ae.map((Ge,ct)=>{const Zt=re.flours?.[ct]||{};return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`flour-${ct}`}),r.jsx("label",{htmlFor:`flour-${ct}`,children:dt(Ge.name,Zt?.name)})]})}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:X?r.jsx("span",{style:{color:"var(--color-primary)"},children:lt(Ge.quantity)}):Ge.quantity}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[it(Ge.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ps(Ge.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:Ge.cost?`${Tt(Mt(Ge.cost))}`:"-"})]},ct)})})]})]}),r.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[r.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:ye("otherIngredients")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:ye("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:ye("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:ye("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:ye("cost")})]})}),r.jsx("tbody",{children:he.map((Ge,ct)=>{const Zt=re.breadIngredients?.[ct]||{};return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ingredient-${ct}`}),r.jsx("label",{htmlFor:`ingredient-${ct}`,children:dt(Ge.name,Zt?.name)})]})}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:X?r.jsx("span",{style:{color:"var(--color-primary)"},children:lt(Ge.quantity)}):Ge.quantity}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[it(Ge.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ps(Ge.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:Ge.cost?`${Tt(Mt(Ge.cost))}`:"-"})]},ct)})})]}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[ye("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const Ge=Zt=>Zt.reduce((In,Xn)=>{const Nr=parseFloat(Xn.cost)||0,Hr=ka(Xn),zr=Nr*Xe;return In+zr*Hr},0),ct=Ge(ae)+Ge(he);return Math.round(ct).toLocaleString()})()]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const Ge=Zt=>Zt.reduce((In,Xn)=>{const Nr=parseFloat(Xn.cost)||0,Hr=ka(Xn),zr=Nr*Xe;return In+zr*Hr},0),ct=Ge(ae)+Ge(he);return Cn(ct)})()]})]})})()}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[r.jsxs("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:[ye("scaleMultiplier"),":"]}),r.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),r.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:oe,onChange:ae=>Ce(ae.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(oe)!==1&&r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>Ce("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const ae=ee.ingredientGroups&&ee.ingredientGroups.length>0?ee.ingredientGroups:null;return ae?ae.map(he=>{const pe=It.filter(Ne=>Ne.groupId===he.id);return pe.length===0||["","Steps","Method",""].includes(he.name)?null:r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(he.name)?"none":"block"},children:he.name}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:ye("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:ye("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:ye("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:ye("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:ye("cost")})]})}),r.jsx("tbody",{children:pe.map((Ne,Be)=>{const it=It.indexOf(Ne),et=re.ingredients?.[it],Xe=typeof Ne=="string"?Ne:Ne.name,lt=et?typeof et=="string"?et:et.name:"",Mt=typeof Ne=="object"?Ne.unit:"",Tt=et&&typeof et=="object"?et.unit:"",Ge=Te(Ne.quantity,oe),ct=de(Ne.cost,oe),Zt=String(oe)!=="1";return r.jsxs("tr",{className:"ingredient-row",children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ing-${he.id}-${Be}`}),r.jsx("label",{htmlFor:`ing-${he.id}-${Be}`,children:dt(Xe,lt)})]})}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Zt?"bold":"normal",color:Zt?"var(--color-primary)":"inherit"},children:Ge}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:dt(Mt,Tt)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ps(Ne.purchaseCost)??"-"}),r.jsxs("td",{style:{textAlign:"right"},children:[Ps(ct)??"-",Kp(Ne)&&r.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Be)})})]})]},he.id)}):r.jsxs(r.Fragment,{children:[r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:ye("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:ye("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:ye("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:ye("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:ye("cost")})]})}),r.jsx("tbody",{children:It.map((he,pe)=>{const Ne=re.ingredients?.[pe],Be=typeof he=="string"?he:he.name,it=Ne?typeof Ne=="string"?Ne:Ne.name:"",et=typeof he=="object"?he.unit:"",Xe=Ne&&typeof Ne=="object"?Ne.unit:"",lt=Te(he.quantity,oe),Mt=de(he.cost,oe),Tt=String(oe)!=="1";return r.jsxs("tr",{className:"ingredient-row",children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ing-${pe}`}),r.jsx("label",{htmlFor:`ing-${pe}`,children:dt(Be,it)})]})}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Tt?"bold":"normal",color:Tt?"var(--color-primary)":"inherit"},children:lt}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:dt(et,Xe)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ps(he.purchaseCost)??"-"}),r.jsxs("td",{style:{textAlign:"right"},children:[Ps(Mt)??"-",Kp(he)&&r.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},pe)})})]}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[ye("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Math.round((pe=>pe.reduce((Ne,Be)=>{const it=parseFloat(Be.cost)||0,et=ka(Be),Xe=de(it,oe),lt=parseFloat(Xe)||0;return Ne+lt*et},0))(It)).toLocaleString()]})]})]})})(),r.jsx("div",{className:"screen-only no-print",children:r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[ye("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Math.round((he=>he.reduce((pe,Ne)=>{const Be=parseFloat(Ne.cost)||0,it=ka(Ne),et=de(Be,oe),Xe=parseFloat(et)||0;return pe+Xe*it},0))(It)).toLocaleString()]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]})}),r.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const he=(pe=>pe.reduce((Ne,Be)=>{const it=parseFloat(Be.cost)||0,et=ka(Be),Xe=parseFloat(de(it,oe))||0;return Ne+Xe*et},0))(It);return Cn(he)})()]})})]}),r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:ye("instructions")}),(()=>{const ae=ee.stepGroups&&ee.stepGroups.length>0?ee.stepGroups:null,he=ae&&Xt.some(pe=>!pe||typeof pe!="object"||!pe.groupId?!1:ae.some(Ne=>Ne.id===pe.groupId));return ae&&he?r.jsx("div",{className:"steps-container",children:ae.map(pe=>{const Ne=Xt.filter(Be=>(typeof Be=="object"?Be.groupId:null)===pe.id);return Ne.length===0?null:r.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[pe.name!==""&&pe.name!=="Steps"&&r.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:pe.name}),r.jsx("div",{className:"steps-list",children:Ne.map((Be,it)=>{const et=Xt.indexOf(Be),Xe=typeof Be=="object"?Be.text:Be,lt=re.steps?.[et],Mt=typeof lt=="object"?lt.text:lt,Tt=Ge=>Ge?Ge.replace(/<[^>]*>?/gm,""):"";return r.jsxs(vn,{className:`step-card ${T.has(et)?"is-completed":""}`,onClick:()=>Ot(et),children:[r.jsx("div",{className:"step-number",children:et+1}),r.jsx("p",{className:"step-text",children:dt(Tt(Xe),Tt(Mt),!0)})]},it)})})]},pe.id)})}):r.jsx("div",{className:"steps-list",children:Xt.map((pe,Ne)=>{const Be=typeof pe=="object"?pe.text:pe,it=re.steps?.[Ne],et=typeof it=="object"?it.text:it;return r.jsxs(vn,{className:`step-card ${T.has(Ne)?"is-completed":""}`,onClick:()=>Ot(Ne),children:[r.jsx("div",{className:"step-number",children:Ne+1}),r.jsx("p",{className:"step-text",children:dt(Be,et,!0)})]},Ne)})})})()]})]})}),r.jsx(an,{isOpen:V,onClose:()=>G(!1),title:" ",size:"large",children:r.jsxs("div",{className:"print-preview-recipe",children:[r.jsx("div",{className:"preview-header",children:r.jsx("h2",{children:ee.title})}),r.jsxs("div",{className:"preview-meta",children:[ee.course&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ee.course]}),ee.category&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ee.category]}),ee.storeName&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ee.storeName]}),ee.servings&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ee.servings,""]})]}),ee.description&&r.jsx("div",{className:"preview-description",children:r.jsx("p",{children:ee.description})}),r.jsx("div",{className:"preview-controls",children:ee.type==="bread"?r.jsxs("div",{className:"preview-control-row",children:[r.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),r.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:X,onChange:ae=>se(ae.target.value),placeholder:"1000"}),X&&r.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>se(""),children:""}),te?.grandTotal?r.jsxs("span",{className:"preview-control-note",children:[": ",te.grandTotal.toLocaleString(),"g"]}):null]}):r.jsxs("div",{className:"preview-control-row",children:[r.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:ye("scaleMultiplier")}),r.jsx("span",{className:"preview-control-mult",children:""}),r.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:oe,onChange:ae=>Ce(ae.target.value),placeholder:"1"}),String(oe)!=="1"&&r.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>Ce("1"),children:""})]})}),r.jsxs("div",{className:"preview-section",children:[r.jsx("h3",{children:ye("ingredients")}),ee.type==="bread"?r.jsxs("div",{className:"preview-ingredients-bread",children:[r.jsxs("div",{className:"bread-group",children:[r.jsx("h4",{children:ye("flourGroup")}),r.jsxs("table",{className:"preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:ye("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:ye("quantity")})]})}),r.jsx("tbody",{children:(qe.flours||[]).map((ae,he)=>{const pe=`flour-${he}`,Ne=te?te.getScaledQtyValue(ae.quantity):ae.quantity;return r.jsxs("tr",{className:$.has(pe)?"is-completed":"",onClick:()=>Wt(pe),role:"button",tabIndex:0,onKeyDown:Be=>{(Be.key==="Enter"||Be.key===" ")&&(Be.preventDefault(),Wt(pe))},children:[r.jsx("td",{children:ae.name}),r.jsxs("td",{style:{textAlign:"right"},children:[Ne,"g"]})]},he)})})]})]}),r.jsxs("div",{className:"bread-group",children:[r.jsx("h4",{children:ye("otherIngredients")}),r.jsxs("table",{className:"preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:ye("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:ye("quantity")})]})}),r.jsx("tbody",{children:(qe.breadIngredients||[]).map((ae,he)=>{const pe=`bread-${he}`,Ne=te?te.getScaledQtyValue(ae.quantity):ae.quantity;return r.jsxs("tr",{className:$.has(pe)?"is-completed":"",onClick:()=>Wt(pe),role:"button",tabIndex:0,onKeyDown:Be=>{(Be.key==="Enter"||Be.key===" ")&&(Be.preventDefault(),Wt(pe))},children:[r.jsx("td",{children:ae.name}),r.jsxs("td",{style:{textAlign:"right"},children:[Ne,"g"]})]},he)})})]})]})]}):r.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const ae=ee.ingredientGroups&&ee.ingredientGroups.length>0?ee.ingredientGroups:null;return ae?ae.map(he=>{const pe=It.filter(Ne=>Ne.groupId===he.id);return pe.length===0||["","Steps","Method",""].includes(he.name)?null:r.jsxs("div",{className:"ingredient-group",children:[r.jsx("h4",{children:he.name}),r.jsxs("table",{className:"preview-table preview-table--normal",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:ye("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:ye("quantity")}),r.jsx("th",{children:ye("unit")})]})}),r.jsx("tbody",{children:pe.map((Ne,Be)=>{const it=`${he.id}-${Be}`,et=typeof Ne=="string"?Ne:Ne.name,Xe=typeof Ne=="object"?Te(Ne.quantity,ge):"",lt=typeof Ne=="object"?Ne.unit:"";return r.jsxs("tr",{className:$.has(it)?"is-completed":"",onClick:()=>Wt(it),role:"button",tabIndex:0,onKeyDown:Mt=>{(Mt.key==="Enter"||Mt.key===" ")&&(Mt.preventDefault(),Wt(it))},children:[r.jsx("td",{children:et}),r.jsx("td",{style:{textAlign:"right"},children:Xe}),r.jsx("td",{children:lt})]},Be)})})]})]},he.id)}):r.jsxs("table",{className:"preview-table preview-table--normal",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:ye("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:ye("quantity")}),r.jsx("th",{children:ye("unit")})]})}),r.jsx("tbody",{children:It.map((he,pe)=>{const Ne=`ungrouped-${pe}`,Be=typeof he=="string"?he:he.name,it=typeof he=="object"?Te(he.quantity,ge):"",et=typeof he=="object"?he.unit:"";return r.jsxs("tr",{className:$.has(Ne)?"is-completed":"",onClick:()=>Wt(Ne),role:"button",tabIndex:0,onKeyDown:Xe=>{(Xe.key==="Enter"||Xe.key===" ")&&(Xe.preventDefault(),Wt(Ne))},children:[r.jsx("td",{children:Be}),r.jsx("td",{style:{textAlign:"right"},children:it}),r.jsx("td",{children:et})]},pe)})})]})})()})]}),Xt.length>0&&r.jsxs("div",{className:"preview-section",children:[r.jsx("h3",{children:ye("instructions")}),r.jsx("ol",{className:"preview-steps",children:Xt.map((ae,he)=>{const pe=typeof ae=="object"?ae.text:ae;return r.jsx("li",{className:B.has(he)?"is-completed":"",onClick:()=>gn(he),role:"button",tabIndex:0,onKeyDown:Ne=>{(Ne.key==="Enter"||Ne.key===" ")&&(Ne.preventDefault(),gn(he))},children:pe},he)})})]}),r.jsxs("div",{className:"modal-actions",children:[r.jsxs(ce,{variant:"primary",onClick:()=>window.print(),children:[" ",ye("print")]}),r.jsx(ce,{variant:"ghost",onClick:()=>G(!1),children:ye("close")})]})]})})]}),r.jsx(an,{isOpen:K,onClose:()=>ie(!1),title:" QR",size:"small",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",padding:"20px"},children:[r.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"#666",textAlign:"center"},children:["",r.jsx("br",{}),""]}),r.jsx("div",{style:{background:"white",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:r.jsx(wx,{value:ee.sourceUrl||"",size:200})}),r.jsx(ce,{variant:"secondary",onClick:()=>ie(!1),children:""})]})}),r.jsxs("div",{className:"print-layout",children:[r.jsx("div",{className:"recipe-detail__hero",children:ee.image?r.jsx("img",{src:ee.image,alt:ee.title,className:"recipe-detail__image"}):r.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),r.jsxs("div",{className:"recipe-detail__title-card",children:[r.jsx("h1",{children:bt(ee.title,re.title)}),We&&r.jsx("p",{className:"recipe-detail__desc",children:bt(We,re.description)})]}),r.jsxs("div",{className:"recipe-detail__meta",children:[ee.category&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:ye("category")}),r.jsx("span",{className:"meta-value",children:bt(ee.category,re.category)})]}),ee.storeName&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:ye("storeName")}),r.jsx("span",{className:"meta-value meta-value--store",children:bt(ee.storeName,re.storeName)})]}),ee.course&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:ye("course")}),r.jsx("span",{className:"meta-value",children:bt(ee.course,re.course)})]}),ee.servings&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:ye("servings")}),r.jsx("span",{className:"meta-value",children:bt(`${ee.servings}`,re.servings?`${re.servings}`:"")})]})]}),ee.sourceUrl&&r.jsxs("div",{className:"print-layout__source",children:[r.jsx("div",{className:"print-layout__source-label",children:ye("sourceRecipe")}),r.jsx("div",{className:"print-layout__source-qr",children:r.jsx(wx,{value:ee.sourceUrl,size:84,style:{display:"block"}})})]}),r.jsxs("div",{className:"recipe-detail__main",children:[r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:ye("ingredients")}),ee.type==="bread"&&te?r.jsxs("div",{children:[r.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:ye("flourGroup")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:ye("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:ye("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:ye("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:ye("cost")})]})}),r.jsx("tbody",{children:te.flours.map((ae,he)=>{const pe=re.flours?.[he]||{},Ne=te.getScaledQtyValue(ae.quantity),Be=X?"":pe.quantity;return r.jsxs("tr",{children:[r.jsx("td",{children:bt(ae.name,pe.name)}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:bt(Ne,Be)}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[te.calcPercent(ae.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ps(ae.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:ae.cost?`${te.formatCostValue(ae.cost)}`:"-"})]},`print-flour-${he}`)})})]})]}),r.jsxs("div",{className:"bread-section",children:[r.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:ye("otherIngredients")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:ye("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:ye("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:ye("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:ye("cost")})]})}),r.jsx("tbody",{children:te.others.map((ae,he)=>{const pe=re.breadIngredients?.[he]||{},Ne=te.getScaledQtyValue(ae.quantity),Be=X?"":pe.quantity;return r.jsxs("tr",{children:[r.jsx("td",{children:bt(ae.name,pe.name)}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:bt(Ne,Be)}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[te.calcPercent(ae.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ps(ae.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:ae.cost?`${te.formatCostValue(ae.cost)}`:"-"})]},`print-others-${he}`)})})]})]})]}):ke.map(ae=>{const he=re.ingredientGroups?.find(pe=>pe.id===ae.id)?.name||"";return r.jsxs("div",{style:{marginBottom:"1.2rem"},children:[ae.name&&r.jsx("div",{className:"print-group-heading",children:bt(ae.name,he)}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:ye("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:ye("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:ye("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:ye("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:ye("cost")})]})}),r.jsx("tbody",{children:ae.items.map((pe,Ne)=>{const Be=typeof pe=="object"?pe.quantity:"",it=typeof pe=="object"?pe.unit:"",et=typeof pe=="object"?pe.purchaseCost:null,Xe=typeof pe=="object"?pe.cost:null,lt=typeof pe=="string"?pe:pe.name,Mt=typeof pe=="object"?Te(pe.quantity,ge):Be,Tt=It.indexOf(pe),Ge=re.ingredients?.[Tt],ct=Ge?typeof Ge=="string"?Ge:Ge.name:"",Zt=Ge&&typeof Ge=="object"?Ge.unit:"",In=String(ge)==="1"&&Ge&&typeof Ge=="object"?Ge.quantity:"";return r.jsxs("tr",{children:[r.jsx("td",{children:bt(lt,ct)}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:bt(Mt,In)}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:bt(it,Zt)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Ps(et)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:Ps(Xe)??"-"})]},`print-ing-${ae.id}-${Ne}`)})})]})]},ae.id)}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[ye("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Oe]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]}),r.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:ye("instructions")}),Xt.length>0?r.jsx("div",{className:"steps-list",children:Xt.map((ae,he)=>{const pe=typeof ae=="object"?ae.text:ae,Ne=re.steps?.[he],Be=typeof Ne=="object"?Ne?.text:Ne;return r.jsxs("div",{className:"step-card",children:[r.jsx("div",{className:"step-number",children:he+1}),r.jsx("p",{className:"step-text",children:bt(pe,Be)})]},`print-step-${he}`)})}):r.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:ye("noSteps")})]})]})]})]})},S_=e=>{if(e==null)return"";let t=String(e);return t=t.replace(/[-]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[--]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},zt=({label:e,id:t,error:s,textarea:a,wrapperClassName:o,...c})=>{const u=a?"textarea":"input",h=c.type==="number"||c.inputMode==="decimal"||c.inputMode==="numeric",f=p=>{if(!c.onChange)return;if(!h){c.onChange(p);return}const m=p?.target?.value??"",g=S_(m);if(g===m){c.onChange(p);return}c.onChange({target:{id:p?.target?.id,name:p?.target?.name,value:g}})};return r.jsxs("div",{className:`input-group ${s?"input-group--error":""} ${o||""}`,children:[e&&r.jsx("label",{htmlFor:t,className:"input-label",children:e}),r.jsx(u,{id:t,className:`input-field ${c.className||""}`,style:c.style,...c,onChange:f}),s&&r.jsx("span",{className:"input-error",children:s})]})},Cr="app-data",Fn={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:e,error:t}=await Ae.auth.getUser();if(t)throw t;return e?.user?.id||null},_getUserScopedPath(e,t){if(!e)throw new Error("User ID is required");const s=String(t||"").replace(/^\/+/,"");return`${e}/${s}`},clearCache(e=null){e?(this._cacheByUserId.delete(e),this._historyCacheByUserId.delete(e)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(e){const{data:t,error:s}=await Ae.storage.from(Cr).list(e);if(s)return console.warn("Failed to list price files:",s.message),[];if(!t||t.length===0)return[];const a=t.filter(c=>String(c?.name||"").toLowerCase().endsWith(".csv")).map(async c=>{const u=this._getUserScopedPath(e,c.name),{data:h,error:f}=await Ae.storage.from(Cr).download(u);if(f)return console.error(`Failed to download ${c.name}:`,f),null;const p=await h.arrayBuffer();try{const m=new TextDecoder("shift-jis");return{fileName:c.name,text:m.decode(p)}}catch(m){try{const g=new TextDecoder("utf-8");return{fileName:c.name,text:g.decode(p)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",c.name,m),null}}});return(await Promise.all(a)).filter(Boolean)},async fetchPriceList(e=null){const t=e||await this._getCurrentUserId();if(!t)return new Map;const s=this._cacheByUserId.get(t);if(s)return s;try{const a=new Map,o=await this._downloadAllCsvTexts(t);if(!o||o.length===0)return new Map;for(const{text:c}of o){if(!c)continue;const u=this.parseCSV(c);for(const[h,f]of u)if(a.has(h)){const p=a.get(h);(f?.dateStr||"")>(p?.dateStr||"")&&a.set(h,f)}else a.set(h,f)}return this._cacheByUserId.set(t,a),a}catch(a){return console.error("Error in fetchPriceList:",a),new Map}},async getFileList(e=null){try{const t=e||await this._getCurrentUserId();if(!t)return[];const{data:s,error:a}=await Ae.storage.from(Cr).list(t);if(a)throw a;return s.filter(o=>String(o?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(e,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=e.name;this.clearCache(s);const o=this._getUserScopedPath(s,a),{data:c,error:u}=await Ae.storage.from(Cr).upload(o,e,{upsert:!0,contentType:"text/csv"});if(u)throw u;return{success:!0,data:c}}catch(s){return console.error("Error uploading price list:",s),{success:!1,error:s}}},async deletePriceFile(e,t=null){try{const s=t||await this._getCurrentUserId();if(!s)throw new Error("");this.clearCache(s);const a=this._getUserScopedPath(s,e),{data:o,error:c}=await Ae.storage.from(Cr).remove([a]);if(c)throw c;if(!o||o.length===0)throw new Error("");return{success:!0,data:o}}catch(s){return console.error("Error deleting price file:",s),{success:!1,error:s}}},async moveAllToTrash(e){const t=await this._getCurrentUserId();if(!t)throw new Error("");const{data:s,error:a}=await Ae.storage.from(Cr).list(t);if(a)throw a;const o=(s||[]).filter(m=>String(m?.name||"").toLowerCase().endsWith(".csv")),c=o.length;let u=0;if(c===0)return{moved:0};const h=[],f=[];for(const m of o){const g=this._getUserScopedPath(t,m.name);e&&e({total:c,done:u,current:m.name});try{const{data:x,error:v}=await Ae.storage.from(Cr).download(g);if(v)throw v;const S=await x.arrayBuffer();let w="";try{w=new TextDecoder("shift-jis").decode(S)}catch{w=new TextDecoder("utf-8").decode(S)}h.push({user_id:t,file_name:m.name,csv_content:w,original_path:g})}catch(x){console.error("Failed to read file for trash:",m.name,x),f.push(m.name)}u++}if(e&&e({total:c,done:u,current:"..."}),h.length>0){const{error:m}=await Ae.from("trash_price_csvs").insert(h);if(m)throw m}e&&e({total:c,done:u,current:"Storage..."});const p=h.map(m=>m.original_path);if(p.length>0){const{error:m}=await Ae.storage.from(Cr).remove(p);if(m)throw m}return this.clearCache(t),{moved:h.length,failed:f}},async adminClearAllNonAdminCsvs(e){const t=await this._getCurrentUserId();if(!t)throw new Error("");const{data:s,error:a}=await Ae.rpc("admin_list_profiles");if(a)throw a;const o=(s||[]).filter(m=>m.role!=="admin"&&m.id!==t),c=o.length;let u=0;const h=[];for(const m of o){const g=m.id,x=m.email||m.id;e&&e({total:c,done:u,current:x});try{const{data:v,error:S}=await Ae.storage.from(Cr).list(g);if(S){console.warn(`Failed to list files for ${x}:`,S.message),h.push({userId:g,email:x,deleted:0,error:S.message}),u++;continue}const w=(v||[]).filter(E=>String(E?.name||"").toLowerCase().endsWith(".csv"));if(w.length===0){h.push({userId:g,email:x,deleted:0,error:null}),u++;continue}const _=w.map(E=>`${g}/${E.name}`),{error:j}=await Ae.storage.from(Cr).remove(_);j?h.push({userId:g,email:x,deleted:0,error:j.message}):(h.push({userId:g,email:x,deleted:w.length,error:null}),this.clearCache(g))}catch(v){h.push({userId:g,email:x,deleted:0,error:String(v?.message||v)})}u++}e&&e({total:c,done:u,current:""});const f=h.reduce((m,g)=>m+(g.deleted||0),0),p=h.filter(m=>m.error);return{results:h,totalDeleted:f,failedUsers:p}},async adminClearTargetUserCsvs(e,t){const s=await this._getCurrentUserId();if(!s)throw new Error("");if(e===s)throw new Error("");t&&t({total:1,done:0,current:"..."});const{data:a,error:o}=await Ae.storage.from(Cr).list(e);if(o)throw o;const c=(a||[]).filter(p=>String(p?.name||"").toLowerCase().endsWith(".csv"));if(c.length===0)return t&&t({total:1,done:1,current:""}),{deleted:0,error:null};const u=c.length;t&&t({total:u,done:0,current:`... (0/${u})`});const h=c.map(p=>`${e}/${p.name}`),{error:f}=await Ae.storage.from(Cr).remove(h);if(f)throw f;return t&&t({total:u,done:u,current:""}),this.clearCache(e),{deleted:u,error:null}},_splitFileName(e){const t=String(e||""),s=t.lastIndexOf(".");return s<=0?{base:t,ext:""}:{base:t.slice(0,s),ext:t.slice(s)}},_makeCopyFileName(e,t){const s=String(e||"");if(!t?.has?.(s))return s;const{base:a,ext:o}=this._splitFileName(s),c=a||s||"price";let u=1;for(;u<1e3;){const h=u===1?"_copy":`_copy${u}`,f=`${c}${h}${o}`;if(!t.has(f))return f;u++}return`${c}_copy_${Date.now()}${o}`},async copyPriceFilesToUser({targetUserId:e,sourceUserId:t=null,onProgress:s=null}={}){const a=t||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(e||"").trim();if(!o)throw new Error("");if(o===a)throw new Error("");const{data:c,error:u}=await Ae.storage.from(Cr).list(a);if(u)throw u;const h=(c||[]).map(v=>v?.name).filter(Boolean).filter(v=>String(v).toLowerCase().endsWith(".csv")),{data:f,error:p}=await Ae.storage.from(Cr).list(o);let m=new Set;if(p){const v=String(p?.message||"").toLowerCase();if(v.includes("not found")||v.includes("404"))m=new Set;else throw p}else m=new Set((f||[]).map(v=>v?.name).filter(Boolean));const g={sourceUserId:a,targetUserId:o,copied:[],skipped:[],failed:[]},x=h.length;s?.({phase:"start",total:x,done:0,current:""});for(let v=0;v<h.length;v++){const S=h[v],w=this._makeCopyFileName(S,m);m.add(w);const _=this._getUserScopedPath(a,S),j=this._getUserScopedPath(o,w);s?.({phase:"progress",total:x,done:v,current:`${S}  ${w}`,fromFile:S,toFile:w});try{const{data:E,error:T}=await Ae.storage.from(Cr).download(_);if(T)throw T;if(!E)throw new Error("");const{error:R}=await Ae.storage.from(Cr).upload(j,E,{upsert:!1,contentType:"text/csv"});if(R){const B=String(R?.message||"").toLowerCase();if(B.includes("already exists")||B.includes("exists")||B.includes("409")){let F=0,$=R;for(;F<5;){F++;const M=this._makeCopyFileName(S,m);m.add(M);const z=this._getUserScopedPath(o,M),{error:P}=await Ae.storage.from(Cr).upload(z,E,{upsert:!1,contentType:"text/csv"});if(!P){g.copied.push({fromFile:S,toFile:M}),$=null;break}$=P}if($)throw $;continue}throw R}g.copied.push({fromFile:S,toFile:w})}catch(E){console.error("copyPriceFilesToUser failed:",E),g.failed.push({file:S,errorMessage:String(E?.message||E)})}s?.({phase:"progress",total:x,done:v+1,current:`${S}  ${w}`,fromFile:S,toFile:w})}return s?.({phase:"done",total:x,done:x,current:"",result:g}),this.clearCache(o),g},async adminCopyCsvsToAllUsers(e){const t=await this._getCurrentUserId();if(!t)throw new Error("");e?.({phase:"start",message:"..."});const{data:s,error:a}=await Ae.rpc("admin_list_profiles");if(a)throw a;const o=(s||[]).filter(f=>f.role!=="admin"&&f.id!==t),c=o.length;if(c===0)return e?.({phase:"done",message:""}),{success:!0,totalTargetUsers:0,results:[]};const u=[];let h=0;for(const f of o){const p=f.id,m=f.email||p;e?.({phase:"progress_user",totalUser:c,doneUser:h,currentUser:m,message:`${m} ...`});const g=x=>{x.phase==="progress"&&e?.({phase:"progress_file",totalUser:c,doneUser:h,currentUser:m,totalFile:x.total,doneFile:x.done,currentFile:x.current,message:`${m} (${x.done}/${x.total})`})};try{const x=await this.copyPriceFilesToUser({targetUserId:p,sourceUserId:t,onProgress:g});u.push({userId:p,result:x,error:null})}catch(x){u.push({userId:p,result:null,error:String(x?.message||x)})}h++}return e?.({phase:"done",message:""}),{success:!0,totalTargetUsers:c,results:u}},parseCSV(e){const t=new Map,s=e.split(/\r?\n/).filter(o=>o.trim());if(s.length===0)return t;if(s.some(o=>o.startsWith("D,")||o.startsWith('"D",')))for(let o of s){const c=[];let u="",h=!1;for(let _=0;_<o.length;_++){const j=o[_];j==='"'?h=!h:j===","&&!h?(c.push(u),u=""):u+=j}c.push(u);const f=c.map(_=>(_=_.trim(),_.startsWith('"')&&_.endsWith('"')?_.slice(1,-1):_));if(f[0]!=="D")continue;const p=f[1],m=f[8],g=f[14],x=f[18],v=f[20],S=String(g??"").trim(),w=Jt(S);if(w&&x){const _=parseFloat(x);if(!isNaN(_)){const j={price:_,vendor:m,unit:v,dateStr:p,displayName:S};if(t.has(w)){const E=t.get(w);(p||"")>=(E?.dateStr||"")&&t.set(w,j)}else t.set(w,j)}}}else{let o={name:-1,price:-1,unit:-1,vendor:-1},c=0;if(s[0].split(",").map(f=>f.trim().replace(/^"|"$/g,"")).forEach((f,p)=>{["","","","","name","item"].some(m=>f.includes(m))&&(o.name=p),["","","","","price","cost"].some(m=>f.includes(m))&&(o.price=p),["","unit"].some(m=>f.includes(m))&&(o.unit=p),["","","","vendor","supplier"].some(m=>f.includes(m))&&(o.vendor=p)}),o.name===-1&&o.price===-1){o={name:0,price:1,unit:2,vendor:3};const f=s[0].split(",");isNaN(parseFloat(f[1]))&&(c=1)}else c=1;const h=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let f=c;f<s.length;f++){const p=s[f],m=[];let g="",x=!1;for(let R=0;R<p.length;R++){const B=p[R];B==='"'?x=!x:B===","&&!x?(m.push(g),g=""):g+=B}m.push(g);const v=m.map(R=>(R=R.trim(),R.startsWith('"')&&R.endsWith('"')?R.slice(1,-1):R)),S=o.name>-1?v[o.name]:null,w=o.price>-1?v[o.price]:null,_=o.unit>-1?v[o.unit]:"",j=o.vendor>-1?v[o.vendor]:"",E=String(S??"").trim(),T=Jt(E);if(T&&w){const R=parseFloat(w.replace(/[^0-9.]/g,""));isNaN(R)||t.set(T,{price:R,vendor:j,unit:_,dateStr:h,displayName:E})}}}return t},parseCSVEntries(e,t=""){const s=[],a=e.split(/\r?\n/).filter(x=>x.trim());if(a.length===0)return s;const o=x=>{const v=String(x??"").trim();if(!v)return null;const S=parseFloat(v.replace(/[^0-9.]/g,""));return Number.isFinite(S)?S:null},c=x=>{const v=[];let S="",w=!1;for(let _=0;_<x.length;_++){const j=x[_];j==='"'?w=!w:j===","&&!w?(v.push(S),S=""):S+=j}return v.push(S),v.map(_=>(_=_.trim(),_.startsWith('"')&&_.endsWith('"')?_.slice(1,-1):_))},u=x=>{const v=String(x??"").trim();if(!v)return"";const S=v.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(S)return`${S[1]}/${String(S[2]).padStart(2,"0")}/${String(S[3]).padStart(2,"0")}`;const w=v.match(/^(\d{4})(\d{2})(\d{2})$/);return w?`${w[1]}/${w[2]}/${w[3]}`:v};if(a.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of a){const v=c(x);if(v[0]!=="D")continue;const S=u(v[1]),w=v[8],_=v[14],j=v[18],E=o(v[19]),T=v[20],R=String(_??"").trim(),B=Jt(R);if(!B||!j)continue;const F=o(j);Number.isFinite(F)&&s.push({key:B,displayName:R,price:F,vendor:w,unit:T,dateStr:S,incomingQty:E,sourceFile:t})}return s}let f={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},p=0;if(a[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,v)=>{const S=String(x||"").toLowerCase();["","","","","name","item"].some(w=>S.includes(w))&&(f.name=v),["","","","","price","cost"].some(w=>S.includes(w))&&(f.price=v),["","unit"].some(w=>S.includes(w))&&(f.unit=v),["","","","vendor","supplier"].some(w=>S.includes(w))&&(f.vendor=v),["","","","date"].some(w=>S.includes(w))&&(f.date=v),["","","","","","qty","quantity"].some(w=>S.includes(w))&&(f.quantity=v)}),f.name===-1&&f.price===-1){f={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=a[0].split(",");isNaN(parseFloat(x[1]))&&(p=1)}else p=1;const g=u(new Date().toISOString().slice(0,10));for(let x=p;x<a.length;x++){const v=c(a[x]),S=f.name>-1?v[f.name]:null,w=f.price>-1?v[f.price]:null,_=f.unit>-1?v[f.unit]:"",j=f.vendor>-1?v[f.vendor]:"",E=f.date>-1?v[f.date]:"",T=f.quantity>-1?o(v[f.quantity]):null,R=String(S??"").trim(),B=Jt(R);if(!B||!w)continue;const F=o(w);Number.isFinite(F)&&s.push({key:B,displayName:R,price:F,vendor:j,unit:_,dateStr:u(E)||g,incomingQty:T,sourceFile:t})}return s},async fetchPriceHistory(e=null){const t=e||await this._getCurrentUserId();if(!t)return new Map;const s=this._historyCacheByUserId.get(t);if(s)return s;try{const a=await this._downloadAllCsvTexts(t);if(!a||a.length===0)return new Map;const o=new Map;for(const{fileName:c,text:u}of a){if(!u)continue;this.parseCSVEntries(u,c).forEach(f=>{const p=f?.key;p&&(o.has(p)||o.set(p,[]),o.get(p).push(f))})}for(const c of o.values())c.sort((u,h)=>{const f=String(u?.dateStr||""),p=String(h?.dateStr||"");if(f!==p)return f.localeCompare(p);const m=Number(u?.price),g=Number(h?.price);return Number.isFinite(m)&&Number.isFinite(g)&&m!==g?m-g:String(u?.sourceFile||"").localeCompare(String(h?.sourceFile||""))});return this._historyCacheByUserId.set(t,o),o}catch(a){return console.error("Error in fetchPriceHistory:",a),new Map}},async getPriceListArray(e=null){const t=await this.fetchPriceList(e),s=[];for(const[a,o]of t.entries())if(o&&typeof o=="object"){const{displayName:c,...u}=o;s.push({name:c||a,...u})}else s.push({name:a,price:o});return s.sort((a,o)=>a.dateStr&&o.dateStr?o.dateStr.localeCompare(a.dateStr):a.name.localeCompare(o.name))},async getPrice(e,t=null){return e&&(await this.fetchPriceList(t)).get(Jt(e))||null}},Vo={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(e){try{console.log(" Searching DB for:",e);const{data:t,error:s}=await Ae.rpc("search_ingredients",{search_query:e,max_results:15});return s?(console.warn(" Database search failed:",s),console.warn("Error message:",s.message),console.warn("Error code:",s.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(e){const t=String(e||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const s=t.toLowerCase(),a=Jt(t);try{const o=await this._searchFromDatabase(s);if(o&&Array.isArray(o)){this._lastDbResults=o,this._lastDbQuery=s;const u=o.map(_=>({name:_.ingredient_name,price:_.last_price,size:_.packet_size,unit:_.packet_unit,itemCategory:_.item_category||null,source:"manual",displaySource:" "}));if(u.length===0)return await this._fallbackSearch(s);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[_,j]=await Promise.all([Fn.getPriceListArray(),Ln.getAllConversions()]),E=Array.from(j.values()).map(F=>({name:F.ingredientName,price:F.lastPrice,size:F.packetSize,unit:F.packetUnit,itemCategory:F.itemCategory||null,source:"manual",displaySource:" "})),T=_.map(F=>({name:F.name,price:F.price,size:null,unit:F.unit,source:"csv",displaySource:" CSV"})),R=new Set(E.map(F=>F.name)),B=T.filter(F=>!R.has(F.name));this._csvCache=[...E,...B]}const h=_=>{if(!a)return null;const j=String(_||"").indexOf(a);return j<0?null:{tier:_===a?0:j===0?1:2,idx:j,len:String(_||"").length}},f=(_,j)=>_.score.tier!==j.score.tier?_.score.tier-j.score.tier:_.score.idx!==j.score.idx?_.score.idx-j.score.idx:_.score.len!==j.score.len?_.score.len-j.score.len:_.name.localeCompare(j.name,"ja"),p=(_,j,E)=>{let T=0;for(;T<_.length&&f(_[T],j)<=0;)T++;_.splice(T,0,j),_.length>E&&_.pop()},g=Math.max(0,15-u.length),x=new Set(u.map(_=>Jt(_.name))),v=[],S=new Set;if(g>0)for(const _ of this._csvCache){const j=Jt(_?.name);if(!j||x.has(j)||S.has(j))continue;const E=h(j);E&&(S.add(j),p(v,{..._,nameKey:j,score:E},g))}const w=v.map(_=>({name:_.name,price:_.price,size:_.size,unit:_.unit,source:_.source,displaySource:_.displaySource}));return[...u,...w]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",o);const c=await this._fallbackSearch(s);return console.log(" Fallback search returned:",c.length,"results"),c}catch(o){return console.error("Error searching ingredients:",o),[]}},async _fallbackSearch(e){try{const t=Jt(e);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[f,p]=await Promise.all([Fn.getPriceListArray(),Ln.getAllConversions()]);console.log(" CSV Data rows:",f.length),console.log(" Manual Data items:",p.size);const m=Array.from(p.values()).map(S=>({name:S.ingredientName,price:S.lastPrice,size:S.packetSize,unit:S.packetUnit,itemCategory:S.itemCategory||null,source:"manual",displaySource:" "})),g=f.map(S=>({name:S.name,price:S.price,size:null,unit:S.unit,source:"csv",displaySource:" CSV"})),x=new Set(m.map(S=>S.name)),v=g.filter(S=>!x.has(S.name));this._csvCache=[...m,...v],console.log(" Cache built. Total items:",this._csvCache.length)}const s=f=>{if(!t)return null;const p=String(f||"").indexOf(t);return p<0?null:{tier:f===t?0:p===0?1:2,idx:p,len:String(f||"").length}},a=(f,p)=>f.score.tier!==p.score.tier?f.score.tier-p.score.tier:f.score.idx!==p.score.idx?f.score.idx-p.score.idx:f.score.len!==p.score.len?f.score.len-p.score.len:f.name.localeCompare(p.name,"ja"),o=(f,p,m)=>{let g=0;for(;g<f.length&&a(f[g],p)<=0;)g++;f.splice(g,0,p),f.length>m&&f.pop()},c=15,u=[],h=new Set;for(const f of this._csvCache){const p=Jt(f?.name);if(!p||h.has(p))continue;const m=s(p);m&&(h.add(p),o(u,{...f,nameKey:p,score:m},c))}return u.map(f=>({name:f.name,price:f.price,size:f.size,unit:f.unit,itemCategory:f.itemCategory||null,source:f.source,displaySource:f.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},$d=({value:e,onChange:t,placeholder:s,disabled:a,onSelect:o,name:c,required:u=!1,triggerSearchKey:h})=>{const[f,p]=k.useState([]),[m,g]=k.useState(!1),[x,v]=k.useState(-1),S=k.useRef(null),w=k.useRef(null),[_,j]=k.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),E=k.useCallback(()=>{if(S.current){const M=S.current.getBoundingClientRect(),z=8,P=4,H=M.top-z,O=window.innerHeight-M.bottom-z,C=(H>=180||H>=O)&&H>=110,I=Math.max(110,Math.min(280,C?H-P:O-P)),L=M.left,V=Math.max(220,window.innerWidth-z*2),G=Math.min(Math.max(M.width,220),V),Y=Math.min(Math.max(z,L),window.innerWidth-z-G);j({top:C?M.top-P:M.bottom+P,left:Y,width:G,maxHeight:I,placeAbove:C})}},[]);k.useEffect(()=>{const M=H=>{S.current&&!S.current.contains(H.target)&&w.current&&!w.current.contains(H.target)&&g(!1)},z=H=>{w.current&&w.current.contains(H.target)||g(!1)},P=()=>{m&&E()};return document.addEventListener("mousedown",M),window.addEventListener("scroll",z,{capture:!0}),window.addEventListener("resize",P),()=>{document.removeEventListener("mousedown",M),window.removeEventListener("scroll",z,{capture:!0}),window.removeEventListener("resize",P)}},[m,E]),k.useEffect(()=>{m&&E()},[m,f,E]),k.useEffect(()=>{if(h!=null&&String(e||"").trim().length>0){const M=String(e).trim();let z=!1;return(async()=>{const H=++T.current,O=await Vo.search(M);!z&&H===T.current&&(p(O),g(O.length>0),v(-1),E())})(),()=>{z=!0}}},[h]);const T=k.useRef(0),R=k.useRef(null),B=async M=>{const z=M.target.value;if(t(M),R.current&&clearTimeout(R.current),z.length===0){g(!1);return}R.current=setTimeout(async()=>{if(z.length>0){const P=++T.current;console.log(" AutocompleteInput: Fetching suggestions for:",z);const H=await Vo.search(z);console.log(" AutocompleteInput: Got",H.length,"suggestions"),P===T.current&&(p(H),g(H.length>0),v(-1))}},150)},F=M=>{const z={target:{value:M.name}};t(z),g(!1),o&&o(M)},$=M=>{m&&(M.key==="ArrowDown"?(M.preventDefault(),v(z=>z<f.length-1?z+1:z)):M.key==="ArrowUp"?(M.preventDefault(),v(z=>z>0?z-1:-1)):M.key==="Enter"?x>=0&&(M.preventDefault(),F(f[x])):M.key==="Escape"&&g(!1))};return r.jsxs("div",{className:"autocomplete-wrapper",ref:S,children:[r.jsx("input",{type:"text",className:"input-field autocomplete-input",name:c,value:e,onChange:B,onKeyDown:$,onFocus:async()=>{if(e&&e.length>0){E();const M=await Vo.search(e);p(M),g(M.length>0)}else E()},placeholder:s,disabled:a,required:u}),m&&za.createPortal(r.jsx("ul",{className:"suggestions-list",ref:w,style:{position:"fixed",top:`${_.top}px`,left:`${_.left}px`,width:`${_.width}px`,maxHeight:`${_.maxHeight}px`,transform:_.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:f.map((M,z)=>r.jsxs("li",{className:`suggestion-item ${z===x?"selected":""}`,onClick:()=>F(M),onMouseEnter:()=>v(z),children:[r.jsxs("div",{className:"suggestion-main",children:[r.jsx("span",{className:"suggestion-name",children:M.name}),M?.source&&M.source!=="manual"&&r.jsx("span",{className:"suggestion-source",children:M.displaySource})]}),r.jsxs("div",{className:"suggestion-details",children:[M.price&&`${Number(M.price).toLocaleString()}`,M.size&&` / ${M.size}${M.unit}`,!M.size&&M.unit&&` / ${M.unit}`]})]},`${M.source}-${z}`))}),document.body)]})},n2=e=>new Promise((t,s)=>{const a=new FileReader;a.onerror=()=>s(new Error("")),a.onload=()=>{const o=String(a.result||""),c=o.includes(",")?o.split(",")[1]:o;t(c)},a.readAsDataURL(e)}),r2={async transcribe(e,{mimeType:t,fileName:s,language:a="ja",promptContext:o}={}){if(!(e instanceof Blob))throw new Error("");const c=await n2(e);if(!c)throw new Error("");const u={audioBase64:c,mimeType:t||e.type||"audio/webm",fileName:s||"voice-input.webm",language:a,promptContext:o||null},h=25e3,f=Ae.functions.invoke("transcribe",{body:u}),p=new Promise((x,v)=>{setTimeout(()=>v(new Error("")),h)}),{data:m,error:g}=await Promise.race([f,p]);if(g)throw new Error(g.message||"");if(m?.success!==!0)throw new Error(m?.error||"");return String(m?.text||"").trim()}},s2=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"],i2=()=>{if(typeof MediaRecorder>"u")return"";for(const e of s2)if(MediaRecorder.isTypeSupported(e))return e;return""},a2=()=>typeof window>"u"?!1:!!(navigator?.mediaDevices?.getUserMedia&&typeof window.MediaRecorder<"u"),o2=e=>{let t=String(e||"").trim();return t=t.replace(/[]+$/u,""),t.trim()},l2=(e,t)=>{const s=String(e||"").trim(),a=o2(t);return a?s?/[.!?]$/.test(s)?`${s}
${a}`:`${s}
${a}`:a:s},ia=({onTranscript:e,getCurrentValue:t,disabled:s=!1,size:a="sm",className:o="",label:c="",language:u="ja",promptContext:h})=>{const f=qs(),[p,m]=k.useState(!1),[g,x]=k.useState(!1),v=k.useRef(null),S=k.useRef(null),w=k.useRef([]),_=k.useRef(!0),j=k.useRef(!1),E=()=>{const z=S.current;z&&z.getTracks().forEach(P=>P.stop()),S.current=null},T=()=>{v.current=null,w.current=[]},R=()=>{console.warn("[VoiceInputButton] Forcing reset. Mounted:",_.current);try{E(),T()}catch(z){console.error("[VoiceInputButton] cleanup failed:",z)}finally{m(!1),x(!1)}},B=async()=>{if(!p&&!g)return;const z=v.current;if(!z){p&&R();return}try{z.state!=="inactive"?(z.stop(),m(!1),x(!0)):R()}catch(P){console.error("[VoiceInputButton] failed to stop recorder:",P),f.error(""),R()}},F=async()=>{if(!(s||p||g)){if(!a2()){f.error("");return}try{j.current=!1;const z=await navigator.mediaDevices.getUserMedia({audio:!0});S.current=z;const P=i2(),H=P?new MediaRecorder(z,{mimeType:P}):new MediaRecorder(z);w.current=[],H.ondataavailable=O=>{O?.data?.size>0&&w.current.push(O.data)},H.onerror=O=>{console.error("[VoiceInputButton] MediaRecorder error:",O?.error||O),E(),T(),m(!1),x(!1),f.error("")},H.onstop=async()=>{if(j.current){E(),T(),_.current&&(m(!1),x(!1));return}_.current&&(m(!1),x(!0));try{const O=H.mimeType||P||"audio/webm",q=new Blob(w.current,{type:O});if(q.size===0)throw new Error("");const C=await r2.transcribe(q,{mimeType:O,fileName:`voice-input.${O.includes("mp4")?"m4a":"webm"}`,language:u,promptContext:h||void 0});if(!C){f.warning("");return}const I=typeof t=="function"?t():"",L=l2(I,C);e?.(L,C),f.success("")}catch(O){console.error("[VoiceInputButton] transcription failed:",O),f.error(O?.message||"")}finally{try{E()}catch{}try{T()}catch{}m(!1),x(!1)}},v.current=H,H.start(),m(!0)}catch(z){if(console.error("[VoiceInputButton] failed to start recording:",z),z?.name==="NotAllowedError"||z?.name==="SecurityError"){f.error(""),R();return}f.error(""),R()}}};k.useEffect(()=>()=>{_.current=!1,j.current=!0;try{v.current&&v.current.state!=="inactive"&&v.current.stop()}catch{}E(),T()},[]);const $=()=>{if(!s){if(g){R();return}if(p){B();return}F()}},M=g?"...":p?"":c;return r.jsxs(ce,{type:"button",variant:"secondary",size:a,onClick:$,disabled:s,className:["voice-input-btn",p?"is-recording":"",o].filter(Boolean).join(" "),title:p?"":g?"":"",children:[p?"":g?"":""," ",M]})},j_=({isOpen:e,onClose:t,onApply:s,ingredientName:a,currentCost:o,currentQuantity:c,unit:u="g",initialPurchaseCost:h,initialContentAmount:f})=>{const[p,m]=k.useState(""),[g,x]=k.useState(""),[v,S]=k.useState(u),[w,_]=k.useState(""),[j,E]=k.useState(!1),[T,R]=k.useState(!1),B=k.useCallback(async()=>{if(R(!0),_(""),h&&f){m(h),x(f);const O=await Ln.getConversion(a);if(O)S(O.packetUnit||u),_(O.vendor||"");else{S(u);try{const q=await Fn.getPrice(a);_(q?.vendor||"")}catch{}}}else{const O=await Ln.getConversion(a);if(O)x(O.packetSize),S(O.packetUnit||u),O.lastPrice&&m(O.lastPrice),_(O.vendor||"");else try{const q=await Fn.getPrice(a);if(q)if(m(o||q.price),_(q.vendor||""),q.unit){const C=q.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(C){let I=C[1]?parseFloat(C[1]):1,L=C[2]?C[2].trim().toLowerCase():"";L==="kg"?(I*=1e3,L="g"):L==="l"?(I*=1e3,L="ml"):L==="cl"?(I*=10,L="ml"):L==="pk"||L==="pack"?L="":L==="bag"?L="":(L==="pc"||L==="pcs")&&(L=""),x(I),S(L||u)}else x(1),S(q.unit)}else x(""),S(u);else x(""),m(o||""),S(u),_("")}catch(q){console.warn("Failed to load master price:",q),x(""),m(o||""),S(u),_("")}}R(!1)},[a,h,f,u,o]);k.useEffect(()=>{if(!e||!a)return;const O=setTimeout(()=>{B()},0);return()=>clearTimeout(O)},[e,a,B]);const F=()=>{const O=parseFloat(p),q=parseFloat(g);return!O||!q?0:["g","ml","cc"].includes(v)?O/q*1e3:v==="cl"?O/q*100:(["kg","l"].includes(v),O/q)},$=async()=>{const O=F();if(j&&g)try{await Ln.saveConversion(a,g,v,p,null,w)}catch(q){console.error("Failed to save default conversion:",q)}s(O,v,p,g,w),t()};if(!e)return null;const M=F(),z=String(u||"").trim().toLowerCase(),P=c?z==="cl"||z===""?M*(c*10/1e3):["g","ml","cc"].includes(z)?M*(c/1e3):M*c:0,H=r.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:r.jsx("div",{className:"unit-conversion-modal__card",onClick:O=>O.stopPropagation(),children:r.jsxs("div",{className:"unit-conversion-modal__body",children:[r.jsx("h3",{className:"unit-conversion-modal__title",children:""}),r.jsxs("div",{className:"unit-conversion-modal__field",children:[r.jsx("span",{className:"unit-conversion-modal__label",children:""}),r.jsx("div",{className:"unit-conversion-modal__value",children:a||"()"})]}),r.jsxs("div",{className:"unit-conversion-modal__inputs",children:[r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),r.jsx("input",{type:"number",value:p,onChange:O=>m(O.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:""}),r.jsxs("div",{className:"unit-conversion-modal__row",children:[r.jsx("input",{type:"number",value:g,onChange:O=>x(O.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),r.jsxs("select",{value:v,onChange:O=>S(O.target.value),className:"unit-conversion-modal__select",children:[r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:"p"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),!["g","ml","","","","","","cc","cl"].includes(v)&&r.jsx("option",{value:v,children:v})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:""}),r.jsx("input",{type:"text",value:w,onChange:O=>_(O.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),r.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:T?r.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[r.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),r.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(M).toLocaleString()]})]}),c&&r.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[r.jsxs("span",{children:[" (",c,u,"):"]}),r.jsxs("span",{children:["",Math.round(P).toLocaleString()]})]})]})}),r.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[r.jsx("input",{type:"checkbox",id:"saveDefault",checked:j,onChange:O=>E(O.target.checked)}),r.jsxs("span",{children:["(",g,v,")"]})]}),r.jsxs("div",{className:"unit-conversion-modal__actions",children:[r.jsx(ce,{type:"button",variant:"secondary",onClick:t,disabled:T,children:""}),r.jsx(ce,{type:"button",variant:"primary",onClick:$,disabled:!p||!g||T,children:""})]})]})})});return za.createPortal(H,document.body)},_d=["","g","kg","ml","cc","cl","L","","","","","PC","","","","","","","","",""],c2=new Set(["food","alcohol","soft_drink","supplies"]),u2=new Set(["alcohol","supplies"]),C_={food:"",alcohol:"",soft_drink:"",supplies:""},ta=e=>{const t=String(e||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":c2.has(t)?t:"":""},qd=e=>u2.has(e),_p=(e,t)=>{const s=ta(t);return s?{...e,itemCategory:s,isAlcohol:qd(s)}:{...e,itemCategory:null}},fr=e=>{const t=parseFloat(e);return Number.isFinite(t)?t:NaN},d2=e=>{const t=String(e||"").trim().replace(/[]+$/u,""),s=t.match(/(\d+(?:\.\d+)?)/);if(s)return s[1];const a=[["","19"],["","18"],["","17"],["","16"],["","15"],["","14"],["","13"],["","12"],["","11"],["","90"],["","80"],["","70"],["","60"],["","50"],["","40"],["","30"],["","20"],["","10"],["","9"],["","8"],["","7"],["","6"],["","5"],["","4"],["","3"],["","2"],["","1"],["","0"],["","0"]],o=t.replace(/\s+/g,"");for(const[c,u]of a)if(o===c||o.startsWith(c))return u;return t},Wp=e=>{const t=fr(e);return!Number.isFinite(t)||t<=0||t>100?100:t},Ea=(e,t)=>{const s=t?.yieldPercent??t?.yield_percent??e?.yieldPercent??e?.yield_percent;return Wp(s)/100},h2=(e,t,s)=>{const a=fr(e),o=fr(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const c=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(c)?a/o*1e3:["kg","","l",""].includes(c)?a/o:["cl",""].includes(c)?a/o*100:a/o},Ex=(e,t,s,a=!1,o=1)=>{const c=fr(e),u=fr(t);if(!Number.isFinite(c)||!Number.isFinite(u))return NaN;const h=Number.isFinite(o)&&o>0?o:1;if(a)return c/1e3*u/h;const f=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(f)||!f?c/1e3*u/h:["cl",""].includes(f)?c*10/1e3*u/h:c*u/h},f2=(e,t)=>{const s=fr(e?.purchaseCost),a=fr(e?.purchaseCostRef??e?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-t)>.01):!1},Nx=e=>String(e||"").trim().replace(/\s+/g," ").toLowerCase(),fs=(e,t)=>{if(!e||e.size===0||!t)return null;const s=e.get(t);if(s)return s;const a=Nx(t);if(!a)return null;for(const[o,c]of e.entries())if(Nx(o)===a)return c;return null},p2=({formData:e,setFormData:t})=>{const s=qs(),[a,o]=k.useState(new Map),[c,u]=k.useState({isOpen:!1,type:null,index:null}),[h,f]=k.useState({key:0,type:null,index:null}),[p,m]=k.useState(new Map);k.useEffect(()=>{(async()=>{const[H,O]=await Promise.all([Fn.fetchPriceList(),Ln.getAllConversions()]);o(H),m(O)})()},[]);const x=(P=>P.reduce((H,O)=>H+(parseFloat(O.quantity)||0),0))(e.flours||[]),v=P=>!x||x===0?0:((parseFloat(P)||0)/x*100).toFixed(1);k.useEffect(()=>{if(p.size===0)return;const P=(q=[])=>{let C=!1;return{adjusted:q.map(L=>{if(!L||typeof L!="object")return L;const V=fs(p,L.name);let G=L;const Y=ta(L.itemCategory??L.item_category??V?.itemCategory);if(Y){const se=qd(Y);(ta(L.itemCategory??L.item_category)!==Y||!!L.isAlcohol!==se)&&(G={...G,itemCategory:Y,isAlcohol:se})}const Z=Ea(L,V),A=Ex(L.quantity,G.purchaseCost,L.unit,!0,Z),U=Number.isFinite(A)?Math.round(A*100)/100:NaN,X=fr(G.cost);if(Number.isFinite(U)&&(!Number.isFinite(X)||Math.abs(X-U)>.01)&&(G={...G,cost:U}),V&&V.packetSize){const oe=[V.lastPrice,L.purchaseCostRef,L.purchase_cost,L.purchaseCost].find(ue=>Number.isFinite(fr(ue))),Ce=h2(oe,V.packetSize,V.packetUnit);if(Number.isFinite(Ce)&&f2(L,Ce)){const ue=Ea(L,V),ne=Math.round(Ce*100)/100,we=Ex(L.quantity,ne,L.unit,!0,ue),Le=Number.isFinite(we)?Math.round(we*100)/100:G.cost,ge=fr(G.purchaseCost),Te=fr(G.cost),de=!Number.isFinite(ge)||Math.abs(ge-ne)>.01,N=Number.isFinite(fr(Le))&&(!Number.isFinite(Te)||Math.abs(Te-Le)>.01);(de||N)&&(G={...G,purchaseCost:ne,cost:Le})}}return G!==L&&(C=!0),G}),changed:C}},H=P(e.flours||[]),O=P(e.breadIngredients||[]);!H.changed&&!O.changed||t(q=>({...q,flours:H.adjusted,breadIngredients:O.adjusted}))},[p,e.breadIngredients,e.flours,t]);const S=(P,H,O)=>{const q=[...e.flours||[]];if(q[P]={...q[P],[H]:O},H==="name"){const C=a.get(Jt(O));if(C){const I=typeof C=="object"?C.price:C,L=typeof C=="object"?C.vendor:null,V=typeof C=="object"?C.unit:null;q[P].purchaseCostRef=I,q[P].vendorRef=L;const G=fs(p,O);if(G&&G.packetSize){let Z=0;const A=G.lastPrice!==null&&G.lastPrice!==void 0&&G.lastPrice!==""?G.lastPrice:I,U=(G.packetUnit||"").trim().toLowerCase();["g",""].includes(U)?Z=A/G.packetSize*1e3:["kg",""].includes(U)?Z=A/G.packetSize:["ml","","cc",""].includes(U)?Z=A/G.packetSize*1e3:["l",""].includes(U)?Z=A/G.packetSize:["cl",""].includes(U)?Z=A/G.packetSize*100:Z=A/G.packetSize,q[P].purchaseCost=Math.round(Z*100)/100,q[P].unit="g"}else q[P].purchaseCost||(q[P].purchaseCost=I,!q[P].unit&&V&&(q[P].unit=V));const Y=ta(G?.itemCategory);Y?q[P]=_p(q[P],Y):q[P].itemCategory=null}else q[P].purchaseCostRef=null,q[P].vendorRef=null,q[P].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(H)||H==="name"){const C=q[P],I=parseFloat(C.quantity),L=parseFloat(C.purchaseCost);if(!isNaN(I)&&!isNaN(L)){let V=0;const G=(C.unit||"").trim().toLowerCase();G==="g"||G===""||G==="ml"||G===""||G==="cc"||G===""||!G?V=I/1e3*L:G==="cl"||G===""?V=I*10/1e3*L:V=I*L;const Y=fs(p,C.name),Z=Ea(C,Y),A=Number.isFinite(Z)&&Z>0?Z:1,U=Math.round(V/A*100)/100;U!==C.cost&&(q[P].cost=U)}}t(C=>({...C,flours:q}))},w=(P,H,O)=>{const q=[...e.breadIngredients||[]];if(q[P]={...q[P],[H]:O},H==="name"){const C=a.get(Jt(O));if(C){const I=typeof C=="object"?C.price:C,L=typeof C=="object"?C.vendor:null,V=typeof C=="object"?C.unit:null;q[P].purchaseCostRef=I,q[P].vendorRef=L;const G=fs(p,O);if(G&&G.packetSize){let Z=0;const A=G.lastPrice!==null&&G.lastPrice!==void 0&&G.lastPrice!==""?G.lastPrice:I,U=(G.packetUnit||"").trim().toLowerCase();["g",""].includes(U)?(Z=A/G.packetSize*1e3,q[P].unit="g"):["kg",""].includes(U)?(Z=A/G.packetSize,q[P].unit="g"):["ml","","cc",""].includes(U)?(Z=A/G.packetSize*1e3,q[P].unit="ml"):["l",""].includes(U)?(Z=A/G.packetSize,q[P].unit="ml"):(Z=A/G.packetSize,q[P].unit=G.packetUnit),q[P].purchaseCost=Math.round(Z*100)/100}else q[P].purchaseCost||(q[P].purchaseCost=I,!q[P].unit&&V&&(q[P].unit=V));const Y=ta(G?.itemCategory);Y?q[P]=_p(q[P],Y):q[P].itemCategory=null}else q[P].purchaseCostRef=null,q[P].vendorRef=null,q[P].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(H)||H==="name"){const C=q[P],I=parseFloat(C.quantity),L=parseFloat(C.purchaseCost);if(!isNaN(I)&&!isNaN(L)){let V=0;const G=C.unit?C.unit.trim().toLowerCase():"g";G==="g"||G===""||G==="ml"||G===""||G==="cc"||G===""?V=I/1e3*L:V=I*L;const Y=fs(p,C.name),Z=Ea(C,Y),A=Number.isFinite(Z)&&Z>0?Z:1,U=Math.round(V/A*100)/100;U!==C.cost&&(q[P].cost=U)}}t(C=>({...C,breadIngredients:q}))},_=(P,H,O)=>{const q=d2(O),C=fr(q);if(!Number.isFinite(C)||C<0){s.warning("1015");return}P(H,"quantity",String(q))},j=()=>{t(P=>({...P,flours:[...P.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},E=()=>{t(P=>({...P,breadIngredients:[...P.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},T=P=>{t(H=>({...H,flours:H.flours.filter((O,q)=>q!==P)}))},R=P=>{t(H=>({...H,breadIngredients:H.breadIngredients.filter((O,q)=>q!==P)}))},B=Pa(Or(tl,{activationConstraint:{distance:10}}),Or(nl,{activationConstraint:{delay:250,tolerance:5}}),Or(el,{coordinateGetter:Id})),F=P=>{const{active:H,over:O}=P;H.id!==O.id&&t(q=>{const I=q.flours.some(G=>G.id===H.id)?"flours":"breadIngredients",L=q[I].findIndex(G=>G.id===H.id),V=q[I].findIndex(G=>G.id===O.id);return L!==-1&&V!==-1?{...q,[I]:aa(q[I],L,V)}:q})};k.useEffect(()=>{if(!e.flours)t(P=>({...P,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const P=e.flours.map(H=>H.id?H:{...H,id:crypto.randomUUID()});JSON.stringify(P)!==JSON.stringify(e.flours)&&t(H=>({...H,flours:P}))}if(!e.breadIngredients)t(P=>({...P,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const P=e.breadIngredients.map(H=>H.id?H:{...H,id:crypto.randomUUID()});JSON.stringify(P)!==JSON.stringify(e.breadIngredients)&&t(H=>({...H,breadIngredients:P}))}},[]);const $=(P,H,O,q)=>{const{type:C,index:I}=c;t(L=>{if(C==="flour"){const V=[...L.flours],G={...V[I],purchaseCost:P,unit:H,purchase_cost:O,content_amount:q},Y=parseFloat(G.quantity),Z=parseFloat(P);if(!isNaN(Y)&&!isNaN(Z)){let A=0;H==="g"||H===""?A=Y/1e3*Z:A=Y*Z;const U=fs(p,G.name),X=Ea(G,U),se=Number.isFinite(X)&&X>0?X:1;G.cost=Math.round(A/se*100)/100}return V[I]=G,Ln.getAllConversions().then(A=>m(A)),Vo.invalidateCache(),{...L,flours:V}}else if(C==="ingredient"){const V=[...L.breadIngredients],G={...V[I],purchaseCost:P,unit:H,purchase_cost:O,content_amount:q},Y=parseFloat(G.quantity),Z=parseFloat(P);if(!isNaN(Y)&&!isNaN(Z)){let A=0;H==="g"||H===""?A=Y/1e3*Z:A=Y*Z;const U=fs(p,G.name),X=Ea(G,U),se=Number.isFinite(X)&&X>0?X:1;G.cost=Math.round(A/se*100)/100}return V[I]=G,Ln.getAllConversions().then(A=>m(A)),Vo.invalidateCache(),{...L,breadIngredients:V}}return L})},M=(P,H,O)=>{O&&t(q=>{const C=P==="flour"?"flours":"breadIngredients",I=[...q[C]||[]],L={...I[H]};if(L.name=O.name,L.itemCategory=null,O.price!==void 0&&O.price!==null&&O.price!==""){L.purchaseCostRef=O.price,L.vendorRef=O.source==="csv"?"CSV":"Master";let Z=O.price,A=O.unit;if(O.source==="manual")if(O.size&&O.size>0){const U=(O.unit||"").trim().toLowerCase();["g",""].includes(U)?(Z=O.price/O.size*1e3,A="g"):["kg",""].includes(U)?(Z=O.price/O.size,A="g"):["ml","","cc",""].includes(U)?(Z=O.price/O.size*1e3,A="ml"):["l",""].includes(U)?(Z=O.price/O.size,A="ml"):["cl",""].includes(U)?(Z=O.price/O.size*100,A="ml"):(Z=O.price/O.size,A=O.unit)}else Z=O.price,A=O.unit;else{const U=fs(p,O.name);if(U&&U.packetSize){const X=U.lastPrice!==null&&U.lastPrice!==void 0&&U.lastPrice!==""?U.lastPrice:O.price,se=(U.packetUnit||"").trim().toLowerCase();["g",""].includes(se)?(Z=X/U.packetSize*1e3,A="g"):["kg",""].includes(se)?(Z=X/U.packetSize,A="g"):["ml","","cc",""].includes(se)?(Z=X/U.packetSize*1e3,A="ml"):["l",""].includes(se)?(Z=X/U.packetSize,A="ml"):["cl",""].includes(se)?(Z=X/U.packetSize*100,A="ml"):(Z=X/U.packetSize,A=U.packetUnit)}else Z=O.price,A=O.unit}L.purchaseCost=Math.round(Z*100)/100,P==="flour"?L.unit="g":A&&(L.unit=A)}const V=ta(O.itemCategory??O.item_category??fs(p,O.name)?.itemCategory);if(V){const Z=_p(L,V);Object.assign(L,Z)}const G=parseFloat(L.quantity),Y=parseFloat(L.purchaseCost);if(!isNaN(G)&&!isNaN(Y)){const Z=fs(p,L.name),A=Ea(L,Z),U=Number.isFinite(A)&&A>0?A:1,X=(L.unit||"").trim().toLowerCase();let se=0;X==="g"||X===""||X==="ml"||X===""||X==="cc"||X===""?se=G/1e3*Y:X==="cl"||X===""?se=G*10/1e3*Y:se=G*Y,L.cost=Math.round(se/U*100)/100}return I[H]=L,{...q,[C]:I}})},z=c.isOpen&&c.index!==null?c.type==="flour"?e.flours[c.index]:e.breadIngredients[c.index]:null;return r.jsxs("div",{className:"bread-form",children:[r.jsxs(vn,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[r.jsxs("div",{className:"bread-header",children:[r.jsxs("h3",{children:[" (Total: ",x,"g)"]}),r.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),r.jsxs("div",{className:"recipe-scroll-wrapper",children:[r.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[r.jsx("span",{})," ",r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{className:"text-center",children:"%"}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsx("div",{className:"bread-grid-body",children:r.jsx(ra,{sensors:B,collisionDetection:pd,onDragEnd:F,id:"flours-dnd",children:r.jsx(Ba,{items:e.flours||[],strategy:Ko,children:(e.flours||[]).map((P,H)=>{const O=fs(p,P?.name),q=Wp(O?.yieldPercent??O?.yield_percent??P?.yieldPercent??P?.yield_percent);return r.jsx(m2,{id:P.id,index:H,item:P,yieldPercentApplied:q,onChange:S,onRemove:T,onSelect:M,calculatePercentage:v,floursLength:(e.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:H}),onQuantityVoiceTranscript:(C,I)=>_(S,C,I),onNameVoiceComplete:(C,I)=>f(L=>({key:L.key+1,type:C,index:I})),voiceSearchTrigger:h},P.id)})})})})]}),r.jsx(ce,{type:"button",variant:"secondary",size:"sm",onClick:j,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),r.jsxs(vn,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[r.jsxs("div",{className:"bread-header",children:[r.jsx("h3",{children:""}),r.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),r.jsxs("div",{className:"recipe-scroll-wrapper",children:[r.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[r.jsx("span",{})," ",r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{className:"text-center",children:"%"}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsx("div",{className:"bread-grid-body",children:r.jsx(ra,{sensors:B,collisionDetection:pd,onDragEnd:F,id:"breadIngredients-dnd",children:r.jsx(Ba,{items:e.breadIngredients||[],strategy:Ko,children:(e.breadIngredients||[]).map((P,H)=>{const O=fs(p,P?.name),q=Wp(O?.yieldPercent??O?.yield_percent??P?.yieldPercent??P?.yield_percent);return r.jsx(g2,{id:P.id,index:H,item:P,yieldPercentApplied:q,onChange:w,onRemove:R,onSelect:M,calculatePercentage:v,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:H}),onQuantityVoiceTranscript:(C,I)=>_(w,C,I),onNameVoiceComplete:(C,I)=>f(L=>({key:L.key+1,type:C,index:I})),voiceSearchTrigger:h},P.id)})})})})]}),r.jsx(ce,{type:"button",variant:"secondary",size:"sm",onClick:E,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),r.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:r.jsx(ce,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),r.jsx(j_,{isOpen:c.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:$,ingredientName:z?.name||"",currentCost:z?.purchaseCost,currentQuantity:z?.quantity,unit:z?.unit||"g",initialPurchaseCost:z?.purchase_cost,initialContentAmount:z?.content_amount})]})},m2=({id:e,index:t,item:s,yieldPercentApplied:a,onChange:o,onRemove:c,onSelect:u,calculatePercentage:h,floursLength:f,onOpenConversion:p,onQuantityVoiceTranscript:m,onNameVoiceComplete:g,voiceSearchTrigger:x})=>{const v=ta(s.itemCategory??s.item_category),S=!!v,w=C_[v]||"",_=S?`${w}${qd(v)?"10%":"8%"}`:"",{attributes:j,listeners:E,setNodeRef:T,transform:R,transition:B,isDragging:F}=$a({id:e}),$={transform:Vr.Transform.toString(R),transition:B,opacity:F?.5:1,position:"relative",zIndex:F?999:"auto"};return r.jsxs("div",{ref:T,style:$,className:"form-ingredient-row--bread",children:[r.jsx("div",{...j,...E,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx($d,{value:s.name,onChange:M=>o(t,"name",M.target.value),onSelect:M=>u("flour",t,M),placeholder:": ",triggerSearchKey:x?.type==="flour"&&x?.index===t?x.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(ia,{size:"xs",label:"",getCurrentValue:()=>s.name,onTranscript:M=>{o(t,"name",M),g&&g("flour",t)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(zt,{type:"number",step:"any",value:s.quantity,onChange:M=>o(t,"quantity",M.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin",style:{width:"100%",minWidth:0}}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(ia,{size:"xs",label:"",getCurrentValue:()=>s.quantity,onTranscript:(M,z)=>m&&m(t,z),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:s.unit??"",onChange:M=>o(t,"unit",M.target.value),className:"input-field",style:{width:"100%",textAlign:"center",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),_d.filter(M=>M).map(M=>r.jsx("option",{value:M,children:M},M)),s.unit&&!_d.includes(s.unit)&&r.jsx("option",{value:s.unit,children:s.unit})]})}),r.jsxs("div",{className:"bread-percent",children:[h(s.quantity),"%"]}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[r.jsx(zt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:M=>o(t,"purchaseCost",M.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",onClick:p,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),r.jsxs("div",{className:"ingredient-cost",children:[r.jsx(zt,{type:"number",step:"any",value:s.cost||"",onChange:M=>o(t,"cost",M.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(fr(a))&&fr(a)<99.999&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const M=fr(a),z=Math.round(M*10)/10;return`${Number.isInteger(z)?Math.round(z):z}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:M=>o(t,"isAlcohol",M.target.checked),disabled:S,style:{cursor:S?"not-allowed":"pointer"},title:S?`${_}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:f>1&&r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>c(t),children:""})})]})},g2=({id:e,index:t,item:s,yieldPercentApplied:a,onChange:o,onRemove:c,onSelect:u,calculatePercentage:h,onOpenConversion:f,onQuantityVoiceTranscript:p,onNameVoiceComplete:m,voiceSearchTrigger:g})=>{const x=ta(s.itemCategory??s.item_category),v=!!x,S=C_[x]||"",w=v?`${S}${qd(x)?"10%":"8%"}`:"",{attributes:_,listeners:j,setNodeRef:E,transform:T,transition:R,isDragging:B}=$a({id:e}),F={transform:Vr.Transform.toString(T),transition:R,opacity:B?.5:1,position:"relative",zIndex:B?999:"auto"};return r.jsxs("div",{ref:E,style:F,className:"form-ingredient-row--bread",children:[r.jsx("div",{..._,...j,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx($d,{value:s.name,onChange:$=>o(t,"name",$.target.value),onSelect:$=>u("ingredient",t,$),placeholder:": ",triggerSearchKey:g?.type==="ingredient"&&g?.index===t?g.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(ia,{size:"xs",label:"",getCurrentValue:()=>s.name,onTranscript:$=>{o(t,"name",$),m&&m("ingredient",t)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(zt,{type:"number",step:"any",value:s.quantity,onChange:$=>o(t,"quantity",$.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin",style:{width:"100%",minWidth:0}}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(ia,{size:"xs",label:"",getCurrentValue:()=>s.quantity,onTranscript:($,M)=>p&&p(t,M),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:s.unit??"",onChange:$=>o(t,"unit",$.target.value),className:"input-field",style:{width:"100%",textAlign:"center",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),_d.filter($=>$).map($=>r.jsx("option",{value:$,children:$},$)),s.unit&&!_d.includes(s.unit)&&r.jsx("option",{value:s.unit,children:s.unit})]})}),r.jsxs("div",{className:"bread-percent",children:[h(s.quantity),"%"]}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[r.jsx(zt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:$=>o(t,"purchaseCost",$.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),r.jsxs("div",{className:"ingredient-cost",children:[r.jsx(zt,{type:"number",step:"any",value:s.cost||"",onChange:$=>o(t,"cost",$.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(fr(a))&&fr(a)<99.999&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const $=fr(a),M=Math.round($*10)/10;return`${Number.isInteger(M)?Math.round(M):M}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:$=>o(t,"isAlcohol",$.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${w}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>c(t),children:""})})]})},Ax=["","g","kg","ml","cc","cl","L","","","","","PC","","","","","","","","",""],y2=new Set(["food","alcohol","soft_drink","supplies"]),v2=new Set(["alcohol","supplies"]),x2={food:"",alcohol:"",soft_drink:"",supplies:""},Bo=e=>{const t=String(e||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":y2.has(t)?t:"":""},wd=e=>v2.has(e),Tx=(e,t)=>{const s=Bo(t);return s?{...e,itemCategory:s,isAlcohol:wd(s)}:{...e,itemCategory:null}},Rx=e=>String(e||"").trim().replace(/\s+/g," ").toLowerCase(),ci=(e,t)=>{if(!e||e.size===0||!t)return null;const s=e.get(t);if(s)return s;const a=Rx(t);if(!a)return null;for(const[o,c]of e.entries())if(Rx(o)===a)return c;return null},Er=e=>{const t=parseFloat(e);return Number.isFinite(t)?t:NaN},b2=e=>{const t=String(e||"").trim().replace(/[]+$/u,""),s=t.match(/(\d+(?:\.\d+)?)/);if(s)return s[1];const a=[["","19"],["","18"],["","17"],["","16"],["","15"],["","14"],["","13"],["","12"],["","11"],["","90"],["","80"],["","70"],["","60"],["","50"],["","40"],["","30"],["","20"],["","10"],["","9"],["","8"],["","7"],["","6"],["","5"],["","4"],["","3"],["","2"],["","1"],["","0"],["","0"]],o=t.replace(/\s+/g,"");for(const[c,u]of a)if(o===c||o.startsWith(c))return u;return t},k_=e=>{const t=Er(e);return!Number.isFinite(t)||t<=0||t>100?100:t},No=(e,t)=>{const s=t?.yieldPercent??t?.yield_percent??e?.yieldPercent??e?.yield_percent;return k_(s)/100},_2=(e,t,s)=>{const a=Er(e),o=Er(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const c=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(c)?a/o*1e3:["kg","","l",""].includes(c)?a/o:["cl",""].includes(c)?a/o*100:a/o},wp=(e,t,s,a=1)=>{const o=Er(e),c=Er(t);if(!Number.isFinite(o)||!Number.isFinite(c))return NaN;const u=String(s||"").trim().toLowerCase();let h=0;["g","","ml","","cc",""].includes(u)?h=o/1e3*c:["cl",""].includes(u)?h=o*10/1e3*c:h=o*c;const f=Number.isFinite(a)&&a>0?a:1;return h/f},w2=(e,t)=>{const s=Er(e?.purchaseCost),a=Er(e?.purchaseCostRef??e?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-t)>.01):!1},S2=Ue.memo(({id:e,index:t,item:s,groupId:a,yieldPercentApplied:o,onChange:c,onRemove:u,handleSuggestionSelect:h,onOpenConversion:f,onQuantityVoiceTranscript:p,onNameVoiceComplete:m,voiceSearchTrigger:g})=>{const x=Bo(s.itemCategory??s.item_category),v=!!x,S=x2[x]||"",w=v?`${S}${wd(x)?"10%":"8%"}`:"",_=v?wd(x):!!s.isAlcohol,{attributes:j,listeners:E,setNodeRef:T,transform:R,transition:B,isDragging:F}=$a({id:e,data:{groupId:a,index:t}}),$={transform:Vr.Translate.toString(R),transition:B,opacity:F?.3:1,position:"relative",zIndex:F?999:"auto"};return r.jsxs("div",{ref:T,style:$,className:"form-ingredient-row",children:[r.jsx("div",{...j,...E,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx($d,{value:s.name,onChange:M=>c(a,t,"name",M.target.value),onSelect:M=>h(a,t,M),placeholder:"",triggerSearchKey:g?.groupId===a&&g?.index===t?g.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(ia,{size:"xs",label:"",getCurrentValue:()=>s.name,onTranscript:M=>{c(a,t,"name",M),m&&m(a,t)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(zt,{value:s.quantity,onChange:M=>c(a,t,"quantity",M.target.value),placeholder:"0",style:{width:"100%",minWidth:0},wrapperClassName:"input-group--no-margin"}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(ia,{size:"xs",label:"",getCurrentValue:()=>s.quantity,onTranscript:(M,z)=>p(a,t,z),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:s.unit??"",onChange:M=>c(a,t,"unit",M.target.value),className:"input-field",style:{width:"100%",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),Ax.filter(M=>M).map(M=>r.jsx("option",{value:M,children:M},M)),s.unit&&!Ax.includes(s.unit)&&r.jsx("option",{value:s.unit,children:s.unit})]})}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[r.jsx(zt,{type:"number",value:s.purchaseCost,onChange:M=>c(a,t,"purchaseCost",M.target.value),step:"0.01",placeholder:s.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},title:s.purchaseCostRef?`: ${s.purchaseCostRef}${s.vendorRef?` (${s.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&r.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",s.purchaseCostRef]})]}),r.jsxs("div",{className:"ingredient-cost","data-label":"",children:[r.jsx(zt,{type:"number",step:"0.01",value:s.cost,onChange:M=>c(a,t,"cost",M.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(Er(o))&&Er(o)<99.999&&r.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const M=Er(o),z=Math.round(M*10)/10;return`${Number.isInteger(z)?Math.round(z):z}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:_,onChange:M=>c(a,t,"isAlcohol",M.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${w}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(a,t),children:""})})]})},(e,t)=>(a=>a&&a.groupId===t.groupId&&a.index===t.index)(t.voiceSearchTrigger)&&e.voiceSearchTrigger?.key!==t.voiceSearchTrigger?.key?!1:e.id===t.id&&e.index===t.index&&e.groupId===t.groupId&&e.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(e.item)===JSON.stringify(t.item)),j2=({section:e,sections:t,onSectionChange:s,onRemoveSection:a,children:o})=>{const{setNodeRef:c}=Ac({id:e.id});return r.jsxs(vn,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[r.jsx(zt,{value:e.name,onChange:u=>s(e.id,u.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),r.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&r.jsx("button",{type:"button",onClick:()=>a(e.id),className:"group-delete-btn",children:""})})]}),r.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[r.jsx("span",{}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsxs("div",{ref:c,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,e.items.length===0&&r.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},C2=({formData:e,setFormData:t,priceList:s})=>{const a=qs(),[o,c]=k.useState(new Map);k.useEffect(()=>{Ln.getAllConversions().then(M=>c(M))},[]);const[u,h]=k.useState({isOpen:!1,groupId:null,index:null}),[f,p]=k.useState({key:0,groupId:null,index:null});k.useEffect(()=>{if(!e.ingredientSections){const M=e.ingredientGroups||[{id:"default",name:""}],z=e.ingredients||[],P=M.map(q=>({id:q.id,name:q.name,items:z.filter(C=>q.id==="default"&&!C.groupId?!0:C.groupId===q.id)})),H=new Set(P.flatMap(q=>q.items.map(C=>C.id))),O=z.filter(q=>!H.has(q.id));O.length>0&&(P.length>0?P[0].items.push(...O):P.push({id:"default",name:"",items:O})),P.length===0&&P.push({id:crypto.randomUUID(),name:"",items:[]}),t(q=>({...q,ingredientSections:P}))}},[e.ingredients,e.ingredientGroups,e.ingredientSections,t]);const m=e.ingredientSections||[];k.useEffect(()=>{if(!e.ingredientSections||e.ingredientSections.length===0||o.size===0)return;let M=!1;const z=e.ingredientSections.map(P=>{const H=P.items.map(O=>{if(!O||typeof O!="object")return O;const q=ci(o,O.name);let C=O;const I=Bo(O.itemCategory??O.item_category??q?.itemCategory);if(I){const V=wd(I);(Bo(O.itemCategory??O.item_category)!==I||!!O.isAlcohol!==V)&&(C={...C,itemCategory:I,isAlcohol:V})}if(q&&q.packetSize){const G=[q.lastPrice,O.purchaseCostRef,O.purchase_cost,O.purchaseCost].find(Z=>Number.isFinite(Er(Z))),Y=_2(G,q.packetSize,q.packetUnit);if(Number.isFinite(Y)&&w2(O,Y)){const Z=No(O,q),A=Math.round(Y*100)/100,U=wp(O.quantity,A,O.unit,Z),X=Number.isFinite(U)?Math.round(U*100)/100:C.cost,se=Er(C.purchaseCost),oe=Er(C.cost),Ce=!Number.isFinite(se)||Math.abs(se-A)>.01,ue=Number.isFinite(Er(X))&&(!Number.isFinite(oe)||Math.abs(oe-X)>.01);(Ce||ue)&&(C={...C,purchaseCost:A,cost:X})}}const L=No(O,q);if(Number.isFinite(L)&&L>0&&Math.abs(L-1)>1e-4){const V=wp(O.quantity,C.purchaseCost,O.unit,L),G=wp(O.quantity,C.purchaseCost,O.unit,1),Y=Er(C.cost);if(Number.isFinite(V)&&(!Number.isFinite(Y)||Number.isFinite(G)&&Math.abs(Y-G)<=.01)){const A=Math.round(V*100)/100,U=Er(C.cost);(!Number.isFinite(U)||Math.abs(U-A)>.01)&&(C={...C,cost:A})}}return C!==O&&(M=!0),C});return H!==P.items?{...P,items:H}:P});M&&t(P=>({...P,ingredientSections:z}))},[o,e.ingredientSections,t]);const g=Pa(Or(tl,{activationConstraint:{distance:10}}),Or(nl,{activationConstraint:{delay:250,tolerance:5}}),Or(el,{coordinateGetter:Id})),x=({active:M,over:z})=>{if(!z)return;const P=M.id,H=z.id,O=m.find(C=>C.items.some(I=>I.id===P)),q=m.find(C=>C.items.some(I=>I.id===H))||m.find(C=>C.id===H);!O||!q||O===q||t(C=>{const I=O.items,L=q.items,V=I.findIndex(Z=>Z.id===P),G=L.findIndex(Z=>Z.id===H);let Y;if(H===q.id)Y=L.length+1;else{const A=z&&M.rect.current.translated&&M.rect.current.translated.top>z.rect.top+z.rect.height?1:0;Y=G>=0?G+A:L.length+1}return{...C,ingredientSections:C.ingredientSections.map(Z=>Z.id===O.id?{...Z,items:I.filter(A=>A.id!==P)}:Z.id===q.id?{...Z,items:[...L.slice(0,Y),I[V],...L.slice(Y,L.length)]}:Z)}})},v=({active:M,over:z})=>{if(!z)return;const P=M.id,H=z.id,O=m.find(C=>C.items.some(I=>I.id===P)),q=m.find(C=>C.items.some(I=>I.id===H))||m.find(C=>C.id===H);if(O&&q&&O===q){const C=O.items.findIndex(L=>L.id===P),I=q.items.findIndex(L=>L.id===H);C!==I&&t(L=>({...L,ingredientSections:L.ingredientSections.map(V=>V.id===O.id?{...V,items:aa(V.items,C,I)}:V)}))}},S=(M,z,P,H)=>{const{groupId:O,index:q}=u;O!==null&&q!==null&&t(C=>{const I=C.ingredientSections.map(L=>{if(L.id!==O)return L;const V=[...L.items],G={...V[q],purchaseCost:M,unit:z,purchase_cost:P,content_amount:H},Y=parseFloat(G.quantity),Z=parseFloat(M);if(!isNaN(Y)&&!isNaN(Z)){const A=ci(o,G.name),U=No(G,A),X=z?z.trim().toLowerCase():"";let se=0;X==="g"||X===""||X==="ml"||X===""||X==="cc"||X===""?se=Y/1e3*Z:X==="cl"||X===""?se=Y*10/1e3*Z:se=Y*Z;const oe=Number.isFinite(U)&&U>0?U:1;G.cost=Math.round(se/oe*100)/100}return V[q]=G,{...L,items:V}});return Ln.getAllConversions().then(L=>c(L)),Vo.invalidateCache(),{...C,ingredientSections:I}})},w=u.isOpen&&u.groupId!==null&&u.index!==null?m.find(M=>M.id===u.groupId)?.items[u.index]:null,_=Ue.useCallback((M,z,P,H)=>{t(O=>{const q=O.ingredientSections.map(C=>{if(C.id!==M)return C;const I=[...C.items],L={...I[z],[P]:H};if(I[z]=L,["quantity","purchaseCost","unit","name","isAlcohol"].includes(P)){const V=parseFloat(L.quantity),G=parseFloat(L.purchaseCost),Y=ci(o,L.name),Z=No(L,Y),A=Number.isFinite(Z)&&Z>0?Z:1;if(!isNaN(V)&&!isNaN(G)){let U=0;const X=L.unit?L.unit.trim().toLowerCase():"";X==="g"||X===""||X==="ml"||X===""||X==="cc"||X===""?U=V/1e3*G:X==="cl"||X===""?U=V*10/1e3*G:U=V*G;const se=Math.round(U/A*100)/100;se!==L.cost&&(L.cost=se,I[z]=L)}}if(P==="name"){const V=s.get(Jt(H)),G=ci(o,H),Y=Bo(G?.itemCategory);if(Y){const Z=Tx(L,Y);Object.assign(L,Z)}else V||(L.itemCategory=null);if(V){const Z=typeof V=="object"?V.price:V,A=typeof V=="object"?V.vendor:null,U=typeof V=="object"?V.unit:null,X=typeof V=="object"?V.size:null;if(L.purchaseCostRef=Z,L.vendorRef=A,G&&G.packetSize){const Ce=G.lastPrice!==null&&G.lastPrice!==void 0&&G.lastPrice!==""?G.lastPrice:Z;let ue=0;const ne=(G.packetUnit||"").trim().toLowerCase();["g",""].includes(ne)?(ue=Ce/G.packetSize*1e3,L.unit="g"):["kg",""].includes(ne)?(ue=Ce/G.packetSize,L.unit="g"):["ml","","cc",""].includes(ne)?(ue=Ce/G.packetSize*1e3,L.unit="ml"):["l",""].includes(ne)?(ue=Ce/G.packetSize,L.unit="ml"):["cl",""].includes(ne)?(ue=Ce/G.packetSize*100,L.unit="ml"):(ue=Ce/G.packetSize,L.unit=G.packetUnit),L.purchaseCost=Math.round(ue*100)/100}else{let Ce=Z,ue=U;X&&X>1&&(["g",""].includes((U||"").toLowerCase())?(Ce=Z/X*1e3,ue="g"):["ml","","cc",""].includes((U||"").toLowerCase())?(Ce=Z/X*1e3,ue="ml"):["cl",""].includes((U||"").toLowerCase())?(Ce=Z/X*100,ue="ml"):["kg",""].includes(U?U.toLowerCase():"")?(Ce=Z/X,ue="g"):["l",""].includes(U?U.toLowerCase():"")?(Ce=Z/X,ue="ml"):Ce=Z/X),L.purchaseCost||(L.purchaseCost=Math.round(Ce*100)/100),!L.unit&&ue&&(L.unit=ue)}const se=parseFloat(L.quantity),oe=parseFloat(L.purchaseCost);if(!isNaN(se)&&!isNaN(oe)){const Ce=ci(o,L.name),ue=No(L,Ce),ne=Number.isFinite(ue)&&ue>0?ue:1,we=L.unit?L.unit.trim().toLowerCase():"";let Le=0;we==="g"||we===""||we==="ml"||we===""||we==="cc"||we===""?Le=se/1e3*oe:we==="cl"||we===""?Le=se*10/1e3*oe:Le=se*oe,L.cost=Math.round(Le/ne*100)/100}}else L.purchaseCostRef=null,L.vendorRef=null;I[z]=L}return{...C,items:I}});return{...O,ingredientSections:q}})},[o,s,t]),j=Ue.useCallback((M,z,P)=>{const H=b2(P),O=Er(H);if(!Number.isFinite(O)||O<0){a.warning("1015");return}_(M,z,"quantity",String(H))},[a,_]),E=Ue.useCallback((M,z,P)=>{t(H=>{const O=H.ingredientSections.map(q=>{if(q.id!==M)return q;const C=[...q.items],I={...C[z]};if(I.name=P.name,I.itemCategory=null,P.price)if(I.purchaseCostRef=P.price,I.vendorRef=P.source==="csv"?"CSV":"Master",P.source==="manual")if(P.size&&P.size>0){const Y=(P.unit||"").trim().toLowerCase();if(["g",""].includes(Y)){const Z=P.price/P.size*1e3;I.purchaseCost=Math.round(Z*100)/100,I.unit="g"}else if(["kg",""].includes(Y)){const Z=P.price/P.size;I.purchaseCost=Math.round(Z*100)/100,I.unit="g"}else if(["ml","","cc",""].includes(Y)){const Z=P.price/P.size*1e3;I.purchaseCost=Math.round(Z*100)/100,I.unit="ml"}else if(["l",""].includes(Y)){const Z=P.price/P.size;I.purchaseCost=Math.round(Z*100)/100,I.unit="ml"}else if(["cl",""].includes(Y)){const Z=P.price/P.size*100;I.purchaseCost=Math.round(Z*100)/100,I.unit="ml"}else{const Z=P.price/P.size;I.purchaseCost=Math.round(Z*100)/100,I.unit=P.unit}}else I.purchaseCost=P.price,I.unit=P.unit;else{const Y=ci(o,P.name);if(Y&&Y.packetSize){const Z=Y.lastPrice!==null&&Y.lastPrice!==void 0&&Y.lastPrice!==""?Y.lastPrice:P.price;let A=0;const U=(Y.packetUnit||"").trim().toLowerCase();["g",""].includes(U)?(A=Z/Y.packetSize*1e3,I.unit="g"):["kg",""].includes(U)?(A=Z/Y.packetSize,I.unit="g"):["ml","","cc",""].includes(U)?(A=Z/Y.packetSize*1e3,I.unit="ml"):["l",""].includes(U)?(A=Z/Y.packetSize,I.unit="ml"):["cl",""].includes(U)?(A=Z/Y.packetSize*100,I.unit="ml"):(A=Z/Y.packetSize,I.unit=Y.packetUnit),I.purchaseCost=Math.round(A*100)/100}else I.purchaseCost=P.price,I.unit=P.unit}const L=Bo(P.itemCategory??P.item_category??ci(o,P.name)?.itemCategory);if(L){const Y=Tx(I,L);Object.assign(I,Y)}const V=parseFloat(I.quantity),G=parseFloat(I.purchaseCost);if(!isNaN(V)&&!isNaN(G)){const Y=ci(o,I.name),Z=No(I,Y),A=Number.isFinite(Z)&&Z>0?Z:1,U=I.unit?I.unit.trim().toLowerCase():"";let X=0;U==="g"||U===""||U==="ml"||U===""||U==="cc"||U===""?X=V/1e3*G:U==="cl"||U===""?X=V*10/1e3*G:X=V*G,I.cost=Math.round(X/A*100)/100}return C[z]=I,{...q,items:C}});return{...H,ingredientSections:O}})},[o,t]),T=Ue.useCallback((M,z)=>{t(P=>({...P,ingredientSections:P.ingredientSections.map(H=>H.id===M?{...H,items:H.items.filter((O,q)=>q!==z)}:H)}))},[t]),R=M=>{const z={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(P=>({...P,ingredientSections:P.ingredientSections.map(H=>H.id===M?{...H,items:[...H.items,z]}:H)}))},B=()=>{t(M=>({...M,ingredientSections:[...M.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},F=M=>{t(z=>({...z,ingredientSections:z.ingredientSections.filter(P=>P.id!==M)}))},$=(M,z)=>{t(P=>({...P,ingredientSections:P.ingredientSections.map(H=>H.id===M?{...H,name:z}:H)}))};return r.jsxs(ra,{sensors:g,collisionDetection:kb,onDragOver:x,onDragEnd:v,children:[r.jsxs("div",{className:"recipe-form-ingredients",children:[m.map(M=>r.jsx(Ba,{id:M.id,items:M.items.map(z=>z.id),strategy:Ko,children:r.jsxs(j2,{section:M,sections:m,onSectionChange:$,onRemoveSection:F,children:[M.items.map((z,P)=>(()=>{const H=ci(o,z?.name),O=k_(H?.yieldPercent??H?.yield_percent??z?.yieldPercent??z?.yield_percent);return r.jsx(S2,{id:z.id,index:P,item:z,groupId:M.id,yieldPercentApplied:O,onChange:_,onRemove:T,handleSuggestionSelect:E,onOpenConversion:()=>h({isOpen:!0,groupId:M.id,index:P}),onQuantityVoiceTranscript:j,onNameVoiceComplete:(q,C)=>p(I=>({key:I.key+1,groupId:q,index:C})),voiceSearchTrigger:f},z.id)})()),r.jsx(ce,{type:"button",variant:"ghost",onClick:()=>R(M.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},M.id)),r.jsx(ce,{type:"button",variant:"secondary",onClick:B,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),r.jsx(ym,{dropAnimation:{sideEffects:gm({styles:{active:{opacity:"0.5"}}})},children:null}),r.jsx(j_,{isOpen:u.isOpen,onClose:()=>h({isOpen:!1,groupId:null,index:null}),onApply:S,ingredientName:w?.name||"",currentCost:w?.purchaseCost,currentQuantity:w?.quantity,unit:w?.unit||"g",initialPurchaseCost:w?.purchase_cost,initialContentAmount:w?.content_amount})]})},k2=({id:e,index:t,item:s,groupId:a,voiceInputEnabled:o,onChange:c,onRemove:u,onVoiceAppend:h})=>{const{attributes:f,listeners:p,setNodeRef:m,transform:g,transition:x,isDragging:v}=$a({id:e,data:{groupId:a,index:t}}),S={transform:Vr.Translate.toString(g),transition:x,opacity:v?.3:1,position:"relative",zIndex:v?999:"auto"};return r.jsxs("div",{ref:m,style:{...S,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[r.jsx("div",{...f,...p,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),r.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),r.jsxs("div",{style:{flex:1},children:[r.jsx(zt,{textarea:!0,value:s.text,onChange:w=>c(a,t,w.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}}),o&&r.jsx("div",{className:"step-row__voice-action",children:r.jsx(ia,{label:"",getCurrentValue:()=>s.text,onTranscript:w=>h(a,t,w)})})]}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(a,t),title:"",children:""})})]})},E2=({section:e,sections:t,onSectionChange:s,onRemoveSection:a,children:o})=>{const{setNodeRef:c}=Ac({id:e.id});return r.jsxs(vn,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[r.jsx(zt,{value:e.name,onChange:u=>s(e.id,u.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),r.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&r.jsx("button",{type:"button",onClick:()=>a(e.id),className:"group-delete-btn",children:""})})]}),r.jsxs("div",{ref:c,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,e.items.length===0&&r.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},N2=({formData:e,setFormData:t,voiceInputEnabled:s=!1})=>{k.useEffect(()=>{if(!e.stepSections){const S=e.stepGroups||[{id:"default",name:""}],_=(e.steps||[]||[]).map(R=>typeof R=="string"?{id:crypto.randomUUID(),text:R}:R),j=S.map(R=>({id:R.id,name:R.name,items:_.filter(B=>R.id==="default"&&!B.groupId?!0:B.groupId===R.id)})),E=new Set(j.flatMap(R=>R.items.map(B=>B.id))),T=_.filter(R=>!E.has(R.id));T.length>0&&(j.length>0?j[0].items.push(...T):j.push({id:"default",name:"",items:T})),j.length===0&&j.push({id:crypto.randomUUID(),name:"",items:[]}),t(R=>({...R,stepSections:j}))}},[e.steps,e.stepGroups,e.stepSections,t]);const a=e.stepSections||[],o=Pa(Or(tl,{activationConstraint:{distance:10}}),Or(nl,{activationConstraint:{delay:250,tolerance:5}}),Or(el,{coordinateGetter:Id})),c=({active:S,over:w})=>{if(!w)return;const _=S.id,j=w.id,E=a.find(R=>R.items.some(B=>B.id===_)),T=a.find(R=>R.items.some(B=>B.id===j))||a.find(R=>R.id===j);!E||!T||E===T||t(R=>{const B=E.items,F=T.items,$=B.findIndex(P=>P.id===_),M=F.findIndex(P=>P.id===j);let z;if(j===T.id)z=F.length+1;else{const H=w&&S.rect.current.translated&&S.rect.current.translated.top>w.rect.top+w.rect.height?1:0;z=M>=0?M+H:F.length+1}return{...R,stepSections:R.stepSections.map(P=>P.id===E.id?{...P,items:B.filter(H=>H.id!==_)}:P.id===T.id?{...P,items:[...F.slice(0,z),B[$],...F.slice(z,F.length)]}:P)}})},u=({active:S,over:w})=>{if(!w)return;const _=S.id,j=w.id,E=a.find(R=>R.items.some(B=>B.id===_)),T=a.find(R=>R.items.some(B=>B.id===j))||a.find(R=>R.id===j);if(E&&T&&E===T){const R=E.items.findIndex(F=>F.id===_),B=T.items.findIndex(F=>F.id===j);R!==B&&t(F=>({...F,stepSections:F.stepSections.map($=>$.id===E.id?{...$,items:aa($.items,R,B)}:$)}))}},h=(S,w,_)=>{t(j=>({...j,stepSections:j.stepSections.map(E=>{if(E.id!==S)return E;const T=[...E.items];return T[w]={...T[w],text:_},{...E,items:T}})}))},f=(S,w)=>{t(_=>({..._,stepSections:_.stepSections.map(j=>j.id===S?{...j,items:j.items.filter((E,T)=>T!==w)}:j)}))},p=(S,w,_)=>{t(j=>({...j,stepSections:j.stepSections.map(E=>{if(E.id!==S)return E;const T=[...E.items];return T[w]={...T[w],text:_},{...E,items:T}})}))},m=S=>{const w={id:crypto.randomUUID(),text:""};t(_=>({..._,stepSections:_.stepSections.map(j=>j.id===S?{...j,items:[...j.items,w]}:j)}))},g=()=>{t(S=>({...S,stepSections:[...S.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},x=S=>{t(w=>({...w,stepSections:w.stepSections.filter(_=>_.id!==S)}))},v=(S,w)=>{t(_=>({..._,stepSections:_.stepSections.map(j=>j.id===S?{...j,name:w}:j)}))};return r.jsxs(ra,{sensors:o,collisionDetection:kb,onDragOver:c,onDragEnd:u,children:[r.jsxs("div",{className:"recipe-form-steps",children:[a.map(S=>r.jsx(Ba,{id:S.id,items:S.items.map(w=>w.id),strategy:Ko,children:r.jsxs(E2,{section:S,sections:a,onSectionChange:v,onRemoveSection:x,children:[S.items.map((w,_)=>r.jsx(k2,{id:w.id,index:_,item:w,groupId:S.id,voiceInputEnabled:s,onChange:h,onRemove:f,onVoiceAppend:p},w.id)),r.jsx(ce,{type:"button",variant:"ghost",onClick:()=>m(S.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},S.id)),r.jsx(ce,{type:"button",variant:"secondary",onClick:g,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),r.jsx(ym,{dropAnimation:{sideEffects:gm({styles:{active:{opacity:"0.5"}}})},children:null})]})},A2="voice_input_enabled",T2=15*1e3,Sd=new Map,Yu=(e,t)=>{Sd.set(e,{value:t===!0,expiresAt:Date.now()+T2})},R2=e=>{const t=Sd.get(e);return t?Date.now()>t.expiresAt?(Sd.delete(e),null):t.value:null},O2=async e=>{const{data:t,error:s}=await Ae.rpc("get_feature_flag",{p_key:e});if(s)throw s;return t===!0},D2=async e=>{const{data:t,error:s}=await Ae.from("app_feature_flags").select("enabled").eq("feature_key",e).maybeSingle();if(s)throw s;return t?.enabled===!0},Yp={async getFlag(e,{force:t=!1}={}){if(!t){const s=R2(e);if(s!==null)return s}try{const s=await O2(e);return Yu(e,s),s}catch(s){console.warn("[featureFlagService] RPC get_feature_flag failed, fallback to table:",s);const a=await D2(e);return Yu(e,a),a}},async setFlag(e,t){const s=t===!0;try{const{data:a,error:o}=await Ae.rpc("admin_set_feature_flag",{p_key:e,p_enabled:s});if(o)throw o;return Yu(e,a?.enabled===!0),a?.enabled===!0}catch(a){console.warn("[featureFlagService] RPC admin_set_feature_flag failed, fallback to table:",a);const{data:o,error:c}=await Ae.from("app_feature_flags").upsert({feature_key:e,enabled:s,updated_at:new Date().toISOString()},{onConflict:"feature_key"}).select("enabled").single();if(c)throw c;const u=o?.enabled===!0;return Yu(e,u),u}},async getVoiceInputEnabled(){return!0},async setVoiceInputEnabled(e){return this.setFlag(A2,e)},clearCache(){Sd.clear()}},E_=({onClose:e,onImport:t,initialMode:s="url"})=>{const a=qs(),[o,c]=k.useState(s),[u,h]=k.useState(null),[f,p]=k.useState(""),[m,g]=k.useState(""),[x,v]=k.useState(null),[S,w]=k.useState(null),_="groq",[j,E]=k.useState(()=>{try{const ge=localStorage.getItem("preferredImageEngine");return!ge||ge==="auto"?_:ge}catch{return _}}),[T,R]=k.useState(!1),[B,F]=k.useState(!1),[$,M]=k.useState(null),[z,P]=k.useState(!1),H=k.useRef(null),O=k.useRef(null),q=k.useRef(null),C=k.useRef(null),I=()=>{C.current&&(clearTimeout(C.current),C.current=null)},L=(ge="")=>{if(I(),q.current){try{q.current.abort()}catch{}q.current=null}F(!1),ge&&M(ge)};k.useEffect(()=>()=>{if(I(),q.current){try{q.current.abort()}catch{}q.current=null}},[]),k.useEffect(()=>{if(!x){w(null);return}const ge=URL.createObjectURL(x);return w(ge),()=>URL.revokeObjectURL(ge)},[x]),k.useEffect(()=>{try{localStorage.setItem("preferredImageEngine",j)}catch{}},[j]);const V=ge=>new Promise(Te=>{if(!ge||typeof ge!="object")return Te(ge);const de=String(ge.type||"").toLowerCase();if(!de.startsWith("image/"))return Te(ge);const N=2e6,ve=2e3,fe=.9,Q=String(ge.name||"").toLowerCase(),K=de.includes("heic")||de.includes("heif")||Q.endsWith(".heic")||Q.endsWith(".heif"),ie=URL.createObjectURL(ge);let re=!1;const ee=qe=>{if(!re){re=!0;try{URL.revokeObjectURL(ie)}catch{}Te(qe)}},le=setTimeout(()=>ee(ge),15e3),ye=new Image;ye.onload=()=>{const qe=ye.naturalWidth||ye.width||0,Re=ye.naturalHeight||ye.height||0;if(!qe||!Re)return clearTimeout(le),ee(ge);const $e=Math.min(1,ve/Math.max(qe,Re)),Ke=Math.max(1,Math.round(qe*$e)),Ye=Math.max(1,Math.round(Re*$e)),Et=$e<1,Kt=K||ge.size>N;if(!Et&&!Kt)return clearTimeout(le),ee(ge);const dt=document.createElement("canvas");dt.width=Ke,dt.height=Ye;const bt=dt.getContext("2d");if(!bt)return clearTimeout(le),ee(ge);bt.drawImage(ye,0,0,Ke,Ye),dt.toBlob(mt=>{if(clearTimeout(le),!mt)return ee(ge);const $t=String(ge.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);ee(new File([mt],`${$t}.jpg`,{type:"image/jpeg"}))},"image/jpeg",fe)},ye.onerror=()=>{clearTimeout(le),ee(ge)},ye.src=ie}),G=async ge=>{if(ge){if(!String(ge.type||"").startsWith("image/")){M("");return}M(null),R(!0);try{const Te=await V(ge);v(Te||ge)}finally{R(!1)}}},Y=()=>H.current?.click?.(),Z=()=>O.current?.click?.(),A=ge=>{ge.preventDefault(),ge.stopPropagation(),ge.type==="dragenter"||ge.type==="dragover"?P(!0):ge.type==="dragleave"&&P(!1)},U=ge=>{if(ge.preventDefault(),ge.stopPropagation(),P(!1),ge.dataTransfer.files&&ge.dataTransfer.files[0]){const Te=ge.dataTransfer.files[0];Te.type.startsWith("image/")&&G(Te)}},X=ge=>/[---]/.test(ge||""),se=ge=>typeof ge=="string"?ge.trim():ge&&typeof ge=="object"?String(ge.text||ge.name||"").trim():"",oe=async ge=>{const Te=[];Te.push((ge.name||ge.title||"").trim()),Te.push((ge.description||"").trim());const de=[];Array.isArray(ge.ingredients)&&ge.ingredients.forEach((Re,$e)=>{if(typeof Re=="string"){const Ye=Re.trim();if(!Ye)return;Te.push(Ye),de.push($e);return}const Ke=String(Re?.name||Re?.text||"").trim();Ke&&(Te.push(Ke),de.push($e))});const N=[];if(Array.isArray(ge.steps)&&ge.steps.forEach((Re,$e)=>{const Ke=se(Re);Ke&&(Te.push(Ke),N.push($e))}),!Te.some(Re=>String(Re||"").trim()))return ge;const{data:ve,error:fe}=await Ae.auth.refreshSession(),Q=ve?.session;if(fe||!Q?.access_token){const Re=fe?.message||"",$e=/refresh_token|session|expired|invalid|not found/i.test(Re);throw new Error($e?"":Re||"")}const K=`${Fo}/functions/v1/translate`,ie=await fetch(K,{method:"POST",headers:{"Content-Type":"application/json",apikey:sd,Authorization:`Bearer ${Q.access_token}`},body:JSON.stringify({text:Te,target_lang:"JA"})});if(!ie.ok){const Re=ie.status;if(Re===401)throw new Error("");let $e="";try{const Ke=await ie.text();if(Ke)try{const Ye=JSON.parse(Ke);$e=Ye?.error||Ye?.message||Ke}catch{$e=Ke}}catch{}throw new Error($e||`: ${Re}`)}const re=await ie.json();if(re&&re.error)throw new Error(String(re.error));if(!Array.isArray(re?.translations))throw new Error("");const ee=re.translations.map(Re=>Re.text);let le=0;const ye={...ge},qe=ee[le++]||ye.name||ye.title||"";if(ye.name=qe,ye.title=qe,ye.description=ee[le++]||ye.description,de.length>0){const Re=new Map;de.forEach(($e,Ke)=>{Re.set($e,ee[le+Ke])}),ye.ingredients=ye.ingredients.map(($e,Ke)=>{const Ye=Re.get(Ke);return Ye?typeof $e=="string"?Ye:$e&&typeof $e=="object"?{...$e,name:Ye}:$e:$e}),le+=de.length}if(N.length>0){const Re=new Map;N.forEach(($e,Ke)=>{Re.set($e,ee[le+Ke])}),ye.steps=ye.steps.map(($e,Ke)=>{const Ye=Re.get(Ke);return Ye?$e&&typeof $e=="object"?{...$e,text:Ye}:Ye:$e})}return ye},[Ce,ue]=k.useState([]),ne=async()=>{F(!0),M(null),ue([]);try{let ge,Te="";if(o==="url"){if(!m)return;Te=m;const{data:fe,error:Q}=await Ae.auth.refreshSession(),K=fe?.session;if(Q||!K?.access_token){const le=Q?.message||"",ye=/refresh_token|session|expired|invalid|not found/i.test(le);throw new Error(ye?"":le||"")}const ie=`${Fo}/functions/v1/scrape-recipe`,re=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json",apikey:sd,Authorization:`Bearer ${K.access_token}`},body:JSON.stringify({url:m})});if(!re.ok){const le=re.status;if(le===401)throw new Error("");if(le===403)throw new Error("URL");if(le>=500)throw new Error("");let ye="";try{const qe=await re.text();if(qe)try{const Re=JSON.parse(qe);ye=Re?.error||Re?.message||qe}catch{ye=qe}}catch{}throw new Error(ye||`URL: ${le}`)}ge=await re.json()}else{if(!x)return;I();const fe=new AbortController;q.current=fe;const Q=12e4;C.current=setTimeout(()=>{L("")},Q),ue(Ye=>[...Ye," ..."]);const K=new FormData;K.append("image",x),K.append("engine",j);const ie=Fo,re=sd,ee=`${ie}/functions/v1/analyze-image`,{data:le,error:ye}=await Ae.auth.refreshSession(),qe=le?.session;if(ye||!qe?.access_token){const Ye=ye?.message||"",Et=/refresh_token|session|expired|invalid/i.test(Ye);throw new Error(Et?"":Ye||"")}const Re=qe.access_token,$e={apikey:re,Authorization:`Bearer ${Re}`,"X-User-JWT":Re};let Ke;try{Ke=await fetch(ee,{method:"POST",headers:$e,body:K,signal:fe.signal})}catch(Ye){throw console.error("Network Error:",Ye),new Error("")}if(Ke.status===401){let Ye="";try{Ye=await Ke.text()}catch{}if(/invalid\s+jwt|jwt\s+expired|token\s+expired/i.test(String(Ye||"")))try{const{data:Kt,error:dt}=await Ae.auth.refreshSession(),bt=Kt?.session;if(dt||!bt?.access_token)throw dt||new Error("No session after refresh");const mt=bt.access_token;$e.Authorization=`Bearer ${mt}`,$e["X-User-JWT"]=mt,Ke=await fetch(ee,{method:"POST",headers:$e,body:K,signal:fe.signal})}catch(Kt){throw console.warn("Session refresh failed:",Kt),new Error("")}}if(!Ke.ok){const Ye=Ke.status;let Et="";try{const dt=await Ke.text();if(dt)try{const bt=JSON.parse(dt);Et=bt?.message||bt?.error||dt}catch{Et=dt}}catch{}const Kt=Et?`: ${Et}`:"";throw new Error(`Server Error (${Ye})${Kt}`)}if(!Ke.body)ge=await Ke.json();else{const Ye=Ke.body.getReader(),Et=new TextDecoder;let Kt=null,dt="",bt=!1;for(;;){const{done:mt,value:$t}=await Ye.read();if(mt)break;dt+=Et.decode($t,{stream:!0});const on=dt.split(`

`);dt=on.pop()||"";for(const Ot of on){const gn=Ot.trim();if(gn.startsWith("data: "))try{const Wt=JSON.parse(gn.slice(6));if(Wt.type==="log")ue(Dt=>[...Dt,Wt.message]);else if(Wt.type==="result")Kt=Wt,bt=!0;else if(Wt.type==="error")throw new Error(Wt.message)}catch(Wt){if(Wt.message&&!Wt.message.includes("Failed to parse"))throw Wt;console.warn("Failed to parse SSE event",Wt)}}if(bt)break}try{await Ye.cancel()}catch{}if(!Kt)throw new Error("");ge=Kt}}if(ge.error)throw new Error(ge.error);if(!ge.recipe)throw new Error("No recipe found");let de=ge.recipe;if(de.title=de.title||de.name||"",de.name=de.name||de.title||"",de.recipeYield=de.recipeYield||de.servings||"",de.description=de.description||"",!de.ingredients&&de.recipeIngredient&&(de.ingredients=de.recipeIngredient),Array.isArray(de.ingredients)){const fe=["","","method","instructions","steps","preparation"],Q=[],K=[];de.ingredients.forEach(ie=>{const re=(ie.group||"").trim().toLowerCase();if(re&&fe.some(ee=>re===ee||re.includes(ee))){const ee=ie.name||ie.text||"";ee&&K.push(ee)}else Q.push(ie)}),K.length>0&&(console.log("Extracted steps from ingredients:",K),de.ingredients=Q,de.steps=Array.isArray(de.steps)?de.steps:[],de.steps=[...de.steps,...K])}const N=Array.isArray(de.steps)?de.steps.slice(0,3).map(fe=>se(fe)).join(""):"",ve=`${de.name||de.title||""}${N}`;if(ve&&!X(ve)){h(de),p(Te),c("confirm-translation"),F(!1);return}t(de,Te),e()}catch(ge){if(console.error("Import failed details:",ge),ge?.name==="AbortError")return;const Te=ge.message||"Import failed. Please try again.";M(Te)}finally{I(),q.current=null,o!=="confirm-translation"&&F(!1)}},we=async ge=>{F(!0),M(null);try{let Te=u;ge&&(Te=await oe(u)),t(Te,f),e()}catch(Te){console.error("Translation flow error:",Te);const de=Te?.message||"";M(de),a.warning(de)}finally{F(!1)}},Le=ge=>{const Te=ge.target.files[0];Te&&G(Te),ge.target.value=""};return r.jsxs("div",{className:"modal-overlay fade-in",children:[B&&r.jsx("div",{className:"analyze-status-popup",role:"status","aria-live":"polite",children:r.jsxs("div",{className:"analyze-status-popup-inner",children:[r.jsx("div",{className:"spinner"}),r.jsx("p",{className:"analyze-status-title",children:"..."}),Ce.length>0&&r.jsx("div",{className:"progress-log-container",children:r.jsxs("div",{className:"progress-log",children:[Ce.map((ge,Te)=>r.jsx("div",{className:"log-entry",children:r.jsx("span",{className:"log-message",children:ge})},Te)),r.jsx("div",{ref:ge=>ge?.scrollIntoView({behavior:"smooth"})})]})}),r.jsx("div",{className:"analyze-status-actions",children:r.jsx(ce,{type:"button",variant:"secondary",onClick:()=>L(),children:""})})]})}),r.jsxs(vn,{className:"import-modal-card",children:[r.jsx("h3",{className:"modal-title",children:o==="confirm-translation"?"":""}),o==="confirm-translation"?r.jsxs("div",{className:"translation-confirm-content",children:[r.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[r.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),r.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),$&&r.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:$}),r.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[r.jsx(ce,{type:"button",variant:"primary",onClick:()=>we(!0),isLoading:B,style:{width:"100%"},children:""}),r.jsx(ce,{type:"button",variant:"secondary",onClick:()=>we(!1),disabled:B,style:{width:"100%"},children:""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"import-mode-tabs",children:[r.jsx("button",{type:"button",onClick:()=>c("url"),className:`tab-btn tab-import-web ${o==="url"?"active":""}`,children:" Web URL"}),r.jsx("button",{type:"button",onClick:()=>c("image"),className:`tab-btn tab-import-image ${o==="image"?"active":""}`,children:"  (Best Effort)"})]}),o==="url"?r.jsxs(r.Fragment,{children:[r.jsx("p",{children:"URL"}),r.jsx("input",{type:"url",placeholder:"https://...",value:m,onChange:ge=>g(ge.target.value),className:"import-url-input",autoFocus:!0})]}):r.jsxs(r.Fragment,{children:[r.jsx("p",{children:""}),r.jsxs("div",{className:"image-engine-panel",children:[r.jsxs("label",{className:"image-engine-label",children:["",r.jsxs("select",{className:"image-engine-select",value:j,onChange:ge=>E(ge.target.value),disabled:B||T,children:[r.jsx("option",{value:"groq",children:"Groq"}),r.jsx("option",{value:"auto",children:"Best EffortGroqAzure OCRGroqGemini"}),r.jsx("option",{value:"gemini",children:"Gemini"}),r.jsx("option",{value:"groq_vision",children:"Groq"})]})]}),r.jsx("div",{className:"image-engine-help",children:"AIGroqBest EffortGeminiGemini"})]}),r.jsxs("div",{className:"image-upload-wrapper",children:[r.jsx("input",{ref:H,type:"file",accept:"image/*",capture:"environment",onChange:Le,className:"image-upload-input"}),r.jsx("input",{ref:O,type:"file",accept:"image/*",onChange:Le,className:"image-upload-input"}),r.jsx("div",{onDragEnter:A,onDragLeave:A,onDragOver:A,onDrop:U,className:`image-upload-label ${z?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{B||T||Z()},onKeyDown:ge=>{B||T||(ge.key==="Enter"||ge.key===" ")&&(ge.preventDefault(),Z())},children:S?r.jsx("img",{src:S,alt:"Preview",className:"image-upload-preview"}):z?"":""}),r.jsxs("div",{className:"image-upload-actions",children:[r.jsx(ce,{type:"button",variant:"secondary",onClick:Y,disabled:B||T,children:""}),r.jsx(ce,{type:"button",variant:"secondary",onClick:Z,disabled:B||T,children:""})]})]}),T&&r.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),$&&r.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto"},children:$}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(ce,{type:"button",variant:"ghost",onClick:e,disabled:B,children:""}),r.jsx(ce,{type:"button",variant:"primary",onClick:ne,isLoading:B,disabled:T||(o==="url"?!m:!x),children:""})]})]})]})]})},Ox=({onSave:e,onCancel:t,initialData:s})=>{const a=s||{},[o,c]=k.useState("ingredients"),[u,h]=k.useState(null),[f,p]=k.useState(new Map);Ue.useEffect(()=>{(async()=>{const L=await Fn.fetchPriceList();p(L)})()},[]);const m=k.useMemo(()=>{const I=a.steps||[""];let L=a.stepGroups||[];const V=I.some(Y=>typeof Y=="object"&&Y.group);if(L.length===0&&V){const Y=new Map;I.forEach(Z=>{typeof Z=="object"&&Z.group&&!Y.has(Z.group)&&Y.set(Z.group,crypto.randomUUID())}),L=Array.from(Y.entries()).map(([Z,A])=>({id:A,name:Z}))}return{steps:I.map(Y=>{const Z=typeof Y=="string"?Y:Y.text||"",A=typeof Y=="object"&&Y.id?Y.id:crypto.randomUUID();let U=typeof Y=="object"?Y.groupId:void 0;const X=typeof Y=="object"?Y.group:void 0;if(!U&&X&&L.length>0){const se=L.find(oe=>oe.name===X);se&&(U=se.id)}return{id:A,text:Z,groupId:U}}),stepGroups:L}},[a]),g=m.steps,x=m.stepGroups,v=k.useMemo(()=>{const I=a.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let L=a.ingredientGroups||[];if(L.length===0&&I.some(G=>G.group)){const G=new Map;I.forEach(Y=>{Y.group&&!G.has(Y.group)&&G.set(Y.group,crypto.randomUUID())}),L=Array.from(G.entries()).map(([Y,Z])=>({id:Z,name:Y})),G.size>0&&I.some(Y=>!Y.group)}return{ingredients:I.map(G=>{const Y=typeof G=="string"?{name:G,quantity:"",unit:"",cost:"",purchaseCost:""}:{...G,cost:G.cost||"",purchaseCost:G.purchaseCost||""};let Z=Y.groupId;if(!Z&&Y.group&&L.length>0){const A=L.find(U=>U.name===Y.group);A&&(Z=A.id)}return{...Y,id:Y.id||crypto.randomUUID(),groupId:Z}}),ingredientGroups:L}},[a]),S=v.ingredients,w=v.ingredientGroups,[_,j]=k.useState({title:a.title||"",description:a.description||"",image:a.image||"",imageFile:null,storeName:a.storeName||"",servings:a.servings||"",ingredients:S,ingredientGroups:w,steps:g,stepGroups:x,tags:a.tags||[""],course:a.course||"",category:a.category||"",type:a.type||"normal",flours:a.flours||[],breadIngredients:a.breadIngredients||[],sourceUrl:a.sourceUrl||""}),[E,T]=k.useState(!1),[R,B]=k.useState(!1);k.useEffect(()=>{let I=!0;return(async()=>{try{const V=await Yp.getVoiceInputEnabled();I&&B(V)}catch(V){console.warn("[RecipeForm] failed to load voice input feature flag:",V),I&&B(!1)}})(),()=>{I=!1}},[]);const F=(I,L="")=>{const V=new Map,G=I.ingredients||[];G.forEach(oe=>{let Ce=oe.group||"";Ce==="Main"&&(Ce=""),V.has(Ce)||V.set(Ce,crypto.randomUUID())});const Y=Array.from(V.entries()).map(([oe,Ce])=>({id:Ce,name:oe})),Z=G.map(oe=>{let Ce=oe.group||"";Ce==="Main"&&(Ce="");let ue;return V.has(Ce)&&(ue=V.get(Ce)),{id:crypto.randomUUID(),name:oe.name||"",quantity:oe.quantity||"",unit:oe.unit||"",cost:"",purchaseCost:"",groupId:ue}}),A=new Map,U=I.steps||[];U.forEach(oe=>{typeof oe=="object"&&oe.group&&oe.group!=="Main"&&(A.has(oe.group)||A.set(oe.group,crypto.randomUUID()))});const X=Array.from(A.entries()).map(([oe,Ce])=>({id:Ce,name:oe})),se=U.map(oe=>{const Ce=typeof oe=="object",ue=Ce?oe.text||"":oe,ne=Ce?oe.group:null;let we;return ne&&A.has(ne)&&(we=A.get(ne)),{id:crypto.randomUUID(),text:ue,groupId:we}});j(oe=>({...oe,title:I.name||I.title||oe.title,description:I.description||oe.description,category:L?"URL":I.category||oe.category,image:I.image||oe.image,servings:I.recipeYield||I.servings||oe.servings,ingredients:Z,ingredientGroups:Y,steps:se,stepGroups:X,ingredientSections:void 0,stepSections:void 0,sourceUrl:L||oe.sourceUrl})),h(null),c("ingredients")},$=I=>{I.preventDefault(),I.stopPropagation(),I.type==="dragenter"||I.type==="dragover"?T(!0):I.type==="dragleave"&&T(!1)},M=I=>{if(I.preventDefault(),I.stopPropagation(),T(!1),I.dataTransfer.files&&I.dataTransfer.files[0]){const L=I.dataTransfer.files[0];L.type.startsWith("image/")&&j(V=>({...V,imageFile:L,image:URL.createObjectURL(L)}))}},z=I=>{const{id:L,value:V}=I.target;j(G=>({...G,[L]:V}))},P=I=>{const L=I.target.files[0];L&&j(V=>({...V,imageFile:L,image:URL.createObjectURL(L)}))},H=k.useMemo(()=>{if(_.type==="bread")return(_.flours?.length||0)+(_.breadIngredients?.length||0);const I=_.ingredientSections||[];return I.length>0?I.reduce((L,V)=>L+(V?.items?.length||0),0):_.ingredients?.length||0},[_.breadIngredients,_.flours,_.ingredientSections,_.ingredients,_.type]),O=k.useMemo(()=>{const I=_.stepSections||[];return I.length>0?I.reduce((L,V)=>L+(V?.items?.length||0),0):_.steps?.length||0},[_.stepSections,_.steps]),q=I=>{I.preventDefault();let L=[],V=[];if(_.type==="bread")L=_.ingredients.map(X=>{const{id:se,...oe}=X;return oe});else{const X=_.ingredientSections||[];X.length===0&&_.ingredients.length>0?L=_.ingredients.map(se=>{const{id:oe,...Ce}=se;return Ce}):(L=X.flatMap(se=>se.items.map(oe=>({...oe,groupId:se.id}))).map(se=>{const{id:oe,...Ce}=se;return Ce}),V=X.map(se=>({id:se.id,name:se.name})))}const G=new Set(_.tags||[]);_.course&&G.add(_.course),_.category&&G.add(_.category),_.type==="bread"&&G.add("");const Y=Array.from(G).filter(Boolean);let Z=[],A=[];const U=_.stepSections||[];U.length===0&&_.steps.length>0?Z=_.steps.map(X=>typeof X=="string"?{text:X}:X):(Z=U.flatMap(X=>X.items.map(se=>({text:se.text,groupId:X.id}))),A=U.map(X=>({id:X.id,name:X.name}))),e({..._,ingredients:L,ingredientGroups:V,steps:Z,stepGroups:A,image:_.imageFile||_.image,id:a.id||Date.now(),tags:Y,ingredientSections:void 0,stepSections:void 0})},C=!!a?.id;return r.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:q,children:[u&&r.jsx(E_,{onClose:()=>h(null),onImport:F,initialMode:u}),r.jsxs("div",{className:"recipe-form-mock__page",children:[r.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:r.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[r.jsxs("div",{className:"recipe-form-mock__crumb",children:[r.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),r.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),r.jsx("span",{className:"recipe-form-mock__crumb-page",children:C?"":""})]}),r.jsxs("div",{className:"recipe-form-mock__actions",children:[r.jsx(ce,{type:"button",variant:"ghost",onClick:t,children:""}),r.jsx(ce,{type:"submit",variant:"primary",children:""})]})]})}),r.jsxs("div",{className:"recipe-form-mock__sheet",children:[r.jsxs("header",{className:"recipe-form-mock__doc",children:[r.jsxs("div",{className:"recipe-form-mock__doc-title",children:[r.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:_.title,onChange:z,placeholder:"",required:!0}),r.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),r.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(zt,{label:"",id:"course",value:_.course,onChange:z,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),r.jsxs("datalist",{id:"course-options",children:[r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""})]})]}),r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(zt,{label:"",id:"category",value:_.category,onChange:z,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),r.jsxs("datalist",{id:"category-options",children:[r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""})]})]}),r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(zt,{label:"",id:"storeName",value:_.storeName,onChange:z,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),r.jsx("datalist",{id:"store-options",children:bd.map(I=>r.jsx("option",{value:I},I))})]}),r.jsx("div",{className:"recipe-form-mock__meta-field",children:r.jsx(zt,{label:"",id:"servings",value:_.servings,onChange:z,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),r.jsxs("div",{className:"recipe-form-mock__grid",children:[r.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[r.jsxs(vn,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsx(zt,{label:"",id:"description",textarea:!0,value:_.description,onChange:z,placeholder:"..."}),R&&r.jsx("div",{className:"recipe-form__voice-action",children:r.jsx(ia,{label:"",getCurrentValue:()=>_.description,onTranscript:I=>j(L=>({...L,description:I}))})}),r.jsx(zt,{label:"URL",id:"sourceUrl",value:_.sourceUrl||"",onChange:z,placeholder:"https://example.com/recipe/..."})]}),r.jsxs(vn,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("div",{className:`recipe-form-mock__image-drop ${E?"is-active":""}`,onDragEnter:$,onDragLeave:$,onDragOver:$,onDrop:M,children:[_.image?r.jsxs("div",{className:"recipe-form-mock__image-preview",children:[r.jsx("img",{src:_.image,alt:"",onError:I=>{I.target.style.display="none"}}),r.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>j(I=>({...I,image:"",imageFile:null})),title:"",children:""})]}):r.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",r.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),r.jsx("input",{type:"file",accept:"image/*",onChange:P,className:"recipe-form-mock__image-input"})]})]}),!a?.id&&r.jsxs(vn,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("div",{className:"recipe-form-mock__import-actions",children:[r.jsx(ce,{variant:"secondary",type:"button",onClick:()=>h("url"),children:"URL"}),r.jsx(ce,{variant:"secondary",type:"button",onClick:()=>h("image"),children:""})]}),r.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),r.jsxs(vn,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[r.jsx("li",{children:""}),r.jsx("li",{children:""}),r.jsx("li",{children:""})]})]})]}),r.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:r.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[r.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[r.jsxs("div",{className:"recipe-form-mock__nav",children:[r.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${o==="ingredients"?"active":""}`,onClick:()=>c("ingredients"),children:[" ",r.jsx("span",{className:"recipe-form-mock__nav-count",children:H.toLocaleString()})]}),r.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${o==="steps"?"active":""}`,onClick:()=>c("steps"),children:[" ",r.jsx("span",{className:"recipe-form-mock__nav-count",children:O.toLocaleString()})]})]}),r.jsx("div",{className:"recipe-form-mock__workspace-right",children:o==="ingredients"?r.jsxs("div",{className:"recipe-form-mock__segmented",children:[r.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${_.type==="normal"?"active":""}`,onClick:()=>j(I=>({...I,type:"normal"})),children:""}),r.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${_.type==="bread"?"active":""}`,onClick:()=>j(I=>({...I,type:"bread"})),children:""})]}):r.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),r.jsx("div",{className:"recipe-form-mock__workspace-body",children:o==="ingredients"?r.jsx("div",{className:"recipe-form-mock__editor-surface",children:_.type==="bread"?r.jsx(p2,{formData:_,setFormData:j}):r.jsx(C2,{formData:_,setFormData:j,priceList:f})}):r.jsx("div",{className:"recipe-form-mock__editor-surface",children:r.jsx(N2,{formData:_,setFormData:j,voiceInputEnabled:R})})})]})})]})]})]})]})},L2="modulepreload",z2=function(e){return"/app/"+e},Dx={},Ze=function(t,s,a){let o=Promise.resolve();if(s&&s.length>0){let f=function(p){return Promise.all(p.map(m=>Promise.resolve(m).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),h=u?.nonce||u?.getAttribute("nonce");o=f(s.map(p=>{if(p=z2(p),p in Dx)return;Dx[p]=!0;const m=p.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${g}`))return;const x=document.createElement("link");if(x.rel=m?"stylesheet":L2,m||(x.as="script"),x.crossOrigin="",x.href=p,h&&x.setAttribute("nonce",h),document.head.appendChild(x),m)return new Promise((v,S)=>{x.addEventListener("load",v),x.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${p}`)))})}))}function c(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return o.then(u=>{for(const h of u||[])h.status==="rejected"&&c(h.reason);return t().catch(c)})},I2=e=>{if(!e)return null;if(Array.isArray(e))return e[0]||null;if(typeof e=="object"){if(e.id&&e.display_id!==void 0)return e;const t=Object.values(e)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},gs={async fetchAllProfiles(){try{const{data:t,error:s}=await Ae.rpc("admin_list_profiles");if(!s&&Array.isArray(t))return t;s&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",s)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const e=await Ae.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!e.error)return e.data||[];if(String(e.error.message||"").toLowerCase().includes("email")){const t=await Ae.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw e.error},async updateProfile(e,t){const a=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let o=null;if(a)try{const{data:u,error:h}=await Ae.rpc("admin_set_show_master_recipes",{target_profile_id:e,enabled:t.show_master_recipes===!0});if(h)throw h;if(u){const f=I2(u);if(f)return f}}catch(u){console.warn("RPC admin_set_show_master_recipes failed:",u),o=u}const c=await Ae.from("profiles").update(t).eq("id",e).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!c.error)return c.data;if(o&&a)throw console.error("Direct update also failed:",c.error),new Error(`(RPC: ${o.message})`);if(String(c.error.message||"").toLowerCase().includes("email")){const u=await Ae.from("profiles").update(t).eq("id",e).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(u.error)throw u.error;return u.data}throw c.error},async adminGetLoginLogs(e){const{data:t,error:s}=await Ae.rpc("admin_get_login_logs",{p_user_id:e});if(s)throw s;return t||[]},async adminResetPassword(e,t){const{data:s,error:a}=await Ae.functions.invoke("admin-reset-password",{body:{userId:e,newPassword:t}});if(a)throw a;if(s?.error)throw new Error(s.error);return s},async sendPasswordResetEmail(e){const{error:t}=await Ae.auth.resetPasswordForEmail(e,{redirectTo:window.location.origin+"/app/"});if(t)throw t;return!0},async adminSetRole(e,t){const{error:s}=await Ae.rpc("admin_set_role",{p_user_id:e,p_role:t});if(s)throw s;return!0},async adminDeleteUser(e){const{error:t}=await Ae.rpc("admin_delete_user",{p_user_id:e});if(t)throw t;return!0}},Lx="csv_unit_overrides",zx=e=>String(e?.code||"")==="42P01"||String(e?.message||"").toLowerCase().includes("does not exist"),jd={async _getCurrentUserId(){const{data:e,error:t}=await Ae.auth.getUser();if(t)throw t;return e?.user?.id||null},async getAll(e=null){try{const t=e||await this._getCurrentUserId();if(!t)return new Map;const{data:s,error:a}=await Ae.from(Lx).select("ingredient_name,csv_unit").eq("user_id",t);if(a){if(zx(a))return new Map;throw a}const o=new Map;return(s||[]).forEach(c=>{c?.ingredient_name&&o.set(String(c.ingredient_name),String(c.csv_unit||""))}),o}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(e,t,s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(e||"").trim(),c=String(t||"").trim();if(!o)throw new Error("");if(!c)throw new Error("");const{data:u,error:h}=await Ae.from(Lx).upsert({user_id:a,ingredient_name:o,csv_unit:c,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(h)throw zx(h)?new Error("DB csv_unit_overrides "):h;return u}},Ix="ingredient_vendor_orders",Mx=e=>String(e?.code||"")==="42P01"||String(e?.message||"").toLowerCase().includes("does not exist"),Ux={async getAll(e){const t=String(e||"").trim();if(!t)return[];const{data:s,error:a}=await Ae.from(Ix).select("vendor_name,sort_order").eq("user_id",t).order("sort_order",{ascending:!0}).order("vendor_name",{ascending:!0});if(a){if(Mx(a))return[];throw a}return(s||[]).map(o=>String(o?.vendor_name||"").trim()).filter(Boolean)},async saveOrder(e,t){const s=String(e||"").trim();if(!s)throw new Error("User ID is required");const a=[],o=new Set;if((t||[]).forEach(f=>{const p=String(f||"").trim();!p||o.has(p)||(o.add(p),a.push(p))}),a.length===0)return;const c=new Date().toISOString(),u=a.map((f,p)=>({user_id:s,vendor_name:f,sort_order:p,updated_at:c})),{error:h}=await Ae.from(Ix).upsert(u,{onConflict:"user_id,vendor_name"});if(h)throw Mx(h)?new Error("DB ingredient_vendor_orders "):h}},Ho=({isOpen:e,onClose:t,onConfirm:s,title:a="",description:o,confirmWord:c="DELETE",loading:u=!1,loadingNode:h=null})=>{const[f,p]=k.useState(""),m=f===c,g=()=>{p(""),t()},x=async()=>{!m||u||(await s(),p(""))};return r.jsx(an,{isOpen:e,onClose:g,title:a,size:"small",showCloseButton:!u,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[o&&r.jsx("div",{style:{color:"#374151",fontSize:"0.95rem",lineHeight:1.6},children:o}),r.jsxs("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px 16px",fontSize:"0.9rem",color:"#991b1b"},children:["  ",r.jsx("strong",{children:c})," "]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"6px",fontWeight:600,fontSize:"0.85rem",color:"#374151"},children:""}),r.jsx("input",{type:"text",value:f,onChange:v=>p(v.target.value),placeholder:c,disabled:u,autoFocus:!0,style:{width:"100%",padding:"10px 12px",border:m?"2px solid #ef4444":"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem",fontFamily:"monospace",letterSpacing:"0.05em",outline:"none",boxSizing:"border-box",color:"#111",transition:"border-color 0.15s ease"},onKeyDown:v=>{v.key==="Enter"&&x()}})]}),u&&h&&r.jsxs("div",{style:{marginTop:"4px",padding:"12px",background:"#f3f4f6",borderRadius:"8px",fontSize:"0.9rem",color:"#374151",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("div",{style:{width:"16px",height:"16px",flexShrink:0,border:"3px solid #e5e7eb",borderTopColor:"#6b7280",borderRadius:"50%",animation:"spin 1s linear infinite"}}),r.jsx("div",{style:{wordBreak:"break-all"},children:h}),r.jsx("style",{children:`
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                        `})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:g,disabled:u,children:""}),r.jsx(ce,{variant:"danger",onClick:x,disabled:!m||u,children:u?"...":""})]})]})})},N_=({isOpen:e,onClose:t,onConfirm:s,title:a,description:o,loading:c,loadingNode:u=null})=>{const[h,f]=k.useState([]),[p,m]=k.useState(!1),[g,x]=k.useState(""),[v,S]=k.useState(!1),[w,_]=k.useState("");k.useEffect(()=>{e&&(x(""),S(!1),_(""),j())},[e]);const j=async()=>{m(!0);try{const T=await gs.fetchAllProfiles();f((T||[]).filter(R=>R.role!=="admin"))}catch(T){console.error("Failed to load profiles:",T)}finally{m(!1)}},E=()=>{s(g)};return e?r.jsx(an,{isOpen:e,onClose:()=>{c||t()},title:a,maxWidth:"500px",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[r.jsx("p",{style:{margin:0,fontSize:"0.95rem",lineHeight:1.5},children:o}),p?r.jsx("div",{style:{fontSize:"0.9rem",color:"#666"},children:"..."}):r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:""}),r.jsxs("select",{value:g,onChange:T=>x(T.target.value),disabled:c||v,style:{width:"100%",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"},children:[r.jsx("option",{value:"",children:"--  --"}),h.map(T=>r.jsxs("option",{value:T.id,children:[T.display_id,T.email?` (${T.email})`:""]},T.id))]})]}),v?r.jsxs("div",{style:{border:"1px solid #fecaca",borderRadius:"8px",padding:"15px",backgroundColor:"#fef2f2",marginTop:"10px"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#dc2626",marginBottom:"8px"},children:""}),r.jsxs("p",{style:{margin:"0 0 10px",fontSize:"0.9rem",color:"#991b1b"},children:[" ",r.jsx("br",{})," ",r.jsx("strong",{children:"DELETE"})," "]}),r.jsx("input",{type:"text",value:w,onChange:T=>_(T.target.value),placeholder:"DELETE",disabled:c,style:{width:"100%",padding:"8px",border:"1px solid #fca5a5",borderRadius:"4px",marginBottom:"15px"}}),c&&u&&r.jsxs("div",{style:{marginBottom:"15px",padding:"12px",background:"#f3f4f6",borderRadius:"8px",fontSize:"0.9rem",color:"#374151",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("div",{style:{width:"16px",height:"16px",flexShrink:0,border:"3px solid #e5e7eb",borderTopColor:"#6b7280",borderRadius:"50%",animation:"spin 1s linear infinite"}}),r.jsx("div",{style:{wordBreak:"break-all"},children:u})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"secondary",onClick:()=>S(!1),disabled:c,children:""}),r.jsx(ce,{variant:"danger",onClick:E,disabled:w!=="DELETE"||c,children:c?"...":""})]})]}):r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"secondary",onClick:t,disabled:c,children:""}),r.jsx(ce,{variant:"danger",onClick:()=>S(!0),disabled:!g||c,children:""})]})]})}):null},Kl="manual",Wl="__all__",Na="__unassigned__",M2=({vendorKey:e,label:t,count:s,active:a,disabled:o,onSelect:c})=>{const{attributes:u,listeners:h,setNodeRef:f,transform:p,transition:m,isDragging:g}=$a({id:e,data:{type:"vendor-order-item"},disabled:!!o}),x={transform:Vr.Transform.toString(p),transition:m,opacity:g?.7:1};return r.jsxs("li",{ref:f,style:x,className:`vendor-order-item ${a?"active":""} ${o?"disabled":""}`,onClick:()=>{o||c(e)},role:"button",tabIndex:o?-1:0,onKeyDown:v=>{o||(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),c(e))},"aria-label":`${t} `,children:[r.jsxs("span",{className:"vendor-order-item__label",title:t,children:[t,r.jsxs("span",{className:"vendor-order-item__count",children:["(",Number(s||0).toLocaleString(),")"]})]}),r.jsx("span",{className:"vendor-order-item__handle",...o?{}:u,...o?{}:h,title:"","aria-label":`${t} `,children:""})]})},U2=()=>{const e=qs(),{user:t}=xs(),s=t?.id||null,[a,o]=k.useState([]),[c,u]=k.useState(""),[h,f]=k.useState("all"),[p,m]=k.useState(!1),[g,x]=k.useState(Wl),[v,S]=k.useState([]),[w,_]=k.useState(!1),[j,E]=k.useState(null),[T,R]=k.useState(!1),[B,F]=k.useState(new Map),[$,M]=k.useState(new Map),[z,P]=k.useState({}),[H,O]=k.useState(!1),[q,C]=k.useState([]),[I,L]=k.useState(!1),[V,G]=k.useState(""),[Y,Z]=k.useState(""),[A,U]=k.useState(!1),[X,se]=k.useState(!1),[oe,Ce]=k.useState(null),[ue,ne]=k.useState(!1),[we,Le]=k.useState(!1),[ge,Te]=k.useState(!1),[de,N]=k.useState(null),[ve,fe]=k.useState(!1),[Q,K]=k.useState(!1),[ie,re]=k.useState(null),[ee,le]=k.useState(!1),[ye,qe]=k.useState(!1),[Re,$e]=k.useState(null),Ke=te=>{const je=String(te||"").trim();return!je||je==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(je)?je:"food"},Ye=te=>{const je=Ke(te);return je==="food"?"8%":je==="soft_drink"?"8%":je==="alcohol"?"10%":je==="supplies"?"10%":"8%"},Et=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:Kl,label:""}],Kt=k.useCallback(te=>{const je=Jt(te);return je?B?.has(je):!1},[B]),dt=Ue.useMemo(()=>{const te={all:a.length,food:0,alcohol:0,soft_drink:0,supplies:0,[Kl]:0};return a.forEach(je=>{const Oe=Ke(je?.itemCategory);te[Oe]=(te[Oe]||0)+1,Kt(je?.ingredientName)||(te[Kl]=(te[Kl]||0)+1)}),te},[a,Kt]),bt=k.useCallback(async()=>{R(!0);try{let te=await Ln.getAllConversions();if((te?.size||0)===0){await new Promise(We=>setTimeout(We,350));const Oe=await Ln.getAllConversions();(Oe?.size||0)>0&&(te=Oe)}const je=Array.from(te.values()).map(Oe=>({...Oe,clientId:Oe.ingredientName,isNew:!1,isEditing:!1}));o(je.sort((Oe,We)=>String(Oe?.ingredientName||"").localeCompare(String(We?.ingredientName||""),"ja"))),R(!1),Promise.allSettled([Fn.fetchPriceList(),jd.getAll()]).then(([Oe,We])=>{Oe.status==="fulfilled"?F(Oe.value||new Map):(F(new Map),console.warn("Failed to load CSV prices (ingredient master still available):",Oe.reason)),We.status==="fulfilled"?M(We.value||new Map):(M(new Map),console.warn("Failed to load CSV unit overrides (ingredient master still available):",We.reason))}).catch(Oe=>{console.warn("Failed to load auxiliary ingredient master data:",Oe),F(new Map),M(new Map)})}catch(te){e.error(""),console.error("Failed to load ingredients:",te),R(!1)}},[e]);k.useEffect(()=>{const te=setTimeout(()=>{bt()},0);return()=>clearTimeout(te)},[bt]),k.useEffect(()=>{let te=!0;return(async()=>{if(!s){te&&S([]);return}try{const Oe=await Ux.getAll(s);te&&S(Oe)}catch(Oe){console.error("Failed to load vendor order:",Oe),te&&S([])}})(),()=>{te=!1}},[s]);const mt=()=>{const te=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,je=["food","alcohol","soft_drink","supplies"].includes(h)?h:"food",Oe={clientId:te,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:je,isNew:!0,isEditing:!0};o(We=>[Oe,...We.map(ae=>({...ae,isEditing:!1}))]),E(te)},$t=k.useCallback(te=>a.findIndex(je=>je?.clientId===te),[a]),on=async te=>{const je=$t(te);if(je<0)return;const Oe=a[je];if(!Oe.ingredientName||!Oe.packetSize||!Oe.lastPrice){e.warning("");return}const We=parseFloat(Oe.yieldPercent),ae=Number.isFinite(We)?We:100;if(ae<=0||ae>100){e.warning("% 1100 ");return}try{await Ln.saveConversion(Oe.ingredientName,Oe.packetSize,Oe.packetUnit,Oe.lastPrice,Oe.itemCategory,Oe.vendor,ae),e.success(""),bt(),E(null)}catch(he){e.error(""),console.error("Save error:",he)}},Ot=async te=>{const je=$t(te);if(je<0)return;const Oe=a[je],We=Oe?.ingredientName;if(Oe.isNew){o(ae=>ae.filter(he=>he?.clientId!==te)),E(null);return}try{await Ln.deleteConversion(We),e.success(""),bt()}catch(ae){e.error(""),console.error("Delete error:",ae)}},gn=te=>{E(te),o(je=>je.map(Oe=>({...Oe,isEditing:Oe?.clientId===te})))},Wt=te=>{const je=$t(te);je<0||(a[je].isNew?o(Oe=>Oe.filter(We=>We?.clientId!==te)):bt(),E(null))},Dt=(te,je,Oe)=>{o(We=>We.map(ae=>ae?.clientId!==te?ae:{...ae,[je]:Oe}))},zn=te=>{const je=parseFloat(te.lastPrice),Oe=parseFloat(te.packetSize);if(!je||!Oe)return"-";const We=te.packetUnit?te.packetUnit.trim().toLowerCase():"";return We==="g"||We===""?`${Math.round(je/Oe*1e3).toLocaleString()}/kg`:We==="ml"||We==="cc"||We===""||We===""?`${Math.round(je/Oe*1e3).toLocaleString()}/L`:We==="cl"||We===""?`${Math.round(je/Oe*100).toLocaleString()}/L`:`${Math.round(je/Oe).toLocaleString()}/${te.packetUnit}`},hn=a.filter(te=>{const je=String(te?.ingredientName||"");return je.toLowerCase().includes(c.toLowerCase())?h==="all"?!0:h===Kl?!Kt(je):Ke(te?.itemCategory)===h:!1}),Ct=Ue.useMemo(()=>{const te=new Map;a.forEach(he=>{const pe=String(he?.ingredientName||"").trim();if(!pe)return;const Ne=Jt(pe);if(!Ne)return;const Be=te.get(Ne)||[];Be.push({clientId:he?.clientId,name:pe}),te.set(Ne,Be)});const je=new Set,Oe=new Set,We=new Map,ae=[];for(const[he,pe]of te.entries()){if(!Array.isArray(pe)||pe.length<2)continue;je.add(he),pe.forEach(Be=>{Be?.clientId&&Oe.add(Be.clientId)});const Ne=Array.from(new Set(pe.map(Be=>Be?.name).filter(Boolean)));We.set(he,Ne),ae.push({key:he,names:Ne,rows:pe.length})}return ae.sort((he,pe)=>{const Ne=String(he?.names?.[0]||""),Be=String(pe?.names?.[0]||"");return Ne.localeCompare(Be,"ja")}),{duplicateKeys:je,duplicateClientIds:Oe,keyToNames:We,groups:ae}},[a]);k.useEffect(()=>{p&&(Ct?.groups?.length||0)===0&&m(!1)},[p,Ct]);const ht=h!=="all"||String(c||"").trim()!=="",Vt=te=>{const je=Jt(te);if(!je)return"-";const We=(B?.get(je)||null)?.unit;return We?String(We):"-"},qt=k.useCallback(te=>{const je=Jt(te);if(!je)return"";const We=(B?.get(je)||null)?.vendor;return We?String(We):""},[B]),cn=Ue.useCallback(te=>{const je=String(te?.vendor||"").trim();if(je)return je;const Oe=qt(te?.ingredientName);return Oe||Na},[qt]),Ft=Ue.useMemo(()=>{const te=new Map;hn.forEach(ae=>{const he=cn(ae);te.set(he,(te.get(he)||0)+1)});const je=new Set(te.keys()),Oe=Array.from(te.entries()).map(([ae,he])=>({key:ae,count:he})),We=new Map((v||[]).map((ae,he)=>[ae,he]));return Oe.sort((ae,he)=>{const pe=We.has(ae.key)?We.get(ae.key):Number.MAX_SAFE_INTEGER,Ne=We.has(he.key)?We.get(he.key):Number.MAX_SAFE_INTEGER;return pe!==Ne?pe-Ne:ae.key===Na&&he.key!==Na?1:he.key===Na&&ae.key!==Na?-1:String(ae.key).localeCompare(String(he.key),"ja")}),{total:hn.length,vendorKeys:je,entries:Oe}},[hn,cn,v]);k.useEffect(()=>{const te=(Ft?.entries||[]).map(je=>je.key);S(je=>{const Oe=Array.isArray(je)?je:[],We=Oe.filter(pe=>te.includes(pe)),ae=te.filter(pe=>!We.includes(pe)),he=[...We,...ae];return he.length===Oe.length&&he.every((pe,Ne)=>pe===Oe[Ne])?Oe:he})},[Ft]);const _n=Pa(Or(Dd,{activationConstraint:{distance:6}})),xn=k.useCallback(async te=>{if(j!==null)return;const{active:je,over:Oe}=te;if(!je?.id||!Oe?.id||je.id===Oe.id)return;const We=(Ft?.entries||[]).map(et=>et.key),ae=We.indexOf(je.id),he=We.indexOf(Oe.id);if(ae<0||he<0)return;const pe=aa(We,ae,he),Be=(Array.isArray(v)?v:[]).filter(et=>!We.includes(et)),it=[...pe,...Be];if(S(it),!!s)try{await Ux.saveOrder(s,it)}catch(et){console.error("Failed to save vendor order:",et),e.error(et?.message||"")}},[j,s,Ft,e,v]);k.useEffect(()=>{g!==Wl&&(Ft?.vendorKeys?.has?.(g)||x(Wl))},[g,Ft]);const un=Ue.useMemo(()=>{let te=hn.filter(je=>{const Oe=je?.clientId,We=!!j&&Oe===j;return!(p&&!(Ct?.duplicateClientIds||new Set).has(Oe)&&!We||g!==Wl&&!(cn(je)===g)&&!We)});if(j&&!te.some(je=>je?.clientId===j)){const je=a.find(Oe=>Oe?.clientId===j);je&&(te=[je,...te])}return te},[hn,p,Ct,g,cn,j,a]),Vn=te=>{const je=(te??"").toString().trim();if(!je)return"";if(Object.prototype.hasOwnProperty.call(z,je))return z[je];const Oe=$?.get(je);if(Oe)return String(Oe);const We=Vt(je);return We==="-"?"":We},Ht=te=>{const je=(te??"").toString().trim();if(!je)return"-";const Oe=$?.get(je);return Oe?String(Oe):Vt(je)},Cn=async(te,je)=>{const Oe=(te??"").toString().trim(),We=(je??"").toString().trim();if(Oe){if(!We){P(ae=>{const he={...ae};return delete he[Oe],he});return}try{await jd.upsert(Oe,We),M(ae=>{const he=new Map(ae);return he.set(Oe,We),he}),e.success("CSV")}catch(ae){console.error(ae),e.error(ae?.message||"")}}},It=async()=>{Te(!0),N(null);try{const te=await Ln.moveAllToTrash();N({type:"success",message:`: ${te.moved}`}),await bt()}catch(te){console.error(te),N({type:"error",message:": "+(te?.message||String(te))})}finally{Te(!1)}},Tn=async()=>{K(!0),re(null);try{const te=await Ln.adminClearAllNonAdminMaster();re({type:"success",message:`:  ${te.deleted_unit_conversions} / CSV ${te.deleted_csv_overrides} `}),await loadConversionsAndOverrides()}catch(te){console.error(te),re({type:"error",message:": "+(te?.message||String(te))})}finally{K(!1)}},Kn=async te=>{qe(!0),$e(null);try{const je=await Ln.adminClearTargetUserMaster(te);$e({type:"success",message:`:  ${je.deleted_unit_conversions} / CSV ${je.deleted_csv_overrides} `}),await loadConversionsAndOverrides()}catch(je){console.error(je),$e({type:"error",message:": "+(je?.message||String(je))})}finally{qe(!1),le(!1)}},dn=async()=>{if(t?.role==="admin"){O(!0),G(""),C([]),Z(""),U(!1),Ce(null),ne(!1),L(!0);try{const te=await gs.fetchAllProfiles();C(te||[])}catch(te){console.error(te),G("")}finally{L(!1)}}},Xt=()=>{X||(ne(!1),O(!1))},ke=async()=>{if(!(!Y||X)){se(!0),Ce({type:"info",message:"..."});try{const te=await Ln.adminCopyIngredientMasterToUser(Y,{overwrite:A}),je=te?.unit_conversions||{},Oe=te?.csv_unit_overrides||{},We=`: ${Number(je.source_total||0).toLocaleString()}   ${Number(je.copied||0).toLocaleString()} /  ${Number(je.updated||0).toLocaleString()} /  ${Number(je.skipped||0).toLocaleString()}`,ae=`(CSV): ${Number(Oe.source_total||0).toLocaleString()}   ${Number(Oe.copied||0).toLocaleString()} /  ${Number(Oe.updated||0).toLocaleString()} /  ${Number(Oe.skipped||0).toLocaleString()}`;Ce({type:"success",message:`
${We}
${ae}`}),e.success("")}catch(te){console.error(te),Ce({type:"error",message:`: ${String(te?.message||te)}`}),e.error("")}finally{se(!1)}}};return r.jsxs("div",{className:"ingredient-master-container",children:[r.jsxs("div",{className:"master-header",children:[r.jsx("h3",{children:" "}),r.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-start"},children:[t?.role==="admin"&&r.jsx(ce,{variant:"secondary",onClick:dn,disabled:j!==null||T||X,title:j!==null?"":void 0,children:""}),r.jsx(ce,{variant:"danger",onClick:()=>Le(!0),disabled:j!==null||T||ge||a.length===0,title:"",children:" "}),t?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"danger",onClick:()=>le(!0),disabled:j!==null||ye||Q,title:"",style:{background:"#b91c1c"},children:" "}),r.jsx(ce,{variant:"danger",onClick:()=>fe(!0),disabled:j!==null||ye||Q,title:"",style:{background:"#7f1d1d"},children:" "})]}),r.jsx(ce,{variant:"primary",onClick:mt,disabled:j!==null,children:"+ "})]})]}),de&&r.jsx("div",{className:`status-msg ${de.type}`,style:{marginBottom:"8px"},children:de.message}),Re&&r.jsx("div",{className:`status-msg ${Re.type}`,style:{marginBottom:"8px"},children:Re.message}),ie&&r.jsx("div",{className:`status-msg ${ie.type}`,style:{marginBottom:"8px"},children:ie.message}),r.jsx("div",{className:"master-search",children:r.jsx(zt,{placeholder:"...",value:c,onChange:te=>u(te.target.value)})}),r.jsxs("div",{className:"ingredient-master-stats",children:[r.jsxs("span",{children:[": ",r.jsx("strong",{children:(a.length||0).toLocaleString()})," "]}),ht&&r.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",r.jsx("strong",{children:(hn.length||0).toLocaleString()})," "]}),r.jsxs("button",{type:"button",className:`ingredient-dup-toggle ${p?"active":""}`,onClick:()=>m(te=>!te),disabled:j!==null||(Ct?.groups?.length||0)===0,title:j!==null?"":(Ct?.groups?.length||0)===0?"":"",children:[": ",r.jsx("strong",{children:(Ct?.groups?.length||0).toLocaleString()})," "]})]}),r.jsx("div",{className:"ingredient-category-tabs",children:Et.map(te=>r.jsxs("button",{type:"button",className:`ingredient-category-tab ${h===te.key?"active":""}`,onClick:()=>f(te.key),disabled:j!==null,title:j!==null?"":void 0,children:[te.label," (",(dt[te.key]??0).toLocaleString(),")"]},te.key))}),r.jsxs("div",{className:"ingredient-vendor-filter-row",children:[r.jsx("label",{htmlFor:"ingredient-vendor-filter",className:"ingredient-vendor-filter-label",children:""}),r.jsxs("select",{id:"ingredient-vendor-filter",value:g,onChange:te=>x(te.target.value),disabled:j!==null,className:"ingredient-vendor-select",title:j!==null?"":"",children:[r.jsxs("option",{value:Wl,children:[" (",(Ft?.total||0).toLocaleString(),")"]}),(Ft?.entries||[]).map(({key:te,count:je})=>{const Oe=te===Na?"":te;return r.jsxs("option",{value:te,children:[Oe," (",Number(je||0).toLocaleString(),")"]},te)})]}),r.jsx("button",{type:"button",className:`ingredient-vendor-order-toggle ${w?"active":""}`,onClick:()=>_(te=>!te),disabled:j!==null,title:j!==null?"":"",children:w?"":""})]}),w&&r.jsxs("div",{className:"ingredient-vendor-order-panel",children:[r.jsx("div",{className:"ingredient-vendor-order-title",children:""}),(Ft?.entries||[]).length===0?r.jsx("div",{className:"ingredient-vendor-order-empty",children:""}):r.jsx(ra,{sensors:_n,collisionDetection:pd,onDragEnd:xn,children:r.jsx(Ba,{items:(Ft?.entries||[]).map(te=>te.key),strategy:Ko,children:r.jsx("ul",{className:"vendor-order-list",children:(Ft?.entries||[]).map(({key:te,count:je})=>{const Oe=te===Na?"":te;return r.jsx(M2,{vendorKey:te,label:Oe,count:je,active:g===te,disabled:j!==null,onSelect:x},te)})})})})]}),T?r.jsx("div",{className:"master-loading",children:"..."}):r.jsx("div",{className:"master-table-wrapper",children:r.jsxs("table",{className:"master-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"master-col-no",children:"No"}),r.jsx("th",{children:""}),r.jsx("th",{className:"master-col-category",children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:"CSV"}),r.jsx("th",{children:""}),r.jsx("th",{children:"%"}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:un.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#999"},children:p?"":ht?"":""})}):un.map((te,je)=>{const Oe=te?.clientId??te?.ingredientName??String(je),We=qt(te?.ingredientName),ae=String(te?.vendor||"").trim(),he=te?.isEditing&&!!We&&We!==ae,pe=ae||We||"",Ne=ae?"vendor-tag--master":We?"vendor-tag--csv":"vendor-tag--empty",Be=pe?ae&&We&&We!==ae?`: ${ae} / CSV: ${We}`:ae?"":"CSV":"",it=Ke(te?.itemCategory),et=it==="food",Xe=Jt(te?.ingredientName),lt=!!Xe&&Ct?.duplicateKeys?.has?.(Xe),Mt=Xe&&Ct?.keyToNames?.get?.(Xe)||null,Tt=lt&&Array.isArray(Mt)&&Mt.length>0?`: ${Mt.join(" / ")}`:"";return r.jsxs("tr",{className:[te.isEditing?"editing":"",lt?"duplicate":""].filter(Boolean).join(" "),children:[r.jsx("td",{className:"master-col-no",children:r.jsx("span",{className:"master-col-no__text",children:je+1})}),r.jsx("td",{children:te.isEditing?r.jsxs("div",{className:"ingredient-name-cell",children:[r.jsx(zt,{value:te.ingredientName,onChange:Ge=>Dt(Oe,"ingredientName",Ge.target.value),placeholder:": ",disabled:!te.isNew,wrapperClassName:"input-group--no-margin"}),r.jsx(zt,{value:te.vendor||"",onChange:Ge=>Dt(Oe,"vendor",Ge.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),he&&r.jsx("div",{className:"ingredient-vendor-tags",children:r.jsxs("span",{className:"vendor-tag vendor-tag--csv",title:"CSV",children:[": ",We]})})]}):r.jsxs("div",{className:"ingredient-name-cell",children:[r.jsxs("div",{className:"ingredient-name-row",children:[r.jsx("span",{children:te.ingredientName}),lt&&r.jsx("span",{className:"ingredient-dup-badge",title:Tt,children:""})]}),r.jsx("div",{className:"ingredient-vendor-tags",children:r.jsxs("span",{className:`vendor-tag ${Ne}`,title:Be,children:[": ",pe||"-"]})})]})}),r.jsx("td",{className:"master-col-category",children:te.isEditing?r.jsxs("select",{value:it,onChange:Ge=>Dt(Oe,"itemCategory",Ge.target.value),className:"category-select",children:[r.jsx("option",{value:"food",children:"8%"}),r.jsx("option",{value:"soft_drink",children:"8%"}),r.jsx("option",{value:"alcohol",children:"10%"}),r.jsx("option",{value:"supplies",children:"10%"})]}):r.jsx("span",{title:"",children:Ye(te?.itemCategory)})}),r.jsx("td",{children:te.isEditing?r.jsx(zt,{type:"number",value:te.lastPrice,onChange:Ge=>Dt(Oe,"lastPrice",Ge.target.value),placeholder:": 500"}):`${parseFloat(te.lastPrice||0).toLocaleString()}`}),r.jsx("td",{children:te.isEditing?r.jsxs("div",{className:"input-with-hint",children:[r.jsx(zt,{type:"number",value:te.packetSize,onChange:Ge=>Dt(Oe,"packetSize",Ge.target.value),placeholder:["","","","PC","","",""].includes(te.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(te.packetUnit)&&r.jsxs("span",{className:"unit-hint",children:["1",te.packetUnit,"1"]})]}):te.packetSize}),r.jsx("td",{children:te.isEditing?r.jsxs("select",{value:te.packetUnit,onChange:Ge=>Dt(Oe,"packetUnit",Ge.target.value),className:"unit-select",children:[r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]}):te.packetUnit}),r.jsx("td",{className:"csv-unit-cell",children:te.isEditing?r.jsx(zt,{value:Vn(te.ingredientName),onChange:Ge=>{const ct=(te.ingredientName??"").toString().trim(),Zt=Ge.target.value;P(In=>({...In,[ct]:Zt}))},onBlur:Ge=>Cn(te.ingredientName,Ge.target.value),placeholder:Vt(te.ingredientName)==="-"?"":`CSV: ${Vt(te.ingredientName)}`}):r.jsx("span",{children:Ht(te.ingredientName)})}),r.jsx("td",{className:"normalized-cost",children:zn(te)}),r.jsx("td",{children:et?te.isEditing?r.jsx(zt,{type:"number",value:te.yieldPercent??"",onChange:Ge=>Dt(Oe,"yieldPercent",Ge.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const Ge=parseFloat(te.yieldPercent);if(!Number.isFinite(Ge)||Ge<=0)return"-";const ct=Math.round(Ge*10)/10;return`${Number.isInteger(ct)?Math.round(ct):ct}%`})():r.jsx("span",{style:{color:"#999"},children:"-"})}),r.jsx("td",{children:r.jsx("div",{className:"action-buttons",children:te.isEditing?r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"primary",size:"sm",onClick:()=>on(Oe),children:""}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>Wt(Oe),children:""})]}):r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>gn(Oe),disabled:j!==null,children:""}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>Ot(Oe),disabled:j!==null,children:""})]})})})]},Oe)})})]})}),r.jsx("div",{className:"master-info",children:r.jsx("p",{children:" "})}),r.jsx(an,{isOpen:H,onClose:Xt,title:"",size:"medium",showCloseButton:!X,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),ue?r.jsxs(r.Fragment,{children:[(()=>{const te=q.find(Oe=>String(Oe?.id)===String(Y)),je=te?`${te.display_id}${te.email?` (${te.email})`:""}`:Y?String(Y).slice(0,8):"-";return r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",r.jsx("strong",{children:je}),r.jsx("br",{}),": ",r.jsx("strong",{children:A?"":""})]})]})})(),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>ne(!1),disabled:X,children:""}),r.jsx(ce,{variant:"primary",onClick:ke,disabled:!Y||X,children:X?"...":""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),I?r.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):r.jsxs("select",{value:Y,onChange:te=>Z(te.target.value),disabled:X||!!V,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:X?"#f3f4f6":"white"},children:[r.jsx("option",{value:"",children:"..."}),q.filter(te=>String(te?.id)&&String(te?.id)!==String(t?.id)).map(te=>r.jsxs("option",{value:te.id,children:[te.display_id,te.email?` (${te.email})`:"",te.role==="admin"?" []":""]},te.id))]}),V&&r.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:V})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[r.jsx("input",{type:"checkbox",checked:A,onChange:te=>U(te.target.checked),disabled:X}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:Xt,disabled:X,children:""}),r.jsx(ce,{variant:"primary",onClick:()=>ne(!0),disabled:!Y||X||I||!!V,children:""})]})]}),X&&r.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),oe?.message&&r.jsx("div",{className:`status-msg ${oe.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:oe.message})]})}),r.jsx(Ho,{isOpen:we,onClose:()=>{ge||(Le(!1),N(null))},onConfirm:async()=>{await It(),Le(!1)},title:"",description:r.jsxs("span",{children:["",r.jsxs("strong",{children:[a.length.toLocaleString(),""]}),"",r.jsx("br",{}),""]}),loading:ge}),r.jsx(Ho,{isOpen:ve,onClose:()=>{Q||(fe(!1),re(null))},onConfirm:async()=>{await Tn(),fe(!1)},title:"",description:r.jsxs("span",{children:[r.jsx("strong",{style:{color:"#b91c1c"},children:"admin"}),"CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:Q}),r.jsx(N_,{isOpen:ee,onClose:()=>{ye||(le(!1),$e(null))},onConfirm:Kn,title:"",description:r.jsxs("span",{children:["CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:ye})]})},Qu="__all_vendors__",A_="__unknown_vendor__",Yl="__all_categories__",Sp="food",ad=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],Qp=ad.reduce((e,t)=>(e[t.value]=t.label,e),{}),B2=new Set(["","","","","PC","","",""]),Aa=e=>{if(e==null||e==="")return null;const t=String(e).replace(/,/g,"").trim();if(!t)return null;const s=Number(t);return Number.isFinite(s)?s:null},Bx=e=>(typeof e=="string"?e.trim():"")||A_,Ao=e=>{const t=String(e||"").trim();return!t||t==="food_alcohol"?Sp:Qp[t]?t:Sp},P2=()=>{const[e,t]=k.useState([]),[s,a]=k.useState(!0),[o,c]=k.useState(null),[u,h]=k.useState(null),[f,p]=k.useState("all"),[m,g]=k.useState({key:null,direction:"asc"}),[x,v]=k.useState(""),[S,w]=k.useState(Yl),[_,j]=k.useState(Qu),[E,T]=k.useState(!1),[R,B]=k.useState(null),F=k.useRef(null),$=qs(),[M,z]=k.useState({isOpen:!1,title:"",message:"",onConfirm:null}),P=()=>{h(ne=>!ne||ne.phase==="running"?ne:null)};k.useEffect(()=>{H()},[]);const H=async()=>{a(!0),B(null);try{console.log("Starting data load for CsvToMasterImporter...");const[ne,we]=await Promise.all([Fn.getPriceListArray().catch(ge=>(console.error("Error fetching price list:",ge),[])),Ln.getAllConversions().catch(ge=>(console.error("Error fetching conversions:",ge),new Map))]);if(console.log("Data fetched:",{csvCount:ne?.length,masterSize:we?.size}),!Array.isArray(ne))throw new Error("CSV");if(!(we instanceof Map))throw new Error("Map");const Le=[];for(const ge of ne){if(!ge||!ge.name)continue;const Te=we.get(ge.name),de=Ao(Te?.itemCategory),N=Te?.packetSize??"",ve=Te?.packetUnit||ge.unit||"",fe=Te?.lastPrice??"",Q=Te?N:B2.has(ve)?1:"";Le.push({name:ge.name,csvPrice:ge.price,csvUnit:ge.unit,csvVendor:ge.vendor,masterCategory:de,masterSize:N,masterUnit:ve,masterPrice:fe,isRegistered:!!Te,inputSize:Q,inputUnit:ve,inputPrice:Te?fe:ge.price??"",inputCategory:de,isModified:!1})}console.log("Merge completed. Items:",Le.length),t(Le)}catch(ne){console.error("Failed to load data for importer:",ne),B(ne.message||"")}finally{a(!1)}},O=async ne=>{c(ne.name);try{const we=Aa(ne.inputSize),Le=Aa(ne.inputPrice);if(we===null||we<=0){$.error("");return}if(!ne.inputUnit){$.error("");return}if(!ne.inputCategory){$.error("");return}await Ln.saveConversion(ne.name,we,ne.inputUnit,Le,ne.inputCategory),t(ge=>ge.map(Te=>Te.name===ne.name?{...Te,isRegistered:!0,isModified:!1,masterSize:we,masterUnit:ne.inputUnit,masterPrice:Le??"",masterCategory:ne.inputCategory,inputCategory:ne.inputCategory}:Te)),$.success("")}catch(we){console.error("Failed to save ingredient:",we),$.error("")}finally{c(null)}},q=async ne=>{z(we=>({...we,isOpen:!1}));try{const we=ne.filter(Re=>{const $e=Aa(Re.inputSize);return!($e!==null&&$e>0)||!Re.inputUnit||!Re.inputCategory});if(we.length>0){const Re=we.slice(0,5).map(Ke=>Ke.name).join(""),$e=we.length>5?` ${we.length-5}`:"";$.error(`: ${Re}${$e}`);return}c("bulk");const Le=ne.length;h({phase:"running",total:Le,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const ge=5,Te=120;let de=0,N=0,ve=0,fe=0;const Q=[],K=[],ie=(Re=!1,$e="")=>{const Ke=Date.now();!Re&&Ke-fe<Te||(fe=Ke,h(Ye=>!Ye||Ye.phase!=="running"?Ye:{...Ye,processed:de,success:N,failed:ve,currentName:$e||Ye.currentName}))};let re=0;const ee=async()=>{for(;;){const Re=re++;if(Re>=ne.length)return;const $e=ne[Re],Ke=$e?.name?String($e.name):"";try{const Ye=Aa($e.inputSize),Et=Aa($e.inputPrice);if(Ye===null||Ye<=0)throw new Error("Invalid size");if(!$e.inputUnit)throw new Error("Invalid unit");if(!$e.inputCategory)throw new Error("Invalid category");await Ln.saveConversion($e.name,Ye,$e.inputUnit,Et,$e.inputCategory),N++,Q.push($e)}catch(Ye){ve++,K.push(Ke||`#${Re+1}`),console.error(`Failed to save ${Ke}:`,Ye)}finally{de++,ie(!1,Ke)}}},le=Math.min(ge,ne.length);await Promise.all(Array.from({length:le},()=>ee())),ie(!0);const ye=new Set(Q.map(Re=>Re.name)),qe=new Map(ne.map(Re=>[Re.name,Re]));t(Re=>Re.map($e=>{if(ye.has($e.name)){const Ke=qe.get($e.name);return{...$e,isRegistered:!0,isModified:!1,masterSize:Aa(Ke.inputSize)??"",masterUnit:Ke.inputUnit,masterPrice:Aa(Ke.inputPrice)??"",masterCategory:Ke.inputCategory,inputCategory:Ke.inputCategory}}return $e})),ve===0?$.success(`${N} `):$.warning(`:  ${N}  /  ${ve} `),h({phase:"done",total:Le,processed:de,success:N,failed:ve,currentName:"",failedNames:K.slice(0,10)})}catch(we){console.error("Bulk save error:",we),$.error(""),h(Le=>({phase:"error",total:Le?.total??ne.length,processed:Le?.processed??0,success:Le?.success??0,failed:Le?.failed??0,currentName:"",failedNames:Le?.failedNames??[],errorMessage:we?.message?String(we.message):""}))}finally{c(null)}},C=()=>{const ne=e.filter(we=>we.isModified);ne.length!==0&&z({isOpen:!0,title:"",message:`${ne.length} `,onConfirm:()=>q(ne)})},I=(ne,we,Le)=>{t(ge=>ge.map(Te=>Te.name===ne?{...Te,[we]:Le,isModified:!0}:Te))},L=ne=>{(ne.key==="ArrowUp"||ne.key==="ArrowDown")&&ne.preventDefault()},V=ne=>{g(we=>we.key===ne?{key:ne,direction:we.direction==="asc"?"desc":"asc"}:{key:ne,direction:"asc"})},G=ne=>m.key!==ne?"":m.direction==="asc"?" ":" ",Y=k.useMemo(()=>{const ne=new Map;e.forEach(Le=>{const ge=Bx(Le.csvVendor),Te=ge===A_?"":ge,de=ne.get(ge);de?de.count+=1:ne.set(ge,{key:ge,label:Te,count:1})});const we=Array.from(ne.values()).sort((Le,ge)=>Le.label.localeCompare(ge.label,"ja"));return[{key:Qu,label:"",count:e.length},...we]},[e]);k.useEffect(()=>{Y.some(we=>we.key===_)||j(Qu)},[Y,_]),k.useEffect(()=>{if(!E)return;const ne=Le=>{F.current&&!F.current.contains(Le.target)&&T(!1)},we=Le=>{Le.key==="Escape"&&T(!1)};return document.addEventListener("mousedown",ne),document.addEventListener("touchstart",ne),document.addEventListener("keydown",we),()=>{document.removeEventListener("mousedown",ne),document.removeEventListener("touchstart",ne),document.removeEventListener("keydown",we)}},[E]);const Z=k.useMemo(()=>_===Qu?e:e.filter(ne=>Bx(ne.csvVendor)===_),[e,_]),A=k.useMemo(()=>{const ne={[Yl]:Z.length};return ad.forEach(we=>{ne[we.value]=0}),Z.forEach(we=>{const Le=Ao(we.inputCategory);ne[Le]=(ne[Le]||0)+1}),ne},[Z]),U=k.useMemo(()=>S===Yl?Z:Z.filter(ne=>Ao(ne.inputCategory)===S),[Z,S]),X=k.useMemo(()=>({all:U.length,unregistered:U.filter(ne=>!ne.isRegistered).length,registered:U.filter(ne=>ne.isRegistered).length}),[U]),se=k.useMemo(()=>Y.find(ne=>ne.key===_)||Y[0],[Y,_]),oe=k.useMemo(()=>U.filter(ne=>!(f==="unregistered"&&ne.isRegistered||f==="registered"&&!ne.isRegistered||x&&!ne.name.includes(x))),[U,f,x]),Ce=k.useMemo(()=>{if(!m.key)return oe;const ne=ge=>String(ge??""),we=ge=>{const Te=parseFloat(ge);return Number.isFinite(Te)?Te:Number.NEGATIVE_INFINITY},Le=[...oe];return Le.sort((ge,Te)=>{let de=0;switch(m.key){case"name":de=ne(ge.name).localeCompare(ne(Te.name),"ja");break;case"csvPrice":de=we(ge.csvPrice)-we(Te.csvPrice);break;case"inputCategory":{const N=Qp[Ao(ge.inputCategory)]||"",ve=Qp[Ao(Te.inputCategory)]||"";de=N.localeCompare(ve,"ja");break}case"inputSize":de=we(ge.inputSize)-we(Te.inputSize);break;case"inputUnit":de=ne(ge.inputUnit).localeCompare(ne(Te.inputUnit),"ja");break;case"inputPrice":de=we(ge.inputPrice)-we(Te.inputPrice);break;default:de=0;break}return de===0&&(de=ne(ge.name).localeCompare(ne(Te.name),"ja")),m.direction==="asc"?de:-de}),Le},[oe,m]),ue=e.filter(ne=>ne.isModified).length;return s?r.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):R?r.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[r.jsx("h3",{children:""}),r.jsx("p",{children:R}),r.jsx(ce,{variant:"secondary",onClick:H,children:""})]}):r.jsxs("div",{className:"csv-importer",children:[r.jsxs("div",{className:"importer-header",children:[r.jsx(zt,{placeholder:"...",value:x,onChange:ne=>v(ne.target.value),style:{maxWidth:"300px"}}),r.jsxs("div",{className:"filter-buttons",children:[r.jsxs(ce,{variant:f==="all"?"primary":"secondary",onClick:()=>p("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",X.all,")"]}),r.jsxs(ce,{variant:f==="unregistered"?"primary":"secondary",onClick:()=>p("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",X.unregistered,")"]}),r.jsxs(ce,{variant:f==="registered"?"primary":"secondary",onClick:()=>p("registered"),size:"sm",children:[" (",X.registered,")"]})]}),r.jsxs("div",{className:"vendor-dropdown",ref:F,children:[r.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>T(ne=>!ne),"aria-haspopup":"listbox","aria-expanded":E,children:[r.jsxs("span",{children:[": ",se?.label," (",se?.count??0,")"]}),r.jsx("span",{className:`vendor-dropdown-chevron ${E?"open":""}`,children:""})]}),E&&r.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:Y.map(ne=>r.jsxs("button",{type:"button",className:`vendor-tab ${_===ne.key?"active":""}`,onClick:()=>{j(ne.key),T(!1)},role:"option","aria-selected":_===ne.key,children:[ne.label," (",ne.count,")"]},ne.key))})]}),r.jsxs("div",{className:"category-filter-row",children:[r.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),r.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:S,onChange:ne=>w(ne.target.value),children:[r.jsxs("option",{value:Yl,children:[" (",A[Yl]||0,")"]}),ad.map(ne=>r.jsxs("option",{value:ne.value,children:[ne.label," (",A[ne.value]||0,")"]},ne.value))]})]}),r.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[ue>0&&r.jsx(ce,{variant:"primary",size:"sm",onClick:C,disabled:o!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o==="bulk"?"...":`(${ue})`}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:H,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsxs("th",{style:{width:"22%"},onClick:()=>V("name"),children:[" (CSV)",G("name")]}),r.jsxs("th",{style:{width:"14%"},onClick:()=>V("csvPrice"),children:[" (CSV)",G("csvPrice")]}),r.jsxs("th",{style:{width:"14%"},onClick:()=>V("inputCategory"),children:[" ",r.jsx("span",{style:{color:"red"},children:"*"}),G("inputCategory")]}),r.jsxs("th",{style:{width:"18%"},onClick:()=>V("inputSize"),children:[" () ",r.jsx("span",{style:{color:"red"},children:"*"}),G("inputSize")]}),r.jsxs("th",{style:{width:"13%"},onClick:()=>V("inputUnit"),children:[" () ",r.jsx("span",{style:{color:"red"},children:"*"}),G("inputUnit")]}),r.jsxs("th",{style:{width:"12%"},onClick:()=>V("inputPrice"),children:[" ()",G("inputPrice")]}),r.jsx("th",{style:{width:"7%"},children:""})]})}),r.jsx("tbody",{children:Ce.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"no-data",children:""})}):Ce.map(ne=>r.jsxs("tr",{style:{backgroundColor:ne.isModified?"#fff8e1":ne.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[r.jsxs("td",{style:{fontWeight:"500"},children:[ne.name,ne.csvVendor&&r.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:ne.csvVendor})]}),r.jsxs("td",{children:[ne.csvPrice?`${ne.csvPrice.toLocaleString()} `:"-",ne.csvUnit&&r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",ne.csvUnit]})]}),r.jsx("td",{children:r.jsx("select",{className:"input-field",value:Ao(ne.inputCategory),onChange:we=>I(ne.name,"inputCategory",we.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:ad.map(we=>r.jsx("option",{value:we.value,children:we.label},we.value))})}),r.jsx("td",{children:r.jsx(zt,{type:"number",value:ne.inputSize,onChange:we=>I(ne.name,"inputSize",we.target.value),onKeyDown:L,placeholder:["","","","PC","","",""].includes(ne.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),r.jsx("td",{children:r.jsxs("select",{className:"input-field",value:ne.inputUnit,onChange:we=>I(ne.name,"inputUnit",we.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","cl","","","","","PC","","",""].includes(ne.inputUnit)&&ne.inputUnit&&r.jsxs("option",{value:ne.inputUnit,children:[ne.inputUnit," (CSV)"]}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"kg",children:"kg"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"L",children:"L"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"PC",children:"PC"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})}),r.jsx("td",{children:r.jsx(zt,{type:"number",value:ne.inputPrice,onChange:we=>I(ne.name,"inputPrice",we.target.value),placeholder:"",style:{width:"100%"}})}),r.jsx("td",{children:r.jsx(ce,{variant:ne.isRegistered?"secondary":"primary",size:"sm",onClick:()=>O(ne),disabled:o===ne.name||o==="bulk",block:!0,children:o===ne.name?"...":ne.isRegistered?"":""})})]},ne.name))})]})}),r.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[r.jsx("p",{children:" CSV"}),r.jsx("p",{children:" "})]}),r.jsxs(an,{isOpen:M.isOpen,onClose:()=>z({...M,isOpen:!1}),title:M.title,size:"small",children:[r.jsx("div",{style:{marginBottom:"1.5rem"},children:M.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[r.jsx(ce,{variant:"secondary",onClick:()=>z({...M,isOpen:!1}),children:""}),r.jsx(ce,{variant:"primary",onClick:M.onConfirm,children:""})]})]}),r.jsx(an,{isOpen:!!u,onClose:P,title:u?.phase==="running"?"":u?.phase==="error"?"":"",size:"small",showCloseButton:u?.phase!=="running",children:u?.phase==="running"?r.jsxs("div",{className:"bulk-progress",children:[r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:""}),r.jsxs("div",{className:"bulk-progress-subtitle",children:[(u.processed||0).toLocaleString()," / ",(u.total||0).toLocaleString()," "]})]})]}),r.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:r.jsx("div",{className:"bulk-progress-bar-inner",style:{width:u.total>0?`${Math.min(100,Math.round((u.processed||0)/u.total*100))}%`:"0%"}})}),r.jsxs("div",{className:"bulk-progress-meta",children:[r.jsxs("div",{children:[": ",(u.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u.failed||0).toLocaleString()," "]}),u.currentName&&r.jsxs("div",{className:"bulk-progress-current",title:u.currentName,children:[": ",u.currentName]})]})]}):u?.phase==="error"?r.jsxs("div",{className:"bulk-progress",children:[r.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),u.errorMessage&&r.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:u.errorMessage}),r.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[r.jsxs("div",{children:[": ",(u.processed||0).toLocaleString()," / ",(u.total||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u.failed||0).toLocaleString()," "]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:r.jsx(ce,{variant:"primary",onClick:P,children:""})})]}):r.jsxs("div",{className:"bulk-progress",children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),r.jsxs("div",{className:"bulk-progress-meta",children:[r.jsxs("div",{children:[": ",(u?.total||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u?.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u?.failed||0).toLocaleString()," "]})]}),Array.isArray(u?.failedNames)&&u.failedNames.length>0&&r.jsxs("div",{className:"bulk-progress-failures",children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),r.jsx("div",{style:{lineHeight:1.5},children:u.failedNames.join("")})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:r.jsx(ce,{variant:"primary",onClick:P,children:""})})]})})]})},$2="app-data",To={async listPriceCsvTrash(){const{data:{user:e}}=await Ae.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:t,error:s}=await Ae.from("trash_price_csvs").select("id, file_name, deleted_at").eq("user_id",e.id).order("deleted_at",{ascending:!1});if(s)throw s;return t||[]},async permanentlyDeletePriceCsvTrash(e){if(!e||e.length===0)return;const{error:t}=await Ae.from("trash_price_csvs").delete().in("id",e);if(t)throw t},async restorePriceCsvFromTrash(e){if(!e||e.length===0)return;const{data:{user:t}}=await Ae.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:s,error:a}=await Ae.from("trash_price_csvs").select("*").in("id",e);if(a)throw a;const o=[];for(const c of s||[]){const u=`${t.id}/${c.file_name}`,h=new Blob([c.csv_content],{type:"text/csv"}),{error:f}=await Ae.storage.from($2).upload(u,h,{upsert:!0,contentType:"text/csv"});if(f){o.push({file_name:c.file_name,error:f.message});continue}await Ae.from("trash_price_csvs").delete().eq("id",c.id),o.push({file_name:c.file_name,error:null})}return o},async listIngredientTrash(){const{data:{user:e}}=await Ae.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:t,error:s}=await Ae.from("trash_ingredient_master").select("id, label, deleted_at, snapshot_unit_conversions").eq("user_id",e.id).order("deleted_at",{ascending:!1});if(s)throw s;return(t||[]).map(a=>({...a,item_count:Array.isArray(a.snapshot_unit_conversions)?a.snapshot_unit_conversions.length:0}))},async permanentlyDeleteIngredientTrash(e){if(!e||e.length===0)return;const{error:t}=await Ae.from("trash_ingredient_master").delete().in("id",e);if(t)throw t},async restoreIngredientFromTrash(e){const{data:{user:t}}=await Ae.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:s,error:a}=await Ae.from("trash_ingredient_master").select("*").eq("id",e).single();if(a)throw a;const o=Array.isArray(s.snapshot_unit_conversions)?s.snapshot_unit_conversions:[],c=Array.isArray(s.snapshot_csv_unit_overrides)?s.snapshot_csv_unit_overrides:[];if(o.length>0){const{error:u}=await Ae.from("unit_conversions").upsert(o.map(h=>({...h,user_id:t.id})),{onConflict:"user_id,ingredient_name"});if(u)throw u}if(c.length>0){const{error:u}=await Ae.from("csv_unit_overrides").upsert(c.map(h=>({...h,user_id:t.id})),{onConflict:"user_id,ingredient_name"});if(u)throw u}await Ae.from("trash_ingredient_master").delete().eq("id",e)}},q2=()=>{const[e,t]=k.useState([]),[s,a]=k.useState([]),[o,c]=k.useState(!0),[u,h]=k.useState(""),[f,p]=k.useState(new Set),[m,g]=k.useState(new Set),[x,v]=k.useState(null),[S,w]=k.useState(!1),[_,j]=k.useState(!1),[E,T]=k.useState(null),R=k.useCallback(async()=>{c(!0),h("");try{const[I,L]=await Promise.all([To.listPriceCsvTrash(),To.listIngredientTrash()]);t(I),a(L)}catch(I){console.error(I),h(": "+(I?.message||String(I)))}finally{c(!1)}},[]);k.useEffect(()=>{R()},[R]);const B=(I,L)=>{T({type:I,text:L}),setTimeout(()=>T(null),4e3)},F=I=>{p(L=>{const V=new Set(L);return V.has(I)?V.delete(I):V.add(I),V})},$=async()=>{const I=Array.from(f);if(I.length!==0){j(!0);try{const V=(await To.restorePriceCsvFromTrash(I)||[]).filter(G=>G.error);B("success",`${I.length-V.length}${V.length>0?`${V.length}`:""}`),p(new Set),await R()}catch(L){B("error",": "+(L?.message||String(L)))}finally{j(!1)}}},M=async()=>{const I=x?.ids||[];w(!0);try{await To.permanentlyDeletePriceCsvTrash(I),B("success",`${I.length}`),p(new Set),v(null),await R()}catch(L){B("error",": "+(L?.message||String(L)))}finally{w(!1)}},z=I=>{g(L=>{const V=new Set(L);return V.has(I)?V.delete(I):V.add(I),V})},P=async I=>{j(!0);try{await To.restoreIngredientFromTrash(I),B("success",""),g(new Set),await R()}catch(L){B("error",": "+(L?.message||String(L)))}finally{j(!1)}},H=async()=>{const I=x?.ids||[];w(!0);try{await To.permanentlyDeleteIngredientTrash(I),B("success",`${I.length}`),g(new Set),v(null),await R()}catch(L){B("error",": "+(L?.message||String(L)))}finally{w(!1)}},O=async()=>{x&&(x.type==="price"?await M():await H())},q=o||_||S,C=e.length===0&&s.length===0;return r.jsxs("div",{style:{padding:"1rem",maxWidth:"900px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"1.4rem"},children:" "}),r.jsx(ce,{variant:"ghost",onClick:R,disabled:q,style:{fontSize:"0.85rem"},children:o?"...":" "})]}),u&&r.jsx("div",{className:"status-msg error",style:{marginBottom:"1rem"},children:u}),E&&r.jsx("div",{className:`status-msg ${E.type}`,style:{marginBottom:"1rem"},children:E.text}),!o&&C&&r.jsx("div",{style:{color:"rgba(255,255,255,0.6)",textAlign:"center",padding:"3rem",fontSize:"1rem"},children:""}),e.length>0&&r.jsxs("div",{style:{marginBottom:"2rem"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"10px",flexWrap:"wrap",gap:"8px"},children:[r.jsxs("h4",{style:{margin:0,color:"#fff",fontSize:"1rem"},children:[" CSV",e.length,""]}),r.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[r.jsxs(ce,{variant:"secondary",onClick:$,disabled:f.size===0||q,children:["",f.size,""]}),r.jsx(ce,{variant:"danger",onClick:()=>v({type:"price",ids:f.size>0?Array.from(f):e.map(I=>I.id)}),disabled:q,children:f.size>0?`${f.size}`:""})]})]}),r.jsx("div",{style:{background:"#fff",borderRadius:"8px",overflow:"hidden"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f8f9fa"},children:[r.jsx("th",{style:{width:36,padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #eee"},children:r.jsx("input",{type:"checkbox",checked:f.size===e.length,onChange:I=>p(I.target.checked?new Set(e.map(L=>L.id)):new Set)})}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111"},children:""}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111",whiteSpace:"nowrap"},children:""})]})}),r.jsx("tbody",{children:e.map(I=>r.jsxs("tr",{onClick:()=>F(I.id),style:{cursor:"pointer",background:f.has(I.id)?"#fef2f2":void 0},children:[r.jsx("td",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #f0f0f0"},children:r.jsx("input",{type:"checkbox",checked:f.has(I.id),onChange:()=>F(I.id),onClick:L=>L.stopPropagation()})}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#1f2937"},children:I.file_name}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#6b7280",whiteSpace:"nowrap",fontSize:"0.82rem"},children:new Date(I.deleted_at).toLocaleString("ja-JP")})]},I.id))})]})})]}),s.length>0&&r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"10px",flexWrap:"wrap",gap:"8px"},children:[r.jsxs("h4",{style:{margin:0,color:"#fff",fontSize:"1rem"},children:[" ",s.length,""]}),r.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:r.jsx(ce,{variant:"danger",onClick:()=>v({type:"ingredient",ids:m.size>0?Array.from(m):s.map(I=>I.id)}),disabled:q,children:m.size>0?`${m.size}`:""})})]}),r.jsx("div",{style:{background:"#fff",borderRadius:"8px",overflow:"hidden"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f8f9fa"},children:[r.jsx("th",{style:{width:36,padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #eee"},children:r.jsx("input",{type:"checkbox",checked:m.size===s.length,onChange:I=>g(I.target.checked?new Set(s.map(L=>L.id)):new Set)})}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111"},children:""}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111"},children:""}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #eee",color:"#111"},children:""})]})}),r.jsx("tbody",{children:s.map(I=>r.jsxs("tr",{style:{background:m.has(I.id)?"#fef2f2":void 0},children:[r.jsx("td",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #f0f0f0"},children:r.jsx("input",{type:"checkbox",checked:m.has(I.id),onChange:()=>z(I.id)})}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#1f2937"},children:I.label}),r.jsxs("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#374151"},children:[(I.item_count||0).toLocaleString(),""]}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#6b7280",whiteSpace:"nowrap",fontSize:"0.82rem"},children:new Date(I.deleted_at).toLocaleString("ja-JP")}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",textAlign:"center"},children:r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>P(I.id),disabled:q,children:""})})]},I.id))})]})})]}),r.jsx(Ho,{isOpen:!!x,onClose:()=>v(null),onConfirm:O,title:"",description:r.jsxs("span",{children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:S})]})},F2=({isOpen:e,onClose:t,onConfirm:s,loading:a,progressStatus:o,copyResult:c})=>{if(!e)return null;const u=()=>{if(!o)return null;const{phase:p,message:m,totalUser:g,doneUser:x,totalFile:v,doneFile:S}=o;return r.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[r.jsx("div",{style:{marginBottom:"10px",fontWeight:"bold",color:"#334155"},children:m||"..."}),g>0&&r.jsxs("div",{style:{marginBottom:"15px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.85rem",marginBottom:"4px",color:"#64748b"},children:[r.jsxs("span",{children:[" (",x," / ",g," )"]}),r.jsxs("span",{children:[Math.round(x/g*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${x/g*100}%`,height:"100%",backgroundColor:"#3b82f6",transition:"width 0.3s ease"}})})]}),p==="progress_file"&&v>0&&r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",marginBottom:"4px",color:"#64748b"},children:[r.jsxs("span",{children:[" (",S," / ",v,")"]}),r.jsxs("span",{children:[Math.round(S/v*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"6px",backgroundColor:"#e2e8f0",borderRadius:"3px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${S/v*100}%`,height:"100%",backgroundColor:"#10b981",transition:"width 0.2s ease"}})})]})]})},h=()=>c?r.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#ecfdf5",borderRadius:"8px",border:"1px solid #a7f3d0"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#065f46",marginBottom:"10px"},children:" "}),r.jsxs("ul",{style:{margin:0,paddingLeft:"20px",fontSize:"0.9rem",color:"#047857"},children:[r.jsxs("li",{children:[": ",c.totalTargetUsers," "]}),r.jsxs("li",{children:[": ",c.csvResults.filter(p=>!p.error).length," / ",c.csvResults.filter(p=>p.error).length,""]}),r.jsx("li",{children:": "})]})]}):null,f=c!==null||o&&o.phase==="done";return r.jsx(an,{isOpen:e,onClose:()=>{a||t()},title:"",maxWidth:"550px",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[!o&&!c&&r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsxs("p",{style:{margin:"0 0 10px",fontSize:"0.95rem",lineHeight:1.6,color:"#334155"},children:["",r.jsx("strong",{children:"CSV"}),"",r.jsx("strong",{children:""}),"",r.jsx("br",{}),r.jsx("strong",{children:""}),""]}),r.jsxs("div",{style:{backgroundColor:"#fff8f1",padding:"12px",borderRadius:"8px",border:"1px solid #fed7aa",fontSize:"0.85rem",color:"#c2410c"},children:[" ",r.jsx("strong",{children:""}),r.jsxs("ul",{style:{margin:"8px 0 0",paddingLeft:"20px",lineHeight:1.5},children:[r.jsx("li",{children:""}),r.jsxs("li",{children:[" ",r.jsx("code",{children:"_copy"})," "]}),r.jsx("li",{children:""})]})]})]}),u(),h(),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"24px"},children:[!a&&!f&&r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"ghost",onClick:t,children:""}),r.jsx(ce,{variant:"primary",onClick:s,children:" "})]}),f&&r.jsx(ce,{variant:"primary",onClick:t,children:""})]})]})})};function Ju(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jp={exports:{}};var Px;function V2(){return Px||(Px=1,(function(e,t){(function(s){e.exports=s()})(function(){return(function s(a,o,c){function u(p,m){if(!o[p]){if(!a[p]){var g=typeof Ju=="function"&&Ju;if(!m&&g)return g(p,!0);if(h)return h(p,!0);var x=new Error("Cannot find module '"+p+"'");throw x.code="MODULE_NOT_FOUND",x}var v=o[p]={exports:{}};a[p][0].call(v.exports,function(S){var w=a[p][1][S];return u(w||S)},v,v.exports,s,a,o,c)}return o[p].exports}for(var h=typeof Ju=="function"&&Ju,f=0;f<c.length;f++)u(c[f]);return u})({1:[function(s,a,o){var c=s("./utils"),u=s("./support"),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(f){for(var p,m,g,x,v,S,w,_=[],j=0,E=f.length,T=E,R=c.getTypeOf(f)!=="string";j<f.length;)T=E-j,g=R?(p=f[j++],m=j<E?f[j++]:0,j<E?f[j++]:0):(p=f.charCodeAt(j++),m=j<E?f.charCodeAt(j++):0,j<E?f.charCodeAt(j++):0),x=p>>2,v=(3&p)<<4|m>>4,S=1<T?(15&m)<<2|g>>6:64,w=2<T?63&g:64,_.push(h.charAt(x)+h.charAt(v)+h.charAt(S)+h.charAt(w));return _.join("")},o.decode=function(f){var p,m,g,x,v,S,w=0,_=0,j="data:";if(f.substr(0,j.length)===j)throw new Error("Invalid base64 input, it looks like a data url.");var E,T=3*(f=f.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(f.charAt(f.length-1)===h.charAt(64)&&T--,f.charAt(f.length-2)===h.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(E=u.uint8array?new Uint8Array(0|T):new Array(0|T);w<f.length;)p=h.indexOf(f.charAt(w++))<<2|(x=h.indexOf(f.charAt(w++)))>>4,m=(15&x)<<4|(v=h.indexOf(f.charAt(w++)))>>2,g=(3&v)<<6|(S=h.indexOf(f.charAt(w++))),E[_++]=p,v!==64&&(E[_++]=m),S!==64&&(E[_++]=g);return E}},{"./support":30,"./utils":32}],2:[function(s,a,o){var c=s("./external"),u=s("./stream/DataWorker"),h=s("./stream/Crc32Probe"),f=s("./stream/DataLengthProbe");function p(m,g,x,v,S){this.compressedSize=m,this.uncompressedSize=g,this.crc32=x,this.compression=v,this.compressedContent=S}p.prototype={getContentWorker:function(){var m=new u(c.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new f("data_length")),g=this;return m.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),m},getCompressedWorker:function(){return new u(c.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},p.createWorkerFrom=function(m,g,x){return m.pipe(new h).pipe(new f("uncompressedSize")).pipe(g.compressWorker(x)).pipe(new f("compressedSize")).withStreamInfo("compression",g)},a.exports=p},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(s,a,o){var c=s("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new c("STORE compression")},uncompressWorker:function(){return new c("STORE decompression")}},o.DEFLATE=s("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(s,a,o){var c=s("./utils"),u=(function(){for(var h,f=[],p=0;p<256;p++){h=p;for(var m=0;m<8;m++)h=1&h?3988292384^h>>>1:h>>>1;f[p]=h}return f})();a.exports=function(h,f){return h!==void 0&&h.length?c.getTypeOf(h)!=="string"?(function(p,m,g,x){var v=u,S=x+g;p^=-1;for(var w=x;w<S;w++)p=p>>>8^v[255&(p^m[w])];return-1^p})(0|f,h,h.length,0):(function(p,m,g,x){var v=u,S=x+g;p^=-1;for(var w=x;w<S;w++)p=p>>>8^v[255&(p^m.charCodeAt(w))];return-1^p})(0|f,h,h.length,0):0}},{"./utils":32}],5:[function(s,a,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(s,a,o){var c=null;c=typeof Promise<"u"?Promise:s("lie"),a.exports={Promise:c}},{lie:37}],7:[function(s,a,o){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",u=s("pako"),h=s("./utils"),f=s("./stream/GenericWorker"),p=c?"uint8array":"array";function m(g,x){f.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=x,this.meta={}}o.magic="\b\0",h.inherits(m,f),m.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(h.transformTo(p,g.data),!1)},m.prototype.flush=function(){f.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},m.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this._pako=null},m.prototype._createPako=function(){this._pako=new u[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(x){g.push({data:x,meta:g.meta})}},o.compressWorker=function(g){return new m("Deflate",g)},o.uncompressWorker=function(){return new m("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(s,a,o){function c(v,S){var w,_="";for(w=0;w<S;w++)_+=String.fromCharCode(255&v),v>>>=8;return _}function u(v,S,w,_,j,E){var T,R,B=v.file,F=v.compression,$=E!==p.utf8encode,M=h.transformTo("string",E(B.name)),z=h.transformTo("string",p.utf8encode(B.name)),P=B.comment,H=h.transformTo("string",E(P)),O=h.transformTo("string",p.utf8encode(P)),q=z.length!==B.name.length,C=O.length!==P.length,I="",L="",V="",G=B.dir,Y=B.date,Z={crc32:0,compressedSize:0,uncompressedSize:0};S&&!w||(Z.crc32=v.crc32,Z.compressedSize=v.compressedSize,Z.uncompressedSize=v.uncompressedSize);var A=0;S&&(A|=8),$||!q&&!C||(A|=2048);var U=0,X=0;G&&(U|=16),j==="UNIX"?(X=798,U|=(function(oe,Ce){var ue=oe;return oe||(ue=Ce?16893:33204),(65535&ue)<<16})(B.unixPermissions,G)):(X=20,U|=(function(oe){return 63&(oe||0)})(B.dosPermissions)),T=Y.getUTCHours(),T<<=6,T|=Y.getUTCMinutes(),T<<=5,T|=Y.getUTCSeconds()/2,R=Y.getUTCFullYear()-1980,R<<=4,R|=Y.getUTCMonth()+1,R<<=5,R|=Y.getUTCDate(),q&&(L=c(1,1)+c(m(M),4)+z,I+="up"+c(L.length,2)+L),C&&(V=c(1,1)+c(m(H),4)+O,I+="uc"+c(V.length,2)+V);var se="";return se+=`
\0`,se+=c(A,2),se+=F.magic,se+=c(T,2),se+=c(R,2),se+=c(Z.crc32,4),se+=c(Z.compressedSize,4),se+=c(Z.uncompressedSize,4),se+=c(M.length,2),se+=c(I.length,2),{fileRecord:g.LOCAL_FILE_HEADER+se+M+I,dirRecord:g.CENTRAL_FILE_HEADER+c(X,2)+se+c(H.length,2)+"\0\0\0\0"+c(U,4)+c(_,4)+M+I+H}}var h=s("../utils"),f=s("../stream/GenericWorker"),p=s("../utf8"),m=s("../crc32"),g=s("../signature");function x(v,S,w,_){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=S,this.zipPlatform=w,this.encodeFileName=_,this.streamFiles=v,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}h.inherits(x,f),x.prototype.push=function(v){var S=v.meta.percent||0,w=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(v):(this.bytesWritten+=v.data.length,f.prototype.push.call(this,{data:v.data,meta:{currentFile:this.currentFile,percent:w?(S+100*(w-_-1))/w:100}}))},x.prototype.openedSource=function(v){this.currentSourceOffset=this.bytesWritten,this.currentFile=v.file.name;var S=this.streamFiles&&!v.file.dir;if(S){var w=u(v,S,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:w.fileRecord,meta:{percent:0}})}else this.accumulate=!0},x.prototype.closedSource=function(v){this.accumulate=!1;var S=this.streamFiles&&!v.file.dir,w=u(v,S,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(w.dirRecord),S)this.push({data:(function(_){return g.DATA_DESCRIPTOR+c(_.crc32,4)+c(_.compressedSize,4)+c(_.uncompressedSize,4)})(v),meta:{percent:100}});else for(this.push({data:w.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},x.prototype.flush=function(){for(var v=this.bytesWritten,S=0;S<this.dirRecords.length;S++)this.push({data:this.dirRecords[S],meta:{percent:100}});var w=this.bytesWritten-v,_=(function(j,E,T,R,B){var F=h.transformTo("string",B(R));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(j,2)+c(j,2)+c(E,4)+c(T,4)+c(F.length,2)+F})(this.dirRecords.length,w,v,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},x.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},x.prototype.registerPrevious=function(v){this._sources.push(v);var S=this;return v.on("data",function(w){S.processChunk(w)}),v.on("end",function(){S.closedSource(S.previous.streamInfo),S._sources.length?S.prepareNextSource():S.end()}),v.on("error",function(w){S.error(w)}),this},x.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},x.prototype.error=function(v){var S=this._sources;if(!f.prototype.error.call(this,v))return!1;for(var w=0;w<S.length;w++)try{S[w].error(v)}catch{}return!0},x.prototype.lock=function(){f.prototype.lock.call(this);for(var v=this._sources,S=0;S<v.length;S++)v[S].lock()},a.exports=x},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(s,a,o){var c=s("../compressions"),u=s("./ZipFileWorker");o.generateWorker=function(h,f,p){var m=new u(f.streamFiles,p,f.platform,f.encodeFileName),g=0;try{h.forEach(function(x,v){g++;var S=(function(E,T){var R=E||T,B=c[R];if(!B)throw new Error(R+" is not a valid compression method !");return B})(v.options.compression,f.compression),w=v.options.compressionOptions||f.compressionOptions||{},_=v.dir,j=v.date;v._compressWorker(S,w).withStreamInfo("file",{name:x,dir:_,date:j,comment:v.comment||"",unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions}).pipe(m)}),m.entriesCount=g}catch(x){m.error(x)}return m}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(s,a,o){function c(){if(!(this instanceof c))return new c;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var u=new c;for(var h in this)typeof this[h]!="function"&&(u[h]=this[h]);return u}}(c.prototype=s("./object")).loadAsync=s("./load"),c.support=s("./support"),c.defaults=s("./defaults"),c.version="3.10.1",c.loadAsync=function(u,h){return new c().loadAsync(u,h)},c.external=s("./external"),a.exports=c},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(s,a,o){var c=s("./utils"),u=s("./external"),h=s("./utf8"),f=s("./zipEntries"),p=s("./stream/Crc32Probe"),m=s("./nodejsUtils");function g(x){return new u.Promise(function(v,S){var w=x.decompressed.getContentWorker().pipe(new p);w.on("error",function(_){S(_)}).on("end",function(){w.streamInfo.crc32!==x.decompressed.crc32?S(new Error("Corrupted zip : CRC32 mismatch")):v()}).resume()})}a.exports=function(x,v){var S=this;return v=c.extend(v||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:h.utf8decode}),m.isNode&&m.isStream(x)?u.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):c.prepareContent("the loaded zip file",x,!0,v.optimizedBinaryString,v.base64).then(function(w){var _=new f(v);return _.load(w),_}).then(function(w){var _=[u.Promise.resolve(w)],j=w.files;if(v.checkCRC32)for(var E=0;E<j.length;E++)_.push(g(j[E]));return u.Promise.all(_)}).then(function(w){for(var _=w.shift(),j=_.files,E=0;E<j.length;E++){var T=j[E],R=T.fileNameStr,B=c.resolve(T.fileNameStr);S.file(B,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:v.createFolders}),T.dir||(S.file(B).unsafeOriginalName=R)}return _.zipComment.length&&(S.comment=_.zipComment),S})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(s,a,o){var c=s("../utils"),u=s("../stream/GenericWorker");function h(f,p){u.call(this,"Nodejs stream input adapter for "+f),this._upstreamEnded=!1,this._bindStream(p)}c.inherits(h,u),h.prototype._bindStream=function(f){var p=this;(this._stream=f).pause(),f.on("data",function(m){p.push({data:m,meta:{percent:0}})}).on("error",function(m){p.isPaused?this.generatedError=m:p.error(m)}).on("end",function(){p.isPaused?p._upstreamEnded=!0:p.end()})},h.prototype.pause=function(){return!!u.prototype.pause.call(this)&&(this._stream.pause(),!0)},h.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},a.exports=h},{"../stream/GenericWorker":28,"../utils":32}],13:[function(s,a,o){var c=s("readable-stream").Readable;function u(h,f,p){c.call(this,f),this._helper=h;var m=this;h.on("data",function(g,x){m.push(g)||m._helper.pause(),p&&p(x)}).on("error",function(g){m.emit("error",g)}).on("end",function(){m.push(null)})}s("../utils").inherits(u,c),u.prototype._read=function(){this._helper.resume()},a.exports=u},{"../utils":32,"readable-stream":16}],14:[function(s,a,o){a.exports={isNode:typeof Buffer<"u",newBufferFrom:function(c,u){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(c,u);if(typeof c=="number")throw new Error('The "data" argument must not be a number');return new Buffer(c,u)},allocBuffer:function(c){if(Buffer.alloc)return Buffer.alloc(c);var u=new Buffer(c);return u.fill(0),u},isBuffer:function(c){return Buffer.isBuffer(c)},isStream:function(c){return c&&typeof c.on=="function"&&typeof c.pause=="function"&&typeof c.resume=="function"}}},{}],15:[function(s,a,o){function c(B,F,$){var M,z=h.getTypeOf(F),P=h.extend($||{},m);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(B=j(B)),P.createFolders&&(M=_(B))&&E.call(this,M,!0);var H=z==="string"&&P.binary===!1&&P.base64===!1;$&&$.binary!==void 0||(P.binary=!H),(F instanceof g&&F.uncompressedSize===0||P.dir||!F||F.length===0)&&(P.base64=!1,P.binary=!0,F="",P.compression="STORE",z="string");var O=null;O=F instanceof g||F instanceof f?F:S.isNode&&S.isStream(F)?new w(B,F):h.prepareContent(B,F,P.binary,P.optimizedBinaryString,P.base64);var q=new x(B,O,P);this.files[B]=q}var u=s("./utf8"),h=s("./utils"),f=s("./stream/GenericWorker"),p=s("./stream/StreamHelper"),m=s("./defaults"),g=s("./compressedObject"),x=s("./zipObject"),v=s("./generate"),S=s("./nodejsUtils"),w=s("./nodejs/NodejsStreamInputAdapter"),_=function(B){B.slice(-1)==="/"&&(B=B.substring(0,B.length-1));var F=B.lastIndexOf("/");return 0<F?B.substring(0,F):""},j=function(B){return B.slice(-1)!=="/"&&(B+="/"),B},E=function(B,F){return F=F!==void 0?F:m.createFolders,B=j(B),this.files[B]||c.call(this,B,null,{dir:!0,createFolders:F}),this.files[B]};function T(B){return Object.prototype.toString.call(B)==="[object RegExp]"}var R={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(B){var F,$,M;for(F in this.files)M=this.files[F],($=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&B($,M)},filter:function(B){var F=[];return this.forEach(function($,M){B($,M)&&F.push(M)}),F},file:function(B,F,$){if(arguments.length!==1)return B=this.root+B,c.call(this,B,F,$),this;if(T(B)){var M=B;return this.filter(function(P,H){return!H.dir&&M.test(P)})}var z=this.files[this.root+B];return z&&!z.dir?z:null},folder:function(B){if(!B)return this;if(T(B))return this.filter(function(z,P){return P.dir&&B.test(z)});var F=this.root+B,$=E.call(this,F),M=this.clone();return M.root=$.name,M},remove:function(B){B=this.root+B;var F=this.files[B];if(F||(B.slice(-1)!=="/"&&(B+="/"),F=this.files[B]),F&&!F.dir)delete this.files[B];else for(var $=this.filter(function(z,P){return P.name.slice(0,B.length)===B}),M=0;M<$.length;M++)delete this.files[$[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(B){var F,$={};try{if(($=h.extend(B||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:u.utf8encode})).type=$.type.toLowerCase(),$.compression=$.compression.toUpperCase(),$.type==="binarystring"&&($.type="string"),!$.type)throw new Error("No output type specified.");h.checkSupport($.type),$.platform!=="darwin"&&$.platform!=="freebsd"&&$.platform!=="linux"&&$.platform!=="sunos"||($.platform="UNIX"),$.platform==="win32"&&($.platform="DOS");var M=$.comment||this.comment||"";F=v.generateWorker(this,$,M)}catch(z){(F=new f("error")).error(z)}return new p(F,$.type||"string",$.mimeType)},generateAsync:function(B,F){return this.generateInternalStream(B).accumulate(F)},generateNodeStream:function(B,F){return(B=B||{}).type||(B.type="nodebuffer"),this.generateInternalStream(B).toNodejsStream(F)}};a.exports=R},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(s,a,o){a.exports=s("stream")},{stream:void 0}],17:[function(s,a,o){var c=s("./DataReader");function u(h){c.call(this,h);for(var f=0;f<this.data.length;f++)h[f]=255&h[f]}s("../utils").inherits(u,c),u.prototype.byteAt=function(h){return this.data[this.zero+h]},u.prototype.lastIndexOfSignature=function(h){for(var f=h.charCodeAt(0),p=h.charCodeAt(1),m=h.charCodeAt(2),g=h.charCodeAt(3),x=this.length-4;0<=x;--x)if(this.data[x]===f&&this.data[x+1]===p&&this.data[x+2]===m&&this.data[x+3]===g)return x-this.zero;return-1},u.prototype.readAndCheckSignature=function(h){var f=h.charCodeAt(0),p=h.charCodeAt(1),m=h.charCodeAt(2),g=h.charCodeAt(3),x=this.readData(4);return f===x[0]&&p===x[1]&&m===x[2]&&g===x[3]},u.prototype.readData=function(h){if(this.checkOffset(h),h===0)return[];var f=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,f},a.exports=u},{"../utils":32,"./DataReader":18}],18:[function(s,a,o){var c=s("../utils");function u(h){this.data=h,this.length=h.length,this.index=0,this.zero=0}u.prototype={checkOffset:function(h){this.checkIndex(this.index+h)},checkIndex:function(h){if(this.length<this.zero+h||h<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+h+"). Corrupted zip ?")},setIndex:function(h){this.checkIndex(h),this.index=h},skip:function(h){this.setIndex(this.index+h)},byteAt:function(){},readInt:function(h){var f,p=0;for(this.checkOffset(h),f=this.index+h-1;f>=this.index;f--)p=(p<<8)+this.byteAt(f);return this.index+=h,p},readString:function(h){return c.transformTo("string",this.readData(h))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var h=this.readInt(4);return new Date(Date.UTC(1980+(h>>25&127),(h>>21&15)-1,h>>16&31,h>>11&31,h>>5&63,(31&h)<<1))}},a.exports=u},{"../utils":32}],19:[function(s,a,o){var c=s("./Uint8ArrayReader");function u(h){c.call(this,h)}s("../utils").inherits(u,c),u.prototype.readData=function(h){this.checkOffset(h);var f=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,f},a.exports=u},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(s,a,o){var c=s("./DataReader");function u(h){c.call(this,h)}s("../utils").inherits(u,c),u.prototype.byteAt=function(h){return this.data.charCodeAt(this.zero+h)},u.prototype.lastIndexOfSignature=function(h){return this.data.lastIndexOf(h)-this.zero},u.prototype.readAndCheckSignature=function(h){return h===this.readData(4)},u.prototype.readData=function(h){this.checkOffset(h);var f=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,f},a.exports=u},{"../utils":32,"./DataReader":18}],21:[function(s,a,o){var c=s("./ArrayReader");function u(h){c.call(this,h)}s("../utils").inherits(u,c),u.prototype.readData=function(h){if(this.checkOffset(h),h===0)return new Uint8Array(0);var f=this.data.subarray(this.zero+this.index,this.zero+this.index+h);return this.index+=h,f},a.exports=u},{"../utils":32,"./ArrayReader":17}],22:[function(s,a,o){var c=s("../utils"),u=s("../support"),h=s("./ArrayReader"),f=s("./StringReader"),p=s("./NodeBufferReader"),m=s("./Uint8ArrayReader");a.exports=function(g){var x=c.getTypeOf(g);return c.checkSupport(x),x!=="string"||u.uint8array?x==="nodebuffer"?new p(g):u.uint8array?new m(c.transformTo("uint8array",g)):new h(c.transformTo("array",g)):new f(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(s,a,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(s,a,o){var c=s("./GenericWorker"),u=s("../utils");function h(f){c.call(this,"ConvertWorker to "+f),this.destType=f}u.inherits(h,c),h.prototype.processChunk=function(f){this.push({data:u.transformTo(this.destType,f.data),meta:f.meta})},a.exports=h},{"../utils":32,"./GenericWorker":28}],25:[function(s,a,o){var c=s("./GenericWorker"),u=s("../crc32");function h(){c.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}s("../utils").inherits(h,c),h.prototype.processChunk=function(f){this.streamInfo.crc32=u(f.data,this.streamInfo.crc32||0),this.push(f)},a.exports=h},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(s,a,o){var c=s("../utils"),u=s("./GenericWorker");function h(f){u.call(this,"DataLengthProbe for "+f),this.propName=f,this.withStreamInfo(f,0)}c.inherits(h,u),h.prototype.processChunk=function(f){if(f){var p=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=p+f.data.length}u.prototype.processChunk.call(this,f)},a.exports=h},{"../utils":32,"./GenericWorker":28}],27:[function(s,a,o){var c=s("../utils"),u=s("./GenericWorker");function h(f){u.call(this,"DataWorker");var p=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,f.then(function(m){p.dataIsReady=!0,p.data=m,p.max=m&&m.length||0,p.type=c.getTypeOf(m),p.isPaused||p._tickAndRepeat()},function(m){p.error(m)})}c.inherits(h,u),h.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this.data=null},h.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,c.delay(this._tickAndRepeat,[],this)),!0)},h.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(c.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},h.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var f=null,p=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":f=this.data.substring(this.index,p);break;case"uint8array":f=this.data.subarray(this.index,p);break;case"array":case"nodebuffer":f=this.data.slice(this.index,p)}return this.index=p,this.push({data:f,meta:{percent:this.max?this.index/this.max*100:0}})},a.exports=h},{"../utils":32,"./GenericWorker":28}],28:[function(s,a,o){function c(u){this.name=u||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}c.prototype={push:function(u){this.emit("data",u)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(u){this.emit("error",u)}return!0},error:function(u){return!this.isFinished&&(this.isPaused?this.generatedError=u:(this.isFinished=!0,this.emit("error",u),this.previous&&this.previous.error(u),this.cleanUp()),!0)},on:function(u,h){return this._listeners[u].push(h),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(u,h){if(this._listeners[u])for(var f=0;f<this._listeners[u].length;f++)this._listeners[u][f].call(this,h)},pipe:function(u){return u.registerPrevious(this)},registerPrevious:function(u){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=u.streamInfo,this.mergeStreamInfo(),this.previous=u;var h=this;return u.on("data",function(f){h.processChunk(f)}),u.on("end",function(){h.end()}),u.on("error",function(f){h.error(f)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var u=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),u=!0),this.previous&&this.previous.resume(),!u},flush:function(){},processChunk:function(u){this.push(u)},withStreamInfo:function(u,h){return this.extraStreamInfo[u]=h,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var u in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,u)&&(this.streamInfo[u]=this.extraStreamInfo[u])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var u="Worker "+this.name;return this.previous?this.previous+" -> "+u:u}},a.exports=c},{}],29:[function(s,a,o){var c=s("../utils"),u=s("./ConvertWorker"),h=s("./GenericWorker"),f=s("../base64"),p=s("../support"),m=s("../external"),g=null;if(p.nodestream)try{g=s("../nodejs/NodejsStreamOutputAdapter")}catch{}function x(S,w){return new m.Promise(function(_,j){var E=[],T=S._internalType,R=S._outputType,B=S._mimeType;S.on("data",function(F,$){E.push(F),w&&w($)}).on("error",function(F){E=[],j(F)}).on("end",function(){try{var F=(function($,M,z){switch($){case"blob":return c.newBlob(c.transformTo("arraybuffer",M),z);case"base64":return f.encode(M);default:return c.transformTo($,M)}})(R,(function($,M){var z,P=0,H=null,O=0;for(z=0;z<M.length;z++)O+=M[z].length;switch($){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(H=new Uint8Array(O),z=0;z<M.length;z++)H.set(M[z],P),P+=M[z].length;return H;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+$+"'")}})(T,E),B);_(F)}catch($){j($)}E=[]}).resume()})}function v(S,w,_){var j=w;switch(w){case"blob":case"arraybuffer":j="uint8array";break;case"base64":j="string"}try{this._internalType=j,this._outputType=w,this._mimeType=_,c.checkSupport(j),this._worker=S.pipe(new u(j)),S.lock()}catch(E){this._worker=new h("error"),this._worker.error(E)}}v.prototype={accumulate:function(S){return x(this,S)},on:function(S,w){var _=this;return S==="data"?this._worker.on(S,function(j){w.call(_,j.data,j.meta)}):this._worker.on(S,function(){c.delay(w,arguments,_)}),this},resume:function(){return c.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(S){if(c.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},S)}},a.exports=v},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(s,a,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var c=new ArrayBuffer(0);try{o.blob=new Blob([c],{type:"application/zip"}).size===0}catch{try{var u=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);u.append(c),o.blob=u.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!s("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(s,a,o){for(var c=s("./utils"),u=s("./support"),h=s("./nodejsUtils"),f=s("./stream/GenericWorker"),p=new Array(256),m=0;m<256;m++)p[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;p[254]=p[254]=1;function g(){f.call(this,"utf-8 decode"),this.leftOver=null}function x(){f.call(this,"utf-8 encode")}o.utf8encode=function(v){return u.nodebuffer?h.newBufferFrom(v,"utf-8"):(function(S){var w,_,j,E,T,R=S.length,B=0;for(E=0;E<R;E++)(64512&(_=S.charCodeAt(E)))==55296&&E+1<R&&(64512&(j=S.charCodeAt(E+1)))==56320&&(_=65536+(_-55296<<10)+(j-56320),E++),B+=_<128?1:_<2048?2:_<65536?3:4;for(w=u.uint8array?new Uint8Array(B):new Array(B),E=T=0;T<B;E++)(64512&(_=S.charCodeAt(E)))==55296&&E+1<R&&(64512&(j=S.charCodeAt(E+1)))==56320&&(_=65536+(_-55296<<10)+(j-56320),E++),_<128?w[T++]=_:(_<2048?w[T++]=192|_>>>6:(_<65536?w[T++]=224|_>>>12:(w[T++]=240|_>>>18,w[T++]=128|_>>>12&63),w[T++]=128|_>>>6&63),w[T++]=128|63&_);return w})(v)},o.utf8decode=function(v){return u.nodebuffer?c.transformTo("nodebuffer",v).toString("utf-8"):(function(S){var w,_,j,E,T=S.length,R=new Array(2*T);for(w=_=0;w<T;)if((j=S[w++])<128)R[_++]=j;else if(4<(E=p[j]))R[_++]=65533,w+=E-1;else{for(j&=E===2?31:E===3?15:7;1<E&&w<T;)j=j<<6|63&S[w++],E--;1<E?R[_++]=65533:j<65536?R[_++]=j:(j-=65536,R[_++]=55296|j>>10&1023,R[_++]=56320|1023&j)}return R.length!==_&&(R.subarray?R=R.subarray(0,_):R.length=_),c.applyFromCharCode(R)})(v=c.transformTo(u.uint8array?"uint8array":"array",v))},c.inherits(g,f),g.prototype.processChunk=function(v){var S=c.transformTo(u.uint8array?"uint8array":"array",v.data);if(this.leftOver&&this.leftOver.length){if(u.uint8array){var w=S;(S=new Uint8Array(w.length+this.leftOver.length)).set(this.leftOver,0),S.set(w,this.leftOver.length)}else S=this.leftOver.concat(S);this.leftOver=null}var _=(function(E,T){var R;for((T=T||E.length)>E.length&&(T=E.length),R=T-1;0<=R&&(192&E[R])==128;)R--;return R<0||R===0?T:R+p[E[R]]>T?R:T})(S),j=S;_!==S.length&&(u.uint8array?(j=S.subarray(0,_),this.leftOver=S.subarray(_,S.length)):(j=S.slice(0,_),this.leftOver=S.slice(_,S.length))),this.push({data:o.utf8decode(j),meta:v.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=g,c.inherits(x,f),x.prototype.processChunk=function(v){this.push({data:o.utf8encode(v.data),meta:v.meta})},o.Utf8EncodeWorker=x},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(s,a,o){var c=s("./support"),u=s("./base64"),h=s("./nodejsUtils"),f=s("./external");function p(w){return w}function m(w,_){for(var j=0;j<w.length;++j)_[j]=255&w.charCodeAt(j);return _}s("setimmediate"),o.newBlob=function(w,_){o.checkSupport("blob");try{return new Blob([w],{type:_})}catch{try{var j=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return j.append(w),j.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(w,_,j){var E=[],T=0,R=w.length;if(R<=j)return String.fromCharCode.apply(null,w);for(;T<R;)_==="array"||_==="nodebuffer"?E.push(String.fromCharCode.apply(null,w.slice(T,Math.min(T+j,R)))):E.push(String.fromCharCode.apply(null,w.subarray(T,Math.min(T+j,R)))),T+=j;return E.join("")},stringifyByChar:function(w){for(var _="",j=0;j<w.length;j++)_+=String.fromCharCode(w[j]);return _},applyCanBeUsed:{uint8array:(function(){try{return c.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return c.nodebuffer&&String.fromCharCode.apply(null,h.allocBuffer(1)).length===1}catch{return!1}})()}};function x(w){var _=65536,j=o.getTypeOf(w),E=!0;if(j==="uint8array"?E=g.applyCanBeUsed.uint8array:j==="nodebuffer"&&(E=g.applyCanBeUsed.nodebuffer),E)for(;1<_;)try{return g.stringifyByChunk(w,j,_)}catch{_=Math.floor(_/2)}return g.stringifyByChar(w)}function v(w,_){for(var j=0;j<w.length;j++)_[j]=w[j];return _}o.applyFromCharCode=x;var S={};S.string={string:p,array:function(w){return m(w,new Array(w.length))},arraybuffer:function(w){return S.string.uint8array(w).buffer},uint8array:function(w){return m(w,new Uint8Array(w.length))},nodebuffer:function(w){return m(w,h.allocBuffer(w.length))}},S.array={string:x,array:p,arraybuffer:function(w){return new Uint8Array(w).buffer},uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return h.newBufferFrom(w)}},S.arraybuffer={string:function(w){return x(new Uint8Array(w))},array:function(w){return v(new Uint8Array(w),new Array(w.byteLength))},arraybuffer:p,uint8array:function(w){return new Uint8Array(w)},nodebuffer:function(w){return h.newBufferFrom(new Uint8Array(w))}},S.uint8array={string:x,array:function(w){return v(w,new Array(w.length))},arraybuffer:function(w){return w.buffer},uint8array:p,nodebuffer:function(w){return h.newBufferFrom(w)}},S.nodebuffer={string:x,array:function(w){return v(w,new Array(w.length))},arraybuffer:function(w){return S.nodebuffer.uint8array(w).buffer},uint8array:function(w){return v(w,new Uint8Array(w.length))},nodebuffer:p},o.transformTo=function(w,_){if(_=_||"",!w)return _;o.checkSupport(w);var j=o.getTypeOf(_);return S[j][w](_)},o.resolve=function(w){for(var _=w.split("/"),j=[],E=0;E<_.length;E++){var T=_[E];T==="."||T===""&&E!==0&&E!==_.length-1||(T===".."?j.pop():j.push(T))}return j.join("/")},o.getTypeOf=function(w){return typeof w=="string"?"string":Object.prototype.toString.call(w)==="[object Array]"?"array":c.nodebuffer&&h.isBuffer(w)?"nodebuffer":c.uint8array&&w instanceof Uint8Array?"uint8array":c.arraybuffer&&w instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(w){if(!c[w.toLowerCase()])throw new Error(w+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(w){var _,j,E="";for(j=0;j<(w||"").length;j++)E+="\\x"+((_=w.charCodeAt(j))<16?"0":"")+_.toString(16).toUpperCase();return E},o.delay=function(w,_,j){setImmediate(function(){w.apply(j||null,_||[])})},o.inherits=function(w,_){function j(){}j.prototype=_.prototype,w.prototype=new j},o.extend=function(){var w,_,j={};for(w=0;w<arguments.length;w++)for(_ in arguments[w])Object.prototype.hasOwnProperty.call(arguments[w],_)&&j[_]===void 0&&(j[_]=arguments[w][_]);return j},o.prepareContent=function(w,_,j,E,T){return f.Promise.resolve(_).then(function(R){return c.blob&&(R instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(R))!==-1)&&typeof FileReader<"u"?new f.Promise(function(B,F){var $=new FileReader;$.onload=function(M){B(M.target.result)},$.onerror=function(M){F(M.target.error)},$.readAsArrayBuffer(R)}):R}).then(function(R){var B=o.getTypeOf(R);return B?(B==="arraybuffer"?R=o.transformTo("uint8array",R):B==="string"&&(T?R=u.decode(R):j&&E!==!0&&(R=(function(F){return m(F,c.uint8array?new Uint8Array(F.length):new Array(F.length))})(R))),R):f.Promise.reject(new Error("Can't read the data of '"+w+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(s,a,o){var c=s("./reader/readerFor"),u=s("./utils"),h=s("./signature"),f=s("./zipEntry"),p=s("./support");function m(g){this.files=[],this.loadOptions=g}m.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var x=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+u.pretty(x)+", expected "+u.pretty(g)+")")}},isSignature:function(g,x){var v=this.reader.index;this.reader.setIndex(g);var S=this.reader.readString(4)===x;return this.reader.setIndex(v),S},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),x=p.uint8array?"uint8array":"array",v=u.transformTo(x,g);this.zipComment=this.loadOptions.decodeFileName(v)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,x,v,S=this.zip64EndOfCentralSize-44;0<S;)g=this.reader.readInt(2),x=this.reader.readInt(4),v=this.reader.readData(x),this.zip64ExtensibleData[g]={id:g,length:x,value:v}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,x;for(g=0;g<this.files.length;g++)x=this.files[g],this.reader.setIndex(x.localHeaderOffset),this.checkSignature(h.LOCAL_FILE_HEADER),x.readLocalPart(this.reader),x.handleUTF8(),x.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(h.CENTRAL_FILE_HEADER);)(g=new f({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(h.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,h.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var x=g;if(this.checkSignature(h.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===u.MAX_VALUE_16BITS||this.diskWithCentralDirStart===u.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===u.MAX_VALUE_16BITS||this.centralDirRecords===u.MAX_VALUE_16BITS||this.centralDirSize===u.MAX_VALUE_32BITS||this.centralDirOffset===u.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,h.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var v=this.centralDirOffset+this.centralDirSize;this.zip64&&(v+=20,v+=12+this.zip64EndOfCentralSize);var S=x-v;if(0<S)this.isSignature(x,h.CENTRAL_FILE_HEADER)||(this.reader.zero=S);else if(S<0)throw new Error("Corrupted zip: missing "+Math.abs(S)+" bytes.")},prepareReader:function(g){this.reader=c(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},a.exports=m},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(s,a,o){var c=s("./reader/readerFor"),u=s("./utils"),h=s("./compressedObject"),f=s("./crc32"),p=s("./utf8"),m=s("./compressions"),g=s("./support");function x(v,S){this.options=v,this.loadOptions=S}x.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(v){var S,w;if(v.skip(22),this.fileNameLength=v.readInt(2),w=v.readInt(2),this.fileName=v.readData(this.fileNameLength),v.skip(w),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((S=(function(_){for(var j in m)if(Object.prototype.hasOwnProperty.call(m,j)&&m[j].magic===_)return m[j];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+u.pretty(this.compressionMethod)+" unknown (inner file : "+u.transformTo("string",this.fileName)+")");this.decompressed=new h(this.compressedSize,this.uncompressedSize,this.crc32,S,v.readData(this.compressedSize))},readCentralPart:function(v){this.versionMadeBy=v.readInt(2),v.skip(2),this.bitFlag=v.readInt(2),this.compressionMethod=v.readString(2),this.date=v.readDate(),this.crc32=v.readInt(4),this.compressedSize=v.readInt(4),this.uncompressedSize=v.readInt(4);var S=v.readInt(2);if(this.extraFieldsLength=v.readInt(2),this.fileCommentLength=v.readInt(2),this.diskNumberStart=v.readInt(2),this.internalFileAttributes=v.readInt(2),this.externalFileAttributes=v.readInt(4),this.localHeaderOffset=v.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");v.skip(S),this.readExtraFields(v),this.parseZIP64ExtraField(v),this.fileComment=v.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var v=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),v==0&&(this.dosPermissions=63&this.externalFileAttributes),v==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var v=c(this.extraFields[1].value);this.uncompressedSize===u.MAX_VALUE_32BITS&&(this.uncompressedSize=v.readInt(8)),this.compressedSize===u.MAX_VALUE_32BITS&&(this.compressedSize=v.readInt(8)),this.localHeaderOffset===u.MAX_VALUE_32BITS&&(this.localHeaderOffset=v.readInt(8)),this.diskNumberStart===u.MAX_VALUE_32BITS&&(this.diskNumberStart=v.readInt(4))}},readExtraFields:function(v){var S,w,_,j=v.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});v.index+4<j;)S=v.readInt(2),w=v.readInt(2),_=v.readData(w),this.extraFields[S]={id:S,length:w,value:_};v.setIndex(j)},handleUTF8:function(){var v=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),this.fileCommentStr=p.utf8decode(this.fileComment);else{var S=this.findExtraFieldUnicodePath();if(S!==null)this.fileNameStr=S;else{var w=u.transformTo(v,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(w)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var j=u.transformTo(v,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(j)}}},findExtraFieldUnicodePath:function(){var v=this.extraFields[28789];if(v){var S=c(v.value);return S.readInt(1)!==1||f(this.fileName)!==S.readInt(4)?null:p.utf8decode(S.readData(v.length-5))}return null},findExtraFieldUnicodeComment:function(){var v=this.extraFields[25461];if(v){var S=c(v.value);return S.readInt(1)!==1||f(this.fileComment)!==S.readInt(4)?null:p.utf8decode(S.readData(v.length-5))}return null}},a.exports=x},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(s,a,o){function c(S,w,_){this.name=S,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=w,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var u=s("./stream/StreamHelper"),h=s("./stream/DataWorker"),f=s("./utf8"),p=s("./compressedObject"),m=s("./stream/GenericWorker");c.prototype={internalStream:function(S){var w=null,_="string";try{if(!S)throw new Error("No output type specified.");var j=(_=S.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),w=this._decompressWorker();var E=!this._dataBinary;E&&!j&&(w=w.pipe(new f.Utf8EncodeWorker)),!E&&j&&(w=w.pipe(new f.Utf8DecodeWorker))}catch(T){(w=new m("error")).error(T)}return new u(w,_,"")},async:function(S,w){return this.internalStream(S).accumulate(w)},nodeStream:function(S,w){return this.internalStream(S||"nodebuffer").toNodejsStream(w)},_compressWorker:function(S,w){if(this._data instanceof p&&this._data.compression.magic===S.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new f.Utf8EncodeWorker)),p.createWorkerFrom(_,S,w)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof m?this._data:new h(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],x=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},v=0;v<g.length;v++)c.prototype[g[v]]=x;a.exports=c},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(s,a,o){(function(c){var u,h,f=c.MutationObserver||c.WebKitMutationObserver;if(f){var p=0,m=new f(S),g=c.document.createTextNode("");m.observe(g,{characterData:!0}),u=function(){g.data=p=++p%2}}else if(c.setImmediate||c.MessageChannel===void 0)u="document"in c&&"onreadystatechange"in c.document.createElement("script")?function(){var w=c.document.createElement("script");w.onreadystatechange=function(){S(),w.onreadystatechange=null,w.parentNode.removeChild(w),w=null},c.document.documentElement.appendChild(w)}:function(){setTimeout(S,0)};else{var x=new c.MessageChannel;x.port1.onmessage=S,u=function(){x.port2.postMessage(0)}}var v=[];function S(){var w,_;h=!0;for(var j=v.length;j;){for(_=v,v=[],w=-1;++w<j;)_[w]();j=v.length}h=!1}a.exports=function(w){v.push(w)!==1||h||u()}}).call(this,typeof Lu<"u"?Lu:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(s,a,o){var c=s("immediate");function u(){}var h={},f=["REJECTED"],p=["FULFILLED"],m=["PENDING"];function g(j){if(typeof j!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,j!==u&&w(this,j)}function x(j,E,T){this.promise=j,typeof E=="function"&&(this.onFulfilled=E,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function v(j,E,T){c(function(){var R;try{R=E(T)}catch(B){return h.reject(j,B)}R===j?h.reject(j,new TypeError("Cannot resolve promise with itself")):h.resolve(j,R)})}function S(j){var E=j&&j.then;if(j&&(typeof j=="object"||typeof j=="function")&&typeof E=="function")return function(){E.apply(j,arguments)}}function w(j,E){var T=!1;function R($){T||(T=!0,h.reject(j,$))}function B($){T||(T=!0,h.resolve(j,$))}var F=_(function(){E(B,R)});F.status==="error"&&R(F.value)}function _(j,E){var T={};try{T.value=j(E),T.status="success"}catch(R){T.status="error",T.value=R}return T}(a.exports=g).prototype.finally=function(j){if(typeof j!="function")return this;var E=this.constructor;return this.then(function(T){return E.resolve(j()).then(function(){return T})},function(T){return E.resolve(j()).then(function(){throw T})})},g.prototype.catch=function(j){return this.then(null,j)},g.prototype.then=function(j,E){if(typeof j!="function"&&this.state===p||typeof E!="function"&&this.state===f)return this;var T=new this.constructor(u);return this.state!==m?v(T,this.state===p?j:E,this.outcome):this.queue.push(new x(T,j,E)),T},x.prototype.callFulfilled=function(j){h.resolve(this.promise,j)},x.prototype.otherCallFulfilled=function(j){v(this.promise,this.onFulfilled,j)},x.prototype.callRejected=function(j){h.reject(this.promise,j)},x.prototype.otherCallRejected=function(j){v(this.promise,this.onRejected,j)},h.resolve=function(j,E){var T=_(S,E);if(T.status==="error")return h.reject(j,T.value);var R=T.value;if(R)w(j,R);else{j.state=p,j.outcome=E;for(var B=-1,F=j.queue.length;++B<F;)j.queue[B].callFulfilled(E)}return j},h.reject=function(j,E){j.state=f,j.outcome=E;for(var T=-1,R=j.queue.length;++T<R;)j.queue[T].callRejected(E);return j},g.resolve=function(j){return j instanceof this?j:h.resolve(new this(u),j)},g.reject=function(j){var E=new this(u);return h.reject(E,j)},g.all=function(j){var E=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=j.length,R=!1;if(!T)return this.resolve([]);for(var B=new Array(T),F=0,$=-1,M=new this(u);++$<T;)z(j[$],$);return M;function z(P,H){E.resolve(P).then(function(O){B[H]=O,++F!==T||R||(R=!0,h.resolve(M,B))},function(O){R||(R=!0,h.reject(M,O))})}},g.race=function(j){var E=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=j.length,R=!1;if(!T)return this.resolve([]);for(var B=-1,F=new this(u);++B<T;)$=j[B],E.resolve($).then(function(M){R||(R=!0,h.resolve(F,M))},function(M){R||(R=!0,h.reject(F,M))});var $;return F}},{immediate:36}],38:[function(s,a,o){var c={};(0,s("./lib/utils/common").assign)(c,s("./lib/deflate"),s("./lib/inflate"),s("./lib/zlib/constants")),a.exports=c},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(s,a,o){var c=s("./zlib/deflate"),u=s("./utils/common"),h=s("./utils/strings"),f=s("./zlib/messages"),p=s("./zlib/zstream"),m=Object.prototype.toString,g=0,x=-1,v=0,S=8;function w(j){if(!(this instanceof w))return new w(j);this.options=u.assign({level:x,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:v,to:""},j||{});var E=this.options;E.raw&&0<E.windowBits?E.windowBits=-E.windowBits:E.gzip&&0<E.windowBits&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var T=c.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(T!==g)throw new Error(f[T]);if(E.header&&c.deflateSetHeader(this.strm,E.header),E.dictionary){var R;if(R=typeof E.dictionary=="string"?h.string2buf(E.dictionary):m.call(E.dictionary)==="[object ArrayBuffer]"?new Uint8Array(E.dictionary):E.dictionary,(T=c.deflateSetDictionary(this.strm,R))!==g)throw new Error(f[T]);this._dict_set=!0}}function _(j,E){var T=new w(E);if(T.push(j,!0),T.err)throw T.msg||f[T.err];return T.result}w.prototype.push=function(j,E){var T,R,B=this.strm,F=this.options.chunkSize;if(this.ended)return!1;R=E===~~E?E:E===!0?4:0,typeof j=="string"?B.input=h.string2buf(j):m.call(j)==="[object ArrayBuffer]"?B.input=new Uint8Array(j):B.input=j,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new u.Buf8(F),B.next_out=0,B.avail_out=F),(T=c.deflate(B,R))!==1&&T!==g)return this.onEnd(T),!(this.ended=!0);B.avail_out!==0&&(B.avail_in!==0||R!==4&&R!==2)||(this.options.to==="string"?this.onData(h.buf2binstring(u.shrinkBuf(B.output,B.next_out))):this.onData(u.shrinkBuf(B.output,B.next_out)))}while((0<B.avail_in||B.avail_out===0)&&T!==1);return R===4?(T=c.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===g):R!==2||(this.onEnd(g),!(B.avail_out=0))},w.prototype.onData=function(j){this.chunks.push(j)},w.prototype.onEnd=function(j){j===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg},o.Deflate=w,o.deflate=_,o.deflateRaw=function(j,E){return(E=E||{}).raw=!0,_(j,E)},o.gzip=function(j,E){return(E=E||{}).gzip=!0,_(j,E)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(s,a,o){var c=s("./zlib/inflate"),u=s("./utils/common"),h=s("./utils/strings"),f=s("./zlib/constants"),p=s("./zlib/messages"),m=s("./zlib/zstream"),g=s("./zlib/gzheader"),x=Object.prototype.toString;function v(w){if(!(this instanceof v))return new v(w);this.options=u.assign({chunkSize:16384,windowBits:0,to:""},w||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||w&&w.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&(15&_.windowBits)==0&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var j=c.inflateInit2(this.strm,_.windowBits);if(j!==f.Z_OK)throw new Error(p[j]);this.header=new g,c.inflateGetHeader(this.strm,this.header)}function S(w,_){var j=new v(_);if(j.push(w,!0),j.err)throw j.msg||p[j.err];return j.result}v.prototype.push=function(w,_){var j,E,T,R,B,F,$=this.strm,M=this.options.chunkSize,z=this.options.dictionary,P=!1;if(this.ended)return!1;E=_===~~_?_:_===!0?f.Z_FINISH:f.Z_NO_FLUSH,typeof w=="string"?$.input=h.binstring2buf(w):x.call(w)==="[object ArrayBuffer]"?$.input=new Uint8Array(w):$.input=w,$.next_in=0,$.avail_in=$.input.length;do{if($.avail_out===0&&($.output=new u.Buf8(M),$.next_out=0,$.avail_out=M),(j=c.inflate($,f.Z_NO_FLUSH))===f.Z_NEED_DICT&&z&&(F=typeof z=="string"?h.string2buf(z):x.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,j=c.inflateSetDictionary(this.strm,F)),j===f.Z_BUF_ERROR&&P===!0&&(j=f.Z_OK,P=!1),j!==f.Z_STREAM_END&&j!==f.Z_OK)return this.onEnd(j),!(this.ended=!0);$.next_out&&($.avail_out!==0&&j!==f.Z_STREAM_END&&($.avail_in!==0||E!==f.Z_FINISH&&E!==f.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=h.utf8border($.output,$.next_out),R=$.next_out-T,B=h.buf2string($.output,T),$.next_out=R,$.avail_out=M-R,R&&u.arraySet($.output,$.output,T,R,0),this.onData(B)):this.onData(u.shrinkBuf($.output,$.next_out)))),$.avail_in===0&&$.avail_out===0&&(P=!0)}while((0<$.avail_in||$.avail_out===0)&&j!==f.Z_STREAM_END);return j===f.Z_STREAM_END&&(E=f.Z_FINISH),E===f.Z_FINISH?(j=c.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===f.Z_OK):E!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),!($.avail_out=0))},v.prototype.onData=function(w){this.chunks.push(w)},v.prototype.onEnd=function(w){w===f.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg},o.Inflate=v,o.inflate=S,o.inflateRaw=function(w,_){return(_=_||{}).raw=!0,S(w,_)},o.ungzip=S},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(s,a,o){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(f){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var m=p.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var g in m)m.hasOwnProperty(g)&&(f[g]=m[g])}}return f},o.shrinkBuf=function(f,p){return f.length===p?f:f.subarray?f.subarray(0,p):(f.length=p,f)};var u={arraySet:function(f,p,m,g,x){if(p.subarray&&f.subarray)f.set(p.subarray(m,m+g),x);else for(var v=0;v<g;v++)f[x+v]=p[m+v]},flattenChunks:function(f){var p,m,g,x,v,S;for(p=g=0,m=f.length;p<m;p++)g+=f[p].length;for(S=new Uint8Array(g),p=x=0,m=f.length;p<m;p++)v=f[p],S.set(v,x),x+=v.length;return S}},h={arraySet:function(f,p,m,g,x){for(var v=0;v<g;v++)f[x+v]=p[m+v]},flattenChunks:function(f){return[].concat.apply([],f)}};o.setTyped=function(f){f?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,u)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,h))},o.setTyped(c)},{}],42:[function(s,a,o){var c=s("./common"),u=!0,h=!0;try{String.fromCharCode.apply(null,[0])}catch{u=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{h=!1}for(var f=new c.Buf8(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;function m(g,x){if(x<65537&&(g.subarray&&h||!g.subarray&&u))return String.fromCharCode.apply(null,c.shrinkBuf(g,x));for(var v="",S=0;S<x;S++)v+=String.fromCharCode(g[S]);return v}f[254]=f[254]=1,o.string2buf=function(g){var x,v,S,w,_,j=g.length,E=0;for(w=0;w<j;w++)(64512&(v=g.charCodeAt(w)))==55296&&w+1<j&&(64512&(S=g.charCodeAt(w+1)))==56320&&(v=65536+(v-55296<<10)+(S-56320),w++),E+=v<128?1:v<2048?2:v<65536?3:4;for(x=new c.Buf8(E),w=_=0;_<E;w++)(64512&(v=g.charCodeAt(w)))==55296&&w+1<j&&(64512&(S=g.charCodeAt(w+1)))==56320&&(v=65536+(v-55296<<10)+(S-56320),w++),v<128?x[_++]=v:(v<2048?x[_++]=192|v>>>6:(v<65536?x[_++]=224|v>>>12:(x[_++]=240|v>>>18,x[_++]=128|v>>>12&63),x[_++]=128|v>>>6&63),x[_++]=128|63&v);return x},o.buf2binstring=function(g){return m(g,g.length)},o.binstring2buf=function(g){for(var x=new c.Buf8(g.length),v=0,S=x.length;v<S;v++)x[v]=g.charCodeAt(v);return x},o.buf2string=function(g,x){var v,S,w,_,j=x||g.length,E=new Array(2*j);for(v=S=0;v<j;)if((w=g[v++])<128)E[S++]=w;else if(4<(_=f[w]))E[S++]=65533,v+=_-1;else{for(w&=_===2?31:_===3?15:7;1<_&&v<j;)w=w<<6|63&g[v++],_--;1<_?E[S++]=65533:w<65536?E[S++]=w:(w-=65536,E[S++]=55296|w>>10&1023,E[S++]=56320|1023&w)}return m(E,S)},o.utf8border=function(g,x){var v;for((x=x||g.length)>g.length&&(x=g.length),v=x-1;0<=v&&(192&g[v])==128;)v--;return v<0||v===0?x:v+f[g[v]]>x?v:x}},{"./common":41}],43:[function(s,a,o){a.exports=function(c,u,h,f){for(var p=65535&c|0,m=c>>>16&65535|0,g=0;h!==0;){for(h-=g=2e3<h?2e3:h;m=m+(p=p+u[f++]|0)|0,--g;);p%=65521,m%=65521}return p|m<<16|0}},{}],44:[function(s,a,o){a.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(s,a,o){var c=(function(){for(var u,h=[],f=0;f<256;f++){u=f;for(var p=0;p<8;p++)u=1&u?3988292384^u>>>1:u>>>1;h[f]=u}return h})();a.exports=function(u,h,f,p){var m=c,g=p+f;u^=-1;for(var x=p;x<g;x++)u=u>>>8^m[255&(u^h[x])];return-1^u}},{}],46:[function(s,a,o){var c,u=s("../utils/common"),h=s("./trees"),f=s("./adler32"),p=s("./crc32"),m=s("./messages"),g=0,x=4,v=0,S=-2,w=-1,_=4,j=2,E=8,T=9,R=286,B=30,F=19,$=2*R+1,M=15,z=3,P=258,H=P+z+1,O=42,q=113,C=1,I=2,L=3,V=4;function G(N,ve){return N.msg=m[ve],ve}function Y(N){return(N<<1)-(4<N?9:0)}function Z(N){for(var ve=N.length;0<=--ve;)N[ve]=0}function A(N){var ve=N.state,fe=ve.pending;fe>N.avail_out&&(fe=N.avail_out),fe!==0&&(u.arraySet(N.output,ve.pending_buf,ve.pending_out,fe,N.next_out),N.next_out+=fe,ve.pending_out+=fe,N.total_out+=fe,N.avail_out-=fe,ve.pending-=fe,ve.pending===0&&(ve.pending_out=0))}function U(N,ve){h._tr_flush_block(N,0<=N.block_start?N.block_start:-1,N.strstart-N.block_start,ve),N.block_start=N.strstart,A(N.strm)}function X(N,ve){N.pending_buf[N.pending++]=ve}function se(N,ve){N.pending_buf[N.pending++]=ve>>>8&255,N.pending_buf[N.pending++]=255&ve}function oe(N,ve){var fe,Q,K=N.max_chain_length,ie=N.strstart,re=N.prev_length,ee=N.nice_match,le=N.strstart>N.w_size-H?N.strstart-(N.w_size-H):0,ye=N.window,qe=N.w_mask,Re=N.prev,$e=N.strstart+P,Ke=ye[ie+re-1],Ye=ye[ie+re];N.prev_length>=N.good_match&&(K>>=2),ee>N.lookahead&&(ee=N.lookahead);do if(ye[(fe=ve)+re]===Ye&&ye[fe+re-1]===Ke&&ye[fe]===ye[ie]&&ye[++fe]===ye[ie+1]){ie+=2,fe++;do;while(ye[++ie]===ye[++fe]&&ye[++ie]===ye[++fe]&&ye[++ie]===ye[++fe]&&ye[++ie]===ye[++fe]&&ye[++ie]===ye[++fe]&&ye[++ie]===ye[++fe]&&ye[++ie]===ye[++fe]&&ye[++ie]===ye[++fe]&&ie<$e);if(Q=P-($e-ie),ie=$e-P,re<Q){if(N.match_start=ve,ee<=(re=Q))break;Ke=ye[ie+re-1],Ye=ye[ie+re]}}while((ve=Re[ve&qe])>le&&--K!=0);return re<=N.lookahead?re:N.lookahead}function Ce(N){var ve,fe,Q,K,ie,re,ee,le,ye,qe,Re=N.w_size;do{if(K=N.window_size-N.lookahead-N.strstart,N.strstart>=Re+(Re-H)){for(u.arraySet(N.window,N.window,Re,Re,0),N.match_start-=Re,N.strstart-=Re,N.block_start-=Re,ve=fe=N.hash_size;Q=N.head[--ve],N.head[ve]=Re<=Q?Q-Re:0,--fe;);for(ve=fe=Re;Q=N.prev[--ve],N.prev[ve]=Re<=Q?Q-Re:0,--fe;);K+=Re}if(N.strm.avail_in===0)break;if(re=N.strm,ee=N.window,le=N.strstart+N.lookahead,ye=K,qe=void 0,qe=re.avail_in,ye<qe&&(qe=ye),fe=qe===0?0:(re.avail_in-=qe,u.arraySet(ee,re.input,re.next_in,qe,le),re.state.wrap===1?re.adler=f(re.adler,ee,qe,le):re.state.wrap===2&&(re.adler=p(re.adler,ee,qe,le)),re.next_in+=qe,re.total_in+=qe,qe),N.lookahead+=fe,N.lookahead+N.insert>=z)for(ie=N.strstart-N.insert,N.ins_h=N.window[ie],N.ins_h=(N.ins_h<<N.hash_shift^N.window[ie+1])&N.hash_mask;N.insert&&(N.ins_h=(N.ins_h<<N.hash_shift^N.window[ie+z-1])&N.hash_mask,N.prev[ie&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=ie,ie++,N.insert--,!(N.lookahead+N.insert<z)););}while(N.lookahead<H&&N.strm.avail_in!==0)}function ue(N,ve){for(var fe,Q;;){if(N.lookahead<H){if(Ce(N),N.lookahead<H&&ve===g)return C;if(N.lookahead===0)break}if(fe=0,N.lookahead>=z&&(N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+z-1])&N.hash_mask,fe=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),fe!==0&&N.strstart-fe<=N.w_size-H&&(N.match_length=oe(N,fe)),N.match_length>=z)if(Q=h._tr_tally(N,N.strstart-N.match_start,N.match_length-z),N.lookahead-=N.match_length,N.match_length<=N.max_lazy_match&&N.lookahead>=z){for(N.match_length--;N.strstart++,N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+z-1])&N.hash_mask,fe=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart,--N.match_length!=0;);N.strstart++}else N.strstart+=N.match_length,N.match_length=0,N.ins_h=N.window[N.strstart],N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+1])&N.hash_mask;else Q=h._tr_tally(N,0,N.window[N.strstart]),N.lookahead--,N.strstart++;if(Q&&(U(N,!1),N.strm.avail_out===0))return C}return N.insert=N.strstart<z-1?N.strstart:z-1,ve===x?(U(N,!0),N.strm.avail_out===0?L:V):N.last_lit&&(U(N,!1),N.strm.avail_out===0)?C:I}function ne(N,ve){for(var fe,Q,K;;){if(N.lookahead<H){if(Ce(N),N.lookahead<H&&ve===g)return C;if(N.lookahead===0)break}if(fe=0,N.lookahead>=z&&(N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+z-1])&N.hash_mask,fe=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),N.prev_length=N.match_length,N.prev_match=N.match_start,N.match_length=z-1,fe!==0&&N.prev_length<N.max_lazy_match&&N.strstart-fe<=N.w_size-H&&(N.match_length=oe(N,fe),N.match_length<=5&&(N.strategy===1||N.match_length===z&&4096<N.strstart-N.match_start)&&(N.match_length=z-1)),N.prev_length>=z&&N.match_length<=N.prev_length){for(K=N.strstart+N.lookahead-z,Q=h._tr_tally(N,N.strstart-1-N.prev_match,N.prev_length-z),N.lookahead-=N.prev_length-1,N.prev_length-=2;++N.strstart<=K&&(N.ins_h=(N.ins_h<<N.hash_shift^N.window[N.strstart+z-1])&N.hash_mask,fe=N.prev[N.strstart&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=N.strstart),--N.prev_length!=0;);if(N.match_available=0,N.match_length=z-1,N.strstart++,Q&&(U(N,!1),N.strm.avail_out===0))return C}else if(N.match_available){if((Q=h._tr_tally(N,0,N.window[N.strstart-1]))&&U(N,!1),N.strstart++,N.lookahead--,N.strm.avail_out===0)return C}else N.match_available=1,N.strstart++,N.lookahead--}return N.match_available&&(Q=h._tr_tally(N,0,N.window[N.strstart-1]),N.match_available=0),N.insert=N.strstart<z-1?N.strstart:z-1,ve===x?(U(N,!0),N.strm.avail_out===0?L:V):N.last_lit&&(U(N,!1),N.strm.avail_out===0)?C:I}function we(N,ve,fe,Q,K){this.good_length=N,this.max_lazy=ve,this.nice_length=fe,this.max_chain=Q,this.func=K}function Le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new u.Buf16(2*$),this.dyn_dtree=new u.Buf16(2*(2*B+1)),this.bl_tree=new u.Buf16(2*(2*F+1)),Z(this.dyn_ltree),Z(this.dyn_dtree),Z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new u.Buf16(M+1),this.heap=new u.Buf16(2*R+1),Z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new u.Buf16(2*R+1),Z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ge(N){var ve;return N&&N.state?(N.total_in=N.total_out=0,N.data_type=j,(ve=N.state).pending=0,ve.pending_out=0,ve.wrap<0&&(ve.wrap=-ve.wrap),ve.status=ve.wrap?O:q,N.adler=ve.wrap===2?0:1,ve.last_flush=g,h._tr_init(ve),v):G(N,S)}function Te(N){var ve=ge(N);return ve===v&&(function(fe){fe.window_size=2*fe.w_size,Z(fe.head),fe.max_lazy_match=c[fe.level].max_lazy,fe.good_match=c[fe.level].good_length,fe.nice_match=c[fe.level].nice_length,fe.max_chain_length=c[fe.level].max_chain,fe.strstart=0,fe.block_start=0,fe.lookahead=0,fe.insert=0,fe.match_length=fe.prev_length=z-1,fe.match_available=0,fe.ins_h=0})(N.state),ve}function de(N,ve,fe,Q,K,ie){if(!N)return S;var re=1;if(ve===w&&(ve=6),Q<0?(re=0,Q=-Q):15<Q&&(re=2,Q-=16),K<1||T<K||fe!==E||Q<8||15<Q||ve<0||9<ve||ie<0||_<ie)return G(N,S);Q===8&&(Q=9);var ee=new Le;return(N.state=ee).strm=N,ee.wrap=re,ee.gzhead=null,ee.w_bits=Q,ee.w_size=1<<ee.w_bits,ee.w_mask=ee.w_size-1,ee.hash_bits=K+7,ee.hash_size=1<<ee.hash_bits,ee.hash_mask=ee.hash_size-1,ee.hash_shift=~~((ee.hash_bits+z-1)/z),ee.window=new u.Buf8(2*ee.w_size),ee.head=new u.Buf16(ee.hash_size),ee.prev=new u.Buf16(ee.w_size),ee.lit_bufsize=1<<K+6,ee.pending_buf_size=4*ee.lit_bufsize,ee.pending_buf=new u.Buf8(ee.pending_buf_size),ee.d_buf=1*ee.lit_bufsize,ee.l_buf=3*ee.lit_bufsize,ee.level=ve,ee.strategy=ie,ee.method=fe,Te(N)}c=[new we(0,0,0,0,function(N,ve){var fe=65535;for(fe>N.pending_buf_size-5&&(fe=N.pending_buf_size-5);;){if(N.lookahead<=1){if(Ce(N),N.lookahead===0&&ve===g)return C;if(N.lookahead===0)break}N.strstart+=N.lookahead,N.lookahead=0;var Q=N.block_start+fe;if((N.strstart===0||N.strstart>=Q)&&(N.lookahead=N.strstart-Q,N.strstart=Q,U(N,!1),N.strm.avail_out===0)||N.strstart-N.block_start>=N.w_size-H&&(U(N,!1),N.strm.avail_out===0))return C}return N.insert=0,ve===x?(U(N,!0),N.strm.avail_out===0?L:V):(N.strstart>N.block_start&&(U(N,!1),N.strm.avail_out),C)}),new we(4,4,8,4,ue),new we(4,5,16,8,ue),new we(4,6,32,32,ue),new we(4,4,16,16,ne),new we(8,16,32,32,ne),new we(8,16,128,128,ne),new we(8,32,128,256,ne),new we(32,128,258,1024,ne),new we(32,258,258,4096,ne)],o.deflateInit=function(N,ve){return de(N,ve,E,15,8,0)},o.deflateInit2=de,o.deflateReset=Te,o.deflateResetKeep=ge,o.deflateSetHeader=function(N,ve){return N&&N.state?N.state.wrap!==2?S:(N.state.gzhead=ve,v):S},o.deflate=function(N,ve){var fe,Q,K,ie;if(!N||!N.state||5<ve||ve<0)return N?G(N,S):S;if(Q=N.state,!N.output||!N.input&&N.avail_in!==0||Q.status===666&&ve!==x)return G(N,N.avail_out===0?-5:S);if(Q.strm=N,fe=Q.last_flush,Q.last_flush=ve,Q.status===O)if(Q.wrap===2)N.adler=0,X(Q,31),X(Q,139),X(Q,8),Q.gzhead?(X(Q,(Q.gzhead.text?1:0)+(Q.gzhead.hcrc?2:0)+(Q.gzhead.extra?4:0)+(Q.gzhead.name?8:0)+(Q.gzhead.comment?16:0)),X(Q,255&Q.gzhead.time),X(Q,Q.gzhead.time>>8&255),X(Q,Q.gzhead.time>>16&255),X(Q,Q.gzhead.time>>24&255),X(Q,Q.level===9?2:2<=Q.strategy||Q.level<2?4:0),X(Q,255&Q.gzhead.os),Q.gzhead.extra&&Q.gzhead.extra.length&&(X(Q,255&Q.gzhead.extra.length),X(Q,Q.gzhead.extra.length>>8&255)),Q.gzhead.hcrc&&(N.adler=p(N.adler,Q.pending_buf,Q.pending,0)),Q.gzindex=0,Q.status=69):(X(Q,0),X(Q,0),X(Q,0),X(Q,0),X(Q,0),X(Q,Q.level===9?2:2<=Q.strategy||Q.level<2?4:0),X(Q,3),Q.status=q);else{var re=E+(Q.w_bits-8<<4)<<8;re|=(2<=Q.strategy||Q.level<2?0:Q.level<6?1:Q.level===6?2:3)<<6,Q.strstart!==0&&(re|=32),re+=31-re%31,Q.status=q,se(Q,re),Q.strstart!==0&&(se(Q,N.adler>>>16),se(Q,65535&N.adler)),N.adler=1}if(Q.status===69)if(Q.gzhead.extra){for(K=Q.pending;Q.gzindex<(65535&Q.gzhead.extra.length)&&(Q.pending!==Q.pending_buf_size||(Q.gzhead.hcrc&&Q.pending>K&&(N.adler=p(N.adler,Q.pending_buf,Q.pending-K,K)),A(N),K=Q.pending,Q.pending!==Q.pending_buf_size));)X(Q,255&Q.gzhead.extra[Q.gzindex]),Q.gzindex++;Q.gzhead.hcrc&&Q.pending>K&&(N.adler=p(N.adler,Q.pending_buf,Q.pending-K,K)),Q.gzindex===Q.gzhead.extra.length&&(Q.gzindex=0,Q.status=73)}else Q.status=73;if(Q.status===73)if(Q.gzhead.name){K=Q.pending;do{if(Q.pending===Q.pending_buf_size&&(Q.gzhead.hcrc&&Q.pending>K&&(N.adler=p(N.adler,Q.pending_buf,Q.pending-K,K)),A(N),K=Q.pending,Q.pending===Q.pending_buf_size)){ie=1;break}ie=Q.gzindex<Q.gzhead.name.length?255&Q.gzhead.name.charCodeAt(Q.gzindex++):0,X(Q,ie)}while(ie!==0);Q.gzhead.hcrc&&Q.pending>K&&(N.adler=p(N.adler,Q.pending_buf,Q.pending-K,K)),ie===0&&(Q.gzindex=0,Q.status=91)}else Q.status=91;if(Q.status===91)if(Q.gzhead.comment){K=Q.pending;do{if(Q.pending===Q.pending_buf_size&&(Q.gzhead.hcrc&&Q.pending>K&&(N.adler=p(N.adler,Q.pending_buf,Q.pending-K,K)),A(N),K=Q.pending,Q.pending===Q.pending_buf_size)){ie=1;break}ie=Q.gzindex<Q.gzhead.comment.length?255&Q.gzhead.comment.charCodeAt(Q.gzindex++):0,X(Q,ie)}while(ie!==0);Q.gzhead.hcrc&&Q.pending>K&&(N.adler=p(N.adler,Q.pending_buf,Q.pending-K,K)),ie===0&&(Q.status=103)}else Q.status=103;if(Q.status===103&&(Q.gzhead.hcrc?(Q.pending+2>Q.pending_buf_size&&A(N),Q.pending+2<=Q.pending_buf_size&&(X(Q,255&N.adler),X(Q,N.adler>>8&255),N.adler=0,Q.status=q)):Q.status=q),Q.pending!==0){if(A(N),N.avail_out===0)return Q.last_flush=-1,v}else if(N.avail_in===0&&Y(ve)<=Y(fe)&&ve!==x)return G(N,-5);if(Q.status===666&&N.avail_in!==0)return G(N,-5);if(N.avail_in!==0||Q.lookahead!==0||ve!==g&&Q.status!==666){var ee=Q.strategy===2?(function(le,ye){for(var qe;;){if(le.lookahead===0&&(Ce(le),le.lookahead===0)){if(ye===g)return C;break}if(le.match_length=0,qe=h._tr_tally(le,0,le.window[le.strstart]),le.lookahead--,le.strstart++,qe&&(U(le,!1),le.strm.avail_out===0))return C}return le.insert=0,ye===x?(U(le,!0),le.strm.avail_out===0?L:V):le.last_lit&&(U(le,!1),le.strm.avail_out===0)?C:I})(Q,ve):Q.strategy===3?(function(le,ye){for(var qe,Re,$e,Ke,Ye=le.window;;){if(le.lookahead<=P){if(Ce(le),le.lookahead<=P&&ye===g)return C;if(le.lookahead===0)break}if(le.match_length=0,le.lookahead>=z&&0<le.strstart&&(Re=Ye[$e=le.strstart-1])===Ye[++$e]&&Re===Ye[++$e]&&Re===Ye[++$e]){Ke=le.strstart+P;do;while(Re===Ye[++$e]&&Re===Ye[++$e]&&Re===Ye[++$e]&&Re===Ye[++$e]&&Re===Ye[++$e]&&Re===Ye[++$e]&&Re===Ye[++$e]&&Re===Ye[++$e]&&$e<Ke);le.match_length=P-(Ke-$e),le.match_length>le.lookahead&&(le.match_length=le.lookahead)}if(le.match_length>=z?(qe=h._tr_tally(le,1,le.match_length-z),le.lookahead-=le.match_length,le.strstart+=le.match_length,le.match_length=0):(qe=h._tr_tally(le,0,le.window[le.strstart]),le.lookahead--,le.strstart++),qe&&(U(le,!1),le.strm.avail_out===0))return C}return le.insert=0,ye===x?(U(le,!0),le.strm.avail_out===0?L:V):le.last_lit&&(U(le,!1),le.strm.avail_out===0)?C:I})(Q,ve):c[Q.level].func(Q,ve);if(ee!==L&&ee!==V||(Q.status=666),ee===C||ee===L)return N.avail_out===0&&(Q.last_flush=-1),v;if(ee===I&&(ve===1?h._tr_align(Q):ve!==5&&(h._tr_stored_block(Q,0,0,!1),ve===3&&(Z(Q.head),Q.lookahead===0&&(Q.strstart=0,Q.block_start=0,Q.insert=0))),A(N),N.avail_out===0))return Q.last_flush=-1,v}return ve!==x?v:Q.wrap<=0?1:(Q.wrap===2?(X(Q,255&N.adler),X(Q,N.adler>>8&255),X(Q,N.adler>>16&255),X(Q,N.adler>>24&255),X(Q,255&N.total_in),X(Q,N.total_in>>8&255),X(Q,N.total_in>>16&255),X(Q,N.total_in>>24&255)):(se(Q,N.adler>>>16),se(Q,65535&N.adler)),A(N),0<Q.wrap&&(Q.wrap=-Q.wrap),Q.pending!==0?v:1)},o.deflateEnd=function(N){var ve;return N&&N.state?(ve=N.state.status)!==O&&ve!==69&&ve!==73&&ve!==91&&ve!==103&&ve!==q&&ve!==666?G(N,S):(N.state=null,ve===q?G(N,-3):v):S},o.deflateSetDictionary=function(N,ve){var fe,Q,K,ie,re,ee,le,ye,qe=ve.length;if(!N||!N.state||(ie=(fe=N.state).wrap)===2||ie===1&&fe.status!==O||fe.lookahead)return S;for(ie===1&&(N.adler=f(N.adler,ve,qe,0)),fe.wrap=0,qe>=fe.w_size&&(ie===0&&(Z(fe.head),fe.strstart=0,fe.block_start=0,fe.insert=0),ye=new u.Buf8(fe.w_size),u.arraySet(ye,ve,qe-fe.w_size,fe.w_size,0),ve=ye,qe=fe.w_size),re=N.avail_in,ee=N.next_in,le=N.input,N.avail_in=qe,N.next_in=0,N.input=ve,Ce(fe);fe.lookahead>=z;){for(Q=fe.strstart,K=fe.lookahead-(z-1);fe.ins_h=(fe.ins_h<<fe.hash_shift^fe.window[Q+z-1])&fe.hash_mask,fe.prev[Q&fe.w_mask]=fe.head[fe.ins_h],fe.head[fe.ins_h]=Q,Q++,--K;);fe.strstart=Q,fe.lookahead=z-1,Ce(fe)}return fe.strstart+=fe.lookahead,fe.block_start=fe.strstart,fe.insert=fe.lookahead,fe.lookahead=0,fe.match_length=fe.prev_length=z-1,fe.match_available=0,N.next_in=ee,N.input=le,N.avail_in=re,fe.wrap=ie,v},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(s,a,o){a.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(s,a,o){a.exports=function(c,u){var h,f,p,m,g,x,v,S,w,_,j,E,T,R,B,F,$,M,z,P,H,O,q,C,I;h=c.state,f=c.next_in,C=c.input,p=f+(c.avail_in-5),m=c.next_out,I=c.output,g=m-(u-c.avail_out),x=m+(c.avail_out-257),v=h.dmax,S=h.wsize,w=h.whave,_=h.wnext,j=h.window,E=h.hold,T=h.bits,R=h.lencode,B=h.distcode,F=(1<<h.lenbits)-1,$=(1<<h.distbits)-1;e:do{T<15&&(E+=C[f++]<<T,T+=8,E+=C[f++]<<T,T+=8),M=R[E&F];t:for(;;){if(E>>>=z=M>>>24,T-=z,(z=M>>>16&255)===0)I[m++]=65535&M;else{if(!(16&z)){if((64&z)==0){M=R[(65535&M)+(E&(1<<z)-1)];continue t}if(32&z){h.mode=12;break e}c.msg="invalid literal/length code",h.mode=30;break e}P=65535&M,(z&=15)&&(T<z&&(E+=C[f++]<<T,T+=8),P+=E&(1<<z)-1,E>>>=z,T-=z),T<15&&(E+=C[f++]<<T,T+=8,E+=C[f++]<<T,T+=8),M=B[E&$];n:for(;;){if(E>>>=z=M>>>24,T-=z,!(16&(z=M>>>16&255))){if((64&z)==0){M=B[(65535&M)+(E&(1<<z)-1)];continue n}c.msg="invalid distance code",h.mode=30;break e}if(H=65535&M,T<(z&=15)&&(E+=C[f++]<<T,(T+=8)<z&&(E+=C[f++]<<T,T+=8)),v<(H+=E&(1<<z)-1)){c.msg="invalid distance too far back",h.mode=30;break e}if(E>>>=z,T-=z,(z=m-g)<H){if(w<(z=H-z)&&h.sane){c.msg="invalid distance too far back",h.mode=30;break e}if(q=j,(O=0)===_){if(O+=S-z,z<P){for(P-=z;I[m++]=j[O++],--z;);O=m-H,q=I}}else if(_<z){if(O+=S+_-z,(z-=_)<P){for(P-=z;I[m++]=j[O++],--z;);if(O=0,_<P){for(P-=z=_;I[m++]=j[O++],--z;);O=m-H,q=I}}}else if(O+=_-z,z<P){for(P-=z;I[m++]=j[O++],--z;);O=m-H,q=I}for(;2<P;)I[m++]=q[O++],I[m++]=q[O++],I[m++]=q[O++],P-=3;P&&(I[m++]=q[O++],1<P&&(I[m++]=q[O++]))}else{for(O=m-H;I[m++]=I[O++],I[m++]=I[O++],I[m++]=I[O++],2<(P-=3););P&&(I[m++]=I[O++],1<P&&(I[m++]=I[O++]))}break}}break}}while(f<p&&m<x);f-=P=T>>3,E&=(1<<(T-=P<<3))-1,c.next_in=f,c.next_out=m,c.avail_in=f<p?p-f+5:5-(f-p),c.avail_out=m<x?x-m+257:257-(m-x),h.hold=E,h.bits=T}},{}],49:[function(s,a,o){var c=s("../utils/common"),u=s("./adler32"),h=s("./crc32"),f=s("./inffast"),p=s("./inftrees"),m=1,g=2,x=0,v=-2,S=1,w=852,_=592;function j(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function E(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new c.Buf16(320),this.work=new c.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(O){var q;return O&&O.state?(q=O.state,O.total_in=O.total_out=q.total=0,O.msg="",q.wrap&&(O.adler=1&q.wrap),q.mode=S,q.last=0,q.havedict=0,q.dmax=32768,q.head=null,q.hold=0,q.bits=0,q.lencode=q.lendyn=new c.Buf32(w),q.distcode=q.distdyn=new c.Buf32(_),q.sane=1,q.back=-1,x):v}function R(O){var q;return O&&O.state?((q=O.state).wsize=0,q.whave=0,q.wnext=0,T(O)):v}function B(O,q){var C,I;return O&&O.state?(I=O.state,q<0?(C=0,q=-q):(C=1+(q>>4),q<48&&(q&=15)),q&&(q<8||15<q)?v:(I.window!==null&&I.wbits!==q&&(I.window=null),I.wrap=C,I.wbits=q,R(O))):v}function F(O,q){var C,I;return O?(I=new E,(O.state=I).window=null,(C=B(O,q))!==x&&(O.state=null),C):v}var $,M,z=!0;function P(O){if(z){var q;for($=new c.Buf32(512),M=new c.Buf32(32),q=0;q<144;)O.lens[q++]=8;for(;q<256;)O.lens[q++]=9;for(;q<280;)O.lens[q++]=7;for(;q<288;)O.lens[q++]=8;for(p(m,O.lens,0,288,$,0,O.work,{bits:9}),q=0;q<32;)O.lens[q++]=5;p(g,O.lens,0,32,M,0,O.work,{bits:5}),z=!1}O.lencode=$,O.lenbits=9,O.distcode=M,O.distbits=5}function H(O,q,C,I){var L,V=O.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new c.Buf8(V.wsize)),I>=V.wsize?(c.arraySet(V.window,q,C-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(I<(L=V.wsize-V.wnext)&&(L=I),c.arraySet(V.window,q,C-I,L,V.wnext),(I-=L)?(c.arraySet(V.window,q,C-I,I,0),V.wnext=I,V.whave=V.wsize):(V.wnext+=L,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=L))),0}o.inflateReset=R,o.inflateReset2=B,o.inflateResetKeep=T,o.inflateInit=function(O){return F(O,15)},o.inflateInit2=F,o.inflate=function(O,q){var C,I,L,V,G,Y,Z,A,U,X,se,oe,Ce,ue,ne,we,Le,ge,Te,de,N,ve,fe,Q,K=0,ie=new c.Buf8(4),re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return v;(C=O.state).mode===12&&(C.mode=13),G=O.next_out,L=O.output,Z=O.avail_out,V=O.next_in,I=O.input,Y=O.avail_in,A=C.hold,U=C.bits,X=Y,se=Z,ve=x;e:for(;;)switch(C.mode){case S:if(C.wrap===0){C.mode=13;break}for(;U<16;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if(2&C.wrap&&A===35615){ie[C.check=0]=255&A,ie[1]=A>>>8&255,C.check=h(C.check,ie,2,0),U=A=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&A)<<8)+(A>>8))%31){O.msg="incorrect header check",C.mode=30;break}if((15&A)!=8){O.msg="unknown compression method",C.mode=30;break}if(U-=4,N=8+(15&(A>>>=4)),C.wbits===0)C.wbits=N;else if(N>C.wbits){O.msg="invalid window size",C.mode=30;break}C.dmax=1<<N,O.adler=C.check=1,C.mode=512&A?10:12,U=A=0;break;case 2:for(;U<16;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if(C.flags=A,(255&C.flags)!=8){O.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){O.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=A>>8&1),512&C.flags&&(ie[0]=255&A,ie[1]=A>>>8&255,C.check=h(C.check,ie,2,0)),U=A=0,C.mode=3;case 3:for(;U<32;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}C.head&&(C.head.time=A),512&C.flags&&(ie[0]=255&A,ie[1]=A>>>8&255,ie[2]=A>>>16&255,ie[3]=A>>>24&255,C.check=h(C.check,ie,4,0)),U=A=0,C.mode=4;case 4:for(;U<16;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}C.head&&(C.head.xflags=255&A,C.head.os=A>>8),512&C.flags&&(ie[0]=255&A,ie[1]=A>>>8&255,C.check=h(C.check,ie,2,0)),U=A=0,C.mode=5;case 5:if(1024&C.flags){for(;U<16;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}C.length=A,C.head&&(C.head.extra_len=A),512&C.flags&&(ie[0]=255&A,ie[1]=A>>>8&255,C.check=h(C.check,ie,2,0)),U=A=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(Y<(oe=C.length)&&(oe=Y),oe&&(C.head&&(N=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),c.arraySet(C.head.extra,I,V,oe,N)),512&C.flags&&(C.check=h(C.check,I,oe,V)),Y-=oe,V+=oe,C.length-=oe),C.length))break e;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(Y===0)break e;for(oe=0;N=I[V+oe++],C.head&&N&&C.length<65536&&(C.head.name+=String.fromCharCode(N)),N&&oe<Y;);if(512&C.flags&&(C.check=h(C.check,I,oe,V)),Y-=oe,V+=oe,N)break e}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(Y===0)break e;for(oe=0;N=I[V+oe++],C.head&&N&&C.length<65536&&(C.head.comment+=String.fromCharCode(N)),N&&oe<Y;);if(512&C.flags&&(C.check=h(C.check,I,oe,V)),Y-=oe,V+=oe,N)break e}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;U<16;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if(A!==(65535&C.check)){O.msg="header crc mismatch",C.mode=30;break}U=A=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),O.adler=C.check=0,C.mode=12;break;case 10:for(;U<32;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}O.adler=C.check=j(A),U=A=0,C.mode=11;case 11:if(C.havedict===0)return O.next_out=G,O.avail_out=Z,O.next_in=V,O.avail_in=Y,C.hold=A,C.bits=U,2;O.adler=C.check=1,C.mode=12;case 12:if(q===5||q===6)break e;case 13:if(C.last){A>>>=7&U,U-=7&U,C.mode=27;break}for(;U<3;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}switch(C.last=1&A,U-=1,3&(A>>>=1)){case 0:C.mode=14;break;case 1:if(P(C),C.mode=20,q!==6)break;A>>>=2,U-=2;break e;case 2:C.mode=17;break;case 3:O.msg="invalid block type",C.mode=30}A>>>=2,U-=2;break;case 14:for(A>>>=7&U,U-=7&U;U<32;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if((65535&A)!=(A>>>16^65535)){O.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&A,U=A=0,C.mode=15,q===6)break e;case 15:C.mode=16;case 16:if(oe=C.length){if(Y<oe&&(oe=Y),Z<oe&&(oe=Z),oe===0)break e;c.arraySet(L,I,V,oe,G),Y-=oe,V+=oe,Z-=oe,G+=oe,C.length-=oe;break}C.mode=12;break;case 17:for(;U<14;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if(C.nlen=257+(31&A),A>>>=5,U-=5,C.ndist=1+(31&A),A>>>=5,U-=5,C.ncode=4+(15&A),A>>>=4,U-=4,286<C.nlen||30<C.ndist){O.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;U<3;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}C.lens[re[C.have++]]=7&A,A>>>=3,U-=3}for(;C.have<19;)C.lens[re[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,fe={bits:C.lenbits},ve=p(0,C.lens,0,19,C.lencode,0,C.work,fe),C.lenbits=fe.bits,ve){O.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;we=(K=C.lencode[A&(1<<C.lenbits)-1])>>>16&255,Le=65535&K,!((ne=K>>>24)<=U);){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if(Le<16)A>>>=ne,U-=ne,C.lens[C.have++]=Le;else{if(Le===16){for(Q=ne+2;U<Q;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if(A>>>=ne,U-=ne,C.have===0){O.msg="invalid bit length repeat",C.mode=30;break}N=C.lens[C.have-1],oe=3+(3&A),A>>>=2,U-=2}else if(Le===17){for(Q=ne+3;U<Q;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}U-=ne,N=0,oe=3+(7&(A>>>=ne)),A>>>=3,U-=3}else{for(Q=ne+7;U<Q;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}U-=ne,N=0,oe=11+(127&(A>>>=ne)),A>>>=7,U-=7}if(C.have+oe>C.nlen+C.ndist){O.msg="invalid bit length repeat",C.mode=30;break}for(;oe--;)C.lens[C.have++]=N}}if(C.mode===30)break;if(C.lens[256]===0){O.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,fe={bits:C.lenbits},ve=p(m,C.lens,0,C.nlen,C.lencode,0,C.work,fe),C.lenbits=fe.bits,ve){O.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,fe={bits:C.distbits},ve=p(g,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,fe),C.distbits=fe.bits,ve){O.msg="invalid distances set",C.mode=30;break}if(C.mode=20,q===6)break e;case 20:C.mode=21;case 21:if(6<=Y&&258<=Z){O.next_out=G,O.avail_out=Z,O.next_in=V,O.avail_in=Y,C.hold=A,C.bits=U,f(O,se),G=O.next_out,L=O.output,Z=O.avail_out,V=O.next_in,I=O.input,Y=O.avail_in,A=C.hold,U=C.bits,C.mode===12&&(C.back=-1);break}for(C.back=0;we=(K=C.lencode[A&(1<<C.lenbits)-1])>>>16&255,Le=65535&K,!((ne=K>>>24)<=U);){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if(we&&(240&we)==0){for(ge=ne,Te=we,de=Le;we=(K=C.lencode[de+((A&(1<<ge+Te)-1)>>ge)])>>>16&255,Le=65535&K,!(ge+(ne=K>>>24)<=U);){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}A>>>=ge,U-=ge,C.back+=ge}if(A>>>=ne,U-=ne,C.back+=ne,C.length=Le,we===0){C.mode=26;break}if(32&we){C.back=-1,C.mode=12;break}if(64&we){O.msg="invalid literal/length code",C.mode=30;break}C.extra=15&we,C.mode=22;case 22:if(C.extra){for(Q=C.extra;U<Q;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}C.length+=A&(1<<C.extra)-1,A>>>=C.extra,U-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;we=(K=C.distcode[A&(1<<C.distbits)-1])>>>16&255,Le=65535&K,!((ne=K>>>24)<=U);){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if((240&we)==0){for(ge=ne,Te=we,de=Le;we=(K=C.distcode[de+((A&(1<<ge+Te)-1)>>ge)])>>>16&255,Le=65535&K,!(ge+(ne=K>>>24)<=U);){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}A>>>=ge,U-=ge,C.back+=ge}if(A>>>=ne,U-=ne,C.back+=ne,64&we){O.msg="invalid distance code",C.mode=30;break}C.offset=Le,C.extra=15&we,C.mode=24;case 24:if(C.extra){for(Q=C.extra;U<Q;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}C.offset+=A&(1<<C.extra)-1,A>>>=C.extra,U-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){O.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(Z===0)break e;if(oe=se-Z,C.offset>oe){if((oe=C.offset-oe)>C.whave&&C.sane){O.msg="invalid distance too far back",C.mode=30;break}Ce=oe>C.wnext?(oe-=C.wnext,C.wsize-oe):C.wnext-oe,oe>C.length&&(oe=C.length),ue=C.window}else ue=L,Ce=G-C.offset,oe=C.length;for(Z<oe&&(oe=Z),Z-=oe,C.length-=oe;L[G++]=ue[Ce++],--oe;);C.length===0&&(C.mode=21);break;case 26:if(Z===0)break e;L[G++]=C.length,Z--,C.mode=21;break;case 27:if(C.wrap){for(;U<32;){if(Y===0)break e;Y--,A|=I[V++]<<U,U+=8}if(se-=Z,O.total_out+=se,C.total+=se,se&&(O.adler=C.check=C.flags?h(C.check,L,se,G-se):u(C.check,L,se,G-se)),se=Z,(C.flags?A:j(A))!==C.check){O.msg="incorrect data check",C.mode=30;break}U=A=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;U<32;){if(Y===0)break e;Y--,A+=I[V++]<<U,U+=8}if(A!==(4294967295&C.total)){O.msg="incorrect length check",C.mode=30;break}U=A=0}C.mode=29;case 29:ve=1;break e;case 30:ve=-3;break e;case 31:return-4;default:return v}return O.next_out=G,O.avail_out=Z,O.next_in=V,O.avail_in=Y,C.hold=A,C.bits=U,(C.wsize||se!==O.avail_out&&C.mode<30&&(C.mode<27||q!==4))&&H(O,O.output,O.next_out,se-O.avail_out)?(C.mode=31,-4):(X-=O.avail_in,se-=O.avail_out,O.total_in+=X,O.total_out+=se,C.total+=se,C.wrap&&se&&(O.adler=C.check=C.flags?h(C.check,L,se,O.next_out-se):u(C.check,L,se,O.next_out-se)),O.data_type=C.bits+(C.last?64:0)+(C.mode===12?128:0)+(C.mode===20||C.mode===15?256:0),(X==0&&se===0||q===4)&&ve===x&&(ve=-5),ve)},o.inflateEnd=function(O){if(!O||!O.state)return v;var q=O.state;return q.window&&(q.window=null),O.state=null,x},o.inflateGetHeader=function(O,q){var C;return O&&O.state?(2&(C=O.state).wrap)==0?v:((C.head=q).done=!1,x):v},o.inflateSetDictionary=function(O,q){var C,I=q.length;return O&&O.state?(C=O.state).wrap!==0&&C.mode!==11?v:C.mode===11&&u(1,q,I,0)!==C.check?-3:H(O,q,I,I)?(C.mode=31,-4):(C.havedict=1,x):v},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(s,a,o){var c=s("../utils/common"),u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];a.exports=function(m,g,x,v,S,w,_,j){var E,T,R,B,F,$,M,z,P,H=j.bits,O=0,q=0,C=0,I=0,L=0,V=0,G=0,Y=0,Z=0,A=0,U=null,X=0,se=new c.Buf16(16),oe=new c.Buf16(16),Ce=null,ue=0;for(O=0;O<=15;O++)se[O]=0;for(q=0;q<v;q++)se[g[x+q]]++;for(L=H,I=15;1<=I&&se[I]===0;I--);if(I<L&&(L=I),I===0)return S[w++]=20971520,S[w++]=20971520,j.bits=1,0;for(C=1;C<I&&se[C]===0;C++);for(L<C&&(L=C),O=Y=1;O<=15;O++)if(Y<<=1,(Y-=se[O])<0)return-1;if(0<Y&&(m===0||I!==1))return-1;for(oe[1]=0,O=1;O<15;O++)oe[O+1]=oe[O]+se[O];for(q=0;q<v;q++)g[x+q]!==0&&(_[oe[g[x+q]]++]=q);if($=m===0?(U=Ce=_,19):m===1?(U=u,X-=257,Ce=h,ue-=257,256):(U=f,Ce=p,-1),O=C,F=w,G=q=A=0,R=-1,B=(Z=1<<(V=L))-1,m===1&&852<Z||m===2&&592<Z)return 1;for(;;){for(M=O-G,P=_[q]<$?(z=0,_[q]):_[q]>$?(z=Ce[ue+_[q]],U[X+_[q]]):(z=96,0),E=1<<O-G,C=T=1<<V;S[F+(A>>G)+(T-=E)]=M<<24|z<<16|P|0,T!==0;);for(E=1<<O-1;A&E;)E>>=1;if(E!==0?(A&=E-1,A+=E):A=0,q++,--se[O]==0){if(O===I)break;O=g[x+_[q]]}if(L<O&&(A&B)!==R){for(G===0&&(G=L),F+=C,Y=1<<(V=O-G);V+G<I&&!((Y-=se[V+G])<=0);)V++,Y<<=1;if(Z+=1<<V,m===1&&852<Z||m===2&&592<Z)return 1;S[R=A&B]=L<<24|V<<16|F-w|0}}return A!==0&&(S[F+A]=O-G<<24|64<<16|0),j.bits=L,0}},{"../utils/common":41}],51:[function(s,a,o){a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(s,a,o){var c=s("../utils/common"),u=0,h=1;function f(K){for(var ie=K.length;0<=--ie;)K[ie]=0}var p=0,m=29,g=256,x=g+1+m,v=30,S=19,w=2*x+1,_=15,j=16,E=7,T=256,R=16,B=17,F=18,$=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(x+2));f(H);var O=new Array(2*v);f(O);var q=new Array(512);f(q);var C=new Array(256);f(C);var I=new Array(m);f(I);var L,V,G,Y=new Array(v);function Z(K,ie,re,ee,le){this.static_tree=K,this.extra_bits=ie,this.extra_base=re,this.elems=ee,this.max_length=le,this.has_stree=K&&K.length}function A(K,ie){this.dyn_tree=K,this.max_code=0,this.stat_desc=ie}function U(K){return K<256?q[K]:q[256+(K>>>7)]}function X(K,ie){K.pending_buf[K.pending++]=255&ie,K.pending_buf[K.pending++]=ie>>>8&255}function se(K,ie,re){K.bi_valid>j-re?(K.bi_buf|=ie<<K.bi_valid&65535,X(K,K.bi_buf),K.bi_buf=ie>>j-K.bi_valid,K.bi_valid+=re-j):(K.bi_buf|=ie<<K.bi_valid&65535,K.bi_valid+=re)}function oe(K,ie,re){se(K,re[2*ie],re[2*ie+1])}function Ce(K,ie){for(var re=0;re|=1&K,K>>>=1,re<<=1,0<--ie;);return re>>>1}function ue(K,ie,re){var ee,le,ye=new Array(_+1),qe=0;for(ee=1;ee<=_;ee++)ye[ee]=qe=qe+re[ee-1]<<1;for(le=0;le<=ie;le++){var Re=K[2*le+1];Re!==0&&(K[2*le]=Ce(ye[Re]++,Re))}}function ne(K){var ie;for(ie=0;ie<x;ie++)K.dyn_ltree[2*ie]=0;for(ie=0;ie<v;ie++)K.dyn_dtree[2*ie]=0;for(ie=0;ie<S;ie++)K.bl_tree[2*ie]=0;K.dyn_ltree[2*T]=1,K.opt_len=K.static_len=0,K.last_lit=K.matches=0}function we(K){8<K.bi_valid?X(K,K.bi_buf):0<K.bi_valid&&(K.pending_buf[K.pending++]=K.bi_buf),K.bi_buf=0,K.bi_valid=0}function Le(K,ie,re,ee){var le=2*ie,ye=2*re;return K[le]<K[ye]||K[le]===K[ye]&&ee[ie]<=ee[re]}function ge(K,ie,re){for(var ee=K.heap[re],le=re<<1;le<=K.heap_len&&(le<K.heap_len&&Le(ie,K.heap[le+1],K.heap[le],K.depth)&&le++,!Le(ie,ee,K.heap[le],K.depth));)K.heap[re]=K.heap[le],re=le,le<<=1;K.heap[re]=ee}function Te(K,ie,re){var ee,le,ye,qe,Re=0;if(K.last_lit!==0)for(;ee=K.pending_buf[K.d_buf+2*Re]<<8|K.pending_buf[K.d_buf+2*Re+1],le=K.pending_buf[K.l_buf+Re],Re++,ee===0?oe(K,le,ie):(oe(K,(ye=C[le])+g+1,ie),(qe=$[ye])!==0&&se(K,le-=I[ye],qe),oe(K,ye=U(--ee),re),(qe=M[ye])!==0&&se(K,ee-=Y[ye],qe)),Re<K.last_lit;);oe(K,T,ie)}function de(K,ie){var re,ee,le,ye=ie.dyn_tree,qe=ie.stat_desc.static_tree,Re=ie.stat_desc.has_stree,$e=ie.stat_desc.elems,Ke=-1;for(K.heap_len=0,K.heap_max=w,re=0;re<$e;re++)ye[2*re]!==0?(K.heap[++K.heap_len]=Ke=re,K.depth[re]=0):ye[2*re+1]=0;for(;K.heap_len<2;)ye[2*(le=K.heap[++K.heap_len]=Ke<2?++Ke:0)]=1,K.depth[le]=0,K.opt_len--,Re&&(K.static_len-=qe[2*le+1]);for(ie.max_code=Ke,re=K.heap_len>>1;1<=re;re--)ge(K,ye,re);for(le=$e;re=K.heap[1],K.heap[1]=K.heap[K.heap_len--],ge(K,ye,1),ee=K.heap[1],K.heap[--K.heap_max]=re,K.heap[--K.heap_max]=ee,ye[2*le]=ye[2*re]+ye[2*ee],K.depth[le]=(K.depth[re]>=K.depth[ee]?K.depth[re]:K.depth[ee])+1,ye[2*re+1]=ye[2*ee+1]=le,K.heap[1]=le++,ge(K,ye,1),2<=K.heap_len;);K.heap[--K.heap_max]=K.heap[1],(function(Ye,Et){var Kt,dt,bt,mt,$t,on,Ot=Et.dyn_tree,gn=Et.max_code,Wt=Et.stat_desc.static_tree,Dt=Et.stat_desc.has_stree,zn=Et.stat_desc.extra_bits,hn=Et.stat_desc.extra_base,Ct=Et.stat_desc.max_length,ht=0;for(mt=0;mt<=_;mt++)Ye.bl_count[mt]=0;for(Ot[2*Ye.heap[Ye.heap_max]+1]=0,Kt=Ye.heap_max+1;Kt<w;Kt++)Ct<(mt=Ot[2*Ot[2*(dt=Ye.heap[Kt])+1]+1]+1)&&(mt=Ct,ht++),Ot[2*dt+1]=mt,gn<dt||(Ye.bl_count[mt]++,$t=0,hn<=dt&&($t=zn[dt-hn]),on=Ot[2*dt],Ye.opt_len+=on*(mt+$t),Dt&&(Ye.static_len+=on*(Wt[2*dt+1]+$t)));if(ht!==0){do{for(mt=Ct-1;Ye.bl_count[mt]===0;)mt--;Ye.bl_count[mt]--,Ye.bl_count[mt+1]+=2,Ye.bl_count[Ct]--,ht-=2}while(0<ht);for(mt=Ct;mt!==0;mt--)for(dt=Ye.bl_count[mt];dt!==0;)gn<(bt=Ye.heap[--Kt])||(Ot[2*bt+1]!==mt&&(Ye.opt_len+=(mt-Ot[2*bt+1])*Ot[2*bt],Ot[2*bt+1]=mt),dt--)}})(K,ie),ue(ye,Ke,K.bl_count)}function N(K,ie,re){var ee,le,ye=-1,qe=ie[1],Re=0,$e=7,Ke=4;for(qe===0&&($e=138,Ke=3),ie[2*(re+1)+1]=65535,ee=0;ee<=re;ee++)le=qe,qe=ie[2*(ee+1)+1],++Re<$e&&le===qe||(Re<Ke?K.bl_tree[2*le]+=Re:le!==0?(le!==ye&&K.bl_tree[2*le]++,K.bl_tree[2*R]++):Re<=10?K.bl_tree[2*B]++:K.bl_tree[2*F]++,ye=le,Ke=(Re=0)===qe?($e=138,3):le===qe?($e=6,3):($e=7,4))}function ve(K,ie,re){var ee,le,ye=-1,qe=ie[1],Re=0,$e=7,Ke=4;for(qe===0&&($e=138,Ke=3),ee=0;ee<=re;ee++)if(le=qe,qe=ie[2*(ee+1)+1],!(++Re<$e&&le===qe)){if(Re<Ke)for(;oe(K,le,K.bl_tree),--Re!=0;);else le!==0?(le!==ye&&(oe(K,le,K.bl_tree),Re--),oe(K,R,K.bl_tree),se(K,Re-3,2)):Re<=10?(oe(K,B,K.bl_tree),se(K,Re-3,3)):(oe(K,F,K.bl_tree),se(K,Re-11,7));ye=le,Ke=(Re=0)===qe?($e=138,3):le===qe?($e=6,3):($e=7,4)}}f(Y);var fe=!1;function Q(K,ie,re,ee){se(K,(p<<1)+(ee?1:0),3),(function(le,ye,qe,Re){we(le),X(le,qe),X(le,~qe),c.arraySet(le.pending_buf,le.window,ye,qe,le.pending),le.pending+=qe})(K,ie,re)}o._tr_init=function(K){fe||((function(){var ie,re,ee,le,ye,qe=new Array(_+1);for(le=ee=0;le<m-1;le++)for(I[le]=ee,ie=0;ie<1<<$[le];ie++)C[ee++]=le;for(C[ee-1]=le,le=ye=0;le<16;le++)for(Y[le]=ye,ie=0;ie<1<<M[le];ie++)q[ye++]=le;for(ye>>=7;le<v;le++)for(Y[le]=ye<<7,ie=0;ie<1<<M[le]-7;ie++)q[256+ye++]=le;for(re=0;re<=_;re++)qe[re]=0;for(ie=0;ie<=143;)H[2*ie+1]=8,ie++,qe[8]++;for(;ie<=255;)H[2*ie+1]=9,ie++,qe[9]++;for(;ie<=279;)H[2*ie+1]=7,ie++,qe[7]++;for(;ie<=287;)H[2*ie+1]=8,ie++,qe[8]++;for(ue(H,x+1,qe),ie=0;ie<v;ie++)O[2*ie+1]=5,O[2*ie]=Ce(ie,5);L=new Z(H,$,g+1,x,_),V=new Z(O,M,0,v,_),G=new Z(new Array(0),z,0,S,E)})(),fe=!0),K.l_desc=new A(K.dyn_ltree,L),K.d_desc=new A(K.dyn_dtree,V),K.bl_desc=new A(K.bl_tree,G),K.bi_buf=0,K.bi_valid=0,ne(K)},o._tr_stored_block=Q,o._tr_flush_block=function(K,ie,re,ee){var le,ye,qe=0;0<K.level?(K.strm.data_type===2&&(K.strm.data_type=(function(Re){var $e,Ke=4093624447;for($e=0;$e<=31;$e++,Ke>>>=1)if(1&Ke&&Re.dyn_ltree[2*$e]!==0)return u;if(Re.dyn_ltree[18]!==0||Re.dyn_ltree[20]!==0||Re.dyn_ltree[26]!==0)return h;for($e=32;$e<g;$e++)if(Re.dyn_ltree[2*$e]!==0)return h;return u})(K)),de(K,K.l_desc),de(K,K.d_desc),qe=(function(Re){var $e;for(N(Re,Re.dyn_ltree,Re.l_desc.max_code),N(Re,Re.dyn_dtree,Re.d_desc.max_code),de(Re,Re.bl_desc),$e=S-1;3<=$e&&Re.bl_tree[2*P[$e]+1]===0;$e--);return Re.opt_len+=3*($e+1)+5+5+4,$e})(K),le=K.opt_len+3+7>>>3,(ye=K.static_len+3+7>>>3)<=le&&(le=ye)):le=ye=re+5,re+4<=le&&ie!==-1?Q(K,ie,re,ee):K.strategy===4||ye===le?(se(K,2+(ee?1:0),3),Te(K,H,O)):(se(K,4+(ee?1:0),3),(function(Re,$e,Ke,Ye){var Et;for(se(Re,$e-257,5),se(Re,Ke-1,5),se(Re,Ye-4,4),Et=0;Et<Ye;Et++)se(Re,Re.bl_tree[2*P[Et]+1],3);ve(Re,Re.dyn_ltree,$e-1),ve(Re,Re.dyn_dtree,Ke-1)})(K,K.l_desc.max_code+1,K.d_desc.max_code+1,qe+1),Te(K,K.dyn_ltree,K.dyn_dtree)),ne(K),ee&&we(K)},o._tr_tally=function(K,ie,re){return K.pending_buf[K.d_buf+2*K.last_lit]=ie>>>8&255,K.pending_buf[K.d_buf+2*K.last_lit+1]=255&ie,K.pending_buf[K.l_buf+K.last_lit]=255&re,K.last_lit++,ie===0?K.dyn_ltree[2*re]++:(K.matches++,ie--,K.dyn_ltree[2*(C[re]+g+1)]++,K.dyn_dtree[2*U(ie)]++),K.last_lit===K.lit_bufsize-1},o._tr_align=function(K){se(K,2,3),oe(K,T,H),(function(ie){ie.bi_valid===16?(X(ie,ie.bi_buf),ie.bi_buf=0,ie.bi_valid=0):8<=ie.bi_valid&&(ie.pending_buf[ie.pending++]=255&ie.bi_buf,ie.bi_buf>>=8,ie.bi_valid-=8)})(K)}},{"../utils/common":41}],53:[function(s,a,o){a.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(s,a,o){(function(c){(function(u,h){if(!u.setImmediate){var f,p,m,g,x=1,v={},S=!1,w=u.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(u);_=_&&_.setTimeout?_:u,f={}.toString.call(u.process)==="[object process]"?function(R){process.nextTick(function(){E(R)})}:(function(){if(u.postMessage&&!u.importScripts){var R=!0,B=u.onmessage;return u.onmessage=function(){R=!1},u.postMessage("","*"),u.onmessage=B,R}})()?(g="setImmediate$"+Math.random()+"$",u.addEventListener?u.addEventListener("message",T,!1):u.attachEvent("onmessage",T),function(R){u.postMessage(g+R,"*")}):u.MessageChannel?((m=new MessageChannel).port1.onmessage=function(R){E(R.data)},function(R){m.port2.postMessage(R)}):w&&"onreadystatechange"in w.createElement("script")?(p=w.documentElement,function(R){var B=w.createElement("script");B.onreadystatechange=function(){E(R),B.onreadystatechange=null,p.removeChild(B),B=null},p.appendChild(B)}):function(R){setTimeout(E,0,R)},_.setImmediate=function(R){typeof R!="function"&&(R=new Function(""+R));for(var B=new Array(arguments.length-1),F=0;F<B.length;F++)B[F]=arguments[F+1];var $={callback:R,args:B};return v[x]=$,f(x),x++},_.clearImmediate=j}function j(R){delete v[R]}function E(R){if(S)setTimeout(E,0,R);else{var B=v[R];if(B){S=!0;try{(function(F){var $=F.callback,M=F.args;switch(M.length){case 0:$();break;case 1:$(M[0]);break;case 2:$(M[0],M[1]);break;case 3:$(M[0],M[1],M[2]);break;default:$.apply(h,M)}})(B)}finally{j(R),S=!1}}}}function T(R){R.source===u&&typeof R.data=="string"&&R.data.indexOf(g)===0&&E(+R.data.slice(g.length))}})(typeof self>"u"?c===void 0?this:c:self)}).call(this,typeof Lu<"u"?Lu:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(jp)),jp.exports}var H2=V2();const G2=nm(H2),$x=e=>`${Fo}/functions/v1/${e}`,ui={async fetchMyBackups(){const{data:e,error:t}=await Ae.from("account_backups").select("id, generation, recipe_count, label, created_at").order("generation",{ascending:!0});if(t)throw t;return e||[]},async adminFetchAllBackups(){const{data:e,error:t}=await Ae.rpc("admin_list_all_backups");if(t)throw t;return e||[]},async adminTriggerBackupAll(){const{data:e}=await Ae.auth.getSession(),t=e?.session?.access_token;if(!t)throw new Error("");const s=$x("scheduled-backup");console.log("[backupService] Calling Edge Function:",s);const a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})}),o=await a.text();if(console.log("[backupService] Response status:",a.status,o),!a.ok)throw new Error(` (${a.status}): ${o}`);try{return JSON.parse(o)}catch{return{ok:!0,message:o}}},async adminTriggerBackupForUser(e){const{data:t}=await Ae.auth.getSession(),s=t?.session?.access_token;if(!s)throw new Error("");const a=$x("scheduled-backup");console.log("[backupService] Calling Edge Function for user:",e,a);const o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({user_id:e})}),c=await o.text();if(console.log("[backupService] Response status:",o.status,c),!o.ok)throw new Error(` (${o.status}): ${c}`);try{return JSON.parse(c)}catch{return{ok:!0,message:c}}},async adminFetchBackupData(e){const{data:t,error:s}=await Ae.from("account_backups").select("id, generation, recipe_count, label, created_at, backup_data, user_id").eq("id",e).single();if(s)throw s;return t},downloadBackupAsJson(e,t,s){const a=String(s||"unknown").replace(/[^\w]/g,"_"),o=String(t||"data").replace(/[^\w\-]/g,"_"),c=new Date().toISOString().slice(0,10),u=`backup_${a}_${o}_${c}.json`,h=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),p=document.createElement("a");p.href=f,p.download=u,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(f)},async downloadAllBackupsAsZip(e){if(!e||Object.keys(e).length===0)return;const s=`all_users_backup_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.zip`,a=new G2;Object.entries(e).forEach(([h,f])=>{const p=h.replace(/[\\/:*?"<>|]/g,"_");a.file(`backup_${p}.json`,JSON.stringify(f,null,2))});const o=await a.generateAsync({type:"blob"}),c=URL.createObjectURL(o),u=document.createElement("a");u.href=c,u.download=s,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(c)}},Ts=(e,t="")=>{const s=String(e||t||"");if(!s)return null;const a=s.match(/(.*)(_[a-zA-Z0-9]{8})$/);return a?r.jsxs(r.Fragment,{children:[a[1],r.jsx("span",{style:{opacity:.45,fontSize:"0.9em",fontWeight:"normal"},children:a[2]})]}):s},K2=()=>{const{user:e}=xs(),[t,s]=k.useState([]),[a,o]=k.useState(!0),[c,u]=k.useState(""),[h,f]=k.useState({type:"",message:""}),[p,m]=k.useState(!1),[g,x]=k.useState(!1),[v,S]=k.useState(new Set),[w,_]=k.useState(null),[j,E]=k.useState(!1),[T,R]=k.useState(!1),[B,F]=k.useState({type:"",message:""}),[$,M]=k.useState(null),[z,P]=k.useState(!1),H=k.useCallback(async()=>{o(!0),u("");try{const A=await ui.adminFetchAllBackups();s(A||[])}catch(A){console.error(A),u(": "+(A?.message||String(A)))}finally{o(!1)}},[]);k.useEffect(()=>{H()},[H]);const O=async()=>{if(!p){m(!0),f({type:"info",message:"..."});try{const A=await ui.adminTriggerBackupAll();f({type:"success",message:A?.message||""}),await H()}catch(A){console.error(A),f({type:"error",message:": "+(A?.message||String(A))})}finally{m(!1)}}},q=async(A,U)=>{if(!v.has(A)){S(X=>new Set([...X,A])),f({type:"info",message:`${U||A} ...`});try{const X=await ui.adminTriggerBackupForUser(A);f({type:"success",message:X?.message||`${U||A} `}),await H()}catch(X){console.error(X),f({type:"error",message:`: ${X?.message||String(X)}`})}finally{S(X=>{const se=new Set(X);return se.delete(A),se})}}},C=async A=>{try{f({type:"info",message:"..."});const U=await ui.adminFetchBackupData(A.id||A.backup_id);ui.downloadBackupAsJson(U.backup_data,A.label,A.display_id||A.user_id),f({type:"success",message:"JSON"})}catch(U){console.error(U),f({type:"error",message:": "+(U?.message||String(U))})}},I=async()=>{if(!(g||t.length===0)){x(!0),f({type:"info",message:"..."});try{const A=new Map;for(const Ce of t){const ue=A.get(Ce.user_id);(!ue||new Date(Ce.created_at)>new Date(ue.created_at))&&A.set(Ce.user_id,Ce)}const U=Array.from(A.values());if(U.length===0){f({type:"info",message:""});return}const X={};let se=0,oe=0;for(let Ce=0;Ce<U.length;Ce++){const ue=U[Ce],ne=Ts(ue.display_id)||ue.user_id;f({type:"info",message:`... ${Ce+1}/${U.length} (${ne})`});try{const we=await ui.adminFetchBackupData(ue.id||ue.backup_id);X[ne]={user_id:ue.user_id,display_id:Ts(ue.display_id)||null,email:ue.email||null,generation:ue.generation,created_at:ue.created_at,label:ue.label,data:we.backup_data||[]},se++}catch(we){console.error(`Failed to fetch data for user ${ue.user_id}:`,we),oe++}}if(se===0)throw new Error("");await ui.downloadAllBackupsAsZip(X),f({type:"success",message:`: ${se}${oe>0?`${oe}`:""}`})}catch(A){console.error(A),f({type:"error",message:": "+(A?.message||String(A))})}finally{x(!1)}}},L=async A=>{_({backupId:A.id||A.backup_id,displayId:Ts(A.display_id)||A.user_id,generation:A.generation,label:A.label,recipeCount:A.recipe_count}),F({type:"",message:""})},V=async()=>{if(!(!w||T)){R(!0),F({type:"info",message:"..."});try{const U=(await ui.adminFetchBackupData(w.backupId))?.backup_data;if(!Array.isArray(U))throw new Error("");F({type:"info",message:`${U.length}...`});const X=await An.importRecipes(U);F({type:"success",message:`: ${X.count}${X.errors?.length>0?`${X.errors.length}`:""}`})}catch(A){console.error(A),F({type:"error",message:": "+(A?.message||String(A))})}finally{R(!1)}}},G=async A=>{P(!0);try{const U=await ui.adminFetchBackupData(A.id||A.backup_id);M({...A,backup_data:U.backup_data})}catch{f({type:"error",message:""})}finally{P(!1)}},Y=t.reduce((A,U)=>{const X=U.user_id;return A[X]||(A[X]={displayId:U.display_id,email:U.email,userId:X,gens:[]}),A[X].gens.push(U),A},{}),Z=Object.values(Y).sort((A,U)=>String(A.displayId||"").localeCompare(String(U.displayId||"")));return e?.role!=="admin"?r.jsx("div",{className:"backup-management-empty",children:r.jsx("p",{children:" "})}):r.jsxs("div",{className:"backup-management",children:[r.jsxs("div",{className:"backup-header",children:[r.jsxs("div",{className:"backup-header-info",children:[r.jsx("h3",{className:"backup-title",children:" "}),r.jsx("p",{className:"backup-desc",children:"3"})]}),r.jsxs("div",{className:"backup-header-actions",children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:H,disabled:a||g,children:" "}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:I,disabled:a||g||t.length===0,title:"ZIP",children:g?"...":" DL (ZIP)"}),r.jsx(ce,{variant:"primary",onClick:O,disabled:p||g,children:p?"...":" "})]})]}),h.message&&r.jsx("div",{className:`backup-status backup-status--${h.type}`,children:h.message}),c&&r.jsx("div",{className:"backup-status backup-status--error",children:c}),a?r.jsx("div",{className:"backup-loading",children:"..."}):Z.length===0?r.jsxs("div",{className:"backup-empty",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]}):r.jsx("div",{className:"backup-user-list",children:Z.map(A=>r.jsxs("div",{className:"backup-user-card",children:[r.jsxs("div",{className:"backup-user-header",children:[r.jsxs("div",{className:"backup-user-info",children:[r.jsxs("span",{className:"backup-user-id",children:[" ",Ts(A.displayId)||A.userId]}),A.email&&r.jsx("span",{className:"backup-user-email",children:A.email})]}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>q(A.userId,Ts(A.displayId)),disabled:v.has(A.userId)||p,children:v.has(A.userId)?"...":""})]}),r.jsx("div",{className:"backup-gen-list",children:[1,2,3].map(U=>{const X=A.gens.find(se=>se.generation===U);return r.jsxs("div",{className:`backup-gen-item ${X?"backup-gen-item--exists":"backup-gen-item--empty"}`,children:[r.jsx("div",{className:"backup-gen-number",children:r.jsxs("span",{className:"backup-gen-badge",children:["",U,""]})}),X?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"backup-gen-meta",children:[r.jsx("div",{className:"backup-gen-label",children:X.label}),r.jsx("div",{className:"backup-gen-date",children:new Date(X.created_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),r.jsxs("div",{className:"backup-gen-count",children:[": ",r.jsx("strong",{children:X.recipe_count}),""]})]}),r.jsxs("div",{className:"backup-gen-actions",children:[r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>G(X),disabled:z,title:"",children:" "}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>C(X),title:"JSON",children:" DL"}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>L(X),title:"",children:" "})]})]}):r.jsx("div",{className:"backup-gen-empty-text",children:""})]},U)})})]},A.userId))}),r.jsxs("div",{className:"backup-cron-info",children:[r.jsx("div",{className:"backup-cron-title",children:" "}),r.jsxs("ul",{className:"backup-cron-list",children:[r.jsxs("li",{children:[" ",r.jsx("strong",{children:"0:00 JST"}),"UTC 15:00"]}),r.jsxs("li",{children:[" Supabase  ",r.jsx("strong",{children:"Database  Cron Jobs"})," "]}),r.jsx("li",{children:"3"})]}),r.jsxs("div",{className:"backup-cron-sql",children:[r.jsx("div",{className:"backup-cron-sql-label",children:"cronSupabase SQL Editor:"}),r.jsx("code",{className:"backup-cron-code",children:`SELECT cron.schedule('daily-account-backup', '0 15 * * *', $$SELECT net.http_post(url:='<SUPABASE_URL>/functions/v1/scheduled-backup', headers:='{"Content-Type":"application/json","Authorization":"Bearer <ANON_KEY>"}', body:='{}'::jsonb) AS request_id;$$);`})]})]}),r.jsx(an,{isOpen:!!w,onClose:()=>{T||_(null)},title:"",size:"medium",showCloseButton:!T,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"14px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),r.jsxs("div",{className:"restore-info-box",children:[r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",w?.displayId]}),r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",w?.generation,""]}),r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",w?.label]}),r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",w?.recipeCount,""]})]}),B.message&&r.jsx("div",{className:`backup-status backup-status--${B.type}`,children:B.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>_(null),disabled:T,children:""}),r.jsx(ce,{variant:"primary",onClick:V,disabled:T||B.type==="success",children:T?"...":""})]})]})}),r.jsx(an,{isOpen:!!$,onClose:()=>M(null),title:` - ${$?.generation}`,size:"large",children:$&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.85rem",color:"#555",display:"flex",gap:"16px",flexWrap:"wrap"},children:[r.jsxs("span",{children:[": ",r.jsx("strong",{children:Ts($.display_id)})]}),r.jsxs("span",{children:[": ",r.jsxs("strong",{children:[$.recipe_count,""]})]}),r.jsxs("span",{children:[": ",r.jsx("strong",{children:new Date($.created_at).toLocaleString("ja-JP")})]})]}),r.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",background:"#f8f9fa",borderRadius:"8px",padding:"12px"},children:r.jsxs("table",{className:"backup-preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"#"}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:(Array.isArray($.backup_data)?$.backup_data:[]).map((A,U)=>r.jsxs("tr",{children:[r.jsx("td",{children:U+1}),r.jsx("td",{style:{fontWeight:500},children:A.title||"-"}),r.jsx("td",{children:A.category||A.course||"-"}),r.jsx("td",{children:A.created_at?new Date(A.created_at).toLocaleDateString("ja-JP"):"-"})]},A.id||U))})]})}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"secondary",onClick:()=>C($),children:" JSON"}),r.jsx(ce,{variant:"ghost",onClick:()=>M(null),children:""})]})]})})]})},qx=e=>{const t=String(e||"");return t?t.slice(0,7).replace("/","-"):""},W2=({onBack:e})=>{const[t,s]=jc(),{user:a}=xs(),[o,c]=k.useState("price"),[u,h]=k.useState(!1),[f,p]=k.useState(!1),[m,g]=k.useState(null),[x,v]=k.useState(null),[S,w]=k.useState(!1),[_,j]=k.useState(!1),[E,T]=k.useState({total:0,done:0,current:""}),[R,B]=k.useState(null),[F,$]=k.useState(!1),[M,z]=k.useState(!1),[P,H]=k.useState({total:0,done:0,current:""}),[O,q]=k.useState(null),[C,I]=k.useState(!1),[L,V]=k.useState(!1),[G,Y]=k.useState(null),[Z,A]=k.useState(!1),[U,X]=k.useState(!1),[se,oe]=k.useState(null),[Ce,ue]=k.useState(null),[ne,we]=k.useState(!1),Le=k.useRef(0),[ge,Te]=k.useState({type:"",message:""}),[de,N]=k.useState(!1),[ve,fe]=k.useState([]),[Q,K]=k.useState(!1),[ie,re]=k.useState(null),[ee,le]=k.useState({type:"",message:""}),[ye,qe]=k.useState(null),[Re,$e]=k.useState(!1),[Ke,Ye]=k.useState(!1),[Et,Kt]=k.useState(!1),[dt,bt]=k.useState([]),[mt,$t]=k.useState(!1),[on,Ot]=k.useState(""),[gn,Wt]=k.useState(""),[Dt,zn]=k.useState(!1),[hn,Ct]=k.useState({total:0,done:0,current:""}),[ht,Vt]=k.useState(null),[qt,cn]=k.useState(!1),[Ft,_n]=k.useState(!1),[xn,un]=k.useState(!1),[Vn,Ht]=k.useState(!1),[Cn,It]=k.useState({type:"",message:""}),[Tn,Kn]=k.useState(!1),[dn,Xt]=k.useState(new Map),[ke,te]=k.useState([]),[je,Oe]=k.useState(""),[We,ae]=k.useState(""),[he,pe]=k.useState(""),Ne=Ue.useMemo(()=>{if(!je)return[];const Se=dn.get(je)||[],nt=new Set;return Se.forEach(ft=>{const Nt=qx(ft?.dateStr);Nt&&nt.add(Nt)}),Array.from(nt).sort((ft,Nt)=>Nt.localeCompare(ft))},[dn,je]);k.useEffect(()=>{if(he){if(!je){pe("");return}Ne.length>0&&!Ne.includes(he)&&pe("")}},[Ne,he,je]);const[Be,it]=k.useState({key:"dateStr",direction:"desc"}),[et,Xe]=k.useState("");k.useEffect(()=>{const Se=t.get("tab");(Se==="price"||Se==="ingredients"||Se==="csv-import"||Se==="duplicates")&&c(Se)},[]);const lt=Se=>{let nt="asc";Be.key===Se&&Be.direction==="asc"&&(nt="desc"),it({key:Se,direction:nt})},Mt=Ue.useMemo(()=>{let Se=[...ve];if(et){const nt=et.toLowerCase().trim();Se=Se.filter(ft=>ft.name&&ft.name.toLowerCase().includes(nt)||ft.vendor&&ft.vendor.toLowerCase().includes(nt)||ft.dateStr&&ft.dateStr.includes(nt))}return Be.key&&Se.sort((nt,ft)=>{let Nt=nt[Be.key]||"",fn=ft[Be.key]||"";return Nt<fn?Be.direction==="asc"?-1:1:Nt>fn?Be.direction==="asc"?1:-1:0}),Se},[ve,Be,et]),[Tt,Ge]=k.useState([]);k.useEffect(()=>{In()},[]),k.useEffect(()=>{let Se=!0;return(async()=>{if(o==="price"){if(a?.role!=="admin"){Se&&(_n(!1),Ht(!1));return}_n(!0);try{const ft=await Yp.getVoiceInputEnabled({force:!0});if(!Se)return;Ht(ft),It({type:"",message:""})}catch(ft){if(console.error("Failed to load voice feature flag:",ft),!Se)return;It({type:"error",message:""})}finally{Se&&_n(!1)}}})(),()=>{Se=!1}},[o,a?.id,a?.role]);const ct=async Se=>{if(!(a?.role!=="admin"||xn)){un(!0),It({type:"info",message:"..."});try{const nt=await Yp.setVoiceInputEnabled(Se);Ht(nt),It({type:"success",message:""+(nt?"":"")+""})}catch(nt){console.error("Failed to save voice feature flag:",nt),It({type:"error",message:""})}finally{un(!1)}}},Zt=async()=>{Kn(!0);try{const nt=await Fn.fetchPriceHistory()||new Map;Xt(nt);const ft=[];for(const[Nt,fn]of nt.entries()){const cr=new Set,ln=[];if((fn||[]).forEach(nn=>{const Zn=[String(nn?.dateStr||""),String(nn?.price??""),String(nn?.incomingQty??""),String(nn?.unit||""),String(nn?.vendor||""),String(nn?.displayName||"")].join("|");cr.has(Zn)||(cr.add(Zn),ln.push(nn))}),ln.length<2)continue;ln.sort((nn,Zn)=>String(nn?.dateStr||"").localeCompare(String(Zn?.dateStr||"")));const wn=ln[ln.length-1]||{},Ut=ln.map(nn=>Number(nn?.price)).filter(nn=>Number.isFinite(nn)),Wn=Ut.length?Math.min(...Ut):null,bn=Ut.length?Math.max(...Ut):null,Bn=new Set(ln.map(nn=>String(nn?.dateStr||""))).size,rs=new Set(ln.map(nn=>String(nn?.displayName||""))).size;let Mr=0;for(let nn=1;nn<ln.length;nn++){const Zn=Number(ln[nn-1]?.price),Tr=Number(ln[nn]?.price);Number.isFinite(Zn)&&Number.isFinite(Tr)&&Zn!==Tr&&Mr++}ft.push({key:Nt,name:wn?.displayName||Nt,lastDate:wn?.dateStr||"",lastPrice:Number.isFinite(Number(wn?.price))?Number(wn?.price):null,lastIncomingQty:Number.isFinite(Number(wn?.incomingQty))?Number(wn?.incomingQty):null,unit:wn?.unit||"",vendor:wn?.vendor||"",rows:ln.length,dates:Bn,nameVariants:rs,minPrice:Wn,maxPrice:bn,changes:Mr})}ft.sort((Nt,fn)=>{const cr=String(Nt?.lastDate||""),ln=String(fn?.lastDate||"");return cr!==ln?ln.localeCompare(cr):(fn?.changes||0)!==(Nt?.changes||0)?(fn?.changes||0)-(Nt?.changes||0):(fn?.rows||0)!==(Nt?.rows||0)?(fn?.rows||0)-(Nt?.rows||0):String(Nt?.name||"").localeCompare(String(fn?.name||""),"ja")}),te(ft),je&&!nt.has(je)&&Oe("")}catch(Se){console.error(Se)}finally{Kn(!1)}};k.useEffect(()=>{o==="duplicates"&&Zt()},[o]);const In=async()=>{K(!0);try{const Se=await Fn.getPriceListArray();fe(Se);const nt=await Fn.getFileList();Ge(nt)}catch(Se){console.error("Failed to load price data",Se)}finally{K(!1)}},Xn=Se=>{if(!Se)return!1;const nt=String(Se.type||"").toLowerCase();return String(Se.name||"").toLowerCase().endsWith(".csv")?!0:nt==="text/csv"||nt==="application/csv"||nt==="application/vnd.ms-excel"},Nr=Se=>{const nt=Se.target.files?.[0];if(nt){if(!Xn(nt)){ue(null),Te({type:"error",message:"CSV.csv"}),Se.target.value="";return}ue(nt),Te({type:"",message:""})}},Hr=()=>{Le.current=0,we(!1)},zr=Se=>{Se.preventDefault(),Se.stopPropagation(),Le.current+=1,we(!0)},Gr=Se=>{Se.preventDefault(),Se.stopPropagation(),Se.dataTransfer&&(Se.dataTransfer.dropEffect="copy"),ne||we(!0)},mr=Se=>{Se.preventDefault(),Se.stopPropagation(),Le.current=Math.max(0,Le.current-1),Le.current===0&&we(!1)},Ls=Se=>{if(Se.preventDefault(),Se.stopPropagation(),Hr(),de)return;const nt=(()=>{const fn=Array.from(Se.dataTransfer?.files||[]);return fn.length>0?fn:Array.from(Se.dataTransfer?.items||[]).filter(ln=>ln?.kind==="file").map(ln=>ln.getAsFile()).filter(Boolean)})();if(nt.length===0)return;const ft=nt.find(Xn);if(!ft){ue(null),Te({type:"error",message:"CSV.csv"});return}ue(ft),Te({type:"info",message:`${ft.name}...`});const Nt=document.getElementById("csv-upload-input");Nt&&(Nt.value=""),Fs(ft)},Fs=async(Se=null)=>{const nt=Se||Ce;if(!nt||de)return;N(!0),Te({type:"info",message:"..."});const ft=await Fn.uploadPriceList(nt);if(ft.success){Te({type:"success",message:"..."});try{const{recipeService:fn}=await Ze(async()=>{const{recipeService:wn}=await Promise.resolve().then(()=>op);return{recipeService:wn}},[]),cr=await Fn.fetchPriceList(),ln=await fn.updateRecipeCosts(cr);Te({type:"success",message:`${ln} `})}catch(fn){console.error("Cost update failed",fn),Te({type:"warning",message:""})}ue(null);const Nt=document.getElementById("csv-upload-input");Nt&&(Nt.value=""),In()}else Te({type:"error",message:`: ${ft.error.message} `});N(!1)},wi=Se=>{re({message:`${Se}
`,onConfirm:async()=>{N(!0);const nt=await Fn.deletePriceFile(Se);N(!1),nt.success?(Te({type:"success",message:""}),In()):Te({type:"error",message:`: ${nt.error.message} `})}})},qa=Se=>{Se&&(qe(Se),$e(!0),le({type:"",message:""}))},Vs=()=>{if(Ke)return;$e(!1),qe(null);const Se=document.getElementById("backup-upload-input");Se&&(Se.value="")},sl=async()=>{const Se=ye;if(!(!Se||Ke)){Ye(!0),le({type:"info",message:"..."});try{const nt=await Se.text(),ft=JSON.parse(nt),{recipeService:Nt}=await Ze(async()=>{const{recipeService:wn}=await Promise.resolve().then(()=>op);return{recipeService:wn}},void 0),fn=await Nt.importRecipes(ft),cr=Number(fn?.count||0),ln=Array.isArray(fn?.errors)?fn.errors.length:0;le({type:ln>0?"warning":"success",message:`: ${cr}${ln>0?` / : ${ln}`:""} `}),$e(!1),qe(null)}catch(nt){console.error(nt),le({type:"error",message:""})}finally{Ye(!1);const nt=document.getElementById("backup-upload-input");nt&&(nt.value="")}}},Ar=async()=>{j(!0),T({total:0,done:0,current:""}),B(null);try{const Se=await Fn.moveAllToTrash(ft=>{T(ft)});B({type:"success",message:`: ${Se.moved} `});const nt=await Fn.getFileList();Ge(nt)}catch(Se){console.error(Se),B({type:"error",message:": "+(Se?.message||String(Se))})}finally{j(!1)}},Hs=async()=>{z(!0),H({total:0,done:0,current:""}),q(null);try{const Se=await Fn.adminClearAllNonAdminCsvs(Nt=>{H(Nt)}),nt=`: ${Se.totalDeleted} ${Se.results.length} `+(Se.failedUsers.length>0?` / ${Se.failedUsers.length} `:"");q({type:Se.failedUsers.length>0?"error":"success",message:nt,details:Se});const ft=await Fn.getFileList();Ge(ft)}catch(Se){console.error(Se),q({type:"error",message:": "+(Se?.message||String(Se))})}finally{z(!1)}},Fa=async Se=>{V(!0),Y(null);try{const nt=await Fn.adminClearTargetUserCsvs(Se,()=>{});Y({type:"success",message:`${nt.deleted} `});const ft=await Fn.getFileList();Ge(ft)}catch(nt){console.error(nt),Y({type:"error",message:": "+(nt?.message||String(nt))})}finally{V(!1),I(!1)}},oa=async()=>{X(!0),oe(null);try{const{data:Se,error:nt}=await Ae.functions.invoke("admin-clear-non-admin-ingredient-master",{body:{}});if(nt)throw nt;if(Se?.success){const ft=Se.deletedUnitConversions??0,Nt=Se.deletedCsvOverrides??0;oe({type:"success",message:`:  ${ft}  / CSV ${Nt} `})}else throw new Error(Se?.error||"")}catch(Se){console.error(Se),oe({type:"error",message:": "+(Se?.message||String(Se))})}finally{X(!1)}},Ir=async()=>{Kt(!0),Vt(null),Ct({total:0,done:0,current:""}),Wt(""),Ot(""),cn(!1),$t(!0);try{const Se=await gs.fetchAllProfiles();bt(Se||[])}catch(Se){console.error(Se),bt([]),Ot("")}finally{$t(!1)}},Si=()=>{Dt||(cn(!1),Kt(!1))},Va=async()=>{if(!(!gn||Dt)){zn(!0),Vt({type:"info",message:"..."}),Ct({total:0,done:0,current:""});try{const Se=await Fn.copyPriceFilesToUser({targetUserId:gn,onProgress:({total:Nt,done:fn,current:cr})=>{Ct({total:Nt||0,done:fn||0,current:cr||""})}}),nt=Se?.copied?.length??0,ft=Se?.failed?.length??0;Vt({type:ft>0?"error":"success",message:`: ${nt}${ft>0?` / : ${ft}`:""} `,failed:Se?.failed||[]})}catch(Se){console.error(Se),Vt({type:"error",message:`: ${String(Se?.message||Se)} `})}finally{zn(!1)}}},zs=async()=>{p(!0),v(null),g({phase:"start",message:"..."});try{const Se=await Fn.adminCopyCsvsToAllUsers(nt=>{g(ft=>({...ft,...nt}))});g({phase:"progress_master",message:"..."}),await Ln.adminCopyMasterToAllUsers(),g({phase:"done",message:""}),v({totalTargetUsers:Se.totalTargetUsers,csvResults:Se.results,masterSuccess:!0})}catch(Se){console.error(Se),g({phase:"error",message:`: ${Se.message}`})}finally{p(!1)}};return r.jsxs("div",{className:["dashboard-container","fade-in",o==="ingredients"||o==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[r.jsxs("div",{className:"dashboard-header",children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),a?.role==="admin"&&r.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[o==="csv-import"&&r.jsx(ce,{variant:"secondary",onClick:()=>s({view:"inventory"}),title:"",children:" "}),r.jsx(ce,{variant:"ghost",onClick:e,children:" "})]})]}),r.jsx("div",{className:"tabs-container",children:r.jsxs("div",{className:"tabs",children:[r.jsx("button",{className:`tab ${o==="price"?"active":""} `,onClick:()=>c("price"),children:" "}),r.jsx("button",{className:`tab ${o==="ingredients"?"active":""} `,onClick:()=>c("ingredients"),children:" "}),r.jsx("button",{className:`tab ${o==="csv-import"?"active":""} `,onClick:()=>c("csv-import"),children:" CSV"}),r.jsx("button",{className:`tab ${o==="duplicates"?"active":""} `,onClick:()=>c("duplicates"),children:" "}),r.jsx("button",{className:`tab ${o==="trash"?"active":""} `,onClick:()=>c("trash"),children:" "}),a?.role==="admin"&&r.jsx("button",{className:`tab ${o==="backup-management"?"active":""} `,onClick:()=>c("backup-management"),children:" "})]})}),a?.role==="admin"&&o==="price"&&r.jsxs("div",{className:"voice-feature-card",children:[r.jsxs("div",{className:"voice-feature-card__left",children:[r.jsx("div",{className:"voice-feature-card__title",children:" Avalon API"}),r.jsx("div",{className:"voice-feature-card__desc",children:"ON/OFF"})]}),r.jsxs("div",{className:"voice-feature-card__right",children:[r.jsxs("label",{className:`voice-feature-switch ${Vn?"is-on":""}`,children:[r.jsx("input",{type:"checkbox",checked:Vn,onChange:Se=>ct(Se.target.checked),disabled:Ft||xn}),r.jsx("span",{className:"voice-feature-switch__slider"})]}),r.jsx("div",{className:"voice-feature-card__state",children:Ft?"...":Vn?": ":": "})]}),Cn.message&&r.jsx("div",{className:`status-msg ${Cn.type||"info"} `,style:{marginTop:"10px",width:"100%"},children:Cn.message})]}),o==="ingredients"?r.jsx(U2,{}):o==="csv-import"?r.jsx(P2,{}):o==="trash"?r.jsx(q2,{}):o==="backup-management"?r.jsx(K2,{}):o==="duplicates"?r.jsxs("div",{className:"dashboard-content",children:[r.jsxs("aside",{className:"dashboard-sidebar",children:[r.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," ",r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[ke.length.toLocaleString(),""]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[r.jsx(zt,{placeholder:"...",value:We,onChange:Se=>ae(Se.target.value),style:{flex:1,fontSize:"0.9rem"}}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:Zt,disabled:Tn,title:"",children:""})]}),r.jsx("div",{className:"dup-list",children:Tn?r.jsx("div",{className:"dup-empty",children:"..."}):ke.length===0?r.jsx("div",{className:"dup-empty",children:"2"}):ke.filter(Se=>{const nt=String(We||"").trim();return nt?String(Se?.name||"").includes(nt):!0}).map(Se=>{const nt=Se.key===je,ft=Se.minPrice!==null&&Se.maxPrice!==null&&Se.minPrice!==Se.maxPrice;return r.jsxs("button",{type:"button",className:`dup-item ${nt?"active":""} `,onClick:()=>Oe(Se.key),children:[r.jsxs("div",{className:"dup-item-top",children:[r.jsx("div",{className:"dup-item-name",title:Se.name,children:Se.name}),ft&&r.jsx("span",{className:"dup-badge",children:""})]}),r.jsxs("div",{className:"dup-item-meta",children:[r.jsxs("span",{children:[": ",Se.lastDate||"-"]}),r.jsxs("span",{children:[": ",Se.rows,""]}),r.jsxs("span",{children:[": ",Se.dates,""]})]}),r.jsxs("div",{className:"dup-item-meta",children:[r.jsxs("span",{children:[Se.lastPrice!==null?`${Math.round(Se.lastPrice).toLocaleString()} `:"-",Se.unit?` / ${Se.unit} `:""]}),r.jsxs("span",{children:[": ",Se.lastIncomingQty!==null?Math.round(Se.lastIncomingQty).toLocaleString():"-"]}),Se.vendor?r.jsxs("span",{title:Se.vendor,children:[": ",Se.vendor]}):r.jsx("span",{children:": -"})]}),Se.nameVariants>1&&r.jsxs("div",{className:"dup-item-note",children:[": ",Se.nameVariants,""]})]},Se.key)})})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsx("div",{className:"sidebar-title",children:" "}),r.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),r.jsxs("main",{className:"dashboard-main",children:[r.jsxs("div",{className:"main-toolbar",children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:je?"":""})}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsxs("select",{value:he,onChange:Se=>pe(Se.target.value),disabled:!je,title:je?"":"",className:"dup-month-select",children:[r.jsx("option",{value:"",children:""}),Ne.map(Se=>r.jsx("option",{value:Se,children:Se.replace("-","/")},Se))]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:Zt,disabled:Tn,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",children:(()=>{if(!je)return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const Se=dn.get(je)||[],nt=new Set,ft=[];Se.forEach(Ut=>{const Wn=[String(Ut?.dateStr||""),String(Ut?.price??""),String(Ut?.incomingQty??""),String(Ut?.unit||""),String(Ut?.vendor||""),String(Ut?.displayName||""),String(Ut?.sourceFile||"")].join("|");nt.has(Wn)||(nt.add(Wn),ft.push(Ut))}),ft.sort((Ut,Wn)=>String(Ut?.dateStr||"").localeCompare(String(Wn?.dateStr||"")));const Nt=he?ft.filter(Ut=>qx(Ut?.dateStr)===he):ft,fn=Nt.map((Ut,Wn)=>{const bn=Wn>0?Nt[Wn-1]:null,Bn=bn?Number(bn?.price):NaN,rs=Number(Ut?.price);let Mr=null,nn=null;return Number.isFinite(Bn)&&Number.isFinite(rs)&&(Mr=rs-Bn,nn=Bn!==0?Mr/Bn*100:null),{...Ut,_diff:Mr,_pct:nn}}),cr=Nt.reduce((Ut,Wn)=>{const bn=Number(Wn?.incomingQty);return Ut+(Number.isFinite(bn)?bn:0)},0),ln=Nt.reduce((Ut,Wn)=>{const bn=Number(Wn?.incomingQty),Bn=Number(Wn?.price);return!Number.isFinite(bn)||!Number.isFinite(Bn)?Ut:Ut+bn*Bn},0),wn=[...fn].reverse();return r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"120px"},children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:"CSV"}),r.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),r.jsx("tbody",{children:wn.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"no-data",children:he?`${he}`:""})}):wn.map((Ut,Wn)=>{const bn=Ut?._diff,Bn=Ut?._pct,rs=bn==null||!Number.isFinite(bn)?"-":`${bn>=0?"+":""}${Math.round(bn).toLocaleString()} `,Mr=Bn==null||!Number.isFinite(Bn)?"":` (${Bn>=0?"+":""}${Bn.toFixed(1)} %)`,nn=bn==null||!Number.isFinite(bn)?"#888":bn>0?"#c92a2a":bn<0?"#2b8a3e":"#666",Zn=Number(Ut?.price),Tr=Number.isFinite(Zn)?`${Math.round(Zn).toLocaleString()} `:"-",J=Number(Ut?.incomingQty),xe=Number.isFinite(J)?Math.round(J).toLocaleString():"-",be=Number.isFinite(J)&&Number.isFinite(Zn)?J*Zn:NaN,Me=Number.isFinite(be)?`${Math.round(be).toLocaleString()} `:"-";return r.jsxs("tr",{children:[r.jsx("td",{className:"col-date",children:Ut?.dateStr||"-"}),r.jsx("td",{children:Ut?.vendor||"-"}),r.jsx("td",{style:{fontWeight:500},children:Ut?.displayName||"-"}),r.jsx("td",{className:"col-number",children:xe}),r.jsxs("td",{className:"col-number",children:[Tr,Ut?.unit&&r.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",Ut.unit]})]}),r.jsx("td",{className:"col-number",children:Me}),r.jsxs("td",{className:"col-number",style:{color:nn},children:[rs,Mr]})]},`${Ut?.dateStr||"d"} -${Wn} `)})}),wn.length>0&&r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",he?`${he}`:""]}),r.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(cr).toLocaleString()}),r.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),r.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(ln).toLocaleString()]}),r.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):r.jsxs("div",{className:"dashboard-content",children:[r.jsxs("aside",{className:"dashboard-sidebar",children:[r.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[r.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),r.jsx(ce,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const Se=await Ze(()=>Promise.resolve().then(()=>op),void 0).then(fn=>fn.recipeService.exportAllRecipes(a)),nt=new Blob([JSON.stringify(Se,null,2)],{type:"application/json"}),ft=URL.createObjectURL(nt),Nt=document.createElement("a");Nt.href=ft,Nt.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Nt),Nt.click(),document.body.removeChild(Nt),URL.revokeObjectURL(ft)}catch(Se){le({type:"error",message:""}),console.error(Se)}},children:" JSON"})]}),r.jsxs("div",{children:[r.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),r.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:Se=>{const nt=Se.target.files?.[0];nt&&qa(nt)}}),r.jsx(ce,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:de||Ke,children:" "}),ee.message&&r.jsx("div",{className:`status-msg ${ee.type} `,style:{marginTop:"10px"},children:ee.message})]})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," "]}),r.jsxs("div",{className:`upload-area upload-area--dropzone ${ne?"upload-area--dragging":""} `,onDragEnter:zr,onDragOver:Gr,onDragLeave:mr,onDropCapture:Ls,onDrop:Ls,children:[r.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",r.jsx("br",{}),r.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",r.jsx("br",{})," 2: "]})]}),r.jsx("div",{className:"upload-drop-hint",children:ne?"":"CSV"}),r.jsx("input",{type:"file",accept:".csv",onChange:Nr,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),Ce&&r.jsxs("div",{className:"upload-selected-file",title:Ce.name,children:[": ",Ce.name]}),r.jsx(ce,{variant:"primary",onClick:Fs,disabled:!Ce||de,className:"upload-btn",size:"sm",block:!0,children:de?"...":""})]}),ge.message&&r.jsx("div",{className:`status-msg ${ge.type} `,children:ge.message})]}),a?.role==="admin"&&r.jsxs("div",{className:"sidebar-card",children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),r.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",Tt.length,""]}),r.jsx("div",{style:{marginTop:"0.75rem"},children:r.jsx(ce,{variant:"secondary",size:"sm",block:!0,onClick:Ir,disabled:Dt||de,title:"",children:""})})]}),r.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," ",r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Tt.length,""]})]}),Tt.length===0?r.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):r.jsx("div",{className:"file-list",children:Tt.map(Se=>r.jsxs("div",{className:"file-list-item",children:[r.jsx("span",{className:"file-name",title:Se.name,children:Se.name}),r.jsx(ce,{variant:"danger",size:"sm",onClick:()=>wi(Se.name),disabled:de,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},Se.name))})]}),r.jsxs("div",{className:"sidebar-card",style:{borderLeft:"4px solid #ef4444"},children:[r.jsx("div",{className:"sidebar-title",style:{color:"#ef4444"},children:" "}),r.jsx("p",{style:{fontSize:"0.8rem",color:"#666",margin:"0 0 10px"},children:"CSV"}),R&&r.jsx("div",{className:`status-msg ${R.type} `,style:{marginBottom:"8px",fontSize:"0.82rem"},children:R.message}),r.jsx(ce,{variant:"danger",onClick:()=>w(!0),disabled:_||Tt.length===0,style:{width:"100%"},children:" "}),a?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsx("hr",{style:{margin:"12px 0",border:"none",borderTop:"1px solid #fecaca"}}),r.jsxs("div",{style:{marginBottom:"16px",padding:"12px",background:"#ecfdf5",borderRadius:"8px",border:"1px solid #6ee7b7"},children:[r.jsx("div",{className:"sidebar-title",style:{color:"#047857",marginBottom:"8px",fontSize:"0.9rem"},children:" "}),r.jsx("p",{style:{fontSize:"0.8rem",color:"#065f46",marginBottom:"12px",lineHeight:1.4},children:""}),r.jsx(ce,{variant:"primary",onClick:()=>h(!0),style:{width:"100%",background:"#059669",borderColor:"#047857"},children:" "})]}),r.jsx("p",{style:{fontSize:"0.8rem",color:"#666",margin:"0 0 8px"},children:" "}),O&&r.jsx("div",{className:`status-msg ${O.type} `,style:{marginBottom:"8px",fontSize:"0.82rem"},children:O.message}),G&&r.jsx("div",{className:`status-msg ${G.type} `,style:{marginBottom:"8px",fontSize:"0.82rem"},children:G.message}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[r.jsx(ce,{variant:"danger",onClick:()=>I(!0),disabled:M||L,style:{width:"100%",background:"#b91c1c"},children:" "}),r.jsx(ce,{variant:"danger",onClick:()=>$(!0),disabled:M||L,style:{width:"100%",background:"#7f1d1d"},children:" "})]}),r.jsx("p",{style:{fontSize:"0.8rem",color:"#666",margin:"12px 0 8px"},children:" CSV"}),se&&r.jsx("div",{className:`status-msg ${se.type} `,style:{marginBottom:"8px",fontSize:"0.82rem"},children:se.message}),r.jsx(ce,{variant:"danger",onClick:()=>A(!0),disabled:U,style:{width:"100%",background:"#7f1d1d"},children:" "})]})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsx("div",{className:"sidebar-title",children:" "}),r.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:" "}),r.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),r.jsxs("main",{className:"dashboard-main",children:[r.jsxs("div",{className:"main-toolbar",children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),r.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",Mt.length.toLocaleString()," "]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsx(zt,{placeholder:" (, , )...",value:et,onChange:Se=>Xe(Se.target.value),style:{width:"250px",fontSize:"0.9rem"}}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:In,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",children:Q?r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsxs("th",{onClick:()=>lt("dateStr"),style:{width:"120px"},children:[" ",Be.key==="dateStr"&&(Be.direction==="asc"?"":"")]}),r.jsxs("th",{onClick:()=>lt("vendor"),children:[" ",Be.key==="vendor"&&(Be.direction==="asc"?"":"")]}),r.jsxs("th",{onClick:()=>lt("name"),children:[" ",Be.key==="name"&&(Be.direction==="asc"?"":"")]}),r.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),r.jsx("tbody",{children:Mt.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"4",className:"no-data",children:""})}):Mt.map((Se,nt)=>r.jsxs("tr",{children:[r.jsx("td",{className:"col-date",children:Se.dateStr||"-"}),r.jsx("td",{children:Se.vendor||"-"}),r.jsx("td",{style:{fontWeight:"500"},children:Se.name}),r.jsxs("td",{className:"col-number",children:[Se.price?Se.price.toLocaleString():"-",Se.unit&&r.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",Se.unit]})]})]},nt))})]})})]})]}),r.jsx(an,{isOpen:Re,onClose:Vs,title:" / ",size:"medium",showCloseButton:!Ke,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:ye?.name||"-"})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:Vs,disabled:Ke,children:""}),r.jsx(ce,{variant:"primary",onClick:sl,disabled:!ye||Ke,children:Ke?"...":""})]}),Ke&&r.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),ee.message&&r.jsx("div",{className:`status-msg ${ee.type||"info"} `,style:{whiteSpace:"pre-wrap"},children:ee.message})]})}),r.jsx(an,{isOpen:Et,onClose:Si,title:"",size:"medium",showCloseButton:!Dt,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",r.jsx("br",{}),r.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",r.jsx("code",{children:"_copy"})," "]})]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",r.jsx("strong",{style:{color:"#111827"},children:a?.displayId||""})," / : ",Tt.length,""]}),qt?r.jsxs(r.Fragment,{children:[(()=>{const Se=dt.find(ft=>String(ft?.id)===String(gn)),nt=Se?`${Se.display_id}${Se.email?` (${Se.email})`:""} `:gn?String(gn).slice(0,8):"-";return r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",r.jsx("strong",{children:nt}),r.jsx("br",{}),": ",r.jsx("strong",{children:Tt.length.toLocaleString()})," CSV",r.jsx("br",{}),": ",r.jsx("code",{children:"_copy"})," "]})]})})(),ht?r.jsxs("div",{style:{marginTop:"16px",borderTop:"1px solid #e5e7eb",paddingTop:"16px"},children:[r.jsx("div",{style:{marginBottom:"16px",color:"#374151",fontSize:"0.95rem",fontWeight:500},children:ht.type==="success"?"":""}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:Si,children:""}),r.jsx(ce,{variant:"primary",onClick:()=>{Vt(null),cn(!1),Wt("")},children:""})]})]}):r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>cn(!1),disabled:Dt,children:""}),r.jsx(ce,{variant:"primary",onClick:Va,disabled:!gn||Dt,children:Dt?"...":""})]}),Dt&&r.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:hn.total?`${hn.done} / ${hn.total}`:"..."})]})]}),r.jsx("div",{className:"bulk-progress-bar",children:r.jsx("div",{className:"bulk-progress-bar-inner",style:{width:hn.total?`${Math.round(hn.done/hn.total*100)}%`:"0%"}})}),r.jsx("div",{className:"bulk-progress-current",title:hn.current,children:hn.current})]}),ht?.message&&r.jsx("div",{className:`status-msg ${ht.type||"info"}`,children:ht.message}),Array.isArray(ht?.failed)&&ht.failed.length>0&&r.jsxs("div",{className:"bulk-progress-failures",children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",ht.failed.length,""]}),r.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:ht.failed.slice(0,10).map((Se,nt)=>r.jsxs("li",{children:[Se?.file||"-",": ",Se?.errorMessage||"unknown error"]},`${Se?.file||"f"}-${nt}`))}),ht.failed.length>10&&r.jsxs("div",{style:{marginTop:"6px"},children:["... ",ht.failed.length-10,""]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),mt?r.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):r.jsxs("select",{value:gn,onChange:Se=>Wt(Se.target.value),disabled:Dt||!!on,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:Dt?"#f3f4f6":"white"},children:[r.jsx("option",{value:"",children:"..."}),dt.filter(Se=>String(Se?.id)&&String(Se?.id)!==String(a?.id)).map(Se=>r.jsxs("option",{value:Se.id,children:[Se.display_id,Se.email?` (${Se.email})`:"",Se.role==="admin"?" []":""]},Se.id))]}),on&&r.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:on})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(ce,{variant:"ghost",onClick:Si,disabled:Dt,children:""}),r.jsx(ce,{variant:"primary",onClick:()=>cn(!0),disabled:!gn||Dt||mt||!!on,children:""})]})]})]})}),ie&&r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>re(null),children:r.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:Se=>Se.stopPropagation(),children:[r.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),r.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:ie.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>re(null),children:""}),r.jsx(ce,{variant:"danger",onClick:()=>{ie.onConfirm(),re(null)},children:""})]})]})}),r.jsx(Ho,{isOpen:S,onClose:()=>{_||(w(!1),B(null))},onConfirm:async()=>{await Ar(),w(!1)},title:"",description:r.jsxs("span",{children:["CSV",r.jsxs("strong",{children:[Tt.length,""]}),"",r.jsx("br",{}),""]}),loading:_,loadingNode:E.current?r.jsxs("span",{children:["... ",r.jsx("strong",{children:E.current})]}):"..."}),r.jsx(Ho,{isOpen:F,onClose:()=>{M||($(!1),q(null))},onConfirm:async()=>{await Hs(),$(!1)},title:"",description:r.jsxs("span",{children:[r.jsx("strong",{style:{color:"#b91c1c"},children:"admin"}),"CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:M,loadingNode:r.jsxs("span",{children:[" (",P.done,"/",P.total,")... ",P.current&&r.jsx("strong",{children:P.current})]})}),r.jsx(Ho,{isOpen:Z,onClose:()=>{U||(A(!1),oe(null))},onConfirm:async()=>{await oa(),A(!1)},title:"",description:r.jsxs("span",{children:[r.jsx("strong",{style:{color:"#b91c1c"},children:"admin"}),"CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:U,loadingNode:"..."}),r.jsx(N_,{isOpen:C,onClose:()=>{L||(I(!1),Y(null))},onConfirm:Fa,title:"",description:r.jsxs("span",{children:["CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:L,loadingNode:"..."}),r.jsx(F2,{isOpen:u,onClose:()=>{h(!1),g(null),v(null)},onConfirm:zs,loading:f,progressStatus:m,copyResult:x})]})},Y2=({recipes:e,recentIds:t,onSelect:s})=>{if(!t||t.length===0)return null;const a=t.map(o=>e.find(c=>c.id===o)).filter(Boolean).slice(0,7);return a.length===0?null:r.jsxs("div",{className:"recent-recipes",children:[r.jsx("h3",{className:"recent-header",children:""}),r.jsx("div",{className:"recent-list",children:a.map(o=>r.jsxs("div",{className:"recent-item",onClick:()=>s(o),children:[r.jsx("div",{className:"recent-thumbnail",children:o.image?r.jsx("img",{src:o.image,alt:o.title}):r.jsx("div",{className:"recent-placeholder"})}),r.jsx("div",{className:"recent-info",children:r.jsx("div",{className:"recent-title",children:o.title})})]},o.id))})]})},Q2=({onBack:e})=>(k.useEffect(()=>{window.scrollTo(0,0)},[]),r.jsxs("div",{className:"levain-guide-container",children:[r.jsxs("header",{className:"levain-guide-header",children:[r.jsx("h1",{children:"LEVAIN GUIDE"}),r.jsx("p",{className:"subtitle",children:" "}),r.jsx("p",{className:"subtitle",children:""}),r.jsx("div",{className:"divider"})]}),r.jsxs("main",{className:"levain-guide-main",children:[r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("p",{children:"Levain"}),r.jsx("h3",{children:""}),r.jsx("p",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",r.jsx("br",{}),r.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",r.jsx("br",{}),r.jsx("strong",{children:""})," Acetobacter aceti "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:["",r.jsx("br",{}),r.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",r.jsx("br",{}),"(   +  + )"]}),"",r.jsx("br",{}),r.jsxs("div",{className:"formula",children:["CHO  2CHO",r.jsx("br",{}),"(  )"]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"- 7-10"}),r.jsxs("div",{className:"timeline",children:[r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),r.jsx("p",{children:"100g + 100ml 20-22"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),r.jsx("p",{children:"50%50g + 50ml "}),r.jsx("p",{children:"100g  50g50g + 50ml"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),r.jsx("p",{children:"50%50g + 50ml "}),r.jsxs("div",{className:"success-box",children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),r.jsx("p",{children:"1150%1:1"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," 15",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," pH 3.5-4.0"]})]})]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"(g)"}),r.jsx("th",{children:"(ml)"}),r.jsx("th",{children:"(g)"}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"0"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"2"}),r.jsx("td",{children:"1"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"0"}),r.jsx("td",{children:""})]})]})]})})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"5-8"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"2-4"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"15-18"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"1-2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"20-22"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"3-5"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"25-28"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"2-3"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"30"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"1-2"})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"1"}),r.jsx("br",{}),"100g50g + 50ml"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"8-12"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),""]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"2%100ml2g"}),r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"2"}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 12 8:00"}),r.jsx("br",{}),"50g25g + 25ml "]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 1  14:00"}),r.jsx("br",{}),"25g + 25ml 2"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 1  20:00"}),r.jsx("br",{}),""]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:" "})," ",r.jsx("br",{}),"",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:" "})," pH",r.jsx("br",{}),"pH 3.5-4.0pH"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"18"}),r.jsx("td",{children:"16-24"}),r.jsx("td",{children:"1"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"20-22"}),r.jsx("td",{children:"12-16"}),r.jsx("td",{children:"2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"24-26"}),r.jsx("td",{children:"8-12"}),r.jsx("td",{children:"2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"28"}),r.jsx("td",{children:"4-8"}),r.jsx("td",{children:"2"})]})]})]})})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"1"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. 22",r.jsx("br",{}),"2. 12",r.jsx("br",{}),"3. 1",r.jsx("br",{}),"4. 1-2"]}),r.jsx("h3",{children:"2"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," pH",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," "]}),r.jsx("h3",{children:"3"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. 15",r.jsx("br",{}),"3. 80%"]}),r.jsx("h3",{children:"4"}),r.jsxs("div",{className:"success-box",children:["",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," "]}),r.jsx("h3",{children:"5"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. 1:0.8",r.jsx("br",{}),"2. ",r.jsx("br",{}),"3. "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"pH"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"pH4-8.0"}),r.jsx("br",{}),r.jsx("br",{})," pH 7.0",r.jsx("br",{})," pH 4.5-5.5",r.jsx("br",{})," pH 3.5-4.0",r.jsx("br",{})," pH 3.0"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:[r.jsx("strong",{children:"pH 3.8-4.0"})," ",r.jsx("br",{}),r.jsx("strong",{children:"pH 3.5"})," ",r.jsx("br",{}),r.jsx("strong",{children:"pH 4.5"})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," 1",r.jsx("br",{})," ",r.jsx("br",{})," -203"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"15-20"}),r.jsx("td",{children:"18-20"}),r.jsx("td",{children:"1-2"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"25+"}),r.jsx("td",{children:"22-24"}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"18-22"}),r.jsx("td",{children:"20-22"}),r.jsx("td",{children:"1-2"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"5-15"}),r.jsx("td",{children:"18"}),r.jsx("td",{children:"2-3"}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," 24",r.jsx("br",{})," ",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," 18",r.jsx("br",{})," "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"100g + 50g + 150ml 12-24",r.jsx("br",{}),"11-2"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"100ml"}),r.jsx("br",{})," 110 to 110 CFU/ml",r.jsx("br",{})," 110 to 110 CFU/ml",r.jsx("br",{})," pH3.5-4.0",r.jsx("br",{})," 0.5-1.5%",r.jsx("br",{})," 0.3-0.8%"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"15-25% ()"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"5-15%"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"20-30%"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"30-50%"}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"formula",children:[" 18   - 8",r.jsx("br",{}),r.jsx("br",{}),"",r.jsx("br",{})," 2018  (20-8) = 1.5",r.jsx("br",{})," 2418  (24-8) = 1.125",r.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),r.jsxs("footer",{className:"levain-footer",children:[r.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),r.jsx("p",{children:""})]}),r.jsxs("button",{className:"levain-back-button",onClick:e,children:[r.jsx("span",{children:""})," "]})]})),Cp=480,J2=({onBack:e})=>{const{user:t,patchCurrentUserProfile:s}=xs(),[a,o]=k.useState([]),[c,u]=k.useState(!0),[h,f]=k.useState(null),[p,m]=k.useState(!1),g=k.useRef(null),[x,v]=k.useState(null),[S,w]=k.useState(""),[_,j]=k.useState(""),[E,T]=k.useState(""),[R,B]=k.useState(""),[F,$]=k.useState(!1),[M,z]=k.useState(!1),[P,H]=k.useState(new Set),[O,q]=k.useState(null),[C,I]=k.useState([]),[L,V]=k.useState(!1),[G,Y]=k.useState(null),[Z,A]=k.useState(!1),U=de=>de?.email==="pingus0428@gmail.com",X=Ue.useCallback(async()=>{try{u(!0);const de=await gs.fetchAllProfiles();o(de)}catch(de){console.error(de),f("")}finally{u(!1)}},[]);k.useEffect(()=>{X()},[X]),k.useEffect(()=>{const de=g.current;if(!de)return;if(!(typeof window<"u"&&typeof window.ResizeObserver<"u")){m(de.getBoundingClientRect().width<Cp);return}const ve=new window.ResizeObserver(fe=>{for(const Q of fe){const K=Q.contentRect.width;m(K<Cp)}});return ve.observe(de),m(de.getBoundingClientRect().width<Cp),()=>ve.disconnect()},[]);const se=a.filter(de=>de.role==="admin"),oe=a.filter(de=>de.role!=="admin"),Ce=(de,N)=>{H(ve=>{const fe=new Set(ve);return N?fe.add(de):fe.delete(de),fe})},ue=async(de,N)=>{const ve=!!de.show_master_recipes;f(null),o(fe=>fe.map(Q=>Q.id===de.id?{...Q,show_master_recipes:N}:Q)),de.id===t?.id&&s?.({showMasterRecipes:N}),Ce(de.id,!0);try{const Q=!!(await gs.updateProfile(de.id,{show_master_recipes:N}))?.show_master_recipes;o(K=>K.map(ie=>ie.id===de.id?{...ie,show_master_recipes:Q}:ie)),de.id===t?.id&&s?.({showMasterRecipes:Q})}catch(fe){console.error(fe),o(Q=>Q.map(K=>K.id===de.id?{...K,show_master_recipes:ve}:K)),de.id===t?.id&&s?.({showMasterRecipes:ve}),f("RLS")}finally{Ce(de.id,!1)}},ne=async de=>{q(de),V(!0),f("");try{const N=await gs.adminGetLoginLogs(de.id);I(N)}catch(N){console.error(N),f("")}finally{V(!1)}},we=async(de,N)=>{f(null);try{await gs.adminSetRole(de.id,N),o(ve=>ve.map(fe=>fe.id===de.id?{...fe,role:N}:fe))}catch(ve){console.error(ve),f("")}},Le=async()=>{if(G){A(!0),f(null);try{await gs.adminDeleteUser(G.id),o(de=>de.filter(N=>N.id!==G.id)),Y(null)}catch(de){console.error(de),f("")}finally{A(!1)}}},ge=de=>{if(!de)return{text:"",color:"#666666",bg:"#f0f0f0"};const N=(Date.now()-new Date(de).getTime())/(1e3*60*60);return N<24?{text:"24h",color:"#ff2d55",bg:"#ffe5e9"}:N<72?{text:"3",color:"#ff9500",bg:"#fff0d4"}:N<168?{text:"1",color:"#34c759",bg:"#e5f9e7"}:N<720?{text:"1",color:"#007aff",bg:"#e5f1ff"}:null},Te=({user:de,isAdmin:N,isSuperAdmin:ve,currentUser:fe,handleRoleChange:Q,savingMasterTargets:K,handleToggleMasterRecipeVisibility:ie,handleOpenLoginLogs:re,setResetTarget:ee,setResetPw1:le,setResetPw2:ye,setResetError:qe,setResetSuccess:Re,setDeleteTarget:$e})=>{const Ke=ge(de.last_sign_in_at),Ye=!ve(de)&&fe?.id!==de.id;return r.jsxs(vn,{className:"user-management__card",children:[r.jsxs("div",{className:"user-management__card-left",children:[r.jsxs("div",{className:"user-management__identity-row",children:[r.jsx("span",{className:"user-management__display-id",children:Ts(de.display_id)}),N&&r.jsx("span",{className:"user-management__role-badge",children:""}),Ke&&r.jsx("span",{className:"user-management__login-badge",style:{backgroundColor:Ke.bg,color:Ke.color,borderColor:Ke.color},children:Ke.text})]}),de.email&&r.jsx("div",{className:"user-management__email",children:de.email}),r.jsxs("div",{className:"user-management__meta",children:[": ",new Date(de.created_at).toLocaleString()]}),r.jsxs("div",{className:"user-management__meta",children:[": ",de.updated_at?new Date(de.updated_at).toLocaleString():"---"]}),r.jsxs("div",{className:"user-management__meta",children:[": ",de.last_sign_in_at?new Date(de.last_sign_in_at).toLocaleString():""]})]}),r.jsxs("div",{className:"user-management__card-right",children:[Ye&&r.jsxs("div",{className:"user-management__role-toggle-wrap",children:[r.jsx("button",{type:"button",className:`user-management__role-toggle-btn ${de.role!=="admin"?"user-management__role-toggle-btn--active":""}`,onClick:()=>Q(de,"user"),disabled:de.role!=="admin",children:""}),r.jsx("button",{type:"button",className:`user-management__role-toggle-btn user-management__role-toggle-btn--admin ${de.role==="admin"?"user-management__role-toggle-btn--active":""}`,onClick:()=>Q(de,"admin"),disabled:de.role==="admin",children:""})]}),r.jsxs("div",{className:"user-management__card-actions-row",children:[!ve(de)&&r.jsxs("label",{className:"user-management__master-toggle",children:[r.jsx("input",{type:"checkbox",checked:de.show_master_recipes||!1,disabled:K.has(de.id),onChange:Et=>ie(de,Et.target.checked)}),""]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>re(de),className:"user-management__action-btn",children:""}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>{ee({id:de.id,display_id:de.display_id,email:de.email}),le(""),ye(""),qe(""),Re("")},className:"user-management__action-btn",children:""}),!ve(de)&&fe?.id!==de.id&&r.jsx(ce,{variant:"danger",size:"sm",onClick:()=>$e(de),className:"user-management__action-btn",children:""})]})]})]},de.id)};return r.jsx("div",{className:`user-management${p?" user-management--narrow":""}`,children:r.jsxs("div",{ref:g,className:"user-management__inner",children:[r.jsxs("div",{className:"user-management__header",children:[r.jsx("h2",{children:""}),r.jsx(ce,{variant:"ghost",onClick:e,children:""})]}),h&&r.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:h}),c?r.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):r.jsxs("div",{className:"user-management__content",children:[se.length>0&&r.jsxs("div",{children:[r.jsx("h3",{className:"user-management__section-title user-management__section-title--admin",children:""}),r.jsx("div",{className:"user-management__list",children:se.map(de=>r.jsx(Te,{user:de,isAdmin:!0,isSuperAdmin:U,currentUser:t,handleRoleChange:we,savingMasterTargets:P,handleToggleMasterRecipeVisibility:ue,handleOpenLoginLogs:ne,setResetTarget:v,setResetPw1:w,setResetPw2:j,setResetError:T,setResetSuccess:B,setDeleteTarget:Y},de.id))})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"user-management__section-title user-management__section-title--default",children:""}),r.jsx("div",{className:"user-management__list",children:oe.length>0?oe.map(de=>r.jsx(Te,{user:de,isAdmin:!1,isSuperAdmin:U,currentUser:t,handleRoleChange:we,savingMasterTargets:P,handleToggleMasterRecipeVisibility:ue,handleOpenLoginLogs:ne,setResetTarget:v,setResetPw1:w,setResetPw2:j,setResetError:T,setResetSuccess:B,setDeleteTarget:Y},de.id)):r.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),r.jsx(an,{isOpen:!!x,onClose:()=>{F||v(null)},title:": ",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",Ts(x?.display_id||x?.email||x?.id)]}),x?.email&&r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:x.email}),r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),E&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:E}),R&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:R}),r.jsxs("div",{style:{display:"grid",gap:"10px"},children:[r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),r.jsx("input",{type:"password",value:S,onChange:de=>w(de.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),r.jsx("input",{type:"password",value:_,onChange:de=>j(de.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>v(null),disabled:F,children:""}),r.jsx(ce,{variant:"secondary",isLoading:M,disabled:!x?.email||F,onClick:async()=>{if(T(""),B(""),!x?.email){T("");return}z(!0);try{await gs.sendPasswordResetEmail(x.email),B("")}catch(de){console.error(de),T(de?.message||"")}finally{z(!1)}},style:{whiteSpace:"nowrap"},children:""}),r.jsx(ce,{variant:"danger",isLoading:F,onClick:async()=>{if(T(""),B(""),!!x?.id){if(!S||S.length<8){T("8");return}if(S!==_){T("");return}$(!0);try{await gs.adminResetPassword(x.id,S),B(""),w(""),j("")}catch(de){console.error(de);const N=de?.message||"";/FunctionsHttpError|not found|404/i.test(N)||/admin-reset-password/i.test(N)?T(""):T(N)}finally{$(!1)}}},children:""})]})]})}),r.jsx(an,{isOpen:!!O,onClose:()=>q(null),title:"",size:"medium",children:r.jsxs("div",{style:{color:"var(--text-color)",lineHeight:1.5,minHeight:"300px",display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"16px",paddingBottom:"8px",borderBottom:"1px solid #ddd"},children:[": ",Ts(O?.display_id||O?.email||O?.id)]}),L?r.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:"#666"},children:"..."}):C.length>0?r.jsx("div",{style:{flex:1,overflowY:"auto",maxHeight:"400px"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsx("tr",{children:r.jsx("th",{style:{textAlign:"left",padding:"8px",borderBottom:"2px solid #ddd",backgroundColor:"#f5f5f5"},children:""})})}),r.jsx("tbody",{children:C.map((de,N)=>r.jsx("tr",{style:{borderBottom:"1px solid #eee"},children:r.jsx("td",{style:{padding:"8px"},children:new Date(de.login_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})},N))})]})}):r.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:["",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.85rem"},children:""})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"20px"},children:r.jsx(ce,{variant:"secondary",onClick:()=>q(null),children:""})})]})}),r.jsx(an,{isOpen:!!G,onClose:()=>{Z||Y(null)},title:"",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[r.jsx("div",{style:{marginBottom:"16px"},children:""}),r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",Ts(G?.display_id||G?.email||G?.id)]}),G?.email&&r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"20px",wordBreak:"break-all"},children:G.email}),r.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>Y(null),disabled:Z,children:""}),r.jsx(ce,{variant:"danger",isLoading:Z,onClick:Le,children:""})]})]})})]})})},$s="inventory_items",Ta="inventory_snapshots",Ql="deleted_inventory_snapshots",Ro=(e,t)=>{const s=String(e?.message||"");return String(e?.code||"")==="42703"?s.toLowerCase().includes(String(t).toLowerCase()):s.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&s.toLowerCase().includes("does not exist")},yr={getAll:async e=>{if(!e)return[];const{data:t,error:s}=await Ae.from($s).select("*").eq("user_id",e).order("created_at",{ascending:!0});return s?(console.error("Error fetching inventory:",s),[]):t||[]},add:async(e,t)=>{if(!e)throw new Error("User ID is required");const{id:s,isPhantom:a,_master:o,_csv:c,...u}=t,h=t?.tax10_override??t?.tax10Override,f=Object.prototype.hasOwnProperty.call(t||{},"tax10"),p=Object.prototype.hasOwnProperty.call(t||{},"tax10_override")||Object.prototype.hasOwnProperty.call(t||{},"tax10Override"),m=String(u?.name??"").trim(),g=String(u?.vendor??"").trim(),x={...u,name:m,vendor:g||null,user_id:e,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0};f&&(x.tax10=!!t.tax10),p&&(x.tax10_override=!!h);const v=async _=>Ae.from($s).insert([_]).select().single();let{data:S,error:w}=await v(x);if(w){const _=Ro(w,"tax10"),j=Ro(w,"tax10_override");if(_||j){const E={...x};_&&delete E.tax10,j&&delete E.tax10_override,{data:S,error:w}=await v(E)}}if(w&&String(w?.code||"")==="23505"){let _=Ae.from($s).select("*").eq("user_id",e).eq("name",m).order("updated_at",{ascending:!1}).order("id",{ascending:!1}).limit(1);g?_=_.eq("vendor",g):_=_.is("vendor",null);const{data:j,error:E}=await _;if(!E&&Array.isArray(j)&&j.length>0){const T=j[0];return await yr.update(e,{...T,...x,id:T.id})}}if(w)throw console.error("Error adding item:",w),w;return S},update:async(e,t)=>{if(!e)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:s,isPhantom:a,created_at:o,_master:c,_csv:u,...h}=t,f=t?.tax10_override??t?.tax10Override,p=Object.prototype.hasOwnProperty.call(t||{},"tax10"),m=Object.prototype.hasOwnProperty.call(t||{},"tax10_override")||Object.prototype.hasOwnProperty.call(t||{},"tax10Override"),g={...h,name:Object.prototype.hasOwnProperty.call(h||{},"name")?String(h.name??"").trim():h.name,vendor:Object.prototype.hasOwnProperty.call(h||{},"vendor")?String(h.vendor??"").trim()||null:h.vendor,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()};p&&(g.tax10=!!t.tax10),m&&(g.tax10_override=!!f);const x=async w=>Ae.from($s).update(w).eq("id",t.id).eq("user_id",e).select().single();let{data:v,error:S}=await x(g);if(S){const w=Ro(S,"tax10"),_=Ro(S,"tax10_override");if(w||_){const j={...g};w&&delete j.tax10,_&&delete j.tax10_override,{data:v,error:S}=await x(j)}}if(S)throw console.error("Error updating item:",S),S;return v},delete:async(e,t)=>{if(!e)throw new Error("User ID is required");const{error:s}=await Ae.from($s).delete().eq("id",t).eq("user_id",e);if(s)throw console.error("Error deleting item:",s),s},adjustStock:async(e,t,s)=>{if(!e)throw new Error("User ID is required");const{data:a,error:o}=await Ae.from($s).select("quantity").eq("id",t).eq("user_id",e).single();if(o||!a)throw new Error("Item not found");const c=Math.max(0,(a.quantity||0)+s),{data:u,error:h}=await Ae.from($s).update({quantity:c,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",e).select().single();if(h)throw h;return u},clearAll:async e=>{if(!e)throw new Error("User ID is required");const{error:t}=await Ae.from($s).delete().eq("user_id",e).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async e=>{if(!e)return new Set;const{data:t,error:s}=await Ae.from("ignored_items").select("name").eq("user_id",e);return s?(console.error("Error fetching ignored items:",s),new Set):new Set(t.map(a=>a.name))},ignoreItem:async(e,t)=>{if(!e)throw new Error("User ID is required");if(!t)return;const{error:s}=await Ae.from("ignored_items").insert([{user_id:e,name:t}]).select();if(s&&s.code!=="23505")throw console.error("Error ignoring item:",s),s},getSnapshots:async e=>{if(!e)return[];const{data:t,error:s}=await Ae.from(Ta).select("*").eq("user_id",e).order("snapshot_date",{ascending:!1});return s?(console.error("Error fetching snapshots:",s),[]):t||[]},getDeletedSnapshots:async e=>{if(!e)return[];const{data:t,error:s}=await Ae.from(Ql).select("*").eq("user_id",e).order("deleted_at",{ascending:!1});return s?(console.error("Error fetching deleted snapshots:",s),[]):t||[]},createSnapshot:async(e,t,s,a)=>{if(!e)throw new Error("User ID is required");let o=null,c=null;const u=await Ae.from(Ta).insert([{user_id:e,title:t,items:s,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();if(o=u.data??null,c=u.error??null,c&&Ro(c,"user_id")){const h=await Ae.from(Ta).insert([{title:t,items:s,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();o=h.data??null,c=h.error??null}if(c)throw console.error("Error creating snapshot:",c),c;return o},deleteSnapshotToTrash:async(e,t)=>{if(!e)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:s,error:a}=await Ae.from(Ta).select("*").eq("id",t).eq("user_id",e).single();if(a||!s)throw console.error("Error fetching snapshot for delete:",a),a||new Error("Snapshot not found");const{error:o}=await Ae.from(Ql).insert([{original_id:s.id,user_id:e,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at,deleted_at:new Date().toISOString()}]);if(o)throw console.error("Error moving snapshot to trash:",o),o;const{error:c}=await Ae.from(Ta).delete().eq("id",t).eq("user_id",e);if(c)throw console.error("Error deleting snapshot from main table:",c),c;return!0},restoreSnapshotFromTrash:async(e,t)=>{if(!e)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:s,error:a}=await Ae.from(Ql).select("*").eq("id",t).eq("user_id",e).single();if(a||!s)throw console.error("Error fetching deleted snapshot:",a),a||new Error("Deleted snapshot not found");let o=null;{const{error:u}=await Ae.from(Ta).insert([{id:s.original_id,user_id:e,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);o=u}if(o){const{error:u}=await Ae.from(Ta).insert([{user_id:e,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);if(u)throw console.error("Error restoring snapshot (fallback) :",u),u}const{error:c}=await Ae.from(Ql).delete().eq("id",t).eq("user_id",e);if(c)throw console.error("Error removing restored snapshot from trash:",c),c;return!0},hardDeleteSnapshotFromTrash:async(e,t)=>{if(!e)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:s}=await Ae.from(Ql).delete().eq("id",t).eq("user_id",e);if(s)throw console.error("Error hard deleting snapshot from trash:",s),s;return!0},resetStockQuantities:async e=>{if(!e)throw new Error("User ID is required");const t=await Ae.from($s).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",e).not("id","is",null);if(t.error){if(Ro(t.error,"user_id")){const s=await Ae.from($s).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(s.error)throw console.error("Error resetting quantities (fallback):",s.error),s.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},La=e=>{const t=String(e??"").trim();if(!t)return"";const s=t.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s===""?"cl":s},X2=(e,t)=>{const s=La(e),a=La(t);if(!s||!a)return null;if(s===a)return 1;if(s==="kg"&&a==="g")return 1e3;if(s==="g"&&a==="kg")return 1/1e3;const o=s==="cc"?"ml":s,c=a==="cc"?"ml":a;return o==="l"&&c==="ml"?1e3:o==="ml"&&c==="l"?1/1e3:o==="cl"&&c==="ml"?10:o==="ml"&&c==="cl"?1/10:null},Z2=e=>{const t=String(e??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},Jl=e=>{if(!Number.isFinite(e))return"-";const t=Math.round(e*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},eA=({index:e,item:t,isLowStock:s,onUpdateQuantity:a,onDelete:o,onToggleTax:c,onEdit:u,onRequestUnitSync:h})=>{const[f,p]=Ue.useState(t.quantity===""?"":parseFloat(t.quantity)||0),m=C=>{const I=String(C||"").trim();return I?I==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(I)?I:"":""},g={food:"",alcohol:"",soft_drink:"",supplies:""};Ue.useEffect(()=>{p(t.quantity===""?"":parseFloat(t.quantity)||0)},[t.quantity]);const x=parseFloat(t.price)||0,v=(()=>{if(!Number.isFinite(x)||x<=0)return"-";const C=t?._csv?.unit,I=String(C||"").trim(),L=String(t?.unit||"").trim();if(!I)return`${Jl(x)}`;const V=La(L),G=La(I);if(G===V)return`${Jl(x)}/${I}`;const Y=X2(G,V);if(Y!==null)return`${Jl(x*Y)}/${I}`;const Z=parseFloat(t?._master?.packetSize),A=String(t?._master?.packetUnit||"").trim(),U=La(A);return Z2(I)&&Number.isFinite(Z)&&Z>0&&U===V?`${Jl(x*Z)}/${I}`:`${Jl(x)}/${L||"-"}`})(),S=m(t?._master?.itemCategory),w=S==="alcohol"||S==="supplies",_=t?.tax10_override===!0||t?.tax10_override===1||t?.tax10_override==="1"||t?.tax10_override==="true",j=S?_?t?.tax10===!0||t?.tax10===1||t?.tax10==="1"||t?.tax10==="true":w:t?.tax10===!0||t?.tax10===1||t?.tax10==="1"||t?.tax10==="true",E=S?_?`${g[S]||S}: ${w?"10%":"8%"}/ `:`${g[S]||S}${j?"10%":"8%"}`:"10%",T=j?1.1:1.08,R=f===""?0:parseFloat(f),B=x*R*T,F=Ue.useMemo(()=>{const C=t?._master?.packetSize,I=t?._master?.packetUnit,L=parseFloat(C);return!Number.isFinite(L)||L<=0?"-":`${Number.isInteger(L)?L.toLocaleString():L.toLocaleString(void 0,{maximumFractionDigits:3})}${I?String(I):""}`},[t?._master?.packetSize,t?._master?.packetUnit]),$=()=>{const C=parseFloat(f);!isNaN(C)&&C!==t.quantity&&a(t.id,C)},M=C=>{C&&setTimeout(()=>{try{C.select()}catch{}},0)},z=C=>{const L=C?.closest?.("table")||document;return Array.from(L.querySelectorAll("input.inventory-quantity-input"))},P=(C,I)=>{const L=z(C).filter(Y=>!Y.disabled),V=L.indexOf(C);if(V<0)return!1;const G=L[V+I];return G?(requestAnimationFrame(()=>{try{G.scrollIntoView({block:"nearest"})}catch{}G.focus(),M(G)}),!0):!1},H=C=>{if(C.key==="Enter"){C.preventDefault(),P(C.currentTarget,C.shiftKey?-1:1),C.currentTarget.blur();return}C.key==="Tab"&&P(C.currentTarget,C.shiftKey?-1:1)&&(C.preventDefault(),C.currentTarget.blur()),(C.key==="ArrowUp"||C.key==="ArrowDown")&&P(C.currentTarget,C.key==="ArrowUp"?-1:1)&&(C.preventDefault(),C.currentTarget.blur())},O=t?._master?.packetUnit||"",q=!!O&&La(O)!==La(t?.unit);return r.jsxs("tr",{className:s(t)?"low-stock":"",children:[r.jsx("td",{style:{textAlign:"center",color:"#6b7280",fontVariantNumeric:"tabular-nums"},children:Number.isFinite(e)?e+1:""}),r.jsx("td",{style:{textAlign:"center"},children:r.jsx("input",{type:"checkbox",checked:j,onChange:C=>c&&c(t,C.target.checked),title:E,className:"inventory-tax-checkbox"})}),r.jsxs("td",{children:[t.name,s(t)&&r.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),r.jsx("td",{style:{textAlign:"right"},children:v}),r.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:F}),r.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[r.jsx("input",{type:"text",inputMode:"decimal",value:f,onChange:C=>p(S_(C.target.value)),className:"inventory-quantity-input no-print",onBlur:$,onKeyDown:H,onFocus:C=>M(C.target),onClick:C=>M(C.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),r.jsx("span",{className:"print-only",style:{display:"none"},children:f})]}),r.jsx("td",{children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx("span",{children:t.unit}),q&&typeof h=="function"&&r.jsx("button",{type:"button",onClick:()=>h(t),title:`${O}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),r.jsx("td",{style:{textAlign:"right"},children:B>0?`${Math.round(B).toLocaleString()}`:"-"}),r.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:t.vendor||"-"}),r.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof u=="function"&&r.jsx("button",{type:"button",onClick:()=>u(t),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),r.jsx("button",{onClick:()=>o(t),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},tA=({items:e,loading:t,onDelete:s,onUpdateQuantity:a,onToggleTax:o,onEdit:c,onRequestUnitSync:u})=>{const{setNodeRef:h,isOver:f}=Ac({id:"inventory-list-droppable"}),p=S=>S.threshold>0&&S.quantity<=S.threshold,[m,g]=Ue.useState({key:null,direction:"asc"}),x=S=>{g(w=>w.key===S?{key:S,direction:w.direction==="asc"?"desc":"asc"}:{key:S,direction:"asc"})},v=Ue.useMemo(()=>{if(!m.key)return e;const S=[...e];return m.key==="vendor"&&S.sort((w,_)=>{const j=(w?.vendor||"").toString(),E=(_?.vendor||"").toString(),T=j.localeCompare(E,"ja");if(T!==0)return m.direction==="asc"?T:-T;const R=(w?.name||"").toString(),B=(_?.name||"").toString(),F=R.localeCompare(B,"ja");return m.direction==="asc"?F:-F}),S},[e,m]);return r.jsxs("div",{ref:h,className:`inventory-list-droppable ${f?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:f?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[r.jsx("div",{className:"inventory-table-container",children:t?r.jsx("p",{children:"Loading..."}):r.jsxs("table",{className:"inventory-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{textAlign:"center",width:"44px"},children:"No"}),r.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"}),r.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",m.key==="vendor"&&(m.direction==="asc"?"":"")]}),r.jsx("th",{style:{width:"40px"}})]})}),r.jsxs("tbody",{children:[v.map((S,w)=>r.jsx(eA,{index:w,item:S,isLowStock:p,onUpdateQuantity:a,onEdit:c,onDelete:s,onToggleTax:o,onRequestUnitSync:u},S.id)),v.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#888",padding:"2rem"},children:f?"":""})})]}),r.jsx("tfoot",{children:(()=>{const S=e.reduce((w,_)=>{const j=parseFloat(_.price)||0,E=_.quantity===""?0:parseFloat(_.quantity)||0,T=_?.tax10===!0||_?.tax10===1||_?.tax10==="1"||_?.tax10==="true"?1.1:1.08,R=j*E;return w.net+=R,w.taxed+=R*T,w},{net:0,taxed:0});return r.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[r.jsx("td",{colSpan:"7",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(S.net).toLocaleString()," / ",Math.round(S.taxed).toLocaleString()]}),r.jsx("td",{colSpan:"2"})]})})()})]})}),f&&r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},nA=({onBack:e})=>{const{user:t}=xs(),s=t?.id,[,a]=jc(),[o,c]=k.useState([]),[u,h]=k.useState([]),[f,p]=k.useState([]),[m,g]=k.useState([]),[x,v]=k.useState(new Map),[S,w]=k.useState(new Map),[_,j]=k.useState(new Set),[E,T]=k.useState(!0),[R,B]=k.useState(""),[F,$]=k.useState(!1),[M,z]=k.useState(null),[P,H]=k.useState(""),[O,q]=k.useState(!1),[C,I]=k.useState(null),[L,V]=k.useState(!1),[G,Y]=k.useState(!1),[Z,A]=k.useState(""),[U,X]=k.useState(!1),[se,oe]=k.useState(!0),[Ce,ue]=k.useState(!1),[ne,we]=k.useState(null),[Le,ge]=k.useState("history"),[Te,de]=k.useState(null),[N,ve]=k.useState(""),[fe,Q]=k.useState(!1),[K,ie]=k.useState(null),[re,ee]=k.useState(!0),[le,ye]=k.useState({key:"name",direction:"asc"}),[qe,Re]=k.useState(!1),[$e,Ke]=k.useState(null),[Ye,Et]=k.useState(new Set),[Kt,dt]=k.useState(!1),[bt,mt]=k.useState(null),[$t,on]=k.useState(null),[Ot,gn]=k.useState(!1),Wt=Pa(Or(Dd,{activationConstraint:{distance:8}})),[Dt,zn]=k.useState("all"),[hn,Ct]=k.useState(new Set),[ht,Vt]=k.useState(""),[qt,cn]=k.useState(""),[Ft,_n]=k.useState({});k.useEffect(()=>{H(M&&M.name||"")},[M]);const[xn,un]=k.useState(""),Vn=({row:J,onVendorClick:xe,isSelected:be})=>{const{attributes:Me,listeners:Qe,setNodeRef:Je,setActivatorNodeRef:tt,transform:rt,transition:st,isDragging:ot}=$a({id:J.vendor,data:{type:"summary-row"}}),pt={transform:Vr.Transform.toString(rt),transition:st,opacity:ot?.6:1};return r.jsxs("tr",{ref:Je,style:pt,...Me,className:be?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[r.jsx("td",{className:"inventory-summary__drag",children:r.jsx("span",{ref:tt,...Qe,className:"inventory-summary__drag-handle",title:"",children:""})}),r.jsx("td",{children:r.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>xe?.(J.vendor),"aria-expanded":!!be,children:[r.jsx("span",{children:J.vendor}),r.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:be?"":""})]})}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(J.total||0).toLocaleString()]})]})};k.useEffect(()=>{s&&(zn("all"),B(""),Ht())},[s]);const Ht=async(J=!1)=>{J||T(!0);try{const[xe,be,Me,Qe,Je,tt,rt]=await Promise.all([yr.getAll(s),Fn.getPriceListArray(),yr.getIgnoredItems(s),yr.getSnapshots(s),yr.getDeletedSnapshots(s),Ln.getAllConversions(),jd.getAll(s)]);c(xe),g(be),j(Me),h(Qe||[]),p(Je||[]),v(tt||new Map),w(rt||new Map);const st=at=>{if(!at)return-1;const Pn=new Date(at).getTime();return Number.isFinite(Pn)?Pn:-1},ot=(at,Rt)=>{const Pn=Math.max(st(at?.updated_at),st(at?.updatedAt),st(at?.created_at),st(at?.createdAt)),$n=Math.max(st(Rt?.updated_at),st(Rt?.updatedAt),st(Rt?.created_at),st(Rt?.createdAt));return Pn!==$n&&$n>Pn?Rt:at},pt=new Map;(xe||[]).forEach(at=>{const Rt=String(at?.vendor??"").trim()||"__no_vendor__",Pn=Jt(at?.name)||String(at?.name??"").trim();if(!Pn)return;const $n=`${Rt}@@${Pn}`,ss=pt.get($n);if(!ss){pt.set($n,at);return}pt.set($n,ot(ss,at))});const vt=new Set(Array.from(pt.values()).map(at=>at.id));Ct(vt)}catch(xe){console.error("Failed to load data:",xe)}finally{J||T(!1)}},Cn=J=>{if(!J)return"-";const xe=new Date(J);if(Number.isNaN(xe.getTime()))return String(J);const be=xe.getFullYear(),Me=String(xe.getMonth()+1).padStart(2,"0"),Qe=String(xe.getDate()).padStart(2,"0"),Je=String(xe.getHours()).padStart(2,"0"),tt=String(xe.getMinutes()).padStart(2,"0");return`${be}/${Me}/${Qe} ${Je}:${tt}`},It=J=>{const xe=J?.items;return Array.isArray(xe)?xe:xe?[]:[]},Tn=J=>{const xe=J?.snapshot_date||J?.created_at;if(!xe)return null;const be=new Date(xe);return Number.isNaN(be.getTime())?null:be},Kn=Ue.useMemo(()=>new Set([""]),[]),dn=J=>{const xe=String(J??"").trim();return Kn.has(xe)},Xt=J=>J===!0||J===1||J==="1"||J==="true",ke=J=>{const xe=String(J??"").trim();if(!xe)return"";const be=xe.toLowerCase();return be===""?"g":be===""?"ml":be===""?"cc":be===""?"kg":be===""?"l":be===""?"cl":be},te=(J,xe)=>{const be=parseFloat(J?.lastPrice),Me=parseFloat(J?.packetSize),Qe=ke(J?.packetUnit),Je=ke(xe||Qe);if(!Number.isFinite(be)||!Number.isFinite(Me)||Me<=0||!Qe)return null;const tt=be/Me;if(Je===Qe)return tt;if(Qe==="g"&&Je==="kg")return tt*1e3;if(Qe==="kg"&&Je==="g")return tt/1e3;const rt=Qe==="cc"?"ml":Qe,st=Je==="cc"?"ml":Je;return rt==="ml"&&st==="l"?tt*1e3:rt==="l"&&st==="ml"?tt/1e3:rt==="cl"&&st==="ml"?be/Me/10:rt==="ml"&&st==="cl"?tt*10:rt==="cl"&&st==="cl"?tt:null},je=(J,xe)=>{const be=ke(J),Me=ke(xe);if(!be||!Me)return null;if(be===Me)return 1;if(be==="kg"&&Me==="g")return 1e3;if(be==="g"&&Me==="kg")return 1/1e3;const Qe=be==="cc"?"ml":be,Je=Me==="cc"?"ml":Me;return Qe==="l"&&Je==="ml"?1e3:Qe==="ml"&&Je==="l"?1/1e3:Qe==="cl"&&Je==="ml"?10:Qe==="ml"&&Je==="cl"?1/10:null},Oe=J=>{const xe=String(J||"").trim();return xe?xe==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(xe)?xe:"":""},We=J=>{const xe=Oe(J);return xe==="alcohol"||xe==="supplies"},ae=J=>{const xe=Oe(J);return xe==="food"?"":xe==="alcohol"||xe==="soft_drink"?"":xe==="supplies"?"":""},he=J=>{const xe=Oe(J);return xe==="food"?"food":xe==="alcohol"||xe==="soft_drink"?"drink":xe==="supplies"?"supplies":"unknown"},pe=J=>J==="food"?"":J==="drink"?"":J==="supplies"?"":"",Ne=J=>Xt(J?.tax10)?1.1:1.08,Be=J=>J?`${J.getFullYear()}-${String(J.getMonth()+1).padStart(2,"0")}`:"",it=J=>{if(!J)return-1;const be=new Date(J).getTime();return Number.isFinite(be)?be:-1},et=J=>{const xe=[J?.updated_at,J?.updatedAt,J?.created_at,J?.createdAt];for(const be of xe){const Me=it(be);if(Me>=0)return Me}return-1},Xe=Ue.useMemo(()=>{const J=new Map;return u.forEach(xe=>{const be=Tn(xe);if(!be)return;const Me=Be(be);J.has(Me)||J.set(Me,{key:Me,year:be.getFullYear(),month:be.getMonth()+1})}),Array.from(J.values()).sort((xe,be)=>be.key.localeCompare(xe.key)).map(xe=>({...xe,label:`${xe.year}${xe.month}`}))},[u]);k.useEffect(()=>{if(Xe.length===0){ht&&Vt("");return}if(ht&&Xe.some(be=>be.key===ht))return;const J=Be(new Date),xe=Xe.find(be=>be.key===J)?.key||Xe[0].key;Vt(xe)},[Xe,ht]),k.useEffect(()=>{if(Xe.length===0){qt&&cn("");return}if(qt&&Xe.some(be=>be.key===qt))return;const J=Be(new Date),xe=Xe.find(be=>be.key===J)?.key||Xe[0].key;cn(xe)},[Xe,qt]);const lt=Ue.useMemo(()=>{if(!qt)return null;const[J,xe]=qt.split("-"),be=parseInt(J,10),Me=parseInt(xe,10);if(!Number.isFinite(be)||!Number.isFinite(Me))return null;const Qe=rt=>String(rt).padStart(2,"0"),Je=new Date(be,Me-1,1),tt=new Date(be,Me,0);return{year:be,month:Me,start:Je,end:tt,rangeLabel:`${be}/${Qe(Me)}/01${be}/${Qe(Me)}/${Qe(tt.getDate())}`}},[qt]),Mt=Ue.useMemo(()=>qt?u.map(J=>({snapshot:J,date:Tn(J)})).filter(J=>J.date&&Be(J.date)===qt).sort((J,xe)=>xe.date-J.date).map(J=>J.snapshot):u,[u,qt]),Tt=Ue.useMemo(()=>{if(!ht)return null;const[J,xe]=ht.split("-"),be=parseInt(J,10),Me=parseInt(xe,10);if(!Number.isFinite(be)||!Number.isFinite(Me))return null;const Qe=rt=>String(rt).padStart(2,"0"),Je=new Date(be,Me-1,1),tt=new Date(be,Me,0);return{year:be,month:Me,start:Je,end:tt,rangeLabel:`${be}/${Qe(Me)}/01${be}/${Qe(Me)}/${Qe(tt.getDate())}`}},[ht]),Ge=Ue.useMemo(()=>ht?u.map(J=>({snapshot:J,date:Tn(J)})).filter(J=>J.date&&Be(J.date)===ht).sort((J,xe)=>xe.date-J.date).map(J=>J.snapshot):[],[u,ht]),ct=Ge[0]||null,Zt=ht||(ct?.id?`snapshot:${ct.id}`:""),In=Ue.useMemo(()=>{const J=new Map;return Ge.forEach(xe=>{const be=Tn(xe)?.getTime()||-1;It(xe).forEach((Qe,Je)=>{const tt=(Qe?.vendor||"").toString().trim();if(dn(tt))return;const rt=tt||"",st=String(Qe?.name||"").trim();if(!st)return;const ot=`${rt}::${st}`,pt={item:{...Qe,vendor:rt},snapshotMs:be,itemUpdatedMs:et(Qe),rowIndex:Je},vt=J.get(ot);if(!vt){J.set(ot,pt);return}if(pt.snapshotMs!==vt.snapshotMs){pt.snapshotMs>vt.snapshotMs&&J.set(ot,pt);return}if(pt.itemUpdatedMs!==vt.itemUpdatedMs){pt.itemUpdatedMs>vt.itemUpdatedMs&&J.set(ot,pt);return}pt.rowIndex>=vt.rowIndex&&J.set(ot,pt)})}),Array.from(J.values()).map(xe=>xe.item)},[Ge,dn]),Xn=Ue.useMemo(()=>{const J=new Map;return In.forEach(xe=>{const be=(xe?.vendor||"").toString().trim(),Me=be||"";if(dn(be))return;const Qe=parseFloat(xe?.price)||0,Je=xe?.quantity===""?0:parseFloat(xe?.quantity)||0,tt=Qe*Je,rt=tt*Ne(xe),st=J.get(Me)||{vendor:Me,net:0,taxed:0};st.net+=tt,st.taxed+=rt,J.set(Me,st)}),Array.from(J.values()).map(xe=>({vendor:xe.vendor,net:xe.net,taxed:xe.taxed,total:xe.taxed}))},[In,dn,Ne]),Nr=Ue.useMemo(()=>{const J=new Map;return Xn.forEach(xe=>{J.set(xe.vendor,xe)}),J},[Xn]),Hr=Ue.useMemo(()=>{const J=new Map;try{for(const[xe,be]of(x||new Map).entries()){const Me=String(xe??"").trim();Me&&J.set(Me,be)}}catch{}return J},[x]),zr=Ue.useCallback(J=>{const xe=Oe(J?.itemCategory??J?.item_category);if(xe)return xe;const be=String(J?.name??"").trim();if(!be)return"";const Me=Hr.get(be);return Oe(Me?.itemCategory??Me?.item_category)},[Hr]),Gr=Ue.useMemo(()=>{const J=new Map;In.forEach((xe,be)=>{const Me=(xe?.vendor||"").toString().trim(),Qe=Me||"";if(dn(Me))return;const Je=parseFloat(xe?.price)||0,tt=xe?.quantity===""?0:parseFloat(xe?.quantity)||0,rt=Je*tt,st=rt*Ne(xe),ot=zr(xe),pt=he(ot),vt=J.get(Qe)||{vendor:Qe,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};vt.totals[pt]+=st,vt.totals.net+=rt,vt.totals.taxed+=st,vt.rows.push({id:xe?.id||`${Qe}-${xe?.name||"item"}-${be}`,name:xe?.name||"",unit:xe?.unit||"",quantity:tt,price:Je,taxed:st,itemCategory:ot,breakdownKey:pt}),J.set(Qe,vt)});for(const xe of J.values())xe.rows.sort((be,Me)=>{const Qe={food:0,drink:1,unknown:2,supplies:3},Je=Qe[be?.breakdownKey]??2,tt=Qe[Me?.breakdownKey]??2;if(Je!==tt)return Je-tt;const rt=(be?.name||"").toString(),st=(Me?.name||"").toString();return rt.localeCompare(st,"ja")});return J},[In,dn,Ne,zr]),mr=Ue.useMemo(()=>Xn.slice().sort((J,xe)=>xe.taxed!==J.taxed?xe.taxed-J.taxed:J.vendor.localeCompare(xe.vendor,"ja")).map(J=>J.vendor),[Xn]),Ls=Ue.useMemo(()=>{if(!Zt)return mr;const J=Ft[Zt],xe=new Set(Nr.keys()),be=Array.isArray(J)?J.filter(Qe=>xe.has(Qe)):[],Me=mr.filter(Qe=>!be.includes(Qe));return[...be,...Me]},[Ft,Zt,mr,Nr]),Fs=Ue.useMemo(()=>Ls.map(J=>Nr.get(J)).filter(Boolean),[Ls,Nr]),wi=Fs.reduce((J,xe)=>(J.net+=xe.net||0,J.taxed+=xe.taxed||0,J),{net:0,taxed:0});k.useEffect(()=>{xn&&(Nr.has(xn)||un(""))},[xn,Nr]);const qa=J=>{un(xe=>xe===J?"":J)},Vs=J=>{J?.id&&s&&(Q(!1),ie(null),ve(""),de({title:"",message:`${J.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Q(!0),ie({type:"move",id:J.id});try{await yr.deleteSnapshotToTrash(s,J.id),await Ht(!0),mt({title:"",message:"",type:"success"})}catch(xe){console.error(xe),mt({title:"",message:"()",type:"error"})}finally{Q(!1),ie(null),de(null)}}}))},sl=J=>{J?.id&&s&&(Q(!1),ie(null),ve(""),de({title:"",message:`${J.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Q(!0),ie({type:"restore",id:J.id});try{await yr.restoreSnapshotFromTrash(s,J.id),await Ht(!0),mt({title:"",message:"",type:"success"})}catch(xe){console.error(xe),mt({title:"",message:"",type:"error"})}finally{Q(!1),ie(null),de(null)}}}))},Ar=J=>{J?.id&&s&&(Q(!1),ie(null),ve(""),de({title:" ",message:`${J.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Q(!0),ie({type:"hard-delete",id:J.id});try{await yr.hardDeleteSnapshotFromTrash(s,J.id),await Ht(!0),mt({title:"",message:"",type:"success"})}catch(xe){console.error(xe),mt({title:"",message:"",type:"error"})}finally{Q(!1),ie(null),de(null)}}}))},Hs=J=>{if(!J)return;const xe=It(J).filter(at=>!dn(at?.vendor)),be=["","","","","()",""],Me=xe.map(at=>{const Rt=parseFloat(at?.price)||0,Pn=at?.quantity===""?0:parseFloat(at?.quantity)||0,$n=Math.round(Rt*Pn*Ne(at));return[at?.name??"",Rt||"",at?.unit??"",at?.quantity??"",$n||"",at?.vendor??""]}),Qe=at=>{const Rt=String(at??"");return Rt.includes(",")||Rt.includes('"')||Rt.includes(`
`)||Rt.includes("\r")?`"${Rt.replace(/"/g,'""')}"`:Rt},Je=[be.map(Qe).join(","),...Me.map(at=>at.map(Qe).join(","))].join(`
`),tt=new Uint8Array([239,187,191]),rt=new Blob([tt,Je],{type:"text/csv"}),st=URL.createObjectURL(rt),ot=(J.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),pt=(J.snapshot_date?new Date(J.snapshot_date):new Date).toISOString().slice(0,10),vt=document.createElement("a");vt.href=st,vt.download=`InventorySnapshot_${pt}_${ot}.csv`,document.body.appendChild(vt),vt.click(),document.body.removeChild(vt),URL.revokeObjectURL(st)},Fa=()=>{if(!ct)return;const J=["","()"],xe=Fs.map(at=>[at.vendor,Math.round(at.total||0)]),be=at=>{const Rt=String(at??"");return Rt.includes(",")||Rt.includes('"')||Rt.includes(`
`)||Rt.includes("\r")?`"${Rt.replace(/"/g,'""')}"`:Rt},Me=[J.map(be).join(","),...xe.map(at=>at.map(be).join(","))].join(`
`),Qe=new Uint8Array([239,187,191]),Je=new Blob([Qe,Me],{type:"text/csv"}),tt=URL.createObjectURL(Je),rt=(ct.snapshot_date?new Date(ct.snapshot_date):new Date).toISOString().slice(0,10),st=ct.title||"inventory_summary",ot=Tt?`${Tt.year}${String(Tt.month).padStart(2,"0")}`:rt,pt=st.toString().replace(/[\\/:*?"<>|]/g,"_"),vt=document.createElement("a");vt.href=tt,vt.download=`InventorySummary_${ot}_${pt}.csv`,document.body.appendChild(vt),vt.click(),document.body.removeChild(vt),URL.revokeObjectURL(tt)},oa=J=>{if(!J?.vendor)return;const xe=["","","","","","()",""],be=(J.rows||[]).map(at=>{const Rt=at.itemCategory?ae(at.itemCategory):pe(at.breakdownKey);return[at.name||"",Rt,Math.round(at.price||0),at.unit||"",Number(at.quantity||0),Math.round(at.taxed||0),J.vendor]}),Me=at=>{const Rt=String(at??"");return Rt.includes(",")||Rt.includes('"')||Rt.includes(`
`)||Rt.includes("\r")?`"${Rt.replace(/"/g,'""')}"`:Rt},Qe=[xe.map(Me).join(","),...be.map(at=>at.map(Me).join(","))].join(`
`),Je=new Uint8Array([239,187,191]),tt=new Blob([Je,Qe],{type:"text/csv"}),rt=URL.createObjectURL(tt),st=(ct?.snapshot_date?new Date(ct.snapshot_date):new Date).toISOString().slice(0,10),ot=Tt?`${Tt.year}${String(Tt.month).padStart(2,"0")}`:st,pt=J.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),vt=document.createElement("a");vt.href=rt,vt.download=`InventorySummary_${ot}_${pt}.csv`,document.body.appendChild(vt),vt.click(),document.body.removeChild(vt),URL.revokeObjectURL(rt)},Ir=Ue.useMemo(()=>{const J=yt=>yt?yt.toString().trim():"",xe=yt=>Jt(yt),be=new Set;try{for(const yt of(_||new Set).values()){const wt=xe(yt);wt&&be.add(wt)}}catch{}const Me=new Set;try{for(const yt of(Ye||new Set).values()){const wt=xe(yt);wt&&Me.add(wt)}}catch{}const Qe=new Map;try{for(const[yt,wt]of(x||new Map).entries()){const At=xe(yt);At&&Qe.set(At,wt)}}catch{}const Je=new Map;try{(m||[]).forEach(yt=>{const wt=xe(yt?.name);wt&&Je.set(wt,yt)})}catch{}const tt=new Map;try{for(const[yt,wt]of(S||new Map).entries()){const At=xe(yt);At&&tt.set(At,wt)}}catch{}const rt=yt=>{const wt=String(yt??"").trim();if(!wt)return"";const At=wt.toLowerCase();return At===""?"g":At===""?"ml":At===""?"cc":At===""?"kg":At===""?"l":At===""?"cl":At},st=(yt,wt)=>{const At=parseFloat(yt?.lastPrice),On=parseFloat(yt?.packetSize),Hn=rt(yt?.packetUnit),rr=rt(wt||Hn);if(!Number.isFinite(At)||!Number.isFinite(On)||On<=0||!Hn)return null;const Gt=At/On;if(rr===Hn)return Gt;if(Hn==="g"&&rr==="kg")return Gt*1e3;if(Hn==="kg"&&rr==="g")return Gt/1e3;const xr=Hn==="cc"?"ml":Hn,Gn=rr==="cc"?"ml":rr;return xr==="ml"&&Gn==="l"?Gt*1e3:xr==="l"&&Gn==="ml"?Gt/1e3:xr==="cl"&&Gn==="ml"?At/On/10:xr==="ml"&&Gn==="cl"?Gt*10:xr==="cl"&&Gn==="cl"?Gt:null},ot=yt=>{const wt=String(yt??"").trim();return wt?["","","","","","","","pc","PC",""].includes(wt):!1},pt=yt=>{const wt=xe(yt?.name),At=wt?Qe.get(wt):null,On=wt?Je.get(wt):null,Hn=wt&&tt.has(wt)?String(tt.get(wt)||""):String(On?.unit||""),rr={...yt};if(rr.name=J(rr.name),rr.vendor=J(rr.vendor),rr._csv={unit:Hn,price:On?.price??null,vendor:J(On?.vendor)||null,dateStr:On?.dateStr??null},!At)return rr;const Gt={...rr},xr=Oe(At?.itemCategory),Gn=At.packetUnit||"",Gs=parseFloat(At.packetSize),_s=Gn?st(At,Gn):null;if(Gt.isPhantom)Gn&&_s!==null&&(Gt.unit=Gn,Gt.price=_s);else{if(!!Gn&&Number.isFinite(Gs)&&Gs>0&&(ot(Gt.unit)||!Gt.unit)&&_s!==null){const Ks=Gt.quantity;if(Ks!==""&&Ks!==null&&Ks!==void 0){const la=parseFloat(Ks);Number.isFinite(la)&&(Gt.quantity=la*Gs)}const Ci=Gt.threshold;if(Ci!==""&&Ci!==null&&Ci!==void 0){const la=parseFloat(Ci);Number.isFinite(la)&&(Gt.threshold=la*Gs)}Gt.unit=Gn}else(Gn&&_s!==null||!Gt.unit&&Gn)&&(Gt.unit=Gn);if(_s!==null&&rt(Gt.unit)===rt(Gn))Gt.price=_s;else{const Ks=st(At,Gt.unit||Gn);Ks!==null&&(Gt.price=Ks)}}const ji=Xt(Gt?.tax10_override??Gt?.tax10Override),il=xr?We(xr):null;return Gt._master={packetSize:At.packetSize,packetUnit:At.packetUnit,lastPrice:At.lastPrice,itemCategory:xr||null,tax10Auto:il,tax10Override:ji,updatedAt:At.updatedAt},xr&&(Gt.tax10_override=ji,!ji&&il!==null&&(Gt.tax10=il)),Gt},vt=o.map(pt),at=new Map;vt.forEach(yt=>{const wt=xe(yt?.name);wt&&at.set(wt,yt)});const Rt=[...vt];m.forEach((yt,wt)=>{const At=String(yt?.name??""),On=J(At),Hn=xe(At);if(Hn&&!(_.has(At)||On&&_.has(On)||be.has(Hn))&&!at.has(Hn)){const rr={id:`phantom-${wt}`,isPhantom:!0,name:On,quantity:"",unit:yt.unit||"",category:"",price:yt.price,vendor:J(yt.vendor),threshold:0,tax10:!1,tax10_override:!1};Rt.push(pt(rr))}});const Pn=Rt.filter(yt=>{const wt=String(yt?.name??""),At=J(wt),On=xe(wt);return!(_.has(wt)||At&&_.has(At)||On&&be.has(On)||Ye.has(wt)||At&&Ye.has(At)||On&&Me.has(On)||dn(yt.vendor))}),$n=yt=>{if(!yt)return-1;const At=new Date(yt).getTime();return Number.isFinite(At)?At:-1},ss=(yt,wt)=>{const At=!!yt?.isPhantom,On=!!wt?.isPhantom;if(At!==On)return At?wt:yt;const Hn=Math.max($n(yt?.updated_at),$n(yt?.updatedAt),$n(yt?.created_at),$n(yt?.createdAt)),rr=Math.max($n(wt?.updated_at),$n(wt?.updatedAt),$n(wt?.created_at),$n(wt?.createdAt));if(Hn!==rr)return rr>Hn?wt:yt;const Gt=yt?.quantity,xr=wt?.quantity,Gn=Gt===""||Gt===null||Gt===void 0?null:parseFloat(Gt),Gs=xr===""||xr===null||xr===void 0?null:parseFloat(xr),_s=Gn!==null&&Number.isFinite(Gn),ji=Gs!==null&&Number.isFinite(Gs);return _s!==ji&&ji?wt:yt},bs=new Map;return Pn.forEach(yt=>{const wt=xe(yt?.name)||J(yt?.name);if(!wt)return;const On=`${J(yt?.vendor)||"__no_vendor__"}@@${wt}`,Hn=bs.get(On);if(!Hn){bs.set(On,yt);return}bs.set(On,ss(Hn,yt))}),Array.from(bs.values())},[o,m,_,Ye,x,S,dn]),Si=J=>{const{active:xe,over:be}=J;if(!be)return;if(xe?.data?.current?.type==="summary-row"){if(!Zt)return;const Qe=xe.id,Je=be.id;if(!Qe||!Je||Qe===Je)return;const tt=Ls,rt=tt.indexOf(Qe),st=tt.indexOf(Je);if(rt<0||st<0)return;const ot=aa(tt,rt,st);_n(pt=>({...pt,[Zt]:ot}));return}if(be.id==="inventory-list-droppable"){const Qe=xe.data.current.item;if(xe.data.current.type==="csv-item"){const Je=String(Qe?.name??"").trim(),tt=Jt(Je);let rt=null;if(x&&x.size>0&&tt&&(rt=x.get(Je)||null,!rt)){for(const[vt,at]of x.entries())if(Jt(vt)===tt){rt=at;break}}const st=rt?.packetUnit||Qe.unit,ot=rt?te(rt,st):null,pt=ot!==null?ot:rt?.lastPrice!==null&&rt?.lastPrice!==void 0&&rt?.lastPrice!==""?rt.lastPrice:Qe.price;z({name:Qe.name,price:pt,unit:st,category:"",threshold:0,quantity:0,vendor:Qe.vendor,tax10:Xt(Qe?.tax10),isNewFromCsv:!0}),$(!0),H(Qe.name||"")}}},Va=async J=>{if(J.preventDefault(),!s)return;const xe=new FormData(J.target),be=xe.get("name"),Me=parseFloat(xe.get("quantity")),Qe=xe.get("unit"),Je=xe.get("category"),tt=parseFloat(xe.get("threshold")),rt=xe.get("vendor"),st=parseFloat(xe.get("price")),ot=xe.get("packetSize"),pt=xe.get("packetUnit"),vt={name:be,quantity:Number.isFinite(Me)?Me:0,unit:Qe,category:Je,threshold:Number.isFinite(tt)?tt:0,vendor:rt||M?.vendor||"",price:Number.isFinite(st)?st:M?.price||0,tax10:Xt(M?.tax10)};try{if(ot&&pt){const at=parseFloat(ot);Number.isFinite(at)&&at>0&&await Ln.saveConversion(be,at,pt,Number.isFinite(st)?st:null,Je,rt)}M?.id&&!M.isPhantom?await yr.update(s,{...M,...vt}):await yr.add(s,vt),$(!1),z(null),Ht()}catch(at){console.error("Failed to save item:",at),mt({title:"",message:"",type:"error"})}},zs=J=>{Ke(J),Re(!0)},Se=J=>{!J||J.isPhantom||!J?._master?.packetUnit||(I(J),q(!0))},nt=()=>{L||(q(!1),I(null))},ft=async({convertQuantity:J})=>{if(!s)return;const xe=C;if(!xe||xe.isPhantom)return;const be=xe?._master?.packetUnit;if(!be)return;const Me=be,Qe=te(xe?._master,Me);if(Qe===null){mt({title:"",message:"/",type:"error"});return}let Je=xe.quantity,tt=xe.threshold;if(J){const rt=je(xe.unit,Me);if(!rt){mt({title:"",message:"kgg / lml ",type:"error"});return}const st=xe.quantity===""?null:parseFloat(xe.quantity);st!==null&&Number.isFinite(st)&&(Je=st*rt);const ot=xe.threshold===""?null:parseFloat(xe.threshold);ot!==null&&Number.isFinite(ot)&&(tt=ot*rt)}V(!0);try{await yr.update(s,{id:xe.id,unit:Me,price:Qe,quantity:Je===""?0:parseFloat(Je)||0,threshold:tt===""?0:parseFloat(tt)||0,tax10:Xt(xe?.tax10)}),await Ht(!0),q(!1),I(null)}catch(rt){console.error("Failed to sync unit:",rt),mt({title:"",message:"",type:"error"})}finally{V(!1)}},Nt=async()=>{if($e)try{const xe=(be=>be?be.toString().trim():"")($e?.name);xe&&Et(be=>{const Me=new Set(be);return Me.add(xe),Me}),Re(!1),Ke(null)}catch(J){console.error("Failed to delete/ignore item:",J)}},fn=async(J,xe)=>{try{if(!s)return;const be=Ir.find(Me=>Me.id===J);if(!be)return;if(be.isPhantom){const Me={name:be.name.trim(),quantity:xe,unit:be.unit,category:be.category||"",price:be.price,vendor:be.vendor,threshold:0,tax10:Xt(be?.tax10)},Qe=await yr.add(s,Me);await Ht(!0),Ct(Je=>{const tt=new Set(Je);return tt.add(Qe.id),tt})}else c(Me=>Me.map(Qe=>Qe.id!==J?Qe:{...Qe,quantity:xe,unit:be.unit??Qe.unit,price:be.price??Qe.price,threshold:be.threshold??Qe.threshold})),Ct(Me=>{const Qe=new Set(Me);return Qe.add(J),Qe}),await yr.update(s,{...be,quantity:xe})}catch(be){console.error(be);const Me=be?.message||be?.error_description||(typeof be=="string"?be:null)||(()=>{try{return JSON.stringify(be)}catch{return null}})()||"";mt({title:"",message:`
${Me}`,type:"error"}),Ht()}},cr=async(J,xe)=>{try{if(!s||!J)return;const be=!!xe;if(J.isPhantom){const Me={name:J.name.trim(),quantity:J.quantity===""?0:parseFloat(J.quantity)||0,unit:J.unit,category:J.category||"",price:J.price,vendor:J.vendor,threshold:0,tax10:be,tax10_override:!0};await yr.add(s,Me),await Ht(!0)}else{const Me=new Date().toISOString();c(Qe=>Qe.map(Je=>Je.id===J.id?{...Je,tax10:be,tax10_override:!0,updated_at:Me,updatedAt:Me}:Je)),await yr.update(s,{...J,tax10:be,tax10_override:!0}),await Ht(!0)}}catch(be){console.error(be);const Me=be?.message||be?.error_description||(typeof be=="string"?be:null)||(()=>{try{return JSON.stringify(be)}catch{return null}})()||"";mt({title:"",message:`
${Me}`,type:"error"}),Ht()}},ln=(J,xe)=>{if(xe===!0){on({item:J});return}cr(J,xe)},wn=()=>{Ot||on(null)},Ut=async()=>{const J=$t?.item;if(J){gn(!0);try{await cr(J,!0),on(null)}finally{gn(!1)}}},Wn=async()=>{if(!U&&Z&&s){X(!0);try{const J=Ir.filter(be=>!be.isPhantom).map(be=>{const Me={...be};return delete Me.isPhantom,delete Me._master,delete Me._csv,Me}),xe=J.reduce((be,Me)=>{const Qe=parseFloat(Me.price)||0,Je=Me.quantity===""?0:parseFloat(Me.quantity)||0;return be+Qe*Je*Ne(Me)},0);await yr.createSnapshot(s,Z,J,xe),se?(await yr.resetStockQuantities(s),await Ht(),Ct(new Set)):await Ht(!0),Y(!1),dt(!0)}catch(J){console.error("Failed to complete inventory:",J);const xe=J?.message||J?.error_description||(typeof J=="string"?J:null)||(()=>{try{return JSON.stringify(J)}catch{return null}})()||"";mt({title:"",message:`
${xe}`,type:"error"})}finally{X(!1)}}},bn=()=>{const J=["","","","","()",""],xe=Zn.map(st=>{const ot=parseFloat(st.price)||0,pt=st.quantity===""?0:parseFloat(st.quantity)||0,vt=Math.round(ot*pt*Ne(st));return[st.name,ot,st.unit,st.quantity,vt,st.vendor||""]}),be=[J.join(","),...xe.map(st=>st.map(ot=>{const pt=String(ot??"");return pt.includes(",")||pt.includes('"')||pt.includes(`
`)?`"${pt.replace(/"/g,'""')}"`:pt}).join(","))].join(`
`),Me=new Uint8Array([239,187,191]),Qe=new Blob([Me,be],{type:"text/csv"}),Je=document.createElement("a"),tt=URL.createObjectURL(Qe),rt=new Date().toISOString().split("T")[0];Je.href=tt,Je.download=`Inventory_${rt}.csv`,document.body.appendChild(Je),Je.click(),document.body.removeChild(Je),URL.revokeObjectURL(tt)},Bn=["","","","","","","","","","","",""],rs=[...new Set(Ir.map(J=>J.vendor).filter(J=>J&&!dn(J)))].sort(),Mr=Ir.some(J=>!J.vendor),nn=Dt==="summary",Zn=Ir.filter(J=>J.name.toLowerCase().includes(R.toLowerCase())?Dt==="all"||Dt==="summary"?!0:Dt==="inventory-check"?hn.has(J.id)||!J.isPhantom:Dt==="other"?!J.vendor:J.vendor===Dt:!1),Tr=J=>{if(!J)return;const xe=Jt(J.name);let be=null;if(x&&x.size>0&&xe&&(be=x.get(J.name)||null,!be)){for(const[Me,Qe]of x.entries())if(Jt(Me)===xe){be=Qe;break}}if(be){const Me=be.packetUnit||M?.unit||"",Qe=be.packetUnit?te(be,Me):null,Je=Qe!==null?Qe:be.lastPrice||M?.price||0;z(tt=>({...tt,name:J.name,price:Je,unit:Me,vendor:be.vendor||tt?.vendor||"",_master:{packetSize:be.packetSize,packetUnit:be.packetUnit,lastPrice:be.lastPrice,itemCategory:be.itemCategory,updatedAt:be.updatedAt}}))}else z(Me=>({...Me,name:J.name}))};if(F){const J=M?._master?.packetSize||"",xe=M?._master?.packetUnit||"";return r.jsxs("div",{className:"inventory-edit-container fade-in",children:[r.jsx("div",{className:"container-header",children:r.jsx("h2",{className:"section-title",children:M&&!M.isNewFromCsv?"":""})}),r.jsx(vn,{className:"edit-form-card",children:r.jsxs("form",{onSubmit:Va,children:[r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx($d,{name:"name",required:!0,value:P,onChange:be=>H(be.target.value),onSelect:Tr,placeholder:": "})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:""}),r.jsx(zt,{name:"vendor",defaultValue:M?.vendor,list:"vendor-list",placeholder:": "}),r.jsx("datalist",{id:"vendor-list",children:rs.filter(be=>be!=="").map(be=>r.jsx("option",{value:be},be))})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:" ()"}),r.jsx(zt,{name:"price",type:"number",step:"1",defaultValue:M?.price,placeholder:"0"})]})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(zt,{name:"quantity",type:"number",step:"0.01",defaultValue:M?.quantity,required:!0})]}),r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(zt,{name:"unit",defaultValue:M?.unit||"pc",required:!0,placeholder:"g, ml, , pc..."})]})]}),r.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px",color:"#495057"},children:["  ()",r.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",marginLeft:"8px",color:"#868e96"},children:" 1pc = 400g "})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{fontSize:"0.85rem"},children:" (1)"}),r.jsx(zt,{name:"packetSize",type:"number",step:"0.01",defaultValue:J,placeholder:": 400"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{fontSize:"0.85rem"},children:""}),r.jsx(zt,{name:"packetUnit",defaultValue:xe,placeholder:": g"})]})]})]}),r.jsxs("div",{className:"form-row",style:{marginTop:"16px"},children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:""}),r.jsx(zt,{name:"category",defaultValue:M?.category,list:"category-list",placeholder:"",autoComplete:"off"}),r.jsx("datalist",{id:"category-list",children:Bn.map(be=>r.jsx("option",{value:be},be))})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:" ()"}),r.jsx(zt,{name:"threshold",type:"number",step:"0.01",defaultValue:M?.threshold||0})]})]}),r.jsxs("div",{className:"form-actions",children:[r.jsx(ce,{variant:"ghost",type:"button",onClick:()=>{$(!1),z(null)},children:""}),r.jsx(ce,{variant:"primary",type:"submit",children:""})]})]})})]})}return r.jsx(ra,{onDragEnd:Si,sensors:Wt,autoScroll:!1,children:r.jsxs("div",{className:"inventory-container fade-in",children:[r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions inventory-header-actions",children:[r.jsx(ce,{variant:"ghost",onClick:e,children:" "}),r.jsx(ce,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>a({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),r.jsx(ce,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const J=new Date;A(`${J.getFullYear()}${J.getMonth()+1} `),oe(!0),Y(!0)},children:" "}),r.jsx(ce,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{we(null),ge("history"),ue(!0)},title:"",children:" "}),r.jsx(ce,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{z(null),H(""),$(!0)},children:"+ "})]})]}),r.jsx("div",{className:"inventory-split-layout",children:r.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[r.jsxs("div",{className:"inventory-controls",children:[nn?r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[r.jsxs("div",{className:"inventory-controls__field",children:[r.jsx("label",{className:"inventory-controls__label",children:":"}),r.jsx("select",{className:"inventory-controls__select",value:ht,onChange:J=>Vt(J.target.value),disabled:Xe.length===0,children:Xe.length===0?r.jsx("option",{value:"",children:""}):Xe.map(J=>r.jsx("option",{value:J.key,children:J.label},J.key))})]}),Tt&&r.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",Tt.rangeLabel]})]}):r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[r.jsxs("div",{className:"inventory-controls__field",children:[r.jsx("label",{className:"inventory-controls__label",children:":"}),r.jsxs("select",{className:"inventory-controls__select",value:Dt==="inventory-check"?"":Dt,onChange:J=>{J.target.value&&zn(J.target.value)},children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",disabled:!0,children:""}),r.jsxs("optgroup",{label:"",children:[rs.map(J=>r.jsx("option",{value:J,children:J},J)),Mr&&r.jsx("option",{value:"other",children:""})]})]})]}),r.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:R,onChange:J=>B(J.target.value)})]}),r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[r.jsxs("button",{className:"inventory-controls__btn",onClick:()=>zn("inventory-check"),"data-active":Dt==="inventory-check"?"true":"false",children:["  (",hn.size,")"]}),r.jsx("button",{className:"inventory-controls__btn",onClick:()=>zn("summary"),"data-active":Dt==="summary"?"true":"false",children:" "}),!nn&&r.jsx("button",{className:"inventory-controls__btn",onClick:bn,title:"CSV",children:" CSV (.csv)"}),!nn&&Dt==="inventory-check"&&r.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),nn?r.jsxs("div",{className:"inventory-summary",children:[r.jsx("div",{className:"inventory-summary__header",children:r.jsxs("div",{children:[r.jsx("div",{className:"inventory-summary__title",children:""}),Tt&&r.jsxs("div",{className:"inventory-summary__meta",children:[": ",Tt.rangeLabel]}),ct?r.jsxs("div",{className:"inventory-summary__meta",children:[": ",ct.title||"","",Cn(ct.snapshot_date),""]}):r.jsx("div",{className:"inventory-summary__meta",children:""}),Ge.length>1&&r.jsxs("div",{className:"inventory-summary__note",children:[" ",Ge.length," "]})]})}),ct?r.jsxs("div",{className:"inventory-summary__table-wrap",children:[r.jsx("div",{className:"inventory-summary__actions",children:r.jsx(ce,{variant:"secondary",size:"sm",onClick:Fa,children:" CSV (.csv)"})}),r.jsxs("table",{className:"inventory-summary__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40px"}}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),r.jsx(Ba,{items:Ls,strategy:Ko,children:r.jsxs("tbody",{children:[Fs.map(J=>{const xe=xn===J.vendor,be=Gr.get(J.vendor)||null;return r.jsxs(Ue.Fragment,{children:[r.jsx(Vn,{row:J,onVendorClick:qa,isSelected:xe}),xe&&be&&r.jsxs("tr",{className:"inventory-summary__detail-row",children:[r.jsx("td",{}),r.jsx("td",{colSpan:"2",children:r.jsxs("div",{className:"inventory-summary__inline-detail",children:[r.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[r.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[be.vendor," "]}),r.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>oa(be),disabled:!be.rows||be.rows.length===0,children:" CSV"}),r.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(be.totals.taxed||0).toLocaleString()]})]})]}),r.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(Me=>r.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[r.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:pe(Me)}),r.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(be.totals[Me]||0).toLocaleString()]})]},Me)),be.totals.unknown>0&&r.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[r.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),r.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(be.totals.unknown).toLocaleString()]})]})]}),r.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(be.totals.net||0).toLocaleString()]}),r.jsx("div",{className:"inventory-summary__inline-items-wrap",children:r.jsxs("table",{className:"inventory-summary__inline-items-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),r.jsx("tbody",{children:be.rows.map((Me,Qe)=>{const Je=Me.itemCategory?ae(Me.itemCategory):pe(Me.breakdownKey),tt=Qe>0?be.rows[Qe-1]:null,rt=!!tt&&tt.breakdownKey!==Me.breakdownKey;return r.jsxs("tr",{className:rt?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[r.jsx("td",{children:Me.name||"-"}),r.jsx("td",{children:Je}),r.jsxs("td",{style:{textAlign:"right"},children:["",Number(Me.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),r.jsxs("td",{style:{textAlign:"right"},children:[Number(Me.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),Me.unit?` ${Me.unit}`:""]}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(Me.taxed||0).toLocaleString()]})]},Me.id)})})]})})]})})]})]},J.vendor)}),Fs.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsx("td",{}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),r.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(wi.net).toLocaleString()," / ",Math.round(wi.taxed).toLocaleString()]})]})})]})]}):r.jsx("div",{className:"inventory-summary__empty",children:""})]}):r.jsx(tA,{items:Zn,loading:E,onSearch:B,searchQuery:R,onEdit:J=>{z(J),H(J?.name||""),$(!0)},onDelete:zs,onUpdateQuantity:fn,onToggleTax:ln,onRequestUnitSync:Se})]})}),r.jsx(an,{isOpen:!!$t,onClose:wn,title:"10%",size:"small",showCloseButton:!Ot,children:r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",$t?.item?.name||"","",r.jsx("strong",{children:"10%"}),""]}),r.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[r.jsx(ce,{variant:"secondary",onClick:wn,disabled:Ot,children:""}),r.jsx(ce,{variant:"primary",onClick:Ut,disabled:Ot,children:Ot?"...":""})]})]})}),r.jsx(an,{isOpen:G,onClose:()=>{U||Y(!1)},title:" ",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),r.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[r.jsx("strong",{children:":"}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. ",se?r.jsxs(r.Fragment,{children:[r.jsx("strong",{children:"()0"}),""]}):r.jsxs(r.Fragment,{children:[r.jsx("strong",{children:""}),""]}),r.jsx("br",{}),""]}),r.jsxs("div",{style:{marginBottom:"16px"},children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[r.jsx("input",{type:"radio",name:"inventory-reset",checked:se,disabled:U,onChange:()=>oe(!0)}),r.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",r.jsx("strong",{children:"0"}),""]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"radio",name:"inventory-reset",checked:!se,disabled:U,onChange:()=>oe(!1)}),r.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",r.jsx("strong",{children:""}),""]})]}),r.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),r.jsx("input",{type:"text",value:Z,onChange:J=>A(J.target.value),disabled:U,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx("button",{onClick:()=>{U||Y(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:U?"not-allowed":"pointer",opacity:U?.6:1,fontSize:"0.9rem"},children:""}),r.jsx("button",{onClick:Wn,disabled:U,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:U?"#94a3b8":"#2ecc71",color:"white",cursor:U?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:U?"...":se?"":""})]}),U&&r.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),r.jsxs(an,{isOpen:Ce,onClose:()=>ue(!1),title:" ",size:"large",children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[r.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:Le==="history"?r.jsxs(r.Fragment,{children:[": ",r.jsx("strong",{children:Mt.length})," "]}):r.jsxs(r.Fragment,{children:[": ",r.jsx("strong",{children:f.length})," "]})}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{type:"button",onClick:()=>ge("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:Le==="history"?"#111":"#fff",color:Le==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),r.jsx("button",{type:"button",onClick:()=>ge("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:Le==="trash"?"#111":"#fff",color:Le==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Ht(!0),title:"",children:" "})]})]}),Le==="history"&&r.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),r.jsx("select",{value:qt,onChange:J=>cn(J.target.value),disabled:Xe.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:Xe.length===0?r.jsx("option",{value:"",children:""}):Xe.map(J=>r.jsx("option",{value:J.key,children:J.label},J.key))})]}),lt&&r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",lt.rangeLabel]})]}),Le==="history"&&Mt.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):Le==="trash"&&f.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f0f0f0"},children:[r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:Le==="trash"?"":""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),r.jsx("tbody",{children:(Le==="history"?Mt:f).map(J=>{const xe=It(J).filter(pt=>!dn(pt?.vendor)),be=xe.length,Me=Math.round(xe.reduce((pt,vt)=>{const at=parseFloat(vt?.price)||0,Rt=vt?.quantity===""?0:parseFloat(vt?.quantity)||0;return pt+at*Rt*Ne(vt)},0)),Qe=Le==="trash"?`trash-${J.id}`:J.id,Je=Cn(Le==="trash"?J.deleted_at:J.snapshot_date),tt=K?.type==="move"&&K?.id===J.id,rt=K?.type==="restore"&&K?.id===J.id,st=K?.type==="hard-delete"&&K?.id===J.id,ot=tt||rt||st;return r.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[r.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Je}),r.jsx("td",{style:{padding:"10px"},children:J.title||"-"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:be.toLocaleString()}),r.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",Me.toLocaleString()]}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Le==="history"?r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Hs(J),disabled:be===0||ot,title:be===0?"items CSV":"CSV",children:" CSV"}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>we(J),disabled:ot,children:""}),r.jsx(ce,{variant:"danger",size:"sm",onClick:()=>Vs(J),disabled:ot,title:"",children:tt?"...":""})]}):r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Hs(J),disabled:be===0||ot,children:" CSV"}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>we(J),disabled:ot,children:""}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>sl(J),disabled:ot,title:"",children:rt?"...":""}),r.jsx(ce,{variant:"danger",size:"sm",onClick:()=>Ar(J),disabled:ot,title:"",children:st?"...":""})]})})]},Qe)})})]})})]}),r.jsx(an,{isOpen:!!Te,onClose:()=>{fe||de(null)},title:Te?.title||"",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:Te?.message}),Te?.requireText&&r.jsxs("div",{style:{marginTop:"14px"},children:[r.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",r.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:Te.requireText})," "]}),r.jsx("input",{type:"text",value:N,onChange:J=>ve(J.target.value),placeholder:Te.requireText,disabled:fe,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(ce,{variant:"ghost",disabled:fe,onClick:()=>{fe||de(null)},children:""}),r.jsx(ce,{variant:"danger",disabled:fe||!!Te?.requireText&&N!==Te.requireText,onClick:()=>Te?.onConfirm&&Te.onConfirm(),children:fe?Te?.loadingLabel||"...":Te?.confirmLabel||""})]})]})}),r.jsx(an,{isOpen:!!ne,onClose:()=>we(null),title:ne?` ${ne.title||""}`:" ",size:"large",children:(()=>{const J=ne;if(!J)return null;const Me=[...It(J).filter(Je=>dn(Je?.vendor)?!1:re?(Je?.quantity===""?0:parseFloat(Je?.quantity)||0)!==0:!0)].sort((Je,tt)=>{const rt=le.direction==="desc"?-1:1;if(le.key==="vendor"){const Rt=(Je?.vendor||"").toString(),Pn=(tt?.vendor||"").toString(),$n=Rt.localeCompare(Pn,"ja");if($n!==0)return $n*rt;const ss=(Je?.name||"").toString(),bs=(tt?.name||"").toString();return ss.localeCompare(bs,"ja")*rt}const st=(Je?.name||"").toString(),ot=(tt?.name||"").toString(),pt=st.localeCompare(ot,"ja");if(pt!==0)return pt*rt;const vt=(Je?.vendor||"").toString(),at=(tt?.vendor||"").toString();return vt.localeCompare(at,"ja")*rt}),Qe=Me.reduce((Je,tt)=>{const rt=parseFloat(tt?.price)||0,st=tt?.quantity===""?0:parseFloat(tt?.quantity)||0,ot=rt*st;return Je.net+=ot,Je.taxed+=ot*Ne(tt),Je},{net:0,taxed:0});return r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[r.jsxs("div",{children:[": ",r.jsx("strong",{children:Cn(J.snapshot_date)})]}),r.jsxs("div",{children:[": ",r.jsx("strong",{children:Me.length.toLocaleString()})]}),r.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",r.jsxs("strong",{children:["",Math.round(Qe.net).toLocaleString()," / ",Math.round(Qe.taxed).toLocaleString()]})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:re,onChange:Je=>ee(Je.target.checked)}),"0"]}),r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>Hs(J),children:" CSV (.csv)"})]}),Me.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f0f0f0"},children:[r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),r.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{ye(Je=>Je.key==="vendor"?{key:"vendor",direction:Je.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",le.key==="vendor"&&(le.direction==="asc"?"":"")]})]})}),r.jsx("tbody",{children:Me.map((Je,tt)=>{const rt=parseFloat(Je?.price)||0,st=Je?.quantity===""?0:parseFloat(Je?.quantity)||0,ot=Math.round(rt*st*Ne(Je)),pt=zr(Je),vt=ae(pt);return r.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[r.jsxs("td",{style:{padding:"10px"},children:[Je?.name||"-",Xt(Je?.tax10)&&r.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),r.jsx("td",{style:{padding:"10px"},children:vt}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:rt?`${Number(rt).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),r.jsx("td",{style:{padding:"10px"},children:Je?.unit||"-"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:st?st.toLocaleString():"0"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:ot?`${ot.toLocaleString()}`:"-"}),r.jsx("td",{style:{padding:"10px"},children:Je?.vendor||"-"})]},Je?.id||`${Je?.name||"item"}-${tt}`)})})]})})]})})()}),r.jsx(an,{isOpen:O,onClose:nt,title:"",size:"small",children:(()=>{const J=C,xe=J?._master?.packetUnit||"",be=J?.unit||"",Me=je(be,xe),Qe=Me!==null&&Me!==1,Je=parseFloat(J?.price)||0,tt=J?.quantity===""?0:parseFloat(J?.quantity)||0,rt=J?Ne(J):1.08,st=Je*tt*rt,ot=xe?te(J?._master,xe):null,pt=ot===null?null:ot*tt*rt,vt=ot===null||!Qe?null:ot*(tt*Me)*rt,at=Pn=>`${Math.round(Pn).toLocaleString()}`,Rt=Pn=>Number.isInteger(Pn)?Pn.toLocaleString():Pn.toLocaleString(void 0,{maximumFractionDigits:3});return r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:J?.name||"-"}),r.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",Rt(tt)," ",be," /  ",Je.toLocaleString()," /  ",at(st)]}),!!xe&&r.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",xe]})]}),r.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",r.jsx("br",{}),""]})}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[r.jsx(ce,{variant:"ghost",type:"button",onClick:nt,disabled:L,children:""}),r.jsx(ce,{variant:"secondary",type:"button",onClick:()=>ft({convertQuantity:!1}),isLoading:L,disabled:L||!xe||ot===null,title:pt===null?"":`:  ${at(pt)}`,children:""}),Qe&&r.jsx(ce,{variant:"primary",type:"button",onClick:()=>ft({convertQuantity:!0}),isLoading:L,disabled:L||!xe||ot===null,title:vt===null?"":`:  ${at(vt)}`,children:""})]})]})})()}),r.jsx(an,{isOpen:qe,onClose:()=>Re(!1),title:"",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",r.jsx("strong",{children:$e?.name}),""]}),r.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),"CSV"]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx("button",{onClick:()=>Re(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),r.jsx("button",{onClick:Nt,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),r.jsx(an,{isOpen:Kt,onClose:()=>dt(!1),title:" ",size:"small",children:r.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[r.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),r.jsxs("h3",{style:{marginBottom:"1rem"},children:[Z," "]}),r.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",r.jsx("br",{}),""]}),r.jsx("button",{onClick:()=>dt(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),r.jsx(an,{isOpen:!!bt,onClose:()=>mt(null),title:bt?.title||"",size:"small",children:r.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[bt?.type==="success"&&r.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),bt?.type==="error"&&r.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),r.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:bt?.message}),r.jsx("button",{onClick:()=>mt(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:bt?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},Xl="app-data",rA="incoming-deliveries",sA=e=>{const t=String(e||"").trim();return t&&t.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},iA=e=>{const t=String(e),s=t.lastIndexOf(".");return s<=0?t:t.slice(0,s)},aA=async e=>{if(!e)return"";const t=await e.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},Rs={async _getCurrentUserId(){const{data:e,error:t}=await Ae.auth.getUser();if(t)throw t;return e?.user?.id||null},_folderPath(e){if(!e)throw new Error("User ID is required");return`${e}/${rA}`},_filePath(e,t){const s=this._folderPath(e),a=String(t||"").replace(/^\/+/,"");return`${s}/${a}`},async listJsonFiles(e=null){const t=e||await this._getCurrentUserId();if(!t)return[];const s=this._folderPath(t),{data:a,error:o}=await Ae.storage.from(Xl).list(s,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return o?(console.error("Failed to list incoming deliveries:",o),[]):(a||[]).filter(c=>String(c?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(e,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._filePath(s,e),{data:o,error:c}=await Ae.storage.from(Xl).download(a);if(c)throw c;const u=await aA(o);return JSON.parse(u)},async saveDeliverySet({pdfFile:e,parsed:t},s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");if(!e)throw new Error("PDF");if(!t)throw new Error("");const o=new Date,c=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}_${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,u=sA(iA(e.name||"delivery")),h=`${c}_${u}`,f=this._filePath(a,`${h}.pdf`),p=this._filePath(a,`${h}.json`),m={...t,_meta:{savedAt:o.toISOString(),originalFileName:e.name||null}},[g,x]=await Promise.all([Ae.storage.from(Xl).upload(f,e,{upsert:!1,contentType:"application/pdf"}),Ae.storage.from(Xl).upload(p,new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(g.error)throw g.error;if(x.error)throw x.error;return{baseName:h,pdfPath:f,jsonPath:p}},async deleteDeliverySet(e,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=String(e||"").trim();if(!a)throw new Error("baseName ");const o=this._filePath(s,`${a}.pdf`),c=this._filePath(s,`${a}.json`),{data:u,error:h}=await Ae.storage.from(Xl).remove([o,c]);if(h)throw h;return u}},oA="/app/assets/pdf.worker-DU8cYlj-.js",lA=e=>typeof e=="string"&&e.trim().length>0,pi=e=>String(e??"").replace(/\u0000/g,"").trim(),nc=e=>{const t=String(e??"").trim();if(!t)return null;const s=t.replace(/[,\s]/g,""),a=Number(s);return Number.isFinite(a)?a:null},Zl=e=>{const t=String(e??"").trim();if(!t)return null;const s=t.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return s?s[2]?`${s[1]} ${s[2]}`:s[1]:null},cA=e=>{const t=String(e??"").trim();return!!(!t||t==="/"||t.startsWith("")||t.includes(""))},uA=(e,t)=>{const s=String(e??"").trim(),a=s.match(/^No\.?\s*(\d{3,})\s*$/);if(a?.[1])return{slipNo:a[1],consumeNext:!1};if(/^No\.?\s*$/.test(s)){const o=String(t??"").trim();if(/^\d{3,}$/.test(o))return{slipNo:o,consumeNext:!0}}return null},Jp=e=>{const t=String(e??"").trim();return t?!!/^No\.?\s*(\d{3,})?\s*$/.test(t):!1},dA=(e,t)=>{const s=pi(e[t]);if(!s||Jp(s)||s===""||s===""||s===""||s==="No"||s===""||s===""||s===""||s===""||s===""||s==="")return null;let a=t+1;const o=nc(e[a]);if(o==null)return null;a+=1;const c=nc(e[a]);if(c==null)return null;a+=1;const u=pi(e[a]);if(!u)return null;a+=1;let h=null,f=null,p=null;const m=nc(e[a]);for(m!=null?(f=m,a+=1,p=pi(e[a]),a+=1):(h=pi(e[a])||null,a+=1,f=nc(e[a]),a+=1,p=pi(e[a]),a+=1);a<e.length;){const v=pi(e[a]);if(v===""||v===""){a+=1;continue}break}let g=null;const x=pi(e[a]);return/^\d+$/.test(x)&&(g=parseInt(x,10),a+=1),{item:{no:g,code:null,name:s,unitPrice:o,deliveryQty:c,deliveryUnit:u,spec:h,orderQty:f,orderUnit:p},nextIndex:a}},hA=e=>{const t=(e||[]).map(pi).filter(h=>!cA(h)),s={title:t.find(h=>h.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let h=0;h<t.length;h+=1){const f=t[h],p=f.match(/^?\s*(.+)$/);if(p?.[1]&&!s.outputAt){s.outputAt=Zl(p[1])||p[1].trim();continue}const m=f.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);m&&!s.rangeFrom&&(s.rangeFrom=m[1],s.rangeTo=m[2])}const a=new Map;let o=null,c=null;for(let h=0;h<t.length;h+=1){const f=t[h],p=t[h+1],m=uA(f,p);if(m?.slipNo){const g=m.slipNo;m.consumeNext&&(h+=1);const x=a.get(g);x?o=x:(o={slipNo:g,vendor:c||null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},a.set(g,o));continue}if(/^(||)/.test(f)&&!f.includes("")&&!f.includes("")&&!f.includes("")){let g=3;(f.startsWith("")||f.startsWith("")||f.startsWith(""))&&(g=4);let x=f.slice(g).trim();(x.startsWith(":")||x.startsWith(""))&&(x=x.slice(1).trim());let v=null;if(!x)lA(p)&&!/^\d+$/.test(p)&&!p.includes("")&&(v=p.trim());else{const S=x.match(/^(\d+)\s+(.+)$/);S&&(x=S[2].trim()),v=x}v&&(o?o.vendor||(o.vendor=v):c=v);continue}if(o){if(f===""||f.startsWith("")){const g=f.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);g?.[1]?o.slipDate=g[1]:Zl(p)&&(o.slipDate=Zl(p));continue}if(f===""){const g=nc(p);g!=null&&(o.total=g);continue}if(f===""||f.startsWith("")){const g=f.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);g?.[1]?o.deliveryDate=g[1]:Zl(p)&&(o.deliveryDate=Zl(p)?.slice(0,10));continue}if(f.startsWith("")){const x=f.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(x&&x!=="No"){o.comment=x;continue}const v=[];for(let w=h+1;w<t.length;w+=1){const _=t[w];if(_){if(Jp(_)||_==="No"||_===""||_===""||_===""||_===""||_===""||_===""||_==="")break;v.push(_)}}const S=v.join(" ").trim();S&&S!=="No"&&(o.comment=S);continue}if(f===""||f===""){let g=h+1;for(;g<t.length;){const x=t[g];if(Jp(x)||x==="")break;const v=dA(t,g);if(!v){g+=1;continue}o.items.push(v.item),g=v.nextIndex}h=g-1}}}const u=Array.from(a.values()).sort((h,f)=>String(h.slipNo).localeCompare(String(f.slipNo),"ja"));return{report:s,slips:u}},Fx=async e=>{if(!e)throw new Error("PDF");const t=await e.arrayBuffer(),s=await Ze(()=>import("./pdf-BO-gTtTQ.js").then(h=>h.p),[]),a=s?.default&&s.default.getDocument?s.default:s;if(!a?.getDocument)throw new Error("PDF");a?.GlobalWorkerOptions&&(a.GlobalWorkerOptions.workerSrc=oA);const o=await a.getDocument({data:new Uint8Array(t)}).promise,c=[];for(let h=1;h<=o.numPages;h+=1){const p=await(await o.getPage(h)).getTextContent();for(const m of p.items||[]){const g=pi(m?.str);g&&c.push(g)}}const u=hA(c);if(!u?.slips||u.slips.length===0)throw new Error("PDFPDF");return u},kp=e=>String(e||"").replace(/\.json$/i,""),Vx=e=>{if(!e)return"-";const t=new Date(e);if(Number.isNaN(t.getTime()))return String(e);const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),u=String(t.getMinutes()).padStart(2,"0");return`${s}/${a}/${o} ${c}:${u}`},fA=e=>{const t=typeof e=="number"?e:parseFloat(String(e||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},pA=e=>String(e||"").trim(),mA=({onBack:e})=>{const[t,s]=jc(),[a,o]=Ue.useState(!0),[c,u]=Ue.useState([]),[h,f]=Ue.useState(null),[p,m]=Ue.useState(!1),[g,x]=Ue.useState(!1),[v,S]=Ue.useState(null),[w,_]=Ue.useState(!1),[j,E]=Ue.useState(""),[T,R]=Ue.useState(null),[B,F]=Ue.useState(!1),[$,M]=Ue.useState(null),[z,P]=Ue.useState(!1),[H,O]=Ue.useState(!1),[q,C]=Ue.useState(null),I=Ue.useCallback(async()=>{o(!0),E("");try{const ue=await Rs.listJsonFiles();u(ue||[])}catch(ue){console.error(ue),E(""),u([])}finally{o(!1)}},[]);Ue.useEffect(()=>{I()},[I]);const L=ue=>{ue.preventDefault(),m(!0)},V=ue=>{ue.preventDefault(),m(!1)},G=ue=>{ue.preventDefault(),m(!1);const ne=ue.dataTransfer.files?.[0];ne&&ne.type==="application/pdf"?(f(ne),S(null),C(null),E(""),Y(ne)):ne&&E("PDF")},Y=async ue=>{if(ue){E(""),x(!0),S(null),C(null);try{const ne=await Fx(ue);S(ne||null)}catch(ne){console.error(ne),E(`PDF:
${ne?.message||String(ne)}`)}finally{x(!1)}}},Z=async()=>{if(h){E(""),x(!0),S(null),C(null);try{const ue=await Fx(h);S(ue||null)}catch(ue){console.error(ue),E(`PDF:
${ue?.message||String(ue)}`)}finally{x(!1)}}},A=async()=>{if(!(!h||!v)){E(""),_(!0);try{await Rs.saveDeliverySet({pdfFile:h,parsed:v}),f(null),S(null),await I()}catch(ue){console.error(ue),E(`: ${ue?.message||String(ue)}`)}finally{_(!1)}}},U=async ue=>{const ne=kp(ue);F(!0),E("");try{const we=await Rs.downloadJson(ue);R({baseName:ne,data:we})}catch(we){console.error(we),E(`: ${we?.message||String(we)}`)}finally{F(!1)}},X=async()=>{if($?.baseName){P(!0),E("");try{await Rs.deleteDeliverySet($.baseName),M(null),await I()}catch(ue){console.error(ue),E(`: ${ue?.message||String(ue)}`)}finally{P(!1)}}},se=ue=>{const ne=new Map,we=(ge,Te)=>{const de=String(ge?.name||"").trim();if(!de)return;const N=pA(ge?.deliveryUnit||ge?.unit||ge?.unitName||""),ve=fA(ge?.deliveryQty??ge?.quantity??ge?.qty);if(!Number.isFinite(ve)||ve===null)return;const fe=String(Te||"").trim(),Q=`${fe}@@${Jt(de)}@@${N||""}`,K=ne.get(Q);K?K.qty+=ve:ne.set(Q,{vendor:fe,name:de,unit:N,qty:ve})};return(ue?.slips||ue?.receipts||[]).forEach(ge=>{const Te=ge?.vendor||"";(ge?.items||[]).forEach(N=>we(N,Te))}),Array.from(ne.values()).sort((ge,Te)=>ge.vendor!==Te.vendor?ge.vendor.localeCompare(Te.vendor,"ja"):ge.name!==Te.name?ge.name.localeCompare(Te.name,"ja"):String(ge.unit||"").localeCompare(String(Te.unit||""),"ja"))},oe=async()=>{O(!0),E(""),C(null);try{const ue=await Rs.listJsonFiles();if(!ue||ue.length===0){C([]);return}const ne=[];for(const ge of ue){const Te=ge?.name;if(Te)try{const de=await Rs.downloadJson(Te);ne.push(de)}catch(de){console.warn("Failed to download:",Te,de)}}const we=new Map;ne.forEach(ge=>{se(ge).forEach(de=>{const N=`${de.vendor}@@${Jt(de.name)}@@${de.unit||""}`,ve=we.get(N);ve?ve.qty+=de.qty:we.set(N,{...de})})});const Le=Array.from(we.values()).sort((ge,Te)=>ge.vendor!==Te.vendor?ge.vendor.localeCompare(Te.vendor,"ja"):ge.name!==Te.name?ge.name.localeCompare(Te.name,"ja"):String(ge.unit||"").localeCompare(String(Te.unit||""),"ja"));C(Le)}catch(ue){console.error(ue),E(`: ${ue?.message||String(ue)}`)}finally{O(!1)}},Ce=v?.slips||v?.receipts||[];return r.jsxs("div",{className:"incoming-deliveries",children:[r.jsxs("div",{className:"incoming-deliveries__header",children:[r.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[r.jsx(ce,{variant:"secondary",onClick:()=>s({view:"incoming-stock"}),children:" "}),r.jsx(ce,{variant:"ghost",onClick:e,children:" "})]})]}),j&&r.jsx(vn,{className:"incoming-deliveries__error",children:j}),r.jsxs(vn,{className:"incoming-deliveries__card",children:[r.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",Fo]}),r.jsxs("div",{className:"incoming-deliveries__upload",children:[r.jsxs("div",{className:`incoming-deliveries__upload-zone ${p?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:L,onDragLeave:V,onDrop:G,children:[r.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:p?"var(--color-primary)":"inherit"},children:p?"":"PDF"}),r.jsx("input",{type:"file",accept:"application/pdf",onChange:ue=>{const ne=ue.target.files?.[0]||null;f(ne),S(null),C(null),E("")},style:{width:"100%"}})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[r.jsx(ce,{variant:"secondary",onClick:Z,disabled:!h||g||w,children:g?"":""}),r.jsx(ce,{variant:"primary",onClick:A,disabled:!h||!v||w||g,children:w?"":""})]})]}),v&&r.jsxs("div",{className:"incoming-deliveries__preview",children:[r.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",r.jsx("strong",{children:v?.report?.outputAt||v?.report?.outputDate||"-"})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",r.jsx("strong",{children:Ce.length})]}),Ce.slice(0,3).map((ue,ne)=>r.jsxs("div",{className:"incoming-deliveries__slip",children:[r.jsxs("div",{className:"incoming-deliveries__slip-head",children:[r.jsx("div",{style:{fontWeight:700},children:ue?.vendor||""}),r.jsxs("div",{style:{opacity:.85},children:["No: ",ue?.slipNo||"-"," / : ",ue?.deliveryDate||"-"]})]}),r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"52%"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%"},children:""})]})}),r.jsx("tbody",{children:(ue?.items||[]).slice(0,6).map((we,Le)=>r.jsxs("tr",{children:[r.jsx("td",{children:we?.name||"-"}),r.jsx("td",{style:{textAlign:"right"},children:we?.unitPrice!=null?`${Math.round(we.unitPrice).toLocaleString()}`:"-"}),r.jsx("td",{style:{textAlign:"right"},children:we?.deliveryQty!=null?we.deliveryQty:"-"}),r.jsx("td",{children:we?.deliveryUnit||"-"})]},`${we?.no||Le}`))})]}),(ue?.items||[]).length>6&&r.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(ue?.items||[]).length-6)," "]})]},`${ue?.slipNo||ue?.id||ne}`)),Ce.length>3&&r.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),r.jsxs(vn,{className:"incoming-deliveries__card",children:[r.jsxs("div",{className:"incoming-deliveries__list-head",children:[r.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[r.jsx(ce,{variant:"secondary",onClick:I,disabled:a||H,children:""}),r.jsx(ce,{variant:"secondary",onClick:oe,disabled:a||H,children:H?"":""})]})]}),a?r.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):c.length===0?r.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):r.jsx("div",{className:"incoming-deliveries__file-list",children:c.map(ue=>r.jsxs("div",{className:"incoming-deliveries__file-row",children:[r.jsxs("div",{className:"incoming-deliveries__file-info",children:[r.jsx("div",{style:{fontWeight:700},children:kp(ue.name)}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",Vx(ue.updated_at||ue.created_at)]})]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>U(ue.name),disabled:B||z,children:B?"":""}),r.jsx(ce,{variant:"ghost",size:"sm",onClick:()=>M({baseName:kp(ue.name)}),disabled:z,children:""})]})]},ue.name))}),q&&r.jsxs("div",{className:"incoming-deliveries__aggregate",children:[r.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),q.length===0?r.jsx("div",{style:{opacity:.85},children:""}):r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"/"}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:q.slice(0,60).map(ue=>r.jsxs("tr",{children:[r.jsx("td",{children:ue.vendor||"-"}),r.jsx("td",{children:ue.name}),r.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(ue.qty)?ue.qty:"-"}),r.jsx("td",{children:ue.unit||"-"})]},`${ue.vendor}@@${ue.name}@@${ue.unit||""}`))})]}),q.length>60&&r.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),r.jsx(an,{isOpen:!!T,onClose:()=>R(null),title:"PDF ",size:"large",children:T?.data?r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",Vx(T.data?._meta?.savedAt),T.data?._meta?.originalFileName?` / : ${T.data._meta.originalFileName}`:""]}),(T.data?.slips||T.data?.receipts||[]).map((ue,ne)=>r.jsxs("div",{style:{marginBottom:"16px"},children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[ue?.vendor||"","No: ",ue?.slipNo||"-"," / : ",ue?.deliveryDate||"-",""]}),r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"52%"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%"},children:""})]})}),r.jsx("tbody",{children:(ue?.items||[]).map((we,Le)=>r.jsxs("tr",{children:[r.jsx("td",{children:we?.name||"-"}),r.jsx("td",{style:{textAlign:"right"},children:we?.unitPrice!=null?`${Math.round(we.unitPrice).toLocaleString()}`:"-"}),r.jsx("td",{style:{textAlign:"right"},children:we?.deliveryQty!=null?we.deliveryQty:"-"}),r.jsx("td",{children:we?.deliveryUnit||"-"})]},`${we?.no||Le}`))})]})]},`${ue?.slipNo||ne}`))]}):r.jsx("div",{style:{opacity:.8},children:""})}),r.jsx(an,{isOpen:!!$,onClose:()=>M(null),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",$?.baseName,""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>M(null),disabled:z,children:""}),r.jsx(ce,{variant:"danger",onClick:X,disabled:z,children:z?"":""})]})]})})]})},di="app-data",gA="incoming-stock",yA="stock.json",vA="applied",Ma=e=>{const t=typeof e=="number"?e:parseFloat(String(e||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},Wo=e=>String(e||"").trim(),Ua=(e,t,s)=>`${String(s||"").trim()}@@${Jt(e)}@@${Wo(t)}`,Ep=e=>{const t=e?.statusCode??e?.status??null;if((typeof t=="string"?parseInt(t,10):t)===404)return!0;const a=String(e?.message||"").toLowerCase();return a.includes("not found")||a.includes("object not found")},xA=e=>{const t=e?.statusCode??e?.status??null;if((typeof t=="string"?parseInt(t,10):t)===409)return!0;const a=String(e?.message||"").toLowerCase();return a.includes("already exists")||a.includes("duplicate")||a.includes("409")},bA=e=>{const t=new Map;return(e?.slips||e?.receipts||[]).forEach(a=>{const o=String(a?.vendor||"").trim();(a?.items||[]).forEach(c=>{const u=String(c?.name||"").trim();if(!u)return;const h=Wo(c?.deliveryUnit||c?.unit||c?.unitName||""),f=Ma(c?.deliveryQty??c?.quantity??c?.qty);if(f==null)return;const p=Ua(u,h,o),m=t.get(p);m?m.quantity+=f:t.set(p,{vendor:o,name:u,unit:h,quantity:f})})}),Array.from(t.values()).filter(a=>Number.isFinite(a.quantity))},_A=(e,t,s)=>{const a=new Map;return(e||[]).forEach(o=>{const c=String(o?.name||"").trim();if(!c)return;const u=Wo(o?.unit||""),h=String(o?.vendor||"").trim(),f=Ma(o?.quantity)??0;a.set(Ua(c,u,h),{vendor:h,name:c,unit:u,quantity:f,updatedAt:o?.updatedAt||null})}),t.forEach(o=>{const c=Ua(o.name,o.unit,o.vendor),u=a.get(c);u?(u.quantity=Math.max(0,(Ma(u.quantity)??0)+(Ma(o.quantity)??0)),u.updatedAt=s):a.set(c,{vendor:o.vendor,name:o.name,unit:Wo(o.unit),quantity:Math.max(0,Ma(o.quantity)??0),updatedAt:s})}),Array.from(a.values()).sort((o,c)=>o.vendor!==c.vendor?o.vendor.localeCompare(c.vendor,"ja"):o.name!==c.name?o.name.localeCompare(c.name,"ja"):String(o.unit||"").localeCompare(String(c.unit||""),"ja"))},hi={async _getCurrentUserId(){const{data:e,error:t}=await Ae.auth.getUser();if(t)throw t;return e?.user?.id||null},_folderPath(e){if(!e)throw new Error("User ID is required");return`${e}/${gA}`},_stockPath(e){return`${this._folderPath(e)}/${yA}`},_appliedFolder(e){return`${this._folderPath(e)}/${vA}`},_appliedMarkerPath(e,t){const s=this._appliedFolder(e),a=String(t||"").trim();if(!a)throw new Error("baseName is required");return`${s}/${a}.json`},async listAppliedBaseNames(e=null){const t=e||await this._getCurrentUserId();if(!t)return new Set;const s=this._appliedFolder(t),{data:a,error:o}=await Ae.storage.from(di).list(s,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(o)return Ep(o)?new Set:(console.error("Failed to list applied markers:",o),new Set);const c=new Set;return(a||[]).forEach(u=>{const h=String(u?.name||"");h.toLowerCase().endsWith(".json")&&c.add(h.replace(/\.json$/i,""))}),c},async loadStock(e=null){const t=e||await this._getCurrentUserId();if(!t)throw new Error("");const s=this._stockPath(t),{data:a,error:o}=await Ae.storage.from(di).createSignedUrl(s,60);if(o){if(Ep(o))return{_meta:{version:1,updatedAt:null},items:[]};throw o}try{const c=await fetch(a.signedUrl,{cache:"no-store"});if(!c.ok){if(c.status===404)return{_meta:{version:1,updatedAt:null},items:[]};throw new Error(`Failed to fetch stock: ${c.status} ${c.statusText}`)}const u=await c.text(),h=JSON.parse(u||"{}"),f=Array.isArray(h?.items)?h.items:[];return{_meta:{version:1,updatedAt:h?._meta?.updatedAt||null},items:f}}catch(c){throw console.warn("loadStock fetch failed",c),c}},async saveStock(e,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._stockPath(s),o={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(e?.items)?e.items:[]},{error:c}=await Ae.storage.from(di).upload(a,new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(c)throw c;return o},async applyDeliverySet({baseName:e,parsed:t},s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(e||"").trim();if(!o)throw new Error("baseName ");if(!t)throw new Error("");const c=bA(t),u=new Date().toISOString(),h=this._appliedMarkerPath(a,o),f={baseName:o,appliedAt:u,slipCount:(t?.slips||t?.receipts||[]).length||0,itemCount:c.length},p=await Ae.storage.from(di).upload(h,new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(p.error){if(xA(p.error))return{status:"already_applied"};throw p.error}try{const m=await this.loadStock(a),g=_A(m.items||[],c,u);return await this.saveStock({items:g},a),{status:"applied",addedCount:c.length}}catch(m){try{await Ae.storage.from(di).remove([h])}catch{}throw m}},async updateStockItem({name:e,unit:t,vendor:s,delta:a},o=null){const c=o||await this._getCurrentUserId();if(!c)throw new Error("");const u=String(e||"").trim();if(!u)throw new Error("");const h=Wo(t),f=String(s||"").trim(),p=Ua(u,h,f),m=Ma(a);if(m===null||!Number.isFinite(m))throw new Error("");const x=(await this.loadStock(c)).items||[],v=new Date().toISOString();let S=!1;const w=x.map(_=>{if(Ua(_.name,_.unit,_.vendor)===p){S=!0;const E=Math.max(0,(Ma(_.quantity)??0)+m);return{..._,quantity:E,updatedAt:v}}return _});if(!S)throw new Error("");return await this.saveStock({items:w},c),{status:"updated",name:u,unit:h}},async deleteStockItem({name:e,unit:t,vendor:s},a=null){const o=a||await this._getCurrentUserId();if(!o)throw new Error("");const c=String(e||"").trim();if(!c)throw new Error("");const u=Wo(t),h=String(s||"").trim(),f=Ua(c,u,h),m=(await this.loadStock(o)).items||[],g=m.filter(x=>Ua(x.name,x.unit,x.vendor)!==f);return g.length,m.length,await this.saveStock({items:g},o),{status:"deleted",name:c}},async clearStock(e=null){const t=e||await this._getCurrentUserId();if(!t)throw new Error("");const s=this._stockPath(t),a={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await Ae.storage.from(di).upload(s,new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const o=this._appliedFolder(t),{data:c}=await Ae.storage.from(di).list(o,{limit:1e3});if(c?.length){const u=c.map(h=>`${o}/${h.name}`);await Ae.storage.from(di).remove(u)}return{status:"cleared"}},async deleteAppliedMarker(e,t=null){const s=t||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._appliedMarkerPath(s,e),{error:o}=await Ae.storage.from(di).remove([a]);if(o){if(Ep(o))return{status:"not_found"};throw o}return{status:"deleted"}}},na="meal_plans",wA="planner_data",Wi="",Hx=20,Zi=[],SA=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,T_=e=>`planner_data_${e}`,Yi=e=>{Zi[Zi.length-1]!==e&&(Zi.push(e),Zi.length>Hx&&Zi.splice(0,Zi.length-Hx))},Fr=(e,t=null)=>{if(e==null||e==="")return t;const s=Number(e);return Number.isFinite(s)?s:t},Xp=(e,t)=>{const s=String(e?.message||"").toLowerCase();return String(e?.code||"")==="42703"?s.includes(`column "${String(t).toLowerCase()}"`):s.includes(`column "${String(t).toLowerCase()}"`)&&s.includes("does not exist")},Qi=e=>{try{if(!e)return{};const t=localStorage.getItem(T_(e));if(t)return JSON.parse(t);const s=localStorage.getItem(wA);if(s){const a=JSON.parse(s);return Es(e,a),a}return{}}catch{return{}}},Es=(e,t)=>{e&&localStorage.setItem(T_(e),JSON.stringify(t))},jA=()=>`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,Go=e=>{if(typeof e=="number")return e;const t=Number(e);return Number.isFinite(t)?t:e},CA=e=>({id:String(e.id),recipeId:Go(e.recipe_id??e.recipeId),type:e.meal_type??e.type??"dinner",note:e.note??"",multiplier:Fr(e.multiplier,1),totalWeight:Fr(e.total_weight??e.totalWeight,null)}),kA=e=>e?typeof e=="string"?e.slice(0,10):e instanceof Date?e.toISOString().slice(0,10):String(e).slice(0,10):"",EA=e=>{const t={};return(e||[]).forEach(s=>{const a=kA(s.plan_date??s.planDate);a&&(t[a]||(t[a]=[]),t[a].push(CA(s)))}),t},NA=(e,t)=>{const s=[];return Object.keys(t||{}).forEach(a=>{(t[a]||[]).forEach(c=>{s.push({user_id:e,plan_date:a,recipe_id:Go(c.recipeId),meal_type:c.type||"dinner",note:c.note||"",multiplier:Fr(c.multiplier,1),total_weight:Fr(c.totalWeight,null)})})}),s},AA=e=>({...e,date_str:e.plan_date,type:e.meal_type}),TA=e=>{const{date_str:t,type:s,...a}=e;return a},_m=async e=>{if(!e||e.length===0)return;const t=e.map(AA);let{error:s}=await Ae.from(na).insert(t);if(s&&(Xp(s,"date_str")||Xp(s,"type"))){const a=t.map(TA);({error:s}=await Ae.from(na).insert(a))}if(s)throw s},Gx=e=>SA.test(String(e||"")),ec=e=>{if(e==null||e==="")return"";if(typeof e=="number")return String(e);const t=Number(e);return Number.isFinite(t)?String(t):String(e)},Cd=(e,t)=>{const s=ec(t?.recipeId),a=ec(t?.type||"dinner"),o=ec(t?.note||""),c=ec(Fr(t?.multiplier,1)),u=ec(Fr(t?.totalWeight,null));return`${e}|${s}|${a}|${o}|${c}|${u}`},RA=(e,t)=>{const s={};Object.keys(e||{}).forEach(o=>{s[o]=[...e[o]||[]]});const a=new Set;return Object.keys(e||{}).forEach(o=>{(e[o]||[]).forEach(c=>{a.add(Cd(o,c))})}),Object.keys(t||{}).forEach(o=>{(t[o]||[]).forEach(u=>{const h=Cd(o,u);a.has(h)||(s[o]||(s[o]=[]),s[o].push(u),a.add(h))})}),s},OA=(e,t,s)=>{const a={...e||{}};return a[t]||(a[t]=[]),a[t]=[...a[t],s],a},DA=(e,t,s)=>{const a={...e||{}};return a[t]&&(a[t]=(a[t]||[]).filter(o=>String(o.id)!==String(s)),a[t].length===0&&delete a[t]),a},LA=(e,t,s,a)=>{const o={...e||{}};return o[t]&&(o[t]=o[t].map(c=>String(c.id)!==String(s)?c:{...c,...a})),o},zA=(e,t,s)=>{const a={...e||{}};return Object.keys(a).forEach(o=>{o>=t&&o<=s&&delete a[o]}),a},IA=(e,t)=>{const s=new Set((t||[]).map(u=>String(u))),a={},o=[];let c=!1;return Object.keys(e||{}).forEach(u=>{const h=e[u]||[],f=h.filter(p=>{const m=s.has(String(p.recipeId));return m||o.push(String(p.id)),m});f.length>0&&(a[u]=f),f.length!==h.length&&(c=!0)}),{nextPlans:c?a:e,invalidIds:o,hasChanges:c}},wm=async e=>{const{data:t,error:s}=await Ae.from(na).select("id, plan_date, recipe_id, meal_type, note, multiplier, total_weight, created_at").eq("user_id",e).order("plan_date",{ascending:!0}).order("created_at",{ascending:!0});if(s)throw s;return EA(t||[])},MA=async(e,t)=>{const s=NA(e,t);return s.length===0?null:(await _m(s),wm(e))},UA=async(e,t)=>{const s=Qi(e);if(!Object.keys(s).some(h=>(s[h]||[]).some(f=>!Gx(f?.id))))return t;const o=new Set;Object.keys(t||{}).forEach(h=>{(t[h]||[]).forEach(f=>{o.add(Cd(h,f))})});const c=[];Object.keys(s||{}).forEach(h=>{(s[h]||[]).forEach(f=>{if(Gx(f?.id))return;const p=Cd(h,f);o.has(p)||(c.push({user_id:e,plan_date:h,recipe_id:Go(f.recipeId),meal_type:f.type||"dinner",note:f.note||"",multiplier:Fr(f.multiplier,1),total_weight:Fr(f.totalWeight,null)}),o.add(p))})}),c.length>0&&await _m(c);const u=await wm(e);return Es(e,u),u},ps={consumeWarnings:()=>{const e=[...Zi];return Zi.length=0,e},getAll:async e=>{if(!e)return{};try{const t=await wm(e);if(Object.keys(t).length===0){const s=Qi(e);if(Object.keys(s).length>0)try{const a=await MA(e,s);if(a)return Es(e,a),a}catch{return Yi(Wi),Es(e,s),s}}try{const s=await UA(e,t);return Es(e,s),s}catch(s){console.warn("plannerService.getAll: failed to sync local fallback meals",s),Yi(Wi);const a=Qi(e),o=RA(t,a);return Es(e,o),o}}catch(t){return console.warn("plannerService.getAll: falling back to localStorage",t),Yi(Wi),Qi(e)}},cleanupInvalidPlans:async(e,t)=>{if(!e)return{};if(!Array.isArray(t)||t.length===0)return ps.getAll(e);const s=await ps.getAll(e),{nextPlans:a,invalidIds:o,hasChanges:c}=IA(s,t);if(!c)return s;try{if(o.length>0)for(let h=0;h<o.length;h+=200){const f=o.slice(h,h+200),{error:p}=await Ae.from(na).delete().eq("user_id",e).in("id",f);if(p)throw p}}catch(u){console.warn("plannerService.cleanupInvalidPlans: delete fallback to localStorage",u),Yi(Wi)}return Es(e,a),a},addMeal:async(e,t,s,a,o={})=>{if(!e)return null;const c={id:jA(),recipeId:Go(s),type:a||"dinner",note:"",multiplier:Fr(o?.multiplier,1),totalWeight:Fr(o?.totalWeight,null)},u=Qi(e),h=OA(u,t,c);Es(e,h);try{const f={user_id:e,plan_date:t,recipe_id:Go(s),meal_type:a||"dinner",note:"",multiplier:Fr(o?.multiplier,1),total_weight:Fr(o?.totalWeight,null)};return await _m([f]),c}catch(f){return console.warn("plannerService.addMeal: insert fallback to localStorage",f),Yi(Wi),c}},removeMeal:async(e,t,s)=>{if(!e)return;try{const{error:c}=await Ae.from(na).delete().eq("id",String(s)).eq("user_id",e);if(c)throw c}catch(c){console.warn("plannerService.removeMeal: delete fallback to localStorage",c),Yi(Wi)}const a=Qi(e),o=DA(a,t,s);Es(e,o)},updateMeal:async(e,t,s,a)=>{if(!e)return;const o={};Object.prototype.hasOwnProperty.call(a,"recipeId")&&(o.recipe_id=Go(a.recipeId)),Object.prototype.hasOwnProperty.call(a,"type")&&(o.meal_type=a.type||"dinner",o.type=o.meal_type),Object.prototype.hasOwnProperty.call(a,"note")&&(o.note=a.note||""),Object.prototype.hasOwnProperty.call(a,"multiplier")&&(o.multiplier=Fr(a.multiplier,1)),Object.prototype.hasOwnProperty.call(a,"totalWeight")&&(o.total_weight=Fr(a.totalWeight,null));try{if(Object.keys(o).length>0){let{error:h}=await Ae.from(na).update(o).eq("id",String(s)).eq("user_id",e);if(h&&Xp(h,"type")){const{type:f,...p}=o;({error:h}=await Ae.from(na).update(p).eq("id",String(s)).eq("user_id",e))}if(h)throw h}}catch(h){console.warn("plannerService.updateMeal: update fallback to localStorage",h),Yi(Wi)}const c=Qi(e),u=LA(c,t,s,a);Es(e,u)},clearPeriod:async(e,t,s)=>{if(!e)return;try{const{error:c}=await Ae.from(na).delete().eq("user_id",e).gte("plan_date",t).lte("plan_date",s);if(c)throw c}catch(c){console.warn("plannerService.clearPeriod: delete fallback to localStorage",c),Yi(Wi)}const a=Qi(e),o=zA(a,t,s);Es(e,o)}},BA=["g","kg","ml","cc","l","cl"],Yo=e=>(e??"").toString().trim(),R_=e=>{const t=Yo(e);if(!t)return"";const s=t.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s===""?"cl":s},PA=e=>{const t=Yo(e);return t?["","","","","","","","PC","pc",""].includes(t):!1},rc=(e,t)=>{const s=parseFloat(e)||0,a=R_(t);return a==="kg"?{qty:s*1e3,unit:"g"}:a==="g"?{qty:s,unit:"g"}:a==="l"?{qty:s*1e3,unit:"ml"}:a==="cc"?{qty:s,unit:"ml"}:a==="ml"?{qty:s,unit:"ml"}:a==="cl"?{qty:s*10,unit:"ml"}:{qty:s,unit:Yo(t)||""}},Kx=(e,t,s,a)=>{const o=Yo(s),c=parseFloat(t)||0;if(!a)return rc(c,o);const u=parseFloat(a.packetSize),h=R_(a.packetUnit);if(!Number.isFinite(u)||u<=0||!h)return rc(c,o);if(BA.includes(h)&&PA(o)){const p=c*u;return rc(p,h)}return rc(c,o)},Zp={async calculateShortages(e,t,s,a={}){if(!e?.id)throw new Error("User required");const o=a?.includeRecipeBreakdown===!0,c=await ps.getAll(e.id),u=new Date(t),h=new Date(s);h.setHours(23,59,59,999);const f=[];if(Object.keys(c).forEach(F=>{const $=new Date(F);$>=u&&$<=h&&c[F].forEach(M=>{f.push(M)})}),f.length===0)return o?{items:[],recipeBreakdown:[]}:[];const[p,m,g,x,v]=await Promise.all([An.fetchRecipes(e),Ln.getAllConversions(),Fn.fetchPriceList(e.id),yr.getAll(e.id),jd.getAll(e.id)]),S=new Map;p.forEach(F=>S.set(F.id,F));const w=new Map;try{for(const[F,$]of(m||new Map).entries()){const M=Jt(F);M&&(w.has(M)||w.set(M,$))}}catch{}const _=new Map;try{for(const[F,$]of(v||new Map).entries()){const M=Jt(F);M&&(_.has(M)||_.set(M,$))}}catch{}const j=new Map;try{(x||[]).forEach(F=>{const $=Jt(F?.name);$&&(j.has($)||j.set($,F))})}catch{}const E={},T=new Map;f.forEach(F=>{const $=S.get(F.recipeId);if(!$)return;let M=null;if(o){const O=String($.id);T.has(O)||T.set(O,{recipeId:$.id,recipeTitle:$.title||`Recipe ${$.id}`,itemMap:new Map}),M=T.get(O)}let z=1;if(F.totalWeight&&F.totalWeight>0){let O=0;($.ingredients||[]).forEach(q=>{const{qty:C,unit:I}=rc(q.quantity,q.unit);(I==="g"||I==="ml")&&(O+=C)}),O>0&&(z=F.totalWeight/O)}else F.multiplier&&F.multiplier>0&&(z=F.multiplier);[...$.ingredients||[]].forEach(O=>{if(!O.name)return;const q=Yo(O.name),C=Jt(q),I=(C?w.get(C):null)||m?.get(q)||null,L=(parseFloat(O.quantity)||0)*z,V=Kx(q,L,O.unit,I),G=V.qty||0,Y=V.unit||"";if(E[q]||(E[q]={quantity:0,unit:Y,count:0}),E[q].quantity+=G,o&&M){const Z=C||q,A=M.itemMap.get(Z);A?(A.required+=G,!A.unit&&Y&&(A.unit=Y)):M.itemMap.set(Z,{ingredientKey:Z,name:q,required:G,unit:Y})}})});const R=Object.keys(E).map(F=>{const $=E[F],M=Jt(F),z=(M?w.get(M):null)||m?.get(F)||null,P=M&&g?.get(M)||null,H=M&&j.get(M)||null,O=Kx(F,H?.quantity??0,H?.unit??$.unit,z),q=$.quantity||0,C=O.qty||0,I=$.unit||O.unit||"",L=C-q,V=parseFloat(z?.packetSize),G=Yo(z?.packetUnit),Y=Number.isFinite(V)&&V>0&&!!G,Z=Y?V*.2:0,A=Y?L<Z:!1,U=P?.unit?String(P.unit).trim():"",X=M&&_.has(M)?String(_.get(M)).trim():"",se=X||""||U||""||"",oe=(z?.lastPrice!==null&&z?.lastPrice!==void 0&&z?.lastPrice!==""?parseFloat(z.lastPrice):null)??(P?.price!==null&&P?.price!==void 0?parseFloat(P.price):null);let Ce=null,ue=0,ne=I;if(Y){const Le=Math.max(0,Z-L);Ce=Math.ceil(Le/V),A&&Ce<1&&(Ce=1),ue=Ce,ne=se}else ue=Math.max(0,q-C),ne=I;const we=Y?A:ue>.01;return{name:F,required:q,stock:C,remaining:L,unit:I,shouldShow:we,toOrder:ue,orderUnit:ne,orderPacks:Ce,packSize:Y?V:null,packUnit:Y?G:null,packPrice:Number.isFinite(oe)?oe:null,vendor:P?.vendor||H?.vendor||""}}).filter(F=>F.shouldShow);if(!o)return R;const B=Array.from(T.values()).map(F=>({recipeId:F.recipeId,recipeTitle:F.recipeTitle,items:Array.from(F.itemMap.values()).filter($=>Number($.required||0)>1e-4)}));return{items:R,recipeBreakdown:B}}},Xu=e=>String(e||"").replace(/\.json$/i,""),$A=e=>{if(!e)return"-";const t=new Date(e);if(Number.isNaN(t.getTime()))return String(e);const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),u=String(t.getMinutes()).padStart(2,"0");return`${s}/${a}/${o} ${c}:${u}`},qA=({onBack:e})=>{const{user:t}=xs(),[s,a]=jc(),[o,c]=Ue.useState(!0),[u,h]=Ue.useState(""),[f,p]=Ue.useState([]),[m,g]=Ue.useState(new Set),[x,v]=Ue.useState({items:[]}),[S,w]=Ue.useState([]),[_,j]=Ue.useState(null),[E,T]=Ue.useState("need_order"),[R,B]=Ue.useState(!1),[F,$]=Ue.useState(null),[M,z]=Ue.useState(""),[P,H]=Ue.useState(!1),O=Ue.useCallback(async()=>{c(!0),h("");try{const re=new Date,ee=new Date(re);ee.setDate(re.getDate()+7);const[le,ye,qe,Re]=await Promise.all([Rs.listJsonFiles(),hi.listAppliedBaseNames(),hi.loadStock(),t?.id?Zp.calculateShortages(t,re.toISOString(),ee.toISOString()):Promise.resolve([])]);p(le||[]),g(ye||new Set),v(qe||{items:[]}),w(Re||[])}catch(re){console.error(re),h(re?.message||String(re))}finally{c(!1)}},[t]);Ue.useEffect(()=>{O()},[O]);const q=Ue.useMemo(()=>{const re=new Map;return(S||[]).forEach(ee=>{const le=`${ee.vendor||""}@@${ee.name}@@${ee.unit||""}`;re.set(le,{...ee,quantity:ee.stock,isShortage:!0,reason:` (: ${ee.required.toFixed(1)}${ee.unit})`})}),(x?.items||[]).forEach(ee=>{if((ee.quantity||0)<=0){const le=`${ee.vendor||""}@@${ee.name}@@${ee.unit||""}`;re.has(le)||re.set(le,{...ee,isShortage:!1})}}),Array.from(re.values()).sort((ee,le)=>ee.isShortage!==le.isShortage?ee.isShortage?-1:1:(ee.vendor||"").localeCompare(le.vendor||""))},[S,x]),C=async re=>{const ee=Xu(re);j(ee),h("");try{const le=await Rs.downloadJson(re);(await hi.applyDeliverySet({baseName:ee,parsed:le}))?.status==="already_applied"&&h("PDF"),await O()}catch(le){console.error(le),h(le?.message||String(le))}finally{j(null)}},I=async()=>{j("all"),h("");try{const re=await Rs.listJsonFiles(),ee=await hi.listAppliedBaseNames();for(const le of re||[]){const ye=le?.name;if(!ye)continue;const qe=Xu(ye);if(ee.has(qe))continue;const Re=await Rs.downloadJson(ye);(await hi.applyDeliverySet({baseName:qe,parsed:Re}))?.status==="applied"&&ee.add(qe)}await O()}catch(re){console.error(re),h(re?.message||String(re))}finally{j(null)}},L=re=>{$(re),z(""),B(!0),h("")},V=re=>{z(ee=>{const ye=(parseFloat(ee)||0)+re;return String(Math.round(ye*1e3)/1e3)})},G=async()=>{if(!F)return;const re=Number(M);if(!M||isNaN(re)||re<=0){h("");return}H(!0),h("");try{await hi.updateStockItem({name:F.name,unit:F.unit,vendor:F.vendor,delta:-re}),await O(),B(!1),$(null)}catch(ee){console.error(ee),h(ee?.message||String(ee))}finally{H(!1)}},[Y,Z]=Ue.useState(!1),[A,U]=Ue.useState(null),[X,se]=Ue.useState(!1),[oe,Ce]=Ue.useState(!1),[ue,ne]=Ue.useState(!1),we=re=>{U(re),Z(!0),h("")},Le=async()=>{if(A){se(!0),h("");try{await hi.deleteStockItem({name:A.name,unit:A.unit,vendor:A.vendor}),await O(),Z(!1),U(null)}catch(re){console.error(re),h(": "+(re.message||String(re)))}finally{se(!1)}}},[ge,Te]=Ue.useState(!1),[de,N]=Ue.useState(null),[ve,fe]=Ue.useState(!1),Q=re=>{const ee=Xu(re.name);N({name:re.name,baseName:ee}),Te(!0),h("")},K=async()=>{if(de){fe(!0),h("");try{await Rs.deleteDeliverySet(de.baseName),await hi.deleteAppliedMarker(de.baseName),await O(),Te(!1),N(null)}catch(re){console.error(re),h("PDF: "+(re.message||String(re)))}finally{fe(!1)}}},ie=async()=>{ne(!0),h("");try{await hi.clearStock(),await O(),Ce(!1)}catch(re){console.error(re),h(": "+(re.message||String(re)))}finally{ne(!1)}};return r.jsxs("div",{className:"incoming-stock",children:[r.jsxs("div",{className:"incoming-stock__header",children:[r.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsx(ce,{variant:"secondary",onClick:()=>a({view:"incoming-deliveries"}),children:" PDF"}),r.jsx(ce,{variant:"ghost",onClick:e,children:" "})]})]}),u&&r.jsx(vn,{className:"incoming-stock__error",children:u}),r.jsxs(vn,{className:"incoming-stock__card",children:[r.jsxs("div",{className:"incoming-stock__card-head",children:[r.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[r.jsx(ce,{variant:"secondary",onClick:O,disabled:o||!!_,children:""}),r.jsx(ce,{variant:"primary",onClick:I,disabled:o||!!_,children:_==="all"?"":""}),r.jsx(ce,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:()=>Ce(!0),disabled:o||!!_||!x?.items?.length,children:" "})]})]}),o?r.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):f.length===0?r.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):r.jsx("div",{className:"incoming-stock__file-list",children:f.map(re=>{const ee=Xu(re?.name),le=m.has(ee);return r.jsxs("div",{className:"incoming-stock__file-row",children:[r.jsxs("div",{className:"incoming-stock__file-info",children:[r.jsx("div",{style:{fontWeight:700},children:ee}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",$A(re.updated_at||re.created_at)]})]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[le?r.jsx("span",{className:"incoming-stock__badge",children:""}):r.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),r.jsx(ce,{variant:le?"secondary":"primary",size:"sm",onClick:()=>C(re.name),disabled:!!_||le,children:_===ee?"":le?"":""}),r.jsx(ce,{variant:"ghost",size:"sm",style:{color:"#d32f2f",marginLeft:"4px"},onClick:()=>Q(re),disabled:!!_,title:"PDF",children:""})]})]},re.name)})}),!o&&r.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",r.jsx("strong",{children:m.size}),"  / PDF: ",r.jsx("strong",{children:f.length})," "]})]}),r.jsxs(vn,{className:"incoming-stock__card",children:[r.jsx("div",{className:"incoming-stock__card-head",children:r.jsx("h3",{className:"incoming-stock__section-title",children:""})}),r.jsxs("div",{className:"incoming-stock__tabs",children:[r.jsxs("button",{className:`incoming-stock__tab-button ${E==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>T("need_order"),children:[" ",r.jsx("span",{className:"incoming-stock__tab-count",children:q.length})]}),Array.from(new Set((x?.items||[]).map(re=>re.vendor||""))).sort().map(re=>r.jsx("button",{className:`incoming-stock__tab-button ${E===re?"incoming-stock__tab-button--active":""}`,onClick:()=>T(re),children:re},re))]}),(()=>{let re=[];if(E==="need_order")re=q;else{const ee=E===""?"":E;re=(x?.items||[]).filter(le=>(le.vendor||"")===ee)}return re.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:E==="need_order"?"0":""}):r.jsx("div",{className:"incoming-stock__table-wrap",children:r.jsxs("table",{className:"incoming-stock__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"45%"},children:"/"}),r.jsx("th",{style:{width:"25%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"10%"},children:""}),r.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),r.jsx("tbody",{children:re.map(ee=>r.jsxs("tr",{style:ee.isShortage?{backgroundColor:"#fff5f5"}:{},children:[r.jsxs("td",{children:[r.jsxs("div",{style:{fontWeight:500},children:[ee.name,ee.isShortage&&r.jsx("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#d32f2f",border:"1px solid #d32f2f",borderRadius:"4px",padding:"1px 4px",verticalAlign:"middle"},children:""})]}),ee.reason&&r.jsxs("div",{style:{fontSize:"0.8rem",color:"#d32f2f",marginTop:"2px"},children:[ee.reason,"  : ",ee.toOrder,ee.orderUnit]}),!ee.reason&&E==="need_order"&&ee.vendor&&r.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:ee.vendor})]}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(ee.quantity||0)<=0||ee.isShortage?"#d32f2f":"inherit"},children:Number.isFinite(ee.quantity)?ee.quantity:"-"}),r.jsx("td",{children:ee.unit||"-"}),r.jsx("td",{style:{textAlign:"center"},children:r.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[r.jsx(ce,{variant:"secondary",size:"sm",onClick:()=>L(ee),children:"/"}),r.jsx(ce,{variant:"ghost",size:"sm",style:{color:"#d32f2f"},onClick:()=>we(ee),children:""})]})})]},`${ee.vendor}@@${ee.name}@@${ee.unit||""}`))})]})})})()]}),r.jsx(an,{isOpen:R,onClose:()=>B(!1),title:"",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsx("div",{style:{fontWeight:"bold"},children:F?.name})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsxs("div",{children:[F?.quantity," ",F?.unit]})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx(zt,{type:"text",inputMode:"decimal",value:M,onChange:re=>z(re.target.value),readOnly:!0,placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px",textAlign:"center",backgroundColor:"#f9f9f9",cursor:"default"}}),r.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:F?.unit})]}),r.jsxs("div",{className:"incoming-stock__calc-grid",children:[r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(.001),children:"+0.001"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(.01),children:"+0.01"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(.1),children:"+0.1"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(.5),children:"+0.5"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>V(1),children:"+1"}),r.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>z(""),children:""})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>B(!1),disabled:P,children:""}),r.jsx(ce,{variant:"primary",onClick:G,disabled:P||!M,children:P?"":""})]})]})}),r.jsx(an,{isOpen:Y,onClose:()=>Z(!1),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",A?.name,"",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.85rem",color:"#666"},children:""})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>Z(!1),disabled:X,children:""}),r.jsx(ce,{variant:"danger",onClick:Le,disabled:X,children:X?"":""})]})]})}),r.jsx(an,{isOpen:ge,onClose:()=>Te(!1),title:"PDF",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",de?.baseName,""]}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>Te(!1),disabled:ve,children:""}),r.jsx(ce,{variant:"danger",onClick:K,disabled:ve,children:ve?"":""})]})]})}),r.jsx(an,{isOpen:oe,onClose:()=>Ce(!1),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsx("p",{style:{marginTop:0,fontWeight:"bold",color:"#d32f2f"},children:""}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["PDF",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>Ce(!1),disabled:ue,children:""}),r.jsx(ce,{variant:"danger",onClick:ie,disabled:ue,children:ue?"":""})]})]})}),r.jsx(an,{isOpen:!!_,onClose:()=>{},title:"",size:"small",showCloseButton:!1,children:r.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[r.jsx("div",{className:"incoming-stock__spinner"}),r.jsx("p",{style:{margin:"0 0 8px",fontWeight:"bold"},children:"PDF..."}),r.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",margin:0},children:[_==="all"?"":"",r.jsx("br",{}),""]})]})})]})},O_=e=>{const{totalWeight:t,multiplier:s}=e||{};return t?`${t}g`:s&&s!==1?`x${s}`:""},FA=({recipe:e})=>{const{attributes:t,listeners:s,setNodeRef:a,transform:o,isDragging:c}=mm({id:`recipe-${e.id}`,data:{recipe:e}}),u=c?{opacity:.35}:o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,position:"relative",zIndex:999}:void 0;return r.jsx("div",{ref:a,style:u,...s,...t,className:"draggable-recipe",children:e.title})},VA=({meal:e,dateStr:t,children:s})=>{const{attributes:a,listeners:o,setNodeRef:c,transform:u,isDragging:h}=mm({id:`meal-${e.id}`,data:{meal:e,dateStr:t,type:"meal"}}),f=h?{opacity:.35}:u?{transform:`translate3d(${u.x}px, ${u.y}px, 0)`,position:"relative",zIndex:999}:void 0,p=O_(e);return r.jsxs("div",{ref:c,style:f,...o,...a,className:"draggable-meal-wrapper",children:[s,p&&r.jsx("div",{style:{position:"absolute",bottom:"2px",right:"4px",fontSize:"0.75rem",fontWeight:"bold",color:"#666",backgroundColor:"rgba(255,255,255,0.8)",padding:"0 2px",borderRadius:"2px",pointerEvents:"none"},children:p})]})},HA=({dateStr:e,dayNum:t,isToday:s,isOutside:a,children:o})=>{const{setNodeRef:c,isOver:u}=Ac({id:`date-${e}`,data:{dateStr:e}});return r.jsxs("div",{ref:c,className:`calendar-cell ${s?"today":""} ${a?"outside-month":""}`,style:{backgroundColor:u?"#ffe0b2":void 0},children:[r.jsx("div",{className:"day-number",children:t}),o]})},Oo=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,GA=({onBack:e,onSelectRecipe:t,onNavigateToOrderList:s})=>{const{user:a}=xs(),o=qs(),c=k.useRef(o),[u,h]=k.useState([]),[f,p]=k.useState({}),[m,g]=k.useState(new Date),[x,v]=k.useState(""),[S,w]=k.useState(!1),[_,j]=k.useState(null),[E,T]=k.useState(!1),[R,B]=k.useState(null),[F,$]=k.useState(1),[M,z]=k.useState(""),[P,H]=k.useState(null),[O,q]=k.useState(!1),[C,I]=k.useState(Oo(new Date)),[L,V]=k.useState(Oo(new Date)),G=Pa(Or(tl,{activationConstraint:{distance:6}}),Or(nl,{activationConstraint:{delay:70,tolerance:8}}));k.useEffect(()=>{c.current=o},[o]);const Y=k.useCallback(()=>{const N=ps.consumeWarnings?.()||[];N.length!==0&&[...new Set(N)].forEach(ve=>{c.current.warning(ve)})},[]),Z=k.useCallback(async()=>{if(!a){h([]),p({});return}let N=[];try{N=await An.fetchRecipes(a)}catch(ve){console.error("Planner: failed to fetch recipes",ve),c.current.error(""),N=[]}if(h(N),a?.id)try{let ve;if(Array.isArray(N)&&N.length>0){const fe=N.map(Q=>Q.id);ve=await ps.cleanupInvalidPlans(a.id,fe)}else ve=await ps.getAll(a.id);p(ve)}finally{Y()}},[Y,a]);k.useEffect(()=>{const N=setTimeout(()=>{Z()},0);return()=>clearTimeout(N)},[Z]);const A=k.useCallback(N=>{const ve=N?.active;if(!ve?.id){H(null);return}const fe=String(ve.id);if(fe.startsWith("recipe-")){const Q=ve.data.current?.recipe;H({kind:"recipe",title:Q?.title||"",qtyStr:""});return}if(fe.startsWith("meal-")){const Q=ve.data.current?.meal,K=u.find(ie=>ie.id===Q?.recipeId);H({kind:"meal",title:K?.title||"Unknown",qtyStr:O_(Q)});return}H(null)},[u]),U=k.useCallback(()=>{H(null)},[]),X=async N=>{const{active:ve,over:fe}=N;try{if(!fe)return;if(fe.id.startsWith("date-")){const Q=fe.data.current.dateStr;if(ve.id.startsWith("recipe-")){const K=ve.data.current.recipe;B({type:"new",recipe:K,targetDateStr:Q}),$(1),z(""),T(!0)}else if(ve.id.startsWith("meal-")){const{meal:K,dateStr:ie}=ve.data.current;if(ie===Q)return;const re={multiplier:K.multiplier,totalWeight:K.totalWeight};await ps.addMeal(a.id,Q,K.recipeId,K.type||"dinner",re),await ps.removeMeal(a.id,ie,K.id),Z()}}}finally{H(null)}},se=async()=>{if(!R)return;const{type:N,recipe:ve,targetDateStr:fe}=R;if(N==="new"){const Q={};if(ve.type==="bread"){const K=parseFloat(M);Q.totalWeight=Number.isFinite(K)?K:null,Q.multiplier=1}else{const K=parseFloat(F);Q.multiplier=Number.isFinite(K)?K:1,Q.totalWeight=null}await ps.addMeal(a.id,fe,ve.id,"dinner",Q)}T(!1),B(null),Z()},oe=()=>{T(!1),B(null)},Ce=async(N,ve,fe)=>{fe&&fe.stopPropagation(),j({dateStr:N,mealId:ve}),w(!0)},ue=async()=>{if(!_)return;const{dateStr:N,mealId:ve}=_;w(!1),j(null);try{await ps.removeMeal(a.id,N,ve),await Z(),o.success("")}catch(fe){o.error(""),console.error("Delete meal error:",fe)}},ne=()=>{w(!1),j(null)},we=()=>{I(Oo(new Date)),V(Oo(new Date)),q(!0)},Le=async()=>{if(a?.id)try{await ps.clearPeriod(a.id,C,L),await Z(),q(!1),o.success(`${C}${L}`)}catch(N){console.error(N),o.error("")}},ge=()=>{const N=m.getFullYear(),ve=m.getMonth(),fe=new Date(N,ve,1),Q=new Date(N,ve+1,0),K=[],ie=fe.getDay();for(let ee=ie-1;ee>=0;ee--){const le=new Date(N,ve,-ee);K.push({date:le,isOutside:!0})}for(let ee=1;ee<=Q.getDate();ee++){const le=new Date(N,ve,ee);K.push({date:le,isOutside:!1})}const re=42-K.length;for(let ee=1;ee<=re;ee++){const le=new Date(N,ve+1,ee);K.push({date:le,isOutside:!0})}return K},Te=u.filter(N=>N.title.toLowerCase().includes(x.toLowerCase())),de=N=>{g(new Date(m.getFullYear(),m.getMonth()+N,1))};return r.jsxs("div",{className:`planner-container fade-in ${P?"dragging":""}`,children:[S&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(vn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("strong",{children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:ne,children:""}),r.jsx(ce,{variant:"danger",onClick:ue,children:""})]})]})}),O&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(vn,{style:{width:"90%",maxWidth:"500px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("strong",{children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1.5rem"},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),r.jsx(zt,{type:"date",value:C,onChange:N=>I(N.target.value)})]}),r.jsx("span",{style:{paddingTop:"24px"},children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),r.jsx(zt,{type:"date",value:L,onChange:N=>V(N.target.value)})]})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>q(!1),children:""}),r.jsx(ce,{variant:"danger",onClick:Le,children:""})]})]})}),E&&R&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(vn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",backgroundColor:"white"},children:[r.jsx("h3",{style:{marginTop:0},children:R.recipe.type==="bread"?"":""}),r.jsx("p",{style:{margin:"1rem 0",color:"#666"},children:R.recipe.title}),r.jsx("div",{style:{marginBottom:"1.5rem"},children:R.recipe.type==="bread"?r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:" (g)"}),r.jsx(zt,{type:"number",value:M,onChange:N=>z(N.target.value),placeholder:": 1200",autoFocus:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:" "})]}):r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:""}),r.jsx(zt,{type:"number",step:"0.1",value:F,onChange:N=>$(N.target.value),placeholder:": 1, 1.5, 2",autoFocus:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:"  (1 = )"})]})}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[r.jsx(ce,{variant:"ghost",onClick:oe,children:""}),r.jsx(ce,{variant:"primary",onClick:se,children:""})]})]})}),r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions",children:[r.jsx(ce,{variant:"secondary",onClick:s,style:{marginRight:"8px"},children:" "}),r.jsx(ce,{variant:"danger",onClick:we,style:{marginRight:"8px"},children:" "}),r.jsx(ce,{variant:"ghost",onClick:e,children:" "})]})]}),r.jsxs(ra,{sensors:G,onDragStart:A,onDragCancel:U,onDragEnd:X,autoScroll:!0,children:[r.jsxs("div",{className:"planner-layout",children:[r.jsxs("div",{className:"recipe-sidebar",children:[r.jsx("div",{className:"sidebar-search",children:r.jsx(zt,{placeholder:"...",value:x,onChange:N=>v(N.target.value)})}),r.jsx("div",{className:"draggable-list",children:Te.map(N=>r.jsx(FA,{recipe:N},N.id))})]}),r.jsxs("div",{className:"planner-calendar",children:[r.jsxs("div",{className:"calendar-header",children:[r.jsx(ce,{variant:"ghost",onClick:()=>de(-1),children:" "}),r.jsxs("h3",{style:{margin:0},children:[m.getFullYear()," ",m.getMonth()+1,""]}),r.jsx(ce,{variant:"ghost",onClick:()=>de(1),children:" "})]}),r.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(N=>r.jsx("div",{className:"calendar-day-header",children:N},N)),ge().map((N,ve)=>{const fe=Oo(N.date),Q=f[fe]||[],K=fe===Oo(new Date);return r.jsx(HA,{dateStr:fe,dayNum:N.date.getDate(),isToday:K,isOutside:N.isOutside,children:Q.map(ie=>{const re=u.find(ee=>ee.id===ie.recipeId);return r.jsx(VA,{meal:ie,dateStr:fe,children:r.jsxs("div",{className:"planned-meal",title:re?.title,onClick:()=>re&&t&&t(re),children:[r.jsx("span",{children:re?.title||"Unknown"}),r.jsx("span",{className:"delete-meal-btn",onPointerDown:ee=>{ee.stopPropagation()},onClick:ee=>Ce(fe,ie.id,ee),children:""})]})},ie.id)})},ve)})]})]})]}),r.jsx(ym,{children:P?r.jsxs("div",{className:`drag-overlay-card ${P.kind==="meal"?"meal":""}`,children:[r.jsx("span",{className:"drag-overlay-title",children:P.title}),P.qtyStr&&r.jsx("span",{className:"drag-overlay-qty",children:P.qtyStr})]}):null})]})]})},KA=({onBack:e,onNavigateToPlanner:t})=>{const{user:s}=xs(),a=qs(),[o,c]=k.useState(new Date().toISOString().slice(0,10)),[u,h]=k.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[f,p]=k.useState([]),[m,g]=k.useState([]),[x,v]=k.useState(!1),[S,w]=k.useState(!1),[_,j]=k.useState(!1),[E,T]=k.useState(!1);Ue.useEffect(()=>{window.plannerService=ps,window.shortageService=Zp,window.recipeService=An},[]);const R=Ue.useMemo(()=>{const H=new Set;return(f||[]).forEach(O=>{const q=Jt(O?.name);H.add(q||O?.name||"")}),H},[f]),B=Ue.useMemo(()=>{const H=new Map;return(f||[]).forEach(O=>{const q=Jt(O?.name)||O?.name||"";q&&(H.has(q)||H.set(q,O))}),H},[f]),F=async()=>{v(!0);try{if(!s?.id){a.error(""),v(!1);return}const H=await Zp.calculateShortages(s,o,u,{includeRecipeBreakdown:!0}),O=Array.isArray(H)?H:H?.items||[],q=Array.isArray(H)?[]:H?.recipeBreakdown||[];O.length,p(O),g(q),w(!0)}catch(H){console.error(H),a.error(": "+(H.message||String(H)))}finally{v(!1)}},$=()=>{j(!0)},M=()=>{T(!0)},z=()=>f.map(H=>{if(Number.isFinite(H.orderPacks)&&H.orderPacks!==null){const O=H.packSize&&H.packUnit?`1${H.orderUnit}=${H.packSize}${H.packUnit}`:"";return`${H.name}: ${H.orderPacks}${H.orderUnit}${O}`}return`${H.name}: ${Number(H.toOrder||0).toFixed(1)}${H.unit}`}).join(`
`),P=async()=>{const H=document.getElementById("copy-textarea");if(H){H.select();try{await navigator.clipboard.writeText(H.value),a.success("")}catch{document.execCommand("copy"),a.success("")}}};return r.jsxs("div",{className:"order-list-container fade-in",children:[r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions",children:[r.jsx(ce,{variant:"secondary",onClick:t,style:{marginRight:"8px"},children:" "}),r.jsx(ce,{variant:"ghost",onClick:e,children:" "})]})]}),r.jsx("div",{className:"filter-card",children:r.jsxs("div",{className:"date-range-inputs",children:[r.jsxs("div",{children:[r.jsx("label",{children:""}),r.jsx("input",{type:"date",value:o,onChange:H=>c(H.target.value)})]}),r.jsx("span",{children:""}),r.jsxs("div",{children:[r.jsx("label",{children:""}),r.jsx("input",{type:"date",value:u,onChange:H=>h(H.target.value)})]}),r.jsx(ce,{variant:"primary",onClick:F,disabled:x,children:x?"...":""})]})}),S&&r.jsxs("div",{className:"order-results",children:[r.jsxs("div",{className:"results-header",children:[r.jsxs("h3",{children:[" (",f.length,")"]}),r.jsxs("div",{className:"result-actions",children:[r.jsx(ce,{variant:"secondary",onClick:$,children:" "}),r.jsx(ce,{variant:"secondary",onClick:M,children:" "})]})]}),r.jsxs("table",{className:"order-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""})]})}),r.jsx("tbody",{children:f.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):f.map((H,O)=>r.jsxs("tr",{children:[r.jsx("td",{children:H.name}),r.jsxs("td",{style:{textAlign:"right"},children:[H.required.toFixed(1)," ",H.unit]}),r.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,H.remaining??0).toFixed(1)," ",H.unit]}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(H.orderPacks)&&H.orderPacks!==null?r.jsxs(r.Fragment,{children:[H.orderPacks,H.orderUnit,H.packSize&&H.packUnit&&r.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",H.orderUnit," = ",Number(H.packSize).toLocaleString(),H.packUnit,H.packPrice?` / ${Math.round(H.packPrice).toLocaleString()}`:""]})]}):r.jsxs(r.Fragment,{children:[H.toOrder.toFixed(1)," ",r.jsx("span",{style:{fontSize:"0.8em"},children:H.unit})]})})]},O))})]})]}),r.jsx(an,{isOpen:_,onClose:()=>j(!1),title:" ",size:"medium",children:r.jsxs("div",{className:"copy-modal-content",children:[r.jsx("p",{className:"copy-instructions",children:""}),r.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:z(),onClick:H=>H.target.select()}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(ce,{variant:"primary",onClick:P,children:" "}),r.jsx(ce,{variant:"ghost",onClick:()=>j(!1),children:""})]})]})}),r.jsx(an,{isOpen:E,onClose:()=>T(!1),title:" ",size:"large",children:r.jsxs("div",{className:"print-preview-content",children:[r.jsxs("div",{className:"print-preview-header",children:[r.jsx("h3",{children:""}),r.jsxs("p",{className:"print-period",children:[": ",o,"  ",u]})]}),m.length>0&&r.jsxs("div",{className:"recipe-breakdown-print",children:[r.jsx("h4",{children:" "}),m.map((H,O)=>{const q=(H.items||[]).filter(C=>{const I=C.ingredientKey||Jt(C.name)||C.name;return R.has(I)});return q.length===0?null:r.jsxs("section",{className:"recipe-breakdown-section",children:[r.jsx("div",{className:"recipe-breakdown-section-title",children:H.recipeTitle}),r.jsxs("table",{className:"recipe-breakdown-table",children:[r.jsxs("colgroup",{children:[r.jsx("col",{className:"rb-col-name"}),r.jsx("col",{className:"rb-col-required"}),r.jsx("col",{className:"rb-col-stock"}),r.jsx("col",{className:"rb-col-spec"})]}),r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""})]})}),r.jsx("tbody",{children:q.map((C,I)=>{const L=C.ingredientKey||Jt(C.name)||C.name,V=B.get(L),G=V?.unit||C.unit||"",Y=Math.max(0,Number(V?.remaining??0)),Z=(V?.vendor||"").trim(),A=V?.packSize&&V?.packUnit?`1${V.orderUnit||""} = ${Number(V.packSize).toLocaleString()}${V.packUnit}${V.packPrice?` / ${Math.round(V.packPrice).toLocaleString()}`:""}`:"-";return r.jsxs("tr",{children:[r.jsxs("td",{children:[C.name,Z&&r.jsxs("span",{className:"recipe-material-vendor",children:["",Z]})]}),r.jsxs("td",{style:{textAlign:"right"},children:[Number(C.required||0).toFixed(1)," ",C.unit||""]}),r.jsxs("td",{style:{textAlign:"right"},children:[Y.toFixed(1)," ",G]}),r.jsx("td",{style:{textAlign:"right",color:"#666",fontWeight:"normal"},children:A})]},`${C.ingredientKey||C.name||I}-${I}`)})})]})]},`${H.recipeId||H.recipeTitle||O}`)})]}),m.length===0&&r.jsx("p",{style:{margin:0,fontSize:"0.95rem",color:"#374151"},children:""}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(ce,{variant:"primary",onClick:()=>window.print(),children:" "}),r.jsx(ce,{variant:"ghost",onClick:()=>T(!1),children:""})]})]})})]})},nr=(e,t=0)=>{const s=Number(e);return Number.isFinite(s)?s:t},WA=e=>{const t=String(e?.model_name||"").toLowerCase(),s=String(e?.endpoint||"").toLowerCase(),a=e?.metadata&&e.metadata.audio_duration_sec!==void 0,o=t.includes("whisper"),c=s.includes("voice");return o||c||a},YA=e=>String(e?.endpoint||"").toLowerCase().includes("analyze-image"),QA=e=>{const t=String(e?.endpoint||"").toLowerCase(),s=String(e?.metadata?.feature||"").toLowerCase(),a=String(e?.metadata?.source||"").toLowerCase();return t==="call-gemini-api"&&(s==="operation_qa"||a==="operation_assistant")},od=e=>{const t=e?.metadata;if(!t||typeof t!="object")return null;const s=t.billing_breakdown;return!s||typeof s!="object"?null:{model:String(s.model||e?.model_name||""),inputTokens:nr(s.input_tokens,nr(e?.input_tokens,0)),outputTokens:nr(s.output_tokens,nr(e?.output_tokens,0)),inputCostJpy:nr(s.input_cost_jpy,0),outputCostJpy:nr(s.output_cost_jpy,0),totalCostJpy:nr(s.total_cost_jpy,nr(e?.estimated_cost_jpy,0)),inputRatePer1M:nr(s.rate_per_1m_jpy?.input,0),outputRatePer1M:nr(s.rate_per_1m_jpy?.output,0)}},Wx=e=>{const t=od(e);return t?`${t.inputTokens.toLocaleString()}tok  ${t.inputRatePer1M}/100 + ${t.outputTokens.toLocaleString()}tok  ${t.outputRatePer1M}/100 = ${t.totalCostJpy}`:"-"};function JA(){const[e,t]=k.useState([]),[s,a]=k.useState({}),[o,c]=k.useState(!0),[u,h]=k.useState("all"),[f,p]=k.useState({status:"all",dateFrom:"",dateTo:""}),[m,g]=k.useState({totalCalls:0,successRate:0,totalCost:0,totalAudioSec:0,totalInputTokens:0,totalOutputTokens:0,totalInputCost:0,totalOutputCost:0,byApi:{}}),x=[{id:"all",label:""},{id:"voice",label:""},{id:"vision",label:""},{id:"operation",label:"AI"}];k.useEffect(()=>{S()},[f]);const v=k.useMemo(()=>e.filter(R=>u==="all"?!0:u==="voice"?WA(R):u==="vision"?YA(R):u==="operation"?QA(R):!0),[e,u]);k.useEffect(()=>{_(v)},[v]);async function S(){c(!0);try{let R=Ae.from("api_usage_logs").select("*").order("created_at",{ascending:!1}).limit(500);f.status!=="all"&&(R=R.eq("status",f.status)),f.dateFrom&&(R=R.gte("created_at",f.dateFrom)),f.dateTo&&(R=R.lte("created_at",f.dateTo+"T23:59:59"));const{data:B,error:F}=await R;if(F)throw F;t(B||[]),w()}catch(R){console.error(":",R),alert("")}finally{c(!1)}}async function w(){try{const R=await gs.fetchAllProfiles(),B={};Array.isArray(R)&&R.forEach(F=>{F.id&&(B[F.id]=F)}),a(B)}catch(R){console.error("Failed to fetch user profiles for logs",R)}}function _(R){const B=R.length,F=R.filter(q=>q.status==="success").length,$=R.reduce((q,C)=>q+nr(C.estimated_cost_jpy,0),0),M=R.filter(q=>q.metadata?.audio_duration_sec).reduce((q,C)=>q+nr(C.metadata.audio_duration_sec,0),0),z=R.reduce((q,C)=>q+nr(C.input_tokens,0),0),P=R.reduce((q,C)=>q+nr(C.output_tokens,0),0),H=R.reduce((q,C)=>{const I=od(C);return q+(I?nr(I.inputCostJpy,0):0)},0),O=R.reduce((q,C)=>{const I=od(C);return q+(I?nr(I.outputCostJpy,0):0)},0);g({totalCalls:B,successRate:B>0?(F/B*100).toFixed(1):0,totalCost:$.toFixed(2),totalAudioSec:M.toFixed(1),totalInputTokens:z,totalOutputTokens:P,totalInputCost:Number(H.toFixed(4)),totalOutputCost:Number(O.toFixed(4)),byApi:{}})}function j(R){return new Date(R).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function E(R){return{success:" ",error:" ",rate_limited:" "}[R]||R}async function T(){const R=[["","API","","","ID","","(ms)","(/)","","","()","",""].join(",")];v.forEach(z=>{let P="";z.metadata?.audio_duration_sec?P=`${z.metadata.audio_duration_sec}s`:(z.input_tokens||z.output_tokens)&&(P=`${z.input_tokens} ${z.output_tokens}`);const H=Wx(z);R.push([j(z.created_at),z.api_name,z.endpoint,z.model_name||"",z.user_id||"",z.status,z.duration_ms||"",P,z.input_tokens||"",z.output_tokens||"",z.estimated_cost_jpy||"",H.replace(/,/g,""),(z.error_message||"").replace(/,/g,"")].join(","))});const B=R.join(`
`),F=new Blob(["\uFEFF"+B],{type:"text/csv;charset=utf-8;"}),$=URL.createObjectURL(F),M=document.createElement("a");M.href=$,M.download=`api_usage_logs_${u}_${new Date().toISOString().split("T")[0]}.csv`,M.click()}return r.jsxs("div",{className:"api-usage-logs",children:[r.jsxs("div",{className:"logs-header",children:[r.jsx("h1",{children:" API"}),r.jsx("button",{onClick:T,className:"export-btn",children:" CSV"})]}),r.jsx("div",{className:"logs-tabs",children:x.map(R=>r.jsx("button",{className:`log-tab ${u===R.id?"active":""}`,onClick:()=>h(R.id),children:R.label},R.id))}),r.jsx("div",{className:"stats-grid",children:u==="voice"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.totalAudioSec,""]}),r.jsxs("div",{className:"secondary-stat",children:[(m.totalAudioSec/60).toFixed(1),""]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(m.totalCost).toLocaleString()]}),r.jsx("div",{className:"secondary-stat",children:"Whisper large-v3 turbo"})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.successRate,"%"]}),r.jsxs("div",{className:"secondary-stat",children:[m.totalCalls,""]})]})]}):u==="vision"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.totalCalls,""]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",nr(m.totalCost,0).toLocaleString()]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.successRate,"%"]})]})]}):u==="operation"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:"API"}),r.jsxs("div",{className:"stat-value",children:[m.totalCalls.toLocaleString(),""]}),r.jsxs("div",{className:"secondary-stat",children:[m.successRate,"% "]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",m.totalInputTokens.toLocaleString()," / ",m.totalOutputTokens.toLocaleString()]}),r.jsx("div",{className:"secondary-stat",children:" / "})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",nr(m.totalCost,0).toLocaleString()]}),r.jsxs("div",{className:"secondary-stat",children:[" ",nr(m.totalInputCost,0).toLocaleString()," /  ",nr(m.totalOutputCost,0).toLocaleString()]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsx("div",{className:"stat-value",children:m.totalCalls.toLocaleString()})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.successRate,"%"]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",nr(m.totalCost,0).toLocaleString()]})]})]})}),r.jsxs("div",{className:"filters",children:[r.jsxs("select",{value:f.status,onChange:R=>p({...f,status:R.target.value}),children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"success",children:""}),r.jsx("option",{value:"error",children:""}),r.jsx("option",{value:"rate_limited",children:""})]}),r.jsx("input",{type:"date",value:f.dateFrom,onChange:R=>p({...f,dateFrom:R.target.value}),placeholder:""}),r.jsx("input",{type:"date",value:f.dateTo,onChange:R=>p({...f,dateTo:R.target.value}),placeholder:""}),r.jsx("button",{onClick:S,className:"refresh-btn",children:" "})]}),o?r.jsx("div",{className:"loading",children:"..."}):r.jsxs("div",{className:"logs-table-container",children:[r.jsxs("table",{className:"logs-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"API"}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:" (/)"}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:v.map(R=>r.jsxs("tr",{className:`status-${R.status}`,children:[r.jsx("td",{children:j(R.created_at)}),r.jsx("td",{children:r.jsx("span",{className:`api-badge api-${R.api_name}`,children:R.api_name})}),r.jsx("td",{children:R.endpoint}),r.jsx("td",{children:r.jsx("code",{children:R.model_name||"-"})}),r.jsx("td",{children:R.user_email||s[R.user_id]?.email||s[R.user_id]?.display_id||(R.user_id?R.user_id.substring(0,8):"-")}),r.jsx("td",{children:E(R.status)}),r.jsx("td",{children:R.duration_ms?`${R.duration_ms}ms`:"-"}),r.jsx("td",{children:R.metadata&&R.metadata.audio_duration_sec?r.jsxs("span",{className:"audio-sec",children:[" ",Number(R.metadata.audio_duration_sec).toFixed(2),"s"]}):R.input_tokens||R.output_tokens?r.jsxs("span",{className:"tokens",children:[R.input_tokens?`${R.input_tokens}`:"",R.output_tokens?` ${R.output_tokens}`:""]}):"-"}),r.jsx("td",{children:R.estimated_cost_jpy!=null&&R.estimated_cost_jpy!==""?r.jsxs("span",{className:"cost",children:["",Number(R.estimated_cost_jpy)]}):"-"}),r.jsx("td",{children:(()=>{const B=od(R);return B?r.jsxs("div",{className:"cost-breakdown",title:Wx(R),children:[r.jsxs("div",{children:[": ",B.inputTokens.toLocaleString(),"tok  ",B.inputRatePer1M,"/100 = ",B.inputCostJpy]}),r.jsxs("div",{children:[": ",B.outputTokens.toLocaleString(),"tok  ",B.outputRatePer1M,"/100 = ",B.outputCostJpy]}),r.jsxs("div",{className:"cost-breakdown-total",children:[": ",B.totalCostJpy]})]}):"-"})()}),r.jsx("td",{className:"error-cell",children:R.error_message?r.jsxs("span",{className:"error-msg",title:R.error_message,children:[R.error_message.substring(0,50),"..."]}):"-"})]},R.id))})]}),v.length===0&&r.jsx("div",{className:"no-logs",children:""})]})]})}const XA=JSON.parse(`[{"id":"guide_qa_001","title":"","keywords":["","","","","","","","baker's","%","","csv","","","",""],"views":["list","detail","create","edit","data","inventory","planner","order-list","trash"],"steps":[": ",": Baker's %",": CSV",": ",": CSV",": "],"notes":" ","source":"recipe_html","category":"basic"},{"id":"guide_qa_002","title":"","keywords":["","","","","supabase","auth","","","","","",""],"views":["list","detail","create","edit","data","inventory","planner","order-list","trash"],"steps":["Supabase Auth",""],"notes":"Supabase Auth ","source":"recipe_html","category":"basic"},{"id":"guide_qa_003","title":"","keywords":["","","","","","","","","","admin","","","","","","",""],"views":["list","detail","create","edit","data","inventory","planner","order-list","trash"],"steps":[": ","Admin:   "],"notes":"    Admin   ","source":"recipe_html","category":"basic"},{"id":"guide_qa_004","title":"","keywords":["","","","","","","","","",""],"views":["list","detail","create","edit","data","inventory","planner","order-list","trash"],"steps":["","","","","",""],"notes":" ","source":"recipe_html","category":"basic"},{"id":"guide_qa_005","title":"","keywords":["","","","","","","",""],"views":["list","detail","create","edit","data","inventory","planner","order-list","trash"],"steps":["","","","",""],"notes":"PC     ","source":"recipe_html","category":"basic"},{"id":"guide_qa_006","title":"","keywords":["","","","","","","",""," /  / ","","","","","","","",""],"views":["list","detail","create","edit","data","inventory","planner","order-list","trash"],"steps":[": :  /  / ",": : /"],"notes":"    :  /  /   ","source":"recipe_html","category":"basic"},{"id":"guide_qa_007","title":"","keywords":["","","","","","","","","","",""],"views":["list","detail","create","edit","data","inventory","planner","order-list","trash"],"steps":["",""],"notes":" ","source":"recipe_html","category":"basic"},{"id":"guide_qa_008","title":"","keywords":["","","","","web",""," web","url","","","","","","",""],"views":["list","detail","create","edit"],"steps":[" Web","URL","",""],"notes":" URL","source":"recipe_html","category":"translate"},{"id":"guide_qa_009","title":"","keywords":["","","","","","","","sauter","braiser","rduire","","","","","oz","cup","tbsp","","","","","","",""],"views":["list","detail","create","edit"],"steps":[": sauter, braiser, rduire",": oz, cup, tbsp",": "],"notes":" ","source":"recipe_html","category":"translate"},{"id":"guide_qa_010","title":"","keywords":["","","","","","","","","","","","","","","","","",""],"views":["list","detail","create","edit"],"steps":[": ",": ",": "],"notes":" ","source":"recipe_html","category":"translate"},{"id":"guide_qa_011","title":"","keywords":["","","","","","","","","","",""],"views":["list","detail","create","edit"],"steps":["","","",""],"notes":" ","source":"recipe_html","category":"translate"},{"id":"guide_qa_012","title":"","keywords":["","","","url","","","","","","","","","","","","","",""],"views":["list","detail","create","edit"],"steps":[": URL    ",":     ",":     ",":   "],"notes":"    URL                   ","source":"recipe_html","category":"translate"},{"id":"guide_qa_013","title":"","keywords":["","ai","","","","","","","","","","","ai"],"views":["list","create","edit","data"],"steps":["","","","AI: OpenAI Whisper (Groq) "],"notes":" ","source":"recipe_html","category":"ai"},{"id":"guide_qa_014","title":"","keywords":["","","ai","","gemini","flash","","","","pro","","","gpt","4o","openai","","","","","ai"],"views":["list","create","edit","data"],"steps":["Gemini 2.0 Flash: ","Gemini 1.5 Pro: ","GPT-4o: OpenAI"],"notes":" AI","source":"recipe_html","category":"ai"},{"id":"guide_qa_015","title":"","keywords":["","","","","","","","","","","","","12","","","",""],"views":["list","detail","create","edit","trash"],"steps":["","",":  (12)"],"notes":" ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_016","title":"","keywords":["","","","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[": ",": "],"notes":"      ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_017","title":"","keywords":["","","","","","public","","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[" :  public "," :  public "," : "],"notes":" public  ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_018","title":"","keywords":["","","pc","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":["PC: "," / : "],"notes":"PC:   / : ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_019","title":"","keywords":["","","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[": ",":  / "],"notes":" :  :  / ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_020","title":"","keywords":["","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":["",""],"notes":" ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_021","title":"","keywords":["","","","2","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[": 2"],"notes":": 2","source":"recipe_html","category":"recipe"},{"id":"guide_qa_022","title":"Baker's %","keywords":["baker's","","","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[" Baker's % ",""],"notes":" Baker's %  ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_023","title":"","keywords":["","","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[""],"notes":"","source":"recipe_html","category":"recipe"},{"id":"guide_qa_024","title":"QR","keywords":["qr","","","","","","","","","","qr","qr","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[": ","QR: QR"],"notes":":  ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_025","title":"","keywords":["","","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[": ",": "],"notes":"     ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_026","title":"","keywords":["","","","","","+ ","","","",""],"views":["list","detail","create","edit","trash"],"steps":["+ "],"notes":"+ ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_027","title":"WebURL","keywords":["weburl","","","","web",""," web","url","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[" Web","URL",""],"notes":" ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_028","title":"","keywords":["","","","","",""," ","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":[" ",""],"notes":" ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_029","title":"","keywords":["","","","","","","","","",""],"views":["list","detail","create","edit","trash"],"steps":["",""],"notes":" ","source":"recipe_html","category":"recipe"},{"id":"guide_qa_030","title":"","keywords":["","","","","","csv","","","",""],"views":["create","edit","detail"],"steps":["","CSV",""],"notes":" ","source":"recipe_html","category":"ingredient"},{"id":"guide_qa_031","title":"","keywords":["","","","","","","","","","","","","",""],"views":["create","edit","detail"],"steps":[": ",": "," : "],"notes":"        ","source":"recipe_html","category":"ingredient"},{"id":"guide_qa_032","title":"10%","keywords":["","10%","","","","","","","","","","","","",""],"views":["create","edit","detail"],"steps":[" 10% ","/"],"notes":" 10%  /","source":"recipe_html","category":"ingredient"},{"id":"guide_qa_033","title":"","keywords":["","","","","","100%","","","%","","50%","","","",""],"views":["create","edit","detail"],"steps":["","% 100% "," 50% "," : 50% "],"notes":" % 100% ","source":"recipe_html","category":"ingredient"},{"id":"guide_qa_034","title":"","keywords":["","","","","","","","","","+ ","","","",""],"views":["create","edit","detail"],"steps":[": ","+ ",""],"notes":":  + ","source":"recipe_html","category":"ingredient"},{"id":"guide_qa_035","title":"","keywords":["","","","","csv","","","csv",""],"views":["detail","list","data","data-management"],"steps":["CSV","CSV"],"notes":"CSV CSV","source":"recipe_html","category":"cost"},{"id":"guide_qa_036","title":"CSV","keywords":["csv","","","","","csv","","","","csv"],"views":["detail","list","data","data-management"],"steps":["  ","CSV",""],"notes":"   CSV  CSV CSVFIM ","source":"recipe_html","category":"cost"},{"id":"guide_qa_037","title":"","keywords":["","","","","csv","","","","csv","","csv",""],"views":["data","data-management"],"steps":[": CSV",": ","CSV:  CSV ",": "],"notes":"   CSV   CSV  CSV    JSON","source":"recipe_html","category":"data"},{"id":"guide_qa_038","title":"","keywords":["","","","","","","","","","","","","","","csv"],"views":["data","data-management"],"steps":[": ",":  /  / "],"notes":":  :  /  / ","source":"recipe_html","category":"data"},{"id":"guide_qa_039","title":"CSV","keywords":["csv","","","","","","","","csv"],"views":["data","data-management"],"steps":["","",""],"notes":" ","source":"recipe_html","category":"data"},{"id":"guide_qa_040","title":"","keywords":["","","","","","","","","","","csv"],"views":["data","data-management"],"steps":[""],"notes":" ","source":"recipe_html","category":"data"},{"id":"guide_qa_041","title":"","keywords":["","","","","","","","1000","","","","csv"],"views":["data","data-management"],"steps":[": ",": ",": : 1000",": : g / ml /  ",": 1 / 1","%: "],"notes":"+         : 1000  : g / ml /    1 / 1 % ","source":"recipe_html","category":"data"},{"id":"guide_qa_042","title":"CSV","keywords":["","","csv","csv","","","xxx","kg","","csv","","","","","csv","","//","","","","csv"],"views":["data","data-management"],"steps":[":  xxx/kg  xxx/L ","CSV: CSV//CSV"],"notes":":  xxx/kg  xxx/L  CSV: CSV//","source":"recipe_html","category":"data"},{"id":"guide_qa_043","title":"CSV","keywords":["csv","","","","","","","","","","","",""],"views":["data","data-management"],"steps":["  CSV","/","","1"],"notes":"CSV   CSV /  1 ","source":"recipe_html","category":"data"},{"id":"guide_qa_044","title":"","keywords":["","","","","","","","","csv"],"views":["data","data-management"],"steps":["  ","",""],"notes":"     ","source":"recipe_html","category":"data"},{"id":"guide_qa_045","title":"","keywords":["","","","","","","","","","json"," "," json","","csv"],"views":["data","data-management"],"steps":["  ","  JSON","  ","  ","JSON",""],"notes":"      JSON        JSON    ","source":"recipe_html","category":"data"},{"id":"guide_qa_046","title":"","keywords":["","","","","","","","","","","","","","","",""],"views":["inventory"],"steps":[": ",": "," : "," : "," CSV: CSV"," :  / PDF"],"notes":"             CSV CSV    / PDF","source":"recipe_html","category":"inventory"},{"id":"guide_qa_047","title":"","keywords":["","","","","","","","","","","csv","","","","",""],"views":["inventory"],"steps":[" : "," : CSV"," : ",": "],"notes":" :   : CSV  :  :  CSV+ ","source":"recipe_html","category":"inventory"},{"id":"guide_qa_048","title":"","keywords":["","","","enter","","shift","","tab","",""],"views":["inventory"],"steps":["Enter: ","Shift + Enter: ","Tab: ","Shift + Tab: "],"notes":"   Enter  Shift + Enter  Tab  Shift + Tab  ","source":"recipe_html","category":"inventory"},{"id":"guide_qa_049","title":"","keywords":["","","","","","","","","","","",""],"views":["inventory"],"steps":["",""],"notes":" ","source":"recipe_html","category":"inventory"},{"id":"guide_qa_050","title":"","keywords":["","","","","","","","","","0","","","","",""],"views":["inventory"],"steps":["","",": 0",""],"notes":"  : 0   CSV","source":"recipe_html","category":"inventory"},{"id":"guide_qa_051","title":"","keywords":["","","","","","","","","","","","","","csv","",""],"views":["inventory"],"steps":["","","//CSV"],"notes":" ","source":"recipe_html","category":"inventory"},{"id":"guide_qa_052","title":"","keywords":["","","","","","","","",""],"views":["planner","order-list"],"steps":["","",""],"notes":" ","source":"recipe_html","category":"planner"},{"id":"guide_qa_053","title":"","keywords":["","","","","","","","","","","",""],"views":["planner","order-list"],"steps":[" / ","",""],"notes":" /   ","source":"recipe_html","category":"planner"},{"id":"guide_qa_054","title":"","keywords":["","","","","","","","","","12","","",""],"views":["planner","order-list"],"steps":["","","12","CSV"],"notes":"  12 CSV","source":"recipe_html","category":"planner"},{"id":"guide_qa_055","title":"","keywords":["","","","","","","","","",""],"views":["users","api-logs","data","data-management","list"],"steps":["",""],"notes":" ","source":"recipe_html","category":"admin"},{"id":"guide_qa_056","title":"ON/OFF","keywords":["","on","off","","","","","","","",""],"views":["users","api-logs","data","data-management","list"],"steps":[""],"notes":"","source":"recipe_html","category":"admin"},{"id":"guide_qa_057","title":"","keywords":["","","","","","",""],"views":["users","api-logs","data","data-management","list"],"steps":["",""],"notes":"2  ","source":"recipe_html","category":"admin"},{"id":"guide_qa_058","title":"","keywords":["","","","","","","","","","","",""],"views":["users","api-logs","data","data-management","list"],"steps":["  ","","","","  ",""],"notes":"              1","source":"recipe_html","category":"admin"},{"id":"guide_qa_059","title":"","keywords":["","","","","","","",""],"views":["list","detail","create","edit","data","inventory","planner","order-list","trash"],"steps":["","","",""],"notes":"LEVAIN GUIDE    ","source":"recipe_html","category":"basic"},{"id":"guide_qa_060","title":"","keywords":["","","","","csv","","","","","","","","","","",""],"views":["list","detail","create","edit","data","data-management","inventory","planner","order-list"],"steps":["CSV","/"],"notes":"CSV /","source":"recipe_html","category":"trouble"},{"id":"guide_qa_061","title":"","keywords":["","","","","","","","","",""],"views":["list","detail","create","edit","data","data-management","inventory","planner","order-list"],"steps":["",""],"notes":" ","source":"recipe_html","category":"trouble"},{"id":"guide_qa_062","title":"//","keywords":["","","","","","","","","","","","csv","","","",""],"views":["list","detail","create","edit","data","data-management","inventory","planner","order-list"],"steps":["","CSV"],"notes":" CSV","source":"recipe_html","category":"trouble"},{"id":"guide_qa_063","title":"","keywords":["","","","","","","","",""],"views":["list","detail","create","edit","data","data-management","inventory","planner","order-list"],"steps":[""],"notes":"","source":"recipe_html","category":"trouble"},{"id":"guide_pdf_recipe_create_methods","title":":  / Web / ","keywords":["","","","web","","URL",""],"views":["list","create","edit"],"steps":[": + ","Web: WebURL",": ",""],"notes":"URL","source":"recipe_management_pdf","category":"recipe"},{"id":"guide_pdf_translation_usage","title":": ","keywords":["","","","","","",""],"views":["detail","list"],"steps":["","",""],"notes":"","source":"recipe_management_pdf","category":"translate"},{"id":"guide_pdf_cost_pipeline","title":": CSV + ","keywords":["","","","csv","",""],"views":["data","data-management","detail"],"steps":["CSV","","","CSV"],"notes":"CSV","source":"recipe_management_pdf","category":"cost"},{"id":"guide_pdf_inventory_planner","title":": ","keywords":["","","","","",""],"views":["inventory","planner","order-list"],"steps":["","",""],"notes":"","source":"recipe_management_pdf","category":"planner"}]`),Yx={entries:XA},ZA=[{id:"recipe_create_manual",title:"",keywords:["","","","","create","","","","",""],views:["list","create"],steps:["+ ","","URL","","","&",""],notes:"DB2001000200"},{id:"recipe_create_web_import",title:"Web URL",keywords:["web","url","","","","","","","","",""],views:["list","create"],steps:["Web","URL","URL","","",""],notes:"/"},{id:"recipe_create_image_import",title:"",keywords:["","","ocr","","","","","","gemini","groq","best effort"],views:["list","create"],steps:["","GroqGemini","&","",""],notes:""},{id:"recipe_create_url_import_limit_and_request",title:"URL",keywords:["url","","","403","","","cloudflare","","","",""],views:["list","create"],steps:["URLURL","","URL","URL",""],notes:"URL100%"},{id:"recipe_create_image_import_accuracy_tips",title:"",keywords:["","","","","","","","","gemini","groq"],views:["list","create"],steps:["","","GroqGemini",""],notes:""},{id:"recipe_create_input_requirements",title:"/",keywords:["","","","","","","","","","sourceurl",""],views:["create","edit"],steps:["","URL"," /  /  /  / ","",""],notes:""},{id:"recipe_create_ingredient_entry_master",title:"",keywords:["","","","","","","","kg","g","","","",""],views:["create","edit"],steps:[" / CSV","","ON","","/"],notes:": 1000/kgg10001000g100g100"},{id:"recipe_edit",title:"",keywords:["","","","update","","","","URL",""],views:["detail","edit"],steps:["","","","",""],notes:"URL / "},{id:"recipe_delete_restore",title:"",keywords:["","","","trash",""],views:["list","trash","detail"],steps:[": ",":   ","1:  ",": "],notes:""},{id:"recipe_search_filter",title:"",keywords:["","","","","","","","","","","",""],views:["list"],steps:["","","/","  "," "],notes:"01"},{id:"recipe_list_reorder",title:"",keywords:["","","","","",""],views:["list"],steps:["","/","",""],notes:"/"},{id:"recipe_list_recent_recipes",title:"",keywords:["","","recent","",""],views:["list","detail"],steps:["","",""],notes:""},{id:"recipe_detail_translate_language",title:"",keywords:["","","","","","","","language","original",""],views:["detail","list"],steps:["",":  Original ()"," French","","ON"],notes:""},{id:"recipe_detail_print_preview",title:"",keywords:["","","print","pdf","","","","","","","","",""],views:["detail"],steps:[""," /",""," (g)","","  ","PDFPDF"],notes:"PDF"},{id:"recipe_detail_duplicate",title:"",keywords:["","","duplicate",""],views:["detail"],steps:["","","",""],notes:""},{id:"recipe_detail_edit_delete",title:"",keywords:["","","","update","delete"],views:["detail"],steps:["","","",""],notes:""},{id:"recipe_detail_top_tabs_overview",title:"",keywords:["","","","","original","","","","","","","","","",""],views:["detail","list","trash"],steps:["/ Original ()  ","/"," Original ()French ON","  PDF","","","  "," "],notes:""},{id:"recipe_detail_qr_source",title:"URLQR",keywords:["qr","qr","","source url","",""],views:["detail"],steps:["URL","QRQR","URL"],notes:"URLQR"},{id:"recipe_share_public",title:"",keywords:["","","","","","","share","public","private","","","",""],views:["list","detail"],steps:["",": ","ON"," "," ","OFF","/",": "],notes:""},{id:"recipe_share_public_toggle_visibility",title:"",keywords:["","","","","","",""],views:["detail","list"],steps:[" ","//","",""],notes:""},{id:"voice_input_recipe_form",title:"",keywords:["","","voice","avalon","",""],views:["create","edit","list"],steps:["","","",""],notes:""},{id:"voice_toggle_admin",title:"/",keywords:["","","avalon api","",""],views:["data","data-management"],steps:[""," Avalon API","ON/OFF"],notes:""},{id:"data_price_csv_upload",title:"CSV",keywords:["csv","","","csv",""],views:["data","data-management"],steps:["","","CSV&","",""],notes:" `.csv` "},{id:"data_price_informart_extract",title:"",keywords:["","informart","btoB","","","","","","","","","","","","fim","","","csv","","","","","","","","","","","kg","g"],views:["list","data","data-management"],steps:["","","FIM ","","","","CSV"," > ","CSVFIM&"," > CSV /  / ","1",""],notes:":  1300/kg  100g CSV 1000 g 100g 120130"},{id:"data_price_month_range_reason",title:"",keywords:["","","","","","","","","",""],views:["list","data","data-management"],steps:[""],notes:""},{id:"data_price_csv_manage",title:"CSV",keywords:["","","csv","csv"],views:["data","data-management"],steps:[" > ","",""],notes:""},{id:"data_csv_import_tab",title:"CSV",keywords:["csv","","","","","","","","","","","","kg","g","","","","","","","","","","8%","10%"],views:["data","data-management","csv-import"],steps:["","CSV"," /  / ","1"," /  /  / ","",": 1300/kg  1000 g ",""],notes:"CSVCSV: 8%10%"},{id:"data_csv_import_unit_reason",title:"CSV",keywords:["","","","","kg","g","","","","",""],views:["data","data-management","csv-import","create","edit","detail"],steps:["CSV",": 1300/kg  g  1000 g ","100g  kg","100g 120130"],notes:""},{id:"data_csv_import_category_tax_reason",title:"CSV",keywords:["csv","","","","","","","","","8%","10%","",""],views:["data","data-management","csv-import","create","edit","detail"],steps:["CSVCSV"," /  /  / ",": 8%10%","",""],notes:""},{id:"data_ingredient_master",title:"",keywords:["","","","",""],views:["data","data-management","ingredients"],steps:["","","","CSV"],notes:""},{id:"data_duplicates",title:"",keywords:["","","","dup","","","","","","","","",""],views:["data","data-management","duplicates"],steps:["",": ","FIMCSV","",""],notes:""},{id:"data_backup_management",title:"",keywords:["","backup management","cron","",""],views:["data","data-management","backup-management"],steps:["","",""],notes:""},{id:"data_management_tabs_overview_non_admin",title:"",keywords:["","","","","csv","","","","",""],views:["data","data-management","csv-import","duplicates","trash"],steps:[": FIMCSV",": ","CSV: ",": ",": CSV/"],notes:"/"},{id:"data_management_tab_price_data_non_admin",title:"",keywords:["","csv","","","","","","",""],views:["data","data-management"],steps:["FIMCSV&","/","CSV","CSV"],notes:"CSV"},{id:"data_management_tab_ingredient_master_non_admin",title:"",keywords:["","","","","","","","","","","","",""],views:["data","data-management","ingredients"],steps:[""," /  /  /  / ","CSV","+ "],notes:""},{id:"data_management_tab_csv_import_non_admin",title:"CSV",keywords:["csv","","","","","","","","","","",""],views:["data","data-management","csv-import"],steps:["CSV","/","",""],notes:""},{id:"data_management_tab_duplicates_non_admin",title:"",keywords:["","","","","","","","","","",""],views:["data","data-management","duplicates"],steps:["","","","/"],notes:""},{id:"data_management_tab_trash_non_admin",title:"",keywords:["","csv","","","","","",""],views:["data","data-management","trash"],steps:["CSV","","",""],notes:""},{id:"inventory_basic",title:"",keywords:["","","inventory",""],views:["inventory","list"],steps:["","",""],notes:""},{id:"incoming_deliveries_pdf",title:"PDF",keywords:["pdf","pdf","","",""],views:["incoming-deliveries","list"],steps:["PDF","PDF&","",""],notes:""},{id:"incoming_stock_apply",title:"",keywords:["","","","","incoming stock"],views:["incoming-stock","list"],steps:["","","",""],notes:""},{id:"planner_basic",title:"",keywords:["","","planner",""],views:["planner","list"],steps:["","",""],notes:""},{id:"planner_detailed_operations_non_admin",title:"",keywords:["","","","","","","","","","","",""],views:["planner"],steps:["&","(g)","","1","",""],notes:" meal_plans "},{id:"planner_to_orderlist_effect_non_admin",title:"",keywords:["","","","","","","","",""],views:["planner","order-list","inventory"],steps:["","","",""],notes:"DB"},{id:"planner_inventory_prerequisite_non_admin",title:"",keywords:["","","","","","","","",""],views:["planner","order-list","inventory","data","data-management"],steps:["","","0",""],notes:"CSV/"},{id:"order_list_calculation_rule_non_admin",title:"",keywords:["","","","20%","","","",""],views:["order-list","planner","inventory"],steps:["/","","12"," > ","CSV > CSV > "],notes:"CSV"},{id:"order_list_basic",title:"",keywords:["","order",""],views:["order-list","planner","list"],steps:["","",""],notes:""},{id:"user_management_admin",title:"",keywords:["","","","admin",""],views:["users","list"],steps:["","",""],notes:""},{id:"api_logs_admin",title:"API",keywords:["api","api","","","admin"],views:["api-logs","list"],steps:["API","API",""],notes:""},{id:"general_navigation",title:"",keywords:["","","","",""],views:["list","data","inventory","incoming-deliveries","incoming-stock","planner","order-list"],steps:["","//PDF///",""],notes:""},{id:"menu_slider_button_guide",title:"",keywords:["","","","","","q&a","","web","","","pdf","","","","","","api","","","",""],views:["list","detail","create","edit","data","inventory","incoming-deliveries","incoming-stock","planner","order-list","trash"],steps:["","Q&A:  `recipe.html` ",":  `recipe_management.pdf` ","Web: URL",": "," / PDF /  /  / : ",": "," / API: ",": ",": ",": ",": "],notes:""},{id:"general_button_not_working",title:"",keywords:["","","","","","error",""],views:["list","detail","create","edit","data","data-management","inventory","incoming-deliveries","incoming-stock","planner","order-list"],steps:["PC: Cmd+Shift+R / Windows: Ctrl+F5","",""," /  / AI"],notes:""}],mi=e=>String(e||"").toLowerCase().replace(/[!?,.:;\-_/\\\s(){}]+/g,""),D_=e=>Array.from(new Set(String(e||"").toLowerCase().split(/[\s,.!?:;/\\\-_(){}]+/).map(t=>t.trim()).filter(Boolean))),eT=[["","","language","","","","","","","original"],["csv","","","","","","","",""],["url","web","web","url","","","import"],["url","","403","","","cloudflare","",""],["","","","ocr","","","","","gemini","groq","best effort"],["","","","","","","","kg","g"],["","informart","btoB","","","","","fim",""],["","","","kg","","g","","","",""],["","","","","","","","8%","10%"],["","","","","","",""],["","","","","","",""],["","","","csv","","","",""],["","planner","","","","","",""],["","order list","","","","","","20%",""],["","","","",""],["","","","","",""],["","","voice","avalon","",""],["","","","","restore","trash"],["","","print","pdf",""],["","","duplicate"],["","","","","share","public","private","","",""],["","","","filter"],["","","","update"],["","","","","",""],["","","recent","",""],["qr","qr","","sourceurl",""],["","","","",""]],tT={recipe_detail_translate_language:["","","","","original"],recipe_detail_print_preview:["","","print","pdf"],recipe_detail_duplicate:["","","duplicate"],recipe_detail_edit_delete:["","",""],recipe_detail_top_tabs_overview:["","","","original","","","","","","","","",""],recipe_edit:["","","","","",""],recipe_share_public:["","","","","","","","","private",""],recipe_share_public_toggle_visibility:["","","","","",""],recipe_detail_qr_source:["qr","qr","","sourceurl",""],recipe_create_manual:["","","","","",""],recipe_create_web_import:["url","web","","","","","",""],recipe_create_image_import:["","","ocr","gemini","groq","best effort"],recipe_create_url_import_limit_and_request:["url","","403","","cloudflare","","","",""],recipe_create_image_import_accuracy_tips:["","","","","","","gemini"],recipe_create_input_requirements:["","","","","","",""],recipe_create_ingredient_entry_master:["","","","","","","","kg","g","",""],data_price_csv_upload:["csv","","","","","shiftjis"],data_price_informart_extract:["","informart","","","","","fim","","","","","csv","","","","kg","g"],data_price_month_range_reason:["","","","","","","","",""],data_csv_import_tab:["csv","","","","","","","kg","g","","","","","","",""],data_csv_import_unit_reason:["","","kg","g","","",""],data_csv_import_category_tax_reason:["","","","","","","8%","10%",""],data_duplicates:["","","","","","","",""],data_management_tabs_overview_non_admin:["","","","","csv","","","",""],data_management_tab_price_data_non_admin:["","csv","","","",""],data_management_tab_ingredient_master_non_admin:["","","","","","",""],data_management_tab_csv_import_non_admin:["csv","","","","","",""],data_management_tab_duplicates_non_admin:["","","","","",""],data_management_tab_trash_non_admin:["","","","csv","",""],planner_detailed_operations_non_admin:["","","","","","","",""],planner_to_orderlist_effect_non_admin:["","","","","",""],planner_inventory_prerequisite_non_admin:["","","","","",""],order_list_calculation_rule_non_admin:["","","20%","","","",""],menu_slider_button_guide:["","","","","q&a","","web","","","","",""],recipe_list_reorder:["","","","","",""],recipe_list_recent_recipes:["","","recent",""],voice_input_recipe_form:["","","voice","avalon"],recipe_search_filter:["","",""],general_button_not_working:["","","","",""]},nT=(()=>{const e=new Map;for(const t of eT){const s=Array.from(new Set(t.map(a=>mi(a)).filter(Boolean)));for(const a of s){const o=s.filter(u=>u!==a),c=e.get(a)||[];e.set(a,Array.from(new Set([...c,...o])))}}return e})(),rT=e=>{const t=new Set((e||[]).filter(Boolean));for(const s of t)(nT.get(s)||[]).forEach(o=>t.add(o));return Array.from(t)},sT=()=>(Array.isArray(Yx?.entries)?Yx.entries:[]).map((t,s)=>{const a=Array.isArray(t?.steps)?t.steps.map(u=>String(u||"").trim()).filter(Boolean).slice(0,6):[],o=String(t?.notes||"").trim(),c=a.length>0?a:o?[o]:[];return c.length===0?null:{id:String(t?.id||`guide_dynamic_${s+1}`),title:String(t?.title||"").trim(),keywords:Array.isArray(t?.keywords)?t.keywords.map(u=>String(u||"").trim()).filter(Boolean).slice(0,24):[],views:Array.isArray(t?.views)?t.views.map(u=>String(u||"").trim()).filter(Boolean):[],steps:c,notes:String(t?.notes||"").trim(),source:String(t?.source||"guide")}}).filter(Boolean),iT=sT(),aT=[...ZA,...iT],Qx=e=>{const t=String(e||"");if(!t)return[];if(t.length===1)return[t];const s=[];for(let a=0;a<t.length-1;a+=1)s.push(t.slice(a,a+2));return s},oT=(e,t)=>{const s=new Set(Qx(mi(e))),a=new Set(Qx(mi(t)));if(s.size===0||a.size===0)return 0;let o=0;for(const u of s)a.has(u)&&(o+=1);const c=new Set([...s,...a]).size;return c===0?0:o/c},lT=(e,t,s,a)=>{let o=0;const c=[];for(const g of e.keywords||[]){const x=mi(g);if(!x)continue;let v=!1;t.includes(x)?(o+=5,v=!0):D_(g).map(w=>mi(w)).filter(Boolean).some(w=>s.includes(w))&&(o+=3,v=!0),v&&c.push(g)}const u=!!e.views?.includes(a);u&&(o+=2);const h=mi(e.title),f=t.includes(h);f&&(o+=4);const p=oT(t,h);p>=.42?o+=5:p>=.26&&(o+=3);const m=tT[e.id]||[];for(const g of m){const x=mi(g);x&&(t.includes(x)||s.includes(x))&&(o+=2)}return!f&&c.length===0&&p<.2&&(o=0),e?.source==="recipe_html"&&o>0&&(o-=1),{score:o,matchedKeywords:c,viewMatched:u,titleMatched:f,titleSimilarity:p}},L_=({question:e,currentView:t,limit:s=3})=>{const a=mi(e);if(!a)return[];const o=rT(D_(e).map(c=>mi(c)).filter(Boolean));return aT.map(c=>{const u=lT(c,a,o,t);return{entry:c,...u}}).filter(c=>c.score>0).sort((c,u)=>u.score!==c.score?u.score-c.score:u.matchedKeywords.length!==c.matchedKeywords.length?u.matchedKeywords.length-c.matchedKeywords.length:c.entry.title.localeCompare(u.entry.title,"ja")).slice(0,s)},cT=({assessment:e,currentViewLabel:t,currentView:s})=>{const a={detail:["","","","","","QRURL",""],create:["","","URLWeb","AI","","",""],edit:["","","","","",""],data:["CSV","","CSV","","/"],"data-management":["CSV","","CSV","","/"],inventory:["","","","CSV"],planner:["","/","","1 / ",""],"order-list":["","","",""," / "],list:["","","","","","","",""]},o={detail:" French /  / / /  /  /   / QR",create:" /  / URL /  /  / ",edit:" /  /  /  /  / ",data:" /  /  /  /  /  / ","data-management":" /  /  /  /  /  / ",inventory:" /  /  / ",planner:" / & /  or  /  /  / ","order-list":" /  /  /  /  /  / ",list:" / +  /   /   /  "},c=a[s]||a.list,u=o[s]||"",h=["1"];return e?.top?.entry?.title&&h.push(`: ${e.top.entry.title}`),t&&h.push(`: ${t}`),h.push("1"),c.forEach((f,p)=>{h.push(`${p+1}. ${f}`)}),h.push(`1: ${u}`),h.push("1"),h.push(": 1 /  French / "),h},z_=({question:e,currentView:t,limit:s=3})=>{const a=L_({question:e,currentView:t,limit:s});if(a.length===0)return{confidence:"low",reason:"no_match",shouldAskClarification:!0,hits:[],top:null,alternatives:[],bestScore:0,scoreGap:0};const o=a[0],c=a[1]||null,u=o.score-(c?.score||0),h=o.matchedKeywords.length;let f="low";o.score>=11&&h>=2||o.score>=10&&o.titleMatched&&h>=1?f="high":o.score>=7&&h>=1&&(f="medium");const p=f==="low"&&a.length>1&&u<=1&&!o.titleMatched&&o.matchedKeywords.length<=1;let m="sufficient";return p&&(m=f==="low"?"low_score":"ambiguous"),{confidence:f,reason:m,shouldAskClarification:p,hits:a,top:o,alternatives:a.slice(1),bestScore:o.score,scoreGap:u}},I_=({assessment:e,currentViewLabel:t="",currentView:s=""})=>cT({assessment:e,currentViewLabel:t,currentView:s}).join(`
`),uT=[{label:"Q&A",patterns:["q&a","qa","q and a",""],can:" `recipe.html` ",caution:"Q&A",pitfall:"/"},{label:"",patterns:["","",""],can:" `recipe_management.pdf` ",caution:"PDF",pitfall:"PDF"},{label:"Web",patterns:["web","web","url","url"],can:"URLWeb",caution:"",pitfall:"URL403URL"},{label:"",patterns:["","","","ocr"],can:"",caution:"",pitfall:""},{label:"",patterns:[""],can:"",caution:"PC/",pitfall:""},{label:"PDF",patterns:["pdf"," pdf"],can:"PDFPDF",caution:"",pitfall:"PDF"},{label:"",patterns:[""],can:"",caution:"PDF",pitfall:""},{label:"",patterns:["",""],can:"",caution:"",pitfall:""},{label:"",patterns:["",""],can:"",caution:"",pitfall:""},{label:"",patterns:[""],can:"CSV",caution:"",pitfall:"CSV"},{label:"",patterns:["","user management"],can:"",caution:"",pitfall:"/"},{label:"API",patterns:["api","api"],can:"API",caution:"",pitfall:""},{label:" / ",patterns:["","","","","",""],can:"/",steps:["  ","","","",""],caution:"",pitfall:""},{label:"",patterns:["","trash"],can:"",caution:"",pitfall:""},{label:"",patterns:["","","top"],can:"",caution:"",pitfall:""},{label:"",patterns:["","logout",""],can:"",caution:"",pitfall:""}],dT=e=>{const t=String(e||"").toLowerCase();return t&&uT.find(s=>(s.patterns||[]).some(a=>t.includes(String(a||"").toLowerCase())))||null},em=({question:e,currentView:t,currentViewLabel:s="",responseStyle:a="balanced"})=>{const o=z_({question:e,currentView:t,limit:2});if(o.shouldAskClarification)return I_({assessment:o,currentViewLabel:s,currentView:t});const c=o.top.entry,u=a==="concise",h=a==="detailed",f=/||/.test(String(e||""));if(c.id==="data_price_month_range_reason"||c.id==="data_price_informart_extract"&&f)return"";if(c.id==="menu_slider_button_guide"){const g=dT(e);if(g){const x=[`${g.label}`,`: ${g.can}`];if(u||x.push(`: ${g.caution}`),h&&x.push(`: ${g.pitfall}`),Array.isArray(g.steps)&&g.steps.length>0){x.push(":");const v=u?3:g.steps.length;g.steps.slice(0,v).forEach((S,w)=>{x.push(`${w+1}. ${S}`)})}return x.join(`
`)}}const p=[];p.push(`${c.title}:`);const m=u?3:c.steps.length;return c.steps.slice(0,m).forEach((g,x)=>{p.push(`${x+1}. ${g}`)}),c.notes&&!u&&p.push(`: ${c.notes}`),h&&o.alternatives[0]?.entry?.title&&p.push(`: ${o.alternatives[0].entry.title}`),u||p.push(" /  / 1"),p.join(`
`)},hT=({question:e,currentView:t})=>{const s=L_({question:e,currentView:t,limit:3});return s.length===0?"":s.map((a,o)=>{const c=a.entry,u=[];return u.push(`${o+1}: ${c.title}`),u.push(`: ${a.score}`),u.push(`: ${a.matchedKeywords.join(", ")||""}`),u.push(`: ${(c.keywords||[]).join(", ")}`),u.push(":"),c.steps.forEach((h,f)=>{u.push(`${f+1}. ${h}`)}),c.notes&&u.push(`: ${c.notes}`),u.join(`
`)}).join(`

`)},fT=Object.assign({"../App.jsx":()=>Ze(()=>import("./App-DlJOHDf0.js"),[]).then(e=>e.default),"../components/AdminCopyAllModal.jsx":()=>Ze(()=>import("./AdminCopyAllModal-D4_oYl33.js"),[]).then(e=>e.default),"../components/AdminTargetDeleteModal.jsx":()=>Ze(()=>import("./AdminTargetDeleteModal-rXCA8HfH.js"),[]).then(e=>e.default),"../components/ApiUsageLogs.css":()=>Ze(()=>import("./ApiUsageLogs-D5CGGaI3.js"),[]).then(e=>e.default),"../components/ApiUsageLogs.jsx":()=>Ze(()=>import("./ApiUsageLogs-Qn6gb0zF.js"),[]).then(e=>e.default),"../components/AutocompleteInput.css":()=>Ze(()=>import("./AutocompleteInput-DYwxwxLC.js"),[]).then(e=>e.default),"../components/AutocompleteInput.jsx":()=>Ze(()=>import("./AutocompleteInput-CJTg9JVm.js"),[]).then(e=>e.default),"../components/BackupManagement.css":()=>Ze(()=>import("./BackupManagement-B6tIeRka.js"),[]).then(e=>e.default),"../components/BackupManagement.jsx":()=>Ze(()=>import("./BackupManagement-BvlCFdCg.js"),[]).then(e=>e.default),"../components/Button.css":()=>Ze(()=>import("./Button-C5uiF37F.js"),[]).then(e=>e.default),"../components/Button.jsx":()=>Ze(()=>import("./Button-CfZH7Cz_.js"),[]).then(e=>e.default),"../components/Card.css":()=>Ze(()=>import("./Card-DI2GPc0z.js"),[]).then(e=>e.default),"../components/Card.jsx":()=>Ze(()=>import("./Card-DqfhjFKb.js"),[]).then(e=>e.default),"../components/CsvToMasterImporter.jsx":()=>Ze(()=>import("./CsvToMasterImporter-DEj38mBe.js"),[]).then(e=>e.default),"../components/DataManagement.css":()=>Ze(()=>import("./DataManagement-6xq1Wpy9.js"),[]).then(e=>e.default),"../components/DataManagement.jsx":()=>Ze(()=>import("./DataManagement-DUK0fIiP.js"),[]).then(e=>e.default),"../components/DeleteConfirmModal.jsx":()=>Ze(()=>import("./DeleteConfirmModal-Cl-u_K07.js"),[]).then(e=>e.default),"../components/ImportModal.css":()=>Ze(()=>import("./ImportModal-DiNXXXGa.js"),[]).then(e=>e.default),"../components/ImportModal.jsx":()=>Ze(()=>import("./ImportModal-PMf7UDIv.js"),[]).then(e=>e.default),"../components/IncomingDeliveries.css":()=>Ze(()=>import("./IncomingDeliveries-D4Rz6OUJ.js"),[]).then(e=>e.default),"../components/IncomingDeliveries.jsx":()=>Ze(()=>import("./IncomingDeliveries-zTD84w_r.js"),[]).then(e=>e.default),"../components/IncomingStock.css":()=>Ze(()=>import("./IncomingStock-RVqLfMpN.js"),[]).then(e=>e.default),"../components/IncomingStock.jsx":()=>Ze(()=>import("./IncomingStock-BRv5F2n8.js"),[]).then(e=>e.default),"../components/IngredientMaster.css":()=>Ze(()=>import("./IngredientMaster-CO03Mmvk.js"),[]).then(e=>e.default),"../components/IngredientMaster.jsx":()=>Ze(()=>import("./IngredientMaster-rUGw5fkX.js"),[]).then(e=>e.default),"../components/Input.css":()=>Ze(()=>import("./Input-Q4a84nKN.js"),[]).then(e=>e.default),"../components/Input.jsx":()=>Ze(()=>import("./Input-BpGvYlUn.js"),[]).then(e=>e.default),"../components/Inventory.css":()=>Ze(()=>import("./Inventory-D7KjKXQk.js"),[]).then(e=>e.default),"../components/Inventory.jsx":()=>Ze(()=>import("./Inventory-Dn_5vEjb.js"),[]).then(e=>e.default),"../components/InventoryCsvList.jsx":()=>Ze(()=>import("./InventoryCsvList-BrLMmzxe.js"),[]).then(e=>e.default),"../components/InventoryList.jsx":()=>Ze(()=>import("./InventoryList-Dyoz9khv.js"),[]).then(e=>e.default),"../components/Layout.css":()=>Ze(()=>import("./Layout-DT1tY09u.js"),[]).then(e=>e.default),"../components/Layout.jsx":()=>Ze(()=>import("./Layout-BkOf243P.js"),[]).then(e=>e.default),"../components/LevainGuide.css":()=>Ze(()=>import("./LevainGuide-Dr2YKjC4.js"),[]).then(e=>e.default),"../components/LevainGuide.jsx":()=>Ze(()=>import("./LevainGuide-CzEiGUXs.js"),[]).then(e=>e.default),"../components/LoginPage.jsx":()=>Ze(()=>import("./LoginPage-D3oOxUQa.js"),[]).then(e=>e.default),"../components/Modal.css":()=>Ze(()=>import("./Modal-CymGGesx.js"),[]).then(e=>e.default),"../components/Modal.jsx":()=>Ze(()=>import("./Modal-OSuGuBpB.js"),[]).then(e=>e.default),"../components/OperationAssistant.css":()=>Ze(()=>import("./OperationAssistant-D6aLSf4e.js"),[]).then(e=>e.default),"../components/OperationAssistant.jsx":()=>Ze(()=>import("./OperationAssistant-BUOXOvZc.js"),[]).then(e=>e.default),"../components/OrderList.css":()=>Ze(()=>import("./OrderList-DasZKvVJ.js"),[]).then(e=>e.default),"../components/OrderList.jsx":()=>Ze(()=>import("./OrderList-BpBZppCk.js"),[]).then(e=>e.default),"../components/PasswordResetPage.jsx":()=>Ze(()=>import("./PasswordResetPage-D1uNpW5D.js"),[]).then(e=>e.default),"../components/Planner.css":()=>Ze(()=>import("./Planner-Bu-IlLf8.js"),[]).then(e=>e.default),"../components/Planner.jsx":()=>Ze(()=>import("./Planner-LfH6RQla.js"),[]).then(e=>e.default),"../components/PriceListManager.css":()=>Ze(()=>import("./PriceListManager-DeTlUKrx.js"),[]).then(e=>e.default),"../components/PriceListManager.jsx":()=>Ze(()=>import("./PriceListManager-BDJswQ7J.js"),[]).then(e=>e.default),"../components/RecentRecipes.css":()=>Ze(()=>import("./RecentRecipes-tVBFzzmg.js"),[]).then(e=>e.default),"../components/RecentRecipes.jsx":()=>Ze(()=>import("./RecentRecipes-BG5WAtnZ.js"),[]).then(e=>e.default),"../components/RecipeDetail.css":()=>Ze(()=>import("./RecipeDetail-Bz5jNnne.js"),[]).then(e=>e.default),"../components/RecipeDetail.jsx":()=>Ze(()=>import("./RecipeDetail-Cae6xgfB.js"),[]).then(e=>e.default),"../components/RecipeForm.css":()=>Ze(()=>import("./RecipeForm-C438w8AG.js"),[]).then(e=>e.default),"../components/RecipeForm.jsx":()=>Ze(()=>import("./RecipeForm-Cyut_tsi.js"),[]).then(e=>e.default),"../components/RecipeFormBread.css":()=>Ze(()=>import("./RecipeFormBread-CYkJAp8a.js"),[]).then(e=>e.default),"../components/RecipeFormBread.jsx":()=>Ze(()=>import("./RecipeFormBread-DimXfWON.js"),[]).then(e=>e.default),"../components/RecipeFormIngredients.jsx":()=>Ze(()=>import("./RecipeFormIngredients-C-c58Dql.js"),[]).then(e=>e.default),"../components/RecipeFormMock.css":()=>Ze(()=>import("./RecipeFormMock-CnVO0cGA.js"),[]).then(e=>e.default),"../components/RecipeFormMock.jsx":()=>Ze(()=>import("./RecipeFormMock-3lyoNgWV.js"),[]).then(e=>e.default),"../components/RecipeFormSteps.jsx":()=>Ze(()=>import("./RecipeFormSteps-By4O683z.js"),[]).then(e=>e.default),"../components/RecipeList.css":()=>Ze(()=>import("./RecipeList-CiYaE6Wm.js"),[]).then(e=>e.default),"../components/RecipeList.jsx":()=>Ze(()=>import("./RecipeList-DEXYrTHN.js"),[]).then(e=>e.default),"../components/Toast.css":()=>Ze(()=>import("./Toast-CDBe9xat.js"),[]).then(e=>e.default),"../components/Toast.jsx":()=>Ze(()=>import("./Toast-5K3zC2ew.js"),[]).then(e=>e.default),"../components/TrashBin.jsx":()=>Ze(()=>import("./TrashBin-O1vG3F3l.js"),[]).then(e=>e.default),"../components/UnitConversionModal.css":()=>Ze(()=>import("./UnitConversionModal-s2WdPeHf.js"),[]).then(e=>e.default),"../components/UnitConversionModal.jsx":()=>Ze(()=>import("./UnitConversionModal-BZRs95Bq.js"),[]).then(e=>e.default),"../components/UserManagement.css":()=>Ze(()=>import("./UserManagement-BG0RbO7P.js"),[]).then(e=>e.default),"../components/UserManagement.jsx":()=>Ze(()=>import("./UserManagement-Cd94ny8-.js"),[]).then(e=>e.default),"../components/VoiceInputButton.jsx":()=>Ze(()=>import("./VoiceInputButton-muPgu69Q.js"),[]).then(e=>e.default),"../constants.js":()=>Ze(()=>import("./constants-BIMM0EzA.js"),[]).then(e=>e.default),"../contexts/AuthContext.jsx":()=>Ze(()=>import("./AuthContext-Bo1mYLKO.js"),[]).then(e=>e.default),"../contexts/ToastContext.jsx":()=>Ze(()=>import("./ToastContext-C-Dszvhw.js"),[]).then(e=>e.default),"../contexts/authContext.js":()=>Ze(()=>import("./authContext-dIs_htaa.js"),[]).then(e=>e.default),"../contexts/toastContext.js":()=>Ze(()=>import("./toastContext-BR9hQdwl.js"),[]).then(e=>e.default),"../contexts/useAuth.js":()=>Ze(()=>import("./useAuth-BJiaNcZ7.js"),[]).then(e=>e.default),"../contexts/useToast.js":()=>Ze(()=>import("./useToast-Doy8f37H.js"),[]).then(e=>e.default),"./backupService.js":()=>Ze(()=>import("./backupService-DjPUoySM.js"),[]).then(e=>e.default),"./csvUnitOverrideService.js":()=>Ze(()=>import("./csvUnitOverrideService-BgabJJc-.js"),[]).then(e=>e.default),"./featureFlagService.js":()=>Ze(()=>import("./featureFlagService-b-7CFBZt.js"),[]).then(e=>e.default),"./incomingDeliveryService.js":()=>Ze(()=>import("./incomingDeliveryService-CCR0nm5K.js"),[]).then(e=>e.default),"./incomingStockService.js":()=>Ze(()=>import("./incomingStockService-oXjLoH9V.js"),[]).then(e=>e.default),"./ingredientSearchService.js":()=>Ze(()=>import("./ingredientSearchService-DtkOeek0.js"),[]).then(e=>e.default),"./inventoryService.js":()=>Ze(()=>import("./inventoryService-BYdNQ2nE.js"),[]).then(e=>e.default),"./operationKnowledgeBase.js":()=>Ze(()=>import("./operationKnowledgeBase-BR-ShW09.js"),[]).then(e=>e.default),"./operationQaService.js":()=>Ze(()=>import("./operationQaService-Dkj5ZP57.js"),[]).then(e=>e.default),"./plannerService.js":()=>Ze(()=>import("./plannerService-w39s46TU.js"),[]).then(e=>e.default),"./purchasePriceService.js":()=>Ze(()=>import("./purchasePriceService-DEQ6cy7k.js"),[]).then(e=>e.default),"./recipeService.js":()=>Ze(()=>import("./recipeService-BOeDGKFb.js"),[]).then(e=>e.default),"./shortageService.js":()=>Ze(()=>import("./shortageService-D-TAEUMQ.js"),[]).then(e=>e.default),"./translationService.js":()=>Ze(()=>import("./translationService-BMSHEKi8.js"),[]).then(e=>e.default),"./trashService.js":()=>Ze(()=>import("./trashService-BkPyQG5k.js"),[]).then(e=>e.default),"./unitConversionService.js":()=>Ze(()=>import("./unitConversionService-DSEXy9Fy.js"),[]).then(e=>e.default),"./userService.js":()=>Ze(()=>import("./userService-Bw7ovO6Q.js"),[]).then(e=>e.default),"./vendorOrderService.js":()=>Ze(()=>import("./vendorOrderService-uNcDQTt1.js"),[]).then(e=>e.default),"./voiceTranscriptionService.js":()=>Ze(()=>import("./voiceTranscriptionService-CLsgSQYt.js"),[]).then(e=>e.default)}),pT=new Set(["","","","","","","","","","","","","","","","","","","","","","and","the","for","how","what","why","please"]);let Np=null;const Sm=e=>String(e||"").toLowerCase().normalize("NFKC").replace(/[^\p{L}\p{N}]+/gu,""),mT=e=>String(e||"").replace(/^\.\.\//,"src/"),gT=e=>{const t=String(e||"").toLowerCase().normalize("NFKC"),s=t.match(/[\p{Script=Han}\p{Script=Hiragana}\p{Script=Katakana}a-z0-9_]{2,}/gu);return s&&s.length>0?s:t.match(/[a-z0-9_]{2,}/g)||[]},yT=e=>{const t=gT(e).map(a=>a.trim()).filter(Boolean).filter(a=>!pT.has(a)).slice(0,14),s=new Map;return t.forEach(a=>{const o=Sm(a);!o||o.length<2||s.has(o)||s.set(o,{raw:a,normalized:o})}),Array.from(s.values())},vT=async()=>(await Promise.all(Object.entries(fT).map(async([t,s])=>{try{const a=await s(),o=String(a||"");return{path:mT(t),content:o,lines:o.split(/\r?\n/)}}catch{return null}}))).filter(Boolean).filter(t=>t.content.trim().length>0).sort((t,s)=>t.path.localeCompare(s.path,"ja")),xT=async()=>(Np||(Np=vT()),Np),bT=(e,t)=>{const s=Sm(e);if(!s)return null;let a=0;const o=[];for(const c of t){if(!c?.normalized||!s.includes(c.normalized))continue;const u=Math.min(8,2+Math.floor(c.normalized.length/2));a+=u,o.push(c.raw)}return a<=0?null:{score:a,matchedTerms:Array.from(new Set(o))}},_T=(e,t=2,s=12)=>{const a=[];for(const o of e)if(!a.some(u=>Math.abs(u.lineNo-o.lineNo)<s)&&(a.push(o),a.length>=t))break;return a},wT=e=>e>=14?"high":e>=9?"medium":"low",ST=e=>{const t=`${e.path}:${e.startLine}-${e.endLine}`,s=e.lines.map(a=>`${a.no}: ${a.text}`).join(`
`);return`${t}
${s}`},jT=async({question:e,limit:t=5,maxFiles:s=5})=>{const a=String(e||"").trim();if(!a)return{confidence:"low",bestScore:0,references:[],snippets:[],promptText:""};const o=yT(a);if(o.length===0)return{confidence:"low",bestScore:0,references:[],snippets:[],promptText:""};const c=await xT(),u=[];for(const w of c){const _=[];if(w.lines.forEach((F,$)=>{const M=bT(F,o);M&&_.push({lineNo:$+1,score:M.score,matchedTerms:M.matchedTerms})}),_.length===0)continue;_.sort((F,$)=>$.score!==F.score?$.score-F.score:F.lineNo-$.lineNo);const j=Sm(w.path),E=o.some(F=>j.includes(F.normalized))?3:0,T=_[0]?.score||0,R=_[1]?.score||0,B=T+Math.round(R*.6)+E;u.push({...w,matches:_,fileScore:B})}u.sort((w,_)=>_.fileScore!==w.fileScore?_.fileScore-w.fileScore:w.path.localeCompare(_.path,"ja"));const h=u.slice(0,s),f=[];h.forEach(w=>{_T(w.matches,2,12).forEach(j=>{const E=Math.max(1,j.lineNo-4),T=Math.min(w.lines.length,j.lineNo+4),R=w.lines.slice(E-1,T).map((B,F)=>({no:E+F,text:B}));f.push({path:w.path,focusLine:j.lineNo,startLine:E,endLine:T,score:j.score,matchedTerms:j.matchedTerms,lines:R})})}),f.sort((w,_)=>_.score!==w.score?_.score-w.score:w.path.localeCompare(_.path,"ja"));const p=f.slice(0,t),m=p[0]?.score||0,g=wT(m),x=p.map(w=>`${w.path}:${w.focusLine}`),v=p.map(ST).join(`

`),S=v.length>9e3?`${v.slice(0,9e3)}
...`:v;return{confidence:g,bestScore:m,references:x,snippets:p,promptText:S||""}},CT="gemini-2.5-flash-lite",kT={list:"",detail:"",create:"",edit:"",data:"","data-management":"",inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"","order-list":"",users:"","api-logs":"API",trash:""},ET=e=>e==="user"||e==="assistant"||e==="system"?e:null,NT=e=>(Array.isArray(e)?e:[]).map(t=>({role:ET(t?.role),content:String(t?.content||"").trim()})).filter(t=>t.role&&t.content).slice(-8),AT=e=>typeof e=="string"?e:!e||typeof e!="object"?"":String(e.step||e.text||"").trim(),TT=["1","","","","","3","",""],RT=e=>{const t=String(e||"");return t?TT.filter(a=>t.includes(a)).length>=2:!1},M_=["","","","","",""],OT=["","","","","","",""],DT=["","","","","","","","","",""],LT=["","","","","","",""],zT=["","","","","","",""],jm="",IT=({question:e,knowledgeAssessment:t})=>{const s=String(e||"").trim();return s?LT.some(c=>s.includes(c))?"concise":zT.some(c=>s.includes(c))||/||/.test(s)||t?.shouldAskClarification||t?.confidence==="low"||M_.some(c=>s.includes(c))&&s.length<=24?"detailed":t?.confidence==="high"&&s.length<=20?"concise":"balanced":"balanced"},MT=(e,t)=>{if(!t?.top?.entry||t.confidence!=="high"||(t.bestScore||0)<10)return!1;const s=String(e||"").trim();if(!s)return!1;const a=M_.some(c=>s.includes(c));return!(s.length<=14&&a)},UT=e=>{const t=String(e||"").trim();if(!t)return null;const s=t.match(/^([1-9]\d*)\s*(?:|)?$/);if(!s)return null;const a=Number(s[1]);return Number.isInteger(a)&&a>0?a:null},BT=e=>{const t=String(e||"");return t.includes(jm)?t.split(`
`).map(s=>s.trim()).map(s=>{const a=s.match(/^(\d+)\.\s*(.+)$/);return a?{index:Number(a[1]),title:String(a[2]||"").trim()}:null}).filter(s=>s?.index&&s?.title).sort((s,a)=>s.index-a.index):[]},PT=({question:e,history:t})=>{const s=UT(e);if(!s)return null;const a=[...t||[]].reverse().find(u=>u?.role==="assistant"&&String(u?.content||"").includes(jm));if(!a)return null;const o=BT(a.content);if(o.length===0)return null;const c=o.find(u=>u.index===s)||null;return c?{kind:"selected",selectedIndex:s,selectedTitle:c.title,options:o}:{kind:"out_of_range",selectedIndex:s,options:o}},$T=(e,t)=>{if((Array.isArray(t?.hits)?t.hits:[]).length<2)return!1;const a=String(e||"").trim();if(!a)return!1;const o=a.length<=30||DT.some(f=>a.includes(f)),c=(t?.top?.matchedKeywords?.length||0)<=2,u=(t?.scoreGap||0)<=3,h=t?.confidence!=="high";return t?.shouldAskClarification||o&&c&&(u||h)},qT=(e,t=44)=>{const s=String(e||"").trim();return s?s.length<=t?s:`${s.slice(0,t-1)}`:""},FT=({knowledgeAssessment:e,currentViewLabel:t=""})=>{const s=(e?.hits||[]).slice(0,3);if(s.length===0)return"";const a=s.every(c=>{const u=String(c?.entry?.title||""),h=Array.isArray(c?.entry?.keywords)?c.entry.keywords.join(" "):"";return/csv||/i.test(`${u} ${h}`)}),o=[];return o.push(""),o.push(a?"CSV":""),t&&o.push(`: ${t}`),o.push(jm),s.forEach((c,u)=>{const h=c?.entry,f=String(h?.title||`${u+1}`),p=qT(h?.steps?.[0]||"");o.push(`${u+1}. ${f}`),p&&o.push(`   : ${p}`)}),o.push(`: ${Math.min(2,s.length)}`),o.join(`
`)},VT=(e,t=[])=>{const s=String(e||"").trim();if(!s)return s;const a=s.length<=18,o=OT.some(u=>s.includes(u));if(!a&&!o)return s;const c=[...t].reverse().find(u=>u?.role==="user"&&String(u?.content||"").trim()&&String(u?.content||"").trim()!==s);return c?`${c.content}
: ${s}`:s},Po=e=>{const t=String(e||"").trim();return t},U_=({description:e,steps:t,notes:s,responseStyle:a="balanced"})=>{const o=[],c=a==="concise",u=String(e||"").trim(),h=(Array.isArray(t)?t:[]).map(AT).map(p=>p.replace(/^\d+\.\s*/,"").trim()).filter(Boolean).slice(0,c?3:6),f=String(s||"").trim();return u&&o.push(u),h.length>0&&h.forEach((p,m)=>{o.push(`${m+1}. ${p}`)}),f&&!c&&o.push(`: ${f}`),{content:o.join(`
`).trim(),stepCount:h.length}},HT=e=>{const t=e?.raw?.candidates?.[0]?.content?.parts;return Array.isArray(t)?t.map(s=>String(s?.text||"").trim()).filter(Boolean).join(`
`).trim():""},GT=e=>{const t=String(e||"");if(!t)return"";const s=t.match(/```json\s*([\s\S]*?)\s*```/i);if(s?.[1])return s[1].trim();const a=t.indexOf("{"),o=t.lastIndexOf("}");return a>=0&&o>a?t.slice(a,o+1).trim():""},KT=(e,t="balanced")=>{const s=GT(e);if(!s)return"";try{const a=JSON.parse(s);return U_({description:a?.description||a?.title,steps:a?.steps,notes:a?.notes,responseStyle:t}).content}catch{return""}},WT=(e,t="balanced")=>{const s=e?.top?.entry;if(!s||!Array.isArray(s.steps)||s.steps.length===0)return"";const a=t==="concise",o=[];return o.push(`${s.title}`),s.steps.slice(0,a?3:5).forEach((c,u)=>{o.push(`${u+1}. ${c}`)}),s.notes&&!a&&o.push(`: ${s.notes}`),a||o.push("1"),o.join(`
`)},Jx=({question:e,currentView:t,currentViewLabel:s,knowledgeAssessment:a,codeEvidence:o,responseStyle:c="balanced"})=>{const u=WT(a,c);if(u)return Po(u);if(o?.confidence==="high"&&o.references?.length)return Po(["","1. ","2. onClick / handle","3. "].join(`
`));if(a?.shouldAskClarification){const f=I_({assessment:a,currentViewLabel:s,currentView:t});return Po(f)}const h=em({question:e,currentView:t,currentViewLabel:s,responseStyle:c});return Po(h)},YT=({question:e,currentView:t,currentViewLabel:s,roleLabel:a,history:o,codePromptText:c,codeReferences:u,responseStyle:h="balanced"})=>{const f=o.length>0?o.map(v=>`${v.role==="assistant"?"AI":""}: ${v.content}`).join(`
`):"",p=hT({question:e,currentView:t}),m=c||"",g=u?.length?u.slice(0,5).join(", "):"",x=h==="concise"?": 1 + 3":h==="detailed"?": 46":": ";return[" Recipe Management ","","","",`: ${s}`,`: ${a}`,"",":",p,"",":",m,"",`: ${g}`,"",":",f,"",`: ${e}`,x,"","JSONJSON:","{",'  "title": "",','  "description": "1",','  "servings": "",','  "ingredients": [],','  "steps": [','    { "step": "1" },','    { "step": "2" }',"  ],",'  "notes": ""',"}","",":","- steps 6","- ","- ","- 12","- ","- notes  path:line 13"].join(`
`)},QT={async askOperationQuestion({question:e,currentView:t,userRole:s,history:a=[]}){const o=String(e||"").trim();if(!o)throw new Error("");const c=kT[t]||String(t||""),u=s==="admin"?"admin":"user",h=NT(a),f=PT({question:o,history:h});if(f?.kind==="selected")return em({question:f.selectedTitle,currentView:t,currentViewLabel:c});if(f?.kind==="out_of_range"){const S=[` 1${f.options.length} `];return f.options.forEach(w=>{S.push(`${w.index}. ${w.title}`)}),S.join(`
`)}const p=VT(o,h),m=z_({question:p,currentView:t,limit:3}),g=IT({question:o,knowledgeAssessment:m}),x=await jT({question:p,limit:5,maxFiles:5});if($T(o,m)){const v=FT({knowledgeAssessment:m,currentViewLabel:c});if(v)return v}if(MT(o,m)){const v=em({question:p,currentView:t,currentViewLabel:c,responseStyle:g});return Po(v)}try{const v=[...h,{role:"user",content:o}],S=YT({question:p,currentView:t,currentViewLabel:c,roleLabel:u,history:v,codePromptText:x.promptText,codeReferences:x.references,responseStyle:g}),{data:w,error:_}=await Ae.functions.invoke("call-gemini-api",{body:{model:CT,temperature:.2,maxTokens:900,prompt:S,logFeature:"operation_qa",logContext:{source:"operation_assistant",feature:"operation_qa",currentView:t}}});if(_){let $=_.message||"AI";if(_?.context&&typeof _.context.json=="function")try{const M=await _.context.json();$=M?.error||M?.message||$}catch{}throw new Error($)}if(!w?.ok)throw new Error(w?.error||"Gemini");const j=w?.recipeData||{},E=U_({description:j?.description||j?.title,steps:j?.steps,notes:j?.notes,responseStyle:g}),T=HT(w),R=KT(T,g),B=E.content||R;return!B||E.stepCount===0&&!R||RT(B)?Jx({question:o,currentView:t,currentViewLabel:c,knowledgeAssessment:m,codeEvidence:x,responseStyle:g}):Po(B,x)}catch(v){return console.warn("operationQaService fallback:",v),Jx({question:o,currentView:t,currentViewLabel:c,knowledgeAssessment:m,codeEvidence:x,responseStyle:g})}}},ld=(e,t)=>({id:`${Date.now()}_${Math.random().toString(16).slice(2)}`,role:e,content:String(t||"")}),Xx=ld("assistant","OK"),JT={detail:["//////","","","","","","URLQR","","","","PDF","","","",""],create:["","","","","","","","","Web URL","URL",""],edit:["","","","","URL","","",""],data:["","CSV&","CSVCSV","/","","","","","",""],"data-management":["","CSV&","CSVCSV","/","","","","","",""],inventory:["","","","","","",""],planner:["","&","","(g)","","1","",""],"order-list":["","","","","","","0"],"incoming-deliveries":["PDF","","",""],"incoming-stock":["","","/",""],trash:["CSV","","",""],list:["","&","","","","","","","","","",""]},XT=["3","","","",""],ZT=({currentView:e,userRole:t})=>{const[s,a]=k.useState(!1),[o,c]=k.useState(""),[u,h]=k.useState(!1),[f,p]=k.useState([Xx]),[m,g]=k.useState(""),[x,v]=k.useState(!1),S=k.useRef(null),w=k.useRef(null),_=o.trim().length>0&&!u,j=k.useMemo(()=>JT[e]||XT,[e]),E=k.useMemo(()=>f.filter(z=>z.role==="user"||z.role==="assistant").map(z=>({role:z.role,content:z.content})).slice(-8),[f]),T=()=>{S.current&&S.current.scrollIntoView({behavior:"smooth",block:"end"})},R=()=>{a(!0),v(!1),setTimeout(()=>{w.current?.focus(),T()},0)},B=()=>{u||a(!1)},F=()=>{u||(p([Xx]),c(""),g(""),v(!1),setTimeout(()=>{w.current?.focus()},0))},$=z=>{u||(c(z),g(""),setTimeout(()=>{w.current?.focus()},0))},M=async z=>{z.preventDefault();const P=o.trim();if(!P||u)return;const H=ld("user",P),O=[...f,H];p(O),c(""),g(""),h(!0),setTimeout(T,0);try{const q=await QT.askOperationQuestion({question:P,currentView:e,userRole:t,history:[...E,{role:"user",content:P}]});p(C=>[...C,ld("assistant",q)])}catch(q){const C=q instanceof Error?q.message:"AI";g(C),p(I=>[...I,ld("assistant","")])}finally{h(!1),setTimeout(()=>{T(),w.current?.focus()},0)}};return r.jsxs(r.Fragment,{children:[r.jsx("button",{type:"button",className:"operation-assistant-fab",onClick:R,title:"AI","aria-label":"AI",children:" "}),r.jsx(an,{isOpen:s,onClose:B,title:"AI",size:"medium",showCloseButton:!u,children:r.jsxs("div",{className:"operation-assistant-modal",children:[r.jsx("div",{className:"operation-assistant-hint",children:" /  / "}),r.jsx("div",{className:"operation-assistant-prompt-toggle-wrap",children:r.jsx("button",{type:"button",className:"operation-assistant-prompt-toggle",onClick:()=>v(z=>!z),disabled:u,"aria-expanded":x,children:x?"":""})}),x&&r.jsx("div",{className:"operation-assistant-quick-prompt-panel",children:r.jsx("div",{className:"operation-assistant-quick-prompt-list",children:j.map(z=>r.jsx("button",{type:"button",className:"operation-assistant-quick-prompt-row",onClick:()=>$(z),disabled:u,children:z},z))})}),r.jsxs("div",{className:"operation-assistant-messages",children:[f.map(z=>r.jsxs("div",{className:`operation-assistant-message operation-assistant-message--${z.role}`,children:[r.jsx("div",{className:"operation-assistant-message-role",children:z.role==="user"?"":"AI"}),r.jsx("div",{className:"operation-assistant-message-content",children:z.content})]},z.id)),u&&r.jsxs("div",{className:"operation-assistant-message operation-assistant-message--assistant",children:[r.jsx("div",{className:"operation-assistant-message-role",children:"AI"}),r.jsx("div",{className:"operation-assistant-message-content",children:"..."})]}),r.jsx("div",{ref:S})]}),m&&r.jsx("div",{className:"operation-assistant-error",children:m}),r.jsxs("form",{onSubmit:M,className:"operation-assistant-form",children:[r.jsx("textarea",{ref:w,className:"operation-assistant-input",value:o,onChange:z=>c(z.target.value),placeholder:": CSV",rows:3,disabled:u}),r.jsxs("div",{className:"operation-assistant-actions",children:[r.jsx(ce,{type:"button",variant:"ghost",onClick:F,disabled:u,children:""}),r.jsx(ce,{type:"submit",variant:"primary",disabled:!_,children:u?"...":""})]})]})]})})]})},Do=async(e,t,s)=>{let a=null;try{const o=new Promise((c,u)=>{a=setTimeout(()=>u(new Error(`${s||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([e,o])}finally{a&&clearTimeout(a)}},Ap=e=>{if(!e)return"";const t=e.indexOf("@");return t>0?e.slice(0,t):e},eR=({children:e})=>{const[t,s]=k.useState(null),[a,o]=k.useState(!0),[c,u]=k.useState(!1),h=k.useCallback(async _=>{if(!_){s(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const j=_.id,E=_.email||"";let T=null;try{const I=localStorage.getItem("auth_user_cache");if(I){const L=JSON.parse(I);L&&L.id===j&&(T=L,s(L))}}catch(I){console.warn("[Auth] Failed to load cache",I)}let R=null;const B=4e3,F=2,$=async()=>{let I=0;for(;I<F;)try{const[L,V]=await Promise.all([Do(Ae.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",j).single().then(Z=>({data:Z,error:null})).catch(Z=>({data:null,error:Z})),B,"profiles.select(with_email)").catch(Z=>({data:null,error:Z})),Do(Ae.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",j).single().then(Z=>({data:Z,error:null})).catch(Z=>({data:null,error:Z})),B,"profiles.select").catch(Z=>({data:null,error:Z}))]);let G=null,Y=null;if(L?.data?.data?G=L.data.data:V?.data?.data?G=V.data.data:Y=L?.error??V?.error??new Error("Profile fetch failed"),Y)if(Y.code==="PGRST116"){const Z=_.user_metadata?.display_id?String(_.user_metadata.display_id):Ap(E)||j.slice(0,8);let A=null,U=null;const X=await Do(Ae.from("profiles").insert([{id:j,display_id:Z,email:E||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),6e3,"profiles.insert(with_email)");if(A=X?.data??null,U=X?.error??null,U&&String(U.message||"").toLowerCase().includes("email")){const se=await Do(Ae.from("profiles").insert([{id:j,display_id:Z,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),6e3,"profiles.insert");A=se?.data??null,U=se?.error??null}if(U)throw U;R=A}else throw Y;else R=G;if(R&&Object.prototype.hasOwnProperty.call(R,"email")&&E&&!R.email)try{await Ae.from("profiles").update({email:E}).eq("id",j)}catch(Z){console.warn("Failed to backfill profile email",Z)}break}catch(L){console.error(`Failed to load/create profile (Attempt ${I+1}/${F}):`,L),I++,I<F&&await new Promise(V=>setTimeout(V,300*I))}return R};if(T){$().then(I=>{if(I){const L=(_?.user_metadata?.display_id||"").toString().trim(),V=I.display_id||L||T.displayId||Ap(E)||j.slice(0,8),G=String(I.role||"user").trim().toLowerCase(),Z=E==="pingus0428@gmail.com"?!0:I.show_master_recipes===!0;s({id:j,email:E,displayId:V,role:G,showMasterRecipes:Z});try{localStorage.setItem("auth_user_cache",JSON.stringify({id:j,email:E,displayId:V,role:G,showMasterRecipes:Z}))}catch(A){console.warn("[Auth] Failed to save cache",A)}}}).catch(()=>{});return}R=await $();const M=(_?.user_metadata?.display_id||"").toString().trim(),z=R?.display_id||M||""||T?.displayId||""||Ap(E)||j.slice(0,8),P=R?.role||_?.app_metadata?.role||T?.role||"user",H=String(P).trim().toLowerCase(),q=E==="pingus0428@gmail.com"?!0:R?.show_master_recipes===!0||R?.show_master_recipes==null&&T?.showMasterRecipes===!0,C={id:j,email:E,displayId:z,role:H,showMasterRecipes:q};s(C);try{localStorage.setItem("auth_user_cache",JSON.stringify(C))}catch(I){console.warn("[Auth] Failed to save cache",I)}},[]);k.useEffect(()=>{let _=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&u(!0);const{data:j}=Ae.auth.onAuthStateChange(async(T,R)=>{T==="PASSWORD_RECOVERY"&&u(!0);try{await h(R?.user||null)}catch(B){console.error("Auth state change handler failed:",B)}});return _=j?.subscription,(async()=>{try{const{data:T}=await Do(Ae.auth.getSession(),5e3,"auth.getSession");await h(T?.session?.user||null)}catch(T){console.error("Auth init failed:",T)}finally{o(!1)}})(),()=>{try{_?.unsubscribe?.()}catch{}}},[h]);const f=k.useCallback(async(_,j)=>{const{error:E}=await Ae.auth.signInWithPassword({email:_,password:j});if(E)throw console.error("Login error:",E),new Error("")},[]),p=k.useCallback(async(_,j,E)=>{const{data:T,error:R}=await Ae.auth.signUp({email:_,password:j,options:{data:{display_id:E},emailRedirectTo:window.location.origin+"/app/"}});if(R)throw console.error("SignUp error:",R),new Error(R.message||"");const B=T?.user;if(B?.id){let F=null;F=(await Ae.from("profiles").insert([{id:B.id,display_id:E,email:_||null,role:"user",show_master_recipes:!1}]))?.error??null,F&&String(F.message||"").toLowerCase().includes("email")&&(F=(await Ae.from("profiles").insert([{id:B.id,display_id:E,role:"user",show_master_recipes:!1}]))?.error??null),F&&F.code!=="23505"&&console.error("Profile create error:",F)}return{needsEmailConfirmation:!T?.session}},[]),m=k.useCallback(async()=>{s(null),u(!1);try{localStorage.removeItem("auth_user_cache")}catch{}try{const{error:_}=await Do(Ae.auth.signOut({scope:"local"}),3e3,"auth.signOut(local)");_&&console.warn("Logout (local scope) returned error:",_)}catch(_){console.warn("Logout (local scope) failed/timed out:",_)}},[]),g=k.useCallback(_=>{!_||typeof _!="object"||s(j=>j&&{...j,..._})},[]),x=k.useCallback(async _=>{const{error:j}=await Ae.auth.resetPasswordForEmail(_,{redirectTo:window.location.origin+"/app/"});if(j)throw console.error("Password reset email error:",j),new Error("");return!0},[]),v=k.useCallback(async _=>{const{error:j}=await Ae.auth.updateUser({password:_});if(j)throw console.error("Update password error:",j),new Error("");return!0},[]),S=k.useCallback(()=>{u(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),w=k.useMemo(()=>({user:t,loading:a,login:f,register:p,logout:m,patchCurrentUserProfile:g,sendPasswordResetEmail:x,isPasswordRecovery:c,updatePassword:v,finishPasswordRecovery:S}),[t,a,f,p,m,g,x,c,v,S]);return r.jsx(p_.Provider,{value:w,children:e})},tR=({id:e,message:t,type:s="info",onClose:a})=>{k.useEffect(()=>{const c=setTimeout(()=>{a(e)},3e3);return()=>clearTimeout(c)},[e,a]);const o=()=>{switch(s){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return r.jsxs("div",{className:`toast toast-${s}`,children:[r.jsx("div",{className:"toast-icon",children:o()}),r.jsx("div",{className:"toast-message",children:t}),r.jsx("button",{className:"toast-close",onClick:()=>a(e),"aria-label":"",children:""})]})},nR=({toasts:e,onRemove:t})=>e.length===0?null:r.jsx("div",{className:"toast-container",children:e.map(s=>r.jsx(tR,{id:s.id,message:s.message,type:s.type,onClose:t},s.id))}),rR=({children:e})=>{const[t,s]=k.useState([]),a=k.useCallback((u,h="info")=>{const f=Date.now()+Math.random();s(p=>[...p,{id:f,message:u,type:h}].slice(-5))},[]),o=k.useCallback(u=>{s(h=>h.filter(f=>f.id!==u))},[]),c={showToast:a,success:u=>a(u,"success"),error:u=>a(u,"error"),warning:u=>a(u,"warning"),info:u=>a(u,"info")};return r.jsxs(m_.Provider,{value:c,children:[e,r.jsx(nR,{toasts:t,onRemove:o})]})},sR=()=>{const[e,t]=k.useState(!0),[s,a]=k.useState(!1),[o,c]=k.useState(""),[u,h]=k.useState(""),[f,p]=k.useState(""),[m,g]=k.useState(""),[x,v]=k.useState(""),[S,w]=k.useState(!1),[_,j]=k.useState(!1);Ue.useEffect(()=>{const M=localStorage.getItem("savedEmail"),z=localStorage.getItem("savedPassword");M&&(c(M),z&&h(z),j(!0))},[]);const{login:E,register:T,sendPasswordResetEmail:R}=xs(),B=async M=>{M.preventDefault(),g(""),v(""),w(!0);try{await E(o.trim(),u),_?(localStorage.setItem("savedEmail",o.trim()),localStorage.setItem("savedPassword",u)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(z){g(z.message||"")}finally{w(!1)}},F=async M=>{M.preventDefault(),g(""),v(""),w(!0);try{if(!f.trim()){g("ID: yoshito");return}(await T(o.trim(),u,f.trim()))?.needsEmailConfirmation?v(""):v(""),t(!0),h("")}catch(z){g(z.message||"")}finally{w(!1)}},$=async M=>{M.preventDefault(),g(""),v(""),w(!0);try{await R(o.trim()),v(""),a(!1)}catch(z){g(z.message||"")}finally{w(!1)}};return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:r.jsxs(vn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[r.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[r.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",r.jsx("br",{}),"Management"]}),r.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:s?"":e?"":""})]}),m&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),x&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),r.jsxs("form",{onSubmit:s?$:e?B:F,children:[r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"email",value:o,onChange:M=>c(M.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:u,onChange:M=>h(M.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&!e&&r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",r.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),r.jsx("input",{type:"text",value:f,onChange:M=>p(M.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),e&&!s&&r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[r.jsx("input",{type:"checkbox",id:"rememberMe",checked:_,onChange:M=>j(M.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),r.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),r.jsx(ce,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:S,children:s?"":e?"":""})]}),r.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s?r.jsx("button",{type:"button",onClick:()=>{a(!1),g(""),v("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):r.jsx("button",{type:"button",onClick:()=>{a(!0),g(""),v("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!s&&r.jsx("button",{type:"button",onClick:()=>{t(!e),g(""),v("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:e?"":""})]})]})})},iR=()=>{const{updatePassword:e,finishPasswordRecovery:t,logout:s}=xs(),[a,o]=Ue.useState(""),[c,u]=Ue.useState(""),[h,f]=Ue.useState(""),[p,m]=Ue.useState(""),[g,x]=Ue.useState(!1),v=async S=>{if(S.preventDefault(),f(""),m(""),!a||a.length<8){f("8");return}if(a!==c){f("");return}x(!0);try{await e(a),m(""),t()}catch(w){console.error(w),f(w.message||"")}finally{x(!1)}};return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:r.jsxs(vn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[r.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),r.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),h&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:h}),p&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:p}),r.jsxs("form",{onSubmit:v,children:[r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:a,onChange:S=>o(S.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:c,onChange:S=>u(S.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),r.jsx(ce,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:g,children:""})]}),r.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),r.jsx(ce,{variant:"ghost",onClick:s,style:{flex:1},children:""})]})]})})},Tp=({label:e,subLabel:t,variant:s="screen",showLogo:a=!0})=>r.jsxs("div",{className:s==="screen"?"loading-screen":"loading-inline",children:[a&&r.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),r.jsxs("div",{className:"loading-text",children:[e,r.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[r.jsx("span",{children:"."}),r.jsx("span",{children:"."}),r.jsx("span",{children:"."})]})]}),r.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&r.jsx("div",{className:"loading-subtext",children:t})]}),aR=24,oR=120,lR=64,cR=180,Zu="__NO_STORE__",ed="__OTHER_STORE__",uR=(e,t)=>{const s=new Set((e||[]).map(o=>String(o.id))),a=[...e||[]];for(const o of t||[]){const c=String(o.id);s.has(c)||(s.add(c),a.push(o))}return a},tm=e=>(e||"").toString().replace(/\s+/g," ").trim(),ts=e=>tm(e).toLowerCase(),Zx=new Set(bd.map(e=>ts(e)).filter(Boolean));function dR(){const{user:e,logout:t,loading:s,isPasswordRecovery:a}=xs(),o=qs(),[c,u]=jc(),[h,f]=k.useState([]),[p,m]=k.useState(!0),[g,x]=k.useState(0),[v,S]=k.useState([]),[w,_]=k.useState(!1),[j,E]=k.useState({}),[T,R]=k.useState({}),[B,F]=k.useState(!1),$=k.useRef(0),M=c.get("view"),z=(M==="create-mock"?"create":M)||"list",P=c.get("id"),H=h.find(ke=>String(ke.id)===P)||null,[O,q]=k.useState(null),[C,I]=k.useState(!1),[L,V]=k.useState(""),[G,Y]=k.useState(null),[Z,A]=k.useState(null),[U,X]=k.useState(""),[se,oe]=k.useState("none"),[Ce,ue]=k.useState(!1),[ne,we]=k.useState(!1),[Le,ge]=k.useState(new Set),[Te,de]=k.useState("normal"),[N,ve]=k.useState(!1),[fe,Q]=k.useState(!1),[K,ie]=k.useState(null),[re,ee]=k.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),le={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};k.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const ke=window.matchMedia("(max-width: 700px)"),te=()=>ee(!!ke.matches);return te(),ke.addEventListener?ke.addEventListener("change",te):ke.addListener(te),()=>{ke.removeEventListener?ke.removeEventListener("change",te):ke.removeListener(te)}},[]),k.useEffect(()=>{if(!re||!le[z]||typeof window>"u")return;const ke=`pc-recommend-shown:${z}`;try{if(window.sessionStorage.getItem(ke)==="1")return;window.sessionStorage.setItem(ke,"1")}catch{}ie(z)},[z,re]),k.useEffect(()=>{z!=="list"&&oe("none")},[z]),k.useEffect(()=>{if(typeof document>"u"||!Ce)return;const ke=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=ke}},[Ce]),k.useEffect(()=>{if(!s){_(!1);return}const ke=setTimeout(()=>_(!0),3500);return()=>clearTimeout(ke)},[s]),k.useEffect(()=>{if(h.length>0||z==="trash")return;let ke=e?.id;if(!ke)try{ke=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!ke)return;const te=An.getCachedRecipes(ke);te&&te.length>0&&(f(te),F(!0),m(!1))},[e?.id]),k.useEffect(()=>{s||e&&(Ye(),$e())},[s,e?.id]),k.useEffect(()=>{if(s)return;if(!e||e.role!=="admin"){E({}),R({});return}let ke=!1;return(async()=>{try{const te=await gs.fetchAllProfiles();if(ke)return;const je={},Oe={};for(const We of te||[])We?.id&&(je[String(We.id)]=We),We?.display_id&&(Oe[String(We.display_id)]=We);E(je),R(Oe)}catch(te){console.warn("Failed to load profiles for admin owner labels",te)}})(),()=>{ke=!0}},[s,e?.id,e?.role]);const ye=ke=>{const je=(ke?.tags||[]).find(ae=>ae&&ae.startsWith("owner:"));if(!je)return"/";const Oe=String(je.slice(6)),We=j[Oe]||T[Oe]||null;return We?We.display_id||We.email||Oe:Oe.length>12?`${Oe.slice(0,8)}`:Oe},qe=Pa(Or(tl,{activationConstraint:{distance:10}}),Or(nl,{activationConstraint:{delay:1e3,tolerance:5}}),Or(el,{coordinateGetter:Id})),Re=ke=>{const{active:te,over:je}=ke;te.id!==je.id&&f(Oe=>{const We=Oe.findIndex(Ne=>Ne.id===te.id),ae=Oe.findIndex(Ne=>Ne.id===je.id);if(We===-1||ae===-1)return Oe;const he=aa(Oe,We,ae),pe=he.map((Ne,Be)=>({id:Ne.id,order_index:Be}));return An.updateOrder(pe).catch(Ne=>console.error("Order update failed",Ne)),he})},$e=async()=>{try{const ke=await An.fetchRecentRecipes();S(ke||[])}catch(ke){console.error("Failed to load history:",ke)}},Ke=async ke=>{const te=[ke,...v.filter(je=>je!==ke)].slice(0,20);S(te);try{await An.addToHistory(ke)}catch(je){console.error("Failed to sync history",je)}},Ye=async()=>{try{const ke=await An.getDeletedCount();x(ke||0)}catch(ke){console.error("Failed to load trash count:",ke)}},Et=async()=>{if(!e)return;const ke=$.current+1;$.current=ke;const te=()=>$.current!==ke,je=re?aR:oR,Oe=re?lR:cR;try{B||m(!0);const We=await An.fetchRecipes(e,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:0,limit:je,skipCacheSave:!0,returnMeta:!0});if(te())return;let ae=We?.recipes||[],he=We?.hasMoreRaw===!0,pe=je;f(ae);let Ne=!1;for(!B&&(ae.length>0||!he)&&(m(!1),Ne=!0);he;){const Be=await An.fetchRecipes(e,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:pe,limit:Oe,skipCacheSave:!0,returnMeta:!0});if(te())return;const it=Be?.recipes||[];if(it.length>0&&(ae=uR(ae,it),f(ae),!B&&!Ne&&(m(!1),Ne=!0)),pe+=Oe,he=Be?.hasMoreRaw===!0,it.length===0&&!he)break}if(te())return;An.saveCachedRecipes(ae,e.id)}catch(We){if(te())return;console.error("Failed to fetch recipes:",We),o.error(`

(${We?.message||"unknown error"})`)}finally{te()||(m(!1),F(!1))}},{allCourses:Kt,allCategories:dt,storeCounts:bt,noStoreCount:mt,otherStoreCount:$t,courseCounts:on,categoryCounts:Ot}=k.useMemo(()=>{const ke=[...new Set(h.map(pe=>tm(pe.course)).filter(Boolean))],te=[...new Set(h.map(pe=>tm(pe.category)).filter(Boolean))],je=h.reduce((pe,Ne)=>{const Be=ts(Ne.storeName);return Be&&(pe[Be]=(pe[Be]||0)+1),pe},{}),Oe=h.reduce((pe,Ne)=>ts(Ne.storeName)?pe:pe+1,0),We=h.reduce((pe,Ne)=>{const Be=ts(Ne.storeName);return Be?Zx.has(Be)?pe:pe+1:pe},0),ae=h.reduce((pe,Ne)=>{const Be=ts(Ne.course);return Be&&(pe[Be]=(pe[Be]||0)+1),pe},{}),he=h.reduce((pe,Ne)=>{const Be=ts(Ne.category);return Be&&(pe[Be]=(pe[Be]||0)+1),pe},{});return{allCourses:ke,allCategories:te,storeCounts:je,noStoreCount:Oe,otherStoreCount:We,courseCounts:ae,categoryCounts:he}},[h]),gn=k.useMemo(()=>{const ke=ts(L),te=U.toLowerCase().trim();return h.filter(je=>{const Oe=ts(je.storeName);return L===""||L==="recent"&&v.includes(je.id)||je.tags&&je.tags.includes(L)||L===Zu&&!Oe||L===ed&&Oe&&!Zx.has(Oe)||je.category&&ts(je.category)===ke||je.course&&ts(je.course)===ke||je.storeName&&Oe===ke?te?(je.title||"").toLowerCase().includes(te)||je.description&&je.description.toLowerCase().includes(te)||Array.isArray(je.ingredients)&&je.ingredients.some(ae=>(ae?.name||"").toLowerCase().includes(te)):!0:!1})},[h,L,v,U]),Wt=()=>{V(""),X(""),oe("none"),de("normal")},Dt=L===""&&!U.trim()&&z==="list",zn=(ke,te={})=>{u({view:"detail",id:ke.id,...te})},hn=async(ke,te=!1)=>{try{if(ke.tags&&e.role!=="admin"&&e.displayId!=="yoshito"&&ke.tags.some(Oe=>Oe==="owner:yoshito")){o.warning("");return}te?(await An.restoreRecipe(ke.id),(z==="trash"||z==="detail")&&(u({view:"trash"}),ht()),o.success("")):(await An.deleteRecipe(ke.id),f(h.filter(je=>je.id!==ke.id)),u({view:"list"}),Ye())}catch(je){console.error("Failed to delete/restore recipe:",je),o.error("")}finally{Ye()}},Ct=async ke=>{try{await An.hardDeleteRecipe(ke.id),f(h.filter(te=>te.id!==ke.id)),u({view:"trash"}),o.success(""),ht(),Ye()}catch(te){console.error("Failed to hard delete recipe:",te),o.error("")}},ht=async()=>{try{$.current+=1,m(!0);const ke=await An.fetchDeletedRecipes();f(ke||[]),V("")}catch(ke){console.error("Failed to fetch deleted recipes:",ke)}finally{m(!1)}},Vt=()=>{u({view:"trash"})},qt=()=>{u({view:"list"})},cn=async()=>{ue(!1);try{await t()}catch(ke){console.error("Logout failed:",ke),o.warning("")}},Ft=async(ke,te)=>{try{let je,Oe=te;if(te&&e.role!=="admin"){const We=ke.tags?.find(he=>he.startsWith("owner:"));We===`owner:${e.id}`||e.displayId&&We===`owner:${e.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${We||"None"}) as ${e.id}. Not the owner. Switching to Create mode (Copy).`),Oe=!1)}Oe?(je=await An.updateRecipe(ke,e),f(h.map(We=>We.id===je.id?je:We))):(je=await An.createRecipe(ke,e),f([je,...h])),u(Oe?{view:"detail",id:je.id}:{view:"detail",id:je.id})}catch(je){console.error("Failed to save recipe:",je),o.error(`
: ${je.message||je.error_description||JSON.stringify(je)}`)}};k.useEffect(()=>{let ke=!1;return(async()=>{if(z!=="edit"||!P){q(null),I(!1);return}I(!0);try{const je=await An.getRecipe(P);if(ke)return;q(je)}catch(je){if(console.error("Failed to load edit recipe details",je),ke)return;q(H),o.warning("")}finally{ke||I(!1)}})(),()=>{ke=!0}},[z,P]);const _n=(ke,te="")=>{try{ke.__importId=globalThis.crypto&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}_${Math.random().toString(16).slice(2)}`}catch{ke.__importId=`${Date.now()}_${Math.random().toString(16).slice(2)}`}const je=["","baker","","","","dough","fermentation"],Oe=ke.title||ke.name||"",We=je.some(et=>Oe.toLowerCase().includes(et)),ae=["flour","","","","","","","","",""],he=["yeast","","",""],pe=ke.ingredients||[],Ne=pe.some(et=>he.some(Xe=>(et.name||"").toLowerCase().includes(Xe))),Be=pe.some(et=>ae.some(Xe=>(et.name||"").toLowerCase().includes(Xe))&&!et.name.includes(""));if(pe.some(et=>et.quantity&&String(et.quantity).includes("%")||et.unit&&String(et.unit).includes("%"))||Ne||We&&Be){ke.type="bread",ke.flours=[],ke.breadIngredients=[];const et=["flour","","","","","","","",""];if(pe.forEach(Xe=>{et.some(Mt=>(Xe.name||"").includes(Mt))?ke.flours.push(Xe):ke.breadIngredients.push(Xe)}),ke.flours.length===0&&pe.length>0){const Xe=pe[0];(Xe.name||"").includes("")&&(ke.flours.push(Xe),ke.breadIngredients=ke.breadIngredients.filter(lt=>lt!==Xe))}}ke.sourceUrl=te,te&&(ke.category="URL"),A(ke),u({view:"create"})},xn=()=>{we(!ne),ge(new Set)},un=ke=>{const te=new Set(Le);te.has(ke)?te.delete(ke):te.add(ke),ge(te)},Vn=()=>{ve(!0)},Ht=()=>{ve(!1)},Cn=async()=>{ve(!1);try{m(!0),z==="trash"?(await Promise.all(Array.from(Le).map(ke=>An.hardDeleteRecipe(ke))),ht()):(await Promise.all(Array.from(Le).map(ke=>An.deleteRecipe(ke))),f(h.filter(ke=>!Le.has(ke.id))),Ye()),ge(new Set),we(!1),o.success("")}catch(ke){console.error("Bulk delete failed",ke),o.warning(""),z==="trash"?ht():Et()}finally{m(!1)}},It=()=>{Le.size!==0&&Q(!0)},Tn=()=>{Q(!1)},Kn=async()=>{Q(!1);try{m(!0);for(const ke of Le)await An.restoreRecipe(ke);f(h.filter(ke=>!Le.has(ke.id))),Ye(),we(!1),ge(new Set),o.success(""),ht()}catch(ke){console.error("Bulk restore failed",ke),o.warning(""),ht()}finally{m(!1)}},dn=()=>{const ke=gn.map(te=>te.id);ge(new Set(ke))},Xt=ke=>{f([ke,...h]),u({view:"edit",id:ke.id})};if(k.useEffect(()=>{s||e&&(z==="trash"?ht():z==="list"&&Et())},[z,s,e?.id]),s&&!w){let ke=!1;try{const te=JSON.parse(localStorage.getItem("auth_user_cache")||"null");te?.id&&(ke=!!An.getCachedRecipes(te.id))}catch{}if(!ke)return r.jsx(Tp,{label:"",subLabel:""})}return e?a?r.jsx(iR,{}):r.jsxs(hj,{children:[N&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(vn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," ",Le.size,"",z==="trash"?"":""]}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:z==="trash"?"":""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:Ht,children:""}),r.jsx(ce,{variant:"danger",onClick:Cn,children:z==="trash"?"":""})]})]})}),fe&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(vn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," ",Le.size,""]}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(ce,{variant:"ghost",onClick:Tn,children:""}),r.jsx(ce,{variant:"secondary",onClick:Kn,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),r.jsx(an,{isOpen:!!K,onClose:()=>ie(null),title:"PC",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[r.jsx("p",{style:{marginTop:0},children:le[K]?r.jsxs(r.Fragment,{children:["",r.jsx("strong",{children:le[K]}),"/"]}):r.jsx(r.Fragment,{children:"/"})}),r.jsxs("p",{style:{marginBottom:0},children:["",r.jsx("strong",{children:"PC"}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[r.jsx(ce,{variant:"ghost",onClick:()=>{ie(null),u({view:"list"})},children:""}),r.jsx(ce,{variant:"primary",onClick:()=>ie(null),children:"OK"})]})]})}),(z==="list"||z==="trash")&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"container-header",children:[r.jsxs("h2",{className:"section-title",children:[z==="trash"?" ()":"",z==="list"&&r.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",h.length,")"]})]}),r.jsx("div",{className:"header-actions",children:z==="list"||z==="trash"?r.jsxs(r.Fragment,{children:[ne?r.jsxs(r.Fragment,{children:[r.jsx(ce,{variant:"ghost",onClick:xn,children:""}),r.jsx(ce,{variant:"secondary",onClick:dn,children:""}),z==="trash"&&r.jsxs(ce,{variant:"secondary",onClick:It,disabled:Le.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",Le.size,")"]}),r.jsxs(ce,{variant:"danger",onClick:Vn,disabled:Le.size===0,children:[z==="trash"?"":""," (",Le.size,")"]})]}):r.jsx(r.Fragment,{children:z==="list"?r.jsx(r.Fragment,{children:r.jsx(ce,{onClick:()=>{A(null),u({view:"create"})},className:"primary-action-btn",children:"+ "})}):r.jsx(ce,{variant:"ghost",onClick:qt,children:" "})}),r.jsx("button",{className:"mobile-menu-toggle",onClick:()=>ue(!Ce),"aria-label":"",children:""}),r.jsxs("div",{className:`secondary-actions ${Ce?"open":""}`,children:[r.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>ue(!1),"aria-label":"",children:""}),r.jsxs("div",{className:"secondary-actions-content",children:[r.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[r.jsxs("div",{style:{fontWeight:"bold"},children:[": ",Ts(e?.displayId||e?.email||(e?.id?`${String(e.id).slice(0,8)}`:"---"))]}),e?.role==="admin"&&r.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),e?.email&&e?.displayId&&r.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:e.email})]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),z==="list"&&r.jsxs(r.Fragment,{children:[r.jsxs(ce,{variant:"secondary",onClick:()=>{Y("url"),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{Y("image"),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsx("div",{className:"pc-recommend-note",children:r.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),r.jsxs(ce,{variant:"secondary",onClick:()=>{u({view:"inventory"}),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{u({view:"incoming-deliveries"}),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{u({view:"incoming-stock"}),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{u({view:"planner"}),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{u({view:"order-list"}),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsxs(ce,{variant:"secondary",onClick:()=>{u({view:"data"}),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),e?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsxs(ce,{variant:"secondary",onClick:()=>{u({view:"users"}),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(ce,{variant:"secondary",onClick:()=>{u({view:"api-logs"}),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," API"]})]}),r.jsx("div",{className:"menu-divider"})]}),!ne&&r.jsxs(ce,{variant:"ghost",onClick:()=>{xn(),ue(!1)},className:"danger-text",children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," ",z==="trash"?"":""]}),z==="list"&&r.jsxs(ce,{variant:"ghost",onClick:()=>{Vt(),ue(!1)},style:{position:"relative"},children:[r.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",g>0&&r.jsx("span",{className:"trash-badge",children:g})]}),r.jsxs(ce,{variant:"ghost",onClick:()=>{qt(),ue(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsxs(ce,{variant:"ghost",onClick:cn,children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]})]}),r.jsx("div",{className:`menu-backdrop ${Ce?"open":""}`,onClick:()=>ue(!1),"aria-hidden":"true"})]}):null})]}),z==="list"&&r.jsxs("div",{className:"list-toolbar",children:[r.jsxs("div",{className:"search-container search-container--compact",children:[r.jsx("span",{className:"search-icon",children:""}),r.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:U,onChange:ke=>X(ke.target.value)})]}),r.jsxs("div",{className:"public-recipe-toggles",children:[r.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${se==="mine"?"active":""}`,"aria-pressed":se==="mine",onClick:()=>oe("mine"),children:" "}),r.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${se==="others"?"active":""}`,"aria-pressed":se==="others",onClick:()=>oe("others"),children:" "}),se!=="none"&&r.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>oe("none"),children:" "})]})]}),r.jsxs("div",{className:"tag-filter-container",children:[r.jsxs("select",{className:"store-filter-select",value:L===Zu?Zu:L===ed?ed:bd.includes(L)?L:"",onChange:ke=>V(ke.target.value||""),children:[r.jsx("option",{value:"",children:""}),bd.map(ke=>r.jsxs("option",{value:ke,children:[ke," (",bt[ts(ke)]||0,")"]},ke)),r.jsxs("option",{value:Zu,children:[" (",mt,")"]}),r.jsxs("option",{value:ed,children:[" (",$t,")"]})]}),r.jsxs("select",{className:"store-filter-select",value:Kt.includes(L)?L:"",onChange:ke=>V(ke.target.value||""),children:[r.jsx("option",{value:"",children:""}),Kt.sort().map(ke=>r.jsxs("option",{value:ke,children:[ke," (",on[ts(ke)]||0,")"]},ke))]}),r.jsxs("select",{className:"store-filter-select",value:dt.includes(L)?L:"",onChange:ke=>V(ke.target.value||""),children:[r.jsx("option",{value:"",children:""}),dt.sort().map(ke=>r.jsxs("option",{value:ke,children:[ke," (",Ot[ts(ke)]||0,")"]},ke))]}),r.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[r.jsx("button",{className:`tag-filter-btn ${Te==="normal"?"active":""}`,onClick:()=>de("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),r.jsx("button",{className:`tag-filter-btn ${Te==="all"?"active":""}`,onClick:()=>de("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),p?r.jsx(Tp,{label:B?"":"",subLabel:B?void 0:"",variant:"inline",showLogo:!1}):h.length===0?r.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[z==="trash"?"":"",L!==""&&r.jsx("p",{children:""})]}):gn.length===0?r.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:["",r.jsx("p",{style:{marginTop:"0.5rem"},children:"//"}),r.jsx("div",{style:{marginTop:"1rem"},children:r.jsx(ce,{variant:"secondary",size:"sm",onClick:Wt,children:""})})]}):r.jsxs("div",{className:"main-content-wrapper",children:[z==="list"&&r.jsx("div",{className:"recent-list-wrapper",children:r.jsx(Y2,{recipes:h,recentIds:v,onSelect:zn})}),r.jsx("div",{className:"recipe-list-container",children:z==="list"?r.jsx(ra,{sensors:qe,collisionDetection:pd,onDragEnd:Re,children:r.jsx(L0,{recipes:gn,onSelectRecipe:zn,isSelectMode:ne,selectedIds:Le,onToggleSelection:un,disableDrag:!Dt,displayMode:Te,publicRecipeView:se,showOwner:e?.role==="admin",ownerLabelFn:ye,currentUser:e})}):r.jsx(L0,{recipes:gn,onSelectRecipe:zn,isSelectMode:ne,selectedIds:Le,onToggleSelection:un,disableDrag:!0,displayMode:Te,publicRecipeView:se,showOwner:e?.role==="admin",ownerLabelFn:ye,currentUser:e})})]})]}),z==="detail"&&H&&r.jsx(t2,{recipe:H,ownerLabel:e?.role==="admin"?ye(H):void 0,isDeleted:!!H.deletedAt,onBack:()=>{c.get("from")==="planner"?u({view:"planner"}):H.deletedAt?Vt():qt()},backLabel:c.get("from")==="planner"?" ":void 0,onList:c.get("from")==="planner"?qt:void 0,onEdit:()=>u({view:"edit",id:H.id,from:c.get("from")}),onDelete:hn,onView:Ke,onHardDelete:Ct,onDuplicate:Xt}),z==="edit"&&P&&(C?r.jsx(Tp,{label:"",subLabel:"URL"}):O&&r.jsx(Ox,{initialData:O,onCancel:()=>u({view:"detail",id:P}),onSave:ke=>Ft(ke,!0)},`edit-${P}`)),z==="create"&&r.jsx(Ox,{initialData:Z,onCancel:()=>{u({view:"list"}),A(null)},onSave:ke=>Ft(ke,!1)},Z?.__importId?`create-form-imported-${Z.__importId}`:"create-form"),G&&r.jsx(E_,{initialMode:G,onClose:()=>Y(null),onImport:_n}),(z==="data"||z==="data-management")&&r.jsx(W2,{onBack:()=>u({view:"list"})}),z==="levain-guide"&&r.jsx(Q2,{onBack:()=>u({view:"list"})}),z==="users"&&e?.role==="admin"&&r.jsx(J2,{onBack:()=>u({view:"list"})}),z==="inventory"&&r.jsx(nA,{onBack:()=>u({view:"list"})}),z==="incoming-deliveries"&&r.jsx(mA,{onBack:()=>u({view:"list"})}),z==="incoming-stock"&&r.jsx(qA,{onBack:()=>u({view:"list"})}),z==="planner"&&r.jsx(GA,{onBack:()=>u({view:"list"}),onSelectRecipe:ke=>zn(ke,{from:"planner"}),onNavigateToOrderList:()=>u({view:"order-list"})}),z==="order-list"&&r.jsx(KA,{onBack:()=>u({view:"list"}),onNavigateToPlanner:()=>u({view:"planner"})}),z==="api-logs"&&e?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{padding:"20px 20px 0",textAlign:"left"},children:r.jsx(ce,{onClick:()=>u({view:"list"}),children:" "})}),r.jsx(JA,{}),r.jsx("div",{style:{padding:"20px",textAlign:"center"},children:r.jsx(ce,{onClick:()=>u({view:"list"}),children:" "})})]}),r.jsx(ZT,{currentView:z,userRole:e?.role})]}):r.jsx(sR,{})}function hR(){return r.jsx(rR,{children:r.jsx(eR,{children:r.jsx(dR,{})})})}class fR extends Ue.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,s){console.error("Uncaught error:",t,s),this.setState({error:t,errorInfo:s})}render(){return this.state.hasError?r.jsxs("div",{style:{padding:"2rem",color:"red"},children:[r.jsx("h1",{children:""}),r.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),r.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),r.jsx("br",{}),r.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}zS.createRoot(document.getElementById("root")).render(r.jsx(k.StrictMode,{children:r.jsx(fR,{children:r.jsx(nj,{children:r.jsx(hR,{})})})}));export{Lu as a,nm as b,Ju as c,pR as g};
