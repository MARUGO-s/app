(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function s(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(l){if(l.ep)return;l.ep=!0;const c=s(l);fetch(l.href,c)}})();var Tu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kp(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function qA(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var s=function a(){var l=!1;try{l=this instanceof a}catch{}return l?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(n).forEach(function(a){var l=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(s,a,l.get?l:{enumerable:!0,get:function(){return n[a]}})}),s}var Df={exports:{}},Bl={};var qv;function aS(){if(qv)return Bl;qv=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function s(a,l,c){var u=null;if(c!==void 0&&(u=""+c),l.key!==void 0&&(u=""+l.key),"key"in l){c={};for(var h in l)h!=="key"&&(c[h]=l[h])}else c=l;return l=c.ref,{$$typeof:n,type:a,key:u,ref:l!==void 0?l:null,props:c}}return Bl.Fragment=e,Bl.jsx=s,Bl.jsxs=s,Bl}var Fv;function oS(){return Fv||(Fv=1,Df.exports=aS()),Df.exports}var r=oS(),zf={exports:{}},zt={};var Hv;function lS(){if(Hv)return zt;Hv=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),u=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),b=Symbol.iterator;function v(A){return A===null||typeof A!="object"?null:(A=b&&A[b]||A["@@iterator"],typeof A=="function"?A:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,w={};function j(A,L,J){this.props=A,this.context=L,this.refs=w,this.updater=J||S}j.prototype.isReactComponent={},j.prototype.setState=function(A,L){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,L,"setState")},j.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function N(){}N.prototype=j.prototype;function T(A,L,J){this.props=A,this.context=L,this.refs=w,this.updater=J||S}var R=T.prototype=new N;R.constructor=T,_(R,j.prototype),R.isPureReactComponent=!0;var $=Array.isArray;function F(){}var q={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function U(A,L,J){var ae=J.ref;return{$$typeof:n,type:A,key:L,ref:ae!==void 0?ae:null,props:J}}function P(A,L){return U(A.type,L,A.props)}function V(A){return typeof A=="object"&&A!==null&&A.$$typeof===n}function D(A){var L={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(J){return L[J]})}var H=/\/+/g;function C(A,L){return typeof A=="object"&&A!==null&&A.key!=null?D(""+A.key):L.toString(36)}function M(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(F,F):(A.status="pending",A.then(function(L){A.status==="pending"&&(A.status="fulfilled",A.value=L)},function(L){A.status==="pending"&&(A.status="rejected",A.reason=L)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function z(A,L,J,ae,ue){var Ce=typeof A;(Ce==="undefined"||Ce==="boolean")&&(A=null);var fe=!1;if(A===null)fe=!0;else switch(Ce){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(A.$$typeof){case n:case e:fe=!0;break;case m:return fe=A._init,z(fe(A._payload),L,J,ae,ue)}}if(fe)return ue=ue(A),fe=ae===""?"."+C(A,0):ae,$(ue)?(J="",fe!=null&&(J=fe.replace(H,"$&/")+"/"),z(ue,L,J,"",function(le){return le})):ue!=null&&(V(ue)&&(ue=P(ue,J+(ue.key==null||A&&A.key===ue.key?"":(""+ue.key).replace(H,"$&/")+"/")+fe)),L.push(ue)),1;fe=0;var ne=ae===""?".":ae+":";if($(A))for(var be=0;be<A.length;be++)ae=A[be],Ce=ne+C(ae,be),fe+=z(ae,L,J,Ce,ue);else if(be=v(A),typeof be=="function")for(A=be.call(A),be=0;!(ae=A.next()).done;)ae=ae.value,Ce=ne+C(ae,be++),fe+=z(ae,L,J,Ce,ue);else if(Ce==="object"){if(typeof A.then=="function")return z(M(A),L,J,ae,ue);throw L=String(A),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.")}return fe}function B(A,L,J){if(A==null)return A;var ae=[],ue=0;return z(A,ae,"","",function(Ce){return L.call(J,Ce,ue++)}),ae}function K(A){if(A._status===-1){var L=A._result;L=L(),L.then(function(J){(A._status===0||A._status===-1)&&(A._status=1,A._result=J)},function(J){(A._status===0||A._status===-1)&&(A._status=2,A._result=J)}),A._status===-1&&(A._status=0,A._result=L)}if(A._status===1)return A._result.default;throw A._result}var Q=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var L=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(L))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)},Z={map:B,forEach:function(A,L,J){B(A,function(){L.apply(this,arguments)},J)},count:function(A){var L=0;return B(A,function(){L++}),L},toArray:function(A){return B(A,function(L){return L})||[]},only:function(A){if(!V(A))throw Error("React.Children.only expected to receive a single React element child.");return A}};return zt.Activity=y,zt.Children=Z,zt.Component=j,zt.Fragment=s,zt.Profiler=l,zt.PureComponent=T,zt.StrictMode=a,zt.Suspense=f,zt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=q,zt.__COMPILER_RUNTIME={__proto__:null,c:function(A){return q.H.useMemoCache(A)}},zt.cache=function(A){return function(){return A.apply(null,arguments)}},zt.cacheSignal=function(){return null},zt.cloneElement=function(A,L,J){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var ae=_({},A.props),ue=A.key;if(L!=null)for(Ce in L.key!==void 0&&(ue=""+L.key),L)!I.call(L,Ce)||Ce==="key"||Ce==="__self"||Ce==="__source"||Ce==="ref"&&L.ref===void 0||(ae[Ce]=L[Ce]);var Ce=arguments.length-2;if(Ce===1)ae.children=J;else if(1<Ce){for(var fe=Array(Ce),ne=0;ne<Ce;ne++)fe[ne]=arguments[ne+2];ae.children=fe}return U(A.type,ue,ae)},zt.createContext=function(A){return A={$$typeof:u,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:c,_context:A},A},zt.createElement=function(A,L,J){var ae,ue={},Ce=null;if(L!=null)for(ae in L.key!==void 0&&(Ce=""+L.key),L)I.call(L,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(ue[ae]=L[ae]);var fe=arguments.length-2;if(fe===1)ue.children=J;else if(1<fe){for(var ne=Array(fe),be=0;be<fe;be++)ne[be]=arguments[be+2];ue.children=ne}if(A&&A.defaultProps)for(ae in fe=A.defaultProps,fe)ue[ae]===void 0&&(ue[ae]=fe[ae]);return U(A,Ce,ue)},zt.createRef=function(){return{current:null}},zt.forwardRef=function(A){return{$$typeof:h,render:A}},zt.isValidElement=V,zt.lazy=function(A){return{$$typeof:m,_payload:{_status:-1,_result:A},_init:K}},zt.memo=function(A,L){return{$$typeof:p,type:A,compare:L===void 0?null:L}},zt.startTransition=function(A){var L=q.T,J={};q.T=J;try{var ae=A(),ue=q.S;ue!==null&&ue(J,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(F,Q)}catch(Ce){Q(Ce)}finally{L!==null&&J.types!==null&&(L.types=J.types),q.T=L}},zt.unstable_useCacheRefresh=function(){return q.H.useCacheRefresh()},zt.use=function(A){return q.H.use(A)},zt.useActionState=function(A,L,J){return q.H.useActionState(A,L,J)},zt.useCallback=function(A,L){return q.H.useCallback(A,L)},zt.useContext=function(A){return q.H.useContext(A)},zt.useDebugValue=function(){},zt.useDeferredValue=function(A,L){return q.H.useDeferredValue(A,L)},zt.useEffect=function(A,L){return q.H.useEffect(A,L)},zt.useEffectEvent=function(A){return q.H.useEffectEvent(A)},zt.useId=function(){return q.H.useId()},zt.useImperativeHandle=function(A,L,J){return q.H.useImperativeHandle(A,L,J)},zt.useInsertionEffect=function(A,L){return q.H.useInsertionEffect(A,L)},zt.useLayoutEffect=function(A,L){return q.H.useLayoutEffect(A,L)},zt.useMemo=function(A,L){return q.H.useMemo(A,L)},zt.useOptimistic=function(A,L){return q.H.useOptimistic(A,L)},zt.useReducer=function(A,L,J){return q.H.useReducer(A,L,J)},zt.useRef=function(A){return q.H.useRef(A)},zt.useState=function(A){return q.H.useState(A)},zt.useSyncExternalStore=function(A,L,J){return q.H.useSyncExternalStore(A,L,J)},zt.useTransition=function(){return q.H.useTransition()},zt.version="19.2.3",zt}var Vv;function gc(){return Vv||(Vv=1,zf.exports=lS()),zf.exports}var k=gc();const Ie=Kp(k);var Mf={exports:{}},$l={},Lf={exports:{}},Uf={};var Gv;function cS(){return Gv||(Gv=1,(function(n){function e(z,B){var K=z.length;z.push(B);e:for(;0<K;){var Q=K-1>>>1,Z=z[Q];if(0<l(Z,B))z[Q]=B,z[K]=Z,K=Q;else break e}}function s(z){return z.length===0?null:z[0]}function a(z){if(z.length===0)return null;var B=z[0],K=z.pop();if(K!==B){z[0]=K;e:for(var Q=0,Z=z.length,A=Z>>>1;Q<A;){var L=2*(Q+1)-1,J=z[L],ae=L+1,ue=z[ae];if(0>l(J,K))ae<Z&&0>l(ue,J)?(z[Q]=ue,z[ae]=K,Q=ae):(z[Q]=J,z[L]=K,Q=L);else if(ae<Z&&0>l(ue,K))z[Q]=ue,z[ae]=K,Q=ae;else break e}}return B}function l(z,B){var K=z.sortIndex-B.sortIndex;return K!==0?K:z.id-B.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;n.unstable_now=function(){return c.now()}}else{var u=Date,h=u.now();n.unstable_now=function(){return u.now()-h}}var f=[],p=[],m=1,y=null,b=3,v=!1,S=!1,_=!1,w=!1,j=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;function R(z){for(var B=s(p);B!==null;){if(B.callback===null)a(p);else if(B.startTime<=z)a(p),B.sortIndex=B.expirationTime,e(f,B);else break;B=s(p)}}function $(z){if(_=!1,R(z),!S)if(s(f)!==null)S=!0,F||(F=!0,D());else{var B=s(p);B!==null&&M($,B.startTime-z)}}var F=!1,q=-1,I=5,U=-1;function P(){return w?!0:!(n.unstable_now()-U<I)}function V(){if(w=!1,F){var z=n.unstable_now();U=z;var B=!0;try{e:{S=!1,_&&(_=!1,N(q),q=-1),v=!0;var K=b;try{t:{for(R(z),y=s(f);y!==null&&!(y.expirationTime>z&&P());){var Q=y.callback;if(typeof Q=="function"){y.callback=null,b=y.priorityLevel;var Z=Q(y.expirationTime<=z);if(z=n.unstable_now(),typeof Z=="function"){y.callback=Z,R(z),B=!0;break t}y===s(f)&&a(f),R(z)}else a(f);y=s(f)}if(y!==null)B=!0;else{var A=s(p);A!==null&&M($,A.startTime-z),B=!1}}break e}finally{y=null,b=K,v=!1}B=void 0}}finally{B?D():F=!1}}}var D;if(typeof T=="function")D=function(){T(V)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,C=H.port2;H.port1.onmessage=V,D=function(){C.postMessage(null)}}else D=function(){j(V,0)};function M(z,B){q=j(function(){z(n.unstable_now())},B)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(z){z.callback=null},n.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<z?Math.floor(1e3/z):5},n.unstable_getCurrentPriorityLevel=function(){return b},n.unstable_next=function(z){switch(b){case 1:case 2:case 3:var B=3;break;default:B=b}var K=b;b=B;try{return z()}finally{b=K}},n.unstable_requestPaint=function(){w=!0},n.unstable_runWithPriority=function(z,B){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var K=b;b=z;try{return B()}finally{b=K}},n.unstable_scheduleCallback=function(z,B,K){var Q=n.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?Q+K:Q):K=Q,z){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=K+Z,z={id:m++,callback:B,priorityLevel:z,startTime:K,expirationTime:Z,sortIndex:-1},K>Q?(z.sortIndex=K,e(p,z),s(f)===null&&z===s(p)&&(_?(N(q),q=-1):_=!0,M($,K-Q))):(z.sortIndex=Z,e(f,z),S||v||(S=!0,F||(F=!0,D()))),z},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(z){var B=b;return function(){var K=b;b=B;try{return z.apply(this,arguments)}finally{b=K}}}})(Uf)),Uf}var Wv;function uS(){return Wv||(Wv=1,Lf.exports=cS()),Lf.exports}var If={exports:{}},Er={};var Kv;function dS(){if(Kv)return Er;Kv=1;var n=gc();function e(f){var p="https://react.dev/errors/"+f;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)p+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+f+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var a={d:{f:s,r:function(){throw Error(e(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},l=Symbol.for("react.portal");function c(f,p,m){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:y==null?null:""+y,children:f,containerInfo:p,implementation:m}}var u=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,p){if(f==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Er.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Er.createPortal=function(f,p){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return c(f,p,null,m)},Er.flushSync=function(f){var p=u.T,m=a.p;try{if(u.T=null,a.p=2,f)return f()}finally{u.T=p,a.p=m,a.d.f()}},Er.preconnect=function(f,p){typeof f=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,a.d.C(f,p))},Er.prefetchDNS=function(f){typeof f=="string"&&a.d.D(f)},Er.preinit=function(f,p){if(typeof f=="string"&&p&&typeof p.as=="string"){var m=p.as,y=h(m,p.crossOrigin),b=typeof p.integrity=="string"?p.integrity:void 0,v=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;m==="style"?a.d.S(f,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:y,integrity:b,fetchPriority:v}):m==="script"&&a.d.X(f,{crossOrigin:y,integrity:b,fetchPriority:v,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Er.preinitModule=function(f,p){if(typeof f=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var m=h(p.as,p.crossOrigin);a.d.M(f,{crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&a.d.M(f)},Er.preload=function(f,p){if(typeof f=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var m=p.as,y=h(m,p.crossOrigin);a.d.L(f,m,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Er.preloadModule=function(f,p){if(typeof f=="string")if(p){var m=h(p.as,p.crossOrigin);a.d.m(f,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else a.d.m(f)},Er.requestFormReset=function(f){a.d.r(f)},Er.unstable_batchedUpdates=function(f,p){return f(p)},Er.useFormState=function(f,p,m){return u.H.useFormState(f,p,m)},Er.useFormStatus=function(){return u.H.useHostTransitionStatus()},Er.version="19.2.3",Er}var Yv;function Bx(){if(Yv)return If.exports;Yv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),If.exports=dS(),If.exports}var Qv;function hS(){if(Qv)return $l;Qv=1;var n=uS(),e=gc(),s=Bx();function a(t){var i="https://react.dev/errors/"+t;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)i+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function c(t){var i=t,o=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&4098)!==0&&(o=i.return),t=i.return;while(t)}return i.tag===3?o:null}function u(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function h(t){if(t.tag===31){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function f(t){if(c(t)!==t)throw Error(a(188))}function p(t){var i=t.alternate;if(!i){if(i=c(t),i===null)throw Error(a(188));return i!==t?null:t}for(var o=t,d=i;;){var g=o.return;if(g===null)break;var x=g.alternate;if(x===null){if(d=g.return,d!==null){o=d;continue}break}if(g.child===x.child){for(x=g.child;x;){if(x===o)return f(g),t;if(x===d)return f(g),i;x=x.sibling}throw Error(a(188))}if(o.return!==d.return)o=g,d=x;else{for(var O=!1,G=g.child;G;){if(G===o){O=!0,o=g,d=x;break}if(G===d){O=!0,d=g,o=x;break}G=G.sibling}if(!O){for(G=x.child;G;){if(G===o){O=!0,o=x,d=g;break}if(G===d){O=!0,d=x,o=g;break}G=G.sibling}if(!O)throw Error(a(189))}}if(o.alternate!==d)throw Error(a(190))}if(o.tag!==3)throw Error(a(188));return o.stateNode.current===o?t:i}function m(t){var i=t.tag;if(i===5||i===26||i===27||i===6)return t;for(t=t.child;t!==null;){if(i=m(t),i!==null)return i;t=t.sibling}return null}var y=Object.assign,b=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),T=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),U=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),V=Symbol.iterator;function D(t){return t===null||typeof t!="object"?null:(t=V&&t[V]||t["@@iterator"],typeof t=="function"?t:null)}var H=Symbol.for("react.client.reference");function C(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===H?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _:return"Fragment";case j:return"Profiler";case w:return"StrictMode";case $:return"Suspense";case F:return"SuspenseList";case U:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case S:return"Portal";case T:return t.displayName||"Context";case N:return(t._context.displayName||"Context")+".Consumer";case R:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case q:return i=t.displayName||null,i!==null?i:C(t.type)||"Memo";case I:i=t._payload,t=t._init;try{return C(t(i))}catch{}}return null}var M=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K={pending:!1,data:null,method:null,action:null},Q=[],Z=-1;function A(t){return{current:t}}function L(t){0>Z||(t.current=Q[Z],Q[Z]=null,Z--)}function J(t,i){Z++,Q[Z]=t.current,t.current=i}var ae=A(null),ue=A(null),Ce=A(null),fe=A(null);function ne(t,i){switch(J(Ce,i),J(ue,t),J(ae,null),i.nodeType){case 9:case 11:t=(t=i.documentElement)&&(t=t.namespaceURI)?dv(t):0;break;default:if(t=i.tagName,i=i.namespaceURI)i=dv(i),t=hv(i,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}L(ae),J(ae,t)}function be(){L(ae),L(ue),L(Ce)}function le(t){t.memoizedState!==null&&J(fe,t);var i=ae.current,o=hv(i,t.type);i!==o&&(J(ue,t),J(ae,o))}function ie(t){ue.current===t&&(L(ae),L(ue)),fe.current===t&&(L(fe),Ml._currentValue=K)}var Te,Le;function E(t){if(Te===void 0)try{throw Error()}catch(o){var i=o.stack.trim().match(/\n( *(at )?)/);Te=i&&i[1]||"",Le=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Te+t+Le}var ve=!1;function ge(t,i){if(!t||ve)return"";ve=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var d={DetermineComponentFrameRoot:function(){try{if(i){var He=function(){throw Error()};if(Object.defineProperty(He.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(He,[])}catch($e){var Me=$e}Reflect.construct(t,[],He)}else{try{He.call()}catch($e){Me=$e}t.call(He.prototype)}}else{try{throw Error()}catch($e){Me=$e}(He=t())&&typeof He.catch=="function"&&He.catch(function(){})}}catch($e){if($e&&Me&&typeof $e.stack=="string")return[$e.stack,Me.stack]}return[null,null]}};d.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(d.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(d.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=d.DetermineComponentFrameRoot(),O=x[0],G=x[1];if(O&&G){var pe=O.split(`
`),De=G.split(`
`);for(g=d=0;d<pe.length&&!pe[d].includes("DetermineComponentFrameRoot");)d++;for(;g<De.length&&!De[g].includes("DetermineComponentFrameRoot");)g++;if(d===pe.length||g===De.length)for(d=pe.length-1,g=De.length-1;1<=d&&0<=g&&pe[d]!==De[g];)g--;for(;1<=d&&0<=g;d--,g--)if(pe[d]!==De[g]){if(d!==1||g!==1)do if(d--,g--,0>g||pe[d]!==De[g]){var qe=`
`+pe[d].replace(" at new "," at ");return t.displayName&&qe.includes("<anonymous>")&&(qe=qe.replace("<anonymous>",t.displayName)),qe}while(1<=d&&0<=g);break}}}finally{ve=!1,Error.prepareStackTrace=o}return(o=t?t.displayName||t.name:"")?E(o):""}function Y(t,i){switch(t.tag){case 26:case 27:case 5:return E(t.type);case 16:return E("Lazy");case 13:return t.child!==i&&i!==null?E("Suspense Fallback"):E("Suspense");case 19:return E("SuspenseList");case 0:case 15:return ge(t.type,!1);case 11:return ge(t.type.render,!1);case 1:return ge(t.type,!0);case 31:return E("Activity");default:return""}}function W(t){try{var i="",o=null;do i+=Y(t,o),o=t,t=t.return;while(t);return i}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}var oe=Object.prototype.hasOwnProperty,re=n.unstable_scheduleCallback,ee=n.unstable_cancelCallback,de=n.unstable_shouldYield,me=n.unstable_requestPaint,Be=n.unstable_now,Re=n.unstable_getCurrentPriorityLevel,Pe=n.unstable_ImmediatePriority,Je=n.unstable_UserBlockingPriority,We=n.unstable_NormalPriority,Et=n.unstable_LowPriority,Wt=n.unstable_IdlePriority,dt=n.log,yt=n.unstable_setDisableYieldValue,ft=null,Tt=null;function sn(t){if(typeof dt=="function"&&yt(t),Tt&&typeof Tt.setStrictMode=="function")try{Tt.setStrictMode(ft,t)}catch{}}var wt=Math.clz32?Math.clz32:qt,Un=Math.log,Lt=Math.LN2;function qt(t){return t>>>=0,t===0?32:31-(Un(t)/Lt|0)|0}var un=256,yn=262144,_t=4194304;function jt(t){var i=t&42;if(i!==0)return i;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Kt(t,i,o){var d=t.pendingLanes;if(d===0)return 0;var g=0,x=t.suspendedLanes,O=t.pingedLanes;t=t.warmLanes;var G=d&134217727;return G!==0?(d=G&~x,d!==0?g=jt(d):(O&=G,O!==0?g=jt(O):o||(o=G&~t,o!==0&&(g=jt(o))))):(G=d&~x,G!==0?g=jt(G):O!==0?g=jt(O):o||(o=d&~t,o!==0&&(g=jt(o)))),g===0?0:i!==0&&i!==g&&(i&x)===0&&(x=g&-g,o=i&-i,x>=o||x===32&&(o&4194048)!==0)?i:g}function Ft(t,i){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&i)===0}function dn(t,i){switch(t){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ht(){var t=_t;return _t<<=1,(_t&62914560)===0&&(_t=4194304),t}function gn(t){for(var i=[],o=0;31>o;o++)i.push(t);return i}function hn(t,i){t.pendingLanes|=i,i!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function an(t,i,o,d,g,x){var O=t.pendingLanes;t.pendingLanes=o,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=o,t.entangledLanes&=o,t.errorRecoveryDisabledLanes&=o,t.shellSuspendCounter=0;var G=t.entanglements,pe=t.expirationTimes,De=t.hiddenUpdates;for(o=O&~o;0<o;){var qe=31-wt(o),He=1<<qe;G[qe]=0,pe[qe]=-1;var Me=De[qe];if(Me!==null)for(De[qe]=null,qe=0;qe<Me.length;qe++){var $e=Me[qe];$e!==null&&($e.lane&=-536870913)}o&=~He}d!==0&&Dn(t,d,0),x!==0&&g===0&&t.tag!==0&&(t.suspendedLanes|=x&~(O&~i))}function Dn(t,i,o){t.pendingLanes|=i,t.suspendedLanes&=~i;var d=31-wt(i);t.entangledLanes|=i,t.entanglements[d]=t.entanglements[d]|1073741824|o&261930}function Vt(t,i){var o=t.entangledLanes|=i;for(t=t.entanglements;o;){var d=31-wt(o),g=1<<d;g&i|t[d]&i&&(t[d]|=i),o&=~g}}function Cn(t,i){var o=i&-i;return o=(o&42)!==0?1:It(o),(o&(t.suspendedLanes|i))!==0?0:o}function It(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function zn(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function qn(){var t=B.p;return t!==0?t:(t=window.event,t===void 0?32:Mv(t.type))}function fn(t,i){var o=B.p;try{return B.p=t,i()}finally{B.p=o}}var Se=Math.random().toString(36).slice(2),nt="__reactFiber$"+Se,te="__reactProps$"+Se,ze="__reactContainer$"+Se,Ae="__reactEvents$"+Se,Qe="__reactListeners$"+Se,ce="__reactHandles$"+Se,se="__reactResources$"+Se,xe="__reactMarker$"+Se;function Ne(t){delete t[nt],delete t[te],delete t[Ae],delete t[Qe],delete t[ce]}function Ke(t){var i=t[nt];if(i)return i;for(var o=t.parentNode;o;){if(i=o[ze]||o[nt]){if(o=i.alternate,i.child!==null||o!==null&&o.child!==null)for(t=xv(t);t!==null;){if(o=t[nt])return o;t=xv(t)}return i}t=o,o=t.parentNode}return null}function tt(t){if(t=t[nt]||t[ze]){var i=t.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return t}return null}function Ze(t){var i=t.tag;if(i===5||i===26||i===27||i===6)return t.stateNode;throw Error(a(33))}function Xe(t){var i=t[se];return i||(i=t[se]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function lt(t){t[xe]=!0}var Pt=new Set,$t={};function Ve(t,i){ct(t,i),ct(t+"Capture",i)}function ct(t,i){for($t[t]=i,t=0;t<i.length;t++)Pt.add(i[t])}var nn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vn={},Xn={};function yr(t){return oe.call(Xn,t)?!0:oe.call(Vn,t)?!1:nn.test(t)?Xn[t]=!0:(Vn[t]=!0,!1)}function $r(t,i,o){if(yr(i))if(o===null)t.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":t.removeAttribute(i);return;case"boolean":var d=i.toLowerCase().slice(0,5);if(d!=="data-"&&d!=="aria-"){t.removeAttribute(i);return}}t.setAttribute(i,""+o)}}function Or(t,i,o){if(o===null)t.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(i);return}t.setAttribute(i,""+o)}}function Pr(t,i,o,d){if(d===null)t.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(o);return}t.setAttributeNS(i,o,""+d)}}function fr(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function qs(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function vi(t,i,o){var d=Object.getOwnPropertyDescriptor(t.constructor.prototype,i);if(!t.hasOwnProperty(i)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var g=d.get,x=d.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return g.call(this)},set:function(O){o=""+O,x.call(this,O)}}),Object.defineProperty(t,i,{enumerable:d.enumerable}),{getValue:function(){return o},setValue:function(O){o=""+O},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function Os(t){if(!t._valueTracker){var i=qs(t)?"checked":"value";t._valueTracker=vi(t,i,""+t[i])}}function $a(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var o=i.getValue(),d="";return t&&(d=qs(t)?t.checked?"true":"false":t.value),t=d,t!==o?(i.setValue(t),!0):!1}function xi(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var je=/[\n"\\]/g;function rt(t){return t.replace(je,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function mt(t,i,o,d,g,x,O,G){t.name="",O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?t.type=O:t.removeAttribute("type"),i!=null?O==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+fr(i)):t.value!==""+fr(i)&&(t.value=""+fr(i)):O!=="submit"&&O!=="reset"||t.removeAttribute("value"),i!=null?vn(t,O,fr(i)):o!=null?vn(t,O,fr(o)):d!=null&&t.removeAttribute("value"),g==null&&x!=null&&(t.defaultChecked=!!x),g!=null&&(t.checked=g&&typeof g!="function"&&typeof g!="symbol"),G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?t.name=""+fr(G):t.removeAttribute("name")}function Dt(t,i,o,d,g,x,O,G){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(t.type=x),i!=null||o!=null){if(!(x!=="submit"&&x!=="reset"||i!=null)){Os(t);return}o=o!=null?""+fr(o):"",i=i!=null?""+fr(i):o,G||i===t.value||(t.value=i),t.defaultValue=i}d=d??g,d=typeof d!="function"&&typeof d!="symbol"&&!!d,t.checked=G?t.checked:!!d,t.defaultChecked=!!d,O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"&&(t.name=O),Os(t)}function vn(t,i,o){i==="number"&&xi(t.ownerDocument)===t||t.defaultValue===""+o||(t.defaultValue=""+o)}function En(t,i,o,d){if(t=t.options,i){i={};for(var g=0;g<o.length;g++)i["$"+o[g]]=!0;for(o=0;o<t.length;o++)g=i.hasOwnProperty("$"+t[o].value),t[o].selected!==g&&(t[o].selected=g),g&&d&&(t[o].defaultSelected=!0)}else{for(o=""+fr(o),i=null,g=0;g<t.length;g++){if(t[g].value===o){t[g].selected=!0,d&&(t[g].defaultSelected=!0);return}i!==null||t[g].disabled||(i=t[g])}i!==null&&(i.selected=!0)}}function An(t,i,o){if(i!=null&&(i=""+fr(i),i!==t.value&&(t.value=i),o==null)){t.defaultValue!==i&&(t.defaultValue=i);return}t.defaultValue=o!=null?""+fr(o):""}function ar(t,i,o,d){if(i==null){if(d!=null){if(o!=null)throw Error(a(92));if(M(d)){if(1<d.length)throw Error(a(93));d=d[0]}o=d}o==null&&(o=""),i=o}o=fr(i),t.defaultValue=o,d=t.textContent,d===o&&d!==""&&d!==null&&(t.value=d),Os(t)}function Rt(t,i){if(i){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=i;return}}t.textContent=i}var Zn=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kn(t,i,o){var d=i.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?d?t.setProperty(i,""):i==="float"?t.cssFloat="":t[i]="":d?t.setProperty(i,o):typeof o!="number"||o===0||Zn.has(i)?i==="float"?t.cssFloat=o:t[i]=(""+o).trim():t[i]=o+"px"}function Yn(t,i,o){if(i!=null&&typeof i!="object")throw Error(a(62));if(t=t.style,o!=null){for(var d in o)!o.hasOwnProperty(d)||i!=null&&i.hasOwnProperty(d)||(d.indexOf("--")===0?t.setProperty(d,""):d==="float"?t.cssFloat="":t[d]="");for(var g in i)d=i[g],i.hasOwnProperty(g)&&o[g]!==d&&kn(t,g,d)}else for(var x in i)i.hasOwnProperty(x)&&kn(t,x,i[x])}function Xr(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zr=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),on=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function or(t){return on.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function vr(){}var Ds=null;function sa(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var gs=null,zs=null;function Zo(t){var i=tt(t);if(i&&(t=i.stateNode)){var o=t[te]||null;e:switch(t=i.stateNode,i.type){case"input":if(mt(t,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),i=o.name,o.type==="radio"&&i!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+rt(""+i)+'"][type="radio"]'),i=0;i<o.length;i++){var d=o[i];if(d!==t&&d.form===t.form){var g=d[te]||null;if(!g)throw Error(a(90));mt(d,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(i=0;i<o.length;i++)d=o[i],d.form===t.form&&$a(d)}break e;case"textarea":An(t,o.value,o.defaultValue);break e;case"select":i=o.value,i!=null&&En(t,!!o.multiple,i,!1)}}}var el=!1;function ia(t,i,o){if(el)return t(i,o);el=!0;try{var d=t(i);return d}finally{if(el=!1,(gs!==null||zs!==null)&&(lu(),gs&&(i=gs,t=zs,zs=gs=null,Zo(i),t)))for(i=0;i<t.length;i++)Zo(t[i])}}function bi(t,i){var o=t.stateNode;if(o===null)return null;var d=o[te]||null;if(d===null)return null;o=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(t=t.type,d=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!d;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(a(231,i,typeof o));return o}var ys=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),X=!1;if(ys)try{var ye={};Object.defineProperty(ye,"passive",{get:function(){X=!0}}),window.addEventListener("test",ye,ye),window.removeEventListener("test",ye,ye)}catch{X=!1}var we=null,Ue=null,Ge=null;function Ye(){if(Ge)return Ge;var t,i=Ue,o=i.length,d,g="value"in we?we.value:we.textContent,x=g.length;for(t=0;t<o&&i[t]===g[t];t++);var O=o-t;for(d=1;d<=O&&i[o-d]===g[x-d];d++);return Ge=g.slice(t,1<d?1-d:void 0)}function et(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function st(){return!0}function it(){return!1}function ot(t){function i(o,d,g,x,O){this._reactName=o,this._targetInst=g,this.type=d,this.nativeEvent=x,this.target=O,this.currentTarget=null;for(var G in t)t.hasOwnProperty(G)&&(o=t[G],this[G]=o?o(x):x[G]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?st:it,this.isPropagationStopped=it,this}return y(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=st)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=st)},persist:function(){},isPersistent:st}),i}var ht={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},vt=ot(ht),at=y({},ht,{view:0,detail:0}),Ot=ot(at),In,Bn,es,vs=y({},at,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_i,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==es&&(es&&t.type==="mousemove"?(In=t.screenX-es.screenX,Bn=t.screenY-es.screenY):Bn=In=0,es=t),In)},movementY:function(t){return"movementY"in t?t.movementY:Bn}}),gt=ot(vs),St=y({},vs,{dataTransfer:0}),At=ot(St),Tn=y({},at,{relatedTarget:0}),Fn=ot(Tn),er=y({},ht,{animationName:0,elapsedTime:0,pseudoElement:0}),Gt=ot(er),xr=y({},ht,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Hn=ot(xr),Fs=y({},ht,{data:0}),xs=ot(Fs),wi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Hs(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=mm[t])?!!i[t]:!1}function _i(){return Hs}var aa=y({},at,{key:function(t){if(t.key){var i=wi[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=et(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?tl[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_i,charCode:function(t){return t.type==="keypress"?et(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?et(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),vw=ot(aa),xw=y({},vs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gm=ot(xw),bw=y({},at,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_i}),ww=ot(bw),_w=y({},ht,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sw=ot(_w),jw=y({},vs,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Cw=ot(jw),kw=y({},ht,{newState:0,oldState:0}),Nw=ot(kw),Ew=[9,13,27,32],Id=ys&&"CompositionEvent"in window,nl=null;ys&&"documentMode"in document&&(nl=document.documentMode);var Aw=ys&&"TextEvent"in window&&!nl,ym=ys&&(!Id||nl&&8<nl&&11>=nl),vm=" ",xm=!1;function bm(t,i){switch(t){case"keyup":return Ew.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wm(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Pa=!1;function Tw(t,i){switch(t){case"compositionend":return wm(i);case"keypress":return i.which!==32?null:(xm=!0,vm);case"textInput":return t=i.data,t===vm&&xm?null:t;default:return null}}function Rw(t,i){if(Pa)return t==="compositionend"||!Id&&bm(t,i)?(t=Ye(),Ge=Ue=we=null,Pa=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return ym&&i.locale!=="ko"?null:i.data;default:return null}}var Ow={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _m(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!Ow[t.type]:i==="textarea"}function Sm(t,i,o,d){gs?zs?zs.push(d):zs=[d]:gs=d,i=mu(i,"onChange"),0<i.length&&(o=new vt("onChange","change",null,o,d),t.push({event:o,listeners:i}))}var rl=null,sl=null;function Dw(t){iv(t,0)}function Nc(t){var i=Ze(t);if($a(i))return t}function jm(t,i){if(t==="change")return i}var Cm=!1;if(ys){var Bd;if(ys){var $d="oninput"in document;if(!$d){var km=document.createElement("div");km.setAttribute("oninput","return;"),$d=typeof km.oninput=="function"}Bd=$d}else Bd=!1;Cm=Bd&&(!document.documentMode||9<document.documentMode)}function Nm(){rl&&(rl.detachEvent("onpropertychange",Em),sl=rl=null)}function Em(t){if(t.propertyName==="value"&&Nc(sl)){var i=[];Sm(i,sl,t,sa(t)),ia(Dw,i)}}function zw(t,i,o){t==="focusin"?(Nm(),rl=i,sl=o,rl.attachEvent("onpropertychange",Em)):t==="focusout"&&Nm()}function Mw(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Nc(sl)}function Lw(t,i){if(t==="click")return Nc(i)}function Uw(t,i){if(t==="input"||t==="change")return Nc(i)}function Iw(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var qr=typeof Object.is=="function"?Object.is:Iw;function il(t,i){if(qr(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var o=Object.keys(t),d=Object.keys(i);if(o.length!==d.length)return!1;for(d=0;d<o.length;d++){var g=o[d];if(!oe.call(i,g)||!qr(t[g],i[g]))return!1}return!0}function Am(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Tm(t,i){var o=Am(t);t=0;for(var d;o;){if(o.nodeType===3){if(d=t+o.textContent.length,t<=i&&d>=i)return{node:o,offset:i-t};t=d}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Am(o)}}function Rm(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?Rm(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function Om(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var i=xi(t.document);i instanceof t.HTMLIFrameElement;){try{var o=typeof i.contentWindow.location.href=="string"}catch{o=!1}if(o)t=i.contentWindow;else break;i=xi(t.document)}return i}function Pd(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}var Bw=ys&&"documentMode"in document&&11>=document.documentMode,qa=null,qd=null,al=null,Fd=!1;function Dm(t,i,o){var d=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Fd||qa==null||qa!==xi(d)||(d=qa,"selectionStart"in d&&Pd(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),al&&il(al,d)||(al=d,d=mu(qd,"onSelect"),0<d.length&&(i=new vt("onSelect","select",null,i,o),t.push({event:i,listeners:d}),i.target=qa)))}function oa(t,i){var o={};return o[t.toLowerCase()]=i.toLowerCase(),o["Webkit"+t]="webkit"+i,o["Moz"+t]="moz"+i,o}var Fa={animationend:oa("Animation","AnimationEnd"),animationiteration:oa("Animation","AnimationIteration"),animationstart:oa("Animation","AnimationStart"),transitionrun:oa("Transition","TransitionRun"),transitionstart:oa("Transition","TransitionStart"),transitioncancel:oa("Transition","TransitionCancel"),transitionend:oa("Transition","TransitionEnd")},Hd={},zm={};ys&&(zm=document.createElement("div").style,"AnimationEvent"in window||(delete Fa.animationend.animation,delete Fa.animationiteration.animation,delete Fa.animationstart.animation),"TransitionEvent"in window||delete Fa.transitionend.transition);function la(t){if(Hd[t])return Hd[t];if(!Fa[t])return t;var i=Fa[t],o;for(o in i)if(i.hasOwnProperty(o)&&o in zm)return Hd[t]=i[o];return t}var Mm=la("animationend"),Lm=la("animationiteration"),Um=la("animationstart"),$w=la("transitionrun"),Pw=la("transitionstart"),qw=la("transitioncancel"),Im=la("transitionend"),Bm=new Map,Vd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Vd.push("scrollEnd");function bs(t,i){Bm.set(t,i),Ve(i,[t])}var Ec=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},ts=[],Ha=0,Gd=0;function Ac(){for(var t=Ha,i=Gd=Ha=0;i<t;){var o=ts[i];ts[i++]=null;var d=ts[i];ts[i++]=null;var g=ts[i];ts[i++]=null;var x=ts[i];if(ts[i++]=null,d!==null&&g!==null){var O=d.pending;O===null?g.next=g:(g.next=O.next,O.next=g),d.pending=g}x!==0&&$m(o,g,x)}}function Tc(t,i,o,d){ts[Ha++]=t,ts[Ha++]=i,ts[Ha++]=o,ts[Ha++]=d,Gd|=d,t.lanes|=d,t=t.alternate,t!==null&&(t.lanes|=d)}function Wd(t,i,o,d){return Tc(t,i,o,d),Rc(t)}function ca(t,i){return Tc(t,null,null,i),Rc(t)}function $m(t,i,o){t.lanes|=o;var d=t.alternate;d!==null&&(d.lanes|=o);for(var g=!1,x=t.return;x!==null;)x.childLanes|=o,d=x.alternate,d!==null&&(d.childLanes|=o),x.tag===22&&(t=x.stateNode,t===null||t._visibility&1||(g=!0)),t=x,x=x.return;return t.tag===3?(x=t.stateNode,g&&i!==null&&(g=31-wt(o),t=x.hiddenUpdates,d=t[g],d===null?t[g]=[i]:d.push(i),i.lane=o|536870912),x):null}function Rc(t){if(50<El)throw El=0,nf=null,Error(a(185));for(var i=t.return;i!==null;)t=i,i=t.return;return t.tag===3?t.stateNode:null}var Va={};function Fw(t,i,o,d){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fr(t,i,o,d){return new Fw(t,i,o,d)}function Kd(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Vs(t,i){var o=t.alternate;return o===null?(o=Fr(t.tag,i,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=i,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&65011712,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,i=t.dependencies,o.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o.refCleanup=t.refCleanup,o}function Pm(t,i){t.flags&=65011714;var o=t.alternate;return o===null?(t.childLanes=0,t.lanes=i,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=o.childLanes,t.lanes=o.lanes,t.child=o.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=o.memoizedProps,t.memoizedState=o.memoizedState,t.updateQueue=o.updateQueue,t.type=o.type,i=o.dependencies,t.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t}function Oc(t,i,o,d,g,x){var O=0;if(d=t,typeof t=="function")Kd(t)&&(O=1);else if(typeof t=="string")O=K_(t,o,ae.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case U:return t=Fr(31,o,i,g),t.elementType=U,t.lanes=x,t;case _:return ua(o.children,g,x,i);case w:O=8,g|=24;break;case j:return t=Fr(12,o,i,g|2),t.elementType=j,t.lanes=x,t;case $:return t=Fr(13,o,i,g),t.elementType=$,t.lanes=x,t;case F:return t=Fr(19,o,i,g),t.elementType=F,t.lanes=x,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case T:O=10;break e;case N:O=9;break e;case R:O=11;break e;case q:O=14;break e;case I:O=16,d=null;break e}O=29,o=Error(a(130,t===null?"null":typeof t,"")),d=null}return i=Fr(O,o,i,g),i.elementType=t,i.type=d,i.lanes=x,i}function ua(t,i,o,d){return t=Fr(7,t,d,i),t.lanes=o,t}function Yd(t,i,o){return t=Fr(6,t,null,i),t.lanes=o,t}function qm(t){var i=Fr(18,null,null,0);return i.stateNode=t,i}function Qd(t,i,o){return i=Fr(4,t.children!==null?t.children:[],t.key,i),i.lanes=o,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}var Fm=new WeakMap;function ns(t,i){if(typeof t=="object"&&t!==null){var o=Fm.get(t);return o!==void 0?o:(i={value:t,source:i,stack:W(i)},Fm.set(t,i),i)}return{value:t,source:i,stack:W(i)}}var Ga=[],Wa=0,Dc=null,ol=0,rs=[],ss=0,Si=null,Ms=1,Ls="";function Gs(t,i){Ga[Wa++]=ol,Ga[Wa++]=Dc,Dc=t,ol=i}function Hm(t,i,o){rs[ss++]=Ms,rs[ss++]=Ls,rs[ss++]=Si,Si=t;var d=Ms;t=Ls;var g=32-wt(d)-1;d&=~(1<<g),o+=1;var x=32-wt(i)+g;if(30<x){var O=g-g%5;x=(d&(1<<O)-1).toString(32),d>>=O,g-=O,Ms=1<<32-wt(i)+g|o<<g|d,Ls=x+t}else Ms=1<<x|o<<g|d,Ls=t}function Jd(t){t.return!==null&&(Gs(t,1),Hm(t,1,0))}function Xd(t){for(;t===Dc;)Dc=Ga[--Wa],Ga[Wa]=null,ol=Ga[--Wa],Ga[Wa]=null;for(;t===Si;)Si=rs[--ss],rs[ss]=null,Ls=rs[--ss],rs[ss]=null,Ms=rs[--ss],rs[ss]=null}function Vm(t,i){rs[ss++]=Ms,rs[ss++]=Ls,rs[ss++]=Si,Ms=i.id,Ls=i.overflow,Si=t}var br=null,Mn=null,en=!1,ji=null,is=!1,Zd=Error(a(519));function Ci(t){var i=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ll(ns(i,t)),Zd}function Gm(t){var i=t.stateNode,o=t.type,d=t.memoizedProps;switch(i[nt]=t,i[te]=d,o){case"dialog":Qt("cancel",i),Qt("close",i);break;case"iframe":case"object":case"embed":Qt("load",i);break;case"video":case"audio":for(o=0;o<Tl.length;o++)Qt(Tl[o],i);break;case"source":Qt("error",i);break;case"img":case"image":case"link":Qt("error",i),Qt("load",i);break;case"details":Qt("toggle",i);break;case"input":Qt("invalid",i),Dt(i,d.value,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name,!0);break;case"select":Qt("invalid",i);break;case"textarea":Qt("invalid",i),ar(i,d.value,d.defaultValue,d.children)}o=d.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||i.textContent===""+o||d.suppressHydrationWarning===!0||cv(i.textContent,o)?(d.popover!=null&&(Qt("beforetoggle",i),Qt("toggle",i)),d.onScroll!=null&&Qt("scroll",i),d.onScrollEnd!=null&&Qt("scrollend",i),d.onClick!=null&&(i.onclick=vr),i=!0):i=!1,i||Ci(t,!0)}function Wm(t){for(br=t.return;br;)switch(br.tag){case 5:case 31:case 13:is=!1;return;case 27:case 3:is=!0;return;default:br=br.return}}function Ka(t){if(t!==br)return!1;if(!en)return Wm(t),en=!0,!1;var i=t.tag,o;if((o=i!==3&&i!==27)&&((o=i===5)&&(o=t.type,o=!(o!=="form"&&o!=="button")||vf(t.type,t.memoizedProps)),o=!o),o&&Mn&&Ci(t),Wm(t),i===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(317));Mn=vv(t)}else if(i===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(317));Mn=vv(t)}else i===27?(i=Mn,Bi(t.type)?(t=Sf,Sf=null,Mn=t):Mn=i):Mn=br?os(t.stateNode.nextSibling):null;return!0}function da(){Mn=br=null,en=!1}function eh(){var t=ji;return t!==null&&(Lr===null?Lr=t:Lr.push.apply(Lr,t),ji=null),t}function ll(t){ji===null?ji=[t]:ji.push(t)}var th=A(null),ha=null,Ws=null;function ki(t,i,o){J(th,i._currentValue),i._currentValue=o}function Ks(t){t._currentValue=th.current,L(th)}function nh(t,i,o){for(;t!==null;){var d=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),t===o)break;t=t.return}}function rh(t,i,o,d){var g=t.child;for(g!==null&&(g.return=t);g!==null;){var x=g.dependencies;if(x!==null){var O=g.child;x=x.firstContext;e:for(;x!==null;){var G=x;x=g;for(var pe=0;pe<i.length;pe++)if(G.context===i[pe]){x.lanes|=o,G=x.alternate,G!==null&&(G.lanes|=o),nh(x.return,o,t),d||(O=null);break e}x=G.next}}else if(g.tag===18){if(O=g.return,O===null)throw Error(a(341));O.lanes|=o,x=O.alternate,x!==null&&(x.lanes|=o),nh(O,o,t),O=null}else O=g.child;if(O!==null)O.return=g;else for(O=g;O!==null;){if(O===t){O=null;break}if(g=O.sibling,g!==null){g.return=O.return,O=g;break}O=O.return}g=O}}function Ya(t,i,o,d){t=null;for(var g=i,x=!1;g!==null;){if(!x){if((g.flags&524288)!==0)x=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var O=g.alternate;if(O===null)throw Error(a(387));if(O=O.memoizedProps,O!==null){var G=g.type;qr(g.pendingProps.value,O.value)||(t!==null?t.push(G):t=[G])}}else if(g===fe.current){if(O=g.alternate,O===null)throw Error(a(387));O.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(t!==null?t.push(Ml):t=[Ml])}g=g.return}t!==null&&rh(i,t,o,d),i.flags|=262144}function zc(t){for(t=t.firstContext;t!==null;){if(!qr(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function fa(t){ha=t,Ws=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function wr(t){return Km(ha,t)}function Mc(t,i){return ha===null&&fa(t),Km(t,i)}function Km(t,i){var o=i._currentValue;if(i={context:i,memoizedValue:o,next:null},Ws===null){if(t===null)throw Error(a(308));Ws=i,t.dependencies={lanes:0,firstContext:i},t.flags|=524288}else Ws=Ws.next=i;return o}var Hw=typeof AbortController<"u"?AbortController:function(){var t=[],i=this.signal={aborted:!1,addEventListener:function(o,d){t.push(d)}};this.abort=function(){i.aborted=!0,t.forEach(function(o){return o()})}},Vw=n.unstable_scheduleCallback,Gw=n.unstable_NormalPriority,tr={$$typeof:T,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function sh(){return{controller:new Hw,data:new Map,refCount:0}}function cl(t){t.refCount--,t.refCount===0&&Vw(Gw,function(){t.controller.abort()})}var ul=null,ih=0,Qa=0,Ja=null;function Ww(t,i){if(ul===null){var o=ul=[];ih=0,Qa=cf(),Ja={status:"pending",value:void 0,then:function(d){o.push(d)}}}return ih++,i.then(Ym,Ym),i}function Ym(){if(--ih===0&&ul!==null){Ja!==null&&(Ja.status="fulfilled");var t=ul;ul=null,Qa=0,Ja=null;for(var i=0;i<t.length;i++)(0,t[i])()}}function Kw(t,i){var o=[],d={status:"pending",value:null,reason:null,then:function(g){o.push(g)}};return t.then(function(){d.status="fulfilled",d.value=i;for(var g=0;g<o.length;g++)(0,o[g])(i)},function(g){for(d.status="rejected",d.reason=g,g=0;g<o.length;g++)(0,o[g])(void 0)}),d}var Qm=z.S;z.S=function(t,i){Dy=Be(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&Ww(t,i),Qm!==null&&Qm(t,i)};var pa=A(null);function ah(){var t=pa.current;return t!==null?t:Nn.pooledCache}function Lc(t,i){i===null?J(pa,pa.current):J(pa,i.pool)}function Jm(){var t=ah();return t===null?null:{parent:tr._currentValue,pool:t}}var Xa=Error(a(460)),oh=Error(a(474)),Uc=Error(a(542)),Ic={then:function(){}};function Xm(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Zm(t,i,o){switch(o=t[o],o===void 0?t.push(i):o!==i&&(i.then(vr,vr),i=o),i.status){case"fulfilled":return i.value;case"rejected":throw t=i.reason,tg(t),t;default:if(typeof i.status=="string")i.then(vr,vr);else{if(t=Nn,t!==null&&100<t.shellSuspendCounter)throw Error(a(482));t=i,t.status="pending",t.then(function(d){if(i.status==="pending"){var g=i;g.status="fulfilled",g.value=d}},function(d){if(i.status==="pending"){var g=i;g.status="rejected",g.reason=d}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw t=i.reason,tg(t),t}throw ga=i,Xa}}function ma(t){try{var i=t._init;return i(t._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(ga=o,Xa):o}}var ga=null;function eg(){if(ga===null)throw Error(a(459));var t=ga;return ga=null,t}function tg(t){if(t===Xa||t===Uc)throw Error(a(483))}var Za=null,dl=0;function Bc(t){var i=dl;return dl+=1,Za===null&&(Za=[]),Zm(Za,t,i)}function hl(t,i){i=i.props.ref,t.ref=i!==void 0?i:null}function $c(t,i){throw i.$$typeof===b?Error(a(525)):(t=Object.prototype.toString.call(i),Error(a(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t)))}function ng(t){function i(ke,_e){if(t){var Oe=ke.deletions;Oe===null?(ke.deletions=[_e],ke.flags|=16):Oe.push(_e)}}function o(ke,_e){if(!t)return null;for(;_e!==null;)i(ke,_e),_e=_e.sibling;return null}function d(ke){for(var _e=new Map;ke!==null;)ke.key!==null?_e.set(ke.key,ke):_e.set(ke.index,ke),ke=ke.sibling;return _e}function g(ke,_e){return ke=Vs(ke,_e),ke.index=0,ke.sibling=null,ke}function x(ke,_e,Oe){return ke.index=Oe,t?(Oe=ke.alternate,Oe!==null?(Oe=Oe.index,Oe<_e?(ke.flags|=67108866,_e):Oe):(ke.flags|=67108866,_e)):(ke.flags|=1048576,_e)}function O(ke){return t&&ke.alternate===null&&(ke.flags|=67108866),ke}function G(ke,_e,Oe,Fe){return _e===null||_e.tag!==6?(_e=Yd(Oe,ke.mode,Fe),_e.return=ke,_e):(_e=g(_e,Oe),_e.return=ke,_e)}function pe(ke,_e,Oe,Fe){var bt=Oe.type;return bt===_?qe(ke,_e,Oe.props.children,Fe,Oe.key):_e!==null&&(_e.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===I&&ma(bt)===_e.type)?(_e=g(_e,Oe.props),hl(_e,Oe),_e.return=ke,_e):(_e=Oc(Oe.type,Oe.key,Oe.props,null,ke.mode,Fe),hl(_e,Oe),_e.return=ke,_e)}function De(ke,_e,Oe,Fe){return _e===null||_e.tag!==4||_e.stateNode.containerInfo!==Oe.containerInfo||_e.stateNode.implementation!==Oe.implementation?(_e=Qd(Oe,ke.mode,Fe),_e.return=ke,_e):(_e=g(_e,Oe.children||[]),_e.return=ke,_e)}function qe(ke,_e,Oe,Fe,bt){return _e===null||_e.tag!==7?(_e=ua(Oe,ke.mode,Fe,bt),_e.return=ke,_e):(_e=g(_e,Oe),_e.return=ke,_e)}function He(ke,_e,Oe){if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return _e=Yd(""+_e,ke.mode,Oe),_e.return=ke,_e;if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case v:return Oe=Oc(_e.type,_e.key,_e.props,null,ke.mode,Oe),hl(Oe,_e),Oe.return=ke,Oe;case S:return _e=Qd(_e,ke.mode,Oe),_e.return=ke,_e;case I:return _e=ma(_e),He(ke,_e,Oe)}if(M(_e)||D(_e))return _e=ua(_e,ke.mode,Oe,null),_e.return=ke,_e;if(typeof _e.then=="function")return He(ke,Bc(_e),Oe);if(_e.$$typeof===T)return He(ke,Mc(ke,_e),Oe);$c(ke,_e)}return null}function Me(ke,_e,Oe,Fe){var bt=_e!==null?_e.key:null;if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint")return bt!==null?null:G(ke,_e,""+Oe,Fe);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case v:return Oe.key===bt?pe(ke,_e,Oe,Fe):null;case S:return Oe.key===bt?De(ke,_e,Oe,Fe):null;case I:return Oe=ma(Oe),Me(ke,_e,Oe,Fe)}if(M(Oe)||D(Oe))return bt!==null?null:qe(ke,_e,Oe,Fe,null);if(typeof Oe.then=="function")return Me(ke,_e,Bc(Oe),Fe);if(Oe.$$typeof===T)return Me(ke,_e,Mc(ke,Oe),Fe);$c(ke,Oe)}return null}function $e(ke,_e,Oe,Fe,bt){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number"||typeof Fe=="bigint")return ke=ke.get(Oe)||null,G(_e,ke,""+Fe,bt);if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case v:return ke=ke.get(Fe.key===null?Oe:Fe.key)||null,pe(_e,ke,Fe,bt);case S:return ke=ke.get(Fe.key===null?Oe:Fe.key)||null,De(_e,ke,Fe,bt);case I:return Fe=ma(Fe),$e(ke,_e,Oe,Fe,bt)}if(M(Fe)||D(Fe))return ke=ke.get(Oe)||null,qe(_e,ke,Fe,bt,null);if(typeof Fe.then=="function")return $e(ke,_e,Oe,Bc(Fe),bt);if(Fe.$$typeof===T)return $e(ke,_e,Oe,Mc(_e,Fe),bt);$c(_e,Fe)}return null}function ut(ke,_e,Oe,Fe){for(var bt=null,ln=null,pt=_e,Bt=_e=0,Zt=null;pt!==null&&Bt<Oe.length;Bt++){pt.index>Bt?(Zt=pt,pt=null):Zt=pt.sibling;var cn=Me(ke,pt,Oe[Bt],Fe);if(cn===null){pt===null&&(pt=Zt);break}t&&pt&&cn.alternate===null&&i(ke,pt),_e=x(cn,_e,Bt),ln===null?bt=cn:ln.sibling=cn,ln=cn,pt=Zt}if(Bt===Oe.length)return o(ke,pt),en&&Gs(ke,Bt),bt;if(pt===null){for(;Bt<Oe.length;Bt++)pt=He(ke,Oe[Bt],Fe),pt!==null&&(_e=x(pt,_e,Bt),ln===null?bt=pt:ln.sibling=pt,ln=pt);return en&&Gs(ke,Bt),bt}for(pt=d(pt);Bt<Oe.length;Bt++)Zt=$e(pt,ke,Bt,Oe[Bt],Fe),Zt!==null&&(t&&Zt.alternate!==null&&pt.delete(Zt.key===null?Bt:Zt.key),_e=x(Zt,_e,Bt),ln===null?bt=Zt:ln.sibling=Zt,ln=Zt);return t&&pt.forEach(function(Hi){return i(ke,Hi)}),en&&Gs(ke,Bt),bt}function Ct(ke,_e,Oe,Fe){if(Oe==null)throw Error(a(151));for(var bt=null,ln=null,pt=_e,Bt=_e=0,Zt=null,cn=Oe.next();pt!==null&&!cn.done;Bt++,cn=Oe.next()){pt.index>Bt?(Zt=pt,pt=null):Zt=pt.sibling;var Hi=Me(ke,pt,cn.value,Fe);if(Hi===null){pt===null&&(pt=Zt);break}t&&pt&&Hi.alternate===null&&i(ke,pt),_e=x(Hi,_e,Bt),ln===null?bt=Hi:ln.sibling=Hi,ln=Hi,pt=Zt}if(cn.done)return o(ke,pt),en&&Gs(ke,Bt),bt;if(pt===null){for(;!cn.done;Bt++,cn=Oe.next())cn=He(ke,cn.value,Fe),cn!==null&&(_e=x(cn,_e,Bt),ln===null?bt=cn:ln.sibling=cn,ln=cn);return en&&Gs(ke,Bt),bt}for(pt=d(pt);!cn.done;Bt++,cn=Oe.next())cn=$e(pt,ke,Bt,cn.value,Fe),cn!==null&&(t&&cn.alternate!==null&&pt.delete(cn.key===null?Bt:cn.key),_e=x(cn,_e,Bt),ln===null?bt=cn:ln.sibling=cn,ln=cn);return t&&pt.forEach(function(iS){return i(ke,iS)}),en&&Gs(ke,Bt),bt}function Sn(ke,_e,Oe,Fe){if(typeof Oe=="object"&&Oe!==null&&Oe.type===_&&Oe.key===null&&(Oe=Oe.props.children),typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case v:e:{for(var bt=Oe.key;_e!==null;){if(_e.key===bt){if(bt=Oe.type,bt===_){if(_e.tag===7){o(ke,_e.sibling),Fe=g(_e,Oe.props.children),Fe.return=ke,ke=Fe;break e}}else if(_e.elementType===bt||typeof bt=="object"&&bt!==null&&bt.$$typeof===I&&ma(bt)===_e.type){o(ke,_e.sibling),Fe=g(_e,Oe.props),hl(Fe,Oe),Fe.return=ke,ke=Fe;break e}o(ke,_e);break}else i(ke,_e);_e=_e.sibling}Oe.type===_?(Fe=ua(Oe.props.children,ke.mode,Fe,Oe.key),Fe.return=ke,ke=Fe):(Fe=Oc(Oe.type,Oe.key,Oe.props,null,ke.mode,Fe),hl(Fe,Oe),Fe.return=ke,ke=Fe)}return O(ke);case S:e:{for(bt=Oe.key;_e!==null;){if(_e.key===bt)if(_e.tag===4&&_e.stateNode.containerInfo===Oe.containerInfo&&_e.stateNode.implementation===Oe.implementation){o(ke,_e.sibling),Fe=g(_e,Oe.children||[]),Fe.return=ke,ke=Fe;break e}else{o(ke,_e);break}else i(ke,_e);_e=_e.sibling}Fe=Qd(Oe,ke.mode,Fe),Fe.return=ke,ke=Fe}return O(ke);case I:return Oe=ma(Oe),Sn(ke,_e,Oe,Fe)}if(M(Oe))return ut(ke,_e,Oe,Fe);if(D(Oe)){if(bt=D(Oe),typeof bt!="function")throw Error(a(150));return Oe=bt.call(Oe),Ct(ke,_e,Oe,Fe)}if(typeof Oe.then=="function")return Sn(ke,_e,Bc(Oe),Fe);if(Oe.$$typeof===T)return Sn(ke,_e,Mc(ke,Oe),Fe);$c(ke,Oe)}return typeof Oe=="string"&&Oe!==""||typeof Oe=="number"||typeof Oe=="bigint"?(Oe=""+Oe,_e!==null&&_e.tag===6?(o(ke,_e.sibling),Fe=g(_e,Oe),Fe.return=ke,ke=Fe):(o(ke,_e),Fe=Yd(Oe,ke.mode,Fe),Fe.return=ke,ke=Fe),O(ke)):o(ke,_e)}return function(ke,_e,Oe,Fe){try{dl=0;var bt=Sn(ke,_e,Oe,Fe);return Za=null,bt}catch(pt){if(pt===Xa||pt===Uc)throw pt;var ln=Fr(29,pt,null,ke.mode);return ln.lanes=Fe,ln.return=ke,ln}}}var ya=ng(!0),rg=ng(!1),Ni=!1;function lh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ch(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Ei(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Ai(t,i,o){var d=t.updateQueue;if(d===null)return null;if(d=d.shared,(pn&2)!==0){var g=d.pending;return g===null?i.next=i:(i.next=g.next,g.next=i),d.pending=i,i=Rc(t),$m(t,null,o),i}return Tc(t,d,i,o),Rc(t)}function fl(t,i,o){if(i=i.updateQueue,i!==null&&(i=i.shared,(o&4194048)!==0)){var d=i.lanes;d&=t.pendingLanes,o|=d,i.lanes=o,Vt(t,o)}}function uh(t,i){var o=t.updateQueue,d=t.alternate;if(d!==null&&(d=d.updateQueue,o===d)){var g=null,x=null;if(o=o.firstBaseUpdate,o!==null){do{var O={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};x===null?g=x=O:x=x.next=O,o=o.next}while(o!==null);x===null?g=x=i:x=x.next=i}else g=x=i;o={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:x,shared:d.shared,callbacks:d.callbacks},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=i:t.next=i,o.lastBaseUpdate=i}var dh=!1;function pl(){if(dh){var t=Ja;if(t!==null)throw t}}function ml(t,i,o,d){dh=!1;var g=t.updateQueue;Ni=!1;var x=g.firstBaseUpdate,O=g.lastBaseUpdate,G=g.shared.pending;if(G!==null){g.shared.pending=null;var pe=G,De=pe.next;pe.next=null,O===null?x=De:O.next=De,O=pe;var qe=t.alternate;qe!==null&&(qe=qe.updateQueue,G=qe.lastBaseUpdate,G!==O&&(G===null?qe.firstBaseUpdate=De:G.next=De,qe.lastBaseUpdate=pe))}if(x!==null){var He=g.baseState;O=0,qe=De=pe=null,G=x;do{var Me=G.lane&-536870913,$e=Me!==G.lane;if($e?(Xt&Me)===Me:(d&Me)===Me){Me!==0&&Me===Qa&&(dh=!0),qe!==null&&(qe=qe.next={lane:0,tag:G.tag,payload:G.payload,callback:null,next:null});e:{var ut=t,Ct=G;Me=i;var Sn=o;switch(Ct.tag){case 1:if(ut=Ct.payload,typeof ut=="function"){He=ut.call(Sn,He,Me);break e}He=ut;break e;case 3:ut.flags=ut.flags&-65537|128;case 0:if(ut=Ct.payload,Me=typeof ut=="function"?ut.call(Sn,He,Me):ut,Me==null)break e;He=y({},He,Me);break e;case 2:Ni=!0}}Me=G.callback,Me!==null&&(t.flags|=64,$e&&(t.flags|=8192),$e=g.callbacks,$e===null?g.callbacks=[Me]:$e.push(Me))}else $e={lane:Me,tag:G.tag,payload:G.payload,callback:G.callback,next:null},qe===null?(De=qe=$e,pe=He):qe=qe.next=$e,O|=Me;if(G=G.next,G===null){if(G=g.shared.pending,G===null)break;$e=G,G=$e.next,$e.next=null,g.lastBaseUpdate=$e,g.shared.pending=null}}while(!0);qe===null&&(pe=He),g.baseState=pe,g.firstBaseUpdate=De,g.lastBaseUpdate=qe,x===null&&(g.shared.lanes=0),zi|=O,t.lanes=O,t.memoizedState=He}}function sg(t,i){if(typeof t!="function")throw Error(a(191,t));t.call(i)}function ig(t,i){var o=t.callbacks;if(o!==null)for(t.callbacks=null,t=0;t<o.length;t++)sg(o[t],i)}var eo=A(null),Pc=A(0);function ag(t,i){t=ri,J(Pc,t),J(eo,i),ri=t|i.baseLanes}function hh(){J(Pc,ri),J(eo,eo.current)}function fh(){ri=Pc.current,L(eo),L(Pc)}var Hr=A(null),as=null;function Ti(t){var i=t.alternate;J(Qn,Qn.current&1),J(Hr,t),as===null&&(i===null||eo.current!==null||i.memoizedState!==null)&&(as=t)}function ph(t){J(Qn,Qn.current),J(Hr,t),as===null&&(as=t)}function og(t){t.tag===22?(J(Qn,Qn.current),J(Hr,t),as===null&&(as=t)):Ri()}function Ri(){J(Qn,Qn.current),J(Hr,Hr.current)}function Vr(t){L(Hr),as===t&&(as=null),L(Qn)}var Qn=A(0);function qc(t){for(var i=t;i!==null;){if(i.tag===13){var o=i.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||wf(o)||_f(o)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Ys=0,Ut=null,wn=null,nr=null,Fc=!1,to=!1,va=!1,Hc=0,gl=0,no=null,Yw=0;function Gn(){throw Error(a(321))}function mh(t,i){if(i===null)return!1;for(var o=0;o<i.length&&o<t.length;o++)if(!qr(t[o],i[o]))return!1;return!0}function gh(t,i,o,d,g,x){return Ys=x,Ut=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,z.H=t===null||t.memoizedState===null?Hg:Rh,va=!1,x=o(d,g),va=!1,to&&(x=cg(i,o,d,g)),lg(t),x}function lg(t){z.H=xl;var i=wn!==null&&wn.next!==null;if(Ys=0,nr=wn=Ut=null,Fc=!1,gl=0,no=null,i)throw Error(a(300));t===null||rr||(t=t.dependencies,t!==null&&zc(t)&&(rr=!0))}function cg(t,i,o,d){Ut=t;var g=0;do{if(to&&(no=null),gl=0,to=!1,25<=g)throw Error(a(301));if(g+=1,nr=wn=null,t.updateQueue!=null){var x=t.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}z.H=Vg,x=i(o,d)}while(to);return x}function Qw(){var t=z.H,i=t.useState()[0];return i=typeof i.then=="function"?yl(i):i,t=t.useState()[0],(wn!==null?wn.memoizedState:null)!==t&&(Ut.flags|=1024),i}function yh(){var t=Hc!==0;return Hc=0,t}function vh(t,i,o){i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~o}function xh(t){if(Fc){for(t=t.memoizedState;t!==null;){var i=t.queue;i!==null&&(i.pending=null),t=t.next}Fc=!1}Ys=0,nr=wn=Ut=null,to=!1,gl=Hc=0,no=null}function Tr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nr===null?Ut.memoizedState=nr=t:nr=nr.next=t,nr}function Jn(){if(wn===null){var t=Ut.alternate;t=t!==null?t.memoizedState:null}else t=wn.next;var i=nr===null?Ut.memoizedState:nr.next;if(i!==null)nr=i,wn=t;else{if(t===null)throw Ut.alternate===null?Error(a(467)):Error(a(310));wn=t,t={memoizedState:wn.memoizedState,baseState:wn.baseState,baseQueue:wn.baseQueue,queue:wn.queue,next:null},nr===null?Ut.memoizedState=nr=t:nr=nr.next=t}return nr}function Vc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function yl(t){var i=gl;return gl+=1,no===null&&(no=[]),t=Zm(no,t,i),i=Ut,(nr===null?i.memoizedState:nr.next)===null&&(i=i.alternate,z.H=i===null||i.memoizedState===null?Hg:Rh),t}function Gc(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return yl(t);if(t.$$typeof===T)return wr(t)}throw Error(a(438,String(t)))}function bh(t){var i=null,o=Ut.updateQueue;if(o!==null&&(i=o.memoCache),i==null){var d=Ut.alternate;d!==null&&(d=d.updateQueue,d!==null&&(d=d.memoCache,d!=null&&(i={data:d.data.map(function(g){return g.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),o===null&&(o=Vc(),Ut.updateQueue=o),o.memoCache=i,o=i.data[i.index],o===void 0)for(o=i.data[i.index]=Array(t),d=0;d<t;d++)o[d]=P;return i.index++,o}function Qs(t,i){return typeof i=="function"?i(t):i}function Wc(t){var i=Jn();return wh(i,wn,t)}function wh(t,i,o){var d=t.queue;if(d===null)throw Error(a(311));d.lastRenderedReducer=o;var g=t.baseQueue,x=d.pending;if(x!==null){if(g!==null){var O=g.next;g.next=x.next,x.next=O}i.baseQueue=g=x,d.pending=null}if(x=t.baseState,g===null)t.memoizedState=x;else{i=g.next;var G=O=null,pe=null,De=i,qe=!1;do{var He=De.lane&-536870913;if(He!==De.lane?(Xt&He)===He:(Ys&He)===He){var Me=De.revertLane;if(Me===0)pe!==null&&(pe=pe.next={lane:0,revertLane:0,gesture:null,action:De.action,hasEagerState:De.hasEagerState,eagerState:De.eagerState,next:null}),He===Qa&&(qe=!0);else if((Ys&Me)===Me){De=De.next,Me===Qa&&(qe=!0);continue}else He={lane:0,revertLane:De.revertLane,gesture:null,action:De.action,hasEagerState:De.hasEagerState,eagerState:De.eagerState,next:null},pe===null?(G=pe=He,O=x):pe=pe.next=He,Ut.lanes|=Me,zi|=Me;He=De.action,va&&o(x,He),x=De.hasEagerState?De.eagerState:o(x,He)}else Me={lane:He,revertLane:De.revertLane,gesture:De.gesture,action:De.action,hasEagerState:De.hasEagerState,eagerState:De.eagerState,next:null},pe===null?(G=pe=Me,O=x):pe=pe.next=Me,Ut.lanes|=He,zi|=He;De=De.next}while(De!==null&&De!==i);if(pe===null?O=x:pe.next=G,!qr(x,t.memoizedState)&&(rr=!0,qe&&(o=Ja,o!==null)))throw o;t.memoizedState=x,t.baseState=O,t.baseQueue=pe,d.lastRenderedState=x}return g===null&&(d.lanes=0),[t.memoizedState,d.dispatch]}function _h(t){var i=Jn(),o=i.queue;if(o===null)throw Error(a(311));o.lastRenderedReducer=t;var d=o.dispatch,g=o.pending,x=i.memoizedState;if(g!==null){o.pending=null;var O=g=g.next;do x=t(x,O.action),O=O.next;while(O!==g);qr(x,i.memoizedState)||(rr=!0),i.memoizedState=x,i.baseQueue===null&&(i.baseState=x),o.lastRenderedState=x}return[x,d]}function ug(t,i,o){var d=Ut,g=Jn(),x=en;if(x){if(o===void 0)throw Error(a(407));o=o()}else o=i();var O=!qr((wn||g).memoizedState,o);if(O&&(g.memoizedState=o,rr=!0),g=g.queue,Ch(fg.bind(null,d,g,t),[t]),g.getSnapshot!==i||O||nr!==null&&nr.memoizedState.tag&1){if(d.flags|=2048,ro(9,{destroy:void 0},hg.bind(null,d,g,o,i),null),Nn===null)throw Error(a(349));x||(Ys&127)!==0||dg(d,i,o)}return o}function dg(t,i,o){t.flags|=16384,t={getSnapshot:i,value:o},i=Ut.updateQueue,i===null?(i=Vc(),Ut.updateQueue=i,i.stores=[t]):(o=i.stores,o===null?i.stores=[t]:o.push(t))}function hg(t,i,o,d){i.value=o,i.getSnapshot=d,pg(i)&&mg(t)}function fg(t,i,o){return o(function(){pg(i)&&mg(t)})}function pg(t){var i=t.getSnapshot;t=t.value;try{var o=i();return!qr(t,o)}catch{return!0}}function mg(t){var i=ca(t,2);i!==null&&Ur(i,t,2)}function Sh(t){var i=Tr();if(typeof t=="function"){var o=t;if(t=o(),va){sn(!0);try{o()}finally{sn(!1)}}}return i.memoizedState=i.baseState=t,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:t},i}function gg(t,i,o,d){return t.baseState=o,wh(t,wn,typeof d=="function"?d:Qs)}function Jw(t,i,o,d,g){if(Qc(t))throw Error(a(485));if(t=i.action,t!==null){var x={payload:g,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(O){x.listeners.push(O)}};z.T!==null?o(!0):x.isTransition=!1,d(x),o=i.pending,o===null?(x.next=i.pending=x,yg(i,x)):(x.next=o.next,i.pending=o.next=x)}}function yg(t,i){var o=i.action,d=i.payload,g=t.state;if(i.isTransition){var x=z.T,O={};z.T=O;try{var G=o(g,d),pe=z.S;pe!==null&&pe(O,G),vg(t,i,G)}catch(De){jh(t,i,De)}finally{x!==null&&O.types!==null&&(x.types=O.types),z.T=x}}else try{x=o(g,d),vg(t,i,x)}catch(De){jh(t,i,De)}}function vg(t,i,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(d){xg(t,i,d)},function(d){return jh(t,i,d)}):xg(t,i,o)}function xg(t,i,o){i.status="fulfilled",i.value=o,bg(i),t.state=o,i=t.pending,i!==null&&(o=i.next,o===i?t.pending=null:(o=o.next,i.next=o,yg(t,o)))}function jh(t,i,o){var d=t.pending;if(t.pending=null,d!==null){d=d.next;do i.status="rejected",i.reason=o,bg(i),i=i.next;while(i!==d)}t.action=null}function bg(t){t=t.listeners;for(var i=0;i<t.length;i++)(0,t[i])()}function wg(t,i){return i}function _g(t,i){if(en){var o=Nn.formState;if(o!==null){e:{var d=Ut;if(en){if(Mn){t:{for(var g=Mn,x=is;g.nodeType!==8;){if(!x){g=null;break t}if(g=os(g.nextSibling),g===null){g=null;break t}}x=g.data,g=x==="F!"||x==="F"?g:null}if(g){Mn=os(g.nextSibling),d=g.data==="F!";break e}}Ci(d)}d=!1}d&&(i=o[0])}}return o=Tr(),o.memoizedState=o.baseState=i,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wg,lastRenderedState:i},o.queue=d,o=Pg.bind(null,Ut,d),d.dispatch=o,d=Sh(!1),x=Th.bind(null,Ut,!1,d.queue),d=Tr(),g={state:i,dispatch:null,action:t,pending:null},d.queue=g,o=Jw.bind(null,Ut,g,x,o),g.dispatch=o,d.memoizedState=t,[i,o,!1]}function Sg(t){var i=Jn();return jg(i,wn,t)}function jg(t,i,o){if(i=wh(t,i,wg)[0],t=Wc(Qs)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var d=yl(i)}catch(O){throw O===Xa?Uc:O}else d=i;i=Jn();var g=i.queue,x=g.dispatch;return o!==i.memoizedState&&(Ut.flags|=2048,ro(9,{destroy:void 0},Xw.bind(null,g,o),null)),[d,x,t]}function Xw(t,i){t.action=i}function Cg(t){var i=Jn(),o=wn;if(o!==null)return jg(i,o,t);Jn(),i=i.memoizedState,o=Jn();var d=o.queue.dispatch;return o.memoizedState=t,[i,d,!1]}function ro(t,i,o,d){return t={tag:t,create:o,deps:d,inst:i,next:null},i=Ut.updateQueue,i===null&&(i=Vc(),Ut.updateQueue=i),o=i.lastEffect,o===null?i.lastEffect=t.next=t:(d=o.next,o.next=t,t.next=d,i.lastEffect=t),t}function kg(){return Jn().memoizedState}function Kc(t,i,o,d){var g=Tr();Ut.flags|=t,g.memoizedState=ro(1|i,{destroy:void 0},o,d===void 0?null:d)}function Yc(t,i,o,d){var g=Jn();d=d===void 0?null:d;var x=g.memoizedState.inst;wn!==null&&d!==null&&mh(d,wn.memoizedState.deps)?g.memoizedState=ro(i,x,o,d):(Ut.flags|=t,g.memoizedState=ro(1|i,x,o,d))}function Ng(t,i){Kc(8390656,8,t,i)}function Ch(t,i){Yc(2048,8,t,i)}function Zw(t){Ut.flags|=4;var i=Ut.updateQueue;if(i===null)i=Vc(),Ut.updateQueue=i,i.events=[t];else{var o=i.events;o===null?i.events=[t]:o.push(t)}}function Eg(t){var i=Jn().memoizedState;return Zw({ref:i,nextImpl:t}),function(){if((pn&2)!==0)throw Error(a(440));return i.impl.apply(void 0,arguments)}}function Ag(t,i){return Yc(4,2,t,i)}function Tg(t,i){return Yc(4,4,t,i)}function Rg(t,i){if(typeof i=="function"){t=t();var o=i(t);return function(){typeof o=="function"?o():i(null)}}if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function Og(t,i,o){o=o!=null?o.concat([t]):null,Yc(4,4,Rg.bind(null,i,t),o)}function kh(){}function Dg(t,i){var o=Jn();i=i===void 0?null:i;var d=o.memoizedState;return i!==null&&mh(i,d[1])?d[0]:(o.memoizedState=[t,i],t)}function zg(t,i){var o=Jn();i=i===void 0?null:i;var d=o.memoizedState;if(i!==null&&mh(i,d[1]))return d[0];if(d=t(),va){sn(!0);try{t()}finally{sn(!1)}}return o.memoizedState=[d,i],d}function Nh(t,i,o){return o===void 0||(Ys&1073741824)!==0&&(Xt&261930)===0?t.memoizedState=i:(t.memoizedState=o,t=My(),Ut.lanes|=t,zi|=t,o)}function Mg(t,i,o,d){return qr(o,i)?o:eo.current!==null?(t=Nh(t,o,d),qr(t,i)||(rr=!0),t):(Ys&42)===0||(Ys&1073741824)!==0&&(Xt&261930)===0?(rr=!0,t.memoizedState=o):(t=My(),Ut.lanes|=t,zi|=t,i)}function Lg(t,i,o,d,g){var x=B.p;B.p=x!==0&&8>x?x:8;var O=z.T,G={};z.T=G,Th(t,!1,i,o);try{var pe=g(),De=z.S;if(De!==null&&De(G,pe),pe!==null&&typeof pe=="object"&&typeof pe.then=="function"){var qe=Kw(pe,d);vl(t,i,qe,Kr(t))}else vl(t,i,d,Kr(t))}catch(He){vl(t,i,{then:function(){},status:"rejected",reason:He},Kr())}finally{B.p=x,O!==null&&G.types!==null&&(O.types=G.types),z.T=O}}function e_(){}function Eh(t,i,o,d){if(t.tag!==5)throw Error(a(476));var g=Ug(t).queue;Lg(t,g,i,K,o===null?e_:function(){return Ig(t),o(d)})}function Ug(t){var i=t.memoizedState;if(i!==null)return i;i={memoizedState:K,baseState:K,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:K},next:null};var o={};return i.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qs,lastRenderedState:o},next:null},t.memoizedState=i,t=t.alternate,t!==null&&(t.memoizedState=i),i}function Ig(t){var i=Ug(t);i.next===null&&(i=t.alternate.memoizedState),vl(t,i.next.queue,{},Kr())}function Ah(){return wr(Ml)}function Bg(){return Jn().memoizedState}function $g(){return Jn().memoizedState}function t_(t){for(var i=t.return;i!==null;){switch(i.tag){case 24:case 3:var o=Kr();t=Ei(o);var d=Ai(i,t,o);d!==null&&(Ur(d,i,o),fl(d,i,o)),i={cache:sh()},t.payload=i;return}i=i.return}}function n_(t,i,o){var d=Kr();o={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},Qc(t)?qg(i,o):(o=Wd(t,i,o,d),o!==null&&(Ur(o,t,d),Fg(o,i,d)))}function Pg(t,i,o){var d=Kr();vl(t,i,o,d)}function vl(t,i,o,d){var g={lane:d,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(Qc(t))qg(i,g);else{var x=t.alternate;if(t.lanes===0&&(x===null||x.lanes===0)&&(x=i.lastRenderedReducer,x!==null))try{var O=i.lastRenderedState,G=x(O,o);if(g.hasEagerState=!0,g.eagerState=G,qr(G,O))return Tc(t,i,g,0),Nn===null&&Ac(),!1}catch{}if(o=Wd(t,i,g,d),o!==null)return Ur(o,t,d),Fg(o,i,d),!0}return!1}function Th(t,i,o,d){if(d={lane:2,revertLane:cf(),gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Qc(t)){if(i)throw Error(a(479))}else i=Wd(t,o,d,2),i!==null&&Ur(i,t,2)}function Qc(t){var i=t.alternate;return t===Ut||i!==null&&i===Ut}function qg(t,i){to=Fc=!0;var o=t.pending;o===null?i.next=i:(i.next=o.next,o.next=i),t.pending=i}function Fg(t,i,o){if((o&4194048)!==0){var d=i.lanes;d&=t.pendingLanes,o|=d,i.lanes=o,Vt(t,o)}}var xl={readContext:wr,use:Gc,useCallback:Gn,useContext:Gn,useEffect:Gn,useImperativeHandle:Gn,useLayoutEffect:Gn,useInsertionEffect:Gn,useMemo:Gn,useReducer:Gn,useRef:Gn,useState:Gn,useDebugValue:Gn,useDeferredValue:Gn,useTransition:Gn,useSyncExternalStore:Gn,useId:Gn,useHostTransitionStatus:Gn,useFormState:Gn,useActionState:Gn,useOptimistic:Gn,useMemoCache:Gn,useCacheRefresh:Gn};xl.useEffectEvent=Gn;var Hg={readContext:wr,use:Gc,useCallback:function(t,i){return Tr().memoizedState=[t,i===void 0?null:i],t},useContext:wr,useEffect:Ng,useImperativeHandle:function(t,i,o){o=o!=null?o.concat([t]):null,Kc(4194308,4,Rg.bind(null,i,t),o)},useLayoutEffect:function(t,i){return Kc(4194308,4,t,i)},useInsertionEffect:function(t,i){Kc(4,2,t,i)},useMemo:function(t,i){var o=Tr();i=i===void 0?null:i;var d=t();if(va){sn(!0);try{t()}finally{sn(!1)}}return o.memoizedState=[d,i],d},useReducer:function(t,i,o){var d=Tr();if(o!==void 0){var g=o(i);if(va){sn(!0);try{o(i)}finally{sn(!1)}}}else g=i;return d.memoizedState=d.baseState=g,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:g},d.queue=t,t=t.dispatch=n_.bind(null,Ut,t),[d.memoizedState,t]},useRef:function(t){var i=Tr();return t={current:t},i.memoizedState=t},useState:function(t){t=Sh(t);var i=t.queue,o=Pg.bind(null,Ut,i);return i.dispatch=o,[t.memoizedState,o]},useDebugValue:kh,useDeferredValue:function(t,i){var o=Tr();return Nh(o,t,i)},useTransition:function(){var t=Sh(!1);return t=Lg.bind(null,Ut,t.queue,!0,!1),Tr().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,i,o){var d=Ut,g=Tr();if(en){if(o===void 0)throw Error(a(407));o=o()}else{if(o=i(),Nn===null)throw Error(a(349));(Xt&127)!==0||dg(d,i,o)}g.memoizedState=o;var x={value:o,getSnapshot:i};return g.queue=x,Ng(fg.bind(null,d,x,t),[t]),d.flags|=2048,ro(9,{destroy:void 0},hg.bind(null,d,x,o,i),null),o},useId:function(){var t=Tr(),i=Nn.identifierPrefix;if(en){var o=Ls,d=Ms;o=(d&~(1<<32-wt(d)-1)).toString(32)+o,i="_"+i+"R_"+o,o=Hc++,0<o&&(i+="H"+o.toString(32)),i+="_"}else o=Yw++,i="_"+i+"r_"+o.toString(32)+"_";return t.memoizedState=i},useHostTransitionStatus:Ah,useFormState:_g,useActionState:_g,useOptimistic:function(t){var i=Tr();i.memoizedState=i.baseState=t;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=o,i=Th.bind(null,Ut,!0,o),o.dispatch=i,[t,i]},useMemoCache:bh,useCacheRefresh:function(){return Tr().memoizedState=t_.bind(null,Ut)},useEffectEvent:function(t){var i=Tr(),o={impl:t};return i.memoizedState=o,function(){if((pn&2)!==0)throw Error(a(440));return o.impl.apply(void 0,arguments)}}},Rh={readContext:wr,use:Gc,useCallback:Dg,useContext:wr,useEffect:Ch,useImperativeHandle:Og,useInsertionEffect:Ag,useLayoutEffect:Tg,useMemo:zg,useReducer:Wc,useRef:kg,useState:function(){return Wc(Qs)},useDebugValue:kh,useDeferredValue:function(t,i){var o=Jn();return Mg(o,wn.memoizedState,t,i)},useTransition:function(){var t=Wc(Qs)[0],i=Jn().memoizedState;return[typeof t=="boolean"?t:yl(t),i]},useSyncExternalStore:ug,useId:Bg,useHostTransitionStatus:Ah,useFormState:Sg,useActionState:Sg,useOptimistic:function(t,i){var o=Jn();return gg(o,wn,t,i)},useMemoCache:bh,useCacheRefresh:$g};Rh.useEffectEvent=Eg;var Vg={readContext:wr,use:Gc,useCallback:Dg,useContext:wr,useEffect:Ch,useImperativeHandle:Og,useInsertionEffect:Ag,useLayoutEffect:Tg,useMemo:zg,useReducer:_h,useRef:kg,useState:function(){return _h(Qs)},useDebugValue:kh,useDeferredValue:function(t,i){var o=Jn();return wn===null?Nh(o,t,i):Mg(o,wn.memoizedState,t,i)},useTransition:function(){var t=_h(Qs)[0],i=Jn().memoizedState;return[typeof t=="boolean"?t:yl(t),i]},useSyncExternalStore:ug,useId:Bg,useHostTransitionStatus:Ah,useFormState:Cg,useActionState:Cg,useOptimistic:function(t,i){var o=Jn();return wn!==null?gg(o,wn,t,i):(o.baseState=t,[t,o.queue.dispatch])},useMemoCache:bh,useCacheRefresh:$g};Vg.useEffectEvent=Eg;function Oh(t,i,o,d){i=t.memoizedState,o=o(d,i),o=o==null?i:y({},i,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var Dh={enqueueSetState:function(t,i,o){t=t._reactInternals;var d=Kr(),g=Ei(d);g.payload=i,o!=null&&(g.callback=o),i=Ai(t,g,d),i!==null&&(Ur(i,t,d),fl(i,t,d))},enqueueReplaceState:function(t,i,o){t=t._reactInternals;var d=Kr(),g=Ei(d);g.tag=1,g.payload=i,o!=null&&(g.callback=o),i=Ai(t,g,d),i!==null&&(Ur(i,t,d),fl(i,t,d))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var o=Kr(),d=Ei(o);d.tag=2,i!=null&&(d.callback=i),i=Ai(t,d,o),i!==null&&(Ur(i,t,o),fl(i,t,o))}};function Gg(t,i,o,d,g,x,O){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(d,x,O):i.prototype&&i.prototype.isPureReactComponent?!il(o,d)||!il(g,x):!0}function Wg(t,i,o,d){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(o,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(o,d),i.state!==t&&Dh.enqueueReplaceState(i,i.state,null)}function xa(t,i){var o=i;if("ref"in i){o={};for(var d in i)d!=="ref"&&(o[d]=i[d])}if(t=t.defaultProps){o===i&&(o=y({},o));for(var g in t)o[g]===void 0&&(o[g]=t[g])}return o}function Kg(t){Ec(t)}function Yg(t){console.error(t)}function Qg(t){Ec(t)}function Jc(t,i){try{var o=t.onUncaughtError;o(i.value,{componentStack:i.stack})}catch(d){setTimeout(function(){throw d})}}function Jg(t,i,o){try{var d=t.onCaughtError;d(o.value,{componentStack:o.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function zh(t,i,o){return o=Ei(o),o.tag=3,o.payload={element:null},o.callback=function(){Jc(t,i)},o}function Xg(t){return t=Ei(t),t.tag=3,t}function Zg(t,i,o,d){var g=o.type.getDerivedStateFromError;if(typeof g=="function"){var x=d.value;t.payload=function(){return g(x)},t.callback=function(){Jg(i,o,d)}}var O=o.stateNode;O!==null&&typeof O.componentDidCatch=="function"&&(t.callback=function(){Jg(i,o,d),typeof g!="function"&&(Mi===null?Mi=new Set([this]):Mi.add(this));var G=d.stack;this.componentDidCatch(d.value,{componentStack:G!==null?G:""})})}function r_(t,i,o,d,g){if(o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){if(i=o.alternate,i!==null&&Ya(i,o,g,!0),o=Hr.current,o!==null){switch(o.tag){case 31:case 13:return as===null?cu():o.alternate===null&&Wn===0&&(Wn=3),o.flags&=-257,o.flags|=65536,o.lanes=g,d===Ic?o.flags|=16384:(i=o.updateQueue,i===null?o.updateQueue=new Set([d]):i.add(d),af(t,d,g)),!1;case 22:return o.flags|=65536,d===Ic?o.flags|=16384:(i=o.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([d])},o.updateQueue=i):(o=i.retryQueue,o===null?i.retryQueue=new Set([d]):o.add(d)),af(t,d,g)),!1}throw Error(a(435,o.tag))}return af(t,d,g),cu(),!1}if(en)return i=Hr.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=g,d!==Zd&&(t=Error(a(422),{cause:d}),ll(ns(t,o)))):(d!==Zd&&(i=Error(a(423),{cause:d}),ll(ns(i,o))),t=t.current.alternate,t.flags|=65536,g&=-g,t.lanes|=g,d=ns(d,o),g=zh(t.stateNode,d,g),uh(t,g),Wn!==4&&(Wn=2)),!1;var x=Error(a(520),{cause:d});if(x=ns(x,o),Nl===null?Nl=[x]:Nl.push(x),Wn!==4&&(Wn=2),i===null)return!0;d=ns(d,o),o=i;do{switch(o.tag){case 3:return o.flags|=65536,t=g&-g,o.lanes|=t,t=zh(o.stateNode,d,t),uh(o,t),!1;case 1:if(i=o.type,x=o.stateNode,(o.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Mi===null||!Mi.has(x))))return o.flags|=65536,g&=-g,o.lanes|=g,g=Xg(g),Zg(g,t,o,d),uh(o,g),!1}o=o.return}while(o!==null);return!1}var Mh=Error(a(461)),rr=!1;function _r(t,i,o,d){i.child=t===null?rg(i,null,o,d):ya(i,t.child,o,d)}function ey(t,i,o,d,g){o=o.render;var x=i.ref;if("ref"in d){var O={};for(var G in d)G!=="ref"&&(O[G]=d[G])}else O=d;return fa(i),d=gh(t,i,o,O,x,g),G=yh(),t!==null&&!rr?(vh(t,i,g),Js(t,i,g)):(en&&G&&Jd(i),i.flags|=1,_r(t,i,d,g),i.child)}function ty(t,i,o,d,g){if(t===null){var x=o.type;return typeof x=="function"&&!Kd(x)&&x.defaultProps===void 0&&o.compare===null?(i.tag=15,i.type=x,ny(t,i,x,d,g)):(t=Oc(o.type,null,d,i,i.mode,g),t.ref=i.ref,t.return=i,i.child=t)}if(x=t.child,!Fh(t,g)){var O=x.memoizedProps;if(o=o.compare,o=o!==null?o:il,o(O,d)&&t.ref===i.ref)return Js(t,i,g)}return i.flags|=1,t=Vs(x,d),t.ref=i.ref,t.return=i,i.child=t}function ny(t,i,o,d,g){if(t!==null){var x=t.memoizedProps;if(il(x,d)&&t.ref===i.ref)if(rr=!1,i.pendingProps=d=x,Fh(t,g))(t.flags&131072)!==0&&(rr=!0);else return i.lanes=t.lanes,Js(t,i,g)}return Lh(t,i,o,d,g)}function ry(t,i,o,d){var g=d.children,x=t!==null?t.memoizedState:null;if(t===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),d.mode==="hidden"){if((i.flags&128)!==0){if(x=x!==null?x.baseLanes|o:o,t!==null){for(d=i.child=t.child,g=0;d!==null;)g=g|d.lanes|d.childLanes,d=d.sibling;d=g&~x}else d=0,i.child=null;return sy(t,i,x,o,d)}if((o&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},t!==null&&Lc(i,x!==null?x.cachePool:null),x!==null?ag(i,x):hh(),og(i);else return d=i.lanes=536870912,sy(t,i,x!==null?x.baseLanes|o:o,o,d)}else x!==null?(Lc(i,x.cachePool),ag(i,x),Ri(),i.memoizedState=null):(t!==null&&Lc(i,null),hh(),Ri());return _r(t,i,g,o),i.child}function bl(t,i){return t!==null&&t.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function sy(t,i,o,d,g){var x=ah();return x=x===null?null:{parent:tr._currentValue,pool:x},i.memoizedState={baseLanes:o,cachePool:x},t!==null&&Lc(i,null),hh(),og(i),t!==null&&Ya(t,i,d,!0),i.childLanes=g,null}function Xc(t,i){return i=eu({mode:i.mode,children:i.children},t.mode),i.ref=t.ref,t.child=i,i.return=t,i}function iy(t,i,o){return ya(i,t.child,null,o),t=Xc(i,i.pendingProps),t.flags|=2,Vr(i),i.memoizedState=null,t}function s_(t,i,o){var d=i.pendingProps,g=(i.flags&128)!==0;if(i.flags&=-129,t===null){if(en){if(d.mode==="hidden")return t=Xc(i,d),i.lanes=536870912,bl(null,t);if(ph(i),(t=Mn)?(t=yv(t,is),t=t!==null&&t.data==="&"?t:null,t!==null&&(i.memoizedState={dehydrated:t,treeContext:Si!==null?{id:Ms,overflow:Ls}:null,retryLane:536870912,hydrationErrors:null},o=qm(t),o.return=i,i.child=o,br=i,Mn=null)):t=null,t===null)throw Ci(i);return i.lanes=536870912,null}return Xc(i,d)}var x=t.memoizedState;if(x!==null){var O=x.dehydrated;if(ph(i),g)if(i.flags&256)i.flags&=-257,i=iy(t,i,o);else if(i.memoizedState!==null)i.child=t.child,i.flags|=128,i=null;else throw Error(a(558));else if(rr||Ya(t,i,o,!1),g=(o&t.childLanes)!==0,rr||g){if(d=Nn,d!==null&&(O=Cn(d,o),O!==0&&O!==x.retryLane))throw x.retryLane=O,ca(t,O),Ur(d,t,O),Mh;cu(),i=iy(t,i,o)}else t=x.treeContext,Mn=os(O.nextSibling),br=i,en=!0,ji=null,is=!1,t!==null&&Vm(i,t),i=Xc(i,d),i.flags|=4096;return i}return t=Vs(t.child,{mode:d.mode,children:d.children}),t.ref=i.ref,i.child=t,t.return=i,t}function Zc(t,i){var o=i.ref;if(o===null)t!==null&&t.ref!==null&&(i.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(a(284));(t===null||t.ref!==o)&&(i.flags|=4194816)}}function Lh(t,i,o,d,g){return fa(i),o=gh(t,i,o,d,void 0,g),d=yh(),t!==null&&!rr?(vh(t,i,g),Js(t,i,g)):(en&&d&&Jd(i),i.flags|=1,_r(t,i,o,g),i.child)}function ay(t,i,o,d,g,x){return fa(i),i.updateQueue=null,o=cg(i,d,o,g),lg(t),d=yh(),t!==null&&!rr?(vh(t,i,x),Js(t,i,x)):(en&&d&&Jd(i),i.flags|=1,_r(t,i,o,x),i.child)}function oy(t,i,o,d,g){if(fa(i),i.stateNode===null){var x=Va,O=o.contextType;typeof O=="object"&&O!==null&&(x=wr(O)),x=new o(d,x),i.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Dh,i.stateNode=x,x._reactInternals=i,x=i.stateNode,x.props=d,x.state=i.memoizedState,x.refs={},lh(i),O=o.contextType,x.context=typeof O=="object"&&O!==null?wr(O):Va,x.state=i.memoizedState,O=o.getDerivedStateFromProps,typeof O=="function"&&(Oh(i,o,O,d),x.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(O=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),O!==x.state&&Dh.enqueueReplaceState(x,x.state,null),ml(i,d,x,g),pl(),x.state=i.memoizedState),typeof x.componentDidMount=="function"&&(i.flags|=4194308),d=!0}else if(t===null){x=i.stateNode;var G=i.memoizedProps,pe=xa(o,G);x.props=pe;var De=x.context,qe=o.contextType;O=Va,typeof qe=="object"&&qe!==null&&(O=wr(qe));var He=o.getDerivedStateFromProps;qe=typeof He=="function"||typeof x.getSnapshotBeforeUpdate=="function",G=i.pendingProps!==G,qe||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(G||De!==O)&&Wg(i,x,d,O),Ni=!1;var Me=i.memoizedState;x.state=Me,ml(i,d,x,g),pl(),De=i.memoizedState,G||Me!==De||Ni?(typeof He=="function"&&(Oh(i,o,He,d),De=i.memoizedState),(pe=Ni||Gg(i,o,pe,d,Me,De,O))?(qe||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(i.flags|=4194308)):(typeof x.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=De),x.props=d,x.state=De,x.context=O,d=pe):(typeof x.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{x=i.stateNode,ch(t,i),O=i.memoizedProps,qe=xa(o,O),x.props=qe,He=i.pendingProps,Me=x.context,De=o.contextType,pe=Va,typeof De=="object"&&De!==null&&(pe=wr(De)),G=o.getDerivedStateFromProps,(De=typeof G=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(O!==He||Me!==pe)&&Wg(i,x,d,pe),Ni=!1,Me=i.memoizedState,x.state=Me,ml(i,d,x,g),pl();var $e=i.memoizedState;O!==He||Me!==$e||Ni||t!==null&&t.dependencies!==null&&zc(t.dependencies)?(typeof G=="function"&&(Oh(i,o,G,d),$e=i.memoizedState),(qe=Ni||Gg(i,o,qe,d,Me,$e,pe)||t!==null&&t.dependencies!==null&&zc(t.dependencies))?(De||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(d,$e,pe),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(d,$e,pe)),typeof x.componentDidUpdate=="function"&&(i.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof x.componentDidUpdate!="function"||O===t.memoizedProps&&Me===t.memoizedState||(i.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||O===t.memoizedProps&&Me===t.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=$e),x.props=d,x.state=$e,x.context=pe,d=qe):(typeof x.componentDidUpdate!="function"||O===t.memoizedProps&&Me===t.memoizedState||(i.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||O===t.memoizedProps&&Me===t.memoizedState||(i.flags|=1024),d=!1)}return x=d,Zc(t,i),d=(i.flags&128)!==0,x||d?(x=i.stateNode,o=d&&typeof o.getDerivedStateFromError!="function"?null:x.render(),i.flags|=1,t!==null&&d?(i.child=ya(i,t.child,null,g),i.child=ya(i,null,o,g)):_r(t,i,o,g),i.memoizedState=x.state,t=i.child):t=Js(t,i,g),t}function ly(t,i,o,d){return da(),i.flags|=256,_r(t,i,o,d),i.child}var Uh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ih(t){return{baseLanes:t,cachePool:Jm()}}function Bh(t,i,o){return t=t!==null?t.childLanes&~o:0,i&&(t|=Wr),t}function cy(t,i,o){var d=i.pendingProps,g=!1,x=(i.flags&128)!==0,O;if((O=x)||(O=t!==null&&t.memoizedState===null?!1:(Qn.current&2)!==0),O&&(g=!0,i.flags&=-129),O=(i.flags&32)!==0,i.flags&=-33,t===null){if(en){if(g?Ti(i):Ri(),(t=Mn)?(t=yv(t,is),t=t!==null&&t.data!=="&"?t:null,t!==null&&(i.memoizedState={dehydrated:t,treeContext:Si!==null?{id:Ms,overflow:Ls}:null,retryLane:536870912,hydrationErrors:null},o=qm(t),o.return=i,i.child=o,br=i,Mn=null)):t=null,t===null)throw Ci(i);return _f(t)?i.lanes=32:i.lanes=536870912,null}var G=d.children;return d=d.fallback,g?(Ri(),g=i.mode,G=eu({mode:"hidden",children:G},g),d=ua(d,g,o,null),G.return=i,d.return=i,G.sibling=d,i.child=G,d=i.child,d.memoizedState=Ih(o),d.childLanes=Bh(t,O,o),i.memoizedState=Uh,bl(null,d)):(Ti(i),$h(i,G))}var pe=t.memoizedState;if(pe!==null&&(G=pe.dehydrated,G!==null)){if(x)i.flags&256?(Ti(i),i.flags&=-257,i=Ph(t,i,o)):i.memoizedState!==null?(Ri(),i.child=t.child,i.flags|=128,i=null):(Ri(),G=d.fallback,g=i.mode,d=eu({mode:"visible",children:d.children},g),G=ua(G,g,o,null),G.flags|=2,d.return=i,G.return=i,d.sibling=G,i.child=d,ya(i,t.child,null,o),d=i.child,d.memoizedState=Ih(o),d.childLanes=Bh(t,O,o),i.memoizedState=Uh,i=bl(null,d));else if(Ti(i),_f(G)){if(O=G.nextSibling&&G.nextSibling.dataset,O)var De=O.dgst;O=De,d=Error(a(419)),d.stack="",d.digest=O,ll({value:d,source:null,stack:null}),i=Ph(t,i,o)}else if(rr||Ya(t,i,o,!1),O=(o&t.childLanes)!==0,rr||O){if(O=Nn,O!==null&&(d=Cn(O,o),d!==0&&d!==pe.retryLane))throw pe.retryLane=d,ca(t,d),Ur(O,t,d),Mh;wf(G)||cu(),i=Ph(t,i,o)}else wf(G)?(i.flags|=192,i.child=t.child,i=null):(t=pe.treeContext,Mn=os(G.nextSibling),br=i,en=!0,ji=null,is=!1,t!==null&&Vm(i,t),i=$h(i,d.children),i.flags|=4096);return i}return g?(Ri(),G=d.fallback,g=i.mode,pe=t.child,De=pe.sibling,d=Vs(pe,{mode:"hidden",children:d.children}),d.subtreeFlags=pe.subtreeFlags&65011712,De!==null?G=Vs(De,G):(G=ua(G,g,o,null),G.flags|=2),G.return=i,d.return=i,d.sibling=G,i.child=d,bl(null,d),d=i.child,G=t.child.memoizedState,G===null?G=Ih(o):(g=G.cachePool,g!==null?(pe=tr._currentValue,g=g.parent!==pe?{parent:pe,pool:pe}:g):g=Jm(),G={baseLanes:G.baseLanes|o,cachePool:g}),d.memoizedState=G,d.childLanes=Bh(t,O,o),i.memoizedState=Uh,bl(t.child,d)):(Ti(i),o=t.child,t=o.sibling,o=Vs(o,{mode:"visible",children:d.children}),o.return=i,o.sibling=null,t!==null&&(O=i.deletions,O===null?(i.deletions=[t],i.flags|=16):O.push(t)),i.child=o,i.memoizedState=null,o)}function $h(t,i){return i=eu({mode:"visible",children:i},t.mode),i.return=t,t.child=i}function eu(t,i){return t=Fr(22,t,null,i),t.lanes=0,t}function Ph(t,i,o){return ya(i,t.child,null,o),t=$h(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function uy(t,i,o){t.lanes|=i;var d=t.alternate;d!==null&&(d.lanes|=i),nh(t.return,i,o)}function qh(t,i,o,d,g,x){var O=t.memoizedState;O===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:o,tailMode:g,treeForkCount:x}:(O.isBackwards=i,O.rendering=null,O.renderingStartTime=0,O.last=d,O.tail=o,O.tailMode=g,O.treeForkCount=x)}function dy(t,i,o){var d=i.pendingProps,g=d.revealOrder,x=d.tail;d=d.children;var O=Qn.current,G=(O&2)!==0;if(G?(O=O&1|2,i.flags|=128):O&=1,J(Qn,O),_r(t,i,d,o),d=en?ol:0,!G&&t!==null&&(t.flags&128)!==0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&uy(t,o,i);else if(t.tag===19)uy(t,o,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(g){case"forwards":for(o=i.child,g=null;o!==null;)t=o.alternate,t!==null&&qc(t)===null&&(g=o),o=o.sibling;o=g,o===null?(g=i.child,i.child=null):(g=o.sibling,o.sibling=null),qh(i,!1,g,o,x,d);break;case"backwards":case"unstable_legacy-backwards":for(o=null,g=i.child,i.child=null;g!==null;){if(t=g.alternate,t!==null&&qc(t)===null){i.child=g;break}t=g.sibling,g.sibling=o,o=g,g=t}qh(i,!0,o,null,x,d);break;case"together":qh(i,!1,null,null,void 0,d);break;default:i.memoizedState=null}return i.child}function Js(t,i,o){if(t!==null&&(i.dependencies=t.dependencies),zi|=i.lanes,(o&i.childLanes)===0)if(t!==null){if(Ya(t,i,o,!1),(o&i.childLanes)===0)return null}else return null;if(t!==null&&i.child!==t.child)throw Error(a(153));if(i.child!==null){for(t=i.child,o=Vs(t,t.pendingProps),i.child=o,o.return=i;t.sibling!==null;)t=t.sibling,o=o.sibling=Vs(t,t.pendingProps),o.return=i;o.sibling=null}return i.child}function Fh(t,i){return(t.lanes&i)!==0?!0:(t=t.dependencies,!!(t!==null&&zc(t)))}function i_(t,i,o){switch(i.tag){case 3:ne(i,i.stateNode.containerInfo),ki(i,tr,t.memoizedState.cache),da();break;case 27:case 5:le(i);break;case 4:ne(i,i.stateNode.containerInfo);break;case 10:ki(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,ph(i),null;break;case 13:var d=i.memoizedState;if(d!==null)return d.dehydrated!==null?(Ti(i),i.flags|=128,null):(o&i.child.childLanes)!==0?cy(t,i,o):(Ti(i),t=Js(t,i,o),t!==null?t.sibling:null);Ti(i);break;case 19:var g=(t.flags&128)!==0;if(d=(o&i.childLanes)!==0,d||(Ya(t,i,o,!1),d=(o&i.childLanes)!==0),g){if(d)return dy(t,i,o);i.flags|=128}if(g=i.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),J(Qn,Qn.current),d)break;return null;case 22:return i.lanes=0,ry(t,i,o,i.pendingProps);case 24:ki(i,tr,t.memoizedState.cache)}return Js(t,i,o)}function hy(t,i,o){if(t!==null)if(t.memoizedProps!==i.pendingProps)rr=!0;else{if(!Fh(t,o)&&(i.flags&128)===0)return rr=!1,i_(t,i,o);rr=(t.flags&131072)!==0}else rr=!1,en&&(i.flags&1048576)!==0&&Hm(i,ol,i.index);switch(i.lanes=0,i.tag){case 16:e:{var d=i.pendingProps;if(t=ma(i.elementType),i.type=t,typeof t=="function")Kd(t)?(d=xa(t,d),i.tag=1,i=oy(null,i,t,d,o)):(i.tag=0,i=Lh(null,i,t,d,o));else{if(t!=null){var g=t.$$typeof;if(g===R){i.tag=11,i=ey(null,i,t,d,o);break e}else if(g===q){i.tag=14,i=ty(null,i,t,d,o);break e}}throw i=C(t)||t,Error(a(306,i,""))}}return i;case 0:return Lh(t,i,i.type,i.pendingProps,o);case 1:return d=i.type,g=xa(d,i.pendingProps),oy(t,i,d,g,o);case 3:e:{if(ne(i,i.stateNode.containerInfo),t===null)throw Error(a(387));d=i.pendingProps;var x=i.memoizedState;g=x.element,ch(t,i),ml(i,d,null,o);var O=i.memoizedState;if(d=O.cache,ki(i,tr,d),d!==x.cache&&rh(i,[tr],o,!0),pl(),d=O.element,x.isDehydrated)if(x={element:d,isDehydrated:!1,cache:O.cache},i.updateQueue.baseState=x,i.memoizedState=x,i.flags&256){i=ly(t,i,d,o);break e}else if(d!==g){g=ns(Error(a(424)),i),ll(g),i=ly(t,i,d,o);break e}else for(t=i.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,Mn=os(t.firstChild),br=i,en=!0,ji=null,is=!0,o=rg(i,null,d,o),i.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(da(),d===g){i=Js(t,i,o);break e}_r(t,i,d,o)}i=i.child}return i;case 26:return Zc(t,i),t===null?(o=Sv(i.type,null,i.pendingProps,null))?i.memoizedState=o:en||(o=i.type,t=i.pendingProps,d=gu(Ce.current).createElement(o),d[nt]=i,d[te]=t,Sr(d,o,t),lt(d),i.stateNode=d):i.memoizedState=Sv(i.type,t.memoizedProps,i.pendingProps,t.memoizedState),null;case 27:return le(i),t===null&&en&&(d=i.stateNode=bv(i.type,i.pendingProps,Ce.current),br=i,is=!0,g=Mn,Bi(i.type)?(Sf=g,Mn=os(d.firstChild)):Mn=g),_r(t,i,i.pendingProps.children,o),Zc(t,i),t===null&&(i.flags|=4194304),i.child;case 5:return t===null&&en&&((g=d=Mn)&&(d=M_(d,i.type,i.pendingProps,is),d!==null?(i.stateNode=d,br=i,Mn=os(d.firstChild),is=!1,g=!0):g=!1),g||Ci(i)),le(i),g=i.type,x=i.pendingProps,O=t!==null?t.memoizedProps:null,d=x.children,vf(g,x)?d=null:O!==null&&vf(g,O)&&(i.flags|=32),i.memoizedState!==null&&(g=gh(t,i,Qw,null,null,o),Ml._currentValue=g),Zc(t,i),_r(t,i,d,o),i.child;case 6:return t===null&&en&&((t=o=Mn)&&(o=L_(o,i.pendingProps,is),o!==null?(i.stateNode=o,br=i,Mn=null,t=!0):t=!1),t||Ci(i)),null;case 13:return cy(t,i,o);case 4:return ne(i,i.stateNode.containerInfo),d=i.pendingProps,t===null?i.child=ya(i,null,d,o):_r(t,i,d,o),i.child;case 11:return ey(t,i,i.type,i.pendingProps,o);case 7:return _r(t,i,i.pendingProps,o),i.child;case 8:return _r(t,i,i.pendingProps.children,o),i.child;case 12:return _r(t,i,i.pendingProps.children,o),i.child;case 10:return d=i.pendingProps,ki(i,i.type,d.value),_r(t,i,d.children,o),i.child;case 9:return g=i.type._context,d=i.pendingProps.children,fa(i),g=wr(g),d=d(g),i.flags|=1,_r(t,i,d,o),i.child;case 14:return ty(t,i,i.type,i.pendingProps,o);case 15:return ny(t,i,i.type,i.pendingProps,o);case 19:return dy(t,i,o);case 31:return s_(t,i,o);case 22:return ry(t,i,o,i.pendingProps);case 24:return fa(i),d=wr(tr),t===null?(g=ah(),g===null&&(g=Nn,x=sh(),g.pooledCache=x,x.refCount++,x!==null&&(g.pooledCacheLanes|=o),g=x),i.memoizedState={parent:d,cache:g},lh(i),ki(i,tr,g)):((t.lanes&o)!==0&&(ch(t,i),ml(i,null,null,o),pl()),g=t.memoizedState,x=i.memoizedState,g.parent!==d?(g={parent:d,cache:d},i.memoizedState=g,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=g),ki(i,tr,d)):(d=x.cache,ki(i,tr,d),d!==g.cache&&rh(i,[tr],o,!0))),_r(t,i,i.pendingProps.children,o),i.child;case 29:throw i.pendingProps}throw Error(a(156,i.tag))}function Xs(t){t.flags|=4}function Hh(t,i,o,d,g){if((i=(t.mode&32)!==0)&&(i=!1),i){if(t.flags|=16777216,(g&335544128)===g)if(t.stateNode.complete)t.flags|=8192;else if(By())t.flags|=8192;else throw ga=Ic,oh}else t.flags&=-16777217}function fy(t,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Ev(i))if(By())t.flags|=8192;else throw ga=Ic,oh}function tu(t,i){i!==null&&(t.flags|=4),t.flags&16384&&(i=t.tag!==22?Ht():536870912,t.lanes|=i,oo|=i)}function wl(t,i){if(!en)switch(t.tailMode){case"hidden":i=t.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:d.sibling=null}}function Ln(t){var i=t.alternate!==null&&t.alternate.child===t.child,o=0,d=0;if(i)for(var g=t.child;g!==null;)o|=g.lanes|g.childLanes,d|=g.subtreeFlags&65011712,d|=g.flags&65011712,g.return=t,g=g.sibling;else for(g=t.child;g!==null;)o|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=t,g=g.sibling;return t.subtreeFlags|=d,t.childLanes=o,i}function a_(t,i,o){var d=i.pendingProps;switch(Xd(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ln(i),null;case 1:return Ln(i),null;case 3:return o=i.stateNode,d=null,t!==null&&(d=t.memoizedState.cache),i.memoizedState.cache!==d&&(i.flags|=2048),Ks(tr),be(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(Ka(i)?Xs(i):t===null||t.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,eh())),Ln(i),null;case 26:var g=i.type,x=i.memoizedState;return t===null?(Xs(i),x!==null?(Ln(i),fy(i,x)):(Ln(i),Hh(i,g,null,d,o))):x?x!==t.memoizedState?(Xs(i),Ln(i),fy(i,x)):(Ln(i),i.flags&=-16777217):(t=t.memoizedProps,t!==d&&Xs(i),Ln(i),Hh(i,g,t,d,o)),null;case 27:if(ie(i),o=Ce.current,g=i.type,t!==null&&i.stateNode!=null)t.memoizedProps!==d&&Xs(i);else{if(!d){if(i.stateNode===null)throw Error(a(166));return Ln(i),null}t=ae.current,Ka(i)?Gm(i):(t=bv(g,d,o),i.stateNode=t,Xs(i))}return Ln(i),null;case 5:if(ie(i),g=i.type,t!==null&&i.stateNode!=null)t.memoizedProps!==d&&Xs(i);else{if(!d){if(i.stateNode===null)throw Error(a(166));return Ln(i),null}if(x=ae.current,Ka(i))Gm(i);else{var O=gu(Ce.current);switch(x){case 1:x=O.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:x=O.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":x=O.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":x=O.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":x=O.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof d.is=="string"?O.createElement("select",{is:d.is}):O.createElement("select"),d.multiple?x.multiple=!0:d.size&&(x.size=d.size);break;default:x=typeof d.is=="string"?O.createElement(g,{is:d.is}):O.createElement(g)}}x[nt]=i,x[te]=d;e:for(O=i.child;O!==null;){if(O.tag===5||O.tag===6)x.appendChild(O.stateNode);else if(O.tag!==4&&O.tag!==27&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===i)break e;for(;O.sibling===null;){if(O.return===null||O.return===i)break e;O=O.return}O.sibling.return=O.return,O=O.sibling}i.stateNode=x;e:switch(Sr(x,g,d),g){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}d&&Xs(i)}}return Ln(i),Hh(i,i.type,t===null?null:t.memoizedProps,i.pendingProps,o),null;case 6:if(t&&i.stateNode!=null)t.memoizedProps!==d&&Xs(i);else{if(typeof d!="string"&&i.stateNode===null)throw Error(a(166));if(t=Ce.current,Ka(i)){if(t=i.stateNode,o=i.memoizedProps,d=null,g=br,g!==null)switch(g.tag){case 27:case 5:d=g.memoizedProps}t[nt]=i,t=!!(t.nodeValue===o||d!==null&&d.suppressHydrationWarning===!0||cv(t.nodeValue,o)),t||Ci(i,!0)}else t=gu(t).createTextNode(d),t[nt]=i,i.stateNode=t}return Ln(i),null;case 31:if(o=i.memoizedState,t===null||t.memoizedState!==null){if(d=Ka(i),o!==null){if(t===null){if(!d)throw Error(a(318));if(t=i.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(557));t[nt]=i}else da(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Ln(i),t=!1}else o=eh(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=o),t=!0;if(!t)return i.flags&256?(Vr(i),i):(Vr(i),null);if((i.flags&128)!==0)throw Error(a(558))}return Ln(i),null;case 13:if(d=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(g=Ka(i),d!==null&&d.dehydrated!==null){if(t===null){if(!g)throw Error(a(318));if(g=i.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(a(317));g[nt]=i}else da(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Ln(i),g=!1}else g=eh(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=g),g=!0;if(!g)return i.flags&256?(Vr(i),i):(Vr(i),null)}return Vr(i),(i.flags&128)!==0?(i.lanes=o,i):(o=d!==null,t=t!==null&&t.memoizedState!==null,o&&(d=i.child,g=null,d.alternate!==null&&d.alternate.memoizedState!==null&&d.alternate.memoizedState.cachePool!==null&&(g=d.alternate.memoizedState.cachePool.pool),x=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(x=d.memoizedState.cachePool.pool),x!==g&&(d.flags|=2048)),o!==t&&o&&(i.child.flags|=8192),tu(i,i.updateQueue),Ln(i),null);case 4:return be(),t===null&&ff(i.stateNode.containerInfo),Ln(i),null;case 10:return Ks(i.type),Ln(i),null;case 19:if(L(Qn),d=i.memoizedState,d===null)return Ln(i),null;if(g=(i.flags&128)!==0,x=d.rendering,x===null)if(g)wl(d,!1);else{if(Wn!==0||t!==null&&(t.flags&128)!==0)for(t=i.child;t!==null;){if(x=qc(t),x!==null){for(i.flags|=128,wl(d,!1),t=x.updateQueue,i.updateQueue=t,tu(i,t),i.subtreeFlags=0,t=o,o=i.child;o!==null;)Pm(o,t),o=o.sibling;return J(Qn,Qn.current&1|2),en&&Gs(i,d.treeForkCount),i.child}t=t.sibling}d.tail!==null&&Be()>au&&(i.flags|=128,g=!0,wl(d,!1),i.lanes=4194304)}else{if(!g)if(t=qc(x),t!==null){if(i.flags|=128,g=!0,t=t.updateQueue,i.updateQueue=t,tu(i,t),wl(d,!0),d.tail===null&&d.tailMode==="hidden"&&!x.alternate&&!en)return Ln(i),null}else 2*Be()-d.renderingStartTime>au&&o!==536870912&&(i.flags|=128,g=!0,wl(d,!1),i.lanes=4194304);d.isBackwards?(x.sibling=i.child,i.child=x):(t=d.last,t!==null?t.sibling=x:i.child=x,d.last=x)}return d.tail!==null?(t=d.tail,d.rendering=t,d.tail=t.sibling,d.renderingStartTime=Be(),t.sibling=null,o=Qn.current,J(Qn,g?o&1|2:o&1),en&&Gs(i,d.treeForkCount),t):(Ln(i),null);case 22:case 23:return Vr(i),fh(),d=i.memoizedState!==null,t!==null?t.memoizedState!==null!==d&&(i.flags|=8192):d&&(i.flags|=8192),d?(o&536870912)!==0&&(i.flags&128)===0&&(Ln(i),i.subtreeFlags&6&&(i.flags|=8192)):Ln(i),o=i.updateQueue,o!==null&&tu(i,o.retryQueue),o=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),d=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(d=i.memoizedState.cachePool.pool),d!==o&&(i.flags|=2048),t!==null&&L(pa),null;case 24:return o=null,t!==null&&(o=t.memoizedState.cache),i.memoizedState.cache!==o&&(i.flags|=2048),Ks(tr),Ln(i),null;case 25:return null;case 30:return null}throw Error(a(156,i.tag))}function o_(t,i){switch(Xd(i),i.tag){case 1:return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return Ks(tr),be(),t=i.flags,(t&65536)!==0&&(t&128)===0?(i.flags=t&-65537|128,i):null;case 26:case 27:case 5:return ie(i),null;case 31:if(i.memoizedState!==null){if(Vr(i),i.alternate===null)throw Error(a(340));da()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 13:if(Vr(i),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(a(340));da()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return L(Qn),null;case 4:return be(),null;case 10:return Ks(i.type),null;case 22:case 23:return Vr(i),fh(),t!==null&&L(pa),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 24:return Ks(tr),null;case 25:return null;default:return null}}function py(t,i){switch(Xd(i),i.tag){case 3:Ks(tr),be();break;case 26:case 27:case 5:ie(i);break;case 4:be();break;case 31:i.memoizedState!==null&&Vr(i);break;case 13:Vr(i);break;case 19:L(Qn);break;case 10:Ks(i.type);break;case 22:case 23:Vr(i),fh(),t!==null&&L(pa);break;case 24:Ks(tr)}}function _l(t,i){try{var o=i.updateQueue,d=o!==null?o.lastEffect:null;if(d!==null){var g=d.next;o=g;do{if((o.tag&t)===t){d=void 0;var x=o.create,O=o.inst;d=x(),O.destroy=d}o=o.next}while(o!==g)}}catch(G){bn(i,i.return,G)}}function Oi(t,i,o){try{var d=i.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var x=g.next;d=x;do{if((d.tag&t)===t){var O=d.inst,G=O.destroy;if(G!==void 0){O.destroy=void 0,g=i;var pe=o,De=G;try{De()}catch(qe){bn(g,pe,qe)}}}d=d.next}while(d!==x)}}catch(qe){bn(i,i.return,qe)}}function my(t){var i=t.updateQueue;if(i!==null){var o=t.stateNode;try{ig(i,o)}catch(d){bn(t,t.return,d)}}}function gy(t,i,o){o.props=xa(t.type,t.memoizedProps),o.state=t.memoizedState;try{o.componentWillUnmount()}catch(d){bn(t,i,d)}}function Sl(t,i){try{var o=t.ref;if(o!==null){switch(t.tag){case 26:case 27:case 5:var d=t.stateNode;break;case 30:d=t.stateNode;break;default:d=t.stateNode}typeof o=="function"?t.refCleanup=o(d):o.current=d}}catch(g){bn(t,i,g)}}function Us(t,i){var o=t.ref,d=t.refCleanup;if(o!==null)if(typeof d=="function")try{d()}catch(g){bn(t,i,g)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(g){bn(t,i,g)}else o.current=null}function yy(t){var i=t.type,o=t.memoizedProps,d=t.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":o.autoFocus&&d.focus();break e;case"img":o.src?d.src=o.src:o.srcSet&&(d.srcset=o.srcSet)}}catch(g){bn(t,t.return,g)}}function Vh(t,i,o){try{var d=t.stateNode;A_(d,t.type,o,i),d[te]=i}catch(g){bn(t,t.return,g)}}function vy(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Bi(t.type)||t.tag===4}function Gh(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||vy(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Bi(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Wh(t,i,o){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(t,i):(i=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,i.appendChild(t),o=o._reactRootContainer,o!=null||i.onclick!==null||(i.onclick=vr));else if(d!==4&&(d===27&&Bi(t.type)&&(o=t.stateNode,i=null),t=t.child,t!==null))for(Wh(t,i,o),t=t.sibling;t!==null;)Wh(t,i,o),t=t.sibling}function nu(t,i,o){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?o.insertBefore(t,i):o.appendChild(t);else if(d!==4&&(d===27&&Bi(t.type)&&(o=t.stateNode),t=t.child,t!==null))for(nu(t,i,o),t=t.sibling;t!==null;)nu(t,i,o),t=t.sibling}function xy(t){var i=t.stateNode,o=t.memoizedProps;try{for(var d=t.type,g=i.attributes;g.length;)i.removeAttributeNode(g[0]);Sr(i,d,o),i[nt]=t,i[te]=o}catch(x){bn(t,t.return,x)}}var Zs=!1,sr=!1,Kh=!1,by=typeof WeakSet=="function"?WeakSet:Set,pr=null;function l_(t,i){if(t=t.containerInfo,gf=Su,t=Om(t),Pd(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var d=o.getSelection&&o.getSelection();if(d&&d.rangeCount!==0){o=d.anchorNode;var g=d.anchorOffset,x=d.focusNode;d=d.focusOffset;try{o.nodeType,x.nodeType}catch{o=null;break e}var O=0,G=-1,pe=-1,De=0,qe=0,He=t,Me=null;t:for(;;){for(var $e;He!==o||g!==0&&He.nodeType!==3||(G=O+g),He!==x||d!==0&&He.nodeType!==3||(pe=O+d),He.nodeType===3&&(O+=He.nodeValue.length),($e=He.firstChild)!==null;)Me=He,He=$e;for(;;){if(He===t)break t;if(Me===o&&++De===g&&(G=O),Me===x&&++qe===d&&(pe=O),($e=He.nextSibling)!==null)break;He=Me,Me=He.parentNode}He=$e}o=G===-1||pe===-1?null:{start:G,end:pe}}else o=null}o=o||{start:0,end:0}}else o=null;for(yf={focusedElem:t,selectionRange:o},Su=!1,pr=i;pr!==null;)if(i=pr,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,pr=t;else for(;pr!==null;){switch(i=pr,x=i.alternate,t=i.flags,i.tag){case 0:if((t&4)!==0&&(t=i.updateQueue,t=t!==null?t.events:null,t!==null))for(o=0;o<t.length;o++)g=t[o],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&x!==null){t=void 0,o=i,g=x.memoizedProps,x=x.memoizedState,d=o.stateNode;try{var ut=xa(o.type,g);t=d.getSnapshotBeforeUpdate(ut,x),d.__reactInternalSnapshotBeforeUpdate=t}catch(Ct){bn(o,o.return,Ct)}}break;case 3:if((t&1024)!==0){if(t=i.stateNode.containerInfo,o=t.nodeType,o===9)bf(t);else if(o===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":bf(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(a(163))}if(t=i.sibling,t!==null){t.return=i.return,pr=t;break}pr=i.return}}function wy(t,i,o){var d=o.flags;switch(o.tag){case 0:case 11:case 15:ti(t,o),d&4&&_l(5,o);break;case 1:if(ti(t,o),d&4)if(t=o.stateNode,i===null)try{t.componentDidMount()}catch(O){bn(o,o.return,O)}else{var g=xa(o.type,i.memoizedProps);i=i.memoizedState;try{t.componentDidUpdate(g,i,t.__reactInternalSnapshotBeforeUpdate)}catch(O){bn(o,o.return,O)}}d&64&&my(o),d&512&&Sl(o,o.return);break;case 3:if(ti(t,o),d&64&&(t=o.updateQueue,t!==null)){if(i=null,o.child!==null)switch(o.child.tag){case 27:case 5:i=o.child.stateNode;break;case 1:i=o.child.stateNode}try{ig(t,i)}catch(O){bn(o,o.return,O)}}break;case 27:i===null&&d&4&&xy(o);case 26:case 5:ti(t,o),i===null&&d&4&&yy(o),d&512&&Sl(o,o.return);break;case 12:ti(t,o);break;case 31:ti(t,o),d&4&&jy(t,o);break;case 13:ti(t,o),d&4&&Cy(t,o),d&64&&(t=o.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(o=y_.bind(null,o),U_(t,o))));break;case 22:if(d=o.memoizedState!==null||Zs,!d){i=i!==null&&i.memoizedState!==null||sr,g=Zs;var x=sr;Zs=d,(sr=i)&&!x?ni(t,o,(o.subtreeFlags&8772)!==0):ti(t,o),Zs=g,sr=x}break;case 30:break;default:ti(t,o)}}function _y(t){var i=t.alternate;i!==null&&(t.alternate=null,_y(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&Ne(i)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var $n=null,Dr=!1;function ei(t,i,o){for(o=o.child;o!==null;)Sy(t,i,o),o=o.sibling}function Sy(t,i,o){if(Tt&&typeof Tt.onCommitFiberUnmount=="function")try{Tt.onCommitFiberUnmount(ft,o)}catch{}switch(o.tag){case 26:sr||Us(o,i),ei(t,i,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:sr||Us(o,i);var d=$n,g=Dr;Bi(o.type)&&($n=o.stateNode,Dr=!1),ei(t,i,o),Ol(o.stateNode),$n=d,Dr=g;break;case 5:sr||Us(o,i);case 6:if(d=$n,g=Dr,$n=null,ei(t,i,o),$n=d,Dr=g,$n!==null)if(Dr)try{($n.nodeType===9?$n.body:$n.nodeName==="HTML"?$n.ownerDocument.body:$n).removeChild(o.stateNode)}catch(x){bn(o,i,x)}else try{$n.removeChild(o.stateNode)}catch(x){bn(o,i,x)}break;case 18:$n!==null&&(Dr?(t=$n,mv(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,o.stateNode),go(t)):mv($n,o.stateNode));break;case 4:d=$n,g=Dr,$n=o.stateNode.containerInfo,Dr=!0,ei(t,i,o),$n=d,Dr=g;break;case 0:case 11:case 14:case 15:Oi(2,o,i),sr||Oi(4,o,i),ei(t,i,o);break;case 1:sr||(Us(o,i),d=o.stateNode,typeof d.componentWillUnmount=="function"&&gy(o,i,d)),ei(t,i,o);break;case 21:ei(t,i,o);break;case 22:sr=(d=sr)||o.memoizedState!==null,ei(t,i,o),sr=d;break;default:ei(t,i,o)}}function jy(t,i){if(i.memoizedState===null&&(t=i.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{go(t)}catch(o){bn(i,i.return,o)}}}function Cy(t,i){if(i.memoizedState===null&&(t=i.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{go(t)}catch(o){bn(i,i.return,o)}}function c_(t){switch(t.tag){case 31:case 13:case 19:var i=t.stateNode;return i===null&&(i=t.stateNode=new by),i;case 22:return t=t.stateNode,i=t._retryCache,i===null&&(i=t._retryCache=new by),i;default:throw Error(a(435,t.tag))}}function ru(t,i){var o=c_(t);i.forEach(function(d){if(!o.has(d)){o.add(d);var g=v_.bind(null,t,d);d.then(g,g)}})}function zr(t,i){var o=i.deletions;if(o!==null)for(var d=0;d<o.length;d++){var g=o[d],x=t,O=i,G=O;e:for(;G!==null;){switch(G.tag){case 27:if(Bi(G.type)){$n=G.stateNode,Dr=!1;break e}break;case 5:$n=G.stateNode,Dr=!1;break e;case 3:case 4:$n=G.stateNode.containerInfo,Dr=!0;break e}G=G.return}if($n===null)throw Error(a(160));Sy(x,O,g),$n=null,Dr=!1,x=g.alternate,x!==null&&(x.return=null),g.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)ky(i,t),i=i.sibling}var ws=null;function ky(t,i){var o=t.alternate,d=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:zr(i,t),Mr(t),d&4&&(Oi(3,t,t.return),_l(3,t),Oi(5,t,t.return));break;case 1:zr(i,t),Mr(t),d&512&&(sr||o===null||Us(o,o.return)),d&64&&Zs&&(t=t.updateQueue,t!==null&&(d=t.callbacks,d!==null&&(o=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=o===null?d:o.concat(d))));break;case 26:var g=ws;if(zr(i,t),Mr(t),d&512&&(sr||o===null||Us(o,o.return)),d&4){var x=o!==null?o.memoizedState:null;if(d=t.memoizedState,o===null)if(d===null)if(t.stateNode===null){e:{d=t.type,o=t.memoizedProps,g=g.ownerDocument||g;t:switch(d){case"title":x=g.getElementsByTagName("title")[0],(!x||x[xe]||x[nt]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=g.createElement(d),g.head.insertBefore(x,g.querySelector("head > title"))),Sr(x,d,o),x[nt]=t,lt(x),d=x;break e;case"link":var O=kv("link","href",g).get(d+(o.href||""));if(O){for(var G=0;G<O.length;G++)if(x=O[G],x.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&x.getAttribute("rel")===(o.rel==null?null:o.rel)&&x.getAttribute("title")===(o.title==null?null:o.title)&&x.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){O.splice(G,1);break t}}x=g.createElement(d),Sr(x,d,o),g.head.appendChild(x);break;case"meta":if(O=kv("meta","content",g).get(d+(o.content||""))){for(G=0;G<O.length;G++)if(x=O[G],x.getAttribute("content")===(o.content==null?null:""+o.content)&&x.getAttribute("name")===(o.name==null?null:o.name)&&x.getAttribute("property")===(o.property==null?null:o.property)&&x.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&x.getAttribute("charset")===(o.charSet==null?null:o.charSet)){O.splice(G,1);break t}}x=g.createElement(d),Sr(x,d,o),g.head.appendChild(x);break;default:throw Error(a(468,d))}x[nt]=t,lt(x),d=x}t.stateNode=d}else Nv(g,t.type,t.stateNode);else t.stateNode=Cv(g,d,t.memoizedProps);else x!==d?(x===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):x.count--,d===null?Nv(g,t.type,t.stateNode):Cv(g,d,t.memoizedProps)):d===null&&t.stateNode!==null&&Vh(t,t.memoizedProps,o.memoizedProps)}break;case 27:zr(i,t),Mr(t),d&512&&(sr||o===null||Us(o,o.return)),o!==null&&d&4&&Vh(t,t.memoizedProps,o.memoizedProps);break;case 5:if(zr(i,t),Mr(t),d&512&&(sr||o===null||Us(o,o.return)),t.flags&32){g=t.stateNode;try{Rt(g,"")}catch(ut){bn(t,t.return,ut)}}d&4&&t.stateNode!=null&&(g=t.memoizedProps,Vh(t,g,o!==null?o.memoizedProps:g)),d&1024&&(Kh=!0);break;case 6:if(zr(i,t),Mr(t),d&4){if(t.stateNode===null)throw Error(a(162));d=t.memoizedProps,o=t.stateNode;try{o.nodeValue=d}catch(ut){bn(t,t.return,ut)}}break;case 3:if(xu=null,g=ws,ws=yu(i.containerInfo),zr(i,t),ws=g,Mr(t),d&4&&o!==null&&o.memoizedState.isDehydrated)try{go(i.containerInfo)}catch(ut){bn(t,t.return,ut)}Kh&&(Kh=!1,Ny(t));break;case 4:d=ws,ws=yu(t.stateNode.containerInfo),zr(i,t),Mr(t),ws=d;break;case 12:zr(i,t),Mr(t);break;case 31:zr(i,t),Mr(t),d&4&&(d=t.updateQueue,d!==null&&(t.updateQueue=null,ru(t,d)));break;case 13:zr(i,t),Mr(t),t.child.flags&8192&&t.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(iu=Be()),d&4&&(d=t.updateQueue,d!==null&&(t.updateQueue=null,ru(t,d)));break;case 22:g=t.memoizedState!==null;var pe=o!==null&&o.memoizedState!==null,De=Zs,qe=sr;if(Zs=De||g,sr=qe||pe,zr(i,t),sr=qe,Zs=De,Mr(t),d&8192)e:for(i=t.stateNode,i._visibility=g?i._visibility&-2:i._visibility|1,g&&(o===null||pe||Zs||sr||ba(t)),o=null,i=t;;){if(i.tag===5||i.tag===26){if(o===null){pe=o=i;try{if(x=pe.stateNode,g)O=x.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none";else{G=pe.stateNode;var He=pe.memoizedProps.style,Me=He!=null&&He.hasOwnProperty("display")?He.display:null;G.style.display=Me==null||typeof Me=="boolean"?"":(""+Me).trim()}}catch(ut){bn(pe,pe.return,ut)}}}else if(i.tag===6){if(o===null){pe=i;try{pe.stateNode.nodeValue=g?"":pe.memoizedProps}catch(ut){bn(pe,pe.return,ut)}}}else if(i.tag===18){if(o===null){pe=i;try{var $e=pe.stateNode;g?gv($e,!0):gv(pe.stateNode,!1)}catch(ut){bn(pe,pe.return,ut)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===t)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;i.sibling===null;){if(i.return===null||i.return===t)break e;o===i&&(o=null),i=i.return}o===i&&(o=null),i.sibling.return=i.return,i=i.sibling}d&4&&(d=t.updateQueue,d!==null&&(o=d.retryQueue,o!==null&&(d.retryQueue=null,ru(t,o))));break;case 19:zr(i,t),Mr(t),d&4&&(d=t.updateQueue,d!==null&&(t.updateQueue=null,ru(t,d)));break;case 30:break;case 21:break;default:zr(i,t),Mr(t)}}function Mr(t){var i=t.flags;if(i&2){try{for(var o,d=t.return;d!==null;){if(vy(d)){o=d;break}d=d.return}if(o==null)throw Error(a(160));switch(o.tag){case 27:var g=o.stateNode,x=Gh(t);nu(t,x,g);break;case 5:var O=o.stateNode;o.flags&32&&(Rt(O,""),o.flags&=-33);var G=Gh(t);nu(t,G,O);break;case 3:case 4:var pe=o.stateNode.containerInfo,De=Gh(t);Wh(t,De,pe);break;default:throw Error(a(161))}}catch(qe){bn(t,t.return,qe)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function Ny(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var i=t;Ny(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),t=t.sibling}}function ti(t,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)wy(t,i.alternate,i),i=i.sibling}function ba(t){for(t=t.child;t!==null;){var i=t;switch(i.tag){case 0:case 11:case 14:case 15:Oi(4,i,i.return),ba(i);break;case 1:Us(i,i.return);var o=i.stateNode;typeof o.componentWillUnmount=="function"&&gy(i,i.return,o),ba(i);break;case 27:Ol(i.stateNode);case 26:case 5:Us(i,i.return),ba(i);break;case 22:i.memoizedState===null&&ba(i);break;case 30:ba(i);break;default:ba(i)}t=t.sibling}}function ni(t,i,o){for(o=o&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var d=i.alternate,g=t,x=i,O=x.flags;switch(x.tag){case 0:case 11:case 15:ni(g,x,o),_l(4,x);break;case 1:if(ni(g,x,o),d=x,g=d.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(De){bn(d,d.return,De)}if(d=x,g=d.updateQueue,g!==null){var G=d.stateNode;try{var pe=g.shared.hiddenCallbacks;if(pe!==null)for(g.shared.hiddenCallbacks=null,g=0;g<pe.length;g++)sg(pe[g],G)}catch(De){bn(d,d.return,De)}}o&&O&64&&my(x),Sl(x,x.return);break;case 27:xy(x);case 26:case 5:ni(g,x,o),o&&d===null&&O&4&&yy(x),Sl(x,x.return);break;case 12:ni(g,x,o);break;case 31:ni(g,x,o),o&&O&4&&jy(g,x);break;case 13:ni(g,x,o),o&&O&4&&Cy(g,x);break;case 22:x.memoizedState===null&&ni(g,x,o),Sl(x,x.return);break;case 30:break;default:ni(g,x,o)}i=i.sibling}}function Yh(t,i){var o=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),t=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(t=i.memoizedState.cachePool.pool),t!==o&&(t!=null&&t.refCount++,o!=null&&cl(o))}function Qh(t,i){t=null,i.alternate!==null&&(t=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==t&&(i.refCount++,t!=null&&cl(t))}function _s(t,i,o,d){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Ey(t,i,o,d),i=i.sibling}function Ey(t,i,o,d){var g=i.flags;switch(i.tag){case 0:case 11:case 15:_s(t,i,o,d),g&2048&&_l(9,i);break;case 1:_s(t,i,o,d);break;case 3:_s(t,i,o,d),g&2048&&(t=null,i.alternate!==null&&(t=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==t&&(i.refCount++,t!=null&&cl(t)));break;case 12:if(g&2048){_s(t,i,o,d),t=i.stateNode;try{var x=i.memoizedProps,O=x.id,G=x.onPostCommit;typeof G=="function"&&G(O,i.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(pe){bn(i,i.return,pe)}}else _s(t,i,o,d);break;case 31:_s(t,i,o,d);break;case 13:_s(t,i,o,d);break;case 23:break;case 22:x=i.stateNode,O=i.alternate,i.memoizedState!==null?x._visibility&2?_s(t,i,o,d):jl(t,i):x._visibility&2?_s(t,i,o,d):(x._visibility|=2,so(t,i,o,d,(i.subtreeFlags&10256)!==0||!1)),g&2048&&Yh(O,i);break;case 24:_s(t,i,o,d),g&2048&&Qh(i.alternate,i);break;default:_s(t,i,o,d)}}function so(t,i,o,d,g){for(g=g&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var x=t,O=i,G=o,pe=d,De=O.flags;switch(O.tag){case 0:case 11:case 15:so(x,O,G,pe,g),_l(8,O);break;case 23:break;case 22:var qe=O.stateNode;O.memoizedState!==null?qe._visibility&2?so(x,O,G,pe,g):jl(x,O):(qe._visibility|=2,so(x,O,G,pe,g)),g&&De&2048&&Yh(O.alternate,O);break;case 24:so(x,O,G,pe,g),g&&De&2048&&Qh(O.alternate,O);break;default:so(x,O,G,pe,g)}i=i.sibling}}function jl(t,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var o=t,d=i,g=d.flags;switch(d.tag){case 22:jl(o,d),g&2048&&Yh(d.alternate,d);break;case 24:jl(o,d),g&2048&&Qh(d.alternate,d);break;default:jl(o,d)}i=i.sibling}}var Cl=8192;function io(t,i,o){if(t.subtreeFlags&Cl)for(t=t.child;t!==null;)Ay(t,i,o),t=t.sibling}function Ay(t,i,o){switch(t.tag){case 26:io(t,i,o),t.flags&Cl&&t.memoizedState!==null&&Y_(o,ws,t.memoizedState,t.memoizedProps);break;case 5:io(t,i,o);break;case 3:case 4:var d=ws;ws=yu(t.stateNode.containerInfo),io(t,i,o),ws=d;break;case 22:t.memoizedState===null&&(d=t.alternate,d!==null&&d.memoizedState!==null?(d=Cl,Cl=16777216,io(t,i,o),Cl=d):io(t,i,o));break;default:io(t,i,o)}}function Ty(t){var i=t.alternate;if(i!==null&&(t=i.child,t!==null)){i.child=null;do i=t.sibling,t.sibling=null,t=i;while(t!==null)}}function kl(t){var i=t.deletions;if((t.flags&16)!==0){if(i!==null)for(var o=0;o<i.length;o++){var d=i[o];pr=d,Oy(d,t)}Ty(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Ry(t),t=t.sibling}function Ry(t){switch(t.tag){case 0:case 11:case 15:kl(t),t.flags&2048&&Oi(9,t,t.return);break;case 3:kl(t);break;case 12:kl(t);break;case 22:var i=t.stateNode;t.memoizedState!==null&&i._visibility&2&&(t.return===null||t.return.tag!==13)?(i._visibility&=-3,su(t)):kl(t);break;default:kl(t)}}function su(t){var i=t.deletions;if((t.flags&16)!==0){if(i!==null)for(var o=0;o<i.length;o++){var d=i[o];pr=d,Oy(d,t)}Ty(t)}for(t=t.child;t!==null;){switch(i=t,i.tag){case 0:case 11:case 15:Oi(8,i,i.return),su(i);break;case 22:o=i.stateNode,o._visibility&2&&(o._visibility&=-3,su(i));break;default:su(i)}t=t.sibling}}function Oy(t,i){for(;pr!==null;){var o=pr;switch(o.tag){case 0:case 11:case 15:Oi(8,o,i);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var d=o.memoizedState.cachePool.pool;d!=null&&d.refCount++}break;case 24:cl(o.memoizedState.cache)}if(d=o.child,d!==null)d.return=o,pr=d;else e:for(o=t;pr!==null;){d=pr;var g=d.sibling,x=d.return;if(_y(d),d===o){pr=null;break e}if(g!==null){g.return=x,pr=g;break e}pr=x}}}var u_={getCacheForType:function(t){var i=wr(tr),o=i.data.get(t);return o===void 0&&(o=t(),i.data.set(t,o)),o},cacheSignal:function(){return wr(tr).controller.signal}},d_=typeof WeakMap=="function"?WeakMap:Map,pn=0,Nn=null,Yt=null,Xt=0,xn=0,Gr=null,Di=!1,ao=!1,Jh=!1,ri=0,Wn=0,zi=0,wa=0,Xh=0,Wr=0,oo=0,Nl=null,Lr=null,Zh=!1,iu=0,Dy=0,au=1/0,ou=null,Mi=null,lr=0,Li=null,lo=null,si=0,ef=0,tf=null,zy=null,El=0,nf=null;function Kr(){return(pn&2)!==0&&Xt!==0?Xt&-Xt:z.T!==null?cf():qn()}function My(){if(Wr===0)if((Xt&536870912)===0||en){var t=yn;yn<<=1,(yn&3932160)===0&&(yn=262144),Wr=t}else Wr=536870912;return t=Hr.current,t!==null&&(t.flags|=32),Wr}function Ur(t,i,o){(t===Nn&&(xn===2||xn===9)||t.cancelPendingCommit!==null)&&(co(t,0),Ui(t,Xt,Wr,!1)),hn(t,o),((pn&2)===0||t!==Nn)&&(t===Nn&&((pn&2)===0&&(wa|=o),Wn===4&&Ui(t,Xt,Wr,!1)),Is(t))}function Ly(t,i,o){if((pn&6)!==0)throw Error(a(327));var d=!o&&(i&127)===0&&(i&t.expiredLanes)===0||Ft(t,i),g=d?p_(t,i):sf(t,i,!0),x=d;do{if(g===0){ao&&!d&&Ui(t,i,0,!1);break}else{if(o=t.current.alternate,x&&!h_(o)){g=sf(t,i,!1),x=!1;continue}if(g===2){if(x=i,t.errorRecoveryDisabledLanes&x)var O=0;else O=t.pendingLanes&-536870913,O=O!==0?O:O&536870912?536870912:0;if(O!==0){i=O;e:{var G=t;g=Nl;var pe=G.current.memoizedState.isDehydrated;if(pe&&(co(G,O).flags|=256),O=sf(G,O,!1),O!==2){if(Jh&&!pe){G.errorRecoveryDisabledLanes|=x,wa|=x,g=4;break e}x=Lr,Lr=g,x!==null&&(Lr===null?Lr=x:Lr.push.apply(Lr,x))}g=O}if(x=!1,g!==2)continue}}if(g===1){co(t,0),Ui(t,i,0,!0);break}e:{switch(d=t,x=g,x){case 0:case 1:throw Error(a(345));case 4:if((i&4194048)!==i)break;case 6:Ui(d,i,Wr,!Di);break e;case 2:Lr=null;break;case 3:case 5:break;default:throw Error(a(329))}if((i&62914560)===i&&(g=iu+300-Be(),10<g)){if(Ui(d,i,Wr,!Di),Kt(d,0,!0)!==0)break e;si=i,d.timeoutHandle=fv(Uy.bind(null,d,o,Lr,ou,Zh,i,Wr,wa,oo,Di,x,"Throttled",-0,0),g);break e}Uy(d,o,Lr,ou,Zh,i,Wr,wa,oo,Di,x,null,-0,0)}}break}while(!0);Is(t)}function Uy(t,i,o,d,g,x,O,G,pe,De,qe,He,Me,$e){if(t.timeoutHandle=-1,He=i.subtreeFlags,He&8192||(He&16785408)===16785408){He={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:vr},Ay(i,x,He);var ut=(x&62914560)===x?iu-Be():(x&4194048)===x?Dy-Be():0;if(ut=Q_(He,ut),ut!==null){si=x,t.cancelPendingCommit=ut(Vy.bind(null,t,i,x,o,d,g,O,G,pe,qe,He,null,Me,$e)),Ui(t,x,O,!De);return}}Vy(t,i,x,o,d,g,O,G,pe)}function h_(t){for(var i=t;;){var o=i.tag;if((o===0||o===11||o===15)&&i.flags&16384&&(o=i.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var d=0;d<o.length;d++){var g=o[d],x=g.getSnapshot;g=g.value;try{if(!qr(x(),g))return!1}catch{return!1}}if(o=i.child,i.subtreeFlags&16384&&o!==null)o.return=i,i=o;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ui(t,i,o,d){i&=~Xh,i&=~wa,t.suspendedLanes|=i,t.pingedLanes&=~i,d&&(t.warmLanes|=i),d=t.expirationTimes;for(var g=i;0<g;){var x=31-wt(g),O=1<<x;d[x]=-1,g&=~O}o!==0&&Dn(t,o,i)}function lu(){return(pn&6)===0?(Al(0),!1):!0}function rf(){if(Yt!==null){if(xn===0)var t=Yt.return;else t=Yt,Ws=ha=null,xh(t),Za=null,dl=0,t=Yt;for(;t!==null;)py(t.alternate,t),t=t.return;Yt=null}}function co(t,i){var o=t.timeoutHandle;o!==-1&&(t.timeoutHandle=-1,O_(o)),o=t.cancelPendingCommit,o!==null&&(t.cancelPendingCommit=null,o()),si=0,rf(),Nn=t,Yt=o=Vs(t.current,null),Xt=i,xn=0,Gr=null,Di=!1,ao=Ft(t,i),Jh=!1,oo=Wr=Xh=wa=zi=Wn=0,Lr=Nl=null,Zh=!1,(i&8)!==0&&(i|=i&32);var d=t.entangledLanes;if(d!==0)for(t=t.entanglements,d&=i;0<d;){var g=31-wt(d),x=1<<g;i|=t[g],d&=~x}return ri=i,Ac(),o}function Iy(t,i){Ut=null,z.H=xl,i===Xa||i===Uc?(i=eg(),xn=3):i===oh?(i=eg(),xn=4):xn=i===Mh?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,Gr=i,Yt===null&&(Wn=1,Jc(t,ns(i,t.current)))}function By(){var t=Hr.current;return t===null?!0:(Xt&4194048)===Xt?as===null:(Xt&62914560)===Xt||(Xt&536870912)!==0?t===as:!1}function $y(){var t=z.H;return z.H=xl,t===null?xl:t}function Py(){var t=z.A;return z.A=u_,t}function cu(){Wn=4,Di||(Xt&4194048)!==Xt&&Hr.current!==null||(ao=!0),(zi&134217727)===0&&(wa&134217727)===0||Nn===null||Ui(Nn,Xt,Wr,!1)}function sf(t,i,o){var d=pn;pn|=2;var g=$y(),x=Py();(Nn!==t||Xt!==i)&&(ou=null,co(t,i)),i=!1;var O=Wn;e:do try{if(xn!==0&&Yt!==null){var G=Yt,pe=Gr;switch(xn){case 8:rf(),O=6;break e;case 3:case 2:case 9:case 6:Hr.current===null&&(i=!0);var De=xn;if(xn=0,Gr=null,uo(t,G,pe,De),o&&ao){O=0;break e}break;default:De=xn,xn=0,Gr=null,uo(t,G,pe,De)}}f_(),O=Wn;break}catch(qe){Iy(t,qe)}while(!0);return i&&t.shellSuspendCounter++,Ws=ha=null,pn=d,z.H=g,z.A=x,Yt===null&&(Nn=null,Xt=0,Ac()),O}function f_(){for(;Yt!==null;)qy(Yt)}function p_(t,i){var o=pn;pn|=2;var d=$y(),g=Py();Nn!==t||Xt!==i?(ou=null,au=Be()+500,co(t,i)):ao=Ft(t,i);e:do try{if(xn!==0&&Yt!==null){i=Yt;var x=Gr;t:switch(xn){case 1:xn=0,Gr=null,uo(t,i,x,1);break;case 2:case 9:if(Xm(x)){xn=0,Gr=null,Fy(i);break}i=function(){xn!==2&&xn!==9||Nn!==t||(xn=7),Is(t)},x.then(i,i);break e;case 3:xn=7;break e;case 4:xn=5;break e;case 7:Xm(x)?(xn=0,Gr=null,Fy(i)):(xn=0,Gr=null,uo(t,i,x,7));break;case 5:var O=null;switch(Yt.tag){case 26:O=Yt.memoizedState;case 5:case 27:var G=Yt;if(O?Ev(O):G.stateNode.complete){xn=0,Gr=null;var pe=G.sibling;if(pe!==null)Yt=pe;else{var De=G.return;De!==null?(Yt=De,uu(De)):Yt=null}break t}}xn=0,Gr=null,uo(t,i,x,5);break;case 6:xn=0,Gr=null,uo(t,i,x,6);break;case 8:rf(),Wn=6;break e;default:throw Error(a(462))}}m_();break}catch(qe){Iy(t,qe)}while(!0);return Ws=ha=null,z.H=d,z.A=g,pn=o,Yt!==null?0:(Nn=null,Xt=0,Ac(),Wn)}function m_(){for(;Yt!==null&&!de();)qy(Yt)}function qy(t){var i=hy(t.alternate,t,ri);t.memoizedProps=t.pendingProps,i===null?uu(t):Yt=i}function Fy(t){var i=t,o=i.alternate;switch(i.tag){case 15:case 0:i=ay(o,i,i.pendingProps,i.type,void 0,Xt);break;case 11:i=ay(o,i,i.pendingProps,i.type.render,i.ref,Xt);break;case 5:xh(i);default:py(o,i),i=Yt=Pm(i,ri),i=hy(o,i,ri)}t.memoizedProps=t.pendingProps,i===null?uu(t):Yt=i}function uo(t,i,o,d){Ws=ha=null,xh(i),Za=null,dl=0;var g=i.return;try{if(r_(t,g,i,o,Xt)){Wn=1,Jc(t,ns(o,t.current)),Yt=null;return}}catch(x){if(g!==null)throw Yt=g,x;Wn=1,Jc(t,ns(o,t.current)),Yt=null;return}i.flags&32768?(en||d===1?t=!0:ao||(Xt&536870912)!==0?t=!1:(Di=t=!0,(d===2||d===9||d===3||d===6)&&(d=Hr.current,d!==null&&d.tag===13&&(d.flags|=16384))),Hy(i,t)):uu(i)}function uu(t){var i=t;do{if((i.flags&32768)!==0){Hy(i,Di);return}t=i.return;var o=a_(i.alternate,i,ri);if(o!==null){Yt=o;return}if(i=i.sibling,i!==null){Yt=i;return}Yt=i=t}while(i!==null);Wn===0&&(Wn=5)}function Hy(t,i){do{var o=o_(t.alternate,t);if(o!==null){o.flags&=32767,Yt=o;return}if(o=t.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!i&&(t=t.sibling,t!==null)){Yt=t;return}Yt=t=o}while(t!==null);Wn=6,Yt=null}function Vy(t,i,o,d,g,x,O,G,pe){t.cancelPendingCommit=null;do du();while(lr!==0);if((pn&6)!==0)throw Error(a(327));if(i!==null){if(i===t.current)throw Error(a(177));if(x=i.lanes|i.childLanes,x|=Gd,an(t,o,x,O,G,pe),t===Nn&&(Yt=Nn=null,Xt=0),lo=i,Li=t,si=o,ef=x,tf=g,zy=d,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,x_(We,function(){return Qy(),null})):(t.callbackNode=null,t.callbackPriority=0),d=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||d){d=z.T,z.T=null,g=B.p,B.p=2,O=pn,pn|=4;try{l_(t,i,o)}finally{pn=O,B.p=g,z.T=d}}lr=1,Gy(),Wy(),Ky()}}function Gy(){if(lr===1){lr=0;var t=Li,i=lo,o=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||o){o=z.T,z.T=null;var d=B.p;B.p=2;var g=pn;pn|=4;try{ky(i,t);var x=yf,O=Om(t.containerInfo),G=x.focusedElem,pe=x.selectionRange;if(O!==G&&G&&G.ownerDocument&&Rm(G.ownerDocument.documentElement,G)){if(pe!==null&&Pd(G)){var De=pe.start,qe=pe.end;if(qe===void 0&&(qe=De),"selectionStart"in G)G.selectionStart=De,G.selectionEnd=Math.min(qe,G.value.length);else{var He=G.ownerDocument||document,Me=He&&He.defaultView||window;if(Me.getSelection){var $e=Me.getSelection(),ut=G.textContent.length,Ct=Math.min(pe.start,ut),Sn=pe.end===void 0?Ct:Math.min(pe.end,ut);!$e.extend&&Ct>Sn&&(O=Sn,Sn=Ct,Ct=O);var ke=Tm(G,Ct),_e=Tm(G,Sn);if(ke&&_e&&($e.rangeCount!==1||$e.anchorNode!==ke.node||$e.anchorOffset!==ke.offset||$e.focusNode!==_e.node||$e.focusOffset!==_e.offset)){var Oe=He.createRange();Oe.setStart(ke.node,ke.offset),$e.removeAllRanges(),Ct>Sn?($e.addRange(Oe),$e.extend(_e.node,_e.offset)):(Oe.setEnd(_e.node,_e.offset),$e.addRange(Oe))}}}}for(He=[],$e=G;$e=$e.parentNode;)$e.nodeType===1&&He.push({element:$e,left:$e.scrollLeft,top:$e.scrollTop});for(typeof G.focus=="function"&&G.focus(),G=0;G<He.length;G++){var Fe=He[G];Fe.element.scrollLeft=Fe.left,Fe.element.scrollTop=Fe.top}}Su=!!gf,yf=gf=null}finally{pn=g,B.p=d,z.T=o}}t.current=i,lr=2}}function Wy(){if(lr===2){lr=0;var t=Li,i=lo,o=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||o){o=z.T,z.T=null;var d=B.p;B.p=2;var g=pn;pn|=4;try{wy(t,i.alternate,i)}finally{pn=g,B.p=d,z.T=o}}lr=3}}function Ky(){if(lr===4||lr===3){lr=0,me();var t=Li,i=lo,o=si,d=zy;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?lr=5:(lr=0,lo=Li=null,Yy(t,t.pendingLanes));var g=t.pendingLanes;if(g===0&&(Mi=null),zn(o),i=i.stateNode,Tt&&typeof Tt.onCommitFiberRoot=="function")try{Tt.onCommitFiberRoot(ft,i,void 0,(i.current.flags&128)===128)}catch{}if(d!==null){i=z.T,g=B.p,B.p=2,z.T=null;try{for(var x=t.onRecoverableError,O=0;O<d.length;O++){var G=d[O];x(G.value,{componentStack:G.stack})}}finally{z.T=i,B.p=g}}(si&3)!==0&&du(),Is(t),g=t.pendingLanes,(o&261930)!==0&&(g&42)!==0?t===nf?El++:(El=0,nf=t):El=0,Al(0)}}function Yy(t,i){(t.pooledCacheLanes&=i)===0&&(i=t.pooledCache,i!=null&&(t.pooledCache=null,cl(i)))}function du(){return Gy(),Wy(),Ky(),Qy()}function Qy(){if(lr!==5)return!1;var t=Li,i=ef;ef=0;var o=zn(si),d=z.T,g=B.p;try{B.p=32>o?32:o,z.T=null,o=tf,tf=null;var x=Li,O=si;if(lr=0,lo=Li=null,si=0,(pn&6)!==0)throw Error(a(331));var G=pn;if(pn|=4,Ry(x.current),Ey(x,x.current,O,o),pn=G,Al(0,!1),Tt&&typeof Tt.onPostCommitFiberRoot=="function")try{Tt.onPostCommitFiberRoot(ft,x)}catch{}return!0}finally{B.p=g,z.T=d,Yy(t,i)}}function Jy(t,i,o){i=ns(o,i),i=zh(t.stateNode,i,2),t=Ai(t,i,2),t!==null&&(hn(t,2),Is(t))}function bn(t,i,o){if(t.tag===3)Jy(t,t,o);else for(;i!==null;){if(i.tag===3){Jy(i,t,o);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Mi===null||!Mi.has(d))){t=ns(o,t),o=Xg(2),d=Ai(i,o,2),d!==null&&(Zg(o,d,i,t),hn(d,2),Is(d));break}}i=i.return}}function af(t,i,o){var d=t.pingCache;if(d===null){d=t.pingCache=new d_;var g=new Set;d.set(i,g)}else g=d.get(i),g===void 0&&(g=new Set,d.set(i,g));g.has(o)||(Jh=!0,g.add(o),t=g_.bind(null,t,i,o),i.then(t,t))}function g_(t,i,o){var d=t.pingCache;d!==null&&d.delete(i),t.pingedLanes|=t.suspendedLanes&o,t.warmLanes&=~o,Nn===t&&(Xt&o)===o&&(Wn===4||Wn===3&&(Xt&62914560)===Xt&&300>Be()-iu?(pn&2)===0&&co(t,0):Xh|=o,oo===Xt&&(oo=0)),Is(t)}function Xy(t,i){i===0&&(i=Ht()),t=ca(t,i),t!==null&&(hn(t,i),Is(t))}function y_(t){var i=t.memoizedState,o=0;i!==null&&(o=i.retryLane),Xy(t,o)}function v_(t,i){var o=0;switch(t.tag){case 31:case 13:var d=t.stateNode,g=t.memoizedState;g!==null&&(o=g.retryLane);break;case 19:d=t.stateNode;break;case 22:d=t.stateNode._retryCache;break;default:throw Error(a(314))}d!==null&&d.delete(i),Xy(t,o)}function x_(t,i){return re(t,i)}var hu=null,ho=null,of=!1,fu=!1,lf=!1,Ii=0;function Is(t){t!==ho&&t.next===null&&(ho===null?hu=ho=t:ho=ho.next=t),fu=!0,of||(of=!0,w_())}function Al(t,i){if(!lf&&fu){lf=!0;do for(var o=!1,d=hu;d!==null;){if(t!==0){var g=d.pendingLanes;if(g===0)var x=0;else{var O=d.suspendedLanes,G=d.pingedLanes;x=(1<<31-wt(42|t)+1)-1,x&=g&~(O&~G),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(o=!0,nv(d,x))}else x=Xt,x=Kt(d,d===Nn?x:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),(x&3)===0||Ft(d,x)||(o=!0,nv(d,x));d=d.next}while(o);lf=!1}}function b_(){Zy()}function Zy(){fu=of=!1;var t=0;Ii!==0&&R_()&&(t=Ii);for(var i=Be(),o=null,d=hu;d!==null;){var g=d.next,x=ev(d,i);x===0?(d.next=null,o===null?hu=g:o.next=g,g===null&&(ho=o)):(o=d,(t!==0||(x&3)!==0)&&(fu=!0)),d=g}lr!==0&&lr!==5||Al(t),Ii!==0&&(Ii=0)}function ev(t,i){for(var o=t.suspendedLanes,d=t.pingedLanes,g=t.expirationTimes,x=t.pendingLanes&-62914561;0<x;){var O=31-wt(x),G=1<<O,pe=g[O];pe===-1?((G&o)===0||(G&d)!==0)&&(g[O]=dn(G,i)):pe<=i&&(t.expiredLanes|=G),x&=~G}if(i=Nn,o=Xt,o=Kt(t,t===i?o:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),d=t.callbackNode,o===0||t===i&&(xn===2||xn===9)||t.cancelPendingCommit!==null)return d!==null&&d!==null&&ee(d),t.callbackNode=null,t.callbackPriority=0;if((o&3)===0||Ft(t,o)){if(i=o&-o,i===t.callbackPriority)return i;switch(d!==null&&ee(d),zn(o)){case 2:case 8:o=Je;break;case 32:o=We;break;case 268435456:o=Wt;break;default:o=We}return d=tv.bind(null,t),o=re(o,d),t.callbackPriority=i,t.callbackNode=o,i}return d!==null&&d!==null&&ee(d),t.callbackPriority=2,t.callbackNode=null,2}function tv(t,i){if(lr!==0&&lr!==5)return t.callbackNode=null,t.callbackPriority=0,null;var o=t.callbackNode;if(du()&&t.callbackNode!==o)return null;var d=Xt;return d=Kt(t,t===Nn?d:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),d===0?null:(Ly(t,d,i),ev(t,Be()),t.callbackNode!=null&&t.callbackNode===o?tv.bind(null,t):null)}function nv(t,i){if(du())return null;Ly(t,i,!0)}function w_(){D_(function(){(pn&6)!==0?re(Pe,b_):Zy()})}function cf(){if(Ii===0){var t=Qa;t===0&&(t=un,un<<=1,(un&261888)===0&&(un=256)),Ii=t}return Ii}function rv(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:or(""+t)}function sv(t,i){var o=i.ownerDocument.createElement("input");return o.name=i.name,o.value=i.value,t.id&&o.setAttribute("form",t.id),i.parentNode.insertBefore(o,i),t=new FormData(t),o.parentNode.removeChild(o),t}function __(t,i,o,d,g){if(i==="submit"&&o&&o.stateNode===g){var x=rv((g[te]||null).action),O=d.submitter;O&&(i=(i=O[te]||null)?rv(i.formAction):O.getAttribute("formAction"),i!==null&&(x=i,O=null));var G=new vt("action","action",null,d,g);t.push({event:G,listeners:[{instance:null,listener:function(){if(d.defaultPrevented){if(Ii!==0){var pe=O?sv(g,O):new FormData(g);Eh(o,{pending:!0,data:pe,method:g.method,action:x},null,pe)}}else typeof x=="function"&&(G.preventDefault(),pe=O?sv(g,O):new FormData(g),Eh(o,{pending:!0,data:pe,method:g.method,action:x},x,pe))},currentTarget:g}]})}}for(var uf=0;uf<Vd.length;uf++){var df=Vd[uf],S_=df.toLowerCase(),j_=df[0].toUpperCase()+df.slice(1);bs(S_,"on"+j_)}bs(Mm,"onAnimationEnd"),bs(Lm,"onAnimationIteration"),bs(Um,"onAnimationStart"),bs("dblclick","onDoubleClick"),bs("focusin","onFocus"),bs("focusout","onBlur"),bs($w,"onTransitionRun"),bs(Pw,"onTransitionStart"),bs(qw,"onTransitionCancel"),bs(Im,"onTransitionEnd"),ct("onMouseEnter",["mouseout","mouseover"]),ct("onMouseLeave",["mouseout","mouseover"]),ct("onPointerEnter",["pointerout","pointerover"]),ct("onPointerLeave",["pointerout","pointerover"]),Ve("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ve("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ve("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ve("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ve("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ve("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Tl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),C_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Tl));function iv(t,i){i=(i&4)!==0;for(var o=0;o<t.length;o++){var d=t[o],g=d.event;d=d.listeners;e:{var x=void 0;if(i)for(var O=d.length-1;0<=O;O--){var G=d[O],pe=G.instance,De=G.currentTarget;if(G=G.listener,pe!==x&&g.isPropagationStopped())break e;x=G,g.currentTarget=De;try{x(g)}catch(qe){Ec(qe)}g.currentTarget=null,x=pe}else for(O=0;O<d.length;O++){if(G=d[O],pe=G.instance,De=G.currentTarget,G=G.listener,pe!==x&&g.isPropagationStopped())break e;x=G,g.currentTarget=De;try{x(g)}catch(qe){Ec(qe)}g.currentTarget=null,x=pe}}}}function Qt(t,i){var o=i[Ae];o===void 0&&(o=i[Ae]=new Set);var d=t+"__bubble";o.has(d)||(av(i,t,2,!1),o.add(d))}function hf(t,i,o){var d=0;i&&(d|=4),av(o,t,d,i)}var pu="_reactListening"+Math.random().toString(36).slice(2);function ff(t){if(!t[pu]){t[pu]=!0,Pt.forEach(function(o){o!=="selectionchange"&&(C_.has(o)||hf(o,!1,t),hf(o,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[pu]||(i[pu]=!0,hf("selectionchange",!1,i))}}function av(t,i,o,d){switch(Mv(i)){case 2:var g=Z_;break;case 8:g=eS;break;default:g=Ef}o=g.bind(null,i,o,t),g=void 0,!X||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(g=!0),d?g!==void 0?t.addEventListener(i,o,{capture:!0,passive:g}):t.addEventListener(i,o,!0):g!==void 0?t.addEventListener(i,o,{passive:g}):t.addEventListener(i,o,!1)}function pf(t,i,o,d,g){var x=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var O=d.tag;if(O===3||O===4){var G=d.stateNode.containerInfo;if(G===g)break;if(O===4)for(O=d.return;O!==null;){var pe=O.tag;if((pe===3||pe===4)&&O.stateNode.containerInfo===g)return;O=O.return}for(;G!==null;){if(O=Ke(G),O===null)return;if(pe=O.tag,pe===5||pe===6||pe===26||pe===27){d=x=O;continue e}G=G.parentNode}}d=d.return}ia(function(){var De=x,qe=sa(o),He=[];e:{var Me=Bm.get(t);if(Me!==void 0){var $e=vt,ut=t;switch(t){case"keypress":if(et(o)===0)break e;case"keydown":case"keyup":$e=vw;break;case"focusin":ut="focus",$e=Fn;break;case"focusout":ut="blur",$e=Fn;break;case"beforeblur":case"afterblur":$e=Fn;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$e=gt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$e=At;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$e=ww;break;case Mm:case Lm:case Um:$e=Gt;break;case Im:$e=Sw;break;case"scroll":case"scrollend":$e=Ot;break;case"wheel":$e=Cw;break;case"copy":case"cut":case"paste":$e=Hn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$e=gm;break;case"toggle":case"beforetoggle":$e=Nw}var Ct=(i&4)!==0,Sn=!Ct&&(t==="scroll"||t==="scrollend"),ke=Ct?Me!==null?Me+"Capture":null:Me;Ct=[];for(var _e=De,Oe;_e!==null;){var Fe=_e;if(Oe=Fe.stateNode,Fe=Fe.tag,Fe!==5&&Fe!==26&&Fe!==27||Oe===null||ke===null||(Fe=bi(_e,ke),Fe!=null&&Ct.push(Rl(_e,Fe,Oe))),Sn)break;_e=_e.return}0<Ct.length&&(Me=new $e(Me,ut,null,o,qe),He.push({event:Me,listeners:Ct}))}}if((i&7)===0){e:{if(Me=t==="mouseover"||t==="pointerover",$e=t==="mouseout"||t==="pointerout",Me&&o!==Ds&&(ut=o.relatedTarget||o.fromElement)&&(Ke(ut)||ut[ze]))break e;if(($e||Me)&&(Me=qe.window===qe?qe:(Me=qe.ownerDocument)?Me.defaultView||Me.parentWindow:window,$e?(ut=o.relatedTarget||o.toElement,$e=De,ut=ut?Ke(ut):null,ut!==null&&(Sn=c(ut),Ct=ut.tag,ut!==Sn||Ct!==5&&Ct!==27&&Ct!==6)&&(ut=null)):($e=null,ut=De),$e!==ut)){if(Ct=gt,Fe="onMouseLeave",ke="onMouseEnter",_e="mouse",(t==="pointerout"||t==="pointerover")&&(Ct=gm,Fe="onPointerLeave",ke="onPointerEnter",_e="pointer"),Sn=$e==null?Me:Ze($e),Oe=ut==null?Me:Ze(ut),Me=new Ct(Fe,_e+"leave",$e,o,qe),Me.target=Sn,Me.relatedTarget=Oe,Fe=null,Ke(qe)===De&&(Ct=new Ct(ke,_e+"enter",ut,o,qe),Ct.target=Oe,Ct.relatedTarget=Sn,Fe=Ct),Sn=Fe,$e&&ut)t:{for(Ct=k_,ke=$e,_e=ut,Oe=0,Fe=ke;Fe;Fe=Ct(Fe))Oe++;Fe=0;for(var bt=_e;bt;bt=Ct(bt))Fe++;for(;0<Oe-Fe;)ke=Ct(ke),Oe--;for(;0<Fe-Oe;)_e=Ct(_e),Fe--;for(;Oe--;){if(ke===_e||_e!==null&&ke===_e.alternate){Ct=ke;break t}ke=Ct(ke),_e=Ct(_e)}Ct=null}else Ct=null;$e!==null&&ov(He,Me,$e,Ct,!1),ut!==null&&Sn!==null&&ov(He,Sn,ut,Ct,!0)}}e:{if(Me=De?Ze(De):window,$e=Me.nodeName&&Me.nodeName.toLowerCase(),$e==="select"||$e==="input"&&Me.type==="file")var ln=jm;else if(_m(Me))if(Cm)ln=Uw;else{ln=Mw;var pt=zw}else $e=Me.nodeName,!$e||$e.toLowerCase()!=="input"||Me.type!=="checkbox"&&Me.type!=="radio"?De&&Xr(De.elementType)&&(ln=jm):ln=Lw;if(ln&&(ln=ln(t,De))){Sm(He,ln,o,qe);break e}pt&&pt(t,Me,De),t==="focusout"&&De&&Me.type==="number"&&De.memoizedProps.value!=null&&vn(Me,"number",Me.value)}switch(pt=De?Ze(De):window,t){case"focusin":(_m(pt)||pt.contentEditable==="true")&&(qa=pt,qd=De,al=null);break;case"focusout":al=qd=qa=null;break;case"mousedown":Fd=!0;break;case"contextmenu":case"mouseup":case"dragend":Fd=!1,Dm(He,o,qe);break;case"selectionchange":if(Bw)break;case"keydown":case"keyup":Dm(He,o,qe)}var Bt;if(Id)e:{switch(t){case"compositionstart":var Zt="onCompositionStart";break e;case"compositionend":Zt="onCompositionEnd";break e;case"compositionupdate":Zt="onCompositionUpdate";break e}Zt=void 0}else Pa?bm(t,o)&&(Zt="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(Zt="onCompositionStart");Zt&&(ym&&o.locale!=="ko"&&(Pa||Zt!=="onCompositionStart"?Zt==="onCompositionEnd"&&Pa&&(Bt=Ye()):(we=qe,Ue="value"in we?we.value:we.textContent,Pa=!0)),pt=mu(De,Zt),0<pt.length&&(Zt=new xs(Zt,t,null,o,qe),He.push({event:Zt,listeners:pt}),Bt?Zt.data=Bt:(Bt=wm(o),Bt!==null&&(Zt.data=Bt)))),(Bt=Aw?Tw(t,o):Rw(t,o))&&(Zt=mu(De,"onBeforeInput"),0<Zt.length&&(pt=new xs("onBeforeInput","beforeinput",null,o,qe),He.push({event:pt,listeners:Zt}),pt.data=Bt)),__(He,t,De,o,qe)}iv(He,i)})}function Rl(t,i,o){return{instance:t,listener:i,currentTarget:o}}function mu(t,i){for(var o=i+"Capture",d=[];t!==null;){var g=t,x=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||x===null||(g=bi(t,o),g!=null&&d.unshift(Rl(t,g,x)),g=bi(t,i),g!=null&&d.push(Rl(t,g,x))),t.tag===3)return d;t=t.return}return[]}function k_(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function ov(t,i,o,d,g){for(var x=i._reactName,O=[];o!==null&&o!==d;){var G=o,pe=G.alternate,De=G.stateNode;if(G=G.tag,pe!==null&&pe===d)break;G!==5&&G!==26&&G!==27||De===null||(pe=De,g?(De=bi(o,x),De!=null&&O.unshift(Rl(o,De,pe))):g||(De=bi(o,x),De!=null&&O.push(Rl(o,De,pe)))),o=o.return}O.length!==0&&t.push({event:i,listeners:O})}var N_=/\r\n?/g,E_=/\u0000|\uFFFD/g;function lv(t){return(typeof t=="string"?t:""+t).replace(N_,`
`).replace(E_,"")}function cv(t,i){return i=lv(i),lv(t)===i}function _n(t,i,o,d,g,x){switch(o){case"children":typeof d=="string"?i==="body"||i==="textarea"&&d===""||Rt(t,d):(typeof d=="number"||typeof d=="bigint")&&i!=="body"&&Rt(t,""+d);break;case"className":Or(t,"class",d);break;case"tabIndex":Or(t,"tabindex",d);break;case"dir":case"role":case"viewBox":case"width":case"height":Or(t,o,d);break;case"style":Yn(t,d,x);break;case"data":if(i!=="object"){Or(t,"data",d);break}case"src":case"href":if(d===""&&(i!=="a"||o!=="href")){t.removeAttribute(o);break}if(d==null||typeof d=="function"||typeof d=="symbol"||typeof d=="boolean"){t.removeAttribute(o);break}d=or(""+d),t.setAttribute(o,d);break;case"action":case"formAction":if(typeof d=="function"){t.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(o==="formAction"?(i!=="input"&&_n(t,i,"name",g.name,g,null),_n(t,i,"formEncType",g.formEncType,g,null),_n(t,i,"formMethod",g.formMethod,g,null),_n(t,i,"formTarget",g.formTarget,g,null)):(_n(t,i,"encType",g.encType,g,null),_n(t,i,"method",g.method,g,null),_n(t,i,"target",g.target,g,null)));if(d==null||typeof d=="symbol"||typeof d=="boolean"){t.removeAttribute(o);break}d=or(""+d),t.setAttribute(o,d);break;case"onClick":d!=null&&(t.onclick=vr);break;case"onScroll":d!=null&&Qt("scroll",t);break;case"onScrollEnd":d!=null&&Qt("scrollend",t);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(a(61));if(o=d.__html,o!=null){if(g.children!=null)throw Error(a(60));t.innerHTML=o}}break;case"multiple":t.multiple=d&&typeof d!="function"&&typeof d!="symbol";break;case"muted":t.muted=d&&typeof d!="function"&&typeof d!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(d==null||typeof d=="function"||typeof d=="boolean"||typeof d=="symbol"){t.removeAttribute("xlink:href");break}o=or(""+d),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":d!=null&&typeof d!="function"&&typeof d!="symbol"?t.setAttribute(o,""+d):t.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":d&&typeof d!="function"&&typeof d!="symbol"?t.setAttribute(o,""):t.removeAttribute(o);break;case"capture":case"download":d===!0?t.setAttribute(o,""):d!==!1&&d!=null&&typeof d!="function"&&typeof d!="symbol"?t.setAttribute(o,d):t.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":d!=null&&typeof d!="function"&&typeof d!="symbol"&&!isNaN(d)&&1<=d?t.setAttribute(o,d):t.removeAttribute(o);break;case"rowSpan":case"start":d==null||typeof d=="function"||typeof d=="symbol"||isNaN(d)?t.removeAttribute(o):t.setAttribute(o,d);break;case"popover":Qt("beforetoggle",t),Qt("toggle",t),$r(t,"popover",d);break;case"xlinkActuate":Pr(t,"http://www.w3.org/1999/xlink","xlink:actuate",d);break;case"xlinkArcrole":Pr(t,"http://www.w3.org/1999/xlink","xlink:arcrole",d);break;case"xlinkRole":Pr(t,"http://www.w3.org/1999/xlink","xlink:role",d);break;case"xlinkShow":Pr(t,"http://www.w3.org/1999/xlink","xlink:show",d);break;case"xlinkTitle":Pr(t,"http://www.w3.org/1999/xlink","xlink:title",d);break;case"xlinkType":Pr(t,"http://www.w3.org/1999/xlink","xlink:type",d);break;case"xmlBase":Pr(t,"http://www.w3.org/XML/1998/namespace","xml:base",d);break;case"xmlLang":Pr(t,"http://www.w3.org/XML/1998/namespace","xml:lang",d);break;case"xmlSpace":Pr(t,"http://www.w3.org/XML/1998/namespace","xml:space",d);break;case"is":$r(t,"is",d);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=Zr.get(o)||o,$r(t,o,d))}}function mf(t,i,o,d,g,x){switch(o){case"style":Yn(t,d,x);break;case"dangerouslySetInnerHTML":if(d!=null){if(typeof d!="object"||!("__html"in d))throw Error(a(61));if(o=d.__html,o!=null){if(g.children!=null)throw Error(a(60));t.innerHTML=o}}break;case"children":typeof d=="string"?Rt(t,d):(typeof d=="number"||typeof d=="bigint")&&Rt(t,""+d);break;case"onScroll":d!=null&&Qt("scroll",t);break;case"onScrollEnd":d!=null&&Qt("scrollend",t);break;case"onClick":d!=null&&(t.onclick=vr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$t.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(g=o.endsWith("Capture"),i=o.slice(2,g?o.length-7:void 0),x=t[te]||null,x=x!=null?x[o]:null,typeof x=="function"&&t.removeEventListener(i,x,g),typeof d=="function")){typeof x!="function"&&x!==null&&(o in t?t[o]=null:t.hasAttribute(o)&&t.removeAttribute(o)),t.addEventListener(i,d,g);break e}o in t?t[o]=d:d===!0?t.setAttribute(o,""):$r(t,o,d)}}}function Sr(t,i,o){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qt("error",t),Qt("load",t);var d=!1,g=!1,x;for(x in o)if(o.hasOwnProperty(x)){var O=o[x];if(O!=null)switch(x){case"src":d=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,i));default:_n(t,i,x,O,o,null)}}g&&_n(t,i,"srcSet",o.srcSet,o,null),d&&_n(t,i,"src",o.src,o,null);return;case"input":Qt("invalid",t);var G=x=O=g=null,pe=null,De=null;for(d in o)if(o.hasOwnProperty(d)){var qe=o[d];if(qe!=null)switch(d){case"name":g=qe;break;case"type":O=qe;break;case"checked":pe=qe;break;case"defaultChecked":De=qe;break;case"value":x=qe;break;case"defaultValue":G=qe;break;case"children":case"dangerouslySetInnerHTML":if(qe!=null)throw Error(a(137,i));break;default:_n(t,i,d,qe,o,null)}}Dt(t,x,G,pe,De,O,g,!1);return;case"select":Qt("invalid",t),d=O=x=null;for(g in o)if(o.hasOwnProperty(g)&&(G=o[g],G!=null))switch(g){case"value":x=G;break;case"defaultValue":O=G;break;case"multiple":d=G;default:_n(t,i,g,G,o,null)}i=x,o=O,t.multiple=!!d,i!=null?En(t,!!d,i,!1):o!=null&&En(t,!!d,o,!0);return;case"textarea":Qt("invalid",t),x=g=d=null;for(O in o)if(o.hasOwnProperty(O)&&(G=o[O],G!=null))switch(O){case"value":d=G;break;case"defaultValue":g=G;break;case"children":x=G;break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(a(91));break;default:_n(t,i,O,G,o,null)}ar(t,d,g,x);return;case"option":for(pe in o)o.hasOwnProperty(pe)&&(d=o[pe],d!=null)&&(pe==="selected"?t.selected=d&&typeof d!="function"&&typeof d!="symbol":_n(t,i,pe,d,o,null));return;case"dialog":Qt("beforetoggle",t),Qt("toggle",t),Qt("cancel",t),Qt("close",t);break;case"iframe":case"object":Qt("load",t);break;case"video":case"audio":for(d=0;d<Tl.length;d++)Qt(Tl[d],t);break;case"image":Qt("error",t),Qt("load",t);break;case"details":Qt("toggle",t);break;case"embed":case"source":case"link":Qt("error",t),Qt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(De in o)if(o.hasOwnProperty(De)&&(d=o[De],d!=null))switch(De){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,i));default:_n(t,i,De,d,o,null)}return;default:if(Xr(i)){for(qe in o)o.hasOwnProperty(qe)&&(d=o[qe],d!==void 0&&mf(t,i,qe,d,o,void 0));return}}for(G in o)o.hasOwnProperty(G)&&(d=o[G],d!=null&&_n(t,i,G,d,o,null))}function A_(t,i,o,d){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,x=null,O=null,G=null,pe=null,De=null,qe=null;for($e in o){var He=o[$e];if(o.hasOwnProperty($e)&&He!=null)switch($e){case"checked":break;case"value":break;case"defaultValue":pe=He;default:d.hasOwnProperty($e)||_n(t,i,$e,null,d,He)}}for(var Me in d){var $e=d[Me];if(He=o[Me],d.hasOwnProperty(Me)&&($e!=null||He!=null))switch(Me){case"type":x=$e;break;case"name":g=$e;break;case"checked":De=$e;break;case"defaultChecked":qe=$e;break;case"value":O=$e;break;case"defaultValue":G=$e;break;case"children":case"dangerouslySetInnerHTML":if($e!=null)throw Error(a(137,i));break;default:$e!==He&&_n(t,i,Me,$e,d,He)}}mt(t,O,G,pe,De,qe,x,g);return;case"select":$e=O=G=Me=null;for(x in o)if(pe=o[x],o.hasOwnProperty(x)&&pe!=null)switch(x){case"value":break;case"multiple":$e=pe;default:d.hasOwnProperty(x)||_n(t,i,x,null,d,pe)}for(g in d)if(x=d[g],pe=o[g],d.hasOwnProperty(g)&&(x!=null||pe!=null))switch(g){case"value":Me=x;break;case"defaultValue":G=x;break;case"multiple":O=x;default:x!==pe&&_n(t,i,g,x,d,pe)}i=G,o=O,d=$e,Me!=null?En(t,!!o,Me,!1):!!d!=!!o&&(i!=null?En(t,!!o,i,!0):En(t,!!o,o?[]:"",!1));return;case"textarea":$e=Me=null;for(G in o)if(g=o[G],o.hasOwnProperty(G)&&g!=null&&!d.hasOwnProperty(G))switch(G){case"value":break;case"children":break;default:_n(t,i,G,null,d,g)}for(O in d)if(g=d[O],x=o[O],d.hasOwnProperty(O)&&(g!=null||x!=null))switch(O){case"value":Me=g;break;case"defaultValue":$e=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(a(91));break;default:g!==x&&_n(t,i,O,g,d,x)}An(t,Me,$e);return;case"option":for(var ut in o)Me=o[ut],o.hasOwnProperty(ut)&&Me!=null&&!d.hasOwnProperty(ut)&&(ut==="selected"?t.selected=!1:_n(t,i,ut,null,d,Me));for(pe in d)Me=d[pe],$e=o[pe],d.hasOwnProperty(pe)&&Me!==$e&&(Me!=null||$e!=null)&&(pe==="selected"?t.selected=Me&&typeof Me!="function"&&typeof Me!="symbol":_n(t,i,pe,Me,d,$e));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ct in o)Me=o[Ct],o.hasOwnProperty(Ct)&&Me!=null&&!d.hasOwnProperty(Ct)&&_n(t,i,Ct,null,d,Me);for(De in d)if(Me=d[De],$e=o[De],d.hasOwnProperty(De)&&Me!==$e&&(Me!=null||$e!=null))switch(De){case"children":case"dangerouslySetInnerHTML":if(Me!=null)throw Error(a(137,i));break;default:_n(t,i,De,Me,d,$e)}return;default:if(Xr(i)){for(var Sn in o)Me=o[Sn],o.hasOwnProperty(Sn)&&Me!==void 0&&!d.hasOwnProperty(Sn)&&mf(t,i,Sn,void 0,d,Me);for(qe in d)Me=d[qe],$e=o[qe],!d.hasOwnProperty(qe)||Me===$e||Me===void 0&&$e===void 0||mf(t,i,qe,Me,d,$e);return}}for(var ke in o)Me=o[ke],o.hasOwnProperty(ke)&&Me!=null&&!d.hasOwnProperty(ke)&&_n(t,i,ke,null,d,Me);for(He in d)Me=d[He],$e=o[He],!d.hasOwnProperty(He)||Me===$e||Me==null&&$e==null||_n(t,i,He,Me,d,$e)}function uv(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function T_(){if(typeof performance.getEntriesByType=="function"){for(var t=0,i=0,o=performance.getEntriesByType("resource"),d=0;d<o.length;d++){var g=o[d],x=g.transferSize,O=g.initiatorType,G=g.duration;if(x&&G&&uv(O)){for(O=0,G=g.responseEnd,d+=1;d<o.length;d++){var pe=o[d],De=pe.startTime;if(De>G)break;var qe=pe.transferSize,He=pe.initiatorType;qe&&uv(He)&&(pe=pe.responseEnd,O+=qe*(pe<G?1:(G-De)/(pe-De)))}if(--d,i+=8*(x+O)/(g.duration/1e3),t++,10<t)break}}if(0<t)return i/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var gf=null,yf=null;function gu(t){return t.nodeType===9?t:t.ownerDocument}function dv(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hv(t,i){if(t===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&i==="foreignObject"?0:t}function vf(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var xf=null;function R_(){var t=window.event;return t&&t.type==="popstate"?t===xf?!1:(xf=t,!0):(xf=null,!1)}var fv=typeof setTimeout=="function"?setTimeout:void 0,O_=typeof clearTimeout=="function"?clearTimeout:void 0,pv=typeof Promise=="function"?Promise:void 0,D_=typeof queueMicrotask=="function"?queueMicrotask:typeof pv<"u"?function(t){return pv.resolve(null).then(t).catch(z_)}:fv;function z_(t){setTimeout(function(){throw t})}function Bi(t){return t==="head"}function mv(t,i){var o=i,d=0;do{var g=o.nextSibling;if(t.removeChild(o),g&&g.nodeType===8)if(o=g.data,o==="/$"||o==="/&"){if(d===0){t.removeChild(g),go(i);return}d--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")d++;else if(o==="html")Ol(t.ownerDocument.documentElement);else if(o==="head"){o=t.ownerDocument.head,Ol(o);for(var x=o.firstChild;x;){var O=x.nextSibling,G=x.nodeName;x[xe]||G==="SCRIPT"||G==="STYLE"||G==="LINK"&&x.rel.toLowerCase()==="stylesheet"||o.removeChild(x),x=O}}else o==="body"&&Ol(t.ownerDocument.body);o=g}while(o);go(i)}function gv(t,i){var o=t;t=0;do{var d=o.nextSibling;if(o.nodeType===1?i?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(i?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(t===0)break;t--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||t++;o=d}while(o)}function bf(t){var i=t.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var o=i;switch(i=i.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":bf(o),Ne(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}t.removeChild(o)}}function M_(t,i,o,d){for(;t.nodeType===1;){var g=o;if(t.nodeName.toLowerCase()!==i.toLowerCase()){if(!d&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(d){if(!t[xe])switch(i){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(x=t.getAttribute("rel"),x==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(x!==g.rel||t.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||t.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||t.getAttribute("title")!==(g.title==null?null:g.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(x=t.getAttribute("src"),(x!==(g.src==null?null:g.src)||t.getAttribute("type")!==(g.type==null?null:g.type)||t.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&x&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(i==="input"&&t.type==="hidden"){var x=g.name==null?null:""+g.name;if(g.type==="hidden"&&t.getAttribute("name")===x)return t}else return t;if(t=os(t.nextSibling),t===null)break}return null}function L_(t,i,o){if(i==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!o||(t=os(t.nextSibling),t===null))return null;return t}function yv(t,i){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!i||(t=os(t.nextSibling),t===null))return null;return t}function wf(t){return t.data==="$?"||t.data==="$~"}function _f(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function U_(t,i){var o=t.ownerDocument;if(t.data==="$~")t._reactRetry=i;else if(t.data!=="$?"||o.readyState!=="loading")i();else{var d=function(){i(),o.removeEventListener("DOMContentLoaded",d)};o.addEventListener("DOMContentLoaded",d),t._reactRetry=d}}function os(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return t}var Sf=null;function vv(t){t=t.nextSibling;for(var i=0;t;){if(t.nodeType===8){var o=t.data;if(o==="/$"||o==="/&"){if(i===0)return os(t.nextSibling);i--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||i++}t=t.nextSibling}return null}function xv(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(i===0)return t;i--}else o!=="/$"&&o!=="/&"||i++}t=t.previousSibling}return null}function bv(t,i,o){switch(i=gu(o),t){case"html":if(t=i.documentElement,!t)throw Error(a(452));return t;case"head":if(t=i.head,!t)throw Error(a(453));return t;case"body":if(t=i.body,!t)throw Error(a(454));return t;default:throw Error(a(451))}}function Ol(t){for(var i=t.attributes;i.length;)t.removeAttributeNode(i[0]);Ne(t)}var ls=new Map,wv=new Set;function yu(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var ii=B.d;B.d={f:I_,r:B_,D:$_,C:P_,L:q_,m:F_,X:V_,S:H_,M:G_};function I_(){var t=ii.f(),i=lu();return t||i}function B_(t){var i=tt(t);i!==null&&i.tag===5&&i.type==="form"?Ig(i):ii.r(t)}var fo=typeof document>"u"?null:document;function _v(t,i,o){var d=fo;if(d&&typeof i=="string"&&i){var g=rt(i);g='link[rel="'+t+'"][href="'+g+'"]',typeof o=="string"&&(g+='[crossorigin="'+o+'"]'),wv.has(g)||(wv.add(g),t={rel:t,crossOrigin:o,href:i},d.querySelector(g)===null&&(i=d.createElement("link"),Sr(i,"link",t),lt(i),d.head.appendChild(i)))}}function $_(t){ii.D(t),_v("dns-prefetch",t,null)}function P_(t,i){ii.C(t,i),_v("preconnect",t,i)}function q_(t,i,o){ii.L(t,i,o);var d=fo;if(d&&t&&i){var g='link[rel="preload"][as="'+rt(i)+'"]';i==="image"&&o&&o.imageSrcSet?(g+='[imagesrcset="'+rt(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(g+='[imagesizes="'+rt(o.imageSizes)+'"]')):g+='[href="'+rt(t)+'"]';var x=g;switch(i){case"style":x=po(t);break;case"script":x=mo(t)}ls.has(x)||(t=y({rel:"preload",href:i==="image"&&o&&o.imageSrcSet?void 0:t,as:i},o),ls.set(x,t),d.querySelector(g)!==null||i==="style"&&d.querySelector(Dl(x))||i==="script"&&d.querySelector(zl(x))||(i=d.createElement("link"),Sr(i,"link",t),lt(i),d.head.appendChild(i)))}}function F_(t,i){ii.m(t,i);var o=fo;if(o&&t){var d=i&&typeof i.as=="string"?i.as:"script",g='link[rel="modulepreload"][as="'+rt(d)+'"][href="'+rt(t)+'"]',x=g;switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=mo(t)}if(!ls.has(x)&&(t=y({rel:"modulepreload",href:t},i),ls.set(x,t),o.querySelector(g)===null)){switch(d){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(zl(x)))return}d=o.createElement("link"),Sr(d,"link",t),lt(d),o.head.appendChild(d)}}}function H_(t,i,o){ii.S(t,i,o);var d=fo;if(d&&t){var g=Xe(d).hoistableStyles,x=po(t);i=i||"default";var O=g.get(x);if(!O){var G={loading:0,preload:null};if(O=d.querySelector(Dl(x)))G.loading=5;else{t=y({rel:"stylesheet",href:t,"data-precedence":i},o),(o=ls.get(x))&&jf(t,o);var pe=O=d.createElement("link");lt(pe),Sr(pe,"link",t),pe._p=new Promise(function(De,qe){pe.onload=De,pe.onerror=qe}),pe.addEventListener("load",function(){G.loading|=1}),pe.addEventListener("error",function(){G.loading|=2}),G.loading|=4,vu(O,i,d)}O={type:"stylesheet",instance:O,count:1,state:G},g.set(x,O)}}}function V_(t,i){ii.X(t,i);var o=fo;if(o&&t){var d=Xe(o).hoistableScripts,g=mo(t),x=d.get(g);x||(x=o.querySelector(zl(g)),x||(t=y({src:t,async:!0},i),(i=ls.get(g))&&Cf(t,i),x=o.createElement("script"),lt(x),Sr(x,"link",t),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(g,x))}}function G_(t,i){ii.M(t,i);var o=fo;if(o&&t){var d=Xe(o).hoistableScripts,g=mo(t),x=d.get(g);x||(x=o.querySelector(zl(g)),x||(t=y({src:t,async:!0,type:"module"},i),(i=ls.get(g))&&Cf(t,i),x=o.createElement("script"),lt(x),Sr(x,"link",t),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},d.set(g,x))}}function Sv(t,i,o,d){var g=(g=Ce.current)?yu(g):null;if(!g)throw Error(a(446));switch(t){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(i=po(o.href),o=Xe(g).hoistableStyles,d=o.get(i),d||(d={type:"style",instance:null,count:0,state:null},o.set(i,d)),d):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){t=po(o.href);var x=Xe(g).hoistableStyles,O=x.get(t);if(O||(g=g.ownerDocument||g,O={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(t,O),(x=g.querySelector(Dl(t)))&&!x._p&&(O.instance=x,O.state.loading=5),ls.has(t)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},ls.set(t,o),x||W_(g,t,o,O.state))),i&&d===null)throw Error(a(528,""));return O}if(i&&d!==null)throw Error(a(529,""));return null;case"script":return i=o.async,o=o.src,typeof o=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=mo(o),o=Xe(g).hoistableScripts,d=o.get(i),d||(d={type:"script",instance:null,count:0,state:null},o.set(i,d)),d):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,t))}}function po(t){return'href="'+rt(t)+'"'}function Dl(t){return'link[rel="stylesheet"]['+t+"]"}function jv(t){return y({},t,{"data-precedence":t.precedence,precedence:null})}function W_(t,i,o,d){t.querySelector('link[rel="preload"][as="style"]['+i+"]")?d.loading=1:(i=t.createElement("link"),d.preload=i,i.addEventListener("load",function(){return d.loading|=1}),i.addEventListener("error",function(){return d.loading|=2}),Sr(i,"link",o),lt(i),t.head.appendChild(i))}function mo(t){return'[src="'+rt(t)+'"]'}function zl(t){return"script[async]"+t}function Cv(t,i,o){if(i.count++,i.instance===null)switch(i.type){case"style":var d=t.querySelector('style[data-href~="'+rt(o.href)+'"]');if(d)return i.instance=d,lt(d),d;var g=y({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return d=(t.ownerDocument||t).createElement("style"),lt(d),Sr(d,"style",g),vu(d,o.precedence,t),i.instance=d;case"stylesheet":g=po(o.href);var x=t.querySelector(Dl(g));if(x)return i.state.loading|=4,i.instance=x,lt(x),x;d=jv(o),(g=ls.get(g))&&jf(d,g),x=(t.ownerDocument||t).createElement("link"),lt(x);var O=x;return O._p=new Promise(function(G,pe){O.onload=G,O.onerror=pe}),Sr(x,"link",d),i.state.loading|=4,vu(x,o.precedence,t),i.instance=x;case"script":return x=mo(o.src),(g=t.querySelector(zl(x)))?(i.instance=g,lt(g),g):(d=o,(g=ls.get(x))&&(d=y({},o),Cf(d,g)),t=t.ownerDocument||t,g=t.createElement("script"),lt(g),Sr(g,"link",d),t.head.appendChild(g),i.instance=g);case"void":return null;default:throw Error(a(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(d=i.instance,i.state.loading|=4,vu(d,o.precedence,t));return i.instance}function vu(t,i,o){for(var d=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=d.length?d[d.length-1]:null,x=g,O=0;O<d.length;O++){var G=d[O];if(G.dataset.precedence===i)x=G;else if(x!==g)break}x?x.parentNode.insertBefore(t,x.nextSibling):(i=o.nodeType===9?o.head:o,i.insertBefore(t,i.firstChild))}function jf(t,i){t.crossOrigin==null&&(t.crossOrigin=i.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=i.referrerPolicy),t.title==null&&(t.title=i.title)}function Cf(t,i){t.crossOrigin==null&&(t.crossOrigin=i.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=i.referrerPolicy),t.integrity==null&&(t.integrity=i.integrity)}var xu=null;function kv(t,i,o){if(xu===null){var d=new Map,g=xu=new Map;g.set(o,d)}else g=xu,d=g.get(o),d||(d=new Map,g.set(o,d));if(d.has(t))return d;for(d.set(t,null),o=o.getElementsByTagName(t),g=0;g<o.length;g++){var x=o[g];if(!(x[xe]||x[nt]||t==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var O=x.getAttribute(i)||"";O=t+O;var G=d.get(O);G?G.push(x):d.set(O,[x])}}return d}function Nv(t,i,o){t=t.ownerDocument||t,t.head.insertBefore(o,i==="title"?t.querySelector("head > title"):null)}function K_(t,i,o){if(o===1||i.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;return i.rel==="stylesheet"?(t=i.disabled,typeof i.precedence=="string"&&t==null):!0;case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function Ev(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function Y_(t,i,o,d){if(o.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=po(d.href),x=i.querySelector(Dl(g));if(x){i=x._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(t.count++,t=bu.bind(t),i.then(t,t)),o.state.loading|=4,o.instance=x,lt(x);return}x=i.ownerDocument||i,d=jv(d),(g=ls.get(g))&&jf(d,g),x=x.createElement("link"),lt(x);var O=x;O._p=new Promise(function(G,pe){O.onload=G,O.onerror=pe}),Sr(x,"link",d),o.instance=x}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(o,i),(i=o.state.preload)&&(o.state.loading&3)===0&&(t.count++,o=bu.bind(t),i.addEventListener("load",o),i.addEventListener("error",o))}}var kf=0;function Q_(t,i){return t.stylesheets&&t.count===0&&_u(t,t.stylesheets),0<t.count||0<t.imgCount?function(o){var d=setTimeout(function(){if(t.stylesheets&&_u(t,t.stylesheets),t.unsuspend){var x=t.unsuspend;t.unsuspend=null,x()}},6e4+i);0<t.imgBytes&&kf===0&&(kf=62500*T_());var g=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&_u(t,t.stylesheets),t.unsuspend)){var x=t.unsuspend;t.unsuspend=null,x()}},(t.imgBytes>kf?50:800)+i);return t.unsuspend=o,function(){t.unsuspend=null,clearTimeout(d),clearTimeout(g)}}:null}function bu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)_u(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var wu=null;function _u(t,i){t.stylesheets=null,t.unsuspend!==null&&(t.count++,wu=new Map,i.forEach(J_,t),wu=null,bu.call(t))}function J_(t,i){if(!(i.state.loading&4)){var o=wu.get(t);if(o)var d=o.get(null);else{o=new Map,wu.set(t,o);for(var g=t.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<g.length;x++){var O=g[x];(O.nodeName==="LINK"||O.getAttribute("media")!=="not all")&&(o.set(O.dataset.precedence,O),d=O)}d&&o.set(null,d)}g=i.instance,O=g.getAttribute("data-precedence"),x=o.get(O)||d,x===d&&o.set(null,g),o.set(O,g),this.count++,d=bu.bind(this),g.addEventListener("load",d),g.addEventListener("error",d),x?x.parentNode.insertBefore(g,x.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(g,t.firstChild)),i.state.loading|=4}}var Ml={$$typeof:T,Provider:null,Consumer:null,_currentValue:K,_currentValue2:K,_threadCount:0};function X_(t,i,o,d,g,x,O,G,pe){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=gn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gn(0),this.hiddenUpdates=gn(null),this.identifierPrefix=d,this.onUncaughtError=g,this.onCaughtError=x,this.onRecoverableError=O,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=pe,this.incompleteTransitions=new Map}function Av(t,i,o,d,g,x,O,G,pe,De,qe,He){return t=new X_(t,i,o,O,pe,De,qe,He,G),i=1,x===!0&&(i|=24),x=Fr(3,null,null,i),t.current=x,x.stateNode=t,i=sh(),i.refCount++,t.pooledCache=i,i.refCount++,x.memoizedState={element:d,isDehydrated:o,cache:i},lh(x),t}function Tv(t){return t?(t=Va,t):Va}function Rv(t,i,o,d,g,x){g=Tv(g),d.context===null?d.context=g:d.pendingContext=g,d=Ei(i),d.payload={element:o},x=x===void 0?null:x,x!==null&&(d.callback=x),o=Ai(t,d,i),o!==null&&(Ur(o,t,i),fl(o,t,i))}function Ov(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<i?o:i}}function Nf(t,i){Ov(t,i),(t=t.alternate)&&Ov(t,i)}function Dv(t){if(t.tag===13||t.tag===31){var i=ca(t,67108864);i!==null&&Ur(i,t,67108864),Nf(t,67108864)}}function zv(t){if(t.tag===13||t.tag===31){var i=Kr();i=It(i);var o=ca(t,i);o!==null&&Ur(o,t,i),Nf(t,i)}}var Su=!0;function Z_(t,i,o,d){var g=z.T;z.T=null;var x=B.p;try{B.p=2,Ef(t,i,o,d)}finally{B.p=x,z.T=g}}function eS(t,i,o,d){var g=z.T;z.T=null;var x=B.p;try{B.p=8,Ef(t,i,o,d)}finally{B.p=x,z.T=g}}function Ef(t,i,o,d){if(Su){var g=Af(d);if(g===null)pf(t,i,d,ju,o),Lv(t,d);else if(nS(g,t,i,o,d))d.stopPropagation();else if(Lv(t,d),i&4&&-1<tS.indexOf(t)){for(;g!==null;){var x=tt(g);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var O=jt(x.pendingLanes);if(O!==0){var G=x;for(G.pendingLanes|=2,G.entangledLanes|=2;O;){var pe=1<<31-wt(O);G.entanglements[1]|=pe,O&=~pe}Is(x),(pn&6)===0&&(au=Be()+500,Al(0))}}break;case 31:case 13:G=ca(x,2),G!==null&&Ur(G,x,2),lu(),Nf(x,2)}if(x=Af(d),x===null&&pf(t,i,d,ju,o),x===g)break;g=x}g!==null&&d.stopPropagation()}else pf(t,i,d,null,o)}}function Af(t){return t=sa(t),Tf(t)}var ju=null;function Tf(t){if(ju=null,t=Ke(t),t!==null){var i=c(t);if(i===null)t=null;else{var o=i.tag;if(o===13){if(t=u(i),t!==null)return t;t=null}else if(o===31){if(t=h(i),t!==null)return t;t=null}else if(o===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null)}}return ju=t,null}function Mv(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Re()){case Pe:return 2;case Je:return 8;case We:case Et:return 32;case Wt:return 268435456;default:return 32}default:return 32}}var Rf=!1,$i=null,Pi=null,qi=null,Ll=new Map,Ul=new Map,Fi=[],tS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Lv(t,i){switch(t){case"focusin":case"focusout":$i=null;break;case"dragenter":case"dragleave":Pi=null;break;case"mouseover":case"mouseout":qi=null;break;case"pointerover":case"pointerout":Ll.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ul.delete(i.pointerId)}}function Il(t,i,o,d,g,x){return t===null||t.nativeEvent!==x?(t={blockedOn:i,domEventName:o,eventSystemFlags:d,nativeEvent:x,targetContainers:[g]},i!==null&&(i=tt(i),i!==null&&Dv(i)),t):(t.eventSystemFlags|=d,i=t.targetContainers,g!==null&&i.indexOf(g)===-1&&i.push(g),t)}function nS(t,i,o,d,g){switch(i){case"focusin":return $i=Il($i,t,i,o,d,g),!0;case"dragenter":return Pi=Il(Pi,t,i,o,d,g),!0;case"mouseover":return qi=Il(qi,t,i,o,d,g),!0;case"pointerover":var x=g.pointerId;return Ll.set(x,Il(Ll.get(x)||null,t,i,o,d,g)),!0;case"gotpointercapture":return x=g.pointerId,Ul.set(x,Il(Ul.get(x)||null,t,i,o,d,g)),!0}return!1}function Uv(t){var i=Ke(t.target);if(i!==null){var o=c(i);if(o!==null){if(i=o.tag,i===13){if(i=u(o),i!==null){t.blockedOn=i,fn(t.priority,function(){zv(o)});return}}else if(i===31){if(i=h(o),i!==null){t.blockedOn=i,fn(t.priority,function(){zv(o)});return}}else if(i===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Cu(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var o=Af(t.nativeEvent);if(o===null){o=t.nativeEvent;var d=new o.constructor(o.type,o);Ds=d,o.target.dispatchEvent(d),Ds=null}else return i=tt(o),i!==null&&Dv(i),t.blockedOn=o,!1;i.shift()}return!0}function Iv(t,i,o){Cu(t)&&o.delete(i)}function rS(){Rf=!1,$i!==null&&Cu($i)&&($i=null),Pi!==null&&Cu(Pi)&&(Pi=null),qi!==null&&Cu(qi)&&(qi=null),Ll.forEach(Iv),Ul.forEach(Iv)}function ku(t,i){t.blockedOn===i&&(t.blockedOn=null,Rf||(Rf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,rS)))}var Nu=null;function Bv(t){Nu!==t&&(Nu=t,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Nu===t&&(Nu=null);for(var i=0;i<t.length;i+=3){var o=t[i],d=t[i+1],g=t[i+2];if(typeof d!="function"){if(Tf(d||o)===null)continue;break}var x=tt(o);x!==null&&(t.splice(i,3),i-=3,Eh(x,{pending:!0,data:g,method:o.method,action:d},d,g))}}))}function go(t){function i(pe){return ku(pe,t)}$i!==null&&ku($i,t),Pi!==null&&ku(Pi,t),qi!==null&&ku(qi,t),Ll.forEach(i),Ul.forEach(i);for(var o=0;o<Fi.length;o++){var d=Fi[o];d.blockedOn===t&&(d.blockedOn=null)}for(;0<Fi.length&&(o=Fi[0],o.blockedOn===null);)Uv(o),o.blockedOn===null&&Fi.shift();if(o=(t.ownerDocument||t).$$reactFormReplay,o!=null)for(d=0;d<o.length;d+=3){var g=o[d],x=o[d+1],O=g[te]||null;if(typeof x=="function")O||Bv(o);else if(O){var G=null;if(x&&x.hasAttribute("formAction")){if(g=x,O=x[te]||null)G=O.formAction;else if(Tf(g)!==null)continue}else G=O.action;typeof G=="function"?o[d+1]=G:(o.splice(d,3),d-=3),Bv(o)}}}function $v(){function t(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(O){return g=O})},focusReset:"manual",scroll:"manual"})}function i(){g!==null&&(g(),g=null),d||setTimeout(o,20)}function o(){if(!d&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var d=!1,g=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(o,100),function(){d=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),g!==null&&(g(),g=null)}}}function Of(t){this._internalRoot=t}Eu.prototype.render=Of.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(a(409));var o=i.current,d=Kr();Rv(o,d,t,i,null,null)},Eu.prototype.unmount=Of.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;Rv(t.current,2,null,t,null,null),lu(),i[ze]=null}};function Eu(t){this._internalRoot=t}Eu.prototype.unstable_scheduleHydration=function(t){if(t){var i=qn();t={blockedOn:null,target:t,priority:i};for(var o=0;o<Fi.length&&i!==0&&i<Fi[o].priority;o++);Fi.splice(o,0,t),o===0&&Uv(t)}};var Pv=e.version;if(Pv!=="19.2.3")throw Error(a(527,Pv,"19.2.3"));B.findDOMNode=function(t){var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(a(188)):(t=Object.keys(t).join(","),Error(a(268,t)));return t=p(i),t=t!==null?m(t):null,t=t===null?null:t.stateNode,t};var sS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Au=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Au.isDisabled&&Au.supportsFiber)try{ft=Au.inject(sS),Tt=Au}catch{}}return $l.createRoot=function(t,i){if(!l(t))throw Error(a(299));var o=!1,d="",g=Kg,x=Yg,O=Qg;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onUncaughtError!==void 0&&(g=i.onUncaughtError),i.onCaughtError!==void 0&&(x=i.onCaughtError),i.onRecoverableError!==void 0&&(O=i.onRecoverableError)),i=Av(t,1,!1,null,null,o,d,null,g,x,O,$v),t[ze]=i.current,ff(t),new Of(i)},$l.hydrateRoot=function(t,i,o){if(!l(t))throw Error(a(299));var d=!1,g="",x=Kg,O=Yg,G=Qg,pe=null;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&(O=o.onCaughtError),o.onRecoverableError!==void 0&&(G=o.onRecoverableError),o.formState!==void 0&&(pe=o.formState)),i=Av(t,1,!0,i,o??null,d,g,pe,x,O,G,$v),i.context=Tv(null),o=i.current,d=Kr(),d=It(d),g=Ei(d),g.callback=null,Ai(o,g,d),o=d,i.current.lanes=o,hn(i,o),Is(i),t[ze]=i.current,ff(t),new Eu(i)},$l.version="19.2.3",$l}var Jv;function fS(){if(Jv)return Mf.exports;Jv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Mf.exports=hS(),Mf.exports}var pS=fS();var Xv="popstate";function mS(n={}){function e(a,l){let{pathname:c,search:u,hash:h}=a.location;return jp("",{pathname:c,search:u,hash:h},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function s(a,l){return typeof l=="string"?l:ic(l)}return yS(e,s,null,n)}function hr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function fs(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function gS(){return Math.random().toString(36).substring(2,10)}function Zv(n,e){return{usr:n.state,key:n.key,idx:e}}function jp(n,e,s=null,a){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?yc(e):e,state:s,key:e&&e.key||a||gS()}}function ic({pathname:n="/",search:e="",hash:s=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),s&&s!=="#"&&(n+=s.charAt(0)==="#"?s:"#"+s),n}function yc(n){let e={};if(n){let s=n.indexOf("#");s>=0&&(e.hash=n.substring(s),n=n.substring(0,s));let a=n.indexOf("?");a>=0&&(e.search=n.substring(a),n=n.substring(0,a)),n&&(e.pathname=n)}return e}function yS(n,e,s,a={}){let{window:l=document.defaultView,v5Compat:c=!1}=a,u=l.history,h="POP",f=null,p=m();p==null&&(p=0,u.replaceState({...u.state,idx:p},""));function m(){return(u.state||{idx:null}).idx}function y(){h="POP";let w=m(),j=w==null?null:w-p;p=w,f&&f({action:h,location:_.location,delta:j})}function b(w,j){h="PUSH";let N=jp(_.location,w,j);p=m()+1;let T=Zv(N,p),R=_.createHref(N);try{u.pushState(T,"",R)}catch($){if($ instanceof DOMException&&$.name==="DataCloneError")throw $;l.location.assign(R)}c&&f&&f({action:h,location:_.location,delta:1})}function v(w,j){h="REPLACE";let N=jp(_.location,w,j);p=m();let T=Zv(N,p),R=_.createHref(N);u.replaceState(T,"",R),c&&f&&f({action:h,location:_.location,delta:0})}function S(w){return vS(w)}let _={get action(){return h},get location(){return n(l,u)},listen(w){if(f)throw new Error("A history only accepts one active listener");return l.addEventListener(Xv,y),f=w,()=>{l.removeEventListener(Xv,y),f=null}},createHref(w){return e(l,w)},createURL:S,encodeLocation(w){let j=S(w);return{pathname:j.pathname,search:j.search,hash:j.hash}},push:b,replace:v,go(w){return u.go(w)}};return _}function vS(n,e=!1){let s="http://localhost";typeof window<"u"&&(s=window.location.origin!=="null"?window.location.origin:window.location.href),hr(s,"No window.location.(origin|href) available to create URL");let a=typeof n=="string"?n:ic(n);return a=a.replace(/ $/,"%20"),!e&&a.startsWith("//")&&(a=s+a),new URL(a,s)}function $x(n,e,s="/"){return xS(n,e,s,!1)}function xS(n,e,s,a){let l=typeof e=="string"?yc(e):e,c=fi(l.pathname||"/",s);if(c==null)return null;let u=Px(n);bS(u);let h=null;for(let f=0;h==null&&f<u.length;++f){let p=RS(c);h=AS(u[f],p,a)}return h}function Px(n,e=[],s=[],a="",l=!1){let c=(u,h,f=l,p)=>{let m={relativePath:p===void 0?u.path||"":p,caseSensitive:u.caseSensitive===!0,childrenIndex:h,route:u};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(a)&&f)return;hr(m.relativePath.startsWith(a),`Absolute route path "${m.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(a.length)}let y=hi([a,m.relativePath]),b=s.concat(m);u.children&&u.children.length>0&&(hr(u.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${y}".`),Px(u.children,e,b,y,f)),!(u.path==null&&!u.index)&&e.push({path:y,score:NS(y,u.index),routesMeta:b})};return n.forEach((u,h)=>{if(u.path===""||!u.path?.includes("?"))c(u,h);else for(let f of qx(u.path))c(u,h,!0,f)}),e}function qx(n){let e=n.split("/");if(e.length===0)return[];let[s,...a]=e,l=s.endsWith("?"),c=s.replace(/\?$/,"");if(a.length===0)return l?[c,""]:[c];let u=qx(a.join("/")),h=[];return h.push(...u.map(f=>f===""?c:[c,f].join("/"))),l&&h.push(...u),h.map(f=>n.startsWith("/")&&f===""?"/":f)}function bS(n){n.sort((e,s)=>e.score!==s.score?s.score-e.score:ES(e.routesMeta.map(a=>a.childrenIndex),s.routesMeta.map(a=>a.childrenIndex)))}var wS=/^:[\w-]+$/,_S=3,SS=2,jS=1,CS=10,kS=-2,e0=n=>n==="*";function NS(n,e){let s=n.split("/"),a=s.length;return s.some(e0)&&(a+=kS),e&&(a+=SS),s.filter(l=>!e0(l)).reduce((l,c)=>l+(wS.test(c)?_S:c===""?jS:CS),a)}function ES(n,e){return n.length===e.length&&n.slice(0,-1).every((a,l)=>a===e[l])?n[n.length-1]-e[e.length-1]:0}function AS(n,e,s=!1){let{routesMeta:a}=n,l={},c="/",u=[];for(let h=0;h<a.length;++h){let f=a[h],p=h===a.length-1,m=c==="/"?e:e.slice(c.length)||"/",y=sd({path:f.relativePath,caseSensitive:f.caseSensitive,end:p},m),b=f.route;if(!y&&p&&s&&!a[a.length-1].route.index&&(y=sd({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},m)),!y)return null;Object.assign(l,y.params),u.push({params:l,pathname:hi([c,y.pathname]),pathnameBase:MS(hi([c,y.pathnameBase])),route:b}),y.pathnameBase!=="/"&&(c=hi([c,y.pathnameBase]))}return u}function sd(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,a]=TS(n.path,n.caseSensitive,n.end),l=e.match(s);if(!l)return null;let c=l[0],u=c.replace(/(.)\/+$/,"$1"),h=l.slice(1);return{params:a.reduce((p,{paramName:m,isOptional:y},b)=>{if(m==="*"){let S=h[b]||"";u=c.slice(0,c.length-S.length).replace(/(.)\/+$/,"$1")}const v=h[b];return y&&!v?p[m]=void 0:p[m]=(v||"").replace(/%2F/g,"/"),p},{}),pathname:c,pathnameBase:u,pattern:n}}function TS(n,e=!1,s=!0){fs(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let a=[],l="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,h,f)=>(a.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(a.push({paramName:"*"}),l+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?l+="\\/*$":n!==""&&n!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,e?void 0:"i"),a]}function RS(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return fs(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function fi(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let s=e.endsWith("/")?e.length-1:e.length,a=n.charAt(s);return a&&a!=="/"?null:n.slice(s)||"/"}var Fx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,OS=n=>Fx.test(n);function DS(n,e="/"){let{pathname:s,search:a="",hash:l=""}=typeof n=="string"?yc(n):n,c;if(s)if(OS(s))c=s;else{if(s.includes("//")){let u=s;s=s.replace(/\/\/+/g,"/"),fs(!1,`Pathnames cannot have embedded double slashes - normalizing ${u} -> ${s}`)}s.startsWith("/")?c=t0(s.substring(1),"/"):c=t0(s,e)}else c=e;return{pathname:c,search:LS(a),hash:US(l)}}function t0(n,e){let s=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(l=>{l===".."?s.length>1&&s.pop():l!=="."&&s.push(l)}),s.length>1?s.join("/"):"/"}function Bf(n,e,s,a){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function zS(n){return n.filter((e,s)=>s===0||e.route.path&&e.route.path.length>0)}function Hx(n){let e=zS(n);return e.map((s,a)=>a===e.length-1?s.pathname:s.pathnameBase)}function Vx(n,e,s,a=!1){let l;typeof n=="string"?l=yc(n):(l={...n},hr(!l.pathname||!l.pathname.includes("?"),Bf("?","pathname","search",l)),hr(!l.pathname||!l.pathname.includes("#"),Bf("#","pathname","hash",l)),hr(!l.search||!l.search.includes("#"),Bf("#","search","hash",l)));let c=n===""||l.pathname==="",u=c?"/":l.pathname,h;if(u==null)h=s;else{let y=e.length-1;if(!a&&u.startsWith("..")){let b=u.split("/");for(;b[0]==="..";)b.shift(),y-=1;l.pathname=b.join("/")}h=y>=0?e[y]:"/"}let f=DS(l,h),p=u&&u!=="/"&&u.endsWith("/"),m=(c||u===".")&&s.endsWith("/");return!f.pathname.endsWith("/")&&(p||m)&&(f.pathname+="/"),f}var hi=n=>n.join("/").replace(/\/\/+/g,"/"),MS=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),LS=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,US=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,IS=class{constructor(n,e,s,a=!1){this.status=n,this.statusText=e||"",this.internal=a,s instanceof Error?(this.data=s.toString(),this.error=s):this.data=s}};function BS(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function $S(n){return n.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Gx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Wx(n,e){let s=n;if(typeof s!="string"||!Fx.test(s))return{absoluteURL:void 0,isExternal:!1,to:s};let a=s,l=!1;if(Gx)try{let c=new URL(window.location.href),u=s.startsWith("//")?new URL(c.protocol+s):new URL(s),h=fi(u.pathname,e);u.origin===c.origin&&h!=null?s=h+u.search+u.hash:l=!0}catch{fs(!1,`<Link to="${s}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:l,to:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Kx=["POST","PUT","PATCH","DELETE"];new Set(Kx);var PS=["GET",...Kx];new Set(PS);var Vo=k.createContext(null);Vo.displayName="DataRouter";var wd=k.createContext(null);wd.displayName="DataRouterState";var qS=k.createContext(!1),Yx=k.createContext({isTransitioning:!1});Yx.displayName="ViewTransition";var FS=k.createContext(new Map);FS.displayName="Fetchers";var HS=k.createContext(null);HS.displayName="Await";var ps=k.createContext(null);ps.displayName="Navigation";var _d=k.createContext(null);_d.displayName="Location";var mi=k.createContext({outlet:null,matches:[],isDataRoute:!1});mi.displayName="Route";var Yp=k.createContext(null);Yp.displayName="RouteError";var Qx="REACT_ROUTER_ERROR",VS="REDIRECT",GS="ROUTE_ERROR_RESPONSE";function WS(n){if(n.startsWith(`${Qx}:${VS}:{`))try{let e=JSON.parse(n.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function KS(n){if(n.startsWith(`${Qx}:${GS}:{`))try{let e=JSON.parse(n.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new IS(e.status,e.statusText,e.data)}catch{}}function YS(n,{relative:e}={}){hr(vc(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:a}=k.useContext(ps),{hash:l,pathname:c,search:u}=xc(n,{relative:e}),h=c;return s!=="/"&&(h=c==="/"?s:hi([s,c])),a.createHref({pathname:h,search:u,hash:l})}function vc(){return k.useContext(_d)!=null}function gi(){return hr(vc(),"useLocation() may be used only in the context of a <Router> component."),k.useContext(_d).location}var Jx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Xx(n){k.useContext(ps).static||k.useLayoutEffect(n)}function Zx(){let{isDataRoute:n}=k.useContext(mi);return n?l1():QS()}function QS(){hr(vc(),"useNavigate() may be used only in the context of a <Router> component.");let n=k.useContext(Vo),{basename:e,navigator:s}=k.useContext(ps),{matches:a}=k.useContext(mi),{pathname:l}=gi(),c=JSON.stringify(Hx(a)),u=k.useRef(!1);return Xx(()=>{u.current=!0}),k.useCallback((f,p={})=>{if(fs(u.current,Jx),!u.current)return;if(typeof f=="number"){s.go(f);return}let m=Vx(f,JSON.parse(c),l,p.relative==="path");n==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:hi([e,m.pathname])),(p.replace?s.replace:s.push)(m,p.state,p)},[e,s,c,l,n])}k.createContext(null);function xc(n,{relative:e}={}){let{matches:s}=k.useContext(mi),{pathname:a}=gi(),l=JSON.stringify(Hx(s));return k.useMemo(()=>Vx(n,JSON.parse(l),a,e==="path"),[n,l,a,e])}function JS(n,e,s,a,l){hr(vc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:c}=k.useContext(ps),{matches:u}=k.useContext(mi),h=u[u.length-1],f=h?h.params:{},p=h?h.pathname:"/",m=h?h.pathnameBase:"/",y=h&&h.route;{let N=y&&y.path||"";tb(p,!y||N.endsWith("*")||N.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${N}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${N}"> to <Route path="${N==="/"?"*":`${N}/*`}">.`)}let b=gi(),v;v=b;let S=v.pathname||"/",_=S;if(m!=="/"){let N=m.replace(/^\//,"").split("/");_="/"+S.replace(/^\//,"").split("/").slice(N.length).join("/")}let w=$x(n,{pathname:_});return fs(y||w!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),fs(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),n1(w&&w.map(N=>Object.assign({},N,{params:Object.assign({},f,N.params),pathname:hi([m,c.encodeLocation?c.encodeLocation(N.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?m:hi([m,c.encodeLocation?c.encodeLocation(N.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:N.pathnameBase])})),u,s,a,l)}function XS(){let n=o1(),e=BS(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,a="rgba(200,200,200, 0.5)",l={padding:"0.5rem",backgroundColor:a},c={padding:"2px 4px",backgroundColor:a},u=null;return console.error("Error handled by React Router default ErrorBoundary:",n),u=k.createElement(k.Fragment,null,k.createElement("p",null," Hey developer "),k.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",k.createElement("code",{style:c},"ErrorBoundary")," or"," ",k.createElement("code",{style:c},"errorElement")," prop on your route.")),k.createElement(k.Fragment,null,k.createElement("h2",null,"Unexpected Application Error!"),k.createElement("h3",{style:{fontStyle:"italic"}},e),s?k.createElement("pre",{style:l},s):null,u)}var ZS=k.createElement(XS,null),eb=class extends k.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.onError?this.props.onError(n,e):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const s=KS(n.digest);s&&(n=s)}let e=n!==void 0?k.createElement(mi.Provider,{value:this.props.routeContext},k.createElement(Yp.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?k.createElement(e1,{error:n},e):e}};eb.contextType=qS;var $f=new WeakMap;function e1({children:n,error:e}){let{basename:s}=k.useContext(ps);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let a=WS(e.digest);if(a){let l=$f.get(e);if(l)throw l;let c=Wx(a.location,s);if(Gx&&!$f.get(e))if(c.isExternal||a.reloadDocument)window.location.href=c.absoluteURL||c.to;else{const u=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(c.to,{replace:a.replace}));throw $f.set(e,u),u}return k.createElement("meta",{httpEquiv:"refresh",content:`0;url=${c.absoluteURL||c.to}`})}}return n}function t1({routeContext:n,match:e,children:s}){let a=k.useContext(Vo);return a&&a.static&&a.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=e.route.id),k.createElement(mi.Provider,{value:n},s)}function n1(n,e=[],s=null,a=null,l=null){if(n==null){if(!s)return null;if(s.errors)n=s.matches;else if(e.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let c=n,u=s?.errors;if(u!=null){let m=c.findIndex(y=>y.route.id&&u?.[y.route.id]!==void 0);hr(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(u).join(",")}`),c=c.slice(0,Math.min(c.length,m+1))}let h=!1,f=-1;if(s)for(let m=0;m<c.length;m++){let y=c[m];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(f=m),y.route.id){let{loaderData:b,errors:v}=s,S=y.route.loader&&!b.hasOwnProperty(y.route.id)&&(!v||v[y.route.id]===void 0);if(y.route.lazy||S){h=!0,f>=0?c=c.slice(0,f+1):c=[c[0]];break}}}let p=s&&a?(m,y)=>{a(m,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:$S(s.matches),errorInfo:y})}:void 0;return c.reduceRight((m,y,b)=>{let v,S=!1,_=null,w=null;s&&(v=u&&y.route.id?u[y.route.id]:void 0,_=y.route.errorElement||ZS,h&&(f<0&&b===0?(tb("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,w=null):f===b&&(S=!0,w=y.route.hydrateFallbackElement||null)));let j=e.concat(c.slice(0,b+1)),N=()=>{let T;return v?T=_:S?T=w:y.route.Component?T=k.createElement(y.route.Component,null):y.route.element?T=y.route.element:T=m,k.createElement(t1,{match:y,routeContext:{outlet:m,matches:j,isDataRoute:s!=null},children:T})};return s&&(y.route.ErrorBoundary||y.route.errorElement||b===0)?k.createElement(eb,{location:s.location,revalidation:s.revalidation,component:_,error:v,children:N(),routeContext:{outlet:null,matches:j,isDataRoute:!0},onError:p}):N()},null)}function Qp(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function r1(n){let e=k.useContext(Vo);return hr(e,Qp(n)),e}function s1(n){let e=k.useContext(wd);return hr(e,Qp(n)),e}function i1(n){let e=k.useContext(mi);return hr(e,Qp(n)),e}function Jp(n){let e=i1(n),s=e.matches[e.matches.length-1];return hr(s.route.id,`${n} can only be used on routes that contain a unique "id"`),s.route.id}function a1(){return Jp("useRouteId")}function o1(){let n=k.useContext(Yp),e=s1("useRouteError"),s=Jp("useRouteError");return n!==void 0?n:e.errors?.[s]}function l1(){let{router:n}=r1("useNavigate"),e=Jp("useNavigate"),s=k.useRef(!1);return Xx(()=>{s.current=!0}),k.useCallback(async(l,c={})=>{fs(s.current,Jx),s.current&&(typeof l=="number"?await n.navigate(l):await n.navigate(l,{fromRouteId:e,...c}))},[n,e])}var n0={};function tb(n,e,s){!e&&!n0[n]&&(n0[n]=!0,fs(!1,s))}k.memo(c1);function c1({routes:n,future:e,state:s,onError:a}){return JS(n,void 0,s,a,e)}function u1({basename:n="/",children:e=null,location:s,navigationType:a="POP",navigator:l,static:c=!1,unstable_useTransitions:u}){hr(!vc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=n.replace(/^\/*/,"/"),f=k.useMemo(()=>({basename:h,navigator:l,static:c,unstable_useTransitions:u,future:{}}),[h,l,c,u]);typeof s=="string"&&(s=yc(s));let{pathname:p="/",search:m="",hash:y="",state:b=null,key:v="default"}=s,S=k.useMemo(()=>{let _=fi(p,h);return _==null?null:{location:{pathname:_,search:m,hash:y,state:b,key:v},navigationType:a}},[h,p,m,y,b,v,a]);return fs(S!=null,`<Router basename="${h}"> is not able to match the URL "${p}${m}${y}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:k.createElement(ps.Provider,{value:f},k.createElement(_d.Provider,{children:e,value:S}))}var Ju="get",Xu="application/x-www-form-urlencoded";function Sd(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function d1(n){return Sd(n)&&n.tagName.toLowerCase()==="button"}function h1(n){return Sd(n)&&n.tagName.toLowerCase()==="form"}function f1(n){return Sd(n)&&n.tagName.toLowerCase()==="input"}function p1(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function m1(n,e){return n.button===0&&(!e||e==="_self")&&!p1(n)}function Cp(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,s)=>{let a=n[s];return e.concat(Array.isArray(a)?a.map(l=>[s,l]):[[s,a]])},[]))}function g1(n,e){let s=Cp(n);return e&&e.forEach((a,l)=>{s.has(l)||e.getAll(l).forEach(c=>{s.append(l,c)})}),s}var Ru=null;function y1(){if(Ru===null)try{new FormData(document.createElement("form"),0),Ru=!1}catch{Ru=!0}return Ru}var v1=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Pf(n){return n!=null&&!v1.has(n)?(fs(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Xu}"`),null):n}function x1(n,e){let s,a,l,c,u;if(h1(n)){let h=n.getAttribute("action");a=h?fi(h,e):null,s=n.getAttribute("method")||Ju,l=Pf(n.getAttribute("enctype"))||Xu,c=new FormData(n)}else if(d1(n)||f1(n)&&(n.type==="submit"||n.type==="image")){let h=n.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=n.getAttribute("formaction")||h.getAttribute("action");if(a=f?fi(f,e):null,s=n.getAttribute("formmethod")||h.getAttribute("method")||Ju,l=Pf(n.getAttribute("formenctype"))||Pf(h.getAttribute("enctype"))||Xu,c=new FormData(h,n),!y1()){let{name:p,type:m,value:y}=n;if(m==="image"){let b=p?`${p}.`:"";c.append(`${b}x`,"0"),c.append(`${b}y`,"0")}else p&&c.append(p,y)}}else{if(Sd(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=Ju,a=null,l=Xu,u=n}return c&&l==="text/plain"&&(u=c,c=void 0),{action:a,method:s.toLowerCase(),encType:l,formData:c,body:u}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Xp(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function b1(n,e,s){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return a.pathname==="/"?a.pathname=`_root.${s}`:e&&fi(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.${s}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${s}`,a}async function w1(n,e){if(n.id in e)return e[n.id];try{let s=await import(n.module);return e[n.id]=s,s}catch(s){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function _1(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function S1(n,e,s){let a=await Promise.all(n.map(async l=>{let c=e.routes[l.route.id];if(c){let u=await w1(c,s);return u.links?u.links():[]}return[]}));return N1(a.flat(1).filter(_1).filter(l=>l.rel==="stylesheet"||l.rel==="preload").map(l=>l.rel==="stylesheet"?{...l,rel:"prefetch",as:"style"}:{...l,rel:"prefetch"}))}function r0(n,e,s,a,l,c){let u=(f,p)=>s[p]?f.route.id!==s[p].route.id:!0,h=(f,p)=>s[p].pathname!==f.pathname||s[p].route.path?.endsWith("*")&&s[p].params["*"]!==f.params["*"];return c==="assets"?e.filter((f,p)=>u(f,p)||h(f,p)):c==="data"?e.filter((f,p)=>{let m=a.routes[f.route.id];if(!m||!m.hasLoader)return!1;if(u(f,p)||h(f,p))return!0;if(f.route.shouldRevalidate){let y=f.route.shouldRevalidate({currentUrl:new URL(l.pathname+l.search+l.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof y=="boolean")return y}return!0}):[]}function j1(n,e,{includeHydrateFallback:s}={}){return C1(n.map(a=>{let l=e.routes[a.route.id];if(!l)return[];let c=[l.module];return l.clientActionModule&&(c=c.concat(l.clientActionModule)),l.clientLoaderModule&&(c=c.concat(l.clientLoaderModule)),s&&l.hydrateFallbackModule&&(c=c.concat(l.hydrateFallbackModule)),l.imports&&(c=c.concat(l.imports)),c}).flat(1))}function C1(n){return[...new Set(n)]}function k1(n){let e={},s=Object.keys(n).sort();for(let a of s)e[a]=n[a];return e}function N1(n,e){let s=new Set;return new Set(e),n.reduce((a,l)=>{let c=JSON.stringify(k1(l));return s.has(c)||(s.add(c),a.push({key:c,link:l})),a},[])}function nb(){let n=k.useContext(Vo);return Xp(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function E1(){let n=k.useContext(wd);return Xp(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Zp=k.createContext(void 0);Zp.displayName="FrameworkContext";function rb(){let n=k.useContext(Zp);return Xp(n,"You must render this element inside a <HydratedRouter> element"),n}function A1(n,e){let s=k.useContext(Zp),[a,l]=k.useState(!1),[c,u]=k.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:p,onMouseLeave:m,onTouchStart:y}=e,b=k.useRef(null);k.useEffect(()=>{if(n==="render"&&u(!0),n==="viewport"){let _=j=>{j.forEach(N=>{u(N.isIntersecting)})},w=new IntersectionObserver(_,{threshold:.5});return b.current&&w.observe(b.current),()=>{w.disconnect()}}},[n]),k.useEffect(()=>{if(a){let _=setTimeout(()=>{u(!0)},100);return()=>{clearTimeout(_)}}},[a]);let v=()=>{l(!0)},S=()=>{l(!1),u(!1)};return s?n!=="intent"?[c,b,{}]:[c,b,{onFocus:Pl(h,v),onBlur:Pl(f,S),onMouseEnter:Pl(p,v),onMouseLeave:Pl(m,S),onTouchStart:Pl(y,v)}]:[!1,b,{}]}function Pl(n,e){return s=>{n&&n(s),s.defaultPrevented||e(s)}}function T1({page:n,...e}){let{router:s}=nb(),a=k.useMemo(()=>$x(s.routes,n,s.basename),[s.routes,n,s.basename]);return a?k.createElement(O1,{page:n,matches:a,...e}):null}function R1(n){let{manifest:e,routeModules:s}=rb(),[a,l]=k.useState([]);return k.useEffect(()=>{let c=!1;return S1(n,e,s).then(u=>{c||l(u)}),()=>{c=!0}},[n,e,s]),a}function O1({page:n,matches:e,...s}){let a=gi(),{manifest:l,routeModules:c}=rb(),{basename:u}=nb(),{loaderData:h,matches:f}=E1(),p=k.useMemo(()=>r0(n,e,f,l,a,"data"),[n,e,f,l,a]),m=k.useMemo(()=>r0(n,e,f,l,a,"assets"),[n,e,f,l,a]),y=k.useMemo(()=>{if(n===a.pathname+a.search+a.hash)return[];let S=new Set,_=!1;if(e.forEach(j=>{let N=l.routes[j.route.id];!N||!N.hasLoader||(!p.some(T=>T.route.id===j.route.id)&&j.route.id in h&&c[j.route.id]?.shouldRevalidate||N.hasClientLoader?_=!0:S.add(j.route.id))}),S.size===0)return[];let w=b1(n,u,"data");return _&&S.size>0&&w.searchParams.set("_routes",e.filter(j=>S.has(j.route.id)).map(j=>j.route.id).join(",")),[w.pathname+w.search]},[u,h,a,l,p,e,n,c]),b=k.useMemo(()=>j1(m,l),[m,l]),v=R1(m);return k.createElement(k.Fragment,null,y.map(S=>k.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...s})),b.map(S=>k.createElement("link",{key:S,rel:"modulepreload",href:S,...s})),v.map(({key:S,link:_})=>k.createElement("link",{key:S,nonce:s.nonce,..._})))}function D1(...n){return e=>{n.forEach(s=>{typeof s=="function"?s(e):s!=null&&(s.current=e)})}}var z1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{z1&&(window.__reactRouterVersion="7.11.0")}catch{}function M1({basename:n,children:e,unstable_useTransitions:s,window:a}){let l=k.useRef();l.current==null&&(l.current=mS({window:a,v5Compat:!0}));let c=l.current,[u,h]=k.useState({action:c.action,location:c.location}),f=k.useCallback(p=>{s===!1?h(p):k.startTransition(()=>h(p))},[s]);return k.useLayoutEffect(()=>c.listen(f),[c,f]),k.createElement(u1,{basename:n,children:e,location:u.location,navigationType:u.action,navigator:c,unstable_useTransitions:s})}var sb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ib=k.forwardRef(function({onClick:e,discover:s="render",prefetch:a="none",relative:l,reloadDocument:c,replace:u,state:h,target:f,to:p,preventScrollReset:m,viewTransition:y,unstable_defaultShouldRevalidate:b,...v},S){let{basename:_,unstable_useTransitions:w}=k.useContext(ps),j=typeof p=="string"&&sb.test(p),N=Wx(p,_);p=N.to;let T=YS(p,{relative:l}),[R,$,F]=A1(a,v),q=B1(p,{replace:u,state:h,target:f,preventScrollReset:m,relative:l,viewTransition:y,unstable_defaultShouldRevalidate:b,unstable_useTransitions:w});function I(P){e&&e(P),P.defaultPrevented||q(P)}let U=k.createElement("a",{...v,...F,href:N.absoluteURL||T,onClick:N.isExternal||c?e:I,ref:D1(S,$),target:f,"data-discover":!j&&s==="render"?"true":void 0});return R&&!j?k.createElement(k.Fragment,null,U,k.createElement(T1,{page:T})):U});ib.displayName="Link";var L1=k.forwardRef(function({"aria-current":e="page",caseSensitive:s=!1,className:a="",end:l=!1,style:c,to:u,viewTransition:h,children:f,...p},m){let y=xc(u,{relative:p.relative}),b=gi(),v=k.useContext(wd),{navigator:S,basename:_}=k.useContext(ps),w=v!=null&&H1(y)&&h===!0,j=S.encodeLocation?S.encodeLocation(y).pathname:y.pathname,N=b.pathname,T=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;s||(N=N.toLowerCase(),T=T?T.toLowerCase():null,j=j.toLowerCase()),T&&_&&(T=fi(T,_)||T);const R=j!=="/"&&j.endsWith("/")?j.length-1:j.length;let $=N===j||!l&&N.startsWith(j)&&N.charAt(R)==="/",F=T!=null&&(T===j||!l&&T.startsWith(j)&&T.charAt(j.length)==="/"),q={isActive:$,isPending:F,isTransitioning:w},I=$?e:void 0,U;typeof a=="function"?U=a(q):U=[a,$?"active":null,F?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let P=typeof c=="function"?c(q):c;return k.createElement(ib,{...p,"aria-current":I,className:U,ref:m,style:P,to:u,viewTransition:h},typeof f=="function"?f(q):f)});L1.displayName="NavLink";var U1=k.forwardRef(({discover:n="render",fetcherKey:e,navigate:s,reloadDocument:a,replace:l,state:c,method:u=Ju,action:h,onSubmit:f,relative:p,preventScrollReset:m,viewTransition:y,unstable_defaultShouldRevalidate:b,...v},S)=>{let{unstable_useTransitions:_}=k.useContext(ps),w=q1(),j=F1(h,{relative:p}),N=u.toLowerCase()==="get"?"get":"post",T=typeof h=="string"&&sb.test(h),R=$=>{if(f&&f($),$.defaultPrevented)return;$.preventDefault();let F=$.nativeEvent.submitter,q=F?.getAttribute("formmethod")||u,I=()=>w(F||$.currentTarget,{fetcherKey:e,method:q,navigate:s,replace:l,state:c,relative:p,preventScrollReset:m,viewTransition:y,unstable_defaultShouldRevalidate:b});_&&s!==!1?k.startTransition(()=>I()):I()};return k.createElement("form",{ref:S,method:N,action:j,onSubmit:a?f:R,...v,"data-discover":!T&&n==="render"?"true":void 0})});U1.displayName="Form";function I1(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ab(n){let e=k.useContext(Vo);return hr(e,I1(n)),e}function B1(n,{target:e,replace:s,state:a,preventScrollReset:l,relative:c,viewTransition:u,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let p=Zx(),m=gi(),y=xc(n,{relative:c});return k.useCallback(b=>{if(m1(b,e)){b.preventDefault();let v=s!==void 0?s:ic(m)===ic(y),S=()=>p(n,{replace:v,state:a,preventScrollReset:l,relative:c,viewTransition:u,unstable_defaultShouldRevalidate:h});f?k.startTransition(()=>S()):S()}},[m,p,y,s,a,e,n,l,c,u,h,f])}function bc(n){fs(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=k.useRef(Cp(n)),s=k.useRef(!1),a=gi(),l=k.useMemo(()=>g1(a.search,s.current?null:e.current),[a.search]),c=Zx(),u=k.useCallback((h,f)=>{const p=Cp(typeof h=="function"?h(new URLSearchParams(l)):h);s.current=!0,c("?"+p,f)},[c,l]);return[l,u]}var $1=0,P1=()=>`__${String(++$1)}__`;function q1(){let{router:n}=ab("useSubmit"),{basename:e}=k.useContext(ps),s=a1(),a=n.fetch,l=n.navigate;return k.useCallback(async(c,u={})=>{let{action:h,method:f,encType:p,formData:m,body:y}=x1(c,e);if(u.navigate===!1){let b=u.fetcherKey||P1();await a(b,s,u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:m,body:y,formMethod:u.method||f,formEncType:u.encType||p,flushSync:u.flushSync})}else await l(u.action||h,{unstable_defaultShouldRevalidate:u.unstable_defaultShouldRevalidate,preventScrollReset:u.preventScrollReset,formData:m,body:y,formMethod:u.method||f,formEncType:u.encType||p,replace:u.replace,state:u.state,fromRouteId:s,flushSync:u.flushSync,viewTransition:u.viewTransition})},[a,l,e,s])}function F1(n,{relative:e}={}){let{basename:s}=k.useContext(ps),a=k.useContext(mi);hr(a,"useFormAction must be used inside a RouteContext");let[l]=a.matches.slice(-1),c={...xc(n||".",{relative:e})},u=gi();if(n==null){c.search=u.search;let h=new URLSearchParams(c.search),f=h.getAll("index");if(f.some(m=>m==="")){h.delete("index"),f.filter(y=>y).forEach(y=>h.append("index",y));let m=h.toString();c.search=m?`?${m}`:""}}return(!n||n===".")&&l.route.index&&(c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(c.pathname=c.pathname==="/"?s:hi([s,c.pathname])),ic(c)}function H1(n,{relative:e}={}){let s=k.useContext(Yx);hr(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=ab("useViewTransitionState"),l=xc(n,{relative:e});if(!s.isTransitioning)return!1;let c=fi(s.currentLocation.pathname,a)||s.currentLocation.pathname,u=fi(s.nextLocation.pathname,a)||s.nextLocation.pathname;return sd(l.pathname,u)!=null||sd(l.pathname,c)!=null}var Da=Bx();const V1=({children:n})=>(gi(),r.jsxs("div",{className:"app-layout",children:[r.jsx("header",{className:"app-header",children:r.jsx("div",{className:"container app-header__content",children:r.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),r.jsx("main",{className:"container app-main",children:n}),r.jsx("footer",{className:"app-footer",children:r.jsx("div",{className:"container",children:r.jsx("p",{children:" 2026 recipe management"})})})]})),mn=({children:n,className:e="",hoverable:s=!1,...a})=>r.jsx("div",{className:`glass-card ${s?"glass-card--hoverable":""} ${e}`,...a,children:n}),he=({children:n,variant:e="primary",size:s="md",isLoading:a,block:l,className:c="",...u})=>{const h=["btn",`btn--${e}`,`btn--${s}`,l?"btn--block":"",a?"btn--loading":"",c].filter(Boolean).join(" ");return r.jsxs("button",{className:h,disabled:a,...u,children:[a&&r.jsx("span",{className:"btn__spinner"}),r.jsx("span",{className:"btn__content",children:n})]})};function G1(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return k.useMemo(()=>a=>{e.forEach(l=>l(a))},e)}const jd=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Go(n){const e=Object.prototype.toString.call(n);return e==="[object Window]"||e==="[object global]"}function em(n){return"nodeType"in n}function Rr(n){var e,s;return n?Go(n)?n:em(n)&&(e=(s=n.ownerDocument)==null?void 0:s.defaultView)!=null?e:window:window}function tm(n){const{Document:e}=Rr(n);return n instanceof e}function wc(n){return Go(n)?!1:n instanceof Rr(n).HTMLElement}function ob(n){return n instanceof Rr(n).SVGElement}function Wo(n){return n?Go(n)?n.document:em(n)?tm(n)?n:wc(n)||ob(n)?n.ownerDocument:document:document:document}const Ts=jd?k.useLayoutEffect:k.useEffect;function Cd(n){const e=k.useRef(n);return Ts(()=>{e.current=n}),k.useCallback(function(){for(var s=arguments.length,a=new Array(s),l=0;l<s;l++)a[l]=arguments[l];return e.current==null?void 0:e.current(...a)},[])}function W1(){const n=k.useRef(null),e=k.useCallback((a,l)=>{n.current=setInterval(a,l)},[]),s=k.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[e,s]}function ac(n,e){e===void 0&&(e=[n]);const s=k.useRef(n);return Ts(()=>{s.current!==n&&(s.current=n)},e),s}function _c(n,e){const s=k.useRef();return k.useMemo(()=>{const a=n(s.current);return s.current=a,a},[...e])}function id(n){const e=Cd(n),s=k.useRef(null),a=k.useCallback(l=>{l!==s.current&&e?.(l,s.current),s.current=l},[]);return[s,a]}function ad(n){const e=k.useRef();return k.useEffect(()=>{e.current=n},[n]),e.current}let qf={};function Sc(n,e){return k.useMemo(()=>{if(e)return e;const s=qf[n]==null?0:qf[n]+1;return qf[n]=s,n+"-"+s},[n,e])}function lb(n){return function(e){for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];return a.reduce((c,u)=>{const h=Object.entries(u);for(const[f,p]of h){const m=c[f];m!=null&&(c[f]=m+n*p)}return c},{...e})}}const Lo=lb(1),oc=lb(-1);function K1(n){return"clientX"in n&&"clientY"in n}function kd(n){if(!n)return!1;const{KeyboardEvent:e}=Rr(n.target);return e&&n instanceof e}function Y1(n){if(!n)return!1;const{TouchEvent:e}=Rr(n.target);return e&&n instanceof e}function od(n){if(Y1(n)){if(n.touches&&n.touches.length){const{clientX:e,clientY:s}=n.touches[0];return{x:e,y:s}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:e,clientY:s}=n.changedTouches[0];return{x:e,y:s}}}return K1(n)?{x:n.clientX,y:n.clientY}:null}const Br=Object.freeze({Translate:{toString(n){if(!n)return;const{x:e,y:s}=n;return"translate3d("+(e?Math.round(e):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:e,scaleY:s}=n;return"scaleX("+e+") scaleY("+s+")"}},Transform:{toString(n){if(n)return[Br.Translate.toString(n),Br.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:e,duration:s,easing:a}=n;return e+" "+s+"ms "+a}}}),s0="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Q1(n){return n.matches(s0)?n:n.querySelector(s0)}const J1={display:"none"};function X1(n){let{id:e,value:s}=n;return Ie.createElement("div",{id:e,style:J1},s)}function Z1(n){let{id:e,announcement:s,ariaLiveType:a="assertive"}=n;const l={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ie.createElement("div",{id:e,style:l,role:"status","aria-live":a,"aria-atomic":!0},s)}function ej(){const[n,e]=k.useState("");return{announce:k.useCallback(a=>{a!=null&&e(a)},[]),announcement:n}}const cb=k.createContext(null);function tj(n){const e=k.useContext(cb);k.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(n)},[n,e])}function nj(){const[n]=k.useState(()=>new Set),e=k.useCallback(a=>(n.add(a),()=>n.delete(a)),[n]);return[k.useCallback(a=>{let{type:l,event:c}=a;n.forEach(u=>{var h;return(h=u[l])==null?void 0:h.call(u,c)})},[n]),e]}const rj={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},sj={onDragStart(n){let{active:e}=n;return"Picked up draggable item "+e.id+"."},onDragOver(n){let{active:e,over:s}=n;return s?"Draggable item "+e.id+" was moved over droppable area "+s.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(n){let{active:e,over:s}=n;return s?"Draggable item "+e.id+" was dropped over droppable area "+s.id:"Draggable item "+e.id+" was dropped."},onDragCancel(n){let{active:e}=n;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function ij(n){let{announcements:e=sj,container:s,hiddenTextDescribedById:a,screenReaderInstructions:l=rj}=n;const{announce:c,announcement:u}=ej(),h=Sc("DndLiveRegion"),[f,p]=k.useState(!1);if(k.useEffect(()=>{p(!0)},[]),tj(k.useMemo(()=>({onDragStart(y){let{active:b}=y;c(e.onDragStart({active:b}))},onDragMove(y){let{active:b,over:v}=y;e.onDragMove&&c(e.onDragMove({active:b,over:v}))},onDragOver(y){let{active:b,over:v}=y;c(e.onDragOver({active:b,over:v}))},onDragEnd(y){let{active:b,over:v}=y;c(e.onDragEnd({active:b,over:v}))},onDragCancel(y){let{active:b,over:v}=y;c(e.onDragCancel({active:b,over:v}))}}),[c,e])),!f)return null;const m=Ie.createElement(Ie.Fragment,null,Ie.createElement(X1,{id:a,value:l.draggable}),Ie.createElement(Z1,{id:h,announcement:u}));return s?Da.createPortal(m,s):m}var ur;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(ur||(ur={}));function ld(){}function Ar(n,e){return k.useMemo(()=>({sensor:n,options:e??{}}),[n,e])}function Ia(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return k.useMemo(()=>[...e].filter(a=>a!=null),[...e])}const Rs=Object.freeze({x:0,y:0});function nm(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))}function aj(n,e){const s=od(n);if(!s)return"0 0";const a={x:(s.x-e.left)/e.width*100,y:(s.y-e.top)/e.height*100};return a.x+"% "+a.y+"%"}function rm(n,e){let{data:{value:s}}=n,{data:{value:a}}=e;return s-a}function oj(n,e){let{data:{value:s}}=n,{data:{value:a}}=e;return a-s}function kp(n){let{left:e,top:s,height:a,width:l}=n;return[{x:e,y:s},{x:e+l,y:s},{x:e,y:s+a},{x:e+l,y:s+a}]}function ub(n,e){if(!n||n.length===0)return null;const[s]=n;return s[e]}function i0(n,e,s){return e===void 0&&(e=n.left),s===void 0&&(s=n.top),{x:e+n.width*.5,y:s+n.height*.5}}const cd=n=>{let{collisionRect:e,droppableRects:s,droppableContainers:a}=n;const l=i0(e,e.left,e.top),c=[];for(const u of a){const{id:h}=u,f=s.get(h);if(f){const p=nm(i0(f),l);c.push({id:h,data:{droppableContainer:u,value:p}})}}return c.sort(rm)},lj=n=>{let{collisionRect:e,droppableRects:s,droppableContainers:a}=n;const l=kp(e),c=[];for(const u of a){const{id:h}=u,f=s.get(h);if(f){const p=kp(f),m=l.reduce((b,v,S)=>b+nm(p[S],v),0),y=Number((m/4).toFixed(4));c.push({id:h,data:{droppableContainer:u,value:y}})}}return c.sort(rm)};function cj(n,e){const s=Math.max(e.top,n.top),a=Math.max(e.left,n.left),l=Math.min(e.left+e.width,n.left+n.width),c=Math.min(e.top+e.height,n.top+n.height),u=l-a,h=c-s;if(a<l&&s<c){const f=e.width*e.height,p=n.width*n.height,m=u*h,y=m/(f+p-m);return Number(y.toFixed(4))}return 0}const uj=n=>{let{collisionRect:e,droppableRects:s,droppableContainers:a}=n;const l=[];for(const c of a){const{id:u}=c,h=s.get(u);if(h){const f=cj(h,e);f>0&&l.push({id:u,data:{droppableContainer:c,value:f}})}}return l.sort(oj)};function dj(n,e){const{top:s,left:a,bottom:l,right:c}=e;return s<=n.y&&n.y<=l&&a<=n.x&&n.x<=c}const db=n=>{let{droppableContainers:e,droppableRects:s,pointerCoordinates:a}=n;if(!a)return[];const l=[];for(const c of e){const{id:u}=c,h=s.get(u);if(h&&dj(a,h)){const p=kp(h).reduce((y,b)=>y+nm(a,b),0),m=Number((p/4).toFixed(4));l.push({id:u,data:{droppableContainer:c,value:m}})}}return l.sort(rm)};function hj(n,e,s){return{...n,scaleX:e&&s?e.width/s.width:1,scaleY:e&&s?e.height/s.height:1}}function hb(n,e){return n&&e?{x:n.left-e.left,y:n.top-e.top}:Rs}function fj(n){return function(s){for(var a=arguments.length,l=new Array(a>1?a-1:0),c=1;c<a;c++)l[c-1]=arguments[c];return l.reduce((u,h)=>({...u,top:u.top+n*h.y,bottom:u.bottom+n*h.y,left:u.left+n*h.x,right:u.right+n*h.x}),{...s})}}const pj=fj(1);function fb(n){if(n.startsWith("matrix3d(")){const e=n.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(n.startsWith("matrix(")){const e=n.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function mj(n,e,s){const a=fb(e);if(!a)return n;const{scaleX:l,scaleY:c,x:u,y:h}=a,f=n.left-u-(1-l)*parseFloat(s),p=n.top-h-(1-c)*parseFloat(s.slice(s.indexOf(" ")+1)),m=l?n.width/l:n.width,y=c?n.height/c:n.height;return{width:m,height:y,top:p,right:f+m,bottom:p+y,left:f}}const gj={ignoreTransform:!1};function Ko(n,e){e===void 0&&(e=gj);let s=n.getBoundingClientRect();if(e.ignoreTransform){const{transform:p,transformOrigin:m}=Rr(n).getComputedStyle(n);p&&(s=mj(s,p,m))}const{top:a,left:l,width:c,height:u,bottom:h,right:f}=s;return{top:a,left:l,width:c,height:u,bottom:h,right:f}}function a0(n){return Ko(n,{ignoreTransform:!0})}function yj(n){const e=n.innerWidth,s=n.innerHeight;return{top:0,left:0,right:e,bottom:s,width:e,height:s}}function vj(n,e){return e===void 0&&(e=Rr(n).getComputedStyle(n)),e.position==="fixed"}function xj(n,e){e===void 0&&(e=Rr(n).getComputedStyle(n));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(l=>{const c=e[l];return typeof c=="string"?s.test(c):!1})}function Nd(n,e){const s=[];function a(l){if(e!=null&&s.length>=e||!l)return s;if(tm(l)&&l.scrollingElement!=null&&!s.includes(l.scrollingElement))return s.push(l.scrollingElement),s;if(!wc(l)||ob(l)||s.includes(l))return s;const c=Rr(n).getComputedStyle(l);return l!==n&&xj(l,c)&&s.push(l),vj(l,c)?s:a(l.parentNode)}return n?a(n):s}function pb(n){const[e]=Nd(n,1);return e??null}function Ff(n){return!jd||!n?null:Go(n)?n:em(n)?tm(n)||n===Wo(n).scrollingElement?window:wc(n)?n:null:null}function mb(n){return Go(n)?n.scrollX:n.scrollLeft}function gb(n){return Go(n)?n.scrollY:n.scrollTop}function Np(n){return{x:mb(n),y:gb(n)}}var gr;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(gr||(gr={}));function yb(n){return!jd||!n?!1:n===document.scrollingElement}function vb(n){const e={x:0,y:0},s=yb(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},a={x:n.scrollWidth-s.width,y:n.scrollHeight-s.height},l=n.scrollTop<=e.y,c=n.scrollLeft<=e.x,u=n.scrollTop>=a.y,h=n.scrollLeft>=a.x;return{isTop:l,isLeft:c,isBottom:u,isRight:h,maxScroll:a,minScroll:e}}const bj={x:.2,y:.2};function wj(n,e,s,a,l){let{top:c,left:u,right:h,bottom:f}=s;a===void 0&&(a=10),l===void 0&&(l=bj);const{isTop:p,isBottom:m,isLeft:y,isRight:b}=vb(n),v={x:0,y:0},S={x:0,y:0},_={height:e.height*l.y,width:e.width*l.x};return!p&&c<=e.top+_.height?(v.y=gr.Backward,S.y=a*Math.abs((e.top+_.height-c)/_.height)):!m&&f>=e.bottom-_.height&&(v.y=gr.Forward,S.y=a*Math.abs((e.bottom-_.height-f)/_.height)),!b&&h>=e.right-_.width?(v.x=gr.Forward,S.x=a*Math.abs((e.right-_.width-h)/_.width)):!y&&u<=e.left+_.width&&(v.x=gr.Backward,S.x=a*Math.abs((e.left+_.width-u)/_.width)),{direction:v,speed:S}}function _j(n){if(n===document.scrollingElement){const{innerWidth:c,innerHeight:u}=window;return{top:0,left:0,right:c,bottom:u,width:c,height:u}}const{top:e,left:s,right:a,bottom:l}=n.getBoundingClientRect();return{top:e,left:s,right:a,bottom:l,width:n.clientWidth,height:n.clientHeight}}function xb(n){return n.reduce((e,s)=>Lo(e,Np(s)),Rs)}function Sj(n){return n.reduce((e,s)=>e+mb(s),0)}function jj(n){return n.reduce((e,s)=>e+gb(s),0)}function bb(n,e){if(e===void 0&&(e=Ko),!n)return;const{top:s,left:a,bottom:l,right:c}=e(n);pb(n)&&(l<=0||c<=0||s>=window.innerHeight||a>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const Cj=[["x",["left","right"],Sj],["y",["top","bottom"],jj]];class sm{constructor(e,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=Nd(s),l=xb(a);this.rect={...e},this.width=e.width,this.height=e.height;for(const[c,u,h]of Cj)for(const f of u)Object.defineProperty(this,f,{get:()=>{const p=h(a),m=l[c]-p;return this.rect[f]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ec{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...s)})},this.target=e}add(e,s,a){var l;(l=this.target)==null||l.addEventListener(e,s,a),this.listeners.push([e,s,a])}}function kj(n){const{EventTarget:e}=Rr(n);return n instanceof e?n:Wo(n)}function Hf(n,e){const s=Math.abs(n.x),a=Math.abs(n.y);return typeof e=="number"?Math.sqrt(s**2+a**2)>e:"x"in e&&"y"in e?s>e.x&&a>e.y:"x"in e?s>e.x:"y"in e?a>e.y:!1}var ds;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(ds||(ds={}));function o0(n){n.preventDefault()}function Nj(n){n.stopPropagation()}var tn;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(tn||(tn={}));const wb={start:[tn.Space,tn.Enter],cancel:[tn.Esc],end:[tn.Space,tn.Enter,tn.Tab]},Ej=(n,e)=>{let{currentCoordinates:s}=e;switch(n.code){case tn.Right:return{...s,x:s.x+25};case tn.Left:return{...s,x:s.x-25};case tn.Down:return{...s,y:s.y+25};case tn.Up:return{...s,y:s.y-25}}};class Yo{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:s}}=e;this.props=e,this.listeners=new ec(Wo(s)),this.windowListeners=new ec(Rr(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ds.Resize,this.handleCancel),this.windowListeners.add(ds.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ds.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:s}=this.props,a=e.node.current;a&&bb(a),s(Rs)}handleKeyDown(e){if(kd(e)){const{active:s,context:a,options:l}=this.props,{keyboardCodes:c=wb,coordinateGetter:u=Ej,scrollBehavior:h="smooth"}=l,{code:f}=e;if(c.end.includes(f)){this.handleEnd(e);return}if(c.cancel.includes(f)){this.handleCancel(e);return}const{collisionRect:p}=a.current,m=p?{x:p.left,y:p.top}:Rs;this.referenceCoordinates||(this.referenceCoordinates=m);const y=u(e,{active:s,context:a.current,currentCoordinates:m});if(y){const b=oc(y,m),v={x:0,y:0},{scrollableAncestors:S}=a.current;for(const _ of S){const w=e.code,{isTop:j,isRight:N,isLeft:T,isBottom:R,maxScroll:$,minScroll:F}=vb(_),q=_j(_),I={x:Math.min(w===tn.Right?q.right-q.width/2:q.right,Math.max(w===tn.Right?q.left:q.left+q.width/2,y.x)),y:Math.min(w===tn.Down?q.bottom-q.height/2:q.bottom,Math.max(w===tn.Down?q.top:q.top+q.height/2,y.y))},U=w===tn.Right&&!N||w===tn.Left&&!T,P=w===tn.Down&&!R||w===tn.Up&&!j;if(U&&I.x!==y.x){const V=_.scrollLeft+b.x,D=w===tn.Right&&V<=$.x||w===tn.Left&&V>=F.x;if(D&&!b.y){_.scrollTo({left:V,behavior:h});return}D?v.x=_.scrollLeft-V:v.x=w===tn.Right?_.scrollLeft-$.x:_.scrollLeft-F.x,v.x&&_.scrollBy({left:-v.x,behavior:h});break}else if(P&&I.y!==y.y){const V=_.scrollTop+b.y,D=w===tn.Down&&V<=$.y||w===tn.Up&&V>=F.y;if(D&&!b.x){_.scrollTo({top:V,behavior:h});return}D?v.y=_.scrollTop-V:v.y=w===tn.Down?_.scrollTop-$.y:_.scrollTop-F.y,v.y&&_.scrollBy({top:-v.y,behavior:h});break}}this.handleMove(e,Lo(oc(y,this.referenceCoordinates),v))}}}handleMove(e,s){const{onMove:a}=this.props;e.preventDefault(),a(s)}handleEnd(e){const{onEnd:s}=this.props;e.preventDefault(),this.detach(),s()}handleCancel(e){const{onCancel:s}=this.props;e.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Yo.activators=[{eventName:"onKeyDown",handler:(n,e,s)=>{let{keyboardCodes:a=wb,onActivation:l}=e,{active:c}=s;const{code:u}=n.nativeEvent;if(a.start.includes(u)){const h=c.activatorNode.current;return h&&n.target!==h?!1:(n.preventDefault(),l?.({event:n.nativeEvent}),!0)}return!1}}];function l0(n){return!!(n&&"distance"in n)}function c0(n){return!!(n&&"delay"in n)}class im{constructor(e,s,a){var l;a===void 0&&(a=kj(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=s;const{event:c}=e,{target:u}=c;this.props=e,this.events=s,this.document=Wo(u),this.documentListeners=new ec(this.document),this.listeners=new ec(a),this.windowListeners=new ec(Rr(u)),this.initialCoordinates=(l=od(c))!=null?l:Rs,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:s,bypassActivationConstraint:a}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(ds.Resize,this.handleCancel),this.windowListeners.add(ds.DragStart,o0),this.windowListeners.add(ds.VisibilityChange,this.handleCancel),this.windowListeners.add(ds.ContextMenu,o0),this.documentListeners.add(ds.Keydown,this.handleKeydown),s){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(c0(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(l0(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,s){const{active:a,onPending:l}=this.props;l(a,e,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:e}=this,{onStart:s}=this.props;e&&(this.activated=!0,this.documentListeners.add(ds.Click,Nj,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ds.SelectionChange,this.removeTextSelection),s(e))}handleMove(e){var s;const{activated:a,initialCoordinates:l,props:c}=this,{onMove:u,options:{activationConstraint:h}}=c;if(!l)return;const f=(s=od(e))!=null?s:Rs,p=oc(l,f);if(!a&&h){if(l0(h)){if(h.tolerance!=null&&Hf(p,h.tolerance))return this.handleCancel();if(Hf(p,h.distance))return this.handleStart()}if(c0(h)&&Hf(p,h.tolerance))return this.handleCancel();this.handlePending(h,p);return}e.cancelable&&e.preventDefault(),u(f)}handleEnd(){const{onAbort:e,onEnd:s}=this.props;this.detach(),this.activated||e(this.props.active),s()}handleCancel(){const{onAbort:e,onCancel:s}=this.props;this.detach(),this.activated||e(this.props.active),s()}handleKeydown(e){e.code===tn.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const Aj={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ed extends im{constructor(e){const{event:s}=e,a=Wo(s.target);super(e,Aj,a)}}Ed.activators=[{eventName:"onPointerDown",handler:(n,e)=>{let{nativeEvent:s}=n,{onActivation:a}=e;return!s.isPrimary||s.button!==0?!1:(a?.({event:s}),!0)}}];const Tj={move:{name:"mousemove"},end:{name:"mouseup"}};var Ep;(function(n){n[n.RightClick=2]="RightClick"})(Ep||(Ep={}));class Qo extends im{constructor(e){super(e,Tj,Wo(e.event.target))}}Qo.activators=[{eventName:"onMouseDown",handler:(n,e)=>{let{nativeEvent:s}=n,{onActivation:a}=e;return s.button===Ep.RightClick?!1:(a?.({event:s}),!0)}}];const Vf={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Jo extends im{constructor(e){super(e,Vf)}static setup(){return window.addEventListener(Vf.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Vf.move.name,e)};function e(){}}}Jo.activators=[{eventName:"onTouchStart",handler:(n,e)=>{let{nativeEvent:s}=n,{onActivation:a}=e;const{touches:l}=s;return l.length>1?!1:(a?.({event:s}),!0)}}];var tc;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})(tc||(tc={}));var ud;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(ud||(ud={}));function Rj(n){let{acceleration:e,activator:s=tc.Pointer,canScroll:a,draggingRect:l,enabled:c,interval:u=5,order:h=ud.TreeOrder,pointerCoordinates:f,scrollableAncestors:p,scrollableAncestorRects:m,delta:y,threshold:b}=n;const v=Dj({delta:y,disabled:!c}),[S,_]=W1(),w=k.useRef({x:0,y:0}),j=k.useRef({x:0,y:0}),N=k.useMemo(()=>{switch(s){case tc.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case tc.DraggableRect:return l}},[s,l,f]),T=k.useRef(null),R=k.useCallback(()=>{const F=T.current;if(!F)return;const q=w.current.x*j.current.x,I=w.current.y*j.current.y;F.scrollBy(q,I)},[]),$=k.useMemo(()=>h===ud.TreeOrder?[...p].reverse():p,[h,p]);k.useEffect(()=>{if(!c||!p.length||!N){_();return}for(const F of $){if(a?.(F)===!1)continue;const q=p.indexOf(F),I=m[q];if(!I)continue;const{direction:U,speed:P}=wj(F,I,N,e,b);for(const V of["x","y"])v[V][U[V]]||(P[V]=0,U[V]=0);if(P.x>0||P.y>0){_(),T.current=F,S(R,u),w.current=P,j.current=U;return}}w.current={x:0,y:0},j.current={x:0,y:0},_()},[e,R,a,_,c,u,JSON.stringify(N),JSON.stringify(v),S,p,$,m,JSON.stringify(b)])}const Oj={x:{[gr.Backward]:!1,[gr.Forward]:!1},y:{[gr.Backward]:!1,[gr.Forward]:!1}};function Dj(n){let{delta:e,disabled:s}=n;const a=ad(e);return _c(l=>{if(s||!a||!l)return Oj;const c={x:Math.sign(e.x-a.x),y:Math.sign(e.y-a.y)};return{x:{[gr.Backward]:l.x[gr.Backward]||c.x===-1,[gr.Forward]:l.x[gr.Forward]||c.x===1},y:{[gr.Backward]:l.y[gr.Backward]||c.y===-1,[gr.Forward]:l.y[gr.Forward]||c.y===1}}},[s,e,a])}function zj(n,e){const s=e!=null?n.get(e):void 0,a=s?s.node.current:null;return _c(l=>{var c;return e==null?null:(c=a??l)!=null?c:null},[a,e])}function Mj(n,e){return k.useMemo(()=>n.reduce((s,a)=>{const{sensor:l}=a,c=l.activators.map(u=>({eventName:u.eventName,handler:e(u.handler,a)}));return[...s,...c]},[]),[n,e])}var lc;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(lc||(lc={}));var Ap;(function(n){n.Optimized="optimized"})(Ap||(Ap={}));const u0=new Map;function Lj(n,e){let{dragging:s,dependencies:a,config:l}=e;const[c,u]=k.useState(null),{frequency:h,measure:f,strategy:p}=l,m=k.useRef(n),y=w(),b=ac(y),v=k.useCallback(function(j){j===void 0&&(j=[]),!b.current&&u(N=>N===null?j:N.concat(j.filter(T=>!N.includes(T))))},[b]),S=k.useRef(null),_=_c(j=>{if(y&&!s)return u0;if(!j||j===u0||m.current!==n||c!=null){const N=new Map;for(let T of n){if(!T)continue;if(c&&c.length>0&&!c.includes(T.id)&&T.rect.current){N.set(T.id,T.rect.current);continue}const R=T.node.current,$=R?new sm(f(R),R):null;T.rect.current=$,$&&N.set(T.id,$)}return N}return j},[n,c,s,y,f]);return k.useEffect(()=>{m.current=n},[n]),k.useEffect(()=>{y||v()},[s,y]),k.useEffect(()=>{c&&c.length>0&&u(null)},[JSON.stringify(c)]),k.useEffect(()=>{y||typeof h!="number"||S.current!==null||(S.current=setTimeout(()=>{v(),S.current=null},h))},[h,y,v,...a]),{droppableRects:_,measureDroppableContainers:v,measuringScheduled:c!=null};function w(){switch(p){case lc.Always:return!1;case lc.BeforeDragging:return s;default:return!s}}}function am(n,e){return _c(s=>n?s||(typeof e=="function"?e(n):n):null,[e,n])}function Uj(n,e){return am(n,e)}function Ij(n){let{callback:e,disabled:s}=n;const a=Cd(e),l=k.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:c}=window;return new c(a)},[a,s]);return k.useEffect(()=>()=>l?.disconnect(),[l]),l}function Ad(n){let{callback:e,disabled:s}=n;const a=Cd(e),l=k.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:c}=window;return new c(a)},[s]);return k.useEffect(()=>()=>l?.disconnect(),[l]),l}function Bj(n){return new sm(Ko(n),n)}function d0(n,e,s){e===void 0&&(e=Bj);const[a,l]=k.useState(null);function c(){l(f=>{if(!n)return null;if(n.isConnected===!1){var p;return(p=f??s)!=null?p:null}const m=e(n);return JSON.stringify(f)===JSON.stringify(m)?f:m})}const u=Ij({callback(f){if(n)for(const p of f){const{type:m,target:y}=p;if(m==="childList"&&y instanceof HTMLElement&&y.contains(n)){c();break}}}}),h=Ad({callback:c});return Ts(()=>{c(),n?(h?.observe(n),u?.observe(document.body,{childList:!0,subtree:!0})):(h?.disconnect(),u?.disconnect())},[n]),a}function $j(n){const e=am(n);return hb(n,e)}const h0=[];function Pj(n){const e=k.useRef(n),s=_c(a=>n?a&&a!==h0&&n&&e.current&&n.parentNode===e.current.parentNode?a:Nd(n):h0,[n]);return k.useEffect(()=>{e.current=n},[n]),s}function qj(n){const[e,s]=k.useState(null),a=k.useRef(n),l=k.useCallback(c=>{const u=Ff(c.target);u&&s(h=>h?(h.set(u,Np(u)),new Map(h)):null)},[]);return k.useEffect(()=>{const c=a.current;if(n!==c){u(c);const h=n.map(f=>{const p=Ff(f);return p?(p.addEventListener("scroll",l,{passive:!0}),[p,Np(p)]):null}).filter(f=>f!=null);s(h.length?new Map(h):null),a.current=n}return()=>{u(n),u(c)};function u(h){h.forEach(f=>{const p=Ff(f);p?.removeEventListener("scroll",l)})}},[l,n]),k.useMemo(()=>n.length?e?Array.from(e.values()).reduce((c,u)=>Lo(c,u),Rs):xb(n):Rs,[n,e])}function f0(n,e){e===void 0&&(e=[]);const s=k.useRef(null);return k.useEffect(()=>{s.current=null},e),k.useEffect(()=>{const a=n!==Rs;a&&!s.current&&(s.current=n),!a&&s.current&&(s.current=null)},[n]),s.current?oc(n,s.current):Rs}function Fj(n){k.useEffect(()=>{if(!jd)return;const e=n.map(s=>{let{sensor:a}=s;return a.setup==null?void 0:a.setup()});return()=>{for(const s of e)s?.()}},n.map(e=>{let{sensor:s}=e;return s}))}function Hj(n,e){return k.useMemo(()=>n.reduce((s,a)=>{let{eventName:l,handler:c}=a;return s[l]=u=>{c(u,e)},s},{}),[n,e])}function _b(n){return k.useMemo(()=>n?yj(n):null,[n])}const p0=[];function Vj(n,e){e===void 0&&(e=Ko);const[s]=n,a=_b(s?Rr(s):null),[l,c]=k.useState(p0);function u(){c(()=>n.length?n.map(f=>yb(f)?a:new sm(e(f),f)):p0)}const h=Ad({callback:u});return Ts(()=>{h?.disconnect(),u(),n.forEach(f=>h?.observe(f))},[n]),l}function Sb(n){if(!n)return null;if(n.children.length>1)return n;const e=n.children[0];return wc(e)?e:n}function Gj(n){let{measure:e}=n;const[s,a]=k.useState(null),l=k.useCallback(p=>{for(const{target:m}of p)if(wc(m)){a(y=>{const b=e(m);return y?{...y,width:b.width,height:b.height}:b});break}},[e]),c=Ad({callback:l}),u=k.useCallback(p=>{const m=Sb(p);c?.disconnect(),m&&c?.observe(m),a(m?e(m):null)},[e,c]),[h,f]=id(u);return k.useMemo(()=>({nodeRef:h,rect:s,setRef:f}),[s,h,f])}const Wj=[{sensor:Ed,options:{}},{sensor:Yo,options:{}}],Kj={current:{}},Zu={draggable:{measure:a0},droppable:{measure:a0,strategy:lc.WhileDragging,frequency:Ap.Optimized},dragOverlay:{measure:Ko}};class nc extends Map{get(e){var s;return e!=null&&(s=super.get(e))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:s}=e;return!s})}getNodeFor(e){var s,a;return(s=(a=this.get(e))==null?void 0:a.node.current)!=null?s:void 0}}const Yj={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new nc,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ld},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Zu,measureDroppableContainers:ld,windowRect:null,measuringScheduled:!1},jb={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ld,draggableNodes:new Map,over:null,measureDroppableContainers:ld},jc=k.createContext(jb),Cb=k.createContext(Yj);function Qj(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new nc}}}function Jj(n,e){switch(e.type){case ur.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case ur.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:e.coordinates.x-n.draggable.initialCoordinates.x,y:e.coordinates.y-n.draggable.initialCoordinates.y}}};case ur.DragEnd:case ur.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ur.RegisterDroppable:{const{element:s}=e,{id:a}=s,l=new nc(n.droppable.containers);return l.set(a,s),{...n,droppable:{...n.droppable,containers:l}}}case ur.SetDroppableDisabled:{const{id:s,key:a,disabled:l}=e,c=n.droppable.containers.get(s);if(!c||a!==c.key)return n;const u=new nc(n.droppable.containers);return u.set(s,{...c,disabled:l}),{...n,droppable:{...n.droppable,containers:u}}}case ur.UnregisterDroppable:{const{id:s,key:a}=e,l=n.droppable.containers.get(s);if(!l||a!==l.key)return n;const c=new nc(n.droppable.containers);return c.delete(s),{...n,droppable:{...n.droppable,containers:c}}}default:return n}}function Xj(n){let{disabled:e}=n;const{active:s,activatorEvent:a,draggableNodes:l}=k.useContext(jc),c=ad(a),u=ad(s?.id);return k.useEffect(()=>{if(!e&&!a&&c&&u!=null){if(!kd(c)||document.activeElement===c.target)return;const h=l.get(u);if(!h)return;const{activatorNode:f,node:p}=h;if(!f.current&&!p.current)return;requestAnimationFrame(()=>{for(const m of[f.current,p.current]){if(!m)continue;const y=Q1(m);if(y){y.focus();break}}})}},[a,e,l,u,c]),null}function kb(n,e){let{transform:s,...a}=e;return n!=null&&n.length?n.reduce((l,c)=>c({transform:l,...a}),s):s}function Zj(n){return k.useMemo(()=>({draggable:{...Zu.draggable,...n?.draggable},droppable:{...Zu.droppable,...n?.droppable},dragOverlay:{...Zu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function eC(n){let{activeNode:e,measure:s,initialRect:a,config:l=!0}=n;const c=k.useRef(!1),{x:u,y:h}=typeof l=="boolean"?{x:l,y:l}:l;Ts(()=>{if(!u&&!h||!e){c.current=!1;return}if(c.current||!a)return;const p=e?.node.current;if(!p||p.isConnected===!1)return;const m=s(p),y=hb(m,a);if(u||(y.x=0),h||(y.y=0),c.current=!0,Math.abs(y.x)>0||Math.abs(y.y)>0){const b=pb(p);b&&b.scrollBy({top:y.y,left:y.x})}},[e,u,h,a,s])}const Td=k.createContext({...Rs,scaleX:1,scaleY:1});var Ki;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Ki||(Ki={}));const ea=k.memo(function(e){var s,a,l,c;let{id:u,accessibility:h,autoScroll:f=!0,children:p,sensors:m=Wj,collisionDetection:y=uj,measuring:b,modifiers:v,...S}=e;const _=k.useReducer(Jj,void 0,Qj),[w,j]=_,[N,T]=nj(),[R,$]=k.useState(Ki.Uninitialized),F=R===Ki.Initialized,{draggable:{active:q,nodes:I,translate:U},droppable:{containers:P}}=w,V=q!=null?I.get(q):null,D=k.useRef({initial:null,translated:null}),H=k.useMemo(()=>{var _t;return q!=null?{id:q,data:(_t=V?.data)!=null?_t:Kj,rect:D}:null},[q,V]),C=k.useRef(null),[M,z]=k.useState(null),[B,K]=k.useState(null),Q=ac(S,Object.values(S)),Z=Sc("DndDescribedBy",u),A=k.useMemo(()=>P.getEnabled(),[P]),L=Zj(b),{droppableRects:J,measureDroppableContainers:ae,measuringScheduled:ue}=Lj(A,{dragging:F,dependencies:[U.x,U.y],config:L.droppable}),Ce=zj(I,q),fe=k.useMemo(()=>B?od(B):null,[B]),ne=yn(),be=Uj(Ce,L.draggable.measure);eC({activeNode:q!=null?I.get(q):null,config:ne.layoutShiftCompensation,initialRect:be,measure:L.draggable.measure});const le=d0(Ce,L.draggable.measure,be),ie=d0(Ce?Ce.parentElement:null),Te=k.useRef({activatorEvent:null,active:null,activeNode:Ce,collisionRect:null,collisions:null,droppableRects:J,draggableNodes:I,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Le=P.getNodeFor((s=Te.current.over)==null?void 0:s.id),E=Gj({measure:L.dragOverlay.measure}),ve=(a=E.nodeRef.current)!=null?a:Ce,ge=F?(l=E.rect)!=null?l:le:null,Y=!!(E.nodeRef.current&&E.rect),W=$j(Y?null:le),oe=_b(ve?Rr(ve):null),re=Pj(F?Le??Ce:null),ee=Vj(re),de=kb(v,{transform:{x:U.x-W.x,y:U.y-W.y,scaleX:1,scaleY:1},activatorEvent:B,active:H,activeNodeRect:le,containerNodeRect:ie,draggingNodeRect:ge,over:Te.current.over,overlayNodeRect:E.rect,scrollableAncestors:re,scrollableAncestorRects:ee,windowRect:oe}),me=fe?Lo(fe,U):null,Be=qj(re),Re=f0(Be),Pe=f0(Be,[le]),Je=Lo(de,Re),We=ge?pj(ge,de):null,Et=H&&We?y({active:H,collisionRect:We,droppableRects:J,droppableContainers:A,pointerCoordinates:me}):null,Wt=ub(Et,"id"),[dt,yt]=k.useState(null),ft=Y?de:Lo(de,Pe),Tt=hj(ft,(c=dt?.rect)!=null?c:null,le),sn=k.useRef(null),wt=k.useCallback((_t,jt)=>{let{sensor:Kt,options:Ft}=jt;if(C.current==null)return;const dn=I.get(C.current);if(!dn)return;const Ht=_t.nativeEvent,gn=new Kt({active:C.current,activeNode:dn,event:Ht,options:Ft,context:Te,onAbort(an){if(!I.get(an))return;const{onDragAbort:Vt}=Q.current,Cn={id:an};Vt?.(Cn),N({type:"onDragAbort",event:Cn})},onPending(an,Dn,Vt,Cn){if(!I.get(an))return;const{onDragPending:zn}=Q.current,qn={id:an,constraint:Dn,initialCoordinates:Vt,offset:Cn};zn?.(qn),N({type:"onDragPending",event:qn})},onStart(an){const Dn=C.current;if(Dn==null)return;const Vt=I.get(Dn);if(!Vt)return;const{onDragStart:Cn}=Q.current,It={activatorEvent:Ht,active:{id:Dn,data:Vt.data,rect:D}};Da.unstable_batchedUpdates(()=>{Cn?.(It),$(Ki.Initializing),j({type:ur.DragStart,initialCoordinates:an,active:Dn}),N({type:"onDragStart",event:It}),z(sn.current),K(Ht)})},onMove(an){j({type:ur.DragMove,coordinates:an})},onEnd:hn(ur.DragEnd),onCancel:hn(ur.DragCancel)});sn.current=gn;function hn(an){return async function(){const{active:Vt,collisions:Cn,over:It,scrollAdjustedTranslate:zn}=Te.current;let qn=null;if(Vt&&zn){const{cancelDrop:fn}=Q.current;qn={activatorEvent:Ht,active:Vt,collisions:Cn,delta:zn,over:It},an===ur.DragEnd&&typeof fn=="function"&&await Promise.resolve(fn(qn))&&(an=ur.DragCancel)}C.current=null,Da.unstable_batchedUpdates(()=>{j({type:an}),$(Ki.Uninitialized),yt(null),z(null),K(null),sn.current=null;const fn=an===ur.DragEnd?"onDragEnd":"onDragCancel";if(qn){const Se=Q.current[fn];Se?.(qn),N({type:fn,event:qn})}})}}},[I]),Un=k.useCallback((_t,jt)=>(Kt,Ft)=>{const dn=Kt.nativeEvent,Ht=I.get(Ft);if(C.current!==null||!Ht||dn.dndKit||dn.defaultPrevented)return;const gn={active:Ht};_t(Kt,jt.options,gn)===!0&&(dn.dndKit={capturedBy:jt.sensor},C.current=Ft,wt(Kt,jt))},[I,wt]),Lt=Mj(m,Un);Fj(m),Ts(()=>{le&&R===Ki.Initializing&&$(Ki.Initialized)},[le,R]),k.useEffect(()=>{const{onDragMove:_t}=Q.current,{active:jt,activatorEvent:Kt,collisions:Ft,over:dn}=Te.current;if(!jt||!Kt)return;const Ht={active:jt,activatorEvent:Kt,collisions:Ft,delta:{x:Je.x,y:Je.y},over:dn};Da.unstable_batchedUpdates(()=>{_t?.(Ht),N({type:"onDragMove",event:Ht})})},[Je.x,Je.y]),k.useEffect(()=>{const{active:_t,activatorEvent:jt,collisions:Kt,droppableContainers:Ft,scrollAdjustedTranslate:dn}=Te.current;if(!_t||C.current==null||!jt||!dn)return;const{onDragOver:Ht}=Q.current,gn=Ft.get(Wt),hn=gn&&gn.rect.current?{id:gn.id,rect:gn.rect.current,data:gn.data,disabled:gn.disabled}:null,an={active:_t,activatorEvent:jt,collisions:Kt,delta:{x:dn.x,y:dn.y},over:hn};Da.unstable_batchedUpdates(()=>{yt(hn),Ht?.(an),N({type:"onDragOver",event:an})})},[Wt]),Ts(()=>{Te.current={activatorEvent:B,active:H,activeNode:Ce,collisionRect:We,collisions:Et,droppableRects:J,draggableNodes:I,draggingNode:ve,draggingNodeRect:ge,droppableContainers:P,over:dt,scrollableAncestors:re,scrollAdjustedTranslate:Je},D.current={initial:ge,translated:We}},[H,Ce,Et,We,I,ve,ge,J,P,dt,re,Je]),Rj({...ne,delta:U,draggingRect:We,pointerCoordinates:me,scrollableAncestors:re,scrollableAncestorRects:ee});const qt=k.useMemo(()=>({active:H,activeNode:Ce,activeNodeRect:le,activatorEvent:B,collisions:Et,containerNodeRect:ie,dragOverlay:E,draggableNodes:I,droppableContainers:P,droppableRects:J,over:dt,measureDroppableContainers:ae,scrollableAncestors:re,scrollableAncestorRects:ee,measuringConfiguration:L,measuringScheduled:ue,windowRect:oe}),[H,Ce,le,B,Et,ie,E,I,P,J,dt,ae,re,ee,L,ue,oe]),un=k.useMemo(()=>({activatorEvent:B,activators:Lt,active:H,activeNodeRect:le,ariaDescribedById:{draggable:Z},dispatch:j,draggableNodes:I,over:dt,measureDroppableContainers:ae}),[B,Lt,H,le,j,Z,I,dt,ae]);return Ie.createElement(cb.Provider,{value:T},Ie.createElement(jc.Provider,{value:un},Ie.createElement(Cb.Provider,{value:qt},Ie.createElement(Td.Provider,{value:Tt},p)),Ie.createElement(Xj,{disabled:h?.restoreFocus===!1})),Ie.createElement(ij,{...h,hiddenTextDescribedById:Z}));function yn(){const _t=M?.autoScrollEnabled===!1,jt=typeof f=="object"?f.enabled===!1:f===!1,Kt=F&&!_t&&!jt;return typeof f=="object"?{...f,enabled:Kt}:{enabled:Kt}}}),tC=k.createContext(null),m0="button",nC="Draggable";function om(n){let{id:e,data:s,disabled:a=!1,attributes:l}=n;const c=Sc(nC),{activators:u,activatorEvent:h,active:f,activeNodeRect:p,ariaDescribedById:m,draggableNodes:y,over:b}=k.useContext(jc),{role:v=m0,roleDescription:S="draggable",tabIndex:_=0}=l??{},w=f?.id===e,j=k.useContext(w?Td:tC),[N,T]=id(),[R,$]=id(),F=Hj(u,e),q=ac(s);Ts(()=>(y.set(e,{id:e,key:c,node:N,activatorNode:R,data:q}),()=>{const U=y.get(e);U&&U.key===c&&y.delete(e)}),[y,e]);const I=k.useMemo(()=>({role:v,tabIndex:_,"aria-disabled":a,"aria-pressed":w&&v===m0?!0:void 0,"aria-roledescription":S,"aria-describedby":m.draggable}),[a,v,_,w,S,m.draggable]);return{active:f,activatorEvent:h,activeNodeRect:p,attributes:I,isDragging:w,listeners:a?void 0:F,node:N,over:b,setNodeRef:T,setActivatorNodeRef:$,transform:j}}function Nb(){return k.useContext(Cb)}const rC="Droppable",sC={timeout:25};function Cc(n){let{data:e,disabled:s=!1,id:a,resizeObserverConfig:l}=n;const c=Sc(rC),{active:u,dispatch:h,over:f,measureDroppableContainers:p}=k.useContext(jc),m=k.useRef({disabled:s}),y=k.useRef(!1),b=k.useRef(null),v=k.useRef(null),{disabled:S,updateMeasurementsFor:_,timeout:w}={...sC,...l},j=ac(_??a),N=k.useCallback(()=>{if(!y.current){y.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{p(Array.isArray(j.current)?j.current:[j.current]),v.current=null},w)},[w]),T=Ad({callback:N,disabled:S||!u}),R=k.useCallback((I,U)=>{T&&(U&&(T.unobserve(U),y.current=!1),I&&T.observe(I))},[T]),[$,F]=id(R),q=ac(e);return k.useEffect(()=>{!T||!$.current||(T.disconnect(),y.current=!1,T.observe($.current))},[$,T]),k.useEffect(()=>(h({type:ur.RegisterDroppable,element:{id:a,key:c,disabled:s,node:$,rect:b,data:q}}),()=>h({type:ur.UnregisterDroppable,key:c,id:a})),[a]),k.useEffect(()=>{s!==m.current.disabled&&(h({type:ur.SetDroppableDisabled,id:a,key:c,disabled:s}),m.current.disabled=s)},[a,c,s,h]),{active:u,rect:b,isOver:f?.id===a,node:$,over:f,setNodeRef:F}}function iC(n){let{animation:e,children:s}=n;const[a,l]=k.useState(null),[c,u]=k.useState(null),h=ad(s);return!s&&!a&&h&&l(h),Ts(()=>{if(!c)return;const f=a?.key,p=a?.props.id;if(f==null||p==null){l(null);return}Promise.resolve(e(p,c)).then(()=>{l(null)})},[e,a,c]),Ie.createElement(Ie.Fragment,null,s,a?k.cloneElement(a,{ref:u}):null)}const aC={x:0,y:0,scaleX:1,scaleY:1};function oC(n){let{children:e}=n;return Ie.createElement(jc.Provider,{value:jb},Ie.createElement(Td.Provider,{value:aC},e))}const lC={position:"fixed",touchAction:"none"},cC=n=>kd(n)?"transform 250ms ease":void 0,uC=k.forwardRef((n,e)=>{let{as:s,activatorEvent:a,adjustScale:l,children:c,className:u,rect:h,style:f,transform:p,transition:m=cC}=n;if(!h)return null;const y=l?p:{...p,scaleX:1,scaleY:1},b={...lC,width:h.width,height:h.height,top:h.top,left:h.left,transform:Br.Transform.toString(y),transformOrigin:l&&a?aj(a,h):void 0,transition:typeof m=="function"?m(a):m,...f};return Ie.createElement(s,{className:u,style:b,ref:e},c)}),lm=n=>e=>{let{active:s,dragOverlay:a}=e;const l={},{styles:c,className:u}=n;if(c!=null&&c.active)for(const[h,f]of Object.entries(c.active))f!==void 0&&(l[h]=s.node.style.getPropertyValue(h),s.node.style.setProperty(h,f));if(c!=null&&c.dragOverlay)for(const[h,f]of Object.entries(c.dragOverlay))f!==void 0&&a.node.style.setProperty(h,f);return u!=null&&u.active&&s.node.classList.add(u.active),u!=null&&u.dragOverlay&&a.node.classList.add(u.dragOverlay),function(){for(const[f,p]of Object.entries(l))s.node.style.setProperty(f,p);u!=null&&u.active&&s.node.classList.remove(u.active)}},dC=n=>{let{transform:{initial:e,final:s}}=n;return[{transform:Br.Transform.toString(e)},{transform:Br.Transform.toString(s)}]},hC={duration:250,easing:"ease",keyframes:dC,sideEffects:lm({styles:{active:{opacity:"0"}}})};function fC(n){let{config:e,draggableNodes:s,droppableContainers:a,measuringConfiguration:l}=n;return Cd((c,u)=>{if(e===null)return;const h=s.get(c);if(!h)return;const f=h.node.current;if(!f)return;const p=Sb(u);if(!p)return;const{transform:m}=Rr(u).getComputedStyle(u),y=fb(m);if(!y)return;const b=typeof e=="function"?e:pC(e);return bb(f,l.draggable.measure),b({active:{id:c,data:h.data,node:f,rect:l.draggable.measure(f)},draggableNodes:s,dragOverlay:{node:u,rect:l.dragOverlay.measure(p)},droppableContainers:a,measuringConfiguration:l,transform:y})})}function pC(n){const{duration:e,easing:s,sideEffects:a,keyframes:l}={...hC,...n};return c=>{let{active:u,dragOverlay:h,transform:f,...p}=c;if(!e)return;const m={x:h.rect.left-u.rect.left,y:h.rect.top-u.rect.top},y={scaleX:f.scaleX!==1?u.rect.width*f.scaleX/h.rect.width:1,scaleY:f.scaleY!==1?u.rect.height*f.scaleY/h.rect.height:1},b={x:f.x-m.x,y:f.y-m.y,...y},v=l({...p,active:u,dragOverlay:h,transform:{initial:f,final:b}}),[S]=v,_=v[v.length-1];if(JSON.stringify(S)===JSON.stringify(_))return;const w=a?.({active:u,dragOverlay:h,...p}),j=h.node.animate(v,{duration:e,easing:s,fill:"forwards"});return new Promise(N=>{j.onfinish=()=>{w?.(),N()}})}}let g0=0;function mC(n){return k.useMemo(()=>{if(n!=null)return g0++,g0},[n])}const cm=Ie.memo(n=>{let{adjustScale:e=!1,children:s,dropAnimation:a,style:l,transition:c,modifiers:u,wrapperElement:h="div",className:f,zIndex:p=999}=n;const{activatorEvent:m,active:y,activeNodeRect:b,containerNodeRect:v,draggableNodes:S,droppableContainers:_,dragOverlay:w,over:j,measuringConfiguration:N,scrollableAncestors:T,scrollableAncestorRects:R,windowRect:$}=Nb(),F=k.useContext(Td),q=mC(y?.id),I=kb(u,{activatorEvent:m,active:y,activeNodeRect:b,containerNodeRect:v,draggingNodeRect:w.rect,over:j,overlayNodeRect:w.rect,scrollableAncestors:T,scrollableAncestorRects:R,transform:F,windowRect:$}),U=am(b),P=fC({config:a,draggableNodes:S,droppableContainers:_,measuringConfiguration:N}),V=U?w.setRef:void 0;return Ie.createElement(oC,null,Ie.createElement(iC,{animation:P},y&&q?Ie.createElement(uC,{key:q,id:y.id,ref:V,as:h,activatorEvent:m,adjustScale:e,className:f,transition:c,rect:U,style:{zIndex:p,...l},transform:I},s):null))});function ra(n,e,s){const a=n.slice();return a.splice(s<0?a.length+s:s,0,a.splice(e,1)[0]),a}function gC(n,e){return n.reduce((s,a,l)=>{const c=e.get(a);return c&&(s[l]=c),s},Array(n.length))}function Ou(n){return n!==null&&n>=0}function yC(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==e[s])return!1;return!0}function vC(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const um=n=>{let{rects:e,activeIndex:s,overIndex:a,index:l}=n;const c=ra(e,a,s),u=e[l],h=c[l];return!h||!u?null:{x:h.left-u.left,y:h.top-u.top,scaleX:h.width/u.width,scaleY:h.height/u.height}},Du={scaleX:1,scaleY:1},qo=n=>{var e;let{activeIndex:s,activeNodeRect:a,index:l,rects:c,overIndex:u}=n;const h=(e=c[s])!=null?e:a;if(!h)return null;if(l===s){const p=c[u];return p?{x:0,y:s<u?p.top+p.height-(h.top+h.height):p.top-h.top,...Du}:null}const f=xC(c,l,s);return l>s&&l<=u?{x:0,y:-h.height-f,...Du}:l<s&&l>=u?{x:0,y:h.height+f,...Du}:{x:0,y:0,...Du}};function xC(n,e,s){const a=n[e],l=n[e-1],c=n[e+1];return a?s<e?l?a.top-(l.top+l.height):c?c.top-(a.top+a.height):0:c?c.top-(a.top+a.height):l?a.top-(l.top+l.height):0:0}const Eb="Sortable",Ab=Ie.createContext({activeIndex:-1,containerId:Eb,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:um,disabled:{draggable:!1,droppable:!1}});function Ua(n){let{children:e,id:s,items:a,strategy:l=um,disabled:c=!1}=n;const{active:u,dragOverlay:h,droppableRects:f,over:p,measureDroppableContainers:m}=Nb(),y=Sc(Eb,s),b=h.rect!==null,v=k.useMemo(()=>a.map(F=>typeof F=="object"&&"id"in F?F.id:F),[a]),S=u!=null,_=u?v.indexOf(u.id):-1,w=p?v.indexOf(p.id):-1,j=k.useRef(v),N=!yC(v,j.current),T=w!==-1&&_===-1||N,R=vC(c);Ts(()=>{N&&S&&m(v)},[N,v,S,m]),k.useEffect(()=>{j.current=v},[v]);const $=k.useMemo(()=>({activeIndex:_,containerId:y,disabled:R,disableTransforms:T,items:v,overIndex:w,useDragOverlay:b,sortedRects:gC(v,f),strategy:l}),[_,y,R.draggable,R.droppable,T,v,w,f,b,l]);return Ie.createElement(Ab.Provider,{value:$},e)}const bC=n=>{let{id:e,items:s,activeIndex:a,overIndex:l}=n;return ra(s,a,l).indexOf(e)},wC=n=>{let{containerId:e,isSorting:s,wasDragging:a,index:l,items:c,newIndex:u,previousItems:h,previousContainerId:f,transition:p}=n;return!p||!a||h!==c&&l===u?!1:s?!0:u!==l&&e===f},_C={duration:200,easing:"ease"},Tb="transform",SC=Br.Transition.toString({property:Tb,duration:0,easing:"linear"}),jC={roleDescription:"sortable"};function CC(n){let{disabled:e,index:s,node:a,rect:l}=n;const[c,u]=k.useState(null),h=k.useRef(s);return Ts(()=>{if(!e&&s!==h.current&&a.current){const f=l.current;if(f){const p=Ko(a.current,{ignoreTransform:!0}),m={x:f.left-p.left,y:f.top-p.top,scaleX:f.width/p.width,scaleY:f.height/p.height};(m.x||m.y)&&u(m)}}s!==h.current&&(h.current=s)},[e,s,a,l]),k.useEffect(()=>{c&&u(null)},[c]),c}function Ba(n){let{animateLayoutChanges:e=wC,attributes:s,disabled:a,data:l,getNewIndex:c=bC,id:u,strategy:h,resizeObserverConfig:f,transition:p=_C}=n;const{items:m,containerId:y,activeIndex:b,disabled:v,disableTransforms:S,sortedRects:_,overIndex:w,useDragOverlay:j,strategy:N}=k.useContext(Ab),T=kC(a,v),R=m.indexOf(u),$=k.useMemo(()=>({sortable:{containerId:y,index:R,items:m},...l}),[y,l,R,m]),F=k.useMemo(()=>m.slice(m.indexOf(u)),[m,u]),{rect:q,node:I,isOver:U,setNodeRef:P}=Cc({id:u,data:$,disabled:T.droppable,resizeObserverConfig:{updateMeasurementsFor:F,...f}}),{active:V,activatorEvent:D,activeNodeRect:H,attributes:C,setNodeRef:M,listeners:z,isDragging:B,over:K,setActivatorNodeRef:Q,transform:Z}=om({id:u,data:$,attributes:{...jC,...s},disabled:T.draggable}),A=G1(P,M),L=!!V,J=L&&!S&&Ou(b)&&Ou(w),ae=!j&&B,ue=ae&&J?Z:null,fe=J?ue??(h??N)({rects:_,activeNodeRect:H,activeIndex:b,overIndex:w,index:R}):null,ne=Ou(b)&&Ou(w)?c({id:u,items:m,activeIndex:b,overIndex:w}):R,be=V?.id,le=k.useRef({activeId:be,items:m,newIndex:ne,containerId:y}),ie=m!==le.current.items,Te=e({active:V,containerId:y,isDragging:B,isSorting:L,id:u,index:R,items:m,newIndex:le.current.newIndex,previousItems:le.current.items,previousContainerId:le.current.containerId,transition:p,wasDragging:le.current.activeId!=null}),Le=CC({disabled:!Te,index:R,node:I,rect:q});return k.useEffect(()=>{L&&le.current.newIndex!==ne&&(le.current.newIndex=ne),y!==le.current.containerId&&(le.current.containerId=y),m!==le.current.items&&(le.current.items=m)},[L,ne,y,m]),k.useEffect(()=>{if(be===le.current.activeId)return;if(be!=null&&le.current.activeId==null){le.current.activeId=be;return}const ve=setTimeout(()=>{le.current.activeId=be},50);return()=>clearTimeout(ve)},[be]),{active:V,activeIndex:b,attributes:C,data:$,rect:q,index:R,newIndex:ne,items:m,isOver:U,isSorting:L,isDragging:B,listeners:z,node:I,overIndex:w,over:K,setNodeRef:A,setActivatorNodeRef:Q,setDroppableNodeRef:P,setDraggableNodeRef:M,transform:Le??fe,transition:E()};function E(){if(Le||ie&&le.current.newIndex===R)return SC;if(!(ae&&!kd(D)||!p)&&(L||Te))return Br.Transition.toString({...p,property:Tb})}}function kC(n,e){var s,a;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(s=n?.draggable)!=null?s:e.draggable,droppable:(a=n?.droppable)!=null?a:e.droppable}}function dd(n){if(!n)return!1;const e=n.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const NC=[tn.Down,tn.Right,tn.Up,tn.Left],Rd=(n,e)=>{let{context:{active:s,collisionRect:a,droppableRects:l,droppableContainers:c,over:u,scrollableAncestors:h}}=e;if(NC.includes(n.code)){if(n.preventDefault(),!s||!a)return;const f=[];c.getEnabled().forEach(y=>{if(!y||y!=null&&y.disabled)return;const b=l.get(y.id);if(b)switch(n.code){case tn.Down:a.top<b.top&&f.push(y);break;case tn.Up:a.top>b.top&&f.push(y);break;case tn.Left:a.left>b.left&&f.push(y);break;case tn.Right:a.left<b.left&&f.push(y);break}});const p=lj({collisionRect:a,droppableRects:l,droppableContainers:f});let m=ub(p,"id");if(m===u?.id&&p.length>1&&(m=p[1].id),m!=null){const y=c.get(s.id),b=c.get(m),v=b?l.get(b.id):null,S=b?.node.current;if(S&&v&&y&&b){const w=Nd(S).some((F,q)=>h[q]!==F),j=Rb(y,b),N=EC(y,b),T=w||!j?{x:0,y:0}:{x:N?a.width-v.width:0,y:N?a.height-v.height:0},R={x:v.left,y:v.top};return T.x&&T.y?R:oc(R,T)}}}};function Rb(n,e){return!dd(n)||!dd(e)?!1:n.data.current.sortable.containerId===e.data.current.sortable.containerId}function EC(n,e){return!dd(n)||!dd(e)||!Rb(n,e)?!1:n.data.current.sortable.index<e.data.current.sortable.index}const AC=()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1,TC=(n,{mobile:e=!1}={})=>{if(!n||typeof n!="string"||n.startsWith("data:")||n.startsWith("blob:"))return n;if(n.includes("/storage/v1/object/public/")){const s=e?360:640,a=e?55:68,l=n.includes("?")?"&":"?";return`${n}${l}width=${s}&quality=${a}&resize=contain`}return n},y0=n=>{if(!n)return"";const e=new Date(n);return`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")}`},ta=n=>Array.isArray(n)?n.flatMap(e=>String(e||"").split(/[,]/)).map(e=>e.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(e=>e.trim()).filter(Boolean):[],RC=({recipe:n,isSelected:e,isSelectMode:s,onSelectRecipe:a,onToggleSelection:l,disableDrag:c,showOwner:u,ownerLabelFn:h,index:f=0,mobileView:p=!1})=>{const{attributes:m,listeners:y,setNodeRef:b,transform:v,transition:S,isDragging:_}=Ba({id:n.id,disabled:c}),w={transform:Br.Transform.toString(v),transition:S,opacity:_?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:c?"default":"grab"},j=p?4:8,N=f<j?"eager":"lazy",T=f<j?"high":"low",R=TC(n.image,{mobile:p});return r.jsx("div",{ref:b,style:w,...m,...y,children:r.jsxs(mn,{hoverable:!0,className:`recipe-card ${e?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some($=>/|Dessert/i.test($))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{s?l(n.id):a(n)},children:[r.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?r.jsx("img",{src:R,alt:n.title,className:"recipe-card__image",loading:N,decoding:"async",fetchPriority:T,sizes:p?"(max-width: 700px) 45vw, 320px":"(max-width: 1024px) 33vw, 280px"}):r.jsx("div",{className:"recipe-card__image placeholder"}),r.jsx("div",{className:"recipe-card__overlay"}),s&&r.jsx("div",{className:"recipe-card__selection-overlay",children:r.jsx("div",{className:`selection-checkbox ${e?"checked":""}`})}),r.jsx("div",{className:"recipe-card__tags",children:(()=>{const $=ta(n.tags);if($.length===0)return null;const F=$.filter(U=>!U.startsWith("owner:"));return(F.includes("URL")?["URL"]:F).slice(0,1).map((U,P)=>r.jsx("span",{className:"recipe-tag",children:U},`${U}-${P}`))})()})]}),r.jsxs("div",{className:"recipe-card__content",children:[r.jsx("h3",{className:"recipe-title",children:n.title}),r.jsx("p",{className:"recipe-desc",children:n.description}),r.jsxs("div",{className:"recipe-meta",children:[n.storeName&&r.jsxs("span",{children:[" ",n.storeName]}),u&&typeof h=="function"&&r.jsxs("span",{className:"recipe-owner",children:[" ",h(n)]}),r.jsxs("div",{className:"recipe-dates",children:[r.jsxs("span",{className:"recipe-date",children:[" : ",y0(n.created_at)]}),n.updated_at&&r.jsxs("span",{className:"recipe-date",children:[" : ",y0(n.updated_at)]})]})]})]})]})})},v0=n=>{const e=ta(n.tags);return n.type==="bread"||e.some(s=>/|Bread/i.test(s))},x0=n=>{const e=a=>/|Dessert/i.test(a),s=ta(n.tags);return/|Dessert/i.test(n.category||"")||s.some(e)},b0=n=>{const e=ta(n.tags);return/|Sauce/i.test(n.category||"")||e.some(s=>/|Sauce/i.test(s))},w0=n=>{const e=ta(n.tags);return/||Decor/i.test(n.category||"")||e.some(s=>/||Decor/i.test(s))},_0=n=>{const e=n.category||"",s=ta(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(e)||s.some(a=>/|Dressing||Vinaigrette||Mayonnaise/i.test(a))},S0=n=>{const e=n.filter(y=>v0(y)),s=n.filter(y=>!v0(y)),a=s.filter(y=>b0(y)),l=s.filter(y=>!b0(y)),c=l.filter(y=>w0(y)),u=l.filter(y=>!w0(y)),h=u.filter(y=>_0(y)),f=u.filter(y=>!_0(y)),p=f.filter(y=>x0(y));return{cookingRecipes:f.filter(y=>!x0(y)),breadRecipes:e,dessertRecipes:p,sauceRecipes:a,dressingRecipes:h,decorationRecipes:c}},j0=({recipes:n,onSelectRecipe:e,isSelectMode:s,selectedIds:a,onToggleSelection:l,disableDrag:c,displayMode:u="normal",publicRecipeView:h="none",showOwner:f=!1,ownerLabelFn:p,currentUser:m=null})=>{const[y,b]=k.useState({}),[v,S]=k.useState(()=>AC());Ie.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const B=window.matchMedia("(max-width: 700px)"),K=()=>S(!!B.matches);return K(),B.addEventListener?B.addEventListener("change",K):B.addListener(K),()=>{B.removeEventListener?B.removeEventListener("change",K):B.removeListener(K)}},[]);const _=B=>{b(K=>({...K,[B]:!K[B]}))},w=B=>ta(B?.tags).map(Q=>Q.toLowerCase()).includes("public"),j=B=>{if(!m)return!1;const K=ta(B?.tags).filter(Z=>Z.startsWith("owner:"));if(K.length===0)return!1;const Q=new Set([m?.id?`owner:${m.id}`:null,m?.displayId?`owner:${m.displayId}`:null].filter(Boolean));return K.some(Z=>Q.has(Z))},N=n.filter(B=>w(B)),T=N.filter(B=>j(B)),R=N.filter(B=>!j(B)),$=n.filter(B=>!w(B)),{cookingRecipes:F,breadRecipes:q,dessertRecipes:I,sauceRecipes:U,dressingRecipes:P,decorationRecipes:V}=S0($),[D,H]=k.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);Ie.useEffect(()=>{const B=()=>{window.innerWidth>=1024?H(9):H(8)};return window.addEventListener("resize",B),()=>window.removeEventListener("resize",B)},[]);const C=(B,K,Q,Z,{showWhenEmpty:A=!1,emptyMessage:L=""}={})=>{if(K.length===0&&!A)return null;const J=u==="all";let ae=K,ue=!1,Ce=!1;return J||(ue=y[Z],Ce=K.length>D,ae=ue?K:K.slice(0,D)),r.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[r.jsxs("h3",{onClick:()=>!J&&Ce&&_(Z),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!J&&Ce?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[r.jsx("span",{children:Q})," ",B,r.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",K.length,")"]}),!J&&Ce&&r.jsx("span",{className:"section-toggle-btn",children:ue?" ":" "})]}),r.jsx("div",{className:"recipe-grid",children:r.jsx(Ua,{items:ae.map(fe=>fe.id),strategy:um,children:ae.map((fe,ne)=>{const be=a&&a.has(fe.id);return r.jsx(RC,{recipe:fe,isSelected:be,isSelectMode:s,onSelectRecipe:e,onToggleSelection:l,disableDrag:c,showOwner:f,ownerLabelFn:p,index:ne,mobileView:v},fe.id)})})}),K.length===0&&r.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:L||`${B}`})]})},M=()=>{if(h!=="mine"&&h!=="others")return null;const B=h==="mine",K=B?"":"",Q=B?"":"",Z=B?"public-mine":"public-others",A=B?T:R,L=B?"":"",J=S0(A);return r.jsxs("div",{className:"public-recipes-block",children:[r.jsxs("div",{className:"public-recipes-block__header",children:[r.jsx("span",{children:Q}),r.jsx("span",{children:K}),r.jsxs("span",{className:"public-recipes-block__count",children:["(",A.length,")"]})]}),A.length===0?r.jsx("div",{className:"public-recipes-block__empty",children:L}):r.jsxs(r.Fragment,{children:[C("",J.cookingRecipes,"",`${Z}-cooking`),C("",J.breadRecipes,"",`${Z}-bread`),C("",J.dessertRecipes,"",`${Z}-dessert`),C("",J.sauceRecipes,"",`${Z}-sauce`),C("",J.dressingRecipes,"",`${Z}-dressing`),C("",J.decorationRecipes,"",`${Z}-decoration`)]})]})},z=h==="none"&&N.length>0&&$.length===0;return r.jsxs("div",{className:"recipe-list-container",children:[M(),z&&r.jsx("div",{className:"recipe-list-empty-hint",children:""}),C("",F,"","cooking"),C("",q,"","bread"),C("",I,"","dessert"),C("",U,"","sauce"),C("",P,"","dressing"),C("",V,"","decoration"),n.length===0&&r.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},rn=({isOpen:n,onClose:e,title:s,children:a,size:l="medium",showCloseButton:c=!0})=>{if(k.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),k.useEffect(()=>{const h=f=>{f.key==="Escape"&&n&&e()};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[n,e]),!n)return null;const u=h=>{h.target===h.currentTarget&&e()};return r.jsx("div",{className:"modal-overlay",onClick:u,children:r.jsxs("div",{className:`modal-content modal-${l}`,children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"modal-title",children:s}),c&&r.jsx("button",{className:"modal-close-btn",onClick:e,"aria-label":"",children:""})]}),r.jsx("div",{className:"modal-body",children:a})]})})};function Od(n,e){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s}function OC(n,e,s,a){function l(c){return c instanceof s?c:new s(function(u){u(c)})}return new(s||(s=Promise))(function(c,u){function h(m){try{p(a.next(m))}catch(y){u(y)}}function f(m){try{p(a.throw(m))}catch(y){u(y)}}function p(m){m.done?c(m.value):l(m.value).then(h,f)}p((a=a.apply(n,e||[])).next())})}const DC=n=>n?(...e)=>n(...e):(...e)=>fetch(...e);class dm extends Error{constructor(e,s="FunctionsError",a){super(e),this.name=s,this.context=a}}class zC extends dm{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class C0 extends dm{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class k0 extends dm{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Tp;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Tp||(Tp={}));class MC{constructor(e,{headers:s={},customFetch:a,region:l=Tp.Any}={}){this.url=e,this.headers=s,this.region=l,this.fetch=DC(a)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return OC(this,arguments,void 0,function*(s,a={}){var l;let c,u;try{const{headers:h,method:f,body:p,signal:m,timeout:y}=a;let b={},{region:v}=a;v||(v=this.region);const S=new URL(`${this.url}/${s}`);v&&v!=="any"&&(b["x-region"]=v,S.searchParams.set("forceFunctionRegion",v));let _;p&&(h&&!Object.prototype.hasOwnProperty.call(h,"Content-Type")||!h)?typeof Blob<"u"&&p instanceof Blob||p instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",_=p):typeof p=="string"?(b["Content-Type"]="text/plain",_=p):typeof FormData<"u"&&p instanceof FormData?_=p:(b["Content-Type"]="application/json",_=JSON.stringify(p)):p&&typeof p!="string"&&!(typeof Blob<"u"&&p instanceof Blob)&&!(p instanceof ArrayBuffer)&&!(typeof FormData<"u"&&p instanceof FormData)?_=JSON.stringify(p):_=p;let w=m;y&&(u=new AbortController,c=setTimeout(()=>u.abort(),y),m?(w=u.signal,m.addEventListener("abort",()=>u.abort())):w=u.signal);const j=yield this.fetch(S.toString(),{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),h),body:_,signal:w}).catch($=>{throw new zC($)}),N=j.headers.get("x-relay-error");if(N&&N==="true")throw new C0(j);if(!j.ok)throw new k0(j);let T=((l=j.headers.get("Content-Type"))!==null&&l!==void 0?l:"text/plain").split(";")[0].trim(),R;return T==="application/json"?R=yield j.json():T==="application/octet-stream"||T==="application/pdf"?R=yield j.blob():T==="text/event-stream"?R=j:T==="multipart/form-data"?R=yield j.formData():R=yield j.text(),{data:R,error:null,response:j}}catch(h){return{data:null,error:h,response:h instanceof k0||h instanceof C0?h.context:void 0}}finally{c&&clearTimeout(c)}})}}var LC=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},UC=class{constructor(n){var e,s,a;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(e=n.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=n.signal,this.isMaybeSingle=(s=n.isMaybeSingle)!==null&&s!==void 0?s:!1,this.urlLengthLimit=(a=n.urlLengthLimit)!==null&&a!==void 0?a:8e3,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=new Headers(this.headers),this.headers.set(n,e),this}then(n,e){var s=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{let u=null,h=null,f=null,p=c.status,m=c.statusText;if(c.ok){var y,b;if(s.method!=="HEAD"){var v;const j=await c.text();j===""||(s.headers.get("Accept")==="text/csv"||s.headers.get("Accept")&&(!((v=s.headers.get("Accept"))===null||v===void 0)&&v.includes("application/vnd.pgrst.plan+text"))?h=j:h=JSON.parse(j))}const _=(y=s.headers.get("Prefer"))===null||y===void 0?void 0:y.match(/count=(exact|planned|estimated)/),w=(b=c.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");_&&w&&w.length>1&&(f=parseInt(w[1])),s.isMaybeSingle&&s.method==="GET"&&Array.isArray(h)&&(h.length>1?(u={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,f=null,p=406,m="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{var S;const _=await c.text();try{u=JSON.parse(_),Array.isArray(u)&&c.status===404&&(h=[],u=null,p=200,m="OK")}catch{c.status===404&&_===""?(p=204,m="No Content"):u={message:_}}if(u&&s.isMaybeSingle&&(!(u==null||(S=u.details)===null||S===void 0)&&S.includes("0 rows"))&&(u=null,p=200,m="OK"),u&&s.shouldThrowOnError)throw new LC(u)}return{error:u,data:h,count:f,status:p,statusText:m}});return this.shouldThrowOnError||(l=l.catch(c=>{var u;let h="",f="",p="";const m=c?.cause;if(m){var y,b,v,S;const j=(y=m?.message)!==null&&y!==void 0?y:"",N=(b=m?.code)!==null&&b!==void 0?b:"";h=`${(v=c?.name)!==null&&v!==void 0?v:"FetchError"}: ${c?.message}`,h+=`

Caused by: ${(S=m?.name)!==null&&S!==void 0?S:"Error"}: ${j}`,N&&(h+=` (${N})`),m?.stack&&(h+=`
${m.stack}`)}else{var _;h=(_=c?.stack)!==null&&_!==void 0?_:""}const w=this.url.toString().length;return c?.name==="AbortError"||c?.code==="ABORT_ERR"?(p="",f="Request was aborted (timeout or manual cancellation)",w>this.urlLengthLimit&&(f+=`. Note: Your request URL is ${w} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(m?.name==="HeadersOverflowError"||m?.code==="UND_ERR_HEADERS_OVERFLOW")&&(p="",f="HTTP headers exceeded server limits (typically 16KB)",w>this.urlLengthLimit&&(f+=`. Your request URL is ${w} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:h,hint:f,code:p},data:null,count:null,status:0,statusText:""}})),l.then(n,e)}returns(){return this}overrideTypes(){return this}},IC=class extends UC{select(n){let e=!1;const s=(n??"*").split("").map(a=>/\s/.test(a)&&!e?"":(a==='"'&&(e=!e),a)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:e=!0,nullsFirst:s,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${n}.${e?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:s=e}={}){const a=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,e,{foreignTable:s,referencedTable:a=s}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${n}`),this.url.searchParams.set(c,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:e=!1,settings:s=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const h=[n?"analyze":null,e?"verbose":null,s?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${f}"; options=${h};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const N0=new RegExp("[,()]");var To=class extends IC{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}regexMatch(n,e){return this.url.searchParams.append(n,`match.${e}`),this}regexIMatch(n,e){return this.url.searchParams.append(n,`imatch.${e}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}isDistinct(n,e){return this.url.searchParams.append(n,`isdistinct.${e}`),this}in(n,e){const s=Array.from(new Set(e)).map(a=>typeof a=="string"&&N0.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`in.(${s})`),this}notIn(n,e){const s=Array.from(new Set(e)).map(a=>typeof a=="string"&&N0.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`not.in.(${s})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:s,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=s===void 0?"":`(${s})`;return this.url.searchParams.append(n,`${l}fts${c}.${e}`),this}match(n){return Object.entries(n).forEach(([e,s])=>{this.url.searchParams.append(e,`eq.${s}`)}),this}not(n,e,s){return this.url.searchParams.append(n,`not.${e}.${s}`),this}or(n,{foreignTable:e,referencedTable:s=e}={}){const a=s?`${s}.or`:"or";return this.url.searchParams.append(a,`(${n})`),this}filter(n,e,s){return this.url.searchParams.append(n,`${e}.${s}`),this}},BC=class{constructor(n,{headers:e={},schema:s,fetch:a,urlLengthLimit:l=8e3}){this.url=n,this.headers=new Headers(e),this.schema=s,this.fetch=a,this.urlLengthLimit=l}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(n,e){const{head:s=!1,count:a}=e??{},l=s?"HEAD":"GET";let c=!1;const u=(n??"*").split("").map(p=>/\s/.test(p)&&!c?"":(p==='"'&&(c=!c),p)).join(""),{url:h,headers:f}=this.cloneRequestState();return h.searchParams.set("select",u),a&&f.append("Prefer",`count=${a}`),new To({method:l,url:h,headers:f,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(n,{count:e,defaultToNull:s=!0}={}){var a;const l="POST",{url:c,headers:u}=this.cloneRequestState();if(e&&u.append("Prefer",`count=${e}`),s||u.append("Prefer","missing=default"),Array.isArray(n)){const h=n.reduce((f,p)=>f.concat(Object.keys(p)),[]);if(h.length>0){const f=[...new Set(h)].map(p=>`"${p}"`);c.searchParams.set("columns",f.join(","))}}return new To({method:l,url:c,headers:u,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(n,{onConflict:e,ignoreDuplicates:s=!1,count:a,defaultToNull:l=!0}={}){var c;const u="POST",{url:h,headers:f}=this.cloneRequestState();if(f.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),e!==void 0&&h.searchParams.set("on_conflict",e),a&&f.append("Prefer",`count=${a}`),l||f.append("Prefer","missing=default"),Array.isArray(n)){const p=n.reduce((m,y)=>m.concat(Object.keys(y)),[]);if(p.length>0){const m=[...new Set(p)].map(y=>`"${y}"`);h.searchParams.set("columns",m.join(","))}}return new To({method:u,url:h,headers:f,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch,urlLengthLimit:this.urlLengthLimit})}update(n,{count:e}={}){var s;const a="PATCH",{url:l,headers:c}=this.cloneRequestState();return e&&c.append("Prefer",`count=${e}`),new To({method:a,url:l,headers:c,schema:this.schema,body:n,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:n}={}){var e;const s="DELETE",{url:a,headers:l}=this.cloneRequestState();return n&&l.append("Prefer",`count=${n}`),new To({method:s,url:a,headers:l,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function cc(n){"@babel/helpers - typeof";return cc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cc(n)}function $C(n,e){if(cc(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,e);if(cc(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function PC(n){var e=$C(n,"string");return cc(e)=="symbol"?e:e+""}function qC(n,e,s){return(e=PC(e))in n?Object.defineProperty(n,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[e]=s,n}function E0(n,e){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,a)}return s}function zu(n){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?E0(Object(s),!0).forEach(function(a){qC(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):E0(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}var FC=class Ob{constructor(e,{headers:s={},schema:a,fetch:l,timeout:c,urlLengthLimit:u=8e3}={}){this.url=e,this.headers=new Headers(s),this.schemaName=a,this.urlLengthLimit=u;const h=l??globalThis.fetch;c!==void 0&&c>0?this.fetch=(f,p)=>{const m=new AbortController,y=setTimeout(()=>m.abort(),c),b=p?.signal;if(b){if(b.aborted)return clearTimeout(y),h(f,p);const v=()=>{clearTimeout(y),m.abort()};return b.addEventListener("abort",v,{once:!0}),h(f,zu(zu({},p),{},{signal:m.signal})).finally(()=>{clearTimeout(y),b.removeEventListener("abort",v)})}return h(f,zu(zu({},p),{},{signal:m.signal})).finally(()=>clearTimeout(y))}:this.fetch=h}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new BC(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new Ob(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,s={},{head:a=!1,get:l=!1,count:c}={}){var u;let h;const f=new URL(`${this.url}/rpc/${e}`);let p;const m=v=>v!==null&&typeof v=="object"&&(!Array.isArray(v)||v.some(m)),y=a&&Object.values(s).some(m);y?(h="POST",p=s):a||l?(h=a?"HEAD":"GET",Object.entries(s).filter(([v,S])=>S!==void 0).map(([v,S])=>[v,Array.isArray(S)?`{${S.join(",")}}`:`${S}`]).forEach(([v,S])=>{f.searchParams.append(v,S)})):(h="POST",p=s);const b=new Headers(this.headers);return y?b.set("Prefer",c?`count=${c},return=minimal`:"return=minimal"):c&&b.set("Prefer",`count=${c}`),new To({method:h,url:f,headers:b,schema:this.schemaName,body:p,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch,urlLengthLimit:this.urlLengthLimit})}};class HC{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const s=globalThis.process;if(s){const a=s.versions;if(a&&a.node){const l=a.node,c=parseInt(l.replace(/^v/,"").split(".")[0]);return c>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${c} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${c} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let s=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(s+=`

Suggested solution: ${e.workaround}`),new Error(s)}static createWebSocket(e,s){const a=this.getWebSocketConstructor();return new a(e,s)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const VC="2.97.0",GC=`realtime-js/${VC}`,WC="1.0.0",Db="2.0.0",A0=Db,Rp=1e4,KC=1e3,YC=100;var Yi;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Yi||(Yi={}));var cr;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(cr||(cr={}));var Ns;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Ns||(Ns={}));var Op;(function(n){n.websocket="websocket"})(Op||(Op={}));var Ta;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Ta||(Ta={}));class QC{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,s){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return s(this._binaryEncodeUserBroadcastPush(e));let a=[e.join_ref,e.ref,e.topic,e.event,e.payload];return s(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(e){var s;return this._isArrayBuffer((s=e.payload)===null||s===void 0?void 0:s.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var s,a;const l=(a=(s=e.payload)===null||s===void 0?void 0:s.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,l)}_encodeJsonUserBroadcastPush(e){var s,a;const l=(a=(s=e.payload)===null||s===void 0?void 0:s.payload)!==null&&a!==void 0?a:{},u=new TextEncoder().encode(JSON.stringify(l)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,u)}_encodeUserBroadcastPush(e,s,a){var l,c;const u=e.topic,h=(l=e.ref)!==null&&l!==void 0?l:"",f=(c=e.join_ref)!==null&&c!==void 0?c:"",p=e.payload.event,m=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},y=Object.keys(m).length===0?"":JSON.stringify(m);if(f.length>255)throw new Error(`joinRef length ${f.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`ref length ${h.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`topic length ${u.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`userEvent length ${p.length} exceeds maximum of 255`);if(y.length>255)throw new Error(`metadata length ${y.length} exceeds maximum of 255`);const b=this.USER_BROADCAST_PUSH_META_LENGTH+f.length+h.length+u.length+p.length+y.length,v=new ArrayBuffer(this.HEADER_LENGTH+b);let S=new DataView(v),_=0;S.setUint8(_++,this.KINDS.userBroadcastPush),S.setUint8(_++,f.length),S.setUint8(_++,h.length),S.setUint8(_++,u.length),S.setUint8(_++,p.length),S.setUint8(_++,y.length),S.setUint8(_++,s),Array.from(f,j=>S.setUint8(_++,j.charCodeAt(0))),Array.from(h,j=>S.setUint8(_++,j.charCodeAt(0))),Array.from(u,j=>S.setUint8(_++,j.charCodeAt(0))),Array.from(p,j=>S.setUint8(_++,j.charCodeAt(0))),Array.from(y,j=>S.setUint8(_++,j.charCodeAt(0)));var w=new Uint8Array(v.byteLength+a.byteLength);return w.set(new Uint8Array(v),0),w.set(new Uint8Array(a),v.byteLength),w.buffer}decode(e,s){if(this._isArrayBuffer(e)){let a=this._binaryDecode(e);return s(a)}if(typeof e=="string"){const a=JSON.parse(e),[l,c,u,h,f]=a;return s({join_ref:l,ref:c,topic:u,event:h,payload:f})}return s({})}_binaryDecode(e){const s=new DataView(e),a=s.getUint8(0),l=new TextDecoder;if(a===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,s,l)}_decodeUserBroadcast(e,s,a){const l=s.getUint8(1),c=s.getUint8(2),u=s.getUint8(3),h=s.getUint8(4);let f=this.HEADER_LENGTH+4;const p=a.decode(e.slice(f,f+l));f=f+l;const m=a.decode(e.slice(f,f+c));f=f+c;const y=a.decode(e.slice(f,f+u));f=f+u;const b=e.slice(f,e.byteLength),v=h===this.JSON_ENCODING?JSON.parse(a.decode(b)):b,S={type:this.BROADCAST_EVENT,event:m,payload:v};return u>0&&(S.meta=JSON.parse(y)),{join_ref:null,ref:null,topic:p,event:this.BROADCAST_EVENT,payload:S}}_isArrayBuffer(e){var s;return e instanceof ArrayBuffer||((s=e?.constructor)===null||s===void 0?void 0:s.name)==="ArrayBuffer"}_pick(e,s){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([a])=>s.includes(a)))}}class zb{constructor(e,s){this.callback=e,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Rn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Rn||(Rn={}));const T0=(n,e,s={})=>{var a;const l=(a=s.skipTypes)!==null&&a!==void 0?a:[];return e?Object.keys(e).reduce((c,u)=>(c[u]=JC(u,n,e,l),c),{}):{}},JC=(n,e,s,a)=>{const l=e.find(h=>h.name===n),c=l?.type,u=s[n];return c&&!a.includes(c)?Mb(c,u):Dp(u)},Mb=(n,e)=>{if(n.charAt(0)==="_"){const s=n.slice(1,n.length);return tk(e,s)}switch(n){case Rn.bool:return XC(e);case Rn.float4:case Rn.float8:case Rn.int2:case Rn.int4:case Rn.int8:case Rn.numeric:case Rn.oid:return ZC(e);case Rn.json:case Rn.jsonb:return ek(e);case Rn.timestamp:return nk(e);case Rn.abstime:case Rn.date:case Rn.daterange:case Rn.int4range:case Rn.int8range:case Rn.money:case Rn.reltime:case Rn.text:case Rn.time:case Rn.timestamptz:case Rn.timetz:case Rn.tsrange:case Rn.tstzrange:return Dp(e);default:return Dp(e)}},Dp=n=>n,XC=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},ZC=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},ek=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},tk=(n,e)=>{if(typeof n!="string")return n;const s=n.length-1,a=n[s];if(n[0]==="{"&&a==="}"){let c;const u=n.slice(1,s);try{c=JSON.parse("["+u+"]")}catch{c=u?u.split(","):[]}return c.map(h=>Mb(e,h))}return n},nk=n=>typeof n=="string"?n.replace(" ","T"):n,Lb=n=>{const e=new URL(n);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Gf{constructor(e,s,a={},l=Rp){this.channel=e,this.event=s,this.payload=a,this.timeout=l,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,s){var a;return this._hasReceived(e)&&s((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:e,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:s}){this.recHooks.filter(a=>a.status===e).forEach(a=>a.callback(s))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var R0;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(R0||(R0={}));class rc{constructor(e,s){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},l=>{const{onJoin:c,onLeave:u,onSync:h}=this.caller;this.joinRef=this.channel._joinRef(),this.state=rc.syncState(this.state,l,c,u),this.pendingDiffs.forEach(f=>{this.state=rc.syncDiff(this.state,f,c,u)}),this.pendingDiffs=[],h()}),this.channel._on(a.diff,{},l=>{const{onJoin:c,onLeave:u,onSync:h}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(l):(this.state=rc.syncDiff(this.state,l,c,u),h())}),this.onJoin((l,c,u)=>{this.channel._trigger("presence",{event:"join",key:l,currentPresences:c,newPresences:u})}),this.onLeave((l,c,u)=>{this.channel._trigger("presence",{event:"leave",key:l,currentPresences:c,leftPresences:u})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,s,a,l){const c=this.cloneDeep(e),u=this.transformState(s),h={},f={};return this.map(c,(p,m)=>{u[p]||(f[p]=m)}),this.map(u,(p,m)=>{const y=c[p];if(y){const b=m.map(w=>w.presence_ref),v=y.map(w=>w.presence_ref),S=m.filter(w=>v.indexOf(w.presence_ref)<0),_=y.filter(w=>b.indexOf(w.presence_ref)<0);S.length>0&&(h[p]=S),_.length>0&&(f[p]=_)}else h[p]=m}),this.syncDiff(c,{joins:h,leaves:f},a,l)}static syncDiff(e,s,a,l){const{joins:c,leaves:u}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return a||(a=()=>{}),l||(l=()=>{}),this.map(c,(h,f)=>{var p;const m=(p=e[h])!==null&&p!==void 0?p:[];if(e[h]=this.cloneDeep(f),m.length>0){const y=e[h].map(v=>v.presence_ref),b=m.filter(v=>y.indexOf(v.presence_ref)<0);e[h].unshift(...b)}a(h,m,f)}),this.map(u,(h,f)=>{let p=e[h];if(!p)return;const m=f.map(y=>y.presence_ref);p=p.filter(y=>m.indexOf(y.presence_ref)<0),e[h]=p,l(h,p,f),p.length===0&&delete e[h]}),e}static map(e,s){return Object.getOwnPropertyNames(e).map(a=>s(a,e[a]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((s,a)=>{const l=e[a];return"metas"in l?s[a]=l.metas.map(c=>(c.presence_ref=c.phx_ref,delete c.phx_ref,delete c.phx_ref_prev,c)):s[a]=l,s},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var O0;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(O0||(O0={}));var sc;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(sc||(sc={}));var ui;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(ui||(ui={}));class zo{constructor(e,s={config:{}},a){var l,c;if(this.topic=e,this.params=s,this.socket=a,this.bindings={},this.state=cr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new Gf(this,Ns.join,this.params,this.timeout),this.rejoinTimer=new zb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=cr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(u=>u.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=cr.closed,this.socket._remove(this)}),this._onError(u=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,u),this.state=cr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=cr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",u=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,u),this.state=cr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ns.reply,{},(u,h)=>{this._trigger(this._replyEventName(h),u)}),this.presence=new rc(this),this.broadcastEndpointURL=Lb(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((c=(l=this.params.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,s=this.timeout){var a,l,c;if(this.socket.isConnected()||this.socket.connect(),this.state==cr.closed){const{config:{broadcast:u,presence:h,private:f}}=this.params,p=(l=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(v=>v.filter))!==null&&l!==void 0?l:[],m=!!this.bindings[sc.PRESENCE]&&this.bindings[sc.PRESENCE].length>0||((c=this.params.config.presence)===null||c===void 0?void 0:c.enabled)===!0,y={},b={broadcast:u,presence:Object.assign(Object.assign({},h),{enabled:m}),postgres_changes:p,private:f};this.socket.accessTokenValue&&(y.access_token=this.socket.accessTokenValue),this._onError(v=>e?.(ui.CHANNEL_ERROR,v)),this._onClose(()=>e?.(ui.CLOSED)),this.updateJoinPayload(Object.assign({config:b},y)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:v})=>{var S;if(this.socket._isManualToken()||this.socket.setAuth(),v===void 0){e?.(ui.SUBSCRIBED);return}else{const _=this.bindings.postgres_changes,w=(S=_?.length)!==null&&S!==void 0?S:0,j=[];for(let N=0;N<w;N++){const T=_[N],{filter:{event:R,schema:$,table:F,filter:q}}=T,I=v&&v[N];if(I&&I.event===R&&zo.isFilterValueEqual(I.schema,$)&&zo.isFilterValueEqual(I.table,F)&&zo.isFilterValueEqual(I.filter,q))j.push(Object.assign(Object.assign({},T),{id:I.id}));else{this.unsubscribe(),this.state=cr.errored,e?.(ui.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=j,e&&e(ui.SUBSCRIBED);return}}).receive("error",v=>{this.state=cr.errored,e?.(ui.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{e?.(ui.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,s={}){return await this.send({type:"presence",event:"track",payload:e},s.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,s,a){return this.state===cr.joined&&e===sc.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,s,a)}async httpSend(e,s,a={}){var l;if(s==null)return Promise.reject("Payload is required for httpSend()");const c={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(c.Authorization=`Bearer ${this.socket.accessTokenValue}`);const u={method:"POST",headers:c,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:s,private:this.private}]})},h=await this._fetchWithTimeout(this.broadcastEndpointURL,u,(l=a.timeout)!==null&&l!==void 0?l:this.timeout);if(h.status===202)return{success:!0};let f=h.statusText;try{const p=await h.json();f=p.error||p.message||f}catch{}return Promise.reject(new Error(f))}async send(e,s={}){var a,l;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:c,payload:u}=e,h={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(h.Authorization=`Bearer ${this.socket.accessTokenValue}`);const f={method:"POST",headers:h,body:JSON.stringify({messages:[{topic:this.subTopic,event:c,payload:u,private:this.private}]})};try{const p=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(a=s.timeout)!==null&&a!==void 0?a:this.timeout);return await((l=p.body)===null||l===void 0?void 0:l.cancel()),p.ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(c=>{var u,h,f;const p=this._push(e.type,e,s.timeout||this.timeout);e.type==="broadcast"&&!(!((f=(h=(u=this.params)===null||u===void 0?void 0:u.config)===null||h===void 0?void 0:h.broadcast)===null||f===void 0)&&f.ack)&&c("ok"),p.receive("ok",()=>c("ok")),p.receive("error",()=>c("error")),p.receive("timeout",()=>c("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=cr.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ns.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(l=>{a=new Gf(this,Ns.leave,{},e),a.receive("ok",()=>{s(),l("ok")}).receive("timeout",()=>{s(),l("timed out")}).receive("error",()=>{l("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=cr.closed,this.bindings={}}async _fetchWithTimeout(e,s,a){const l=new AbortController,c=setTimeout(()=>l.abort(),a),u=await this.socket.fetch(e,Object.assign(Object.assign({},s),{signal:l.signal}));return clearTimeout(c),u}_push(e,s,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let l=new Gf(this,e,s,a);return this._canPush()?l.send():this._addToPushBuffer(l),l}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>YC){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(e,s,a){return s}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,s,a){var l,c;const u=e.toLocaleLowerCase(),{close:h,error:f,leave:p,join:m}=Ns;if(a&&[h,f,p,m].indexOf(u)>=0&&a!==this._joinRef())return;let b=this._onMessage(u,s,a);if(s&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(u)?(l=this.bindings.postgres_changes)===null||l===void 0||l.filter(v=>{var S,_,w;return((S=v.filter)===null||S===void 0?void 0:S.event)==="*"||((w=(_=v.filter)===null||_===void 0?void 0:_.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===u}).map(v=>v.callback(b,a)):(c=this.bindings[u])===null||c===void 0||c.filter(v=>{var S,_,w,j,N,T;if(["broadcast","presence","postgres_changes"].includes(u))if("id"in v){const R=v.id,$=(S=v.filter)===null||S===void 0?void 0:S.event;return R&&((_=s.ids)===null||_===void 0?void 0:_.includes(R))&&($==="*"||$?.toLocaleLowerCase()===((w=s.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const R=(N=(j=v?.filter)===null||j===void 0?void 0:j.event)===null||N===void 0?void 0:N.toLocaleLowerCase();return R==="*"||R===((T=s?.event)===null||T===void 0?void 0:T.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===u}).map(v=>{if(typeof b=="object"&&"ids"in b){const S=b.data,{schema:_,table:w,commit_timestamp:j,type:N,errors:T}=S;b=Object.assign(Object.assign({},{schema:_,table:w,commit_timestamp:j,eventType:N,new:{},old:{},errors:T}),this._getPayloadRecords(S))}v.callback(b,a)})}_isClosed(){return this.state===cr.closed}_isJoined(){return this.state===cr.joined}_isJoining(){return this.state===cr.joining}_isLeaving(){return this.state===cr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,s,a){const l=e.toLocaleLowerCase(),c={type:l,filter:s,callback:a};return this.bindings[l]?this.bindings[l].push(c):this.bindings[l]=[c],this}_off(e,s){const a=e.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(l=>{var c;return!(((c=l.type)===null||c===void 0?void 0:c.toLocaleLowerCase())===a&&zo.isEqual(l.filter,s))})),this}static isEqual(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const a in e)if(e[a]!==s[a])return!1;return!0}static isFilterValueEqual(e,s){return(e??void 0)===(s??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ns.close,{},e)}_onError(e){this._on(Ns.error,{},s=>e(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=cr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const s={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(s.new=T0(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(s.old=T0(e.columns,e.old_record)),s}}const Wf=()=>{},Mu={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},rk=[1e3,2e3,5e3,1e4],sk=1e4,ik=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ak{constructor(e,s){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Rp,this.transport=null,this.heartbeatIntervalMs=Mu.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Wf,this.ref=0,this.reconnectTimer=null,this.vsn=A0,this.logger=Wf,this.conn=null,this.sendBuffer=[],this.serializer=new QC,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=l=>l?(...c)=>l(...c):(...c)=>fetch(...c),!(!((a=s?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${e}/${Op.websocket}`,this.httpEndpoint=Lb(e),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=HC.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const s=e.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,s??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const s=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const e=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,s,a){this.logger(e,s,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Yi.connecting:return Ta.Connecting;case Yi.open:return Ta.Open;case Yi.closing:return Ta.Closing;default:return Ta.Closed}}isConnected(){return this.connectionState()===Ta.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,s={config:{}}){const a=`realtime:${e}`,l=this.getChannels().find(c=>c.topic===a);if(l)return l;{const c=new zo(`realtime:${e}`,s,this);return this.channels.push(c),c}}push(e){const{topic:s,event:a,payload:l,ref:c}=e,u=()=>{this.encode(e,h=>{var f;(f=this.conn)===null||f===void 0||f.send(h)})};this.log("push",`${s} ${a} (${c})`,l),this.isConnected()?u():this.sendBuffer.push(u)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(KC,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Mu.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let s=this.channels.find(a=>a.topic===e&&(a._isJoined()||a._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${e}"`),s.unsubscribe())}_remove(e){this.channels=this.channels.filter(s=>s.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply"&&s.ref&&s.ref===this.pendingHeartbeatRef){const p=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error",p)}catch(m){this.log("error","error in heartbeat callback",m)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:a,event:l,payload:c,ref:u}=s,h=u?`(${u})`:"",f=c.status||"";this.log("receive",`${f} ${a} ${l} ${h}`.trim(),c),this.channels.filter(p=>p._isMember(a)).forEach(p=>p._trigger(l,c,u)),this._triggerStateCallbacks("message",s)})}_clearTimer(e){var s;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Yi.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Yi.open||this.conn.readyState===Yi.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(s=>{this.log("error","error waiting for auth on connect",s),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this._terminateWorker()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var s;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(s){this.log("error","error in heartbeat callback",s)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ns.error))}_appendParams(e,s){if(Object.keys(s).length===0)return e;const a=e.match(/\?/)?"&":"?",l=new URLSearchParams(s);return`${e}${a}${l}`}_workerObjectUrl(e){let s;if(e)s=e;else{const a=new Blob([ik],{type:"application/javascript"});s=URL.createObjectURL(a)}return s}_setConnectionState(e,s=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(e=null){let s,a=!1;if(e)s=e,a=!0;else if(this.accessToken)try{s=await this.accessToken()}catch(l){this.log("error","Error fetching access token from callback",l),s=this.accessTokenValue}else s=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(l=>{const c={access_token:s,version:GC};s&&l.updateJoinPayload(c),l.joinedOnce&&l._isJoined()&&l._push(Ns.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(s=>{this.log("error",`Error setting auth in ${e}`,s)})}_triggerStateCallbacks(e,s){try{this.stateChangeCallbacks[e].forEach(a=>{try{a(s)}catch(l){this.log("error",`error in ${e} callback`,l)}})}catch(a){this.log("error",`error triggering ${e} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new zb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Mu.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var s,a,l,c,u,h,f,p,m,y,b,v;switch(this.transport=(s=e?.transport)!==null&&s!==void 0?s:null,this.timeout=(a=e?.timeout)!==null&&a!==void 0?a:Rp,this.heartbeatIntervalMs=(l=e?.heartbeatIntervalMs)!==null&&l!==void 0?l:Mu.HEARTBEAT_INTERVAL,this.worker=(c=e?.worker)!==null&&c!==void 0?c:!1,this.accessToken=(u=e?.accessToken)!==null&&u!==void 0?u:null,this.heartbeatCallback=(h=e?.heartbeatCallback)!==null&&h!==void 0?h:Wf,this.vsn=(f=e?.vsn)!==null&&f!==void 0?f:A0,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(p=e?.reconnectAfterMs)!==null&&p!==void 0?p:(S=>rk[S-1]||sk),this.vsn){case WC:this.encode=(m=e?.encode)!==null&&m!==void 0?m:((S,_)=>_(JSON.stringify(S))),this.decode=(y=e?.decode)!==null&&y!==void 0?y:((S,_)=>_(JSON.parse(S)));break;case Db:this.encode=(b=e?.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(v=e?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var uc=class extends Error{constructor(n,e){super(n),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function ok(n,e,s){const a=new URL(e,n);if(s)for(const[l,c]of Object.entries(s))c!==void 0&&a.searchParams.set(l,c);return a.toString()}async function lk(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function ck(n){const e=n.fetchImpl??globalThis.fetch;return{async request({method:s,path:a,query:l,body:c,headers:u}){const h=ok(n.baseUrl,a,l),f=await lk(n.auth),p=await e(h,{method:s,headers:{...c?{"Content-Type":"application/json"}:{},...f,...u},body:c?JSON.stringify(c):void 0}),m=await p.text(),y=(p.headers.get("content-type")||"").includes("application/json"),b=y&&m?JSON.parse(m):m;if(!p.ok){const v=y?b:void 0,S=v?.error;throw new uc(S?.message??`Request failed with status ${p.status}`,{status:p.status,icebergType:S?.type,icebergCode:S?.code,details:v})}return{status:p.status,headers:p.headers,data:b}}}}function Lu(n){return n.join("")}var uk=class{constructor(n,e=""){this.client=n,this.prefix=e}async listNamespaces(n){const e=n?{parent:Lu(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(n,e){const s={namespace:n.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Lu(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Lu(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Lu(n.namespace)}`}),!0}catch(e){if(e instanceof uc&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(n,e){try{return await this.createNamespace(n,e)}catch(s){if(s instanceof uc&&s.status===409)return;throw s}}};function yo(n){return n.join("")}var dk=class{constructor(n,e="",s){this.client=n,this.prefix=e,this.accessDelegation=s}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${yo(n.namespace)}/tables`})).data.identifiers}async createTable(n,e){const s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${yo(n.namespace)}/tables`,body:e,headers:s})).data.metadata}async updateTable(n,e){const s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${yo(n.namespace)}/tables/${n.name}`,body:e});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(n,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${yo(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(n){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${yo(n.namespace)}/tables/${n.name}`,headers:e})).data.metadata}async tableExists(n){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${yo(n.namespace)}/tables/${n.name}`,headers:e}),!0}catch(s){if(s instanceof uc&&s.status===404)return!1;throw s}}async createTableIfNotExists(n,e){try{return await this.createTable(n,e)}catch(s){if(s instanceof uc&&s.status===409)return await this.loadTable({namespace:n.namespace,name:e.name});throw s}}},hk=class{constructor(n){let e="v1";n.catalogName&&(e+=`/${n.catalogName}`);const s=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=ck({baseUrl:s,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new uk(this.client,e),this.tableOps=new dk(this.client,e,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,e){return this.namespaceOps.createNamespace(n,e)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,e){return this.tableOps.createTable(n,e)}async updateTable(n,e){return this.tableOps.updateTable(n,e)}async dropTable(n,e){await this.tableOps.dropTable(n,e)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,e){return this.namespaceOps.createNamespaceIfNotExists(n,e)}async createTableIfNotExists(n,e){return this.tableOps.createTableIfNotExists(n,e)}},Dd=class extends Error{constructor(n,e="storage",s,a){super(n),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=s,this.statusCode=a}};function zd(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var Uu=class extends Dd{constructor(n,e,s,a="storage"){super(n,a,e,s),this.name=a==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Ub=class extends Dd{constructor(n,e,s="storage"){super(n,s),this.name=s==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const fk=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),pk=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},zp=n=>{if(Array.isArray(n))return n.map(s=>zp(s));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([s,a])=>{const l=s.replace(/([-_][a-z])/gi,c=>c.toUpperCase().replace(/[-_]/g,""));e[l]=zp(a)}),e},mk=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function dc(n){"@babel/helpers - typeof";return dc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dc(n)}function gk(n,e){if(dc(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,e);if(dc(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function yk(n){var e=gk(n,"string");return dc(e)=="symbol"?e:e+""}function vk(n,e,s){return(e=yk(e))in n?Object.defineProperty(n,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[e]=s,n}function D0(n,e){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,a)}return s}function kt(n){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?D0(Object(s),!0).forEach(function(a){vk(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):D0(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}const z0=n=>{var e;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(e=n.error)===null||e===void 0?void 0:e.message)||JSON.stringify(n)},xk=async(n,e,s,a)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!s?.noResolveJson){const l=n,c=l.status||500;if(typeof l.json=="function")l.json().then(u=>{const h=u?.statusCode||u?.code||c+"";e(new Uu(z0(u),c,h,a))}).catch(()=>{if(a==="vectors"){const u=c+"";e(new Uu(l.statusText||`HTTP ${c} error`,c,u,a))}else{const u=c+"";e(new Uu(l.statusText||`HTTP ${c} error`,c,u,a))}});else{const u=c+"";e(new Uu(l.statusText||`HTTP ${c} error`,c,u,a))}}else e(new Ub(z0(n),n,a))},bk=(n,e,s,a)=>{const l={method:n,headers:e?.headers||{}};return n==="GET"||n==="HEAD"||!a?kt(kt({},l),s):(pk(a)?(l.headers=kt({"Content-Type":"application/json"},e?.headers),l.body=JSON.stringify(a)):l.body=a,e?.duplex&&(l.duplex=e.duplex),kt(kt({},l),s))};async function ql(n,e,s,a,l,c,u){return new Promise((h,f)=>{n(s,bk(e,a,l,c)).then(p=>{if(!p.ok)throw p;if(a?.noResolveJson)return p;if(u==="vectors"){const m=p.headers.get("content-type");if(p.headers.get("content-length")==="0"||p.status===204)return{};if(!m||!m.includes("application/json"))return{}}return p.json()}).then(p=>h(p)).catch(p=>xk(p,f,a,u))})}function Ib(n="storage"){return{get:async(e,s,a,l)=>ql(e,"GET",s,a,l,void 0,n),post:async(e,s,a,l,c)=>ql(e,"POST",s,l,c,a,n),put:async(e,s,a,l,c)=>ql(e,"PUT",s,l,c,a,n),head:async(e,s,a,l)=>ql(e,"HEAD",s,kt(kt({},a),{},{noResolveJson:!0}),l,void 0,n),remove:async(e,s,a,l,c)=>ql(e,"DELETE",s,l,c,a,n)}}const wk=Ib("storage"),{get:hc,post:ks,put:Mp,head:_k,remove:hm}=wk,Jr=Ib("vectors");var Xo=class{constructor(n,e={},s,a="storage"){this.shouldThrowOnError=!1,this.url=n,this.headers=e,this.fetch=fk(s),this.namespace=a}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=kt(kt({},this.headers),{},{[n]:e}),this}async handleOperation(n){var e=this;try{return{data:await n(),error:null}}catch(s){if(e.shouldThrowOnError)throw s;if(zd(s))return{data:null,error:s};throw s}}},Sk=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e}then(n,e){return this.execute().then(n,e)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(zd(e))return{data:null,error:e};throw e}}};let Bb;Bb=Symbol.toStringTag;var jk=class{constructor(n,e){this.downloadFn=n,this.shouldThrowOnError=e,this[Bb]="BlobDownloadBuilder",this.promise=null}asStream(){return new Sk(this.downloadFn,this.shouldThrowOnError)}then(n,e){return this.getPromise().then(n,e)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(e){if(n.shouldThrowOnError)throw e;if(zd(e))return{data:null,error:e};throw e}}};const Ck={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},M0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var kk=class extends Xo{constructor(n,e={},s,a){super(n,e,a,"storage"),this.bucketId=s}async uploadOrUpdate(n,e,s,a){var l=this;return l.handleOperation(async()=>{let c;const u=kt(kt({},M0),a);let h=kt(kt({},l.headers),n==="POST"&&{"x-upsert":String(u.upsert)});const f=u.metadata;typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),f&&c.append("metadata",l.encodeMetadata(f)),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.has("cacheControl")||c.append("cacheControl",u.cacheControl),f&&!c.has("metadata")&&c.append("metadata",l.encodeMetadata(f))):(c=s,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType,f&&(h["x-metadata"]=l.toBase64(l.encodeMetadata(f))),(typeof ReadableStream<"u"&&c instanceof ReadableStream||c&&typeof c=="object"&&"pipe"in c&&typeof c.pipe=="function")&&!u.duplex&&(u.duplex="half")),a?.headers&&(h=kt(kt({},h),a.headers));const p=l._removeEmptyFolders(e),m=l._getFinalPath(p),y=await(n=="PUT"?Mp:ks)(l.fetch,`${l.url}/object/${m}`,c,kt({headers:h},u?.duplex?{duplex:u.duplex}:{}));return{path:p,id:y.Id,fullPath:y.Key}})}async upload(n,e,s){return this.uploadOrUpdate("POST",n,e,s)}async uploadToSignedUrl(n,e,s,a){var l=this;const c=l._removeEmptyFolders(n),u=l._getFinalPath(c),h=new URL(l.url+`/object/upload/sign/${u}`);return h.searchParams.set("token",e),l.handleOperation(async()=>{let f;const p=kt({upsert:M0.upsert},a),m=kt(kt({},l.headers),{"x-upsert":String(p.upsert)});return typeof Blob<"u"&&s instanceof Blob?(f=new FormData,f.append("cacheControl",p.cacheControl),f.append("",s)):typeof FormData<"u"&&s instanceof FormData?(f=s,f.append("cacheControl",p.cacheControl)):(f=s,m["cache-control"]=`max-age=${p.cacheControl}`,m["content-type"]=p.contentType),{path:c,fullPath:(await Mp(l.fetch,h.toString(),f,{headers:m})).Key}})}async createSignedUploadUrl(n,e){var s=this;return s.handleOperation(async()=>{let a=s._getFinalPath(n);const l=kt({},s.headers);e?.upsert&&(l["x-upsert"]="true");const c=await ks(s.fetch,`${s.url}/object/upload/sign/${a}`,{},{headers:l}),u=new URL(s.url+c.url),h=u.searchParams.get("token");if(!h)throw new Dd("No token returned by API");return{signedUrl:u.toString(),path:n,token:h}})}async update(n,e,s){return this.uploadOrUpdate("PUT",n,e,s)}async move(n,e,s){var a=this;return a.handleOperation(async()=>await ks(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:n,destinationKey:e,destinationBucket:s?.destinationBucket},{headers:a.headers}))}async copy(n,e,s){var a=this;return a.handleOperation(async()=>({path:(await ks(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:n,destinationKey:e,destinationBucket:s?.destinationBucket},{headers:a.headers})).Key}))}async createSignedUrl(n,e,s){var a=this;return a.handleOperation(async()=>{let l=a._getFinalPath(n),c=await ks(a.fetch,`${a.url}/object/sign/${l}`,kt({expiresIn:e},s?.transform?{transform:s.transform}:{}),{headers:a.headers});const u=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{signedUrl:encodeURI(`${a.url}${c.signedURL}${u}`)}})}async createSignedUrls(n,e,s){var a=this;return a.handleOperation(async()=>{const l=await ks(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:e,paths:n},{headers:a.headers}),c=s?.download?`&download=${s.download===!0?"":s.download}`:"";return l.map(u=>kt(kt({},u),{},{signedUrl:u.signedURL?encodeURI(`${a.url}${u.signedURL}${c}`):null}))})}download(n,e,s){const a=typeof e?.transform<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString(e?.transform||{}),c=l?`?${l}`:"",u=this._getFinalPath(n),h=()=>hc(this.fetch,`${this.url}/${a}/${u}${c}`,{headers:this.headers,noResolveJson:!0},s);return new jk(h,this.shouldThrowOnError)}async info(n){var e=this;const s=e._getFinalPath(n);return e.handleOperation(async()=>zp(await hc(e.fetch,`${e.url}/object/info/${s}`,{headers:e.headers})))}async exists(n){var e=this;const s=e._getFinalPath(n);try{return await _k(e.fetch,`${e.url}/object/${s}`,{headers:e.headers}),{data:!0,error:null}}catch(a){if(e.shouldThrowOnError)throw a;if(zd(a)&&a instanceof Ub){const l=a.originalError;if([400,404].includes(l?.status))return{data:!1,error:a}}throw a}}getPublicUrl(n,e){const s=this._getFinalPath(n),a=[],l=e?.download?`download=${e.download===!0?"":e.download}`:"";l!==""&&a.push(l);const c=typeof e?.transform<"u"?"render/image":"object",u=this.transformOptsToQueryString(e?.transform||{});u!==""&&a.push(u);let h=a.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${s}${h}`)}}}async remove(n){var e=this;return e.handleOperation(async()=>await hm(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:n},{headers:e.headers}))}async list(n,e,s){var a=this;return a.handleOperation(async()=>{const l=kt(kt(kt({},Ck),e),{},{prefix:n||""});return await ks(a.fetch,`${a.url}/object/list/${a.bucketId}`,l,{headers:a.headers},s)})}async listV2(n,e){var s=this;return s.handleOperation(async()=>{const a=kt({},n);return await ks(s.fetch,`${s.url}/object/list-v2/${s.bucketId}`,a,{headers:s.headers},e)})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};const Nk="2.97.0",kc={"X-Client-Info":`storage-js/${Nk}`};var Ek=class extends Xo{constructor(n,e={},s,a){const l=new URL(n);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase."));const c=l.href.replace(/\/$/,""),u=kt(kt({},kc),e);super(c,u,s,"storage")}async listBuckets(n){var e=this;return e.handleOperation(async()=>{const s=e.listBucketOptionsToQueryString(n);return await hc(e.fetch,`${e.url}/bucket${s}`,{headers:e.headers})})}async getBucket(n){var e=this;return e.handleOperation(async()=>await hc(e.fetch,`${e.url}/bucket/${n}`,{headers:e.headers}))}async createBucket(n,e={public:!1}){var s=this;return s.handleOperation(async()=>await ks(s.fetch,`${s.url}/bucket`,{id:n,name:n,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:s.headers}))}async updateBucket(n,e){var s=this;return s.handleOperation(async()=>await Mp(s.fetch,`${s.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:s.headers}))}async emptyBucket(n){var e=this;return e.handleOperation(async()=>await ks(e.fetch,`${e.url}/bucket/${n}/empty`,{},{headers:e.headers}))}async deleteBucket(n){var e=this;return e.handleOperation(async()=>await hm(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(n){const e={};return n&&("limit"in n&&(e.limit=String(n.limit)),"offset"in n&&(e.offset=String(n.offset)),n.search&&(e.search=n.search),n.sortColumn&&(e.sortColumn=n.sortColumn),n.sortOrder&&(e.sortOrder=n.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Ak=class extends Xo{constructor(n,e={},s){const a=n.replace(/\/$/,""),l=kt(kt({},kc),e);super(a,l,s,"storage")}async createBucket(n){var e=this;return e.handleOperation(async()=>await ks(e.fetch,`${e.url}/bucket`,{name:n},{headers:e.headers}))}async listBuckets(n){var e=this;return e.handleOperation(async()=>{const s=new URLSearchParams;n?.limit!==void 0&&s.set("limit",n.limit.toString()),n?.offset!==void 0&&s.set("offset",n.offset.toString()),n?.sortColumn&&s.set("sortColumn",n.sortColumn),n?.sortOrder&&s.set("sortOrder",n.sortOrder),n?.search&&s.set("search",n.search);const a=s.toString(),l=a?`${e.url}/bucket?${a}`:`${e.url}/bucket`;return await hc(e.fetch,l,{headers:e.headers})})}async deleteBucket(n){var e=this;return e.handleOperation(async()=>await hm(e.fetch,`${e.url}/bucket/${n}`,{},{headers:e.headers}))}from(n){var e=this;if(!mk(n))throw new Dd("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const s=new hk({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(s,{get(l,c){const u=l[c];return typeof u!="function"?u:async(...h)=>{try{return{data:await u.apply(l,h),error:null}}catch(f){if(a)throw f;return{data:null,error:f}}}}})}},Tk=class extends Xo{constructor(n,e={},s){const a=n.replace(/\/$/,""),l=kt(kt({},kc),{},{"Content-Type":"application/json"},e);super(a,l,s,"vectors")}async createIndex(n){var e=this;return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/CreateIndex`,n,{headers:e.headers})||{})}async getIndex(n,e){var s=this;return s.handleOperation(async()=>await Jr.post(s.fetch,`${s.url}/GetIndex`,{vectorBucketName:n,indexName:e},{headers:s.headers}))}async listIndexes(n){var e=this;return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/ListIndexes`,n,{headers:e.headers}))}async deleteIndex(n,e){var s=this;return s.handleOperation(async()=>await Jr.post(s.fetch,`${s.url}/DeleteIndex`,{vectorBucketName:n,indexName:e},{headers:s.headers})||{})}},Rk=class extends Xo{constructor(n,e={},s){const a=n.replace(/\/$/,""),l=kt(kt({},kc),{},{"Content-Type":"application/json"},e);super(a,l,s,"vectors")}async putVectors(n){var e=this;if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/PutVectors`,n,{headers:e.headers})||{})}async getVectors(n){var e=this;return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/GetVectors`,n,{headers:e.headers}))}async listVectors(n){var e=this;if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/ListVectors`,n,{headers:e.headers}))}async queryVectors(n){var e=this;return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/QueryVectors`,n,{headers:e.headers}))}async deleteVectors(n){var e=this;if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/DeleteVectors`,n,{headers:e.headers})||{})}},Ok=class extends Xo{constructor(n,e={},s){const a=n.replace(/\/$/,""),l=kt(kt({},kc),{},{"Content-Type":"application/json"},e);super(a,l,s,"vectors")}async createBucket(n){var e=this;return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:e.headers})||{})}async getBucket(n){var e=this;return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:n},{headers:e.headers}))}async listBuckets(n={}){var e=this;return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/ListVectorBuckets`,n,{headers:e.headers}))}async deleteBucket(n){var e=this;return e.handleOperation(async()=>await Jr.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:e.headers})||{})}},Dk=class extends Ok{constructor(n,e={}){super(n,e.headers||{},e.fetch)}from(n){return new zk(this.url,this.headers,n,this.fetch)}async createBucket(n){var e=()=>super.createBucket,s=this;return e().call(s,n)}async getBucket(n){var e=()=>super.getBucket,s=this;return e().call(s,n)}async listBuckets(n={}){var e=()=>super.listBuckets,s=this;return e().call(s,n)}async deleteBucket(n){var e=()=>super.deleteBucket,s=this;return e().call(s,n)}},zk=class extends Tk{constructor(n,e,s,a){super(n,e,a),this.vectorBucketName=s}async createIndex(n){var e=()=>super.createIndex,s=this;return e().call(s,kt(kt({},n),{},{vectorBucketName:s.vectorBucketName}))}async listIndexes(n={}){var e=()=>super.listIndexes,s=this;return e().call(s,kt(kt({},n),{},{vectorBucketName:s.vectorBucketName}))}async getIndex(n){var e=()=>super.getIndex,s=this;return e().call(s,s.vectorBucketName,n)}async deleteIndex(n){var e=()=>super.deleteIndex,s=this;return e().call(s,s.vectorBucketName,n)}index(n){return new Mk(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},Mk=class extends Rk{constructor(n,e,s,a,l){super(n,e,l),this.vectorBucketName=s,this.indexName=a}async putVectors(n){var e=()=>super.putVectors,s=this;return e().call(s,kt(kt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async getVectors(n){var e=()=>super.getVectors,s=this;return e().call(s,kt(kt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async listVectors(n={}){var e=()=>super.listVectors,s=this;return e().call(s,kt(kt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async queryVectors(n){var e=()=>super.queryVectors,s=this;return e().call(s,kt(kt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}async deleteVectors(n){var e=()=>super.deleteVectors,s=this;return e().call(s,kt(kt({},n),{},{vectorBucketName:s.vectorBucketName,indexName:s.indexName}))}},Lk=class extends Ek{constructor(n,e={},s,a){super(n,e,s,a)}from(n){return new kk(this.url,this.headers,n,this.fetch)}get vectors(){return new Dk(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Ak(this.url+"/iceberg",this.headers,this.fetch)}};const $b="2.97.0",Ro=30*1e3,Lp=3,Kf=Lp*Ro,Uk="http://localhost:9999",Ik="supabase.auth.token",Bk={"X-Client-Info":`gotrue-js/${$b}`},Up="X-Supabase-Api-Version",Pb={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},$k=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Pk=600*1e3;class fc extends Error{constructor(e,s,a){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=a}}function xt(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class qk extends fc{constructor(e,s,a){super(e,s,a),this.name="AuthApiError",this.status=s,this.code=a}}function Fk(n){return xt(n)&&n.name==="AuthApiError"}class Ra extends fc{constructor(e,s){super(e),this.name="AuthUnknownError",this.originalError=s}}class yi extends fc{constructor(e,s,a,l){super(e,a,l),this.name=s,this.status=a}}class Yr extends yi{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Yf(n){return xt(n)&&n.name==="AuthSessionMissingError"}class vo extends yi{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Iu extends yi{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Bu extends yi{constructor(e,s=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Hk(n){return xt(n)&&n.name==="AuthImplicitGrantRedirectError"}class L0 extends yi{constructor(e,s=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Vk extends yi{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Ip extends yi{constructor(e,s){super(e,"AuthRetryableFetchError",s,void 0)}}function Qf(n){return xt(n)&&n.name==="AuthRetryableFetchError"}class U0 extends yi{constructor(e,s,a){super(e,"AuthWeakPasswordError",s,"weak_password"),this.reasons=a}}class Bp extends yi{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const hd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),I0=` 	
\r=`.split(""),Gk=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<I0.length;e+=1)n[I0[e].charCodeAt(0)]=-2;for(let e=0;e<hd.length;e+=1)n[hd[e].charCodeAt(0)]=e;return n})();function B0(n,e,s){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const a=e.queue>>e.queuedBits-6&63;s(hd[a]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const a=e.queue>>e.queuedBits-6&63;s(hd[a]),e.queuedBits-=6}}function qb(n,e,s){const a=Gk[n];if(a>-1)for(e.queue=e.queue<<6|a,e.queuedBits+=6;e.queuedBits>=8;)s(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function $0(n){const e=[],s=u=>{e.push(String.fromCodePoint(u))},a={utf8seq:0,codepoint:0},l={queue:0,queuedBits:0},c=u=>{Yk(u,a,s)};for(let u=0;u<n.length;u+=1)qb(n.charCodeAt(u),l,c);return e.join("")}function Wk(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Kk(n,e){for(let s=0;s<n.length;s+=1){let a=n.charCodeAt(s);if(a>55295&&a<=56319){const l=(a-55296)*1024&65535;a=(n.charCodeAt(s+1)-56320&65535|l)+65536,s+=1}Wk(a,e)}}function Yk(n,e,s){if(e.utf8seq===0){if(n<=127){s(n);return}for(let a=1;a<6;a+=1)if((n>>7-a&1)===0){e.utf8seq=a;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&s(e.codepoint)}}function Uo(n){const e=[],s={queue:0,queuedBits:0},a=l=>{e.push(l)};for(let l=0;l<n.length;l+=1)qb(n.charCodeAt(l),s,a);return new Uint8Array(e)}function Qk(n){const e=[];return Kk(n,s=>e.push(s)),new Uint8Array(e)}function za(n){const e=[],s={queue:0,queuedBits:0},a=l=>{e.push(l)};return n.forEach(l=>B0(l,s,a)),B0(null,s,a),e.join("")}function Jk(n){return Math.round(Date.now()/1e3)+n}function Xk(){return Symbol("auth-callback")}const kr=()=>typeof window<"u"&&typeof document<"u",_a={tested:!1,writable:!1},Fb=()=>{if(!kr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_a.tested)return _a.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),_a.tested=!0,_a.writable=!0}catch{_a.tested=!0,_a.writable=!1}return _a.writable};function Zk(n){const e={},s=new URL(n);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((l,c)=>{e[c]=l})}catch{}return s.searchParams.forEach((a,l)=>{e[l]=a}),e}const Hb=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),eN=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Oo=async(n,e,s)=>{await n.setItem(e,JSON.stringify(s))},Sa=async(n,e)=>{const s=await n.getItem(e);if(!s)return null;try{return JSON.parse(s)}catch{return s}},jr=async(n,e)=>{await n.removeItem(e)};class Md{constructor(){this.promise=new Md.promiseConstructor((e,s)=>{this.resolve=e,this.reject=s})}}Md.promiseConstructor=Promise;function $u(n){const e=n.split(".");if(e.length!==3)throw new Bp("Invalid JWT structure");for(let a=0;a<e.length;a++)if(!$k.test(e[a]))throw new Bp("JWT not in base64url format");return{header:JSON.parse($0(e[0])),payload:JSON.parse($0(e[1])),signature:Uo(e[2]),raw:{header:e[0],payload:e[1]}}}async function tN(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function nN(n,e){return new Promise((a,l)=>{(async()=>{for(let c=0;c<1/0;c++)try{const u=await n(c);if(!e(c,null,u)){a(u);return}}catch(u){if(!e(c,u)){l(u);return}}})()})}function rN(n){return("0"+n.toString(16)).substr(-2)}function sN(){const e=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=s.length;let l="";for(let c=0;c<56;c++)l+=s.charAt(Math.floor(Math.random()*a));return l}return crypto.getRandomValues(e),Array.from(e,rN).join("")}async function iN(n){const s=new TextEncoder().encode(n),a=await crypto.subtle.digest("SHA-256",s),l=new Uint8Array(a);return Array.from(l).map(c=>String.fromCharCode(c)).join("")}async function aN(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const s=await iN(n);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function xo(n,e,s=!1){const a=sN();let l=a;s&&(l+="/PASSWORD_RECOVERY"),await Oo(n,`${e}-code-verifier`,l);const c=await aN(a);return[c,a===c?"plain":"s256"]}const oN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function lN(n){const e=n.headers.get(Up);if(!e||!e.match(oN))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function cN(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function uN(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const dN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function bo(n){if(!dN.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Jf(){const n={};return new Proxy(n,{get:(e,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const a=s.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function hN(n,e){return new Proxy(n,{get:(s,a,l)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const c=a.toString();if(c==="Symbol(Symbol.toPrimitive)"||c==="Symbol(Symbol.toStringTag)"||c==="Symbol(util.inspect.custom)"||c==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(s,a,l)}return!e.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(s,a,l)}})}function P0(n){return JSON.parse(JSON.stringify(n))}const Aa=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),fN=[502,503,504];async function q0(n){var e;if(!eN(n))throw new Ip(Aa(n),0);if(fN.includes(n.status))throw new Ip(Aa(n),n.status);let s;try{s=await n.json()}catch(c){throw new Ra(Aa(c),c)}let a;const l=lN(n);if(l&&l.getTime()>=Pb["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?a=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(a=s.error_code),a){if(a==="weak_password")throw new U0(Aa(s),n.status,((e=s.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(a==="session_not_found")throw new Yr}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((c,u)=>c&&typeof u=="string",!0))throw new U0(Aa(s),n.status,s.weak_password.reasons);throw new qk(Aa(s),n.status||500,a)}const pN=(n,e,s,a)=>{const l={method:n,headers:e?.headers||{}};return n==="GET"?l:(l.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),l.body=JSON.stringify(a),Object.assign(Object.assign({},l),s))};async function Nt(n,e,s,a){var l;const c=Object.assign({},a?.headers);c[Up]||(c[Up]=Pb["2024-01-01"].name),a?.jwt&&(c.Authorization=`Bearer ${a.jwt}`);const u=(l=a?.query)!==null&&l!==void 0?l:{};a?.redirectTo&&(u.redirect_to=a.redirectTo);const h=Object.keys(u).length?"?"+new URLSearchParams(u).toString():"",f=await mN(n,e,s+h,{headers:c,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(f):{data:Object.assign({},f),error:null}}async function mN(n,e,s,a,l,c){const u=pN(e,a,l,c);let h;try{h=await n(s,Object.assign({},u))}catch(f){throw console.error(f),new Ip(Aa(f),0)}if(h.ok||await q0(h),a?.noResolveJson)return h;try{return await h.json()}catch(f){await q0(f)}}function Ss(n){var e;let s=null;vN(n)&&(s=Object.assign({},n),n.expires_at||(s.expires_at=Jk(n.expires_in)));const a=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:s,user:a},error:null}}function F0(n){const e=Ss(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ji(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function gN(n){return{data:n,error:null}}function yN(n){const{action_link:e,email_otp:s,hashed_token:a,redirect_to:l,verification_type:c}=n,u=Od(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),h={action_link:e,email_otp:s,hashed_token:a,redirect_to:l,verification_type:c},f=Object.assign({},u);return{data:{properties:h,user:f},error:null}}function H0(n){return n}function vN(n){return n.access_token&&n.refresh_token&&n.expires_in}const Xf=["global","local","others"];class xN{constructor({url:e="",headers:s={},fetch:a}){this.url=e,this.headers=s,this.fetch=Hb(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,s=Xf[0]){if(Xf.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Xf.join(", ")}`);try{return await Nt(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(a){if(xt(a))return{data:null,error:a};throw a}}async inviteUserByEmail(e,s={}){try{return await Nt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Ji})}catch(a){if(xt(a))return{data:{user:null},error:a};throw a}}async generateLink(e){try{const{options:s}=e,a=Od(e,["options"]),l=Object.assign(Object.assign({},a),s);return"newEmail"in a&&(l.new_email=a?.newEmail,delete l.newEmail),await Nt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:l,headers:this.headers,xform:yN,redirectTo:s?.redirectTo})}catch(s){if(xt(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(e){try{return await Nt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ji})}catch(s){if(xt(s))return{data:{user:null},error:s};throw s}}async listUsers(e){var s,a,l,c,u,h,f;try{const p={nextPage:null,lastPage:0,total:0},m=await Nt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=e?.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(c=(l=e?.perPage)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""},xform:H0});if(m.error)throw m.error;const y=await m.json(),b=(u=m.headers.get("x-total-count"))!==null&&u!==void 0?u:0,v=(f=(h=m.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return v.length>0&&(v.forEach(S=>{const _=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(S.split(";")[1].split("=")[1]);p[`${w}Page`]=_}),p.total=parseInt(b)),{data:Object.assign(Object.assign({},y),p),error:null}}catch(p){if(xt(p))return{data:{users:[]},error:p};throw p}}async getUserById(e){bo(e);try{return await Nt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ji})}catch(s){if(xt(s))return{data:{user:null},error:s};throw s}}async updateUserById(e,s){bo(e);try{return await Nt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:s,headers:this.headers,xform:Ji})}catch(a){if(xt(a))return{data:{user:null},error:a};throw a}}async deleteUser(e,s=!1){bo(e);try{return await Nt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:s},xform:Ji})}catch(a){if(xt(a))return{data:{user:null},error:a};throw a}}async _listFactors(e){bo(e.userId);try{const{data:s,error:a}=await Nt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:l=>({data:{factors:l},error:null})});return{data:s,error:a}}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _deleteFactor(e){bo(e.userId),bo(e.id);try{return{data:await Nt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _listOAuthClients(e){var s,a,l,c,u,h,f;try{const p={nextPage:null,lastPage:0,total:0},m=await Nt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(s=e?.page)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:"",per_page:(c=(l=e?.perPage)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""},xform:H0});if(m.error)throw m.error;const y=await m.json(),b=(u=m.headers.get("x-total-count"))!==null&&u!==void 0?u:0,v=(f=(h=m.headers.get("link"))===null||h===void 0?void 0:h.split(","))!==null&&f!==void 0?f:[];return v.length>0&&(v.forEach(S=>{const _=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(S.split(";")[1].split("=")[1]);p[`${w}Page`]=_}),p.total=parseInt(b)),{data:Object.assign(Object.assign({},y),p),error:null}}catch(p){if(xt(p))return{data:{clients:[]},error:p};throw p}}async _createOAuthClient(e){try{return await Nt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _getOAuthClient(e){try{return await Nt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _updateOAuthClient(e,s){try{return await Nt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:s,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(xt(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(e){try{return await Nt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(s){if(xt(s))return{data:null,error:s};throw s}}async _regenerateOAuthClientSecret(e){try{return await Nt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:s=>({data:s,error:null})})}catch(s){if(xt(s))return{data:null,error:s};throw s}}}function V0(n={}){return{getItem:e=>n[e]||null,setItem:(e,s)=>{n[e]=s},removeItem:e=>{delete n[e]}}}const wo={debug:!!(globalThis&&Fb()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Vb extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class G0 extends Vb{}async function bN(n,e,s){wo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const a=new globalThis.AbortController;e>0&&setTimeout(()=>{a.abort(),wo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve();try{return await globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async l=>{if(l){wo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,l.name);try{return await s()}finally{wo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,l.name)}}else{if(e===0)throw wo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new G0(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(wo.debug)try{const c=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(c,null,"  "))}catch(c){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",c)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}})}catch(l){throw l?.name==="AbortError"?new G0(`Acquiring an exclusive Navigator LockManager lock "${n}" timed out waiting ${e}ms`):l}}function wN(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Gb(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function _N(n){return parseInt(n,16)}function SN(n){const e=new TextEncoder().encode(n);return"0x"+Array.from(e,a=>a.toString(16).padStart(2,"0")).join("")}function jN(n){var e;const{chainId:s,domain:a,expirationTime:l,issuedAt:c=new Date,nonce:u,notBefore:h,requestId:f,resources:p,scheme:m,uri:y,version:b}=n;{if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(u&&u.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${u}`);if(!y)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const v=Gb(n.address),S=m?`${m}://${a}`:a,_=n.statement?`${n.statement}
`:"",w=`${S} wants you to sign in with your Ethereum account:
${v}

${_}`;let j=`URI: ${y}
Version: ${b}
Chain ID: ${s}${u?`
Nonce: ${u}`:""}
Issued At: ${c.toISOString()}`;if(l&&(j+=`
Expiration Time: ${l.toISOString()}`),h&&(j+=`
Not Before: ${h.toISOString()}`),f&&(j+=`
Request ID: ${f}`),p){let N=`
Resources:`;for(const T of p){if(!T||typeof T!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${T}`);N+=`
- ${T}`}j+=N}return`${w}
${j}`}class ir extends Error{constructor({message:e,code:s,cause:a,name:l}){var c;super(e,{cause:a}),this.__isWebAuthnError=!0,this.name=(c=l??(a instanceof Error?a.name:void 0))!==null&&c!==void 0?c:"Unknown Error",this.code=s}}class fd extends ir{constructor(e,s){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:s,message:e}),this.name="WebAuthnUnknownError",this.originalError=s}}function CN({error:n,options:e}){var s,a,l;const{publicKey:c}=e;if(!c)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ir({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((s=c.authenticatorSelection)===null||s===void 0?void 0:s.requireResidentKey)===!0)return new ir({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((a=c.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new ir({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((l=c.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new ir({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new ir({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new ir({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return c.pubKeyCredParams.filter(h=>h.type==="public-key").length===0?new ir({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new ir({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const u=window.location.hostname;if(Wb(u)){if(c.rp.id!==u)return new ir({message:`The RP ID "${c.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new ir({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(c.user.id.byteLength<1||c.user.id.byteLength>64)return new ir({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new ir({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new ir({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function kN({error:n,options:e}){const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new ir({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new ir({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const a=window.location.hostname;if(Wb(a)){if(s.rpId!==a)return new ir({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new ir({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new ir({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new ir({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class NN{createNewAbortSignal(){if(this.controller){const s=new Error("Cancelling existing WebAuthn API call for new one");s.name="AbortError",this.controller.abort(s)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const EN=new NN;function AN(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:e,user:s,excludeCredentials:a}=n,l=Od(n,["challenge","user","excludeCredentials"]),c=Uo(e).buffer,u=Object.assign(Object.assign({},s),{id:Uo(s.id).buffer}),h=Object.assign(Object.assign({},l),{challenge:c,user:u});if(a&&a.length>0){h.excludeCredentials=new Array(a.length);for(let f=0;f<a.length;f++){const p=a[f];h.excludeCredentials[f]=Object.assign(Object.assign({},p),{id:Uo(p.id).buffer,type:p.type||"public-key",transports:p.transports})}}return h}function TN(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:e,allowCredentials:s}=n,a=Od(n,["challenge","allowCredentials"]),l=Uo(e).buffer,c=Object.assign(Object.assign({},a),{challenge:l});if(s&&s.length>0){c.allowCredentials=new Array(s.length);for(let u=0;u<s.length;u++){const h=s[u];c.allowCredentials[u]=Object.assign(Object.assign({},h),{id:Uo(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return c}function RN(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n;return{id:n.id,rawId:n.id,response:{attestationObject:za(new Uint8Array(n.response.attestationObject)),clientDataJSON:za(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=s.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function ON(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const s=n,a=n.getClientExtensionResults(),l=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:za(new Uint8Array(l.authenticatorData)),clientDataJSON:za(new Uint8Array(l.clientDataJSON)),signature:za(new Uint8Array(l.signature)),userHandle:l.userHandle?za(new Uint8Array(l.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(e=s.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Wb(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function W0(){var n,e;return!!(kr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function DN(n){try{const e=await navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new fd("Browser returned unexpected credential type",e)}:{data:null,error:new fd("Empty credential response",e)}}catch(e){return{data:null,error:CN({error:e,options:n})}}}async function zN(n){try{const e=await navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new fd("Browser returned unexpected credential type",e)}:{data:null,error:new fd("Empty credential response",e)}}catch(e){return{data:null,error:kN({error:e,options:n})}}}const MN={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},LN={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function pd(...n){const e=l=>l!==null&&typeof l=="object"&&!Array.isArray(l),s=l=>l instanceof ArrayBuffer||ArrayBuffer.isView(l),a={};for(const l of n)if(l)for(const c in l){const u=l[c];if(u!==void 0)if(Array.isArray(u))a[c]=u;else if(s(u))a[c]=u;else if(e(u)){const h=a[c];e(h)?a[c]=pd(h,u):a[c]=pd(u)}else a[c]=u}return a}function UN(n,e){return pd(MN,n,e||{})}function IN(n,e){return pd(LN,n,e||{})}class BN{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:s,friendlyName:a,signal:l},c){var u;try{const{data:h,error:f}=await this.client.mfa.challenge({factorId:e,webauthn:s});if(!h)return{data:null,error:f};const p=l??EN.createNewAbortSignal();if(h.webauthn.type==="create"){const{user:m}=h.webauthn.credential_options.publicKey;if(!m.name){const y=a;if(y)m.name=`${m.id}:${y}`;else{const v=(await this.client.getUser()).data.user,S=((u=v?.user_metadata)===null||u===void 0?void 0:u.name)||v?.email||v?.id||"User";m.name=`${m.id}:${S}`}}m.displayName||(m.displayName=m.name)}switch(h.webauthn.type){case"create":{const m=UN(h.webauthn.credential_options.publicKey,c?.create),{data:y,error:b}=await DN({publicKey:m,signal:p});return y?{data:{factorId:e,challengeId:h.id,webauthn:{type:h.webauthn.type,credential_response:y}},error:null}:{data:null,error:b}}case"request":{const m=IN(h.webauthn.credential_options.publicKey,c?.request),{data:y,error:b}=await zN(Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:m,signal:p}));return y?{data:{factorId:e,challengeId:h.id,webauthn:{type:h.webauthn.type,credential_response:y}},error:null}:{data:null,error:b}}}}catch(h){return xt(h)?{data:null,error:h}:{data:null,error:new Ra("Unexpected error in challenge",h)}}}async _verify({challengeId:e,factorId:s,webauthn:a}){return this.client.mfa.verify({factorId:s,challengeId:e,webauthn:a})}async _authenticate({factorId:e,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:l}={}},c){if(!s)return{data:null,error:new fc("rpId is required for WebAuthn authentication")};try{if(!W0())return{data:null,error:new Ra("Browser does not support WebAuthn",null)};const{data:u,error:h}=await this.challenge({factorId:e,webauthn:{rpId:s,rpOrigins:a},signal:l},{request:c});if(!u)return{data:null,error:h};const{webauthn:f}=u;return this._verify({factorId:e,challengeId:u.challengeId,webauthn:{type:f.type,rpId:s,rpOrigins:a,credential_response:f.credential_response}})}catch(u){return xt(u)?{data:null,error:u}:{data:null,error:new Ra("Unexpected error in authenticate",u)}}}async _register({friendlyName:e,webauthn:{rpId:s=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:l}={}},c){if(!s)return{data:null,error:new fc("rpId is required for WebAuthn registration")};try{if(!W0())return{data:null,error:new Ra("Browser does not support WebAuthn",null)};const{data:u,error:h}=await this._enroll({friendlyName:e});if(!u)return await this.client.mfa.listFactors().then(m=>{var y;return(y=m.data)===null||y===void 0?void 0:y.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===e&&b.status!=="unverified")}).then(m=>m?this.client.mfa.unenroll({factorId:m?.id}):void 0),{data:null,error:h};const{data:f,error:p}=await this._challenge({factorId:u.id,friendlyName:u.friendly_name,webauthn:{rpId:s,rpOrigins:a},signal:l},{create:c});return f?this._verify({factorId:u.id,challengeId:f.challengeId,webauthn:{rpId:s,rpOrigins:a,type:f.webauthn.type,credential_response:f.webauthn.credential_response}}):{data:null,error:p}}catch(u){return xt(u)?{data:null,error:u}:{data:null,error:new Ra("Unexpected error in register",u)}}}}wN();const $N={url:Uk,storageKey:Ik,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Bk,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function K0(n,e,s){return await s()}const _o={};class pc{get jwks(){var e,s;return(s=(e=_o[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(e){_o[this.storageKey]=Object.assign(Object.assign({},_o[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,s;return(s=(e=_o[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){_o[this.storageKey]=Object.assign(Object.assign({},_o[this.storageKey]),{cachedAt:e})}constructor(e){var s,a,l;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const c=Object.assign(Object.assign({},$N),e);if(this.storageKey=c.storageKey,this.instanceID=(s=pc.nextInstanceID[this.storageKey])!==null&&s!==void 0?s:0,pc.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!c.debug,typeof c.debug=="function"&&(this.logger=c.debug),this.instanceID>0&&kr()){const u=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(u),this.logDebugMessages&&console.trace(u)}if(this.persistSession=c.persistSession,this.autoRefreshToken=c.autoRefreshToken,this.admin=new xN({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=Hb(c.fetch),this.lock=c.lock||K0,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,this.throwOnError=c.throwOnError,this.lockAcquireTimeout=c.lockAcquireTimeout,c.lock?this.lock=c.lock:this.persistSession&&kr()&&(!((a=globalThis?.navigator)===null||a===void 0)&&a.locks)?this.lock=bN:this.lock=K0,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new BN(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(c.storage?this.storage=c.storage:Fb()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=V0(this.memoryStorage)),c.userStorage&&(this.userStorage=c.userStorage)):(this.memoryStorage={},this.storage=V0(this.memoryStorage)),kr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(u){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",u)}(l=this.broadcastChannel)===null||l===void 0||l.addEventListener("message",async u=>{this._debug("received broadcast notification from other tab or client",u);try{await this._notifyAllSubscribers(u.data.event,u.data.session,!1)}catch(h){this._debug("#broadcastChannel","error",h)}})}c.skipAutoInitialize||this.initialize().catch(u=>{this._debug("#initialize()","error",u)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${$b}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let s={},a="none";if(kr()&&(s=Zk(window.location.href),this._isImplicitGrantCallback(s)?a="implicit":await this._isPKCECallback(s)&&(a="pkce")),kr()&&this.detectSessionInUrl&&a!=="none"){const{data:l,error:c}=await this._getSessionFromURL(s,a);if(c){if(this._debug("#_initialize()","error detecting session from URL",c),Hk(c)){const f=(e=c.details)===null||e===void 0?void 0:e.code;if(f==="identity_already_exists"||f==="identity_not_found"||f==="single_identity_not_deletable")return{error:c}}return{error:c}}const{session:u,redirectType:h}=l;return this._debug("#_initialize()","detected session in URL",u,"redirect type",h),await this._saveSession(u),setTimeout(async()=>{h==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",u):await this._notifyAllSubscribers("SIGNED_IN",u)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return xt(s)?this._returnResult({error:s}):this._returnResult({error:new Ra("Unexpected error during initialization",s)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var s,a,l;try{const c=await Nt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(s=e?.options)===null||s===void 0?void 0:s.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(l=e?.options)===null||l===void 0?void 0:l.captchaToken}},xform:Ss}),{data:u,error:h}=c;if(h||!u)return this._returnResult({data:{user:null,session:null},error:h});const f=u.session,p=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:p,session:f},error:null})}catch(c){if(xt(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signUp(e){var s,a,l;try{let c;if("email"in e){const{email:m,password:y,options:b}=e;let v=null,S=null;this.flowType==="pkce"&&([v,S]=await xo(this.storage,this.storageKey)),c=await Nt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b?.emailRedirectTo,body:{email:m,password:y,data:(s=b?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:b?.captchaToken},code_challenge:v,code_challenge_method:S},xform:Ss})}else if("phone"in e){const{phone:m,password:y,options:b}=e;c=await Nt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:y,data:(a=b?.data)!==null&&a!==void 0?a:{},channel:(l=b?.channel)!==null&&l!==void 0?l:"sms",gotrue_meta_security:{captcha_token:b?.captchaToken}},xform:Ss})}else throw new Iu("You must provide either an email or phone number and a password");const{data:u,error:h}=c;if(h||!u)return await jr(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:h});const f=u.session,p=u.user;return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",f)),this._returnResult({data:{user:p,session:f},error:null})}catch(c){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signInWithPassword(e){try{let s;if("email"in e){const{email:c,password:u,options:h}=e;s=await Nt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:c,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:F0})}else if("phone"in e){const{phone:c,password:u,options:h}=e;s=await Nt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:c,password:u,gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:F0})}else throw new Iu("You must provide either an email or phone number and a password");const{data:a,error:l}=s;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a||!a.session||!a.user){const c=new vo;return this._returnResult({data:{user:null,session:null},error:c})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:l})}catch(s){if(xt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOAuth(e){var s,a,l,c;return await this._handleProviderSignIn(e.provider,{redirectTo:(s=e.options)===null||s===void 0?void 0:s.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:(c=e.options)===null||c===void 0?void 0:c.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:s}=e;switch(s){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}}async signInWithEthereum(e){var s,a,l,c,u,h,f,p,m,y,b;let v,S;if("message"in e)v=e.message,S=e.signature;else{const{chain:_,wallet:w,statement:j,options:N}=e;let T;if(kr())if(typeof w=="object")T=w;else{const U=window;if("ethereum"in U&&typeof U.ethereum=="object"&&"request"in U.ethereum&&typeof U.ethereum.request=="function")T=U.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=w}const R=new URL((s=N?.url)!==null&&s!==void 0?s:window.location.href),$=await T.request({method:"eth_requestAccounts"}).then(U=>U).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!$||$.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const F=Gb($[0]);let q=(a=N?.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!q){const U=await T.request({method:"eth_chainId"});q=_N(U)}const I={domain:R.host,address:F,statement:j,uri:R.href,version:"1",chainId:q,nonce:(l=N?.signInWithEthereum)===null||l===void 0?void 0:l.nonce,issuedAt:(u=(c=N?.signInWithEthereum)===null||c===void 0?void 0:c.issuedAt)!==null&&u!==void 0?u:new Date,expirationTime:(h=N?.signInWithEthereum)===null||h===void 0?void 0:h.expirationTime,notBefore:(f=N?.signInWithEthereum)===null||f===void 0?void 0:f.notBefore,requestId:(p=N?.signInWithEthereum)===null||p===void 0?void 0:p.requestId,resources:(m=N?.signInWithEthereum)===null||m===void 0?void 0:m.resources};v=jN(I),S=await T.request({method:"personal_sign",params:[SN(v),F]})}try{const{data:_,error:w}=await Nt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:v,signature:S},!((y=e.options)===null||y===void 0)&&y.captchaToken?{gotrue_meta_security:{captcha_token:(b=e.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:Ss});if(w)throw w;if(!_||!_.session||!_.user){const j=new vo;return this._returnResult({data:{user:null,session:null},error:j})}return _.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),this._returnResult({data:Object.assign({},_),error:w})}catch(_){if(xt(_))return this._returnResult({data:{user:null,session:null},error:_});throw _}}async signInWithSolana(e){var s,a,l,c,u,h,f,p,m,y,b,v;let S,_;if("message"in e)S=e.message,_=e.signature;else{const{chain:w,wallet:j,statement:N,options:T}=e;let R;if(kr())if(typeof j=="object")R=j;else{const F=window;if("solana"in F&&typeof F.solana=="object"&&("signIn"in F.solana&&typeof F.solana.signIn=="function"||"signMessage"in F.solana&&typeof F.solana.signMessage=="function"))R=F.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!T?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");R=j}const $=new URL((s=T?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in R&&R.signIn){const F=await R.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},T?.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),N?{statement:N}:null));let q;if(Array.isArray(F)&&F[0]&&typeof F[0]=="object")q=F[0];else if(F&&typeof F=="object"&&"signedMessage"in F&&"signature"in F)q=F;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in q&&"signature"in q&&(typeof q.signedMessage=="string"||q.signedMessage instanceof Uint8Array)&&q.signature instanceof Uint8Array)S=typeof q.signedMessage=="string"?q.signedMessage:new TextDecoder().decode(q.signedMessage),_=q.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in R)||typeof R.signMessage!="function"||!("publicKey"in R)||typeof R!="object"||!R.publicKey||!("toBase58"in R.publicKey)||typeof R.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");S=[`${$.host} wants you to sign in with your Solana account:`,R.publicKey.toBase58(),...N?["",N,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(l=(a=T?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&l!==void 0?l:new Date().toISOString()}`,...!((c=T?.signInWithSolana)===null||c===void 0)&&c.notBefore?[`Not Before: ${T.signInWithSolana.notBefore}`]:[],...!((u=T?.signInWithSolana)===null||u===void 0)&&u.expirationTime?[`Expiration Time: ${T.signInWithSolana.expirationTime}`]:[],...!((h=T?.signInWithSolana)===null||h===void 0)&&h.chainId?[`Chain ID: ${T.signInWithSolana.chainId}`]:[],...!((f=T?.signInWithSolana)===null||f===void 0)&&f.nonce?[`Nonce: ${T.signInWithSolana.nonce}`]:[],...!((p=T?.signInWithSolana)===null||p===void 0)&&p.requestId?[`Request ID: ${T.signInWithSolana.requestId}`]:[],...!((y=(m=T?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||y===void 0)&&y.length?["Resources",...T.signInWithSolana.resources.map(q=>`- ${q}`)]:[]].join(`
`);const F=await R.signMessage(new TextEncoder().encode(S),"utf8");if(!F||!(F instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");_=F}}try{const{data:w,error:j}=await Nt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:S,signature:za(_)},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(v=e.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:Ss});if(j)throw j;if(!w||!w.session||!w.user){const N=new vo;return this._returnResult({data:{user:null,session:null},error:N})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:j})}catch(w){if(xt(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async _exchangeCodeForSession(e){const s=await Sa(this.storage,`${this.storageKey}-code-verifier`),[a,l]=(s??"").split("/");try{if(!a&&this.flowType==="pkce")throw new Vk;const{data:c,error:u}=await Nt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:a},xform:Ss});if(await jr(this.storage,`${this.storageKey}-code-verifier`),u)throw u;if(!c||!c.session||!c.user){const h=new vo;return this._returnResult({data:{user:null,session:null,redirectType:null},error:h})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:Object.assign(Object.assign({},c),{redirectType:l??null}),error:u})}catch(c){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(c))return this._returnResult({data:{user:null,session:null,redirectType:null},error:c});throw c}}async signInWithIdToken(e){try{const{options:s,provider:a,token:l,access_token:c,nonce:u}=e,h=await Nt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:l,access_token:c,nonce:u,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:Ss}),{data:f,error:p}=h;if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!f||!f.session||!f.user){const m=new vo;return this._returnResult({data:{user:null,session:null},error:m})}return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",f.session)),this._returnResult({data:f,error:p})}catch(s){if(xt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithOtp(e){var s,a,l,c,u;try{if("email"in e){const{email:h,options:f}=e;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await xo(this.storage,this.storageKey));const{error:y}=await Nt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:h,data:(s=f?.data)!==null&&s!==void 0?s:{},create_user:(a=f?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:m},redirectTo:f?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:y})}if("phone"in e){const{phone:h,options:f}=e,{data:p,error:m}=await Nt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:h,data:(l=f?.data)!==null&&l!==void 0?l:{},create_user:(c=f?.shouldCreateUser)!==null&&c!==void 0?c:!0,gotrue_meta_security:{captcha_token:f?.captchaToken},channel:(u=f?.channel)!==null&&u!==void 0?u:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:p?.message_id},error:m})}throw new Iu("You must provide either an email or phone number.")}catch(h){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(h))return this._returnResult({data:{user:null,session:null},error:h});throw h}}async verifyOtp(e){var s,a;try{let l,c;"options"in e&&(l=(s=e.options)===null||s===void 0?void 0:s.redirectTo,c=(a=e.options)===null||a===void 0?void 0:a.captchaToken);const{data:u,error:h}=await Nt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:c}}),redirectTo:l,xform:Ss});if(h)throw h;if(!u)throw new Error("An error occurred on token verification.");const f=u.session,p=u.user;return f?.access_token&&(await this._saveSession(f),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",f)),this._returnResult({data:{user:p,session:f},error:null})}catch(l){if(xt(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithSSO(e){var s,a,l,c,u;try{let h=null,f=null;this.flowType==="pkce"&&([h,f]=await xo(this.storage,this.storageKey));const p=await Nt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(a=(s=e.options)===null||s===void 0?void 0:s.redirectTo)!==null&&a!==void 0?a:void 0}),!((l=e?.options)===null||l===void 0)&&l.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:h,code_challenge_method:f}),headers:this.headers,xform:gN});return!((c=p.data)===null||c===void 0)&&c.url&&kr()&&!(!((u=e.options)===null||u===void 0)&&u.skipBrowserRedirect)&&window.location.assign(p.data.url),this._returnResult(p)}catch(h){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(h))return this._returnResult({data:null,error:h});throw h}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:s},error:a}=e;if(a)throw a;if(!s)throw new Yr;const{error:l}=await Nt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return this._returnResult({data:{user:null,session:null},error:l})})}catch(e){if(xt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const s=`${this.url}/resend`;if("email"in e){const{email:a,type:l,options:c}=e,{error:u}=await Nt(this.fetch,"POST",s,{headers:this.headers,body:{email:a,type:l,gotrue_meta_security:{captcha_token:c?.captchaToken}},redirectTo:c?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}else if("phone"in e){const{phone:a,type:l,options:c}=e,{data:u,error:h}=await Nt(this.fetch,"POST",s,{headers:this.headers,body:{phone:a,type:l,gotrue_meta_security:{captcha_token:c?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:u?.message_id},error:h})}throw new Iu("You must provide either an email or phone number and a type")}catch(s){if(xt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async s=>s))}async _acquireLock(e,s){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),l=(async()=>(await a,await s()))();return this.pendingInLock.push((async()=>{try{await l}catch{}})()),l}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=s();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const l=[...this.pendingInLock];await Promise.all(l),this.pendingInLock.splice(0,l.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await e(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const s=await Sa(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?e=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const a=e.expires_at?e.expires_at*1e3-Date.now()<Kf:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",e.expires_at),!a){if(this.userStorage){const u=await Sa(this.userStorage,this.storageKey+"-user");u?.user?e.user=u.user:e.user=Jf()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const u={value:this.suppressGetSessionWarning};e.user=hN(e.user,u),u.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);return c?this._returnResult({data:{session:null},error:c}):this._returnResult({data:{session:l},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const s=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return s.data.user&&(this.suppressGetSessionWarning=!0),s}async _getUser(e){try{return e?await Nt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ji}):await this._useSession(async s=>{var a,l,c;const{data:u,error:h}=s;if(h)throw h;return!(!((a=u.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Yr}:await Nt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(c=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&c!==void 0?c:void 0,xform:Ji})})}catch(s){if(xt(s))return Yf(s)&&(await this._removeSession(),await jr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:s});throw s}}async updateUser(e,s={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,s))}async _updateUser(e,s={}){try{return await this._useSession(async a=>{const{data:l,error:c}=a;if(c)throw c;if(!l.session)throw new Yr;const u=l.session;let h=null,f=null;this.flowType==="pkce"&&e.email!=null&&([h,f]=await xo(this.storage,this.storageKey));const{data:p,error:m}=await Nt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:h,code_challenge_method:f}),jwt:u.access_token,xform:Ji});if(m)throw m;return u.user=p.user,await this._saveSession(u),await this._notifyAllSubscribers("USER_UPDATED",u),this._returnResult({data:{user:u.user},error:null})})}catch(a){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Yr;const s=Date.now()/1e3;let a=s,l=!0,c=null;const{payload:u}=$u(e.access_token);if(u.exp&&(a=u.exp,l=a<=s),l){const{data:h,error:f}=await this._callRefreshToken(e.refresh_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});if(!h)return{data:{user:null,session:null},error:null};c=h}else{const{data:h,error:f}=await this._getUser(e.access_token);if(f)return this._returnResult({data:{user:null,session:null},error:f});c={access_token:e.access_token,refresh_token:e.refresh_token,user:h.user,token_type:"bearer",expires_in:a-s,expires_at:a},await this._saveSession(c),await this._notifyAllSubscribers("SIGNED_IN",c)}return this._returnResult({data:{user:c.user,session:c},error:null})}catch(s){if(xt(s))return this._returnResult({data:{session:null,user:null},error:s});throw s}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async s=>{var a;if(!e){const{data:u,error:h}=s;if(h)throw h;e=(a=u.session)!==null&&a!==void 0?a:void 0}if(!e?.refresh_token)throw new Yr;const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);return c?this._returnResult({data:{user:null,session:null},error:c}):l?this._returnResult({data:{user:l.user,session:l},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(s){if(xt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async _getSessionFromURL(e,s){try{if(!kr())throw new Bu("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Bu(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new L0("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Bu("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new L0("No code detected.");const{data:N,error:T}=await this._exchangeCodeForSession(e.code);if(T)throw T;const R=new URL(window.location.href);return R.searchParams.delete("code"),window.history.replaceState(window.history.state,"",R.toString()),{data:{session:N.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:l,access_token:c,refresh_token:u,expires_in:h,expires_at:f,token_type:p}=e;if(!c||!h||!u||!p)throw new Bu("No session defined in URL");const m=Math.round(Date.now()/1e3),y=parseInt(h);let b=m+y;f&&(b=parseInt(f));const v=b-m;v*1e3<=Ro&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${v}s, should have been closer to ${y}s`);const S=b-y;m-S>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",S,b,m):m-S<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",S,b,m);const{data:_,error:w}=await this._getUser(c);if(w)throw w;const j={provider_token:a,provider_refresh_token:l,access_token:c,expires_in:y,expires_at:b,refresh_token:u,token_type:p,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:j,redirectType:e.type},error:null})}catch(a){if(xt(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const s=await Sa(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&s)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async s=>{var a;const{data:l,error:c}=s;if(c&&!Yf(c))return this._returnResult({error:c});const u=(a=l.session)===null||a===void 0?void 0:a.access_token;if(u){const{error:h}=await this.admin.signOut(u,e);if(h&&!(Fk(h)&&(h.status===404||h.status===401||h.status===403)||Yf(h)))return this._returnResult({error:h})}return e!=="others"&&(await this._removeSession(),await jr(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const s=Xk(),a={id:s,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,a),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:a}}}async _emitInitialSession(e){return await this._useSession(async s=>{var a,l;try{const{data:{session:c},error:u}=s;if(u)throw u;await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",c)),this._debug("INITIAL_SESSION","callback id",e,"session",c)}catch(c){await((l=this.stateChangeEmitters.get(e))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",c),console.error(c)}})}async resetPasswordForEmail(e,s={}){let a=null,l=null;this.flowType==="pkce"&&([a,l]=await xo(this.storage,this.storageKey,!0));try{return await Nt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:a,code_challenge_method:l,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(c){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(c))return this._returnResult({data:null,error:c});throw c}}async getUserIdentities(){var e;try{const{data:s,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(e=s.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var s;try{const{data:a,error:l}=await this._useSession(async c=>{var u,h,f,p,m;const{data:y,error:b}=c;if(b)throw b;const v=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(u=e.options)===null||u===void 0?void 0:u.redirectTo,scopes:(h=e.options)===null||h===void 0?void 0:h.scopes,queryParams:(f=e.options)===null||f===void 0?void 0:f.queryParams,skipBrowserRedirect:!0});return await Nt(this.fetch,"GET",v,{headers:this.headers,jwt:(m=(p=y.session)===null||p===void 0?void 0:p.access_token)!==null&&m!==void 0?m:void 0})});if(l)throw l;return kr()&&!(!((s=e.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(a?.url),this._returnResult({data:{provider:e.provider,url:a?.url},error:null})}catch(a){if(xt(a))return this._returnResult({data:{provider:e.provider,url:null},error:a});throw a}}async linkIdentityIdToken(e){return await this._useSession(async s=>{var a;try{const{error:l,data:{session:c}}=s;if(l)throw l;const{options:u,provider:h,token:f,access_token:p,nonce:m}=e,y=await Nt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=c?.access_token)!==null&&a!==void 0?a:void 0,body:{provider:h,id_token:f,access_token:p,nonce:m,link_identity:!0,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Ss}),{data:b,error:v}=y;return v?this._returnResult({data:{user:null,session:null},error:v}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new vo}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:v}))}catch(l){if(await jr(this.storage,`${this.storageKey}-code-verifier`),xt(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}})}async unlinkIdentity(e){try{return await this._useSession(async s=>{var a,l;const{data:c,error:u}=s;if(u)throw u;return await Nt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(l=(a=c.session)===null||a===void 0?void 0:a.access_token)!==null&&l!==void 0?l:void 0})})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async _refreshAccessToken(e){const s=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{const a=Date.now();return await nN(async l=>(l>0&&await tN(200*Math.pow(2,l-1)),this._debug(s,"refreshing attempt",l),await Nt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ss})),(l,c)=>{const u=200*Math.pow(2,l);return c&&Qf(c)&&Date.now()+u-a<Ro})}catch(a){if(this._debug(s,"error",a),xt(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(s,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,s){const a=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",s,"url",a),kr()&&!s.skipBrowserRedirect&&window.location.assign(a),{data:{provider:e,url:a},error:null}}async _recoverAndRefresh(){var e,s;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const l=await Sa(this.storage,this.storageKey);if(l&&this.userStorage){let u=await Sa(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!u&&(u={user:l.user},await Oo(this.userStorage,this.storageKey+"-user",u)),l.user=(e=u?.user)!==null&&e!==void 0?e:Jf()}else if(l&&!l.user&&!l.user){const u=await Sa(this.storage,this.storageKey+"-user");u&&u?.user?(l.user=u.user,await jr(this.storage,this.storageKey+"-user"),await Oo(this.storage,this.storageKey,l)):l.user=Jf()}if(this._debug(a,"session from storage",l),!this._isValidSession(l)){this._debug(a,"session is not valid"),l!==null&&await this._removeSession();return}const c=((s=l.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Kf;if(this._debug(a,`session has${c?"":" not"} expired with margin of ${Kf}s`),c){if(this.autoRefreshToken&&l.refresh_token){const{error:u}=await this._callRefreshToken(l.refresh_token);u&&(console.error(u),Qf(u)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",u),await this._removeSession()))}}else if(l.user&&l.user.__isUserNotAvailableProxy===!0)try{const{data:u,error:h}=await this._getUser(l.access_token);!h&&u?.user?(l.user=u.user,await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(u){console.error("Error getting user data:",u),this._debug(a,"error getting user data, skipping SIGNED_IN notification",u)}else await this._notifyAllSubscribers("SIGNED_IN",l)}catch(l){this._debug(a,"error",l),console.error(l);return}finally{this._debug(a,"end")}}async _callRefreshToken(e){var s,a;if(!e)throw new Yr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const l=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(l,"begin");try{this.refreshingDeferred=new Md;const{data:c,error:u}=await this._refreshAccessToken(e);if(u)throw u;if(!c.session)throw new Yr;await this._saveSession(c.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",c.session);const h={data:c.session,error:null};return this.refreshingDeferred.resolve(h),h}catch(c){if(this._debug(l,"error",c),xt(c)){const u={data:null,error:c};return Qf(c)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(u),u}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(c),c}finally{this.refreshingDeferred=null,this._debug(l,"end")}}async _notifyAllSubscribers(e,s,a=!0){const l=`#_notifyAllSubscribers(${e})`;this._debug(l,"begin",s,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:e,session:s});const c=[],u=Array.from(this.stateChangeEmitters.values()).map(async h=>{try{await h.callback(e,s)}catch(f){c.push(f)}});if(await Promise.all(u),c.length>0){for(let h=0;h<c.length;h+=1)console.error(c[h]);throw c[0]}}finally{this._debug(l,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await jr(this.storage,`${this.storageKey}-code-verifier`);const s=Object.assign({},e),a=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&s.user&&await Oo(this.userStorage,this.storageKey+"-user",{user:s.user});const l=Object.assign({},s);delete l.user;const c=P0(l);await Oo(this.storage,this.storageKey,c)}else{const l=P0(s);await Oo(this.storage,this.storageKey,l)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await jr(this.storage,this.storageKey),await jr(this.storage,this.storageKey+"-code-verifier"),await jr(this.storage,this.storageKey+"-user"),this.userStorage&&await jr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&kr()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ro);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const s=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=s,s&&typeof s=="object"&&typeof s.unref=="function"?s.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(s)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const s=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,s&&clearTimeout(s)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async s=>{const{data:{session:a}}=s;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const l=Math.floor((a.expires_at*1e3-e)/Ro);this._debug("#_autoRefreshTokenTick()",`access token expires in ${l} ticks, a tick lasts ${Ro}ms, refresh threshold is ${Lp} ticks`),l<=Lp&&await this._callRefreshToken(a.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Vb)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!kr()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const s=`#_onVisibilityChanged(${e})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,s,a){const l=[`provider=${encodeURIComponent(s)}`];if(a?.redirectTo&&l.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&l.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[c,u]=await xo(this.storage,this.storageKey),h=new URLSearchParams({code_challenge:`${encodeURIComponent(c)}`,code_challenge_method:`${encodeURIComponent(u)}`});l.push(h.toString())}if(a?.queryParams){const c=new URLSearchParams(a.queryParams);l.push(c.toString())}return a?.skipBrowserRedirect&&l.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${e}?${l.join("&")}`}async _unenroll(e){try{return await this._useSession(async s=>{var a;const{data:l,error:c}=s;return c?this._returnResult({data:null,error:c}):await Nt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(a=l?.session)===null||a===void 0?void 0:a.access_token})})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async _enroll(e){try{return await this._useSession(async s=>{var a,l;const{data:c,error:u}=s;if(u)return this._returnResult({data:null,error:u});const h=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:f,error:p}=await Nt(this.fetch,"POST",`${this.url}/factors`,{body:h,headers:this.headers,jwt:(a=c?.session)===null||a===void 0?void 0:a.access_token});return p?this._returnResult({data:null,error:p}):(e.factorType==="totp"&&f.type==="totp"&&(!((l=f?.totp)===null||l===void 0)&&l.qr_code)&&(f.totp.qr_code=`data:image/svg+xml;utf-8,${f.totp.qr_code}`),this._returnResult({data:f,error:null}))})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async s=>{var a;const{data:l,error:c}=s;if(c)return this._returnResult({data:null,error:c});const u=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?RN(e.webauthn.credential_response):ON(e.webauthn.credential_response)})}:{code:e.code}),{data:h,error:f}=await Nt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:u,headers:this.headers,jwt:(a=l?.session)===null||a===void 0?void 0:a.access_token});return f?this._returnResult({data:null,error:f}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+h.expires_in},h)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",h),this._returnResult({data:h,error:f}))})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async s=>{var a;const{data:l,error:c}=s;if(c)return this._returnResult({data:null,error:c});const u=await Nt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(a=l?.session)===null||a===void 0?void 0:a.access_token});if(u.error)return u;const{data:h}=u;if(h.type!=="webauthn")return{data:h,error:null};switch(h.webauthn.type){case"create":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:AN(h.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},h),{webauthn:Object.assign(Object.assign({},h.webauthn),{credential_options:Object.assign(Object.assign({},h.webauthn.credential_options),{publicKey:TN(h.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}})}async _challengeAndVerify(e){const{data:s,error:a}=await this._challenge({factorId:e.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:e.factorId,challengeId:s.id,code:e.code})}async _listFactors(){var e;const{data:{user:s},error:a}=await this.getUser();if(a)return{data:null,error:a};const l={all:[],phone:[],totp:[],webauthn:[]};for(const c of(e=s?.factors)!==null&&e!==void 0?e:[])l.all.push(c),c.status==="verified"&&l[c.factor_type].push(c);return{data:l,error:null}}async _getAuthenticatorAssuranceLevel(e){var s,a,l,c;if(e)try{const{payload:v}=$u(e);let S=null;v.aal&&(S=v.aal);let _=S;const{data:{user:w},error:j}=await this.getUser(e);if(j)return this._returnResult({data:null,error:j});((a=(s=w?.factors)===null||s===void 0?void 0:s.filter(R=>R.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(_="aal2");const T=v.amr||[];return{data:{currentLevel:S,nextLevel:_,currentAuthenticationMethods:T},error:null}}catch(v){if(xt(v))return this._returnResult({data:null,error:v});throw v}const{data:{session:u},error:h}=await this.getSession();if(h)return this._returnResult({data:null,error:h});if(!u)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:f}=$u(u.access_token);let p=null;f.aal&&(p=f.aal);let m=p;((c=(l=u.user.factors)===null||l===void 0?void 0:l.filter(v=>v.status==="verified"))!==null&&c!==void 0?c:[]).length>0&&(m="aal2");const b=f.amr||[];return{data:{currentLevel:p,nextLevel:m,currentAuthenticationMethods:b},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async s=>{const{data:{session:a},error:l}=s;return l?this._returnResult({data:null,error:l}):a?await Nt(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:a.access_token,xform:c=>({data:c,error:null})}):this._returnResult({data:null,error:new Yr})})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async _approveAuthorization(e,s){try{return await this._useSession(async a=>{const{data:{session:l},error:c}=a;if(c)return this._returnResult({data:null,error:c});if(!l)return this._returnResult({data:null,error:new Yr});const u=await Nt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:l.access_token,body:{action:"approve"},xform:h=>({data:h,error:null})});return u.data&&u.data.redirect_url&&kr()&&!s?.skipBrowserRedirect&&window.location.assign(u.data.redirect_url),u})}catch(a){if(xt(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(e,s){try{return await this._useSession(async a=>{const{data:{session:l},error:c}=a;if(c)return this._returnResult({data:null,error:c});if(!l)return this._returnResult({data:null,error:new Yr});const u=await Nt(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:l.access_token,body:{action:"deny"},xform:h=>({data:h,error:null})});return u.data&&u.data.redirect_url&&kr()&&!s?.skipBrowserRedirect&&window.location.assign(u.data.redirect_url),u})}catch(a){if(xt(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:s},error:a}=e;return a?this._returnResult({data:null,error:a}):s?await Nt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new Yr})})}catch(e){if(xt(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async s=>{const{data:{session:a},error:l}=s;return l?this._returnResult({data:null,error:l}):a?(await Nt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Yr})})}catch(s){if(xt(s))return this._returnResult({data:null,error:s});throw s}}async fetchJwk(e,s={keys:[]}){let a=s.keys.find(h=>h.kid===e);if(a)return a;const l=Date.now();if(a=this.jwks.keys.find(h=>h.kid===e),a&&this.jwks_cached_at+Pk>l)return a;const{data:c,error:u}=await Nt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(u)throw u;return!c.keys||c.keys.length===0||(this.jwks=c,this.jwks_cached_at=l,a=c.keys.find(h=>h.kid===e),!a)?null:a}async getClaims(e,s={}){try{let a=e;if(!a){const{data:v,error:S}=await this.getSession();if(S||!v.session)return this._returnResult({data:null,error:S});a=v.session.access_token}const{header:l,payload:c,signature:u,raw:{header:h,payload:f}}=$u(a);s?.allowExpired||cN(c.exp);const p=!l.alg||l.alg.startsWith("HS")||!l.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(l.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!p){const{error:v}=await this.getUser(a);if(v)throw v;return{data:{claims:c,header:l,signature:u},error:null}}const m=uN(l.alg),y=await crypto.subtle.importKey("jwk",p,m,!0,["verify"]);if(!await crypto.subtle.verify(m,y,u,Qk(`${h}.${f}`)))throw new Bp("Invalid JWT signature");return{data:{claims:c,header:l,signature:u},error:null}}catch(a){if(xt(a))return this._returnResult({data:null,error:a});throw a}}}pc.nextInstanceID={};const PN=pc,qN="2.97.0";let Jl="";typeof Deno<"u"?Jl="deno":typeof document<"u"?Jl="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Jl="react-native":Jl="node";const FN={"X-Client-Info":`supabase-js-${Jl}/${qN}`},HN={headers:FN},VN={schema:"public"},GN={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},WN={};function mc(n){"@babel/helpers - typeof";return mc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mc(n)}function KN(n,e){if(mc(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,e);if(mc(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function YN(n){var e=KN(n,"string");return mc(e)=="symbol"?e:e+""}function QN(n,e,s){return(e=YN(e))in n?Object.defineProperty(n,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[e]=s,n}function Y0(n,e){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),s.push.apply(s,a)}return s}function Kn(n){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?Y0(Object(s),!0).forEach(function(a){QN(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Y0(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}const JN=n=>n?(...e)=>n(...e):(...e)=>fetch(...e),XN=()=>Headers,ZN=(n,e,s)=>{const a=JN(s),l=XN();return async(c,u)=>{var h;const f=(h=await e())!==null&&h!==void 0?h:n;let p=new l(u?.headers);return p.has("apikey")||p.set("apikey",n),p.has("Authorization")||p.set("Authorization",`Bearer ${f}`),a(c,Kn(Kn({},u),{},{headers:p}))}};function eE(n){return n.endsWith("/")?n:n+"/"}function tE(n,e){var s,a;const{db:l,auth:c,realtime:u,global:h}=n,{db:f,auth:p,realtime:m,global:y}=e,b={db:Kn(Kn({},f),l),auth:Kn(Kn({},p),c),realtime:Kn(Kn({},m),u),storage:{},global:Kn(Kn(Kn({},y),h),{},{headers:Kn(Kn({},(s=y?.headers)!==null&&s!==void 0?s:{}),(a=h?.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return n.accessToken?b.accessToken=n.accessToken:delete b.accessToken,b}function nE(n){const e=n?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(eE(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var rE=class extends PN{constructor(n){super(n)}},sE=class{constructor(n,e,s){var a,l;this.supabaseUrl=n,this.supabaseKey=e;const c=nE(n);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,h={db:VN,realtime:WN,auth:Kn(Kn({},GN),{},{storageKey:u}),global:HN},f=tE(s??{},h);if(this.storageKey=(a=f.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(l=f.global.headers)!==null&&l!==void 0?l:{},f.accessToken)this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(m,y)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(y)} is not possible`)}});else{var p;this.auth=this._initSupabaseAuthClient((p=f.auth)!==null&&p!==void 0?p:{},this.headers,f.global.fetch)}this.fetch=ZN(e,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Kn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(m=>this.realtime.setAuth(m)).catch(m=>console.warn("Failed to set initial Realtime auth token:",m)),this.rest=new FC(new URL("rest/v1",c).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch,timeout:f.db.timeout,urlLengthLimit:f.db.urlLengthLimit}),this.storage=new Lk(this.storageUrl.href,this.headers,this.fetch,s?.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new MC(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,e,s)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,e,s;if(n.accessToken)return await n.accessToken();const{data:a}=await n.auth.getSession();return(e=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&e!==void 0?e:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:s,storage:a,userStorage:l,storageKey:c,flowType:u,lock:h,debug:f,throwOnError:p},m,y){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new rE({url:this.authUrl.href,headers:Kn(Kn({},b),m),storageKey:c,autoRefreshToken:n,persistSession:e,detectSessionInUrl:s,storage:a,userStorage:l,flowType:u,lock:h,debug:f,throwOnError:p,fetch:y,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new ak(this.realtimeUrl.href,Kn(Kn({},n),{},{params:Kn(Kn({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,e)=>{this._handleTokenChanged(n,"CLIENT",e?.access_token)})}_handleTokenChanged(n,e,s){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const iE=(n,e,s)=>new sE(n,e,s);function aE(){if(typeof window<"u")return!1;const n=globalThis.process;if(!n)return!1;const e=n.version;if(e==null)return!1;const s=e.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}aE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Zf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var oE={};const Kb=n=>{if(typeof import.meta<"u"&&Zf&&Zf[n])return Zf[n];const e=oE;return e&&e[n]?e[n]:null},Yb=Kb("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",Qb=Kb("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",Io=Yb,ed=Qb,Ee=iE(Yb,Qb),lE=2,ep=n=>{if(typeof n!="string")return!1;const e=n.trim();return e?!/^[\d-\s.,+\-/%~]+$/.test(e):!1},Q0={async translateRecipe(n,e="EN-US"){const s=[],a=[],l=(f,p)=>{const m=typeof f=="string"?f:String(f??"");s.push(m),a.push((y,b)=>{p(b,y||m,m)})},c=f=>Array.isArray(f)?f.map(p=>p&&typeof p=="object"?{...p}:p):f,u={...n,ingredients:c(n.ingredients),flours:c(n.flours),breadIngredients:c(n.breadIngredients),steps:c(n.steps),ingredientGroups:c(n.ingredientGroups),stepGroups:c(n.stepGroups)};if(l(n.title||n.name||"",(f,p)=>{f.title=p,(f.name!==void 0||n.name!==void 0)&&(f.name=p)}),l(n.description||"",(f,p)=>{f.description=p}),n.course&&l(n.course,(f,p)=>{f.course=p}),n.category&&l(n.category,(f,p)=>{f.category=p}),n.storeName&&l(n.storeName,(f,p)=>{f.storeName=p}),Array.isArray(n.ingredientGroups)&&n.ingredientGroups.forEach((f,p)=>{const m=f?.name;m&&l(m,(y,b)=>{y.ingredientGroups?.[p]&&(y.ingredientGroups[p].name=b)})}),Array.isArray(n.stepGroups)&&n.stepGroups.forEach((f,p)=>{const m=f?.name;m&&l(m,(y,b)=>{y.stepGroups?.[p]&&(y.stepGroups[p].name=b)})}),n.type==="bread"?((n.flours||[]).forEach((f,p)=>{!f||typeof f!="object"||(l(f.name||"",(m,y)=>{m.flours?.[p]&&(m.flours[p].name=y)}),f.unit&&l(f.unit,(m,y)=>{m.flours?.[p]&&(m.flours[p].unit=y)}),ep(f.quantity)&&l(f.quantity,(m,y)=>{m.flours?.[p]&&(m.flours[p].quantity=y)}))}),(n.breadIngredients||[]).forEach((f,p)=>{!f||typeof f!="object"||(l(f.name||"",(m,y)=>{m.breadIngredients?.[p]&&(m.breadIngredients[p].name=y)}),f.unit&&l(f.unit,(m,y)=>{m.breadIngredients?.[p]&&(m.breadIngredients[p].unit=y)}),ep(f.quantity)&&l(f.quantity,(m,y)=>{m.breadIngredients?.[p]&&(m.breadIngredients[p].quantity=y)}))})):(n.ingredients||[]).forEach((f,p)=>{if(typeof f=="string"){l(f,(m,y)=>{Array.isArray(m.ingredients)&&(m.ingredients[p]=y)});return}!f||typeof f!="object"||(l(f.name||"",(m,y)=>{m.ingredients?.[p]&&typeof m.ingredients[p]=="object"&&(m.ingredients[p].name=y)}),f.unit&&l(f.unit,(m,y)=>{m.ingredients?.[p]&&typeof m.ingredients[p]=="object"&&(m.ingredients[p].unit=y)}),ep(f.quantity)&&l(f.quantity,(m,y)=>{m.ingredients?.[p]&&typeof m.ingredients[p]=="object"&&(m.ingredients[p].quantity=y)}))}),(n.steps||[]).forEach((f,p)=>{const m=typeof f=="object"&&f!==null?f.text||"":f||"";l(m,(y,b)=>{const v=y.steps?.[p];if(typeof v=="object"&&v!==null){v.text=b;return}Array.isArray(y.steps)&&(y.steps[p]=b)})}),!s.some(f=>String(f||"").trim().length>0))return n;try{const f=await this.translateList(s,e);return a.forEach((p,m)=>{p(f[m],u)}),u.__translationVersion=lE,u}catch(f){throw console.error("Translation failed:",f),f}},async translateList(n,e){const s=(n||[]).map(p=>typeof p=="string"?p:String(p??""));if(!s.some(p=>p.trim().length>0))return s;const a=`${Io}/functions/v1/translate`,l=async p=>await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:ed,Authorization:`Bearer ${p}`},body:JSON.stringify({text:s,target_lang:e})}),c=async()=>{const{data:p}=await Ee.auth.getSession();if(p?.session?.access_token)return p.session.access_token;const{data:m,error:y}=await Ee.auth.refreshSession();if(y||!m?.session?.access_token){const b=y?.message||"",v=/refresh_token|session|expired|invalid|not found/i.test(b);throw new Error(v?"":b||"")}return m.session.access_token};let u=await c(),h=await l(u);if(h.status===401&&(u=await c(),h=await l(u)),!h.ok){const p=h.status;let m="";try{const y=await h.text();if(y)try{const b=JSON.parse(y);m=b?.error||b?.message||y}catch{m=y}}catch{}throw new Error(m||`Translation Error (${p})`)}const f=await h.json();if(f&&f.error)throw console.error("Edge Function returned error:",f.error),new Error(`Translation Error: ${f.error}`);if(!Array.isArray(f?.translations))throw console.error("Edge Function returned invalid payload:",f),new Error("Translation Error: invalid response payload");return f.translations.map(p=>p.text)}},Jt=n=>{const e=(n??"").toString();return(typeof e.normalize=="function"?e.normalize("NFKC"):e).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},Pu=async(n,e,s)=>{let a=null;try{const l=new Promise((c,u)=>{a=setTimeout(()=>u(new Error(`${s||"operation"} timed out after ${e}ms`)),e)});return await Promise.race([n,l])}finally{a&&clearTimeout(a)}},td=n=>{if(Array.isArray(n))return n.map(s=>String(s)).filter(Boolean);if(typeof n!="string")return[];const e=n.trim();if(!e)return[];if(e.startsWith("{")&&e.endsWith("}")){const s=e.slice(1,-1);return s?s.split(",").map(a=>a.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},cE=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(e=>typeof e=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const e=n[0],s=Object.values(e)[0];return td(s)}return[]}if(typeof n=="object"){const e=Object.values(n)[0];return td(e)}return td(n)},Jb=n=>{if(Array.isArray(n))return n.map(e=>String(e)).filter(Boolean);if(typeof n=="string"){const e=n.trim();if(!e)return[];const s=td(e);return s.length>0?s:e.split(",").map(a=>a.trim()).filter(Boolean)}return[]},J0=n=>{if(!n)return!1;const e=String(n.code||"").toUpperCase(),s=String(n.message||"").toLowerCase(),a=String(n.details||"").toLowerCase();return e==="42501"||e.startsWith("PGRST")||s.includes("row-level security")||s.includes("permission denied")||s.includes("violates row-level security")||s.includes("invalid input syntax")||s.includes("column")||a.includes("row-level security")?!1:s.includes("failed to fetch")||s.includes("network")||s.includes("timeout")||s.includes("timed out")||s.includes("load failed")},Xb="recipe_list_cache",uE=300*1e3,tp=(n,e)=>{try{const s=(n||[]).map(a=>({id:a.id,title:a.title,description:a.description,image:a.image,servings:a.servings,course:a.course,category:a.category,storeName:a.storeName,store_name:a.store_name,tags:a.tags,created_at:a.created_at,updated_at:a.updated_at,type:a.type,sourceUrl:a.sourceUrl}));localStorage.setItem(Xb,JSON.stringify({userId:e,updatedAt:Date.now(),recipes:s}))}catch{}},dE=n=>{try{const e=localStorage.getItem(Xb);if(!e)return null;const s=JSON.parse(e);return s.userId!==n||Date.now()-s.updatedAt>uE?null:s.recipes||null}catch{return null}},jn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(n){return dE(n)},saveCachedRecipes(n,e){tp(n,e)},async _resolveShowMasterPreference(n,e=15e3){const s=n?.showMasterRecipes===!0,a=n?.id;if(!a)return s;const l=this._showMasterPrefCache.get(a),c=Date.now();if(l&&l.value!==s)return this._showMasterPrefCache.set(a,{value:s,updatedAt:c}),s;if(l&&c-l.updatedAt<3e4)return l.value;try{const{data:u,error:h}=await Pu(Ee.from("profiles").select("show_master_recipes").eq("id",a).single(),Math.min(3e3,e/3),"profiles.select(show_master_recipes)");if(h)throw h;const f=u?.show_master_recipes===!0;return this._showMasterPrefCache.set(a,{value:f,updatedAt:c}),f}catch{return this._showMasterPrefCache.set(a,{value:s,updatedAt:c}),s}},async _resolveMasterOwnerTags(n=15e3){const e=Date.now();if(this._masterOwnerTagsCache?.value&&e-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:s,error:a}=await Pu(Ee.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(a)throw a;const l=cE(s),c=new Set(l.length>0?l:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:c,updatedAt:e},c}catch{const s=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:s,updatedAt:e},s}},async fetchRecipes(n,{timeoutMs:e=15e3,includeIngredients:s=!0,includeSources:a=!0,offset:l=0,limit:c=null,skipCacheSave:u=!1,returnMeta:h=!1}={}){if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const f=n.role==="admin",p=f?Promise.resolve(!1):this._resolveShowMasterPreference(n,e),m=Number.isInteger(l)&&l>=0?l:0,y=Number.isInteger(c)&&c>0?c:null;let b=0,v=[];const S=async(V,{withOrderIndex:D,queryTimeoutMs:H})=>{let C=Ee.from("recipes").select(V);D?C=C.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):C=C.order("created_at",{ascending:!1}),y!=null&&(C=C.range(m,m+y-1));const{data:M,error:z}=await Pu(C,H,"recipes.select(list)");if(z)throw z;return b=Array.isArray(M)?M.length:0,(M||[]).map(js)},_=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`,w=s?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${a?",recipe_sources(url)":""}`,j=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",N=s?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let T=null;const R=`recipe_query_pattern:${s?"ing":"noing"}:${a?"src":"nosrc"}`,$=this._queryPatternCache.get(R),F=Math.max(2500,e);if($)try{v=await S($.spec,{withOrderIndex:$.withOrderIndex,queryTimeoutMs:F})}catch(V){console.warn("Cached query pattern failed, re-detecting...",V),this._queryPatternCache.delete(R),T=V}else{const D=Math.max(2500,Math.round(e/(s?[_,w,j,N]:[_,w,N]).length));try{v=await S(_,{withOrderIndex:!0,queryTimeoutMs:D}),this._queryPatternCache.set(R,{spec:_,withOrderIndex:!0})}catch(H){T=H;try{v=await S(w,{withOrderIndex:!1,queryTimeoutMs:D}),this._queryPatternCache.set(R,{spec:w,withOrderIndex:!1})}catch(C){T=C;try{v=await S(j,{withOrderIndex:!1,queryTimeoutMs:D}),this._queryPatternCache.set(R,{spec:j,withOrderIndex:!1})}catch(M){T=M;try{v=await S(N,{withOrderIndex:!1,queryTimeoutMs:D}),this._queryPatternCache.set(R,{spec:N,withOrderIndex:!1})}catch(z){T=z,v=[]}}}}}if(v.length===0&&T)try{const V=localStorage.getItem("local_recipes");if(V){const D=JSON.parse(V).map(H=>typeof js=="function"?js(H):H);v=y!=null?D.slice(m,m+y):D,b=v.length}else throw T}catch{throw T}if(f)return u||tp(v,n.id),h?{recipes:v,hasMoreRaw:y!=null?b===y:!1}:v;const q=[String(n.id)];n.displayId&&q.push(String(n.displayId));const I=await p,U=I?await this._resolveMasterOwnerTags(e):new Set,P=v.filter(V=>{const D=Jb(V.tags),H=D.filter(B=>B&&B.startsWith("owner:"));if(H.length===0)return!0;const C=H.some(B=>U.has(B));if(I&&C)return!0;const M=H.some(B=>q.some(K=>B===`owner:${K}`)),z=D.includes("public");return!!(M||z)});return u||tp(P,n.id),h?{recipes:P,hasMoreRaw:y!=null?b===y:!1}:P},_filterRecipesInApp(n,e){return this.fetchRecipes(e)},async uploadImage(n){const e=n.name.split(".").pop(),a=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${e}`}`,{error:l}=await Ee.storage.from("recipe-images").upload(a,n);if(l)throw l;const{data:c}=Ee.storage.from("recipe-images").getPublicUrl(a);return c.publicUrl},async getRecipe(n){try{const{data:e,error:s}=await Pu(Ee.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(s)throw s;return js(e)}catch(e){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",e);const s=localStorage.getItem("local_recipes");if(s){const l=JSON.parse(s).find(c=>c.id==n);if(l)return js(l)}throw e}},async createRecipe(n,e){console.log("createRecipe called with user:",e);const{id:s,created_at:a,sourceUrl:l,...c}=n;if(c.image instanceof File&&(c.image=await this.uploadImage(c.image)),e){const f=(c.tags||[]).filter(p=>!p.startsWith("owner:"));c.tags=[...f,`owner:${e.id}`],console.log("Added owner tag. New tags:",c.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const u=qu(c);try{const{data:h,error:f}=await Ee.from("recipes").insert([u]).select().single();if(f)throw f;if(l){const{error:p}=await Ee.from("recipe_sources").insert([{recipe_id:h.id,url:l}]);p&&console.error("Failed to save source URL:",p)}return js({...h,recipe_sources:l?[{url:l}]:[]})}catch(h){if(!J0(h))throw h;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",h);const f=Date.now(),p={...c,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:c.tags||[]},m=qu(p);m.id=f,m.created_at=p.created_at,console.log("Saving to LocalStorage:",m);try{const y=localStorage.getItem("local_recipes"),b=y?JSON.parse(y):[];b.push(m),localStorage.setItem("local_recipes",JSON.stringify(b)),console.log("Saved to LocalStorage success. Total recipes:",b.length)}catch(y){throw console.error("Failed to save to LocalStorage:",y),h}return js(m)}},async updateRecipe(n){const{id:e,created_at:s,sourceUrl:a,...l}=n;l.image instanceof File&&(l.image=await this.uploadImage(l.image));const c=qu(l);l.steps===void 0&&delete c.steps,l.tags===void 0&&delete c.tags,l.ingredients!==void 0||l.type!==void 0||l.ingredientGroups!==void 0||l.flours!==void 0||l.breadIngredients!==void 0||l.stepGroups!==void 0||delete c.ingredients;try{const{data:h,error:f}=await Ee.from("recipes").update(c).eq("id",n.id).select().single();if(f)throw f;if(a!==void 0&&(await Ee.from("recipe_sources").delete().eq("recipe_id",n.id),a)){const{error:p}=await Ee.from("recipe_sources").insert([{recipe_id:n.id,url:a}]);p&&console.error("Failed to update source URL:",p)}return js({...h,recipe_sources:a?[{url:a}]:[]})}catch(h){if(!J0(h))throw h;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",h);const f=localStorage.getItem("local_recipes");if(f){let p=JSON.parse(f);const m=p.findIndex(y=>y.id==n.id);if(m!==-1){const y={...p[m],...c,updated_at:new Date().toISOString()};return p[m]=y,localStorage.setItem("local_recipes",JSON.stringify(p)),js(y)}}throw h}},async duplicateRecipe(n,e){const{id:s,created_at:a,updated_at:l,image:c,...u}=n;u.title=`${u.title} ()`;let h=null;if(c)try{const f=c.split("/").pop(),p=`copy-${Date.now()}-${f}`,{error:m}=await Ee.storage.from("recipe-images").copy(f,p);if(m)console.warn("Image copy failed, using original URL:",m),h=c;else{const{data:y}=Ee.storage.from("recipe-images").getPublicUrl(p);h=y.publicUrl}}catch(f){console.warn("Image copy logic error:",f),h=c}return u.image=h,await this.createRecipe(u,e)},async fetchDeletedRecipes(){const{data:n,error:e}=await Ee.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(e)throw e;return n.map(hE)},async getDeletedCount(){const{count:n,error:e}=await Ee.from("deleted_recipes").select("*",{count:"exact",head:!0});if(e)throw e;return n},async deleteRecipe(n){try{const{data:e,error:s}=await Ee.from("recipes").select("*").eq("id",n).single();if(s)throw s;const{error:a}=await Ee.from("deleted_recipes").insert([{original_id:e.id,title:e.title,description:e.description,image:e.image,prep_time:e.prep_time,cook_time:e.cook_time,servings:e.servings,tags:e.tags,ingredients:e.ingredients,steps:e.steps,created_at:e.created_at}]);if(a)throw a;const{error:l}=await Ee.from("recipes").delete().eq("id",n);if(l)throw l;return!0}catch(e){console.warn("Supabase delete failed, using LocalStorage fallback:",e);const s=localStorage.getItem("local_recipes");if(s){let a=JSON.parse(s);const l=a.length;if(a=a.filter(c=>c.id!=n),a.length<l)return localStorage.setItem("local_recipes",JSON.stringify(a)),!0}throw e}},async restoreRecipe(n){const{data:e,error:s}=await Ee.from("deleted_recipes").select("*").eq("id",n).single();if(s)throw s;const{error:a}=await Ee.from("recipes").insert([{title:e.title,description:e.description,image:e.image,prep_time:e.prep_time,cook_time:e.cook_time,servings:e.servings,tags:e.tags,ingredients:e.ingredients,steps:e.steps,created_at:e.created_at}]);if(a)throw a;const{error:l}=await Ee.from("deleted_recipes").delete().eq("id",n);if(l)throw l;return!0},async hardDeleteRecipe(n){const{error:e}=await Ee.from("deleted_recipes").delete().eq("id",n);if(e)throw e;return!0},async fetchRecentRecipes(){const{data:n,error:e}=await Ee.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(e)throw e;return n.map(s=>s.recipe_id)},async addToHistory(n){const{error:e}=await Ee.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(e)throw e;return!0},async updateOrder(n){const e=n.map(s=>Ee.from("recipes").update({order_index:s.order_index}).eq("id",s.id));await Promise.all(e)},async exportAllRecipes(n){return await this.fetchRecipes(n)},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let e=0,s=[];for(const a of n)try{await this.createRecipe(a),e++}catch(l){console.error("Import failed for recipe:",a.title,l),s.push({title:a.title,error:l.message})}return{success:!0,count:e,errors:s}},async updateRecipeCosts(n){const{data:e,error:s}=await Ee.from("recipes").select("*");if(s)throw s;let a=0;const l=[];for(const c of e){const u=js(c);let h=!1;const f=p=>p.map(m=>{if(!m.name)return m;const y=n.get(Jt(m.name));if(y&&m.purchaseCost!==y.price){h=!0;const b={...m,purchaseCost:y.price};if(u.type==="bread"){const v=parseFloat(b.quantity)||0;b.cost=Math.round(v/1e3*b.purchaseCost)}else if(m.cost&&m.purchaseCost){const v=m.cost/m.purchaseCost;b.cost=Math.round(b.purchaseCost*v)}return b}return m});if(u.type==="bread"){const p=f(u.flours||[]),m=f(u.breadIngredients||[]);h&&(u.flours=p,u.breadIngredients=m)}else{const p=f(u.ingredients||[]);h&&(u.ingredients=p)}if(h){const p=qu(u);l.push(Ee.from("recipes").update(p).eq("id",u.id)),a++}}return l.length>0&&await Promise.all(l),a}},qu=n=>{let e=n.ingredients||[];const s={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(s.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const l=n.steps||[],c=n.stepGroups.map(u=>({...u,count:l.filter(h=>h.groupId===u.id).length}));s.stepGroups=c}if(n.type==="bread"){const l=(n.flours||[]).map(u=>({...u,_group:"flour"})),c=(n.breadIngredients||[]).map(u=>({...u,_group:"other"}));e=[s,...l,...c]}else e=[s,...e];const a=(n.steps||[]).map(l=>typeof l=="string"?l:l.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:e,steps:a,tags:n.tags||[]}},js=n=>{const e=n.ingredients||[];let s="normal",a=[],l=[],c=[],u=[],h=e;const f=Jb(n.tags);if(Array.isArray(e)&&e.length>0&&e[0]&&typeof e[0]=="object"&&e[0]._meta){const y=e[0];s=y.type||"normal",y.groups&&(c=y.groups),y.stepGroups&&(u=y.stepGroups);const b=e.slice(1);s==="bread"?(a=b.filter(v=>v._group==="flour").map(v=>{const{_group:S,..._}=v;return _}),l=b.filter(v=>v._group==="other").map(v=>{const{_group:S,..._}=v;return _}),h=[...a,...l]):h=b}else n.ingredients_meta&&(s=n.ingredients_meta.type||"normal",Array.isArray(n.ingredients_meta.groups)&&(c=n.ingredients_meta.groups),Array.isArray(n.ingredients_meta.stepGroups)&&(u=n.ingredients_meta.stepGroups),h=Array.isArray(e)?e:[]);let m=n.steps||[];if(u.length>0&&Array.isArray(m)){let y=0;m=m.map(v=>({text:v}));const b=[];for(u.forEach(v=>{const S=v.count||0;for(let _=0;_<S;_++)y<m.length&&(b.push({...m[y],text:m[y].text,groupId:v.id}),y++)});y<m.length;)b.push({...m[y],groupId:"default"}),y++;m=b}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:s,flours:a,breadIngredients:l,ingredientGroups:c,stepGroups:u,ingredients:h,steps:m.length>0&&typeof m[0]=="object"?m:n.steps,tags:f,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},hE=n=>({...js(n),deletedAt:n.deleted_at,originalId:n.original_id}),np=Object.freeze(Object.defineProperty({__proto__:null,recipeService:jn},Symbol.toStringTag,{value:"Module"})),rp="food",fE="food_alcohol",pE=new Set(["food","alcohol","soft_drink","supplies"]),Fu=n=>{const e=String(n||"").trim();return!e||e===fE?rp:pE.has(e)?e:rp},On={async _getCurrentUserId(){const{data:n,error:e}=await Ee.auth.getUser();if(e)throw e;return n?.user?.id||null},async saveConversion(n,e,s,a=null,l=null,c=void 0,u=void 0){try{const h=await this._getCurrentUserId();if(!h)throw new Error("");const f={user_id:h,ingredient_name:n,packet_size:parseFloat(e),packet_unit:s,last_price:a?parseFloat(a):null,updated_at:new Date().toISOString()};if(l&&(f.item_category=Fu(l)),c!==void 0){const b=String(c??"").trim();f.vendor=b||null}if(u!==void 0){const b=parseFloat(u);let v=Number.isFinite(b)?b:100;v<=0&&(v=100),v>100&&(v=100),f.yield_percent=v}const p=async b=>Ee.from("unit_conversions").upsert(b,{onConflict:"user_id,ingredient_name"}).select().single();let{data:m,error:y}=await p(f);if(y){const b=String(y.message||""),v=!!f.item_category&&b.includes("item_category"),S=Object.prototype.hasOwnProperty.call(f,"vendor")&&b.includes("vendor"),_=Object.prototype.hasOwnProperty.call(f,"yield_percent")&&b.includes("yield_percent");if(v||S||_){const w={...f};v&&delete w.item_category,S&&delete w.vendor,_&&delete w.yield_percent,{data:m,error:y}=await p(w)}}if(y)throw y;return{ingredientName:m.ingredient_name,packetSize:m.packet_size,packetUnit:m.packet_unit,lastPrice:m.last_price,vendor:m.vendor||"",itemCategory:Fu(m.item_category),yieldPercent:m.yield_percent===null||m.yield_percent===void 0?100:m.yield_percent,updatedAt:m.updated_at}}catch(h){throw console.error("Error saving conversion:",h),h}},async getConversion(n){try{const e=await this._getCurrentUserId();if(!e)return null;const{data:s,error:a}=await Ee.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",e).single();return a?(a.code==="PGRST116"||console.warn("Error fetching conversion:",a),null):{ingredientName:s.ingredient_name,packetSize:s.packet_size,packetUnit:s.packet_unit,lastPrice:s.last_price,vendor:s.vendor||"",itemCategory:Fu(s.item_category),yieldPercent:s.yield_percent===null||s.yield_percent===void 0?100:s.yield_percent,updatedAt:s.updated_at}}catch(e){return console.error("Error in getConversion:",e),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:e,error:s}=await Ee.from("unit_conversions").select("*").eq("user_id",n);if(s)throw s;const a=new Map;return e.forEach(l=>{a.set(l.ingredient_name,{ingredientName:l.ingredient_name,packetSize:l.packet_size,packetUnit:l.packet_unit,lastPrice:l.last_price,vendor:l.vendor||"",itemCategory:Fu(l.item_category),yieldPercent:l.yield_percent===null||l.yield_percent===void 0?100:l.yield_percent,updatedAt:l.updated_at})}),a}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const e=await this._getCurrentUserId();if(!e)throw new Error("");const{error:s}=await Ee.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",e);if(s)throw s;return{success:!0}}catch(e){throw console.error("Error deleting conversion:",e),e}},async adminCopyIngredientMasterToUser(n,{overwrite:e=!1}={}){const s=String(n||"").trim();if(!s)throw new Error("");const{data:a,error:l}=await Ee.rpc("admin_copy_ingredient_master",{target_profile_id:s,overwrite:e===!0});if(l)throw l;return a},async adminCopyMasterToAllUsers(){const n=await this._getCurrentUserId();if(!n)throw new Error("");const{error:e}=await Ee.rpc("admin_copy_master_to_all_users",{p_admin_id:n});if(e)throw e;return{success:!0}},async moveAllToTrash(){const n=await this._getCurrentUserId();if(!n)throw new Error("");const{data:e,error:s}=await Ee.from("unit_conversions").select("*").eq("user_id",n);if(s)throw s;const{data:a,error:l}=await Ee.from("csv_unit_overrides").select("*").eq("user_id",n);if(l)throw l;const c=(e||[]).length;if(c===0&&(a||[]).length===0)return{moved:0};const{error:u}=await Ee.from("trash_ingredient_master").insert([{user_id:n,label:`${new Date().toLocaleDateString("ja-JP")}`,snapshot_unit_conversions:e||[],snapshot_csv_unit_overrides:a||[]}]);if(u)throw u;if((e||[]).length>0){const{error:h}=await Ee.from("unit_conversions").delete().eq("user_id",n);if(h)throw h}if((a||[]).length>0){const{error:h}=await Ee.from("csv_unit_overrides").delete().eq("user_id",n);if(h)throw h}return{moved:c}},async adminClearAllNonAdminMaster(){if(!await this._getCurrentUserId())throw new Error("");const{data:e,error:s}=await Ee.rpc("admin_clear_all_non_admin_ingredient_master");if(s)throw s;return{deleted_unit_conversions:e.deleted_unit_conversions||0,deleted_csv_overrides:e.deleted_csv_overrides||0}},async adminClearTargetUserMaster(n){const e=await this._getCurrentUserId();if(!e)throw new Error("");if(n===e)throw new Error("");const{data:s,error:a}=await Ee.rpc("admin_clear_target_user_ingredient_master",{target_user_id:n});if(a)throw a;return{deleted_unit_conversions:s.deleted_unit_conversions||0,deleted_csv_overrides:s.deleted_csv_overrides||0}}},Zb=k.createContext(null),ms=()=>k.useContext(Zb),ew=k.createContext(null),Ps=()=>{const n=k.useContext(ew);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},md=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],mE=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var So={},sp={exports:{}},ip,X0;function gE(){if(X0)return ip;X0=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ip=n,ip}var ap,Z0;function yE(){if(Z0)return ap;Z0=1;var n=gE();function e(){}function s(){}return s.resetWarningCache=e,ap=function(){function a(u,h,f,p,m,y){if(y!==n){var b=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw b.name="Invariant Violation",b}}a.isRequired=a;function l(){return a}var c={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:e};return c.PropTypes=c,c},ap}var ex;function tw(){return ex||(ex=1,sp.exports=yE()()),sp.exports}var op,tx;function nw(){return tx||(tx=1,op={L:1,M:0,Q:3,H:2}),op}var lp,nx;function rw(){return nx||(nx=1,lp={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),lp}var cp,rx;function vE(){if(rx)return cp;rx=1;var n=rw();function e(s){this.mode=n.MODE_8BIT_BYTE,this.data=s}return e.prototype={getLength:function(s){return this.data.length},write:function(s){for(var a=0;a<this.data.length;a++)s.put(this.data.charCodeAt(a),8)}},cp=e,cp}var up,sx;function xE(){if(sx)return up;sx=1;var n=nw();function e(s,a){this.totalCount=s,this.dataCount=a}return e.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e.getRSBlocks=function(s,a){var l=e.getRsBlockTable(s,a);if(l==null)throw new Error("bad rs block @ typeNumber:"+s+"/errorCorrectLevel:"+a);for(var c=l.length/3,u=new Array,h=0;h<c;h++)for(var f=l[h*3+0],p=l[h*3+1],m=l[h*3+2],y=0;y<f;y++)u.push(new e(p,m));return u},e.getRsBlockTable=function(s,a){switch(a){case n.L:return e.RS_BLOCK_TABLE[(s-1)*4+0];case n.M:return e.RS_BLOCK_TABLE[(s-1)*4+1];case n.Q:return e.RS_BLOCK_TABLE[(s-1)*4+2];case n.H:return e.RS_BLOCK_TABLE[(s-1)*4+3];default:return}},up=e,up}var dp,ix;function bE(){if(ix)return dp;ix=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(e){var s=Math.floor(e/8);return(this.buffer[s]>>>7-e%8&1)==1},put:function(e,s){for(var a=0;a<s;a++)this.putBit((e>>>s-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(e){var s=Math.floor(this.length/8);this.buffer.length<=s&&this.buffer.push(0),e&&(this.buffer[s]|=128>>>this.length%8),this.length++}},dp=n,dp}var hp,ax;function sw(){if(ax)return hp;ax=1;for(var n={glog:function(s){if(s<1)throw new Error("glog("+s+")");return n.LOG_TABLE[s]},gexp:function(s){for(;s<0;)s+=255;for(;s>=256;)s-=255;return n.EXP_TABLE[s]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},e=0;e<8;e++)n.EXP_TABLE[e]=1<<e;for(var e=8;e<256;e++)n.EXP_TABLE[e]=n.EXP_TABLE[e-4]^n.EXP_TABLE[e-5]^n.EXP_TABLE[e-6]^n.EXP_TABLE[e-8];for(var e=0;e<255;e++)n.LOG_TABLE[n.EXP_TABLE[e]]=e;return hp=n,hp}var fp,ox;function iw(){if(ox)return fp;ox=1;var n=sw();function e(s,a){if(s.length==null)throw new Error(s.length+"/"+a);for(var l=0;l<s.length&&s[l]==0;)l++;this.num=new Array(s.length-l+a);for(var c=0;c<s.length-l;c++)this.num[c]=s[c+l]}return e.prototype={get:function(s){return this.num[s]},getLength:function(){return this.num.length},multiply:function(s){for(var a=new Array(this.getLength()+s.getLength()-1),l=0;l<this.getLength();l++)for(var c=0;c<s.getLength();c++)a[l+c]^=n.gexp(n.glog(this.get(l))+n.glog(s.get(c)));return new e(a,0)},mod:function(s){if(this.getLength()-s.getLength()<0)return this;for(var a=n.glog(this.get(0))-n.glog(s.get(0)),l=new Array(this.getLength()),c=0;c<this.getLength();c++)l[c]=this.get(c);for(var c=0;c<s.getLength();c++)l[c]^=n.gexp(n.glog(s.get(c))+a);return new e(l,0).mod(s)}},fp=e,fp}var pp,lx;function wE(){if(lx)return pp;lx=1;var n=rw(),e=iw(),s=sw(),a={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},l={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(c){for(var u=c<<10;l.getBCHDigit(u)-l.getBCHDigit(l.G15)>=0;)u^=l.G15<<l.getBCHDigit(u)-l.getBCHDigit(l.G15);return(c<<10|u)^l.G15_MASK},getBCHTypeNumber:function(c){for(var u=c<<12;l.getBCHDigit(u)-l.getBCHDigit(l.G18)>=0;)u^=l.G18<<l.getBCHDigit(u)-l.getBCHDigit(l.G18);return c<<12|u},getBCHDigit:function(c){for(var u=0;c!=0;)u++,c>>>=1;return u},getPatternPosition:function(c){return l.PATTERN_POSITION_TABLE[c-1]},getMask:function(c,u,h){switch(c){case a.PATTERN000:return(u+h)%2==0;case a.PATTERN001:return u%2==0;case a.PATTERN010:return h%3==0;case a.PATTERN011:return(u+h)%3==0;case a.PATTERN100:return(Math.floor(u/2)+Math.floor(h/3))%2==0;case a.PATTERN101:return u*h%2+u*h%3==0;case a.PATTERN110:return(u*h%2+u*h%3)%2==0;case a.PATTERN111:return(u*h%3+(u+h)%2)%2==0;default:throw new Error("bad maskPattern:"+c)}},getErrorCorrectPolynomial:function(c){for(var u=new e([1],0),h=0;h<c;h++)u=u.multiply(new e([1,s.gexp(h)],0));return u},getLengthInBits:function(c,u){if(1<=u&&u<10)switch(c){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+c)}else if(u<27)switch(c){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+c)}else if(u<41)switch(c){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+c)}else throw new Error("type:"+u)},getLostPoint:function(c){for(var u=c.getModuleCount(),h=0,f=0;f<u;f++)for(var p=0;p<u;p++){for(var m=0,y=c.isDark(f,p),b=-1;b<=1;b++)if(!(f+b<0||u<=f+b))for(var v=-1;v<=1;v++)p+v<0||u<=p+v||b==0&&v==0||y==c.isDark(f+b,p+v)&&m++;m>5&&(h+=3+m-5)}for(var f=0;f<u-1;f++)for(var p=0;p<u-1;p++){var S=0;c.isDark(f,p)&&S++,c.isDark(f+1,p)&&S++,c.isDark(f,p+1)&&S++,c.isDark(f+1,p+1)&&S++,(S==0||S==4)&&(h+=3)}for(var f=0;f<u;f++)for(var p=0;p<u-6;p++)c.isDark(f,p)&&!c.isDark(f,p+1)&&c.isDark(f,p+2)&&c.isDark(f,p+3)&&c.isDark(f,p+4)&&!c.isDark(f,p+5)&&c.isDark(f,p+6)&&(h+=40);for(var p=0;p<u;p++)for(var f=0;f<u-6;f++)c.isDark(f,p)&&!c.isDark(f+1,p)&&c.isDark(f+2,p)&&c.isDark(f+3,p)&&c.isDark(f+4,p)&&!c.isDark(f+5,p)&&c.isDark(f+6,p)&&(h+=40);for(var _=0,p=0;p<u;p++)for(var f=0;f<u;f++)c.isDark(f,p)&&_++;var w=Math.abs(100*_/u/u-50)/5;return h+=w*10,h}};return pp=l,pp}var mp,cx;function _E(){if(cx)return mp;cx=1;var n=vE(),e=xE(),s=bE(),a=wE(),l=iw();function c(h,f){this.typeNumber=h,this.errorCorrectLevel=f,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var u=c.prototype;return u.addData=function(h){var f=new n(h);this.dataList.push(f),this.dataCache=null},u.isDark=function(h,f){if(h<0||this.moduleCount<=h||f<0||this.moduleCount<=f)throw new Error(h+","+f);return this.modules[h][f]},u.getModuleCount=function(){return this.moduleCount},u.make=function(){if(this.typeNumber<1){var h=1;for(h=1;h<40;h++){for(var f=e.getRSBlocks(h,this.errorCorrectLevel),p=new s,m=0,y=0;y<f.length;y++)m+=f[y].dataCount;for(var y=0;y<this.dataList.length;y++){var b=this.dataList[y];p.put(b.mode,4),p.put(b.getLength(),a.getLengthInBits(b.mode,h)),b.write(p)}if(p.getLengthInBits()<=m*8)break}this.typeNumber=h}this.makeImpl(!1,this.getBestMaskPattern())},u.makeImpl=function(h,f){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var p=0;p<this.moduleCount;p++){this.modules[p]=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++)this.modules[p][m]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(h,f),this.typeNumber>=7&&this.setupTypeNumber(h),this.dataCache==null&&(this.dataCache=c.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,f)},u.setupPositionProbePattern=function(h,f){for(var p=-1;p<=7;p++)if(!(h+p<=-1||this.moduleCount<=h+p))for(var m=-1;m<=7;m++)f+m<=-1||this.moduleCount<=f+m||(0<=p&&p<=6&&(m==0||m==6)||0<=m&&m<=6&&(p==0||p==6)||2<=p&&p<=4&&2<=m&&m<=4?this.modules[h+p][f+m]=!0:this.modules[h+p][f+m]=!1)},u.getBestMaskPattern=function(){for(var h=0,f=0,p=0;p<8;p++){this.makeImpl(!0,p);var m=a.getLostPoint(this);(p==0||h>m)&&(h=m,f=p)}return f},u.createMovieClip=function(h,f,p){var m=h.createEmptyMovieClip(f,p),y=1;this.make();for(var b=0;b<this.modules.length;b++)for(var v=b*y,S=0;S<this.modules[b].length;S++){var _=S*y,w=this.modules[b][S];w&&(m.beginFill(0,100),m.moveTo(_,v),m.lineTo(_+y,v),m.lineTo(_+y,v+y),m.lineTo(_,v+y),m.endFill())}return m},u.setupTimingPattern=function(){for(var h=8;h<this.moduleCount-8;h++)this.modules[h][6]==null&&(this.modules[h][6]=h%2==0);for(var f=8;f<this.moduleCount-8;f++)this.modules[6][f]==null&&(this.modules[6][f]=f%2==0)},u.setupPositionAdjustPattern=function(){for(var h=a.getPatternPosition(this.typeNumber),f=0;f<h.length;f++)for(var p=0;p<h.length;p++){var m=h[f],y=h[p];if(this.modules[m][y]==null)for(var b=-2;b<=2;b++)for(var v=-2;v<=2;v++)b==-2||b==2||v==-2||v==2||b==0&&v==0?this.modules[m+b][y+v]=!0:this.modules[m+b][y+v]=!1}},u.setupTypeNumber=function(h){for(var f=a.getBCHTypeNumber(this.typeNumber),p=0;p<18;p++){var m=!h&&(f>>p&1)==1;this.modules[Math.floor(p/3)][p%3+this.moduleCount-8-3]=m}for(var p=0;p<18;p++){var m=!h&&(f>>p&1)==1;this.modules[p%3+this.moduleCount-8-3][Math.floor(p/3)]=m}},u.setupTypeInfo=function(h,f){for(var p=this.errorCorrectLevel<<3|f,m=a.getBCHTypeInfo(p),y=0;y<15;y++){var b=!h&&(m>>y&1)==1;y<6?this.modules[y][8]=b:y<8?this.modules[y+1][8]=b:this.modules[this.moduleCount-15+y][8]=b}for(var y=0;y<15;y++){var b=!h&&(m>>y&1)==1;y<8?this.modules[8][this.moduleCount-y-1]=b:y<9?this.modules[8][15-y-1+1]=b:this.modules[8][15-y-1]=b}this.modules[this.moduleCount-8][8]=!h},u.mapData=function(h,f){for(var p=-1,m=this.moduleCount-1,y=7,b=0,v=this.moduleCount-1;v>0;v-=2)for(v==6&&v--;;){for(var S=0;S<2;S++)if(this.modules[m][v-S]==null){var _=!1;b<h.length&&(_=(h[b]>>>y&1)==1);var w=a.getMask(f,m,v-S);w&&(_=!_),this.modules[m][v-S]=_,y--,y==-1&&(b++,y=7)}if(m+=p,m<0||this.moduleCount<=m){m-=p,p=-p;break}}},c.PAD0=236,c.PAD1=17,c.createData=function(h,f,p){for(var m=e.getRSBlocks(h,f),y=new s,b=0;b<p.length;b++){var v=p[b];y.put(v.mode,4),y.put(v.getLength(),a.getLengthInBits(v.mode,h)),v.write(y)}for(var S=0,b=0;b<m.length;b++)S+=m[b].dataCount;if(y.getLengthInBits()>S*8)throw new Error("code length overflow. ("+y.getLengthInBits()+">"+S*8+")");for(y.getLengthInBits()+4<=S*8&&y.put(0,4);y.getLengthInBits()%8!=0;)y.putBit(!1);for(;!(y.getLengthInBits()>=S*8||(y.put(c.PAD0,8),y.getLengthInBits()>=S*8));)y.put(c.PAD1,8);return c.createBytes(y,m)},c.createBytes=function(h,f){for(var p=0,m=0,y=0,b=new Array(f.length),v=new Array(f.length),S=0;S<f.length;S++){var _=f[S].dataCount,w=f[S].totalCount-_;m=Math.max(m,_),y=Math.max(y,w),b[S]=new Array(_);for(var j=0;j<b[S].length;j++)b[S][j]=255&h.buffer[j+p];p+=_;var N=a.getErrorCorrectPolynomial(w),T=new l(b[S],N.getLength()-1),R=T.mod(N);v[S]=new Array(N.getLength()-1);for(var j=0;j<v[S].length;j++){var $=j+R.getLength()-v[S].length;v[S][j]=$>=0?R.get($):0}}for(var F=0,j=0;j<f.length;j++)F+=f[j].totalCount;for(var q=new Array(F),I=0,j=0;j<m;j++)for(var S=0;S<f.length;S++)j<b[S].length&&(q[I++]=b[S][j]);for(var j=0;j<y;j++)for(var S=0;S<f.length;S++)j<v[S].length&&(q[I++]=v[S][j]);return q},mp=c,mp}var Hu={},ux;function SE(){if(ux)return Hu;ux=1,Object.defineProperty(Hu,"__esModule",{value:!0});var n=Object.assign||function(p){for(var m=1;m<arguments.length;m++){var y=arguments[m];for(var b in y)Object.prototype.hasOwnProperty.call(y,b)&&(p[b]=y[b])}return p},e=tw(),s=c(e),a=gc(),l=c(a);function c(p){return p&&p.__esModule?p:{default:p}}function u(p,m){var y={};for(var b in p)m.indexOf(b)>=0||Object.prototype.hasOwnProperty.call(p,b)&&(y[b]=p[b]);return y}var h={bgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,bgD:s.default.string.isRequired,fgColor:s.default.oneOfType([s.default.object,s.default.string]).isRequired,fgD:s.default.string.isRequired,size:s.default.number.isRequired,title:s.default.string,viewBoxSize:s.default.number.isRequired,xmlns:s.default.string},f=(0,a.forwardRef)(function(p,m){var y=p.bgColor,b=p.bgD,v=p.fgD,S=p.fgColor,_=p.size,w=p.title,j=p.viewBoxSize,N=p.xmlns,T=N===void 0?"http://www.w3.org/2000/svg":N,R=u(p,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return l.default.createElement("svg",n({},R,{height:_,ref:m,viewBox:"0 0 "+j+" "+j,width:_,xmlns:T}),w?l.default.createElement("title",null,w):null,l.default.createElement("path",{d:b,fill:y}),l.default.createElement("path",{d:v,fill:S}))});return f.displayName="QRCodeSvg",f.propTypes=h,Hu.default=f,Hu}var dx;function jE(){if(dx)return So;dx=1,Object.defineProperty(So,"__esModule",{value:!0}),So.QRCode=void 0;var n=Object.assign||function(_){for(var w=1;w<arguments.length;w++){var j=arguments[w];for(var N in j)Object.prototype.hasOwnProperty.call(j,N)&&(_[N]=j[N])}return _},e=tw(),s=y(e),a=nw(),l=y(a),c=_E(),u=y(c),h=gc(),f=y(h),p=SE(),m=y(p);function y(_){return _&&_.__esModule?_:{default:_}}function b(_,w){var j={};for(var N in _)w.indexOf(N)>=0||Object.prototype.hasOwnProperty.call(_,N)&&(j[N]=_[N]);return j}var v={bgColor:s.default.oneOfType([s.default.object,s.default.string]),fgColor:s.default.oneOfType([s.default.object,s.default.string]),level:s.default.string,size:s.default.number,value:s.default.string.isRequired},S=(0,h.forwardRef)(function(_,w){var j=_.bgColor,N=j===void 0?"#FFFFFF":j,T=_.fgColor,R=T===void 0?"#000000":T,$=_.level,F=$===void 0?"L":$,q=_.size,I=q===void 0?256:q,U=_.value,P=b(_,["bgColor","fgColor","level","size","value"]),V=new u.default(-1,l.default[F]);V.addData(U),V.make();var D=V.modules;return f.default.createElement(m.default,n({},P,{bgColor:N,bgD:D.map(function(H,C){return H.map(function(M,z){return M?"":"M "+z+" "+C+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:R,fgD:D.map(function(H,C){return H.map(function(M,z){return M?"M "+z+" "+C+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:w,size:I,viewBoxSize:D.length}))});return So.QRCode=S,S.displayName="QRCode",S.propTypes=v,So.default=S,So}var CE=jE();const hx=Kp(CE),fx=n=>{if(!n)return"";const e=new Date(n);return`${e.getFullYear()}/${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")}`},kE=n=>{if(n==null)return NaN;if(typeof n=="number")return Number.isFinite(n)?n:NaN;const e=String(n).trim().replace(/[,\s]/g,"");if(!e)return NaN;const s=parseFloat(e);return Number.isFinite(s)?s:NaN},Bs=(n,{maximumFractionDigits:e=1}={})=>{const s=kE(n);return Number.isFinite(s)?`${s.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:e})}`:null},NE=new Set(["food","alcohol","soft_drink","supplies"]),aw=new Set(["alcohol","supplies"]),ow=n=>{const e=String(n||"").trim().toLowerCase();return e?e==="food_alcohol"?"food":NE.has(e)?e:"":""},$p=n=>{const e=ow(n?.itemCategory??n?.item_category);return e?aw.has(e):!!n?.isAlcohol},ja=n=>$p(n)?1.1:1.08,px=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),EE=(n,e)=>{if(!n||n.size===0||!e)return null;const s=n.get(e);if(s)return s;const a=px(e);if(!a)return null;for(const[l,c]of n.entries())if(px(l)===a)return c;return null},pi=n=>{const e=parseFloat(n);return Number.isFinite(e)?e:NaN},AE=n=>{const e=pi(n);return!Number.isFinite(e)||e<=0||e>100?100:e},TE=(n,e)=>{const s=e?.yieldPercent??e?.yield_percent??n?.yieldPercent??n?.yield_percent;return AE(s)/100},RE=(n,e,s)=>{const a=pi(n),l=pi(e);if(!Number.isFinite(a)||!Number.isFinite(l)||l<=0)return NaN;const c=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(c)?a/l*1e3:["kg","","l",""].includes(c)?a/l:["cl",""].includes(c)?a/l*100:a/l},mx=(n,e,s,{defaultWeightWhenUnitEmpty:a=!1,forceWeightBased:l=!1,yieldRate:c=1}={})=>{const u=pi(n),h=pi(e);if(!Number.isFinite(u)||!Number.isFinite(h))return NaN;const f=Number.isFinite(c)&&c>0?c:1,p=String(s||"").trim().toLowerCase();return l||!p&&a||["g","","ml","","cc",""].includes(p)?u/1e3*h/f:["cl",""].includes(p)?u*10/1e3*h/f:u*h/f},OE=(n,e)=>{const s=pi(n?.purchaseCost),a=pi(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(e)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-e)>.01):!1},DE=2,Do=Object.freeze({course:"",category:"",storeName:"",servings:"",ingredients:"",ingredientName:"",quantity:"",quantityGram:" (g)",unit:"",purchase:"",cost:"",totalCost:"",instructions:"",sourceRecipe:"",flourGroup:"",otherIngredients:"",scaleMultiplier:"",noSteps:"",print:"",close:""}),gx=Object.keys(Do),zE=({recipe:n,ownerLabel:e,onBack:s,onEdit:a,onDelete:l,onHardDelete:c,isDeleted:u,onView:h,onDuplicate:f,backLabel:p,onList:m})=>{const{user:y}=ms(),b=Ps(),[v,S]=Ie.useState(!1),[_,w]=Ie.useState(!1),[j,N]=Ie.useState(!1),[T,R]=Ie.useState(new Set),[$,F]=Ie.useState(new Set),[q,I]=Ie.useState(new Set),[U,P]=Ie.useState({}),[V,D]=Ie.useState("ORIGINAL"),[H,C]=Ie.useState(!1),[M,z]=Ie.useState(!0),[B,K]=Ie.useState(!1),[Q,Z]=Ie.useState(new Map),[A,L]=Ie.useState({}),[J,ae]=Ie.useState(""),[ue,Ce]=Ie.useState(1),[fe,ne]=Ie.useState(""),[be,le]=Ie.useState(""),ie=Ie.useMemo(()=>{const ce=parseFloat(ue);return isNaN(ce)?1:ce},[ue]),Te=(ce,se)=>{if(!ce)return"";const xe=parseFloat(ce);if(isNaN(xe))return ce;const Ne=xe*parseFloat(se);return Number.isInteger(Ne)?Ne.toString():Ne.toFixed(1).replace(/\.0$/,"")},Le=(ce,se)=>{if(!ce)return"";const xe=parseFloat(ce);return isNaN(xe)?ce:(xe*parseFloat(se)).toFixed(2).replace(/\.00$/,"")},[E,ve]=Ie.useState(n),[ge,Y]=Ie.useState(!1),[W,oe]=Ie.useState(!1),re=E||n,ee=V==="ORIGINAL"?E:U[V]||E,de=V==="ORIGINAL"||V==="JA"?Do:A[V]||Do,me=ce=>de[ce]||Do[ce]||ce;Ie.useEffect(()=>{let ce=!0;return On.getAllConversions().then(se=>{ce&&Z(se)}).catch(()=>{ce&&Z(new Map)}),()=>{ce=!1}},[]);const Be=Ie.useMemo(()=>{const ce=(se,xe={})=>{if(!se||typeof se!="object")return se;const Ne=EE(Q,se.name),Ke=ow(se.itemCategory??se.item_category??Ne?.itemCategory),tt=TE(se,Ne);let Ze=se;if(Ke&&(Ze={...Ze,itemCategory:Ke,isAlcohol:aw.has(Ke)}),!Ne||!Ne.packetSize){const Ve=String(se.unit||"").trim();if(xe.forceWeightBased||xe.defaultWeightWhenUnitEmpty&&!Ve){const nn=mx(se.quantity,Ze.purchaseCost,se.unit,{...xe,yieldRate:tt}),Vn=Number.isFinite(nn)?Math.round(nn*100)/100:NaN,Xn=pi(Ze.cost);if(Number.isFinite(Vn)&&(!Number.isFinite(Xn)||Math.abs(Xn-Vn)>.01))return{...Ze,cost:Vn}}return Ze}const lt=[Ne.lastPrice,se.purchaseCostRef,se.purchase_cost,se.purchaseCost].find(Ve=>Number.isFinite(pi(Ve))),Pt=RE(lt,Ne.packetSize,Ne.packetUnit);if(!Number.isFinite(Pt)||!OE(se,Pt))return Ze;const $t=mx(se.quantity,Pt,se.unit,{...xe,yieldRate:tt});return{...Ze,purchaseCost:Math.round(Pt*100)/100,cost:Number.isFinite($t)?Math.round($t*100)/100:Ze.cost}};return{...ee,ingredients:(ee.ingredients||[]).map(se=>ce(se)),flours:(ee.flours||[]).map(se=>ce(se,{forceWeightBased:!0})),breadIngredients:(ee.breadIngredients||[]).map(se=>ce(se,{forceWeightBased:!0}))}},[Q,ee]);Ie.useEffect(()=>{ve(n),!n.steps&&!u&&(Y(!0),jn.getRecipe(n.id).then(ce=>{ve(ce)}).catch(ce=>{console.error("Failed to load details",ce)}).finally(()=>{Y(!1)}))},[n,u]);const[Re,Pe]=Ie.useState(n.tags?.includes("public")||!1),Je=y?.role==="admin"||n.tags&&n.tags.includes(`owner:${y?.id}`)||y?.displayId&&n.tags&&n.tags.includes(`owner:${y.displayId}`),Et=!(n.tags&&n.tags.some(ce=>ce.startsWith("owner:")))||Je,Wt=async()=>{const ce=!Re;try{const se=n.tags||[];let xe;ce?xe=[...se,"public"]:xe=se.filter(Ne=>Ne!=="public"),Pe(ce),await jn.updateRecipe({id:n.id,tags:xe})}catch(se){console.error("Failed to toggle public",se),b.error(""),Pe(!ce)}},dt=(ce,se,xe=!1)=>V==="ORIGINAL"||!M||!se||ce===se?ce:r.jsxs(r.Fragment,{children:[ce,xe?r.jsx("br",{}):" ",r.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",se,")"]})]}),yt=(ce,se)=>{const xe=String(ce??"").trim(),Ne=String(se??"").trim();return V==="ORIGINAL"||!M||!Ne||xe===Ne?xe||Ne:`${xe}${Ne}`},ft=ce=>!ce||!Array.isArray(ce.steps)?!1:ce.type==="bread"?Array.isArray(ce.flours)&&Array.isArray(ce.breadIngredients):Array.isArray(ce.ingredients),Tt=(ce,se)=>!ce||!se||ce.__translationVersion!==DE||Array.isArray(se.steps)&&!Array.isArray(ce.steps)?!1:se.type==="bread"?!((se.flours||[]).length>0&&(ce.flours||[]).length===0||(se.breadIngredients||[]).length>0&&(ce.breadIngredients||[]).length===0):!((se.ingredients||[]).length>0&&(ce.ingredients||[]).length===0),sn=async ce=>{const se=ce.target.value;if(D(se),se==="ORIGINAL")return;let xe=E||n;if(!u&&n?.id&&!ft(xe))try{Y(!0);const tt=await jn.getRecipe(n.id);tt&&(xe=tt,ve(tt))}catch(tt){console.error("Failed to load full recipe for translation",tt)}finally{Y(!1)}const Ne=U[se]&&Tt(U[se],xe),Ke=se!=="JA"&&!A[se];if(!(Ne&&!Ke)){C(!0);try{let tt=null;if(await Promise.all([(async()=>{if(!Ne)try{const Ze=await Q0.translateRecipe(xe,se);P(Xe=>({...Xe,[se]:Ze}))}catch(Ze){tt=Ze}})(),(async()=>{if(Ke)try{const Ze=await Q0.translateList(gx.map(lt=>Do[lt]),se),Xe=gx.reduce((lt,Pt,$t)=>(lt[Pt]=Ze[$t]||Do[Pt],lt),{});L(lt=>({...lt,[se]:Xe}))}catch(Ze){console.error("Failed to translate UI labels",Ze)}})()]),tt)throw tt}catch(tt){console.error(tt),b.error(""),D("ORIGINAL")}finally{C(!1)}}},wt=ce=>{R(se=>{const xe=new Set(se);return xe.has(ce)?xe.delete(ce):xe.add(ce),xe})},Un=ce=>{F(se=>{const xe=new Set(se);return xe.has(ce)?xe.delete(ce):xe.add(ce),xe})},Lt=ce=>{I(se=>{const xe=new Set(se);return xe.has(ce)?xe.delete(ce):xe.add(ce),xe})};Ie.useEffect(()=>{window.scrollTo(0,0),h&&n&&!u&&h(n.id);const ce=document.title;return n&&n.title&&(document.title=n.title),P({}),D("ORIGINAL"),R(new Set),F(new Set),I(new Set),Pe(n.tags?.includes("public")||!1),()=>{document.title=ce}},[n.id,n.title]),Ie.useEffect(()=>{n&&n.servings?le(n.servings.toString()):le(""),ne("")},[n]);const qt=()=>{S(!0)},un=()=>{S(!1),l(n)},yn=()=>{S(!1)},_t=()=>{N(!0)},jt=()=>{N(!1),c(n)},Kt=()=>{N(!1)},Ft=()=>{w(!0)},dn=async()=>{w(!1);try{const ce=await jn.duplicateRecipe(n,y);f&&f(ce)}catch(ce){console.error("Duplication failed",ce),b.error("")}},Ht=()=>{w(!1)},gn=Ie.useRef(null),hn=Ie.useRef(null),an=ce=>{hn.current=null,gn.current=ce.targetTouches[0].clientX},Dn=ce=>{hn.current=ce.targetTouches[0].clientX},Vt=()=>{if(!gn.current||!hn.current)return;const ce=gn.current-hn.current,se=gn.current<50,xe=ce<-100;se&&xe&&s()},Cn=ce=>{const se=Math.round(parseFloat(ce)),xe=parseFloat(fe),Ne=parseFloat(be);let Ke=null,tt=null,Ze=null;return!isNaN(se)&&!isNaN(Ne)&&Ne>0&&(Ze=se/Ne),!isNaN(se)&&!isNaN(xe)&&!isNaN(Ne)&&xe>0&&Ne>0&&(tt=xe*Ne,Ke=se/tt*100),r.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[r.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{children:["  ",r.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),r.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[r.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),r.jsx("input",{type:"number",value:fe,onChange:Xe=>ne(Xe.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[r.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),r.jsx("input",{type:"number",value:be,onChange:Xe=>le(Xe.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Ze!==null&&r.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Ke!==null?Ke>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Ke!==null?Ke>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Ke!==null?"6px":"0"},children:["1(): ",r.jsxs("strong",{children:["",Ze.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Ke!==null&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",tt.toLocaleString()]}),r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(tt-se).toLocaleString()]}),r.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Ke>40?"#d32f2f":"#2e7d32"},children:[": ",Ke.toFixed(1),"%"]})]})]})]})]})},It=Be.ingredients||[];let zn=ee.steps||[];const qn=ce=>String(ce||"").trim().toLowerCase(),fn=ce=>{const se=qn(ce);return se?["","","steps","method"].some(xe=>se===xe||se.includes(xe)):!1};if(!zn.length&&ee.ingredientGroups){const ce=ee.ingredientGroups.find(se=>fn(se.name));if(ce)zn=It.filter(xe=>xe.groupId===ce.id).map(xe=>typeof xe=="string"?xe:{...xe,text:xe.name||xe.text||""});else{const se=It.filter(xe=>fn(xe.group)||fn(xe.groupName));se.length&&(zn=se.map(xe=>typeof xe=="string"?xe:{...xe,text:xe.name||xe.text||""}))}}const Se=zn,nt=Ie.useMemo(()=>{const ce=ee.ingredientGroups||[],se=["","steps","method",""],xe=Xe=>String(Xe||"").trim().toLowerCase(),Ne=new Set(ce.filter(Xe=>se.includes(xe(Xe.name))).map(Xe=>Xe.id)),Ke=ce.filter(Xe=>!Ne.has(Xe.id));if(!Ke.length)return[{id:"default",name:null,items:It.filter(Xe=>!Ne.has(Xe.groupId))}];const tt=Ke.map(Xe=>{const lt=It.filter(Pt=>Pt.groupId===Xe.id);return{id:Xe.id,name:Xe.name===""?null:Xe.name,items:lt}}).filter(Xe=>Xe.items.length>0),Ze=It.filter(Xe=>Xe.groupId?Ne.has(Xe.groupId)?!1:!Ke.some(lt=>lt.id===Xe.groupId):!0);return Ze.length&&tt.push({id:"ungrouped",name:null,items:Ze}),tt.length?tt:[{id:"default",name:null,items:It.filter(Xe=>!Ne.has(Xe.groupId))}]},[ee.ingredientGroups,It]),te=Ie.useMemo(()=>{if(ee.type!=="bread")return null;const ce=Be.flours||[],se=Be.breadIngredients||[],xe=ce.reduce((Ve,ct)=>Ve+(parseFloat(ct.quantity)||0),0),Ne=xe+se.reduce((Ve,ct)=>Ve+(parseFloat(ct.quantity)||0),0),Ke=parseFloat(J),tt=Ke&&Ne?Ke/Ne:1,Ze=Ve=>xe?((parseFloat(Ve)||0)/xe*100).toFixed(1):"0.0",Xe=Ve=>Ke?((parseFloat(Ve)||0)*tt).toFixed(1):Ve,lt=Ve=>{const ct=parseFloat(Ve)||0;if(!Ke)return ct;const nn=ct*tt;return Math.round(nn*100)/100},Pt=Ve=>{const ct=lt(Ve);return Number.isFinite(ct)?ct.toLocaleString(void 0,{maximumFractionDigits:2}):""},$t=Ve=>Ve.reduce((ct,nn)=>{const Xn=(parseFloat(nn.cost)||0)*(Ke?tt:1),yr=ja(nn);return ct+Xn*yr},0);return{flours:ce,others:se,totalFlour:xe,grandTotal:Ne,calcPercent:Ze,getScaledQtyValue:Xe,getScaledCostValue:lt,formatCostValue:Pt,scaleFactor:tt,totalTaxIncluded:$t(ce)+$t(se)}},[Be.breadIngredients,Be.flours,ee.type,J]),ze=Ie.useMemo(()=>ee.type==="bread"?0:It.reduce((ce,se)=>{const Ne=(parseFloat(se.cost)||0)*ie,Ke=ja(se);return ce+Ne*Ke},0),[ee.type,It,ie]),Ae=ee.type==="bread"?te?Math.round(te.totalTaxIncluded).toLocaleString():"0":Math.round(ze).toLocaleString(),Qe=ee.description||re.description;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:an,onTouchMove:Dn,onTouchEnd:Vt,children:[_&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(mn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(he,{variant:"ghost",onClick:Ht,children:""}),r.jsx(he,{variant:"primary",onClick:dn,children:""})]})]})}),j&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(mn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(he,{variant:"ghost",onClick:Kt,children:""}),r.jsx(he,{variant:"danger",onClick:jt,children:""})]})]})}),v&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(mn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("small",{style:{color:"#666"},children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(he,{variant:"ghost",onClick:yn,children:""}),r.jsx(he,{variant:"danger",onClick:un,children:""})]})]})}),r.jsxs("div",{className:"recipe-detail__header",children:[r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx(he,{variant:"secondary",onClick:s,size:"sm",children:p||" "}),m&&r.jsx(he,{variant:"secondary",onClick:m,size:"sm",children:""})]}),!u&&r.jsxs("div",{className:"recipe-detail__actions",children:[Et&&(y?.displayId==="yoshito"||y?.role==="admin")&&r.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:Re,onChange:Wt,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),r.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:Re?"#4CAF50":"#888"},children:Re?"":""})]})}),!Et&&r.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),r.jsxs("select",{className:"language-select",value:V,onChange:sn,disabled:H,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[r.jsx("option",{value:"ORIGINAL",children:" Original ()"}),mE.map(ce=>r.jsx("option",{value:ce.code,children:ce.label},ce.code))]}),V!=="ORIGINAL"&&r.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:M,onChange:ce=>z(ce.target.checked),style:{marginRight:"4px"}}),""]}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>K(!0),children:" "}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),r.jsx(he,{variant:"secondary",size:"sm",onClick:Ft,children:""}),Et&&r.jsxs(r.Fragment,{children:[r.jsx(he,{variant:"secondary",size:"sm",onClick:a,children:""}),r.jsx(he,{variant:"danger",size:"sm",onClick:qt,style:{marginLeft:"0.5rem"},children:""})]})]}),u&&r.jsxs("div",{className:"recipe-detail__actions",children:[r.jsx(he,{variant:"ghost",size:"sm",onClick:_t,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),r.jsx(he,{variant:"primary",size:"sm",onClick:()=>l(n,!0),children:""})]})]}),r.jsx("div",{className:"recipe-detail__hero",children:ee.image?r.jsx("img",{src:ee.image,alt:ee.title,className:"recipe-detail__image"}):r.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),r.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[r.jsx("h1",{children:dt(ee.title,re.title)}),r.jsx("p",{className:"recipe-detail__desc",children:dt(ee.description,re.description,!0)}),y?.role==="admin"&&e&&r.jsxs("div",{className:"recipe-detail__owner",children:[" : ",e]}),r.jsxs("div",{className:"recipe-detail__meta",children:[ee.course&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:me("course")}),r.jsx("span",{className:"meta-value",children:dt(ee.course,re.course)})]}),ee.category&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:me("category")}),r.jsx("span",{className:"meta-value",children:dt(ee.category,re.category)})]}),ee.storeName&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:me("storeName")}),r.jsx("span",{className:"meta-value",children:dt(ee.storeName,re.storeName)})]}),r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:me("servings")}),r.jsxs("span",{className:"meta-value",children:[ee.servings,""]})]})]}),ee.sourceUrl&&r.jsx("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:r.jsxs("div",{style:{fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"12px"},children:[r.jsxs("a",{href:ee.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",r.jsx("span",{className:"screen-only",children:me("sourceRecipe")}),r.jsx("span",{className:"print-only",children:me("sourceRecipe")})]}),r.jsx("button",{onClick:()=>oe(!0),className:"screen-only",style:{background:"none",border:"none",padding:0,color:"var(--color-text-muted)",cursor:"pointer",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"4px",textDecoration:"underline"},children:" QR"})]})})]}),r.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[r.jsxs("span",{children:[" : ",fx(n.created_at)]}),n.updated_at&&r.jsxs("span",{children:[" : ",fx(n.updated_at)]})]}),r.jsx("div",{className:"recipe-detail__content",children:r.jsxs("div",{className:"recipe-detail__main",children:[r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:me("ingredients")}),r.jsx(mn,{className:"ingredients-card",children:ee.type==="bread"?r.jsx("div",{className:"bread-detail-view",children:(()=>{const ce=Be.flours||[],se=Be.breadIngredients||[],xe=ce.reduce((Ve,ct)=>Ve+(parseFloat(ct.quantity)||0),0),Ne=xe+se.reduce((Ve,ct)=>Ve+(parseFloat(ct.quantity)||0),0),Ke=xe?(Ne/xe*100).toFixed(1):"0.0",tt=Ve=>xe?((parseFloat(Ve)||0)/xe*100).toFixed(1):"0.0",Ze=parseFloat(J),Xe=Ze&&Ne?Ze/Ne:1,lt=Ve=>Ze?((parseFloat(Ve)||0)*Xe).toFixed(1):Ve,Pt=Ve=>{const ct=parseFloat(Ve)||0;if(!Ze)return ct;const nn=ct*Xe;return Math.round(nn*100)/100},$t=Ve=>Number.isFinite(Ve)?Ve.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),r.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[Ne.toLocaleString(),"g"]}),r.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Ke,"%)"]})]}),r.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("input",{id:"target-total-input",type:"number",value:J,onChange:Ve=>ae(Ve.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),r.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),J&&r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>ae(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),J&&r.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",Xe.toFixed(3)," "]})]}),r.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[r.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[r.jsx("span",{children:me("flourGroup")}),r.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",J?lt(xe):xe,"g (100%)"]})]}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:me("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:me("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:me("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:me("cost")})]})}),r.jsx("tbody",{children:ce.map((Ve,ct)=>{const nn=re.flours?.[ct]||{};return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`flour-${ct}`}),r.jsx("label",{htmlFor:`flour-${ct}`,children:dt(Ve.name,nn?.name)})]})}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:J?r.jsx("span",{style:{color:"var(--color-primary)"},children:lt(Ve.quantity)}):Ve.quantity}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[tt(Ve.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Bs(Ve.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:Ve.cost?`${$t(Pt(Ve.cost))}`:"-"})]},ct)})})]})]}),r.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[r.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:me("otherIngredients")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:me("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:me("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:me("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:me("cost")})]})}),r.jsx("tbody",{children:se.map((Ve,ct)=>{const nn=re.breadIngredients?.[ct]||{};return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ingredient-${ct}`}),r.jsx("label",{htmlFor:`ingredient-${ct}`,children:dt(Ve.name,nn?.name)})]})}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:J?r.jsx("span",{style:{color:"var(--color-primary)"},children:lt(Ve.quantity)}):Ve.quantity}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[tt(Ve.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Bs(Ve.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:Ve.cost?`${$t(Pt(Ve.cost))}`:"-"})]},ct)})})]}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[me("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const Ve=nn=>nn.reduce((Vn,Xn)=>{const yr=parseFloat(Xn.cost)||0,$r=ja(Xn),Or=yr*Xe;return Vn+Or*$r},0),ct=Ve(ce)+Ve(se);return Math.round(ct).toLocaleString()})()]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const Ve=nn=>nn.reduce((Vn,Xn)=>{const yr=parseFloat(Xn.cost)||0,$r=ja(Xn),Or=yr*Xe;return Vn+Or*$r},0),ct=Ve(ce)+Ve(se);return Cn(ct)})()]})]})})()}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[r.jsxs("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:[me("scaleMultiplier"),":"]}),r.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),r.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:ue,onChange:ce=>Ce(ce.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(ue)!==1&&r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>Ce("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const ce=ee.ingredientGroups&&ee.ingredientGroups.length>0?ee.ingredientGroups:null;return ce?ce.map(se=>{const xe=It.filter(Ne=>Ne.groupId===se.id);return xe.length===0||["","Steps","Method",""].includes(se.name)?null:r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(se.name)?"none":"block"},children:se.name}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:me("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:me("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:me("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:me("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:me("cost")})]})}),r.jsx("tbody",{children:xe.map((Ne,Ke)=>{const tt=It.indexOf(Ne),Ze=re.ingredients?.[tt],Xe=typeof Ne=="string"?Ne:Ne.name,lt=Ze?typeof Ze=="string"?Ze:Ze.name:"",Pt=typeof Ne=="object"?Ne.unit:"",$t=Ze&&typeof Ze=="object"?Ze.unit:"",Ve=Te(Ne.quantity,ue),ct=Le(Ne.cost,ue),nn=String(ue)!=="1";return r.jsxs("tr",{className:"ingredient-row",children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ing-${se.id}-${Ke}`}),r.jsx("label",{htmlFor:`ing-${se.id}-${Ke}`,children:dt(Xe,lt)})]})}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:nn?"bold":"normal",color:nn?"var(--color-primary)":"inherit"},children:Ve}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:dt(Pt,$t)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Bs(Ne.purchaseCost)??"-"}),r.jsxs("td",{style:{textAlign:"right"},children:[Bs(ct)??"-",$p(Ne)&&r.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Ke)})})]})]},se.id)}):r.jsxs(r.Fragment,{children:[r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:me("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:me("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:me("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:me("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:me("cost")})]})}),r.jsx("tbody",{children:It.map((se,xe)=>{const Ne=re.ingredients?.[xe],Ke=typeof se=="string"?se:se.name,tt=Ne?typeof Ne=="string"?Ne:Ne.name:"",Ze=typeof se=="object"?se.unit:"",Xe=Ne&&typeof Ne=="object"?Ne.unit:"",lt=Te(se.quantity,ue),Pt=Le(se.cost,ue),$t=String(ue)!=="1";return r.jsxs("tr",{className:"ingredient-row",children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ing-${xe}`}),r.jsx("label",{htmlFor:`ing-${xe}`,children:dt(Ke,tt)})]})}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:$t?"bold":"normal",color:$t?"var(--color-primary)":"inherit"},children:lt}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:dt(Ze,Xe)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Bs(se.purchaseCost)??"-"}),r.jsxs("td",{style:{textAlign:"right"},children:[Bs(Pt)??"-",$p(se)&&r.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},xe)})})]}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[me("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Math.round((xe=>xe.reduce((Ne,Ke)=>{const tt=parseFloat(Ke.cost)||0,Ze=ja(Ke),Xe=Le(tt,ue),lt=parseFloat(Xe)||0;return Ne+lt*Ze},0))(It)).toLocaleString()]})]})]})})(),r.jsx("div",{className:"screen-only no-print",children:r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[me("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Math.round((se=>se.reduce((xe,Ne)=>{const Ke=parseFloat(Ne.cost)||0,tt=ja(Ne),Ze=Le(Ke,ue),Xe=parseFloat(Ze)||0;return xe+Xe*tt},0))(It)).toLocaleString()]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]})}),r.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const se=(xe=>xe.reduce((Ne,Ke)=>{const tt=parseFloat(Ke.cost)||0,Ze=ja(Ke),Xe=parseFloat(Le(tt,ue))||0;return Ne+Xe*Ze},0))(It);return Cn(se)})()]})})]}),r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:me("instructions")}),(()=>{const ce=ee.stepGroups&&ee.stepGroups.length>0?ee.stepGroups:null,se=ce&&Se.some(xe=>!xe||typeof xe!="object"||!xe.groupId?!1:ce.some(Ne=>Ne.id===xe.groupId));return ce&&se?r.jsx("div",{className:"steps-container",children:ce.map(xe=>{const Ne=Se.filter(Ke=>(typeof Ke=="object"?Ke.groupId:null)===xe.id);return Ne.length===0?null:r.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[xe.name!==""&&xe.name!=="Steps"&&r.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:xe.name}),r.jsx("div",{className:"steps-list",children:Ne.map((Ke,tt)=>{const Ze=Se.indexOf(Ke),Xe=typeof Ke=="object"?Ke.text:Ke,lt=re.steps?.[Ze],Pt=typeof lt=="object"?lt.text:lt,$t=Ve=>Ve?Ve.replace(/<[^>]*>?/gm,""):"";return r.jsxs(mn,{className:`step-card ${T.has(Ze)?"is-completed":""}`,onClick:()=>wt(Ze),children:[r.jsx("div",{className:"step-number",children:Ze+1}),r.jsx("p",{className:"step-text",children:dt($t(Xe),$t(Pt),!0)})]},tt)})})]},xe.id)})}):r.jsx("div",{className:"steps-list",children:Se.map((xe,Ne)=>{const Ke=typeof xe=="object"?xe.text:xe,tt=re.steps?.[Ne],Ze=typeof tt=="object"?tt.text:tt;return r.jsxs(mn,{className:`step-card ${T.has(Ne)?"is-completed":""}`,onClick:()=>wt(Ne),children:[r.jsx("div",{className:"step-number",children:Ne+1}),r.jsx("p",{className:"step-text",children:dt(Ke,Ze,!0)})]},Ne)})})})()]})]})}),r.jsx(rn,{isOpen:B,onClose:()=>K(!1),title:" ",size:"large",children:r.jsxs("div",{className:"print-preview-recipe",children:[r.jsx("div",{className:"preview-header",children:r.jsx("h2",{children:ee.title})}),r.jsxs("div",{className:"preview-meta",children:[ee.course&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ee.course]}),ee.category&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ee.category]}),ee.storeName&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ee.storeName]}),ee.servings&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",ee.servings,""]})]}),ee.description&&r.jsx("div",{className:"preview-description",children:r.jsx("p",{children:ee.description})}),r.jsx("div",{className:"preview-controls",children:ee.type==="bread"?r.jsxs("div",{className:"preview-control-row",children:[r.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),r.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:J,onChange:ce=>ae(ce.target.value),placeholder:"1000"}),J&&r.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>ae(""),children:""}),te?.grandTotal?r.jsxs("span",{className:"preview-control-note",children:[": ",te.grandTotal.toLocaleString(),"g"]}):null]}):r.jsxs("div",{className:"preview-control-row",children:[r.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:me("scaleMultiplier")}),r.jsx("span",{className:"preview-control-mult",children:""}),r.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:ue,onChange:ce=>Ce(ce.target.value),placeholder:"1"}),String(ue)!=="1"&&r.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>Ce("1"),children:""})]})}),r.jsxs("div",{className:"preview-section",children:[r.jsx("h3",{children:me("ingredients")}),ee.type==="bread"?r.jsxs("div",{className:"preview-ingredients-bread",children:[r.jsxs("div",{className:"bread-group",children:[r.jsx("h4",{children:me("flourGroup")}),r.jsxs("table",{className:"preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:me("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:me("quantity")})]})}),r.jsx("tbody",{children:(Be.flours||[]).map((ce,se)=>{const xe=`flour-${se}`,Ne=te?te.getScaledQtyValue(ce.quantity):ce.quantity;return r.jsxs("tr",{className:q.has(xe)?"is-completed":"",onClick:()=>Lt(xe),role:"button",tabIndex:0,onKeyDown:Ke=>{(Ke.key==="Enter"||Ke.key===" ")&&(Ke.preventDefault(),Lt(xe))},children:[r.jsx("td",{children:ce.name}),r.jsxs("td",{style:{textAlign:"right"},children:[Ne,"g"]})]},se)})})]})]}),r.jsxs("div",{className:"bread-group",children:[r.jsx("h4",{children:me("otherIngredients")}),r.jsxs("table",{className:"preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:me("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:me("quantity")})]})}),r.jsx("tbody",{children:(Be.breadIngredients||[]).map((ce,se)=>{const xe=`bread-${se}`,Ne=te?te.getScaledQtyValue(ce.quantity):ce.quantity;return r.jsxs("tr",{className:q.has(xe)?"is-completed":"",onClick:()=>Lt(xe),role:"button",tabIndex:0,onKeyDown:Ke=>{(Ke.key==="Enter"||Ke.key===" ")&&(Ke.preventDefault(),Lt(xe))},children:[r.jsx("td",{children:ce.name}),r.jsxs("td",{style:{textAlign:"right"},children:[Ne,"g"]})]},se)})})]})]})]}):r.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const ce=ee.ingredientGroups&&ee.ingredientGroups.length>0?ee.ingredientGroups:null;return ce?ce.map(se=>{const xe=It.filter(Ne=>Ne.groupId===se.id);return xe.length===0||["","Steps","Method",""].includes(se.name)?null:r.jsxs("div",{className:"ingredient-group",children:[r.jsx("h4",{children:se.name}),r.jsxs("table",{className:"preview-table preview-table--normal",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:me("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:me("quantity")}),r.jsx("th",{children:me("unit")})]})}),r.jsx("tbody",{children:xe.map((Ne,Ke)=>{const tt=`${se.id}-${Ke}`,Ze=typeof Ne=="string"?Ne:Ne.name,Xe=typeof Ne=="object"?Te(Ne.quantity,ie):"",lt=typeof Ne=="object"?Ne.unit:"";return r.jsxs("tr",{className:q.has(tt)?"is-completed":"",onClick:()=>Lt(tt),role:"button",tabIndex:0,onKeyDown:Pt=>{(Pt.key==="Enter"||Pt.key===" ")&&(Pt.preventDefault(),Lt(tt))},children:[r.jsx("td",{children:Ze}),r.jsx("td",{style:{textAlign:"right"},children:Xe}),r.jsx("td",{children:lt})]},Ke)})})]})]},se.id)}):r.jsxs("table",{className:"preview-table preview-table--normal",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:me("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:me("quantity")}),r.jsx("th",{children:me("unit")})]})}),r.jsx("tbody",{children:It.map((se,xe)=>{const Ne=`ungrouped-${xe}`,Ke=typeof se=="string"?se:se.name,tt=typeof se=="object"?Te(se.quantity,ie):"",Ze=typeof se=="object"?se.unit:"";return r.jsxs("tr",{className:q.has(Ne)?"is-completed":"",onClick:()=>Lt(Ne),role:"button",tabIndex:0,onKeyDown:Xe=>{(Xe.key==="Enter"||Xe.key===" ")&&(Xe.preventDefault(),Lt(Ne))},children:[r.jsx("td",{children:Ke}),r.jsx("td",{style:{textAlign:"right"},children:tt}),r.jsx("td",{children:Ze})]},xe)})})]})})()})]}),Se.length>0&&r.jsxs("div",{className:"preview-section",children:[r.jsx("h3",{children:me("instructions")}),r.jsx("ol",{className:"preview-steps",children:Se.map((ce,se)=>{const xe=typeof ce=="object"?ce.text:ce;return r.jsx("li",{className:$.has(se)?"is-completed":"",onClick:()=>Un(se),role:"button",tabIndex:0,onKeyDown:Ne=>{(Ne.key==="Enter"||Ne.key===" ")&&(Ne.preventDefault(),Un(se))},children:xe},se)})})]}),r.jsxs("div",{className:"modal-actions",children:[r.jsxs(he,{variant:"primary",onClick:()=>window.print(),children:[" ",me("print")]}),r.jsx(he,{variant:"ghost",onClick:()=>K(!1),children:me("close")})]})]})})]}),r.jsx(rn,{isOpen:W,onClose:()=>oe(!1),title:" QR",size:"small",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px",padding:"20px"},children:[r.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"#666",textAlign:"center"},children:["",r.jsx("br",{}),""]}),r.jsx("div",{style:{background:"white",padding:"8px",border:"1px solid #ddd",borderRadius:"4px"},children:r.jsx(hx,{value:ee.sourceUrl||"",size:200})}),r.jsx(he,{variant:"secondary",onClick:()=>oe(!1),children:""})]})}),r.jsxs("div",{className:"print-layout",children:[r.jsx("div",{className:"recipe-detail__hero",children:ee.image?r.jsx("img",{src:ee.image,alt:ee.title,className:"recipe-detail__image"}):r.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),r.jsxs("div",{className:"recipe-detail__title-card",children:[r.jsx("h1",{children:yt(ee.title,re.title)}),Qe&&r.jsx("p",{className:"recipe-detail__desc",children:yt(Qe,re.description)})]}),r.jsxs("div",{className:"recipe-detail__meta",children:[ee.category&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:me("category")}),r.jsx("span",{className:"meta-value",children:yt(ee.category,re.category)})]}),ee.storeName&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:me("storeName")}),r.jsx("span",{className:"meta-value meta-value--store",children:yt(ee.storeName,re.storeName)})]}),ee.course&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:me("course")}),r.jsx("span",{className:"meta-value",children:yt(ee.course,re.course)})]}),ee.servings&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:me("servings")}),r.jsx("span",{className:"meta-value",children:yt(`${ee.servings}`,re.servings?`${re.servings}`:"")})]})]}),ee.sourceUrl&&r.jsxs("div",{className:"print-layout__source",children:[r.jsx("div",{className:"print-layout__source-label",children:me("sourceRecipe")}),r.jsx("div",{className:"print-layout__source-qr",children:r.jsx(hx,{value:ee.sourceUrl,size:84,style:{display:"block"}})})]}),r.jsxs("div",{className:"recipe-detail__main",children:[r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:me("ingredients")}),ee.type==="bread"&&te?r.jsxs("div",{children:[r.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:me("flourGroup")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:me("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:me("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:me("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:me("cost")})]})}),r.jsx("tbody",{children:te.flours.map((ce,se)=>{const xe=re.flours?.[se]||{},Ne=te.getScaledQtyValue(ce.quantity),Ke=J?"":xe.quantity;return r.jsxs("tr",{children:[r.jsx("td",{children:yt(ce.name,xe.name)}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:yt(Ne,Ke)}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[te.calcPercent(ce.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Bs(ce.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:ce.cost?`${te.formatCostValue(ce.cost)}`:"-"})]},`print-flour-${se}`)})})]})]}),r.jsxs("div",{className:"bread-section",children:[r.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:me("otherIngredients")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:me("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:me("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:me("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:me("cost")})]})}),r.jsx("tbody",{children:te.others.map((ce,se)=>{const xe=re.breadIngredients?.[se]||{},Ne=te.getScaledQtyValue(ce.quantity),Ke=J?"":xe.quantity;return r.jsxs("tr",{children:[r.jsx("td",{children:yt(ce.name,xe.name)}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:yt(Ne,Ke)}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[te.calcPercent(ce.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Bs(ce.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:ce.cost?`${te.formatCostValue(ce.cost)}`:"-"})]},`print-others-${se}`)})})]})]})]}):nt.map(ce=>{const se=re.ingredientGroups?.find(xe=>xe.id===ce.id)?.name||"";return r.jsxs("div",{style:{marginBottom:"1.2rem"},children:[ce.name&&r.jsx("div",{className:"print-group-heading",children:yt(ce.name,se)}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:me("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:me("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:me("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:me("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:me("cost")})]})}),r.jsx("tbody",{children:ce.items.map((xe,Ne)=>{const Ke=typeof xe=="object"?xe.quantity:"",tt=typeof xe=="object"?xe.unit:"",Ze=typeof xe=="object"?xe.purchaseCost:null,Xe=typeof xe=="object"?xe.cost:null,lt=typeof xe=="string"?xe:xe.name,Pt=typeof xe=="object"?Te(xe.quantity,ie):Ke,$t=It.indexOf(xe),Ve=re.ingredients?.[$t],ct=Ve?typeof Ve=="string"?Ve:Ve.name:"",nn=Ve&&typeof Ve=="object"?Ve.unit:"",Vn=String(ie)==="1"&&Ve&&typeof Ve=="object"?Ve.quantity:"";return r.jsxs("tr",{children:[r.jsx("td",{children:yt(lt,ct)}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:yt(Pt,Vn)}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:yt(tt,nn)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:Bs(Ze)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:Bs(Xe)??"-"})]},`print-ing-${ce.id}-${Ne}`)})})]})]},ce.id)}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[me("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Ae]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]}),r.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:me("instructions")}),Se.length>0?r.jsx("div",{className:"steps-list",children:Se.map((ce,se)=>{const xe=typeof ce=="object"?ce.text:ce,Ne=re.steps?.[se],Ke=typeof Ne=="object"?Ne?.text:Ne;return r.jsxs("div",{className:"step-card",children:[r.jsx("div",{className:"step-number",children:se+1}),r.jsx("p",{className:"step-text",children:yt(xe,Ke)})]},`print-step-${se}`)})}):r.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:me("noSteps")})]})]})]})]})},lw=n=>{if(n==null)return"";let e=String(n);return e=e.replace(/[-]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),e=e.replace(/[--]/g,s=>String.fromCharCode(s.charCodeAt(0)-65248)),e=e.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),e=e.toLowerCase(),e=e.replace(/,/g,""),e},Mt=({label:n,id:e,error:s,textarea:a,wrapperClassName:l,...c})=>{const u=a?"textarea":"input",h=c.type==="number"||c.inputMode==="decimal"||c.inputMode==="numeric",f=p=>{if(!c.onChange)return;if(!h){c.onChange(p);return}const m=p?.target?.value??"",y=lw(m);if(y===m){c.onChange(p);return}c.onChange({target:{id:p?.target?.id,name:p?.target?.name,value:y}})};return r.jsxs("div",{className:`input-group ${s?"input-group--error":""} ${l||""}`,children:[n&&r.jsx("label",{htmlFor:e,className:"input-label",children:n}),r.jsx(u,{id:e,className:`input-field ${c.className||""}`,style:c.style,...c,onChange:f}),s&&r.jsx("span",{className:"input-error",children:s})]})},Cr="app-data",Pn={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:e}=await Ee.auth.getUser();if(e)throw e;return n?.user?.id||null},_getUserScopedPath(n,e){if(!n)throw new Error("User ID is required");const s=String(e||"").replace(/^\/+/,"");return`${n}/${s}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:e,error:s}=await Ee.storage.from(Cr).list(n);if(s)return console.warn("Failed to list price files:",s.message),[];if(!e||e.length===0)return[];const a=e.filter(c=>String(c?.name||"").toLowerCase().endsWith(".csv")).map(async c=>{const u=this._getUserScopedPath(n,c.name),{data:h,error:f}=await Ee.storage.from(Cr).download(u);if(f)return console.error(`Failed to download ${c.name}:`,f),null;const p=await h.arrayBuffer();try{const m=new TextDecoder("shift-jis");return{fileName:c.name,text:m.decode(p)}}catch(m){try{const y=new TextDecoder("utf-8");return{fileName:c.name,text:y.decode(p)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",c.name,m),null}}});return(await Promise.all(a)).filter(Boolean)},async fetchPriceList(n=null){const e=n||await this._getCurrentUserId();if(!e)return new Map;const s=this._cacheByUserId.get(e);if(s)return s;try{const a=new Map,l=await this._downloadAllCsvTexts(e);if(!l||l.length===0)return new Map;for(const{text:c}of l){if(!c)continue;const u=this.parseCSV(c);for(const[h,f]of u)if(a.has(h)){const p=a.get(h);(f?.dateStr||"")>(p?.dateStr||"")&&a.set(h,f)}else a.set(h,f)}return this._cacheByUserId.set(e,a),a}catch(a){return console.error("Error in fetchPriceList:",a),new Map}},async getFileList(n=null){try{const e=n||await this._getCurrentUserId();if(!e)return[];const{data:s,error:a}=await Ee.storage.from(Cr).list(e);if(a)throw a;return s.filter(l=>String(l?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(e){return console.error("Error fetching file list:",e),[]}},async uploadPriceList(n,e=null){try{const s=e||await this._getCurrentUserId();if(!s)throw new Error("");const a=n.name;this.clearCache(s);const l=this._getUserScopedPath(s,a),{data:c,error:u}=await Ee.storage.from(Cr).upload(l,n,{upsert:!0,contentType:"text/csv"});if(u)throw u;return{success:!0,data:c}}catch(s){return console.error("Error uploading price list:",s),{success:!1,error:s}}},async deletePriceFile(n,e=null){try{const s=e||await this._getCurrentUserId();if(!s)throw new Error("");this.clearCache(s);const a=this._getUserScopedPath(s,n),{data:l,error:c}=await Ee.storage.from(Cr).remove([a]);if(c)throw c;if(!l||l.length===0)throw new Error("");return{success:!0,data:l}}catch(s){return console.error("Error deleting price file:",s),{success:!1,error:s}}},async moveAllToTrash(n){const e=await this._getCurrentUserId();if(!e)throw new Error("");const{data:s,error:a}=await Ee.storage.from(Cr).list(e);if(a)throw a;const l=(s||[]).filter(m=>String(m?.name||"").toLowerCase().endsWith(".csv")),c=l.length;let u=0;if(c===0)return{moved:0};const h=[],f=[];for(const m of l){const y=this._getUserScopedPath(e,m.name);n&&n({total:c,done:u,current:m.name});try{const{data:b,error:v}=await Ee.storage.from(Cr).download(y);if(v)throw v;const S=await b.arrayBuffer();let _="";try{_=new TextDecoder("shift-jis").decode(S)}catch{_=new TextDecoder("utf-8").decode(S)}h.push({user_id:e,file_name:m.name,csv_content:_,original_path:y})}catch(b){console.error("Failed to read file for trash:",m.name,b),f.push(m.name)}u++}if(n&&n({total:c,done:u,current:"..."}),h.length>0){const{error:m}=await Ee.from("trash_price_csvs").insert(h);if(m)throw m}n&&n({total:c,done:u,current:"Storage..."});const p=h.map(m=>m.original_path);if(p.length>0){const{error:m}=await Ee.storage.from(Cr).remove(p);if(m)throw m}return this.clearCache(e),{moved:h.length,failed:f}},async adminClearAllNonAdminCsvs(n){const e=await this._getCurrentUserId();if(!e)throw new Error("");const{data:s,error:a}=await Ee.rpc("admin_list_profiles");if(a)throw a;const l=(s||[]).filter(m=>m.role!=="admin"&&m.id!==e),c=l.length;let u=0;const h=[];for(const m of l){const y=m.id,b=m.email||m.id;n&&n({total:c,done:u,current:b});try{const{data:v,error:S}=await Ee.storage.from(Cr).list(y);if(S){console.warn(`Failed to list files for ${b}:`,S.message),h.push({userId:y,email:b,deleted:0,error:S.message}),u++;continue}const _=(v||[]).filter(N=>String(N?.name||"").toLowerCase().endsWith(".csv"));if(_.length===0){h.push({userId:y,email:b,deleted:0,error:null}),u++;continue}const w=_.map(N=>`${y}/${N.name}`),{error:j}=await Ee.storage.from(Cr).remove(w);j?h.push({userId:y,email:b,deleted:0,error:j.message}):(h.push({userId:y,email:b,deleted:_.length,error:null}),this.clearCache(y))}catch(v){h.push({userId:y,email:b,deleted:0,error:String(v?.message||v)})}u++}n&&n({total:c,done:u,current:""});const f=h.reduce((m,y)=>m+(y.deleted||0),0),p=h.filter(m=>m.error);return{results:h,totalDeleted:f,failedUsers:p}},async adminClearTargetUserCsvs(n,e){const s=await this._getCurrentUserId();if(!s)throw new Error("");if(n===s)throw new Error("");e&&e({total:1,done:0,current:"..."});const{data:a,error:l}=await Ee.storage.from(Cr).list(n);if(l)throw l;const c=(a||[]).filter(p=>String(p?.name||"").toLowerCase().endsWith(".csv"));if(c.length===0)return e&&e({total:1,done:1,current:""}),{deleted:0,error:null};const u=c.length;e&&e({total:u,done:0,current:`... (0/${u})`});const h=c.map(p=>`${n}/${p.name}`),{error:f}=await Ee.storage.from(Cr).remove(h);if(f)throw f;return e&&e({total:u,done:u,current:""}),this.clearCache(n),{deleted:u,error:null}},_splitFileName(n){const e=String(n||""),s=e.lastIndexOf(".");return s<=0?{base:e,ext:""}:{base:e.slice(0,s),ext:e.slice(s)}},_makeCopyFileName(n,e){const s=String(n||"");if(!e?.has?.(s))return s;const{base:a,ext:l}=this._splitFileName(s),c=a||s||"price";let u=1;for(;u<1e3;){const h=u===1?"_copy":`_copy${u}`,f=`${c}${h}${l}`;if(!e.has(f))return f;u++}return`${c}_copy_${Date.now()}${l}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:e=null,onProgress:s=null}={}){const a=e||await this._getCurrentUserId();if(!a)throw new Error("");const l=String(n||"").trim();if(!l)throw new Error("");if(l===a)throw new Error("");const{data:c,error:u}=await Ee.storage.from(Cr).list(a);if(u)throw u;const h=(c||[]).map(v=>v?.name).filter(Boolean).filter(v=>String(v).toLowerCase().endsWith(".csv")),{data:f,error:p}=await Ee.storage.from(Cr).list(l);let m=new Set;if(p){const v=String(p?.message||"").toLowerCase();if(v.includes("not found")||v.includes("404"))m=new Set;else throw p}else m=new Set((f||[]).map(v=>v?.name).filter(Boolean));const y={sourceUserId:a,targetUserId:l,copied:[],skipped:[],failed:[]},b=h.length;s?.({phase:"start",total:b,done:0,current:""});for(let v=0;v<h.length;v++){const S=h[v],_=this._makeCopyFileName(S,m);m.add(_);const w=this._getUserScopedPath(a,S),j=this._getUserScopedPath(l,_);s?.({phase:"progress",total:b,done:v,current:`${S}  ${_}`,fromFile:S,toFile:_});try{const{data:N,error:T}=await Ee.storage.from(Cr).download(w);if(T)throw T;if(!N)throw new Error("");const{error:R}=await Ee.storage.from(Cr).upload(j,N,{upsert:!1,contentType:"text/csv"});if(R){const $=String(R?.message||"").toLowerCase();if($.includes("already exists")||$.includes("exists")||$.includes("409")){let F=0,q=R;for(;F<5;){F++;const I=this._makeCopyFileName(S,m);m.add(I);const U=this._getUserScopedPath(l,I),{error:P}=await Ee.storage.from(Cr).upload(U,N,{upsert:!1,contentType:"text/csv"});if(!P){y.copied.push({fromFile:S,toFile:I}),q=null;break}q=P}if(q)throw q;continue}throw R}y.copied.push({fromFile:S,toFile:_})}catch(N){console.error("copyPriceFilesToUser failed:",N),y.failed.push({file:S,errorMessage:String(N?.message||N)})}s?.({phase:"progress",total:b,done:v+1,current:`${S}  ${_}`,fromFile:S,toFile:_})}return s?.({phase:"done",total:b,done:b,current:"",result:y}),this.clearCache(l),y},async adminCopyCsvsToAllUsers(n){const e=await this._getCurrentUserId();if(!e)throw new Error("");n?.({phase:"start",message:"..."});const{data:s,error:a}=await Ee.rpc("admin_list_profiles");if(a)throw a;const l=(s||[]).filter(f=>f.role!=="admin"&&f.id!==e),c=l.length;if(c===0)return n?.({phase:"done",message:""}),{success:!0,totalTargetUsers:0,results:[]};const u=[];let h=0;for(const f of l){const p=f.id,m=f.email||p;n?.({phase:"progress_user",totalUser:c,doneUser:h,currentUser:m,message:`${m} ...`});const y=b=>{b.phase==="progress"&&n?.({phase:"progress_file",totalUser:c,doneUser:h,currentUser:m,totalFile:b.total,doneFile:b.done,currentFile:b.current,message:`${m} (${b.done}/${b.total})`})};try{const b=await this.copyPriceFilesToUser({targetUserId:p,sourceUserId:e,onProgress:y});u.push({userId:p,result:b,error:null})}catch(b){u.push({userId:p,result:null,error:String(b?.message||b)})}h++}return n?.({phase:"done",message:""}),{success:!0,totalTargetUsers:c,results:u}},parseCSV(n){const e=new Map,s=n.split(/\r?\n/).filter(l=>l.trim());if(s.length===0)return e;if(s.some(l=>l.startsWith("D,")||l.startsWith('"D",')))for(let l of s){const c=[];let u="",h=!1;for(let w=0;w<l.length;w++){const j=l[w];j==='"'?h=!h:j===","&&!h?(c.push(u),u=""):u+=j}c.push(u);const f=c.map(w=>(w=w.trim(),w.startsWith('"')&&w.endsWith('"')?w.slice(1,-1):w));if(f[0]!=="D")continue;const p=f[1],m=f[8],y=f[14],b=f[18],v=f[20],S=String(y??"").trim(),_=Jt(S);if(_&&b){const w=parseFloat(b);if(!isNaN(w)){const j={price:w,vendor:m,unit:v,dateStr:p,displayName:S};if(e.has(_)){const N=e.get(_);(p||"")>=(N?.dateStr||"")&&e.set(_,j)}else e.set(_,j)}}}else{let l={name:-1,price:-1,unit:-1,vendor:-1},c=0;if(s[0].split(",").map(f=>f.trim().replace(/^"|"$/g,"")).forEach((f,p)=>{["","","","","name","item"].some(m=>f.includes(m))&&(l.name=p),["","","","","price","cost"].some(m=>f.includes(m))&&(l.price=p),["","unit"].some(m=>f.includes(m))&&(l.unit=p),["","","","vendor","supplier"].some(m=>f.includes(m))&&(l.vendor=p)}),l.name===-1&&l.price===-1){l={name:0,price:1,unit:2,vendor:3};const f=s[0].split(",");isNaN(parseFloat(f[1]))&&(c=1)}else c=1;const h=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let f=c;f<s.length;f++){const p=s[f],m=[];let y="",b=!1;for(let R=0;R<p.length;R++){const $=p[R];$==='"'?b=!b:$===","&&!b?(m.push(y),y=""):y+=$}m.push(y);const v=m.map(R=>(R=R.trim(),R.startsWith('"')&&R.endsWith('"')?R.slice(1,-1):R)),S=l.name>-1?v[l.name]:null,_=l.price>-1?v[l.price]:null,w=l.unit>-1?v[l.unit]:"",j=l.vendor>-1?v[l.vendor]:"",N=String(S??"").trim(),T=Jt(N);if(T&&_){const R=parseFloat(_.replace(/[^0-9.]/g,""));isNaN(R)||e.set(T,{price:R,vendor:j,unit:w,dateStr:h,displayName:N})}}}return e},parseCSVEntries(n,e=""){const s=[],a=n.split(/\r?\n/).filter(b=>b.trim());if(a.length===0)return s;const l=b=>{const v=String(b??"").trim();if(!v)return null;const S=parseFloat(v.replace(/[^0-9.]/g,""));return Number.isFinite(S)?S:null},c=b=>{const v=[];let S="",_=!1;for(let w=0;w<b.length;w++){const j=b[w];j==='"'?_=!_:j===","&&!_?(v.push(S),S=""):S+=j}return v.push(S),v.map(w=>(w=w.trim(),w.startsWith('"')&&w.endsWith('"')?w.slice(1,-1):w))},u=b=>{const v=String(b??"").trim();if(!v)return"";const S=v.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(S)return`${S[1]}/${String(S[2]).padStart(2,"0")}/${String(S[3]).padStart(2,"0")}`;const _=v.match(/^(\d{4})(\d{2})(\d{2})$/);return _?`${_[1]}/${_[2]}/${_[3]}`:v};if(a.some(b=>b.startsWith("D,")||b.startsWith('"D",'))){for(let b of a){const v=c(b);if(v[0]!=="D")continue;const S=u(v[1]),_=v[8],w=v[14],j=v[18],N=l(v[19]),T=v[20],R=String(w??"").trim(),$=Jt(R);if(!$||!j)continue;const F=l(j);Number.isFinite(F)&&s.push({key:$,displayName:R,price:F,vendor:_,unit:T,dateStr:S,incomingQty:N,sourceFile:e})}return s}let f={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},p=0;if(a[0].split(",").map(b=>b.trim().replace(/^"|"$/g,"")).forEach((b,v)=>{const S=String(b||"").toLowerCase();["","","","","name","item"].some(_=>S.includes(_))&&(f.name=v),["","","","","price","cost"].some(_=>S.includes(_))&&(f.price=v),["","unit"].some(_=>S.includes(_))&&(f.unit=v),["","","","vendor","supplier"].some(_=>S.includes(_))&&(f.vendor=v),["","","","date"].some(_=>S.includes(_))&&(f.date=v),["","","","","","qty","quantity"].some(_=>S.includes(_))&&(f.quantity=v)}),f.name===-1&&f.price===-1){f={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const b=a[0].split(",");isNaN(parseFloat(b[1]))&&(p=1)}else p=1;const y=u(new Date().toISOString().slice(0,10));for(let b=p;b<a.length;b++){const v=c(a[b]),S=f.name>-1?v[f.name]:null,_=f.price>-1?v[f.price]:null,w=f.unit>-1?v[f.unit]:"",j=f.vendor>-1?v[f.vendor]:"",N=f.date>-1?v[f.date]:"",T=f.quantity>-1?l(v[f.quantity]):null,R=String(S??"").trim(),$=Jt(R);if(!$||!_)continue;const F=l(_);Number.isFinite(F)&&s.push({key:$,displayName:R,price:F,vendor:j,unit:w,dateStr:u(N)||y,incomingQty:T,sourceFile:e})}return s},async fetchPriceHistory(n=null){const e=n||await this._getCurrentUserId();if(!e)return new Map;const s=this._historyCacheByUserId.get(e);if(s)return s;try{const a=await this._downloadAllCsvTexts(e);if(!a||a.length===0)return new Map;const l=new Map;for(const{fileName:c,text:u}of a){if(!u)continue;this.parseCSVEntries(u,c).forEach(f=>{const p=f?.key;p&&(l.has(p)||l.set(p,[]),l.get(p).push(f))})}for(const c of l.values())c.sort((u,h)=>{const f=String(u?.dateStr||""),p=String(h?.dateStr||"");if(f!==p)return f.localeCompare(p);const m=Number(u?.price),y=Number(h?.price);return Number.isFinite(m)&&Number.isFinite(y)&&m!==y?m-y:String(u?.sourceFile||"").localeCompare(String(h?.sourceFile||""))});return this._historyCacheByUserId.set(e,l),l}catch(a){return console.error("Error in fetchPriceHistory:",a),new Map}},async getPriceListArray(n=null){const e=await this.fetchPriceList(n),s=[];for(const[a,l]of e.entries())if(l&&typeof l=="object"){const{displayName:c,...u}=l;s.push({name:c||a,...u})}else s.push({name:a,price:l});return s.sort((a,l)=>a.dateStr&&l.dateStr?l.dateStr.localeCompare(a.dateStr):a.name.localeCompare(l.name))},async getPrice(n,e=null){return n&&(await this.fetchPriceList(e)).get(Jt(n))||null}},Bo={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:e,error:s}=await Ee.rpc("search_ingredients",{search_query:n,max_results:15});return s?(console.warn(" Database search failed:",s),console.warn("Error message:",s.message),console.warn("Error code:",s.code),null):(console.log(" DB search result:",e),e||[])}catch(e){return console.warn(" Database search exception:",e),null}},async search(n){const e=String(n||"").trim();if(!e)return this._lastDbResults=null,this._lastDbQuery=null,[];const s=e.toLowerCase(),a=Jt(e);try{const l=await this._searchFromDatabase(s);if(l&&Array.isArray(l)){this._lastDbResults=l,this._lastDbQuery=s;const u=l.map(w=>({name:w.ingredient_name,price:w.last_price,size:w.packet_size,unit:w.packet_unit,itemCategory:w.item_category||null,source:"manual",displaySource:" "}));if(u.length===0)return await this._fallbackSearch(s);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[w,j]=await Promise.all([Pn.getPriceListArray(),On.getAllConversions()]),N=Array.from(j.values()).map(F=>({name:F.ingredientName,price:F.lastPrice,size:F.packetSize,unit:F.packetUnit,itemCategory:F.itemCategory||null,source:"manual",displaySource:" "})),T=w.map(F=>({name:F.name,price:F.price,size:null,unit:F.unit,source:"csv",displaySource:" CSV"})),R=new Set(N.map(F=>F.name)),$=T.filter(F=>!R.has(F.name));this._csvCache=[...N,...$]}const h=w=>{if(!a)return null;const j=String(w||"").indexOf(a);return j<0?null:{tier:w===a?0:j===0?1:2,idx:j,len:String(w||"").length}},f=(w,j)=>w.score.tier!==j.score.tier?w.score.tier-j.score.tier:w.score.idx!==j.score.idx?w.score.idx-j.score.idx:w.score.len!==j.score.len?w.score.len-j.score.len:w.name.localeCompare(j.name,"ja"),p=(w,j,N)=>{let T=0;for(;T<w.length&&f(w[T],j)<=0;)T++;w.splice(T,0,j),w.length>N&&w.pop()},y=Math.max(0,15-u.length),b=new Set(u.map(w=>Jt(w.name))),v=[],S=new Set;if(y>0)for(const w of this._csvCache){const j=Jt(w?.name);if(!j||b.has(j)||S.has(j))continue;const N=h(j);N&&(S.add(j),p(v,{...w,nameKey:j,score:N},y))}const _=v.map(w=>({name:w.name,price:w.price,size:w.size,unit:w.unit,source:w.source,displaySource:w.displaySource}));return[...u,..._]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",l);const c=await this._fallbackSearch(s);return console.log(" Fallback search returned:",c.length,"results"),c}catch(l){return console.error("Error searching ingredients:",l),[]}},async _fallbackSearch(n){try{const e=Jt(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[f,p]=await Promise.all([Pn.getPriceListArray(),On.getAllConversions()]);console.log(" CSV Data rows:",f.length),console.log(" Manual Data items:",p.size);const m=Array.from(p.values()).map(S=>({name:S.ingredientName,price:S.lastPrice,size:S.packetSize,unit:S.packetUnit,itemCategory:S.itemCategory||null,source:"manual",displaySource:" "})),y=f.map(S=>({name:S.name,price:S.price,size:null,unit:S.unit,source:"csv",displaySource:" CSV"})),b=new Set(m.map(S=>S.name)),v=y.filter(S=>!b.has(S.name));this._csvCache=[...m,...v],console.log(" Cache built. Total items:",this._csvCache.length)}const s=f=>{if(!e)return null;const p=String(f||"").indexOf(e);return p<0?null:{tier:f===e?0:p===0?1:2,idx:p,len:String(f||"").length}},a=(f,p)=>f.score.tier!==p.score.tier?f.score.tier-p.score.tier:f.score.idx!==p.score.idx?f.score.idx-p.score.idx:f.score.len!==p.score.len?f.score.len-p.score.len:f.name.localeCompare(p.name,"ja"),l=(f,p,m)=>{let y=0;for(;y<f.length&&a(f[y],p)<=0;)y++;f.splice(y,0,p),f.length>m&&f.pop()},c=15,u=[],h=new Set;for(const f of this._csvCache){const p=Jt(f?.name);if(!p||h.has(p))continue;const m=s(p);m&&(h.add(p),l(u,{...f,nameKey:p,score:m},c))}return u.map(f=>({name:f.name,price:f.price,size:f.size,unit:f.unit,itemCategory:f.itemCategory||null,source:f.source,displaySource:f.displaySource}))}catch(e){return console.error("Error in fallback search:",e),[]}}},Ld=({value:n,onChange:e,placeholder:s,disabled:a,onSelect:l,name:c,required:u=!1,triggerSearchKey:h})=>{const[f,p]=k.useState([]),[m,y]=k.useState(!1),[b,v]=k.useState(-1),S=k.useRef(null),_=k.useRef(null),[w,j]=k.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),N=k.useCallback(()=>{if(S.current){const I=S.current.getBoundingClientRect(),U=8,P=4,V=I.top-U,D=window.innerHeight-I.bottom-U,C=(V>=180||V>=D)&&V>=110,M=Math.max(110,Math.min(280,C?V-P:D-P)),z=I.left,B=Math.max(220,window.innerWidth-U*2),K=Math.min(Math.max(I.width,220),B),Q=Math.min(Math.max(U,z),window.innerWidth-U-K);j({top:C?I.top-P:I.bottom+P,left:Q,width:K,maxHeight:M,placeAbove:C})}},[]);k.useEffect(()=>{const I=V=>{S.current&&!S.current.contains(V.target)&&_.current&&!_.current.contains(V.target)&&y(!1)},U=V=>{_.current&&_.current.contains(V.target)||y(!1)},P=()=>{m&&N()};return document.addEventListener("mousedown",I),window.addEventListener("scroll",U,{capture:!0}),window.addEventListener("resize",P),()=>{document.removeEventListener("mousedown",I),window.removeEventListener("scroll",U,{capture:!0}),window.removeEventListener("resize",P)}},[m,N]),k.useEffect(()=>{m&&N()},[m,f,N]),k.useEffect(()=>{if(h!=null&&String(n||"").trim().length>0){const I=String(n).trim();let U=!1;return(async()=>{const V=++T.current,D=await Bo.search(I);!U&&V===T.current&&(p(D),y(D.length>0),v(-1),N())})(),()=>{U=!0}}},[h]);const T=k.useRef(0),R=k.useRef(null),$=async I=>{const U=I.target.value;if(e(I),R.current&&clearTimeout(R.current),U.length===0){y(!1);return}R.current=setTimeout(async()=>{if(U.length>0){const P=++T.current;console.log(" AutocompleteInput: Fetching suggestions for:",U);const V=await Bo.search(U);console.log(" AutocompleteInput: Got",V.length,"suggestions"),P===T.current&&(p(V),y(V.length>0),v(-1))}},150)},F=I=>{const U={target:{value:I.name}};e(U),y(!1),l&&l(I)},q=I=>{m&&(I.key==="ArrowDown"?(I.preventDefault(),v(U=>U<f.length-1?U+1:U)):I.key==="ArrowUp"?(I.preventDefault(),v(U=>U>0?U-1:-1)):I.key==="Enter"?b>=0&&(I.preventDefault(),F(f[b])):I.key==="Escape"&&y(!1))};return r.jsxs("div",{className:"autocomplete-wrapper",ref:S,children:[r.jsx("input",{type:"text",className:"input-field autocomplete-input",name:c,value:n,onChange:$,onKeyDown:q,onFocus:async()=>{if(n&&n.length>0){N();const I=await Bo.search(n);p(I),y(I.length>0)}else N()},placeholder:s,disabled:a,required:u}),m&&Da.createPortal(r.jsx("ul",{className:"suggestions-list",ref:_,style:{position:"fixed",top:`${w.top}px`,left:`${w.left}px`,width:`${w.width}px`,maxHeight:`${w.maxHeight}px`,transform:w.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:f.map((I,U)=>r.jsxs("li",{className:`suggestion-item ${U===b?"selected":""}`,onClick:()=>F(I),onMouseEnter:()=>v(U),children:[r.jsxs("div",{className:"suggestion-main",children:[r.jsx("span",{className:"suggestion-name",children:I.name}),I?.source&&I.source!=="manual"&&r.jsx("span",{className:"suggestion-source",children:I.displaySource})]}),r.jsxs("div",{className:"suggestion-details",children:[I.price&&`${Number(I.price).toLocaleString()}`,I.size&&` / ${I.size}${I.unit}`,!I.size&&I.unit&&` / ${I.unit}`]})]},`${I.source}-${U}`))}),document.body)]})},ME=n=>new Promise((e,s)=>{const a=new FileReader;a.onerror=()=>s(new Error("")),a.onload=()=>{const l=String(a.result||""),c=l.includes(",")?l.split(",")[1]:l;e(c)},a.readAsDataURL(n)}),LE={async transcribe(n,{mimeType:e,fileName:s,language:a="ja",promptContext:l}={}){if(!(n instanceof Blob))throw new Error("");const c=await ME(n);if(!c)throw new Error("");const u={audioBase64:c,mimeType:e||n.type||"audio/webm",fileName:s||"voice-input.webm",language:a,promptContext:l||null},h=25e3,f=Ee.functions.invoke("transcribe",{body:u}),p=new Promise((b,v)=>{setTimeout(()=>v(new Error("")),h)}),{data:m,error:y}=await Promise.race([f,p]);if(y)throw new Error(y.message||"");if(m?.success!==!0)throw new Error(m?.error||"");return String(m?.text||"").trim()}},UE=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"],IE=()=>{if(typeof MediaRecorder>"u")return"";for(const n of UE)if(MediaRecorder.isTypeSupported(n))return n;return""},BE=()=>typeof window>"u"?!1:!!(navigator?.mediaDevices?.getUserMedia&&typeof window.MediaRecorder<"u"),$E=n=>{let e=String(n||"").trim();return e=e.replace(/[]+$/u,""),e.trim()},PE=(n,e)=>{const s=String(n||"").trim(),a=$E(e);return a?s?/[.!?]$/.test(s)?`${s}
${a}`:`${s}
${a}`:a:s},na=({onTranscript:n,getCurrentValue:e,disabled:s=!1,size:a="sm",className:l="",label:c="",language:u="ja",promptContext:h})=>{const f=Ps(),[p,m]=k.useState(!1),[y,b]=k.useState(!1),v=k.useRef(null),S=k.useRef(null),_=k.useRef([]),w=k.useRef(!0),j=k.useRef(!1),N=()=>{const U=S.current;U&&U.getTracks().forEach(P=>P.stop()),S.current=null},T=()=>{v.current=null,_.current=[]},R=()=>{console.warn("[VoiceInputButton] Forcing reset. Mounted:",w.current);try{N(),T()}catch(U){console.error("[VoiceInputButton] cleanup failed:",U)}finally{m(!1),b(!1)}},$=async()=>{if(!p&&!y)return;const U=v.current;if(!U){p&&R();return}try{U.state!=="inactive"?(U.stop(),m(!1),b(!0)):R()}catch(P){console.error("[VoiceInputButton] failed to stop recorder:",P),f.error(""),R()}},F=async()=>{if(!(s||p||y)){if(!BE()){f.error("");return}try{j.current=!1;const U=await navigator.mediaDevices.getUserMedia({audio:!0});S.current=U;const P=IE(),V=P?new MediaRecorder(U,{mimeType:P}):new MediaRecorder(U);_.current=[],V.ondataavailable=D=>{D?.data?.size>0&&_.current.push(D.data)},V.onerror=D=>{console.error("[VoiceInputButton] MediaRecorder error:",D?.error||D),N(),T(),m(!1),b(!1),f.error("")},V.onstop=async()=>{if(j.current){N(),T(),w.current&&(m(!1),b(!1));return}w.current&&(m(!1),b(!0));try{const D=V.mimeType||P||"audio/webm",H=new Blob(_.current,{type:D});if(H.size===0)throw new Error("");const C=await LE.transcribe(H,{mimeType:D,fileName:`voice-input.${D.includes("mp4")?"m4a":"webm"}`,language:u,promptContext:h||void 0});if(!C){f.warning("");return}const M=typeof e=="function"?e():"",z=PE(M,C);n?.(z,C),f.success("")}catch(D){console.error("[VoiceInputButton] transcription failed:",D),f.error(D?.message||"")}finally{try{N()}catch{}try{T()}catch{}m(!1),b(!1)}},v.current=V,V.start(),m(!0)}catch(U){if(console.error("[VoiceInputButton] failed to start recording:",U),U?.name==="NotAllowedError"||U?.name==="SecurityError"){f.error(""),R();return}f.error(""),R()}}};k.useEffect(()=>()=>{w.current=!1,j.current=!0;try{v.current&&v.current.state!=="inactive"&&v.current.stop()}catch{}N(),T()},[]);const q=()=>{if(!s){if(y){R();return}if(p){$();return}F()}},I=y?"...":p?"":c;return r.jsxs(he,{type:"button",variant:"secondary",size:a,onClick:q,disabled:s,className:["voice-input-btn",p?"is-recording":"",l].filter(Boolean).join(" "),title:p?"":y?"":"",children:[p?"":y?"":""," ",I]})},cw=({isOpen:n,onClose:e,onApply:s,ingredientName:a,currentCost:l,currentQuantity:c,unit:u="g",initialPurchaseCost:h,initialContentAmount:f})=>{const[p,m]=k.useState(""),[y,b]=k.useState(""),[v,S]=k.useState(u),[_,w]=k.useState(""),[j,N]=k.useState(!1),[T,R]=k.useState(!1),$=k.useCallback(async()=>{if(R(!0),w(""),h&&f){m(h),b(f);const D=await On.getConversion(a);if(D)S(D.packetUnit||u),w(D.vendor||"");else{S(u);try{const H=await Pn.getPrice(a);w(H?.vendor||"")}catch{}}}else{const D=await On.getConversion(a);if(D)b(D.packetSize),S(D.packetUnit||u),D.lastPrice&&m(D.lastPrice),w(D.vendor||"");else try{const H=await Pn.getPrice(a);if(H)if(m(l||H.price),w(H.vendor||""),H.unit){const C=H.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if(C){let M=C[1]?parseFloat(C[1]):1,z=C[2]?C[2].trim().toLowerCase():"";z==="kg"?(M*=1e3,z="g"):z==="l"?(M*=1e3,z="ml"):z==="cl"?(M*=10,z="ml"):z==="pk"||z==="pack"?z="":z==="bag"?z="":(z==="pc"||z==="pcs")&&(z=""),b(M),S(z||u)}else b(1),S(H.unit)}else b(""),S(u);else b(""),m(l||""),S(u),w("")}catch(H){console.warn("Failed to load master price:",H),b(""),m(l||""),S(u),w("")}}R(!1)},[a,h,f,u,l]);k.useEffect(()=>{if(!n||!a)return;const D=setTimeout(()=>{$()},0);return()=>clearTimeout(D)},[n,a,$]);const F=()=>{const D=parseFloat(p),H=parseFloat(y);return!D||!H?0:["g","ml","cc"].includes(v)?D/H*1e3:v==="cl"?D/H*100:(["kg","l"].includes(v),D/H)},q=async()=>{const D=F();if(j&&y)try{await On.saveConversion(a,y,v,p,null,_)}catch(H){console.error("Failed to save default conversion:",H)}s(D,v,p,y,_),e()};if(!n)return null;const I=F(),U=String(u||"").trim().toLowerCase(),P=c?U==="cl"||U===""?I*(c*10/1e3):["g","ml","cc"].includes(U)?I*(c/1e3):I*c:0,V=r.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:e,children:r.jsx("div",{className:"unit-conversion-modal__card",onClick:D=>D.stopPropagation(),children:r.jsxs("div",{className:"unit-conversion-modal__body",children:[r.jsx("h3",{className:"unit-conversion-modal__title",children:""}),r.jsxs("div",{className:"unit-conversion-modal__field",children:[r.jsx("span",{className:"unit-conversion-modal__label",children:""}),r.jsx("div",{className:"unit-conversion-modal__value",children:a||"()"})]}),r.jsxs("div",{className:"unit-conversion-modal__inputs",children:[r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),r.jsx("input",{type:"number",value:p,onChange:D=>m(D.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:""}),r.jsxs("div",{className:"unit-conversion-modal__row",children:[r.jsx("input",{type:"number",value:y,onChange:D=>b(D.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),r.jsxs("select",{value:v,onChange:D=>S(D.target.value),className:"unit-conversion-modal__select",children:[r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:"p"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),!["g","ml","","","","","","cc","cl"].includes(v)&&r.jsx("option",{value:v,children:v})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:""}),r.jsx("input",{type:"text",value:_,onChange:D=>w(D.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),r.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:T?r.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[r.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),r.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(I).toLocaleString()]})]}),c&&r.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[r.jsxs("span",{children:[" (",c,u,"):"]}),r.jsxs("span",{children:["",Math.round(P).toLocaleString()]})]})]})}),r.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[r.jsx("input",{type:"checkbox",id:"saveDefault",checked:j,onChange:D=>N(D.target.checked)}),r.jsxs("span",{children:["(",y,v,")"]})]}),r.jsxs("div",{className:"unit-conversion-modal__actions",children:[r.jsx(he,{type:"button",variant:"secondary",onClick:e,disabled:T,children:""}),r.jsx(he,{type:"button",variant:"primary",onClick:q,disabled:!p||!y||T,children:""})]})]})})});return Da.createPortal(V,document.body)},gd=["","g","kg","ml","cc","cl","L","","","","","PC","","","","","","","","",""],qE=new Set(["food","alcohol","soft_drink","supplies"]),FE=new Set(["alcohol","supplies"]),uw={food:"",alcohol:"",soft_drink:"",supplies:""},Xi=n=>{const e=String(n||"").trim().toLowerCase();return e?e==="food_alcohol"?"food":qE.has(e)?e:"":""},Ud=n=>FE.has(n),gp=(n,e)=>{const s=Xi(e);return s?{...n,itemCategory:s,isAlcohol:Ud(s)}:{...n,itemCategory:null}},dr=n=>{const e=parseFloat(n);return Number.isFinite(e)?e:NaN},HE=n=>{const e=String(n||"").trim().replace(/[]+$/u,""),s=e.match(/(\d+(?:\.\d+)?)/);if(s)return s[1];const a=[["","19"],["","18"],["","17"],["","16"],["","15"],["","14"],["","13"],["","12"],["","11"],["","90"],["","80"],["","70"],["","60"],["","50"],["","40"],["","30"],["","20"],["","10"],["","9"],["","8"],["","7"],["","6"],["","5"],["","4"],["","3"],["","2"],["","1"],["","0"],["","0"]],l=e.replace(/\s+/g,"");for(const[c,u]of a)if(l===c||l.startsWith(c))return u;return e},Pp=n=>{const e=dr(n);return!Number.isFinite(e)||e<=0||e>100?100:e},Ca=(n,e)=>{const s=e?.yieldPercent??e?.yield_percent??n?.yieldPercent??n?.yield_percent;return Pp(s)/100},VE=(n,e,s)=>{const a=dr(n),l=dr(e);if(!Number.isFinite(a)||!Number.isFinite(l)||l<=0)return NaN;const c=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(c)?a/l*1e3:["kg","","l",""].includes(c)?a/l:["cl",""].includes(c)?a/l*100:a/l},yx=(n,e,s,a=!1,l=1)=>{const c=dr(n),u=dr(e);if(!Number.isFinite(c)||!Number.isFinite(u))return NaN;const h=Number.isFinite(l)&&l>0?l:1;if(a)return c/1e3*u/h;const f=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(f)||!f?c/1e3*u/h:["cl",""].includes(f)?c*10/1e3*u/h:c*u/h},GE=(n,e)=>{const s=dr(n?.purchaseCost),a=dr(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(e)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-e)>.01):!1},vx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),cs=(n,e)=>{if(!n||n.size===0||!e)return null;const s=n.get(e);if(s)return s;const a=vx(e);if(!a)return null;for(const[l,c]of n.entries())if(vx(l)===a)return c;return null},WE=({formData:n,setFormData:e})=>{const s=Ps(),[a,l]=k.useState(new Map),[c,u]=k.useState({isOpen:!1,type:null,index:null}),[h,f]=k.useState({key:0,type:null,index:null}),[p,m]=k.useState(new Map);k.useEffect(()=>{(async()=>{const[V,D]=await Promise.all([Pn.fetchPriceList(),On.getAllConversions()]);l(V),m(D)})()},[]);const b=(P=>P.reduce((V,D)=>V+(parseFloat(D.quantity)||0),0))(n.flours||[]),v=P=>!b||b===0?0:((parseFloat(P)||0)/b*100).toFixed(1);k.useEffect(()=>{if(p.size===0)return;const P=(H=[])=>{let C=!1;return{adjusted:H.map(z=>{if(!z||typeof z!="object")return z;const B=cs(p,z.name);let K=z;const Q=Xi(z.itemCategory??z.item_category??B?.itemCategory);if(Q){const ae=Ud(Q);(Xi(z.itemCategory??z.item_category)!==Q||!!z.isAlcohol!==ae)&&(K={...K,itemCategory:Q,isAlcohol:ae})}const Z=Ca(z,B),A=yx(z.quantity,K.purchaseCost,z.unit,!0,Z),L=Number.isFinite(A)?Math.round(A*100)/100:NaN,J=dr(K.cost);if(Number.isFinite(L)&&(!Number.isFinite(J)||Math.abs(J-L)>.01)&&(K={...K,cost:L}),B&&B.packetSize){const ue=[B.lastPrice,z.purchaseCostRef,z.purchase_cost,z.purchaseCost].find(fe=>Number.isFinite(dr(fe))),Ce=VE(ue,B.packetSize,B.packetUnit);if(Number.isFinite(Ce)&&GE(z,Ce)){const fe=Ca(z,B),ne=Math.round(Ce*100)/100,be=yx(z.quantity,ne,z.unit,!0,fe),le=Number.isFinite(be)?Math.round(be*100)/100:K.cost,ie=dr(K.purchaseCost),Te=dr(K.cost),Le=!Number.isFinite(ie)||Math.abs(ie-ne)>.01,E=Number.isFinite(dr(le))&&(!Number.isFinite(Te)||Math.abs(Te-le)>.01);(Le||E)&&(K={...K,purchaseCost:ne,cost:le})}}return K!==z&&(C=!0),K}),changed:C}},V=P(n.flours||[]),D=P(n.breadIngredients||[]);!V.changed&&!D.changed||e(H=>({...H,flours:V.adjusted,breadIngredients:D.adjusted}))},[p,n.breadIngredients,n.flours,e]);const S=(P,V,D)=>{const H=[...n.flours||[]];if(H[P]={...H[P],[V]:D},V==="name"){const C=a.get(Jt(D));if(C){const M=typeof C=="object"?C.price:C,z=typeof C=="object"?C.vendor:null,B=typeof C=="object"?C.unit:null;H[P].purchaseCostRef=M,H[P].vendorRef=z;const K=cs(p,D);if(K&&K.packetSize){let Z=0;const A=K.lastPrice!==null&&K.lastPrice!==void 0&&K.lastPrice!==""?K.lastPrice:M,L=(K.packetUnit||"").trim().toLowerCase();["g",""].includes(L)?Z=A/K.packetSize*1e3:["kg",""].includes(L)?Z=A/K.packetSize:["ml","","cc",""].includes(L)?Z=A/K.packetSize*1e3:["l",""].includes(L)?Z=A/K.packetSize:["cl",""].includes(L)?Z=A/K.packetSize*100:Z=A/K.packetSize,H[P].purchaseCost=Math.round(Z*100)/100,H[P].unit="g"}else H[P].purchaseCost||(H[P].purchaseCost=M,!H[P].unit&&B&&(H[P].unit=B));const Q=Xi(K?.itemCategory);Q?H[P]=gp(H[P],Q):H[P].itemCategory=null}else H[P].purchaseCostRef=null,H[P].vendorRef=null,H[P].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(V)||V==="name"){const C=H[P],M=parseFloat(C.quantity),z=parseFloat(C.purchaseCost);if(!isNaN(M)&&!isNaN(z)){let B=0;const K=(C.unit||"").trim().toLowerCase();K==="g"||K===""||K==="ml"||K===""||K==="cc"||K===""||!K?B=M/1e3*z:K==="cl"||K===""?B=M*10/1e3*z:B=M*z;const Q=cs(p,C.name),Z=Ca(C,Q),A=Number.isFinite(Z)&&Z>0?Z:1,L=Math.round(B/A*100)/100;L!==C.cost&&(H[P].cost=L)}}e(C=>({...C,flours:H}))},_=(P,V,D)=>{const H=[...n.breadIngredients||[]];if(H[P]={...H[P],[V]:D},V==="name"){const C=a.get(Jt(D));if(C){const M=typeof C=="object"?C.price:C,z=typeof C=="object"?C.vendor:null,B=typeof C=="object"?C.unit:null;H[P].purchaseCostRef=M,H[P].vendorRef=z;const K=cs(p,D);if(K&&K.packetSize){let Z=0;const A=K.lastPrice!==null&&K.lastPrice!==void 0&&K.lastPrice!==""?K.lastPrice:M,L=(K.packetUnit||"").trim().toLowerCase();["g",""].includes(L)?(Z=A/K.packetSize*1e3,H[P].unit="g"):["kg",""].includes(L)?(Z=A/K.packetSize,H[P].unit="g"):["ml","","cc",""].includes(L)?(Z=A/K.packetSize*1e3,H[P].unit="ml"):["l",""].includes(L)?(Z=A/K.packetSize,H[P].unit="ml"):(Z=A/K.packetSize,H[P].unit=K.packetUnit),H[P].purchaseCost=Math.round(Z*100)/100}else H[P].purchaseCost||(H[P].purchaseCost=M,!H[P].unit&&B&&(H[P].unit=B));const Q=Xi(K?.itemCategory);Q?H[P]=gp(H[P],Q):H[P].itemCategory=null}else H[P].purchaseCostRef=null,H[P].vendorRef=null,H[P].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(V)||V==="name"){const C=H[P],M=parseFloat(C.quantity),z=parseFloat(C.purchaseCost);if(!isNaN(M)&&!isNaN(z)){let B=0;const K=C.unit?C.unit.trim().toLowerCase():"g";K==="g"||K===""||K==="ml"||K===""||K==="cc"||K===""?B=M/1e3*z:B=M*z;const Q=cs(p,C.name),Z=Ca(C,Q),A=Number.isFinite(Z)&&Z>0?Z:1,L=Math.round(B/A*100)/100;L!==C.cost&&(H[P].cost=L)}}e(C=>({...C,breadIngredients:H}))},w=(P,V,D)=>{const H=HE(D),C=dr(H);if(!Number.isFinite(C)||C<0){s.warning("1015");return}P(V,"quantity",String(H))},j=()=>{e(P=>({...P,flours:[...P.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},N=()=>{e(P=>({...P,breadIngredients:[...P.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},T=P=>{e(V=>({...V,flours:V.flours.filter((D,H)=>H!==P)}))},R=P=>{e(V=>({...V,breadIngredients:V.breadIngredients.filter((D,H)=>H!==P)}))},$=Ia(Ar(Qo,{activationConstraint:{distance:10}}),Ar(Jo,{activationConstraint:{delay:250,tolerance:5}}),Ar(Yo,{coordinateGetter:Rd})),F=P=>{const{active:V,over:D}=P;V.id!==D.id&&e(H=>{const M=H.flours.some(K=>K.id===V.id)?"flours":"breadIngredients",z=H[M].findIndex(K=>K.id===V.id),B=H[M].findIndex(K=>K.id===D.id);return z!==-1&&B!==-1?{...H,[M]:ra(H[M],z,B)}:H})};k.useEffect(()=>{if(!n.flours)e(P=>({...P,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const P=n.flours.map(V=>V.id?V:{...V,id:crypto.randomUUID()});JSON.stringify(P)!==JSON.stringify(n.flours)&&e(V=>({...V,flours:P}))}if(!n.breadIngredients)e(P=>({...P,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const P=n.breadIngredients.map(V=>V.id?V:{...V,id:crypto.randomUUID()});JSON.stringify(P)!==JSON.stringify(n.breadIngredients)&&e(V=>({...V,breadIngredients:P}))}},[]);const q=(P,V,D,H)=>{const{type:C,index:M}=c;e(z=>{if(C==="flour"){const B=[...z.flours],K={...B[M],purchaseCost:P,unit:V,purchase_cost:D,content_amount:H},Q=parseFloat(K.quantity),Z=parseFloat(P);if(!isNaN(Q)&&!isNaN(Z)){let A=0;V==="g"||V===""?A=Q/1e3*Z:A=Q*Z;const L=cs(p,K.name),J=Ca(K,L),ae=Number.isFinite(J)&&J>0?J:1;K.cost=Math.round(A/ae*100)/100}return B[M]=K,On.getAllConversions().then(A=>m(A)),Bo.invalidateCache(),{...z,flours:B}}else if(C==="ingredient"){const B=[...z.breadIngredients],K={...B[M],purchaseCost:P,unit:V,purchase_cost:D,content_amount:H},Q=parseFloat(K.quantity),Z=parseFloat(P);if(!isNaN(Q)&&!isNaN(Z)){let A=0;V==="g"||V===""?A=Q/1e3*Z:A=Q*Z;const L=cs(p,K.name),J=Ca(K,L),ae=Number.isFinite(J)&&J>0?J:1;K.cost=Math.round(A/ae*100)/100}return B[M]=K,On.getAllConversions().then(A=>m(A)),Bo.invalidateCache(),{...z,breadIngredients:B}}return z})},I=(P,V,D)=>{D&&e(H=>{const C=P==="flour"?"flours":"breadIngredients",M=[...H[C]||[]],z={...M[V]};if(z.name=D.name,z.itemCategory=null,D.price!==void 0&&D.price!==null&&D.price!==""){z.purchaseCostRef=D.price,z.vendorRef=D.source==="csv"?"CSV":"Master";let Z=D.price,A=D.unit;if(D.source==="manual")if(D.size&&D.size>0){const L=(D.unit||"").trim().toLowerCase();["g",""].includes(L)?(Z=D.price/D.size*1e3,A="g"):["kg",""].includes(L)?(Z=D.price/D.size,A="g"):["ml","","cc",""].includes(L)?(Z=D.price/D.size*1e3,A="ml"):["l",""].includes(L)?(Z=D.price/D.size,A="ml"):["cl",""].includes(L)?(Z=D.price/D.size*100,A="ml"):(Z=D.price/D.size,A=D.unit)}else Z=D.price,A=D.unit;else{const L=cs(p,D.name);if(L&&L.packetSize){const J=L.lastPrice!==null&&L.lastPrice!==void 0&&L.lastPrice!==""?L.lastPrice:D.price,ae=(L.packetUnit||"").trim().toLowerCase();["g",""].includes(ae)?(Z=J/L.packetSize*1e3,A="g"):["kg",""].includes(ae)?(Z=J/L.packetSize,A="g"):["ml","","cc",""].includes(ae)?(Z=J/L.packetSize*1e3,A="ml"):["l",""].includes(ae)?(Z=J/L.packetSize,A="ml"):["cl",""].includes(ae)?(Z=J/L.packetSize*100,A="ml"):(Z=J/L.packetSize,A=L.packetUnit)}else Z=D.price,A=D.unit}z.purchaseCost=Math.round(Z*100)/100,P==="flour"?z.unit="g":A&&(z.unit=A)}const B=Xi(D.itemCategory??D.item_category??cs(p,D.name)?.itemCategory);if(B){const Z=gp(z,B);Object.assign(z,Z)}const K=parseFloat(z.quantity),Q=parseFloat(z.purchaseCost);if(!isNaN(K)&&!isNaN(Q)){const Z=cs(p,z.name),A=Ca(z,Z),L=Number.isFinite(A)&&A>0?A:1,J=(z.unit||"").trim().toLowerCase();let ae=0;J==="g"||J===""||J==="ml"||J===""||J==="cc"||J===""?ae=K/1e3*Q:J==="cl"||J===""?ae=K*10/1e3*Q:ae=K*Q,z.cost=Math.round(ae/L*100)/100}return M[V]=z,{...H,[C]:M}})},U=c.isOpen&&c.index!==null?c.type==="flour"?n.flours[c.index]:n.breadIngredients[c.index]:null;return r.jsxs("div",{className:"bread-form",children:[r.jsxs(mn,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[r.jsxs("div",{className:"bread-header",children:[r.jsxs("h3",{children:[" (Total: ",b,"g)"]}),r.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),r.jsxs("div",{className:"recipe-scroll-wrapper",children:[r.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[r.jsx("span",{})," ",r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{className:"text-center",children:"%"}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsx("div",{className:"bread-grid-body",children:r.jsx(ea,{sensors:$,collisionDetection:cd,onDragEnd:F,id:"flours-dnd",children:r.jsx(Ua,{items:n.flours||[],strategy:qo,children:(n.flours||[]).map((P,V)=>{const D=cs(p,P?.name),H=Pp(D?.yieldPercent??D?.yield_percent??P?.yieldPercent??P?.yield_percent);return r.jsx(KE,{id:P.id,index:V,item:P,yieldPercentApplied:H,onChange:S,onRemove:T,onSelect:I,calculatePercentage:v,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:V}),onQuantityVoiceTranscript:(C,M)=>w(S,C,M),onNameVoiceComplete:(C,M)=>f(z=>({key:z.key+1,type:C,index:M})),voiceSearchTrigger:h},P.id)})})})})]}),r.jsx(he,{type:"button",variant:"secondary",size:"sm",onClick:j,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),r.jsxs(mn,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[r.jsxs("div",{className:"bread-header",children:[r.jsx("h3",{children:""}),r.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),r.jsxs("div",{className:"recipe-scroll-wrapper",children:[r.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[r.jsx("span",{})," ",r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{className:"text-center",children:"%"}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsx("div",{className:"bread-grid-body",children:r.jsx(ea,{sensors:$,collisionDetection:cd,onDragEnd:F,id:"breadIngredients-dnd",children:r.jsx(Ua,{items:n.breadIngredients||[],strategy:qo,children:(n.breadIngredients||[]).map((P,V)=>{const D=cs(p,P?.name),H=Pp(D?.yieldPercent??D?.yield_percent??P?.yieldPercent??P?.yield_percent);return r.jsx(YE,{id:P.id,index:V,item:P,yieldPercentApplied:H,onChange:_,onRemove:R,onSelect:I,calculatePercentage:v,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:V}),onQuantityVoiceTranscript:(C,M)=>w(_,C,M),onNameVoiceComplete:(C,M)=>f(z=>({key:z.key+1,type:C,index:M})),voiceSearchTrigger:h},P.id)})})})})]}),r.jsx(he,{type:"button",variant:"secondary",size:"sm",onClick:N,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),r.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:r.jsx(he,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),r.jsx(cw,{isOpen:c.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:q,ingredientName:U?.name||"",currentCost:U?.purchaseCost,currentQuantity:U?.quantity,unit:U?.unit||"g",initialPurchaseCost:U?.purchase_cost,initialContentAmount:U?.content_amount})]})},KE=({id:n,index:e,item:s,yieldPercentApplied:a,onChange:l,onRemove:c,onSelect:u,calculatePercentage:h,floursLength:f,onOpenConversion:p,onQuantityVoiceTranscript:m,onNameVoiceComplete:y,voiceSearchTrigger:b})=>{const v=Xi(s.itemCategory??s.item_category),S=!!v,_=uw[v]||"",w=S?`${_}${Ud(v)?"10%":"8%"}`:"",{attributes:j,listeners:N,setNodeRef:T,transform:R,transition:$,isDragging:F}=Ba({id:n}),q={transform:Br.Transform.toString(R),transition:$,opacity:F?.5:1,position:"relative",zIndex:F?999:"auto"};return r.jsxs("div",{ref:T,style:q,className:"form-ingredient-row--bread",children:[r.jsx("div",{...j,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Ld,{value:s.name,onChange:I=>l(e,"name",I.target.value),onSelect:I=>u("flour",e,I),placeholder:": ",triggerSearchKey:b?.type==="flour"&&b?.index===e?b.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(na,{size:"xs",label:"",getCurrentValue:()=>s.name,onTranscript:I=>{l(e,"name",I),y&&y("flour",e)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Mt,{type:"number",step:"any",value:s.quantity,onChange:I=>l(e,"quantity",I.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin",style:{width:"100%",minWidth:0}}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(na,{size:"xs",label:"",getCurrentValue:()=>s.quantity,onTranscript:(I,U)=>m&&m(e,U),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:s.unit??"",onChange:I=>l(e,"unit",I.target.value),className:"input-field",style:{width:"100%",textAlign:"center",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),gd.filter(I=>I).map(I=>r.jsx("option",{value:I,children:I},I)),s.unit&&!gd.includes(s.unit)&&r.jsx("option",{value:s.unit,children:s.unit})]})}),r.jsxs("div",{className:"bread-percent",children:[h(s.quantity),"%"]}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[r.jsx(Mt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:I=>l(e,"purchaseCost",I.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",onClick:p,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),r.jsxs("div",{className:"ingredient-cost",children:[r.jsx(Mt,{type:"number",step:"any",value:s.cost||"",onChange:I=>l(e,"cost",I.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(dr(a))&&dr(a)<99.999&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const I=dr(a),U=Math.round(I*10)/10;return`${Number.isInteger(U)?Math.round(U):U}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:I=>l(e,"isAlcohol",I.target.checked),disabled:S,style:{cursor:S?"not-allowed":"pointer"},title:S?`${w}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:f>1&&r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>c(e),children:""})})]})},YE=({id:n,index:e,item:s,yieldPercentApplied:a,onChange:l,onRemove:c,onSelect:u,calculatePercentage:h,onOpenConversion:f,onQuantityVoiceTranscript:p,onNameVoiceComplete:m,voiceSearchTrigger:y})=>{const b=Xi(s.itemCategory??s.item_category),v=!!b,S=uw[b]||"",_=v?`${S}${Ud(b)?"10%":"8%"}`:"",{attributes:w,listeners:j,setNodeRef:N,transform:T,transition:R,isDragging:$}=Ba({id:n}),F={transform:Br.Transform.toString(T),transition:R,opacity:$?.5:1,position:"relative",zIndex:$?999:"auto"};return r.jsxs("div",{ref:N,style:F,className:"form-ingredient-row--bread",children:[r.jsx("div",{...w,...j,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Ld,{value:s.name,onChange:q=>l(e,"name",q.target.value),onSelect:q=>u("ingredient",e,q),placeholder:": ",triggerSearchKey:y?.type==="ingredient"&&y?.index===e?y.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(na,{size:"xs",label:"",getCurrentValue:()=>s.name,onTranscript:q=>{l(e,"name",q),m&&m("ingredient",e)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Mt,{type:"number",step:"any",value:s.quantity,onChange:q=>l(e,"quantity",q.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin",style:{width:"100%",minWidth:0}}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(na,{size:"xs",label:"",getCurrentValue:()=>s.quantity,onTranscript:(q,I)=>p&&p(e,I),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:s.unit??"",onChange:q=>l(e,"unit",q.target.value),className:"input-field",style:{width:"100%",textAlign:"center",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),gd.filter(q=>q).map(q=>r.jsx("option",{value:q,children:q},q)),s.unit&&!gd.includes(s.unit)&&r.jsx("option",{value:s.unit,children:s.unit})]})}),r.jsxs("div",{className:"bread-percent",children:[h(s.quantity),"%"]}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[r.jsx(Mt,{type:"number",step:"any",value:s.purchaseCost||"",onChange:q=>l(e,"purchaseCost",q.target.value),placeholder:s.purchaseCostRef?`Ref: ${s.purchaseCostRef}`:"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:s.purchaseCostRef?`: ${s.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",s.purchaseCostRef," ",s.vendorRef&&`(${s.vendorRef})`]})]}),r.jsxs("div",{className:"ingredient-cost",children:[r.jsx(Mt,{type:"number",step:"any",value:s.cost||"",onChange:q=>l(e,"cost",q.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(dr(a))&&dr(a)<99.999&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const q=dr(a),I=Math.round(q*10)/10;return`${Number.isInteger(I)?Math.round(I):I}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:s.isAlcohol||!1,onChange:q=>l(e,"isAlcohol",q.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${_}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>c(e),children:""})})]})},xx=["","g","kg","ml","cc","cl","L","","","","","PC","","","","","","","","",""],QE=new Set(["food","alcohol","soft_drink","supplies"]),JE=new Set(["alcohol","supplies"]),XE={food:"",alcohol:"",soft_drink:"",supplies:""},Mo=n=>{const e=String(n||"").trim().toLowerCase();return e?e==="food_alcohol"?"food":QE.has(e)?e:"":""},yd=n=>JE.has(n),bx=(n,e)=>{const s=Mo(e);return s?{...n,itemCategory:s,isAlcohol:yd(s)}:{...n,itemCategory:null}},wx=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),ai=(n,e)=>{if(!n||n.size===0||!e)return null;const s=n.get(e);if(s)return s;const a=wx(e);if(!a)return null;for(const[l,c]of n.entries())if(wx(l)===a)return c;return null},Nr=n=>{const e=parseFloat(n);return Number.isFinite(e)?e:NaN},ZE=n=>{const e=String(n||"").trim().replace(/[]+$/u,""),s=e.match(/(\d+(?:\.\d+)?)/);if(s)return s[1];const a=[["","19"],["","18"],["","17"],["","16"],["","15"],["","14"],["","13"],["","12"],["","11"],["","90"],["","80"],["","70"],["","60"],["","50"],["","40"],["","30"],["","20"],["","10"],["","9"],["","8"],["","7"],["","6"],["","5"],["","4"],["","3"],["","2"],["","1"],["","0"],["","0"]],l=e.replace(/\s+/g,"");for(const[c,u]of a)if(l===c||l.startsWith(c))return u;return e},dw=n=>{const e=Nr(n);return!Number.isFinite(e)||e<=0||e>100?100:e},jo=(n,e)=>{const s=e?.yieldPercent??e?.yield_percent??n?.yieldPercent??n?.yield_percent;return dw(s)/100},e2=(n,e,s)=>{const a=Nr(n),l=Nr(e);if(!Number.isFinite(a)||!Number.isFinite(l)||l<=0)return NaN;const c=String(s||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(c)?a/l*1e3:["kg","","l",""].includes(c)?a/l:["cl",""].includes(c)?a/l*100:a/l},yp=(n,e,s,a=1)=>{const l=Nr(n),c=Nr(e);if(!Number.isFinite(l)||!Number.isFinite(c))return NaN;const u=String(s||"").trim().toLowerCase();let h=0;["g","","ml","","cc",""].includes(u)?h=l/1e3*c:["cl",""].includes(u)?h=l*10/1e3*c:h=l*c;const f=Number.isFinite(a)&&a>0?a:1;return h/f},t2=(n,e)=>{const s=Nr(n?.purchaseCost),a=Nr(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(e)?!!(!Number.isFinite(s)||Number.isFinite(a)&&Math.abs(s-a)<1e-4&&Math.abs(s-e)>.01):!1},n2=Ie.memo(({id:n,index:e,item:s,groupId:a,yieldPercentApplied:l,onChange:c,onRemove:u,handleSuggestionSelect:h,onOpenConversion:f,onQuantityVoiceTranscript:p,onNameVoiceComplete:m,voiceSearchTrigger:y})=>{const b=Mo(s.itemCategory??s.item_category),v=!!b,S=XE[b]||"",_=v?`${S}${yd(b)?"10%":"8%"}`:"",w=v?yd(b):!!s.isAlcohol,{attributes:j,listeners:N,setNodeRef:T,transform:R,transition:$,isDragging:F}=Ba({id:n,data:{groupId:a,index:e}}),q={transform:Br.Translate.toString(R),transition:$,opacity:F?.3:1,position:"relative",zIndex:F?999:"auto"};return r.jsxs("div",{ref:T,style:q,className:"form-ingredient-row",children:[r.jsx("div",{...j,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Ld,{value:s.name,onChange:I=>c(a,e,"name",I.target.value),onSelect:I=>h(a,e,I),placeholder:"",triggerSearchKey:y?.groupId===a&&y?.index===e?y.key:void 0}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(na,{size:"xs",label:"",getCurrentValue:()=>s.name,onTranscript:I=>{c(a,e,"name",I),m&&m(a,e)},promptContext:"ingredient",className:"ingredient-voice-btn"})})]}),r.jsxs("div",{className:"ingredient-qty",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(Mt,{value:s.quantity,onChange:I=>c(a,e,"quantity",I.target.value),placeholder:"0",style:{width:"100%",minWidth:0},wrapperClassName:"input-group--no-margin"}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(na,{size:"xs",label:"",getCurrentValue:()=>s.quantity,onTranscript:(I,U)=>p(a,e,U),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-unit",children:r.jsxs("select",{value:s.unit??"",onChange:I=>c(a,e,"unit",I.target.value),className:"input-field",style:{width:"100%",padding:"0.4rem 0.5rem",borderRadius:"4px",border:"1px solid #ccc"},title:"",children:[r.jsx("option",{value:"",children:""}),xx.filter(I=>I).map(I=>r.jsx("option",{value:I,children:I},I)),s.unit&&!xx.includes(s.unit)&&r.jsx("option",{value:s.unit,children:s.unit})]})}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[r.jsx(Mt,{type:"number",value:s.purchaseCost,onChange:I=>c(a,e,"purchaseCost",I.target.value),step:"0.01",placeholder:s.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:s.purchaseCostRef&&!s.purchaseCost?"orange":"",paddingRight:"20px"},title:s.purchaseCostRef?`: ${s.purchaseCostRef}${s.vendorRef?` (${s.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:f,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),s.purchaseCostRef&&r.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",s.purchaseCostRef]})]}),r.jsxs("div",{className:"ingredient-cost","data-label":"",children:[r.jsx(Mt,{type:"number",step:"0.01",value:s.cost,onChange:I=>c(a,e,"cost",I.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(Nr(l))&&Nr(l)<99.999&&r.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const I=Nr(l),U=Math.round(I*10)/10;return`${Number.isInteger(U)?Math.round(U):U}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:w,onChange:I=>c(a,e,"isAlcohol",I.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${_}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(a,e),children:""})})]})},(n,e)=>(a=>a&&a.groupId===e.groupId&&a.index===e.index)(e.voiceSearchTrigger)&&n.voiceSearchTrigger?.key!==e.voiceSearchTrigger?.key?!1:n.id===e.id&&n.index===e.index&&n.groupId===e.groupId&&n.yieldPercentApplied===e.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(e.item)),r2=({section:n,sections:e,onSectionChange:s,onRemoveSection:a,children:l})=>{const{setNodeRef:c}=Cc({id:n.id});return r.jsxs(mn,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[r.jsx(Mt,{value:n.name,onChange:u=>s(n.id,u.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),r.jsx("div",{style:{display:"flex",gap:"8px"},children:e.length>1&&r.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),r.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[r.jsx("span",{}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsxs("div",{ref:c,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[l,n.items.length===0&&r.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},s2=({formData:n,setFormData:e,priceList:s})=>{const a=Ps(),[l,c]=k.useState(new Map);k.useEffect(()=>{On.getAllConversions().then(I=>c(I))},[]);const[u,h]=k.useState({isOpen:!1,groupId:null,index:null}),[f,p]=k.useState({key:0,groupId:null,index:null});k.useEffect(()=>{if(!n.ingredientSections){const I=n.ingredientGroups||[{id:"default",name:""}],U=n.ingredients||[],P=I.map(H=>({id:H.id,name:H.name,items:U.filter(C=>H.id==="default"&&!C.groupId?!0:C.groupId===H.id)})),V=new Set(P.flatMap(H=>H.items.map(C=>C.id))),D=U.filter(H=>!V.has(H.id));D.length>0&&(P.length>0?P[0].items.push(...D):P.push({id:"default",name:"",items:D})),P.length===0&&P.push({id:crypto.randomUUID(),name:"",items:[]}),e(H=>({...H,ingredientSections:P}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,e]);const m=n.ingredientSections||[];k.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||l.size===0)return;let I=!1;const U=n.ingredientSections.map(P=>{const V=P.items.map(D=>{if(!D||typeof D!="object")return D;const H=ai(l,D.name);let C=D;const M=Mo(D.itemCategory??D.item_category??H?.itemCategory);if(M){const B=yd(M);(Mo(D.itemCategory??D.item_category)!==M||!!D.isAlcohol!==B)&&(C={...C,itemCategory:M,isAlcohol:B})}if(H&&H.packetSize){const K=[H.lastPrice,D.purchaseCostRef,D.purchase_cost,D.purchaseCost].find(Z=>Number.isFinite(Nr(Z))),Q=e2(K,H.packetSize,H.packetUnit);if(Number.isFinite(Q)&&t2(D,Q)){const Z=jo(D,H),A=Math.round(Q*100)/100,L=yp(D.quantity,A,D.unit,Z),J=Number.isFinite(L)?Math.round(L*100)/100:C.cost,ae=Nr(C.purchaseCost),ue=Nr(C.cost),Ce=!Number.isFinite(ae)||Math.abs(ae-A)>.01,fe=Number.isFinite(Nr(J))&&(!Number.isFinite(ue)||Math.abs(ue-J)>.01);(Ce||fe)&&(C={...C,purchaseCost:A,cost:J})}}const z=jo(D,H);if(Number.isFinite(z)&&z>0&&Math.abs(z-1)>1e-4){const B=yp(D.quantity,C.purchaseCost,D.unit,z),K=yp(D.quantity,C.purchaseCost,D.unit,1),Q=Nr(C.cost);if(Number.isFinite(B)&&(!Number.isFinite(Q)||Number.isFinite(K)&&Math.abs(Q-K)<=.01)){const A=Math.round(B*100)/100,L=Nr(C.cost);(!Number.isFinite(L)||Math.abs(L-A)>.01)&&(C={...C,cost:A})}}return C!==D&&(I=!0),C});return V!==P.items?{...P,items:V}:P});I&&e(P=>({...P,ingredientSections:U}))},[l,n.ingredientSections,e]);const y=Ia(Ar(Qo,{activationConstraint:{distance:10}}),Ar(Jo,{activationConstraint:{delay:250,tolerance:5}}),Ar(Yo,{coordinateGetter:Rd})),b=({active:I,over:U})=>{if(!U)return;const P=I.id,V=U.id,D=m.find(C=>C.items.some(M=>M.id===P)),H=m.find(C=>C.items.some(M=>M.id===V))||m.find(C=>C.id===V);!D||!H||D===H||e(C=>{const M=D.items,z=H.items,B=M.findIndex(Z=>Z.id===P),K=z.findIndex(Z=>Z.id===V);let Q;if(V===H.id)Q=z.length+1;else{const A=U&&I.rect.current.translated&&I.rect.current.translated.top>U.rect.top+U.rect.height?1:0;Q=K>=0?K+A:z.length+1}return{...C,ingredientSections:C.ingredientSections.map(Z=>Z.id===D.id?{...Z,items:M.filter(A=>A.id!==P)}:Z.id===H.id?{...Z,items:[...z.slice(0,Q),M[B],...z.slice(Q,z.length)]}:Z)}})},v=({active:I,over:U})=>{if(!U)return;const P=I.id,V=U.id,D=m.find(C=>C.items.some(M=>M.id===P)),H=m.find(C=>C.items.some(M=>M.id===V))||m.find(C=>C.id===V);if(D&&H&&D===H){const C=D.items.findIndex(z=>z.id===P),M=H.items.findIndex(z=>z.id===V);C!==M&&e(z=>({...z,ingredientSections:z.ingredientSections.map(B=>B.id===D.id?{...B,items:ra(B.items,C,M)}:B)}))}},S=(I,U,P,V)=>{const{groupId:D,index:H}=u;D!==null&&H!==null&&e(C=>{const M=C.ingredientSections.map(z=>{if(z.id!==D)return z;const B=[...z.items],K={...B[H],purchaseCost:I,unit:U,purchase_cost:P,content_amount:V},Q=parseFloat(K.quantity),Z=parseFloat(I);if(!isNaN(Q)&&!isNaN(Z)){const A=ai(l,K.name),L=jo(K,A),J=U?U.trim().toLowerCase():"";let ae=0;J==="g"||J===""||J==="ml"||J===""||J==="cc"||J===""?ae=Q/1e3*Z:J==="cl"||J===""?ae=Q*10/1e3*Z:ae=Q*Z;const ue=Number.isFinite(L)&&L>0?L:1;K.cost=Math.round(ae/ue*100)/100}return B[H]=K,{...z,items:B}});return On.getAllConversions().then(z=>c(z)),Bo.invalidateCache(),{...C,ingredientSections:M}})},_=u.isOpen&&u.groupId!==null&&u.index!==null?m.find(I=>I.id===u.groupId)?.items[u.index]:null,w=Ie.useCallback((I,U,P,V)=>{e(D=>{const H=D.ingredientSections.map(C=>{if(C.id!==I)return C;const M=[...C.items],z={...M[U],[P]:V};if(M[U]=z,["quantity","purchaseCost","unit","name","isAlcohol"].includes(P)){const B=parseFloat(z.quantity),K=parseFloat(z.purchaseCost),Q=ai(l,z.name),Z=jo(z,Q),A=Number.isFinite(Z)&&Z>0?Z:1;if(!isNaN(B)&&!isNaN(K)){let L=0;const J=z.unit?z.unit.trim().toLowerCase():"";J==="g"||J===""||J==="ml"||J===""||J==="cc"||J===""?L=B/1e3*K:J==="cl"||J===""?L=B*10/1e3*K:L=B*K;const ae=Math.round(L/A*100)/100;ae!==z.cost&&(z.cost=ae,M[U]=z)}}if(P==="name"){const B=s.get(Jt(V)),K=ai(l,V),Q=Mo(K?.itemCategory);if(Q){const Z=bx(z,Q);Object.assign(z,Z)}else B||(z.itemCategory=null);if(B){const Z=typeof B=="object"?B.price:B,A=typeof B=="object"?B.vendor:null,L=typeof B=="object"?B.unit:null,J=typeof B=="object"?B.size:null;if(z.purchaseCostRef=Z,z.vendorRef=A,K&&K.packetSize){const Ce=K.lastPrice!==null&&K.lastPrice!==void 0&&K.lastPrice!==""?K.lastPrice:Z;let fe=0;const ne=(K.packetUnit||"").trim().toLowerCase();["g",""].includes(ne)?(fe=Ce/K.packetSize*1e3,z.unit="g"):["kg",""].includes(ne)?(fe=Ce/K.packetSize,z.unit="g"):["ml","","cc",""].includes(ne)?(fe=Ce/K.packetSize*1e3,z.unit="ml"):["l",""].includes(ne)?(fe=Ce/K.packetSize,z.unit="ml"):["cl",""].includes(ne)?(fe=Ce/K.packetSize*100,z.unit="ml"):(fe=Ce/K.packetSize,z.unit=K.packetUnit),z.purchaseCost=Math.round(fe*100)/100}else{let Ce=Z,fe=L;J&&J>1&&(["g",""].includes((L||"").toLowerCase())?(Ce=Z/J*1e3,fe="g"):["ml","","cc",""].includes((L||"").toLowerCase())?(Ce=Z/J*1e3,fe="ml"):["cl",""].includes((L||"").toLowerCase())?(Ce=Z/J*100,fe="ml"):["kg",""].includes(L?L.toLowerCase():"")?(Ce=Z/J,fe="g"):["l",""].includes(L?L.toLowerCase():"")?(Ce=Z/J,fe="ml"):Ce=Z/J),z.purchaseCost||(z.purchaseCost=Math.round(Ce*100)/100),!z.unit&&fe&&(z.unit=fe)}const ae=parseFloat(z.quantity),ue=parseFloat(z.purchaseCost);if(!isNaN(ae)&&!isNaN(ue)){const Ce=ai(l,z.name),fe=jo(z,Ce),ne=Number.isFinite(fe)&&fe>0?fe:1,be=z.unit?z.unit.trim().toLowerCase():"";let le=0;be==="g"||be===""||be==="ml"||be===""||be==="cc"||be===""?le=ae/1e3*ue:be==="cl"||be===""?le=ae*10/1e3*ue:le=ae*ue,z.cost=Math.round(le/ne*100)/100}}else z.purchaseCostRef=null,z.vendorRef=null;M[U]=z}return{...C,items:M}});return{...D,ingredientSections:H}})},[l,s,e]),j=Ie.useCallback((I,U,P)=>{const V=ZE(P),D=Nr(V);if(!Number.isFinite(D)||D<0){a.warning("1015");return}w(I,U,"quantity",String(V))},[a,w]),N=Ie.useCallback((I,U,P)=>{e(V=>{const D=V.ingredientSections.map(H=>{if(H.id!==I)return H;const C=[...H.items],M={...C[U]};if(M.name=P.name,M.itemCategory=null,P.price)if(M.purchaseCostRef=P.price,M.vendorRef=P.source==="csv"?"CSV":"Master",P.source==="manual")if(P.size&&P.size>0){const Q=(P.unit||"").trim().toLowerCase();if(["g",""].includes(Q)){const Z=P.price/P.size*1e3;M.purchaseCost=Math.round(Z*100)/100,M.unit="g"}else if(["kg",""].includes(Q)){const Z=P.price/P.size;M.purchaseCost=Math.round(Z*100)/100,M.unit="g"}else if(["ml","","cc",""].includes(Q)){const Z=P.price/P.size*1e3;M.purchaseCost=Math.round(Z*100)/100,M.unit="ml"}else if(["l",""].includes(Q)){const Z=P.price/P.size;M.purchaseCost=Math.round(Z*100)/100,M.unit="ml"}else if(["cl",""].includes(Q)){const Z=P.price/P.size*100;M.purchaseCost=Math.round(Z*100)/100,M.unit="ml"}else{const Z=P.price/P.size;M.purchaseCost=Math.round(Z*100)/100,M.unit=P.unit}}else M.purchaseCost=P.price,M.unit=P.unit;else{const Q=ai(l,P.name);if(Q&&Q.packetSize){const Z=Q.lastPrice!==null&&Q.lastPrice!==void 0&&Q.lastPrice!==""?Q.lastPrice:P.price;let A=0;const L=(Q.packetUnit||"").trim().toLowerCase();["g",""].includes(L)?(A=Z/Q.packetSize*1e3,M.unit="g"):["kg",""].includes(L)?(A=Z/Q.packetSize,M.unit="g"):["ml","","cc",""].includes(L)?(A=Z/Q.packetSize*1e3,M.unit="ml"):["l",""].includes(L)?(A=Z/Q.packetSize,M.unit="ml"):["cl",""].includes(L)?(A=Z/Q.packetSize*100,M.unit="ml"):(A=Z/Q.packetSize,M.unit=Q.packetUnit),M.purchaseCost=Math.round(A*100)/100}else M.purchaseCost=P.price,M.unit=P.unit}const z=Mo(P.itemCategory??P.item_category??ai(l,P.name)?.itemCategory);if(z){const Q=bx(M,z);Object.assign(M,Q)}const B=parseFloat(M.quantity),K=parseFloat(M.purchaseCost);if(!isNaN(B)&&!isNaN(K)){const Q=ai(l,M.name),Z=jo(M,Q),A=Number.isFinite(Z)&&Z>0?Z:1,L=M.unit?M.unit.trim().toLowerCase():"";let J=0;L==="g"||L===""||L==="ml"||L===""||L==="cc"||L===""?J=B/1e3*K:L==="cl"||L===""?J=B*10/1e3*K:J=B*K,M.cost=Math.round(J/A*100)/100}return C[U]=M,{...H,items:C}});return{...V,ingredientSections:D}})},[l,e]),T=Ie.useCallback((I,U)=>{e(P=>({...P,ingredientSections:P.ingredientSections.map(V=>V.id===I?{...V,items:V.items.filter((D,H)=>H!==U)}:V)}))},[e]),R=I=>{const U={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};e(P=>({...P,ingredientSections:P.ingredientSections.map(V=>V.id===I?{...V,items:[...V.items,U]}:V)}))},$=()=>{e(I=>({...I,ingredientSections:[...I.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},F=I=>{e(U=>({...U,ingredientSections:U.ingredientSections.filter(P=>P.id!==I)}))},q=(I,U)=>{e(P=>({...P,ingredientSections:P.ingredientSections.map(V=>V.id===I?{...V,name:U}:V)}))};return r.jsxs(ea,{sensors:y,collisionDetection:db,onDragOver:b,onDragEnd:v,children:[r.jsxs("div",{className:"recipe-form-ingredients",children:[m.map(I=>r.jsx(Ua,{id:I.id,items:I.items.map(U=>U.id),strategy:qo,children:r.jsxs(r2,{section:I,sections:m,onSectionChange:q,onRemoveSection:F,children:[I.items.map((U,P)=>(()=>{const V=ai(l,U?.name),D=dw(V?.yieldPercent??V?.yield_percent??U?.yieldPercent??U?.yield_percent);return r.jsx(n2,{id:U.id,index:P,item:U,groupId:I.id,yieldPercentApplied:D,onChange:w,onRemove:T,handleSuggestionSelect:N,onOpenConversion:()=>h({isOpen:!0,groupId:I.id,index:P}),onQuantityVoiceTranscript:j,onNameVoiceComplete:(H,C)=>p(M=>({key:M.key+1,groupId:H,index:C})),voiceSearchTrigger:f},U.id)})()),r.jsx(he,{type:"button",variant:"ghost",onClick:()=>R(I.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},I.id)),r.jsx(he,{type:"button",variant:"secondary",onClick:$,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),r.jsx(cm,{dropAnimation:{sideEffects:lm({styles:{active:{opacity:"0.5"}}})},children:null}),r.jsx(cw,{isOpen:u.isOpen,onClose:()=>h({isOpen:!1,groupId:null,index:null}),onApply:S,ingredientName:_?.name||"",currentCost:_?.purchaseCost,currentQuantity:_?.quantity,unit:_?.unit||"g",initialPurchaseCost:_?.purchase_cost,initialContentAmount:_?.content_amount})]})},i2=({id:n,index:e,item:s,groupId:a,voiceInputEnabled:l,onChange:c,onRemove:u,onVoiceAppend:h})=>{const{attributes:f,listeners:p,setNodeRef:m,transform:y,transition:b,isDragging:v}=Ba({id:n,data:{groupId:a,index:e}}),S={transform:Br.Translate.toString(y),transition:b,opacity:v?.3:1,position:"relative",zIndex:v?999:"auto"};return r.jsxs("div",{ref:m,style:{...S,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[r.jsx("div",{...f,...p,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),r.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:e+1}),r.jsxs("div",{style:{flex:1},children:[r.jsx(Mt,{textarea:!0,value:s.text,onChange:_=>c(a,e,_.target.value),placeholder:` ${e+1}...`,style:{minHeight:"60px",width:"100%"}}),l&&r.jsx("div",{className:"step-row__voice-action",children:r.jsx(na,{label:"",getCurrentValue:()=>s.text,onTranscript:_=>h(a,e,_)})})]}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(a,e),title:"",children:""})})]})},a2=({section:n,sections:e,onSectionChange:s,onRemoveSection:a,children:l})=>{const{setNodeRef:c}=Cc({id:n.id});return r.jsxs(mn,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[r.jsx(Mt,{value:n.name,onChange:u=>s(n.id,u.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),r.jsx("div",{style:{display:"flex",gap:"8px"},children:e.length>1&&r.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),r.jsxs("div",{ref:c,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[l,n.items.length===0&&r.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},o2=({formData:n,setFormData:e,voiceInputEnabled:s=!1})=>{k.useEffect(()=>{if(!n.stepSections){const S=n.stepGroups||[{id:"default",name:""}],w=(n.steps||[]||[]).map(R=>typeof R=="string"?{id:crypto.randomUUID(),text:R}:R),j=S.map(R=>({id:R.id,name:R.name,items:w.filter($=>R.id==="default"&&!$.groupId?!0:$.groupId===R.id)})),N=new Set(j.flatMap(R=>R.items.map($=>$.id))),T=w.filter(R=>!N.has(R.id));T.length>0&&(j.length>0?j[0].items.push(...T):j.push({id:"default",name:"",items:T})),j.length===0&&j.push({id:crypto.randomUUID(),name:"",items:[]}),e(R=>({...R,stepSections:j}))}},[n.steps,n.stepGroups,n.stepSections,e]);const a=n.stepSections||[],l=Ia(Ar(Qo,{activationConstraint:{distance:10}}),Ar(Jo,{activationConstraint:{delay:250,tolerance:5}}),Ar(Yo,{coordinateGetter:Rd})),c=({active:S,over:_})=>{if(!_)return;const w=S.id,j=_.id,N=a.find(R=>R.items.some($=>$.id===w)),T=a.find(R=>R.items.some($=>$.id===j))||a.find(R=>R.id===j);!N||!T||N===T||e(R=>{const $=N.items,F=T.items,q=$.findIndex(P=>P.id===w),I=F.findIndex(P=>P.id===j);let U;if(j===T.id)U=F.length+1;else{const V=_&&S.rect.current.translated&&S.rect.current.translated.top>_.rect.top+_.rect.height?1:0;U=I>=0?I+V:F.length+1}return{...R,stepSections:R.stepSections.map(P=>P.id===N.id?{...P,items:$.filter(V=>V.id!==w)}:P.id===T.id?{...P,items:[...F.slice(0,U),$[q],...F.slice(U,F.length)]}:P)}})},u=({active:S,over:_})=>{if(!_)return;const w=S.id,j=_.id,N=a.find(R=>R.items.some($=>$.id===w)),T=a.find(R=>R.items.some($=>$.id===j))||a.find(R=>R.id===j);if(N&&T&&N===T){const R=N.items.findIndex(F=>F.id===w),$=T.items.findIndex(F=>F.id===j);R!==$&&e(F=>({...F,stepSections:F.stepSections.map(q=>q.id===N.id?{...q,items:ra(q.items,R,$)}:q)}))}},h=(S,_,w)=>{e(j=>({...j,stepSections:j.stepSections.map(N=>{if(N.id!==S)return N;const T=[...N.items];return T[_]={...T[_],text:w},{...N,items:T}})}))},f=(S,_)=>{e(w=>({...w,stepSections:w.stepSections.map(j=>j.id===S?{...j,items:j.items.filter((N,T)=>T!==_)}:j)}))},p=(S,_,w)=>{e(j=>({...j,stepSections:j.stepSections.map(N=>{if(N.id!==S)return N;const T=[...N.items];return T[_]={...T[_],text:w},{...N,items:T}})}))},m=S=>{const _={id:crypto.randomUUID(),text:""};e(w=>({...w,stepSections:w.stepSections.map(j=>j.id===S?{...j,items:[...j.items,_]}:j)}))},y=()=>{e(S=>({...S,stepSections:[...S.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},b=S=>{e(_=>({..._,stepSections:_.stepSections.filter(w=>w.id!==S)}))},v=(S,_)=>{e(w=>({...w,stepSections:w.stepSections.map(j=>j.id===S?{...j,name:_}:j)}))};return r.jsxs(ea,{sensors:l,collisionDetection:db,onDragOver:c,onDragEnd:u,children:[r.jsxs("div",{className:"recipe-form-steps",children:[a.map(S=>r.jsx(Ua,{id:S.id,items:S.items.map(_=>_.id),strategy:qo,children:r.jsxs(a2,{section:S,sections:a,onSectionChange:v,onRemoveSection:b,children:[S.items.map((_,w)=>r.jsx(i2,{id:_.id,index:w,item:_,groupId:S.id,voiceInputEnabled:s,onChange:h,onRemove:f,onVoiceAppend:p},_.id)),r.jsx(he,{type:"button",variant:"ghost",onClick:()=>m(S.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},S.id)),r.jsx(he,{type:"button",variant:"secondary",onClick:y,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),r.jsx(cm,{dropAnimation:{sideEffects:lm({styles:{active:{opacity:"0.5"}}})},children:null})]})},l2="voice_input_enabled",c2=15*1e3,vd=new Map,Vu=(n,e)=>{vd.set(n,{value:e===!0,expiresAt:Date.now()+c2})},u2=n=>{const e=vd.get(n);return e?Date.now()>e.expiresAt?(vd.delete(n),null):e.value:null},d2=async n=>{const{data:e,error:s}=await Ee.rpc("get_feature_flag",{p_key:n});if(s)throw s;return e===!0},h2=async n=>{const{data:e,error:s}=await Ee.from("app_feature_flags").select("enabled").eq("feature_key",n).maybeSingle();if(s)throw s;return e?.enabled===!0},qp={async getFlag(n,{force:e=!1}={}){if(!e){const s=u2(n);if(s!==null)return s}try{const s=await d2(n);return Vu(n,s),s}catch(s){console.warn("[featureFlagService] RPC get_feature_flag failed, fallback to table:",s);const a=await h2(n);return Vu(n,a),a}},async setFlag(n,e){const s=e===!0;try{const{data:a,error:l}=await Ee.rpc("admin_set_feature_flag",{p_key:n,p_enabled:s});if(l)throw l;return Vu(n,a?.enabled===!0),a?.enabled===!0}catch(a){console.warn("[featureFlagService] RPC admin_set_feature_flag failed, fallback to table:",a);const{data:l,error:c}=await Ee.from("app_feature_flags").upsert({feature_key:n,enabled:s,updated_at:new Date().toISOString()},{onConflict:"feature_key"}).select("enabled").single();if(c)throw c;const u=l?.enabled===!0;return Vu(n,u),u}},async getVoiceInputEnabled(){return!0},async setVoiceInputEnabled(n){return this.setFlag(l2,n)},clearCache(){vd.clear()}},hw=({onClose:n,onImport:e,initialMode:s="url"})=>{const a=Ps(),[l,c]=k.useState(s),[u,h]=k.useState(null),[f,p]=k.useState(""),[m,y]=k.useState(""),[b,v]=k.useState(null),[S,_]=k.useState(null),w="groq",[j,N]=k.useState(()=>{try{const ie=localStorage.getItem("preferredImageEngine");return!ie||ie==="auto"?w:ie}catch{return w}}),[T,R]=k.useState(!1),[$,F]=k.useState(!1),[q,I]=k.useState(null),[U,P]=k.useState(!1),V=k.useRef(null),D=k.useRef(null),H=k.useRef(null),C=k.useRef(null),M=()=>{C.current&&(clearTimeout(C.current),C.current=null)},z=(ie="")=>{if(M(),H.current){try{H.current.abort()}catch{}H.current=null}F(!1),ie&&I(ie)};k.useEffect(()=>()=>{if(M(),H.current){try{H.current.abort()}catch{}H.current=null}},[]),k.useEffect(()=>{if(!b){_(null);return}const ie=URL.createObjectURL(b);return _(ie),()=>URL.revokeObjectURL(ie)},[b]),k.useEffect(()=>{try{localStorage.setItem("preferredImageEngine",j)}catch{}},[j]);const B=ie=>new Promise(Te=>{if(!ie||typeof ie!="object")return Te(ie);const Le=String(ie.type||"").toLowerCase();if(!Le.startsWith("image/"))return Te(ie);const E=2e6,ve=2e3,ge=.9,Y=String(ie.name||"").toLowerCase(),W=Le.includes("heic")||Le.includes("heif")||Y.endsWith(".heic")||Y.endsWith(".heif"),oe=URL.createObjectURL(ie);let re=!1;const ee=Be=>{if(!re){re=!0;try{URL.revokeObjectURL(oe)}catch{}Te(Be)}},de=setTimeout(()=>ee(ie),15e3),me=new Image;me.onload=()=>{const Be=me.naturalWidth||me.width||0,Re=me.naturalHeight||me.height||0;if(!Be||!Re)return clearTimeout(de),ee(ie);const Pe=Math.min(1,ve/Math.max(Be,Re)),Je=Math.max(1,Math.round(Be*Pe)),We=Math.max(1,Math.round(Re*Pe)),Et=Pe<1,Wt=W||ie.size>E;if(!Et&&!Wt)return clearTimeout(de),ee(ie);const dt=document.createElement("canvas");dt.width=Je,dt.height=We;const yt=dt.getContext("2d");if(!yt)return clearTimeout(de),ee(ie);yt.drawImage(me,0,0,Je,We),dt.toBlob(ft=>{if(clearTimeout(de),!ft)return ee(ie);const Tt=String(ie.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);ee(new File([ft],`${Tt}.jpg`,{type:"image/jpeg"}))},"image/jpeg",ge)},me.onerror=()=>{clearTimeout(de),ee(ie)},me.src=oe}),K=async ie=>{if(ie){if(!String(ie.type||"").startsWith("image/")){I("");return}I(null),R(!0);try{const Te=await B(ie);v(Te||ie)}finally{R(!1)}}},Q=()=>V.current?.click?.(),Z=()=>D.current?.click?.(),A=ie=>{ie.preventDefault(),ie.stopPropagation(),ie.type==="dragenter"||ie.type==="dragover"?P(!0):ie.type==="dragleave"&&P(!1)},L=ie=>{if(ie.preventDefault(),ie.stopPropagation(),P(!1),ie.dataTransfer.files&&ie.dataTransfer.files[0]){const Te=ie.dataTransfer.files[0];Te.type.startsWith("image/")&&K(Te)}},J=ie=>/[---]/.test(ie||""),ae=ie=>typeof ie=="string"?ie.trim():ie&&typeof ie=="object"?String(ie.text||ie.name||"").trim():"",ue=async ie=>{const Te=[];Te.push((ie.name||ie.title||"").trim()),Te.push((ie.description||"").trim());const Le=[];Array.isArray(ie.ingredients)&&ie.ingredients.forEach((Re,Pe)=>{if(typeof Re=="string"){const We=Re.trim();if(!We)return;Te.push(We),Le.push(Pe);return}const Je=String(Re?.name||Re?.text||"").trim();Je&&(Te.push(Je),Le.push(Pe))});const E=[];if(Array.isArray(ie.steps)&&ie.steps.forEach((Re,Pe)=>{const Je=ae(Re);Je&&(Te.push(Je),E.push(Pe))}),!Te.some(Re=>String(Re||"").trim()))return ie;const{data:ve,error:ge}=await Ee.auth.refreshSession(),Y=ve?.session;if(ge||!Y?.access_token){const Re=ge?.message||"",Pe=/refresh_token|session|expired|invalid|not found/i.test(Re);throw new Error(Pe?"":Re||"")}const W=`${Io}/functions/v1/translate`,oe=await fetch(W,{method:"POST",headers:{"Content-Type":"application/json",apikey:ed,Authorization:`Bearer ${Y.access_token}`},body:JSON.stringify({text:Te,target_lang:"JA"})});if(!oe.ok){const Re=oe.status;if(Re===401)throw new Error("");let Pe="";try{const Je=await oe.text();if(Je)try{const We=JSON.parse(Je);Pe=We?.error||We?.message||Je}catch{Pe=Je}}catch{}throw new Error(Pe||`: ${Re}`)}const re=await oe.json();if(re&&re.error)throw new Error(String(re.error));if(!Array.isArray(re?.translations))throw new Error("");const ee=re.translations.map(Re=>Re.text);let de=0;const me={...ie},Be=ee[de++]||me.name||me.title||"";if(me.name=Be,me.title=Be,me.description=ee[de++]||me.description,Le.length>0){const Re=new Map;Le.forEach((Pe,Je)=>{Re.set(Pe,ee[de+Je])}),me.ingredients=me.ingredients.map((Pe,Je)=>{const We=Re.get(Je);return We?typeof Pe=="string"?We:Pe&&typeof Pe=="object"?{...Pe,name:We}:Pe:Pe}),de+=Le.length}if(E.length>0){const Re=new Map;E.forEach((Pe,Je)=>{Re.set(Pe,ee[de+Je])}),me.steps=me.steps.map((Pe,Je)=>{const We=Re.get(Je);return We?Pe&&typeof Pe=="object"?{...Pe,text:We}:We:Pe})}return me},[Ce,fe]=k.useState([]),ne=async()=>{F(!0),I(null),fe([]);try{let ie,Te="";if(l==="url"){if(!m)return;Te=m;const{data:ge,error:Y}=await Ee.auth.refreshSession(),W=ge?.session;if(Y||!W?.access_token){const de=Y?.message||"",me=/refresh_token|session|expired|invalid|not found/i.test(de);throw new Error(me?"":de||"")}const oe=`${Io}/functions/v1/scrape-recipe`,re=await fetch(oe,{method:"POST",headers:{"Content-Type":"application/json",apikey:ed,Authorization:`Bearer ${W.access_token}`},body:JSON.stringify({url:m})});if(!re.ok){const de=re.status;if(de===401)throw new Error("");if(de===403)throw new Error("URL");if(de>=500)throw new Error("");let me="";try{const Be=await re.text();if(Be)try{const Re=JSON.parse(Be);me=Re?.error||Re?.message||Be}catch{me=Be}}catch{}throw new Error(me||`URL: ${de}`)}ie=await re.json()}else{if(!b)return;M();const ge=new AbortController;H.current=ge;const Y=12e4;C.current=setTimeout(()=>{z("")},Y),fe(We=>[...We," ..."]);const W=new FormData;W.append("image",b),W.append("engine",j);const oe=Io,re=ed,ee=`${oe}/functions/v1/analyze-image`,{data:de,error:me}=await Ee.auth.refreshSession(),Be=de?.session;if(me||!Be?.access_token){const We=me?.message||"",Et=/refresh_token|session|expired|invalid/i.test(We);throw new Error(Et?"":We||"")}const Re=Be.access_token,Pe={apikey:re,Authorization:`Bearer ${Re}`,"X-User-JWT":Re};let Je;try{Je=await fetch(ee,{method:"POST",headers:Pe,body:W,signal:ge.signal})}catch(We){throw console.error("Network Error:",We),new Error("")}if(Je.status===401){let We="";try{We=await Je.text()}catch{}if(/invalid\s+jwt|jwt\s+expired|token\s+expired/i.test(String(We||"")))try{const{data:Wt,error:dt}=await Ee.auth.refreshSession(),yt=Wt?.session;if(dt||!yt?.access_token)throw dt||new Error("No session after refresh");const ft=yt.access_token;Pe.Authorization=`Bearer ${ft}`,Pe["X-User-JWT"]=ft,Je=await fetch(ee,{method:"POST",headers:Pe,body:W,signal:ge.signal})}catch(Wt){throw console.warn("Session refresh failed:",Wt),new Error("")}}if(!Je.ok){const We=Je.status;let Et="";try{const dt=await Je.text();if(dt)try{const yt=JSON.parse(dt);Et=yt?.message||yt?.error||dt}catch{Et=dt}}catch{}const Wt=Et?`: ${Et}`:"";throw new Error(`Server Error (${We})${Wt}`)}if(!Je.body)ie=await Je.json();else{const We=Je.body.getReader(),Et=new TextDecoder;let Wt=null,dt="",yt=!1;for(;;){const{done:ft,value:Tt}=await We.read();if(ft)break;dt+=Et.decode(Tt,{stream:!0});const sn=dt.split(`

`);dt=sn.pop()||"";for(const wt of sn){const Un=wt.trim();if(Un.startsWith("data: "))try{const Lt=JSON.parse(Un.slice(6));if(Lt.type==="log")fe(qt=>[...qt,Lt.message]);else if(Lt.type==="result")Wt=Lt,yt=!0;else if(Lt.type==="error")throw new Error(Lt.message)}catch(Lt){if(Lt.message&&!Lt.message.includes("Failed to parse"))throw Lt;console.warn("Failed to parse SSE event",Lt)}}if(yt)break}try{await We.cancel()}catch{}if(!Wt)throw new Error("");ie=Wt}}if(ie.error)throw new Error(ie.error);if(!ie.recipe)throw new Error("No recipe found");let Le=ie.recipe;if(Le.title=Le.title||Le.name||"",Le.name=Le.name||Le.title||"",Le.recipeYield=Le.recipeYield||Le.servings||"",Le.description=Le.description||"",!Le.ingredients&&Le.recipeIngredient&&(Le.ingredients=Le.recipeIngredient),Array.isArray(Le.ingredients)){const ge=["","","method","instructions","steps","preparation"],Y=[],W=[];Le.ingredients.forEach(oe=>{const re=(oe.group||"").trim().toLowerCase();if(re&&ge.some(ee=>re===ee||re.includes(ee))){const ee=oe.name||oe.text||"";ee&&W.push(ee)}else Y.push(oe)}),W.length>0&&(console.log("Extracted steps from ingredients:",W),Le.ingredients=Y,Le.steps=Array.isArray(Le.steps)?Le.steps:[],Le.steps=[...Le.steps,...W])}const E=Array.isArray(Le.steps)?Le.steps.slice(0,3).map(ge=>ae(ge)).join(""):"",ve=`${Le.name||Le.title||""}${E}`;if(ve&&!J(ve)){h(Le),p(Te),c("confirm-translation"),F(!1);return}e(Le,Te),n()}catch(ie){if(console.error("Import failed details:",ie),ie?.name==="AbortError")return;const Te=ie.message||"Import failed. Please try again.";I(Te)}finally{M(),H.current=null,l!=="confirm-translation"&&F(!1)}},be=async ie=>{F(!0),I(null);try{let Te=u;ie&&(Te=await ue(u)),e(Te,f),n()}catch(Te){console.error("Translation flow error:",Te);const Le=Te?.message||"";I(Le),a.warning(Le)}finally{F(!1)}},le=ie=>{const Te=ie.target.files[0];Te&&K(Te),ie.target.value=""};return r.jsxs("div",{className:"modal-overlay fade-in",children:[$&&r.jsx("div",{className:"analyze-status-popup",role:"status","aria-live":"polite",children:r.jsxs("div",{className:"analyze-status-popup-inner",children:[r.jsx("div",{className:"spinner"}),r.jsx("p",{className:"analyze-status-title",children:"..."}),Ce.length>0&&r.jsx("div",{className:"progress-log-container",children:r.jsxs("div",{className:"progress-log",children:[Ce.map((ie,Te)=>r.jsx("div",{className:"log-entry",children:r.jsx("span",{className:"log-message",children:ie})},Te)),r.jsx("div",{ref:ie=>ie?.scrollIntoView({behavior:"smooth"})})]})}),r.jsx("div",{className:"analyze-status-actions",children:r.jsx(he,{type:"button",variant:"secondary",onClick:()=>z(),children:""})})]})}),r.jsxs(mn,{className:"import-modal-card",children:[r.jsx("h3",{className:"modal-title",children:l==="confirm-translation"?"":""}),l==="confirm-translation"?r.jsxs("div",{className:"translation-confirm-content",children:[r.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[r.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),r.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),q&&r.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:q}),r.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[r.jsx(he,{type:"button",variant:"primary",onClick:()=>be(!0),isLoading:$,style:{width:"100%"},children:""}),r.jsx(he,{type:"button",variant:"secondary",onClick:()=>be(!1),disabled:$,style:{width:"100%"},children:""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"import-mode-tabs",children:[r.jsx("button",{type:"button",onClick:()=>c("url"),className:`tab-btn tab-import-web ${l==="url"?"active":""}`,children:" Web URL"}),r.jsx("button",{type:"button",onClick:()=>c("image"),className:`tab-btn tab-import-image ${l==="image"?"active":""}`,children:"  (Best Effort)"})]}),l==="url"?r.jsxs(r.Fragment,{children:[r.jsx("p",{children:"URL"}),r.jsx("input",{type:"url",placeholder:"https://...",value:m,onChange:ie=>y(ie.target.value),className:"import-url-input",autoFocus:!0})]}):r.jsxs(r.Fragment,{children:[r.jsx("p",{children:""}),r.jsxs("div",{className:"image-engine-panel",children:[r.jsxs("label",{className:"image-engine-label",children:["",r.jsxs("select",{className:"image-engine-select",value:j,onChange:ie=>N(ie.target.value),disabled:$||T,children:[r.jsx("option",{value:"groq",children:"Groq"}),r.jsx("option",{value:"auto",children:"Best EffortGroqAzure OCRGroqGemini"}),r.jsx("option",{value:"gemini",children:"Gemini"}),r.jsx("option",{value:"groq_vision",children:"Groq"})]})]}),r.jsx("div",{className:"image-engine-help",children:"AIGroqBest EffortGeminiGemini"})]}),r.jsxs("div",{className:"image-upload-wrapper",children:[r.jsx("input",{ref:V,type:"file",accept:"image/*",capture:"environment",onChange:le,className:"image-upload-input"}),r.jsx("input",{ref:D,type:"file",accept:"image/*",onChange:le,className:"image-upload-input"}),r.jsx("div",{onDragEnter:A,onDragLeave:A,onDragOver:A,onDrop:L,className:`image-upload-label ${U?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{$||T||Z()},onKeyDown:ie=>{$||T||(ie.key==="Enter"||ie.key===" ")&&(ie.preventDefault(),Z())},children:S?r.jsx("img",{src:S,alt:"Preview",className:"image-upload-preview"}):U?"":""}),r.jsxs("div",{className:"image-upload-actions",children:[r.jsx(he,{type:"button",variant:"secondary",onClick:Q,disabled:$||T,children:""}),r.jsx(he,{type:"button",variant:"secondary",onClick:Z,disabled:$||T,children:""})]})]}),T&&r.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),q&&r.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto"},children:q}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(he,{type:"button",variant:"ghost",onClick:n,disabled:$,children:""}),r.jsx(he,{type:"button",variant:"primary",onClick:ne,isLoading:$,disabled:T||(l==="url"?!m:!b),children:""})]})]})]})]})},_x=({onSave:n,onCancel:e,initialData:s})=>{const a=s||{},[l,c]=k.useState("ingredients"),[u,h]=k.useState(null),[f,p]=k.useState(new Map);Ie.useEffect(()=>{(async()=>{const z=await Pn.fetchPriceList();p(z)})()},[]);const m=k.useMemo(()=>{const M=a.steps||[""];let z=a.stepGroups||[];const B=M.some(Q=>typeof Q=="object"&&Q.group);if(z.length===0&&B){const Q=new Map;M.forEach(Z=>{typeof Z=="object"&&Z.group&&!Q.has(Z.group)&&Q.set(Z.group,crypto.randomUUID())}),z=Array.from(Q.entries()).map(([Z,A])=>({id:A,name:Z}))}return{steps:M.map(Q=>{const Z=typeof Q=="string"?Q:Q.text||"",A=typeof Q=="object"&&Q.id?Q.id:crypto.randomUUID();let L=typeof Q=="object"?Q.groupId:void 0;const J=typeof Q=="object"?Q.group:void 0;if(!L&&J&&z.length>0){const ae=z.find(ue=>ue.name===J);ae&&(L=ae.id)}return{id:A,text:Z,groupId:L}}),stepGroups:z}},[a]),y=m.steps,b=m.stepGroups,v=k.useMemo(()=>{const M=a.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let z=a.ingredientGroups||[];if(z.length===0&&M.some(K=>K.group)){const K=new Map;M.forEach(Q=>{Q.group&&!K.has(Q.group)&&K.set(Q.group,crypto.randomUUID())}),z=Array.from(K.entries()).map(([Q,Z])=>({id:Z,name:Q})),K.size>0&&M.some(Q=>!Q.group)}return{ingredients:M.map(K=>{const Q=typeof K=="string"?{name:K,quantity:"",unit:"",cost:"",purchaseCost:""}:{...K,cost:K.cost||"",purchaseCost:K.purchaseCost||""};let Z=Q.groupId;if(!Z&&Q.group&&z.length>0){const A=z.find(L=>L.name===Q.group);A&&(Z=A.id)}return{...Q,id:Q.id||crypto.randomUUID(),groupId:Z}}),ingredientGroups:z}},[a]),S=v.ingredients,_=v.ingredientGroups,[w,j]=k.useState({title:a.title||"",description:a.description||"",image:a.image||"",imageFile:null,storeName:a.storeName||"",servings:a.servings||"",ingredients:S,ingredientGroups:_,steps:y,stepGroups:b,tags:a.tags||[""],course:a.course||"",category:a.category||"",type:a.type||"normal",flours:a.flours||[],breadIngredients:a.breadIngredients||[],sourceUrl:a.sourceUrl||""}),[N,T]=k.useState(!1),[R,$]=k.useState(!1);k.useEffect(()=>{let M=!0;return(async()=>{try{const B=await qp.getVoiceInputEnabled();M&&$(B)}catch(B){console.warn("[RecipeForm] failed to load voice input feature flag:",B),M&&$(!1)}})(),()=>{M=!1}},[]);const F=(M,z="")=>{const B=new Map,K=M.ingredients||[];K.forEach(ue=>{let Ce=ue.group||"";Ce==="Main"&&(Ce=""),B.has(Ce)||B.set(Ce,crypto.randomUUID())});const Q=Array.from(B.entries()).map(([ue,Ce])=>({id:Ce,name:ue})),Z=K.map(ue=>{let Ce=ue.group||"";Ce==="Main"&&(Ce="");let fe;return B.has(Ce)&&(fe=B.get(Ce)),{id:crypto.randomUUID(),name:ue.name||"",quantity:ue.quantity||"",unit:ue.unit||"",cost:"",purchaseCost:"",groupId:fe}}),A=new Map,L=M.steps||[];L.forEach(ue=>{typeof ue=="object"&&ue.group&&ue.group!=="Main"&&(A.has(ue.group)||A.set(ue.group,crypto.randomUUID()))});const J=Array.from(A.entries()).map(([ue,Ce])=>({id:Ce,name:ue})),ae=L.map(ue=>{const Ce=typeof ue=="object",fe=Ce?ue.text||"":ue,ne=Ce?ue.group:null;let be;return ne&&A.has(ne)&&(be=A.get(ne)),{id:crypto.randomUUID(),text:fe,groupId:be}});j(ue=>({...ue,title:M.name||M.title||ue.title,description:M.description||ue.description,category:z?"URL":M.category||ue.category,image:M.image||ue.image,servings:M.recipeYield||M.servings||ue.servings,ingredients:Z,ingredientGroups:Q,steps:ae,stepGroups:J,ingredientSections:void 0,stepSections:void 0,sourceUrl:z||ue.sourceUrl})),h(null),c("ingredients")},q=M=>{M.preventDefault(),M.stopPropagation(),M.type==="dragenter"||M.type==="dragover"?T(!0):M.type==="dragleave"&&T(!1)},I=M=>{if(M.preventDefault(),M.stopPropagation(),T(!1),M.dataTransfer.files&&M.dataTransfer.files[0]){const z=M.dataTransfer.files[0];z.type.startsWith("image/")&&j(B=>({...B,imageFile:z,image:URL.createObjectURL(z)}))}},U=M=>{const{id:z,value:B}=M.target;j(K=>({...K,[z]:B}))},P=M=>{const z=M.target.files[0];z&&j(B=>({...B,imageFile:z,image:URL.createObjectURL(z)}))},V=k.useMemo(()=>{if(w.type==="bread")return(w.flours?.length||0)+(w.breadIngredients?.length||0);const M=w.ingredientSections||[];return M.length>0?M.reduce((z,B)=>z+(B?.items?.length||0),0):w.ingredients?.length||0},[w.breadIngredients,w.flours,w.ingredientSections,w.ingredients,w.type]),D=k.useMemo(()=>{const M=w.stepSections||[];return M.length>0?M.reduce((z,B)=>z+(B?.items?.length||0),0):w.steps?.length||0},[w.stepSections,w.steps]),H=M=>{M.preventDefault();let z=[],B=[];if(w.type==="bread")z=w.ingredients.map(J=>{const{id:ae,...ue}=J;return ue});else{const J=w.ingredientSections||[];J.length===0&&w.ingredients.length>0?z=w.ingredients.map(ae=>{const{id:ue,...Ce}=ae;return Ce}):(z=J.flatMap(ae=>ae.items.map(ue=>({...ue,groupId:ae.id}))).map(ae=>{const{id:ue,...Ce}=ae;return Ce}),B=J.map(ae=>({id:ae.id,name:ae.name})))}const K=new Set(w.tags||[]);w.course&&K.add(w.course),w.category&&K.add(w.category),w.type==="bread"&&K.add("");const Q=Array.from(K).filter(Boolean);let Z=[],A=[];const L=w.stepSections||[];L.length===0&&w.steps.length>0?Z=w.steps.map(J=>typeof J=="string"?{text:J}:J):(Z=L.flatMap(J=>J.items.map(ae=>({text:ae.text,groupId:J.id}))),A=L.map(J=>({id:J.id,name:J.name}))),n({...w,ingredients:z,ingredientGroups:B,steps:Z,stepGroups:A,image:w.imageFile||w.image,id:a.id||Date.now(),tags:Q,ingredientSections:void 0,stepSections:void 0})},C=!!a?.id;return r.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:H,children:[u&&r.jsx(hw,{onClose:()=>h(null),onImport:F,initialMode:u}),r.jsxs("div",{className:"recipe-form-mock__page",children:[r.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:r.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[r.jsxs("div",{className:"recipe-form-mock__crumb",children:[r.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),r.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),r.jsx("span",{className:"recipe-form-mock__crumb-page",children:C?"":""})]}),r.jsxs("div",{className:"recipe-form-mock__actions",children:[r.jsx(he,{type:"button",variant:"ghost",onClick:e,children:""}),r.jsx(he,{type:"submit",variant:"primary",children:""})]})]})}),r.jsxs("div",{className:"recipe-form-mock__sheet",children:[r.jsxs("header",{className:"recipe-form-mock__doc",children:[r.jsxs("div",{className:"recipe-form-mock__doc-title",children:[r.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:w.title,onChange:U,placeholder:"",required:!0}),r.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),r.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(Mt,{label:"",id:"course",value:w.course,onChange:U,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),r.jsxs("datalist",{id:"course-options",children:[r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""})]})]}),r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(Mt,{label:"",id:"category",value:w.category,onChange:U,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),r.jsxs("datalist",{id:"category-options",children:[r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""})]})]}),r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(Mt,{label:"",id:"storeName",value:w.storeName,onChange:U,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),r.jsx("datalist",{id:"store-options",children:md.map(M=>r.jsx("option",{value:M},M))})]}),r.jsx("div",{className:"recipe-form-mock__meta-field",children:r.jsx(Mt,{label:"",id:"servings",value:w.servings,onChange:U,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),r.jsxs("div",{className:"recipe-form-mock__grid",children:[r.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[r.jsxs(mn,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsx(Mt,{label:"",id:"description",textarea:!0,value:w.description,onChange:U,placeholder:"..."}),R&&r.jsx("div",{className:"recipe-form__voice-action",children:r.jsx(na,{label:"",getCurrentValue:()=>w.description,onTranscript:M=>j(z=>({...z,description:M}))})}),r.jsx(Mt,{label:"URL",id:"sourceUrl",value:w.sourceUrl||"",onChange:U,placeholder:"https://example.com/recipe/..."})]}),r.jsxs(mn,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("div",{className:`recipe-form-mock__image-drop ${N?"is-active":""}`,onDragEnter:q,onDragLeave:q,onDragOver:q,onDrop:I,children:[w.image?r.jsxs("div",{className:"recipe-form-mock__image-preview",children:[r.jsx("img",{src:w.image,alt:"",onError:M=>{M.target.style.display="none"}}),r.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>j(M=>({...M,image:"",imageFile:null})),title:"",children:""})]}):r.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",r.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),r.jsx("input",{type:"file",accept:"image/*",onChange:P,className:"recipe-form-mock__image-input"})]})]}),!a?.id&&r.jsxs(mn,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("div",{className:"recipe-form-mock__import-actions",children:[r.jsx(he,{variant:"secondary",type:"button",onClick:()=>h("url"),children:"URL"}),r.jsx(he,{variant:"secondary",type:"button",onClick:()=>h("image"),children:""})]}),r.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),r.jsxs(mn,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[r.jsx("li",{children:""}),r.jsx("li",{children:""}),r.jsx("li",{children:""})]})]})]}),r.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:r.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[r.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[r.jsxs("div",{className:"recipe-form-mock__nav",children:[r.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${l==="ingredients"?"active":""}`,onClick:()=>c("ingredients"),children:[" ",r.jsx("span",{className:"recipe-form-mock__nav-count",children:V.toLocaleString()})]}),r.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${l==="steps"?"active":""}`,onClick:()=>c("steps"),children:[" ",r.jsx("span",{className:"recipe-form-mock__nav-count",children:D.toLocaleString()})]})]}),r.jsx("div",{className:"recipe-form-mock__workspace-right",children:l==="ingredients"?r.jsxs("div",{className:"recipe-form-mock__segmented",children:[r.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${w.type==="normal"?"active":""}`,onClick:()=>j(M=>({...M,type:"normal"})),children:""}),r.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${w.type==="bread"?"active":""}`,onClick:()=>j(M=>({...M,type:"bread"})),children:""})]}):r.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),r.jsx("div",{className:"recipe-form-mock__workspace-body",children:l==="ingredients"?r.jsx("div",{className:"recipe-form-mock__editor-surface",children:w.type==="bread"?r.jsx(WE,{formData:w,setFormData:j}):r.jsx(s2,{formData:w,setFormData:j,priceList:f})}):r.jsx("div",{className:"recipe-form-mock__editor-surface",children:r.jsx(o2,{formData:w,setFormData:j,voiceInputEnabled:R})})})]})})]})]})]})]})},f2="modulepreload",p2=function(n){return"/app/"+n},Sx={},nd=function(e,s,a){let l=Promise.resolve();if(s&&s.length>0){let f=function(p){return Promise.all(p.map(m=>Promise.resolve(m).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),h=u?.nonce||u?.getAttribute("nonce");l=f(s.map(p=>{if(p=p2(p),p in Sx)return;Sx[p]=!0;const m=p.endsWith(".css"),y=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${y}`))return;const b=document.createElement("link");if(b.rel=m?"stylesheet":f2,m||(b.as="script"),b.crossOrigin="",b.href=p,h&&b.setAttribute("nonce",h),document.head.appendChild(b),m)return new Promise((v,S)=>{b.addEventListener("load",v),b.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${p}`)))})}))}function c(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return l.then(u=>{for(const h of u||[])h.status==="rejected"&&c(h.reason);return e().catch(c)})},m2=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const e=Object.values(n)[0];if(Array.isArray(e))return e[0]||null;if(e&&typeof e=="object"&&e.id)return e}return null},hs={async fetchAllProfiles(){try{const{data:e,error:s}=await Ee.rpc("admin_list_profiles");if(!s&&Array.isArray(e))return e;s&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",s)}catch(e){console.warn("admin_list_profiles RPC threw (fallback to direct select):",e)}const n=await Ee.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const e=await Ee.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(e.error)throw e.error;return e.data||[]}throw n.error},async updateProfile(n,e){const a=Object.keys(e||{}).length===1&&Object.prototype.hasOwnProperty.call(e,"show_master_recipes");let l=null;if(a)try{const{data:u,error:h}=await Ee.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:e.show_master_recipes===!0});if(h)throw h;if(u){const f=m2(u);if(f)return f}}catch(u){console.warn("RPC admin_set_show_master_recipes failed:",u),l=u}const c=await Ee.from("profiles").update(e).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!c.error)return c.data;if(l&&a)throw console.error("Direct update also failed:",c.error),new Error(`(RPC: ${l.message})`);if(String(c.error.message||"").toLowerCase().includes("email")){const u=await Ee.from("profiles").update(e).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(u.error)throw u.error;return u.data}throw c.error},async adminGetLoginLogs(n){const{data:e,error:s}=await Ee.rpc("admin_get_login_logs",{p_user_id:n});if(s)throw s;return e||[]},async adminResetPassword(n,e){const{data:s,error:a}=await Ee.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:e}});if(a)throw a;if(s?.error)throw new Error(s.error);return s},async sendPasswordResetEmail(n){const{error:e}=await Ee.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin+"/app/"});if(e)throw e;return!0},async adminSetRole(n,e){const{error:s}=await Ee.rpc("admin_set_role",{p_user_id:n,p_role:e});if(s)throw s;return!0},async adminDeleteUser(n){const{error:e}=await Ee.rpc("admin_delete_user",{p_user_id:n});if(e)throw e;return!0}},jx="csv_unit_overrides",Cx=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),xd={async _getCurrentUserId(){const{data:n,error:e}=await Ee.auth.getUser();if(e)throw e;return n?.user?.id||null},async getAll(n=null){try{const e=n||await this._getCurrentUserId();if(!e)return new Map;const{data:s,error:a}=await Ee.from(jx).select("ingredient_name,csv_unit").eq("user_id",e);if(a){if(Cx(a))return new Map;throw a}const l=new Map;return(s||[]).forEach(c=>{c?.ingredient_name&&l.set(String(c.ingredient_name),String(c.csv_unit||""))}),l}catch(e){return console.warn("csvUnitOverrideService.getAll failed",e),new Map}},async upsert(n,e,s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");const l=String(n||"").trim(),c=String(e||"").trim();if(!l)throw new Error("");if(!c)throw new Error("");const{data:u,error:h}=await Ee.from(jx).upsert({user_id:a,ingredient_name:l,csv_unit:c,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(h)throw Cx(h)?new Error("DB csv_unit_overrides "):h;return u}},kx="ingredient_vendor_orders",Nx=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),Ex={async getAll(n){const e=String(n||"").trim();if(!e)return[];const{data:s,error:a}=await Ee.from(kx).select("vendor_name,sort_order").eq("user_id",e).order("sort_order",{ascending:!0}).order("vendor_name",{ascending:!0});if(a){if(Nx(a))return[];throw a}return(s||[]).map(l=>String(l?.vendor_name||"").trim()).filter(Boolean)},async saveOrder(n,e){const s=String(n||"").trim();if(!s)throw new Error("User ID is required");const a=[],l=new Set;if((e||[]).forEach(f=>{const p=String(f||"").trim();!p||l.has(p)||(l.add(p),a.push(p))}),a.length===0)return;const c=new Date().toISOString(),u=a.map((f,p)=>({user_id:s,vendor_name:f,sort_order:p,updated_at:c})),{error:h}=await Ee.from(kx).upsert(u,{onConflict:"user_id,vendor_name"});if(h)throw Nx(h)?new Error("DB ingredient_vendor_orders "):h}},$o=({isOpen:n,onClose:e,onConfirm:s,title:a="",description:l,confirmWord:c="DELETE",loading:u=!1,loadingNode:h=null})=>{const[f,p]=k.useState(""),m=f===c,y=()=>{p(""),e()},b=async()=>{!m||u||(await s(),p(""))};return r.jsx(rn,{isOpen:n,onClose:y,title:a,size:"small",showCloseButton:!u,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[l&&r.jsx("div",{style:{color:"#374151",fontSize:"0.95rem",lineHeight:1.6},children:l}),r.jsxs("div",{style:{background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",padding:"12px 16px",fontSize:"0.9rem",color:"#991b1b"},children:["  ",r.jsx("strong",{children:c})," "]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"6px",fontWeight:600,fontSize:"0.85rem",color:"#374151"},children:""}),r.jsx("input",{type:"text",value:f,onChange:v=>p(v.target.value),placeholder:c,disabled:u,autoFocus:!0,style:{width:"100%",padding:"10px 12px",border:m?"2px solid #ef4444":"1px solid #d1d5db",borderRadius:"8px",fontSize:"1rem",fontFamily:"monospace",letterSpacing:"0.05em",outline:"none",boxSizing:"border-box",color:"#111",transition:"border-color 0.15s ease"},onKeyDown:v=>{v.key==="Enter"&&b()}})]}),u&&h&&r.jsxs("div",{style:{marginTop:"4px",padding:"12px",background:"#f3f4f6",borderRadius:"8px",fontSize:"0.9rem",color:"#374151",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("div",{style:{width:"16px",height:"16px",flexShrink:0,border:"3px solid #e5e7eb",borderTopColor:"#6b7280",borderRadius:"50%",animation:"spin 1s linear infinite"}}),r.jsx("div",{style:{wordBreak:"break-all"},children:h}),r.jsx("style",{children:`
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                        `})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(he,{variant:"ghost",onClick:y,disabled:u,children:""}),r.jsx(he,{variant:"danger",onClick:b,disabled:!m||u,children:u?"...":""})]})]})})},fw=({isOpen:n,onClose:e,onConfirm:s,title:a,description:l,loading:c,loadingNode:u=null})=>{const[h,f]=k.useState([]),[p,m]=k.useState(!1),[y,b]=k.useState(""),[v,S]=k.useState(!1),[_,w]=k.useState("");k.useEffect(()=>{n&&(b(""),S(!1),w(""),j())},[n]);const j=async()=>{m(!0);try{const T=await hs.fetchAllProfiles();f((T||[]).filter(R=>R.role!=="admin"))}catch(T){console.error("Failed to load profiles:",T)}finally{m(!1)}},N=()=>{s(y)};return n?r.jsx(rn,{isOpen:n,onClose:()=>{c||e()},title:a,maxWidth:"500px",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[r.jsx("p",{style:{margin:0,fontSize:"0.95rem",lineHeight:1.5},children:l}),p?r.jsx("div",{style:{fontSize:"0.9rem",color:"#666"},children:"..."}):r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:""}),r.jsxs("select",{value:y,onChange:T=>b(T.target.value),disabled:c||v,style:{width:"100%",padding:"8px",border:"1px solid #d1d5db",borderRadius:"4px"},children:[r.jsx("option",{value:"",children:"--  --"}),h.map(T=>r.jsxs("option",{value:T.id,children:[T.display_id,T.email?` (${T.email})`:""]},T.id))]})]}),v?r.jsxs("div",{style:{border:"1px solid #fecaca",borderRadius:"8px",padding:"15px",backgroundColor:"#fef2f2",marginTop:"10px"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#dc2626",marginBottom:"8px"},children:""}),r.jsxs("p",{style:{margin:"0 0 10px",fontSize:"0.9rem",color:"#991b1b"},children:[" ",r.jsx("br",{})," ",r.jsx("strong",{children:"DELETE"})," "]}),r.jsx("input",{type:"text",value:_,onChange:T=>w(T.target.value),placeholder:"DELETE",disabled:c,style:{width:"100%",padding:"8px",border:"1px solid #fca5a5",borderRadius:"4px",marginBottom:"15px"}}),c&&u&&r.jsxs("div",{style:{marginBottom:"15px",padding:"12px",background:"#f3f4f6",borderRadius:"8px",fontSize:"0.9rem",color:"#374151",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("div",{style:{width:"16px",height:"16px",flexShrink:0,border:"3px solid #e5e7eb",borderTopColor:"#6b7280",borderRadius:"50%",animation:"spin 1s linear infinite"}}),r.jsx("div",{style:{wordBreak:"break-all"},children:u})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(he,{variant:"secondary",onClick:()=>S(!1),disabled:c,children:""}),r.jsx(he,{variant:"danger",onClick:N,disabled:_!=="DELETE"||c,children:c?"...":""})]})]}):r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(he,{variant:"secondary",onClick:e,disabled:c,children:""}),r.jsx(he,{variant:"danger",onClick:()=>S(!0),disabled:!y||c,children:""})]})]})}):null},Fl="manual",Hl="__all__",ka="__unassigned__",g2=({vendorKey:n,label:e,count:s,active:a,disabled:l,onSelect:c})=>{const{attributes:u,listeners:h,setNodeRef:f,transform:p,transition:m,isDragging:y}=Ba({id:n,data:{type:"vendor-order-item"},disabled:!!l}),b={transform:Br.Transform.toString(p),transition:m,opacity:y?.7:1};return r.jsxs("li",{ref:f,style:b,className:`vendor-order-item ${a?"active":""} ${l?"disabled":""}`,onClick:()=>{l||c(n)},role:"button",tabIndex:l?-1:0,onKeyDown:v=>{l||(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),c(n))},"aria-label":`${e} `,children:[r.jsxs("span",{className:"vendor-order-item__label",title:e,children:[e,r.jsxs("span",{className:"vendor-order-item__count",children:["(",Number(s||0).toLocaleString(),")"]})]}),r.jsx("span",{className:"vendor-order-item__handle",...l?{}:u,...l?{}:h,title:"","aria-label":`${e} `,children:""})]})},y2=()=>{const n=Ps(),{user:e}=ms(),s=e?.id||null,[a,l]=k.useState([]),[c,u]=k.useState(""),[h,f]=k.useState("all"),[p,m]=k.useState(!1),[y,b]=k.useState(Hl),[v,S]=k.useState([]),[_,w]=k.useState(!1),[j,N]=k.useState(null),[T,R]=k.useState(!1),[$,F]=k.useState(new Map),[q,I]=k.useState(new Map),[U,P]=k.useState({}),[V,D]=k.useState(!1),[H,C]=k.useState([]),[M,z]=k.useState(!1),[B,K]=k.useState(""),[Q,Z]=k.useState(""),[A,L]=k.useState(!1),[J,ae]=k.useState(!1),[ue,Ce]=k.useState(null),[fe,ne]=k.useState(!1),[be,le]=k.useState(!1),[ie,Te]=k.useState(!1),[Le,E]=k.useState(null),[ve,ge]=k.useState(!1),[Y,W]=k.useState(!1),[oe,re]=k.useState(null),[ee,de]=k.useState(!1),[me,Be]=k.useState(!1),[Re,Pe]=k.useState(null),Je=te=>{const ze=String(te||"").trim();return!ze||ze==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(ze)?ze:"food"},We=te=>{const ze=Je(te);return ze==="food"?"8%":ze==="soft_drink"?"8%":ze==="alcohol"?"10%":ze==="supplies"?"10%":"8%"},Et=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:Fl,label:""}],Wt=k.useCallback(te=>{const ze=Jt(te);return ze?$?.has(ze):!1},[$]),dt=Ie.useMemo(()=>{const te={all:a.length,food:0,alcohol:0,soft_drink:0,supplies:0,[Fl]:0};return a.forEach(ze=>{const Ae=Je(ze?.itemCategory);te[Ae]=(te[Ae]||0)+1,Wt(ze?.ingredientName)||(te[Fl]=(te[Fl]||0)+1)}),te},[a,Wt]),yt=k.useCallback(async()=>{R(!0);try{let te=await On.getAllConversions();if((te?.size||0)===0){await new Promise(Qe=>setTimeout(Qe,350));const Ae=await On.getAllConversions();(Ae?.size||0)>0&&(te=Ae)}const ze=Array.from(te.values()).map(Ae=>({...Ae,clientId:Ae.ingredientName,isNew:!1,isEditing:!1}));l(ze.sort((Ae,Qe)=>String(Ae?.ingredientName||"").localeCompare(String(Qe?.ingredientName||""),"ja"))),R(!1),Promise.allSettled([Pn.fetchPriceList(),xd.getAll()]).then(([Ae,Qe])=>{Ae.status==="fulfilled"?F(Ae.value||new Map):(F(new Map),console.warn("Failed to load CSV prices (ingredient master still available):",Ae.reason)),Qe.status==="fulfilled"?I(Qe.value||new Map):(I(new Map),console.warn("Failed to load CSV unit overrides (ingredient master still available):",Qe.reason))}).catch(Ae=>{console.warn("Failed to load auxiliary ingredient master data:",Ae),F(new Map),I(new Map)})}catch(te){n.error(""),console.error("Failed to load ingredients:",te),R(!1)}},[n]);k.useEffect(()=>{const te=setTimeout(()=>{yt()},0);return()=>clearTimeout(te)},[yt]),k.useEffect(()=>{let te=!0;return(async()=>{if(!s){te&&S([]);return}try{const Ae=await Ex.getAll(s);te&&S(Ae)}catch(Ae){console.error("Failed to load vendor order:",Ae),te&&S([])}})(),()=>{te=!1}},[s]);const ft=()=>{const te=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,ze=["food","alcohol","soft_drink","supplies"].includes(h)?h:"food",Ae={clientId:te,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:ze,isNew:!0,isEditing:!0};l(Qe=>[Ae,...Qe.map(ce=>({...ce,isEditing:!1}))]),N(te)},Tt=k.useCallback(te=>a.findIndex(ze=>ze?.clientId===te),[a]),sn=async te=>{const ze=Tt(te);if(ze<0)return;const Ae=a[ze];if(!Ae.ingredientName||!Ae.packetSize||!Ae.lastPrice){n.warning("");return}const Qe=parseFloat(Ae.yieldPercent),ce=Number.isFinite(Qe)?Qe:100;if(ce<=0||ce>100){n.warning("% 1100 ");return}try{await On.saveConversion(Ae.ingredientName,Ae.packetSize,Ae.packetUnit,Ae.lastPrice,Ae.itemCategory,Ae.vendor,ce),n.success(""),yt(),N(null)}catch(se){n.error(""),console.error("Save error:",se)}},wt=async te=>{const ze=Tt(te);if(ze<0)return;const Ae=a[ze],Qe=Ae?.ingredientName;if(Ae.isNew){l(ce=>ce.filter(se=>se?.clientId!==te)),N(null);return}try{await On.deleteConversion(Qe),n.success(""),yt()}catch(ce){n.error(""),console.error("Delete error:",ce)}},Un=te=>{N(te),l(ze=>ze.map(Ae=>({...Ae,isEditing:Ae?.clientId===te})))},Lt=te=>{const ze=Tt(te);ze<0||(a[ze].isNew?l(Ae=>Ae.filter(Qe=>Qe?.clientId!==te)):yt(),N(null))},qt=(te,ze,Ae)=>{l(Qe=>Qe.map(ce=>ce?.clientId!==te?ce:{...ce,[ze]:Ae}))},un=te=>{const ze=parseFloat(te.lastPrice),Ae=parseFloat(te.packetSize);if(!ze||!Ae)return"-";const Qe=te.packetUnit?te.packetUnit.trim().toLowerCase():"";return Qe==="g"||Qe===""?`${Math.round(ze/Ae*1e3).toLocaleString()}/kg`:Qe==="ml"||Qe==="cc"||Qe===""||Qe===""?`${Math.round(ze/Ae*1e3).toLocaleString()}/L`:Qe==="cl"||Qe===""?`${Math.round(ze/Ae*100).toLocaleString()}/L`:`${Math.round(ze/Ae).toLocaleString()}/${te.packetUnit}`},yn=a.filter(te=>{const ze=String(te?.ingredientName||"");return ze.toLowerCase().includes(c.toLowerCase())?h==="all"?!0:h===Fl?!Wt(ze):Je(te?.itemCategory)===h:!1}),_t=Ie.useMemo(()=>{const te=new Map;a.forEach(se=>{const xe=String(se?.ingredientName||"").trim();if(!xe)return;const Ne=Jt(xe);if(!Ne)return;const Ke=te.get(Ne)||[];Ke.push({clientId:se?.clientId,name:xe}),te.set(Ne,Ke)});const ze=new Set,Ae=new Set,Qe=new Map,ce=[];for(const[se,xe]of te.entries()){if(!Array.isArray(xe)||xe.length<2)continue;ze.add(se),xe.forEach(Ke=>{Ke?.clientId&&Ae.add(Ke.clientId)});const Ne=Array.from(new Set(xe.map(Ke=>Ke?.name).filter(Boolean)));Qe.set(se,Ne),ce.push({key:se,names:Ne,rows:xe.length})}return ce.sort((se,xe)=>{const Ne=String(se?.names?.[0]||""),Ke=String(xe?.names?.[0]||"");return Ne.localeCompare(Ke,"ja")}),{duplicateKeys:ze,duplicateClientIds:Ae,keyToNames:Qe,groups:ce}},[a]);k.useEffect(()=>{p&&(_t?.groups?.length||0)===0&&m(!1)},[p,_t]);const jt=h!=="all"||String(c||"").trim()!=="",Kt=te=>{const ze=Jt(te);if(!ze)return"-";const Qe=($?.get(ze)||null)?.unit;return Qe?String(Qe):"-"},Ft=k.useCallback(te=>{const ze=Jt(te);if(!ze)return"";const Qe=($?.get(ze)||null)?.vendor;return Qe?String(Qe):""},[$]),dn=Ie.useCallback(te=>{const ze=String(te?.vendor||"").trim();if(ze)return ze;const Ae=Ft(te?.ingredientName);return Ae||ka},[Ft]),Ht=Ie.useMemo(()=>{const te=new Map;yn.forEach(ce=>{const se=dn(ce);te.set(se,(te.get(se)||0)+1)});const ze=new Set(te.keys()),Ae=Array.from(te.entries()).map(([ce,se])=>({key:ce,count:se})),Qe=new Map((v||[]).map((ce,se)=>[ce,se]));return Ae.sort((ce,se)=>{const xe=Qe.has(ce.key)?Qe.get(ce.key):Number.MAX_SAFE_INTEGER,Ne=Qe.has(se.key)?Qe.get(se.key):Number.MAX_SAFE_INTEGER;return xe!==Ne?xe-Ne:ce.key===ka&&se.key!==ka?1:se.key===ka&&ce.key!==ka?-1:String(ce.key).localeCompare(String(se.key),"ja")}),{total:yn.length,vendorKeys:ze,entries:Ae}},[yn,dn,v]);k.useEffect(()=>{const te=(Ht?.entries||[]).map(ze=>ze.key);S(ze=>{const Ae=Array.isArray(ze)?ze:[],Qe=Ae.filter(xe=>te.includes(xe)),ce=te.filter(xe=>!Qe.includes(xe)),se=[...Qe,...ce];return se.length===Ae.length&&se.every((xe,Ne)=>xe===Ae[Ne])?Ae:se})},[Ht]);const gn=Ia(Ar(Ed,{activationConstraint:{distance:6}})),hn=k.useCallback(async te=>{if(j!==null)return;const{active:ze,over:Ae}=te;if(!ze?.id||!Ae?.id||ze.id===Ae.id)return;const Qe=(Ht?.entries||[]).map(Ze=>Ze.key),ce=Qe.indexOf(ze.id),se=Qe.indexOf(Ae.id);if(ce<0||se<0)return;const xe=ra(Qe,ce,se),Ke=(Array.isArray(v)?v:[]).filter(Ze=>!Qe.includes(Ze)),tt=[...xe,...Ke];if(S(tt),!!s)try{await Ex.saveOrder(s,tt)}catch(Ze){console.error("Failed to save vendor order:",Ze),n.error(Ze?.message||"")}},[j,s,Ht,n,v]);k.useEffect(()=>{y!==Hl&&(Ht?.vendorKeys?.has?.(y)||b(Hl))},[y,Ht]);const an=Ie.useMemo(()=>{let te=yn.filter(ze=>{const Ae=ze?.clientId,Qe=!!j&&Ae===j;return!(p&&!(_t?.duplicateClientIds||new Set).has(Ae)&&!Qe||y!==Hl&&!(dn(ze)===y)&&!Qe)});if(j&&!te.some(ze=>ze?.clientId===j)){const ze=a.find(Ae=>Ae?.clientId===j);ze&&(te=[ze,...te])}return te},[yn,p,_t,y,dn,j,a]),Dn=te=>{const ze=(te??"").toString().trim();if(!ze)return"";if(Object.prototype.hasOwnProperty.call(U,ze))return U[ze];const Ae=q?.get(ze);if(Ae)return String(Ae);const Qe=Kt(ze);return Qe==="-"?"":Qe},Vt=te=>{const ze=(te??"").toString().trim();if(!ze)return"-";const Ae=q?.get(ze);return Ae?String(Ae):Kt(ze)},Cn=async(te,ze)=>{const Ae=(te??"").toString().trim(),Qe=(ze??"").toString().trim();if(Ae){if(!Qe){P(ce=>{const se={...ce};return delete se[Ae],se});return}try{await xd.upsert(Ae,Qe),I(ce=>{const se=new Map(ce);return se.set(Ae,Qe),se}),n.success("CSV")}catch(ce){console.error(ce),n.error(ce?.message||"")}}},It=async()=>{Te(!0),E(null);try{const te=await On.moveAllToTrash();E({type:"success",message:`: ${te.moved}`}),await yt()}catch(te){console.error(te),E({type:"error",message:": "+(te?.message||String(te))})}finally{Te(!1)}},zn=async()=>{W(!0),re(null);try{const te=await On.adminClearAllNonAdminMaster();re({type:"success",message:`:  ${te.deleted_unit_conversions} / CSV ${te.deleted_csv_overrides} `}),await loadConversionsAndOverrides()}catch(te){console.error(te),re({type:"error",message:": "+(te?.message||String(te))})}finally{W(!1)}},qn=async te=>{Be(!0),Pe(null);try{const ze=await On.adminClearTargetUserMaster(te);Pe({type:"success",message:`:  ${ze.deleted_unit_conversions} / CSV ${ze.deleted_csv_overrides} `}),await loadConversionsAndOverrides()}catch(ze){console.error(ze),Pe({type:"error",message:": "+(ze?.message||String(ze))})}finally{Be(!1),de(!1)}},fn=async()=>{if(e?.role==="admin"){D(!0),K(""),C([]),Z(""),L(!1),Ce(null),ne(!1),z(!0);try{const te=await hs.fetchAllProfiles();C(te||[])}catch(te){console.error(te),K("")}finally{z(!1)}}},Se=()=>{J||(ne(!1),D(!1))},nt=async()=>{if(!(!Q||J)){ae(!0),Ce({type:"info",message:"..."});try{const te=await On.adminCopyIngredientMasterToUser(Q,{overwrite:A}),ze=te?.unit_conversions||{},Ae=te?.csv_unit_overrides||{},Qe=`: ${Number(ze.source_total||0).toLocaleString()}   ${Number(ze.copied||0).toLocaleString()} /  ${Number(ze.updated||0).toLocaleString()} /  ${Number(ze.skipped||0).toLocaleString()}`,ce=`(CSV): ${Number(Ae.source_total||0).toLocaleString()}   ${Number(Ae.copied||0).toLocaleString()} /  ${Number(Ae.updated||0).toLocaleString()} /  ${Number(Ae.skipped||0).toLocaleString()}`;Ce({type:"success",message:`
${Qe}
${ce}`}),n.success("")}catch(te){console.error(te),Ce({type:"error",message:`: ${String(te?.message||te)}`}),n.error("")}finally{ae(!1)}}};return r.jsxs("div",{className:"ingredient-master-container",children:[r.jsxs("div",{className:"master-header",children:[r.jsx("h3",{children:" "}),r.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-start"},children:[e?.role==="admin"&&r.jsx(he,{variant:"secondary",onClick:fn,disabled:j!==null||T||J,title:j!==null?"":void 0,children:""}),r.jsx(he,{variant:"danger",onClick:()=>le(!0),disabled:j!==null||T||ie||a.length===0,title:"",children:" "}),e?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsx(he,{variant:"danger",onClick:()=>de(!0),disabled:j!==null||me||Y,title:"",style:{background:"#b91c1c"},children:" "}),r.jsx(he,{variant:"danger",onClick:()=>ge(!0),disabled:j!==null||me||Y,title:"",style:{background:"#7f1d1d"},children:" "})]}),r.jsx(he,{variant:"primary",onClick:ft,disabled:j!==null,children:"+ "})]})]}),Le&&r.jsx("div",{className:`status-msg ${Le.type}`,style:{marginBottom:"8px"},children:Le.message}),Re&&r.jsx("div",{className:`status-msg ${Re.type}`,style:{marginBottom:"8px"},children:Re.message}),oe&&r.jsx("div",{className:`status-msg ${oe.type}`,style:{marginBottom:"8px"},children:oe.message}),r.jsx("div",{className:"master-search",children:r.jsx(Mt,{placeholder:"...",value:c,onChange:te=>u(te.target.value)})}),r.jsxs("div",{className:"ingredient-master-stats",children:[r.jsxs("span",{children:[": ",r.jsx("strong",{children:(a.length||0).toLocaleString()})," "]}),jt&&r.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",r.jsx("strong",{children:(yn.length||0).toLocaleString()})," "]}),r.jsxs("button",{type:"button",className:`ingredient-dup-toggle ${p?"active":""}`,onClick:()=>m(te=>!te),disabled:j!==null||(_t?.groups?.length||0)===0,title:j!==null?"":(_t?.groups?.length||0)===0?"":"",children:[": ",r.jsx("strong",{children:(_t?.groups?.length||0).toLocaleString()})," "]})]}),r.jsx("div",{className:"ingredient-category-tabs",children:Et.map(te=>r.jsxs("button",{type:"button",className:`ingredient-category-tab ${h===te.key?"active":""}`,onClick:()=>f(te.key),disabled:j!==null,title:j!==null?"":void 0,children:[te.label," (",(dt[te.key]??0).toLocaleString(),")"]},te.key))}),r.jsxs("div",{className:"ingredient-vendor-filter-row",children:[r.jsx("label",{htmlFor:"ingredient-vendor-filter",className:"ingredient-vendor-filter-label",children:""}),r.jsxs("select",{id:"ingredient-vendor-filter",value:y,onChange:te=>b(te.target.value),disabled:j!==null,className:"ingredient-vendor-select",title:j!==null?"":"",children:[r.jsxs("option",{value:Hl,children:[" (",(Ht?.total||0).toLocaleString(),")"]}),(Ht?.entries||[]).map(({key:te,count:ze})=>{const Ae=te===ka?"":te;return r.jsxs("option",{value:te,children:[Ae," (",Number(ze||0).toLocaleString(),")"]},te)})]}),r.jsx("button",{type:"button",className:`ingredient-vendor-order-toggle ${_?"active":""}`,onClick:()=>w(te=>!te),disabled:j!==null,title:j!==null?"":"",children:_?"":""})]}),_&&r.jsxs("div",{className:"ingredient-vendor-order-panel",children:[r.jsx("div",{className:"ingredient-vendor-order-title",children:""}),(Ht?.entries||[]).length===0?r.jsx("div",{className:"ingredient-vendor-order-empty",children:""}):r.jsx(ea,{sensors:gn,collisionDetection:cd,onDragEnd:hn,children:r.jsx(Ua,{items:(Ht?.entries||[]).map(te=>te.key),strategy:qo,children:r.jsx("ul",{className:"vendor-order-list",children:(Ht?.entries||[]).map(({key:te,count:ze})=>{const Ae=te===ka?"":te;return r.jsx(g2,{vendorKey:te,label:Ae,count:ze,active:y===te,disabled:j!==null,onSelect:b},te)})})})})]}),T?r.jsx("div",{className:"master-loading",children:"..."}):r.jsx("div",{className:"master-table-wrapper",children:r.jsxs("table",{className:"master-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"master-col-no",children:"No"}),r.jsx("th",{children:""}),r.jsx("th",{className:"master-col-category",children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:"CSV"}),r.jsx("th",{children:""}),r.jsx("th",{children:"%"}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:an.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#999"},children:p?"":jt?"":""})}):an.map((te,ze)=>{const Ae=te?.clientId??te?.ingredientName??String(ze),Qe=Ft(te?.ingredientName),ce=String(te?.vendor||"").trim(),se=te?.isEditing&&!!Qe&&Qe!==ce,xe=ce||Qe||"",Ne=ce?"vendor-tag--master":Qe?"vendor-tag--csv":"vendor-tag--empty",Ke=xe?ce&&Qe&&Qe!==ce?`: ${ce} / CSV: ${Qe}`:ce?"":"CSV":"",tt=Je(te?.itemCategory),Ze=tt==="food",Xe=Jt(te?.ingredientName),lt=!!Xe&&_t?.duplicateKeys?.has?.(Xe),Pt=Xe&&_t?.keyToNames?.get?.(Xe)||null,$t=lt&&Array.isArray(Pt)&&Pt.length>0?`: ${Pt.join(" / ")}`:"";return r.jsxs("tr",{className:[te.isEditing?"editing":"",lt?"duplicate":""].filter(Boolean).join(" "),children:[r.jsx("td",{className:"master-col-no",children:r.jsx("span",{className:"master-col-no__text",children:ze+1})}),r.jsx("td",{children:te.isEditing?r.jsxs("div",{className:"ingredient-name-cell",children:[r.jsx(Mt,{value:te.ingredientName,onChange:Ve=>qt(Ae,"ingredientName",Ve.target.value),placeholder:": ",disabled:!te.isNew,wrapperClassName:"input-group--no-margin"}),r.jsx(Mt,{value:te.vendor||"",onChange:Ve=>qt(Ae,"vendor",Ve.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),se&&r.jsx("div",{className:"ingredient-vendor-tags",children:r.jsxs("span",{className:"vendor-tag vendor-tag--csv",title:"CSV",children:[": ",Qe]})})]}):r.jsxs("div",{className:"ingredient-name-cell",children:[r.jsxs("div",{className:"ingredient-name-row",children:[r.jsx("span",{children:te.ingredientName}),lt&&r.jsx("span",{className:"ingredient-dup-badge",title:$t,children:""})]}),r.jsx("div",{className:"ingredient-vendor-tags",children:r.jsxs("span",{className:`vendor-tag ${Ne}`,title:Ke,children:[": ",xe||"-"]})})]})}),r.jsx("td",{className:"master-col-category",children:te.isEditing?r.jsxs("select",{value:tt,onChange:Ve=>qt(Ae,"itemCategory",Ve.target.value),className:"category-select",children:[r.jsx("option",{value:"food",children:"8%"}),r.jsx("option",{value:"soft_drink",children:"8%"}),r.jsx("option",{value:"alcohol",children:"10%"}),r.jsx("option",{value:"supplies",children:"10%"})]}):r.jsx("span",{title:"",children:We(te?.itemCategory)})}),r.jsx("td",{children:te.isEditing?r.jsx(Mt,{type:"number",value:te.lastPrice,onChange:Ve=>qt(Ae,"lastPrice",Ve.target.value),placeholder:": 500"}):`${parseFloat(te.lastPrice||0).toLocaleString()}`}),r.jsx("td",{children:te.isEditing?r.jsxs("div",{className:"input-with-hint",children:[r.jsx(Mt,{type:"number",value:te.packetSize,onChange:Ve=>qt(Ae,"packetSize",Ve.target.value),placeholder:["","","","PC","","",""].includes(te.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(te.packetUnit)&&r.jsxs("span",{className:"unit-hint",children:["1",te.packetUnit,"1"]})]}):te.packetSize}),r.jsx("td",{children:te.isEditing?r.jsxs("select",{value:te.packetUnit,onChange:Ve=>qt(Ae,"packetUnit",Ve.target.value),className:"unit-select",children:[r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]}):te.packetUnit}),r.jsx("td",{className:"csv-unit-cell",children:te.isEditing?r.jsx(Mt,{value:Dn(te.ingredientName),onChange:Ve=>{const ct=(te.ingredientName??"").toString().trim(),nn=Ve.target.value;P(Vn=>({...Vn,[ct]:nn}))},onBlur:Ve=>Cn(te.ingredientName,Ve.target.value),placeholder:Kt(te.ingredientName)==="-"?"":`CSV: ${Kt(te.ingredientName)}`}):r.jsx("span",{children:Vt(te.ingredientName)})}),r.jsx("td",{className:"normalized-cost",children:un(te)}),r.jsx("td",{children:Ze?te.isEditing?r.jsx(Mt,{type:"number",value:te.yieldPercent??"",onChange:Ve=>qt(Ae,"yieldPercent",Ve.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const Ve=parseFloat(te.yieldPercent);if(!Number.isFinite(Ve)||Ve<=0)return"-";const ct=Math.round(Ve*10)/10;return`${Number.isInteger(ct)?Math.round(ct):ct}%`})():r.jsx("span",{style:{color:"#999"},children:"-"})}),r.jsx("td",{children:r.jsx("div",{className:"action-buttons",children:te.isEditing?r.jsxs(r.Fragment,{children:[r.jsx(he,{variant:"primary",size:"sm",onClick:()=>sn(Ae),children:""}),r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>Lt(Ae),children:""})]}):r.jsxs(r.Fragment,{children:[r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>Un(Ae),disabled:j!==null,children:""}),r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>wt(Ae),disabled:j!==null,children:""})]})})})]},Ae)})})]})}),r.jsx("div",{className:"master-info",children:r.jsx("p",{children:" "})}),r.jsx(rn,{isOpen:V,onClose:Se,title:"",size:"medium",showCloseButton:!J,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),fe?r.jsxs(r.Fragment,{children:[(()=>{const te=H.find(Ae=>String(Ae?.id)===String(Q)),ze=te?`${te.display_id}${te.email?` (${te.email})`:""}`:Q?String(Q).slice(0,8):"-";return r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",r.jsx("strong",{children:ze}),r.jsx("br",{}),": ",r.jsx("strong",{children:A?"":""})]})]})})(),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>ne(!1),disabled:J,children:""}),r.jsx(he,{variant:"primary",onClick:nt,disabled:!Q||J,children:J?"...":""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),M?r.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):r.jsxs("select",{value:Q,onChange:te=>Z(te.target.value),disabled:J||!!B,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:J?"#f3f4f6":"white"},children:[r.jsx("option",{value:"",children:"..."}),H.filter(te=>String(te?.id)&&String(te?.id)!==String(e?.id)).map(te=>r.jsxs("option",{value:te.id,children:[te.display_id,te.email?` (${te.email})`:"",te.role==="admin"?" []":""]},te.id))]}),B&&r.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:B})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[r.jsx("input",{type:"checkbox",checked:A,onChange:te=>L(te.target.checked),disabled:J}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(he,{variant:"ghost",onClick:Se,disabled:J,children:""}),r.jsx(he,{variant:"primary",onClick:()=>ne(!0),disabled:!Q||J||M||!!B,children:""})]})]}),J&&r.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),ue?.message&&r.jsx("div",{className:`status-msg ${ue.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:ue.message})]})}),r.jsx($o,{isOpen:be,onClose:()=>{ie||(le(!1),E(null))},onConfirm:async()=>{await It(),le(!1)},title:"",description:r.jsxs("span",{children:["",r.jsxs("strong",{children:[a.length.toLocaleString(),""]}),"",r.jsx("br",{}),""]}),loading:ie}),r.jsx($o,{isOpen:ve,onClose:()=>{Y||(ge(!1),re(null))},onConfirm:async()=>{await zn(),ge(!1)},title:"",description:r.jsxs("span",{children:[r.jsx("strong",{style:{color:"#b91c1c"},children:"admin"}),"CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:Y}),r.jsx(fw,{isOpen:ee,onClose:()=>{me||(de(!1),Pe(null))},onConfirm:qn,title:"",description:r.jsxs("span",{children:["CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:me})]})},Gu="__all_vendors__",pw="__unknown_vendor__",Vl="__all_categories__",vp="food",rd=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],Fp=rd.reduce((n,e)=>(n[e.value]=e.label,n),{}),v2=new Set(["","","","","PC","","",""]),Na=n=>{if(n==null||n==="")return null;const e=String(n).replace(/,/g,"").trim();if(!e)return null;const s=Number(e);return Number.isFinite(s)?s:null},Ax=n=>(typeof n=="string"?n.trim():"")||pw,Co=n=>{const e=String(n||"").trim();return!e||e==="food_alcohol"?vp:Fp[e]?e:vp},x2=()=>{const[n,e]=k.useState([]),[s,a]=k.useState(!0),[l,c]=k.useState(null),[u,h]=k.useState(null),[f,p]=k.useState("all"),[m,y]=k.useState({key:null,direction:"asc"}),[b,v]=k.useState(""),[S,_]=k.useState(Vl),[w,j]=k.useState(Gu),[N,T]=k.useState(!1),[R,$]=k.useState(null),F=k.useRef(null),q=Ps(),[I,U]=k.useState({isOpen:!1,title:"",message:"",onConfirm:null}),P=()=>{h(ne=>!ne||ne.phase==="running"?ne:null)};k.useEffect(()=>{V()},[]);const V=async()=>{a(!0),$(null);try{console.log("Starting data load for CsvToMasterImporter...");const[ne,be]=await Promise.all([Pn.getPriceListArray().catch(ie=>(console.error("Error fetching price list:",ie),[])),On.getAllConversions().catch(ie=>(console.error("Error fetching conversions:",ie),new Map))]);if(console.log("Data fetched:",{csvCount:ne?.length,masterSize:be?.size}),!Array.isArray(ne))throw new Error("CSV");if(!(be instanceof Map))throw new Error("Map");const le=[];for(const ie of ne){if(!ie||!ie.name)continue;const Te=be.get(ie.name),Le=Co(Te?.itemCategory),E=Te?.packetSize??"",ve=Te?.packetUnit||ie.unit||"",ge=Te?.lastPrice??"",Y=Te?E:v2.has(ve)?1:"";le.push({name:ie.name,csvPrice:ie.price,csvUnit:ie.unit,csvVendor:ie.vendor,masterCategory:Le,masterSize:E,masterUnit:ve,masterPrice:ge,isRegistered:!!Te,inputSize:Y,inputUnit:ve,inputPrice:Te?ge:ie.price??"",inputCategory:Le,isModified:!1})}console.log("Merge completed. Items:",le.length),e(le)}catch(ne){console.error("Failed to load data for importer:",ne),$(ne.message||"")}finally{a(!1)}},D=async ne=>{c(ne.name);try{const be=Na(ne.inputSize),le=Na(ne.inputPrice);if(be===null||be<=0){q.error("");return}if(!ne.inputUnit){q.error("");return}if(!ne.inputCategory){q.error("");return}await On.saveConversion(ne.name,be,ne.inputUnit,le,ne.inputCategory),e(ie=>ie.map(Te=>Te.name===ne.name?{...Te,isRegistered:!0,isModified:!1,masterSize:be,masterUnit:ne.inputUnit,masterPrice:le??"",masterCategory:ne.inputCategory,inputCategory:ne.inputCategory}:Te)),q.success("")}catch(be){console.error("Failed to save ingredient:",be),q.error("")}finally{c(null)}},H=async ne=>{U(be=>({...be,isOpen:!1}));try{const be=ne.filter(Re=>{const Pe=Na(Re.inputSize);return!(Pe!==null&&Pe>0)||!Re.inputUnit||!Re.inputCategory});if(be.length>0){const Re=be.slice(0,5).map(Je=>Je.name).join(""),Pe=be.length>5?` ${be.length-5}`:"";q.error(`: ${Re}${Pe}`);return}c("bulk");const le=ne.length;h({phase:"running",total:le,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const ie=5,Te=120;let Le=0,E=0,ve=0,ge=0;const Y=[],W=[],oe=(Re=!1,Pe="")=>{const Je=Date.now();!Re&&Je-ge<Te||(ge=Je,h(We=>!We||We.phase!=="running"?We:{...We,processed:Le,success:E,failed:ve,currentName:Pe||We.currentName}))};let re=0;const ee=async()=>{for(;;){const Re=re++;if(Re>=ne.length)return;const Pe=ne[Re],Je=Pe?.name?String(Pe.name):"";try{const We=Na(Pe.inputSize),Et=Na(Pe.inputPrice);if(We===null||We<=0)throw new Error("Invalid size");if(!Pe.inputUnit)throw new Error("Invalid unit");if(!Pe.inputCategory)throw new Error("Invalid category");await On.saveConversion(Pe.name,We,Pe.inputUnit,Et,Pe.inputCategory),E++,Y.push(Pe)}catch(We){ve++,W.push(Je||`#${Re+1}`),console.error(`Failed to save ${Je}:`,We)}finally{Le++,oe(!1,Je)}}},de=Math.min(ie,ne.length);await Promise.all(Array.from({length:de},()=>ee())),oe(!0);const me=new Set(Y.map(Re=>Re.name)),Be=new Map(ne.map(Re=>[Re.name,Re]));e(Re=>Re.map(Pe=>{if(me.has(Pe.name)){const Je=Be.get(Pe.name);return{...Pe,isRegistered:!0,isModified:!1,masterSize:Na(Je.inputSize)??"",masterUnit:Je.inputUnit,masterPrice:Na(Je.inputPrice)??"",masterCategory:Je.inputCategory,inputCategory:Je.inputCategory}}return Pe})),ve===0?q.success(`${E} `):q.warning(`:  ${E}  /  ${ve} `),h({phase:"done",total:le,processed:Le,success:E,failed:ve,currentName:"",failedNames:W.slice(0,10)})}catch(be){console.error("Bulk save error:",be),q.error(""),h(le=>({phase:"error",total:le?.total??ne.length,processed:le?.processed??0,success:le?.success??0,failed:le?.failed??0,currentName:"",failedNames:le?.failedNames??[],errorMessage:be?.message?String(be.message):""}))}finally{c(null)}},C=()=>{const ne=n.filter(be=>be.isModified);ne.length!==0&&U({isOpen:!0,title:"",message:`${ne.length} `,onConfirm:()=>H(ne)})},M=(ne,be,le)=>{e(ie=>ie.map(Te=>Te.name===ne?{...Te,[be]:le,isModified:!0}:Te))},z=ne=>{(ne.key==="ArrowUp"||ne.key==="ArrowDown")&&ne.preventDefault()},B=ne=>{y(be=>be.key===ne?{key:ne,direction:be.direction==="asc"?"desc":"asc"}:{key:ne,direction:"asc"})},K=ne=>m.key!==ne?"":m.direction==="asc"?" ":" ",Q=k.useMemo(()=>{const ne=new Map;n.forEach(le=>{const ie=Ax(le.csvVendor),Te=ie===pw?"":ie,Le=ne.get(ie);Le?Le.count+=1:ne.set(ie,{key:ie,label:Te,count:1})});const be=Array.from(ne.values()).sort((le,ie)=>le.label.localeCompare(ie.label,"ja"));return[{key:Gu,label:"",count:n.length},...be]},[n]);k.useEffect(()=>{Q.some(be=>be.key===w)||j(Gu)},[Q,w]),k.useEffect(()=>{if(!N)return;const ne=le=>{F.current&&!F.current.contains(le.target)&&T(!1)},be=le=>{le.key==="Escape"&&T(!1)};return document.addEventListener("mousedown",ne),document.addEventListener("touchstart",ne),document.addEventListener("keydown",be),()=>{document.removeEventListener("mousedown",ne),document.removeEventListener("touchstart",ne),document.removeEventListener("keydown",be)}},[N]);const Z=k.useMemo(()=>w===Gu?n:n.filter(ne=>Ax(ne.csvVendor)===w),[n,w]),A=k.useMemo(()=>{const ne={[Vl]:Z.length};return rd.forEach(be=>{ne[be.value]=0}),Z.forEach(be=>{const le=Co(be.inputCategory);ne[le]=(ne[le]||0)+1}),ne},[Z]),L=k.useMemo(()=>S===Vl?Z:Z.filter(ne=>Co(ne.inputCategory)===S),[Z,S]),J=k.useMemo(()=>({all:L.length,unregistered:L.filter(ne=>!ne.isRegistered).length,registered:L.filter(ne=>ne.isRegistered).length}),[L]),ae=k.useMemo(()=>Q.find(ne=>ne.key===w)||Q[0],[Q,w]),ue=k.useMemo(()=>L.filter(ne=>!(f==="unregistered"&&ne.isRegistered||f==="registered"&&!ne.isRegistered||b&&!ne.name.includes(b))),[L,f,b]),Ce=k.useMemo(()=>{if(!m.key)return ue;const ne=ie=>String(ie??""),be=ie=>{const Te=parseFloat(ie);return Number.isFinite(Te)?Te:Number.NEGATIVE_INFINITY},le=[...ue];return le.sort((ie,Te)=>{let Le=0;switch(m.key){case"name":Le=ne(ie.name).localeCompare(ne(Te.name),"ja");break;case"csvPrice":Le=be(ie.csvPrice)-be(Te.csvPrice);break;case"inputCategory":{const E=Fp[Co(ie.inputCategory)]||"",ve=Fp[Co(Te.inputCategory)]||"";Le=E.localeCompare(ve,"ja");break}case"inputSize":Le=be(ie.inputSize)-be(Te.inputSize);break;case"inputUnit":Le=ne(ie.inputUnit).localeCompare(ne(Te.inputUnit),"ja");break;case"inputPrice":Le=be(ie.inputPrice)-be(Te.inputPrice);break;default:Le=0;break}return Le===0&&(Le=ne(ie.name).localeCompare(ne(Te.name),"ja")),m.direction==="asc"?Le:-Le}),le},[ue,m]),fe=n.filter(ne=>ne.isModified).length;return s?r.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):R?r.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[r.jsx("h3",{children:""}),r.jsx("p",{children:R}),r.jsx(he,{variant:"secondary",onClick:V,children:""})]}):r.jsxs("div",{className:"csv-importer",children:[r.jsxs("div",{className:"importer-header",children:[r.jsx(Mt,{placeholder:"...",value:b,onChange:ne=>v(ne.target.value),style:{maxWidth:"300px"}}),r.jsxs("div",{className:"filter-buttons",children:[r.jsxs(he,{variant:f==="all"?"primary":"secondary",onClick:()=>p("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",J.all,")"]}),r.jsxs(he,{variant:f==="unregistered"?"primary":"secondary",onClick:()=>p("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",J.unregistered,")"]}),r.jsxs(he,{variant:f==="registered"?"primary":"secondary",onClick:()=>p("registered"),size:"sm",children:[" (",J.registered,")"]})]}),r.jsxs("div",{className:"vendor-dropdown",ref:F,children:[r.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>T(ne=>!ne),"aria-haspopup":"listbox","aria-expanded":N,children:[r.jsxs("span",{children:[": ",ae?.label," (",ae?.count??0,")"]}),r.jsx("span",{className:`vendor-dropdown-chevron ${N?"open":""}`,children:""})]}),N&&r.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:Q.map(ne=>r.jsxs("button",{type:"button",className:`vendor-tab ${w===ne.key?"active":""}`,onClick:()=>{j(ne.key),T(!1)},role:"option","aria-selected":w===ne.key,children:[ne.label," (",ne.count,")"]},ne.key))})]}),r.jsxs("div",{className:"category-filter-row",children:[r.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),r.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:S,onChange:ne=>_(ne.target.value),children:[r.jsxs("option",{value:Vl,children:[" (",A[Vl]||0,")"]}),rd.map(ne=>r.jsxs("option",{value:ne.value,children:[ne.label," (",A[ne.value]||0,")"]},ne.value))]})]}),r.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[fe>0&&r.jsx(he,{variant:"primary",size:"sm",onClick:C,disabled:l!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:l==="bulk"?"...":`(${fe})`}),r.jsx(he,{variant:"secondary",size:"sm",onClick:V,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsxs("th",{style:{width:"22%"},onClick:()=>B("name"),children:[" (CSV)",K("name")]}),r.jsxs("th",{style:{width:"14%"},onClick:()=>B("csvPrice"),children:[" (CSV)",K("csvPrice")]}),r.jsxs("th",{style:{width:"14%"},onClick:()=>B("inputCategory"),children:[" ",r.jsx("span",{style:{color:"red"},children:"*"}),K("inputCategory")]}),r.jsxs("th",{style:{width:"18%"},onClick:()=>B("inputSize"),children:[" () ",r.jsx("span",{style:{color:"red"},children:"*"}),K("inputSize")]}),r.jsxs("th",{style:{width:"13%"},onClick:()=>B("inputUnit"),children:[" () ",r.jsx("span",{style:{color:"red"},children:"*"}),K("inputUnit")]}),r.jsxs("th",{style:{width:"12%"},onClick:()=>B("inputPrice"),children:[" ()",K("inputPrice")]}),r.jsx("th",{style:{width:"7%"},children:""})]})}),r.jsx("tbody",{children:Ce.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"no-data",children:""})}):Ce.map(ne=>r.jsxs("tr",{style:{backgroundColor:ne.isModified?"#fff8e1":ne.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[r.jsxs("td",{style:{fontWeight:"500"},children:[ne.name,ne.csvVendor&&r.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:ne.csvVendor})]}),r.jsxs("td",{children:[ne.csvPrice?`${ne.csvPrice.toLocaleString()} `:"-",ne.csvUnit&&r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",ne.csvUnit]})]}),r.jsx("td",{children:r.jsx("select",{className:"input-field",value:Co(ne.inputCategory),onChange:be=>M(ne.name,"inputCategory",be.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:rd.map(be=>r.jsx("option",{value:be.value,children:be.label},be.value))})}),r.jsx("td",{children:r.jsx(Mt,{type:"number",value:ne.inputSize,onChange:be=>M(ne.name,"inputSize",be.target.value),onKeyDown:z,placeholder:["","","","PC","","",""].includes(ne.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),r.jsx("td",{children:r.jsxs("select",{className:"input-field",value:ne.inputUnit,onChange:be=>M(ne.name,"inputUnit",be.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","cl","","","","","PC","","",""].includes(ne.inputUnit)&&ne.inputUnit&&r.jsxs("option",{value:ne.inputUnit,children:[ne.inputUnit," (CSV)"]}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"kg",children:"kg"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"L",children:"L"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"PC",children:"PC"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})}),r.jsx("td",{children:r.jsx(Mt,{type:"number",value:ne.inputPrice,onChange:be=>M(ne.name,"inputPrice",be.target.value),placeholder:"",style:{width:"100%"}})}),r.jsx("td",{children:r.jsx(he,{variant:ne.isRegistered?"secondary":"primary",size:"sm",onClick:()=>D(ne),disabled:l===ne.name||l==="bulk",block:!0,children:l===ne.name?"...":ne.isRegistered?"":""})})]},ne.name))})]})}),r.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[r.jsx("p",{children:" CSV"}),r.jsx("p",{children:" "})]}),r.jsxs(rn,{isOpen:I.isOpen,onClose:()=>U({...I,isOpen:!1}),title:I.title,size:"small",children:[r.jsx("div",{style:{marginBottom:"1.5rem"},children:I.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[r.jsx(he,{variant:"secondary",onClick:()=>U({...I,isOpen:!1}),children:""}),r.jsx(he,{variant:"primary",onClick:I.onConfirm,children:""})]})]}),r.jsx(rn,{isOpen:!!u,onClose:P,title:u?.phase==="running"?"":u?.phase==="error"?"":"",size:"small",showCloseButton:u?.phase!=="running",children:u?.phase==="running"?r.jsxs("div",{className:"bulk-progress",children:[r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:""}),r.jsxs("div",{className:"bulk-progress-subtitle",children:[(u.processed||0).toLocaleString()," / ",(u.total||0).toLocaleString()," "]})]})]}),r.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:r.jsx("div",{className:"bulk-progress-bar-inner",style:{width:u.total>0?`${Math.min(100,Math.round((u.processed||0)/u.total*100))}%`:"0%"}})}),r.jsxs("div",{className:"bulk-progress-meta",children:[r.jsxs("div",{children:[": ",(u.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u.failed||0).toLocaleString()," "]}),u.currentName&&r.jsxs("div",{className:"bulk-progress-current",title:u.currentName,children:[": ",u.currentName]})]})]}):u?.phase==="error"?r.jsxs("div",{className:"bulk-progress",children:[r.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),u.errorMessage&&r.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:u.errorMessage}),r.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[r.jsxs("div",{children:[": ",(u.processed||0).toLocaleString()," / ",(u.total||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u.failed||0).toLocaleString()," "]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:r.jsx(he,{variant:"primary",onClick:P,children:""})})]}):r.jsxs("div",{className:"bulk-progress",children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),r.jsxs("div",{className:"bulk-progress-meta",children:[r.jsxs("div",{children:[": ",(u?.total||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u?.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(u?.failed||0).toLocaleString()," "]})]}),Array.isArray(u?.failedNames)&&u.failedNames.length>0&&r.jsxs("div",{className:"bulk-progress-failures",children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),r.jsx("div",{style:{lineHeight:1.5},children:u.failedNames.join("")})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:r.jsx(he,{variant:"primary",onClick:P,children:""})})]})})]})},b2="app-data",ko={async listPriceCsvTrash(){const{data:{user:n}}=await Ee.auth.getUser();if(!n)throw new Error("Not authenticated");const{data:e,error:s}=await Ee.from("trash_price_csvs").select("id, file_name, deleted_at").eq("user_id",n.id).order("deleted_at",{ascending:!1});if(s)throw s;return e||[]},async permanentlyDeletePriceCsvTrash(n){if(!n||n.length===0)return;const{error:e}=await Ee.from("trash_price_csvs").delete().in("id",n);if(e)throw e},async restorePriceCsvFromTrash(n){if(!n||n.length===0)return;const{data:{user:e}}=await Ee.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:s,error:a}=await Ee.from("trash_price_csvs").select("*").in("id",n);if(a)throw a;const l=[];for(const c of s||[]){const u=`${e.id}/${c.file_name}`,h=new Blob([c.csv_content],{type:"text/csv"}),{error:f}=await Ee.storage.from(b2).upload(u,h,{upsert:!0,contentType:"text/csv"});if(f){l.push({file_name:c.file_name,error:f.message});continue}await Ee.from("trash_price_csvs").delete().eq("id",c.id),l.push({file_name:c.file_name,error:null})}return l},async listIngredientTrash(){const{data:{user:n}}=await Ee.auth.getUser();if(!n)throw new Error("Not authenticated");const{data:e,error:s}=await Ee.from("trash_ingredient_master").select("id, label, deleted_at, snapshot_unit_conversions").eq("user_id",n.id).order("deleted_at",{ascending:!1});if(s)throw s;return(e||[]).map(a=>({...a,item_count:Array.isArray(a.snapshot_unit_conversions)?a.snapshot_unit_conversions.length:0}))},async permanentlyDeleteIngredientTrash(n){if(!n||n.length===0)return;const{error:e}=await Ee.from("trash_ingredient_master").delete().in("id",n);if(e)throw e},async restoreIngredientFromTrash(n){const{data:{user:e}}=await Ee.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:s,error:a}=await Ee.from("trash_ingredient_master").select("*").eq("id",n).single();if(a)throw a;const l=Array.isArray(s.snapshot_unit_conversions)?s.snapshot_unit_conversions:[],c=Array.isArray(s.snapshot_csv_unit_overrides)?s.snapshot_csv_unit_overrides:[];if(l.length>0){const{error:u}=await Ee.from("unit_conversions").upsert(l.map(h=>({...h,user_id:e.id})),{onConflict:"user_id,ingredient_name"});if(u)throw u}if(c.length>0){const{error:u}=await Ee.from("csv_unit_overrides").upsert(c.map(h=>({...h,user_id:e.id})),{onConflict:"user_id,ingredient_name"});if(u)throw u}await Ee.from("trash_ingredient_master").delete().eq("id",n)}},w2=()=>{const[n,e]=k.useState([]),[s,a]=k.useState([]),[l,c]=k.useState(!0),[u,h]=k.useState(""),[f,p]=k.useState(new Set),[m,y]=k.useState(new Set),[b,v]=k.useState(null),[S,_]=k.useState(!1),[w,j]=k.useState(!1),[N,T]=k.useState(null),R=k.useCallback(async()=>{c(!0),h("");try{const[M,z]=await Promise.all([ko.listPriceCsvTrash(),ko.listIngredientTrash()]);e(M),a(z)}catch(M){console.error(M),h(": "+(M?.message||String(M)))}finally{c(!1)}},[]);k.useEffect(()=>{R()},[R]);const $=(M,z)=>{T({type:M,text:z}),setTimeout(()=>T(null),4e3)},F=M=>{p(z=>{const B=new Set(z);return B.has(M)?B.delete(M):B.add(M),B})},q=async()=>{const M=Array.from(f);if(M.length!==0){j(!0);try{const B=(await ko.restorePriceCsvFromTrash(M)||[]).filter(K=>K.error);$("success",`${M.length-B.length}${B.length>0?`${B.length}`:""}`),p(new Set),await R()}catch(z){$("error",": "+(z?.message||String(z)))}finally{j(!1)}}},I=async()=>{const M=b?.ids||[];_(!0);try{await ko.permanentlyDeletePriceCsvTrash(M),$("success",`${M.length}`),p(new Set),v(null),await R()}catch(z){$("error",": "+(z?.message||String(z)))}finally{_(!1)}},U=M=>{y(z=>{const B=new Set(z);return B.has(M)?B.delete(M):B.add(M),B})},P=async M=>{j(!0);try{await ko.restoreIngredientFromTrash(M),$("success",""),y(new Set),await R()}catch(z){$("error",": "+(z?.message||String(z)))}finally{j(!1)}},V=async()=>{const M=b?.ids||[];_(!0);try{await ko.permanentlyDeleteIngredientTrash(M),$("success",`${M.length}`),y(new Set),v(null),await R()}catch(z){$("error",": "+(z?.message||String(z)))}finally{_(!1)}},D=async()=>{b&&(b.type==="price"?await I():await V())},H=l||w||S,C=n.length===0&&s.length===0;return r.jsxs("div",{style:{padding:"1rem",maxWidth:"900px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{margin:0,color:"#fff",fontSize:"1.4rem"},children:" "}),r.jsx(he,{variant:"ghost",onClick:R,disabled:H,style:{fontSize:"0.85rem"},children:l?"...":" "})]}),u&&r.jsx("div",{className:"status-msg error",style:{marginBottom:"1rem"},children:u}),N&&r.jsx("div",{className:`status-msg ${N.type}`,style:{marginBottom:"1rem"},children:N.text}),!l&&C&&r.jsx("div",{style:{color:"rgba(255,255,255,0.6)",textAlign:"center",padding:"3rem",fontSize:"1rem"},children:""}),n.length>0&&r.jsxs("div",{style:{marginBottom:"2rem"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"10px",flexWrap:"wrap",gap:"8px"},children:[r.jsxs("h4",{style:{margin:0,color:"#fff",fontSize:"1rem"},children:[" CSV",n.length,""]}),r.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[r.jsxs(he,{variant:"secondary",onClick:q,disabled:f.size===0||H,children:["",f.size,""]}),r.jsx(he,{variant:"danger",onClick:()=>v({type:"price",ids:f.size>0?Array.from(f):n.map(M=>M.id)}),disabled:H,children:f.size>0?`${f.size}`:""})]})]}),r.jsx("div",{style:{background:"#fff",borderRadius:"8px",overflow:"hidden"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f8f9fa"},children:[r.jsx("th",{style:{width:36,padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #eee"},children:r.jsx("input",{type:"checkbox",checked:f.size===n.length,onChange:M=>p(M.target.checked?new Set(n.map(z=>z.id)):new Set)})}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111"},children:""}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111",whiteSpace:"nowrap"},children:""})]})}),r.jsx("tbody",{children:n.map(M=>r.jsxs("tr",{onClick:()=>F(M.id),style:{cursor:"pointer",background:f.has(M.id)?"#fef2f2":void 0},children:[r.jsx("td",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #f0f0f0"},children:r.jsx("input",{type:"checkbox",checked:f.has(M.id),onChange:()=>F(M.id),onClick:z=>z.stopPropagation()})}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#1f2937"},children:M.file_name}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#6b7280",whiteSpace:"nowrap",fontSize:"0.82rem"},children:new Date(M.deleted_at).toLocaleString("ja-JP")})]},M.id))})]})})]}),s.length>0&&r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"10px",flexWrap:"wrap",gap:"8px"},children:[r.jsxs("h4",{style:{margin:0,color:"#fff",fontSize:"1rem"},children:[" ",s.length,""]}),r.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:r.jsx(he,{variant:"danger",onClick:()=>v({type:"ingredient",ids:m.size>0?Array.from(m):s.map(M=>M.id)}),disabled:H,children:m.size>0?`${m.size}`:""})})]}),r.jsx("div",{style:{background:"#fff",borderRadius:"8px",overflow:"hidden"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.9rem"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f8f9fa"},children:[r.jsx("th",{style:{width:36,padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #eee"},children:r.jsx("input",{type:"checkbox",checked:m.size===s.length,onChange:M=>y(M.target.checked?new Set(s.map(z=>z.id)):new Set)})}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111"},children:""}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111"},children:""}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #eee",color:"#111",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #eee",color:"#111"},children:""})]})}),r.jsx("tbody",{children:s.map(M=>r.jsxs("tr",{style:{background:m.has(M.id)?"#fef2f2":void 0},children:[r.jsx("td",{style:{padding:"10px 12px",textAlign:"center",borderBottom:"1px solid #f0f0f0"},children:r.jsx("input",{type:"checkbox",checked:m.has(M.id),onChange:()=>U(M.id)})}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#1f2937"},children:M.label}),r.jsxs("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#374151"},children:[(M.item_count||0).toLocaleString(),""]}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",color:"#6b7280",whiteSpace:"nowrap",fontSize:"0.82rem"},children:new Date(M.deleted_at).toLocaleString("ja-JP")}),r.jsx("td",{style:{padding:"10px 12px",borderBottom:"1px solid #f0f0f0",textAlign:"center"},children:r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>P(M.id),disabled:H,children:""})})]},M.id))})]})})]}),r.jsx($o,{isOpen:!!b,onClose:()=>v(null),onConfirm:D,title:"",description:r.jsxs("span",{children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:S})]})},_2=({isOpen:n,onClose:e,onConfirm:s,loading:a,progressStatus:l,copyResult:c})=>{if(!n)return null;const u=()=>{if(!l)return null;const{phase:p,message:m,totalUser:y,doneUser:b,totalFile:v,doneFile:S}=l;return r.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0"},children:[r.jsx("div",{style:{marginBottom:"10px",fontWeight:"bold",color:"#334155"},children:m||"..."}),y>0&&r.jsxs("div",{style:{marginBottom:"15px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.85rem",marginBottom:"4px",color:"#64748b"},children:[r.jsxs("span",{children:[" (",b," / ",y," )"]}),r.jsxs("span",{children:[Math.round(b/y*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"#e2e8f0",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${b/y*100}%`,height:"100%",backgroundColor:"#3b82f6",transition:"width 0.3s ease"}})})]}),p==="progress_file"&&v>0&&r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.8rem",marginBottom:"4px",color:"#64748b"},children:[r.jsxs("span",{children:[" (",S," / ",v,")"]}),r.jsxs("span",{children:[Math.round(S/v*100),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"6px",backgroundColor:"#e2e8f0",borderRadius:"3px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${S/v*100}%`,height:"100%",backgroundColor:"#10b981",transition:"width 0.2s ease"}})})]})]})},h=()=>c?r.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#ecfdf5",borderRadius:"8px",border:"1px solid #a7f3d0"},children:[r.jsx("div",{style:{fontWeight:"bold",color:"#065f46",marginBottom:"10px"},children:" "}),r.jsxs("ul",{style:{margin:0,paddingLeft:"20px",fontSize:"0.9rem",color:"#047857"},children:[r.jsxs("li",{children:[": ",c.totalTargetUsers," "]}),r.jsxs("li",{children:[": ",c.csvResults.filter(p=>!p.error).length," / ",c.csvResults.filter(p=>p.error).length,""]}),r.jsx("li",{children:": "})]})]}):null,f=c!==null||l&&l.phase==="done";return r.jsx(rn,{isOpen:n,onClose:()=>{a||e()},title:"",maxWidth:"550px",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[!l&&!c&&r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsxs("p",{style:{margin:"0 0 10px",fontSize:"0.95rem",lineHeight:1.6,color:"#334155"},children:["",r.jsx("strong",{children:"CSV"}),"",r.jsx("strong",{children:""}),"",r.jsx("br",{}),r.jsx("strong",{children:""}),""]}),r.jsxs("div",{style:{backgroundColor:"#fff8f1",padding:"12px",borderRadius:"8px",border:"1px solid #fed7aa",fontSize:"0.85rem",color:"#c2410c"},children:[" ",r.jsx("strong",{children:""}),r.jsxs("ul",{style:{margin:"8px 0 0",paddingLeft:"20px",lineHeight:1.5},children:[r.jsx("li",{children:""}),r.jsxs("li",{children:[" ",r.jsx("code",{children:"_copy"})," "]}),r.jsx("li",{children:""})]})]})]}),u(),h(),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"24px"},children:[!a&&!f&&r.jsxs(r.Fragment,{children:[r.jsx(he,{variant:"ghost",onClick:e,children:""}),r.jsx(he,{variant:"primary",onClick:s,children:" "})]}),f&&r.jsx(he,{variant:"primary",onClick:e,children:""})]})]})})};function Wu(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xp={exports:{}};var Tx;function S2(){return Tx||(Tx=1,(function(n,e){(function(s){n.exports=s()})(function(){return(function s(a,l,c){function u(p,m){if(!l[p]){if(!a[p]){var y=typeof Wu=="function"&&Wu;if(!m&&y)return y(p,!0);if(h)return h(p,!0);var b=new Error("Cannot find module '"+p+"'");throw b.code="MODULE_NOT_FOUND",b}var v=l[p]={exports:{}};a[p][0].call(v.exports,function(S){var _=a[p][1][S];return u(_||S)},v,v.exports,s,a,l,c)}return l[p].exports}for(var h=typeof Wu=="function"&&Wu,f=0;f<c.length;f++)u(c[f]);return u})({1:[function(s,a,l){var c=s("./utils"),u=s("./support"),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";l.encode=function(f){for(var p,m,y,b,v,S,_,w=[],j=0,N=f.length,T=N,R=c.getTypeOf(f)!=="string";j<f.length;)T=N-j,y=R?(p=f[j++],m=j<N?f[j++]:0,j<N?f[j++]:0):(p=f.charCodeAt(j++),m=j<N?f.charCodeAt(j++):0,j<N?f.charCodeAt(j++):0),b=p>>2,v=(3&p)<<4|m>>4,S=1<T?(15&m)<<2|y>>6:64,_=2<T?63&y:64,w.push(h.charAt(b)+h.charAt(v)+h.charAt(S)+h.charAt(_));return w.join("")},l.decode=function(f){var p,m,y,b,v,S,_=0,w=0,j="data:";if(f.substr(0,j.length)===j)throw new Error("Invalid base64 input, it looks like a data url.");var N,T=3*(f=f.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(f.charAt(f.length-1)===h.charAt(64)&&T--,f.charAt(f.length-2)===h.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(N=u.uint8array?new Uint8Array(0|T):new Array(0|T);_<f.length;)p=h.indexOf(f.charAt(_++))<<2|(b=h.indexOf(f.charAt(_++)))>>4,m=(15&b)<<4|(v=h.indexOf(f.charAt(_++)))>>2,y=(3&v)<<6|(S=h.indexOf(f.charAt(_++))),N[w++]=p,v!==64&&(N[w++]=m),S!==64&&(N[w++]=y);return N}},{"./support":30,"./utils":32}],2:[function(s,a,l){var c=s("./external"),u=s("./stream/DataWorker"),h=s("./stream/Crc32Probe"),f=s("./stream/DataLengthProbe");function p(m,y,b,v,S){this.compressedSize=m,this.uncompressedSize=y,this.crc32=b,this.compression=v,this.compressedContent=S}p.prototype={getContentWorker:function(){var m=new u(c.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new f("data_length")),y=this;return m.on("end",function(){if(this.streamInfo.data_length!==y.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),m},getCompressedWorker:function(){return new u(c.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},p.createWorkerFrom=function(m,y,b){return m.pipe(new h).pipe(new f("uncompressedSize")).pipe(y.compressWorker(b)).pipe(new f("compressedSize")).withStreamInfo("compression",y)},a.exports=p},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(s,a,l){var c=s("./stream/GenericWorker");l.STORE={magic:"\0\0",compressWorker:function(){return new c("STORE compression")},uncompressWorker:function(){return new c("STORE decompression")}},l.DEFLATE=s("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(s,a,l){var c=s("./utils"),u=(function(){for(var h,f=[],p=0;p<256;p++){h=p;for(var m=0;m<8;m++)h=1&h?3988292384^h>>>1:h>>>1;f[p]=h}return f})();a.exports=function(h,f){return h!==void 0&&h.length?c.getTypeOf(h)!=="string"?(function(p,m,y,b){var v=u,S=b+y;p^=-1;for(var _=b;_<S;_++)p=p>>>8^v[255&(p^m[_])];return-1^p})(0|f,h,h.length,0):(function(p,m,y,b){var v=u,S=b+y;p^=-1;for(var _=b;_<S;_++)p=p>>>8^v[255&(p^m.charCodeAt(_))];return-1^p})(0|f,h,h.length,0):0}},{"./utils":32}],5:[function(s,a,l){l.base64=!1,l.binary=!1,l.dir=!1,l.createFolders=!0,l.date=null,l.compression=null,l.compressionOptions=null,l.comment=null,l.unixPermissions=null,l.dosPermissions=null},{}],6:[function(s,a,l){var c=null;c=typeof Promise<"u"?Promise:s("lie"),a.exports={Promise:c}},{lie:37}],7:[function(s,a,l){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",u=s("pako"),h=s("./utils"),f=s("./stream/GenericWorker"),p=c?"uint8array":"array";function m(y,b){f.call(this,"FlateWorker/"+y),this._pako=null,this._pakoAction=y,this._pakoOptions=b,this.meta={}}l.magic="\b\0",h.inherits(m,f),m.prototype.processChunk=function(y){this.meta=y.meta,this._pako===null&&this._createPako(),this._pako.push(h.transformTo(p,y.data),!1)},m.prototype.flush=function(){f.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},m.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this._pako=null},m.prototype._createPako=function(){this._pako=new u[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var y=this;this._pako.onData=function(b){y.push({data:b,meta:y.meta})}},l.compressWorker=function(y){return new m("Deflate",y)},l.uncompressWorker=function(){return new m("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(s,a,l){function c(v,S){var _,w="";for(_=0;_<S;_++)w+=String.fromCharCode(255&v),v>>>=8;return w}function u(v,S,_,w,j,N){var T,R,$=v.file,F=v.compression,q=N!==p.utf8encode,I=h.transformTo("string",N($.name)),U=h.transformTo("string",p.utf8encode($.name)),P=$.comment,V=h.transformTo("string",N(P)),D=h.transformTo("string",p.utf8encode(P)),H=U.length!==$.name.length,C=D.length!==P.length,M="",z="",B="",K=$.dir,Q=$.date,Z={crc32:0,compressedSize:0,uncompressedSize:0};S&&!_||(Z.crc32=v.crc32,Z.compressedSize=v.compressedSize,Z.uncompressedSize=v.uncompressedSize);var A=0;S&&(A|=8),q||!H&&!C||(A|=2048);var L=0,J=0;K&&(L|=16),j==="UNIX"?(J=798,L|=(function(ue,Ce){var fe=ue;return ue||(fe=Ce?16893:33204),(65535&fe)<<16})($.unixPermissions,K)):(J=20,L|=(function(ue){return 63&(ue||0)})($.dosPermissions)),T=Q.getUTCHours(),T<<=6,T|=Q.getUTCMinutes(),T<<=5,T|=Q.getUTCSeconds()/2,R=Q.getUTCFullYear()-1980,R<<=4,R|=Q.getUTCMonth()+1,R<<=5,R|=Q.getUTCDate(),H&&(z=c(1,1)+c(m(I),4)+U,M+="up"+c(z.length,2)+z),C&&(B=c(1,1)+c(m(V),4)+D,M+="uc"+c(B.length,2)+B);var ae="";return ae+=`
\0`,ae+=c(A,2),ae+=F.magic,ae+=c(T,2),ae+=c(R,2),ae+=c(Z.crc32,4),ae+=c(Z.compressedSize,4),ae+=c(Z.uncompressedSize,4),ae+=c(I.length,2),ae+=c(M.length,2),{fileRecord:y.LOCAL_FILE_HEADER+ae+I+M,dirRecord:y.CENTRAL_FILE_HEADER+c(J,2)+ae+c(V.length,2)+"\0\0\0\0"+c(L,4)+c(w,4)+I+M+V}}var h=s("../utils"),f=s("../stream/GenericWorker"),p=s("../utf8"),m=s("../crc32"),y=s("../signature");function b(v,S,_,w){f.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=S,this.zipPlatform=_,this.encodeFileName=w,this.streamFiles=v,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}h.inherits(b,f),b.prototype.push=function(v){var S=v.meta.percent||0,_=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(v):(this.bytesWritten+=v.data.length,f.prototype.push.call(this,{data:v.data,meta:{currentFile:this.currentFile,percent:_?(S+100*(_-w-1))/_:100}}))},b.prototype.openedSource=function(v){this.currentSourceOffset=this.bytesWritten,this.currentFile=v.file.name;var S=this.streamFiles&&!v.file.dir;if(S){var _=u(v,S,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(v){this.accumulate=!1;var S=this.streamFiles&&!v.file.dir,_=u(v,S,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),S)this.push({data:(function(w){return y.DATA_DESCRIPTOR+c(w.crc32,4)+c(w.compressedSize,4)+c(w.uncompressedSize,4)})(v),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var v=this.bytesWritten,S=0;S<this.dirRecords.length;S++)this.push({data:this.dirRecords[S],meta:{percent:100}});var _=this.bytesWritten-v,w=(function(j,N,T,R,$){var F=h.transformTo("string",$(R));return y.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(j,2)+c(j,2)+c(N,4)+c(T,4)+c(F.length,2)+F})(this.dirRecords.length,_,v,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(v){this._sources.push(v);var S=this;return v.on("data",function(_){S.processChunk(_)}),v.on("end",function(){S.closedSource(S.previous.streamInfo),S._sources.length?S.prepareNextSource():S.end()}),v.on("error",function(_){S.error(_)}),this},b.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(v){var S=this._sources;if(!f.prototype.error.call(this,v))return!1;for(var _=0;_<S.length;_++)try{S[_].error(v)}catch{}return!0},b.prototype.lock=function(){f.prototype.lock.call(this);for(var v=this._sources,S=0;S<v.length;S++)v[S].lock()},a.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(s,a,l){var c=s("../compressions"),u=s("./ZipFileWorker");l.generateWorker=function(h,f,p){var m=new u(f.streamFiles,p,f.platform,f.encodeFileName),y=0;try{h.forEach(function(b,v){y++;var S=(function(N,T){var R=N||T,$=c[R];if(!$)throw new Error(R+" is not a valid compression method !");return $})(v.options.compression,f.compression),_=v.options.compressionOptions||f.compressionOptions||{},w=v.dir,j=v.date;v._compressWorker(S,_).withStreamInfo("file",{name:b,dir:w,date:j,comment:v.comment||"",unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions}).pipe(m)}),m.entriesCount=y}catch(b){m.error(b)}return m}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(s,a,l){function c(){if(!(this instanceof c))return new c;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var u=new c;for(var h in this)typeof this[h]!="function"&&(u[h]=this[h]);return u}}(c.prototype=s("./object")).loadAsync=s("./load"),c.support=s("./support"),c.defaults=s("./defaults"),c.version="3.10.1",c.loadAsync=function(u,h){return new c().loadAsync(u,h)},c.external=s("./external"),a.exports=c},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(s,a,l){var c=s("./utils"),u=s("./external"),h=s("./utf8"),f=s("./zipEntries"),p=s("./stream/Crc32Probe"),m=s("./nodejsUtils");function y(b){return new u.Promise(function(v,S){var _=b.decompressed.getContentWorker().pipe(new p);_.on("error",function(w){S(w)}).on("end",function(){_.streamInfo.crc32!==b.decompressed.crc32?S(new Error("Corrupted zip : CRC32 mismatch")):v()}).resume()})}a.exports=function(b,v){var S=this;return v=c.extend(v||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:h.utf8decode}),m.isNode&&m.isStream(b)?u.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):c.prepareContent("the loaded zip file",b,!0,v.optimizedBinaryString,v.base64).then(function(_){var w=new f(v);return w.load(_),w}).then(function(_){var w=[u.Promise.resolve(_)],j=_.files;if(v.checkCRC32)for(var N=0;N<j.length;N++)w.push(y(j[N]));return u.Promise.all(w)}).then(function(_){for(var w=_.shift(),j=w.files,N=0;N<j.length;N++){var T=j[N],R=T.fileNameStr,$=c.resolve(T.fileNameStr);S.file($,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:v.createFolders}),T.dir||(S.file($).unsafeOriginalName=R)}return w.zipComment.length&&(S.comment=w.zipComment),S})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(s,a,l){var c=s("../utils"),u=s("../stream/GenericWorker");function h(f,p){u.call(this,"Nodejs stream input adapter for "+f),this._upstreamEnded=!1,this._bindStream(p)}c.inherits(h,u),h.prototype._bindStream=function(f){var p=this;(this._stream=f).pause(),f.on("data",function(m){p.push({data:m,meta:{percent:0}})}).on("error",function(m){p.isPaused?this.generatedError=m:p.error(m)}).on("end",function(){p.isPaused?p._upstreamEnded=!0:p.end()})},h.prototype.pause=function(){return!!u.prototype.pause.call(this)&&(this._stream.pause(),!0)},h.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},a.exports=h},{"../stream/GenericWorker":28,"../utils":32}],13:[function(s,a,l){var c=s("readable-stream").Readable;function u(h,f,p){c.call(this,f),this._helper=h;var m=this;h.on("data",function(y,b){m.push(y)||m._helper.pause(),p&&p(b)}).on("error",function(y){m.emit("error",y)}).on("end",function(){m.push(null)})}s("../utils").inherits(u,c),u.prototype._read=function(){this._helper.resume()},a.exports=u},{"../utils":32,"readable-stream":16}],14:[function(s,a,l){a.exports={isNode:typeof Buffer<"u",newBufferFrom:function(c,u){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(c,u);if(typeof c=="number")throw new Error('The "data" argument must not be a number');return new Buffer(c,u)},allocBuffer:function(c){if(Buffer.alloc)return Buffer.alloc(c);var u=new Buffer(c);return u.fill(0),u},isBuffer:function(c){return Buffer.isBuffer(c)},isStream:function(c){return c&&typeof c.on=="function"&&typeof c.pause=="function"&&typeof c.resume=="function"}}},{}],15:[function(s,a,l){function c($,F,q){var I,U=h.getTypeOf(F),P=h.extend(q||{},m);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&($=j($)),P.createFolders&&(I=w($))&&N.call(this,I,!0);var V=U==="string"&&P.binary===!1&&P.base64===!1;q&&q.binary!==void 0||(P.binary=!V),(F instanceof y&&F.uncompressedSize===0||P.dir||!F||F.length===0)&&(P.base64=!1,P.binary=!0,F="",P.compression="STORE",U="string");var D=null;D=F instanceof y||F instanceof f?F:S.isNode&&S.isStream(F)?new _($,F):h.prepareContent($,F,P.binary,P.optimizedBinaryString,P.base64);var H=new b($,D,P);this.files[$]=H}var u=s("./utf8"),h=s("./utils"),f=s("./stream/GenericWorker"),p=s("./stream/StreamHelper"),m=s("./defaults"),y=s("./compressedObject"),b=s("./zipObject"),v=s("./generate"),S=s("./nodejsUtils"),_=s("./nodejs/NodejsStreamInputAdapter"),w=function($){$.slice(-1)==="/"&&($=$.substring(0,$.length-1));var F=$.lastIndexOf("/");return 0<F?$.substring(0,F):""},j=function($){return $.slice(-1)!=="/"&&($+="/"),$},N=function($,F){return F=F!==void 0?F:m.createFolders,$=j($),this.files[$]||c.call(this,$,null,{dir:!0,createFolders:F}),this.files[$]};function T($){return Object.prototype.toString.call($)==="[object RegExp]"}var R={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function($){var F,q,I;for(F in this.files)I=this.files[F],(q=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&$(q,I)},filter:function($){var F=[];return this.forEach(function(q,I){$(q,I)&&F.push(I)}),F},file:function($,F,q){if(arguments.length!==1)return $=this.root+$,c.call(this,$,F,q),this;if(T($)){var I=$;return this.filter(function(P,V){return!V.dir&&I.test(P)})}var U=this.files[this.root+$];return U&&!U.dir?U:null},folder:function($){if(!$)return this;if(T($))return this.filter(function(U,P){return P.dir&&$.test(U)});var F=this.root+$,q=N.call(this,F),I=this.clone();return I.root=q.name,I},remove:function($){$=this.root+$;var F=this.files[$];if(F||($.slice(-1)!=="/"&&($+="/"),F=this.files[$]),F&&!F.dir)delete this.files[$];else for(var q=this.filter(function(U,P){return P.name.slice(0,$.length)===$}),I=0;I<q.length;I++)delete this.files[q[I].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function($){var F,q={};try{if((q=h.extend($||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:u.utf8encode})).type=q.type.toLowerCase(),q.compression=q.compression.toUpperCase(),q.type==="binarystring"&&(q.type="string"),!q.type)throw new Error("No output type specified.");h.checkSupport(q.type),q.platform!=="darwin"&&q.platform!=="freebsd"&&q.platform!=="linux"&&q.platform!=="sunos"||(q.platform="UNIX"),q.platform==="win32"&&(q.platform="DOS");var I=q.comment||this.comment||"";F=v.generateWorker(this,q,I)}catch(U){(F=new f("error")).error(U)}return new p(F,q.type||"string",q.mimeType)},generateAsync:function($,F){return this.generateInternalStream($).accumulate(F)},generateNodeStream:function($,F){return($=$||{}).type||($.type="nodebuffer"),this.generateInternalStream($).toNodejsStream(F)}};a.exports=R},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(s,a,l){a.exports=s("stream")},{stream:void 0}],17:[function(s,a,l){var c=s("./DataReader");function u(h){c.call(this,h);for(var f=0;f<this.data.length;f++)h[f]=255&h[f]}s("../utils").inherits(u,c),u.prototype.byteAt=function(h){return this.data[this.zero+h]},u.prototype.lastIndexOfSignature=function(h){for(var f=h.charCodeAt(0),p=h.charCodeAt(1),m=h.charCodeAt(2),y=h.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===f&&this.data[b+1]===p&&this.data[b+2]===m&&this.data[b+3]===y)return b-this.zero;return-1},u.prototype.readAndCheckSignature=function(h){var f=h.charCodeAt(0),p=h.charCodeAt(1),m=h.charCodeAt(2),y=h.charCodeAt(3),b=this.readData(4);return f===b[0]&&p===b[1]&&m===b[2]&&y===b[3]},u.prototype.readData=function(h){if(this.checkOffset(h),h===0)return[];var f=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,f},a.exports=u},{"../utils":32,"./DataReader":18}],18:[function(s,a,l){var c=s("../utils");function u(h){this.data=h,this.length=h.length,this.index=0,this.zero=0}u.prototype={checkOffset:function(h){this.checkIndex(this.index+h)},checkIndex:function(h){if(this.length<this.zero+h||h<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+h+"). Corrupted zip ?")},setIndex:function(h){this.checkIndex(h),this.index=h},skip:function(h){this.setIndex(this.index+h)},byteAt:function(){},readInt:function(h){var f,p=0;for(this.checkOffset(h),f=this.index+h-1;f>=this.index;f--)p=(p<<8)+this.byteAt(f);return this.index+=h,p},readString:function(h){return c.transformTo("string",this.readData(h))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var h=this.readInt(4);return new Date(Date.UTC(1980+(h>>25&127),(h>>21&15)-1,h>>16&31,h>>11&31,h>>5&63,(31&h)<<1))}},a.exports=u},{"../utils":32}],19:[function(s,a,l){var c=s("./Uint8ArrayReader");function u(h){c.call(this,h)}s("../utils").inherits(u,c),u.prototype.readData=function(h){this.checkOffset(h);var f=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,f},a.exports=u},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(s,a,l){var c=s("./DataReader");function u(h){c.call(this,h)}s("../utils").inherits(u,c),u.prototype.byteAt=function(h){return this.data.charCodeAt(this.zero+h)},u.prototype.lastIndexOfSignature=function(h){return this.data.lastIndexOf(h)-this.zero},u.prototype.readAndCheckSignature=function(h){return h===this.readData(4)},u.prototype.readData=function(h){this.checkOffset(h);var f=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,f},a.exports=u},{"../utils":32,"./DataReader":18}],21:[function(s,a,l){var c=s("./ArrayReader");function u(h){c.call(this,h)}s("../utils").inherits(u,c),u.prototype.readData=function(h){if(this.checkOffset(h),h===0)return new Uint8Array(0);var f=this.data.subarray(this.zero+this.index,this.zero+this.index+h);return this.index+=h,f},a.exports=u},{"../utils":32,"./ArrayReader":17}],22:[function(s,a,l){var c=s("../utils"),u=s("../support"),h=s("./ArrayReader"),f=s("./StringReader"),p=s("./NodeBufferReader"),m=s("./Uint8ArrayReader");a.exports=function(y){var b=c.getTypeOf(y);return c.checkSupport(b),b!=="string"||u.uint8array?b==="nodebuffer"?new p(y):u.uint8array?new m(c.transformTo("uint8array",y)):new h(c.transformTo("array",y)):new f(y)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(s,a,l){l.LOCAL_FILE_HEADER="PK",l.CENTRAL_FILE_HEADER="PK",l.CENTRAL_DIRECTORY_END="PK",l.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",l.ZIP64_CENTRAL_DIRECTORY_END="PK",l.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(s,a,l){var c=s("./GenericWorker"),u=s("../utils");function h(f){c.call(this,"ConvertWorker to "+f),this.destType=f}u.inherits(h,c),h.prototype.processChunk=function(f){this.push({data:u.transformTo(this.destType,f.data),meta:f.meta})},a.exports=h},{"../utils":32,"./GenericWorker":28}],25:[function(s,a,l){var c=s("./GenericWorker"),u=s("../crc32");function h(){c.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}s("../utils").inherits(h,c),h.prototype.processChunk=function(f){this.streamInfo.crc32=u(f.data,this.streamInfo.crc32||0),this.push(f)},a.exports=h},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(s,a,l){var c=s("../utils"),u=s("./GenericWorker");function h(f){u.call(this,"DataLengthProbe for "+f),this.propName=f,this.withStreamInfo(f,0)}c.inherits(h,u),h.prototype.processChunk=function(f){if(f){var p=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=p+f.data.length}u.prototype.processChunk.call(this,f)},a.exports=h},{"../utils":32,"./GenericWorker":28}],27:[function(s,a,l){var c=s("../utils"),u=s("./GenericWorker");function h(f){u.call(this,"DataWorker");var p=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,f.then(function(m){p.dataIsReady=!0,p.data=m,p.max=m&&m.length||0,p.type=c.getTypeOf(m),p.isPaused||p._tickAndRepeat()},function(m){p.error(m)})}c.inherits(h,u),h.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this.data=null},h.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,c.delay(this._tickAndRepeat,[],this)),!0)},h.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(c.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},h.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var f=null,p=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":f=this.data.substring(this.index,p);break;case"uint8array":f=this.data.subarray(this.index,p);break;case"array":case"nodebuffer":f=this.data.slice(this.index,p)}return this.index=p,this.push({data:f,meta:{percent:this.max?this.index/this.max*100:0}})},a.exports=h},{"../utils":32,"./GenericWorker":28}],28:[function(s,a,l){function c(u){this.name=u||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}c.prototype={push:function(u){this.emit("data",u)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(u){this.emit("error",u)}return!0},error:function(u){return!this.isFinished&&(this.isPaused?this.generatedError=u:(this.isFinished=!0,this.emit("error",u),this.previous&&this.previous.error(u),this.cleanUp()),!0)},on:function(u,h){return this._listeners[u].push(h),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(u,h){if(this._listeners[u])for(var f=0;f<this._listeners[u].length;f++)this._listeners[u][f].call(this,h)},pipe:function(u){return u.registerPrevious(this)},registerPrevious:function(u){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=u.streamInfo,this.mergeStreamInfo(),this.previous=u;var h=this;return u.on("data",function(f){h.processChunk(f)}),u.on("end",function(){h.end()}),u.on("error",function(f){h.error(f)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var u=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),u=!0),this.previous&&this.previous.resume(),!u},flush:function(){},processChunk:function(u){this.push(u)},withStreamInfo:function(u,h){return this.extraStreamInfo[u]=h,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var u in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,u)&&(this.streamInfo[u]=this.extraStreamInfo[u])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var u="Worker "+this.name;return this.previous?this.previous+" -> "+u:u}},a.exports=c},{}],29:[function(s,a,l){var c=s("../utils"),u=s("./ConvertWorker"),h=s("./GenericWorker"),f=s("../base64"),p=s("../support"),m=s("../external"),y=null;if(p.nodestream)try{y=s("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(S,_){return new m.Promise(function(w,j){var N=[],T=S._internalType,R=S._outputType,$=S._mimeType;S.on("data",function(F,q){N.push(F),_&&_(q)}).on("error",function(F){N=[],j(F)}).on("end",function(){try{var F=(function(q,I,U){switch(q){case"blob":return c.newBlob(c.transformTo("arraybuffer",I),U);case"base64":return f.encode(I);default:return c.transformTo(q,I)}})(R,(function(q,I){var U,P=0,V=null,D=0;for(U=0;U<I.length;U++)D+=I[U].length;switch(q){case"string":return I.join("");case"array":return Array.prototype.concat.apply([],I);case"uint8array":for(V=new Uint8Array(D),U=0;U<I.length;U++)V.set(I[U],P),P+=I[U].length;return V;case"nodebuffer":return Buffer.concat(I);default:throw new Error("concat : unsupported type '"+q+"'")}})(T,N),$);w(F)}catch(q){j(q)}N=[]}).resume()})}function v(S,_,w){var j=_;switch(_){case"blob":case"arraybuffer":j="uint8array";break;case"base64":j="string"}try{this._internalType=j,this._outputType=_,this._mimeType=w,c.checkSupport(j),this._worker=S.pipe(new u(j)),S.lock()}catch(N){this._worker=new h("error"),this._worker.error(N)}}v.prototype={accumulate:function(S){return b(this,S)},on:function(S,_){var w=this;return S==="data"?this._worker.on(S,function(j){_.call(w,j.data,j.meta)}):this._worker.on(S,function(){c.delay(_,arguments,w)}),this},resume:function(){return c.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(S){if(c.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new y(this,{objectMode:this._outputType!=="nodebuffer"},S)}},a.exports=v},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(s,a,l){if(l.base64=!0,l.array=!0,l.string=!0,l.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",l.nodebuffer=typeof Buffer<"u",l.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")l.blob=!1;else{var c=new ArrayBuffer(0);try{l.blob=new Blob([c],{type:"application/zip"}).size===0}catch{try{var u=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);u.append(c),l.blob=u.getBlob("application/zip").size===0}catch{l.blob=!1}}}try{l.nodestream=!!s("readable-stream").Readable}catch{l.nodestream=!1}},{"readable-stream":16}],31:[function(s,a,l){for(var c=s("./utils"),u=s("./support"),h=s("./nodejsUtils"),f=s("./stream/GenericWorker"),p=new Array(256),m=0;m<256;m++)p[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;p[254]=p[254]=1;function y(){f.call(this,"utf-8 decode"),this.leftOver=null}function b(){f.call(this,"utf-8 encode")}l.utf8encode=function(v){return u.nodebuffer?h.newBufferFrom(v,"utf-8"):(function(S){var _,w,j,N,T,R=S.length,$=0;for(N=0;N<R;N++)(64512&(w=S.charCodeAt(N)))==55296&&N+1<R&&(64512&(j=S.charCodeAt(N+1)))==56320&&(w=65536+(w-55296<<10)+(j-56320),N++),$+=w<128?1:w<2048?2:w<65536?3:4;for(_=u.uint8array?new Uint8Array($):new Array($),N=T=0;T<$;N++)(64512&(w=S.charCodeAt(N)))==55296&&N+1<R&&(64512&(j=S.charCodeAt(N+1)))==56320&&(w=65536+(w-55296<<10)+(j-56320),N++),w<128?_[T++]=w:(w<2048?_[T++]=192|w>>>6:(w<65536?_[T++]=224|w>>>12:(_[T++]=240|w>>>18,_[T++]=128|w>>>12&63),_[T++]=128|w>>>6&63),_[T++]=128|63&w);return _})(v)},l.utf8decode=function(v){return u.nodebuffer?c.transformTo("nodebuffer",v).toString("utf-8"):(function(S){var _,w,j,N,T=S.length,R=new Array(2*T);for(_=w=0;_<T;)if((j=S[_++])<128)R[w++]=j;else if(4<(N=p[j]))R[w++]=65533,_+=N-1;else{for(j&=N===2?31:N===3?15:7;1<N&&_<T;)j=j<<6|63&S[_++],N--;1<N?R[w++]=65533:j<65536?R[w++]=j:(j-=65536,R[w++]=55296|j>>10&1023,R[w++]=56320|1023&j)}return R.length!==w&&(R.subarray?R=R.subarray(0,w):R.length=w),c.applyFromCharCode(R)})(v=c.transformTo(u.uint8array?"uint8array":"array",v))},c.inherits(y,f),y.prototype.processChunk=function(v){var S=c.transformTo(u.uint8array?"uint8array":"array",v.data);if(this.leftOver&&this.leftOver.length){if(u.uint8array){var _=S;(S=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),S.set(_,this.leftOver.length)}else S=this.leftOver.concat(S);this.leftOver=null}var w=(function(N,T){var R;for((T=T||N.length)>N.length&&(T=N.length),R=T-1;0<=R&&(192&N[R])==128;)R--;return R<0||R===0?T:R+p[N[R]]>T?R:T})(S),j=S;w!==S.length&&(u.uint8array?(j=S.subarray(0,w),this.leftOver=S.subarray(w,S.length)):(j=S.slice(0,w),this.leftOver=S.slice(w,S.length))),this.push({data:l.utf8decode(j),meta:v.meta})},y.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:l.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},l.Utf8DecodeWorker=y,c.inherits(b,f),b.prototype.processChunk=function(v){this.push({data:l.utf8encode(v.data),meta:v.meta})},l.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(s,a,l){var c=s("./support"),u=s("./base64"),h=s("./nodejsUtils"),f=s("./external");function p(_){return _}function m(_,w){for(var j=0;j<_.length;++j)w[j]=255&_.charCodeAt(j);return w}s("setimmediate"),l.newBlob=function(_,w){l.checkSupport("blob");try{return new Blob([_],{type:w})}catch{try{var j=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return j.append(_),j.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var y={stringifyByChunk:function(_,w,j){var N=[],T=0,R=_.length;if(R<=j)return String.fromCharCode.apply(null,_);for(;T<R;)w==="array"||w==="nodebuffer"?N.push(String.fromCharCode.apply(null,_.slice(T,Math.min(T+j,R)))):N.push(String.fromCharCode.apply(null,_.subarray(T,Math.min(T+j,R)))),T+=j;return N.join("")},stringifyByChar:function(_){for(var w="",j=0;j<_.length;j++)w+=String.fromCharCode(_[j]);return w},applyCanBeUsed:{uint8array:(function(){try{return c.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return c.nodebuffer&&String.fromCharCode.apply(null,h.allocBuffer(1)).length===1}catch{return!1}})()}};function b(_){var w=65536,j=l.getTypeOf(_),N=!0;if(j==="uint8array"?N=y.applyCanBeUsed.uint8array:j==="nodebuffer"&&(N=y.applyCanBeUsed.nodebuffer),N)for(;1<w;)try{return y.stringifyByChunk(_,j,w)}catch{w=Math.floor(w/2)}return y.stringifyByChar(_)}function v(_,w){for(var j=0;j<_.length;j++)w[j]=_[j];return w}l.applyFromCharCode=b;var S={};S.string={string:p,array:function(_){return m(_,new Array(_.length))},arraybuffer:function(_){return S.string.uint8array(_).buffer},uint8array:function(_){return m(_,new Uint8Array(_.length))},nodebuffer:function(_){return m(_,h.allocBuffer(_.length))}},S.array={string:b,array:p,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return h.newBufferFrom(_)}},S.arraybuffer={string:function(_){return b(new Uint8Array(_))},array:function(_){return v(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:p,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return h.newBufferFrom(new Uint8Array(_))}},S.uint8array={string:b,array:function(_){return v(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:p,nodebuffer:function(_){return h.newBufferFrom(_)}},S.nodebuffer={string:b,array:function(_){return v(_,new Array(_.length))},arraybuffer:function(_){return S.nodebuffer.uint8array(_).buffer},uint8array:function(_){return v(_,new Uint8Array(_.length))},nodebuffer:p},l.transformTo=function(_,w){if(w=w||"",!_)return w;l.checkSupport(_);var j=l.getTypeOf(w);return S[j][_](w)},l.resolve=function(_){for(var w=_.split("/"),j=[],N=0;N<w.length;N++){var T=w[N];T==="."||T===""&&N!==0&&N!==w.length-1||(T===".."?j.pop():j.push(T))}return j.join("/")},l.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":c.nodebuffer&&h.isBuffer(_)?"nodebuffer":c.uint8array&&_ instanceof Uint8Array?"uint8array":c.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},l.checkSupport=function(_){if(!c[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},l.MAX_VALUE_16BITS=65535,l.MAX_VALUE_32BITS=-1,l.pretty=function(_){var w,j,N="";for(j=0;j<(_||"").length;j++)N+="\\x"+((w=_.charCodeAt(j))<16?"0":"")+w.toString(16).toUpperCase();return N},l.delay=function(_,w,j){setImmediate(function(){_.apply(j||null,w||[])})},l.inherits=function(_,w){function j(){}j.prototype=w.prototype,_.prototype=new j},l.extend=function(){var _,w,j={};for(_=0;_<arguments.length;_++)for(w in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],w)&&j[w]===void 0&&(j[w]=arguments[_][w]);return j},l.prepareContent=function(_,w,j,N,T){return f.Promise.resolve(w).then(function(R){return c.blob&&(R instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(R))!==-1)&&typeof FileReader<"u"?new f.Promise(function($,F){var q=new FileReader;q.onload=function(I){$(I.target.result)},q.onerror=function(I){F(I.target.error)},q.readAsArrayBuffer(R)}):R}).then(function(R){var $=l.getTypeOf(R);return $?($==="arraybuffer"?R=l.transformTo("uint8array",R):$==="string"&&(T?R=u.decode(R):j&&N!==!0&&(R=(function(F){return m(F,c.uint8array?new Uint8Array(F.length):new Array(F.length))})(R))),R):f.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(s,a,l){var c=s("./reader/readerFor"),u=s("./utils"),h=s("./signature"),f=s("./zipEntry"),p=s("./support");function m(y){this.files=[],this.loadOptions=y}m.prototype={checkSignature:function(y){if(!this.reader.readAndCheckSignature(y)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+u.pretty(b)+", expected "+u.pretty(y)+")")}},isSignature:function(y,b){var v=this.reader.index;this.reader.setIndex(y);var S=this.reader.readString(4)===b;return this.reader.setIndex(v),S},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var y=this.reader.readData(this.zipCommentLength),b=p.uint8array?"uint8array":"array",v=u.transformTo(b,y);this.zipComment=this.loadOptions.decodeFileName(v)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var y,b,v,S=this.zip64EndOfCentralSize-44;0<S;)y=this.reader.readInt(2),b=this.reader.readInt(4),v=this.reader.readData(b),this.zip64ExtensibleData[y]={id:y,length:b,value:v}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var y,b;for(y=0;y<this.files.length;y++)b=this.files[y],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(h.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var y;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(h.CENTRAL_FILE_HEADER);)(y=new f({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(y);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var y=this.reader.lastIndexOfSignature(h.CENTRAL_DIRECTORY_END);if(y<0)throw this.isSignature(0,h.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(y);var b=y;if(this.checkSignature(h.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===u.MAX_VALUE_16BITS||this.diskWithCentralDirStart===u.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===u.MAX_VALUE_16BITS||this.centralDirRecords===u.MAX_VALUE_16BITS||this.centralDirSize===u.MAX_VALUE_32BITS||this.centralDirOffset===u.MAX_VALUE_32BITS){if(this.zip64=!0,(y=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(y),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,h.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var v=this.centralDirOffset+this.centralDirSize;this.zip64&&(v+=20,v+=12+this.zip64EndOfCentralSize);var S=b-v;if(0<S)this.isSignature(b,h.CENTRAL_FILE_HEADER)||(this.reader.zero=S);else if(S<0)throw new Error("Corrupted zip: missing "+Math.abs(S)+" bytes.")},prepareReader:function(y){this.reader=c(y)},load:function(y){this.prepareReader(y),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},a.exports=m},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(s,a,l){var c=s("./reader/readerFor"),u=s("./utils"),h=s("./compressedObject"),f=s("./crc32"),p=s("./utf8"),m=s("./compressions"),y=s("./support");function b(v,S){this.options=v,this.loadOptions=S}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(v){var S,_;if(v.skip(22),this.fileNameLength=v.readInt(2),_=v.readInt(2),this.fileName=v.readData(this.fileNameLength),v.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((S=(function(w){for(var j in m)if(Object.prototype.hasOwnProperty.call(m,j)&&m[j].magic===w)return m[j];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+u.pretty(this.compressionMethod)+" unknown (inner file : "+u.transformTo("string",this.fileName)+")");this.decompressed=new h(this.compressedSize,this.uncompressedSize,this.crc32,S,v.readData(this.compressedSize))},readCentralPart:function(v){this.versionMadeBy=v.readInt(2),v.skip(2),this.bitFlag=v.readInt(2),this.compressionMethod=v.readString(2),this.date=v.readDate(),this.crc32=v.readInt(4),this.compressedSize=v.readInt(4),this.uncompressedSize=v.readInt(4);var S=v.readInt(2);if(this.extraFieldsLength=v.readInt(2),this.fileCommentLength=v.readInt(2),this.diskNumberStart=v.readInt(2),this.internalFileAttributes=v.readInt(2),this.externalFileAttributes=v.readInt(4),this.localHeaderOffset=v.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");v.skip(S),this.readExtraFields(v),this.parseZIP64ExtraField(v),this.fileComment=v.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var v=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),v==0&&(this.dosPermissions=63&this.externalFileAttributes),v==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var v=c(this.extraFields[1].value);this.uncompressedSize===u.MAX_VALUE_32BITS&&(this.uncompressedSize=v.readInt(8)),this.compressedSize===u.MAX_VALUE_32BITS&&(this.compressedSize=v.readInt(8)),this.localHeaderOffset===u.MAX_VALUE_32BITS&&(this.localHeaderOffset=v.readInt(8)),this.diskNumberStart===u.MAX_VALUE_32BITS&&(this.diskNumberStart=v.readInt(4))}},readExtraFields:function(v){var S,_,w,j=v.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});v.index+4<j;)S=v.readInt(2),_=v.readInt(2),w=v.readData(_),this.extraFields[S]={id:S,length:_,value:w};v.setIndex(j)},handleUTF8:function(){var v=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),this.fileCommentStr=p.utf8decode(this.fileComment);else{var S=this.findExtraFieldUnicodePath();if(S!==null)this.fileNameStr=S;else{var _=u.transformTo(v,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var j=u.transformTo(v,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(j)}}},findExtraFieldUnicodePath:function(){var v=this.extraFields[28789];if(v){var S=c(v.value);return S.readInt(1)!==1||f(this.fileName)!==S.readInt(4)?null:p.utf8decode(S.readData(v.length-5))}return null},findExtraFieldUnicodeComment:function(){var v=this.extraFields[25461];if(v){var S=c(v.value);return S.readInt(1)!==1||f(this.fileComment)!==S.readInt(4)?null:p.utf8decode(S.readData(v.length-5))}return null}},a.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(s,a,l){function c(S,_,w){this.name=S,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=_,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var u=s("./stream/StreamHelper"),h=s("./stream/DataWorker"),f=s("./utf8"),p=s("./compressedObject"),m=s("./stream/GenericWorker");c.prototype={internalStream:function(S){var _=null,w="string";try{if(!S)throw new Error("No output type specified.");var j=(w=S.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),_=this._decompressWorker();var N=!this._dataBinary;N&&!j&&(_=_.pipe(new f.Utf8EncodeWorker)),!N&&j&&(_=_.pipe(new f.Utf8DecodeWorker))}catch(T){(_=new m("error")).error(T)}return new u(_,w,"")},async:function(S,_){return this.internalStream(S).accumulate(_)},nodeStream:function(S,_){return this.internalStream(S||"nodebuffer").toNodejsStream(_)},_compressWorker:function(S,_){if(this._data instanceof p&&this._data.compression.magic===S.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new f.Utf8EncodeWorker)),p.createWorkerFrom(w,S,_)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof m?this._data:new h(this._data)}};for(var y=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},v=0;v<y.length;v++)c.prototype[y[v]]=b;a.exports=c},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(s,a,l){(function(c){var u,h,f=c.MutationObserver||c.WebKitMutationObserver;if(f){var p=0,m=new f(S),y=c.document.createTextNode("");m.observe(y,{characterData:!0}),u=function(){y.data=p=++p%2}}else if(c.setImmediate||c.MessageChannel===void 0)u="document"in c&&"onreadystatechange"in c.document.createElement("script")?function(){var _=c.document.createElement("script");_.onreadystatechange=function(){S(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},c.document.documentElement.appendChild(_)}:function(){setTimeout(S,0)};else{var b=new c.MessageChannel;b.port1.onmessage=S,u=function(){b.port2.postMessage(0)}}var v=[];function S(){var _,w;h=!0;for(var j=v.length;j;){for(w=v,v=[],_=-1;++_<j;)w[_]();j=v.length}h=!1}a.exports=function(_){v.push(_)!==1||h||u()}}).call(this,typeof Tu<"u"?Tu:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(s,a,l){var c=s("immediate");function u(){}var h={},f=["REJECTED"],p=["FULFILLED"],m=["PENDING"];function y(j){if(typeof j!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,j!==u&&_(this,j)}function b(j,N,T){this.promise=j,typeof N=="function"&&(this.onFulfilled=N,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function v(j,N,T){c(function(){var R;try{R=N(T)}catch($){return h.reject(j,$)}R===j?h.reject(j,new TypeError("Cannot resolve promise with itself")):h.resolve(j,R)})}function S(j){var N=j&&j.then;if(j&&(typeof j=="object"||typeof j=="function")&&typeof N=="function")return function(){N.apply(j,arguments)}}function _(j,N){var T=!1;function R(q){T||(T=!0,h.reject(j,q))}function $(q){T||(T=!0,h.resolve(j,q))}var F=w(function(){N($,R)});F.status==="error"&&R(F.value)}function w(j,N){var T={};try{T.value=j(N),T.status="success"}catch(R){T.status="error",T.value=R}return T}(a.exports=y).prototype.finally=function(j){if(typeof j!="function")return this;var N=this.constructor;return this.then(function(T){return N.resolve(j()).then(function(){return T})},function(T){return N.resolve(j()).then(function(){throw T})})},y.prototype.catch=function(j){return this.then(null,j)},y.prototype.then=function(j,N){if(typeof j!="function"&&this.state===p||typeof N!="function"&&this.state===f)return this;var T=new this.constructor(u);return this.state!==m?v(T,this.state===p?j:N,this.outcome):this.queue.push(new b(T,j,N)),T},b.prototype.callFulfilled=function(j){h.resolve(this.promise,j)},b.prototype.otherCallFulfilled=function(j){v(this.promise,this.onFulfilled,j)},b.prototype.callRejected=function(j){h.reject(this.promise,j)},b.prototype.otherCallRejected=function(j){v(this.promise,this.onRejected,j)},h.resolve=function(j,N){var T=w(S,N);if(T.status==="error")return h.reject(j,T.value);var R=T.value;if(R)_(j,R);else{j.state=p,j.outcome=N;for(var $=-1,F=j.queue.length;++$<F;)j.queue[$].callFulfilled(N)}return j},h.reject=function(j,N){j.state=f,j.outcome=N;for(var T=-1,R=j.queue.length;++T<R;)j.queue[T].callRejected(N);return j},y.resolve=function(j){return j instanceof this?j:h.resolve(new this(u),j)},y.reject=function(j){var N=new this(u);return h.reject(N,j)},y.all=function(j){var N=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=j.length,R=!1;if(!T)return this.resolve([]);for(var $=new Array(T),F=0,q=-1,I=new this(u);++q<T;)U(j[q],q);return I;function U(P,V){N.resolve(P).then(function(D){$[V]=D,++F!==T||R||(R=!0,h.resolve(I,$))},function(D){R||(R=!0,h.reject(I,D))})}},y.race=function(j){var N=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=j.length,R=!1;if(!T)return this.resolve([]);for(var $=-1,F=new this(u);++$<T;)q=j[$],N.resolve(q).then(function(I){R||(R=!0,h.resolve(F,I))},function(I){R||(R=!0,h.reject(F,I))});var q;return F}},{immediate:36}],38:[function(s,a,l){var c={};(0,s("./lib/utils/common").assign)(c,s("./lib/deflate"),s("./lib/inflate"),s("./lib/zlib/constants")),a.exports=c},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(s,a,l){var c=s("./zlib/deflate"),u=s("./utils/common"),h=s("./utils/strings"),f=s("./zlib/messages"),p=s("./zlib/zstream"),m=Object.prototype.toString,y=0,b=-1,v=0,S=8;function _(j){if(!(this instanceof _))return new _(j);this.options=u.assign({level:b,method:S,chunkSize:16384,windowBits:15,memLevel:8,strategy:v,to:""},j||{});var N=this.options;N.raw&&0<N.windowBits?N.windowBits=-N.windowBits:N.gzip&&0<N.windowBits&&N.windowBits<16&&(N.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var T=c.deflateInit2(this.strm,N.level,N.method,N.windowBits,N.memLevel,N.strategy);if(T!==y)throw new Error(f[T]);if(N.header&&c.deflateSetHeader(this.strm,N.header),N.dictionary){var R;if(R=typeof N.dictionary=="string"?h.string2buf(N.dictionary):m.call(N.dictionary)==="[object ArrayBuffer]"?new Uint8Array(N.dictionary):N.dictionary,(T=c.deflateSetDictionary(this.strm,R))!==y)throw new Error(f[T]);this._dict_set=!0}}function w(j,N){var T=new _(N);if(T.push(j,!0),T.err)throw T.msg||f[T.err];return T.result}_.prototype.push=function(j,N){var T,R,$=this.strm,F=this.options.chunkSize;if(this.ended)return!1;R=N===~~N?N:N===!0?4:0,typeof j=="string"?$.input=h.string2buf(j):m.call(j)==="[object ArrayBuffer]"?$.input=new Uint8Array(j):$.input=j,$.next_in=0,$.avail_in=$.input.length;do{if($.avail_out===0&&($.output=new u.Buf8(F),$.next_out=0,$.avail_out=F),(T=c.deflate($,R))!==1&&T!==y)return this.onEnd(T),!(this.ended=!0);$.avail_out!==0&&($.avail_in!==0||R!==4&&R!==2)||(this.options.to==="string"?this.onData(h.buf2binstring(u.shrinkBuf($.output,$.next_out))):this.onData(u.shrinkBuf($.output,$.next_out)))}while((0<$.avail_in||$.avail_out===0)&&T!==1);return R===4?(T=c.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===y):R!==2||(this.onEnd(y),!($.avail_out=0))},_.prototype.onData=function(j){this.chunks.push(j)},_.prototype.onEnd=function(j){j===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg},l.Deflate=_,l.deflate=w,l.deflateRaw=function(j,N){return(N=N||{}).raw=!0,w(j,N)},l.gzip=function(j,N){return(N=N||{}).gzip=!0,w(j,N)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(s,a,l){var c=s("./zlib/inflate"),u=s("./utils/common"),h=s("./utils/strings"),f=s("./zlib/constants"),p=s("./zlib/messages"),m=s("./zlib/zstream"),y=s("./zlib/gzheader"),b=Object.prototype.toString;function v(_){if(!(this instanceof v))return new v(_);this.options=u.assign({chunkSize:16384,windowBits:0,to:""},_||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||_&&_.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&(15&w.windowBits)==0&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var j=c.inflateInit2(this.strm,w.windowBits);if(j!==f.Z_OK)throw new Error(p[j]);this.header=new y,c.inflateGetHeader(this.strm,this.header)}function S(_,w){var j=new v(w);if(j.push(_,!0),j.err)throw j.msg||p[j.err];return j.result}v.prototype.push=function(_,w){var j,N,T,R,$,F,q=this.strm,I=this.options.chunkSize,U=this.options.dictionary,P=!1;if(this.ended)return!1;N=w===~~w?w:w===!0?f.Z_FINISH:f.Z_NO_FLUSH,typeof _=="string"?q.input=h.binstring2buf(_):b.call(_)==="[object ArrayBuffer]"?q.input=new Uint8Array(_):q.input=_,q.next_in=0,q.avail_in=q.input.length;do{if(q.avail_out===0&&(q.output=new u.Buf8(I),q.next_out=0,q.avail_out=I),(j=c.inflate(q,f.Z_NO_FLUSH))===f.Z_NEED_DICT&&U&&(F=typeof U=="string"?h.string2buf(U):b.call(U)==="[object ArrayBuffer]"?new Uint8Array(U):U,j=c.inflateSetDictionary(this.strm,F)),j===f.Z_BUF_ERROR&&P===!0&&(j=f.Z_OK,P=!1),j!==f.Z_STREAM_END&&j!==f.Z_OK)return this.onEnd(j),!(this.ended=!0);q.next_out&&(q.avail_out!==0&&j!==f.Z_STREAM_END&&(q.avail_in!==0||N!==f.Z_FINISH&&N!==f.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=h.utf8border(q.output,q.next_out),R=q.next_out-T,$=h.buf2string(q.output,T),q.next_out=R,q.avail_out=I-R,R&&u.arraySet(q.output,q.output,T,R,0),this.onData($)):this.onData(u.shrinkBuf(q.output,q.next_out)))),q.avail_in===0&&q.avail_out===0&&(P=!0)}while((0<q.avail_in||q.avail_out===0)&&j!==f.Z_STREAM_END);return j===f.Z_STREAM_END&&(N=f.Z_FINISH),N===f.Z_FINISH?(j=c.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===f.Z_OK):N!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),!(q.avail_out=0))},v.prototype.onData=function(_){this.chunks.push(_)},v.prototype.onEnd=function(_){_===f.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},l.Inflate=v,l.inflate=S,l.inflateRaw=function(_,w){return(w=w||{}).raw=!0,S(_,w)},l.ungzip=S},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(s,a,l){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";l.assign=function(f){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var m=p.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var y in m)m.hasOwnProperty(y)&&(f[y]=m[y])}}return f},l.shrinkBuf=function(f,p){return f.length===p?f:f.subarray?f.subarray(0,p):(f.length=p,f)};var u={arraySet:function(f,p,m,y,b){if(p.subarray&&f.subarray)f.set(p.subarray(m,m+y),b);else for(var v=0;v<y;v++)f[b+v]=p[m+v]},flattenChunks:function(f){var p,m,y,b,v,S;for(p=y=0,m=f.length;p<m;p++)y+=f[p].length;for(S=new Uint8Array(y),p=b=0,m=f.length;p<m;p++)v=f[p],S.set(v,b),b+=v.length;return S}},h={arraySet:function(f,p,m,y,b){for(var v=0;v<y;v++)f[b+v]=p[m+v]},flattenChunks:function(f){return[].concat.apply([],f)}};l.setTyped=function(f){f?(l.Buf8=Uint8Array,l.Buf16=Uint16Array,l.Buf32=Int32Array,l.assign(l,u)):(l.Buf8=Array,l.Buf16=Array,l.Buf32=Array,l.assign(l,h))},l.setTyped(c)},{}],42:[function(s,a,l){var c=s("./common"),u=!0,h=!0;try{String.fromCharCode.apply(null,[0])}catch{u=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{h=!1}for(var f=new c.Buf8(256),p=0;p<256;p++)f[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;function m(y,b){if(b<65537&&(y.subarray&&h||!y.subarray&&u))return String.fromCharCode.apply(null,c.shrinkBuf(y,b));for(var v="",S=0;S<b;S++)v+=String.fromCharCode(y[S]);return v}f[254]=f[254]=1,l.string2buf=function(y){var b,v,S,_,w,j=y.length,N=0;for(_=0;_<j;_++)(64512&(v=y.charCodeAt(_)))==55296&&_+1<j&&(64512&(S=y.charCodeAt(_+1)))==56320&&(v=65536+(v-55296<<10)+(S-56320),_++),N+=v<128?1:v<2048?2:v<65536?3:4;for(b=new c.Buf8(N),_=w=0;w<N;_++)(64512&(v=y.charCodeAt(_)))==55296&&_+1<j&&(64512&(S=y.charCodeAt(_+1)))==56320&&(v=65536+(v-55296<<10)+(S-56320),_++),v<128?b[w++]=v:(v<2048?b[w++]=192|v>>>6:(v<65536?b[w++]=224|v>>>12:(b[w++]=240|v>>>18,b[w++]=128|v>>>12&63),b[w++]=128|v>>>6&63),b[w++]=128|63&v);return b},l.buf2binstring=function(y){return m(y,y.length)},l.binstring2buf=function(y){for(var b=new c.Buf8(y.length),v=0,S=b.length;v<S;v++)b[v]=y.charCodeAt(v);return b},l.buf2string=function(y,b){var v,S,_,w,j=b||y.length,N=new Array(2*j);for(v=S=0;v<j;)if((_=y[v++])<128)N[S++]=_;else if(4<(w=f[_]))N[S++]=65533,v+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&v<j;)_=_<<6|63&y[v++],w--;1<w?N[S++]=65533:_<65536?N[S++]=_:(_-=65536,N[S++]=55296|_>>10&1023,N[S++]=56320|1023&_)}return m(N,S)},l.utf8border=function(y,b){var v;for((b=b||y.length)>y.length&&(b=y.length),v=b-1;0<=v&&(192&y[v])==128;)v--;return v<0||v===0?b:v+f[y[v]]>b?v:b}},{"./common":41}],43:[function(s,a,l){a.exports=function(c,u,h,f){for(var p=65535&c|0,m=c>>>16&65535|0,y=0;h!==0;){for(h-=y=2e3<h?2e3:h;m=m+(p=p+u[f++]|0)|0,--y;);p%=65521,m%=65521}return p|m<<16|0}},{}],44:[function(s,a,l){a.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(s,a,l){var c=(function(){for(var u,h=[],f=0;f<256;f++){u=f;for(var p=0;p<8;p++)u=1&u?3988292384^u>>>1:u>>>1;h[f]=u}return h})();a.exports=function(u,h,f,p){var m=c,y=p+f;u^=-1;for(var b=p;b<y;b++)u=u>>>8^m[255&(u^h[b])];return-1^u}},{}],46:[function(s,a,l){var c,u=s("../utils/common"),h=s("./trees"),f=s("./adler32"),p=s("./crc32"),m=s("./messages"),y=0,b=4,v=0,S=-2,_=-1,w=4,j=2,N=8,T=9,R=286,$=30,F=19,q=2*R+1,I=15,U=3,P=258,V=P+U+1,D=42,H=113,C=1,M=2,z=3,B=4;function K(E,ve){return E.msg=m[ve],ve}function Q(E){return(E<<1)-(4<E?9:0)}function Z(E){for(var ve=E.length;0<=--ve;)E[ve]=0}function A(E){var ve=E.state,ge=ve.pending;ge>E.avail_out&&(ge=E.avail_out),ge!==0&&(u.arraySet(E.output,ve.pending_buf,ve.pending_out,ge,E.next_out),E.next_out+=ge,ve.pending_out+=ge,E.total_out+=ge,E.avail_out-=ge,ve.pending-=ge,ve.pending===0&&(ve.pending_out=0))}function L(E,ve){h._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,ve),E.block_start=E.strstart,A(E.strm)}function J(E,ve){E.pending_buf[E.pending++]=ve}function ae(E,ve){E.pending_buf[E.pending++]=ve>>>8&255,E.pending_buf[E.pending++]=255&ve}function ue(E,ve){var ge,Y,W=E.max_chain_length,oe=E.strstart,re=E.prev_length,ee=E.nice_match,de=E.strstart>E.w_size-V?E.strstart-(E.w_size-V):0,me=E.window,Be=E.w_mask,Re=E.prev,Pe=E.strstart+P,Je=me[oe+re-1],We=me[oe+re];E.prev_length>=E.good_match&&(W>>=2),ee>E.lookahead&&(ee=E.lookahead);do if(me[(ge=ve)+re]===We&&me[ge+re-1]===Je&&me[ge]===me[oe]&&me[++ge]===me[oe+1]){oe+=2,ge++;do;while(me[++oe]===me[++ge]&&me[++oe]===me[++ge]&&me[++oe]===me[++ge]&&me[++oe]===me[++ge]&&me[++oe]===me[++ge]&&me[++oe]===me[++ge]&&me[++oe]===me[++ge]&&me[++oe]===me[++ge]&&oe<Pe);if(Y=P-(Pe-oe),oe=Pe-P,re<Y){if(E.match_start=ve,ee<=(re=Y))break;Je=me[oe+re-1],We=me[oe+re]}}while((ve=Re[ve&Be])>de&&--W!=0);return re<=E.lookahead?re:E.lookahead}function Ce(E){var ve,ge,Y,W,oe,re,ee,de,me,Be,Re=E.w_size;do{if(W=E.window_size-E.lookahead-E.strstart,E.strstart>=Re+(Re-V)){for(u.arraySet(E.window,E.window,Re,Re,0),E.match_start-=Re,E.strstart-=Re,E.block_start-=Re,ve=ge=E.hash_size;Y=E.head[--ve],E.head[ve]=Re<=Y?Y-Re:0,--ge;);for(ve=ge=Re;Y=E.prev[--ve],E.prev[ve]=Re<=Y?Y-Re:0,--ge;);W+=Re}if(E.strm.avail_in===0)break;if(re=E.strm,ee=E.window,de=E.strstart+E.lookahead,me=W,Be=void 0,Be=re.avail_in,me<Be&&(Be=me),ge=Be===0?0:(re.avail_in-=Be,u.arraySet(ee,re.input,re.next_in,Be,de),re.state.wrap===1?re.adler=f(re.adler,ee,Be,de):re.state.wrap===2&&(re.adler=p(re.adler,ee,Be,de)),re.next_in+=Be,re.total_in+=Be,Be),E.lookahead+=ge,E.lookahead+E.insert>=U)for(oe=E.strstart-E.insert,E.ins_h=E.window[oe],E.ins_h=(E.ins_h<<E.hash_shift^E.window[oe+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[oe+U-1])&E.hash_mask,E.prev[oe&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=oe,oe++,E.insert--,!(E.lookahead+E.insert<U)););}while(E.lookahead<V&&E.strm.avail_in!==0)}function fe(E,ve){for(var ge,Y;;){if(E.lookahead<V){if(Ce(E),E.lookahead<V&&ve===y)return C;if(E.lookahead===0)break}if(ge=0,E.lookahead>=U&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+U-1])&E.hash_mask,ge=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),ge!==0&&E.strstart-ge<=E.w_size-V&&(E.match_length=ue(E,ge)),E.match_length>=U)if(Y=h._tr_tally(E,E.strstart-E.match_start,E.match_length-U),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=U){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+U-1])&E.hash_mask,ge=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else Y=h._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(Y&&(L(E,!1),E.strm.avail_out===0))return C}return E.insert=E.strstart<U-1?E.strstart:U-1,ve===b?(L(E,!0),E.strm.avail_out===0?z:B):E.last_lit&&(L(E,!1),E.strm.avail_out===0)?C:M}function ne(E,ve){for(var ge,Y,W;;){if(E.lookahead<V){if(Ce(E),E.lookahead<V&&ve===y)return C;if(E.lookahead===0)break}if(ge=0,E.lookahead>=U&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+U-1])&E.hash_mask,ge=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=U-1,ge!==0&&E.prev_length<E.max_lazy_match&&E.strstart-ge<=E.w_size-V&&(E.match_length=ue(E,ge),E.match_length<=5&&(E.strategy===1||E.match_length===U&&4096<E.strstart-E.match_start)&&(E.match_length=U-1)),E.prev_length>=U&&E.match_length<=E.prev_length){for(W=E.strstart+E.lookahead-U,Y=h._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-U),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=W&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+U-1])&E.hash_mask,ge=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=U-1,E.strstart++,Y&&(L(E,!1),E.strm.avail_out===0))return C}else if(E.match_available){if((Y=h._tr_tally(E,0,E.window[E.strstart-1]))&&L(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return C}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(Y=h._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<U-1?E.strstart:U-1,ve===b?(L(E,!0),E.strm.avail_out===0?z:B):E.last_lit&&(L(E,!1),E.strm.avail_out===0)?C:M}function be(E,ve,ge,Y,W){this.good_length=E,this.max_lazy=ve,this.nice_length=ge,this.max_chain=Y,this.func=W}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=N,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new u.Buf16(2*q),this.dyn_dtree=new u.Buf16(2*(2*$+1)),this.bl_tree=new u.Buf16(2*(2*F+1)),Z(this.dyn_ltree),Z(this.dyn_dtree),Z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new u.Buf16(I+1),this.heap=new u.Buf16(2*R+1),Z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new u.Buf16(2*R+1),Z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ie(E){var ve;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=j,(ve=E.state).pending=0,ve.pending_out=0,ve.wrap<0&&(ve.wrap=-ve.wrap),ve.status=ve.wrap?D:H,E.adler=ve.wrap===2?0:1,ve.last_flush=y,h._tr_init(ve),v):K(E,S)}function Te(E){var ve=ie(E);return ve===v&&(function(ge){ge.window_size=2*ge.w_size,Z(ge.head),ge.max_lazy_match=c[ge.level].max_lazy,ge.good_match=c[ge.level].good_length,ge.nice_match=c[ge.level].nice_length,ge.max_chain_length=c[ge.level].max_chain,ge.strstart=0,ge.block_start=0,ge.lookahead=0,ge.insert=0,ge.match_length=ge.prev_length=U-1,ge.match_available=0,ge.ins_h=0})(E.state),ve}function Le(E,ve,ge,Y,W,oe){if(!E)return S;var re=1;if(ve===_&&(ve=6),Y<0?(re=0,Y=-Y):15<Y&&(re=2,Y-=16),W<1||T<W||ge!==N||Y<8||15<Y||ve<0||9<ve||oe<0||w<oe)return K(E,S);Y===8&&(Y=9);var ee=new le;return(E.state=ee).strm=E,ee.wrap=re,ee.gzhead=null,ee.w_bits=Y,ee.w_size=1<<ee.w_bits,ee.w_mask=ee.w_size-1,ee.hash_bits=W+7,ee.hash_size=1<<ee.hash_bits,ee.hash_mask=ee.hash_size-1,ee.hash_shift=~~((ee.hash_bits+U-1)/U),ee.window=new u.Buf8(2*ee.w_size),ee.head=new u.Buf16(ee.hash_size),ee.prev=new u.Buf16(ee.w_size),ee.lit_bufsize=1<<W+6,ee.pending_buf_size=4*ee.lit_bufsize,ee.pending_buf=new u.Buf8(ee.pending_buf_size),ee.d_buf=1*ee.lit_bufsize,ee.l_buf=3*ee.lit_bufsize,ee.level=ve,ee.strategy=oe,ee.method=ge,Te(E)}c=[new be(0,0,0,0,function(E,ve){var ge=65535;for(ge>E.pending_buf_size-5&&(ge=E.pending_buf_size-5);;){if(E.lookahead<=1){if(Ce(E),E.lookahead===0&&ve===y)return C;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var Y=E.block_start+ge;if((E.strstart===0||E.strstart>=Y)&&(E.lookahead=E.strstart-Y,E.strstart=Y,L(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-V&&(L(E,!1),E.strm.avail_out===0))return C}return E.insert=0,ve===b?(L(E,!0),E.strm.avail_out===0?z:B):(E.strstart>E.block_start&&(L(E,!1),E.strm.avail_out),C)}),new be(4,4,8,4,fe),new be(4,5,16,8,fe),new be(4,6,32,32,fe),new be(4,4,16,16,ne),new be(8,16,32,32,ne),new be(8,16,128,128,ne),new be(8,32,128,256,ne),new be(32,128,258,1024,ne),new be(32,258,258,4096,ne)],l.deflateInit=function(E,ve){return Le(E,ve,N,15,8,0)},l.deflateInit2=Le,l.deflateReset=Te,l.deflateResetKeep=ie,l.deflateSetHeader=function(E,ve){return E&&E.state?E.state.wrap!==2?S:(E.state.gzhead=ve,v):S},l.deflate=function(E,ve){var ge,Y,W,oe;if(!E||!E.state||5<ve||ve<0)return E?K(E,S):S;if(Y=E.state,!E.output||!E.input&&E.avail_in!==0||Y.status===666&&ve!==b)return K(E,E.avail_out===0?-5:S);if(Y.strm=E,ge=Y.last_flush,Y.last_flush=ve,Y.status===D)if(Y.wrap===2)E.adler=0,J(Y,31),J(Y,139),J(Y,8),Y.gzhead?(J(Y,(Y.gzhead.text?1:0)+(Y.gzhead.hcrc?2:0)+(Y.gzhead.extra?4:0)+(Y.gzhead.name?8:0)+(Y.gzhead.comment?16:0)),J(Y,255&Y.gzhead.time),J(Y,Y.gzhead.time>>8&255),J(Y,Y.gzhead.time>>16&255),J(Y,Y.gzhead.time>>24&255),J(Y,Y.level===9?2:2<=Y.strategy||Y.level<2?4:0),J(Y,255&Y.gzhead.os),Y.gzhead.extra&&Y.gzhead.extra.length&&(J(Y,255&Y.gzhead.extra.length),J(Y,Y.gzhead.extra.length>>8&255)),Y.gzhead.hcrc&&(E.adler=p(E.adler,Y.pending_buf,Y.pending,0)),Y.gzindex=0,Y.status=69):(J(Y,0),J(Y,0),J(Y,0),J(Y,0),J(Y,0),J(Y,Y.level===9?2:2<=Y.strategy||Y.level<2?4:0),J(Y,3),Y.status=H);else{var re=N+(Y.w_bits-8<<4)<<8;re|=(2<=Y.strategy||Y.level<2?0:Y.level<6?1:Y.level===6?2:3)<<6,Y.strstart!==0&&(re|=32),re+=31-re%31,Y.status=H,ae(Y,re),Y.strstart!==0&&(ae(Y,E.adler>>>16),ae(Y,65535&E.adler)),E.adler=1}if(Y.status===69)if(Y.gzhead.extra){for(W=Y.pending;Y.gzindex<(65535&Y.gzhead.extra.length)&&(Y.pending!==Y.pending_buf_size||(Y.gzhead.hcrc&&Y.pending>W&&(E.adler=p(E.adler,Y.pending_buf,Y.pending-W,W)),A(E),W=Y.pending,Y.pending!==Y.pending_buf_size));)J(Y,255&Y.gzhead.extra[Y.gzindex]),Y.gzindex++;Y.gzhead.hcrc&&Y.pending>W&&(E.adler=p(E.adler,Y.pending_buf,Y.pending-W,W)),Y.gzindex===Y.gzhead.extra.length&&(Y.gzindex=0,Y.status=73)}else Y.status=73;if(Y.status===73)if(Y.gzhead.name){W=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>W&&(E.adler=p(E.adler,Y.pending_buf,Y.pending-W,W)),A(E),W=Y.pending,Y.pending===Y.pending_buf_size)){oe=1;break}oe=Y.gzindex<Y.gzhead.name.length?255&Y.gzhead.name.charCodeAt(Y.gzindex++):0,J(Y,oe)}while(oe!==0);Y.gzhead.hcrc&&Y.pending>W&&(E.adler=p(E.adler,Y.pending_buf,Y.pending-W,W)),oe===0&&(Y.gzindex=0,Y.status=91)}else Y.status=91;if(Y.status===91)if(Y.gzhead.comment){W=Y.pending;do{if(Y.pending===Y.pending_buf_size&&(Y.gzhead.hcrc&&Y.pending>W&&(E.adler=p(E.adler,Y.pending_buf,Y.pending-W,W)),A(E),W=Y.pending,Y.pending===Y.pending_buf_size)){oe=1;break}oe=Y.gzindex<Y.gzhead.comment.length?255&Y.gzhead.comment.charCodeAt(Y.gzindex++):0,J(Y,oe)}while(oe!==0);Y.gzhead.hcrc&&Y.pending>W&&(E.adler=p(E.adler,Y.pending_buf,Y.pending-W,W)),oe===0&&(Y.status=103)}else Y.status=103;if(Y.status===103&&(Y.gzhead.hcrc?(Y.pending+2>Y.pending_buf_size&&A(E),Y.pending+2<=Y.pending_buf_size&&(J(Y,255&E.adler),J(Y,E.adler>>8&255),E.adler=0,Y.status=H)):Y.status=H),Y.pending!==0){if(A(E),E.avail_out===0)return Y.last_flush=-1,v}else if(E.avail_in===0&&Q(ve)<=Q(ge)&&ve!==b)return K(E,-5);if(Y.status===666&&E.avail_in!==0)return K(E,-5);if(E.avail_in!==0||Y.lookahead!==0||ve!==y&&Y.status!==666){var ee=Y.strategy===2?(function(de,me){for(var Be;;){if(de.lookahead===0&&(Ce(de),de.lookahead===0)){if(me===y)return C;break}if(de.match_length=0,Be=h._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++,Be&&(L(de,!1),de.strm.avail_out===0))return C}return de.insert=0,me===b?(L(de,!0),de.strm.avail_out===0?z:B):de.last_lit&&(L(de,!1),de.strm.avail_out===0)?C:M})(Y,ve):Y.strategy===3?(function(de,me){for(var Be,Re,Pe,Je,We=de.window;;){if(de.lookahead<=P){if(Ce(de),de.lookahead<=P&&me===y)return C;if(de.lookahead===0)break}if(de.match_length=0,de.lookahead>=U&&0<de.strstart&&(Re=We[Pe=de.strstart-1])===We[++Pe]&&Re===We[++Pe]&&Re===We[++Pe]){Je=de.strstart+P;do;while(Re===We[++Pe]&&Re===We[++Pe]&&Re===We[++Pe]&&Re===We[++Pe]&&Re===We[++Pe]&&Re===We[++Pe]&&Re===We[++Pe]&&Re===We[++Pe]&&Pe<Je);de.match_length=P-(Je-Pe),de.match_length>de.lookahead&&(de.match_length=de.lookahead)}if(de.match_length>=U?(Be=h._tr_tally(de,1,de.match_length-U),de.lookahead-=de.match_length,de.strstart+=de.match_length,de.match_length=0):(Be=h._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++),Be&&(L(de,!1),de.strm.avail_out===0))return C}return de.insert=0,me===b?(L(de,!0),de.strm.avail_out===0?z:B):de.last_lit&&(L(de,!1),de.strm.avail_out===0)?C:M})(Y,ve):c[Y.level].func(Y,ve);if(ee!==z&&ee!==B||(Y.status=666),ee===C||ee===z)return E.avail_out===0&&(Y.last_flush=-1),v;if(ee===M&&(ve===1?h._tr_align(Y):ve!==5&&(h._tr_stored_block(Y,0,0,!1),ve===3&&(Z(Y.head),Y.lookahead===0&&(Y.strstart=0,Y.block_start=0,Y.insert=0))),A(E),E.avail_out===0))return Y.last_flush=-1,v}return ve!==b?v:Y.wrap<=0?1:(Y.wrap===2?(J(Y,255&E.adler),J(Y,E.adler>>8&255),J(Y,E.adler>>16&255),J(Y,E.adler>>24&255),J(Y,255&E.total_in),J(Y,E.total_in>>8&255),J(Y,E.total_in>>16&255),J(Y,E.total_in>>24&255)):(ae(Y,E.adler>>>16),ae(Y,65535&E.adler)),A(E),0<Y.wrap&&(Y.wrap=-Y.wrap),Y.pending!==0?v:1)},l.deflateEnd=function(E){var ve;return E&&E.state?(ve=E.state.status)!==D&&ve!==69&&ve!==73&&ve!==91&&ve!==103&&ve!==H&&ve!==666?K(E,S):(E.state=null,ve===H?K(E,-3):v):S},l.deflateSetDictionary=function(E,ve){var ge,Y,W,oe,re,ee,de,me,Be=ve.length;if(!E||!E.state||(oe=(ge=E.state).wrap)===2||oe===1&&ge.status!==D||ge.lookahead)return S;for(oe===1&&(E.adler=f(E.adler,ve,Be,0)),ge.wrap=0,Be>=ge.w_size&&(oe===0&&(Z(ge.head),ge.strstart=0,ge.block_start=0,ge.insert=0),me=new u.Buf8(ge.w_size),u.arraySet(me,ve,Be-ge.w_size,ge.w_size,0),ve=me,Be=ge.w_size),re=E.avail_in,ee=E.next_in,de=E.input,E.avail_in=Be,E.next_in=0,E.input=ve,Ce(ge);ge.lookahead>=U;){for(Y=ge.strstart,W=ge.lookahead-(U-1);ge.ins_h=(ge.ins_h<<ge.hash_shift^ge.window[Y+U-1])&ge.hash_mask,ge.prev[Y&ge.w_mask]=ge.head[ge.ins_h],ge.head[ge.ins_h]=Y,Y++,--W;);ge.strstart=Y,ge.lookahead=U-1,Ce(ge)}return ge.strstart+=ge.lookahead,ge.block_start=ge.strstart,ge.insert=ge.lookahead,ge.lookahead=0,ge.match_length=ge.prev_length=U-1,ge.match_available=0,E.next_in=ee,E.input=de,E.avail_in=re,ge.wrap=oe,v},l.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(s,a,l){a.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(s,a,l){a.exports=function(c,u){var h,f,p,m,y,b,v,S,_,w,j,N,T,R,$,F,q,I,U,P,V,D,H,C,M;h=c.state,f=c.next_in,C=c.input,p=f+(c.avail_in-5),m=c.next_out,M=c.output,y=m-(u-c.avail_out),b=m+(c.avail_out-257),v=h.dmax,S=h.wsize,_=h.whave,w=h.wnext,j=h.window,N=h.hold,T=h.bits,R=h.lencode,$=h.distcode,F=(1<<h.lenbits)-1,q=(1<<h.distbits)-1;e:do{T<15&&(N+=C[f++]<<T,T+=8,N+=C[f++]<<T,T+=8),I=R[N&F];t:for(;;){if(N>>>=U=I>>>24,T-=U,(U=I>>>16&255)===0)M[m++]=65535&I;else{if(!(16&U)){if((64&U)==0){I=R[(65535&I)+(N&(1<<U)-1)];continue t}if(32&U){h.mode=12;break e}c.msg="invalid literal/length code",h.mode=30;break e}P=65535&I,(U&=15)&&(T<U&&(N+=C[f++]<<T,T+=8),P+=N&(1<<U)-1,N>>>=U,T-=U),T<15&&(N+=C[f++]<<T,T+=8,N+=C[f++]<<T,T+=8),I=$[N&q];n:for(;;){if(N>>>=U=I>>>24,T-=U,!(16&(U=I>>>16&255))){if((64&U)==0){I=$[(65535&I)+(N&(1<<U)-1)];continue n}c.msg="invalid distance code",h.mode=30;break e}if(V=65535&I,T<(U&=15)&&(N+=C[f++]<<T,(T+=8)<U&&(N+=C[f++]<<T,T+=8)),v<(V+=N&(1<<U)-1)){c.msg="invalid distance too far back",h.mode=30;break e}if(N>>>=U,T-=U,(U=m-y)<V){if(_<(U=V-U)&&h.sane){c.msg="invalid distance too far back",h.mode=30;break e}if(H=j,(D=0)===w){if(D+=S-U,U<P){for(P-=U;M[m++]=j[D++],--U;);D=m-V,H=M}}else if(w<U){if(D+=S+w-U,(U-=w)<P){for(P-=U;M[m++]=j[D++],--U;);if(D=0,w<P){for(P-=U=w;M[m++]=j[D++],--U;);D=m-V,H=M}}}else if(D+=w-U,U<P){for(P-=U;M[m++]=j[D++],--U;);D=m-V,H=M}for(;2<P;)M[m++]=H[D++],M[m++]=H[D++],M[m++]=H[D++],P-=3;P&&(M[m++]=H[D++],1<P&&(M[m++]=H[D++]))}else{for(D=m-V;M[m++]=M[D++],M[m++]=M[D++],M[m++]=M[D++],2<(P-=3););P&&(M[m++]=M[D++],1<P&&(M[m++]=M[D++]))}break}}break}}while(f<p&&m<b);f-=P=T>>3,N&=(1<<(T-=P<<3))-1,c.next_in=f,c.next_out=m,c.avail_in=f<p?p-f+5:5-(f-p),c.avail_out=m<b?b-m+257:257-(m-b),h.hold=N,h.bits=T}},{}],49:[function(s,a,l){var c=s("../utils/common"),u=s("./adler32"),h=s("./crc32"),f=s("./inffast"),p=s("./inftrees"),m=1,y=2,b=0,v=-2,S=1,_=852,w=592;function j(D){return(D>>>24&255)+(D>>>8&65280)+((65280&D)<<8)+((255&D)<<24)}function N(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new c.Buf16(320),this.work=new c.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(D){var H;return D&&D.state?(H=D.state,D.total_in=D.total_out=H.total=0,D.msg="",H.wrap&&(D.adler=1&H.wrap),H.mode=S,H.last=0,H.havedict=0,H.dmax=32768,H.head=null,H.hold=0,H.bits=0,H.lencode=H.lendyn=new c.Buf32(_),H.distcode=H.distdyn=new c.Buf32(w),H.sane=1,H.back=-1,b):v}function R(D){var H;return D&&D.state?((H=D.state).wsize=0,H.whave=0,H.wnext=0,T(D)):v}function $(D,H){var C,M;return D&&D.state?(M=D.state,H<0?(C=0,H=-H):(C=1+(H>>4),H<48&&(H&=15)),H&&(H<8||15<H)?v:(M.window!==null&&M.wbits!==H&&(M.window=null),M.wrap=C,M.wbits=H,R(D))):v}function F(D,H){var C,M;return D?(M=new N,(D.state=M).window=null,(C=$(D,H))!==b&&(D.state=null),C):v}var q,I,U=!0;function P(D){if(U){var H;for(q=new c.Buf32(512),I=new c.Buf32(32),H=0;H<144;)D.lens[H++]=8;for(;H<256;)D.lens[H++]=9;for(;H<280;)D.lens[H++]=7;for(;H<288;)D.lens[H++]=8;for(p(m,D.lens,0,288,q,0,D.work,{bits:9}),H=0;H<32;)D.lens[H++]=5;p(y,D.lens,0,32,I,0,D.work,{bits:5}),U=!1}D.lencode=q,D.lenbits=9,D.distcode=I,D.distbits=5}function V(D,H,C,M){var z,B=D.state;return B.window===null&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new c.Buf8(B.wsize)),M>=B.wsize?(c.arraySet(B.window,H,C-B.wsize,B.wsize,0),B.wnext=0,B.whave=B.wsize):(M<(z=B.wsize-B.wnext)&&(z=M),c.arraySet(B.window,H,C-M,z,B.wnext),(M-=z)?(c.arraySet(B.window,H,C-M,M,0),B.wnext=M,B.whave=B.wsize):(B.wnext+=z,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=z))),0}l.inflateReset=R,l.inflateReset2=$,l.inflateResetKeep=T,l.inflateInit=function(D){return F(D,15)},l.inflateInit2=F,l.inflate=function(D,H){var C,M,z,B,K,Q,Z,A,L,J,ae,ue,Ce,fe,ne,be,le,ie,Te,Le,E,ve,ge,Y,W=0,oe=new c.Buf8(4),re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!D||!D.state||!D.output||!D.input&&D.avail_in!==0)return v;(C=D.state).mode===12&&(C.mode=13),K=D.next_out,z=D.output,Z=D.avail_out,B=D.next_in,M=D.input,Q=D.avail_in,A=C.hold,L=C.bits,J=Q,ae=Z,ve=b;e:for(;;)switch(C.mode){case S:if(C.wrap===0){C.mode=13;break}for(;L<16;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if(2&C.wrap&&A===35615){oe[C.check=0]=255&A,oe[1]=A>>>8&255,C.check=h(C.check,oe,2,0),L=A=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&A)<<8)+(A>>8))%31){D.msg="incorrect header check",C.mode=30;break}if((15&A)!=8){D.msg="unknown compression method",C.mode=30;break}if(L-=4,E=8+(15&(A>>>=4)),C.wbits===0)C.wbits=E;else if(E>C.wbits){D.msg="invalid window size",C.mode=30;break}C.dmax=1<<E,D.adler=C.check=1,C.mode=512&A?10:12,L=A=0;break;case 2:for(;L<16;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if(C.flags=A,(255&C.flags)!=8){D.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){D.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=A>>8&1),512&C.flags&&(oe[0]=255&A,oe[1]=A>>>8&255,C.check=h(C.check,oe,2,0)),L=A=0,C.mode=3;case 3:for(;L<32;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}C.head&&(C.head.time=A),512&C.flags&&(oe[0]=255&A,oe[1]=A>>>8&255,oe[2]=A>>>16&255,oe[3]=A>>>24&255,C.check=h(C.check,oe,4,0)),L=A=0,C.mode=4;case 4:for(;L<16;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}C.head&&(C.head.xflags=255&A,C.head.os=A>>8),512&C.flags&&(oe[0]=255&A,oe[1]=A>>>8&255,C.check=h(C.check,oe,2,0)),L=A=0,C.mode=5;case 5:if(1024&C.flags){for(;L<16;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}C.length=A,C.head&&(C.head.extra_len=A),512&C.flags&&(oe[0]=255&A,oe[1]=A>>>8&255,C.check=h(C.check,oe,2,0)),L=A=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(Q<(ue=C.length)&&(ue=Q),ue&&(C.head&&(E=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),c.arraySet(C.head.extra,M,B,ue,E)),512&C.flags&&(C.check=h(C.check,M,ue,B)),Q-=ue,B+=ue,C.length-=ue),C.length))break e;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(Q===0)break e;for(ue=0;E=M[B+ue++],C.head&&E&&C.length<65536&&(C.head.name+=String.fromCharCode(E)),E&&ue<Q;);if(512&C.flags&&(C.check=h(C.check,M,ue,B)),Q-=ue,B+=ue,E)break e}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(Q===0)break e;for(ue=0;E=M[B+ue++],C.head&&E&&C.length<65536&&(C.head.comment+=String.fromCharCode(E)),E&&ue<Q;);if(512&C.flags&&(C.check=h(C.check,M,ue,B)),Q-=ue,B+=ue,E)break e}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;L<16;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if(A!==(65535&C.check)){D.msg="header crc mismatch",C.mode=30;break}L=A=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),D.adler=C.check=0,C.mode=12;break;case 10:for(;L<32;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}D.adler=C.check=j(A),L=A=0,C.mode=11;case 11:if(C.havedict===0)return D.next_out=K,D.avail_out=Z,D.next_in=B,D.avail_in=Q,C.hold=A,C.bits=L,2;D.adler=C.check=1,C.mode=12;case 12:if(H===5||H===6)break e;case 13:if(C.last){A>>>=7&L,L-=7&L,C.mode=27;break}for(;L<3;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}switch(C.last=1&A,L-=1,3&(A>>>=1)){case 0:C.mode=14;break;case 1:if(P(C),C.mode=20,H!==6)break;A>>>=2,L-=2;break e;case 2:C.mode=17;break;case 3:D.msg="invalid block type",C.mode=30}A>>>=2,L-=2;break;case 14:for(A>>>=7&L,L-=7&L;L<32;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if((65535&A)!=(A>>>16^65535)){D.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&A,L=A=0,C.mode=15,H===6)break e;case 15:C.mode=16;case 16:if(ue=C.length){if(Q<ue&&(ue=Q),Z<ue&&(ue=Z),ue===0)break e;c.arraySet(z,M,B,ue,K),Q-=ue,B+=ue,Z-=ue,K+=ue,C.length-=ue;break}C.mode=12;break;case 17:for(;L<14;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if(C.nlen=257+(31&A),A>>>=5,L-=5,C.ndist=1+(31&A),A>>>=5,L-=5,C.ncode=4+(15&A),A>>>=4,L-=4,286<C.nlen||30<C.ndist){D.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;L<3;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}C.lens[re[C.have++]]=7&A,A>>>=3,L-=3}for(;C.have<19;)C.lens[re[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,ge={bits:C.lenbits},ve=p(0,C.lens,0,19,C.lencode,0,C.work,ge),C.lenbits=ge.bits,ve){D.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;be=(W=C.lencode[A&(1<<C.lenbits)-1])>>>16&255,le=65535&W,!((ne=W>>>24)<=L);){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if(le<16)A>>>=ne,L-=ne,C.lens[C.have++]=le;else{if(le===16){for(Y=ne+2;L<Y;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if(A>>>=ne,L-=ne,C.have===0){D.msg="invalid bit length repeat",C.mode=30;break}E=C.lens[C.have-1],ue=3+(3&A),A>>>=2,L-=2}else if(le===17){for(Y=ne+3;L<Y;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}L-=ne,E=0,ue=3+(7&(A>>>=ne)),A>>>=3,L-=3}else{for(Y=ne+7;L<Y;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}L-=ne,E=0,ue=11+(127&(A>>>=ne)),A>>>=7,L-=7}if(C.have+ue>C.nlen+C.ndist){D.msg="invalid bit length repeat",C.mode=30;break}for(;ue--;)C.lens[C.have++]=E}}if(C.mode===30)break;if(C.lens[256]===0){D.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,ge={bits:C.lenbits},ve=p(m,C.lens,0,C.nlen,C.lencode,0,C.work,ge),C.lenbits=ge.bits,ve){D.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,ge={bits:C.distbits},ve=p(y,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,ge),C.distbits=ge.bits,ve){D.msg="invalid distances set",C.mode=30;break}if(C.mode=20,H===6)break e;case 20:C.mode=21;case 21:if(6<=Q&&258<=Z){D.next_out=K,D.avail_out=Z,D.next_in=B,D.avail_in=Q,C.hold=A,C.bits=L,f(D,ae),K=D.next_out,z=D.output,Z=D.avail_out,B=D.next_in,M=D.input,Q=D.avail_in,A=C.hold,L=C.bits,C.mode===12&&(C.back=-1);break}for(C.back=0;be=(W=C.lencode[A&(1<<C.lenbits)-1])>>>16&255,le=65535&W,!((ne=W>>>24)<=L);){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if(be&&(240&be)==0){for(ie=ne,Te=be,Le=le;be=(W=C.lencode[Le+((A&(1<<ie+Te)-1)>>ie)])>>>16&255,le=65535&W,!(ie+(ne=W>>>24)<=L);){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}A>>>=ie,L-=ie,C.back+=ie}if(A>>>=ne,L-=ne,C.back+=ne,C.length=le,be===0){C.mode=26;break}if(32&be){C.back=-1,C.mode=12;break}if(64&be){D.msg="invalid literal/length code",C.mode=30;break}C.extra=15&be,C.mode=22;case 22:if(C.extra){for(Y=C.extra;L<Y;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}C.length+=A&(1<<C.extra)-1,A>>>=C.extra,L-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;be=(W=C.distcode[A&(1<<C.distbits)-1])>>>16&255,le=65535&W,!((ne=W>>>24)<=L);){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if((240&be)==0){for(ie=ne,Te=be,Le=le;be=(W=C.distcode[Le+((A&(1<<ie+Te)-1)>>ie)])>>>16&255,le=65535&W,!(ie+(ne=W>>>24)<=L);){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}A>>>=ie,L-=ie,C.back+=ie}if(A>>>=ne,L-=ne,C.back+=ne,64&be){D.msg="invalid distance code",C.mode=30;break}C.offset=le,C.extra=15&be,C.mode=24;case 24:if(C.extra){for(Y=C.extra;L<Y;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}C.offset+=A&(1<<C.extra)-1,A>>>=C.extra,L-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){D.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(Z===0)break e;if(ue=ae-Z,C.offset>ue){if((ue=C.offset-ue)>C.whave&&C.sane){D.msg="invalid distance too far back",C.mode=30;break}Ce=ue>C.wnext?(ue-=C.wnext,C.wsize-ue):C.wnext-ue,ue>C.length&&(ue=C.length),fe=C.window}else fe=z,Ce=K-C.offset,ue=C.length;for(Z<ue&&(ue=Z),Z-=ue,C.length-=ue;z[K++]=fe[Ce++],--ue;);C.length===0&&(C.mode=21);break;case 26:if(Z===0)break e;z[K++]=C.length,Z--,C.mode=21;break;case 27:if(C.wrap){for(;L<32;){if(Q===0)break e;Q--,A|=M[B++]<<L,L+=8}if(ae-=Z,D.total_out+=ae,C.total+=ae,ae&&(D.adler=C.check=C.flags?h(C.check,z,ae,K-ae):u(C.check,z,ae,K-ae)),ae=Z,(C.flags?A:j(A))!==C.check){D.msg="incorrect data check",C.mode=30;break}L=A=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;L<32;){if(Q===0)break e;Q--,A+=M[B++]<<L,L+=8}if(A!==(4294967295&C.total)){D.msg="incorrect length check",C.mode=30;break}L=A=0}C.mode=29;case 29:ve=1;break e;case 30:ve=-3;break e;case 31:return-4;default:return v}return D.next_out=K,D.avail_out=Z,D.next_in=B,D.avail_in=Q,C.hold=A,C.bits=L,(C.wsize||ae!==D.avail_out&&C.mode<30&&(C.mode<27||H!==4))&&V(D,D.output,D.next_out,ae-D.avail_out)?(C.mode=31,-4):(J-=D.avail_in,ae-=D.avail_out,D.total_in+=J,D.total_out+=ae,C.total+=ae,C.wrap&&ae&&(D.adler=C.check=C.flags?h(C.check,z,ae,D.next_out-ae):u(C.check,z,ae,D.next_out-ae)),D.data_type=C.bits+(C.last?64:0)+(C.mode===12?128:0)+(C.mode===20||C.mode===15?256:0),(J==0&&ae===0||H===4)&&ve===b&&(ve=-5),ve)},l.inflateEnd=function(D){if(!D||!D.state)return v;var H=D.state;return H.window&&(H.window=null),D.state=null,b},l.inflateGetHeader=function(D,H){var C;return D&&D.state?(2&(C=D.state).wrap)==0?v:((C.head=H).done=!1,b):v},l.inflateSetDictionary=function(D,H){var C,M=H.length;return D&&D.state?(C=D.state).wrap!==0&&C.mode!==11?v:C.mode===11&&u(1,H,M,0)!==C.check?-3:V(D,H,M,M)?(C.mode=31,-4):(C.havedict=1,b):v},l.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(s,a,l){var c=s("../utils/common"),u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];a.exports=function(m,y,b,v,S,_,w,j){var N,T,R,$,F,q,I,U,P,V=j.bits,D=0,H=0,C=0,M=0,z=0,B=0,K=0,Q=0,Z=0,A=0,L=null,J=0,ae=new c.Buf16(16),ue=new c.Buf16(16),Ce=null,fe=0;for(D=0;D<=15;D++)ae[D]=0;for(H=0;H<v;H++)ae[y[b+H]]++;for(z=V,M=15;1<=M&&ae[M]===0;M--);if(M<z&&(z=M),M===0)return S[_++]=20971520,S[_++]=20971520,j.bits=1,0;for(C=1;C<M&&ae[C]===0;C++);for(z<C&&(z=C),D=Q=1;D<=15;D++)if(Q<<=1,(Q-=ae[D])<0)return-1;if(0<Q&&(m===0||M!==1))return-1;for(ue[1]=0,D=1;D<15;D++)ue[D+1]=ue[D]+ae[D];for(H=0;H<v;H++)y[b+H]!==0&&(w[ue[y[b+H]]++]=H);if(q=m===0?(L=Ce=w,19):m===1?(L=u,J-=257,Ce=h,fe-=257,256):(L=f,Ce=p,-1),D=C,F=_,K=H=A=0,R=-1,$=(Z=1<<(B=z))-1,m===1&&852<Z||m===2&&592<Z)return 1;for(;;){for(I=D-K,P=w[H]<q?(U=0,w[H]):w[H]>q?(U=Ce[fe+w[H]],L[J+w[H]]):(U=96,0),N=1<<D-K,C=T=1<<B;S[F+(A>>K)+(T-=N)]=I<<24|U<<16|P|0,T!==0;);for(N=1<<D-1;A&N;)N>>=1;if(N!==0?(A&=N-1,A+=N):A=0,H++,--ae[D]==0){if(D===M)break;D=y[b+w[H]]}if(z<D&&(A&$)!==R){for(K===0&&(K=z),F+=C,Q=1<<(B=D-K);B+K<M&&!((Q-=ae[B+K])<=0);)B++,Q<<=1;if(Z+=1<<B,m===1&&852<Z||m===2&&592<Z)return 1;S[R=A&$]=z<<24|B<<16|F-_|0}}return A!==0&&(S[F+A]=D-K<<24|64<<16|0),j.bits=z,0}},{"../utils/common":41}],51:[function(s,a,l){a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(s,a,l){var c=s("../utils/common"),u=0,h=1;function f(W){for(var oe=W.length;0<=--oe;)W[oe]=0}var p=0,m=29,y=256,b=y+1+m,v=30,S=19,_=2*b+1,w=15,j=16,N=7,T=256,R=16,$=17,F=18,q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],V=new Array(2*(b+2));f(V);var D=new Array(2*v);f(D);var H=new Array(512);f(H);var C=new Array(256);f(C);var M=new Array(m);f(M);var z,B,K,Q=new Array(v);function Z(W,oe,re,ee,de){this.static_tree=W,this.extra_bits=oe,this.extra_base=re,this.elems=ee,this.max_length=de,this.has_stree=W&&W.length}function A(W,oe){this.dyn_tree=W,this.max_code=0,this.stat_desc=oe}function L(W){return W<256?H[W]:H[256+(W>>>7)]}function J(W,oe){W.pending_buf[W.pending++]=255&oe,W.pending_buf[W.pending++]=oe>>>8&255}function ae(W,oe,re){W.bi_valid>j-re?(W.bi_buf|=oe<<W.bi_valid&65535,J(W,W.bi_buf),W.bi_buf=oe>>j-W.bi_valid,W.bi_valid+=re-j):(W.bi_buf|=oe<<W.bi_valid&65535,W.bi_valid+=re)}function ue(W,oe,re){ae(W,re[2*oe],re[2*oe+1])}function Ce(W,oe){for(var re=0;re|=1&W,W>>>=1,re<<=1,0<--oe;);return re>>>1}function fe(W,oe,re){var ee,de,me=new Array(w+1),Be=0;for(ee=1;ee<=w;ee++)me[ee]=Be=Be+re[ee-1]<<1;for(de=0;de<=oe;de++){var Re=W[2*de+1];Re!==0&&(W[2*de]=Ce(me[Re]++,Re))}}function ne(W){var oe;for(oe=0;oe<b;oe++)W.dyn_ltree[2*oe]=0;for(oe=0;oe<v;oe++)W.dyn_dtree[2*oe]=0;for(oe=0;oe<S;oe++)W.bl_tree[2*oe]=0;W.dyn_ltree[2*T]=1,W.opt_len=W.static_len=0,W.last_lit=W.matches=0}function be(W){8<W.bi_valid?J(W,W.bi_buf):0<W.bi_valid&&(W.pending_buf[W.pending++]=W.bi_buf),W.bi_buf=0,W.bi_valid=0}function le(W,oe,re,ee){var de=2*oe,me=2*re;return W[de]<W[me]||W[de]===W[me]&&ee[oe]<=ee[re]}function ie(W,oe,re){for(var ee=W.heap[re],de=re<<1;de<=W.heap_len&&(de<W.heap_len&&le(oe,W.heap[de+1],W.heap[de],W.depth)&&de++,!le(oe,ee,W.heap[de],W.depth));)W.heap[re]=W.heap[de],re=de,de<<=1;W.heap[re]=ee}function Te(W,oe,re){var ee,de,me,Be,Re=0;if(W.last_lit!==0)for(;ee=W.pending_buf[W.d_buf+2*Re]<<8|W.pending_buf[W.d_buf+2*Re+1],de=W.pending_buf[W.l_buf+Re],Re++,ee===0?ue(W,de,oe):(ue(W,(me=C[de])+y+1,oe),(Be=q[me])!==0&&ae(W,de-=M[me],Be),ue(W,me=L(--ee),re),(Be=I[me])!==0&&ae(W,ee-=Q[me],Be)),Re<W.last_lit;);ue(W,T,oe)}function Le(W,oe){var re,ee,de,me=oe.dyn_tree,Be=oe.stat_desc.static_tree,Re=oe.stat_desc.has_stree,Pe=oe.stat_desc.elems,Je=-1;for(W.heap_len=0,W.heap_max=_,re=0;re<Pe;re++)me[2*re]!==0?(W.heap[++W.heap_len]=Je=re,W.depth[re]=0):me[2*re+1]=0;for(;W.heap_len<2;)me[2*(de=W.heap[++W.heap_len]=Je<2?++Je:0)]=1,W.depth[de]=0,W.opt_len--,Re&&(W.static_len-=Be[2*de+1]);for(oe.max_code=Je,re=W.heap_len>>1;1<=re;re--)ie(W,me,re);for(de=Pe;re=W.heap[1],W.heap[1]=W.heap[W.heap_len--],ie(W,me,1),ee=W.heap[1],W.heap[--W.heap_max]=re,W.heap[--W.heap_max]=ee,me[2*de]=me[2*re]+me[2*ee],W.depth[de]=(W.depth[re]>=W.depth[ee]?W.depth[re]:W.depth[ee])+1,me[2*re+1]=me[2*ee+1]=de,W.heap[1]=de++,ie(W,me,1),2<=W.heap_len;);W.heap[--W.heap_max]=W.heap[1],(function(We,Et){var Wt,dt,yt,ft,Tt,sn,wt=Et.dyn_tree,Un=Et.max_code,Lt=Et.stat_desc.static_tree,qt=Et.stat_desc.has_stree,un=Et.stat_desc.extra_bits,yn=Et.stat_desc.extra_base,_t=Et.stat_desc.max_length,jt=0;for(ft=0;ft<=w;ft++)We.bl_count[ft]=0;for(wt[2*We.heap[We.heap_max]+1]=0,Wt=We.heap_max+1;Wt<_;Wt++)_t<(ft=wt[2*wt[2*(dt=We.heap[Wt])+1]+1]+1)&&(ft=_t,jt++),wt[2*dt+1]=ft,Un<dt||(We.bl_count[ft]++,Tt=0,yn<=dt&&(Tt=un[dt-yn]),sn=wt[2*dt],We.opt_len+=sn*(ft+Tt),qt&&(We.static_len+=sn*(Lt[2*dt+1]+Tt)));if(jt!==0){do{for(ft=_t-1;We.bl_count[ft]===0;)ft--;We.bl_count[ft]--,We.bl_count[ft+1]+=2,We.bl_count[_t]--,jt-=2}while(0<jt);for(ft=_t;ft!==0;ft--)for(dt=We.bl_count[ft];dt!==0;)Un<(yt=We.heap[--Wt])||(wt[2*yt+1]!==ft&&(We.opt_len+=(ft-wt[2*yt+1])*wt[2*yt],wt[2*yt+1]=ft),dt--)}})(W,oe),fe(me,Je,W.bl_count)}function E(W,oe,re){var ee,de,me=-1,Be=oe[1],Re=0,Pe=7,Je=4;for(Be===0&&(Pe=138,Je=3),oe[2*(re+1)+1]=65535,ee=0;ee<=re;ee++)de=Be,Be=oe[2*(ee+1)+1],++Re<Pe&&de===Be||(Re<Je?W.bl_tree[2*de]+=Re:de!==0?(de!==me&&W.bl_tree[2*de]++,W.bl_tree[2*R]++):Re<=10?W.bl_tree[2*$]++:W.bl_tree[2*F]++,me=de,Je=(Re=0)===Be?(Pe=138,3):de===Be?(Pe=6,3):(Pe=7,4))}function ve(W,oe,re){var ee,de,me=-1,Be=oe[1],Re=0,Pe=7,Je=4;for(Be===0&&(Pe=138,Je=3),ee=0;ee<=re;ee++)if(de=Be,Be=oe[2*(ee+1)+1],!(++Re<Pe&&de===Be)){if(Re<Je)for(;ue(W,de,W.bl_tree),--Re!=0;);else de!==0?(de!==me&&(ue(W,de,W.bl_tree),Re--),ue(W,R,W.bl_tree),ae(W,Re-3,2)):Re<=10?(ue(W,$,W.bl_tree),ae(W,Re-3,3)):(ue(W,F,W.bl_tree),ae(W,Re-11,7));me=de,Je=(Re=0)===Be?(Pe=138,3):de===Be?(Pe=6,3):(Pe=7,4)}}f(Q);var ge=!1;function Y(W,oe,re,ee){ae(W,(p<<1)+(ee?1:0),3),(function(de,me,Be,Re){be(de),J(de,Be),J(de,~Be),c.arraySet(de.pending_buf,de.window,me,Be,de.pending),de.pending+=Be})(W,oe,re)}l._tr_init=function(W){ge||((function(){var oe,re,ee,de,me,Be=new Array(w+1);for(de=ee=0;de<m-1;de++)for(M[de]=ee,oe=0;oe<1<<q[de];oe++)C[ee++]=de;for(C[ee-1]=de,de=me=0;de<16;de++)for(Q[de]=me,oe=0;oe<1<<I[de];oe++)H[me++]=de;for(me>>=7;de<v;de++)for(Q[de]=me<<7,oe=0;oe<1<<I[de]-7;oe++)H[256+me++]=de;for(re=0;re<=w;re++)Be[re]=0;for(oe=0;oe<=143;)V[2*oe+1]=8,oe++,Be[8]++;for(;oe<=255;)V[2*oe+1]=9,oe++,Be[9]++;for(;oe<=279;)V[2*oe+1]=7,oe++,Be[7]++;for(;oe<=287;)V[2*oe+1]=8,oe++,Be[8]++;for(fe(V,b+1,Be),oe=0;oe<v;oe++)D[2*oe+1]=5,D[2*oe]=Ce(oe,5);z=new Z(V,q,y+1,b,w),B=new Z(D,I,0,v,w),K=new Z(new Array(0),U,0,S,N)})(),ge=!0),W.l_desc=new A(W.dyn_ltree,z),W.d_desc=new A(W.dyn_dtree,B),W.bl_desc=new A(W.bl_tree,K),W.bi_buf=0,W.bi_valid=0,ne(W)},l._tr_stored_block=Y,l._tr_flush_block=function(W,oe,re,ee){var de,me,Be=0;0<W.level?(W.strm.data_type===2&&(W.strm.data_type=(function(Re){var Pe,Je=4093624447;for(Pe=0;Pe<=31;Pe++,Je>>>=1)if(1&Je&&Re.dyn_ltree[2*Pe]!==0)return u;if(Re.dyn_ltree[18]!==0||Re.dyn_ltree[20]!==0||Re.dyn_ltree[26]!==0)return h;for(Pe=32;Pe<y;Pe++)if(Re.dyn_ltree[2*Pe]!==0)return h;return u})(W)),Le(W,W.l_desc),Le(W,W.d_desc),Be=(function(Re){var Pe;for(E(Re,Re.dyn_ltree,Re.l_desc.max_code),E(Re,Re.dyn_dtree,Re.d_desc.max_code),Le(Re,Re.bl_desc),Pe=S-1;3<=Pe&&Re.bl_tree[2*P[Pe]+1]===0;Pe--);return Re.opt_len+=3*(Pe+1)+5+5+4,Pe})(W),de=W.opt_len+3+7>>>3,(me=W.static_len+3+7>>>3)<=de&&(de=me)):de=me=re+5,re+4<=de&&oe!==-1?Y(W,oe,re,ee):W.strategy===4||me===de?(ae(W,2+(ee?1:0),3),Te(W,V,D)):(ae(W,4+(ee?1:0),3),(function(Re,Pe,Je,We){var Et;for(ae(Re,Pe-257,5),ae(Re,Je-1,5),ae(Re,We-4,4),Et=0;Et<We;Et++)ae(Re,Re.bl_tree[2*P[Et]+1],3);ve(Re,Re.dyn_ltree,Pe-1),ve(Re,Re.dyn_dtree,Je-1)})(W,W.l_desc.max_code+1,W.d_desc.max_code+1,Be+1),Te(W,W.dyn_ltree,W.dyn_dtree)),ne(W),ee&&be(W)},l._tr_tally=function(W,oe,re){return W.pending_buf[W.d_buf+2*W.last_lit]=oe>>>8&255,W.pending_buf[W.d_buf+2*W.last_lit+1]=255&oe,W.pending_buf[W.l_buf+W.last_lit]=255&re,W.last_lit++,oe===0?W.dyn_ltree[2*re]++:(W.matches++,oe--,W.dyn_ltree[2*(C[re]+y+1)]++,W.dyn_dtree[2*L(oe)]++),W.last_lit===W.lit_bufsize-1},l._tr_align=function(W){ae(W,2,3),ue(W,T,V),(function(oe){oe.bi_valid===16?(J(oe,oe.bi_buf),oe.bi_buf=0,oe.bi_valid=0):8<=oe.bi_valid&&(oe.pending_buf[oe.pending++]=255&oe.bi_buf,oe.bi_buf>>=8,oe.bi_valid-=8)})(W)}},{"../utils/common":41}],53:[function(s,a,l){a.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(s,a,l){(function(c){(function(u,h){if(!u.setImmediate){var f,p,m,y,b=1,v={},S=!1,_=u.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(u);w=w&&w.setTimeout?w:u,f={}.toString.call(u.process)==="[object process]"?function(R){process.nextTick(function(){N(R)})}:(function(){if(u.postMessage&&!u.importScripts){var R=!0,$=u.onmessage;return u.onmessage=function(){R=!1},u.postMessage("","*"),u.onmessage=$,R}})()?(y="setImmediate$"+Math.random()+"$",u.addEventListener?u.addEventListener("message",T,!1):u.attachEvent("onmessage",T),function(R){u.postMessage(y+R,"*")}):u.MessageChannel?((m=new MessageChannel).port1.onmessage=function(R){N(R.data)},function(R){m.port2.postMessage(R)}):_&&"onreadystatechange"in _.createElement("script")?(p=_.documentElement,function(R){var $=_.createElement("script");$.onreadystatechange=function(){N(R),$.onreadystatechange=null,p.removeChild($),$=null},p.appendChild($)}):function(R){setTimeout(N,0,R)},w.setImmediate=function(R){typeof R!="function"&&(R=new Function(""+R));for(var $=new Array(arguments.length-1),F=0;F<$.length;F++)$[F]=arguments[F+1];var q={callback:R,args:$};return v[b]=q,f(b),b++},w.clearImmediate=j}function j(R){delete v[R]}function N(R){if(S)setTimeout(N,0,R);else{var $=v[R];if($){S=!0;try{(function(F){var q=F.callback,I=F.args;switch(I.length){case 0:q();break;case 1:q(I[0]);break;case 2:q(I[0],I[1]);break;case 3:q(I[0],I[1],I[2]);break;default:q.apply(h,I)}})($)}finally{j(R),S=!1}}}}function T(R){R.source===u&&typeof R.data=="string"&&R.data.indexOf(y)===0&&N(+R.data.slice(y.length))}})(typeof self>"u"?c===void 0?this:c:self)}).call(this,typeof Tu<"u"?Tu:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(xp)),xp.exports}var j2=S2();const C2=Kp(j2),Rx=n=>`${Io}/functions/v1/${n}`,oi={async fetchMyBackups(){const{data:n,error:e}=await Ee.from("account_backups").select("id, generation, recipe_count, label, created_at").order("generation",{ascending:!0});if(e)throw e;return n||[]},async adminFetchAllBackups(){const{data:n,error:e}=await Ee.rpc("admin_list_all_backups");if(e)throw e;return n||[]},async adminTriggerBackupAll(){const{data:n}=await Ee.auth.getSession(),e=n?.session?.access_token;if(!e)throw new Error("");const s=Rx("scheduled-backup");console.log("[backupService] Calling Edge Function:",s);const a=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({})}),l=await a.text();if(console.log("[backupService] Response status:",a.status,l),!a.ok)throw new Error(` (${a.status}): ${l}`);try{return JSON.parse(l)}catch{return{ok:!0,message:l}}},async adminTriggerBackupForUser(n){const{data:e}=await Ee.auth.getSession(),s=e?.session?.access_token;if(!s)throw new Error("");const a=Rx("scheduled-backup");console.log("[backupService] Calling Edge Function for user:",n,a);const l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({user_id:n})}),c=await l.text();if(console.log("[backupService] Response status:",l.status,c),!l.ok)throw new Error(` (${l.status}): ${c}`);try{return JSON.parse(c)}catch{return{ok:!0,message:c}}},async adminFetchBackupData(n){const{data:e,error:s}=await Ee.from("account_backups").select("id, generation, recipe_count, label, created_at, backup_data, user_id").eq("id",n).single();if(s)throw s;return e},downloadBackupAsJson(n,e,s){const a=String(s||"unknown").replace(/[^\w]/g,"_"),l=String(e||"data").replace(/[^\w\-]/g,"_"),c=new Date().toISOString().slice(0,10),u=`backup_${a}_${l}_${c}.json`,h=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),f=URL.createObjectURL(h),p=document.createElement("a");p.href=f,p.download=u,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(f)},async downloadAllBackupsAsZip(n){if(!n||Object.keys(n).length===0)return;const s=`all_users_backup_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.zip`,a=new C2;Object.entries(n).forEach(([h,f])=>{const p=h.replace(/[\\/:*?"<>|]/g,"_");a.file(`backup_${p}.json`,JSON.stringify(f,null,2))});const l=await a.generateAsync({type:"blob"}),c=URL.createObjectURL(l),u=document.createElement("a");u.href=c,u.download=s,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(c)}},Es=(n,e="")=>{const s=String(n||e||"");if(!s)return null;const a=s.match(/(.*)(_[a-zA-Z0-9]{8})$/);return a?r.jsxs(r.Fragment,{children:[a[1],r.jsx("span",{style:{opacity:.45,fontSize:"0.9em",fontWeight:"normal"},children:a[2]})]}):s},k2=()=>{const{user:n}=ms(),[e,s]=k.useState([]),[a,l]=k.useState(!0),[c,u]=k.useState(""),[h,f]=k.useState({type:"",message:""}),[p,m]=k.useState(!1),[y,b]=k.useState(!1),[v,S]=k.useState(new Set),[_,w]=k.useState(null),[j,N]=k.useState(!1),[T,R]=k.useState(!1),[$,F]=k.useState({type:"",message:""}),[q,I]=k.useState(null),[U,P]=k.useState(!1),V=k.useCallback(async()=>{l(!0),u("");try{const A=await oi.adminFetchAllBackups();s(A||[])}catch(A){console.error(A),u(": "+(A?.message||String(A)))}finally{l(!1)}},[]);k.useEffect(()=>{V()},[V]);const D=async()=>{if(!p){m(!0),f({type:"info",message:"..."});try{const A=await oi.adminTriggerBackupAll();f({type:"success",message:A?.message||""}),await V()}catch(A){console.error(A),f({type:"error",message:": "+(A?.message||String(A))})}finally{m(!1)}}},H=async(A,L)=>{if(!v.has(A)){S(J=>new Set([...J,A])),f({type:"info",message:`${L||A} ...`});try{const J=await oi.adminTriggerBackupForUser(A);f({type:"success",message:J?.message||`${L||A} `}),await V()}catch(J){console.error(J),f({type:"error",message:`: ${J?.message||String(J)}`})}finally{S(J=>{const ae=new Set(J);return ae.delete(A),ae})}}},C=async A=>{try{f({type:"info",message:"..."});const L=await oi.adminFetchBackupData(A.id||A.backup_id);oi.downloadBackupAsJson(L.backup_data,A.label,A.display_id||A.user_id),f({type:"success",message:"JSON"})}catch(L){console.error(L),f({type:"error",message:": "+(L?.message||String(L))})}},M=async()=>{if(!(y||e.length===0)){b(!0),f({type:"info",message:"..."});try{const A=new Map;for(const Ce of e){const fe=A.get(Ce.user_id);(!fe||new Date(Ce.created_at)>new Date(fe.created_at))&&A.set(Ce.user_id,Ce)}const L=Array.from(A.values());if(L.length===0){f({type:"info",message:""});return}const J={};let ae=0,ue=0;for(let Ce=0;Ce<L.length;Ce++){const fe=L[Ce],ne=Es(fe.display_id)||fe.user_id;f({type:"info",message:`... ${Ce+1}/${L.length} (${ne})`});try{const be=await oi.adminFetchBackupData(fe.id||fe.backup_id);J[ne]={user_id:fe.user_id,display_id:Es(fe.display_id)||null,email:fe.email||null,generation:fe.generation,created_at:fe.created_at,label:fe.label,data:be.backup_data||[]},ae++}catch(be){console.error(`Failed to fetch data for user ${fe.user_id}:`,be),ue++}}if(ae===0)throw new Error("");await oi.downloadAllBackupsAsZip(J),f({type:"success",message:`: ${ae}${ue>0?`${ue}`:""}`})}catch(A){console.error(A),f({type:"error",message:": "+(A?.message||String(A))})}finally{b(!1)}}},z=async A=>{w({backupId:A.id||A.backup_id,displayId:Es(A.display_id)||A.user_id,generation:A.generation,label:A.label,recipeCount:A.recipe_count}),F({type:"",message:""})},B=async()=>{if(!(!_||T)){R(!0),F({type:"info",message:"..."});try{const L=(await oi.adminFetchBackupData(_.backupId))?.backup_data;if(!Array.isArray(L))throw new Error("");F({type:"info",message:`${L.length}...`});const J=await jn.importRecipes(L);F({type:"success",message:`: ${J.count}${J.errors?.length>0?`${J.errors.length}`:""}`})}catch(A){console.error(A),F({type:"error",message:": "+(A?.message||String(A))})}finally{R(!1)}}},K=async A=>{P(!0);try{const L=await oi.adminFetchBackupData(A.id||A.backup_id);I({...A,backup_data:L.backup_data})}catch{f({type:"error",message:""})}finally{P(!1)}},Q=e.reduce((A,L)=>{const J=L.user_id;return A[J]||(A[J]={displayId:L.display_id,email:L.email,userId:J,gens:[]}),A[J].gens.push(L),A},{}),Z=Object.values(Q).sort((A,L)=>String(A.displayId||"").localeCompare(String(L.displayId||"")));return n?.role!=="admin"?r.jsx("div",{className:"backup-management-empty",children:r.jsx("p",{children:" "})}):r.jsxs("div",{className:"backup-management",children:[r.jsxs("div",{className:"backup-header",children:[r.jsxs("div",{className:"backup-header-info",children:[r.jsx("h3",{className:"backup-title",children:" "}),r.jsx("p",{className:"backup-desc",children:"3"})]}),r.jsxs("div",{className:"backup-header-actions",children:[r.jsx(he,{variant:"secondary",size:"sm",onClick:V,disabled:a||y,children:" "}),r.jsx(he,{variant:"secondary",size:"sm",onClick:M,disabled:a||y||e.length===0,title:"ZIP",children:y?"...":" DL (ZIP)"}),r.jsx(he,{variant:"primary",onClick:D,disabled:p||y,children:p?"...":" "})]})]}),h.message&&r.jsx("div",{className:`backup-status backup-status--${h.type}`,children:h.message}),c&&r.jsx("div",{className:"backup-status backup-status--error",children:c}),a?r.jsx("div",{className:"backup-loading",children:"..."}):Z.length===0?r.jsxs("div",{className:"backup-empty",children:[r.jsx("p",{children:""}),r.jsx("p",{children:""})]}):r.jsx("div",{className:"backup-user-list",children:Z.map(A=>r.jsxs("div",{className:"backup-user-card",children:[r.jsxs("div",{className:"backup-user-header",children:[r.jsxs("div",{className:"backup-user-info",children:[r.jsxs("span",{className:"backup-user-id",children:[" ",Es(A.displayId)||A.userId]}),A.email&&r.jsx("span",{className:"backup-user-email",children:A.email})]}),r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>H(A.userId,Es(A.displayId)),disabled:v.has(A.userId)||p,children:v.has(A.userId)?"...":""})]}),r.jsx("div",{className:"backup-gen-list",children:[1,2,3].map(L=>{const J=A.gens.find(ae=>ae.generation===L);return r.jsxs("div",{className:`backup-gen-item ${J?"backup-gen-item--exists":"backup-gen-item--empty"}`,children:[r.jsx("div",{className:"backup-gen-number",children:r.jsxs("span",{className:"backup-gen-badge",children:["",L,""]})}),J?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"backup-gen-meta",children:[r.jsx("div",{className:"backup-gen-label",children:J.label}),r.jsx("div",{className:"backup-gen-date",children:new Date(J.created_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),r.jsxs("div",{className:"backup-gen-count",children:[": ",r.jsx("strong",{children:J.recipe_count}),""]})]}),r.jsxs("div",{className:"backup-gen-actions",children:[r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>K(J),disabled:U,title:"",children:" "}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>C(J),title:"JSON",children:" DL"}),r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>z(J),title:"",children:" "})]})]}):r.jsx("div",{className:"backup-gen-empty-text",children:""})]},L)})})]},A.userId))}),r.jsxs("div",{className:"backup-cron-info",children:[r.jsx("div",{className:"backup-cron-title",children:" "}),r.jsxs("ul",{className:"backup-cron-list",children:[r.jsxs("li",{children:[" ",r.jsx("strong",{children:"0:00 JST"}),"UTC 15:00"]}),r.jsxs("li",{children:[" Supabase  ",r.jsx("strong",{children:"Database  Cron Jobs"})," "]}),r.jsx("li",{children:"3"})]}),r.jsxs("div",{className:"backup-cron-sql",children:[r.jsx("div",{className:"backup-cron-sql-label",children:"cronSupabase SQL Editor:"}),r.jsx("code",{className:"backup-cron-code",children:`SELECT cron.schedule('daily-account-backup', '0 15 * * *', $$SELECT net.http_post(url:='<SUPABASE_URL>/functions/v1/scheduled-backup', headers:='{"Content-Type":"application/json","Authorization":"Bearer <ANON_KEY>"}', body:='{}'::jsonb) AS request_id;$$);`})]})]}),r.jsx(rn,{isOpen:!!_,onClose:()=>{T||w(null)},title:"",size:"medium",showCloseButton:!T,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"14px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),r.jsxs("div",{className:"restore-info-box",children:[r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",_?.displayId]}),r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",_?.generation,""]}),r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",_?.label]}),r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",_?.recipeCount,""]})]}),$.message&&r.jsx("div",{className:`backup-status backup-status--${$.type}`,children:$.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>w(null),disabled:T,children:""}),r.jsx(he,{variant:"primary",onClick:B,disabled:T||$.type==="success",children:T?"...":""})]})]})}),r.jsx(rn,{isOpen:!!q,onClose:()=>I(null),title:` - ${q?.generation}`,size:"large",children:q&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.85rem",color:"#555",display:"flex",gap:"16px",flexWrap:"wrap"},children:[r.jsxs("span",{children:[": ",r.jsx("strong",{children:Es(q.display_id)})]}),r.jsxs("span",{children:[": ",r.jsxs("strong",{children:[q.recipe_count,""]})]}),r.jsxs("span",{children:[": ",r.jsx("strong",{children:new Date(q.created_at).toLocaleString("ja-JP")})]})]}),r.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",background:"#f8f9fa",borderRadius:"8px",padding:"12px"},children:r.jsxs("table",{className:"backup-preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"#"}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:(Array.isArray(q.backup_data)?q.backup_data:[]).map((A,L)=>r.jsxs("tr",{children:[r.jsx("td",{children:L+1}),r.jsx("td",{style:{fontWeight:500},children:A.title||"-"}),r.jsx("td",{children:A.category||A.course||"-"}),r.jsx("td",{children:A.created_at?new Date(A.created_at).toLocaleDateString("ja-JP"):"-"})]},A.id||L))})]})}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(he,{variant:"secondary",onClick:()=>C(q),children:" JSON"}),r.jsx(he,{variant:"ghost",onClick:()=>I(null),children:""})]})]})})]})},Ox=n=>{const e=String(n||"");return e?e.slice(0,7).replace("/","-"):""},N2=({onBack:n})=>{const[e,s]=bc(),{user:a}=ms(),[l,c]=k.useState("price"),[u,h]=k.useState(!1),[f,p]=k.useState(!1),[m,y]=k.useState(null),[b,v]=k.useState(null),[S,_]=k.useState(!1),[w,j]=k.useState(!1),[N,T]=k.useState({total:0,done:0,current:""}),[R,$]=k.useState(null),[F,q]=k.useState(!1),[I,U]=k.useState(!1),[P,V]=k.useState({total:0,done:0,current:""}),[D,H]=k.useState(null),[C,M]=k.useState(!1),[z,B]=k.useState(!1),[K,Q]=k.useState(null),[Z,A]=k.useState(!1),[L,J]=k.useState(!1),[ae,ue]=k.useState(null),[Ce,fe]=k.useState(null),[ne,be]=k.useState({type:"",message:""}),[le,ie]=k.useState(!1),[Te,Le]=k.useState([]),[E,ve]=k.useState(!1),[ge,Y]=k.useState(null),[W,oe]=k.useState({type:"",message:""}),[re,ee]=k.useState(null),[de,me]=k.useState(!1),[Be,Re]=k.useState(!1),[Pe,Je]=k.useState(!1),[We,Et]=k.useState([]),[Wt,dt]=k.useState(!1),[yt,ft]=k.useState(""),[Tt,sn]=k.useState(""),[wt,Un]=k.useState(!1),[Lt,qt]=k.useState({total:0,done:0,current:""}),[un,yn]=k.useState(null),[_t,jt]=k.useState(!1),[Kt,Ft]=k.useState(!1),[dn,Ht]=k.useState(!1),[gn,hn]=k.useState(!1),[an,Dn]=k.useState({type:"",message:""}),[Vt,Cn]=k.useState(!1),[It,zn]=k.useState(new Map),[qn,fn]=k.useState([]),[Se,nt]=k.useState(""),[te,ze]=k.useState(""),[Ae,Qe]=k.useState(""),ce=Ie.useMemo(()=>{if(!Se)return[];const je=It.get(Se)||[],rt=new Set;return je.forEach(mt=>{const Dt=Ox(mt?.dateStr);Dt&&rt.add(Dt)}),Array.from(rt).sort((mt,Dt)=>Dt.localeCompare(mt))},[It,Se]);k.useEffect(()=>{if(Ae){if(!Se){Qe("");return}ce.length>0&&!ce.includes(Ae)&&Qe("")}},[ce,Ae,Se]);const[se,xe]=k.useState({key:"dateStr",direction:"desc"}),[Ne,Ke]=k.useState("");k.useEffect(()=>{const je=e.get("tab");(je==="price"||je==="ingredients"||je==="csv-import"||je==="duplicates")&&c(je)},[]);const tt=je=>{let rt="asc";se.key===je&&se.direction==="asc"&&(rt="desc"),xe({key:je,direction:rt})},Ze=Ie.useMemo(()=>{let je=[...Te];if(Ne){const rt=Ne.toLowerCase().trim();je=je.filter(mt=>mt.name&&mt.name.toLowerCase().includes(rt)||mt.vendor&&mt.vendor.toLowerCase().includes(rt)||mt.dateStr&&mt.dateStr.includes(rt))}return se.key&&je.sort((rt,mt)=>{let Dt=rt[se.key]||"",vn=mt[se.key]||"";return Dt<vn?se.direction==="asc"?-1:1:Dt>vn?se.direction==="asc"?1:-1:0}),je},[Te,se,Ne]),[Xe,lt]=k.useState([]);k.useEffect(()=>{Ve()},[]),k.useEffect(()=>{let je=!0;return(async()=>{if(l==="price"){if(a?.role!=="admin"){je&&(Ft(!1),hn(!1));return}Ft(!0);try{const mt=await qp.getVoiceInputEnabled({force:!0});if(!je)return;hn(mt),Dn({type:"",message:""})}catch(mt){if(console.error("Failed to load voice feature flag:",mt),!je)return;Dn({type:"error",message:""})}finally{je&&Ft(!1)}}})(),()=>{je=!1}},[l,a?.id,a?.role]);const Pt=async je=>{if(!(a?.role!=="admin"||dn)){Ht(!0),Dn({type:"info",message:"..."});try{const rt=await qp.setVoiceInputEnabled(je);hn(rt),Dn({type:"success",message:""+(rt?"":"")+""})}catch(rt){console.error("Failed to save voice feature flag:",rt),Dn({type:"error",message:""})}finally{Ht(!1)}}},$t=async()=>{Cn(!0);try{const rt=await Pn.fetchPriceHistory()||new Map;zn(rt);const mt=[];for(const[Dt,vn]of rt.entries()){const En=new Set,An=[];if((vn||[]).forEach(on=>{const or=[String(on?.dateStr||""),String(on?.price??""),String(on?.incomingQty??""),String(on?.unit||""),String(on?.vendor||""),String(on?.displayName||"")].join("|");En.has(or)||(En.add(or),An.push(on))}),An.length<2)continue;An.sort((on,or)=>String(on?.dateStr||"").localeCompare(String(or?.dateStr||"")));const ar=An[An.length-1]||{},Rt=An.map(on=>Number(on?.price)).filter(on=>Number.isFinite(on)),Zn=Rt.length?Math.min(...Rt):null,kn=Rt.length?Math.max(...Rt):null,Yn=new Set(An.map(on=>String(on?.dateStr||""))).size,Xr=new Set(An.map(on=>String(on?.displayName||""))).size;let Zr=0;for(let on=1;on<An.length;on++){const or=Number(An[on-1]?.price),vr=Number(An[on]?.price);Number.isFinite(or)&&Number.isFinite(vr)&&or!==vr&&Zr++}mt.push({key:Dt,name:ar?.displayName||Dt,lastDate:ar?.dateStr||"",lastPrice:Number.isFinite(Number(ar?.price))?Number(ar?.price):null,lastIncomingQty:Number.isFinite(Number(ar?.incomingQty))?Number(ar?.incomingQty):null,unit:ar?.unit||"",vendor:ar?.vendor||"",rows:An.length,dates:Yn,nameVariants:Xr,minPrice:Zn,maxPrice:kn,changes:Zr})}mt.sort((Dt,vn)=>{const En=String(Dt?.lastDate||""),An=String(vn?.lastDate||"");return En!==An?An.localeCompare(En):(vn?.changes||0)!==(Dt?.changes||0)?(vn?.changes||0)-(Dt?.changes||0):(vn?.rows||0)!==(Dt?.rows||0)?(vn?.rows||0)-(Dt?.rows||0):String(Dt?.name||"").localeCompare(String(vn?.name||""),"ja")}),fn(mt),Se&&!rt.has(Se)&&nt("")}catch(je){console.error(je)}finally{Cn(!1)}};k.useEffect(()=>{l==="duplicates"&&$t()},[l]);const Ve=async()=>{ve(!0);try{const je=await Pn.getPriceListArray();Le(je);const rt=await Pn.getFileList();lt(rt)}catch(je){console.error("Failed to load price data",je)}finally{ve(!1)}},ct=je=>{je.target.files&&je.target.files[0]&&(fe(je.target.files[0]),be({type:"",message:""}))},nn=async()=>{if(!Ce)return;ie(!0),be({type:"info",message:"..."});const je=await Pn.uploadPriceList(Ce);if(je.success){be({type:"success",message:"..."});try{const{recipeService:mt}=await nd(async()=>{const{recipeService:En}=await Promise.resolve().then(()=>np);return{recipeService:En}},[]),Dt=await Pn.fetchPriceList(),vn=await mt.updateRecipeCosts(Dt);be({type:"success",message:`${vn} `})}catch(mt){console.error("Cost update failed",mt),be({type:"warning",message:""})}fe(null);const rt=document.getElementById("csv-upload-input");rt&&(rt.value=""),Ve()}else be({type:"error",message:`: ${je.error.message} `});ie(!1)},Vn=je=>{Y({message:`${je}
`,onConfirm:async()=>{ie(!0);const rt=await Pn.deletePriceFile(je);ie(!1),rt.success?(be({type:"success",message:""}),Ve()):be({type:"error",message:`: ${rt.error.message} `})}})},Xn=je=>{je&&(ee(je),me(!0),oe({type:"",message:""}))},yr=()=>{if(Be)return;me(!1),ee(null);const je=document.getElementById("backup-upload-input");je&&(je.value="")},$r=async()=>{const je=re;if(!(!je||Be)){Re(!0),oe({type:"info",message:"..."});try{const rt=await je.text(),mt=JSON.parse(rt),{recipeService:Dt}=await nd(async()=>{const{recipeService:ar}=await Promise.resolve().then(()=>np);return{recipeService:ar}},void 0),vn=await Dt.importRecipes(mt),En=Number(vn?.count||0),An=Array.isArray(vn?.errors)?vn.errors.length:0;oe({type:An>0?"warning":"success",message:`: ${En}${An>0?` / : ${An}`:""} `}),me(!1),ee(null)}catch(rt){console.error(rt),oe({type:"error",message:""})}finally{Re(!1);const rt=document.getElementById("backup-upload-input");rt&&(rt.value="")}}},Or=async()=>{j(!0),T({total:0,done:0,current:""}),$(null);try{const je=await Pn.moveAllToTrash(mt=>{T(mt)});$({type:"success",message:`: ${je.moved} `});const rt=await Pn.getFileList();lt(rt)}catch(je){console.error(je),$({type:"error",message:": "+(je?.message||String(je))})}finally{j(!1)}},Pr=async()=>{U(!0),V({total:0,done:0,current:""}),H(null);try{const je=await Pn.adminClearAllNonAdminCsvs(Dt=>{V(Dt)}),rt=`: ${je.totalDeleted} ${je.results.length} `+(je.failedUsers.length>0?` / ${je.failedUsers.length} `:"");H({type:je.failedUsers.length>0?"error":"success",message:rt,details:je});const mt=await Pn.getFileList();lt(mt)}catch(je){console.error(je),H({type:"error",message:": "+(je?.message||String(je))})}finally{U(!1)}},fr=async je=>{B(!0),Q(null);try{const rt=await Pn.adminClearTargetUserCsvs(je,Dt=>{});Q({type:"success",message:`${rt.deleted} `});const mt=await Pn.getFileList();lt(mt)}catch(rt){console.error(rt),Q({type:"error",message:": "+(rt?.message||String(rt))})}finally{B(!1),M(!1)}},qs=async()=>{J(!0),ue(null);try{const{data:je,error:rt}=await Ee.functions.invoke("admin-clear-non-admin-ingredient-master",{body:{}});if(rt)throw rt;if(je?.success){const mt=je.deletedUnitConversions??0,Dt=je.deletedCsvOverrides??0;ue({type:"success",message:`:  ${mt}  / CSV ${Dt} `})}else throw new Error(je?.error||"")}catch(je){console.error(je),ue({type:"error",message:": "+(je?.message||String(je))})}finally{J(!1)}},vi=async()=>{Je(!0),yn(null),qt({total:0,done:0,current:""}),sn(""),ft(""),jt(!1),dt(!0);try{const je=await hs.fetchAllProfiles();Et(je||[])}catch(je){console.error(je),Et([]),ft("")}finally{dt(!1)}},Os=()=>{wt||(jt(!1),Je(!1))},$a=async()=>{if(!(!Tt||wt)){Un(!0),yn({type:"info",message:"..."}),qt({total:0,done:0,current:""});try{const je=await Pn.copyPriceFilesToUser({targetUserId:Tt,onProgress:({total:Dt,done:vn,current:En})=>{qt({total:Dt||0,done:vn||0,current:En||""})}}),rt=je?.copied?.length??0,mt=je?.failed?.length??0;yn({type:mt>0?"error":"success",message:`: ${rt}${mt>0?` / : ${mt}`:""} `,failed:je?.failed||[]})}catch(je){console.error(je),yn({type:"error",message:`: ${String(je?.message||je)} `})}finally{Un(!1)}}},xi=async()=>{p(!0),v(null),y({phase:"start",message:"..."});try{const je=await Pn.adminCopyCsvsToAllUsers(rt=>{y(mt=>({...mt,...rt}))});y({phase:"progress_master",message:"..."}),await On.adminCopyMasterToAllUsers(),y({phase:"done",message:""}),v({totalTargetUsers:je.totalTargetUsers,csvResults:je.results,masterSuccess:!0})}catch(je){console.error(je),y({phase:"error",message:`: ${je.message}`})}finally{p(!1)}};return r.jsxs("div",{className:["dashboard-container","fade-in",l==="ingredients"||l==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[r.jsxs("div",{className:"dashboard-header",children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),a?.role==="admin"&&r.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[l==="csv-import"&&r.jsx(he,{variant:"secondary",onClick:()=>s({view:"inventory"}),title:"",children:" "}),r.jsx(he,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsx("div",{className:"tabs-container",children:r.jsxs("div",{className:"tabs",children:[r.jsx("button",{className:`tab ${l==="price"?"active":""} `,onClick:()=>c("price"),children:" "}),r.jsx("button",{className:`tab ${l==="ingredients"?"active":""} `,onClick:()=>c("ingredients"),children:" "}),r.jsx("button",{className:`tab ${l==="csv-import"?"active":""} `,onClick:()=>c("csv-import"),children:" CSV"}),r.jsx("button",{className:`tab ${l==="duplicates"?"active":""} `,onClick:()=>c("duplicates"),children:" "}),r.jsx("button",{className:`tab ${l==="trash"?"active":""} `,onClick:()=>c("trash"),children:" "}),a?.role==="admin"&&r.jsx("button",{className:`tab ${l==="backup-management"?"active":""} `,onClick:()=>c("backup-management"),children:" "})]})}),a?.role==="admin"&&l==="price"&&r.jsxs("div",{className:"voice-feature-card",children:[r.jsxs("div",{className:"voice-feature-card__left",children:[r.jsx("div",{className:"voice-feature-card__title",children:" Avalon API"}),r.jsx("div",{className:"voice-feature-card__desc",children:"ON/OFF"})]}),r.jsxs("div",{className:"voice-feature-card__right",children:[r.jsxs("label",{className:`voice-feature-switch ${gn?"is-on":""}`,children:[r.jsx("input",{type:"checkbox",checked:gn,onChange:je=>Pt(je.target.checked),disabled:Kt||dn}),r.jsx("span",{className:"voice-feature-switch__slider"})]}),r.jsx("div",{className:"voice-feature-card__state",children:Kt?"...":gn?": ":": "})]}),an.message&&r.jsx("div",{className:`status-msg ${an.type||"info"} `,style:{marginTop:"10px",width:"100%"},children:an.message})]}),l==="ingredients"?r.jsx(y2,{}):l==="csv-import"?r.jsx(x2,{}):l==="trash"?r.jsx(w2,{}):l==="backup-management"?r.jsx(k2,{}):l==="duplicates"?r.jsxs("div",{className:"dashboard-content",children:[r.jsxs("aside",{className:"dashboard-sidebar",children:[r.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," ",r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[qn.length.toLocaleString(),""]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[r.jsx(Mt,{placeholder:"...",value:te,onChange:je=>ze(je.target.value),style:{flex:1,fontSize:"0.9rem"}}),r.jsx(he,{variant:"secondary",size:"sm",onClick:$t,disabled:Vt,title:"",children:""})]}),r.jsx("div",{className:"dup-list",children:Vt?r.jsx("div",{className:"dup-empty",children:"..."}):qn.length===0?r.jsx("div",{className:"dup-empty",children:"2"}):qn.filter(je=>{const rt=String(te||"").trim();return rt?String(je?.name||"").includes(rt):!0}).map(je=>{const rt=je.key===Se,mt=je.minPrice!==null&&je.maxPrice!==null&&je.minPrice!==je.maxPrice;return r.jsxs("button",{type:"button",className:`dup-item ${rt?"active":""} `,onClick:()=>nt(je.key),children:[r.jsxs("div",{className:"dup-item-top",children:[r.jsx("div",{className:"dup-item-name",title:je.name,children:je.name}),mt&&r.jsx("span",{className:"dup-badge",children:""})]}),r.jsxs("div",{className:"dup-item-meta",children:[r.jsxs("span",{children:[": ",je.lastDate||"-"]}),r.jsxs("span",{children:[": ",je.rows,""]}),r.jsxs("span",{children:[": ",je.dates,""]})]}),r.jsxs("div",{className:"dup-item-meta",children:[r.jsxs("span",{children:[je.lastPrice!==null?`${Math.round(je.lastPrice).toLocaleString()} `:"-",je.unit?` / ${je.unit} `:""]}),r.jsxs("span",{children:[": ",je.lastIncomingQty!==null?Math.round(je.lastIncomingQty).toLocaleString():"-"]}),je.vendor?r.jsxs("span",{title:je.vendor,children:[": ",je.vendor]}):r.jsx("span",{children:": -"})]}),je.nameVariants>1&&r.jsxs("div",{className:"dup-item-note",children:[": ",je.nameVariants,""]})]},je.key)})})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsx("div",{className:"sidebar-title",children:" "}),r.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),r.jsxs("main",{className:"dashboard-main",children:[r.jsxs("div",{className:"main-toolbar",children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:Se?"":""})}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsxs("select",{value:Ae,onChange:je=>Qe(je.target.value),disabled:!Se,title:Se?"":"",className:"dup-month-select",children:[r.jsx("option",{value:"",children:""}),ce.map(je=>r.jsx("option",{value:je,children:je.replace("-","/")},je))]}),r.jsx(he,{variant:"secondary",size:"sm",onClick:$t,disabled:Vt,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",children:(()=>{if(!Se)return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const je=It.get(Se)||[],rt=new Set,mt=[];je.forEach(Rt=>{const Zn=[String(Rt?.dateStr||""),String(Rt?.price??""),String(Rt?.incomingQty??""),String(Rt?.unit||""),String(Rt?.vendor||""),String(Rt?.displayName||""),String(Rt?.sourceFile||"")].join("|");rt.has(Zn)||(rt.add(Zn),mt.push(Rt))}),mt.sort((Rt,Zn)=>String(Rt?.dateStr||"").localeCompare(String(Zn?.dateStr||"")));const Dt=Ae?mt.filter(Rt=>Ox(Rt?.dateStr)===Ae):mt,vn=Dt.map((Rt,Zn)=>{const kn=Zn>0?Dt[Zn-1]:null,Yn=kn?Number(kn?.price):NaN,Xr=Number(Rt?.price);let Zr=null,on=null;return Number.isFinite(Yn)&&Number.isFinite(Xr)&&(Zr=Xr-Yn,on=Yn!==0?Zr/Yn*100:null),{...Rt,_diff:Zr,_pct:on}}),En=Dt.reduce((Rt,Zn)=>{const kn=Number(Zn?.incomingQty);return Rt+(Number.isFinite(kn)?kn:0)},0),An=Dt.reduce((Rt,Zn)=>{const kn=Number(Zn?.incomingQty),Yn=Number(Zn?.price);return!Number.isFinite(kn)||!Number.isFinite(Yn)?Rt:Rt+kn*Yn},0),ar=[...vn].reverse();return r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"120px"},children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:"CSV"}),r.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),r.jsx("tbody",{children:ar.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"no-data",children:Ae?`${Ae}`:""})}):ar.map((Rt,Zn)=>{const kn=Rt?._diff,Yn=Rt?._pct,Xr=kn==null||!Number.isFinite(kn)?"-":`${kn>=0?"+":""}${Math.round(kn).toLocaleString()} `,Zr=Yn==null||!Number.isFinite(Yn)?"":` (${Yn>=0?"+":""}${Yn.toFixed(1)} %)`,on=kn==null||!Number.isFinite(kn)?"#888":kn>0?"#c92a2a":kn<0?"#2b8a3e":"#666",or=Number(Rt?.price),vr=Number.isFinite(or)?`${Math.round(or).toLocaleString()} `:"-",Ds=Number(Rt?.incomingQty),sa=Number.isFinite(Ds)?Math.round(Ds).toLocaleString():"-",gs=Number.isFinite(Ds)&&Number.isFinite(or)?Ds*or:NaN,zs=Number.isFinite(gs)?`${Math.round(gs).toLocaleString()} `:"-";return r.jsxs("tr",{children:[r.jsx("td",{className:"col-date",children:Rt?.dateStr||"-"}),r.jsx("td",{children:Rt?.vendor||"-"}),r.jsx("td",{style:{fontWeight:500},children:Rt?.displayName||"-"}),r.jsx("td",{className:"col-number",children:sa}),r.jsxs("td",{className:"col-number",children:[vr,Rt?.unit&&r.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",Rt.unit]})]}),r.jsx("td",{className:"col-number",children:zs}),r.jsxs("td",{className:"col-number",style:{color:on},children:[Xr,Zr]})]},`${Rt?.dateStr||"d"} -${Zn} `)})}),ar.length>0&&r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",Ae?`${Ae}`:""]}),r.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(En).toLocaleString()}),r.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),r.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(An).toLocaleString()]}),r.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):r.jsxs("div",{className:"dashboard-content",children:[r.jsxs("aside",{className:"dashboard-sidebar",children:[r.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[r.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),r.jsx(he,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const je=await nd(()=>Promise.resolve().then(()=>np),void 0).then(vn=>vn.recipeService.exportAllRecipes(a)),rt=new Blob([JSON.stringify(je,null,2)],{type:"application/json"}),mt=URL.createObjectURL(rt),Dt=document.createElement("a");Dt.href=mt,Dt.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Dt),Dt.click(),document.body.removeChild(Dt),URL.revokeObjectURL(mt)}catch(je){oe({type:"error",message:""}),console.error(je)}},children:" JSON"})]}),r.jsxs("div",{children:[r.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),r.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:je=>{const rt=je.target.files?.[0];rt&&Xn(rt)}}),r.jsx(he,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:le||Be,children:" "}),W.message&&r.jsx("div",{className:`status-msg ${W.type} `,style:{marginTop:"10px"},children:W.message})]})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," "]}),r.jsxs("div",{className:"upload-area",children:[r.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",r.jsx("br",{}),r.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",r.jsx("br",{})," 2: "]})]}),r.jsx("input",{type:"file",accept:".csv",onChange:ct,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),r.jsx(he,{variant:"primary",onClick:nn,disabled:!Ce||le,className:"upload-btn",size:"sm",block:!0,children:le?"...":""})]}),ne.message&&r.jsx("div",{className:`status-msg ${ne.type} `,children:ne.message})]}),a?.role==="admin"&&r.jsxs("div",{className:"sidebar-card",children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),r.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",Xe.length,""]}),r.jsx("div",{style:{marginTop:"0.75rem"},children:r.jsx(he,{variant:"secondary",size:"sm",block:!0,onClick:vi,disabled:wt||le,title:"",children:""})})]}),r.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," ",r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Xe.length,""]})]}),Xe.length===0?r.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):r.jsx("div",{className:"file-list",children:Xe.map(je=>r.jsxs("div",{className:"file-list-item",children:[r.jsx("span",{className:"file-name",title:je.name,children:je.name}),r.jsx(he,{variant:"danger",size:"sm",onClick:()=>Vn(je.name),disabled:le,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},je.name))})]}),r.jsxs("div",{className:"sidebar-card",style:{borderLeft:"4px solid #ef4444"},children:[r.jsx("div",{className:"sidebar-title",style:{color:"#ef4444"},children:" "}),r.jsx("p",{style:{fontSize:"0.8rem",color:"#666",margin:"0 0 10px"},children:"CSV"}),R&&r.jsx("div",{className:`status-msg ${R.type} `,style:{marginBottom:"8px",fontSize:"0.82rem"},children:R.message}),r.jsx(he,{variant:"danger",onClick:()=>_(!0),disabled:w||Xe.length===0,style:{width:"100%"},children:" "}),a?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsx("hr",{style:{margin:"12px 0",border:"none",borderTop:"1px solid #fecaca"}}),r.jsxs("div",{style:{marginBottom:"16px",padding:"12px",background:"#ecfdf5",borderRadius:"8px",border:"1px solid #6ee7b7"},children:[r.jsx("div",{className:"sidebar-title",style:{color:"#047857",marginBottom:"8px",fontSize:"0.9rem"},children:" "}),r.jsx("p",{style:{fontSize:"0.8rem",color:"#065f46",marginBottom:"12px",lineHeight:1.4},children:""}),r.jsx(he,{variant:"primary",onClick:()=>h(!0),style:{width:"100%",background:"#059669",borderColor:"#047857"},children:" "})]}),r.jsx("p",{style:{fontSize:"0.8rem",color:"#666",margin:"0 0 8px"},children:" "}),D&&r.jsx("div",{className:`status-msg ${D.type} `,style:{marginBottom:"8px",fontSize:"0.82rem"},children:D.message}),K&&r.jsx("div",{className:`status-msg ${K.type} `,style:{marginBottom:"8px",fontSize:"0.82rem"},children:K.message}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[r.jsx(he,{variant:"danger",onClick:()=>M(!0),disabled:I||z,style:{width:"100%",background:"#b91c1c"},children:" "}),r.jsx(he,{variant:"danger",onClick:()=>q(!0),disabled:I||z,style:{width:"100%",background:"#7f1d1d"},children:" "})]}),r.jsx("p",{style:{fontSize:"0.8rem",color:"#666",margin:"12px 0 8px"},children:" CSV"}),ae&&r.jsx("div",{className:`status-msg ${ae.type} `,style:{marginBottom:"8px",fontSize:"0.82rem"},children:ae.message}),r.jsx(he,{variant:"danger",onClick:()=>A(!0),disabled:L,style:{width:"100%",background:"#7f1d1d"},children:" "})]})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsx("div",{className:"sidebar-title",children:" "}),r.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:" "}),r.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),r.jsxs("main",{className:"dashboard-main",children:[r.jsxs("div",{className:"main-toolbar",children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),r.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",Ze.length.toLocaleString()," "]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsx(Mt,{placeholder:" (, , )...",value:Ne,onChange:je=>Ke(je.target.value),style:{width:"250px",fontSize:"0.9rem"}}),r.jsx(he,{variant:"secondary",size:"sm",onClick:Ve,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",children:E?r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsxs("th",{onClick:()=>tt("dateStr"),style:{width:"120px"},children:[" ",se.key==="dateStr"&&(se.direction==="asc"?"":"")]}),r.jsxs("th",{onClick:()=>tt("vendor"),children:[" ",se.key==="vendor"&&(se.direction==="asc"?"":"")]}),r.jsxs("th",{onClick:()=>tt("name"),children:[" ",se.key==="name"&&(se.direction==="asc"?"":"")]}),r.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),r.jsx("tbody",{children:Ze.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"4",className:"no-data",children:""})}):Ze.map((je,rt)=>r.jsxs("tr",{children:[r.jsx("td",{className:"col-date",children:je.dateStr||"-"}),r.jsx("td",{children:je.vendor||"-"}),r.jsx("td",{style:{fontWeight:"500"},children:je.name}),r.jsxs("td",{className:"col-number",children:[je.price?je.price.toLocaleString():"-",je.unit&&r.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",je.unit]})]})]},rt))})]})})]})]}),r.jsx(rn,{isOpen:de,onClose:yr,title:" / ",size:"medium",showCloseButton:!Be,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:re?.name||"-"})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(he,{variant:"ghost",onClick:yr,disabled:Be,children:""}),r.jsx(he,{variant:"primary",onClick:$r,disabled:!re||Be,children:Be?"...":""})]}),Be&&r.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),W.message&&r.jsx("div",{className:`status-msg ${W.type||"info"} `,style:{whiteSpace:"pre-wrap"},children:W.message})]})}),r.jsx(rn,{isOpen:Pe,onClose:Os,title:"",size:"medium",showCloseButton:!wt,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",r.jsx("br",{}),r.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",r.jsx("code",{children:"_copy"})," "]})]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",r.jsx("strong",{style:{color:"#111827"},children:a?.displayId||""})," / : ",Xe.length,""]}),_t?r.jsxs(r.Fragment,{children:[(()=>{const je=We.find(mt=>String(mt?.id)===String(Tt)),rt=je?`${je.display_id}${je.email?` (${je.email})`:""} `:Tt?String(Tt).slice(0,8):"-";return r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",r.jsx("strong",{children:rt}),r.jsx("br",{}),": ",r.jsx("strong",{children:Xe.length.toLocaleString()})," CSV",r.jsx("br",{}),": ",r.jsx("code",{children:"_copy"})," "]})]})})(),un?r.jsxs("div",{style:{marginTop:"16px",borderTop:"1px solid #e5e7eb",paddingTop:"16px"},children:[r.jsx("div",{style:{marginBottom:"16px",color:"#374151",fontSize:"0.95rem",fontWeight:500},children:un.type==="success"?"":""}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(he,{variant:"ghost",onClick:Os,children:""}),r.jsx(he,{variant:"primary",onClick:()=>{yn(null),jt(!1),sn("")},children:""})]})]}):r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>jt(!1),disabled:wt,children:""}),r.jsx(he,{variant:"primary",onClick:$a,disabled:!Tt||wt,children:wt?"...":""})]}),wt&&r.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:Lt.total?`${Lt.done} / ${Lt.total}`:"..."})]})]}),r.jsx("div",{className:"bulk-progress-bar",children:r.jsx("div",{className:"bulk-progress-bar-inner",style:{width:Lt.total?`${Math.round(Lt.done/Lt.total*100)}%`:"0%"}})}),r.jsx("div",{className:"bulk-progress-current",title:Lt.current,children:Lt.current})]}),un?.message&&r.jsx("div",{className:`status-msg ${un.type||"info"}`,children:un.message}),Array.isArray(un?.failed)&&un.failed.length>0&&r.jsxs("div",{className:"bulk-progress-failures",children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",un.failed.length,""]}),r.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:un.failed.slice(0,10).map((je,rt)=>r.jsxs("li",{children:[je?.file||"-",": ",je?.errorMessage||"unknown error"]},`${je?.file||"f"}-${rt}`))}),un.failed.length>10&&r.jsxs("div",{style:{marginTop:"6px"},children:["... ",un.failed.length-10,""]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),Wt?r.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):r.jsxs("select",{value:Tt,onChange:je=>sn(je.target.value),disabled:wt||!!yt,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:wt?"#f3f4f6":"white"},children:[r.jsx("option",{value:"",children:"..."}),We.filter(je=>String(je?.id)&&String(je?.id)!==String(a?.id)).map(je=>r.jsxs("option",{value:je.id,children:[je.display_id,je.email?` (${je.email})`:"",je.role==="admin"?" []":""]},je.id))]}),yt&&r.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:yt})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(he,{variant:"ghost",onClick:Os,disabled:wt,children:""}),r.jsx(he,{variant:"primary",onClick:()=>jt(!0),disabled:!Tt||wt||Wt||!!yt,children:""})]})]})]})}),ge&&r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>Y(null),children:r.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:je=>je.stopPropagation(),children:[r.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),r.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:ge.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>Y(null),children:""}),r.jsx(he,{variant:"danger",onClick:()=>{ge.onConfirm(),Y(null)},children:""})]})]})}),r.jsx($o,{isOpen:S,onClose:()=>{w||(_(!1),$(null))},onConfirm:async()=>{await Or(),_(!1)},title:"",description:r.jsxs("span",{children:["CSV",r.jsxs("strong",{children:[Xe.length,""]}),"",r.jsx("br",{}),""]}),loading:w,loadingNode:N.current?r.jsxs("span",{children:["... ",r.jsx("strong",{children:N.current})]}):"..."}),r.jsx($o,{isOpen:F,onClose:()=>{I||(q(!1),H(null))},onConfirm:async()=>{await Pr(),q(!1)},title:"",description:r.jsxs("span",{children:[r.jsx("strong",{style:{color:"#b91c1c"},children:"admin"}),"CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:I,loadingNode:r.jsxs("span",{children:[" (",P.done,"/",P.total,")... ",P.current&&r.jsx("strong",{children:P.current})]})}),r.jsx($o,{isOpen:Z,onClose:()=>{L||(A(!1),ue(null))},onConfirm:async()=>{await qs(),A(!1)},title:"",description:r.jsxs("span",{children:[r.jsx("strong",{style:{color:"#b91c1c"},children:"admin"}),"CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:L,loadingNode:"..."}),r.jsx(fw,{isOpen:C,onClose:()=>{z||(M(!1),Q(null))},onConfirm:fr,title:"",description:r.jsxs("span",{children:["CSV",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),loading:z,loadingNode:"..."}),r.jsx(_2,{isOpen:u,onClose:()=>{h(!1),y(null),v(null)},onConfirm:xi,loading:f,progressStatus:m,copyResult:b})]})},E2=({recipes:n,recentIds:e,onSelect:s})=>{if(!e||e.length===0)return null;const a=e.map(l=>n.find(c=>c.id===l)).filter(Boolean).slice(0,7);return a.length===0?null:r.jsxs("div",{className:"recent-recipes",children:[r.jsx("h3",{className:"recent-header",children:""}),r.jsx("div",{className:"recent-list",children:a.map(l=>r.jsxs("div",{className:"recent-item",onClick:()=>s(l),children:[r.jsx("div",{className:"recent-thumbnail",children:l.image?r.jsx("img",{src:l.image,alt:l.title}):r.jsx("div",{className:"recent-placeholder"})}),r.jsx("div",{className:"recent-info",children:r.jsx("div",{className:"recent-title",children:l.title})})]},l.id))})]})},A2=({onBack:n})=>(k.useEffect(()=>{window.scrollTo(0,0)},[]),r.jsxs("div",{className:"levain-guide-container",children:[r.jsxs("header",{className:"levain-guide-header",children:[r.jsx("h1",{children:"LEVAIN GUIDE"}),r.jsx("p",{className:"subtitle",children:" "}),r.jsx("p",{className:"subtitle",children:""}),r.jsx("div",{className:"divider"})]}),r.jsxs("main",{className:"levain-guide-main",children:[r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("p",{children:"Levain"}),r.jsx("h3",{children:""}),r.jsx("p",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",r.jsx("br",{}),r.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",r.jsx("br",{}),r.jsx("strong",{children:""})," Acetobacter aceti "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:["",r.jsx("br",{}),r.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",r.jsx("br",{}),"(   +  + )"]}),"",r.jsx("br",{}),r.jsxs("div",{className:"formula",children:["CHO  2CHO",r.jsx("br",{}),"(  )"]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"- 7-10"}),r.jsxs("div",{className:"timeline",children:[r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),r.jsx("p",{children:"100g + 100ml 20-22"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),r.jsx("p",{children:"50%50g + 50ml "}),r.jsx("p",{children:"100g  50g50g + 50ml"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),r.jsx("p",{children:"50%50g + 50ml "}),r.jsxs("div",{className:"success-box",children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),r.jsx("p",{children:"1150%1:1"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," 15",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," pH 3.5-4.0"]})]})]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"(g)"}),r.jsx("th",{children:"(ml)"}),r.jsx("th",{children:"(g)"}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"0"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"2"}),r.jsx("td",{children:"1"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"0"}),r.jsx("td",{children:""})]})]})]})})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"5-8"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"2-4"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"15-18"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"1-2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"20-22"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"3-5"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"25-28"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"2-3"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"30"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"1-2"})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"1"}),r.jsx("br",{}),"100g50g + 50ml"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"8-12"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),""]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"2%100ml2g"}),r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"2"}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 12 8:00"}),r.jsx("br",{}),"50g25g + 25ml "]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 1  14:00"}),r.jsx("br",{}),"25g + 25ml 2"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 1  20:00"}),r.jsx("br",{}),""]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:" "})," ",r.jsx("br",{}),"",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:" "})," pH",r.jsx("br",{}),"pH 3.5-4.0pH"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"18"}),r.jsx("td",{children:"16-24"}),r.jsx("td",{children:"1"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"20-22"}),r.jsx("td",{children:"12-16"}),r.jsx("td",{children:"2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"24-26"}),r.jsx("td",{children:"8-12"}),r.jsx("td",{children:"2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"28"}),r.jsx("td",{children:"4-8"}),r.jsx("td",{children:"2"})]})]})]})})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"1"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. 22",r.jsx("br",{}),"2. 12",r.jsx("br",{}),"3. 1",r.jsx("br",{}),"4. 1-2"]}),r.jsx("h3",{children:"2"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," pH",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," "]}),r.jsx("h3",{children:"3"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. 15",r.jsx("br",{}),"3. 80%"]}),r.jsx("h3",{children:"4"}),r.jsxs("div",{className:"success-box",children:["",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," "]}),r.jsx("h3",{children:"5"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. 1:0.8",r.jsx("br",{}),"2. ",r.jsx("br",{}),"3. "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"pH"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"pH4-8.0"}),r.jsx("br",{}),r.jsx("br",{})," pH 7.0",r.jsx("br",{})," pH 4.5-5.5",r.jsx("br",{})," pH 3.5-4.0",r.jsx("br",{})," pH 3.0"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:[r.jsx("strong",{children:"pH 3.8-4.0"})," ",r.jsx("br",{}),r.jsx("strong",{children:"pH 3.5"})," ",r.jsx("br",{}),r.jsx("strong",{children:"pH 4.5"})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," 1",r.jsx("br",{})," ",r.jsx("br",{})," -203"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"15-20"}),r.jsx("td",{children:"18-20"}),r.jsx("td",{children:"1-2"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"25+"}),r.jsx("td",{children:"22-24"}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"18-22"}),r.jsx("td",{children:"20-22"}),r.jsx("td",{children:"1-2"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"5-15"}),r.jsx("td",{children:"18"}),r.jsx("td",{children:"2-3"}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," 24",r.jsx("br",{})," ",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," 18",r.jsx("br",{})," "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"100g + 50g + 150ml 12-24",r.jsx("br",{}),"11-2"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"100ml"}),r.jsx("br",{})," 110 to 110 CFU/ml",r.jsx("br",{})," 110 to 110 CFU/ml",r.jsx("br",{})," pH3.5-4.0",r.jsx("br",{})," 0.5-1.5%",r.jsx("br",{})," 0.3-0.8%"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"15-25% ()"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"5-15%"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"20-30%"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"30-50%"}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"formula",children:[" 18   - 8",r.jsx("br",{}),r.jsx("br",{}),"",r.jsx("br",{})," 2018  (20-8) = 1.5",r.jsx("br",{})," 2418  (24-8) = 1.125",r.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),r.jsxs("footer",{className:"levain-footer",children:[r.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),r.jsx("p",{children:""})]}),r.jsxs("button",{className:"levain-back-button",onClick:n,children:[r.jsx("span",{children:""})," "]})]})),T2=({onBack:n})=>{const{user:e,patchCurrentUserProfile:s}=ms(),[a,l]=k.useState([]),[c,u]=k.useState(!0),[h,f]=k.useState(null),[p,m]=k.useState(null),[y,b]=k.useState(""),[v,S]=k.useState(""),[_,w]=k.useState(""),[j,N]=k.useState(""),[T,R]=k.useState(!1),[$,F]=k.useState(!1),[q,I]=k.useState(new Set),[U,P]=k.useState(null),[V,D]=k.useState([]),[H,C]=k.useState(!1),[M,z]=k.useState(null),[B,K]=k.useState(!1),Q=le=>le?.email==="pingus0428@gmail.com",Z=Ie.useCallback(async()=>{try{u(!0);const le=await hs.fetchAllProfiles();l(le)}catch(le){console.error(le),f("")}finally{u(!1)}},[]);k.useEffect(()=>{Z()},[Z]);const A=a.filter(le=>le.role==="admin"),L=a.filter(le=>le.role!=="admin"),J=(le,ie)=>{I(Te=>{const Le=new Set(Te);return ie?Le.add(le):Le.delete(le),Le})},ae=async(le,ie)=>{const Te=!!le.show_master_recipes;f(null),l(Le=>Le.map(E=>E.id===le.id?{...E,show_master_recipes:ie}:E)),le.id===e?.id&&s?.({showMasterRecipes:ie}),J(le.id,!0);try{const E=!!(await hs.updateProfile(le.id,{show_master_recipes:ie}))?.show_master_recipes;l(ve=>ve.map(ge=>ge.id===le.id?{...ge,show_master_recipes:E}:ge)),le.id===e?.id&&s?.({showMasterRecipes:E})}catch(Le){console.error(Le),l(E=>E.map(ve=>ve.id===le.id?{...ve,show_master_recipes:Te}:ve)),le.id===e?.id&&s?.({showMasterRecipes:Te}),f("RLS")}finally{J(le.id,!1)}},ue=async le=>{P(le),C(!0),f("");try{const ie=await hs.adminGetLoginLogs(le.id);D(ie)}catch(ie){console.error(ie),f("")}finally{C(!1)}},Ce=async(le,ie)=>{f(null);try{await hs.adminSetRole(le.id,ie),l(Te=>Te.map(Le=>Le.id===le.id?{...Le,role:ie}:Le))}catch(Te){console.error(Te),f("")}},fe=async()=>{if(M){K(!0),f(null);try{await hs.adminDeleteUser(M.id),l(le=>le.filter(ie=>ie.id!==M.id)),z(null)}catch(le){console.error(le),f("")}finally{K(!1)}}},ne=le=>{if(!le)return{text:"",color:"#666666",bg:"#f0f0f0"};const ie=(Date.now()-new Date(le).getTime())/(1e3*60*60);return ie<24?{text:"24h",color:"#ff2d55",bg:"#ffe5e9"}:ie<72?{text:"3",color:"#ff9500",bg:"#fff0d4"}:ie<168?{text:"1",color:"#34c759",bg:"#e5f9e7"}:ie<720?{text:"1",color:"#007aff",bg:"#e5f1ff"}:null},be=({user:le,isAdmin:ie,isSuperAdmin:Te,currentUser:Le,handleRoleChange:E,savingMasterTargets:ve,handleToggleMasterRecipeVisibility:ge,handleOpenLoginLogs:Y,setResetTarget:W,setResetPw1:oe,setResetPw2:re,setResetError:ee,setResetSuccess:de,setDeleteTarget:me})=>{const Be=ne(le.last_sign_in_at);return r.jsxs(mn,{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",padding:"15px",backgroundColor:"white"},children:[r.jsxs("div",{style:{flex:1,minWidth:0,marginRight:"16px"},children:[r.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:[r.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:Es(le.display_id)}),ie&&r.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",color:"#555"},children:""}),Be&&r.jsx("span",{style:{backgroundColor:Be.bg,color:Be.color,border:`1px solid ${Be.color}`,padding:"1px 6px",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"bold",lineHeight:1},children:Be.text})]}),le.email&&r.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",wordBreak:"break-all"},children:le.email}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"4px"},children:[": ",new Date(le.created_at).toLocaleString()]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",le.updated_at?new Date(le.updated_at).toLocaleString():"---"]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",le.last_sign_in_at?new Date(le.last_sign_in_at).toLocaleString():""]})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"12px",flexShrink:0},children:[!Te(le)&&Le?.id!==le.id&&r.jsxs("div",{style:{display:"flex",borderRadius:"6px",overflow:"hidden",border:"1px solid #d1d5db",backgroundColor:"#f3f4f6",padding:"2px"},children:[r.jsx("button",{onClick:()=>E(le,"user"),disabled:le.role!=="admin",style:{padding:"4px 14px",fontSize:"0.85rem",cursor:le.role!=="admin"?"default":"pointer",border:"none",transition:"all 0.2s",outline:"none",backgroundColor:le.role!=="admin"?"#fff":"transparent",fontWeight:le.role!=="admin"?"bold":"normal",color:le.role!=="admin"?"#111827":"#6b7280",boxShadow:le.role!=="admin"?"0 1px 2px rgba(0,0,0,0.1)":"none",borderRadius:"4px"},children:""}),r.jsx("button",{onClick:()=>E(le,"admin"),disabled:le.role==="admin",style:{padding:"4px 14px",fontSize:"0.85rem",cursor:le.role==="admin"?"default":"pointer",border:"none",transition:"all 0.2s",outline:"none",backgroundColor:le.role==="admin"?"#fff":"transparent",fontWeight:le.role==="admin"?"bold":"normal",color:le.role==="admin"?"#ef4444":"#6b7280",boxShadow:le.role==="admin"?"0 1px 2px rgba(0,0,0,0.1)":"none",borderRadius:"4px"},children:""})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[!Te(le)&&r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:le.show_master_recipes||!1,disabled:ve.has(le.id),onChange:Re=>ge(le,Re.target.checked)}),""]}),r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>Y(le),style:{whiteSpace:"nowrap"},children:""}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>{W({id:le.id,display_id:le.display_id,email:le.email}),oe(""),re(""),ee(""),de("")},style:{whiteSpace:"nowrap"},children:""}),!Te(le)&&Le?.id!==le.id&&r.jsx(he,{variant:"danger",size:"sm",onClick:()=>me(le),style:{whiteSpace:"nowrap"},children:""})]})]})]},le.id)};return r.jsx("div",{style:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:r.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",width:"100%",overflowY:"auto",flex:1},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[r.jsx("h2",{children:""}),r.jsx(he,{variant:"ghost",onClick:n,children:""})]}),h&&r.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:h}),c?r.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[A.length>0&&r.jsxs("div",{children:[r.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:A.map(le=>r.jsx(be,{user:le,isAdmin:!0,isSuperAdmin:Q,currentUser:e,handleRoleChange:Ce,savingMasterTargets:q,handleToggleMasterRecipeVisibility:ae,handleOpenLoginLogs:ue,setResetTarget:m,setResetPw1:b,setResetPw2:S,setResetError:w,setResetSuccess:N,setDeleteTarget:z},le.id))})]}),r.jsxs("div",{children:[r.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:L.length>0?L.map(le=>r.jsx(be,{user:le,isAdmin:!1,isSuperAdmin:Q,currentUser:e,handleRoleChange:Ce,savingMasterTargets:q,handleToggleMasterRecipeVisibility:ae,handleOpenLoginLogs:ue,setResetTarget:m,setResetPw1:b,setResetPw2:S,setResetError:w,setResetSuccess:N,setDeleteTarget:z},le.id)):r.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),r.jsx(rn,{isOpen:!!p,onClose:()=>{T||m(null)},title:": ",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",Es(p?.display_id||p?.email||p?.id)]}),p?.email&&r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:p.email}),r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),_&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:_}),j&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:j}),r.jsxs("div",{style:{display:"grid",gap:"10px"},children:[r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),r.jsx("input",{type:"password",value:y,onChange:le=>b(le.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),r.jsx("input",{type:"password",value:v,onChange:le=>S(le.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>m(null),disabled:T,children:""}),r.jsx(he,{variant:"secondary",isLoading:$,disabled:!p?.email||T,onClick:async()=>{if(w(""),N(""),!p?.email){w("");return}F(!0);try{await hs.sendPasswordResetEmail(p.email),N("")}catch(le){console.error(le),w(le?.message||"")}finally{F(!1)}},style:{whiteSpace:"nowrap"},children:""}),r.jsx(he,{variant:"danger",isLoading:T,onClick:async()=>{if(w(""),N(""),!!p?.id){if(!y||y.length<8){w("8");return}if(y!==v){w("");return}R(!0);try{await hs.adminResetPassword(p.id,y),N(""),b(""),S("")}catch(le){console.error(le);const ie=le?.message||"";/FunctionsHttpError|not found|404/i.test(ie)||/admin-reset-password/i.test(ie)?w(""):w(ie)}finally{R(!1)}}},children:""})]})]})}),r.jsx(rn,{isOpen:!!U,onClose:()=>P(null),title:"",size:"medium",children:r.jsxs("div",{style:{color:"var(--text-color)",lineHeight:1.5,minHeight:"300px",display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"16px",paddingBottom:"8px",borderBottom:"1px solid #ddd"},children:[": ",Es(U?.display_id||U?.email||U?.id)]}),H?r.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:"#666"},children:"..."}):V.length>0?r.jsx("div",{style:{flex:1,overflowY:"auto",maxHeight:"400px"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsx("tr",{children:r.jsx("th",{style:{textAlign:"left",padding:"8px",borderBottom:"2px solid #ddd",backgroundColor:"#f5f5f5"},children:""})})}),r.jsx("tbody",{children:V.map((le,ie)=>r.jsx("tr",{style:{borderBottom:"1px solid #eee"},children:r.jsx("td",{style:{padding:"8px"},children:new Date(le.login_at).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})},ie))})]})}):r.jsxs("div",{style:{textAlign:"center",padding:"40px 0",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:["",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.85rem"},children:""})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"20px"},children:r.jsx(he,{variant:"secondary",onClick:()=>P(null),children:""})})]})}),r.jsx(rn,{isOpen:!!M,onClose:()=>{B||z(null)},title:"",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[r.jsx("div",{style:{marginBottom:"16px"},children:""}),r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",Es(M?.display_id||M?.email||M?.id)]}),M?.email&&r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"20px",wordBreak:"break-all"},children:M.email}),r.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end"},children:[r.jsx(he,{variant:"ghost",onClick:()=>z(null),disabled:B,children:""}),r.jsx(he,{variant:"danger",isLoading:B,onClick:fe,children:""})]})]})})]})})},$s="inventory_items",Ea="inventory_snapshots",Gl="deleted_inventory_snapshots",No=(n,e)=>{const s=String(n?.message||"");return String(n?.code||"")==="42703"?s.toLowerCase().includes(String(e).toLowerCase()):s.toLowerCase().includes(`column "${String(e).toLowerCase()}"`)&&s.toLowerCase().includes("does not exist")},mr={getAll:async n=>{if(!n)return[];const{data:e,error:s}=await Ee.from($s).select("*").eq("user_id",n).order("created_at",{ascending:!0});return s?(console.error("Error fetching inventory:",s),[]):e||[]},add:async(n,e)=>{if(!n)throw new Error("User ID is required");const{id:s,isPhantom:a,_master:l,_csv:c,...u}=e,h=e?.tax10_override??e?.tax10Override,f=Object.prototype.hasOwnProperty.call(e||{},"tax10"),p=Object.prototype.hasOwnProperty.call(e||{},"tax10_override")||Object.prototype.hasOwnProperty.call(e||{},"tax10Override"),m=String(u?.name??"").trim(),y=String(u?.vendor??"").trim(),b={...u,name:m,vendor:y||null,user_id:n,quantity:parseFloat(e.quantity)||0,threshold:parseFloat(e.threshold)||0,price:parseFloat(e.price)||0};f&&(b.tax10=!!e.tax10),p&&(b.tax10_override=!!h);const v=async w=>Ee.from($s).insert([w]).select().single();let{data:S,error:_}=await v(b);if(_){const w=No(_,"tax10"),j=No(_,"tax10_override");if(w||j){const N={...b};w&&delete N.tax10,j&&delete N.tax10_override,{data:S,error:_}=await v(N)}}if(_&&String(_?.code||"")==="23505"){let w=Ee.from($s).select("*").eq("user_id",n).eq("name",m).order("updated_at",{ascending:!1}).order("id",{ascending:!1}).limit(1);y?w=w.eq("vendor",y):w=w.is("vendor",null);const{data:j,error:N}=await w;if(!N&&Array.isArray(j)&&j.length>0){const T=j[0];return await mr.update(n,{...T,...b,id:T.id})}}if(_)throw console.error("Error adding item:",_),_;return S},update:async(n,e)=>{if(!n)throw new Error("User ID is required");if(!e.id)throw new Error("Item ID is required for update");const{id:s,isPhantom:a,created_at:l,_master:c,_csv:u,...h}=e,f=e?.tax10_override??e?.tax10Override,p=Object.prototype.hasOwnProperty.call(e||{},"tax10"),m=Object.prototype.hasOwnProperty.call(e||{},"tax10_override")||Object.prototype.hasOwnProperty.call(e||{},"tax10Override"),y={...h,name:Object.prototype.hasOwnProperty.call(h||{},"name")?String(h.name??"").trim():h.name,vendor:Object.prototype.hasOwnProperty.call(h||{},"vendor")?String(h.vendor??"").trim()||null:h.vendor,quantity:parseFloat(e.quantity)||0,threshold:parseFloat(e.threshold)||0,price:parseFloat(e.price)||0,updated_at:new Date().toISOString()};p&&(y.tax10=!!e.tax10),m&&(y.tax10_override=!!f);const b=async _=>Ee.from($s).update(_).eq("id",e.id).eq("user_id",n).select().single();let{data:v,error:S}=await b(y);if(S){const _=No(S,"tax10"),w=No(S,"tax10_override");if(_||w){const j={...y};_&&delete j.tax10,w&&delete j.tax10_override,{data:v,error:S}=await b(j)}}if(S)throw console.error("Error updating item:",S),S;return v},delete:async(n,e)=>{if(!n)throw new Error("User ID is required");const{error:s}=await Ee.from($s).delete().eq("id",e).eq("user_id",n);if(s)throw console.error("Error deleting item:",s),s},adjustStock:async(n,e,s)=>{if(!n)throw new Error("User ID is required");const{data:a,error:l}=await Ee.from($s).select("quantity").eq("id",e).eq("user_id",n).single();if(l||!a)throw new Error("Item not found");const c=Math.max(0,(a.quantity||0)+s),{data:u,error:h}=await Ee.from($s).update({quantity:c,updated_at:new Date().toISOString()}).eq("id",e).eq("user_id",n).select().single();if(h)throw h;return u},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:e}=await Ee.from($s).delete().eq("user_id",n).not("id","is",null);if(e)throw console.error("Error clearing inventory:",e),e},getIgnoredItems:async n=>{if(!n)return new Set;const{data:e,error:s}=await Ee.from("ignored_items").select("name").eq("user_id",n);return s?(console.error("Error fetching ignored items:",s),new Set):new Set(e.map(a=>a.name))},ignoreItem:async(n,e)=>{if(!n)throw new Error("User ID is required");if(!e)return;const{error:s}=await Ee.from("ignored_items").insert([{user_id:n,name:e}]).select();if(s&&s.code!=="23505")throw console.error("Error ignoring item:",s),s},getSnapshots:async n=>{if(!n)return[];const{data:e,error:s}=await Ee.from(Ea).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return s?(console.error("Error fetching snapshots:",s),[]):e||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:e,error:s}=await Ee.from(Gl).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return s?(console.error("Error fetching deleted snapshots:",s),[]):e||[]},createSnapshot:async(n,e,s,a)=>{if(!n)throw new Error("User ID is required");let l=null,c=null;const u=await Ee.from(Ea).insert([{user_id:n,title:e,items:s,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();if(l=u.data??null,c=u.error??null,c&&No(c,"user_id")){const h=await Ee.from(Ea).insert([{title:e,items:s,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();l=h.data??null,c=h.error??null}if(c)throw console.error("Error creating snapshot:",c),c;return l},deleteSnapshotToTrash:async(n,e)=>{if(!n)throw new Error("User ID is required");if(!e)throw new Error("Snapshot ID is required");const{data:s,error:a}=await Ee.from(Ea).select("*").eq("id",e).eq("user_id",n).single();if(a||!s)throw console.error("Error fetching snapshot for delete:",a),a||new Error("Snapshot not found");const{error:l}=await Ee.from(Gl).insert([{original_id:s.id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at,deleted_at:new Date().toISOString()}]);if(l)throw console.error("Error moving snapshot to trash:",l),l;const{error:c}=await Ee.from(Ea).delete().eq("id",e).eq("user_id",n);if(c)throw console.error("Error deleting snapshot from main table:",c),c;return!0},restoreSnapshotFromTrash:async(n,e)=>{if(!n)throw new Error("User ID is required");if(!e)throw new Error("Deleted snapshot ID is required");const{data:s,error:a}=await Ee.from(Gl).select("*").eq("id",e).eq("user_id",n).single();if(a||!s)throw console.error("Error fetching deleted snapshot:",a),a||new Error("Deleted snapshot not found");let l=null;{const{error:u}=await Ee.from(Ea).insert([{id:s.original_id,user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);l=u}if(l){const{error:u}=await Ee.from(Ea).insert([{user_id:n,title:s.title,items:s.items,total_value:s.total_value,snapshot_date:s.snapshot_date,created_at:s.created_at}]);if(u)throw console.error("Error restoring snapshot (fallback) :",u),u}const{error:c}=await Ee.from(Gl).delete().eq("id",e).eq("user_id",n);if(c)throw console.error("Error removing restored snapshot from trash:",c),c;return!0},hardDeleteSnapshotFromTrash:async(n,e)=>{if(!n)throw new Error("User ID is required");if(!e)throw new Error("Deleted snapshot ID is required");const{error:s}=await Ee.from(Gl).delete().eq("id",e).eq("user_id",n);if(s)throw console.error("Error hard deleting snapshot from trash:",s),s;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const e=await Ee.from($s).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(e.error){if(No(e.error,"user_id")){const s=await Ee.from($s).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(s.error)throw console.error("Error resetting quantities (fallback):",s.error),s.error;return}throw console.error("Error resetting quantities:",e.error),e.error}}},Oa=n=>{const e=String(n??"").trim();if(!e)return"";const s=e.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s===""?"cl":s},R2=(n,e)=>{const s=Oa(n),a=Oa(e);if(!s||!a)return null;if(s===a)return 1;if(s==="kg"&&a==="g")return 1e3;if(s==="g"&&a==="kg")return 1/1e3;const l=s==="cc"?"ml":s,c=a==="cc"?"ml":a;return l==="l"&&c==="ml"?1e3:l==="ml"&&c==="l"?1/1e3:l==="cl"&&c==="ml"?10:l==="ml"&&c==="cl"?1/10:null},O2=n=>{const e=String(n??"").trim();return e?["","","","","","","","pc","PC",""].includes(e):!1},Wl=n=>{if(!Number.isFinite(n))return"-";const e=Math.round(n*100)/100;return Number.isInteger(e)?e.toLocaleString():e.toLocaleString("ja-JP",{maximumFractionDigits:2})},D2=({index:n,item:e,isLowStock:s,onUpdateQuantity:a,onDelete:l,onToggleTax:c,onEdit:u,onRequestUnitSync:h})=>{const[f,p]=Ie.useState(e.quantity===""?"":parseFloat(e.quantity)||0),m=C=>{const M=String(C||"").trim();return M?M==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(M)?M:"":""},y={food:"",alcohol:"",soft_drink:"",supplies:""};Ie.useEffect(()=>{p(e.quantity===""?"":parseFloat(e.quantity)||0)},[e.quantity]);const b=parseFloat(e.price)||0,v=(()=>{if(!Number.isFinite(b)||b<=0)return"-";const C=e?._csv?.unit,M=String(C||"").trim(),z=String(e?.unit||"").trim();if(!M)return`${Wl(b)}`;const B=Oa(z),K=Oa(M);if(K===B)return`${Wl(b)}/${M}`;const Q=R2(K,B);if(Q!==null)return`${Wl(b*Q)}/${M}`;const Z=parseFloat(e?._master?.packetSize),A=String(e?._master?.packetUnit||"").trim(),L=Oa(A);return O2(M)&&Number.isFinite(Z)&&Z>0&&L===B?`${Wl(b*Z)}/${M}`:`${Wl(b)}/${z||"-"}`})(),S=m(e?._master?.itemCategory),_=S==="alcohol"||S==="supplies",w=e?.tax10_override===!0||e?.tax10_override===1||e?.tax10_override==="1"||e?.tax10_override==="true",j=S?w?e?.tax10===!0||e?.tax10===1||e?.tax10==="1"||e?.tax10==="true":_:e?.tax10===!0||e?.tax10===1||e?.tax10==="1"||e?.tax10==="true",N=S?w?`${y[S]||S}: ${_?"10%":"8%"}/ `:`${y[S]||S}${j?"10%":"8%"}`:"10%",T=j?1.1:1.08,R=f===""?0:parseFloat(f),$=b*R*T,F=Ie.useMemo(()=>{const C=e?._master?.packetSize,M=e?._master?.packetUnit,z=parseFloat(C);return!Number.isFinite(z)||z<=0?"-":`${Number.isInteger(z)?z.toLocaleString():z.toLocaleString(void 0,{maximumFractionDigits:3})}${M?String(M):""}`},[e?._master?.packetSize,e?._master?.packetUnit]),q=()=>{const C=parseFloat(f);!isNaN(C)&&C!==e.quantity&&a(e.id,C)},I=C=>{C&&setTimeout(()=>{try{C.select()}catch{}},0)},U=C=>{const z=C?.closest?.("table")||document;return Array.from(z.querySelectorAll("input.inventory-quantity-input"))},P=(C,M)=>{const z=U(C).filter(Q=>!Q.disabled),B=z.indexOf(C);if(B<0)return!1;const K=z[B+M];return K?(requestAnimationFrame(()=>{try{K.scrollIntoView({block:"nearest"})}catch{}K.focus(),I(K)}),!0):!1},V=C=>{if(C.key==="Enter"){C.preventDefault(),P(C.currentTarget,C.shiftKey?-1:1),C.currentTarget.blur();return}C.key==="Tab"&&P(C.currentTarget,C.shiftKey?-1:1)&&(C.preventDefault(),C.currentTarget.blur()),(C.key==="ArrowUp"||C.key==="ArrowDown")&&P(C.currentTarget,C.key==="ArrowUp"?-1:1)&&(C.preventDefault(),C.currentTarget.blur())},D=e?._master?.packetUnit||"",H=!!D&&Oa(D)!==Oa(e?.unit);return r.jsxs("tr",{className:s(e)?"low-stock":"",children:[r.jsx("td",{style:{textAlign:"center",color:"#6b7280",fontVariantNumeric:"tabular-nums"},children:Number.isFinite(n)?n+1:""}),r.jsx("td",{style:{textAlign:"center"},children:r.jsx("input",{type:"checkbox",checked:j,onChange:C=>c&&c(e,C.target.checked),title:N,className:"inventory-tax-checkbox"})}),r.jsxs("td",{children:[e.name,s(e)&&r.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),r.jsx("td",{style:{textAlign:"right"},children:v}),r.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:F}),r.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[r.jsx("input",{type:"text",inputMode:"decimal",value:f,onChange:C=>p(lw(C.target.value)),className:"inventory-quantity-input no-print",onBlur:q,onKeyDown:V,onFocus:C=>I(C.target),onClick:C=>I(C.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),r.jsx("span",{className:"print-only",style:{display:"none"},children:f})]}),r.jsx("td",{children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx("span",{children:e.unit}),H&&typeof h=="function"&&r.jsx("button",{type:"button",onClick:()=>h(e),title:`${D}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),r.jsx("td",{style:{textAlign:"right"},children:$>0?`${Math.round($).toLocaleString()}`:"-"}),r.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:e.vendor||"-"}),r.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof u=="function"&&r.jsx("button",{type:"button",onClick:()=>u(e),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),r.jsx("button",{onClick:()=>l(e),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},z2=({items:n,loading:e,onDelete:s,onUpdateQuantity:a,onToggleTax:l,onEdit:c,onRequestUnitSync:u})=>{const{setNodeRef:h,isOver:f}=Cc({id:"inventory-list-droppable"}),p=S=>S.threshold>0&&S.quantity<=S.threshold,[m,y]=Ie.useState({key:null,direction:"asc"}),b=S=>{y(_=>_.key===S?{key:S,direction:_.direction==="asc"?"desc":"asc"}:{key:S,direction:"asc"})},v=Ie.useMemo(()=>{if(!m.key)return n;const S=[...n];return m.key==="vendor"&&S.sort((_,w)=>{const j=(_?.vendor||"").toString(),N=(w?.vendor||"").toString(),T=j.localeCompare(N,"ja");if(T!==0)return m.direction==="asc"?T:-T;const R=(_?.name||"").toString(),$=(w?.name||"").toString(),F=R.localeCompare($,"ja");return m.direction==="asc"?F:-F}),S},[n,m]);return r.jsxs("div",{ref:h,className:`inventory-list-droppable ${f?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:f?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[r.jsx("div",{className:"inventory-table-container",children:e?r.jsx("p",{children:"Loading..."}):r.jsxs("table",{className:"inventory-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{textAlign:"center",width:"44px"},children:"No"}),r.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"}),r.jsxs("th",{onClick:()=>b("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",m.key==="vendor"&&(m.direction==="asc"?"":"")]}),r.jsx("th",{style:{width:"40px"}})]})}),r.jsxs("tbody",{children:[v.map((S,_)=>r.jsx(D2,{index:_,item:S,isLowStock:p,onUpdateQuantity:a,onEdit:c,onDelete:s,onToggleTax:l,onRequestUnitSync:u},S.id)),v.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#888",padding:"2rem"},children:f?"":""})})]}),r.jsx("tfoot",{children:(()=>{const S=n.reduce((_,w)=>{const j=parseFloat(w.price)||0,N=w.quantity===""?0:parseFloat(w.quantity)||0,T=w?.tax10===!0||w?.tax10===1||w?.tax10==="1"||w?.tax10==="true"?1.1:1.08,R=j*N;return _.net+=R,_.taxed+=R*T,_},{net:0,taxed:0});return r.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[r.jsx("td",{colSpan:"7",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(S.net).toLocaleString()," / ",Math.round(S.taxed).toLocaleString()]}),r.jsx("td",{colSpan:"2"})]})})()})]})}),f&&r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},M2=({onBack:n})=>{const{user:e}=ms(),s=e?.id,[,a]=bc(),[l,c]=k.useState([]),[u,h]=k.useState([]),[f,p]=k.useState([]),[m,y]=k.useState([]),[b,v]=k.useState(new Map),[S,_]=k.useState(new Map),[w,j]=k.useState(new Set),[N,T]=k.useState(!0),[R,$]=k.useState(""),[F,q]=k.useState(!1),[I,U]=k.useState(null),[P,V]=k.useState(""),[D,H]=k.useState(!1),[C,M]=k.useState(null),[z,B]=k.useState(!1),[K,Q]=k.useState(!1),[Z,A]=k.useState(""),[L,J]=k.useState(!1),[ae,ue]=k.useState(!0),[Ce,fe]=k.useState(!1),[ne,be]=k.useState(null),[le,ie]=k.useState("history"),[Te,Le]=k.useState(null),[E,ve]=k.useState(""),[ge,Y]=k.useState(!1),[W,oe]=k.useState(null),[re,ee]=k.useState(!0),[de,me]=k.useState({key:"name",direction:"asc"}),[Be,Re]=k.useState(!1),[Pe,Je]=k.useState(null),[We,Et]=k.useState(new Set),[Wt,dt]=k.useState(!1),[yt,ft]=k.useState(null),[Tt,sn]=k.useState(null),[wt,Un]=k.useState(!1),Lt=Ia(Ar(Ed,{activationConstraint:{distance:8}})),[qt,un]=k.useState("all"),[yn,_t]=k.useState(new Set),[jt,Kt]=k.useState(""),[Ft,dn]=k.useState(""),[Ht,gn]=k.useState({});k.useEffect(()=>{V(I&&I.name||"")},[I]);const[hn,an]=k.useState(""),Dn=({row:X,onVendorClick:ye,isSelected:we})=>{const{attributes:Ue,listeners:Ge,setNodeRef:Ye,setActivatorNodeRef:et,transform:st,transition:it,isDragging:ot}=Ba({id:X.vendor,data:{type:"summary-row"}}),ht={transform:Br.Transform.toString(st),transition:it,opacity:ot?.6:1};return r.jsxs("tr",{ref:Ye,style:ht,...Ue,className:we?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[r.jsx("td",{className:"inventory-summary__drag",children:r.jsx("span",{ref:et,...Ge,className:"inventory-summary__drag-handle",title:"",children:""})}),r.jsx("td",{children:r.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>ye?.(X.vendor),"aria-expanded":!!we,children:[r.jsx("span",{children:X.vendor}),r.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:we?"":""})]})}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(X.total||0).toLocaleString()]})]})};k.useEffect(()=>{s&&(un("all"),$(""),Vt())},[s]);const Vt=async(X=!1)=>{X||T(!0);try{const[ye,we,Ue,Ge,Ye,et,st]=await Promise.all([mr.getAll(s),Pn.getPriceListArray(),mr.getIgnoredItems(s),mr.getSnapshots(s),mr.getDeletedSnapshots(s),On.getAllConversions(),xd.getAll(s)]);c(ye),y(we),j(Ue),h(Ge||[]),p(Ye||[]),v(et||new Map),_(st||new Map);const it=at=>{if(!at)return-1;const In=new Date(at).getTime();return Number.isFinite(In)?In:-1},ot=(at,Ot)=>{const In=Math.max(it(at?.updated_at),it(at?.updatedAt),it(at?.created_at),it(at?.createdAt)),Bn=Math.max(it(Ot?.updated_at),it(Ot?.updatedAt),it(Ot?.created_at),it(Ot?.createdAt));return In!==Bn&&Bn>In?Ot:at},ht=new Map;(ye||[]).forEach(at=>{const Ot=String(at?.vendor??"").trim()||"__no_vendor__",In=Jt(at?.name)||String(at?.name??"").trim();if(!In)return;const Bn=`${Ot}@@${In}`,es=ht.get(Bn);if(!es){ht.set(Bn,at);return}ht.set(Bn,ot(es,at))});const vt=new Set(Array.from(ht.values()).map(at=>at.id));_t(vt)}catch(ye){console.error("Failed to load data:",ye)}finally{X||T(!1)}},Cn=X=>{if(!X)return"-";const ye=new Date(X);if(Number.isNaN(ye.getTime()))return String(X);const we=ye.getFullYear(),Ue=String(ye.getMonth()+1).padStart(2,"0"),Ge=String(ye.getDate()).padStart(2,"0"),Ye=String(ye.getHours()).padStart(2,"0"),et=String(ye.getMinutes()).padStart(2,"0");return`${we}/${Ue}/${Ge} ${Ye}:${et}`},It=X=>{const ye=X?.items;return Array.isArray(ye)?ye:ye?[]:[]},zn=X=>{const ye=X?.snapshot_date||X?.created_at;if(!ye)return null;const we=new Date(ye);return Number.isNaN(we.getTime())?null:we},qn=Ie.useMemo(()=>new Set([""]),[]),fn=X=>{const ye=String(X??"").trim();return qn.has(ye)},Se=X=>X===!0||X===1||X==="1"||X==="true",nt=X=>{const ye=String(X??"").trim();if(!ye)return"";const we=ye.toLowerCase();return we===""?"g":we===""?"ml":we===""?"cc":we===""?"kg":we===""?"l":we===""?"cl":we},te=(X,ye)=>{const we=parseFloat(X?.lastPrice),Ue=parseFloat(X?.packetSize),Ge=nt(X?.packetUnit),Ye=nt(ye||Ge);if(!Number.isFinite(we)||!Number.isFinite(Ue)||Ue<=0||!Ge)return null;const et=we/Ue;if(Ye===Ge)return et;if(Ge==="g"&&Ye==="kg")return et*1e3;if(Ge==="kg"&&Ye==="g")return et/1e3;const st=Ge==="cc"?"ml":Ge,it=Ye==="cc"?"ml":Ye;return st==="ml"&&it==="l"?et*1e3:st==="l"&&it==="ml"?et/1e3:st==="cl"&&it==="ml"?we/Ue/10:st==="ml"&&it==="cl"?et*10:st==="cl"&&it==="cl"?et:null},ze=(X,ye)=>{const we=nt(X),Ue=nt(ye);if(!we||!Ue)return null;if(we===Ue)return 1;if(we==="kg"&&Ue==="g")return 1e3;if(we==="g"&&Ue==="kg")return 1/1e3;const Ge=we==="cc"?"ml":we,Ye=Ue==="cc"?"ml":Ue;return Ge==="l"&&Ye==="ml"?1e3:Ge==="ml"&&Ye==="l"?1/1e3:Ge==="cl"&&Ye==="ml"?10:Ge==="ml"&&Ye==="cl"?1/10:null},Ae=X=>{const ye=String(X||"").trim();return ye?ye==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(ye)?ye:"":""},Qe=X=>{const ye=Ae(X);return ye==="alcohol"||ye==="supplies"},ce=X=>{const ye=Ae(X);return ye==="food"?"":ye==="alcohol"||ye==="soft_drink"?"":ye==="supplies"?"":""},se=X=>{const ye=Ae(X);return ye==="food"?"food":ye==="alcohol"||ye==="soft_drink"?"drink":ye==="supplies"?"supplies":"unknown"},xe=X=>X==="food"?"":X==="drink"?"":X==="supplies"?"":"",Ne=X=>Se(X?.tax10)?1.1:1.08,Ke=X=>X?`${X.getFullYear()}-${String(X.getMonth()+1).padStart(2,"0")}`:"",tt=X=>{if(!X)return-1;const we=new Date(X).getTime();return Number.isFinite(we)?we:-1},Ze=X=>{const ye=[X?.updated_at,X?.updatedAt,X?.created_at,X?.createdAt];for(const we of ye){const Ue=tt(we);if(Ue>=0)return Ue}return-1},Xe=Ie.useMemo(()=>{const X=new Map;return u.forEach(ye=>{const we=zn(ye);if(!we)return;const Ue=Ke(we);X.has(Ue)||X.set(Ue,{key:Ue,year:we.getFullYear(),month:we.getMonth()+1})}),Array.from(X.values()).sort((ye,we)=>we.key.localeCompare(ye.key)).map(ye=>({...ye,label:`${ye.year}${ye.month}`}))},[u]);k.useEffect(()=>{if(Xe.length===0){jt&&Kt("");return}if(jt&&Xe.some(we=>we.key===jt))return;const X=Ke(new Date),ye=Xe.find(we=>we.key===X)?.key||Xe[0].key;Kt(ye)},[Xe,jt]),k.useEffect(()=>{if(Xe.length===0){Ft&&dn("");return}if(Ft&&Xe.some(we=>we.key===Ft))return;const X=Ke(new Date),ye=Xe.find(we=>we.key===X)?.key||Xe[0].key;dn(ye)},[Xe,Ft]);const lt=Ie.useMemo(()=>{if(!Ft)return null;const[X,ye]=Ft.split("-"),we=parseInt(X,10),Ue=parseInt(ye,10);if(!Number.isFinite(we)||!Number.isFinite(Ue))return null;const Ge=st=>String(st).padStart(2,"0"),Ye=new Date(we,Ue-1,1),et=new Date(we,Ue,0);return{year:we,month:Ue,start:Ye,end:et,rangeLabel:`${we}/${Ge(Ue)}/01${we}/${Ge(Ue)}/${Ge(et.getDate())}`}},[Ft]),Pt=Ie.useMemo(()=>Ft?u.map(X=>({snapshot:X,date:zn(X)})).filter(X=>X.date&&Ke(X.date)===Ft).sort((X,ye)=>ye.date-X.date).map(X=>X.snapshot):u,[u,Ft]),$t=Ie.useMemo(()=>{if(!jt)return null;const[X,ye]=jt.split("-"),we=parseInt(X,10),Ue=parseInt(ye,10);if(!Number.isFinite(we)||!Number.isFinite(Ue))return null;const Ge=st=>String(st).padStart(2,"0"),Ye=new Date(we,Ue-1,1),et=new Date(we,Ue,0);return{year:we,month:Ue,start:Ye,end:et,rangeLabel:`${we}/${Ge(Ue)}/01${we}/${Ge(Ue)}/${Ge(et.getDate())}`}},[jt]),Ve=Ie.useMemo(()=>jt?u.map(X=>({snapshot:X,date:zn(X)})).filter(X=>X.date&&Ke(X.date)===jt).sort((X,ye)=>ye.date-X.date).map(X=>X.snapshot):[],[u,jt]),ct=Ve[0]||null,nn=jt||(ct?.id?`snapshot:${ct.id}`:""),Vn=Ie.useMemo(()=>{const X=new Map;return Ve.forEach(ye=>{const we=zn(ye)?.getTime()||-1;It(ye).forEach((Ge,Ye)=>{const et=(Ge?.vendor||"").toString().trim();if(fn(et))return;const st=et||"",it=String(Ge?.name||"").trim();if(!it)return;const ot=`${st}::${it}`,ht={item:{...Ge,vendor:st},snapshotMs:we,itemUpdatedMs:Ze(Ge),rowIndex:Ye},vt=X.get(ot);if(!vt){X.set(ot,ht);return}if(ht.snapshotMs!==vt.snapshotMs){ht.snapshotMs>vt.snapshotMs&&X.set(ot,ht);return}if(ht.itemUpdatedMs!==vt.itemUpdatedMs){ht.itemUpdatedMs>vt.itemUpdatedMs&&X.set(ot,ht);return}ht.rowIndex>=vt.rowIndex&&X.set(ot,ht)})}),Array.from(X.values()).map(ye=>ye.item)},[Ve,fn]),Xn=Ie.useMemo(()=>{const X=new Map;return Vn.forEach(ye=>{const we=(ye?.vendor||"").toString().trim(),Ue=we||"";if(fn(we))return;const Ge=parseFloat(ye?.price)||0,Ye=ye?.quantity===""?0:parseFloat(ye?.quantity)||0,et=Ge*Ye,st=et*Ne(ye),it=X.get(Ue)||{vendor:Ue,net:0,taxed:0};it.net+=et,it.taxed+=st,X.set(Ue,it)}),Array.from(X.values()).map(ye=>({vendor:ye.vendor,net:ye.net,taxed:ye.taxed,total:ye.taxed}))},[Vn,fn,Ne]),yr=Ie.useMemo(()=>{const X=new Map;return Xn.forEach(ye=>{X.set(ye.vendor,ye)}),X},[Xn]),$r=Ie.useMemo(()=>{const X=new Map;try{for(const[ye,we]of(b||new Map).entries()){const Ue=String(ye??"").trim();Ue&&X.set(Ue,we)}}catch{}return X},[b]),Or=Ie.useCallback(X=>{const ye=Ae(X?.itemCategory??X?.item_category);if(ye)return ye;const we=String(X?.name??"").trim();if(!we)return"";const Ue=$r.get(we);return Ae(Ue?.itemCategory??Ue?.item_category)},[$r]),Pr=Ie.useMemo(()=>{const X=new Map;Vn.forEach((ye,we)=>{const Ue=(ye?.vendor||"").toString().trim(),Ge=Ue||"";if(fn(Ue))return;const Ye=parseFloat(ye?.price)||0,et=ye?.quantity===""?0:parseFloat(ye?.quantity)||0,st=Ye*et,it=st*Ne(ye),ot=Or(ye),ht=se(ot),vt=X.get(Ge)||{vendor:Ge,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};vt.totals[ht]+=it,vt.totals.net+=st,vt.totals.taxed+=it,vt.rows.push({id:ye?.id||`${Ge}-${ye?.name||"item"}-${we}`,name:ye?.name||"",unit:ye?.unit||"",quantity:et,price:Ye,taxed:it,itemCategory:ot,breakdownKey:ht}),X.set(Ge,vt)});for(const ye of X.values())ye.rows.sort((we,Ue)=>{const Ge={food:0,drink:1,unknown:2,supplies:3},Ye=Ge[we?.breakdownKey]??2,et=Ge[Ue?.breakdownKey]??2;if(Ye!==et)return Ye-et;const st=(we?.name||"").toString(),it=(Ue?.name||"").toString();return st.localeCompare(it,"ja")});return X},[Vn,fn,Ne,Or]),fr=Ie.useMemo(()=>Xn.slice().sort((X,ye)=>ye.taxed!==X.taxed?ye.taxed-X.taxed:X.vendor.localeCompare(ye.vendor,"ja")).map(X=>X.vendor),[Xn]),qs=Ie.useMemo(()=>{if(!nn)return fr;const X=Ht[nn],ye=new Set(yr.keys()),we=Array.isArray(X)?X.filter(Ge=>ye.has(Ge)):[],Ue=fr.filter(Ge=>!we.includes(Ge));return[...we,...Ue]},[Ht,nn,fr,yr]),vi=Ie.useMemo(()=>qs.map(X=>yr.get(X)).filter(Boolean),[qs,yr]),Os=vi.reduce((X,ye)=>(X.net+=ye.net||0,X.taxed+=ye.taxed||0,X),{net:0,taxed:0});k.useEffect(()=>{hn&&(yr.has(hn)||an(""))},[hn,yr]);const $a=X=>{an(ye=>ye===X?"":X)},xi=X=>{X?.id&&s&&(Y(!1),oe(null),ve(""),Le({title:"",message:`${X.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Y(!0),oe({type:"move",id:X.id});try{await mr.deleteSnapshotToTrash(s,X.id),await Vt(!0),ft({title:"",message:"",type:"success"})}catch(ye){console.error(ye),ft({title:"",message:"()",type:"error"})}finally{Y(!1),oe(null),Le(null)}}}))},je=X=>{X?.id&&s&&(Y(!1),oe(null),ve(""),Le({title:"",message:`${X.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Y(!0),oe({type:"restore",id:X.id});try{await mr.restoreSnapshotFromTrash(s,X.id),await Vt(!0),ft({title:"",message:"",type:"success"})}catch(ye){console.error(ye),ft({title:"",message:"",type:"error"})}finally{Y(!1),oe(null),Le(null)}}}))},rt=X=>{X?.id&&s&&(Y(!1),oe(null),ve(""),Le({title:" ",message:`${X.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{Y(!0),oe({type:"hard-delete",id:X.id});try{await mr.hardDeleteSnapshotFromTrash(s,X.id),await Vt(!0),ft({title:"",message:"",type:"success"})}catch(ye){console.error(ye),ft({title:"",message:"",type:"error"})}finally{Y(!1),oe(null),Le(null)}}}))},mt=X=>{if(!X)return;const ye=It(X).filter(at=>!fn(at?.vendor)),we=["","","","","()",""],Ue=ye.map(at=>{const Ot=parseFloat(at?.price)||0,In=at?.quantity===""?0:parseFloat(at?.quantity)||0,Bn=Math.round(Ot*In*Ne(at));return[at?.name??"",Ot||"",at?.unit??"",at?.quantity??"",Bn||"",at?.vendor??""]}),Ge=at=>{const Ot=String(at??"");return Ot.includes(",")||Ot.includes('"')||Ot.includes(`
`)||Ot.includes("\r")?`"${Ot.replace(/"/g,'""')}"`:Ot},Ye=[we.map(Ge).join(","),...Ue.map(at=>at.map(Ge).join(","))].join(`
`),et=new Uint8Array([239,187,191]),st=new Blob([et,Ye],{type:"text/csv"}),it=URL.createObjectURL(st),ot=(X.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),ht=(X.snapshot_date?new Date(X.snapshot_date):new Date).toISOString().slice(0,10),vt=document.createElement("a");vt.href=it,vt.download=`InventorySnapshot_${ht}_${ot}.csv`,document.body.appendChild(vt),vt.click(),document.body.removeChild(vt),URL.revokeObjectURL(it)},Dt=()=>{if(!ct)return;const X=["","()"],ye=vi.map(at=>[at.vendor,Math.round(at.total||0)]),we=at=>{const Ot=String(at??"");return Ot.includes(",")||Ot.includes('"')||Ot.includes(`
`)||Ot.includes("\r")?`"${Ot.replace(/"/g,'""')}"`:Ot},Ue=[X.map(we).join(","),...ye.map(at=>at.map(we).join(","))].join(`
`),Ge=new Uint8Array([239,187,191]),Ye=new Blob([Ge,Ue],{type:"text/csv"}),et=URL.createObjectURL(Ye),st=(ct.snapshot_date?new Date(ct.snapshot_date):new Date).toISOString().slice(0,10),it=ct.title||"inventory_summary",ot=$t?`${$t.year}${String($t.month).padStart(2,"0")}`:st,ht=it.toString().replace(/[\\/:*?"<>|]/g,"_"),vt=document.createElement("a");vt.href=et,vt.download=`InventorySummary_${ot}_${ht}.csv`,document.body.appendChild(vt),vt.click(),document.body.removeChild(vt),URL.revokeObjectURL(et)},vn=X=>{if(!X?.vendor)return;const ye=["","","","","","()",""],we=(X.rows||[]).map(at=>{const Ot=at.itemCategory?ce(at.itemCategory):xe(at.breakdownKey);return[at.name||"",Ot,Math.round(at.price||0),at.unit||"",Number(at.quantity||0),Math.round(at.taxed||0),X.vendor]}),Ue=at=>{const Ot=String(at??"");return Ot.includes(",")||Ot.includes('"')||Ot.includes(`
`)||Ot.includes("\r")?`"${Ot.replace(/"/g,'""')}"`:Ot},Ge=[ye.map(Ue).join(","),...we.map(at=>at.map(Ue).join(","))].join(`
`),Ye=new Uint8Array([239,187,191]),et=new Blob([Ye,Ge],{type:"text/csv"}),st=URL.createObjectURL(et),it=(ct?.snapshot_date?new Date(ct.snapshot_date):new Date).toISOString().slice(0,10),ot=$t?`${$t.year}${String($t.month).padStart(2,"0")}`:it,ht=X.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),vt=document.createElement("a");vt.href=st,vt.download=`InventorySummary_${ot}_${ht}.csv`,document.body.appendChild(vt),vt.click(),document.body.removeChild(vt),URL.revokeObjectURL(st)},En=Ie.useMemo(()=>{const X=gt=>gt?gt.toString().trim():"",ye=gt=>Jt(gt),we=new Set;try{for(const gt of(w||new Set).values()){const St=ye(gt);St&&we.add(St)}}catch{}const Ue=new Set;try{for(const gt of(We||new Set).values()){const St=ye(gt);St&&Ue.add(St)}}catch{}const Ge=new Map;try{for(const[gt,St]of(b||new Map).entries()){const At=ye(gt);At&&Ge.set(At,St)}}catch{}const Ye=new Map;try{(m||[]).forEach(gt=>{const St=ye(gt?.name);St&&Ye.set(St,gt)})}catch{}const et=new Map;try{for(const[gt,St]of(S||new Map).entries()){const At=ye(gt);At&&et.set(At,St)}}catch{}const st=gt=>{const St=String(gt??"").trim();if(!St)return"";const At=St.toLowerCase();return At===""?"g":At===""?"ml":At===""?"cc":At===""?"kg":At===""?"l":At===""?"cl":At},it=(gt,St)=>{const At=parseFloat(gt?.lastPrice),Tn=parseFloat(gt?.packetSize),Fn=st(gt?.packetUnit),er=st(St||Fn);if(!Number.isFinite(At)||!Number.isFinite(Tn)||Tn<=0||!Fn)return null;const Gt=At/Tn;if(er===Fn)return Gt;if(Fn==="g"&&er==="kg")return Gt*1e3;if(Fn==="kg"&&er==="g")return Gt/1e3;const xr=Fn==="cc"?"ml":Fn,Hn=er==="cc"?"ml":er;return xr==="ml"&&Hn==="l"?Gt*1e3:xr==="l"&&Hn==="ml"?Gt/1e3:xr==="cl"&&Hn==="ml"?At/Tn/10:xr==="ml"&&Hn==="cl"?Gt*10:xr==="cl"&&Hn==="cl"?Gt:null},ot=gt=>{const St=String(gt??"").trim();return St?["","","","","","","","pc","PC",""].includes(St):!1},ht=gt=>{const St=ye(gt?.name),At=St?Ge.get(St):null,Tn=St?Ye.get(St):null,Fn=St&&et.has(St)?String(et.get(St)||""):String(Tn?.unit||""),er={...gt};if(er.name=X(er.name),er.vendor=X(er.vendor),er._csv={unit:Fn,price:Tn?.price??null,vendor:X(Tn?.vendor)||null,dateStr:Tn?.dateStr??null},!At)return er;const Gt={...er},xr=Ae(At?.itemCategory),Hn=At.packetUnit||"",Fs=parseFloat(At.packetSize),xs=Hn?it(At,Hn):null;if(Gt.isPhantom)Hn&&xs!==null&&(Gt.unit=Hn,Gt.price=xs);else{if(!!Hn&&Number.isFinite(Fs)&&Fs>0&&(ot(Gt.unit)||!Gt.unit)&&xs!==null){const Hs=Gt.quantity;if(Hs!==""&&Hs!==null&&Hs!==void 0){const aa=parseFloat(Hs);Number.isFinite(aa)&&(Gt.quantity=aa*Fs)}const _i=Gt.threshold;if(_i!==""&&_i!==null&&_i!==void 0){const aa=parseFloat(_i);Number.isFinite(aa)&&(Gt.threshold=aa*Fs)}Gt.unit=Hn}else(Hn&&xs!==null||!Gt.unit&&Hn)&&(Gt.unit=Hn);if(xs!==null&&st(Gt.unit)===st(Hn))Gt.price=xs;else{const Hs=it(At,Gt.unit||Hn);Hs!==null&&(Gt.price=Hs)}}const wi=Se(Gt?.tax10_override??Gt?.tax10Override),tl=xr?Qe(xr):null;return Gt._master={packetSize:At.packetSize,packetUnit:At.packetUnit,lastPrice:At.lastPrice,itemCategory:xr||null,tax10Auto:tl,tax10Override:wi,updatedAt:At.updatedAt},xr&&(Gt.tax10_override=wi,!wi&&tl!==null&&(Gt.tax10=tl)),Gt},vt=l.map(ht),at=new Map;vt.forEach(gt=>{const St=ye(gt?.name);St&&at.set(St,gt)});const Ot=[...vt];m.forEach((gt,St)=>{const At=String(gt?.name??""),Tn=X(At),Fn=ye(At);if(Fn&&!(w.has(At)||Tn&&w.has(Tn)||we.has(Fn))&&!at.has(Fn)){const er={id:`phantom-${St}`,isPhantom:!0,name:Tn,quantity:"",unit:gt.unit||"",category:"",price:gt.price,vendor:X(gt.vendor),threshold:0,tax10:!1,tax10_override:!1};Ot.push(ht(er))}});const In=Ot.filter(gt=>{const St=String(gt?.name??""),At=X(St),Tn=ye(St);return!(w.has(St)||At&&w.has(At)||Tn&&we.has(Tn)||We.has(St)||At&&We.has(At)||Tn&&Ue.has(Tn)||fn(gt.vendor))}),Bn=gt=>{if(!gt)return-1;const At=new Date(gt).getTime();return Number.isFinite(At)?At:-1},es=(gt,St)=>{const At=!!gt?.isPhantom,Tn=!!St?.isPhantom;if(At!==Tn)return At?St:gt;const Fn=Math.max(Bn(gt?.updated_at),Bn(gt?.updatedAt),Bn(gt?.created_at),Bn(gt?.createdAt)),er=Math.max(Bn(St?.updated_at),Bn(St?.updatedAt),Bn(St?.created_at),Bn(St?.createdAt));if(Fn!==er)return er>Fn?St:gt;const Gt=gt?.quantity,xr=St?.quantity,Hn=Gt===""||Gt===null||Gt===void 0?null:parseFloat(Gt),Fs=xr===""||xr===null||xr===void 0?null:parseFloat(xr),xs=Hn!==null&&Number.isFinite(Hn),wi=Fs!==null&&Number.isFinite(Fs);return xs!==wi&&wi?St:gt},vs=new Map;return In.forEach(gt=>{const St=ye(gt?.name)||X(gt?.name);if(!St)return;const Tn=`${X(gt?.vendor)||"__no_vendor__"}@@${St}`,Fn=vs.get(Tn);if(!Fn){vs.set(Tn,gt);return}vs.set(Tn,es(Fn,gt))}),Array.from(vs.values())},[l,m,w,We,b,S,fn]),An=X=>{const{active:ye,over:we}=X;if(!we)return;if(ye?.data?.current?.type==="summary-row"){if(!nn)return;const Ge=ye.id,Ye=we.id;if(!Ge||!Ye||Ge===Ye)return;const et=qs,st=et.indexOf(Ge),it=et.indexOf(Ye);if(st<0||it<0)return;const ot=ra(et,st,it);gn(ht=>({...ht,[nn]:ot}));return}if(we.id==="inventory-list-droppable"){const Ge=ye.data.current.item;if(ye.data.current.type==="csv-item"){const Ye=String(Ge?.name??"").trim(),et=Jt(Ye);let st=null;if(b&&b.size>0&&et&&(st=b.get(Ye)||null,!st)){for(const[vt,at]of b.entries())if(Jt(vt)===et){st=at;break}}const it=st?.packetUnit||Ge.unit,ot=st?te(st,it):null,ht=ot!==null?ot:st?.lastPrice!==null&&st?.lastPrice!==void 0&&st?.lastPrice!==""?st.lastPrice:Ge.price;U({name:Ge.name,price:ht,unit:it,category:"",threshold:0,quantity:0,vendor:Ge.vendor,tax10:Se(Ge?.tax10),isNewFromCsv:!0}),q(!0),V(Ge.name||"")}}},ar=async X=>{if(X.preventDefault(),!s)return;const ye=new FormData(X.target),we=ye.get("name"),Ue=parseFloat(ye.get("quantity")),Ge=ye.get("unit"),Ye=ye.get("category"),et=parseFloat(ye.get("threshold")),st=ye.get("vendor"),it=parseFloat(ye.get("price")),ot=ye.get("packetSize"),ht=ye.get("packetUnit"),vt={name:we,quantity:Number.isFinite(Ue)?Ue:0,unit:Ge,category:Ye,threshold:Number.isFinite(et)?et:0,vendor:st||I?.vendor||"",price:Number.isFinite(it)?it:I?.price||0,tax10:Se(I?.tax10)};try{if(ot&&ht){const at=parseFloat(ot);Number.isFinite(at)&&at>0&&await On.saveConversion(we,at,ht,Number.isFinite(it)?it:null,Ye,st)}I?.id&&!I.isPhantom?await mr.update(s,{...I,...vt}):await mr.add(s,vt),q(!1),U(null),Vt()}catch(at){console.error("Failed to save item:",at),ft({title:"",message:"",type:"error"})}},Rt=X=>{Je(X),Re(!0)},Zn=X=>{!X||X.isPhantom||!X?._master?.packetUnit||(M(X),H(!0))},kn=()=>{z||(H(!1),M(null))},Yn=async({convertQuantity:X})=>{if(!s)return;const ye=C;if(!ye||ye.isPhantom)return;const we=ye?._master?.packetUnit;if(!we)return;const Ue=we,Ge=te(ye?._master,Ue);if(Ge===null){ft({title:"",message:"/",type:"error"});return}let Ye=ye.quantity,et=ye.threshold;if(X){const st=ze(ye.unit,Ue);if(!st){ft({title:"",message:"kgg / lml ",type:"error"});return}const it=ye.quantity===""?null:parseFloat(ye.quantity);it!==null&&Number.isFinite(it)&&(Ye=it*st);const ot=ye.threshold===""?null:parseFloat(ye.threshold);ot!==null&&Number.isFinite(ot)&&(et=ot*st)}B(!0);try{await mr.update(s,{id:ye.id,unit:Ue,price:Ge,quantity:Ye===""?0:parseFloat(Ye)||0,threshold:et===""?0:parseFloat(et)||0,tax10:Se(ye?.tax10)}),await Vt(!0),H(!1),M(null)}catch(st){console.error("Failed to sync unit:",st),ft({title:"",message:"",type:"error"})}finally{B(!1)}},Xr=async()=>{if(Pe)try{const ye=(we=>we?we.toString().trim():"")(Pe?.name);ye&&Et(we=>{const Ue=new Set(we);return Ue.add(ye),Ue}),Re(!1),Je(null)}catch(X){console.error("Failed to delete/ignore item:",X)}},Zr=async(X,ye)=>{try{if(!s)return;const we=En.find(Ue=>Ue.id===X);if(!we)return;if(we.isPhantom){const Ue={name:we.name.trim(),quantity:ye,unit:we.unit,category:we.category||"",price:we.price,vendor:we.vendor,threshold:0,tax10:Se(we?.tax10)},Ge=await mr.add(s,Ue);await Vt(!0),_t(Ye=>{const et=new Set(Ye);return et.add(Ge.id),et})}else c(Ue=>Ue.map(Ge=>Ge.id!==X?Ge:{...Ge,quantity:ye,unit:we.unit??Ge.unit,price:we.price??Ge.price,threshold:we.threshold??Ge.threshold})),_t(Ue=>{const Ge=new Set(Ue);return Ge.add(X),Ge}),await mr.update(s,{...we,quantity:ye})}catch(we){console.error(we);const Ue=we?.message||we?.error_description||(typeof we=="string"?we:null)||(()=>{try{return JSON.stringify(we)}catch{return null}})()||"";ft({title:"",message:`
${Ue}`,type:"error"}),Vt()}},on=async(X,ye)=>{try{if(!s||!X)return;const we=!!ye;if(X.isPhantom){const Ue={name:X.name.trim(),quantity:X.quantity===""?0:parseFloat(X.quantity)||0,unit:X.unit,category:X.category||"",price:X.price,vendor:X.vendor,threshold:0,tax10:we,tax10_override:!0};await mr.add(s,Ue),await Vt(!0)}else{const Ue=new Date().toISOString();c(Ge=>Ge.map(Ye=>Ye.id===X.id?{...Ye,tax10:we,tax10_override:!0,updated_at:Ue,updatedAt:Ue}:Ye)),await mr.update(s,{...X,tax10:we,tax10_override:!0}),await Vt(!0)}}catch(we){console.error(we);const Ue=we?.message||we?.error_description||(typeof we=="string"?we:null)||(()=>{try{return JSON.stringify(we)}catch{return null}})()||"";ft({title:"",message:`
${Ue}`,type:"error"}),Vt()}},or=(X,ye)=>{if(ye===!0){sn({item:X});return}on(X,ye)},vr=()=>{wt||sn(null)},Ds=async()=>{const X=Tt?.item;if(X){Un(!0);try{await on(X,!0),sn(null)}finally{Un(!1)}}},sa=async()=>{if(!L&&Z&&s){J(!0);try{const X=En.filter(we=>!we.isPhantom).map(we=>{const Ue={...we};return delete Ue.isPhantom,delete Ue._master,delete Ue._csv,Ue}),ye=X.reduce((we,Ue)=>{const Ge=parseFloat(Ue.price)||0,Ye=Ue.quantity===""?0:parseFloat(Ue.quantity)||0;return we+Ge*Ye*Ne(Ue)},0);await mr.createSnapshot(s,Z,X,ye),ae?(await mr.resetStockQuantities(s),await Vt(),_t(new Set)):await Vt(!0),Q(!1),dt(!0)}catch(X){console.error("Failed to complete inventory:",X);const ye=X?.message||X?.error_description||(typeof X=="string"?X:null)||(()=>{try{return JSON.stringify(X)}catch{return null}})()||"";ft({title:"",message:`
${ye}`,type:"error"})}finally{J(!1)}}},gs=()=>{const X=["","","","","()",""],ye=bi.map(it=>{const ot=parseFloat(it.price)||0,ht=it.quantity===""?0:parseFloat(it.quantity)||0,vt=Math.round(ot*ht*Ne(it));return[it.name,ot,it.unit,it.quantity,vt,it.vendor||""]}),we=[X.join(","),...ye.map(it=>it.map(ot=>{const ht=String(ot??"");return ht.includes(",")||ht.includes('"')||ht.includes(`
`)?`"${ht.replace(/"/g,'""')}"`:ht}).join(","))].join(`
`),Ue=new Uint8Array([239,187,191]),Ge=new Blob([Ue,we],{type:"text/csv"}),Ye=document.createElement("a"),et=URL.createObjectURL(Ge),st=new Date().toISOString().split("T")[0];Ye.href=et,Ye.download=`Inventory_${st}.csv`,document.body.appendChild(Ye),Ye.click(),document.body.removeChild(Ye),URL.revokeObjectURL(et)},zs=["","","","","","","","","","","",""],Zo=[...new Set(En.map(X=>X.vendor).filter(X=>X&&!fn(X)))].sort(),el=En.some(X=>!X.vendor),ia=qt==="summary",bi=En.filter(X=>X.name.toLowerCase().includes(R.toLowerCase())?qt==="all"||qt==="summary"?!0:qt==="inventory-check"?yn.has(X.id)||!X.isPhantom:qt==="other"?!X.vendor:X.vendor===qt:!1),ys=X=>{if(!X)return;const ye=Jt(X.name);let we=null;if(b&&b.size>0&&ye&&(we=b.get(X.name)||null,!we)){for(const[Ue,Ge]of b.entries())if(Jt(Ue)===ye){we=Ge;break}}if(we){const Ue=we.packetUnit||I?.unit||"",Ge=we.packetUnit?te(we,Ue):null,Ye=Ge!==null?Ge:we.lastPrice||I?.price||0;U(et=>({...et,name:X.name,price:Ye,unit:Ue,vendor:we.vendor||et?.vendor||"",_master:{packetSize:we.packetSize,packetUnit:we.packetUnit,lastPrice:we.lastPrice,itemCategory:we.itemCategory,updatedAt:we.updatedAt}}))}else U(Ue=>({...Ue,name:X.name}))};if(F){const X=I?._master?.packetSize||"",ye=I?._master?.packetUnit||"";return r.jsxs("div",{className:"inventory-edit-container fade-in",children:[r.jsx("div",{className:"container-header",children:r.jsx("h2",{className:"section-title",children:I&&!I.isNewFromCsv?"":""})}),r.jsx(mn,{className:"edit-form-card",children:r.jsxs("form",{onSubmit:ar,children:[r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(Ld,{name:"name",required:!0,value:P,onChange:we=>V(we.target.value),onSelect:ys,placeholder:": "})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:""}),r.jsx(Mt,{name:"vendor",defaultValue:I?.vendor,list:"vendor-list",placeholder:": "}),r.jsx("datalist",{id:"vendor-list",children:Zo.filter(we=>we!=="").map(we=>r.jsx("option",{value:we},we))})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:" ()"}),r.jsx(Mt,{name:"price",type:"number",step:"1",defaultValue:I?.price,placeholder:"0"})]})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(Mt,{name:"quantity",type:"number",step:"0.01",defaultValue:I?.quantity,required:!0})]}),r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(Mt,{name:"unit",defaultValue:I?.unit||"pc",required:!0,placeholder:"g, ml, , pc..."})]})]}),r.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px",color:"#495057"},children:["  ()",r.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",marginLeft:"8px",color:"#868e96"},children:" 1pc = 400g "})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{fontSize:"0.85rem"},children:" (1)"}),r.jsx(Mt,{name:"packetSize",type:"number",step:"0.01",defaultValue:X,placeholder:": 400"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{fontSize:"0.85rem"},children:""}),r.jsx(Mt,{name:"packetUnit",defaultValue:ye,placeholder:": g"})]})]})]}),r.jsxs("div",{className:"form-row",style:{marginTop:"16px"},children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:""}),r.jsx(Mt,{name:"category",defaultValue:I?.category,list:"category-list",placeholder:"",autoComplete:"off"}),r.jsx("datalist",{id:"category-list",children:zs.map(we=>r.jsx("option",{value:we},we))})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:" ()"}),r.jsx(Mt,{name:"threshold",type:"number",step:"0.01",defaultValue:I?.threshold||0})]})]}),r.jsxs("div",{className:"form-actions",children:[r.jsx(he,{variant:"ghost",type:"button",onClick:()=>{q(!1),U(null)},children:""}),r.jsx(he,{variant:"primary",type:"submit",children:""})]})]})})]})}return r.jsx(ea,{onDragEnd:An,sensors:Lt,autoScroll:!1,children:r.jsxs("div",{className:"inventory-container fade-in",children:[r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions inventory-header-actions",children:[r.jsx(he,{variant:"ghost",onClick:n,children:" "}),r.jsx(he,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>a({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),r.jsx(he,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const X=new Date;A(`${X.getFullYear()}${X.getMonth()+1} `),ue(!0),Q(!0)},children:" "}),r.jsx(he,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{be(null),ie("history"),fe(!0)},title:"",children:" "}),r.jsx(he,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{U(null),V(""),q(!0)},children:"+ "})]})]}),r.jsx("div",{className:"inventory-split-layout",children:r.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[r.jsxs("div",{className:"inventory-controls",children:[ia?r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[r.jsxs("div",{className:"inventory-controls__field",children:[r.jsx("label",{className:"inventory-controls__label",children:":"}),r.jsx("select",{className:"inventory-controls__select",value:jt,onChange:X=>Kt(X.target.value),disabled:Xe.length===0,children:Xe.length===0?r.jsx("option",{value:"",children:""}):Xe.map(X=>r.jsx("option",{value:X.key,children:X.label},X.key))})]}),$t&&r.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",$t.rangeLabel]})]}):r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[r.jsxs("div",{className:"inventory-controls__field",children:[r.jsx("label",{className:"inventory-controls__label",children:":"}),r.jsxs("select",{className:"inventory-controls__select",value:qt==="inventory-check"?"":qt,onChange:X=>{X.target.value&&un(X.target.value)},children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",disabled:!0,children:""}),r.jsxs("optgroup",{label:"",children:[Zo.map(X=>r.jsx("option",{value:X,children:X},X)),el&&r.jsx("option",{value:"other",children:""})]})]})]}),r.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:R,onChange:X=>$(X.target.value)})]}),r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[r.jsxs("button",{className:"inventory-controls__btn",onClick:()=>un("inventory-check"),"data-active":qt==="inventory-check"?"true":"false",children:["  (",yn.size,")"]}),r.jsx("button",{className:"inventory-controls__btn",onClick:()=>un("summary"),"data-active":qt==="summary"?"true":"false",children:" "}),!ia&&r.jsx("button",{className:"inventory-controls__btn",onClick:gs,title:"CSV",children:" CSV (.csv)"}),!ia&&qt==="inventory-check"&&r.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),ia?r.jsxs("div",{className:"inventory-summary",children:[r.jsx("div",{className:"inventory-summary__header",children:r.jsxs("div",{children:[r.jsx("div",{className:"inventory-summary__title",children:""}),$t&&r.jsxs("div",{className:"inventory-summary__meta",children:[": ",$t.rangeLabel]}),ct?r.jsxs("div",{className:"inventory-summary__meta",children:[": ",ct.title||"","",Cn(ct.snapshot_date),""]}):r.jsx("div",{className:"inventory-summary__meta",children:""}),Ve.length>1&&r.jsxs("div",{className:"inventory-summary__note",children:[" ",Ve.length," "]})]})}),ct?r.jsxs("div",{className:"inventory-summary__table-wrap",children:[r.jsx("div",{className:"inventory-summary__actions",children:r.jsx(he,{variant:"secondary",size:"sm",onClick:Dt,children:" CSV (.csv)"})}),r.jsxs("table",{className:"inventory-summary__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40px"}}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),r.jsx(Ua,{items:qs,strategy:qo,children:r.jsxs("tbody",{children:[vi.map(X=>{const ye=hn===X.vendor,we=Pr.get(X.vendor)||null;return r.jsxs(Ie.Fragment,{children:[r.jsx(Dn,{row:X,onVendorClick:$a,isSelected:ye}),ye&&we&&r.jsxs("tr",{className:"inventory-summary__detail-row",children:[r.jsx("td",{}),r.jsx("td",{colSpan:"2",children:r.jsxs("div",{className:"inventory-summary__inline-detail",children:[r.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[r.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[we.vendor," "]}),r.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>vn(we),disabled:!we.rows||we.rows.length===0,children:" CSV"}),r.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(we.totals.taxed||0).toLocaleString()]})]})]}),r.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(Ue=>r.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[r.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:xe(Ue)}),r.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(we.totals[Ue]||0).toLocaleString()]})]},Ue)),we.totals.unknown>0&&r.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[r.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),r.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(we.totals.unknown).toLocaleString()]})]})]}),r.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(we.totals.net||0).toLocaleString()]}),r.jsx("div",{className:"inventory-summary__inline-items-wrap",children:r.jsxs("table",{className:"inventory-summary__inline-items-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),r.jsx("tbody",{children:we.rows.map((Ue,Ge)=>{const Ye=Ue.itemCategory?ce(Ue.itemCategory):xe(Ue.breakdownKey),et=Ge>0?we.rows[Ge-1]:null,st=!!et&&et.breakdownKey!==Ue.breakdownKey;return r.jsxs("tr",{className:st?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[r.jsx("td",{children:Ue.name||"-"}),r.jsx("td",{children:Ye}),r.jsxs("td",{style:{textAlign:"right"},children:["",Number(Ue.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),r.jsxs("td",{style:{textAlign:"right"},children:[Number(Ue.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),Ue.unit?` ${Ue.unit}`:""]}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(Ue.taxed||0).toLocaleString()]})]},Ue.id)})})]})})]})})]})]},X.vendor)}),vi.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsx("td",{}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),r.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(Os.net).toLocaleString()," / ",Math.round(Os.taxed).toLocaleString()]})]})})]})]}):r.jsx("div",{className:"inventory-summary__empty",children:""})]}):r.jsx(z2,{items:bi,loading:N,onSearch:$,searchQuery:R,onEdit:X=>{U(X),V(X?.name||""),q(!0)},onDelete:Rt,onUpdateQuantity:Zr,onToggleTax:or,onRequestUnitSync:Zn})]})}),r.jsx(rn,{isOpen:!!Tt,onClose:vr,title:"10%",size:"small",showCloseButton:!wt,children:r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",Tt?.item?.name||"","",r.jsx("strong",{children:"10%"}),""]}),r.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[r.jsx(he,{variant:"secondary",onClick:vr,disabled:wt,children:""}),r.jsx(he,{variant:"primary",onClick:Ds,disabled:wt,children:wt?"...":""})]})]})}),r.jsx(rn,{isOpen:K,onClose:()=>{L||Q(!1)},title:" ",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),r.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[r.jsx("strong",{children:":"}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. ",ae?r.jsxs(r.Fragment,{children:[r.jsx("strong",{children:"()0"}),""]}):r.jsxs(r.Fragment,{children:[r.jsx("strong",{children:""}),""]}),r.jsx("br",{}),""]}),r.jsxs("div",{style:{marginBottom:"16px"},children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[r.jsx("input",{type:"radio",name:"inventory-reset",checked:ae,disabled:L,onChange:()=>ue(!0)}),r.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",r.jsx("strong",{children:"0"}),""]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"radio",name:"inventory-reset",checked:!ae,disabled:L,onChange:()=>ue(!1)}),r.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",r.jsx("strong",{children:""}),""]})]}),r.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),r.jsx("input",{type:"text",value:Z,onChange:X=>A(X.target.value),disabled:L,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx("button",{onClick:()=>{L||Q(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:L?"not-allowed":"pointer",opacity:L?.6:1,fontSize:"0.9rem"},children:""}),r.jsx("button",{onClick:sa,disabled:L,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:L?"#94a3b8":"#2ecc71",color:"white",cursor:L?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:L?"...":ae?"":""})]}),L&&r.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),r.jsxs(rn,{isOpen:Ce,onClose:()=>fe(!1),title:" ",size:"large",children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[r.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:le==="history"?r.jsxs(r.Fragment,{children:[": ",r.jsx("strong",{children:Pt.length})," "]}):r.jsxs(r.Fragment,{children:[": ",r.jsx("strong",{children:f.length})," "]})}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{type:"button",onClick:()=>ie("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:le==="history"?"#111":"#fff",color:le==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),r.jsx("button",{type:"button",onClick:()=>ie("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:le==="trash"?"#111":"#fff",color:le==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>Vt(!0),title:"",children:" "})]})]}),le==="history"&&r.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),r.jsx("select",{value:Ft,onChange:X=>dn(X.target.value),disabled:Xe.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:Xe.length===0?r.jsx("option",{value:"",children:""}):Xe.map(X=>r.jsx("option",{value:X.key,children:X.label},X.key))})]}),lt&&r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",lt.rangeLabel]})]}),le==="history"&&Pt.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):le==="trash"&&f.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f0f0f0"},children:[r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:le==="trash"?"":""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),r.jsx("tbody",{children:(le==="history"?Pt:f).map(X=>{const ye=It(X).filter(ht=>!fn(ht?.vendor)),we=ye.length,Ue=Math.round(ye.reduce((ht,vt)=>{const at=parseFloat(vt?.price)||0,Ot=vt?.quantity===""?0:parseFloat(vt?.quantity)||0;return ht+at*Ot*Ne(vt)},0)),Ge=le==="trash"?`trash-${X.id}`:X.id,Ye=Cn(le==="trash"?X.deleted_at:X.snapshot_date),et=W?.type==="move"&&W?.id===X.id,st=W?.type==="restore"&&W?.id===X.id,it=W?.type==="hard-delete"&&W?.id===X.id,ot=et||st||it;return r.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[r.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Ye}),r.jsx("td",{style:{padding:"10px"},children:X.title||"-"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:we.toLocaleString()}),r.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",Ue.toLocaleString()]}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:le==="history"?r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>mt(X),disabled:we===0||ot,title:we===0?"items CSV":"CSV",children:" CSV"}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>be(X),disabled:ot,children:""}),r.jsx(he,{variant:"danger",size:"sm",onClick:()=>xi(X),disabled:ot,title:"",children:et?"...":""})]}):r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>mt(X),disabled:we===0||ot,children:" CSV"}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>be(X),disabled:ot,children:""}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>je(X),disabled:ot,title:"",children:st?"...":""}),r.jsx(he,{variant:"danger",size:"sm",onClick:()=>rt(X),disabled:ot,title:"",children:it?"...":""})]})})]},Ge)})})]})})]}),r.jsx(rn,{isOpen:!!Te,onClose:()=>{ge||Le(null)},title:Te?.title||"",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:Te?.message}),Te?.requireText&&r.jsxs("div",{style:{marginTop:"14px"},children:[r.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",r.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:Te.requireText})," "]}),r.jsx("input",{type:"text",value:E,onChange:X=>ve(X.target.value),placeholder:Te.requireText,disabled:ge,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(he,{variant:"ghost",disabled:ge,onClick:()=>{ge||Le(null)},children:""}),r.jsx(he,{variant:"danger",disabled:ge||!!Te?.requireText&&E!==Te.requireText,onClick:()=>Te?.onConfirm&&Te.onConfirm(),children:ge?Te?.loadingLabel||"...":Te?.confirmLabel||""})]})]})}),r.jsx(rn,{isOpen:!!ne,onClose:()=>be(null),title:ne?` ${ne.title||""}`:" ",size:"large",children:(()=>{const X=ne;if(!X)return null;const Ue=[...It(X).filter(Ye=>fn(Ye?.vendor)?!1:re?(Ye?.quantity===""?0:parseFloat(Ye?.quantity)||0)!==0:!0)].sort((Ye,et)=>{const st=de.direction==="desc"?-1:1;if(de.key==="vendor"){const Ot=(Ye?.vendor||"").toString(),In=(et?.vendor||"").toString(),Bn=Ot.localeCompare(In,"ja");if(Bn!==0)return Bn*st;const es=(Ye?.name||"").toString(),vs=(et?.name||"").toString();return es.localeCompare(vs,"ja")*st}const it=(Ye?.name||"").toString(),ot=(et?.name||"").toString(),ht=it.localeCompare(ot,"ja");if(ht!==0)return ht*st;const vt=(Ye?.vendor||"").toString(),at=(et?.vendor||"").toString();return vt.localeCompare(at,"ja")*st}),Ge=Ue.reduce((Ye,et)=>{const st=parseFloat(et?.price)||0,it=et?.quantity===""?0:parseFloat(et?.quantity)||0,ot=st*it;return Ye.net+=ot,Ye.taxed+=ot*Ne(et),Ye},{net:0,taxed:0});return r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[r.jsxs("div",{children:[": ",r.jsx("strong",{children:Cn(X.snapshot_date)})]}),r.jsxs("div",{children:[": ",r.jsx("strong",{children:Ue.length.toLocaleString()})]}),r.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",r.jsxs("strong",{children:["",Math.round(Ge.net).toLocaleString()," / ",Math.round(Ge.taxed).toLocaleString()]})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:re,onChange:Ye=>ee(Ye.target.checked)}),"0"]}),r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>mt(X),children:" CSV (.csv)"})]}),Ue.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f0f0f0"},children:[r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),r.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{me(Ye=>Ye.key==="vendor"?{key:"vendor",direction:Ye.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",de.key==="vendor"&&(de.direction==="asc"?"":"")]})]})}),r.jsx("tbody",{children:Ue.map((Ye,et)=>{const st=parseFloat(Ye?.price)||0,it=Ye?.quantity===""?0:parseFloat(Ye?.quantity)||0,ot=Math.round(st*it*Ne(Ye)),ht=Or(Ye),vt=ce(ht);return r.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[r.jsxs("td",{style:{padding:"10px"},children:[Ye?.name||"-",Se(Ye?.tax10)&&r.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),r.jsx("td",{style:{padding:"10px"},children:vt}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:st?`${Number(st).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),r.jsx("td",{style:{padding:"10px"},children:Ye?.unit||"-"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:it?it.toLocaleString():"0"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:ot?`${ot.toLocaleString()}`:"-"}),r.jsx("td",{style:{padding:"10px"},children:Ye?.vendor||"-"})]},Ye?.id||`${Ye?.name||"item"}-${et}`)})})]})})]})})()}),r.jsx(rn,{isOpen:D,onClose:kn,title:"",size:"small",children:(()=>{const X=C,ye=X?._master?.packetUnit||"",we=X?.unit||"",Ue=ze(we,ye),Ge=Ue!==null&&Ue!==1,Ye=parseFloat(X?.price)||0,et=X?.quantity===""?0:parseFloat(X?.quantity)||0,st=X?Ne(X):1.08,it=Ye*et*st,ot=ye?te(X?._master,ye):null,ht=ot===null?null:ot*et*st,vt=ot===null||!Ge?null:ot*(et*Ue)*st,at=In=>`${Math.round(In).toLocaleString()}`,Ot=In=>Number.isInteger(In)?In.toLocaleString():In.toLocaleString(void 0,{maximumFractionDigits:3});return r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:X?.name||"-"}),r.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",Ot(et)," ",we," /  ",Ye.toLocaleString()," /  ",at(it)]}),!!ye&&r.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",ye]})]}),r.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",r.jsx("br",{}),""]})}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[r.jsx(he,{variant:"ghost",type:"button",onClick:kn,disabled:z,children:""}),r.jsx(he,{variant:"secondary",type:"button",onClick:()=>Yn({convertQuantity:!1}),isLoading:z,disabled:z||!ye||ot===null,title:ht===null?"":`:  ${at(ht)}`,children:""}),Ge&&r.jsx(he,{variant:"primary",type:"button",onClick:()=>Yn({convertQuantity:!0}),isLoading:z,disabled:z||!ye||ot===null,title:vt===null?"":`:  ${at(vt)}`,children:""})]})]})})()}),r.jsx(rn,{isOpen:Be,onClose:()=>Re(!1),title:"",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",r.jsx("strong",{children:Pe?.name}),""]}),r.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),"CSV"]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx("button",{onClick:()=>Re(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),r.jsx("button",{onClick:Xr,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),r.jsx(rn,{isOpen:Wt,onClose:()=>dt(!1),title:" ",size:"small",children:r.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[r.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),r.jsxs("h3",{style:{marginBottom:"1rem"},children:[Z," "]}),r.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",r.jsx("br",{}),""]}),r.jsx("button",{onClick:()=>dt(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),r.jsx(rn,{isOpen:!!yt,onClose:()=>ft(null),title:yt?.title||"",size:"small",children:r.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[yt?.type==="success"&&r.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),yt?.type==="error"&&r.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),r.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:yt?.message}),r.jsx("button",{onClick:()=>ft(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:yt?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},Kl="app-data",L2="incoming-deliveries",U2=n=>{const e=String(n||"").trim();return e&&e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},I2=n=>{const e=String(n),s=e.lastIndexOf(".");return s<=0?e:e.slice(0,s)},B2=async n=>{if(!n)return"";const e=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(e)}catch{return String.fromCharCode(...new Uint8Array(e))}},As={async _getCurrentUserId(){const{data:n,error:e}=await Ee.auth.getUser();if(e)throw e;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${L2}`},_filePath(n,e){const s=this._folderPath(n),a=String(e||"").replace(/^\/+/,"");return`${s}/${a}`},async listJsonFiles(n=null){const e=n||await this._getCurrentUserId();if(!e)return[];const s=this._folderPath(e),{data:a,error:l}=await Ee.storage.from(Kl).list(s,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return l?(console.error("Failed to list incoming deliveries:",l),[]):(a||[]).filter(c=>String(c?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(n,e=null){const s=e||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._filePath(s,n),{data:l,error:c}=await Ee.storage.from(Kl).download(a);if(c)throw c;const u=await B2(l);return JSON.parse(u)},async saveDeliverySet({pdfFile:n,parsed:e},s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");if(!n)throw new Error("PDF");if(!e)throw new Error("");const l=new Date,c=`${l.getFullYear()}${String(l.getMonth()+1).padStart(2,"0")}${String(l.getDate()).padStart(2,"0")}_${String(l.getHours()).padStart(2,"0")}${String(l.getMinutes()).padStart(2,"0")}${String(l.getSeconds()).padStart(2,"0")}`,u=U2(I2(n.name||"delivery")),h=`${c}_${u}`,f=this._filePath(a,`${h}.pdf`),p=this._filePath(a,`${h}.json`),m={...e,_meta:{savedAt:l.toISOString(),originalFileName:n.name||null}},[y,b]=await Promise.all([Ee.storage.from(Kl).upload(f,n,{upsert:!1,contentType:"application/pdf"}),Ee.storage.from(Kl).upload(p,new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(y.error)throw y.error;if(b.error)throw b.error;return{baseName:h,pdfPath:f,jsonPath:p}},async deleteDeliverySet(n,e=null){const s=e||await this._getCurrentUserId();if(!s)throw new Error("");const a=String(n||"").trim();if(!a)throw new Error("baseName ");const l=this._filePath(s,`${a}.pdf`),c=this._filePath(s,`${a}.json`),{data:u,error:h}=await Ee.storage.from(Kl).remove([l,c]);if(h)throw h;return u}},$2="/app/assets/pdf.worker-DU8cYlj-.js",P2=n=>typeof n=="string"&&n.trim().length>0,di=n=>String(n??"").replace(/\u0000/g,"").trim(),Xl=n=>{const e=String(n??"").trim();if(!e)return null;const s=e.replace(/[,\s]/g,""),a=Number(s);return Number.isFinite(a)?a:null},Yl=n=>{const e=String(n??"").trim();if(!e)return null;const s=e.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return s?s[2]?`${s[1]} ${s[2]}`:s[1]:null},q2=n=>{const e=String(n??"").trim();return!!(!e||e==="/"||e.startsWith("")||e.includes(""))},F2=(n,e)=>{const s=String(n??"").trim(),a=s.match(/^No\.?\s*(\d{3,})\s*$/);if(a?.[1])return{slipNo:a[1],consumeNext:!1};if(/^No\.?\s*$/.test(s)){const l=String(e??"").trim();if(/^\d{3,}$/.test(l))return{slipNo:l,consumeNext:!0}}return null},Hp=n=>{const e=String(n??"").trim();return e?!!/^No\.?\s*(\d{3,})?\s*$/.test(e):!1},H2=(n,e)=>{const s=di(n[e]);if(!s||Hp(s)||s===""||s===""||s===""||s==="No"||s===""||s===""||s===""||s===""||s===""||s==="")return null;let a=e+1;const l=Xl(n[a]);if(l==null)return null;a+=1;const c=Xl(n[a]);if(c==null)return null;a+=1;const u=di(n[a]);if(!u)return null;a+=1;let h=null,f=null,p=null;const m=Xl(n[a]);for(m!=null?(f=m,a+=1,p=di(n[a]),a+=1):(h=di(n[a])||null,a+=1,f=Xl(n[a]),a+=1,p=di(n[a]),a+=1);a<n.length;){const v=di(n[a]);if(v===""||v===""){a+=1;continue}break}let y=null;const b=di(n[a]);return/^\d+$/.test(b)&&(y=parseInt(b,10),a+=1),{item:{no:y,code:null,name:s,unitPrice:l,deliveryQty:c,deliveryUnit:u,spec:h,orderQty:f,orderUnit:p},nextIndex:a}},V2=n=>{const e=(n||[]).map(di).filter(h=>!q2(h)),s={title:e.find(h=>h.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let h=0;h<e.length;h+=1){const f=e[h],p=f.match(/^?\s*(.+)$/);if(p?.[1]&&!s.outputAt){s.outputAt=Yl(p[1])||p[1].trim();continue}const m=f.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);m&&!s.rangeFrom&&(s.rangeFrom=m[1],s.rangeTo=m[2])}const a=new Map;let l=null,c=null;for(let h=0;h<e.length;h+=1){const f=e[h],p=e[h+1],m=F2(f,p);if(m?.slipNo){const y=m.slipNo;m.consumeNext&&(h+=1);const b=a.get(y);b?l=b:(l={slipNo:y,vendor:c||null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},a.set(y,l));continue}if(/^(||)/.test(f)&&!f.includes("")&&!f.includes("")&&!f.includes("")){let y=3;(f.startsWith("")||f.startsWith("")||f.startsWith(""))&&(y=4);let b=f.slice(y).trim();(b.startsWith(":")||b.startsWith(""))&&(b=b.slice(1).trim());let v=null;if(!b)P2(p)&&!/^\d+$/.test(p)&&!p.includes("")&&(v=p.trim());else{const S=b.match(/^(\d+)\s+(.+)$/);S&&(b=S[2].trim()),v=b}v&&(l?l.vendor||(l.vendor=v):c=v);continue}if(l){if(f===""||f.startsWith("")){const y=f.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);y?.[1]?l.slipDate=y[1]:Yl(p)&&(l.slipDate=Yl(p));continue}if(f===""){const y=Xl(p);y!=null&&(l.total=y);continue}if(f===""||f.startsWith("")){const y=f.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);y?.[1]?l.deliveryDate=y[1]:Yl(p)&&(l.deliveryDate=Yl(p)?.slice(0,10));continue}if(f.startsWith("")){const b=f.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(b&&b!=="No"){l.comment=b;continue}const v=[];for(let _=h+1;_<e.length;_+=1){const w=e[_];if(w){if(Hp(w)||w==="No"||w===""||w===""||w===""||w===""||w===""||w===""||w==="")break;v.push(w)}}const S=v.join(" ").trim();S&&S!=="No"&&(l.comment=S);continue}if(f===""||f===""){let y=h+1;for(;y<e.length;){const b=e[y];if(Hp(b)||b==="")break;const v=H2(e,y);if(!v){y+=1;continue}l.items.push(v.item),y=v.nextIndex}h=y-1}}}const u=Array.from(a.values()).sort((h,f)=>String(h.slipNo).localeCompare(String(f.slipNo),"ja"));return{report:s,slips:u}},Dx=async n=>{if(!n)throw new Error("PDF");const e=await n.arrayBuffer(),s=await nd(()=>import("./pdf-CVC8Mzfd.js").then(h=>h.p),[]),a=s?.default&&s.default.getDocument?s.default:s;if(!a?.getDocument)throw new Error("PDF");a?.GlobalWorkerOptions&&(a.GlobalWorkerOptions.workerSrc=$2);const l=await a.getDocument({data:new Uint8Array(e)}).promise,c=[];for(let h=1;h<=l.numPages;h+=1){const p=await(await l.getPage(h)).getTextContent();for(const m of p.items||[]){const y=di(m?.str);y&&c.push(y)}}const u=V2(c);if(!u?.slips||u.slips.length===0)throw new Error("PDFPDF");return u},bp=n=>String(n||"").replace(/\.json$/i,""),zx=n=>{if(!n)return"-";const e=new Date(n);if(Number.isNaN(e.getTime()))return String(n);const s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),c=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0");return`${s}/${a}/${l} ${c}:${u}`},G2=n=>{const e=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(e)?e:null},W2=n=>String(n||"").trim(),K2=({onBack:n})=>{const[e,s]=bc(),[a,l]=Ie.useState(!0),[c,u]=Ie.useState([]),[h,f]=Ie.useState(null),[p,m]=Ie.useState(!1),[y,b]=Ie.useState(!1),[v,S]=Ie.useState(null),[_,w]=Ie.useState(!1),[j,N]=Ie.useState(""),[T,R]=Ie.useState(null),[$,F]=Ie.useState(!1),[q,I]=Ie.useState(null),[U,P]=Ie.useState(!1),[V,D]=Ie.useState(!1),[H,C]=Ie.useState(null),M=Ie.useCallback(async()=>{l(!0),N("");try{const fe=await As.listJsonFiles();u(fe||[])}catch(fe){console.error(fe),N(""),u([])}finally{l(!1)}},[]);Ie.useEffect(()=>{M()},[M]);const z=fe=>{fe.preventDefault(),m(!0)},B=fe=>{fe.preventDefault(),m(!1)},K=fe=>{fe.preventDefault(),m(!1);const ne=fe.dataTransfer.files?.[0];ne&&ne.type==="application/pdf"?(f(ne),S(null),C(null),N(""),Q(ne)):ne&&N("PDF")},Q=async fe=>{if(fe){N(""),b(!0),S(null),C(null);try{const ne=await Dx(fe);S(ne||null)}catch(ne){console.error(ne),N(`PDF:
${ne?.message||String(ne)}`)}finally{b(!1)}}},Z=async()=>{if(h){N(""),b(!0),S(null),C(null);try{const fe=await Dx(h);S(fe||null)}catch(fe){console.error(fe),N(`PDF:
${fe?.message||String(fe)}`)}finally{b(!1)}}},A=async()=>{if(!(!h||!v)){N(""),w(!0);try{await As.saveDeliverySet({pdfFile:h,parsed:v}),f(null),S(null),await M()}catch(fe){console.error(fe),N(`: ${fe?.message||String(fe)}`)}finally{w(!1)}}},L=async fe=>{const ne=bp(fe);F(!0),N("");try{const be=await As.downloadJson(fe);R({baseName:ne,data:be})}catch(be){console.error(be),N(`: ${be?.message||String(be)}`)}finally{F(!1)}},J=async()=>{if(q?.baseName){P(!0),N("");try{await As.deleteDeliverySet(q.baseName),I(null),await M()}catch(fe){console.error(fe),N(`: ${fe?.message||String(fe)}`)}finally{P(!1)}}},ae=fe=>{const ne=new Map,be=(ie,Te)=>{const Le=String(ie?.name||"").trim();if(!Le)return;const E=W2(ie?.deliveryUnit||ie?.unit||ie?.unitName||""),ve=G2(ie?.deliveryQty??ie?.quantity??ie?.qty);if(!Number.isFinite(ve)||ve===null)return;const ge=String(Te||"").trim(),Y=`${ge}@@${Jt(Le)}@@${E||""}`,W=ne.get(Y);W?W.qty+=ve:ne.set(Y,{vendor:ge,name:Le,unit:E,qty:ve})};return(fe?.slips||fe?.receipts||[]).forEach(ie=>{const Te=ie?.vendor||"";(ie?.items||[]).forEach(E=>be(E,Te))}),Array.from(ne.values()).sort((ie,Te)=>ie.vendor!==Te.vendor?ie.vendor.localeCompare(Te.vendor,"ja"):ie.name!==Te.name?ie.name.localeCompare(Te.name,"ja"):String(ie.unit||"").localeCompare(String(Te.unit||""),"ja"))},ue=async()=>{D(!0),N(""),C(null);try{const fe=await As.listJsonFiles();if(!fe||fe.length===0){C([]);return}const ne=[];for(const ie of fe){const Te=ie?.name;if(Te)try{const Le=await As.downloadJson(Te);ne.push(Le)}catch(Le){console.warn("Failed to download:",Te,Le)}}const be=new Map;ne.forEach(ie=>{ae(ie).forEach(Le=>{const E=`${Le.vendor}@@${Jt(Le.name)}@@${Le.unit||""}`,ve=be.get(E);ve?ve.qty+=Le.qty:be.set(E,{...Le})})});const le=Array.from(be.values()).sort((ie,Te)=>ie.vendor!==Te.vendor?ie.vendor.localeCompare(Te.vendor,"ja"):ie.name!==Te.name?ie.name.localeCompare(Te.name,"ja"):String(ie.unit||"").localeCompare(String(Te.unit||""),"ja"));C(le)}catch(fe){console.error(fe),N(`: ${fe?.message||String(fe)}`)}finally{D(!1)}},Ce=v?.slips||v?.receipts||[];return r.jsxs("div",{className:"incoming-deliveries",children:[r.jsxs("div",{className:"incoming-deliveries__header",children:[r.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[r.jsx(he,{variant:"secondary",onClick:()=>s({view:"incoming-stock"}),children:" "}),r.jsx(he,{variant:"ghost",onClick:n,children:" "})]})]}),j&&r.jsx(mn,{className:"incoming-deliveries__error",children:j}),r.jsxs(mn,{className:"incoming-deliveries__card",children:[r.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",Io]}),r.jsxs("div",{className:"incoming-deliveries__upload",children:[r.jsxs("div",{className:`incoming-deliveries__upload-zone ${p?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:z,onDragLeave:B,onDrop:K,children:[r.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:p?"var(--color-primary)":"inherit"},children:p?"":"PDF"}),r.jsx("input",{type:"file",accept:"application/pdf",onChange:fe=>{const ne=fe.target.files?.[0]||null;f(ne),S(null),C(null),N("")},style:{width:"100%"}})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[r.jsx(he,{variant:"secondary",onClick:Z,disabled:!h||y||_,children:y?"":""}),r.jsx(he,{variant:"primary",onClick:A,disabled:!h||!v||_||y,children:_?"":""})]})]}),v&&r.jsxs("div",{className:"incoming-deliveries__preview",children:[r.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",r.jsx("strong",{children:v?.report?.outputAt||v?.report?.outputDate||"-"})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",r.jsx("strong",{children:Ce.length})]}),Ce.slice(0,3).map((fe,ne)=>r.jsxs("div",{className:"incoming-deliveries__slip",children:[r.jsxs("div",{className:"incoming-deliveries__slip-head",children:[r.jsx("div",{style:{fontWeight:700},children:fe?.vendor||""}),r.jsxs("div",{style:{opacity:.85},children:["No: ",fe?.slipNo||"-"," / : ",fe?.deliveryDate||"-"]})]}),r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"52%"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%"},children:""})]})}),r.jsx("tbody",{children:(fe?.items||[]).slice(0,6).map((be,le)=>r.jsxs("tr",{children:[r.jsx("td",{children:be?.name||"-"}),r.jsx("td",{style:{textAlign:"right"},children:be?.unitPrice!=null?`${Math.round(be.unitPrice).toLocaleString()}`:"-"}),r.jsx("td",{style:{textAlign:"right"},children:be?.deliveryQty!=null?be.deliveryQty:"-"}),r.jsx("td",{children:be?.deliveryUnit||"-"})]},`${be?.no||le}`))})]}),(fe?.items||[]).length>6&&r.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(fe?.items||[]).length-6)," "]})]},`${fe?.slipNo||fe?.id||ne}`)),Ce.length>3&&r.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),r.jsxs(mn,{className:"incoming-deliveries__card",children:[r.jsxs("div",{className:"incoming-deliveries__list-head",children:[r.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[r.jsx(he,{variant:"secondary",onClick:M,disabled:a||V,children:""}),r.jsx(he,{variant:"secondary",onClick:ue,disabled:a||V,children:V?"":""})]})]}),a?r.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):c.length===0?r.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):r.jsx("div",{className:"incoming-deliveries__file-list",children:c.map(fe=>r.jsxs("div",{className:"incoming-deliveries__file-row",children:[r.jsxs("div",{className:"incoming-deliveries__file-info",children:[r.jsx("div",{style:{fontWeight:700},children:bp(fe.name)}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",zx(fe.updated_at||fe.created_at)]})]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>L(fe.name),disabled:$||U,children:$?"":""}),r.jsx(he,{variant:"ghost",size:"sm",onClick:()=>I({baseName:bp(fe.name)}),disabled:U,children:""})]})]},fe.name))}),H&&r.jsxs("div",{className:"incoming-deliveries__aggregate",children:[r.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),H.length===0?r.jsx("div",{style:{opacity:.85},children:""}):r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"/"}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:H.slice(0,60).map(fe=>r.jsxs("tr",{children:[r.jsx("td",{children:fe.vendor||"-"}),r.jsx("td",{children:fe.name}),r.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(fe.qty)?fe.qty:"-"}),r.jsx("td",{children:fe.unit||"-"})]},`${fe.vendor}@@${fe.name}@@${fe.unit||""}`))})]}),H.length>60&&r.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),r.jsx(rn,{isOpen:!!T,onClose:()=>R(null),title:"PDF ",size:"large",children:T?.data?r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",zx(T.data?._meta?.savedAt),T.data?._meta?.originalFileName?` / : ${T.data._meta.originalFileName}`:""]}),(T.data?.slips||T.data?.receipts||[]).map((fe,ne)=>r.jsxs("div",{style:{marginBottom:"16px"},children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[fe?.vendor||"","No: ",fe?.slipNo||"-"," / : ",fe?.deliveryDate||"-",""]}),r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"52%"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%"},children:""})]})}),r.jsx("tbody",{children:(fe?.items||[]).map((be,le)=>r.jsxs("tr",{children:[r.jsx("td",{children:be?.name||"-"}),r.jsx("td",{style:{textAlign:"right"},children:be?.unitPrice!=null?`${Math.round(be.unitPrice).toLocaleString()}`:"-"}),r.jsx("td",{style:{textAlign:"right"},children:be?.deliveryQty!=null?be.deliveryQty:"-"}),r.jsx("td",{children:be?.deliveryUnit||"-"})]},`${be?.no||le}`))})]})]},`${fe?.slipNo||ne}`))]}):r.jsx("div",{style:{opacity:.8},children:""})}),r.jsx(rn,{isOpen:!!q,onClose:()=>I(null),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",q?.baseName,""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>I(null),disabled:U,children:""}),r.jsx(he,{variant:"danger",onClick:J,disabled:U,children:U?"":""})]})]})})]})},li="app-data",Y2="incoming-stock",Q2="stock.json",J2="applied",Ma=n=>{const e=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(e)?e:null},Fo=n=>String(n||"").trim(),La=(n,e,s)=>`${String(s||"").trim()}@@${Jt(n)}@@${Fo(e)}`,wp=n=>{const e=n?.statusCode??n?.status??null;if((typeof e=="string"?parseInt(e,10):e)===404)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("not found")||a.includes("object not found")},X2=n=>{const e=n?.statusCode??n?.status??null;if((typeof e=="string"?parseInt(e,10):e)===409)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("already exists")||a.includes("duplicate")||a.includes("409")},Z2=n=>{const e=new Map;return(n?.slips||n?.receipts||[]).forEach(a=>{const l=String(a?.vendor||"").trim();(a?.items||[]).forEach(c=>{const u=String(c?.name||"").trim();if(!u)return;const h=Fo(c?.deliveryUnit||c?.unit||c?.unitName||""),f=Ma(c?.deliveryQty??c?.quantity??c?.qty);if(f==null)return;const p=La(u,h,l),m=e.get(p);m?m.quantity+=f:e.set(p,{vendor:l,name:u,unit:h,quantity:f})})}),Array.from(e.values()).filter(a=>Number.isFinite(a.quantity))},eA=(n,e,s)=>{const a=new Map;return(n||[]).forEach(l=>{const c=String(l?.name||"").trim();if(!c)return;const u=Fo(l?.unit||""),h=String(l?.vendor||"").trim(),f=Ma(l?.quantity)??0;a.set(La(c,u,h),{vendor:h,name:c,unit:u,quantity:f,updatedAt:l?.updatedAt||null})}),e.forEach(l=>{const c=La(l.name,l.unit,l.vendor),u=a.get(c);u?(u.quantity=Math.max(0,(Ma(u.quantity)??0)+(Ma(l.quantity)??0)),u.updatedAt=s):a.set(c,{vendor:l.vendor,name:l.name,unit:Fo(l.unit),quantity:Math.max(0,Ma(l.quantity)??0),updatedAt:s})}),Array.from(a.values()).sort((l,c)=>l.vendor!==c.vendor?l.vendor.localeCompare(c.vendor,"ja"):l.name!==c.name?l.name.localeCompare(c.name,"ja"):String(l.unit||"").localeCompare(String(c.unit||""),"ja"))},ci={async _getCurrentUserId(){const{data:n,error:e}=await Ee.auth.getUser();if(e)throw e;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${Y2}`},_stockPath(n){return`${this._folderPath(n)}/${Q2}`},_appliedFolder(n){return`${this._folderPath(n)}/${J2}`},_appliedMarkerPath(n,e){const s=this._appliedFolder(n),a=String(e||"").trim();if(!a)throw new Error("baseName is required");return`${s}/${a}.json`},async listAppliedBaseNames(n=null){const e=n||await this._getCurrentUserId();if(!e)return new Set;const s=this._appliedFolder(e),{data:a,error:l}=await Ee.storage.from(li).list(s,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(l)return wp(l)?new Set:(console.error("Failed to list applied markers:",l),new Set);const c=new Set;return(a||[]).forEach(u=>{const h=String(u?.name||"");h.toLowerCase().endsWith(".json")&&c.add(h.replace(/\.json$/i,""))}),c},async loadStock(n=null){const e=n||await this._getCurrentUserId();if(!e)throw new Error("");const s=this._stockPath(e),{data:a,error:l}=await Ee.storage.from(li).createSignedUrl(s,60);if(l){if(wp(l))return{_meta:{version:1,updatedAt:null},items:[]};throw l}try{const c=await fetch(a.signedUrl,{cache:"no-store"});if(!c.ok){if(c.status===404)return{_meta:{version:1,updatedAt:null},items:[]};throw new Error(`Failed to fetch stock: ${c.status} ${c.statusText}`)}const u=await c.text(),h=JSON.parse(u||"{}"),f=Array.isArray(h?.items)?h.items:[];return{_meta:{version:1,updatedAt:h?._meta?.updatedAt||null},items:f}}catch(c){throw console.warn("loadStock fetch failed",c),c}},async saveStock(n,e=null){const s=e||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._stockPath(s),l={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(n?.items)?n.items:[]},{error:c}=await Ee.storage.from(li).upload(a,new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(c)throw c;return l},async applyDeliverySet({baseName:n,parsed:e},s=null){const a=s||await this._getCurrentUserId();if(!a)throw new Error("");const l=String(n||"").trim();if(!l)throw new Error("baseName ");if(!e)throw new Error("");const c=Z2(e),u=new Date().toISOString(),h=this._appliedMarkerPath(a,l),f={baseName:l,appliedAt:u,slipCount:(e?.slips||e?.receipts||[]).length||0,itemCount:c.length},p=await Ee.storage.from(li).upload(h,new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(p.error){if(X2(p.error))return{status:"already_applied"};throw p.error}try{const m=await this.loadStock(a),y=eA(m.items||[],c,u);return await this.saveStock({items:y},a),{status:"applied",addedCount:c.length}}catch(m){try{await Ee.storage.from(li).remove([h])}catch{}throw m}},async updateStockItem({name:n,unit:e,vendor:s,delta:a},l=null){const c=l||await this._getCurrentUserId();if(!c)throw new Error("");const u=String(n||"").trim();if(!u)throw new Error("");const h=Fo(e),f=String(s||"").trim(),p=La(u,h,f),m=Ma(a);if(m===null||!Number.isFinite(m))throw new Error("");const b=(await this.loadStock(c)).items||[],v=new Date().toISOString();let S=!1;const _=b.map(w=>{if(La(w.name,w.unit,w.vendor)===p){S=!0;const N=Math.max(0,(Ma(w.quantity)??0)+m);return{...w,quantity:N,updatedAt:v}}return w});if(!S)throw new Error("");return await this.saveStock({items:_},c),{status:"updated",name:u,unit:h}},async deleteStockItem({name:n,unit:e,vendor:s},a=null){const l=a||await this._getCurrentUserId();if(!l)throw new Error("");const c=String(n||"").trim();if(!c)throw new Error("");const u=Fo(e),h=String(s||"").trim(),f=La(c,u,h),m=(await this.loadStock(l)).items||[],y=m.filter(b=>La(b.name,b.unit,b.vendor)!==f);return y.length,m.length,await this.saveStock({items:y},l),{status:"deleted",name:c}},async clearStock(n=null){const e=n||await this._getCurrentUserId();if(!e)throw new Error("");const s=this._stockPath(e),a={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await Ee.storage.from(li).upload(s,new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const l=this._appliedFolder(e),{data:c}=await Ee.storage.from(li).list(l,{limit:1e3});if(c?.length){const u=c.map(h=>`${l}/${h.name}`);await Ee.storage.from(li).remove(u)}return{status:"cleared"}},async deleteAppliedMarker(n,e=null){const s=e||await this._getCurrentUserId();if(!s)throw new Error("");const a=this._appliedMarkerPath(s,n),{error:l}=await Ee.storage.from(li).remove([a]);if(l){if(wp(l))return{status:"not_found"};throw l}return{status:"deleted"}}},Zi="meal_plans",tA="planner_data",Vi="",Mx=20,Qi=[],nA=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,mw=n=>`planner_data_${n}`,Gi=n=>{Qi[Qi.length-1]!==n&&(Qi.push(n),Qi.length>Mx&&Qi.splice(0,Qi.length-Mx))},Ir=(n,e=null)=>{if(n==null||n==="")return e;const s=Number(n);return Number.isFinite(s)?s:e},Vp=(n,e)=>{const s=String(n?.message||"").toLowerCase();return String(n?.code||"")==="42703"?s.includes(`column "${String(e).toLowerCase()}"`):s.includes(`column "${String(e).toLowerCase()}"`)&&s.includes("does not exist")},Wi=n=>{try{if(!n)return{};const e=localStorage.getItem(mw(n));if(e)return JSON.parse(e);const s=localStorage.getItem(tA);if(s){const a=JSON.parse(s);return Cs(n,a),a}return{}}catch{return{}}},Cs=(n,e)=>{n&&localStorage.setItem(mw(n),JSON.stringify(e))},rA=()=>`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,Po=n=>{if(typeof n=="number")return n;const e=Number(n);return Number.isFinite(e)?e:n},sA=n=>({id:String(n.id),recipeId:Po(n.recipe_id??n.recipeId),type:n.meal_type??n.type??"dinner",note:n.note??"",multiplier:Ir(n.multiplier,1),totalWeight:Ir(n.total_weight??n.totalWeight,null)}),iA=n=>n?typeof n=="string"?n.slice(0,10):n instanceof Date?n.toISOString().slice(0,10):String(n).slice(0,10):"",aA=n=>{const e={};return(n||[]).forEach(s=>{const a=iA(s.plan_date??s.planDate);a&&(e[a]||(e[a]=[]),e[a].push(sA(s)))}),e},oA=(n,e)=>{const s=[];return Object.keys(e||{}).forEach(a=>{(e[a]||[]).forEach(c=>{s.push({user_id:n,plan_date:a,recipe_id:Po(c.recipeId),meal_type:c.type||"dinner",note:c.note||"",multiplier:Ir(c.multiplier,1),total_weight:Ir(c.totalWeight,null)})})}),s},lA=n=>({...n,date_str:n.plan_date,type:n.meal_type}),cA=n=>{const{date_str:e,type:s,...a}=n;return a},fm=async n=>{if(!n||n.length===0)return;const e=n.map(lA);let{error:s}=await Ee.from(Zi).insert(e);if(s&&(Vp(s,"date_str")||Vp(s,"type"))){const a=e.map(cA);({error:s}=await Ee.from(Zi).insert(a))}if(s)throw s},Lx=n=>nA.test(String(n||"")),Ql=n=>{if(n==null||n==="")return"";if(typeof n=="number")return String(n);const e=Number(n);return Number.isFinite(e)?String(e):String(n)},bd=(n,e)=>{const s=Ql(e?.recipeId),a=Ql(e?.type||"dinner"),l=Ql(e?.note||""),c=Ql(Ir(e?.multiplier,1)),u=Ql(Ir(e?.totalWeight,null));return`${n}|${s}|${a}|${l}|${c}|${u}`},uA=(n,e)=>{const s={};Object.keys(n||{}).forEach(l=>{s[l]=[...n[l]||[]]});const a=new Set;return Object.keys(n||{}).forEach(l=>{(n[l]||[]).forEach(c=>{a.add(bd(l,c))})}),Object.keys(e||{}).forEach(l=>{(e[l]||[]).forEach(u=>{const h=bd(l,u);a.has(h)||(s[l]||(s[l]=[]),s[l].push(u),a.add(h))})}),s},dA=(n,e,s)=>{const a={...n||{}};return a[e]||(a[e]=[]),a[e]=[...a[e],s],a},hA=(n,e,s)=>{const a={...n||{}};return a[e]&&(a[e]=(a[e]||[]).filter(l=>String(l.id)!==String(s)),a[e].length===0&&delete a[e]),a},fA=(n,e,s,a)=>{const l={...n||{}};return l[e]&&(l[e]=l[e].map(c=>String(c.id)!==String(s)?c:{...c,...a})),l},pA=(n,e,s)=>{const a={...n||{}};return Object.keys(a).forEach(l=>{l>=e&&l<=s&&delete a[l]}),a},mA=(n,e)=>{const s=new Set((e||[]).map(u=>String(u))),a={},l=[];let c=!1;return Object.keys(n||{}).forEach(u=>{const h=n[u]||[],f=h.filter(p=>{const m=s.has(String(p.recipeId));return m||l.push(String(p.id)),m});f.length>0&&(a[u]=f),f.length!==h.length&&(c=!0)}),{nextPlans:c?a:n,invalidIds:l,hasChanges:c}},pm=async n=>{const{data:e,error:s}=await Ee.from(Zi).select("id, plan_date, recipe_id, meal_type, note, multiplier, total_weight, created_at").eq("user_id",n).order("plan_date",{ascending:!0}).order("created_at",{ascending:!0});if(s)throw s;return aA(e||[])},gA=async(n,e)=>{const s=oA(n,e);return s.length===0?null:(await fm(s),pm(n))},yA=async(n,e)=>{const s=Wi(n);if(!Object.keys(s).some(h=>(s[h]||[]).some(f=>!Lx(f?.id))))return e;const l=new Set;Object.keys(e||{}).forEach(h=>{(e[h]||[]).forEach(f=>{l.add(bd(h,f))})});const c=[];Object.keys(s||{}).forEach(h=>{(s[h]||[]).forEach(f=>{if(Lx(f?.id))return;const p=bd(h,f);l.has(p)||(c.push({user_id:n,plan_date:h,recipe_id:Po(f.recipeId),meal_type:f.type||"dinner",note:f.note||"",multiplier:Ir(f.multiplier,1),total_weight:Ir(f.totalWeight,null)}),l.add(p))})}),c.length>0&&await fm(c);const u=await pm(n);return Cs(n,u),u},us={consumeWarnings:()=>{const n=[...Qi];return Qi.length=0,n},getAll:async n=>{if(!n)return{};try{const e=await pm(n);if(Object.keys(e).length===0){const s=Wi(n);if(Object.keys(s).length>0)try{const a=await gA(n,s);if(a)return Cs(n,a),a}catch{return Gi(Vi),Cs(n,s),s}}try{const s=await yA(n,e);return Cs(n,s),s}catch(s){console.warn("plannerService.getAll: failed to sync local fallback meals",s),Gi(Vi);const a=Wi(n),l=uA(e,a);return Cs(n,l),l}}catch(e){return console.warn("plannerService.getAll: falling back to localStorage",e),Gi(Vi),Wi(n)}},cleanupInvalidPlans:async(n,e)=>{if(!n)return{};if(!Array.isArray(e)||e.length===0)return us.getAll(n);const s=await us.getAll(n),{nextPlans:a,invalidIds:l,hasChanges:c}=mA(s,e);if(!c)return s;try{if(l.length>0)for(let h=0;h<l.length;h+=200){const f=l.slice(h,h+200),{error:p}=await Ee.from(Zi).delete().eq("user_id",n).in("id",f);if(p)throw p}}catch(u){console.warn("plannerService.cleanupInvalidPlans: delete fallback to localStorage",u),Gi(Vi)}return Cs(n,a),a},addMeal:async(n,e,s,a,l={})=>{if(!n)return null;const c={id:rA(),recipeId:Po(s),type:a||"dinner",note:"",multiplier:Ir(l?.multiplier,1),totalWeight:Ir(l?.totalWeight,null)},u=Wi(n),h=dA(u,e,c);Cs(n,h);try{const f={user_id:n,plan_date:e,recipe_id:Po(s),meal_type:a||"dinner",note:"",multiplier:Ir(l?.multiplier,1),total_weight:Ir(l?.totalWeight,null)};return await fm([f]),c}catch(f){return console.warn("plannerService.addMeal: insert fallback to localStorage",f),Gi(Vi),c}},removeMeal:async(n,e,s)=>{if(!n)return;try{const{error:c}=await Ee.from(Zi).delete().eq("id",String(s)).eq("user_id",n);if(c)throw c}catch(c){console.warn("plannerService.removeMeal: delete fallback to localStorage",c),Gi(Vi)}const a=Wi(n),l=hA(a,e,s);Cs(n,l)},updateMeal:async(n,e,s,a)=>{if(!n)return;const l={};Object.prototype.hasOwnProperty.call(a,"recipeId")&&(l.recipe_id=Po(a.recipeId)),Object.prototype.hasOwnProperty.call(a,"type")&&(l.meal_type=a.type||"dinner",l.type=l.meal_type),Object.prototype.hasOwnProperty.call(a,"note")&&(l.note=a.note||""),Object.prototype.hasOwnProperty.call(a,"multiplier")&&(l.multiplier=Ir(a.multiplier,1)),Object.prototype.hasOwnProperty.call(a,"totalWeight")&&(l.total_weight=Ir(a.totalWeight,null));try{if(Object.keys(l).length>0){let{error:h}=await Ee.from(Zi).update(l).eq("id",String(s)).eq("user_id",n);if(h&&Vp(h,"type")){const{type:f,...p}=l;({error:h}=await Ee.from(Zi).update(p).eq("id",String(s)).eq("user_id",n))}if(h)throw h}}catch(h){console.warn("plannerService.updateMeal: update fallback to localStorage",h),Gi(Vi)}const c=Wi(n),u=fA(c,e,s,a);Cs(n,u)},clearPeriod:async(n,e,s)=>{if(!n)return;try{const{error:c}=await Ee.from(Zi).delete().eq("user_id",n).gte("plan_date",e).lte("plan_date",s);if(c)throw c}catch(c){console.warn("plannerService.clearPeriod: delete fallback to localStorage",c),Gi(Vi)}const a=Wi(n),l=pA(a,e,s);Cs(n,l)}},vA=["g","kg","ml","cc","l","cl"],Ho=n=>(n??"").toString().trim(),gw=n=>{const e=Ho(n);if(!e)return"";const s=e.toLowerCase();return s===""?"g":s===""?"ml":s===""?"cc":s===""?"kg":s===""?"l":s===""?"cl":s},xA=n=>{const e=Ho(n);return e?["","","","","","","","PC","pc",""].includes(e):!1},Zl=(n,e)=>{const s=parseFloat(n)||0,a=gw(e);return a==="kg"?{qty:s*1e3,unit:"g"}:a==="g"?{qty:s,unit:"g"}:a==="l"?{qty:s*1e3,unit:"ml"}:a==="cc"?{qty:s,unit:"ml"}:a==="ml"?{qty:s,unit:"ml"}:a==="cl"?{qty:s*10,unit:"ml"}:{qty:s,unit:Ho(e)||""}},Ux=(n,e,s,a)=>{const l=Ho(s),c=parseFloat(e)||0;if(!a)return Zl(c,l);const u=parseFloat(a.packetSize),h=gw(a.packetUnit);if(!Number.isFinite(u)||u<=0||!h)return Zl(c,l);if(vA.includes(h)&&xA(l)){const p=c*u;return Zl(p,h)}return Zl(c,l)},Gp={async calculateShortages(n,e,s,a={}){if(!n?.id)throw new Error("User required");const l=a?.includeRecipeBreakdown===!0,c=await us.getAll(n.id),u=new Date(e),h=new Date(s);h.setHours(23,59,59,999);const f=[];if(Object.keys(c).forEach(F=>{const q=new Date(F);q>=u&&q<=h&&c[F].forEach(I=>{f.push(I)})}),f.length===0)return l?{items:[],recipeBreakdown:[]}:[];const[p,m,y,b,v]=await Promise.all([jn.fetchRecipes(n),On.getAllConversions(),Pn.fetchPriceList(n.id),mr.getAll(n.id),xd.getAll(n.id)]),S=new Map;p.forEach(F=>S.set(F.id,F));const _=new Map;try{for(const[F,q]of(m||new Map).entries()){const I=Jt(F);I&&(_.has(I)||_.set(I,q))}}catch{}const w=new Map;try{for(const[F,q]of(v||new Map).entries()){const I=Jt(F);I&&(w.has(I)||w.set(I,q))}}catch{}const j=new Map;try{(b||[]).forEach(F=>{const q=Jt(F?.name);q&&(j.has(q)||j.set(q,F))})}catch{}const N={},T=new Map;f.forEach(F=>{const q=S.get(F.recipeId);if(!q)return;let I=null;if(l){const D=String(q.id);T.has(D)||T.set(D,{recipeId:q.id,recipeTitle:q.title||`Recipe ${q.id}`,itemMap:new Map}),I=T.get(D)}let U=1;if(F.totalWeight&&F.totalWeight>0){let D=0;(q.ingredients||[]).forEach(H=>{const{qty:C,unit:M}=Zl(H.quantity,H.unit);(M==="g"||M==="ml")&&(D+=C)}),D>0&&(U=F.totalWeight/D)}else F.multiplier&&F.multiplier>0&&(U=F.multiplier);[...q.ingredients||[]].forEach(D=>{if(!D.name)return;const H=Ho(D.name),C=Jt(H),M=(C?_.get(C):null)||m?.get(H)||null,z=(parseFloat(D.quantity)||0)*U,B=Ux(H,z,D.unit,M),K=B.qty||0,Q=B.unit||"";if(N[H]||(N[H]={quantity:0,unit:Q,count:0}),N[H].quantity+=K,l&&I){const Z=C||H,A=I.itemMap.get(Z);A?(A.required+=K,!A.unit&&Q&&(A.unit=Q)):I.itemMap.set(Z,{ingredientKey:Z,name:H,required:K,unit:Q})}})});const R=Object.keys(N).map(F=>{const q=N[F],I=Jt(F),U=(I?_.get(I):null)||m?.get(F)||null,P=I&&y?.get(I)||null,V=I&&j.get(I)||null,D=Ux(F,V?.quantity??0,V?.unit??q.unit,U),H=q.quantity||0,C=D.qty||0,M=q.unit||D.unit||"",z=C-H,B=parseFloat(U?.packetSize),K=Ho(U?.packetUnit),Q=Number.isFinite(B)&&B>0&&!!K,Z=Q?B*.2:0,A=Q?z<Z:!1,L=P?.unit?String(P.unit).trim():"",J=I&&w.has(I)?String(w.get(I)).trim():"",ae=J||""||L||""||"",ue=(U?.lastPrice!==null&&U?.lastPrice!==void 0&&U?.lastPrice!==""?parseFloat(U.lastPrice):null)??(P?.price!==null&&P?.price!==void 0?parseFloat(P.price):null);let Ce=null,fe=0,ne=M;if(Q){const le=Math.max(0,Z-z);Ce=Math.ceil(le/B),A&&Ce<1&&(Ce=1),fe=Ce,ne=ae}else fe=Math.max(0,H-C),ne=M;const be=Q?A:fe>.01;return{name:F,required:H,stock:C,remaining:z,unit:M,shouldShow:be,toOrder:fe,orderUnit:ne,orderPacks:Ce,packSize:Q?B:null,packUnit:Q?K:null,packPrice:Number.isFinite(ue)?ue:null,vendor:P?.vendor||V?.vendor||""}}).filter(F=>F.shouldShow);if(!l)return R;const $=Array.from(T.values()).map(F=>({recipeId:F.recipeId,recipeTitle:F.recipeTitle,items:Array.from(F.itemMap.values()).filter(q=>Number(q.required||0)>1e-4)}));return{items:R,recipeBreakdown:$}}},Ku=n=>String(n||"").replace(/\.json$/i,""),bA=n=>{if(!n)return"-";const e=new Date(n);if(Number.isNaN(e.getTime()))return String(n);const s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),c=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0");return`${s}/${a}/${l} ${c}:${u}`},wA=({onBack:n})=>{const{user:e}=ms(),[s,a]=bc(),[l,c]=Ie.useState(!0),[u,h]=Ie.useState(""),[f,p]=Ie.useState([]),[m,y]=Ie.useState(new Set),[b,v]=Ie.useState({items:[]}),[S,_]=Ie.useState([]),[w,j]=Ie.useState(null),[N,T]=Ie.useState("need_order"),[R,$]=Ie.useState(!1),[F,q]=Ie.useState(null),[I,U]=Ie.useState(""),[P,V]=Ie.useState(!1),D=Ie.useCallback(async()=>{c(!0),h("");try{const re=new Date,ee=new Date(re);ee.setDate(re.getDate()+7);const[de,me,Be,Re]=await Promise.all([As.listJsonFiles(),ci.listAppliedBaseNames(),ci.loadStock(),e?.id?Gp.calculateShortages(e,re.toISOString(),ee.toISOString()):Promise.resolve([])]);p(de||[]),y(me||new Set),v(Be||{items:[]}),_(Re||[])}catch(re){console.error(re),h(re?.message||String(re))}finally{c(!1)}},[e]);Ie.useEffect(()=>{D()},[D]);const H=Ie.useMemo(()=>{const re=new Map;return(S||[]).forEach(ee=>{const de=`${ee.vendor||""}@@${ee.name}@@${ee.unit||""}`;re.set(de,{...ee,quantity:ee.stock,isShortage:!0,reason:` (: ${ee.required.toFixed(1)}${ee.unit})`})}),(b?.items||[]).forEach(ee=>{if((ee.quantity||0)<=0){const de=`${ee.vendor||""}@@${ee.name}@@${ee.unit||""}`;re.has(de)||re.set(de,{...ee,isShortage:!1})}}),Array.from(re.values()).sort((ee,de)=>ee.isShortage!==de.isShortage?ee.isShortage?-1:1:(ee.vendor||"").localeCompare(de.vendor||""))},[S,b]),C=async re=>{const ee=Ku(re);j(ee),h("");try{const de=await As.downloadJson(re);(await ci.applyDeliverySet({baseName:ee,parsed:de}))?.status==="already_applied"&&h("PDF"),await D()}catch(de){console.error(de),h(de?.message||String(de))}finally{j(null)}},M=async()=>{j("all"),h("");try{const re=await As.listJsonFiles(),ee=await ci.listAppliedBaseNames();for(const de of re||[]){const me=de?.name;if(!me)continue;const Be=Ku(me);if(ee.has(Be))continue;const Re=await As.downloadJson(me);(await ci.applyDeliverySet({baseName:Be,parsed:Re}))?.status==="applied"&&ee.add(Be)}await D()}catch(re){console.error(re),h(re?.message||String(re))}finally{j(null)}},z=re=>{q(re),U(""),$(!0),h("")},B=re=>{U(ee=>{const me=(parseFloat(ee)||0)+re;return String(Math.round(me*1e3)/1e3)})},K=async()=>{if(!F)return;const re=Number(I);if(!I||isNaN(re)||re<=0){h("");return}V(!0),h("");try{await ci.updateStockItem({name:F.name,unit:F.unit,vendor:F.vendor,delta:-re}),await D(),$(!1),q(null)}catch(ee){console.error(ee),h(ee?.message||String(ee))}finally{V(!1)}},[Q,Z]=Ie.useState(!1),[A,L]=Ie.useState(null),[J,ae]=Ie.useState(!1),[ue,Ce]=Ie.useState(!1),[fe,ne]=Ie.useState(!1),be=re=>{L(re),Z(!0),h("")},le=async()=>{if(A){ae(!0),h("");try{await ci.deleteStockItem({name:A.name,unit:A.unit,vendor:A.vendor}),await D(),Z(!1),L(null)}catch(re){console.error(re),h(": "+(re.message||String(re)))}finally{ae(!1)}}},[ie,Te]=Ie.useState(!1),[Le,E]=Ie.useState(null),[ve,ge]=Ie.useState(!1),Y=re=>{const ee=Ku(re.name);E({name:re.name,baseName:ee}),Te(!0),h("")},W=async()=>{if(Le){ge(!0),h("");try{await As.deleteDeliverySet(Le.baseName),await ci.deleteAppliedMarker(Le.baseName),await D(),Te(!1),E(null)}catch(re){console.error(re),h("PDF: "+(re.message||String(re)))}finally{ge(!1)}}},oe=async()=>{ne(!0),h("");try{await ci.clearStock(),await D(),Ce(!1)}catch(re){console.error(re),h(": "+(re.message||String(re)))}finally{ne(!1)}};return r.jsxs("div",{className:"incoming-stock",children:[r.jsxs("div",{className:"incoming-stock__header",children:[r.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsx(he,{variant:"secondary",onClick:()=>a({view:"incoming-deliveries"}),children:" PDF"}),r.jsx(he,{variant:"ghost",onClick:n,children:" "})]})]}),u&&r.jsx(mn,{className:"incoming-stock__error",children:u}),r.jsxs(mn,{className:"incoming-stock__card",children:[r.jsxs("div",{className:"incoming-stock__card-head",children:[r.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[r.jsx(he,{variant:"secondary",onClick:D,disabled:l||!!w,children:""}),r.jsx(he,{variant:"primary",onClick:M,disabled:l||!!w,children:w==="all"?"":""}),r.jsx(he,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:()=>Ce(!0),disabled:l||!!w||!b?.items?.length,children:" "})]})]}),l?r.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):f.length===0?r.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):r.jsx("div",{className:"incoming-stock__file-list",children:f.map(re=>{const ee=Ku(re?.name),de=m.has(ee);return r.jsxs("div",{className:"incoming-stock__file-row",children:[r.jsxs("div",{className:"incoming-stock__file-info",children:[r.jsx("div",{style:{fontWeight:700},children:ee}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",bA(re.updated_at||re.created_at)]})]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[de?r.jsx("span",{className:"incoming-stock__badge",children:""}):r.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),r.jsx(he,{variant:de?"secondary":"primary",size:"sm",onClick:()=>C(re.name),disabled:!!w||de,children:w===ee?"":de?"":""}),r.jsx(he,{variant:"ghost",size:"sm",style:{color:"#d32f2f",marginLeft:"4px"},onClick:()=>Y(re),disabled:!!w,title:"PDF",children:""})]})]},re.name)})}),!l&&r.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",r.jsx("strong",{children:m.size}),"  / PDF: ",r.jsx("strong",{children:f.length})," "]})]}),r.jsxs(mn,{className:"incoming-stock__card",children:[r.jsx("div",{className:"incoming-stock__card-head",children:r.jsx("h3",{className:"incoming-stock__section-title",children:""})}),r.jsxs("div",{className:"incoming-stock__tabs",children:[r.jsxs("button",{className:`incoming-stock__tab-button ${N==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>T("need_order"),children:[" ",r.jsx("span",{className:"incoming-stock__tab-count",children:H.length})]}),Array.from(new Set((b?.items||[]).map(re=>re.vendor||""))).sort().map(re=>r.jsx("button",{className:`incoming-stock__tab-button ${N===re?"incoming-stock__tab-button--active":""}`,onClick:()=>T(re),children:re},re))]}),(()=>{let re=[];if(N==="need_order")re=H;else{const ee=N===""?"":N;re=(b?.items||[]).filter(de=>(de.vendor||"")===ee)}return re.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:N==="need_order"?"0":""}):r.jsx("div",{className:"incoming-stock__table-wrap",children:r.jsxs("table",{className:"incoming-stock__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"45%"},children:"/"}),r.jsx("th",{style:{width:"25%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"10%"},children:""}),r.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),r.jsx("tbody",{children:re.map(ee=>r.jsxs("tr",{style:ee.isShortage?{backgroundColor:"#fff5f5"}:{},children:[r.jsxs("td",{children:[r.jsxs("div",{style:{fontWeight:500},children:[ee.name,ee.isShortage&&r.jsx("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#d32f2f",border:"1px solid #d32f2f",borderRadius:"4px",padding:"1px 4px",verticalAlign:"middle"},children:""})]}),ee.reason&&r.jsxs("div",{style:{fontSize:"0.8rem",color:"#d32f2f",marginTop:"2px"},children:[ee.reason,"  : ",ee.toOrder,ee.orderUnit]}),!ee.reason&&N==="need_order"&&ee.vendor&&r.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:ee.vendor})]}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(ee.quantity||0)<=0||ee.isShortage?"#d32f2f":"inherit"},children:Number.isFinite(ee.quantity)?ee.quantity:"-"}),r.jsx("td",{children:ee.unit||"-"}),r.jsx("td",{style:{textAlign:"center"},children:r.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[r.jsx(he,{variant:"secondary",size:"sm",onClick:()=>z(ee),children:"/"}),r.jsx(he,{variant:"ghost",size:"sm",style:{color:"#d32f2f"},onClick:()=>be(ee),children:""})]})})]},`${ee.vendor}@@${ee.name}@@${ee.unit||""}`))})]})})})()]}),r.jsx(rn,{isOpen:R,onClose:()=>$(!1),title:"",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsx("div",{style:{fontWeight:"bold"},children:F?.name})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsxs("div",{children:[F?.quantity," ",F?.unit]})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx(Mt,{type:"text",inputMode:"decimal",value:I,onChange:re=>U(re.target.value),readOnly:!0,placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px",textAlign:"center",backgroundColor:"#f9f9f9",cursor:"default"}}),r.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:F?.unit})]}),r.jsxs("div",{className:"incoming-stock__calc-grid",children:[r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(.001),children:"+0.001"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(.01),children:"+0.01"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(.1),children:"+0.1"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(.5),children:"+0.5"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>B(1),children:"+1"}),r.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>U(""),children:""})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>$(!1),disabled:P,children:""}),r.jsx(he,{variant:"primary",onClick:K,disabled:P||!I,children:P?"":""})]})]})}),r.jsx(rn,{isOpen:Q,onClose:()=>Z(!1),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",A?.name,"",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.85rem",color:"#666"},children:""})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>Z(!1),disabled:J,children:""}),r.jsx(he,{variant:"danger",onClick:le,disabled:J,children:J?"":""})]})]})}),r.jsx(rn,{isOpen:ie,onClose:()=>Te(!1),title:"PDF",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",Le?.baseName,""]}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>Te(!1),disabled:ve,children:""}),r.jsx(he,{variant:"danger",onClick:W,disabled:ve,children:ve?"":""})]})]})}),r.jsx(rn,{isOpen:ue,onClose:()=>Ce(!1),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsx("p",{style:{marginTop:0,fontWeight:"bold",color:"#d32f2f"},children:""}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["PDF",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>Ce(!1),disabled:fe,children:""}),r.jsx(he,{variant:"danger",onClick:oe,disabled:fe,children:fe?"":""})]})]})}),r.jsx(rn,{isOpen:!!w,onClose:()=>{},title:"",size:"small",showCloseButton:!1,children:r.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[r.jsx("div",{className:"incoming-stock__spinner"}),r.jsx("p",{style:{margin:"0 0 8px",fontWeight:"bold"},children:"PDF..."}),r.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",margin:0},children:[w==="all"?"":"",r.jsx("br",{}),""]})]})})]})},yw=n=>{const{totalWeight:e,multiplier:s}=n||{};return e?`${e}g`:s&&s!==1?`x${s}`:""},_A=({recipe:n})=>{const{attributes:e,listeners:s,setNodeRef:a,transform:l,isDragging:c}=om({id:`recipe-${n.id}`,data:{recipe:n}}),u=c?{opacity:.35}:l?{transform:`translate3d(${l.x}px, ${l.y}px, 0)`,position:"relative",zIndex:999}:void 0;return r.jsx("div",{ref:a,style:u,...s,...e,className:"draggable-recipe",children:n.title})},SA=({meal:n,dateStr:e,children:s})=>{const{attributes:a,listeners:l,setNodeRef:c,transform:u,isDragging:h}=om({id:`meal-${n.id}`,data:{meal:n,dateStr:e,type:"meal"}}),f=h?{opacity:.35}:u?{transform:`translate3d(${u.x}px, ${u.y}px, 0)`,position:"relative",zIndex:999}:void 0,p=yw(n);return r.jsxs("div",{ref:c,style:f,...l,...a,className:"draggable-meal-wrapper",children:[s,p&&r.jsx("div",{style:{position:"absolute",bottom:"2px",right:"4px",fontSize:"0.75rem",fontWeight:"bold",color:"#666",backgroundColor:"rgba(255,255,255,0.8)",padding:"0 2px",borderRadius:"2px",pointerEvents:"none"},children:p})]})},jA=({dateStr:n,dayNum:e,isToday:s,isOutside:a,children:l})=>{const{setNodeRef:c,isOver:u}=Cc({id:`date-${n}`,data:{dateStr:n}});return r.jsxs("div",{ref:c,className:`calendar-cell ${s?"today":""} ${a?"outside-month":""}`,style:{backgroundColor:u?"#ffe0b2":void 0},children:[r.jsx("div",{className:"day-number",children:e}),l]})},Eo=n=>`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,CA=({onBack:n,onSelectRecipe:e,onNavigateToOrderList:s})=>{const{user:a}=ms(),l=Ps(),c=k.useRef(l),[u,h]=k.useState([]),[f,p]=k.useState({}),[m,y]=k.useState(new Date),[b,v]=k.useState(""),[S,_]=k.useState(!1),[w,j]=k.useState(null),[N,T]=k.useState(!1),[R,$]=k.useState(null),[F,q]=k.useState(1),[I,U]=k.useState(""),[P,V]=k.useState(null),[D,H]=k.useState(!1),[C,M]=k.useState(Eo(new Date)),[z,B]=k.useState(Eo(new Date)),K=Ia(Ar(Qo,{activationConstraint:{distance:6}}),Ar(Jo,{activationConstraint:{delay:70,tolerance:8}}));k.useEffect(()=>{c.current=l},[l]);const Q=k.useCallback(()=>{const E=us.consumeWarnings?.()||[];E.length!==0&&[...new Set(E)].forEach(ve=>{c.current.warning(ve)})},[]),Z=k.useCallback(async()=>{if(!a){h([]),p({});return}let E=[];try{E=await jn.fetchRecipes(a)}catch(ve){console.error("Planner: failed to fetch recipes",ve),c.current.error(""),E=[]}if(h(E),a?.id)try{let ve;if(Array.isArray(E)&&E.length>0){const ge=E.map(Y=>Y.id);ve=await us.cleanupInvalidPlans(a.id,ge)}else ve=await us.getAll(a.id);p(ve)}finally{Q()}},[Q,a]);k.useEffect(()=>{const E=setTimeout(()=>{Z()},0);return()=>clearTimeout(E)},[Z]);const A=k.useCallback(E=>{const ve=E?.active;if(!ve?.id){V(null);return}const ge=String(ve.id);if(ge.startsWith("recipe-")){const Y=ve.data.current?.recipe;V({kind:"recipe",title:Y?.title||"",qtyStr:""});return}if(ge.startsWith("meal-")){const Y=ve.data.current?.meal,W=u.find(oe=>oe.id===Y?.recipeId);V({kind:"meal",title:W?.title||"Unknown",qtyStr:yw(Y)});return}V(null)},[u]),L=k.useCallback(()=>{V(null)},[]),J=async E=>{const{active:ve,over:ge}=E;try{if(!ge)return;if(ge.id.startsWith("date-")){const Y=ge.data.current.dateStr;if(ve.id.startsWith("recipe-")){const W=ve.data.current.recipe;$({type:"new",recipe:W,targetDateStr:Y}),q(1),U(""),T(!0)}else if(ve.id.startsWith("meal-")){const{meal:W,dateStr:oe}=ve.data.current;if(oe===Y)return;const re={multiplier:W.multiplier,totalWeight:W.totalWeight};await us.addMeal(a.id,Y,W.recipeId,W.type||"dinner",re),await us.removeMeal(a.id,oe,W.id),Z()}}}finally{V(null)}},ae=async()=>{if(!R)return;const{type:E,recipe:ve,targetDateStr:ge}=R;if(E==="new"){const Y={};if(ve.type==="bread"){const W=parseFloat(I);Y.totalWeight=Number.isFinite(W)?W:null,Y.multiplier=1}else{const W=parseFloat(F);Y.multiplier=Number.isFinite(W)?W:1,Y.totalWeight=null}await us.addMeal(a.id,ge,ve.id,"dinner",Y)}T(!1),$(null),Z()},ue=()=>{T(!1),$(null)},Ce=async(E,ve,ge)=>{ge&&ge.stopPropagation(),j({dateStr:E,mealId:ve}),_(!0)},fe=async()=>{if(!w)return;const{dateStr:E,mealId:ve}=w;_(!1),j(null);try{await us.removeMeal(a.id,E,ve),await Z(),l.success("")}catch(ge){l.error(""),console.error("Delete meal error:",ge)}},ne=()=>{_(!1),j(null)},be=()=>{M(Eo(new Date)),B(Eo(new Date)),H(!0)},le=async()=>{if(a?.id)try{await us.clearPeriod(a.id,C,z),await Z(),H(!1),l.success(`${C}${z}`)}catch(E){console.error(E),l.error("")}},ie=()=>{const E=m.getFullYear(),ve=m.getMonth(),ge=new Date(E,ve,1),Y=new Date(E,ve+1,0),W=[],oe=ge.getDay();for(let ee=oe-1;ee>=0;ee--){const de=new Date(E,ve,-ee);W.push({date:de,isOutside:!0})}for(let ee=1;ee<=Y.getDate();ee++){const de=new Date(E,ve,ee);W.push({date:de,isOutside:!1})}const re=42-W.length;for(let ee=1;ee<=re;ee++){const de=new Date(E,ve+1,ee);W.push({date:de,isOutside:!0})}return W},Te=u.filter(E=>E.title.toLowerCase().includes(b.toLowerCase())),Le=E=>{y(new Date(m.getFullYear(),m.getMonth()+E,1))};return r.jsxs("div",{className:`planner-container fade-in ${P?"dragging":""}`,children:[S&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(mn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("strong",{children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(he,{variant:"ghost",onClick:ne,children:""}),r.jsx(he,{variant:"danger",onClick:fe,children:""})]})]})}),D&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(mn,{style:{width:"90%",maxWidth:"500px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("strong",{children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1.5rem"},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),r.jsx(Mt,{type:"date",value:C,onChange:E=>M(E.target.value)})]}),r.jsx("span",{style:{paddingTop:"24px"},children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),r.jsx(Mt,{type:"date",value:z,onChange:E=>B(E.target.value)})]})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[r.jsx(he,{variant:"ghost",onClick:()=>H(!1),children:""}),r.jsx(he,{variant:"danger",onClick:le,children:""})]})]})}),N&&R&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(mn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",backgroundColor:"white"},children:[r.jsx("h3",{style:{marginTop:0},children:R.recipe.type==="bread"?"":""}),r.jsx("p",{style:{margin:"1rem 0",color:"#666"},children:R.recipe.title}),r.jsx("div",{style:{marginBottom:"1.5rem"},children:R.recipe.type==="bread"?r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:" (g)"}),r.jsx(Mt,{type:"number",value:I,onChange:E=>U(E.target.value),placeholder:": 1200",autoFocus:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:" "})]}):r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:""}),r.jsx(Mt,{type:"number",step:"0.1",value:F,onChange:E=>q(E.target.value),placeholder:": 1, 1.5, 2",autoFocus:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:"  (1 = )"})]})}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[r.jsx(he,{variant:"ghost",onClick:ue,children:""}),r.jsx(he,{variant:"primary",onClick:ae,children:""})]})]})}),r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions",children:[r.jsx(he,{variant:"secondary",onClick:s,style:{marginRight:"8px"},children:" "}),r.jsx(he,{variant:"danger",onClick:be,style:{marginRight:"8px"},children:" "}),r.jsx(he,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsxs(ea,{sensors:K,onDragStart:A,onDragCancel:L,onDragEnd:J,autoScroll:!0,children:[r.jsxs("div",{className:"planner-layout",children:[r.jsxs("div",{className:"recipe-sidebar",children:[r.jsx("div",{className:"sidebar-search",children:r.jsx(Mt,{placeholder:"...",value:b,onChange:E=>v(E.target.value)})}),r.jsx("div",{className:"draggable-list",children:Te.map(E=>r.jsx(_A,{recipe:E},E.id))})]}),r.jsxs("div",{className:"planner-calendar",children:[r.jsxs("div",{className:"calendar-header",children:[r.jsx(he,{variant:"ghost",onClick:()=>Le(-1),children:" "}),r.jsxs("h3",{style:{margin:0},children:[m.getFullYear()," ",m.getMonth()+1,""]}),r.jsx(he,{variant:"ghost",onClick:()=>Le(1),children:" "})]}),r.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(E=>r.jsx("div",{className:"calendar-day-header",children:E},E)),ie().map((E,ve)=>{const ge=Eo(E.date),Y=f[ge]||[],W=ge===Eo(new Date);return r.jsx(jA,{dateStr:ge,dayNum:E.date.getDate(),isToday:W,isOutside:E.isOutside,children:Y.map(oe=>{const re=u.find(ee=>ee.id===oe.recipeId);return r.jsx(SA,{meal:oe,dateStr:ge,children:r.jsxs("div",{className:"planned-meal",title:re?.title,onClick:()=>re&&e&&e(re),children:[r.jsx("span",{children:re?.title||"Unknown"}),r.jsx("span",{className:"delete-meal-btn",onPointerDown:ee=>{ee.stopPropagation()},onClick:ee=>Ce(ge,oe.id,ee),children:""})]})},oe.id)})},ve)})]})]})]}),r.jsx(cm,{children:P?r.jsxs("div",{className:`drag-overlay-card ${P.kind==="meal"?"meal":""}`,children:[r.jsx("span",{className:"drag-overlay-title",children:P.title}),P.qtyStr&&r.jsx("span",{className:"drag-overlay-qty",children:P.qtyStr})]}):null})]})]})},kA=({onBack:n,onNavigateToPlanner:e})=>{const{user:s}=ms(),a=Ps(),[l,c]=k.useState(new Date().toISOString().slice(0,10)),[u,h]=k.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[f,p]=k.useState([]),[m,y]=k.useState([]),[b,v]=k.useState(!1),[S,_]=k.useState(!1),[w,j]=k.useState(!1),[N,T]=k.useState(!1);Ie.useEffect(()=>{window.plannerService=us,window.shortageService=Gp,window.recipeService=jn},[]);const R=Ie.useMemo(()=>{const V=new Set;return(f||[]).forEach(D=>{const H=Jt(D?.name);V.add(H||D?.name||"")}),V},[f]),$=Ie.useMemo(()=>{const V=new Map;return(f||[]).forEach(D=>{const H=Jt(D?.name)||D?.name||"";H&&(V.has(H)||V.set(H,D))}),V},[f]),F=async()=>{v(!0);try{if(!s?.id){a.error(""),v(!1);return}const V=await Gp.calculateShortages(s,l,u,{includeRecipeBreakdown:!0}),D=Array.isArray(V)?V:V?.items||[],H=Array.isArray(V)?[]:V?.recipeBreakdown||[];D.length,p(D),y(H),_(!0)}catch(V){console.error(V),a.error(": "+(V.message||String(V)))}finally{v(!1)}},q=()=>{j(!0)},I=()=>{T(!0)},U=()=>f.map(V=>{if(Number.isFinite(V.orderPacks)&&V.orderPacks!==null){const D=V.packSize&&V.packUnit?`1${V.orderUnit}=${V.packSize}${V.packUnit}`:"";return`${V.name}: ${V.orderPacks}${V.orderUnit}${D}`}return`${V.name}: ${Number(V.toOrder||0).toFixed(1)}${V.unit}`}).join(`
`),P=async()=>{const V=document.getElementById("copy-textarea");if(V){V.select();try{await navigator.clipboard.writeText(V.value),a.success("")}catch{document.execCommand("copy"),a.success("")}}};return r.jsxs("div",{className:"order-list-container fade-in",children:[r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions",children:[r.jsx(he,{variant:"secondary",onClick:e,style:{marginRight:"8px"},children:" "}),r.jsx(he,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsx("div",{className:"filter-card",children:r.jsxs("div",{className:"date-range-inputs",children:[r.jsxs("div",{children:[r.jsx("label",{children:""}),r.jsx("input",{type:"date",value:l,onChange:V=>c(V.target.value)})]}),r.jsx("span",{children:""}),r.jsxs("div",{children:[r.jsx("label",{children:""}),r.jsx("input",{type:"date",value:u,onChange:V=>h(V.target.value)})]}),r.jsx(he,{variant:"primary",onClick:F,disabled:b,children:b?"...":""})]})}),S&&r.jsxs("div",{className:"order-results",children:[r.jsxs("div",{className:"results-header",children:[r.jsxs("h3",{children:[" (",f.length,")"]}),r.jsxs("div",{className:"result-actions",children:[r.jsx(he,{variant:"secondary",onClick:q,children:" "}),r.jsx(he,{variant:"secondary",onClick:I,children:" "})]})]}),r.jsxs("table",{className:"order-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""})]})}),r.jsx("tbody",{children:f.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):f.map((V,D)=>r.jsxs("tr",{children:[r.jsx("td",{children:V.name}),r.jsxs("td",{style:{textAlign:"right"},children:[V.required.toFixed(1)," ",V.unit]}),r.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,V.remaining??0).toFixed(1)," ",V.unit]}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(V.orderPacks)&&V.orderPacks!==null?r.jsxs(r.Fragment,{children:[V.orderPacks,V.orderUnit,V.packSize&&V.packUnit&&r.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",V.orderUnit," = ",Number(V.packSize).toLocaleString(),V.packUnit,V.packPrice?` / ${Math.round(V.packPrice).toLocaleString()}`:""]})]}):r.jsxs(r.Fragment,{children:[V.toOrder.toFixed(1)," ",r.jsx("span",{style:{fontSize:"0.8em"},children:V.unit})]})})]},D))})]})]}),r.jsx(rn,{isOpen:w,onClose:()=>j(!1),title:" ",size:"medium",children:r.jsxs("div",{className:"copy-modal-content",children:[r.jsx("p",{className:"copy-instructions",children:""}),r.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:U(),onClick:V=>V.target.select()}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(he,{variant:"primary",onClick:P,children:" "}),r.jsx(he,{variant:"ghost",onClick:()=>j(!1),children:""})]})]})}),r.jsx(rn,{isOpen:N,onClose:()=>T(!1),title:" ",size:"large",children:r.jsxs("div",{className:"print-preview-content",children:[r.jsxs("div",{className:"print-preview-header",children:[r.jsx("h3",{children:""}),r.jsxs("p",{className:"print-period",children:[": ",l,"  ",u]})]}),m.length>0&&r.jsxs("div",{className:"recipe-breakdown-print",children:[r.jsx("h4",{children:" "}),m.map((V,D)=>{const H=(V.items||[]).filter(C=>{const M=C.ingredientKey||Jt(C.name)||C.name;return R.has(M)});return H.length===0?null:r.jsxs("section",{className:"recipe-breakdown-section",children:[r.jsx("div",{className:"recipe-breakdown-section-title",children:V.recipeTitle}),r.jsxs("table",{className:"recipe-breakdown-table",children:[r.jsxs("colgroup",{children:[r.jsx("col",{className:"rb-col-name"}),r.jsx("col",{className:"rb-col-required"}),r.jsx("col",{className:"rb-col-stock"}),r.jsx("col",{className:"rb-col-spec"})]}),r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""})]})}),r.jsx("tbody",{children:H.map((C,M)=>{const z=C.ingredientKey||Jt(C.name)||C.name,B=$.get(z),K=B?.unit||C.unit||"",Q=Math.max(0,Number(B?.remaining??0)),Z=(B?.vendor||"").trim(),A=B?.packSize&&B?.packUnit?`1${B.orderUnit||""} = ${Number(B.packSize).toLocaleString()}${B.packUnit}${B.packPrice?` / ${Math.round(B.packPrice).toLocaleString()}`:""}`:"-";return r.jsxs("tr",{children:[r.jsxs("td",{children:[C.name,Z&&r.jsxs("span",{className:"recipe-material-vendor",children:["",Z]})]}),r.jsxs("td",{style:{textAlign:"right"},children:[Number(C.required||0).toFixed(1)," ",C.unit||""]}),r.jsxs("td",{style:{textAlign:"right"},children:[Q.toFixed(1)," ",K]}),r.jsx("td",{style:{textAlign:"right",color:"#666",fontWeight:"normal"},children:A})]},`${C.ingredientKey||C.name||M}-${M}`)})})]})]},`${V.recipeId||V.recipeTitle||D}`)})]}),m.length===0&&r.jsx("p",{style:{margin:0,fontSize:"0.95rem",color:"#374151"},children:""}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(he,{variant:"primary",onClick:()=>window.print(),children:" "}),r.jsx(he,{variant:"ghost",onClick:()=>T(!1),children:""})]})]})})]})};function NA(){const[n,e]=k.useState([]),[s,a]=k.useState({}),[l,c]=k.useState(!0),[u,h]=k.useState("all"),[f,p]=k.useState({status:"all",dateFrom:"",dateTo:""}),[m,y]=k.useState({totalCalls:0,successRate:0,totalCost:0,totalAudioSec:0,byApi:{}}),b=[{id:"all",label:""},{id:"voice",label:""},{id:"vision",label:""}];k.useEffect(()=>{S()},[f]);const v=k.useMemo(()=>n.filter(R=>{if(u==="all")return!0;if(u==="voice"){const $=R.model_name&&R.model_name.toLowerCase().includes("whisper"),F=R.endpoint&&R.endpoint.toLowerCase().includes("voice"),q=R.metadata&&R.metadata.audio_duration_sec!==void 0;return $||F||q}return u==="vision"?R.endpoint&&R.endpoint.toLowerCase().includes("analyze-image"):!0}),[n,u]);k.useEffect(()=>{w(v)},[v]);async function S(){c(!0);try{let R=Ee.from("api_usage_logs").select("*").order("created_at",{ascending:!1}).limit(500);f.status!=="all"&&(R=R.eq("status",f.status)),f.dateFrom&&(R=R.gte("created_at",f.dateFrom)),f.dateTo&&(R=R.lte("created_at",f.dateTo+"T23:59:59"));const{data:$,error:F}=await R;if(F)throw F;e($||[]),_()}catch(R){console.error(":",R),alert("")}finally{c(!1)}}async function _(){try{const R=await hs.fetchAllProfiles(),$={};Array.isArray(R)&&R.forEach(F=>{F.id&&($[F.id]=F)}),a($)}catch(R){console.error("Failed to fetch user profiles for logs",R)}}function w(R){const $=R.length,F=R.filter(U=>U.status==="success").length,q=R.reduce((U,P)=>U+(P.estimated_cost_jpy||0),0),I=R.filter(U=>U.metadata?.audio_duration_sec).reduce((U,P)=>U+(Number(P.metadata.audio_duration_sec)||0),0);y({totalCalls:$,successRate:$>0?(F/$*100).toFixed(1):0,totalCost:q.toFixed(2),totalAudioSec:I.toFixed(1),byApi:{}})}function j(R){return new Date(R).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function N(R){return{success:" ",error:" ",rate_limited:" "}[R]||R}async function T(){const R=[["","API","","","ID","","(ms)","/","()",""].join(",")];v.forEach(U=>{let P="";U.metadata?.audio_duration_sec?P=`${U.metadata.audio_duration_sec}s`:(U.input_tokens||U.output_tokens)&&(P=`${U.input_tokens} ${U.output_tokens}`),R.push([j(U.created_at),U.api_name,U.endpoint,U.model_name||"",U.user_id||"",U.status,U.duration_ms||"",P,U.estimated_cost_jpy||"",(U.error_message||"").replace(/,/g,"")].join(","))});const $=R.join(`
`),F=new Blob(["\uFEFF"+$],{type:"text/csv;charset=utf-8;"}),q=URL.createObjectURL(F),I=document.createElement("a");I.href=q,I.download=`api_usage_logs_${u}_${new Date().toISOString().split("T")[0]}.csv`,I.click()}return r.jsxs("div",{className:"api-usage-logs",children:[r.jsxs("div",{className:"logs-header",children:[r.jsx("h1",{children:" API"}),r.jsx("button",{onClick:T,className:"export-btn",children:" CSV"})]}),r.jsx("div",{className:"logs-tabs",children:b.map(R=>r.jsx("button",{className:`log-tab ${u===R.id?"active":""}`,onClick:()=>h(R.id),children:R.label},R.id))}),r.jsx("div",{className:"stats-grid",children:u==="voice"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.totalAudioSec,""]}),r.jsxs("div",{className:"secondary-stat",children:[(m.totalAudioSec/60).toFixed(1),""]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(m.totalCost).toLocaleString()]}),r.jsx("div",{className:"secondary-stat",children:"Whisper large-v3 turbo"})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.successRate,"%"]}),r.jsxs("div",{className:"secondary-stat",children:[m.totalCalls,""]})]})]}):u==="vision"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.totalCalls,""]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(m.totalCost).toLocaleString()]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.successRate,"%"]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsx("div",{className:"stat-value",children:m.totalCalls.toLocaleString()})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[m.successRate,"%"]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(m.totalCost).toLocaleString()]})]})]})}),r.jsxs("div",{className:"filters",children:[r.jsxs("select",{value:f.status,onChange:R=>p({...f,status:R.target.value}),children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"success",children:""}),r.jsx("option",{value:"error",children:""}),r.jsx("option",{value:"rate_limited",children:""})]}),r.jsx("input",{type:"date",value:f.dateFrom,onChange:R=>p({...f,dateFrom:R.target.value}),placeholder:""}),r.jsx("input",{type:"date",value:f.dateTo,onChange:R=>p({...f,dateTo:R.target.value}),placeholder:""}),r.jsx("button",{onClick:S,className:"refresh-btn",children:" "})]}),l?r.jsx("div",{className:"loading",children:"..."}):r.jsxs("div",{className:"logs-table-container",children:[r.jsxs("table",{className:"logs-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"API"}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:" (/)"}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:v.map(R=>r.jsxs("tr",{className:`status-${R.status}`,children:[r.jsx("td",{children:j(R.created_at)}),r.jsx("td",{children:r.jsx("span",{className:`api-badge api-${R.api_name}`,children:R.api_name})}),r.jsx("td",{children:R.endpoint}),r.jsx("td",{children:r.jsx("code",{children:R.model_name||"-"})}),r.jsx("td",{children:R.user_email||s[R.user_id]?.email||s[R.user_id]?.display_id||(R.user_id?R.user_id.substring(0,8):"-")}),r.jsx("td",{children:N(R.status)}),r.jsx("td",{children:R.duration_ms?`${R.duration_ms}ms`:"-"}),r.jsx("td",{children:R.metadata&&R.metadata.audio_duration_sec?r.jsxs("span",{className:"audio-sec",children:[" ",Number(R.metadata.audio_duration_sec).toFixed(2),"s"]}):R.input_tokens||R.output_tokens?r.jsxs("span",{className:"tokens",children:[R.input_tokens?`${R.input_tokens}`:"",R.output_tokens?` ${R.output_tokens}`:""]}):"-"}),r.jsx("td",{children:R.estimated_cost_jpy!=null&&R.estimated_cost_jpy!==""?r.jsxs("span",{className:"cost",children:["",Number(R.estimated_cost_jpy)]}):"-"}),r.jsx("td",{className:"error-cell",children:R.error_message?r.jsxs("span",{className:"error-msg",title:R.error_message,children:[R.error_message.substring(0,50),"..."]}):"-"})]},R.id))})]}),v.length===0&&r.jsx("div",{className:"no-logs",children:""})]})]})}const Ao=async(n,e,s)=>{let a=null;try{const l=new Promise((c,u)=>{a=setTimeout(()=>u(new Error(`${s||"operation"} timed out after ${e}ms`)),e)});return await Promise.race([n,l])}finally{a&&clearTimeout(a)}},_p=n=>{if(!n)return"";const e=n.indexOf("@");return e>0?n.slice(0,e):n},EA=({children:n})=>{const[e,s]=k.useState(null),[a,l]=k.useState(!0),[c,u]=k.useState(!1),h=k.useCallback(async w=>{if(!w){s(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const j=w.id,N=w.email||"";let T=null;try{const M=localStorage.getItem("auth_user_cache");if(M){const z=JSON.parse(M);z&&z.id===j&&(T=z,s(z))}}catch(M){console.warn("[Auth] Failed to load cache",M)}let R=null;const $=4e3,F=2,q=async()=>{let M=0;for(;M<F;)try{const[z,B]=await Promise.all([Ao(Ee.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",j).single().then(Z=>({data:Z,error:null})).catch(Z=>({data:null,error:Z})),$,"profiles.select(with_email)").catch(Z=>({data:null,error:Z})),Ao(Ee.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",j).single().then(Z=>({data:Z,error:null})).catch(Z=>({data:null,error:Z})),$,"profiles.select").catch(Z=>({data:null,error:Z}))]);let K=null,Q=null;if(z?.data?.data?K=z.data.data:B?.data?.data?K=B.data.data:Q=z?.error??B?.error??new Error("Profile fetch failed"),Q)if(Q.code==="PGRST116"){const Z=w.user_metadata?.display_id?String(w.user_metadata.display_id):_p(N)||j.slice(0,8);let A=null,L=null;const J=await Ao(Ee.from("profiles").insert([{id:j,display_id:Z,email:N||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),6e3,"profiles.insert(with_email)");if(A=J?.data??null,L=J?.error??null,L&&String(L.message||"").toLowerCase().includes("email")){const ae=await Ao(Ee.from("profiles").insert([{id:j,display_id:Z,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),6e3,"profiles.insert");A=ae?.data??null,L=ae?.error??null}if(L)throw L;R=A}else throw Q;else R=K;if(R&&Object.prototype.hasOwnProperty.call(R,"email")&&N&&!R.email)try{await Ee.from("profiles").update({email:N}).eq("id",j)}catch(Z){console.warn("Failed to backfill profile email",Z)}break}catch(z){console.error(`Failed to load/create profile (Attempt ${M+1}/${F}):`,z),M++,M<F&&await new Promise(B=>setTimeout(B,300*M))}return R};if(T){q().then(M=>{if(M){const z=(w?.user_metadata?.display_id||"").toString().trim(),B=M.display_id||z||T.displayId||_p(N)||j.slice(0,8),K=String(M.role||"user").trim().toLowerCase(),Z=N==="pingus0428@gmail.com"?!0:M.show_master_recipes===!0;s({id:j,email:N,displayId:B,role:K,showMasterRecipes:Z});try{localStorage.setItem("auth_user_cache",JSON.stringify({id:j,email:N,displayId:B,role:K,showMasterRecipes:Z}))}catch(A){console.warn("[Auth] Failed to save cache",A)}}}).catch(()=>{});return}R=await q();const I=(w?.user_metadata?.display_id||"").toString().trim(),U=R?.display_id||I||""||T?.displayId||""||_p(N)||j.slice(0,8),P=R?.role||w?.app_metadata?.role||T?.role||"user",V=String(P).trim().toLowerCase(),H=N==="pingus0428@gmail.com"?!0:R?.show_master_recipes===!0||R?.show_master_recipes==null&&T?.showMasterRecipes===!0,C={id:j,email:N,displayId:U,role:V,showMasterRecipes:H};s(C);try{localStorage.setItem("auth_user_cache",JSON.stringify(C))}catch(M){console.warn("[Auth] Failed to save cache",M)}},[]);k.useEffect(()=>{let w=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&u(!0);const{data:j}=Ee.auth.onAuthStateChange(async(T,R)=>{T==="PASSWORD_RECOVERY"&&u(!0);try{await h(R?.user||null)}catch($){console.error("Auth state change handler failed:",$)}});return w=j?.subscription,(async()=>{try{const{data:T}=await Ao(Ee.auth.getSession(),5e3,"auth.getSession");await h(T?.session?.user||null)}catch(T){console.error("Auth init failed:",T)}finally{l(!1)}})(),()=>{try{w?.unsubscribe?.()}catch{}}},[h]);const f=k.useCallback(async(w,j)=>{const{error:N}=await Ee.auth.signInWithPassword({email:w,password:j});if(N)throw console.error("Login error:",N),new Error("")},[]),p=k.useCallback(async(w,j,N)=>{const{data:T,error:R}=await Ee.auth.signUp({email:w,password:j,options:{data:{display_id:N},emailRedirectTo:window.location.origin+"/app/"}});if(R)throw console.error("SignUp error:",R),new Error(R.message||"");const $=T?.user;if($?.id){let F=null;F=(await Ee.from("profiles").insert([{id:$.id,display_id:N,email:w||null,role:"user",show_master_recipes:!1}]))?.error??null,F&&String(F.message||"").toLowerCase().includes("email")&&(F=(await Ee.from("profiles").insert([{id:$.id,display_id:N,role:"user",show_master_recipes:!1}]))?.error??null),F&&F.code!=="23505"&&console.error("Profile create error:",F)}return{needsEmailConfirmation:!T?.session}},[]),m=k.useCallback(async()=>{s(null),u(!1);try{localStorage.removeItem("auth_user_cache")}catch{}try{const{error:w}=await Ao(Ee.auth.signOut({scope:"local"}),3e3,"auth.signOut(local)");w&&console.warn("Logout (local scope) returned error:",w)}catch(w){console.warn("Logout (local scope) failed/timed out:",w)}},[]),y=k.useCallback(w=>{!w||typeof w!="object"||s(j=>j&&{...j,...w})},[]),b=k.useCallback(async w=>{const{error:j}=await Ee.auth.resetPasswordForEmail(w,{redirectTo:window.location.origin+"/app/"});if(j)throw console.error("Password reset email error:",j),new Error("");return!0},[]),v=k.useCallback(async w=>{const{error:j}=await Ee.auth.updateUser({password:w});if(j)throw console.error("Update password error:",j),new Error("");return!0},[]),S=k.useCallback(()=>{u(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),_=k.useMemo(()=>({user:e,loading:a,login:f,register:p,logout:m,patchCurrentUserProfile:y,sendPasswordResetEmail:b,isPasswordRecovery:c,updatePassword:v,finishPasswordRecovery:S}),[e,a,f,p,m,y,b,c,v,S]);return r.jsx(Zb.Provider,{value:_,children:n})},AA=({id:n,message:e,type:s="info",onClose:a})=>{k.useEffect(()=>{const c=setTimeout(()=>{a(n)},3e3);return()=>clearTimeout(c)},[n,a]);const l=()=>{switch(s){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return r.jsxs("div",{className:`toast toast-${s}`,children:[r.jsx("div",{className:"toast-icon",children:l()}),r.jsx("div",{className:"toast-message",children:e}),r.jsx("button",{className:"toast-close",onClick:()=>a(n),"aria-label":"",children:""})]})},TA=({toasts:n,onRemove:e})=>n.length===0?null:r.jsx("div",{className:"toast-container",children:n.map(s=>r.jsx(AA,{id:s.id,message:s.message,type:s.type,onClose:e},s.id))}),RA=({children:n})=>{const[e,s]=k.useState([]),a=k.useCallback((u,h="info")=>{const f=Date.now()+Math.random();s(p=>[...p,{id:f,message:u,type:h}].slice(-5))},[]),l=k.useCallback(u=>{s(h=>h.filter(f=>f.id!==u))},[]),c={showToast:a,success:u=>a(u,"success"),error:u=>a(u,"error"),warning:u=>a(u,"warning"),info:u=>a(u,"info")};return r.jsxs(ew.Provider,{value:c,children:[n,r.jsx(TA,{toasts:e,onRemove:l})]})},OA=()=>{const[n,e]=k.useState(!0),[s,a]=k.useState(!1),[l,c]=k.useState(""),[u,h]=k.useState(""),[f,p]=k.useState(""),[m,y]=k.useState(""),[b,v]=k.useState(""),[S,_]=k.useState(!1),[w,j]=k.useState(!1);Ie.useEffect(()=>{const I=localStorage.getItem("savedEmail"),U=localStorage.getItem("savedPassword");I&&(c(I),U&&h(U),j(!0))},[]);const{login:N,register:T,sendPasswordResetEmail:R}=ms(),$=async I=>{I.preventDefault(),y(""),v(""),_(!0);try{await N(l.trim(),u),w?(localStorage.setItem("savedEmail",l.trim()),localStorage.setItem("savedPassword",u)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(U){y(U.message||"")}finally{_(!1)}},F=async I=>{I.preventDefault(),y(""),v(""),_(!0);try{if(!f.trim()){y("ID: yoshito");return}(await T(l.trim(),u,f.trim()))?.needsEmailConfirmation?v(""):v(""),e(!0),h("")}catch(U){y(U.message||"")}finally{_(!1)}},q=async I=>{I.preventDefault(),y(""),v(""),_(!0);try{await R(l.trim()),v(""),a(!1)}catch(U){y(U.message||"")}finally{_(!1)}};return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:r.jsxs(mn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[r.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[r.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",r.jsx("br",{}),"Management"]}),r.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:s?"":n?"":""})]}),m&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),b&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:b}),r.jsxs("form",{onSubmit:s?q:n?$:F,children:[r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"email",value:l,onChange:I=>c(I.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:u,onChange:I=>h(I.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!s&&!n&&r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",r.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),r.jsx("input",{type:"text",value:f,onChange:I=>p(I.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!s&&r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[r.jsx("input",{type:"checkbox",id:"rememberMe",checked:w,onChange:I=>j(I.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),r.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),r.jsx(he,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:S,children:s?"":n?"":""})]}),r.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s?r.jsx("button",{type:"button",onClick:()=>{a(!1),y(""),v("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):r.jsx("button",{type:"button",onClick:()=>{a(!0),y(""),v("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!s&&r.jsx("button",{type:"button",onClick:()=>{e(!n),y(""),v("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},DA=()=>{const{updatePassword:n,finishPasswordRecovery:e,logout:s}=ms(),[a,l]=Ie.useState(""),[c,u]=Ie.useState(""),[h,f]=Ie.useState(""),[p,m]=Ie.useState(""),[y,b]=Ie.useState(!1),v=async S=>{if(S.preventDefault(),f(""),m(""),!a||a.length<8){f("8");return}if(a!==c){f("");return}b(!0);try{await n(a),m(""),e()}catch(_){console.error(_),f(_.message||"")}finally{b(!1)}};return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:r.jsxs(mn,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[r.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),r.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),h&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:h}),p&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:p}),r.jsxs("form",{onSubmit:v,children:[r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:a,onChange:S=>l(S.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:c,onChange:S=>u(S.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),r.jsx(he,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:y,children:""})]}),r.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>{e()},style:{flex:1},children:""}),r.jsx(he,{variant:"ghost",onClick:s,style:{flex:1},children:""})]})]})})},Sp=({label:n,subLabel:e,variant:s="screen",showLogo:a=!0})=>r.jsxs("div",{className:s==="screen"?"loading-screen":"loading-inline",children:[a&&r.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),r.jsxs("div",{className:"loading-text",children:[n,r.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[r.jsx("span",{children:"."}),r.jsx("span",{children:"."}),r.jsx("span",{children:"."})]})]}),r.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),e&&r.jsx("div",{className:"loading-subtext",children:e})]}),zA=24,MA=120,LA=64,UA=180,Yu="__NO_STORE__",Qu="__OTHER_STORE__",IA=(n,e)=>{const s=new Set((n||[]).map(l=>String(l.id))),a=[...n||[]];for(const l of e||[]){const c=String(l.id);s.has(c)||(s.add(c),a.push(l))}return a},Wp=n=>(n||"").toString().replace(/\s+/g," ").trim(),Qr=n=>Wp(n).toLowerCase(),Ix=new Set(md.map(n=>Qr(n)).filter(Boolean));function BA(){const{user:n,logout:e,loading:s,isPasswordRecovery:a}=ms(),l=Ps(),[c,u]=bc(),[h,f]=k.useState([]),[p,m]=k.useState(!0),[y,b]=k.useState(0),[v,S]=k.useState([]),[_,w]=k.useState(!1),[j,N]=k.useState({}),[T,R]=k.useState({}),[$,F]=k.useState(!1),q=k.useRef(0),I=c.get("view"),U=(I==="create-mock"?"create":I)||"list",P=c.get("id"),V=h.find(Se=>String(Se.id)===P)||null,[D,H]=k.useState(null),[C,M]=k.useState(!1),[z,B]=k.useState(""),[K,Q]=k.useState(null),[Z,A]=k.useState(null),[L,J]=k.useState(""),[ae,ue]=k.useState("none"),[Ce,fe]=k.useState(!1),[ne,be]=k.useState(!1),[le,ie]=k.useState(new Set),[Te,Le]=k.useState("normal"),[E,ve]=k.useState(!1),[ge,Y]=k.useState(!1),[W,oe]=k.useState(null),[re,ee]=k.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),de={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};k.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const Se=window.matchMedia("(max-width: 700px)"),nt=()=>ee(!!Se.matches);return nt(),Se.addEventListener?Se.addEventListener("change",nt):Se.addListener(nt),()=>{Se.removeEventListener?Se.removeEventListener("change",nt):Se.removeListener(nt)}},[]),k.useEffect(()=>{if(!re||!de[U]||typeof window>"u")return;const Se=`pc-recommend-shown:${U}`;try{if(window.sessionStorage.getItem(Se)==="1")return;window.sessionStorage.setItem(Se,"1")}catch{}oe(U)},[U,re]),k.useEffect(()=>{U!=="list"&&ue("none")},[U]),k.useEffect(()=>{if(typeof document>"u"||!Ce)return;const Se=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=Se}},[Ce]),k.useEffect(()=>{if(!s){w(!1);return}const Se=setTimeout(()=>w(!0),3500);return()=>clearTimeout(Se)},[s]),k.useEffect(()=>{if(h.length>0||U==="trash")return;let Se=n?.id;if(!Se)try{Se=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!Se)return;const nt=jn.getCachedRecipes(Se);nt&&nt.length>0&&(f(nt),F(!0),m(!1))},[n?.id]),k.useEffect(()=>{s||n&&(We(),Pe())},[s,n?.id]),k.useEffect(()=>{if(s)return;if(!n||n.role!=="admin"){N({}),R({});return}let Se=!1;return(async()=>{try{const nt=await hs.fetchAllProfiles();if(Se)return;const te={},ze={};for(const Ae of nt||[])Ae?.id&&(te[String(Ae.id)]=Ae),Ae?.display_id&&(ze[String(Ae.display_id)]=Ae);N(te),R(ze)}catch(nt){console.warn("Failed to load profiles for admin owner labels",nt)}})(),()=>{Se=!0}},[s,n?.id,n?.role]);const me=Se=>{const te=(Se?.tags||[]).find(Qe=>Qe&&Qe.startsWith("owner:"));if(!te)return"/";const ze=String(te.slice(6)),Ae=j[ze]||T[ze]||null;return Ae?Ae.display_id||Ae.email||ze:ze.length>12?`${ze.slice(0,8)}`:ze},Be=Ia(Ar(Qo,{activationConstraint:{distance:10}}),Ar(Jo,{activationConstraint:{delay:1e3,tolerance:5}}),Ar(Yo,{coordinateGetter:Rd})),Re=Se=>{const{active:nt,over:te}=Se;nt.id!==te.id&&f(ze=>{const Ae=ze.findIndex(xe=>xe.id===nt.id),Qe=ze.findIndex(xe=>xe.id===te.id);if(Ae===-1||Qe===-1)return ze;const ce=ra(ze,Ae,Qe),se=ce.map((xe,Ne)=>({id:xe.id,order_index:Ne}));return jn.updateOrder(se).catch(xe=>console.error("Order update failed",xe)),ce})},Pe=async()=>{try{const Se=await jn.fetchRecentRecipes();S(Se||[])}catch(Se){console.error("Failed to load history:",Se)}},Je=async Se=>{const nt=[Se,...v.filter(te=>te!==Se)].slice(0,20);S(nt);try{await jn.addToHistory(Se)}catch(te){console.error("Failed to sync history",te)}},We=async()=>{try{const Se=await jn.getDeletedCount();b(Se||0)}catch(Se){console.error("Failed to load trash count:",Se)}},Et=async()=>{if(!n)return;const Se=q.current+1;q.current=Se;const nt=()=>q.current!==Se,te=re?zA:MA,ze=re?LA:UA;try{$||m(!0);const Ae=await jn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:0,limit:te,skipCacheSave:!0,returnMeta:!0});if(nt())return;let Qe=Ae?.recipes||[],ce=Ae?.hasMoreRaw===!0,se=te;f(Qe);let xe=!1;for(!$&&(Qe.length>0||!ce)&&(m(!1),xe=!0);ce;){const Ne=await jn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:se,limit:ze,skipCacheSave:!0,returnMeta:!0});if(nt())return;const Ke=Ne?.recipes||[];if(Ke.length>0&&(Qe=IA(Qe,Ke),f(Qe),!$&&!xe&&(m(!1),xe=!0)),se+=ze,ce=Ne?.hasMoreRaw===!0,Ke.length===0&&!ce)break}if(nt())return;jn.saveCachedRecipes(Qe,n.id)}catch(Ae){if(nt())return;console.error("Failed to fetch recipes:",Ae),l.error(`

(${Ae?.message||"unknown error"})`)}finally{nt()||(m(!1),F(!1))}},{allCourses:Wt,allCategories:dt,storeCounts:yt,noStoreCount:ft,otherStoreCount:Tt,courseCounts:sn,categoryCounts:wt}=k.useMemo(()=>{const Se=[...new Set(h.map(se=>Wp(se.course)).filter(Boolean))],nt=[...new Set(h.map(se=>Wp(se.category)).filter(Boolean))],te=h.reduce((se,xe)=>{const Ne=Qr(xe.storeName);return Ne&&(se[Ne]=(se[Ne]||0)+1),se},{}),ze=h.reduce((se,xe)=>Qr(xe.storeName)?se:se+1,0),Ae=h.reduce((se,xe)=>{const Ne=Qr(xe.storeName);return Ne?Ix.has(Ne)?se:se+1:se},0),Qe=h.reduce((se,xe)=>{const Ne=Qr(xe.course);return Ne&&(se[Ne]=(se[Ne]||0)+1),se},{}),ce=h.reduce((se,xe)=>{const Ne=Qr(xe.category);return Ne&&(se[Ne]=(se[Ne]||0)+1),se},{});return{allCourses:Se,allCategories:nt,storeCounts:te,noStoreCount:ze,otherStoreCount:Ae,courseCounts:Qe,categoryCounts:ce}},[h]),Un=k.useMemo(()=>{const Se=Qr(z),nt=L.toLowerCase().trim();return h.filter(te=>{const ze=Qr(te.storeName);return z===""||z==="recent"&&v.includes(te.id)||te.tags&&te.tags.includes(z)||z===Yu&&!ze||z===Qu&&ze&&!Ix.has(ze)||te.category&&Qr(te.category)===Se||te.course&&Qr(te.course)===Se||te.storeName&&ze===Se?nt?(te.title||"").toLowerCase().includes(nt)||te.description&&te.description.toLowerCase().includes(nt)||Array.isArray(te.ingredients)&&te.ingredients.some(Qe=>(Qe?.name||"").toLowerCase().includes(nt)):!0:!1})},[h,z,v,L]),Lt=z===""&&!L.trim()&&U==="list",qt=(Se,nt={})=>{u({view:"detail",id:Se.id,...nt})},un=async(Se,nt=!1)=>{try{if(Se.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&Se.tags.some(ze=>ze==="owner:yoshito")){l.warning("");return}nt?(await jn.restoreRecipe(Se.id),(U==="trash"||U==="detail")&&(u({view:"trash"}),_t()),l.success("")):(await jn.deleteRecipe(Se.id),f(h.filter(te=>te.id!==Se.id)),u({view:"list"}),We())}catch(te){console.error("Failed to delete/restore recipe:",te),l.error("")}finally{We()}},yn=async Se=>{try{await jn.hardDeleteRecipe(Se.id),f(h.filter(nt=>nt.id!==Se.id)),u({view:"trash"}),l.success(""),_t(),We()}catch(nt){console.error("Failed to hard delete recipe:",nt),l.error("")}},_t=async()=>{try{q.current+=1,m(!0);const Se=await jn.fetchDeletedRecipes();f(Se||[]),B("")}catch(Se){console.error("Failed to fetch deleted recipes:",Se)}finally{m(!1)}},jt=()=>{u({view:"trash"})},Kt=()=>{u({view:"list"})},Ft=async()=>{fe(!1);try{await e()}catch(Se){console.error("Logout failed:",Se),l.warning("")}},dn=async(Se,nt)=>{try{let te,ze=nt;if(nt&&n.role!=="admin"){const Ae=Se.tags?.find(ce=>ce.startsWith("owner:"));Ae===`owner:${n.id}`||n.displayId&&Ae===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${Ae||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),ze=!1)}ze?(te=await jn.updateRecipe(Se,n),f(h.map(Ae=>Ae.id===te.id?te:Ae))):(te=await jn.createRecipe(Se,n),f([te,...h])),u(ze?{view:"detail",id:te.id}:{view:"detail",id:te.id})}catch(te){console.error("Failed to save recipe:",te),l.error(`
: ${te.message||te.error_description||JSON.stringify(te)}`)}};k.useEffect(()=>{let Se=!1;return(async()=>{if(U!=="edit"||!P){H(null),M(!1);return}M(!0);try{const te=await jn.getRecipe(P);if(Se)return;H(te)}catch(te){if(console.error("Failed to load edit recipe details",te),Se)return;H(V),l.warning("")}finally{Se||M(!1)}})(),()=>{Se=!0}},[U,P]);const Ht=(Se,nt="")=>{try{Se.__importId=globalThis.crypto&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}_${Math.random().toString(16).slice(2)}`}catch{Se.__importId=`${Date.now()}_${Math.random().toString(16).slice(2)}`}const te=["","baker","","","","dough","fermentation"],ze=Se.title||Se.name||"",Ae=te.some(tt=>ze.toLowerCase().includes(tt)),Qe=["flour","","","","","","","","",""],ce=["yeast","","",""],se=Se.ingredients||[],xe=se.some(tt=>ce.some(Ze=>(tt.name||"").toLowerCase().includes(Ze))),Ne=se.some(tt=>Qe.some(Ze=>(tt.name||"").toLowerCase().includes(Ze))&&!tt.name.includes(""));if(se.some(tt=>tt.quantity&&String(tt.quantity).includes("%")||tt.unit&&String(tt.unit).includes("%"))||xe||Ae&&Ne){Se.type="bread",Se.flours=[],Se.breadIngredients=[];const tt=["flour","","","","","","","",""];if(se.forEach(Ze=>{tt.some(lt=>(Ze.name||"").includes(lt))?Se.flours.push(Ze):Se.breadIngredients.push(Ze)}),Se.flours.length===0&&se.length>0){const Ze=se[0];(Ze.name||"").includes("")&&(Se.flours.push(Ze),Se.breadIngredients=Se.breadIngredients.filter(Xe=>Xe!==Ze))}}Se.sourceUrl=nt,nt&&(Se.category="URL"),A(Se),u({view:"create"})},gn=()=>{be(!ne),ie(new Set)},hn=Se=>{const nt=new Set(le);nt.has(Se)?nt.delete(Se):nt.add(Se),ie(nt)},an=()=>{ve(!0)},Dn=()=>{ve(!1)},Vt=async()=>{ve(!1);try{m(!0),U==="trash"?(await Promise.all(Array.from(le).map(Se=>jn.hardDeleteRecipe(Se))),_t()):(await Promise.all(Array.from(le).map(Se=>jn.deleteRecipe(Se))),f(h.filter(Se=>!le.has(Se.id))),We()),ie(new Set),be(!1),l.success("")}catch(Se){console.error("Bulk delete failed",Se),l.warning(""),U==="trash"?_t():Et()}finally{m(!1)}},Cn=()=>{le.size!==0&&Y(!0)},It=()=>{Y(!1)},zn=async()=>{Y(!1);try{m(!0);for(const Se of le)await jn.restoreRecipe(Se);f(h.filter(Se=>!le.has(Se.id))),We(),be(!1),ie(new Set),l.success(""),_t()}catch(Se){console.error("Bulk restore failed",Se),l.warning(""),_t()}finally{m(!1)}},qn=()=>{const Se=Un.map(nt=>nt.id);ie(new Set(Se))},fn=Se=>{f([Se,...h]),u({view:"edit",id:Se.id})};if(k.useEffect(()=>{s||n&&(U==="trash"?_t():U==="list"&&Et())},[U,s,n?.id]),s&&!_){let Se=!1;try{const nt=JSON.parse(localStorage.getItem("auth_user_cache")||"null");nt?.id&&(Se=!!jn.getCachedRecipes(nt.id))}catch{}if(!Se)return r.jsx(Sp,{label:"",subLabel:""})}return n?a?r.jsx(DA,{}):r.jsxs(V1,{children:[E&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(mn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," ",le.size,"",U==="trash"?"":""]}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:U==="trash"?"":""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(he,{variant:"ghost",onClick:Dn,children:""}),r.jsx(he,{variant:"danger",onClick:Vt,children:U==="trash"?"":""})]})]})}),ge&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(mn,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," ",le.size,""]}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(he,{variant:"ghost",onClick:It,children:""}),r.jsx(he,{variant:"secondary",onClick:zn,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),r.jsx(rn,{isOpen:!!W,onClose:()=>oe(null),title:"PC",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[r.jsx("p",{style:{marginTop:0},children:de[W]?r.jsxs(r.Fragment,{children:["",r.jsx("strong",{children:de[W]}),"/"]}):r.jsx(r.Fragment,{children:"/"})}),r.jsxs("p",{style:{marginBottom:0},children:["",r.jsx("strong",{children:"PC"}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[r.jsx(he,{variant:"ghost",onClick:()=>{oe(null),u({view:"list"})},children:""}),r.jsx(he,{variant:"primary",onClick:()=>oe(null),children:"OK"})]})]})}),(U==="list"||U==="trash")&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"container-header",children:[r.jsxs("h2",{className:"section-title",children:[U==="trash"?" ()":"",U==="list"&&r.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",h.length,")"]})]}),r.jsx("div",{className:"header-actions",children:U==="list"||U==="trash"?r.jsxs(r.Fragment,{children:[ne?r.jsxs(r.Fragment,{children:[r.jsx(he,{variant:"ghost",onClick:gn,children:""}),r.jsx(he,{variant:"secondary",onClick:qn,children:""}),U==="trash"&&r.jsxs(he,{variant:"secondary",onClick:Cn,disabled:le.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",le.size,")"]}),r.jsxs(he,{variant:"danger",onClick:an,disabled:le.size===0,children:[U==="trash"?"":""," (",le.size,")"]})]}):r.jsx(r.Fragment,{children:U==="list"?r.jsx(r.Fragment,{children:r.jsx(he,{onClick:()=>{A(null),u({view:"create"})},className:"primary-action-btn",children:"+ "})}):r.jsx(he,{variant:"ghost",onClick:Kt,children:" "})}),r.jsx("button",{className:"mobile-menu-toggle",onClick:()=>fe(!Ce),"aria-label":"",children:""}),r.jsxs("div",{className:`secondary-actions ${Ce?"open":""}`,children:[r.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>fe(!1),"aria-label":"",children:""}),r.jsxs("div",{className:"secondary-actions-content",children:[r.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[r.jsxs("div",{style:{fontWeight:"bold"},children:[": ",Es(n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---"))]}),n?.role==="admin"&&r.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&r.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),r.jsxs(he,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),r.jsxs(he,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),U==="list"&&r.jsxs(r.Fragment,{children:[r.jsxs(he,{variant:"secondary",onClick:()=>{Q("url"),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),r.jsxs(he,{variant:"secondary",onClick:()=>{Q("image"),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsx("div",{className:"pc-recommend-note",children:r.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),r.jsxs(he,{variant:"secondary",onClick:()=>{u({view:"inventory"}),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(he,{variant:"secondary",onClick:()=>{u({view:"incoming-deliveries"}),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),r.jsxs(he,{variant:"secondary",onClick:()=>{u({view:"incoming-stock"}),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(he,{variant:"secondary",onClick:()=>{u({view:"planner"}),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(he,{variant:"secondary",onClick:()=>{u({view:"order-list"}),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsxs(he,{variant:"secondary",onClick:()=>{u({view:"data"}),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsxs(he,{variant:"secondary",onClick:()=>{u({view:"users"}),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(he,{variant:"secondary",onClick:()=>{u({view:"api-logs"}),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," API"]})]}),r.jsx("div",{className:"menu-divider"})]}),!ne&&r.jsxs(he,{variant:"ghost",onClick:()=>{gn(),fe(!1)},className:"danger-text",children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," ",U==="trash"?"":""]}),U==="list"&&r.jsxs(he,{variant:"ghost",onClick:()=>{jt(),fe(!1)},style:{position:"relative"},children:[r.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",y>0&&r.jsx("span",{className:"trash-badge",children:y})]}),r.jsxs(he,{variant:"ghost",onClick:()=>{Kt(),fe(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsxs(he,{variant:"ghost",onClick:Ft,children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]})]}),r.jsx("div",{className:`menu-backdrop ${Ce?"open":""}`,onClick:()=>fe(!1),"aria-hidden":"true"})]}):null})]}),U==="list"&&r.jsxs("div",{className:"list-toolbar",children:[r.jsxs("div",{className:"search-container search-container--compact",children:[r.jsx("span",{className:"search-icon",children:""}),r.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:L,onChange:Se=>J(Se.target.value)})]}),r.jsxs("div",{className:"public-recipe-toggles",children:[r.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${ae==="mine"?"active":""}`,"aria-pressed":ae==="mine",onClick:()=>ue("mine"),children:" "}),r.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${ae==="others"?"active":""}`,"aria-pressed":ae==="others",onClick:()=>ue("others"),children:" "}),ae!=="none"&&r.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>ue("none"),children:" "})]})]}),r.jsxs("div",{className:"tag-filter-container",children:[r.jsxs("select",{className:"store-filter-select",value:z===Yu?Yu:z===Qu?Qu:md.includes(z)?z:"",onChange:Se=>B(Se.target.value||""),children:[r.jsx("option",{value:"",children:""}),md.map(Se=>r.jsxs("option",{value:Se,children:[Se," (",yt[Qr(Se)]||0,")"]},Se)),r.jsxs("option",{value:Yu,children:[" (",ft,")"]}),r.jsxs("option",{value:Qu,children:[" (",Tt,")"]})]}),r.jsxs("select",{className:"store-filter-select",value:Wt.includes(z)?z:"",onChange:Se=>B(Se.target.value||""),children:[r.jsx("option",{value:"",children:""}),Wt.sort().map(Se=>r.jsxs("option",{value:Se,children:[Se," (",sn[Qr(Se)]||0,")"]},Se))]}),r.jsxs("select",{className:"store-filter-select",value:dt.includes(z)?z:"",onChange:Se=>B(Se.target.value||""),children:[r.jsx("option",{value:"",children:""}),dt.sort().map(Se=>r.jsxs("option",{value:Se,children:[Se," (",wt[Qr(Se)]||0,")"]},Se))]}),r.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[r.jsx("button",{className:`tag-filter-btn ${Te==="normal"?"active":""}`,onClick:()=>Le("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),r.jsx("button",{className:`tag-filter-btn ${Te==="all"?"active":""}`,onClick:()=>Le("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),p?r.jsx(Sp,{label:$?"":"",subLabel:$?void 0:"",variant:"inline",showLogo:!1}):h.length===0?r.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[U==="trash"?"":"",z!==""&&r.jsx("p",{children:""})]}):r.jsxs("div",{className:"main-content-wrapper",children:[U==="list"&&r.jsx("div",{className:"recent-list-wrapper",children:r.jsx(E2,{recipes:h,recentIds:v,onSelect:qt})}),r.jsx("div",{className:"recipe-list-container",children:U==="list"?r.jsx(ea,{sensors:Be,collisionDetection:cd,onDragEnd:Re,children:r.jsx(j0,{recipes:Un,onSelectRecipe:qt,isSelectMode:ne,selectedIds:le,onToggleSelection:hn,disableDrag:!Lt,displayMode:Te,publicRecipeView:ae,showOwner:n?.role==="admin",ownerLabelFn:me,currentUser:n})}):r.jsx(j0,{recipes:Un,onSelectRecipe:qt,isSelectMode:ne,selectedIds:le,onToggleSelection:hn,disableDrag:!0,displayMode:Te,publicRecipeView:ae,showOwner:n?.role==="admin",ownerLabelFn:me,currentUser:n})})]})]}),U==="detail"&&V&&r.jsx(zE,{recipe:V,ownerLabel:n?.role==="admin"?me(V):void 0,isDeleted:!!V.deletedAt,onBack:()=>{c.get("from")==="planner"?u({view:"planner"}):V.deletedAt?jt():Kt()},backLabel:c.get("from")==="planner"?" ":void 0,onList:c.get("from")==="planner"?Kt:void 0,onEdit:()=>u({view:"edit",id:V.id,from:c.get("from")}),onDelete:un,onView:Je,onHardDelete:yn,onDuplicate:fn}),U==="edit"&&P&&(C?r.jsx(Sp,{label:"",subLabel:"URL"}):D&&r.jsx(_x,{initialData:D,onCancel:()=>u({view:"detail",id:P}),onSave:Se=>dn(Se,!0)},`edit-${P}`)),U==="create"&&r.jsx(_x,{initialData:Z,onCancel:()=>{u({view:"list"}),A(null)},onSave:Se=>dn(Se,!1)},Z?.__importId?`create-form-imported-${Z.__importId}`:"create-form"),K&&r.jsx(hw,{initialMode:K,onClose:()=>Q(null),onImport:Ht}),(U==="data"||U==="data-management")&&r.jsx(N2,{onBack:()=>u({view:"list"})}),U==="levain-guide"&&r.jsx(A2,{onBack:()=>u({view:"list"})}),U==="users"&&n?.role==="admin"&&r.jsx(T2,{onBack:()=>u({view:"list"})}),U==="inventory"&&r.jsx(M2,{onBack:()=>u({view:"list"})}),U==="incoming-deliveries"&&r.jsx(K2,{onBack:()=>u({view:"list"})}),U==="incoming-stock"&&r.jsx(wA,{onBack:()=>u({view:"list"})}),U==="planner"&&r.jsx(CA,{onBack:()=>u({view:"list"}),onSelectRecipe:Se=>qt(Se,{from:"planner"}),onNavigateToOrderList:()=>u({view:"order-list"})}),U==="order-list"&&r.jsx(kA,{onBack:()=>u({view:"list"}),onNavigateToPlanner:()=>u({view:"planner"})}),U==="api-logs"&&n?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{padding:"20px 20px 0",textAlign:"left"},children:r.jsx(he,{onClick:()=>u({view:"list"}),children:" "})}),r.jsx(NA,{}),r.jsx("div",{style:{padding:"20px",textAlign:"center"},children:r.jsx(he,{onClick:()=>u({view:"list"}),children:" "})})]})]}):r.jsx(OA,{})}function $A(){return r.jsx(RA,{children:r.jsx(EA,{children:r.jsx(BA,{})})})}class PA extends Ie.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,s){console.error("Uncaught error:",e,s),this.setState({error:e,errorInfo:s})}render(){return this.state.hasError?r.jsxs("div",{style:{padding:"2rem",color:"red"},children:[r.jsx("h1",{children:""}),r.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),r.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),r.jsx("br",{}),r.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}pS.createRoot(document.getElementById("root")).render(r.jsx(k.StrictMode,{children:r.jsx(PA,{children:r.jsx(M1,{children:r.jsx($A,{})})})}));export{Tu as a,Kp as b,Wu as c,qA as g};
