(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(o){if(o.ep)return;o.ep=!0;const u=i(o);fetch(o.href,u)}})();var _A=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function N0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function CA(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var i=function a(){var o=!1;try{o=this instanceof a}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(a){var o=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(i,a,o.get?o:{enumerable:!0,get:function(){return n[a]}})}),i}var bf={exports:{}},Co={};var Mv;function YS(){if(Mv)return Co;Mv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function i(a,o,u){var d=null;if(u!==void 0&&(d=""+u),o.key!==void 0&&(d=""+o.key),"key"in o){u={};for(var f in o)f!=="key"&&(u[f]=o[f])}else u=o;return o=u.ref,{$$typeof:n,type:a,key:d,ref:o!==void 0?o:null,props:u}}return Co.Fragment=t,Co.jsx=i,Co.jsxs=i,Co}var zv;function WS(){return zv||(zv=1,bf.exports=YS()),bf.exports}var r=WS(),wf={exports:{}},Bt={};var Lv;function QS(){if(Lv)return Bt;Lv=1;var n=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function S(q){return q===null||typeof q!="object"?null:(q=x&&q[x]||q["@@iterator"],typeof q=="function"?q:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,w={};function C(q,W,ie){this.props=q,this.context=W,this.refs=w,this.updater=ie||_}C.prototype.isReactComponent={},C.prototype.setState=function(q,W){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,W,"setState")},C.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function D(){}D.prototype=C.prototype;function z(q,W,ie){this.props=q,this.context=W,this.refs=w,this.updater=ie||_}var T=z.prototype=new D;T.constructor=z,N(T,C.prototype),T.isPureReactComponent=!0;var U=Array.isArray;function E(){}var R={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function O(q,W,ie){var ve=ie.ref;return{$$typeof:n,type:q,key:W,ref:ve!==void 0?ve:null,props:ie}}function V(q,W){return O(q.type,W,q.props)}function P(q){return typeof q=="object"&&q!==null&&q.$$typeof===n}function F(q){var W={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(ie){return W[ie]})}var Q=/\/+/g;function $(q,W){return typeof q=="object"&&q!==null&&q.key!=null?F(""+q.key):W.toString(36)}function I(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(E,E):(q.status="pending",q.then(function(W){q.status==="pending"&&(q.status="fulfilled",q.value=W)},function(W){q.status==="pending"&&(q.status="rejected",q.reason=W)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function k(q,W,ie,ve,xe){var Ne=typeof q;(Ne==="undefined"||Ne==="boolean")&&(q=null);var de=!1;if(q===null)de=!0;else switch(Ne){case"bigint":case"string":case"number":de=!0;break;case"object":switch(q.$$typeof){case n:case t:de=!0;break;case y:return de=q._init,k(de(q._payload),W,ie,ve,xe)}}if(de)return xe=xe(q),de=ve===""?"."+$(q,0):ve,U(xe)?(ie="",de!=null&&(ie=de.replace(Q,"$&/")+"/"),k(xe,W,ie,"",function(Ae){return Ae})):xe!=null&&(P(xe)&&(xe=V(xe,ie+(xe.key==null||q&&q.key===xe.key?"":(""+xe.key).replace(Q,"$&/")+"/")+de)),W.push(xe)),1;de=0;var K=ve===""?".":ve+":";if(U(q))for(var ge=0;ge<q.length;ge++)ve=q[ge],Ne=K+$(ve,ge),de+=k(ve,W,ie,Ne,xe);else if(ge=S(q),typeof ge=="function")for(q=ge.call(q),ge=0;!(ve=q.next()).done;)ve=ve.value,Ne=K+$(ve,ge++),de+=k(ve,W,ie,Ne,xe);else if(Ne==="object"){if(typeof q.then=="function")return k(I(q),W,ie,ve,xe);throw W=String(q),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return de}function L(q,W,ie){if(q==null)return q;var ve=[],xe=0;return k(q,ve,"","",function(Ne){return W.call(ie,Ne,xe++)}),ve}function H(q){if(q._status===-1){var W=q._result;W=W(),W.then(function(ie){(q._status===0||q._status===-1)&&(q._status=1,q._result=ie)},function(ie){(q._status===0||q._status===-1)&&(q._status=2,q._result=ie)}),q._status===-1&&(q._status=0,q._result=W)}if(q._status===1)return q._result.default;throw q._result}var G=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},ce={map:L,forEach:function(q,W,ie){L(q,function(){W.apply(this,arguments)},ie)},count:function(q){var W=0;return L(q,function(){W++}),W},toArray:function(q){return L(q,function(W){return W})||[]},only:function(q){if(!P(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return Bt.Activity=v,Bt.Children=ce,Bt.Component=C,Bt.Fragment=i,Bt.Profiler=o,Bt.PureComponent=z,Bt.StrictMode=a,Bt.Suspense=h,Bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=R,Bt.__COMPILER_RUNTIME={__proto__:null,c:function(q){return R.H.useMemoCache(q)}},Bt.cache=function(q){return function(){return q.apply(null,arguments)}},Bt.cacheSignal=function(){return null},Bt.cloneElement=function(q,W,ie){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var ve=N({},q.props),xe=q.key;if(W!=null)for(Ne in W.key!==void 0&&(xe=""+W.key),W)!A.call(W,Ne)||Ne==="key"||Ne==="__self"||Ne==="__source"||Ne==="ref"&&W.ref===void 0||(ve[Ne]=W[Ne]);var Ne=arguments.length-2;if(Ne===1)ve.children=ie;else if(1<Ne){for(var de=Array(Ne),K=0;K<Ne;K++)de[K]=arguments[K+2];ve.children=de}return O(q.type,xe,ve)},Bt.createContext=function(q){return q={$$typeof:d,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:u,_context:q},q},Bt.createElement=function(q,W,ie){var ve,xe={},Ne=null;if(W!=null)for(ve in W.key!==void 0&&(Ne=""+W.key),W)A.call(W,ve)&&ve!=="key"&&ve!=="__self"&&ve!=="__source"&&(xe[ve]=W[ve]);var de=arguments.length-2;if(de===1)xe.children=ie;else if(1<de){for(var K=Array(de),ge=0;ge<de;ge++)K[ge]=arguments[ge+2];xe.children=K}if(q&&q.defaultProps)for(ve in de=q.defaultProps,de)xe[ve]===void 0&&(xe[ve]=de[ve]);return O(q,Ne,xe)},Bt.createRef=function(){return{current:null}},Bt.forwardRef=function(q){return{$$typeof:f,render:q}},Bt.isValidElement=P,Bt.lazy=function(q){return{$$typeof:y,_payload:{_status:-1,_result:q},_init:H}},Bt.memo=function(q,W){return{$$typeof:m,type:q,compare:W===void 0?null:W}},Bt.startTransition=function(q){var W=R.T,ie={};R.T=ie;try{var ve=q(),xe=R.S;xe!==null&&xe(ie,ve),typeof ve=="object"&&ve!==null&&typeof ve.then=="function"&&ve.then(E,G)}catch(Ne){G(Ne)}finally{W!==null&&ie.types!==null&&(W.types=ie.types),R.T=W}},Bt.unstable_useCacheRefresh=function(){return R.H.useCacheRefresh()},Bt.use=function(q){return R.H.use(q)},Bt.useActionState=function(q,W,ie){return R.H.useActionState(q,W,ie)},Bt.useCallback=function(q,W){return R.H.useCallback(q,W)},Bt.useContext=function(q){return R.H.useContext(q)},Bt.useDebugValue=function(){},Bt.useDeferredValue=function(q,W){return R.H.useDeferredValue(q,W)},Bt.useEffect=function(q,W){return R.H.useEffect(q,W)},Bt.useEffectEvent=function(q){return R.H.useEffectEvent(q)},Bt.useId=function(){return R.H.useId()},Bt.useImperativeHandle=function(q,W,ie){return R.H.useImperativeHandle(q,W,ie)},Bt.useInsertionEffect=function(q,W){return R.H.useInsertionEffect(q,W)},Bt.useLayoutEffect=function(q,W){return R.H.useLayoutEffect(q,W)},Bt.useMemo=function(q,W){return R.H.useMemo(q,W)},Bt.useOptimistic=function(q,W){return R.H.useOptimistic(q,W)},Bt.useReducer=function(q,W,ie){return R.H.useReducer(q,W,ie)},Bt.useRef=function(q){return R.H.useRef(q)},Bt.useState=function(q){return R.H.useState(q)},Bt.useSyncExternalStore=function(q,W,ie){return R.H.useSyncExternalStore(q,W,ie)},Bt.useTransition=function(){return R.H.useTransition()},Bt.version="19.2.3",Bt}var Uv;function nc(){return Uv||(Uv=1,wf.exports=QS()),wf.exports}var b=nc();const je=N0(b);var Sf={exports:{}},No={},jf={exports:{}},_f={};var Iv;function JS(){return Iv||(Iv=1,(function(n){function t(k,L){var H=k.length;k.push(L);e:for(;0<H;){var G=H-1>>>1,ce=k[G];if(0<o(ce,L))k[G]=L,k[H]=ce,H=G;else break e}}function i(k){return k.length===0?null:k[0]}function a(k){if(k.length===0)return null;var L=k[0],H=k.pop();if(H!==L){k[0]=H;e:for(var G=0,ce=k.length,q=ce>>>1;G<q;){var W=2*(G+1)-1,ie=k[W],ve=W+1,xe=k[ve];if(0>o(ie,H))ve<ce&&0>o(xe,ie)?(k[G]=xe,k[ve]=H,G=ve):(k[G]=ie,k[W]=H,G=W);else if(ve<ce&&0>o(xe,H))k[G]=xe,k[ve]=H,G=ve;else break e}}return L}function o(k,L){var H=k.sortIndex-L.sortIndex;return H!==0?H:k.id-L.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var d=Date,f=d.now();n.unstable_now=function(){return d.now()-f}}var h=[],m=[],y=1,v=null,x=3,S=!1,_=!1,N=!1,w=!1,C=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;function T(k){for(var L=i(m);L!==null;){if(L.callback===null)a(m);else if(L.startTime<=k)a(m),L.sortIndex=L.expirationTime,t(h,L);else break;L=i(m)}}function U(k){if(N=!1,T(k),!_)if(i(h)!==null)_=!0,E||(E=!0,F());else{var L=i(m);L!==null&&I(U,L.startTime-k)}}var E=!1,R=-1,A=5,O=-1;function V(){return w?!0:!(n.unstable_now()-O<A)}function P(){if(w=!1,E){var k=n.unstable_now();O=k;var L=!0;try{e:{_=!1,N&&(N=!1,D(R),R=-1),S=!0;var H=x;try{t:{for(T(k),v=i(h);v!==null&&!(v.expirationTime>k&&V());){var G=v.callback;if(typeof G=="function"){v.callback=null,x=v.priorityLevel;var ce=G(v.expirationTime<=k);if(k=n.unstable_now(),typeof ce=="function"){v.callback=ce,T(k),L=!0;break t}v===i(h)&&a(h),T(k)}else a(h);v=i(h)}if(v!==null)L=!0;else{var q=i(m);q!==null&&I(U,q.startTime-k),L=!1}}break e}finally{v=null,x=H,S=!1}L=void 0}}finally{L?F():E=!1}}}var F;if(typeof z=="function")F=function(){z(P)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,$=Q.port2;Q.port1.onmessage=P,F=function(){$.postMessage(null)}}else F=function(){C(P,0)};function I(k,L){R=C(function(){k(n.unstable_now())},L)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return x},n.unstable_next=function(k){switch(x){case 1:case 2:case 3:var L=3;break;default:L=x}var H=x;x=L;try{return k()}finally{x=H}},n.unstable_requestPaint=function(){w=!0},n.unstable_runWithPriority=function(k,L){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var H=x;x=k;try{return L()}finally{x=H}},n.unstable_scheduleCallback=function(k,L,H){var G=n.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?G+H:G):H=G,k){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=H+ce,k={id:y++,callback:L,priorityLevel:k,startTime:H,expirationTime:ce,sortIndex:-1},H>G?(k.sortIndex=H,t(m,k),i(h)===null&&k===i(m)&&(N?(D(R),R=-1):N=!0,I(U,H-G))):(k.sortIndex=ce,t(h,k),_||S||(_=!0,E||(E=!0,F()))),k},n.unstable_shouldYield=V,n.unstable_wrapCallback=function(k){var L=x;return function(){var H=x;x=L;try{return k.apply(this,arguments)}finally{x=H}}}})(_f)),_f}var Bv;function XS(){return Bv||(Bv=1,jf.exports=JS()),jf.exports}var Cf={exports:{}},cr={};var $v;function ZS(){if($v)return cr;$v=1;var n=nc();function t(h){var m="https://react.dev/errors/"+h;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)m+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(t(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");function u(h,m,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:o,key:v==null?null:""+v,children:h,containerInfo:m,implementation:y}}var d=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,m){if(h==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return cr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,cr.createPortal=function(h,m){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(t(299));return u(h,m,null,y)},cr.flushSync=function(h){var m=d.T,y=a.p;try{if(d.T=null,a.p=2,h)return h()}finally{d.T=m,a.p=y,a.d.f()}},cr.preconnect=function(h,m){typeof h=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,a.d.C(h,m))},cr.prefetchDNS=function(h){typeof h=="string"&&a.d.D(h)},cr.preinit=function(h,m){if(typeof h=="string"&&m&&typeof m.as=="string"){var y=m.as,v=f(y,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,S=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;y==="style"?a.d.S(h,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:S}):y==="script"&&a.d.X(h,{crossOrigin:v,integrity:x,fetchPriority:S,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},cr.preinitModule=function(h,m){if(typeof h=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var y=f(m.as,m.crossOrigin);a.d.M(h,{crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&a.d.M(h)},cr.preload=function(h,m){if(typeof h=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var y=m.as,v=f(y,m.crossOrigin);a.d.L(h,y,{crossOrigin:v,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},cr.preloadModule=function(h,m){if(typeof h=="string")if(m){var y=f(m.as,m.crossOrigin);a.d.m(h,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:y,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else a.d.m(h)},cr.requestFormReset=function(h){a.d.r(h)},cr.unstable_batchedUpdates=function(h,m){return h(m)},cr.useFormState=function(h,m,y){return d.H.useFormState(h,m,y)},cr.useFormStatus=function(){return d.H.useHostTransitionStatus()},cr.version="19.2.3",cr}var Pv;function E0(){if(Pv)return Cf.exports;Pv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Cf.exports=ZS(),Cf.exports}var qv;function ej(){if(qv)return No;qv=1;var n=XS(),t=nc(),i=E0();function a(e){var s="https://react.dev/errors/"+e;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+e+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function u(e){var s=e,l=e;if(e.alternate)for(;s.return;)s=s.return;else{e=s;do s=e,(s.flags&4098)!==0&&(l=s.return),e=s.return;while(e)}return s.tag===3?l:null}function d(e){if(e.tag===13){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function f(e){if(e.tag===31){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function h(e){if(u(e)!==e)throw Error(a(188))}function m(e){var s=e.alternate;if(!s){if(s=u(e),s===null)throw Error(a(188));return s!==e?null:e}for(var l=e,c=s;;){var p=l.return;if(p===null)break;var g=p.alternate;if(g===null){if(c=p.return,c!==null){l=c;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===l)return h(p),e;if(g===c)return h(p),s;g=g.sibling}throw Error(a(188))}if(l.return!==c.return)l=p,c=g;else{for(var j=!1,M=p.child;M;){if(M===l){j=!0,l=p,c=g;break}if(M===c){j=!0,c=p,l=g;break}M=M.sibling}if(!j){for(M=g.child;M;){if(M===l){j=!0,l=g,c=p;break}if(M===c){j=!0,c=g,l=p;break}M=M.sibling}if(!j)throw Error(a(189))}}if(l.alternate!==c)throw Error(a(190))}if(l.tag!==3)throw Error(a(188));return l.stateNode.current===l?e:s}function y(e){var s=e.tag;if(s===5||s===26||s===27||s===6)return e;for(e=e.child;e!==null;){if(s=y(e),s!==null)return s;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),_=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),z=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),O=Symbol.for("react.activity"),V=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function F(e){return e===null||typeof e!="object"?null:(e=P&&e[P]||e["@@iterator"],typeof e=="function"?e:null)}var Q=Symbol.for("react.client.reference");function $(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Q?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case N:return"Fragment";case C:return"Profiler";case w:return"StrictMode";case U:return"Suspense";case E:return"SuspenseList";case O:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case _:return"Portal";case z:return e.displayName||"Context";case D:return(e._context.displayName||"Context")+".Consumer";case T:var s=e.render;return e=e.displayName,e||(e=s.displayName||s.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case R:return s=e.displayName||null,s!==null?s:$(e.type)||"Memo";case A:s=e._payload,e=e._init;try{return $(e(s))}catch{}}return null}var I=Array.isArray,k=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,H={pending:!1,data:null,method:null,action:null},G=[],ce=-1;function q(e){return{current:e}}function W(e){0>ce||(e.current=G[ce],G[ce]=null,ce--)}function ie(e,s){ce++,G[ce]=e.current,e.current=s}var ve=q(null),xe=q(null),Ne=q(null),de=q(null);function K(e,s){switch(ie(Ne,s),ie(xe,e),ie(ve,null),s.nodeType){case 9:case 11:e=(e=s.documentElement)&&(e=e.namespaceURI)?rv(e):0;break;default:if(e=s.tagName,s=s.namespaceURI)s=rv(s),e=sv(s,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}W(ve),ie(ve,e)}function ge(){W(ve),W(xe),W(Ne)}function Ae(e){e.memoizedState!==null&&ie(de,e);var s=ve.current,l=sv(s,e.type);s!==l&&(ie(xe,e),ie(ve,l))}function ae(e){xe.current===e&&(W(ve),W(xe)),de.current===e&&(W(de),wo._currentValue=H)}var Se,Re;function Oe(e){if(Se===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);Se=s&&s[1]||"",Re=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Se+e+Re}var He=!1;function nt(e,s){if(!e||He)return"";He=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(s){var ze=function(){throw Error()};if(Object.defineProperty(ze.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ze,[])}catch(we){var ye=we}Reflect.construct(e,[],ze)}else{try{ze.call()}catch(we){ye=we}e.call(ze.prototype)}}else{try{throw Error()}catch(we){ye=we}(ze=e())&&typeof ze.catch=="function"&&ze.catch(function(){})}}catch(we){if(we&&ye&&typeof we.stack=="string")return[we.stack,ye.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=c.DetermineComponentFrameRoot(),j=g[0],M=g[1];if(j&&M){var Y=j.split(`
`),me=M.split(`
`);for(p=c=0;c<Y.length&&!Y[c].includes("DetermineComponentFrameRoot");)c++;for(;p<me.length&&!me[p].includes("DetermineComponentFrameRoot");)p++;if(c===Y.length||p===me.length)for(c=Y.length-1,p=me.length-1;1<=c&&0<=p&&Y[c]!==me[p];)p--;for(;1<=c&&0<=p;c--,p--)if(Y[c]!==me[p]){if(c!==1||p!==1)do if(c--,p--,0>p||Y[c]!==me[p]){var Te=`
`+Y[c].replace(" at new "," at ");return e.displayName&&Te.includes("<anonymous>")&&(Te=Te.replace("<anonymous>",e.displayName)),Te}while(1<=c&&0<=p);break}}}finally{He=!1,Error.prepareStackTrace=l}return(l=e?e.displayName||e.name:"")?Oe(l):""}function ot(e,s){switch(e.tag){case 26:case 27:case 5:return Oe(e.type);case 16:return Oe("Lazy");case 13:return e.child!==s&&s!==null?Oe("Suspense Fallback"):Oe("Suspense");case 19:return Oe("SuspenseList");case 0:case 15:return nt(e.type,!1);case 11:return nt(e.type.render,!1);case 1:return nt(e.type,!0);case 31:return Oe("Activity");default:return""}}function Fe(e){try{var s="",l=null;do s+=ot(e,l),l=e,e=e.return;while(e);return s}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var Ce=Object.prototype.hasOwnProperty,Ee=n.unstable_scheduleCallback,se=n.unstable_cancelCallback,Pe=n.unstable_shouldYield,dt=n.unstable_requestPaint,gt=n.unstable_now,ct=n.unstable_getCurrentPriorityLevel,Qe=n.unstable_ImmediatePriority,it=n.unstable_UserBlockingPriority,tt=n.unstable_NormalPriority,ut=n.unstable_LowPriority,qt=n.unstable_IdlePriority,$t=n.log,an=n.unstable_setDisableYieldValue,Ht=null,rn=null;function sn(e){if(typeof $t=="function"&&an(e),rn&&typeof rn.setStrictMode=="function")try{rn.setStrictMode(Ht,e)}catch{}}var Kt=Math.clz32?Math.clz32:ee,In=Math.log,mn=Math.LN2;function ee(e){return e>>>=0,e===0?32:31-(In(e)/mn|0)|0}var De=256,ke=262144,Ie=4194304;function Ve(e){var s=e&42;if(s!==0)return s;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function lt(e,s,l){var c=e.pendingLanes;if(c===0)return 0;var p=0,g=e.suspendedLanes,j=e.pingedLanes;e=e.warmLanes;var M=c&134217727;return M!==0?(c=M&~g,c!==0?p=Ve(c):(j&=M,j!==0?p=Ve(j):l||(l=M&~e,l!==0&&(p=Ve(l))))):(M=c&~g,M!==0?p=Ve(M):j!==0?p=Ve(j):l||(l=c&~e,l!==0&&(p=Ve(l)))),p===0?0:s!==0&&s!==p&&(s&g)===0&&(g=p&-p,l=s&-s,g>=l||g===32&&(l&4194048)!==0)?s:p}function bt(e,s){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&s)===0}function Lt(e,s){switch(e){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pt(){var e=Ie;return Ie<<=1,(Ie&62914560)===0&&(Ie=4194304),e}function hn(e){for(var s=[],l=0;31>l;l++)s.push(e);return s}function he(e,s){e.pendingLanes|=s,s!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ye(e,s,l,c,p,g){var j=e.pendingLanes;e.pendingLanes=l,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=l,e.entangledLanes&=l,e.errorRecoveryDisabledLanes&=l,e.shellSuspendCounter=0;var M=e.entanglements,Y=e.expirationTimes,me=e.hiddenUpdates;for(l=j&~l;0<l;){var Te=31-Kt(l),ze=1<<Te;M[Te]=0,Y[Te]=-1;var ye=me[Te];if(ye!==null)for(me[Te]=null,Te=0;Te<ye.length;Te++){var we=ye[Te];we!==null&&(we.lane&=-536870913)}l&=~ze}c!==0&&ht(e,c,0),g!==0&&p===0&&e.tag!==0&&(e.suspendedLanes|=g&~(j&~s))}function ht(e,s,l){e.pendingLanes|=s,e.suspendedLanes&=~s;var c=31-Kt(s);e.entangledLanes|=s,e.entanglements[c]=e.entanglements[c]|1073741824|l&261930}function We(e,s){var l=e.entangledLanes|=s;for(e=e.entanglements;l;){var c=31-Kt(l),p=1<<c;p&s|e[c]&s&&(e[c]|=s),l&=~p}}function At(e,s){var l=s&-s;return l=(l&42)!==0?1:jt(l),(l&(e.suspendedLanes|s))!==0?0:l}function jt(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Dt(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function Vt(){var e=L.p;return e!==0?e:(e=window.event,e===void 0?32:Ev(e.type))}function pt(e,s){var l=L.p;try{return L.p=e,s()}finally{L.p=l}}var te=Math.random().toString(36).slice(2),$e="__reactFiber$"+te,Ge="__reactProps$"+te,Et="__reactContainer$"+te,J="__reactEvents$"+te,Z="__reactListeners$"+te,oe="__reactHandles$"+te,fe="__reactResources$"+te,Le="__reactMarker$"+te;function qe(e){delete e[$e],delete e[Ge],delete e[J],delete e[Z],delete e[oe]}function Ze(e){var s=e[$e];if(s)return s;for(var l=e.parentNode;l;){if(s=l[Et]||l[$e]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(e=dv(e);e!==null;){if(l=e[$e])return l;e=dv(e)}return s}e=l,l=e.parentNode}return null}function Xe(e){if(e=e[$e]||e[Et]){var s=e.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return e}return null}function Ct(e){var s=e.tag;if(s===5||s===26||s===27||s===6)return e.stateNode;throw Error(a(33))}function Nt(e){var s=e[fe];return s||(s=e[fe]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function It(e){e[Le]=!0}var rt=new Set,kt={};function Xt(e,s){dn(e,s),dn(e+"Capture",s)}function dn(e,s){for(kt[e]=s,e=0;e<s.length;e++)rt.add(s[e])}var Wn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sr={},Jr={};function Mr(e){return Ce.call(Jr,e)?!0:Ce.call(Sr,e)?!1:Wn.test(e)?Jr[e]=!0:(Sr[e]=!0,!1)}function Ii(e,s,l){if(Mr(s))if(l===null)e.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":e.removeAttribute(s);return;case"boolean":var c=s.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){e.removeAttribute(s);return}}e.setAttribute(s,""+l)}}function Ws(e,s,l){if(l===null)e.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttribute(s,""+l)}}function Xr(e,s,l,c){if(c===null)e.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(l);return}e.setAttributeNS(s,l,""+c)}}function or(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Bi(e){var s=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Sa(e,s,l){var c=Object.getOwnPropertyDescriptor(e.constructor.prototype,s);if(!e.hasOwnProperty(s)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,g=c.set;return Object.defineProperty(e,s,{configurable:!0,get:function(){return p.call(this)},set:function(j){l=""+j,g.call(this,j)}}),Object.defineProperty(e,s,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(j){l=""+j},stopTracking:function(){e._valueTracker=null,delete e[s]}}}}function ja(e){if(!e._valueTracker){var s=Bi(e)?"checked":"value";e._valueTracker=Sa(e,s,""+e[s])}}function fc(e){if(!e)return!1;var s=e._valueTracker;if(!s)return!0;var l=s.getValue(),c="";return e&&(c=Bi(e)?e.checked?"true":"false":e.value),e=c,e!==l?(s.setValue(e),!0):!1}function _a(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Sd=/[\n"\\]/g;function pr(e){return e.replace(Sd,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function $i(e,s,l,c,p,g,j,M){e.name="",j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?e.type=j:e.removeAttribute("type"),s!=null?j==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+or(s)):e.value!==""+or(s)&&(e.value=""+or(s)):j!=="submit"&&j!=="reset"||e.removeAttribute("value"),s!=null?Ol(e,j,or(s)):l!=null?Ol(e,j,or(l)):c!=null&&e.removeAttribute("value"),p==null&&g!=null&&(e.defaultChecked=!!g),p!=null&&(e.checked=p&&typeof p!="function"&&typeof p!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?e.name=""+or(M):e.removeAttribute("name")}function pc(e,s,l,c,p,g,j,M){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(e.type=g),s!=null||l!=null){if(!(g!=="submit"&&g!=="reset"||s!=null)){ja(e);return}l=l!=null?""+or(l):"",s=s!=null?""+or(s):l,M||s===e.value||(e.value=s),e.defaultValue=s}c=c??p,c=typeof c!="function"&&typeof c!="symbol"&&!!c,e.checked=M?e.checked:!!c,e.defaultChecked=!!c,j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(e.name=j),ja(e)}function Ol(e,s,l){s==="number"&&_a(e.ownerDocument)===e||e.defaultValue===""+l||(e.defaultValue=""+l)}function zr(e,s,l,c){if(e=e.options,s){s={};for(var p=0;p<l.length;p++)s["$"+l[p]]=!0;for(l=0;l<e.length;l++)p=s.hasOwnProperty("$"+e[l].value),e[l].selected!==p&&(e[l].selected=p),p&&c&&(e[l].defaultSelected=!0)}else{for(l=""+or(l),s=null,p=0;p<e.length;p++){if(e[p].value===l){e[p].selected=!0,c&&(e[p].defaultSelected=!0);return}s!==null||e[p].disabled||(s=e[p])}s!==null&&(s.selected=!0)}}function mc(e,s,l){if(s!=null&&(s=""+or(s),s!==e.value&&(e.value=s),l==null)){e.defaultValue!==s&&(e.defaultValue=s);return}e.defaultValue=l!=null?""+or(l):""}function gc(e,s,l,c){if(s==null){if(c!=null){if(l!=null)throw Error(a(92));if(I(c)){if(1<c.length)throw Error(a(93));c=c[0]}l=c}l==null&&(l=""),s=l}l=or(s),e.defaultValue=l,c=e.textContent,c===l&&c!==""&&c!==null&&(e.value=c),ja(e)}function Qs(e,s){if(s){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=s;return}}e.textContent=s}var jd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Dl(e,s,l){var c=s.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?e.setProperty(s,""):s==="float"?e.cssFloat="":e[s]="":c?e.setProperty(s,l):typeof l!="number"||l===0||jd.has(s)?s==="float"?e.cssFloat=l:e[s]=(""+l).trim():e[s]=l+"px"}function Ml(e,s,l){if(s!=null&&typeof s!="object")throw Error(a(62));if(e=e.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||s!=null&&s.hasOwnProperty(c)||(c.indexOf("--")===0?e.setProperty(c,""):c==="float"?e.cssFloat="":e[c]="");for(var p in s)c=s[p],s.hasOwnProperty(p)&&l[p]!==c&&Dl(e,p,c)}else for(var g in s)s.hasOwnProperty(g)&&Dl(e,g,s[g])}function zl(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _d=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),yc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ca(e){return yc.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Lr(){}var Ll=null;function Ul(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Js=null,Xs=null;function Il(e){var s=Xe(e);if(s&&(e=s.stateNode)){var l=e[Ge]||null;e:switch(e=s.stateNode,s.type){case"input":if($i(e,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),s=l.name,l.type==="radio"&&s!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+pr(""+s)+'"][type="radio"]'),s=0;s<l.length;s++){var c=l[s];if(c!==e&&c.form===e.form){var p=c[Ge]||null;if(!p)throw Error(a(90));$i(c,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(s=0;s<l.length;s++)c=l[s],c.form===e.form&&fc(c)}break e;case"textarea":mc(e,l.value,l.defaultValue);break e;case"select":s=l.value,s!=null&&zr(e,!!l.multiple,s,!1)}}}var Bl=!1;function Pi(e,s,l){if(Bl)return e(s,l);Bl=!0;try{var c=e(s);return c}finally{if(Bl=!1,(Js!==null||Xs!==null)&&(Zc(),Js&&(s=Js,e=Xs,Xs=Js=null,Il(s),e)))for(s=0;s<e.length;s++)Il(e[s])}}function Zs(e,s){var l=e.stateNode;if(l===null)return null;var c=l[Ge]||null;if(c===null)return null;l=c[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(a(231,s,typeof l));return l}var Zr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),B=!1;if(Zr)try{var X={};Object.defineProperty(X,"passive",{get:function(){B=!0}}),window.addEventListener("test",X,X),window.removeEventListener("test",X,X)}catch{B=!1}var ne=null,be=null,Ue=null;function Be(){if(Ue)return Ue;var e,s=be,l=s.length,c,p="value"in ne?ne.value:ne.textContent,g=p.length;for(e=0;e<l&&s[e]===p[e];e++);var j=l-e;for(c=1;c<=j&&s[l-c]===p[g-c];c++);return Ue=p.slice(e,1<c?1-c:void 0)}function Ke(e){var s=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&s===13&&(e=13)):e=s,e===10&&(e=13),32<=e||e===13?e:0}function Je(){return!0}function et(){return!1}function at(e){function s(l,c,p,g,j){this._reactName=l,this._targetInst=p,this.type=c,this.nativeEvent=g,this.target=j,this.currentTarget=null;for(var M in e)e.hasOwnProperty(M)&&(l=e[M],this[M]=l?l(g):g[M]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?Je:et,this.isPropagationStopped=et,this}return v(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Je)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Je)},persist:function(){},isPersistent:Je}),s}var mt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xt=at(mt),st=v({},mt,{view:0,detail:0}),Ut=at(st),Nn,En,Ur,es=v({},st,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ti,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ur&&(Ur&&e.type==="mousemove"?(Nn=e.screenX-Ur.screenX,En=e.screenY-Ur.screenY):En=Nn=0,Ur=e),Nn)},movementY:function(e){return"movementY"in e?e.movementY:En}}),vt=at(es),_t=v({},es,{dataTransfer:0}),zt=at(_t),wn=v({},st,{relatedTarget:0}),Tn=at(wn),Bn=v({},mt,{animationName:0,elapsedTime:0,pseudoElement:0}),Yt=at(Bn),er=v({},mt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),An=at(er),ws=v({},mt,{data:0}),ts=at(ws),ei={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$l={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ss(e){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(e):(e=lm[e])?!!s[e]:!1}function ti(){return Ss}var qi=v({},st,{key:function(e){if(e.key){var s=ei[e.key]||e.key;if(s!=="Unidentified")return s}return e.type==="keypress"?(e=Ke(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?$l[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ti,charCode:function(e){return e.type==="keypress"?Ke(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Ke(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),aw=at(qi),lw=v({},es,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),om=at(lw),ow=v({},st,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ti}),cw=at(ow),uw=v({},mt,{propertyName:0,elapsedTime:0,pseudoElement:0}),dw=at(uw),hw=v({},es,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),fw=at(hw),pw=v({},mt,{newState:0,oldState:0}),mw=at(pw),gw=[9,13,27,32],Cd=Zr&&"CompositionEvent"in window,Pl=null;Zr&&"documentMode"in document&&(Pl=document.documentMode);var yw=Zr&&"TextEvent"in window&&!Pl,cm=Zr&&(!Cd||Pl&&8<Pl&&11>=Pl),um=" ",dm=!1;function hm(e,s){switch(e){case"keyup":return gw.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Na=!1;function vw(e,s){switch(e){case"compositionend":return fm(s);case"keypress":return s.which!==32?null:(dm=!0,um);case"textInput":return e=s.data,e===um&&dm?null:e;default:return null}}function xw(e,s){if(Na)return e==="compositionend"||!Cd&&hm(e,s)?(e=Be(),Ue=be=ne=null,Na=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return cm&&s.locale!=="ko"?null:s.data;default:return null}}var bw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pm(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s==="input"?!!bw[e.type]:s==="textarea"}function mm(e,s,l,c){Js?Xs?Xs.push(c):Xs=[c]:Js=c,s=au(s,"onChange"),0<s.length&&(l=new xt("onChange","change",null,l,c),e.push({event:l,listeners:s}))}var ql=null,Fl=null;function ww(e){Jy(e,0)}function vc(e){var s=Ct(e);if(fc(s))return e}function gm(e,s){if(e==="change")return s}var ym=!1;if(Zr){var Nd;if(Zr){var Ed="oninput"in document;if(!Ed){var vm=document.createElement("div");vm.setAttribute("oninput","return;"),Ed=typeof vm.oninput=="function"}Nd=Ed}else Nd=!1;ym=Nd&&(!document.documentMode||9<document.documentMode)}function xm(){ql&&(ql.detachEvent("onpropertychange",bm),Fl=ql=null)}function bm(e){if(e.propertyName==="value"&&vc(Fl)){var s=[];mm(s,Fl,e,Ul(e)),Pi(ww,s)}}function Sw(e,s,l){e==="focusin"?(xm(),ql=s,Fl=l,ql.attachEvent("onpropertychange",bm)):e==="focusout"&&xm()}function jw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return vc(Fl)}function _w(e,s){if(e==="click")return vc(s)}function Cw(e,s){if(e==="input"||e==="change")return vc(s)}function Nw(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var jr=typeof Object.is=="function"?Object.is:Nw;function Hl(e,s){if(jr(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;var l=Object.keys(e),c=Object.keys(s);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var p=l[c];if(!Ce.call(s,p)||!jr(e[p],s[p]))return!1}return!0}function wm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Sm(e,s){var l=wm(e);e=0;for(var c;l;){if(l.nodeType===3){if(c=e+l.textContent.length,e<=s&&c>=s)return{node:l,offset:s-e};e=c}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=wm(l)}}function jm(e,s){return e&&s?e===s?!0:e&&e.nodeType===3?!1:s&&s.nodeType===3?jm(e,s.parentNode):"contains"in e?e.contains(s):e.compareDocumentPosition?!!(e.compareDocumentPosition(s)&16):!1:!1}function _m(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var s=_a(e.document);s instanceof e.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)e=s.contentWindow;else break;s=_a(e.document)}return s}function kd(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s&&(s==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||s==="textarea"||e.contentEditable==="true")}var Ew=Zr&&"documentMode"in document&&11>=document.documentMode,Ea=null,Td=null,Vl=null,Ad=!1;function Cm(e,s,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Ad||Ea==null||Ea!==_a(c)||(c=Ea,"selectionStart"in c&&kd(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Vl&&Hl(Vl,c)||(Vl=c,c=au(Td,"onSelect"),0<c.length&&(s=new xt("onSelect","select",null,s,l),e.push({event:s,listeners:c}),s.target=Ea)))}function Fi(e,s){var l={};return l[e.toLowerCase()]=s.toLowerCase(),l["Webkit"+e]="webkit"+s,l["Moz"+e]="moz"+s,l}var ka={animationend:Fi("Animation","AnimationEnd"),animationiteration:Fi("Animation","AnimationIteration"),animationstart:Fi("Animation","AnimationStart"),transitionrun:Fi("Transition","TransitionRun"),transitionstart:Fi("Transition","TransitionStart"),transitioncancel:Fi("Transition","TransitionCancel"),transitionend:Fi("Transition","TransitionEnd")},Rd={},Nm={};Zr&&(Nm=document.createElement("div").style,"AnimationEvent"in window||(delete ka.animationend.animation,delete ka.animationiteration.animation,delete ka.animationstart.animation),"TransitionEvent"in window||delete ka.transitionend.transition);function Hi(e){if(Rd[e])return Rd[e];if(!ka[e])return e;var s=ka[e],l;for(l in s)if(s.hasOwnProperty(l)&&l in Nm)return Rd[e]=s[l];return e}var Em=Hi("animationend"),km=Hi("animationiteration"),Tm=Hi("animationstart"),kw=Hi("transitionrun"),Tw=Hi("transitionstart"),Aw=Hi("transitioncancel"),Am=Hi("transitionend"),Rm=new Map,Od="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Od.push("scrollEnd");function ns(e,s){Rm.set(e,s),Xt(s,[e])}var xc=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},Ir=[],Ta=0,Dd=0;function bc(){for(var e=Ta,s=Dd=Ta=0;s<e;){var l=Ir[s];Ir[s++]=null;var c=Ir[s];Ir[s++]=null;var p=Ir[s];Ir[s++]=null;var g=Ir[s];if(Ir[s++]=null,c!==null&&p!==null){var j=c.pending;j===null?p.next=p:(p.next=j.next,j.next=p),c.pending=p}g!==0&&Om(l,p,g)}}function wc(e,s,l,c){Ir[Ta++]=e,Ir[Ta++]=s,Ir[Ta++]=l,Ir[Ta++]=c,Dd|=c,e.lanes|=c,e=e.alternate,e!==null&&(e.lanes|=c)}function Md(e,s,l,c){return wc(e,s,l,c),Sc(e)}function Vi(e,s){return wc(e,null,null,s),Sc(e)}function Om(e,s,l){e.lanes|=l;var c=e.alternate;c!==null&&(c.lanes|=l);for(var p=!1,g=e.return;g!==null;)g.childLanes|=l,c=g.alternate,c!==null&&(c.childLanes|=l),g.tag===22&&(e=g.stateNode,e===null||e._visibility&1||(p=!0)),e=g,g=g.return;return e.tag===3?(g=e.stateNode,p&&s!==null&&(p=31-Kt(l),e=g.hiddenUpdates,c=e[p],c===null?e[p]=[s]:c.push(s),s.lane=l|536870912),g):null}function Sc(e){if(50<po)throw po=0,Fh=null,Error(a(185));for(var s=e.return;s!==null;)e=s,s=e.return;return e.tag===3?e.stateNode:null}var Aa={};function Rw(e,s,l,c){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _r(e,s,l,c){return new Rw(e,s,l,c)}function zd(e){return e=e.prototype,!(!e||!e.isReactComponent)}function js(e,s){var l=e.alternate;return l===null?(l=_r(e.tag,s,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=s,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&65011712,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,s=e.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l.refCleanup=e.refCleanup,l}function Dm(e,s){e.flags&=65011714;var l=e.alternate;return l===null?(e.childLanes=0,e.lanes=s,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=l.childLanes,e.lanes=l.lanes,e.child=l.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=l.memoizedProps,e.memoizedState=l.memoizedState,e.updateQueue=l.updateQueue,e.type=l.type,s=l.dependencies,e.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),e}function jc(e,s,l,c,p,g){var j=0;if(c=e,typeof e=="function")zd(e)&&(j=1);else if(typeof e=="string")j=LS(e,l,ve.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case O:return e=_r(31,l,s,p),e.elementType=O,e.lanes=g,e;case N:return Gi(l.children,p,g,s);case w:j=8,p|=24;break;case C:return e=_r(12,l,s,p|2),e.elementType=C,e.lanes=g,e;case U:return e=_r(13,l,s,p),e.elementType=U,e.lanes=g,e;case E:return e=_r(19,l,s,p),e.elementType=E,e.lanes=g,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case z:j=10;break e;case D:j=9;break e;case T:j=11;break e;case R:j=14;break e;case A:j=16,c=null;break e}j=29,l=Error(a(130,e===null?"null":typeof e,"")),c=null}return s=_r(j,l,s,p),s.elementType=e,s.type=c,s.lanes=g,s}function Gi(e,s,l,c){return e=_r(7,e,c,s),e.lanes=l,e}function Ld(e,s,l){return e=_r(6,e,null,s),e.lanes=l,e}function Mm(e){var s=_r(18,null,null,0);return s.stateNode=e,s}function Ud(e,s,l){return s=_r(4,e.children!==null?e.children:[],e.key,s),s.lanes=l,s.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},s}var zm=new WeakMap;function Br(e,s){if(typeof e=="object"&&e!==null){var l=zm.get(e);return l!==void 0?l:(s={value:e,source:s,stack:Fe(s)},zm.set(e,s),s)}return{value:e,source:s,stack:Fe(s)}}var Ra=[],Oa=0,_c=null,Gl=0,$r=[],Pr=0,ni=null,ps=1,ms="";function _s(e,s){Ra[Oa++]=Gl,Ra[Oa++]=_c,_c=e,Gl=s}function Lm(e,s,l){$r[Pr++]=ps,$r[Pr++]=ms,$r[Pr++]=ni,ni=e;var c=ps;e=ms;var p=32-Kt(c)-1;c&=~(1<<p),l+=1;var g=32-Kt(s)+p;if(30<g){var j=p-p%5;g=(c&(1<<j)-1).toString(32),c>>=j,p-=j,ps=1<<32-Kt(s)+p|l<<p|c,ms=g+e}else ps=1<<g|l<<p|c,ms=e}function Id(e){e.return!==null&&(_s(e,1),Lm(e,1,0))}function Bd(e){for(;e===_c;)_c=Ra[--Oa],Ra[Oa]=null,Gl=Ra[--Oa],Ra[Oa]=null;for(;e===ni;)ni=$r[--Pr],$r[Pr]=null,ms=$r[--Pr],$r[Pr]=null,ps=$r[--Pr],$r[Pr]=null}function Um(e,s){$r[Pr++]=ps,$r[Pr++]=ms,$r[Pr++]=ni,ps=s.id,ms=s.overflow,ni=e}var tr=null,_n=null,tn=!1,ri=null,qr=!1,$d=Error(a(519));function si(e){var s=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Kl(Br(s,e)),$d}function Im(e){var s=e.stateNode,l=e.type,c=e.memoizedProps;switch(s[$e]=e,s[Ge]=c,l){case"dialog":Qt("cancel",s),Qt("close",s);break;case"iframe":case"object":case"embed":Qt("load",s);break;case"video":case"audio":for(l=0;l<go.length;l++)Qt(go[l],s);break;case"source":Qt("error",s);break;case"img":case"image":case"link":Qt("error",s),Qt("load",s);break;case"details":Qt("toggle",s);break;case"input":Qt("invalid",s),pc(s,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Qt("invalid",s);break;case"textarea":Qt("invalid",s),gc(s,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||s.textContent===""+l||c.suppressHydrationWarning===!0||tv(s.textContent,l)?(c.popover!=null&&(Qt("beforetoggle",s),Qt("toggle",s)),c.onScroll!=null&&Qt("scroll",s),c.onScrollEnd!=null&&Qt("scrollend",s),c.onClick!=null&&(s.onclick=Lr),s=!0):s=!1,s||si(e,!0)}function Bm(e){for(tr=e.return;tr;)switch(tr.tag){case 5:case 31:case 13:qr=!1;return;case 27:case 3:qr=!0;return;default:tr=tr.return}}function Da(e){if(e!==tr)return!1;if(!tn)return Bm(e),tn=!0,!1;var s=e.tag,l;if((l=s!==3&&s!==27)&&((l=s===5)&&(l=e.type,l=!(l!=="form"&&l!=="button")||sf(e.type,e.memoizedProps)),l=!l),l&&_n&&si(e),Bm(e),s===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));_n=uv(e)}else if(s===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));_n=uv(e)}else s===27?(s=_n,vi(e.type)?(e=uf,uf=null,_n=e):_n=s):_n=tr?Hr(e.stateNode.nextSibling):null;return!0}function Ki(){_n=tr=null,tn=!1}function Pd(){var e=ri;return e!==null&&(vr===null?vr=e:vr.push.apply(vr,e),ri=null),e}function Kl(e){ri===null?ri=[e]:ri.push(e)}var qd=q(null),Yi=null,Cs=null;function ii(e,s,l){ie(qd,s._currentValue),s._currentValue=l}function Ns(e){e._currentValue=qd.current,W(qd)}function Fd(e,s,l){for(;e!==null;){var c=e.alternate;if((e.childLanes&s)!==s?(e.childLanes|=s,c!==null&&(c.childLanes|=s)):c!==null&&(c.childLanes&s)!==s&&(c.childLanes|=s),e===l)break;e=e.return}}function Hd(e,s,l,c){var p=e.child;for(p!==null&&(p.return=e);p!==null;){var g=p.dependencies;if(g!==null){var j=p.child;g=g.firstContext;e:for(;g!==null;){var M=g;g=p;for(var Y=0;Y<s.length;Y++)if(M.context===s[Y]){g.lanes|=l,M=g.alternate,M!==null&&(M.lanes|=l),Fd(g.return,l,e),c||(j=null);break e}g=M.next}}else if(p.tag===18){if(j=p.return,j===null)throw Error(a(341));j.lanes|=l,g=j.alternate,g!==null&&(g.lanes|=l),Fd(j,l,e),j=null}else j=p.child;if(j!==null)j.return=p;else for(j=p;j!==null;){if(j===e){j=null;break}if(p=j.sibling,p!==null){p.return=j.return,j=p;break}j=j.return}p=j}}function Ma(e,s,l,c){e=null;for(var p=s,g=!1;p!==null;){if(!g){if((p.flags&524288)!==0)g=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var j=p.alternate;if(j===null)throw Error(a(387));if(j=j.memoizedProps,j!==null){var M=p.type;jr(p.pendingProps.value,j.value)||(e!==null?e.push(M):e=[M])}}else if(p===de.current){if(j=p.alternate,j===null)throw Error(a(387));j.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(e!==null?e.push(wo):e=[wo])}p=p.return}e!==null&&Hd(s,e,l,c),s.flags|=262144}function Cc(e){for(e=e.firstContext;e!==null;){if(!jr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Wi(e){Yi=e,Cs=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function nr(e){return $m(Yi,e)}function Nc(e,s){return Yi===null&&Wi(e),$m(e,s)}function $m(e,s){var l=s._currentValue;if(s={context:s,memoizedValue:l,next:null},Cs===null){if(e===null)throw Error(a(308));Cs=s,e.dependencies={lanes:0,firstContext:s},e.flags|=524288}else Cs=Cs.next=s;return l}var Ow=typeof AbortController<"u"?AbortController:function(){var e=[],s=this.signal={aborted:!1,addEventListener:function(l,c){e.push(c)}};this.abort=function(){s.aborted=!0,e.forEach(function(l){return l()})}},Dw=n.unstable_scheduleCallback,Mw=n.unstable_NormalPriority,$n={$$typeof:z,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Vd(){return{controller:new Ow,data:new Map,refCount:0}}function Yl(e){e.refCount--,e.refCount===0&&Dw(Mw,function(){e.controller.abort()})}var Wl=null,Gd=0,za=0,La=null;function zw(e,s){if(Wl===null){var l=Wl=[];Gd=0,za=Wh(),La={status:"pending",value:void 0,then:function(c){l.push(c)}}}return Gd++,s.then(Pm,Pm),s}function Pm(){if(--Gd===0&&Wl!==null){La!==null&&(La.status="fulfilled");var e=Wl;Wl=null,za=0,La=null;for(var s=0;s<e.length;s++)(0,e[s])()}}function Lw(e,s){var l=[],c={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return e.then(function(){c.status="fulfilled",c.value=s;for(var p=0;p<l.length;p++)(0,l[p])(s)},function(p){for(c.status="rejected",c.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),c}var qm=k.S;k.S=function(e,s){Cy=gt(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&zw(e,s),qm!==null&&qm(e,s)};var Qi=q(null);function Kd(){var e=Qi.current;return e!==null?e:xn.pooledCache}function Ec(e,s){s===null?ie(Qi,Qi.current):ie(Qi,s.pool)}function Fm(){var e=Kd();return e===null?null:{parent:$n._currentValue,pool:e}}var Ua=Error(a(460)),Yd=Error(a(474)),kc=Error(a(542)),Tc={then:function(){}};function Hm(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Vm(e,s,l){switch(l=e[l],l===void 0?e.push(s):l!==s&&(s.then(Lr,Lr),s=l),s.status){case"fulfilled":return s.value;case"rejected":throw e=s.reason,Km(e),e;default:if(typeof s.status=="string")s.then(Lr,Lr);else{if(e=xn,e!==null&&100<e.shellSuspendCounter)throw Error(a(482));e=s,e.status="pending",e.then(function(c){if(s.status==="pending"){var p=s;p.status="fulfilled",p.value=c}},function(c){if(s.status==="pending"){var p=s;p.status="rejected",p.reason=c}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw e=s.reason,Km(e),e}throw Xi=s,Ua}}function Ji(e){try{var s=e._init;return s(e._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Xi=l,Ua):l}}var Xi=null;function Gm(){if(Xi===null)throw Error(a(459));var e=Xi;return Xi=null,e}function Km(e){if(e===Ua||e===kc)throw Error(a(483))}var Ia=null,Ql=0;function Ac(e){var s=Ql;return Ql+=1,Ia===null&&(Ia=[]),Vm(Ia,e,s)}function Jl(e,s){s=s.props.ref,e.ref=s!==void 0?s:null}function Rc(e,s){throw s.$$typeof===x?Error(a(525)):(e=Object.prototype.toString.call(s),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)))}function Ym(e){function s(ue,re){if(e){var pe=ue.deletions;pe===null?(ue.deletions=[re],ue.flags|=16):pe.push(re)}}function l(ue,re){if(!e)return null;for(;re!==null;)s(ue,re),re=re.sibling;return null}function c(ue){for(var re=new Map;ue!==null;)ue.key!==null?re.set(ue.key,ue):re.set(ue.index,ue),ue=ue.sibling;return re}function p(ue,re){return ue=js(ue,re),ue.index=0,ue.sibling=null,ue}function g(ue,re,pe){return ue.index=pe,e?(pe=ue.alternate,pe!==null?(pe=pe.index,pe<re?(ue.flags|=67108866,re):pe):(ue.flags|=67108866,re)):(ue.flags|=1048576,re)}function j(ue){return e&&ue.alternate===null&&(ue.flags|=67108866),ue}function M(ue,re,pe,Me){return re===null||re.tag!==6?(re=Ld(pe,ue.mode,Me),re.return=ue,re):(re=p(re,pe),re.return=ue,re)}function Y(ue,re,pe,Me){var St=pe.type;return St===N?Te(ue,re,pe.props.children,Me,pe.key):re!==null&&(re.elementType===St||typeof St=="object"&&St!==null&&St.$$typeof===A&&Ji(St)===re.type)?(re=p(re,pe.props),Jl(re,pe),re.return=ue,re):(re=jc(pe.type,pe.key,pe.props,null,ue.mode,Me),Jl(re,pe),re.return=ue,re)}function me(ue,re,pe,Me){return re===null||re.tag!==4||re.stateNode.containerInfo!==pe.containerInfo||re.stateNode.implementation!==pe.implementation?(re=Ud(pe,ue.mode,Me),re.return=ue,re):(re=p(re,pe.children||[]),re.return=ue,re)}function Te(ue,re,pe,Me,St){return re===null||re.tag!==7?(re=Gi(pe,ue.mode,Me,St),re.return=ue,re):(re=p(re,pe),re.return=ue,re)}function ze(ue,re,pe){if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return re=Ld(""+re,ue.mode,pe),re.return=ue,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case S:return pe=jc(re.type,re.key,re.props,null,ue.mode,pe),Jl(pe,re),pe.return=ue,pe;case _:return re=Ud(re,ue.mode,pe),re.return=ue,re;case A:return re=Ji(re),ze(ue,re,pe)}if(I(re)||F(re))return re=Gi(re,ue.mode,pe,null),re.return=ue,re;if(typeof re.then=="function")return ze(ue,Ac(re),pe);if(re.$$typeof===z)return ze(ue,Nc(ue,re),pe);Rc(ue,re)}return null}function ye(ue,re,pe,Me){var St=re!==null?re.key:null;if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return St!==null?null:M(ue,re,""+pe,Me);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case S:return pe.key===St?Y(ue,re,pe,Me):null;case _:return pe.key===St?me(ue,re,pe,Me):null;case A:return pe=Ji(pe),ye(ue,re,pe,Me)}if(I(pe)||F(pe))return St!==null?null:Te(ue,re,pe,Me,null);if(typeof pe.then=="function")return ye(ue,re,Ac(pe),Me);if(pe.$$typeof===z)return ye(ue,re,Nc(ue,pe),Me);Rc(ue,pe)}return null}function we(ue,re,pe,Me,St){if(typeof Me=="string"&&Me!==""||typeof Me=="number"||typeof Me=="bigint")return ue=ue.get(pe)||null,M(re,ue,""+Me,St);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case S:return ue=ue.get(Me.key===null?pe:Me.key)||null,Y(re,ue,Me,St);case _:return ue=ue.get(Me.key===null?pe:Me.key)||null,me(re,ue,Me,St);case A:return Me=Ji(Me),we(ue,re,pe,Me,St)}if(I(Me)||F(Me))return ue=ue.get(pe)||null,Te(re,ue,Me,St,null);if(typeof Me.then=="function")return we(ue,re,pe,Ac(Me),St);if(Me.$$typeof===z)return we(ue,re,pe,Nc(re,Me),St);Rc(re,Me)}return null}function ft(ue,re,pe,Me){for(var St=null,ln=null,yt=re,Gt=re=0,en=null;yt!==null&&Gt<pe.length;Gt++){yt.index>Gt?(en=yt,yt=null):en=yt.sibling;var on=ye(ue,yt,pe[Gt],Me);if(on===null){yt===null&&(yt=en);break}e&&yt&&on.alternate===null&&s(ue,yt),re=g(on,re,Gt),ln===null?St=on:ln.sibling=on,ln=on,yt=en}if(Gt===pe.length)return l(ue,yt),tn&&_s(ue,Gt),St;if(yt===null){for(;Gt<pe.length;Gt++)yt=ze(ue,pe[Gt],Me),yt!==null&&(re=g(yt,re,Gt),ln===null?St=yt:ln.sibling=yt,ln=yt);return tn&&_s(ue,Gt),St}for(yt=c(yt);Gt<pe.length;Gt++)en=we(yt,ue,Gt,pe[Gt],Me),en!==null&&(e&&en.alternate!==null&&yt.delete(en.key===null?Gt:en.key),re=g(en,re,Gt),ln===null?St=en:ln.sibling=en,ln=en);return e&&yt.forEach(function(ji){return s(ue,ji)}),tn&&_s(ue,Gt),St}function Tt(ue,re,pe,Me){if(pe==null)throw Error(a(151));for(var St=null,ln=null,yt=re,Gt=re=0,en=null,on=pe.next();yt!==null&&!on.done;Gt++,on=pe.next()){yt.index>Gt?(en=yt,yt=null):en=yt.sibling;var ji=ye(ue,yt,on.value,Me);if(ji===null){yt===null&&(yt=en);break}e&&yt&&ji.alternate===null&&s(ue,yt),re=g(ji,re,Gt),ln===null?St=ji:ln.sibling=ji,ln=ji,yt=en}if(on.done)return l(ue,yt),tn&&_s(ue,Gt),St;if(yt===null){for(;!on.done;Gt++,on=pe.next())on=ze(ue,on.value,Me),on!==null&&(re=g(on,re,Gt),ln===null?St=on:ln.sibling=on,ln=on);return tn&&_s(ue,Gt),St}for(yt=c(yt);!on.done;Gt++,on=pe.next())on=we(yt,ue,Gt,on.value,Me),on!==null&&(e&&on.alternate!==null&&yt.delete(on.key===null?Gt:on.key),re=g(on,re,Gt),ln===null?St=on:ln.sibling=on,ln=on);return e&&yt.forEach(function(KS){return s(ue,KS)}),tn&&_s(ue,Gt),St}function vn(ue,re,pe,Me){if(typeof pe=="object"&&pe!==null&&pe.type===N&&pe.key===null&&(pe=pe.props.children),typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case S:e:{for(var St=pe.key;re!==null;){if(re.key===St){if(St=pe.type,St===N){if(re.tag===7){l(ue,re.sibling),Me=p(re,pe.props.children),Me.return=ue,ue=Me;break e}}else if(re.elementType===St||typeof St=="object"&&St!==null&&St.$$typeof===A&&Ji(St)===re.type){l(ue,re.sibling),Me=p(re,pe.props),Jl(Me,pe),Me.return=ue,ue=Me;break e}l(ue,re);break}else s(ue,re);re=re.sibling}pe.type===N?(Me=Gi(pe.props.children,ue.mode,Me,pe.key),Me.return=ue,ue=Me):(Me=jc(pe.type,pe.key,pe.props,null,ue.mode,Me),Jl(Me,pe),Me.return=ue,ue=Me)}return j(ue);case _:e:{for(St=pe.key;re!==null;){if(re.key===St)if(re.tag===4&&re.stateNode.containerInfo===pe.containerInfo&&re.stateNode.implementation===pe.implementation){l(ue,re.sibling),Me=p(re,pe.children||[]),Me.return=ue,ue=Me;break e}else{l(ue,re);break}else s(ue,re);re=re.sibling}Me=Ud(pe,ue.mode,Me),Me.return=ue,ue=Me}return j(ue);case A:return pe=Ji(pe),vn(ue,re,pe,Me)}if(I(pe))return ft(ue,re,pe,Me);if(F(pe)){if(St=F(pe),typeof St!="function")throw Error(a(150));return pe=St.call(pe),Tt(ue,re,pe,Me)}if(typeof pe.then=="function")return vn(ue,re,Ac(pe),Me);if(pe.$$typeof===z)return vn(ue,re,Nc(ue,pe),Me);Rc(ue,pe)}return typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint"?(pe=""+pe,re!==null&&re.tag===6?(l(ue,re.sibling),Me=p(re,pe),Me.return=ue,ue=Me):(l(ue,re),Me=Ld(pe,ue.mode,Me),Me.return=ue,ue=Me),j(ue)):l(ue,re)}return function(ue,re,pe,Me){try{Ql=0;var St=vn(ue,re,pe,Me);return Ia=null,St}catch(yt){if(yt===Ua||yt===kc)throw yt;var ln=_r(29,yt,null,ue.mode);return ln.lanes=Me,ln.return=ue,ln}}}var Zi=Ym(!0),Wm=Ym(!1),ai=!1;function Wd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Qd(e,s){e=e.updateQueue,s.updateQueue===e&&(s.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function li(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function oi(e,s,l){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(cn&2)!==0){var p=c.pending;return p===null?s.next=s:(s.next=p.next,p.next=s),c.pending=s,s=Sc(e),Om(e,null,l),s}return wc(e,c,s,l),Sc(e)}function Xl(e,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194048)!==0)){var c=s.lanes;c&=e.pendingLanes,l|=c,s.lanes=l,We(e,l)}}function Jd(e,s){var l=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var p=null,g=null;if(l=l.firstBaseUpdate,l!==null){do{var j={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};g===null?p=g=j:g=g.next=j,l=l.next}while(l!==null);g===null?p=g=s:g=g.next=s}else p=g=s;l={baseState:c.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:c.shared,callbacks:c.callbacks},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=s:e.next=s,l.lastBaseUpdate=s}var Xd=!1;function Zl(){if(Xd){var e=La;if(e!==null)throw e}}function eo(e,s,l,c){Xd=!1;var p=e.updateQueue;ai=!1;var g=p.firstBaseUpdate,j=p.lastBaseUpdate,M=p.shared.pending;if(M!==null){p.shared.pending=null;var Y=M,me=Y.next;Y.next=null,j===null?g=me:j.next=me,j=Y;var Te=e.alternate;Te!==null&&(Te=Te.updateQueue,M=Te.lastBaseUpdate,M!==j&&(M===null?Te.firstBaseUpdate=me:M.next=me,Te.lastBaseUpdate=Y))}if(g!==null){var ze=p.baseState;j=0,Te=me=Y=null,M=g;do{var ye=M.lane&-536870913,we=ye!==M.lane;if(we?(Zt&ye)===ye:(c&ye)===ye){ye!==0&&ye===za&&(Xd=!0),Te!==null&&(Te=Te.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var ft=e,Tt=M;ye=s;var vn=l;switch(Tt.tag){case 1:if(ft=Tt.payload,typeof ft=="function"){ze=ft.call(vn,ze,ye);break e}ze=ft;break e;case 3:ft.flags=ft.flags&-65537|128;case 0:if(ft=Tt.payload,ye=typeof ft=="function"?ft.call(vn,ze,ye):ft,ye==null)break e;ze=v({},ze,ye);break e;case 2:ai=!0}}ye=M.callback,ye!==null&&(e.flags|=64,we&&(e.flags|=8192),we=p.callbacks,we===null?p.callbacks=[ye]:we.push(ye))}else we={lane:ye,tag:M.tag,payload:M.payload,callback:M.callback,next:null},Te===null?(me=Te=we,Y=ze):Te=Te.next=we,j|=ye;if(M=M.next,M===null){if(M=p.shared.pending,M===null)break;we=M,M=we.next,we.next=null,p.lastBaseUpdate=we,p.shared.pending=null}}while(!0);Te===null&&(Y=ze),p.baseState=Y,p.firstBaseUpdate=me,p.lastBaseUpdate=Te,g===null&&(p.shared.lanes=0),fi|=j,e.lanes=j,e.memoizedState=ze}}function Qm(e,s){if(typeof e!="function")throw Error(a(191,e));e.call(s)}function Jm(e,s){var l=e.callbacks;if(l!==null)for(e.callbacks=null,e=0;e<l.length;e++)Qm(l[e],s)}var Ba=q(null),Oc=q(0);function Xm(e,s){e=zs,ie(Oc,e),ie(Ba,s),zs=e|s.baseLanes}function Zd(){ie(Oc,zs),ie(Ba,Ba.current)}function eh(){zs=Oc.current,W(Ba),W(Oc)}var Cr=q(null),Fr=null;function ci(e){var s=e.alternate;ie(zn,zn.current&1),ie(Cr,e),Fr===null&&(s===null||Ba.current!==null||s.memoizedState!==null)&&(Fr=e)}function th(e){ie(zn,zn.current),ie(Cr,e),Fr===null&&(Fr=e)}function Zm(e){e.tag===22?(ie(zn,zn.current),ie(Cr,e),Fr===null&&(Fr=e)):ui()}function ui(){ie(zn,zn.current),ie(Cr,Cr.current)}function Nr(e){W(Cr),Fr===e&&(Fr=null),W(zn)}var zn=q(0);function Dc(e){for(var s=e;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||of(l)||cf(l)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Es=0,Ft=null,gn=null,Pn=null,Mc=!1,$a=!1,ea=!1,zc=0,to=0,Pa=null,Uw=0;function On(){throw Error(a(321))}function nh(e,s){if(s===null)return!1;for(var l=0;l<s.length&&l<e.length;l++)if(!jr(e[l],s[l]))return!1;return!0}function rh(e,s,l,c,p,g){return Es=g,Ft=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,k.H=e===null||e.memoizedState===null?Lg:vh,ea=!1,g=l(c,p),ea=!1,$a&&(g=tg(s,l,c,p)),eg(e),g}function eg(e){k.H=so;var s=gn!==null&&gn.next!==null;if(Es=0,Pn=gn=Ft=null,Mc=!1,to=0,Pa=null,s)throw Error(a(300));e===null||qn||(e=e.dependencies,e!==null&&Cc(e)&&(qn=!0))}function tg(e,s,l,c){Ft=e;var p=0;do{if($a&&(Pa=null),to=0,$a=!1,25<=p)throw Error(a(301));if(p+=1,Pn=gn=null,e.updateQueue!=null){var g=e.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}k.H=Ug,g=s(l,c)}while($a);return g}function Iw(){var e=k.H,s=e.useState()[0];return s=typeof s.then=="function"?no(s):s,e=e.useState()[0],(gn!==null?gn.memoizedState:null)!==e&&(Ft.flags|=1024),s}function sh(){var e=zc!==0;return zc=0,e}function ih(e,s,l){s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~l}function ah(e){if(Mc){for(e=e.memoizedState;e!==null;){var s=e.queue;s!==null&&(s.pending=null),e=e.next}Mc=!1}Es=0,Pn=gn=Ft=null,$a=!1,to=zc=0,Pa=null}function hr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pn===null?Ft.memoizedState=Pn=e:Pn=Pn.next=e,Pn}function Ln(){if(gn===null){var e=Ft.alternate;e=e!==null?e.memoizedState:null}else e=gn.next;var s=Pn===null?Ft.memoizedState:Pn.next;if(s!==null)Pn=s,gn=e;else{if(e===null)throw Ft.alternate===null?Error(a(467)):Error(a(310));gn=e,e={memoizedState:gn.memoizedState,baseState:gn.baseState,baseQueue:gn.baseQueue,queue:gn.queue,next:null},Pn===null?Ft.memoizedState=Pn=e:Pn=Pn.next=e}return Pn}function Lc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function no(e){var s=to;return to+=1,Pa===null&&(Pa=[]),e=Vm(Pa,e,s),s=Ft,(Pn===null?s.memoizedState:Pn.next)===null&&(s=s.alternate,k.H=s===null||s.memoizedState===null?Lg:vh),e}function Uc(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return no(e);if(e.$$typeof===z)return nr(e)}throw Error(a(438,String(e)))}function lh(e){var s=null,l=Ft.updateQueue;if(l!==null&&(s=l.memoCache),s==null){var c=Ft.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(s={data:c.data.map(function(p){return p.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),l===null&&(l=Lc(),Ft.updateQueue=l),l.memoCache=s,l=s.data[s.index],l===void 0)for(l=s.data[s.index]=Array(e),c=0;c<e;c++)l[c]=V;return s.index++,l}function ks(e,s){return typeof s=="function"?s(e):s}function Ic(e){var s=Ln();return oh(s,gn,e)}function oh(e,s,l){var c=e.queue;if(c===null)throw Error(a(311));c.lastRenderedReducer=l;var p=e.baseQueue,g=c.pending;if(g!==null){if(p!==null){var j=p.next;p.next=g.next,g.next=j}s.baseQueue=p=g,c.pending=null}if(g=e.baseState,p===null)e.memoizedState=g;else{s=p.next;var M=j=null,Y=null,me=s,Te=!1;do{var ze=me.lane&-536870913;if(ze!==me.lane?(Zt&ze)===ze:(Es&ze)===ze){var ye=me.revertLane;if(ye===0)Y!==null&&(Y=Y.next={lane:0,revertLane:0,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null}),ze===za&&(Te=!0);else if((Es&ye)===ye){me=me.next,ye===za&&(Te=!0);continue}else ze={lane:0,revertLane:me.revertLane,gesture:null,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},Y===null?(M=Y=ze,j=g):Y=Y.next=ze,Ft.lanes|=ye,fi|=ye;ze=me.action,ea&&l(g,ze),g=me.hasEagerState?me.eagerState:l(g,ze)}else ye={lane:ze,revertLane:me.revertLane,gesture:me.gesture,action:me.action,hasEagerState:me.hasEagerState,eagerState:me.eagerState,next:null},Y===null?(M=Y=ye,j=g):Y=Y.next=ye,Ft.lanes|=ze,fi|=ze;me=me.next}while(me!==null&&me!==s);if(Y===null?j=g:Y.next=M,!jr(g,e.memoizedState)&&(qn=!0,Te&&(l=La,l!==null)))throw l;e.memoizedState=g,e.baseState=j,e.baseQueue=Y,c.lastRenderedState=g}return p===null&&(c.lanes=0),[e.memoizedState,c.dispatch]}function ch(e){var s=Ln(),l=s.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=e;var c=l.dispatch,p=l.pending,g=s.memoizedState;if(p!==null){l.pending=null;var j=p=p.next;do g=e(g,j.action),j=j.next;while(j!==p);jr(g,s.memoizedState)||(qn=!0),s.memoizedState=g,s.baseQueue===null&&(s.baseState=g),l.lastRenderedState=g}return[g,c]}function ng(e,s,l){var c=Ft,p=Ln(),g=tn;if(g){if(l===void 0)throw Error(a(407));l=l()}else l=s();var j=!jr((gn||p).memoizedState,l);if(j&&(p.memoizedState=l,qn=!0),p=p.queue,hh(ig.bind(null,c,p,e),[e]),p.getSnapshot!==s||j||Pn!==null&&Pn.memoizedState.tag&1){if(c.flags|=2048,qa(9,{destroy:void 0},sg.bind(null,c,p,l,s),null),xn===null)throw Error(a(349));g||(Es&127)!==0||rg(c,s,l)}return l}function rg(e,s,l){e.flags|=16384,e={getSnapshot:s,value:l},s=Ft.updateQueue,s===null?(s=Lc(),Ft.updateQueue=s,s.stores=[e]):(l=s.stores,l===null?s.stores=[e]:l.push(e))}function sg(e,s,l,c){s.value=l,s.getSnapshot=c,ag(s)&&lg(e)}function ig(e,s,l){return l(function(){ag(s)&&lg(e)})}function ag(e){var s=e.getSnapshot;e=e.value;try{var l=s();return!jr(e,l)}catch{return!0}}function lg(e){var s=Vi(e,2);s!==null&&xr(s,e,2)}function uh(e){var s=hr();if(typeof e=="function"){var l=e;if(e=l(),ea){sn(!0);try{l()}finally{sn(!1)}}}return s.memoizedState=s.baseState=e,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:e},s}function og(e,s,l,c){return e.baseState=l,oh(e,gn,typeof c=="function"?c:ks)}function Bw(e,s,l,c,p){if(Pc(e))throw Error(a(485));if(e=s.action,e!==null){var g={payload:p,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(j){g.listeners.push(j)}};k.T!==null?l(!0):g.isTransition=!1,c(g),l=s.pending,l===null?(g.next=s.pending=g,cg(s,g)):(g.next=l.next,s.pending=l.next=g)}}function cg(e,s){var l=s.action,c=s.payload,p=e.state;if(s.isTransition){var g=k.T,j={};k.T=j;try{var M=l(p,c),Y=k.S;Y!==null&&Y(j,M),ug(e,s,M)}catch(me){dh(e,s,me)}finally{g!==null&&j.types!==null&&(g.types=j.types),k.T=g}}else try{g=l(p,c),ug(e,s,g)}catch(me){dh(e,s,me)}}function ug(e,s,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){dg(e,s,c)},function(c){return dh(e,s,c)}):dg(e,s,l)}function dg(e,s,l){s.status="fulfilled",s.value=l,hg(s),e.state=l,s=e.pending,s!==null&&(l=s.next,l===s?e.pending=null:(l=l.next,s.next=l,cg(e,l)))}function dh(e,s,l){var c=e.pending;if(e.pending=null,c!==null){c=c.next;do s.status="rejected",s.reason=l,hg(s),s=s.next;while(s!==c)}e.action=null}function hg(e){e=e.listeners;for(var s=0;s<e.length;s++)(0,e[s])()}function fg(e,s){return s}function pg(e,s){if(tn){var l=xn.formState;if(l!==null){e:{var c=Ft;if(tn){if(_n){t:{for(var p=_n,g=qr;p.nodeType!==8;){if(!g){p=null;break t}if(p=Hr(p.nextSibling),p===null){p=null;break t}}g=p.data,p=g==="F!"||g==="F"?p:null}if(p){_n=Hr(p.nextSibling),c=p.data==="F!";break e}}si(c)}c=!1}c&&(s=l[0])}}return l=hr(),l.memoizedState=l.baseState=s,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fg,lastRenderedState:s},l.queue=c,l=Dg.bind(null,Ft,c),c.dispatch=l,c=uh(!1),g=yh.bind(null,Ft,!1,c.queue),c=hr(),p={state:s,dispatch:null,action:e,pending:null},c.queue=p,l=Bw.bind(null,Ft,p,g,l),p.dispatch=l,c.memoizedState=e,[s,l,!1]}function mg(e){var s=Ln();return gg(s,gn,e)}function gg(e,s,l){if(s=oh(e,s,fg)[0],e=Ic(ks)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var c=no(s)}catch(j){throw j===Ua?kc:j}else c=s;s=Ln();var p=s.queue,g=p.dispatch;return l!==s.memoizedState&&(Ft.flags|=2048,qa(9,{destroy:void 0},$w.bind(null,p,l),null)),[c,g,e]}function $w(e,s){e.action=s}function yg(e){var s=Ln(),l=gn;if(l!==null)return gg(s,l,e);Ln(),s=s.memoizedState,l=Ln();var c=l.queue.dispatch;return l.memoizedState=e,[s,c,!1]}function qa(e,s,l,c){return e={tag:e,create:l,deps:c,inst:s,next:null},s=Ft.updateQueue,s===null&&(s=Lc(),Ft.updateQueue=s),l=s.lastEffect,l===null?s.lastEffect=e.next=e:(c=l.next,l.next=e,e.next=c,s.lastEffect=e),e}function vg(){return Ln().memoizedState}function Bc(e,s,l,c){var p=hr();Ft.flags|=e,p.memoizedState=qa(1|s,{destroy:void 0},l,c===void 0?null:c)}function $c(e,s,l,c){var p=Ln();c=c===void 0?null:c;var g=p.memoizedState.inst;gn!==null&&c!==null&&nh(c,gn.memoizedState.deps)?p.memoizedState=qa(s,g,l,c):(Ft.flags|=e,p.memoizedState=qa(1|s,g,l,c))}function xg(e,s){Bc(8390656,8,e,s)}function hh(e,s){$c(2048,8,e,s)}function Pw(e){Ft.flags|=4;var s=Ft.updateQueue;if(s===null)s=Lc(),Ft.updateQueue=s,s.events=[e];else{var l=s.events;l===null?s.events=[e]:l.push(e)}}function bg(e){var s=Ln().memoizedState;return Pw({ref:s,nextImpl:e}),function(){if((cn&2)!==0)throw Error(a(440));return s.impl.apply(void 0,arguments)}}function wg(e,s){return $c(4,2,e,s)}function Sg(e,s){return $c(4,4,e,s)}function jg(e,s){if(typeof s=="function"){e=e();var l=s(e);return function(){typeof l=="function"?l():s(null)}}if(s!=null)return e=e(),s.current=e,function(){s.current=null}}function _g(e,s,l){l=l!=null?l.concat([e]):null,$c(4,4,jg.bind(null,s,e),l)}function fh(){}function Cg(e,s){var l=Ln();s=s===void 0?null:s;var c=l.memoizedState;return s!==null&&nh(s,c[1])?c[0]:(l.memoizedState=[e,s],e)}function Ng(e,s){var l=Ln();s=s===void 0?null:s;var c=l.memoizedState;if(s!==null&&nh(s,c[1]))return c[0];if(c=e(),ea){sn(!0);try{e()}finally{sn(!1)}}return l.memoizedState=[c,s],c}function ph(e,s,l){return l===void 0||(Es&1073741824)!==0&&(Zt&261930)===0?e.memoizedState=s:(e.memoizedState=l,e=Ey(),Ft.lanes|=e,fi|=e,l)}function Eg(e,s,l,c){return jr(l,s)?l:Ba.current!==null?(e=ph(e,l,c),jr(e,s)||(qn=!0),e):(Es&42)===0||(Es&1073741824)!==0&&(Zt&261930)===0?(qn=!0,e.memoizedState=l):(e=Ey(),Ft.lanes|=e,fi|=e,s)}function kg(e,s,l,c,p){var g=L.p;L.p=g!==0&&8>g?g:8;var j=k.T,M={};k.T=M,yh(e,!1,s,l);try{var Y=p(),me=k.S;if(me!==null&&me(M,Y),Y!==null&&typeof Y=="object"&&typeof Y.then=="function"){var Te=Lw(Y,c);ro(e,s,Te,Tr(e))}else ro(e,s,c,Tr(e))}catch(ze){ro(e,s,{then:function(){},status:"rejected",reason:ze},Tr())}finally{L.p=g,j!==null&&M.types!==null&&(j.types=M.types),k.T=j}}function qw(){}function mh(e,s,l,c){if(e.tag!==5)throw Error(a(476));var p=Tg(e).queue;kg(e,p,s,H,l===null?qw:function(){return Ag(e),l(c)})}function Tg(e){var s=e.memoizedState;if(s!==null)return s;s={memoizedState:H,baseState:H,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:H},next:null};var l={};return s.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:l},next:null},e.memoizedState=s,e=e.alternate,e!==null&&(e.memoizedState=s),s}function Ag(e){var s=Tg(e);s.next===null&&(s=e.alternate.memoizedState),ro(e,s.next.queue,{},Tr())}function gh(){return nr(wo)}function Rg(){return Ln().memoizedState}function Og(){return Ln().memoizedState}function Fw(e){for(var s=e.return;s!==null;){switch(s.tag){case 24:case 3:var l=Tr();e=li(l);var c=oi(s,e,l);c!==null&&(xr(c,s,l),Xl(c,s,l)),s={cache:Vd()},e.payload=s;return}s=s.return}}function Hw(e,s,l){var c=Tr();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Pc(e)?Mg(s,l):(l=Md(e,s,l,c),l!==null&&(xr(l,e,c),zg(l,s,c)))}function Dg(e,s,l){var c=Tr();ro(e,s,l,c)}function ro(e,s,l,c){var p={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(Pc(e))Mg(s,p);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=s.lastRenderedReducer,g!==null))try{var j=s.lastRenderedState,M=g(j,l);if(p.hasEagerState=!0,p.eagerState=M,jr(M,j))return wc(e,s,p,0),xn===null&&bc(),!1}catch{}if(l=Md(e,s,p,c),l!==null)return xr(l,e,c),zg(l,s,c),!0}return!1}function yh(e,s,l,c){if(c={lane:2,revertLane:Wh(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Pc(e)){if(s)throw Error(a(479))}else s=Md(e,l,c,2),s!==null&&xr(s,e,2)}function Pc(e){var s=e.alternate;return e===Ft||s!==null&&s===Ft}function Mg(e,s){$a=Mc=!0;var l=e.pending;l===null?s.next=s:(s.next=l.next,l.next=s),e.pending=s}function zg(e,s,l){if((l&4194048)!==0){var c=s.lanes;c&=e.pendingLanes,l|=c,s.lanes=l,We(e,l)}}var so={readContext:nr,use:Uc,useCallback:On,useContext:On,useEffect:On,useImperativeHandle:On,useLayoutEffect:On,useInsertionEffect:On,useMemo:On,useReducer:On,useRef:On,useState:On,useDebugValue:On,useDeferredValue:On,useTransition:On,useSyncExternalStore:On,useId:On,useHostTransitionStatus:On,useFormState:On,useActionState:On,useOptimistic:On,useMemoCache:On,useCacheRefresh:On};so.useEffectEvent=On;var Lg={readContext:nr,use:Uc,useCallback:function(e,s){return hr().memoizedState=[e,s===void 0?null:s],e},useContext:nr,useEffect:xg,useImperativeHandle:function(e,s,l){l=l!=null?l.concat([e]):null,Bc(4194308,4,jg.bind(null,s,e),l)},useLayoutEffect:function(e,s){return Bc(4194308,4,e,s)},useInsertionEffect:function(e,s){Bc(4,2,e,s)},useMemo:function(e,s){var l=hr();s=s===void 0?null:s;var c=e();if(ea){sn(!0);try{e()}finally{sn(!1)}}return l.memoizedState=[c,s],c},useReducer:function(e,s,l){var c=hr();if(l!==void 0){var p=l(s);if(ea){sn(!0);try{l(s)}finally{sn(!1)}}}else p=s;return c.memoizedState=c.baseState=p,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:p},c.queue=e,e=e.dispatch=Hw.bind(null,Ft,e),[c.memoizedState,e]},useRef:function(e){var s=hr();return e={current:e},s.memoizedState=e},useState:function(e){e=uh(e);var s=e.queue,l=Dg.bind(null,Ft,s);return s.dispatch=l,[e.memoizedState,l]},useDebugValue:fh,useDeferredValue:function(e,s){var l=hr();return ph(l,e,s)},useTransition:function(){var e=uh(!1);return e=kg.bind(null,Ft,e.queue,!0,!1),hr().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,s,l){var c=Ft,p=hr();if(tn){if(l===void 0)throw Error(a(407));l=l()}else{if(l=s(),xn===null)throw Error(a(349));(Zt&127)!==0||rg(c,s,l)}p.memoizedState=l;var g={value:l,getSnapshot:s};return p.queue=g,xg(ig.bind(null,c,g,e),[e]),c.flags|=2048,qa(9,{destroy:void 0},sg.bind(null,c,g,l,s),null),l},useId:function(){var e=hr(),s=xn.identifierPrefix;if(tn){var l=ms,c=ps;l=(c&~(1<<32-Kt(c)-1)).toString(32)+l,s="_"+s+"R_"+l,l=zc++,0<l&&(s+="H"+l.toString(32)),s+="_"}else l=Uw++,s="_"+s+"r_"+l.toString(32)+"_";return e.memoizedState=s},useHostTransitionStatus:gh,useFormState:pg,useActionState:pg,useOptimistic:function(e){var s=hr();s.memoizedState=s.baseState=e;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=l,s=yh.bind(null,Ft,!0,l),l.dispatch=s,[e,s]},useMemoCache:lh,useCacheRefresh:function(){return hr().memoizedState=Fw.bind(null,Ft)},useEffectEvent:function(e){var s=hr(),l={impl:e};return s.memoizedState=l,function(){if((cn&2)!==0)throw Error(a(440));return l.impl.apply(void 0,arguments)}}},vh={readContext:nr,use:Uc,useCallback:Cg,useContext:nr,useEffect:hh,useImperativeHandle:_g,useInsertionEffect:wg,useLayoutEffect:Sg,useMemo:Ng,useReducer:Ic,useRef:vg,useState:function(){return Ic(ks)},useDebugValue:fh,useDeferredValue:function(e,s){var l=Ln();return Eg(l,gn.memoizedState,e,s)},useTransition:function(){var e=Ic(ks)[0],s=Ln().memoizedState;return[typeof e=="boolean"?e:no(e),s]},useSyncExternalStore:ng,useId:Rg,useHostTransitionStatus:gh,useFormState:mg,useActionState:mg,useOptimistic:function(e,s){var l=Ln();return og(l,gn,e,s)},useMemoCache:lh,useCacheRefresh:Og};vh.useEffectEvent=bg;var Ug={readContext:nr,use:Uc,useCallback:Cg,useContext:nr,useEffect:hh,useImperativeHandle:_g,useInsertionEffect:wg,useLayoutEffect:Sg,useMemo:Ng,useReducer:ch,useRef:vg,useState:function(){return ch(ks)},useDebugValue:fh,useDeferredValue:function(e,s){var l=Ln();return gn===null?ph(l,e,s):Eg(l,gn.memoizedState,e,s)},useTransition:function(){var e=ch(ks)[0],s=Ln().memoizedState;return[typeof e=="boolean"?e:no(e),s]},useSyncExternalStore:ng,useId:Rg,useHostTransitionStatus:gh,useFormState:yg,useActionState:yg,useOptimistic:function(e,s){var l=Ln();return gn!==null?og(l,gn,e,s):(l.baseState=e,[e,l.queue.dispatch])},useMemoCache:lh,useCacheRefresh:Og};Ug.useEffectEvent=bg;function xh(e,s,l,c){s=e.memoizedState,l=l(c,s),l=l==null?s:v({},s,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var bh={enqueueSetState:function(e,s,l){e=e._reactInternals;var c=Tr(),p=li(c);p.payload=s,l!=null&&(p.callback=l),s=oi(e,p,c),s!==null&&(xr(s,e,c),Xl(s,e,c))},enqueueReplaceState:function(e,s,l){e=e._reactInternals;var c=Tr(),p=li(c);p.tag=1,p.payload=s,l!=null&&(p.callback=l),s=oi(e,p,c),s!==null&&(xr(s,e,c),Xl(s,e,c))},enqueueForceUpdate:function(e,s){e=e._reactInternals;var l=Tr(),c=li(l);c.tag=2,s!=null&&(c.callback=s),s=oi(e,c,l),s!==null&&(xr(s,e,l),Xl(s,e,l))}};function Ig(e,s,l,c,p,g,j){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,j):s.prototype&&s.prototype.isPureReactComponent?!Hl(l,c)||!Hl(p,g):!0}function Bg(e,s,l,c){e=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,c),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,c),s.state!==e&&bh.enqueueReplaceState(s,s.state,null)}function ta(e,s){var l=s;if("ref"in s){l={};for(var c in s)c!=="ref"&&(l[c]=s[c])}if(e=e.defaultProps){l===s&&(l=v({},l));for(var p in e)l[p]===void 0&&(l[p]=e[p])}return l}function $g(e){xc(e)}function Pg(e){console.error(e)}function qg(e){xc(e)}function qc(e,s){try{var l=e.onUncaughtError;l(s.value,{componentStack:s.stack})}catch(c){setTimeout(function(){throw c})}}function Fg(e,s,l){try{var c=e.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function wh(e,s,l){return l=li(l),l.tag=3,l.payload={element:null},l.callback=function(){qc(e,s)},l}function Hg(e){return e=li(e),e.tag=3,e}function Vg(e,s,l,c){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var g=c.value;e.payload=function(){return p(g)},e.callback=function(){Fg(s,l,c)}}var j=l.stateNode;j!==null&&typeof j.componentDidCatch=="function"&&(e.callback=function(){Fg(s,l,c),typeof p!="function"&&(pi===null?pi=new Set([this]):pi.add(this));var M=c.stack;this.componentDidCatch(c.value,{componentStack:M!==null?M:""})})}function Vw(e,s,l,c,p){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(s=l.alternate,s!==null&&Ma(s,l,p,!0),l=Cr.current,l!==null){switch(l.tag){case 31:case 13:return Fr===null?eu():l.alternate===null&&Dn===0&&(Dn=3),l.flags&=-257,l.flags|=65536,l.lanes=p,c===Tc?l.flags|=16384:(s=l.updateQueue,s===null?l.updateQueue=new Set([c]):s.add(c),Gh(e,c,p)),!1;case 22:return l.flags|=65536,c===Tc?l.flags|=16384:(s=l.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=s):(l=s.retryQueue,l===null?s.retryQueue=new Set([c]):l.add(c)),Gh(e,c,p)),!1}throw Error(a(435,l.tag))}return Gh(e,c,p),eu(),!1}if(tn)return s=Cr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=p,c!==$d&&(e=Error(a(422),{cause:c}),Kl(Br(e,l)))):(c!==$d&&(s=Error(a(423),{cause:c}),Kl(Br(s,l))),e=e.current.alternate,e.flags|=65536,p&=-p,e.lanes|=p,c=Br(c,l),p=wh(e.stateNode,c,p),Jd(e,p),Dn!==4&&(Dn=2)),!1;var g=Error(a(520),{cause:c});if(g=Br(g,l),fo===null?fo=[g]:fo.push(g),Dn!==4&&(Dn=2),s===null)return!0;c=Br(c,l),l=s;do{switch(l.tag){case 3:return l.flags|=65536,e=p&-p,l.lanes|=e,e=wh(l.stateNode,c,e),Jd(l,e),!1;case 1:if(s=l.type,g=l.stateNode,(l.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(pi===null||!pi.has(g))))return l.flags|=65536,p&=-p,l.lanes|=p,p=Hg(p),Vg(p,e,l,c),Jd(l,p),!1}l=l.return}while(l!==null);return!1}var Sh=Error(a(461)),qn=!1;function rr(e,s,l,c){s.child=e===null?Wm(s,null,l,c):Zi(s,e.child,l,c)}function Gg(e,s,l,c,p){l=l.render;var g=s.ref;if("ref"in c){var j={};for(var M in c)M!=="ref"&&(j[M]=c[M])}else j=c;return Wi(s),c=rh(e,s,l,j,g,p),M=sh(),e!==null&&!qn?(ih(e,s,p),Ts(e,s,p)):(tn&&M&&Id(s),s.flags|=1,rr(e,s,c,p),s.child)}function Kg(e,s,l,c,p){if(e===null){var g=l.type;return typeof g=="function"&&!zd(g)&&g.defaultProps===void 0&&l.compare===null?(s.tag=15,s.type=g,Yg(e,s,g,c,p)):(e=jc(l.type,null,c,s,s.mode,p),e.ref=s.ref,e.return=s,s.child=e)}if(g=e.child,!Ah(e,p)){var j=g.memoizedProps;if(l=l.compare,l=l!==null?l:Hl,l(j,c)&&e.ref===s.ref)return Ts(e,s,p)}return s.flags|=1,e=js(g,c),e.ref=s.ref,e.return=s,s.child=e}function Yg(e,s,l,c,p){if(e!==null){var g=e.memoizedProps;if(Hl(g,c)&&e.ref===s.ref)if(qn=!1,s.pendingProps=c=g,Ah(e,p))(e.flags&131072)!==0&&(qn=!0);else return s.lanes=e.lanes,Ts(e,s,p)}return jh(e,s,l,c,p)}function Wg(e,s,l,c){var p=c.children,g=e!==null?e.memoizedState:null;if(e===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((s.flags&128)!==0){if(g=g!==null?g.baseLanes|l:l,e!==null){for(c=s.child=e.child,p=0;c!==null;)p=p|c.lanes|c.childLanes,c=c.sibling;c=p&~g}else c=0,s.child=null;return Qg(e,s,g,l,c)}if((l&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},e!==null&&Ec(s,g!==null?g.cachePool:null),g!==null?Xm(s,g):Zd(),Zm(s);else return c=s.lanes=536870912,Qg(e,s,g!==null?g.baseLanes|l:l,l,c)}else g!==null?(Ec(s,g.cachePool),Xm(s,g),ui(),s.memoizedState=null):(e!==null&&Ec(s,null),Zd(),ui());return rr(e,s,p,l),s.child}function io(e,s){return e!==null&&e.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Qg(e,s,l,c,p){var g=Kd();return g=g===null?null:{parent:$n._currentValue,pool:g},s.memoizedState={baseLanes:l,cachePool:g},e!==null&&Ec(s,null),Zd(),Zm(s),e!==null&&Ma(e,s,c,!0),s.childLanes=p,null}function Fc(e,s){return s=Vc({mode:s.mode,children:s.children},e.mode),s.ref=e.ref,e.child=s,s.return=e,s}function Jg(e,s,l){return Zi(s,e.child,null,l),e=Fc(s,s.pendingProps),e.flags|=2,Nr(s),s.memoizedState=null,e}function Gw(e,s,l){var c=s.pendingProps,p=(s.flags&128)!==0;if(s.flags&=-129,e===null){if(tn){if(c.mode==="hidden")return e=Fc(s,c),s.lanes=536870912,io(null,e);if(th(s),(e=_n)?(e=cv(e,qr),e=e!==null&&e.data==="&"?e:null,e!==null&&(s.memoizedState={dehydrated:e,treeContext:ni!==null?{id:ps,overflow:ms}:null,retryLane:536870912,hydrationErrors:null},l=Mm(e),l.return=s,s.child=l,tr=s,_n=null)):e=null,e===null)throw si(s);return s.lanes=536870912,null}return Fc(s,c)}var g=e.memoizedState;if(g!==null){var j=g.dehydrated;if(th(s),p)if(s.flags&256)s.flags&=-257,s=Jg(e,s,l);else if(s.memoizedState!==null)s.child=e.child,s.flags|=128,s=null;else throw Error(a(558));else if(qn||Ma(e,s,l,!1),p=(l&e.childLanes)!==0,qn||p){if(c=xn,c!==null&&(j=At(c,l),j!==0&&j!==g.retryLane))throw g.retryLane=j,Vi(e,j),xr(c,e,j),Sh;eu(),s=Jg(e,s,l)}else e=g.treeContext,_n=Hr(j.nextSibling),tr=s,tn=!0,ri=null,qr=!1,e!==null&&Um(s,e),s=Fc(s,c),s.flags|=4096;return s}return e=js(e.child,{mode:c.mode,children:c.children}),e.ref=s.ref,s.child=e,e.return=s,e}function Hc(e,s){var l=s.ref;if(l===null)e!==null&&e.ref!==null&&(s.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(a(284));(e===null||e.ref!==l)&&(s.flags|=4194816)}}function jh(e,s,l,c,p){return Wi(s),l=rh(e,s,l,c,void 0,p),c=sh(),e!==null&&!qn?(ih(e,s,p),Ts(e,s,p)):(tn&&c&&Id(s),s.flags|=1,rr(e,s,l,p),s.child)}function Xg(e,s,l,c,p,g){return Wi(s),s.updateQueue=null,l=tg(s,c,l,p),eg(e),c=sh(),e!==null&&!qn?(ih(e,s,g),Ts(e,s,g)):(tn&&c&&Id(s),s.flags|=1,rr(e,s,l,g),s.child)}function Zg(e,s,l,c,p){if(Wi(s),s.stateNode===null){var g=Aa,j=l.contextType;typeof j=="object"&&j!==null&&(g=nr(j)),g=new l(c,g),s.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=bh,s.stateNode=g,g._reactInternals=s,g=s.stateNode,g.props=c,g.state=s.memoizedState,g.refs={},Wd(s),j=l.contextType,g.context=typeof j=="object"&&j!==null?nr(j):Aa,g.state=s.memoizedState,j=l.getDerivedStateFromProps,typeof j=="function"&&(xh(s,l,j,c),g.state=s.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(j=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),j!==g.state&&bh.enqueueReplaceState(g,g.state,null),eo(s,c,g,p),Zl(),g.state=s.memoizedState),typeof g.componentDidMount=="function"&&(s.flags|=4194308),c=!0}else if(e===null){g=s.stateNode;var M=s.memoizedProps,Y=ta(l,M);g.props=Y;var me=g.context,Te=l.contextType;j=Aa,typeof Te=="object"&&Te!==null&&(j=nr(Te));var ze=l.getDerivedStateFromProps;Te=typeof ze=="function"||typeof g.getSnapshotBeforeUpdate=="function",M=s.pendingProps!==M,Te||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(M||me!==j)&&Bg(s,g,c,j),ai=!1;var ye=s.memoizedState;g.state=ye,eo(s,c,g,p),Zl(),me=s.memoizedState,M||ye!==me||ai?(typeof ze=="function"&&(xh(s,l,ze,c),me=s.memoizedState),(Y=ai||Ig(s,l,Y,c,ye,me,j))?(Te||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(s.flags|=4194308)):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=c,s.memoizedState=me),g.props=c,g.state=me,g.context=j,c=Y):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),c=!1)}else{g=s.stateNode,Qd(e,s),j=s.memoizedProps,Te=ta(l,j),g.props=Te,ze=s.pendingProps,ye=g.context,me=l.contextType,Y=Aa,typeof me=="object"&&me!==null&&(Y=nr(me)),M=l.getDerivedStateFromProps,(me=typeof M=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(j!==ze||ye!==Y)&&Bg(s,g,c,Y),ai=!1,ye=s.memoizedState,g.state=ye,eo(s,c,g,p),Zl();var we=s.memoizedState;j!==ze||ye!==we||ai||e!==null&&e.dependencies!==null&&Cc(e.dependencies)?(typeof M=="function"&&(xh(s,l,M,c),we=s.memoizedState),(Te=ai||Ig(s,l,Te,c,ye,we,Y)||e!==null&&e.dependencies!==null&&Cc(e.dependencies))?(me||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,we,Y),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,we,Y)),typeof g.componentDidUpdate=="function"&&(s.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof g.componentDidUpdate!="function"||j===e.memoizedProps&&ye===e.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&ye===e.memoizedState||(s.flags|=1024),s.memoizedProps=c,s.memoizedState=we),g.props=c,g.state=we,g.context=Y,c=Te):(typeof g.componentDidUpdate!="function"||j===e.memoizedProps&&ye===e.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||j===e.memoizedProps&&ye===e.memoizedState||(s.flags|=1024),c=!1)}return g=c,Hc(e,s),c=(s.flags&128)!==0,g||c?(g=s.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:g.render(),s.flags|=1,e!==null&&c?(s.child=Zi(s,e.child,null,p),s.child=Zi(s,null,l,p)):rr(e,s,l,p),s.memoizedState=g.state,e=s.child):e=Ts(e,s,p),e}function ey(e,s,l,c){return Ki(),s.flags|=256,rr(e,s,l,c),s.child}var _h={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ch(e){return{baseLanes:e,cachePool:Fm()}}function Nh(e,s,l){return e=e!==null?e.childLanes&~l:0,s&&(e|=kr),e}function ty(e,s,l){var c=s.pendingProps,p=!1,g=(s.flags&128)!==0,j;if((j=g)||(j=e!==null&&e.memoizedState===null?!1:(zn.current&2)!==0),j&&(p=!0,s.flags&=-129),j=(s.flags&32)!==0,s.flags&=-33,e===null){if(tn){if(p?ci(s):ui(),(e=_n)?(e=cv(e,qr),e=e!==null&&e.data!=="&"?e:null,e!==null&&(s.memoizedState={dehydrated:e,treeContext:ni!==null?{id:ps,overflow:ms}:null,retryLane:536870912,hydrationErrors:null},l=Mm(e),l.return=s,s.child=l,tr=s,_n=null)):e=null,e===null)throw si(s);return cf(e)?s.lanes=32:s.lanes=536870912,null}var M=c.children;return c=c.fallback,p?(ui(),p=s.mode,M=Vc({mode:"hidden",children:M},p),c=Gi(c,p,l,null),M.return=s,c.return=s,M.sibling=c,s.child=M,c=s.child,c.memoizedState=Ch(l),c.childLanes=Nh(e,j,l),s.memoizedState=_h,io(null,c)):(ci(s),Eh(s,M))}var Y=e.memoizedState;if(Y!==null&&(M=Y.dehydrated,M!==null)){if(g)s.flags&256?(ci(s),s.flags&=-257,s=kh(e,s,l)):s.memoizedState!==null?(ui(),s.child=e.child,s.flags|=128,s=null):(ui(),M=c.fallback,p=s.mode,c=Vc({mode:"visible",children:c.children},p),M=Gi(M,p,l,null),M.flags|=2,c.return=s,M.return=s,c.sibling=M,s.child=c,Zi(s,e.child,null,l),c=s.child,c.memoizedState=Ch(l),c.childLanes=Nh(e,j,l),s.memoizedState=_h,s=io(null,c));else if(ci(s),cf(M)){if(j=M.nextSibling&&M.nextSibling.dataset,j)var me=j.dgst;j=me,c=Error(a(419)),c.stack="",c.digest=j,Kl({value:c,source:null,stack:null}),s=kh(e,s,l)}else if(qn||Ma(e,s,l,!1),j=(l&e.childLanes)!==0,qn||j){if(j=xn,j!==null&&(c=At(j,l),c!==0&&c!==Y.retryLane))throw Y.retryLane=c,Vi(e,c),xr(j,e,c),Sh;of(M)||eu(),s=kh(e,s,l)}else of(M)?(s.flags|=192,s.child=e.child,s=null):(e=Y.treeContext,_n=Hr(M.nextSibling),tr=s,tn=!0,ri=null,qr=!1,e!==null&&Um(s,e),s=Eh(s,c.children),s.flags|=4096);return s}return p?(ui(),M=c.fallback,p=s.mode,Y=e.child,me=Y.sibling,c=js(Y,{mode:"hidden",children:c.children}),c.subtreeFlags=Y.subtreeFlags&65011712,me!==null?M=js(me,M):(M=Gi(M,p,l,null),M.flags|=2),M.return=s,c.return=s,c.sibling=M,s.child=c,io(null,c),c=s.child,M=e.child.memoizedState,M===null?M=Ch(l):(p=M.cachePool,p!==null?(Y=$n._currentValue,p=p.parent!==Y?{parent:Y,pool:Y}:p):p=Fm(),M={baseLanes:M.baseLanes|l,cachePool:p}),c.memoizedState=M,c.childLanes=Nh(e,j,l),s.memoizedState=_h,io(e.child,c)):(ci(s),l=e.child,e=l.sibling,l=js(l,{mode:"visible",children:c.children}),l.return=s,l.sibling=null,e!==null&&(j=s.deletions,j===null?(s.deletions=[e],s.flags|=16):j.push(e)),s.child=l,s.memoizedState=null,l)}function Eh(e,s){return s=Vc({mode:"visible",children:s},e.mode),s.return=e,e.child=s}function Vc(e,s){return e=_r(22,e,null,s),e.lanes=0,e}function kh(e,s,l){return Zi(s,e.child,null,l),e=Eh(s,s.pendingProps.children),e.flags|=2,s.memoizedState=null,e}function ny(e,s,l){e.lanes|=s;var c=e.alternate;c!==null&&(c.lanes|=s),Fd(e.return,s,l)}function Th(e,s,l,c,p,g){var j=e.memoizedState;j===null?e.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:p,treeForkCount:g}:(j.isBackwards=s,j.rendering=null,j.renderingStartTime=0,j.last=c,j.tail=l,j.tailMode=p,j.treeForkCount=g)}function ry(e,s,l){var c=s.pendingProps,p=c.revealOrder,g=c.tail;c=c.children;var j=zn.current,M=(j&2)!==0;if(M?(j=j&1|2,s.flags|=128):j&=1,ie(zn,j),rr(e,s,c,l),c=tn?Gl:0,!M&&e!==null&&(e.flags&128)!==0)e:for(e=s.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ny(e,l,s);else if(e.tag===19)ny(e,l,s);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break e;for(;e.sibling===null;){if(e.return===null||e.return===s)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(p){case"forwards":for(l=s.child,p=null;l!==null;)e=l.alternate,e!==null&&Dc(e)===null&&(p=l),l=l.sibling;l=p,l===null?(p=s.child,s.child=null):(p=l.sibling,l.sibling=null),Th(s,!1,p,l,g,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,p=s.child,s.child=null;p!==null;){if(e=p.alternate,e!==null&&Dc(e)===null){s.child=p;break}e=p.sibling,p.sibling=l,l=p,p=e}Th(s,!0,l,null,g,c);break;case"together":Th(s,!1,null,null,void 0,c);break;default:s.memoizedState=null}return s.child}function Ts(e,s,l){if(e!==null&&(s.dependencies=e.dependencies),fi|=s.lanes,(l&s.childLanes)===0)if(e!==null){if(Ma(e,s,l,!1),(l&s.childLanes)===0)return null}else return null;if(e!==null&&s.child!==e.child)throw Error(a(153));if(s.child!==null){for(e=s.child,l=js(e,e.pendingProps),s.child=l,l.return=s;e.sibling!==null;)e=e.sibling,l=l.sibling=js(e,e.pendingProps),l.return=s;l.sibling=null}return s.child}function Ah(e,s){return(e.lanes&s)!==0?!0:(e=e.dependencies,!!(e!==null&&Cc(e)))}function Kw(e,s,l){switch(s.tag){case 3:K(s,s.stateNode.containerInfo),ii(s,$n,e.memoizedState.cache),Ki();break;case 27:case 5:Ae(s);break;case 4:K(s,s.stateNode.containerInfo);break;case 10:ii(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,th(s),null;break;case 13:var c=s.memoizedState;if(c!==null)return c.dehydrated!==null?(ci(s),s.flags|=128,null):(l&s.child.childLanes)!==0?ty(e,s,l):(ci(s),e=Ts(e,s,l),e!==null?e.sibling:null);ci(s);break;case 19:var p=(e.flags&128)!==0;if(c=(l&s.childLanes)!==0,c||(Ma(e,s,l,!1),c=(l&s.childLanes)!==0),p){if(c)return ry(e,s,l);s.flags|=128}if(p=s.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),ie(zn,zn.current),c)break;return null;case 22:return s.lanes=0,Wg(e,s,l,s.pendingProps);case 24:ii(s,$n,e.memoizedState.cache)}return Ts(e,s,l)}function sy(e,s,l){if(e!==null)if(e.memoizedProps!==s.pendingProps)qn=!0;else{if(!Ah(e,l)&&(s.flags&128)===0)return qn=!1,Kw(e,s,l);qn=(e.flags&131072)!==0}else qn=!1,tn&&(s.flags&1048576)!==0&&Lm(s,Gl,s.index);switch(s.lanes=0,s.tag){case 16:e:{var c=s.pendingProps;if(e=Ji(s.elementType),s.type=e,typeof e=="function")zd(e)?(c=ta(e,c),s.tag=1,s=Zg(null,s,e,c,l)):(s.tag=0,s=jh(null,s,e,c,l));else{if(e!=null){var p=e.$$typeof;if(p===T){s.tag=11,s=Gg(null,s,e,c,l);break e}else if(p===R){s.tag=14,s=Kg(null,s,e,c,l);break e}}throw s=$(e)||e,Error(a(306,s,""))}}return s;case 0:return jh(e,s,s.type,s.pendingProps,l);case 1:return c=s.type,p=ta(c,s.pendingProps),Zg(e,s,c,p,l);case 3:e:{if(K(s,s.stateNode.containerInfo),e===null)throw Error(a(387));c=s.pendingProps;var g=s.memoizedState;p=g.element,Qd(e,s),eo(s,c,null,l);var j=s.memoizedState;if(c=j.cache,ii(s,$n,c),c!==g.cache&&Hd(s,[$n],l,!0),Zl(),c=j.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:j.cache},s.updateQueue.baseState=g,s.memoizedState=g,s.flags&256){s=ey(e,s,c,l);break e}else if(c!==p){p=Br(Error(a(424)),s),Kl(p),s=ey(e,s,c,l);break e}else for(e=s.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,_n=Hr(e.firstChild),tr=s,tn=!0,ri=null,qr=!0,l=Wm(s,null,c,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Ki(),c===p){s=Ts(e,s,l);break e}rr(e,s,c,l)}s=s.child}return s;case 26:return Hc(e,s),e===null?(l=mv(s.type,null,s.pendingProps,null))?s.memoizedState=l:tn||(l=s.type,e=s.pendingProps,c=lu(Ne.current).createElement(l),c[$e]=s,c[Ge]=e,sr(c,l,e),It(c),s.stateNode=c):s.memoizedState=mv(s.type,e.memoizedProps,s.pendingProps,e.memoizedState),null;case 27:return Ae(s),e===null&&tn&&(c=s.stateNode=hv(s.type,s.pendingProps,Ne.current),tr=s,qr=!0,p=_n,vi(s.type)?(uf=p,_n=Hr(c.firstChild)):_n=p),rr(e,s,s.pendingProps.children,l),Hc(e,s),e===null&&(s.flags|=4194304),s.child;case 5:return e===null&&tn&&((p=c=_n)&&(c=jS(c,s.type,s.pendingProps,qr),c!==null?(s.stateNode=c,tr=s,_n=Hr(c.firstChild),qr=!1,p=!0):p=!1),p||si(s)),Ae(s),p=s.type,g=s.pendingProps,j=e!==null?e.memoizedProps:null,c=g.children,sf(p,g)?c=null:j!==null&&sf(p,j)&&(s.flags|=32),s.memoizedState!==null&&(p=rh(e,s,Iw,null,null,l),wo._currentValue=p),Hc(e,s),rr(e,s,c,l),s.child;case 6:return e===null&&tn&&((e=l=_n)&&(l=_S(l,s.pendingProps,qr),l!==null?(s.stateNode=l,tr=s,_n=null,e=!0):e=!1),e||si(s)),null;case 13:return ty(e,s,l);case 4:return K(s,s.stateNode.containerInfo),c=s.pendingProps,e===null?s.child=Zi(s,null,c,l):rr(e,s,c,l),s.child;case 11:return Gg(e,s,s.type,s.pendingProps,l);case 7:return rr(e,s,s.pendingProps,l),s.child;case 8:return rr(e,s,s.pendingProps.children,l),s.child;case 12:return rr(e,s,s.pendingProps.children,l),s.child;case 10:return c=s.pendingProps,ii(s,s.type,c.value),rr(e,s,c.children,l),s.child;case 9:return p=s.type._context,c=s.pendingProps.children,Wi(s),p=nr(p),c=c(p),s.flags|=1,rr(e,s,c,l),s.child;case 14:return Kg(e,s,s.type,s.pendingProps,l);case 15:return Yg(e,s,s.type,s.pendingProps,l);case 19:return ry(e,s,l);case 31:return Gw(e,s,l);case 22:return Wg(e,s,l,s.pendingProps);case 24:return Wi(s),c=nr($n),e===null?(p=Kd(),p===null&&(p=xn,g=Vd(),p.pooledCache=g,g.refCount++,g!==null&&(p.pooledCacheLanes|=l),p=g),s.memoizedState={parent:c,cache:p},Wd(s),ii(s,$n,p)):((e.lanes&l)!==0&&(Qd(e,s),eo(s,null,null,l),Zl()),p=e.memoizedState,g=s.memoizedState,p.parent!==c?(p={parent:c,cache:c},s.memoizedState=p,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=p),ii(s,$n,c)):(c=g.cache,ii(s,$n,c),c!==p.cache&&Hd(s,[$n],l,!0))),rr(e,s,s.pendingProps.children,l),s.child;case 29:throw s.pendingProps}throw Error(a(156,s.tag))}function As(e){e.flags|=4}function Rh(e,s,l,c,p){if((s=(e.mode&32)!==0)&&(s=!1),s){if(e.flags|=16777216,(p&335544128)===p)if(e.stateNode.complete)e.flags|=8192;else if(Ry())e.flags|=8192;else throw Xi=Tc,Yd}else e.flags&=-16777217}function iy(e,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!bv(s))if(Ry())e.flags|=8192;else throw Xi=Tc,Yd}function Gc(e,s){s!==null&&(e.flags|=4),e.flags&16384&&(s=e.tag!==22?Pt():536870912,e.lanes|=s,Ga|=s)}function ao(e,s){if(!tn)switch(e.tailMode){case"hidden":s=e.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?s||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Cn(e){var s=e.alternate!==null&&e.alternate.child===e.child,l=0,c=0;if(s)for(var p=e.child;p!==null;)l|=p.lanes|p.childLanes,c|=p.subtreeFlags&65011712,c|=p.flags&65011712,p.return=e,p=p.sibling;else for(p=e.child;p!==null;)l|=p.lanes|p.childLanes,c|=p.subtreeFlags,c|=p.flags,p.return=e,p=p.sibling;return e.subtreeFlags|=c,e.childLanes=l,s}function Yw(e,s,l){var c=s.pendingProps;switch(Bd(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Cn(s),null;case 1:return Cn(s),null;case 3:return l=s.stateNode,c=null,e!==null&&(c=e.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),Ns($n),ge(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(e===null||e.child===null)&&(Da(s)?As(s):e===null||e.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Pd())),Cn(s),null;case 26:var p=s.type,g=s.memoizedState;return e===null?(As(s),g!==null?(Cn(s),iy(s,g)):(Cn(s),Rh(s,p,null,c,l))):g?g!==e.memoizedState?(As(s),Cn(s),iy(s,g)):(Cn(s),s.flags&=-16777217):(e=e.memoizedProps,e!==c&&As(s),Cn(s),Rh(s,p,e,c,l)),null;case 27:if(ae(s),l=Ne.current,p=s.type,e!==null&&s.stateNode!=null)e.memoizedProps!==c&&As(s);else{if(!c){if(s.stateNode===null)throw Error(a(166));return Cn(s),null}e=ve.current,Da(s)?Im(s):(e=hv(p,c,l),s.stateNode=e,As(s))}return Cn(s),null;case 5:if(ae(s),p=s.type,e!==null&&s.stateNode!=null)e.memoizedProps!==c&&As(s);else{if(!c){if(s.stateNode===null)throw Error(a(166));return Cn(s),null}if(g=ve.current,Da(s))Im(s);else{var j=lu(Ne.current);switch(g){case 1:g=j.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:g=j.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":g=j.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":g=j.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":g=j.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof c.is=="string"?j.createElement("select",{is:c.is}):j.createElement("select"),c.multiple?g.multiple=!0:c.size&&(g.size=c.size);break;default:g=typeof c.is=="string"?j.createElement(p,{is:c.is}):j.createElement(p)}}g[$e]=s,g[Ge]=c;e:for(j=s.child;j!==null;){if(j.tag===5||j.tag===6)g.appendChild(j.stateNode);else if(j.tag!==4&&j.tag!==27&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===s)break e;for(;j.sibling===null;){if(j.return===null||j.return===s)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}s.stateNode=g;e:switch(sr(g,p,c),p){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&As(s)}}return Cn(s),Rh(s,s.type,e===null?null:e.memoizedProps,s.pendingProps,l),null;case 6:if(e&&s.stateNode!=null)e.memoizedProps!==c&&As(s);else{if(typeof c!="string"&&s.stateNode===null)throw Error(a(166));if(e=Ne.current,Da(s)){if(e=s.stateNode,l=s.memoizedProps,c=null,p=tr,p!==null)switch(p.tag){case 27:case 5:c=p.memoizedProps}e[$e]=s,e=!!(e.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||tv(e.nodeValue,l)),e||si(s,!0)}else e=lu(e).createTextNode(c),e[$e]=s,s.stateNode=e}return Cn(s),null;case 31:if(l=s.memoizedState,e===null||e.memoizedState!==null){if(c=Da(s),l!==null){if(e===null){if(!c)throw Error(a(318));if(e=s.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(557));e[$e]=s}else Ki(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Cn(s),e=!1}else l=Pd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=l),e=!0;if(!e)return s.flags&256?(Nr(s),s):(Nr(s),null);if((s.flags&128)!==0)throw Error(a(558))}return Cn(s),null;case 13:if(c=s.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(p=Da(s),c!==null&&c.dehydrated!==null){if(e===null){if(!p)throw Error(a(318));if(p=s.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(a(317));p[$e]=s}else Ki(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Cn(s),p=!1}else p=Pd(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=p),p=!0;if(!p)return s.flags&256?(Nr(s),s):(Nr(s),null)}return Nr(s),(s.flags&128)!==0?(s.lanes=l,s):(l=c!==null,e=e!==null&&e.memoizedState!==null,l&&(c=s.child,p=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(p=c.alternate.memoizedState.cachePool.pool),g=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(g=c.memoizedState.cachePool.pool),g!==p&&(c.flags|=2048)),l!==e&&l&&(s.child.flags|=8192),Gc(s,s.updateQueue),Cn(s),null);case 4:return ge(),e===null&&Zh(s.stateNode.containerInfo),Cn(s),null;case 10:return Ns(s.type),Cn(s),null;case 19:if(W(zn),c=s.memoizedState,c===null)return Cn(s),null;if(p=(s.flags&128)!==0,g=c.rendering,g===null)if(p)ao(c,!1);else{if(Dn!==0||e!==null&&(e.flags&128)!==0)for(e=s.child;e!==null;){if(g=Dc(e),g!==null){for(s.flags|=128,ao(c,!1),e=g.updateQueue,s.updateQueue=e,Gc(s,e),s.subtreeFlags=0,e=l,l=s.child;l!==null;)Dm(l,e),l=l.sibling;return ie(zn,zn.current&1|2),tn&&_s(s,c.treeForkCount),s.child}e=e.sibling}c.tail!==null&&gt()>Jc&&(s.flags|=128,p=!0,ao(c,!1),s.lanes=4194304)}else{if(!p)if(e=Dc(g),e!==null){if(s.flags|=128,p=!0,e=e.updateQueue,s.updateQueue=e,Gc(s,e),ao(c,!0),c.tail===null&&c.tailMode==="hidden"&&!g.alternate&&!tn)return Cn(s),null}else 2*gt()-c.renderingStartTime>Jc&&l!==536870912&&(s.flags|=128,p=!0,ao(c,!1),s.lanes=4194304);c.isBackwards?(g.sibling=s.child,s.child=g):(e=c.last,e!==null?e.sibling=g:s.child=g,c.last=g)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=gt(),e.sibling=null,l=zn.current,ie(zn,p?l&1|2:l&1),tn&&_s(s,c.treeForkCount),e):(Cn(s),null);case 22:case 23:return Nr(s),eh(),c=s.memoizedState!==null,e!==null?e.memoizedState!==null!==c&&(s.flags|=8192):c&&(s.flags|=8192),c?(l&536870912)!==0&&(s.flags&128)===0&&(Cn(s),s.subtreeFlags&6&&(s.flags|=8192)):Cn(s),l=s.updateQueue,l!==null&&Gc(s,l.retryQueue),l=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),c=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),c!==l&&(s.flags|=2048),e!==null&&W(Qi),null;case 24:return l=null,e!==null&&(l=e.memoizedState.cache),s.memoizedState.cache!==l&&(s.flags|=2048),Ns($n),Cn(s),null;case 25:return null;case 30:return null}throw Error(a(156,s.tag))}function Ww(e,s){switch(Bd(s),s.tag){case 1:return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 3:return Ns($n),ge(),e=s.flags,(e&65536)!==0&&(e&128)===0?(s.flags=e&-65537|128,s):null;case 26:case 27:case 5:return ae(s),null;case 31:if(s.memoizedState!==null){if(Nr(s),s.alternate===null)throw Error(a(340));Ki()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 13:if(Nr(s),e=s.memoizedState,e!==null&&e.dehydrated!==null){if(s.alternate===null)throw Error(a(340));Ki()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 19:return W(zn),null;case 4:return ge(),null;case 10:return Ns(s.type),null;case 22:case 23:return Nr(s),eh(),e!==null&&W(Qi),e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 24:return Ns($n),null;case 25:return null;default:return null}}function ay(e,s){switch(Bd(s),s.tag){case 3:Ns($n),ge();break;case 26:case 27:case 5:ae(s);break;case 4:ge();break;case 31:s.memoizedState!==null&&Nr(s);break;case 13:Nr(s);break;case 19:W(zn);break;case 10:Ns(s.type);break;case 22:case 23:Nr(s),eh(),e!==null&&W(Qi);break;case 24:Ns($n)}}function lo(e,s){try{var l=s.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var p=c.next;l=p;do{if((l.tag&e)===e){c=void 0;var g=l.create,j=l.inst;c=g(),j.destroy=c}l=l.next}while(l!==p)}}catch(M){pn(s,s.return,M)}}function di(e,s,l){try{var c=s.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var g=p.next;c=g;do{if((c.tag&e)===e){var j=c.inst,M=j.destroy;if(M!==void 0){j.destroy=void 0,p=s;var Y=l,me=M;try{me()}catch(Te){pn(p,Y,Te)}}}c=c.next}while(c!==g)}}catch(Te){pn(s,s.return,Te)}}function ly(e){var s=e.updateQueue;if(s!==null){var l=e.stateNode;try{Jm(s,l)}catch(c){pn(e,e.return,c)}}}function oy(e,s,l){l.props=ta(e.type,e.memoizedProps),l.state=e.memoizedState;try{l.componentWillUnmount()}catch(c){pn(e,s,c)}}function oo(e,s){try{var l=e.ref;if(l!==null){switch(e.tag){case 26:case 27:case 5:var c=e.stateNode;break;case 30:c=e.stateNode;break;default:c=e.stateNode}typeof l=="function"?e.refCleanup=l(c):l.current=c}}catch(p){pn(e,s,p)}}function gs(e,s){var l=e.ref,c=e.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(p){pn(e,s,p)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){pn(e,s,p)}else l.current=null}function cy(e){var s=e.type,l=e.memoizedProps,c=e.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break e;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(p){pn(e,e.return,p)}}function Oh(e,s,l){try{var c=e.stateNode;yS(c,e.type,l,s),c[Ge]=s}catch(p){pn(e,e.return,p)}}function uy(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&vi(e.type)||e.tag===4}function Dh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||uy(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&vi(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Mh(e,s,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,s?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(e,s):(s=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,s.appendChild(e),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Lr));else if(c!==4&&(c===27&&vi(e.type)&&(l=e.stateNode,s=null),e=e.child,e!==null))for(Mh(e,s,l),e=e.sibling;e!==null;)Mh(e,s,l),e=e.sibling}function Kc(e,s,l){var c=e.tag;if(c===5||c===6)e=e.stateNode,s?l.insertBefore(e,s):l.appendChild(e);else if(c!==4&&(c===27&&vi(e.type)&&(l=e.stateNode),e=e.child,e!==null))for(Kc(e,s,l),e=e.sibling;e!==null;)Kc(e,s,l),e=e.sibling}function dy(e){var s=e.stateNode,l=e.memoizedProps;try{for(var c=e.type,p=s.attributes;p.length;)s.removeAttributeNode(p[0]);sr(s,c,l),s[$e]=e,s[Ge]=l}catch(g){pn(e,e.return,g)}}var Rs=!1,Fn=!1,zh=!1,hy=typeof WeakSet=="function"?WeakSet:Set,Qn=null;function Qw(e,s){if(e=e.containerInfo,nf=pu,e=_m(e),kd(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var p=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{l.nodeType,g.nodeType}catch{l=null;break e}var j=0,M=-1,Y=-1,me=0,Te=0,ze=e,ye=null;t:for(;;){for(var we;ze!==l||p!==0&&ze.nodeType!==3||(M=j+p),ze!==g||c!==0&&ze.nodeType!==3||(Y=j+c),ze.nodeType===3&&(j+=ze.nodeValue.length),(we=ze.firstChild)!==null;)ye=ze,ze=we;for(;;){if(ze===e)break t;if(ye===l&&++me===p&&(M=j),ye===g&&++Te===c&&(Y=j),(we=ze.nextSibling)!==null)break;ze=ye,ye=ze.parentNode}ze=we}l=M===-1||Y===-1?null:{start:M,end:Y}}else l=null}l=l||{start:0,end:0}}else l=null;for(rf={focusedElem:e,selectionRange:l},pu=!1,Qn=s;Qn!==null;)if(s=Qn,e=s.child,(s.subtreeFlags&1028)!==0&&e!==null)e.return=s,Qn=e;else for(;Qn!==null;){switch(s=Qn,g=s.alternate,e=s.flags,s.tag){case 0:if((e&4)!==0&&(e=s.updateQueue,e=e!==null?e.events:null,e!==null))for(l=0;l<e.length;l++)p=e[l],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&g!==null){e=void 0,l=s,p=g.memoizedProps,g=g.memoizedState,c=l.stateNode;try{var ft=ta(l.type,p);e=c.getSnapshotBeforeUpdate(ft,g),c.__reactInternalSnapshotBeforeUpdate=e}catch(Tt){pn(l,l.return,Tt)}}break;case 3:if((e&1024)!==0){if(e=s.stateNode.containerInfo,l=e.nodeType,l===9)lf(e);else if(l===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":lf(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(a(163))}if(e=s.sibling,e!==null){e.return=s.return,Qn=e;break}Qn=s.return}}function fy(e,s,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:Ds(e,l),c&4&&lo(5,l);break;case 1:if(Ds(e,l),c&4)if(e=l.stateNode,s===null)try{e.componentDidMount()}catch(j){pn(l,l.return,j)}else{var p=ta(l.type,s.memoizedProps);s=s.memoizedState;try{e.componentDidUpdate(p,s,e.__reactInternalSnapshotBeforeUpdate)}catch(j){pn(l,l.return,j)}}c&64&&ly(l),c&512&&oo(l,l.return);break;case 3:if(Ds(e,l),c&64&&(e=l.updateQueue,e!==null)){if(s=null,l.child!==null)switch(l.child.tag){case 27:case 5:s=l.child.stateNode;break;case 1:s=l.child.stateNode}try{Jm(e,s)}catch(j){pn(l,l.return,j)}}break;case 27:s===null&&c&4&&dy(l);case 26:case 5:Ds(e,l),s===null&&c&4&&cy(l),c&512&&oo(l,l.return);break;case 12:Ds(e,l);break;case 31:Ds(e,l),c&4&&gy(e,l);break;case 13:Ds(e,l),c&4&&yy(e,l),c&64&&(e=l.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(l=iS.bind(null,l),CS(e,l))));break;case 22:if(c=l.memoizedState!==null||Rs,!c){s=s!==null&&s.memoizedState!==null||Fn,p=Rs;var g=Fn;Rs=c,(Fn=s)&&!g?Ms(e,l,(l.subtreeFlags&8772)!==0):Ds(e,l),Rs=p,Fn=g}break;case 30:break;default:Ds(e,l)}}function py(e){var s=e.alternate;s!==null&&(e.alternate=null,py(s)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(s=e.stateNode,s!==null&&qe(s)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var kn=null,mr=!1;function Os(e,s,l){for(l=l.child;l!==null;)my(e,s,l),l=l.sibling}function my(e,s,l){if(rn&&typeof rn.onCommitFiberUnmount=="function")try{rn.onCommitFiberUnmount(Ht,l)}catch{}switch(l.tag){case 26:Fn||gs(l,s),Os(e,s,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Fn||gs(l,s);var c=kn,p=mr;vi(l.type)&&(kn=l.stateNode,mr=!1),Os(e,s,l),vo(l.stateNode),kn=c,mr=p;break;case 5:Fn||gs(l,s);case 6:if(c=kn,p=mr,kn=null,Os(e,s,l),kn=c,mr=p,kn!==null)if(mr)try{(kn.nodeType===9?kn.body:kn.nodeName==="HTML"?kn.ownerDocument.body:kn).removeChild(l.stateNode)}catch(g){pn(l,s,g)}else try{kn.removeChild(l.stateNode)}catch(g){pn(l,s,g)}break;case 18:kn!==null&&(mr?(e=kn,lv(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,l.stateNode),el(e)):lv(kn,l.stateNode));break;case 4:c=kn,p=mr,kn=l.stateNode.containerInfo,mr=!0,Os(e,s,l),kn=c,mr=p;break;case 0:case 11:case 14:case 15:di(2,l,s),Fn||di(4,l,s),Os(e,s,l);break;case 1:Fn||(gs(l,s),c=l.stateNode,typeof c.componentWillUnmount=="function"&&oy(l,s,c)),Os(e,s,l);break;case 21:Os(e,s,l);break;case 22:Fn=(c=Fn)||l.memoizedState!==null,Os(e,s,l),Fn=c;break;default:Os(e,s,l)}}function gy(e,s){if(s.memoizedState===null&&(e=s.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{el(e)}catch(l){pn(s,s.return,l)}}}function yy(e,s){if(s.memoizedState===null&&(e=s.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{el(e)}catch(l){pn(s,s.return,l)}}function Jw(e){switch(e.tag){case 31:case 13:case 19:var s=e.stateNode;return s===null&&(s=e.stateNode=new hy),s;case 22:return e=e.stateNode,s=e._retryCache,s===null&&(s=e._retryCache=new hy),s;default:throw Error(a(435,e.tag))}}function Yc(e,s){var l=Jw(e);s.forEach(function(c){if(!l.has(c)){l.add(c);var p=aS.bind(null,e,c);c.then(p,p)}})}function gr(e,s){var l=s.deletions;if(l!==null)for(var c=0;c<l.length;c++){var p=l[c],g=e,j=s,M=j;e:for(;M!==null;){switch(M.tag){case 27:if(vi(M.type)){kn=M.stateNode,mr=!1;break e}break;case 5:kn=M.stateNode,mr=!1;break e;case 3:case 4:kn=M.stateNode.containerInfo,mr=!0;break e}M=M.return}if(kn===null)throw Error(a(160));my(g,j,p),kn=null,mr=!1,g=p.alternate,g!==null&&(g.return=null),p.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)vy(s,e),s=s.sibling}var rs=null;function vy(e,s){var l=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:gr(s,e),yr(e),c&4&&(di(3,e,e.return),lo(3,e),di(5,e,e.return));break;case 1:gr(s,e),yr(e),c&512&&(Fn||l===null||gs(l,l.return)),c&64&&Rs&&(e=e.updateQueue,e!==null&&(c=e.callbacks,c!==null&&(l=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var p=rs;if(gr(s,e),yr(e),c&512&&(Fn||l===null||gs(l,l.return)),c&4){var g=l!==null?l.memoizedState:null;if(c=e.memoizedState,l===null)if(c===null)if(e.stateNode===null){e:{c=e.type,l=e.memoizedProps,p=p.ownerDocument||p;t:switch(c){case"title":g=p.getElementsByTagName("title")[0],(!g||g[Le]||g[$e]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=p.createElement(c),p.head.insertBefore(g,p.querySelector("head > title"))),sr(g,c,l),g[$e]=e,It(g),c=g;break e;case"link":var j=vv("link","href",p).get(c+(l.href||""));if(j){for(var M=0;M<j.length;M++)if(g=j[M],g.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&g.getAttribute("rel")===(l.rel==null?null:l.rel)&&g.getAttribute("title")===(l.title==null?null:l.title)&&g.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){j.splice(M,1);break t}}g=p.createElement(c),sr(g,c,l),p.head.appendChild(g);break;case"meta":if(j=vv("meta","content",p).get(c+(l.content||""))){for(M=0;M<j.length;M++)if(g=j[M],g.getAttribute("content")===(l.content==null?null:""+l.content)&&g.getAttribute("name")===(l.name==null?null:l.name)&&g.getAttribute("property")===(l.property==null?null:l.property)&&g.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&g.getAttribute("charset")===(l.charSet==null?null:l.charSet)){j.splice(M,1);break t}}g=p.createElement(c),sr(g,c,l),p.head.appendChild(g);break;default:throw Error(a(468,c))}g[$e]=e,It(g),c=g}e.stateNode=c}else xv(p,e.type,e.stateNode);else e.stateNode=yv(p,c,e.memoizedProps);else g!==c?(g===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):g.count--,c===null?xv(p,e.type,e.stateNode):yv(p,c,e.memoizedProps)):c===null&&e.stateNode!==null&&Oh(e,e.memoizedProps,l.memoizedProps)}break;case 27:gr(s,e),yr(e),c&512&&(Fn||l===null||gs(l,l.return)),l!==null&&c&4&&Oh(e,e.memoizedProps,l.memoizedProps);break;case 5:if(gr(s,e),yr(e),c&512&&(Fn||l===null||gs(l,l.return)),e.flags&32){p=e.stateNode;try{Qs(p,"")}catch(ft){pn(e,e.return,ft)}}c&4&&e.stateNode!=null&&(p=e.memoizedProps,Oh(e,p,l!==null?l.memoizedProps:p)),c&1024&&(zh=!0);break;case 6:if(gr(s,e),yr(e),c&4){if(e.stateNode===null)throw Error(a(162));c=e.memoizedProps,l=e.stateNode;try{l.nodeValue=c}catch(ft){pn(e,e.return,ft)}}break;case 3:if(uu=null,p=rs,rs=ou(s.containerInfo),gr(s,e),rs=p,yr(e),c&4&&l!==null&&l.memoizedState.isDehydrated)try{el(s.containerInfo)}catch(ft){pn(e,e.return,ft)}zh&&(zh=!1,xy(e));break;case 4:c=rs,rs=ou(e.stateNode.containerInfo),gr(s,e),yr(e),rs=c;break;case 12:gr(s,e),yr(e);break;case 31:gr(s,e),yr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Yc(e,c)));break;case 13:gr(s,e),yr(e),e.child.flags&8192&&e.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(Qc=gt()),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Yc(e,c)));break;case 22:p=e.memoizedState!==null;var Y=l!==null&&l.memoizedState!==null,me=Rs,Te=Fn;if(Rs=me||p,Fn=Te||Y,gr(s,e),Fn=Te,Rs=me,yr(e),c&8192)e:for(s=e.stateNode,s._visibility=p?s._visibility&-2:s._visibility|1,p&&(l===null||Y||Rs||Fn||na(e)),l=null,s=e;;){if(s.tag===5||s.tag===26){if(l===null){Y=l=s;try{if(g=Y.stateNode,p)j=g.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none";else{M=Y.stateNode;var ze=Y.memoizedProps.style,ye=ze!=null&&ze.hasOwnProperty("display")?ze.display:null;M.style.display=ye==null||typeof ye=="boolean"?"":(""+ye).trim()}}catch(ft){pn(Y,Y.return,ft)}}}else if(s.tag===6){if(l===null){Y=s;try{Y.stateNode.nodeValue=p?"":Y.memoizedProps}catch(ft){pn(Y,Y.return,ft)}}}else if(s.tag===18){if(l===null){Y=s;try{var we=Y.stateNode;p?ov(we,!0):ov(Y.stateNode,!1)}catch(ft){pn(Y,Y.return,ft)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===e)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;l===s&&(l=null),s=s.return}l===s&&(l=null),s.sibling.return=s.return,s=s.sibling}c&4&&(c=e.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,Yc(e,l))));break;case 19:gr(s,e),yr(e),c&4&&(c=e.updateQueue,c!==null&&(e.updateQueue=null,Yc(e,c)));break;case 30:break;case 21:break;default:gr(s,e),yr(e)}}function yr(e){var s=e.flags;if(s&2){try{for(var l,c=e.return;c!==null;){if(uy(c)){l=c;break}c=c.return}if(l==null)throw Error(a(160));switch(l.tag){case 27:var p=l.stateNode,g=Dh(e);Kc(e,g,p);break;case 5:var j=l.stateNode;l.flags&32&&(Qs(j,""),l.flags&=-33);var M=Dh(e);Kc(e,M,j);break;case 3:case 4:var Y=l.stateNode.containerInfo,me=Dh(e);Mh(e,me,Y);break;default:throw Error(a(161))}}catch(Te){pn(e,e.return,Te)}e.flags&=-3}s&4096&&(e.flags&=-4097)}function xy(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var s=e;xy(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),e=e.sibling}}function Ds(e,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)fy(e,s.alternate,s),s=s.sibling}function na(e){for(e=e.child;e!==null;){var s=e;switch(s.tag){case 0:case 11:case 14:case 15:di(4,s,s.return),na(s);break;case 1:gs(s,s.return);var l=s.stateNode;typeof l.componentWillUnmount=="function"&&oy(s,s.return,l),na(s);break;case 27:vo(s.stateNode);case 26:case 5:gs(s,s.return),na(s);break;case 22:s.memoizedState===null&&na(s);break;case 30:na(s);break;default:na(s)}e=e.sibling}}function Ms(e,s,l){for(l=l&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var c=s.alternate,p=e,g=s,j=g.flags;switch(g.tag){case 0:case 11:case 15:Ms(p,g,l),lo(4,g);break;case 1:if(Ms(p,g,l),c=g,p=c.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(me){pn(c,c.return,me)}if(c=g,p=c.updateQueue,p!==null){var M=c.stateNode;try{var Y=p.shared.hiddenCallbacks;if(Y!==null)for(p.shared.hiddenCallbacks=null,p=0;p<Y.length;p++)Qm(Y[p],M)}catch(me){pn(c,c.return,me)}}l&&j&64&&ly(g),oo(g,g.return);break;case 27:dy(g);case 26:case 5:Ms(p,g,l),l&&c===null&&j&4&&cy(g),oo(g,g.return);break;case 12:Ms(p,g,l);break;case 31:Ms(p,g,l),l&&j&4&&gy(p,g);break;case 13:Ms(p,g,l),l&&j&4&&yy(p,g);break;case 22:g.memoizedState===null&&Ms(p,g,l),oo(g,g.return);break;case 30:break;default:Ms(p,g,l)}s=s.sibling}}function Lh(e,s){var l=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(l=e.memoizedState.cachePool.pool),e=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(e=s.memoizedState.cachePool.pool),e!==l&&(e!=null&&e.refCount++,l!=null&&Yl(l))}function Uh(e,s){e=null,s.alternate!==null&&(e=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==e&&(s.refCount++,e!=null&&Yl(e))}function ss(e,s,l,c){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)by(e,s,l,c),s=s.sibling}function by(e,s,l,c){var p=s.flags;switch(s.tag){case 0:case 11:case 15:ss(e,s,l,c),p&2048&&lo(9,s);break;case 1:ss(e,s,l,c);break;case 3:ss(e,s,l,c),p&2048&&(e=null,s.alternate!==null&&(e=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==e&&(s.refCount++,e!=null&&Yl(e)));break;case 12:if(p&2048){ss(e,s,l,c),e=s.stateNode;try{var g=s.memoizedProps,j=g.id,M=g.onPostCommit;typeof M=="function"&&M(j,s.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(Y){pn(s,s.return,Y)}}else ss(e,s,l,c);break;case 31:ss(e,s,l,c);break;case 13:ss(e,s,l,c);break;case 23:break;case 22:g=s.stateNode,j=s.alternate,s.memoizedState!==null?g._visibility&2?ss(e,s,l,c):co(e,s):g._visibility&2?ss(e,s,l,c):(g._visibility|=2,Fa(e,s,l,c,(s.subtreeFlags&10256)!==0||!1)),p&2048&&Lh(j,s);break;case 24:ss(e,s,l,c),p&2048&&Uh(s.alternate,s);break;default:ss(e,s,l,c)}}function Fa(e,s,l,c,p){for(p=p&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var g=e,j=s,M=l,Y=c,me=j.flags;switch(j.tag){case 0:case 11:case 15:Fa(g,j,M,Y,p),lo(8,j);break;case 23:break;case 22:var Te=j.stateNode;j.memoizedState!==null?Te._visibility&2?Fa(g,j,M,Y,p):co(g,j):(Te._visibility|=2,Fa(g,j,M,Y,p)),p&&me&2048&&Lh(j.alternate,j);break;case 24:Fa(g,j,M,Y,p),p&&me&2048&&Uh(j.alternate,j);break;default:Fa(g,j,M,Y,p)}s=s.sibling}}function co(e,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var l=e,c=s,p=c.flags;switch(c.tag){case 22:co(l,c),p&2048&&Lh(c.alternate,c);break;case 24:co(l,c),p&2048&&Uh(c.alternate,c);break;default:co(l,c)}s=s.sibling}}var uo=8192;function Ha(e,s,l){if(e.subtreeFlags&uo)for(e=e.child;e!==null;)wy(e,s,l),e=e.sibling}function wy(e,s,l){switch(e.tag){case 26:Ha(e,s,l),e.flags&uo&&e.memoizedState!==null&&US(l,rs,e.memoizedState,e.memoizedProps);break;case 5:Ha(e,s,l);break;case 3:case 4:var c=rs;rs=ou(e.stateNode.containerInfo),Ha(e,s,l),rs=c;break;case 22:e.memoizedState===null&&(c=e.alternate,c!==null&&c.memoizedState!==null?(c=uo,uo=16777216,Ha(e,s,l),uo=c):Ha(e,s,l));break;default:Ha(e,s,l)}}function Sy(e){var s=e.alternate;if(s!==null&&(e=s.child,e!==null)){s.child=null;do s=e.sibling,e.sibling=null,e=s;while(e!==null)}}function ho(e){var s=e.deletions;if((e.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var c=s[l];Qn=c,_y(c,e)}Sy(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)jy(e),e=e.sibling}function jy(e){switch(e.tag){case 0:case 11:case 15:ho(e),e.flags&2048&&di(9,e,e.return);break;case 3:ho(e);break;case 12:ho(e);break;case 22:var s=e.stateNode;e.memoizedState!==null&&s._visibility&2&&(e.return===null||e.return.tag!==13)?(s._visibility&=-3,Wc(e)):ho(e);break;default:ho(e)}}function Wc(e){var s=e.deletions;if((e.flags&16)!==0){if(s!==null)for(var l=0;l<s.length;l++){var c=s[l];Qn=c,_y(c,e)}Sy(e)}for(e=e.child;e!==null;){switch(s=e,s.tag){case 0:case 11:case 15:di(8,s,s.return),Wc(s);break;case 22:l=s.stateNode,l._visibility&2&&(l._visibility&=-3,Wc(s));break;default:Wc(s)}e=e.sibling}}function _y(e,s){for(;Qn!==null;){var l=Qn;switch(l.tag){case 0:case 11:case 15:di(8,l,s);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Yl(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,Qn=c;else e:for(l=e;Qn!==null;){c=Qn;var p=c.sibling,g=c.return;if(py(c),c===l){Qn=null;break e}if(p!==null){p.return=g,Qn=p;break e}Qn=g}}}var Xw={getCacheForType:function(e){var s=nr($n),l=s.data.get(e);return l===void 0&&(l=e(),s.data.set(e,l)),l},cacheSignal:function(){return nr($n).controller.signal}},Zw=typeof WeakMap=="function"?WeakMap:Map,cn=0,xn=null,Wt=null,Zt=0,fn=0,Er=null,hi=!1,Va=!1,Ih=!1,zs=0,Dn=0,fi=0,ra=0,Bh=0,kr=0,Ga=0,fo=null,vr=null,$h=!1,Qc=0,Cy=0,Jc=1/0,Xc=null,pi=null,Vn=0,mi=null,Ka=null,Ls=0,Ph=0,qh=null,Ny=null,po=0,Fh=null;function Tr(){return(cn&2)!==0&&Zt!==0?Zt&-Zt:k.T!==null?Wh():Vt()}function Ey(){if(kr===0)if((Zt&536870912)===0||tn){var e=ke;ke<<=1,(ke&3932160)===0&&(ke=262144),kr=e}else kr=536870912;return e=Cr.current,e!==null&&(e.flags|=32),kr}function xr(e,s,l){(e===xn&&(fn===2||fn===9)||e.cancelPendingCommit!==null)&&(Ya(e,0),gi(e,Zt,kr,!1)),he(e,l),((cn&2)===0||e!==xn)&&(e===xn&&((cn&2)===0&&(ra|=l),Dn===4&&gi(e,Zt,kr,!1)),ys(e))}function ky(e,s,l){if((cn&6)!==0)throw Error(a(327));var c=!l&&(s&127)===0&&(s&e.expiredLanes)===0||bt(e,s),p=c?nS(e,s):Vh(e,s,!0),g=c;do{if(p===0){Va&&!c&&gi(e,s,0,!1);break}else{if(l=e.current.alternate,g&&!eS(l)){p=Vh(e,s,!1),g=!1;continue}if(p===2){if(g=s,e.errorRecoveryDisabledLanes&g)var j=0;else j=e.pendingLanes&-536870913,j=j!==0?j:j&536870912?536870912:0;if(j!==0){s=j;e:{var M=e;p=fo;var Y=M.current.memoizedState.isDehydrated;if(Y&&(Ya(M,j).flags|=256),j=Vh(M,j,!1),j!==2){if(Ih&&!Y){M.errorRecoveryDisabledLanes|=g,ra|=g,p=4;break e}g=vr,vr=p,g!==null&&(vr===null?vr=g:vr.push.apply(vr,g))}p=j}if(g=!1,p!==2)continue}}if(p===1){Ya(e,0),gi(e,s,0,!0);break}e:{switch(c=e,g=p,g){case 0:case 1:throw Error(a(345));case 4:if((s&4194048)!==s)break;case 6:gi(c,s,kr,!hi);break e;case 2:vr=null;break;case 3:case 5:break;default:throw Error(a(329))}if((s&62914560)===s&&(p=Qc+300-gt(),10<p)){if(gi(c,s,kr,!hi),lt(c,0,!0)!==0)break e;Ls=s,c.timeoutHandle=iv(Ty.bind(null,c,l,vr,Xc,$h,s,kr,ra,Ga,hi,g,"Throttled",-0,0),p);break e}Ty(c,l,vr,Xc,$h,s,kr,ra,Ga,hi,g,null,-0,0)}}break}while(!0);ys(e)}function Ty(e,s,l,c,p,g,j,M,Y,me,Te,ze,ye,we){if(e.timeoutHandle=-1,ze=s.subtreeFlags,ze&8192||(ze&16785408)===16785408){ze={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Lr},wy(s,g,ze);var ft=(g&62914560)===g?Qc-gt():(g&4194048)===g?Cy-gt():0;if(ft=IS(ze,ft),ft!==null){Ls=g,e.cancelPendingCommit=ft(Uy.bind(null,e,s,g,l,c,p,j,M,Y,Te,ze,null,ye,we)),gi(e,g,j,!me);return}}Uy(e,s,g,l,c,p,j,M,Y)}function eS(e){for(var s=e;;){var l=s.tag;if((l===0||l===11||l===15)&&s.flags&16384&&(l=s.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var p=l[c],g=p.getSnapshot;p=p.value;try{if(!jr(g(),p))return!1}catch{return!1}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function gi(e,s,l,c){s&=~Bh,s&=~ra,e.suspendedLanes|=s,e.pingedLanes&=~s,c&&(e.warmLanes|=s),c=e.expirationTimes;for(var p=s;0<p;){var g=31-Kt(p),j=1<<g;c[g]=-1,p&=~j}l!==0&&ht(e,l,s)}function Zc(){return(cn&6)===0?(mo(0),!1):!0}function Hh(){if(Wt!==null){if(fn===0)var e=Wt.return;else e=Wt,Cs=Yi=null,ah(e),Ia=null,Ql=0,e=Wt;for(;e!==null;)ay(e.alternate,e),e=e.return;Wt=null}}function Ya(e,s){var l=e.timeoutHandle;l!==-1&&(e.timeoutHandle=-1,bS(l)),l=e.cancelPendingCommit,l!==null&&(e.cancelPendingCommit=null,l()),Ls=0,Hh(),xn=e,Wt=l=js(e.current,null),Zt=s,fn=0,Er=null,hi=!1,Va=bt(e,s),Ih=!1,Ga=kr=Bh=ra=fi=Dn=0,vr=fo=null,$h=!1,(s&8)!==0&&(s|=s&32);var c=e.entangledLanes;if(c!==0)for(e=e.entanglements,c&=s;0<c;){var p=31-Kt(c),g=1<<p;s|=e[p],c&=~g}return zs=s,bc(),l}function Ay(e,s){Ft=null,k.H=so,s===Ua||s===kc?(s=Gm(),fn=3):s===Yd?(s=Gm(),fn=4):fn=s===Sh?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Er=s,Wt===null&&(Dn=1,qc(e,Br(s,e.current)))}function Ry(){var e=Cr.current;return e===null?!0:(Zt&4194048)===Zt?Fr===null:(Zt&62914560)===Zt||(Zt&536870912)!==0?e===Fr:!1}function Oy(){var e=k.H;return k.H=so,e===null?so:e}function Dy(){var e=k.A;return k.A=Xw,e}function eu(){Dn=4,hi||(Zt&4194048)!==Zt&&Cr.current!==null||(Va=!0),(fi&134217727)===0&&(ra&134217727)===0||xn===null||gi(xn,Zt,kr,!1)}function Vh(e,s,l){var c=cn;cn|=2;var p=Oy(),g=Dy();(xn!==e||Zt!==s)&&(Xc=null,Ya(e,s)),s=!1;var j=Dn;e:do try{if(fn!==0&&Wt!==null){var M=Wt,Y=Er;switch(fn){case 8:Hh(),j=6;break e;case 3:case 2:case 9:case 6:Cr.current===null&&(s=!0);var me=fn;if(fn=0,Er=null,Wa(e,M,Y,me),l&&Va){j=0;break e}break;default:me=fn,fn=0,Er=null,Wa(e,M,Y,me)}}tS(),j=Dn;break}catch(Te){Ay(e,Te)}while(!0);return s&&e.shellSuspendCounter++,Cs=Yi=null,cn=c,k.H=p,k.A=g,Wt===null&&(xn=null,Zt=0,bc()),j}function tS(){for(;Wt!==null;)My(Wt)}function nS(e,s){var l=cn;cn|=2;var c=Oy(),p=Dy();xn!==e||Zt!==s?(Xc=null,Jc=gt()+500,Ya(e,s)):Va=bt(e,s);e:do try{if(fn!==0&&Wt!==null){s=Wt;var g=Er;t:switch(fn){case 1:fn=0,Er=null,Wa(e,s,g,1);break;case 2:case 9:if(Hm(g)){fn=0,Er=null,zy(s);break}s=function(){fn!==2&&fn!==9||xn!==e||(fn=7),ys(e)},g.then(s,s);break e;case 3:fn=7;break e;case 4:fn=5;break e;case 7:Hm(g)?(fn=0,Er=null,zy(s)):(fn=0,Er=null,Wa(e,s,g,7));break;case 5:var j=null;switch(Wt.tag){case 26:j=Wt.memoizedState;case 5:case 27:var M=Wt;if(j?bv(j):M.stateNode.complete){fn=0,Er=null;var Y=M.sibling;if(Y!==null)Wt=Y;else{var me=M.return;me!==null?(Wt=me,tu(me)):Wt=null}break t}}fn=0,Er=null,Wa(e,s,g,5);break;case 6:fn=0,Er=null,Wa(e,s,g,6);break;case 8:Hh(),Dn=6;break e;default:throw Error(a(462))}}rS();break}catch(Te){Ay(e,Te)}while(!0);return Cs=Yi=null,k.H=c,k.A=p,cn=l,Wt!==null?0:(xn=null,Zt=0,bc(),Dn)}function rS(){for(;Wt!==null&&!Pe();)My(Wt)}function My(e){var s=sy(e.alternate,e,zs);e.memoizedProps=e.pendingProps,s===null?tu(e):Wt=s}function zy(e){var s=e,l=s.alternate;switch(s.tag){case 15:case 0:s=Xg(l,s,s.pendingProps,s.type,void 0,Zt);break;case 11:s=Xg(l,s,s.pendingProps,s.type.render,s.ref,Zt);break;case 5:ah(s);default:ay(l,s),s=Wt=Dm(s,zs),s=sy(l,s,zs)}e.memoizedProps=e.pendingProps,s===null?tu(e):Wt=s}function Wa(e,s,l,c){Cs=Yi=null,ah(s),Ia=null,Ql=0;var p=s.return;try{if(Vw(e,p,s,l,Zt)){Dn=1,qc(e,Br(l,e.current)),Wt=null;return}}catch(g){if(p!==null)throw Wt=p,g;Dn=1,qc(e,Br(l,e.current)),Wt=null;return}s.flags&32768?(tn||c===1?e=!0:Va||(Zt&536870912)!==0?e=!1:(hi=e=!0,(c===2||c===9||c===3||c===6)&&(c=Cr.current,c!==null&&c.tag===13&&(c.flags|=16384))),Ly(s,e)):tu(s)}function tu(e){var s=e;do{if((s.flags&32768)!==0){Ly(s,hi);return}e=s.return;var l=Yw(s.alternate,s,zs);if(l!==null){Wt=l;return}if(s=s.sibling,s!==null){Wt=s;return}Wt=s=e}while(s!==null);Dn===0&&(Dn=5)}function Ly(e,s){do{var l=Ww(e.alternate,e);if(l!==null){l.flags&=32767,Wt=l;return}if(l=e.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!s&&(e=e.sibling,e!==null)){Wt=e;return}Wt=e=l}while(e!==null);Dn=6,Wt=null}function Uy(e,s,l,c,p,g,j,M,Y){e.cancelPendingCommit=null;do nu();while(Vn!==0);if((cn&6)!==0)throw Error(a(327));if(s!==null){if(s===e.current)throw Error(a(177));if(g=s.lanes|s.childLanes,g|=Dd,Ye(e,l,g,j,M,Y),e===xn&&(Wt=xn=null,Zt=0),Ka=s,mi=e,Ls=l,Ph=g,qh=p,Ny=c,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,lS(tt,function(){return qy(),null})):(e.callbackNode=null,e.callbackPriority=0),c=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||c){c=k.T,k.T=null,p=L.p,L.p=2,j=cn,cn|=4;try{Qw(e,s,l)}finally{cn=j,L.p=p,k.T=c}}Vn=1,Iy(),By(),$y()}}function Iy(){if(Vn===1){Vn=0;var e=mi,s=Ka,l=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||l){l=k.T,k.T=null;var c=L.p;L.p=2;var p=cn;cn|=4;try{vy(s,e);var g=rf,j=_m(e.containerInfo),M=g.focusedElem,Y=g.selectionRange;if(j!==M&&M&&M.ownerDocument&&jm(M.ownerDocument.documentElement,M)){if(Y!==null&&kd(M)){var me=Y.start,Te=Y.end;if(Te===void 0&&(Te=me),"selectionStart"in M)M.selectionStart=me,M.selectionEnd=Math.min(Te,M.value.length);else{var ze=M.ownerDocument||document,ye=ze&&ze.defaultView||window;if(ye.getSelection){var we=ye.getSelection(),ft=M.textContent.length,Tt=Math.min(Y.start,ft),vn=Y.end===void 0?Tt:Math.min(Y.end,ft);!we.extend&&Tt>vn&&(j=vn,vn=Tt,Tt=j);var ue=Sm(M,Tt),re=Sm(M,vn);if(ue&&re&&(we.rangeCount!==1||we.anchorNode!==ue.node||we.anchorOffset!==ue.offset||we.focusNode!==re.node||we.focusOffset!==re.offset)){var pe=ze.createRange();pe.setStart(ue.node,ue.offset),we.removeAllRanges(),Tt>vn?(we.addRange(pe),we.extend(re.node,re.offset)):(pe.setEnd(re.node,re.offset),we.addRange(pe))}}}}for(ze=[],we=M;we=we.parentNode;)we.nodeType===1&&ze.push({element:we,left:we.scrollLeft,top:we.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<ze.length;M++){var Me=ze[M];Me.element.scrollLeft=Me.left,Me.element.scrollTop=Me.top}}pu=!!nf,rf=nf=null}finally{cn=p,L.p=c,k.T=l}}e.current=s,Vn=2}}function By(){if(Vn===2){Vn=0;var e=mi,s=Ka,l=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||l){l=k.T,k.T=null;var c=L.p;L.p=2;var p=cn;cn|=4;try{fy(e,s.alternate,s)}finally{cn=p,L.p=c,k.T=l}}Vn=3}}function $y(){if(Vn===4||Vn===3){Vn=0,dt();var e=mi,s=Ka,l=Ls,c=Ny;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Vn=5:(Vn=0,Ka=mi=null,Py(e,e.pendingLanes));var p=e.pendingLanes;if(p===0&&(pi=null),Dt(l),s=s.stateNode,rn&&typeof rn.onCommitFiberRoot=="function")try{rn.onCommitFiberRoot(Ht,s,void 0,(s.current.flags&128)===128)}catch{}if(c!==null){s=k.T,p=L.p,L.p=2,k.T=null;try{for(var g=e.onRecoverableError,j=0;j<c.length;j++){var M=c[j];g(M.value,{componentStack:M.stack})}}finally{k.T=s,L.p=p}}(Ls&3)!==0&&nu(),ys(e),p=e.pendingLanes,(l&261930)!==0&&(p&42)!==0?e===Fh?po++:(po=0,Fh=e):po=0,mo(0)}}function Py(e,s){(e.pooledCacheLanes&=s)===0&&(s=e.pooledCache,s!=null&&(e.pooledCache=null,Yl(s)))}function nu(){return Iy(),By(),$y(),qy()}function qy(){if(Vn!==5)return!1;var e=mi,s=Ph;Ph=0;var l=Dt(Ls),c=k.T,p=L.p;try{L.p=32>l?32:l,k.T=null,l=qh,qh=null;var g=mi,j=Ls;if(Vn=0,Ka=mi=null,Ls=0,(cn&6)!==0)throw Error(a(331));var M=cn;if(cn|=4,jy(g.current),by(g,g.current,j,l),cn=M,mo(0,!1),rn&&typeof rn.onPostCommitFiberRoot=="function")try{rn.onPostCommitFiberRoot(Ht,g)}catch{}return!0}finally{L.p=p,k.T=c,Py(e,s)}}function Fy(e,s,l){s=Br(l,s),s=wh(e.stateNode,s,2),e=oi(e,s,2),e!==null&&(he(e,2),ys(e))}function pn(e,s,l){if(e.tag===3)Fy(e,e,l);else for(;s!==null;){if(s.tag===3){Fy(s,e,l);break}else if(s.tag===1){var c=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(pi===null||!pi.has(c))){e=Br(l,e),l=Hg(2),c=oi(s,l,2),c!==null&&(Vg(l,c,s,e),he(c,2),ys(c));break}}s=s.return}}function Gh(e,s,l){var c=e.pingCache;if(c===null){c=e.pingCache=new Zw;var p=new Set;c.set(s,p)}else p=c.get(s),p===void 0&&(p=new Set,c.set(s,p));p.has(l)||(Ih=!0,p.add(l),e=sS.bind(null,e,s,l),s.then(e,e))}function sS(e,s,l){var c=e.pingCache;c!==null&&c.delete(s),e.pingedLanes|=e.suspendedLanes&l,e.warmLanes&=~l,xn===e&&(Zt&l)===l&&(Dn===4||Dn===3&&(Zt&62914560)===Zt&&300>gt()-Qc?(cn&2)===0&&Ya(e,0):Bh|=l,Ga===Zt&&(Ga=0)),ys(e)}function Hy(e,s){s===0&&(s=Pt()),e=Vi(e,s),e!==null&&(he(e,s),ys(e))}function iS(e){var s=e.memoizedState,l=0;s!==null&&(l=s.retryLane),Hy(e,l)}function aS(e,s){var l=0;switch(e.tag){case 31:case 13:var c=e.stateNode,p=e.memoizedState;p!==null&&(l=p.retryLane);break;case 19:c=e.stateNode;break;case 22:c=e.stateNode._retryCache;break;default:throw Error(a(314))}c!==null&&c.delete(s),Hy(e,l)}function lS(e,s){return Ee(e,s)}var ru=null,Qa=null,Kh=!1,su=!1,Yh=!1,yi=0;function ys(e){e!==Qa&&e.next===null&&(Qa===null?ru=Qa=e:Qa=Qa.next=e),su=!0,Kh||(Kh=!0,cS())}function mo(e,s){if(!Yh&&su){Yh=!0;do for(var l=!1,c=ru;c!==null;){if(e!==0){var p=c.pendingLanes;if(p===0)var g=0;else{var j=c.suspendedLanes,M=c.pingedLanes;g=(1<<31-Kt(42|e)+1)-1,g&=p&~(j&~M),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(l=!0,Yy(c,g))}else g=Zt,g=lt(c,c===xn?g:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(g&3)===0||bt(c,g)||(l=!0,Yy(c,g));c=c.next}while(l);Yh=!1}}function oS(){Vy()}function Vy(){su=Kh=!1;var e=0;yi!==0&&xS()&&(e=yi);for(var s=gt(),l=null,c=ru;c!==null;){var p=c.next,g=Gy(c,s);g===0?(c.next=null,l===null?ru=p:l.next=p,p===null&&(Qa=l)):(l=c,(e!==0||(g&3)!==0)&&(su=!0)),c=p}Vn!==0&&Vn!==5||mo(e),yi!==0&&(yi=0)}function Gy(e,s){for(var l=e.suspendedLanes,c=e.pingedLanes,p=e.expirationTimes,g=e.pendingLanes&-62914561;0<g;){var j=31-Kt(g),M=1<<j,Y=p[j];Y===-1?((M&l)===0||(M&c)!==0)&&(p[j]=Lt(M,s)):Y<=s&&(e.expiredLanes|=M),g&=~M}if(s=xn,l=Zt,l=lt(e,e===s?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c=e.callbackNode,l===0||e===s&&(fn===2||fn===9)||e.cancelPendingCommit!==null)return c!==null&&c!==null&&se(c),e.callbackNode=null,e.callbackPriority=0;if((l&3)===0||bt(e,l)){if(s=l&-l,s===e.callbackPriority)return s;switch(c!==null&&se(c),Dt(l)){case 2:case 8:l=it;break;case 32:l=tt;break;case 268435456:l=qt;break;default:l=tt}return c=Ky.bind(null,e),l=Ee(l,c),e.callbackPriority=s,e.callbackNode=l,s}return c!==null&&c!==null&&se(c),e.callbackPriority=2,e.callbackNode=null,2}function Ky(e,s){if(Vn!==0&&Vn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var l=e.callbackNode;if(nu()&&e.callbackNode!==l)return null;var c=Zt;return c=lt(e,e===xn?c:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),c===0?null:(ky(e,c,s),Gy(e,gt()),e.callbackNode!=null&&e.callbackNode===l?Ky.bind(null,e):null)}function Yy(e,s){if(nu())return null;ky(e,s,!0)}function cS(){wS(function(){(cn&6)!==0?Ee(Qe,oS):Vy()})}function Wh(){if(yi===0){var e=za;e===0&&(e=De,De<<=1,(De&261888)===0&&(De=256)),yi=e}return yi}function Wy(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Ca(""+e)}function Qy(e,s){var l=s.ownerDocument.createElement("input");return l.name=s.name,l.value=s.value,e.id&&l.setAttribute("form",e.id),s.parentNode.insertBefore(l,s),e=new FormData(e),l.parentNode.removeChild(l),e}function uS(e,s,l,c,p){if(s==="submit"&&l&&l.stateNode===p){var g=Wy((p[Ge]||null).action),j=c.submitter;j&&(s=(s=j[Ge]||null)?Wy(s.formAction):j.getAttribute("formAction"),s!==null&&(g=s,j=null));var M=new xt("action","action",null,c,p);e.push({event:M,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(yi!==0){var Y=j?Qy(p,j):new FormData(p);mh(l,{pending:!0,data:Y,method:p.method,action:g},null,Y)}}else typeof g=="function"&&(M.preventDefault(),Y=j?Qy(p,j):new FormData(p),mh(l,{pending:!0,data:Y,method:p.method,action:g},g,Y))},currentTarget:p}]})}}for(var Qh=0;Qh<Od.length;Qh++){var Jh=Od[Qh],dS=Jh.toLowerCase(),hS=Jh[0].toUpperCase()+Jh.slice(1);ns(dS,"on"+hS)}ns(Em,"onAnimationEnd"),ns(km,"onAnimationIteration"),ns(Tm,"onAnimationStart"),ns("dblclick","onDoubleClick"),ns("focusin","onFocus"),ns("focusout","onBlur"),ns(kw,"onTransitionRun"),ns(Tw,"onTransitionStart"),ns(Aw,"onTransitionCancel"),ns(Am,"onTransitionEnd"),dn("onMouseEnter",["mouseout","mouseover"]),dn("onMouseLeave",["mouseout","mouseover"]),dn("onPointerEnter",["pointerout","pointerover"]),dn("onPointerLeave",["pointerout","pointerover"]),Xt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Xt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Xt("onBeforeInput",["compositionend","keypress","textInput","paste"]),Xt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Xt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Xt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var go="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(go));function Jy(e,s){s=(s&4)!==0;for(var l=0;l<e.length;l++){var c=e[l],p=c.event;c=c.listeners;e:{var g=void 0;if(s)for(var j=c.length-1;0<=j;j--){var M=c[j],Y=M.instance,me=M.currentTarget;if(M=M.listener,Y!==g&&p.isPropagationStopped())break e;g=M,p.currentTarget=me;try{g(p)}catch(Te){xc(Te)}p.currentTarget=null,g=Y}else for(j=0;j<c.length;j++){if(M=c[j],Y=M.instance,me=M.currentTarget,M=M.listener,Y!==g&&p.isPropagationStopped())break e;g=M,p.currentTarget=me;try{g(p)}catch(Te){xc(Te)}p.currentTarget=null,g=Y}}}}function Qt(e,s){var l=s[J];l===void 0&&(l=s[J]=new Set);var c=e+"__bubble";l.has(c)||(Xy(s,e,2,!1),l.add(c))}function Xh(e,s,l){var c=0;s&&(c|=4),Xy(l,e,c,s)}var iu="_reactListening"+Math.random().toString(36).slice(2);function Zh(e){if(!e[iu]){e[iu]=!0,rt.forEach(function(l){l!=="selectionchange"&&(fS.has(l)||Xh(l,!1,e),Xh(l,!0,e))});var s=e.nodeType===9?e:e.ownerDocument;s===null||s[iu]||(s[iu]=!0,Xh("selectionchange",!1,s))}}function Xy(e,s,l,c){switch(Ev(s)){case 2:var p=PS;break;case 8:p=qS;break;default:p=mf}l=p.bind(null,s,l,e),p=void 0,!B||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(p=!0),c?p!==void 0?e.addEventListener(s,l,{capture:!0,passive:p}):e.addEventListener(s,l,!0):p!==void 0?e.addEventListener(s,l,{passive:p}):e.addEventListener(s,l,!1)}function ef(e,s,l,c,p){var g=c;if((s&1)===0&&(s&2)===0&&c!==null)e:for(;;){if(c===null)return;var j=c.tag;if(j===3||j===4){var M=c.stateNode.containerInfo;if(M===p)break;if(j===4)for(j=c.return;j!==null;){var Y=j.tag;if((Y===3||Y===4)&&j.stateNode.containerInfo===p)return;j=j.return}for(;M!==null;){if(j=Ze(M),j===null)return;if(Y=j.tag,Y===5||Y===6||Y===26||Y===27){c=g=j;continue e}M=M.parentNode}}c=c.return}Pi(function(){var me=g,Te=Ul(l),ze=[];e:{var ye=Rm.get(e);if(ye!==void 0){var we=xt,ft=e;switch(e){case"keypress":if(Ke(l)===0)break e;case"keydown":case"keyup":we=aw;break;case"focusin":ft="focus",we=Tn;break;case"focusout":ft="blur",we=Tn;break;case"beforeblur":case"afterblur":we=Tn;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":we=vt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":we=zt;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":we=cw;break;case Em:case km:case Tm:we=Yt;break;case Am:we=dw;break;case"scroll":case"scrollend":we=Ut;break;case"wheel":we=fw;break;case"copy":case"cut":case"paste":we=An;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":we=om;break;case"toggle":case"beforetoggle":we=mw}var Tt=(s&4)!==0,vn=!Tt&&(e==="scroll"||e==="scrollend"),ue=Tt?ye!==null?ye+"Capture":null:ye;Tt=[];for(var re=me,pe;re!==null;){var Me=re;if(pe=Me.stateNode,Me=Me.tag,Me!==5&&Me!==26&&Me!==27||pe===null||ue===null||(Me=Zs(re,ue),Me!=null&&Tt.push(yo(re,Me,pe))),vn)break;re=re.return}0<Tt.length&&(ye=new we(ye,ft,null,l,Te),ze.push({event:ye,listeners:Tt}))}}if((s&7)===0){e:{if(ye=e==="mouseover"||e==="pointerover",we=e==="mouseout"||e==="pointerout",ye&&l!==Ll&&(ft=l.relatedTarget||l.fromElement)&&(Ze(ft)||ft[Et]))break e;if((we||ye)&&(ye=Te.window===Te?Te:(ye=Te.ownerDocument)?ye.defaultView||ye.parentWindow:window,we?(ft=l.relatedTarget||l.toElement,we=me,ft=ft?Ze(ft):null,ft!==null&&(vn=u(ft),Tt=ft.tag,ft!==vn||Tt!==5&&Tt!==27&&Tt!==6)&&(ft=null)):(we=null,ft=me),we!==ft)){if(Tt=vt,Me="onMouseLeave",ue="onMouseEnter",re="mouse",(e==="pointerout"||e==="pointerover")&&(Tt=om,Me="onPointerLeave",ue="onPointerEnter",re="pointer"),vn=we==null?ye:Ct(we),pe=ft==null?ye:Ct(ft),ye=new Tt(Me,re+"leave",we,l,Te),ye.target=vn,ye.relatedTarget=pe,Me=null,Ze(Te)===me&&(Tt=new Tt(ue,re+"enter",ft,l,Te),Tt.target=pe,Tt.relatedTarget=vn,Me=Tt),vn=Me,we&&ft)t:{for(Tt=pS,ue=we,re=ft,pe=0,Me=ue;Me;Me=Tt(Me))pe++;Me=0;for(var St=re;St;St=Tt(St))Me++;for(;0<pe-Me;)ue=Tt(ue),pe--;for(;0<Me-pe;)re=Tt(re),Me--;for(;pe--;){if(ue===re||re!==null&&ue===re.alternate){Tt=ue;break t}ue=Tt(ue),re=Tt(re)}Tt=null}else Tt=null;we!==null&&Zy(ze,ye,we,Tt,!1),ft!==null&&vn!==null&&Zy(ze,vn,ft,Tt,!0)}}e:{if(ye=me?Ct(me):window,we=ye.nodeName&&ye.nodeName.toLowerCase(),we==="select"||we==="input"&&ye.type==="file")var ln=gm;else if(pm(ye))if(ym)ln=Cw;else{ln=jw;var yt=Sw}else we=ye.nodeName,!we||we.toLowerCase()!=="input"||ye.type!=="checkbox"&&ye.type!=="radio"?me&&zl(me.elementType)&&(ln=gm):ln=_w;if(ln&&(ln=ln(e,me))){mm(ze,ln,l,Te);break e}yt&&yt(e,ye,me),e==="focusout"&&me&&ye.type==="number"&&me.memoizedProps.value!=null&&Ol(ye,"number",ye.value)}switch(yt=me?Ct(me):window,e){case"focusin":(pm(yt)||yt.contentEditable==="true")&&(Ea=yt,Td=me,Vl=null);break;case"focusout":Vl=Td=Ea=null;break;case"mousedown":Ad=!0;break;case"contextmenu":case"mouseup":case"dragend":Ad=!1,Cm(ze,l,Te);break;case"selectionchange":if(Ew)break;case"keydown":case"keyup":Cm(ze,l,Te)}var Gt;if(Cd)e:{switch(e){case"compositionstart":var en="onCompositionStart";break e;case"compositionend":en="onCompositionEnd";break e;case"compositionupdate":en="onCompositionUpdate";break e}en=void 0}else Na?hm(e,l)&&(en="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(en="onCompositionStart");en&&(cm&&l.locale!=="ko"&&(Na||en!=="onCompositionStart"?en==="onCompositionEnd"&&Na&&(Gt=Be()):(ne=Te,be="value"in ne?ne.value:ne.textContent,Na=!0)),yt=au(me,en),0<yt.length&&(en=new ts(en,e,null,l,Te),ze.push({event:en,listeners:yt}),Gt?en.data=Gt:(Gt=fm(l),Gt!==null&&(en.data=Gt)))),(Gt=yw?vw(e,l):xw(e,l))&&(en=au(me,"onBeforeInput"),0<en.length&&(yt=new ts("onBeforeInput","beforeinput",null,l,Te),ze.push({event:yt,listeners:en}),yt.data=Gt)),uS(ze,e,me,l,Te)}Jy(ze,s)})}function yo(e,s,l){return{instance:e,listener:s,currentTarget:l}}function au(e,s){for(var l=s+"Capture",c=[];e!==null;){var p=e,g=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||g===null||(p=Zs(e,l),p!=null&&c.unshift(yo(e,p,g)),p=Zs(e,s),p!=null&&c.push(yo(e,p,g))),e.tag===3)return c;e=e.return}return[]}function pS(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function Zy(e,s,l,c,p){for(var g=s._reactName,j=[];l!==null&&l!==c;){var M=l,Y=M.alternate,me=M.stateNode;if(M=M.tag,Y!==null&&Y===c)break;M!==5&&M!==26&&M!==27||me===null||(Y=me,p?(me=Zs(l,g),me!=null&&j.unshift(yo(l,me,Y))):p||(me=Zs(l,g),me!=null&&j.push(yo(l,me,Y)))),l=l.return}j.length!==0&&e.push({event:s,listeners:j})}var mS=/\r\n?/g,gS=/\u0000|\uFFFD/g;function ev(e){return(typeof e=="string"?e:""+e).replace(mS,`
`).replace(gS,"")}function tv(e,s){return s=ev(s),ev(e)===s}function yn(e,s,l,c,p,g){switch(l){case"children":typeof c=="string"?s==="body"||s==="textarea"&&c===""||Qs(e,c):(typeof c=="number"||typeof c=="bigint")&&s!=="body"&&Qs(e,""+c);break;case"className":Ws(e,"class",c);break;case"tabIndex":Ws(e,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Ws(e,l,c);break;case"style":Ml(e,c,g);break;case"data":if(s!=="object"){Ws(e,"data",c);break}case"src":case"href":if(c===""&&(s!=="a"||l!=="href")){e.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=Ca(""+c),e.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){e.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(l==="formAction"?(s!=="input"&&yn(e,s,"name",p.name,p,null),yn(e,s,"formEncType",p.formEncType,p,null),yn(e,s,"formMethod",p.formMethod,p,null),yn(e,s,"formTarget",p.formTarget,p,null)):(yn(e,s,"encType",p.encType,p,null),yn(e,s,"method",p.method,p,null),yn(e,s,"target",p.target,p,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){e.removeAttribute(l);break}c=Ca(""+c),e.setAttribute(l,c);break;case"onClick":c!=null&&(e.onclick=Lr);break;case"onScroll":c!=null&&Qt("scroll",e);break;case"onScrollEnd":c!=null&&Qt("scrollend",e);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(p.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"multiple":e.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":e.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){e.removeAttribute("xlink:href");break}l=Ca(""+c),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""+c):e.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,""):e.removeAttribute(l);break;case"capture":case"download":c===!0?e.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?e.setAttribute(l,c):e.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?e.setAttribute(l,c):e.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?e.removeAttribute(l):e.setAttribute(l,c);break;case"popover":Qt("beforetoggle",e),Qt("toggle",e),Ii(e,"popover",c);break;case"xlinkActuate":Xr(e,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Xr(e,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Xr(e,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Xr(e,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Xr(e,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Xr(e,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Xr(e,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Ii(e,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=_d.get(l)||l,Ii(e,l,c))}}function tf(e,s,l,c,p,g){switch(l){case"style":Ml(e,c,g);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(a(61));if(l=c.__html,l!=null){if(p.children!=null)throw Error(a(60));e.innerHTML=l}}break;case"children":typeof c=="string"?Qs(e,c):(typeof c=="number"||typeof c=="bigint")&&Qs(e,""+c);break;case"onScroll":c!=null&&Qt("scroll",e);break;case"onScrollEnd":c!=null&&Qt("scrollend",e);break;case"onClick":c!=null&&(e.onclick=Lr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!kt.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),s=l.slice(2,p?l.length-7:void 0),g=e[Ge]||null,g=g!=null?g[l]:null,typeof g=="function"&&e.removeEventListener(s,g,p),typeof c=="function")){typeof g!="function"&&g!==null&&(l in e?e[l]=null:e.hasAttribute(l)&&e.removeAttribute(l)),e.addEventListener(s,c,p);break e}l in e?e[l]=c:c===!0?e.setAttribute(l,""):Ii(e,l,c)}}}function sr(e,s,l){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Qt("error",e),Qt("load",e);var c=!1,p=!1,g;for(g in l)if(l.hasOwnProperty(g)){var j=l[g];if(j!=null)switch(g){case"src":c=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,s));default:yn(e,s,g,j,l,null)}}p&&yn(e,s,"srcSet",l.srcSet,l,null),c&&yn(e,s,"src",l.src,l,null);return;case"input":Qt("invalid",e);var M=g=j=p=null,Y=null,me=null;for(c in l)if(l.hasOwnProperty(c)){var Te=l[c];if(Te!=null)switch(c){case"name":p=Te;break;case"type":j=Te;break;case"checked":Y=Te;break;case"defaultChecked":me=Te;break;case"value":g=Te;break;case"defaultValue":M=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(a(137,s));break;default:yn(e,s,c,Te,l,null)}}pc(e,g,M,Y,me,j,p,!1);return;case"select":Qt("invalid",e),c=j=g=null;for(p in l)if(l.hasOwnProperty(p)&&(M=l[p],M!=null))switch(p){case"value":g=M;break;case"defaultValue":j=M;break;case"multiple":c=M;default:yn(e,s,p,M,l,null)}s=g,l=j,e.multiple=!!c,s!=null?zr(e,!!c,s,!1):l!=null&&zr(e,!!c,l,!0);return;case"textarea":Qt("invalid",e),g=p=c=null;for(j in l)if(l.hasOwnProperty(j)&&(M=l[j],M!=null))switch(j){case"value":c=M;break;case"defaultValue":p=M;break;case"children":g=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(a(91));break;default:yn(e,s,j,M,l,null)}gc(e,c,p,g);return;case"option":for(Y in l)l.hasOwnProperty(Y)&&(c=l[Y],c!=null)&&(Y==="selected"?e.selected=c&&typeof c!="function"&&typeof c!="symbol":yn(e,s,Y,c,l,null));return;case"dialog":Qt("beforetoggle",e),Qt("toggle",e),Qt("cancel",e),Qt("close",e);break;case"iframe":case"object":Qt("load",e);break;case"video":case"audio":for(c=0;c<go.length;c++)Qt(go[c],e);break;case"image":Qt("error",e),Qt("load",e);break;case"details":Qt("toggle",e);break;case"embed":case"source":case"link":Qt("error",e),Qt("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(me in l)if(l.hasOwnProperty(me)&&(c=l[me],c!=null))switch(me){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,s));default:yn(e,s,me,c,l,null)}return;default:if(zl(s)){for(Te in l)l.hasOwnProperty(Te)&&(c=l[Te],c!==void 0&&tf(e,s,Te,c,l,void 0));return}}for(M in l)l.hasOwnProperty(M)&&(c=l[M],c!=null&&yn(e,s,M,c,l,null))}function yS(e,s,l,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,g=null,j=null,M=null,Y=null,me=null,Te=null;for(we in l){var ze=l[we];if(l.hasOwnProperty(we)&&ze!=null)switch(we){case"checked":break;case"value":break;case"defaultValue":Y=ze;default:c.hasOwnProperty(we)||yn(e,s,we,null,c,ze)}}for(var ye in c){var we=c[ye];if(ze=l[ye],c.hasOwnProperty(ye)&&(we!=null||ze!=null))switch(ye){case"type":g=we;break;case"name":p=we;break;case"checked":me=we;break;case"defaultChecked":Te=we;break;case"value":j=we;break;case"defaultValue":M=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(a(137,s));break;default:we!==ze&&yn(e,s,ye,we,c,ze)}}$i(e,j,M,Y,me,Te,g,p);return;case"select":we=j=M=ye=null;for(g in l)if(Y=l[g],l.hasOwnProperty(g)&&Y!=null)switch(g){case"value":break;case"multiple":we=Y;default:c.hasOwnProperty(g)||yn(e,s,g,null,c,Y)}for(p in c)if(g=c[p],Y=l[p],c.hasOwnProperty(p)&&(g!=null||Y!=null))switch(p){case"value":ye=g;break;case"defaultValue":M=g;break;case"multiple":j=g;default:g!==Y&&yn(e,s,p,g,c,Y)}s=M,l=j,c=we,ye!=null?zr(e,!!l,ye,!1):!!c!=!!l&&(s!=null?zr(e,!!l,s,!0):zr(e,!!l,l?[]:"",!1));return;case"textarea":we=ye=null;for(M in l)if(p=l[M],l.hasOwnProperty(M)&&p!=null&&!c.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:yn(e,s,M,null,c,p)}for(j in c)if(p=c[j],g=l[j],c.hasOwnProperty(j)&&(p!=null||g!=null))switch(j){case"value":ye=p;break;case"defaultValue":we=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(a(91));break;default:p!==g&&yn(e,s,j,p,c,g)}mc(e,ye,we);return;case"option":for(var ft in l)ye=l[ft],l.hasOwnProperty(ft)&&ye!=null&&!c.hasOwnProperty(ft)&&(ft==="selected"?e.selected=!1:yn(e,s,ft,null,c,ye));for(Y in c)ye=c[Y],we=l[Y],c.hasOwnProperty(Y)&&ye!==we&&(ye!=null||we!=null)&&(Y==="selected"?e.selected=ye&&typeof ye!="function"&&typeof ye!="symbol":yn(e,s,Y,ye,c,we));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Tt in l)ye=l[Tt],l.hasOwnProperty(Tt)&&ye!=null&&!c.hasOwnProperty(Tt)&&yn(e,s,Tt,null,c,ye);for(me in c)if(ye=c[me],we=l[me],c.hasOwnProperty(me)&&ye!==we&&(ye!=null||we!=null))switch(me){case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(a(137,s));break;default:yn(e,s,me,ye,c,we)}return;default:if(zl(s)){for(var vn in l)ye=l[vn],l.hasOwnProperty(vn)&&ye!==void 0&&!c.hasOwnProperty(vn)&&tf(e,s,vn,void 0,c,ye);for(Te in c)ye=c[Te],we=l[Te],!c.hasOwnProperty(Te)||ye===we||ye===void 0&&we===void 0||tf(e,s,Te,ye,c,we);return}}for(var ue in l)ye=l[ue],l.hasOwnProperty(ue)&&ye!=null&&!c.hasOwnProperty(ue)&&yn(e,s,ue,null,c,ye);for(ze in c)ye=c[ze],we=l[ze],!c.hasOwnProperty(ze)||ye===we||ye==null&&we==null||yn(e,s,ze,ye,c,we)}function nv(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function vS(){if(typeof performance.getEntriesByType=="function"){for(var e=0,s=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var p=l[c],g=p.transferSize,j=p.initiatorType,M=p.duration;if(g&&M&&nv(j)){for(j=0,M=p.responseEnd,c+=1;c<l.length;c++){var Y=l[c],me=Y.startTime;if(me>M)break;var Te=Y.transferSize,ze=Y.initiatorType;Te&&nv(ze)&&(Y=Y.responseEnd,j+=Te*(Y<M?1:(M-me)/(Y-me)))}if(--c,s+=8*(g+j)/(p.duration/1e3),e++,10<e)break}}if(0<e)return s/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var nf=null,rf=null;function lu(e){return e.nodeType===9?e:e.ownerDocument}function rv(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function sv(e,s){if(e===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&s==="foreignObject"?0:e}function sf(e,s){return e==="textarea"||e==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var af=null;function xS(){var e=window.event;return e&&e.type==="popstate"?e===af?!1:(af=e,!0):(af=null,!1)}var iv=typeof setTimeout=="function"?setTimeout:void 0,bS=typeof clearTimeout=="function"?clearTimeout:void 0,av=typeof Promise=="function"?Promise:void 0,wS=typeof queueMicrotask=="function"?queueMicrotask:typeof av<"u"?function(e){return av.resolve(null).then(e).catch(SS)}:iv;function SS(e){setTimeout(function(){throw e})}function vi(e){return e==="head"}function lv(e,s){var l=s,c=0;do{var p=l.nextSibling;if(e.removeChild(l),p&&p.nodeType===8)if(l=p.data,l==="/$"||l==="/&"){if(c===0){e.removeChild(p),el(s);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")vo(e.ownerDocument.documentElement);else if(l==="head"){l=e.ownerDocument.head,vo(l);for(var g=l.firstChild;g;){var j=g.nextSibling,M=g.nodeName;g[Le]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&g.rel.toLowerCase()==="stylesheet"||l.removeChild(g),g=j}}else l==="body"&&vo(e.ownerDocument.body);l=p}while(l);el(s)}function ov(e,s){var l=e;e=0;do{var c=l.nextSibling;if(l.nodeType===1?s?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(s?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(e===0)break;e--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||e++;l=c}while(l)}function lf(e){var s=e.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var l=s;switch(s=s.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":lf(l),qe(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}e.removeChild(l)}}function jS(e,s,l,c){for(;e.nodeType===1;){var p=l;if(e.nodeName.toLowerCase()!==s.toLowerCase()){if(!c&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(c){if(!e[Le])switch(s){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(g=e.getAttribute("rel"),g==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(g!==p.rel||e.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||e.getAttribute("title")!==(p.title==null?null:p.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(g=e.getAttribute("src"),(g!==(p.src==null?null:p.src)||e.getAttribute("type")!==(p.type==null?null:p.type)||e.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&g&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(s==="input"&&e.type==="hidden"){var g=p.name==null?null:""+p.name;if(p.type==="hidden"&&e.getAttribute("name")===g)return e}else return e;if(e=Hr(e.nextSibling),e===null)break}return null}function _S(e,s,l){if(s==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!l||(e=Hr(e.nextSibling),e===null))return null;return e}function cv(e,s){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!s||(e=Hr(e.nextSibling),e===null))return null;return e}function of(e){return e.data==="$?"||e.data==="$~"}function cf(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function CS(e,s){var l=e.ownerDocument;if(e.data==="$~")e._reactRetry=s;else if(e.data!=="$?"||l.readyState!=="loading")s();else{var c=function(){s(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),e._reactRetry=c}}function Hr(e){for(;e!=null;e=e.nextSibling){var s=e.nodeType;if(s===1||s===3)break;if(s===8){if(s=e.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return e}var uf=null;function uv(e){e=e.nextSibling;for(var s=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"||l==="/&"){if(s===0)return Hr(e.nextSibling);s--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||s++}e=e.nextSibling}return null}function dv(e){e=e.previousSibling;for(var s=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(s===0)return e;s--}else l!=="/$"&&l!=="/&"||s++}e=e.previousSibling}return null}function hv(e,s,l){switch(s=lu(l),e){case"html":if(e=s.documentElement,!e)throw Error(a(452));return e;case"head":if(e=s.head,!e)throw Error(a(453));return e;case"body":if(e=s.body,!e)throw Error(a(454));return e;default:throw Error(a(451))}}function vo(e){for(var s=e.attributes;s.length;)e.removeAttributeNode(s[0]);qe(e)}var Vr=new Map,fv=new Set;function ou(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Us=L.d;L.d={f:NS,r:ES,D:kS,C:TS,L:AS,m:RS,X:DS,S:OS,M:MS};function NS(){var e=Us.f(),s=Zc();return e||s}function ES(e){var s=Xe(e);s!==null&&s.tag===5&&s.type==="form"?Ag(s):Us.r(e)}var Ja=typeof document>"u"?null:document;function pv(e,s,l){var c=Ja;if(c&&typeof s=="string"&&s){var p=pr(s);p='link[rel="'+e+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),fv.has(p)||(fv.add(p),e={rel:e,crossOrigin:l,href:s},c.querySelector(p)===null&&(s=c.createElement("link"),sr(s,"link",e),It(s),c.head.appendChild(s)))}}function kS(e){Us.D(e),pv("dns-prefetch",e,null)}function TS(e,s){Us.C(e,s),pv("preconnect",e,s)}function AS(e,s,l){Us.L(e,s,l);var c=Ja;if(c&&e&&s){var p='link[rel="preload"][as="'+pr(s)+'"]';s==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+pr(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+pr(l.imageSizes)+'"]')):p+='[href="'+pr(e)+'"]';var g=p;switch(s){case"style":g=Xa(e);break;case"script":g=Za(e)}Vr.has(g)||(e=v({rel:"preload",href:s==="image"&&l&&l.imageSrcSet?void 0:e,as:s},l),Vr.set(g,e),c.querySelector(p)!==null||s==="style"&&c.querySelector(xo(g))||s==="script"&&c.querySelector(bo(g))||(s=c.createElement("link"),sr(s,"link",e),It(s),c.head.appendChild(s)))}}function RS(e,s){Us.m(e,s);var l=Ja;if(l&&e){var c=s&&typeof s.as=="string"?s.as:"script",p='link[rel="modulepreload"][as="'+pr(c)+'"][href="'+pr(e)+'"]',g=p;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=Za(e)}if(!Vr.has(g)&&(e=v({rel:"modulepreload",href:e},s),Vr.set(g,e),l.querySelector(p)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(bo(g)))return}c=l.createElement("link"),sr(c,"link",e),It(c),l.head.appendChild(c)}}}function OS(e,s,l){Us.S(e,s,l);var c=Ja;if(c&&e){var p=Nt(c).hoistableStyles,g=Xa(e);s=s||"default";var j=p.get(g);if(!j){var M={loading:0,preload:null};if(j=c.querySelector(xo(g)))M.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":s},l),(l=Vr.get(g))&&df(e,l);var Y=j=c.createElement("link");It(Y),sr(Y,"link",e),Y._p=new Promise(function(me,Te){Y.onload=me,Y.onerror=Te}),Y.addEventListener("load",function(){M.loading|=1}),Y.addEventListener("error",function(){M.loading|=2}),M.loading|=4,cu(j,s,c)}j={type:"stylesheet",instance:j,count:1,state:M},p.set(g,j)}}}function DS(e,s){Us.X(e,s);var l=Ja;if(l&&e){var c=Nt(l).hoistableScripts,p=Za(e),g=c.get(p);g||(g=l.querySelector(bo(p)),g||(e=v({src:e,async:!0},s),(s=Vr.get(p))&&hf(e,s),g=l.createElement("script"),It(g),sr(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function MS(e,s){Us.M(e,s);var l=Ja;if(l&&e){var c=Nt(l).hoistableScripts,p=Za(e),g=c.get(p);g||(g=l.querySelector(bo(p)),g||(e=v({src:e,async:!0,type:"module"},s),(s=Vr.get(p))&&hf(e,s),g=l.createElement("script"),It(g),sr(g,"link",e),l.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},c.set(p,g))}}function mv(e,s,l,c){var p=(p=Ne.current)?ou(p):null;if(!p)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(s=Xa(l.href),l=Nt(p).hoistableStyles,c=l.get(s),c||(c={type:"style",instance:null,count:0,state:null},l.set(s,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){e=Xa(l.href);var g=Nt(p).hoistableStyles,j=g.get(e);if(j||(p=p.ownerDocument||p,j={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(e,j),(g=p.querySelector(xo(e)))&&!g._p&&(j.instance=g,j.state.loading=5),Vr.has(e)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Vr.set(e,l),g||zS(p,e,l,j.state))),s&&c===null)throw Error(a(528,""));return j}if(s&&c!==null)throw Error(a(529,""));return null;case"script":return s=l.async,l=l.src,typeof l=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Za(l),l=Nt(p).hoistableScripts,c=l.get(s),c||(c={type:"script",instance:null,count:0,state:null},l.set(s,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function Xa(e){return'href="'+pr(e)+'"'}function xo(e){return'link[rel="stylesheet"]['+e+"]"}function gv(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function zS(e,s,l,c){e.querySelector('link[rel="preload"][as="style"]['+s+"]")?c.loading=1:(s=e.createElement("link"),c.preload=s,s.addEventListener("load",function(){return c.loading|=1}),s.addEventListener("error",function(){return c.loading|=2}),sr(s,"link",l),It(s),e.head.appendChild(s))}function Za(e){return'[src="'+pr(e)+'"]'}function bo(e){return"script[async]"+e}function yv(e,s,l){if(s.count++,s.instance===null)switch(s.type){case"style":var c=e.querySelector('style[data-href~="'+pr(l.href)+'"]');if(c)return s.instance=c,It(c),c;var p=v({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(e.ownerDocument||e).createElement("style"),It(c),sr(c,"style",p),cu(c,l.precedence,e),s.instance=c;case"stylesheet":p=Xa(l.href);var g=e.querySelector(xo(p));if(g)return s.state.loading|=4,s.instance=g,It(g),g;c=gv(l),(p=Vr.get(p))&&df(c,p),g=(e.ownerDocument||e).createElement("link"),It(g);var j=g;return j._p=new Promise(function(M,Y){j.onload=M,j.onerror=Y}),sr(g,"link",c),s.state.loading|=4,cu(g,l.precedence,e),s.instance=g;case"script":return g=Za(l.src),(p=e.querySelector(bo(g)))?(s.instance=p,It(p),p):(c=l,(p=Vr.get(g))&&(c=v({},l),hf(c,p)),e=e.ownerDocument||e,p=e.createElement("script"),It(p),sr(p,"link",c),e.head.appendChild(p),s.instance=p);case"void":return null;default:throw Error(a(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(c=s.instance,s.state.loading|=4,cu(c,l.precedence,e));return s.instance}function cu(e,s,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=c.length?c[c.length-1]:null,g=p,j=0;j<c.length;j++){var M=c[j];if(M.dataset.precedence===s)g=M;else if(g!==p)break}g?g.parentNode.insertBefore(e,g.nextSibling):(s=l.nodeType===9?l.head:l,s.insertBefore(e,s.firstChild))}function df(e,s){e.crossOrigin==null&&(e.crossOrigin=s.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=s.referrerPolicy),e.title==null&&(e.title=s.title)}function hf(e,s){e.crossOrigin==null&&(e.crossOrigin=s.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=s.referrerPolicy),e.integrity==null&&(e.integrity=s.integrity)}var uu=null;function vv(e,s,l){if(uu===null){var c=new Map,p=uu=new Map;p.set(l,c)}else p=uu,c=p.get(l),c||(c=new Map,p.set(l,c));if(c.has(e))return c;for(c.set(e,null),l=l.getElementsByTagName(e),p=0;p<l.length;p++){var g=l[p];if(!(g[Le]||g[$e]||e==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var j=g.getAttribute(s)||"";j=e+j;var M=c.get(j);M?M.push(g):c.set(j,[g])}}return c}function xv(e,s,l){e=e.ownerDocument||e,e.head.insertBefore(l,s==="title"?e.querySelector("head > title"):null)}function LS(e,s,l){if(l===1||s.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(e=s.disabled,typeof s.precedence=="string"&&e==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function bv(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function US(e,s,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var p=Xa(c.href),g=s.querySelector(xo(p));if(g){s=g._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(e.count++,e=du.bind(e),s.then(e,e)),l.state.loading|=4,l.instance=g,It(g);return}g=s.ownerDocument||s,c=gv(c),(p=Vr.get(p))&&df(c,p),g=g.createElement("link"),It(g);var j=g;j._p=new Promise(function(M,Y){j.onload=M,j.onerror=Y}),sr(g,"link",c),l.instance=g}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(l,s),(s=l.state.preload)&&(l.state.loading&3)===0&&(e.count++,l=du.bind(e),s.addEventListener("load",l),s.addEventListener("error",l))}}var ff=0;function IS(e,s){return e.stylesheets&&e.count===0&&fu(e,e.stylesheets),0<e.count||0<e.imgCount?function(l){var c=setTimeout(function(){if(e.stylesheets&&fu(e,e.stylesheets),e.unsuspend){var g=e.unsuspend;e.unsuspend=null,g()}},6e4+s);0<e.imgBytes&&ff===0&&(ff=62500*vS());var p=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&fu(e,e.stylesheets),e.unsuspend)){var g=e.unsuspend;e.unsuspend=null,g()}},(e.imgBytes>ff?50:800)+s);return e.unsuspend=l,function(){e.unsuspend=null,clearTimeout(c),clearTimeout(p)}}:null}function du(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)fu(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var hu=null;function fu(e,s){e.stylesheets=null,e.unsuspend!==null&&(e.count++,hu=new Map,s.forEach(BS,e),hu=null,du.call(e))}function BS(e,s){if(!(s.state.loading&4)){var l=hu.get(e);if(l)var c=l.get(null);else{l=new Map,hu.set(e,l);for(var p=e.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<p.length;g++){var j=p[g];(j.nodeName==="LINK"||j.getAttribute("media")!=="not all")&&(l.set(j.dataset.precedence,j),c=j)}c&&l.set(null,c)}p=s.instance,j=p.getAttribute("data-precedence"),g=l.get(j)||c,g===c&&l.set(null,p),l.set(j,p),this.count++,c=du.bind(this),p.addEventListener("load",c),p.addEventListener("error",c),g?g.parentNode.insertBefore(p,g.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(p,e.firstChild)),s.state.loading|=4}}var wo={$$typeof:z,Provider:null,Consumer:null,_currentValue:H,_currentValue2:H,_threadCount:0};function $S(e,s,l,c,p,g,j,M,Y){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=hn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=hn(0),this.hiddenUpdates=hn(null),this.identifierPrefix=c,this.onUncaughtError=p,this.onCaughtError=g,this.onRecoverableError=j,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Y,this.incompleteTransitions=new Map}function wv(e,s,l,c,p,g,j,M,Y,me,Te,ze){return e=new $S(e,s,l,j,Y,me,Te,ze,M),s=1,g===!0&&(s|=24),g=_r(3,null,null,s),e.current=g,g.stateNode=e,s=Vd(),s.refCount++,e.pooledCache=s,s.refCount++,g.memoizedState={element:c,isDehydrated:l,cache:s},Wd(g),e}function Sv(e){return e?(e=Aa,e):Aa}function jv(e,s,l,c,p,g){p=Sv(p),c.context===null?c.context=p:c.pendingContext=p,c=li(s),c.payload={element:l},g=g===void 0?null:g,g!==null&&(c.callback=g),l=oi(e,c,s),l!==null&&(xr(l,e,s),Xl(l,e,s))}function _v(e,s){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<s?l:s}}function pf(e,s){_v(e,s),(e=e.alternate)&&_v(e,s)}function Cv(e){if(e.tag===13||e.tag===31){var s=Vi(e,67108864);s!==null&&xr(s,e,67108864),pf(e,67108864)}}function Nv(e){if(e.tag===13||e.tag===31){var s=Tr();s=jt(s);var l=Vi(e,s);l!==null&&xr(l,e,s),pf(e,s)}}var pu=!0;function PS(e,s,l,c){var p=k.T;k.T=null;var g=L.p;try{L.p=2,mf(e,s,l,c)}finally{L.p=g,k.T=p}}function qS(e,s,l,c){var p=k.T;k.T=null;var g=L.p;try{L.p=8,mf(e,s,l,c)}finally{L.p=g,k.T=p}}function mf(e,s,l,c){if(pu){var p=gf(c);if(p===null)ef(e,s,c,mu,l),kv(e,c);else if(HS(p,e,s,l,c))c.stopPropagation();else if(kv(e,c),s&4&&-1<FS.indexOf(e)){for(;p!==null;){var g=Xe(p);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var j=Ve(g.pendingLanes);if(j!==0){var M=g;for(M.pendingLanes|=2,M.entangledLanes|=2;j;){var Y=1<<31-Kt(j);M.entanglements[1]|=Y,j&=~Y}ys(g),(cn&6)===0&&(Jc=gt()+500,mo(0))}}break;case 31:case 13:M=Vi(g,2),M!==null&&xr(M,g,2),Zc(),pf(g,2)}if(g=gf(c),g===null&&ef(e,s,c,mu,l),g===p)break;p=g}p!==null&&c.stopPropagation()}else ef(e,s,c,null,l)}}function gf(e){return e=Ul(e),yf(e)}var mu=null;function yf(e){if(mu=null,e=Ze(e),e!==null){var s=u(e);if(s===null)e=null;else{var l=s.tag;if(l===13){if(e=d(s),e!==null)return e;e=null}else if(l===31){if(e=f(s),e!==null)return e;e=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;e=null}else s!==e&&(e=null)}}return mu=e,null}function Ev(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ct()){case Qe:return 2;case it:return 8;case tt:case ut:return 32;case qt:return 268435456;default:return 32}default:return 32}}var vf=!1,xi=null,bi=null,wi=null,So=new Map,jo=new Map,Si=[],FS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function kv(e,s){switch(e){case"focusin":case"focusout":xi=null;break;case"dragenter":case"dragleave":bi=null;break;case"mouseover":case"mouseout":wi=null;break;case"pointerover":case"pointerout":So.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":jo.delete(s.pointerId)}}function _o(e,s,l,c,p,g){return e===null||e.nativeEvent!==g?(e={blockedOn:s,domEventName:l,eventSystemFlags:c,nativeEvent:g,targetContainers:[p]},s!==null&&(s=Xe(s),s!==null&&Cv(s)),e):(e.eventSystemFlags|=c,s=e.targetContainers,p!==null&&s.indexOf(p)===-1&&s.push(p),e)}function HS(e,s,l,c,p){switch(s){case"focusin":return xi=_o(xi,e,s,l,c,p),!0;case"dragenter":return bi=_o(bi,e,s,l,c,p),!0;case"mouseover":return wi=_o(wi,e,s,l,c,p),!0;case"pointerover":var g=p.pointerId;return So.set(g,_o(So.get(g)||null,e,s,l,c,p)),!0;case"gotpointercapture":return g=p.pointerId,jo.set(g,_o(jo.get(g)||null,e,s,l,c,p)),!0}return!1}function Tv(e){var s=Ze(e.target);if(s!==null){var l=u(s);if(l!==null){if(s=l.tag,s===13){if(s=d(l),s!==null){e.blockedOn=s,pt(e.priority,function(){Nv(l)});return}}else if(s===31){if(s=f(l),s!==null){e.blockedOn=s,pt(e.priority,function(){Nv(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function gu(e){if(e.blockedOn!==null)return!1;for(var s=e.targetContainers;0<s.length;){var l=gf(e.nativeEvent);if(l===null){l=e.nativeEvent;var c=new l.constructor(l.type,l);Ll=c,l.target.dispatchEvent(c),Ll=null}else return s=Xe(l),s!==null&&Cv(s),e.blockedOn=l,!1;s.shift()}return!0}function Av(e,s,l){gu(e)&&l.delete(s)}function VS(){vf=!1,xi!==null&&gu(xi)&&(xi=null),bi!==null&&gu(bi)&&(bi=null),wi!==null&&gu(wi)&&(wi=null),So.forEach(Av),jo.forEach(Av)}function yu(e,s){e.blockedOn===s&&(e.blockedOn=null,vf||(vf=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,VS)))}var vu=null;function Rv(e){vu!==e&&(vu=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){vu===e&&(vu=null);for(var s=0;s<e.length;s+=3){var l=e[s],c=e[s+1],p=e[s+2];if(typeof c!="function"){if(yf(c||l)===null)continue;break}var g=Xe(l);g!==null&&(e.splice(s,3),s-=3,mh(g,{pending:!0,data:p,method:l.method,action:c},c,p))}}))}function el(e){function s(Y){return yu(Y,e)}xi!==null&&yu(xi,e),bi!==null&&yu(bi,e),wi!==null&&yu(wi,e),So.forEach(s),jo.forEach(s);for(var l=0;l<Si.length;l++){var c=Si[l];c.blockedOn===e&&(c.blockedOn=null)}for(;0<Si.length&&(l=Si[0],l.blockedOn===null);)Tv(l),l.blockedOn===null&&Si.shift();if(l=(e.ownerDocument||e).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var p=l[c],g=l[c+1],j=p[Ge]||null;if(typeof g=="function")j||Rv(l);else if(j){var M=null;if(g&&g.hasAttribute("formAction")){if(p=g,j=g[Ge]||null)M=j.formAction;else if(yf(p)!==null)continue}else M=j.action;typeof M=="function"?l[c+1]=M:(l.splice(c,3),c-=3),Rv(l)}}}function Ov(){function e(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(j){return p=j})},focusReset:"manual",scroll:"manual"})}function s(){p!==null&&(p(),p=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,p=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),p!==null&&(p(),p=null)}}}function xf(e){this._internalRoot=e}xu.prototype.render=xf.prototype.render=function(e){var s=this._internalRoot;if(s===null)throw Error(a(409));var l=s.current,c=Tr();jv(l,c,e,s,null,null)},xu.prototype.unmount=xf.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var s=e.containerInfo;jv(e.current,2,null,e,null,null),Zc(),s[Et]=null}};function xu(e){this._internalRoot=e}xu.prototype.unstable_scheduleHydration=function(e){if(e){var s=Vt();e={blockedOn:null,target:e,priority:s};for(var l=0;l<Si.length&&s!==0&&s<Si[l].priority;l++);Si.splice(l,0,e),l===0&&Tv(e)}};var Dv=t.version;if(Dv!=="19.2.3")throw Error(a(527,Dv,"19.2.3"));L.findDOMNode=function(e){var s=e._reactInternals;if(s===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=m(s),e=e!==null?y(e):null,e=e===null?null:e.stateNode,e};var GS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bu.isDisabled&&bu.supportsFiber)try{Ht=bu.inject(GS),rn=bu}catch{}}return No.createRoot=function(e,s){if(!o(e))throw Error(a(299));var l=!1,c="",p=$g,g=Pg,j=qg;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(c=s.identifierPrefix),s.onUncaughtError!==void 0&&(p=s.onUncaughtError),s.onCaughtError!==void 0&&(g=s.onCaughtError),s.onRecoverableError!==void 0&&(j=s.onRecoverableError)),s=wv(e,1,!1,null,null,l,c,null,p,g,j,Ov),e[Et]=s.current,Zh(e),new xf(s)},No.hydrateRoot=function(e,s,l){if(!o(e))throw Error(a(299));var c=!1,p="",g=$g,j=Pg,M=qg,Y=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(g=l.onUncaughtError),l.onCaughtError!==void 0&&(j=l.onCaughtError),l.onRecoverableError!==void 0&&(M=l.onRecoverableError),l.formState!==void 0&&(Y=l.formState)),s=wv(e,1,!0,s,l??null,c,p,Y,g,j,M,Ov),s.context=Sv(null),l=s.current,c=Tr(),c=jt(c),p=li(c),p.callback=null,oi(l,p,c),l=c,s.current.lanes=l,he(s,l),ys(s),e[Et]=s.current,Zh(e),new xu(s)},No.version="19.2.3",No}var Fv;function tj(){if(Fv)return Sf.exports;Fv=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),Sf.exports=ej(),Sf.exports}var nj=tj();var Hv="popstate";function rj(n={}){function t(a,o){let{pathname:u,search:d,hash:f}=a.location;return hp("",{pathname:u,search:d,hash:f},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function i(a,o){return typeof o=="string"?o:Vo(o)}return ij(t,i,null,n)}function Yn(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function Wr(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function sj(){return Math.random().toString(36).substring(2,10)}function Vv(n,t){return{usr:n.state,key:n.key,idx:t}}function hp(n,t,i=null,a){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof t=="string"?rc(t):t,state:i,key:t&&t.key||a||sj()}}function Vo({pathname:n="/",search:t="",hash:i=""}){return t&&t!=="?"&&(n+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(n+=i.charAt(0)==="#"?i:"#"+i),n}function rc(n){let t={};if(n){let i=n.indexOf("#");i>=0&&(t.hash=n.substring(i),n=n.substring(0,i));let a=n.indexOf("?");a>=0&&(t.search=n.substring(a),n=n.substring(0,a)),n&&(t.pathname=n)}return t}function ij(n,t,i,a={}){let{window:o=document.defaultView,v5Compat:u=!1}=a,d=o.history,f="POP",h=null,m=y();m==null&&(m=0,d.replaceState({...d.state,idx:m},""));function y(){return(d.state||{idx:null}).idx}function v(){f="POP";let w=y(),C=w==null?null:w-m;m=w,h&&h({action:f,location:N.location,delta:C})}function x(w,C){f="PUSH";let D=hp(N.location,w,C);m=y()+1;let z=Vv(D,m),T=N.createHref(D);try{d.pushState(z,"",T)}catch(U){if(U instanceof DOMException&&U.name==="DataCloneError")throw U;o.location.assign(T)}u&&h&&h({action:f,location:N.location,delta:1})}function S(w,C){f="REPLACE";let D=hp(N.location,w,C);m=y();let z=Vv(D,m),T=N.createHref(D);d.replaceState(z,"",T),u&&h&&h({action:f,location:N.location,delta:0})}function _(w){return aj(w)}let N={get action(){return f},get location(){return n(o,d)},listen(w){if(h)throw new Error("A history only accepts one active listener");return o.addEventListener(Hv,v),h=w,()=>{o.removeEventListener(Hv,v),h=null}},createHref(w){return t(o,w)},createURL:_,encodeLocation(w){let C=_(w);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:x,replace:S,go(w){return d.go(w)}};return N}function aj(n,t=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Yn(i,"No window.location.(origin|href) available to create URL");let a=typeof n=="string"?n:Vo(n);return a=a.replace(/ $/,"%20"),!t&&a.startsWith("//")&&(a=i+a),new URL(a,i)}function k0(n,t,i="/"){return lj(n,t,i,!1)}function lj(n,t,i,a){let o=typeof t=="string"?rc(t):t,u=Hs(o.pathname||"/",i);if(u==null)return null;let d=T0(n);oj(d);let f=null;for(let h=0;f==null&&h<d.length;++h){let m=xj(u);f=yj(d[h],m,a)}return f}function T0(n,t=[],i=[],a="",o=!1){let u=(d,f,h=o,m)=>{let y={relativePath:m===void 0?d.path||"":m,caseSensitive:d.caseSensitive===!0,childrenIndex:f,route:d};if(y.relativePath.startsWith("/")){if(!y.relativePath.startsWith(a)&&h)return;Yn(y.relativePath.startsWith(a),`Absolute route path "${y.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),y.relativePath=y.relativePath.slice(a.length)}let v=Fs([a,y.relativePath]),x=i.concat(y);d.children&&d.children.length>0&&(Yn(d.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${v}".`),T0(d.children,t,x,v,h)),!(d.path==null&&!d.index)&&t.push({path:v,score:mj(v,d.index),routesMeta:x})};return n.forEach((d,f)=>{if(d.path===""||!d.path?.includes("?"))u(d,f);else for(let h of A0(d.path))u(d,f,!0,h)}),t}function A0(n){let t=n.split("/");if(t.length===0)return[];let[i,...a]=t,o=i.endsWith("?"),u=i.replace(/\?$/,"");if(a.length===0)return o?[u,""]:[u];let d=A0(a.join("/")),f=[];return f.push(...d.map(h=>h===""?u:[u,h].join("/"))),o&&f.push(...d),f.map(h=>n.startsWith("/")&&h===""?"/":h)}function oj(n){n.sort((t,i)=>t.score!==i.score?i.score-t.score:gj(t.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}var cj=/^:[\w-]+$/,uj=3,dj=2,hj=1,fj=10,pj=-2,Gv=n=>n==="*";function mj(n,t){let i=n.split("/"),a=i.length;return i.some(Gv)&&(a+=pj),t&&(a+=dj),i.filter(o=>!Gv(o)).reduce((o,u)=>o+(cj.test(u)?uj:u===""?hj:fj),a)}function gj(n,t){return n.length===t.length&&n.slice(0,-1).every((a,o)=>a===t[o])?n[n.length-1]-t[t.length-1]:0}function yj(n,t,i=!1){let{routesMeta:a}=n,o={},u="/",d=[];for(let f=0;f<a.length;++f){let h=a[f],m=f===a.length-1,y=u==="/"?t:t.slice(u.length)||"/",v=Hu({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},y),x=h.route;if(!v&&m&&i&&!a[a.length-1].route.index&&(v=Hu({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},y)),!v)return null;Object.assign(o,v.params),d.push({params:o,pathname:Fs([u,v.pathname]),pathnameBase:jj(Fs([u,v.pathnameBase])),route:x}),v.pathnameBase!=="/"&&(u=Fs([u,v.pathnameBase]))}return d}function Hu(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[i,a]=vj(n.path,n.caseSensitive,n.end),o=t.match(i);if(!o)return null;let u=o[0],d=u.replace(/(.)\/+$/,"$1"),f=o.slice(1);return{params:a.reduce((m,{paramName:y,isOptional:v},x)=>{if(y==="*"){let _=f[x]||"";d=u.slice(0,u.length-_.length).replace(/(.)\/+$/,"$1")}const S=f[x];return v&&!S?m[y]=void 0:m[y]=(S||"").replace(/%2F/g,"/"),m},{}),pathname:u,pathnameBase:d,pattern:n}}function vj(n,t=!1,i=!0){Wr(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let a=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,f,h)=>(a.push({paramName:f,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(a.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),a]}function xj(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Wr(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),n}}function Hs(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,a=n.charAt(i);return a&&a!=="/"?null:n.slice(i)||"/"}var R0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,bj=n=>R0.test(n);function wj(n,t="/"){let{pathname:i,search:a="",hash:o=""}=typeof n=="string"?rc(n):n,u;if(i)if(bj(i))u=i;else{if(i.includes("//")){let d=i;i=i.replace(/\/\/+/g,"/"),Wr(!1,`Pathnames cannot have embedded double slashes - normalizing ${d} -> ${i}`)}i.startsWith("/")?u=Kv(i.substring(1),"/"):u=Kv(i,t)}else u=t;return{pathname:u,search:_j(a),hash:Cj(o)}}function Kv(n,t){let i=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?i.length>1&&i.pop():o!=="."&&i.push(o)}),i.length>1?i.join("/"):"/"}function Nf(n,t,i,a){return`Cannot include a '${n}' character in a manually specified \`to.${t}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Sj(n){return n.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function O0(n){let t=Sj(n);return t.map((i,a)=>a===t.length-1?i.pathname:i.pathnameBase)}function D0(n,t,i,a=!1){let o;typeof n=="string"?o=rc(n):(o={...n},Yn(!o.pathname||!o.pathname.includes("?"),Nf("?","pathname","search",o)),Yn(!o.pathname||!o.pathname.includes("#"),Nf("#","pathname","hash",o)),Yn(!o.search||!o.search.includes("#"),Nf("#","search","hash",o)));let u=n===""||o.pathname==="",d=u?"/":o.pathname,f;if(d==null)f=i;else{let v=t.length-1;if(!a&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),v-=1;o.pathname=x.join("/")}f=v>=0?t[v]:"/"}let h=wj(o,f),m=d&&d!=="/"&&d.endsWith("/"),y=(u||d===".")&&i.endsWith("/");return!h.pathname.endsWith("/")&&(m||y)&&(h.pathname+="/"),h}var Fs=n=>n.join("/").replace(/\/\/+/g,"/"),jj=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),_j=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Cj=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,Nj=class{constructor(n,t,i,a=!1){this.status=n,this.statusText=t||"",this.internal=a,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}};function Ej(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function kj(n){return n.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var M0=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function z0(n,t){let i=n;if(typeof i!="string"||!R0.test(i))return{absoluteURL:void 0,isExternal:!1,to:i};let a=i,o=!1;if(M0)try{let u=new URL(window.location.href),d=i.startsWith("//")?new URL(u.protocol+i):new URL(i),f=Hs(d.pathname,t);d.origin===u.origin&&f!=null?i=f+d.search+d.hash:o=!0}catch{Wr(!1,`<Link to="${i}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:o,to:i}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var L0=["POST","PUT","PATCH","DELETE"];new Set(L0);var Tj=["GET",...L0];new Set(Tj);var Cl=b.createContext(null);Cl.displayName="DataRouter";var ad=b.createContext(null);ad.displayName="DataRouterState";var Aj=b.createContext(!1),U0=b.createContext({isTransitioning:!1});U0.displayName="ViewTransition";var Rj=b.createContext(new Map);Rj.displayName="Fetchers";var Oj=b.createContext(null);Oj.displayName="Await";var Qr=b.createContext(null);Qr.displayName="Navigation";var ld=b.createContext(null);ld.displayName="Location";var Gs=b.createContext({outlet:null,matches:[],isDataRoute:!1});Gs.displayName="Route";var Up=b.createContext(null);Up.displayName="RouteError";var I0="REACT_ROUTER_ERROR",Dj="REDIRECT",Mj="ROUTE_ERROR_RESPONSE";function zj(n){if(n.startsWith(`${I0}:${Dj}:{`))try{let t=JSON.parse(n.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function Lj(n){if(n.startsWith(`${I0}:${Mj}:{`))try{let t=JSON.parse(n.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new Nj(t.status,t.statusText,t.data)}catch{}}function Uj(n,{relative:t}={}){Yn(sc(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:a}=b.useContext(Qr),{hash:o,pathname:u,search:d}=ic(n,{relative:t}),f=u;return i!=="/"&&(f=u==="/"?i:Fs([i,u])),a.createHref({pathname:f,search:d,hash:o})}function sc(){return b.useContext(ld)!=null}function Ks(){return Yn(sc(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(ld).location}var B0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function $0(n){b.useContext(Qr).static||b.useLayoutEffect(n)}function P0(){let{isDataRoute:n}=b.useContext(Gs);return n?Qj():Ij()}function Ij(){Yn(sc(),"useNavigate() may be used only in the context of a <Router> component.");let n=b.useContext(Cl),{basename:t,navigator:i}=b.useContext(Qr),{matches:a}=b.useContext(Gs),{pathname:o}=Ks(),u=JSON.stringify(O0(a)),d=b.useRef(!1);return $0(()=>{d.current=!0}),b.useCallback((h,m={})=>{if(Wr(d.current,B0),!d.current)return;if(typeof h=="number"){i.go(h);return}let y=D0(h,JSON.parse(u),o,m.relative==="path");n==null&&t!=="/"&&(y.pathname=y.pathname==="/"?t:Fs([t,y.pathname])),(m.replace?i.replace:i.push)(y,m.state,m)},[t,i,u,o,n])}b.createContext(null);function ic(n,{relative:t}={}){let{matches:i}=b.useContext(Gs),{pathname:a}=Ks(),o=JSON.stringify(O0(i));return b.useMemo(()=>D0(n,JSON.parse(o),a,t==="path"),[n,o,a,t])}function Bj(n,t,i,a,o){Yn(sc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:u}=b.useContext(Qr),{matches:d}=b.useContext(Gs),f=d[d.length-1],h=f?f.params:{},m=f?f.pathname:"/",y=f?f.pathnameBase:"/",v=f&&f.route;{let D=v&&v.path||"";F0(m,!v||D.endsWith("*")||D.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${m}" (under <Route path="${D}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${D}"> to <Route path="${D==="/"?"*":`${D}/*`}">.`)}let x=Ks(),S;S=x;let _=S.pathname||"/",N=_;if(y!=="/"){let D=y.replace(/^\//,"").split("/");N="/"+_.replace(/^\//,"").split("/").slice(D.length).join("/")}let w=k0(n,{pathname:N});return Wr(v||w!=null,`No routes matched location "${S.pathname}${S.search}${S.hash}" `),Wr(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${S.pathname}${S.search}${S.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),Hj(w&&w.map(D=>Object.assign({},D,{params:Object.assign({},h,D.params),pathname:Fs([y,u.encodeLocation?u.encodeLocation(D.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?y:Fs([y,u.encodeLocation?u.encodeLocation(D.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:D.pathnameBase])})),d,i,a,o)}function $j(){let n=Wj(),t=Ej(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),i=n instanceof Error?n.stack:null,a="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:a},u={padding:"2px 4px",backgroundColor:a},d=null;return console.error("Error handled by React Router default ErrorBoundary:",n),d=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:u},"ErrorBoundary")," or"," ",b.createElement("code",{style:u},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},t),i?b.createElement("pre",{style:o},i):null,d)}var Pj=b.createElement($j,null),q0=class extends b.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,t){return t.location!==n.location||t.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:t.error,location:t.location,revalidation:n.revalidation||t.revalidation}}componentDidCatch(n,t){this.props.onError?this.props.onError(n,t):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const i=Lj(n.digest);i&&(n=i)}let t=n!==void 0?b.createElement(Gs.Provider,{value:this.props.routeContext},b.createElement(Up.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?b.createElement(qj,{error:n},t):t}};q0.contextType=Aj;var Ef=new WeakMap;function qj({children:n,error:t}){let{basename:i}=b.useContext(Qr);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let a=zj(t.digest);if(a){let o=Ef.get(t);if(o)throw o;let u=z0(a.location,i);if(M0&&!Ef.get(t))if(u.isExternal||a.reloadDocument)window.location.href=u.absoluteURL||u.to;else{const d=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(u.to,{replace:a.replace}));throw Ef.set(t,d),d}return b.createElement("meta",{httpEquiv:"refresh",content:`0;url=${u.absoluteURL||u.to}`})}}return n}function Fj({routeContext:n,match:t,children:i}){let a=b.useContext(Cl);return a&&a.static&&a.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=t.route.id),b.createElement(Gs.Provider,{value:n},i)}function Hj(n,t=[],i=null,a=null,o=null){if(n==null){if(!i)return null;if(i.errors)n=i.matches;else if(t.length===0&&!i.initialized&&i.matches.length>0)n=i.matches;else return null}let u=n,d=i?.errors;if(d!=null){let y=u.findIndex(v=>v.route.id&&d?.[v.route.id]!==void 0);Yn(y>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(d).join(",")}`),u=u.slice(0,Math.min(u.length,y+1))}let f=!1,h=-1;if(i)for(let y=0;y<u.length;y++){let v=u[y];if((v.route.HydrateFallback||v.route.hydrateFallbackElement)&&(h=y),v.route.id){let{loaderData:x,errors:S}=i,_=v.route.loader&&!x.hasOwnProperty(v.route.id)&&(!S||S[v.route.id]===void 0);if(v.route.lazy||_){f=!0,h>=0?u=u.slice(0,h+1):u=[u[0]];break}}}let m=i&&a?(y,v)=>{a(y,{location:i.location,params:i.matches?.[0]?.params??{},unstable_pattern:kj(i.matches),errorInfo:v})}:void 0;return u.reduceRight((y,v,x)=>{let S,_=!1,N=null,w=null;i&&(S=d&&v.route.id?d[v.route.id]:void 0,N=v.route.errorElement||Pj,f&&(h<0&&x===0?(F0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),_=!0,w=null):h===x&&(_=!0,w=v.route.hydrateFallbackElement||null)));let C=t.concat(u.slice(0,x+1)),D=()=>{let z;return S?z=N:_?z=w:v.route.Component?z=b.createElement(v.route.Component,null):v.route.element?z=v.route.element:z=y,b.createElement(Fj,{match:v,routeContext:{outlet:y,matches:C,isDataRoute:i!=null},children:z})};return i&&(v.route.ErrorBoundary||v.route.errorElement||x===0)?b.createElement(q0,{location:i.location,revalidation:i.revalidation,component:N,error:S,children:D(),routeContext:{outlet:null,matches:C,isDataRoute:!0},onError:m}):D()},null)}function Ip(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Vj(n){let t=b.useContext(Cl);return Yn(t,Ip(n)),t}function Gj(n){let t=b.useContext(ad);return Yn(t,Ip(n)),t}function Kj(n){let t=b.useContext(Gs);return Yn(t,Ip(n)),t}function Bp(n){let t=Kj(n),i=t.matches[t.matches.length-1];return Yn(i.route.id,`${n} can only be used on routes that contain a unique "id"`),i.route.id}function Yj(){return Bp("useRouteId")}function Wj(){let n=b.useContext(Up),t=Gj("useRouteError"),i=Bp("useRouteError");return n!==void 0?n:t.errors?.[i]}function Qj(){let{router:n}=Vj("useNavigate"),t=Bp("useNavigate"),i=b.useRef(!1);return $0(()=>{i.current=!0}),b.useCallback(async(o,u={})=>{Wr(i.current,B0),i.current&&(typeof o=="number"?await n.navigate(o):await n.navigate(o,{fromRouteId:t,...u}))},[n,t])}var Yv={};function F0(n,t,i){!t&&!Yv[n]&&(Yv[n]=!0,Wr(!1,i))}b.memo(Jj);function Jj({routes:n,future:t,state:i,onError:a}){return Bj(n,void 0,i,a,t)}function Xj({basename:n="/",children:t=null,location:i,navigationType:a="POP",navigator:o,static:u=!1,unstable_useTransitions:d}){Yn(!sc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=n.replace(/^\/*/,"/"),h=b.useMemo(()=>({basename:f,navigator:o,static:u,unstable_useTransitions:d,future:{}}),[f,o,u,d]);typeof i=="string"&&(i=rc(i));let{pathname:m="/",search:y="",hash:v="",state:x=null,key:S="default"}=i,_=b.useMemo(()=>{let N=Hs(m,f);return N==null?null:{location:{pathname:N,search:y,hash:v,state:x,key:S},navigationType:a}},[f,m,y,v,x,S,a]);return Wr(_!=null,`<Router basename="${f}"> is not able to match the URL "${m}${y}${v}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:b.createElement(Qr.Provider,{value:h},b.createElement(ld.Provider,{children:t,value:_}))}var Uu="get",Iu="application/x-www-form-urlencoded";function od(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function Zj(n){return od(n)&&n.tagName.toLowerCase()==="button"}function e_(n){return od(n)&&n.tagName.toLowerCase()==="form"}function t_(n){return od(n)&&n.tagName.toLowerCase()==="input"}function n_(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function r_(n,t){return n.button===0&&(!t||t==="_self")&&!n_(n)}function fp(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((t,i)=>{let a=n[i];return t.concat(Array.isArray(a)?a.map(o=>[i,o]):[[i,a]])},[]))}function s_(n,t){let i=fp(n);return t&&t.forEach((a,o)=>{i.has(o)||t.getAll(o).forEach(u=>{i.append(o,u)})}),i}var wu=null;function i_(){if(wu===null)try{new FormData(document.createElement("form"),0),wu=!1}catch{wu=!0}return wu}var a_=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function kf(n){return n!=null&&!a_.has(n)?(Wr(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Iu}"`),null):n}function l_(n,t){let i,a,o,u,d;if(e_(n)){let f=n.getAttribute("action");a=f?Hs(f,t):null,i=n.getAttribute("method")||Uu,o=kf(n.getAttribute("enctype"))||Iu,u=new FormData(n)}else if(Zj(n)||t_(n)&&(n.type==="submit"||n.type==="image")){let f=n.form;if(f==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=n.getAttribute("formaction")||f.getAttribute("action");if(a=h?Hs(h,t):null,i=n.getAttribute("formmethod")||f.getAttribute("method")||Uu,o=kf(n.getAttribute("formenctype"))||kf(f.getAttribute("enctype"))||Iu,u=new FormData(f,n),!i_()){let{name:m,type:y,value:v}=n;if(y==="image"){let x=m?`${m}.`:"";u.append(`${x}x`,"0"),u.append(`${x}y`,"0")}else m&&u.append(m,v)}}else{if(od(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=Uu,a=null,o=Iu,d=n}return u&&o==="text/plain"&&(d=u,u=void 0),{action:a,method:i.toLowerCase(),encType:o,formData:u,body:d}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function $p(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function o_(n,t,i){let a=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return a.pathname==="/"?a.pathname=`_root.${i}`:t&&Hs(a.pathname,t)==="/"?a.pathname=`${t.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function c_(n,t){if(n.id in t)return t[n.id];try{let i=await import(n.module);return t[n.id]=i,i}catch(i){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function u_(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function d_(n,t,i){let a=await Promise.all(n.map(async o=>{let u=t.routes[o.route.id];if(u){let d=await c_(u,i);return d.links?d.links():[]}return[]}));return m_(a.flat(1).filter(u_).filter(o=>o.rel==="stylesheet"||o.rel==="preload").map(o=>o.rel==="stylesheet"?{...o,rel:"prefetch",as:"style"}:{...o,rel:"prefetch"}))}function Wv(n,t,i,a,o,u){let d=(h,m)=>i[m]?h.route.id!==i[m].route.id:!0,f=(h,m)=>i[m].pathname!==h.pathname||i[m].route.path?.endsWith("*")&&i[m].params["*"]!==h.params["*"];return u==="assets"?t.filter((h,m)=>d(h,m)||f(h,m)):u==="data"?t.filter((h,m)=>{let y=a.routes[h.route.id];if(!y||!y.hasLoader)return!1;if(d(h,m)||f(h,m))return!0;if(h.route.shouldRevalidate){let v=h.route.shouldRevalidate({currentUrl:new URL(o.pathname+o.search+o.hash,window.origin),currentParams:i[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function h_(n,t,{includeHydrateFallback:i}={}){return f_(n.map(a=>{let o=t.routes[a.route.id];if(!o)return[];let u=[o.module];return o.clientActionModule&&(u=u.concat(o.clientActionModule)),o.clientLoaderModule&&(u=u.concat(o.clientLoaderModule)),i&&o.hydrateFallbackModule&&(u=u.concat(o.hydrateFallbackModule)),o.imports&&(u=u.concat(o.imports)),u}).flat(1))}function f_(n){return[...new Set(n)]}function p_(n){let t={},i=Object.keys(n).sort();for(let a of i)t[a]=n[a];return t}function m_(n,t){let i=new Set;return new Set(t),n.reduce((a,o)=>{let u=JSON.stringify(p_(o));return i.has(u)||(i.add(u),a.push({key:u,link:o})),a},[])}function H0(){let n=b.useContext(Cl);return $p(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function g_(){let n=b.useContext(ad);return $p(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Pp=b.createContext(void 0);Pp.displayName="FrameworkContext";function V0(){let n=b.useContext(Pp);return $p(n,"You must render this element inside a <HydratedRouter> element"),n}function y_(n,t){let i=b.useContext(Pp),[a,o]=b.useState(!1),[u,d]=b.useState(!1),{onFocus:f,onBlur:h,onMouseEnter:m,onMouseLeave:y,onTouchStart:v}=t,x=b.useRef(null);b.useEffect(()=>{if(n==="render"&&d(!0),n==="viewport"){let N=C=>{C.forEach(D=>{d(D.isIntersecting)})},w=new IntersectionObserver(N,{threshold:.5});return x.current&&w.observe(x.current),()=>{w.disconnect()}}},[n]),b.useEffect(()=>{if(a){let N=setTimeout(()=>{d(!0)},100);return()=>{clearTimeout(N)}}},[a]);let S=()=>{o(!0)},_=()=>{o(!1),d(!1)};return i?n!=="intent"?[u,x,{}]:[u,x,{onFocus:Eo(f,S),onBlur:Eo(h,_),onMouseEnter:Eo(m,S),onMouseLeave:Eo(y,_),onTouchStart:Eo(v,S)}]:[!1,x,{}]}function Eo(n,t){return i=>{n&&n(i),i.defaultPrevented||t(i)}}function v_({page:n,...t}){let{router:i}=H0(),a=b.useMemo(()=>k0(i.routes,n,i.basename),[i.routes,n,i.basename]);return a?b.createElement(b_,{page:n,matches:a,...t}):null}function x_(n){let{manifest:t,routeModules:i}=V0(),[a,o]=b.useState([]);return b.useEffect(()=>{let u=!1;return d_(n,t,i).then(d=>{u||o(d)}),()=>{u=!0}},[n,t,i]),a}function b_({page:n,matches:t,...i}){let a=Ks(),{manifest:o,routeModules:u}=V0(),{basename:d}=H0(),{loaderData:f,matches:h}=g_(),m=b.useMemo(()=>Wv(n,t,h,o,a,"data"),[n,t,h,o,a]),y=b.useMemo(()=>Wv(n,t,h,o,a,"assets"),[n,t,h,o,a]),v=b.useMemo(()=>{if(n===a.pathname+a.search+a.hash)return[];let _=new Set,N=!1;if(t.forEach(C=>{let D=o.routes[C.route.id];!D||!D.hasLoader||(!m.some(z=>z.route.id===C.route.id)&&C.route.id in f&&u[C.route.id]?.shouldRevalidate||D.hasClientLoader?N=!0:_.add(C.route.id))}),_.size===0)return[];let w=o_(n,d,"data");return N&&_.size>0&&w.searchParams.set("_routes",t.filter(C=>_.has(C.route.id)).map(C=>C.route.id).join(",")),[w.pathname+w.search]},[d,f,a,o,m,t,n,u]),x=b.useMemo(()=>h_(y,o),[y,o]),S=x_(y);return b.createElement(b.Fragment,null,v.map(_=>b.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...i})),x.map(_=>b.createElement("link",{key:_,rel:"modulepreload",href:_,...i})),S.map(({key:_,link:N})=>b.createElement("link",{key:_,nonce:i.nonce,...N})))}function w_(...n){return t=>{n.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}var S_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{S_&&(window.__reactRouterVersion="7.11.0")}catch{}function j_({basename:n,children:t,unstable_useTransitions:i,window:a}){let o=b.useRef();o.current==null&&(o.current=rj({window:a,v5Compat:!0}));let u=o.current,[d,f]=b.useState({action:u.action,location:u.location}),h=b.useCallback(m=>{i===!1?f(m):b.startTransition(()=>f(m))},[i]);return b.useLayoutEffect(()=>u.listen(h),[u,h]),b.createElement(Xj,{basename:n,children:t,location:d.location,navigationType:d.action,navigator:u,unstable_useTransitions:i})}var G0=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,K0=b.forwardRef(function({onClick:t,discover:i="render",prefetch:a="none",relative:o,reloadDocument:u,replace:d,state:f,target:h,to:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...S},_){let{basename:N,unstable_useTransitions:w}=b.useContext(Qr),C=typeof m=="string"&&G0.test(m),D=z0(m,N);m=D.to;let z=Uj(m,{relative:o}),[T,U,E]=y_(a,S),R=E_(m,{replace:d,state:f,target:h,preventScrollReset:y,relative:o,viewTransition:v,unstable_defaultShouldRevalidate:x,unstable_useTransitions:w});function A(V){t&&t(V),V.defaultPrevented||R(V)}let O=b.createElement("a",{...S,...E,href:D.absoluteURL||z,onClick:D.isExternal||u?t:A,ref:w_(_,U),target:h,"data-discover":!C&&i==="render"?"true":void 0});return T&&!C?b.createElement(b.Fragment,null,O,b.createElement(v_,{page:z})):O});K0.displayName="Link";var __=b.forwardRef(function({"aria-current":t="page",caseSensitive:i=!1,className:a="",end:o=!1,style:u,to:d,viewTransition:f,children:h,...m},y){let v=ic(d,{relative:m.relative}),x=Ks(),S=b.useContext(ad),{navigator:_,basename:N}=b.useContext(Qr),w=S!=null&&O_(v)&&f===!0,C=_.encodeLocation?_.encodeLocation(v).pathname:v.pathname,D=x.pathname,z=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;i||(D=D.toLowerCase(),z=z?z.toLowerCase():null,C=C.toLowerCase()),z&&N&&(z=Hs(z,N)||z);const T=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let U=D===C||!o&&D.startsWith(C)&&D.charAt(T)==="/",E=z!=null&&(z===C||!o&&z.startsWith(C)&&z.charAt(C.length)==="/"),R={isActive:U,isPending:E,isTransitioning:w},A=U?t:void 0,O;typeof a=="function"?O=a(R):O=[a,U?"active":null,E?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let V=typeof u=="function"?u(R):u;return b.createElement(K0,{...m,"aria-current":A,className:O,ref:y,style:V,to:d,viewTransition:f},typeof h=="function"?h(R):h)});__.displayName="NavLink";var C_=b.forwardRef(({discover:n="render",fetcherKey:t,navigate:i,reloadDocument:a,replace:o,state:u,method:d=Uu,action:f,onSubmit:h,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x,...S},_)=>{let{unstable_useTransitions:N}=b.useContext(Qr),w=A_(),C=R_(f,{relative:m}),D=d.toLowerCase()==="get"?"get":"post",z=typeof f=="string"&&G0.test(f),T=U=>{if(h&&h(U),U.defaultPrevented)return;U.preventDefault();let E=U.nativeEvent.submitter,R=E?.getAttribute("formmethod")||d,A=()=>w(E||U.currentTarget,{fetcherKey:t,method:R,navigate:i,replace:o,state:u,relative:m,preventScrollReset:y,viewTransition:v,unstable_defaultShouldRevalidate:x});N&&i!==!1?b.startTransition(()=>A()):A()};return b.createElement("form",{ref:_,method:D,action:C,onSubmit:a?h:T,...S,"data-discover":!z&&n==="render"?"true":void 0})});C_.displayName="Form";function N_(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Y0(n){let t=b.useContext(Cl);return Yn(t,N_(n)),t}function E_(n,{target:t,replace:i,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:h}={}){let m=P0(),y=Ks(),v=ic(n,{relative:u});return b.useCallback(x=>{if(r_(x,t)){x.preventDefault();let S=i!==void 0?i:Vo(y)===Vo(v),_=()=>m(n,{replace:S,state:a,preventScrollReset:o,relative:u,viewTransition:d,unstable_defaultShouldRevalidate:f});h?b.startTransition(()=>_()):_()}},[y,m,v,i,a,t,n,o,u,d,f,h])}function ac(n){Wr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=b.useRef(fp(n)),i=b.useRef(!1),a=Ks(),o=b.useMemo(()=>s_(a.search,i.current?null:t.current),[a.search]),u=P0(),d=b.useCallback((f,h)=>{const m=fp(typeof f=="function"?f(new URLSearchParams(o)):f);i.current=!0,u("?"+m,h)},[u,o]);return[o,d]}var k_=0,T_=()=>`__${String(++k_)}__`;function A_(){let{router:n}=Y0("useSubmit"),{basename:t}=b.useContext(Qr),i=Yj(),a=n.fetch,o=n.navigate;return b.useCallback(async(u,d={})=>{let{action:f,method:h,encType:m,formData:y,body:v}=l_(u,t);if(d.navigate===!1){let x=d.fetcherKey||T_();await a(x,i,d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||h,formEncType:d.encType||m,flushSync:d.flushSync})}else await o(d.action||f,{unstable_defaultShouldRevalidate:d.unstable_defaultShouldRevalidate,preventScrollReset:d.preventScrollReset,formData:y,body:v,formMethod:d.method||h,formEncType:d.encType||m,replace:d.replace,state:d.state,fromRouteId:i,flushSync:d.flushSync,viewTransition:d.viewTransition})},[a,o,t,i])}function R_(n,{relative:t}={}){let{basename:i}=b.useContext(Qr),a=b.useContext(Gs);Yn(a,"useFormAction must be used inside a RouteContext");let[o]=a.matches.slice(-1),u={...ic(n||".",{relative:t})},d=Ks();if(n==null){u.search=d.search;let f=new URLSearchParams(u.search),h=f.getAll("index");if(h.some(y=>y==="")){f.delete("index"),h.filter(v=>v).forEach(v=>f.append("index",v));let y=f.toString();u.search=y?`?${y}`:""}}return(!n||n===".")&&o.route.index&&(u.search=u.search?u.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(u.pathname=u.pathname==="/"?i:Fs([i,u.pathname])),Vo(u)}function O_(n,{relative:t}={}){let i=b.useContext(U0);Yn(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=Y0("useViewTransitionState"),o=ic(n,{relative:t});if(!i.isTransitioning)return!1;let u=Hs(i.currentLocation.pathname,a)||i.currentLocation.pathname,d=Hs(i.nextLocation.pathname,a)||i.nextLocation.pathname;return Hu(o.pathname,d)!=null||Hu(o.pathname,u)!=null}var ma=E0();const D_=({children:n})=>(Ks(),r.jsxs("div",{className:"app-layout",children:[r.jsx("header",{className:"app-header",children:r.jsx("div",{className:"container app-header__content",children:r.jsx("img",{src:"/app/header-logo.png",alt:"recipe management",className:"app-logo-image"})})}),r.jsx("main",{className:"container app-main",children:n}),r.jsx("footer",{className:"app-footer",children:r.jsx("div",{className:"container",children:r.jsx("p",{children:" 2026 recipe management"})})})]})),un=({children:n,className:t="",hoverable:i=!1,...a})=>r.jsx("div",{className:`glass-card ${i?"glass-card--hoverable":""} ${t}`,...a,children:n}),le=({children:n,variant:t="primary",size:i="md",isLoading:a,block:o,className:u="",...d})=>{const f=["btn",`btn--${t}`,`btn--${i}`,o?"btn--block":"",a?"btn--loading":"",u].filter(Boolean).join(" ");return r.jsxs("button",{className:f,disabled:a,...d,children:[a&&r.jsx("span",{className:"btn__spinner"}),r.jsx("span",{className:"btn__content",children:n})]})};function M_(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return b.useMemo(()=>a=>{t.forEach(o=>o(a))},t)}const cd=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Nl(n){const t=Object.prototype.toString.call(n);return t==="[object Window]"||t==="[object global]"}function qp(n){return"nodeType"in n}function fr(n){var t,i;return n?Nl(n)?n:qp(n)&&(t=(i=n.ownerDocument)==null?void 0:i.defaultView)!=null?t:window:window}function Fp(n){const{Document:t}=fr(n);return n instanceof t}function lc(n){return Nl(n)?!1:n instanceof fr(n).HTMLElement}function W0(n){return n instanceof fr(n).SVGElement}function El(n){return n?Nl(n)?n.document:qp(n)?Fp(n)?n:lc(n)||W0(n)?n.ownerDocument:document:document:document}const ds=cd?b.useLayoutEffect:b.useEffect;function ud(n){const t=b.useRef(n);return ds(()=>{t.current=n}),b.useCallback(function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return t.current==null?void 0:t.current(...a)},[])}function z_(){const n=b.useRef(null),t=b.useCallback((a,o)=>{n.current=setInterval(a,o)},[]),i=b.useCallback(()=>{n.current!==null&&(clearInterval(n.current),n.current=null)},[]);return[t,i]}function Go(n,t){t===void 0&&(t=[n]);const i=b.useRef(n);return ds(()=>{i.current!==n&&(i.current=n)},t),i}function oc(n,t){const i=b.useRef();return b.useMemo(()=>{const a=n(i.current);return i.current=a,a},[...t])}function Vu(n){const t=ud(n),i=b.useRef(null),a=b.useCallback(o=>{o!==i.current&&t?.(o,i.current),i.current=o},[]);return[i,a]}function Gu(n){const t=b.useRef();return b.useEffect(()=>{t.current=n},[n]),t.current}let Tf={};function cc(n,t){return b.useMemo(()=>{if(t)return t;const i=Tf[n]==null?0:Tf[n]+1;return Tf[n]=i,n+"-"+i},[n,t])}function Q0(n){return function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return a.reduce((u,d)=>{const f=Object.entries(d);for(const[h,m]of f){const y=u[h];y!=null&&(u[h]=y+n*m)}return u},{...t})}}const xl=Q0(1),Ko=Q0(-1);function L_(n){return"clientX"in n&&"clientY"in n}function dd(n){if(!n)return!1;const{KeyboardEvent:t}=fr(n.target);return t&&n instanceof t}function U_(n){if(!n)return!1;const{TouchEvent:t}=fr(n.target);return t&&n instanceof t}function Ku(n){if(U_(n)){if(n.touches&&n.touches.length){const{clientX:t,clientY:i}=n.touches[0];return{x:t,y:i}}else if(n.changedTouches&&n.changedTouches.length){const{clientX:t,clientY:i}=n.changedTouches[0];return{x:t,y:i}}}return L_(n)?{x:n.clientX,y:n.clientY}:null}const wr=Object.freeze({Translate:{toString(n){if(!n)return;const{x:t,y:i}=n;return"translate3d("+(t?Math.round(t):0)+"px, "+(i?Math.round(i):0)+"px, 0)"}},Scale:{toString(n){if(!n)return;const{scaleX:t,scaleY:i}=n;return"scaleX("+t+") scaleY("+i+")"}},Transform:{toString(n){if(n)return[wr.Translate.toString(n),wr.Scale.toString(n)].join(" ")}},Transition:{toString(n){let{property:t,duration:i,easing:a}=n;return t+" "+i+"ms "+a}}}),Qv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function I_(n){return n.matches(Qv)?n:n.querySelector(Qv)}const B_={display:"none"};function $_(n){let{id:t,value:i}=n;return je.createElement("div",{id:t,style:B_},i)}function P_(n){let{id:t,announcement:i,ariaLiveType:a="assertive"}=n;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return je.createElement("div",{id:t,style:o,role:"status","aria-live":a,"aria-atomic":!0},i)}function q_(){const[n,t]=b.useState("");return{announce:b.useCallback(a=>{a!=null&&t(a)},[]),announcement:n}}const J0=b.createContext(null);function F_(n){const t=b.useContext(J0);b.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(n)},[n,t])}function H_(){const[n]=b.useState(()=>new Set),t=b.useCallback(a=>(n.add(a),()=>n.delete(a)),[n]);return[b.useCallback(a=>{let{type:o,event:u}=a;n.forEach(d=>{var f;return(f=d[o])==null?void 0:f.call(d,u)})},[n]),t]}const V_={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},G_={onDragStart(n){let{active:t}=n;return"Picked up draggable item "+t.id+"."},onDragOver(n){let{active:t,over:i}=n;return i?"Draggable item "+t.id+" was moved over droppable area "+i.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(n){let{active:t,over:i}=n;return i?"Draggable item "+t.id+" was dropped over droppable area "+i.id:"Draggable item "+t.id+" was dropped."},onDragCancel(n){let{active:t}=n;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function K_(n){let{announcements:t=G_,container:i,hiddenTextDescribedById:a,screenReaderInstructions:o=V_}=n;const{announce:u,announcement:d}=q_(),f=cc("DndLiveRegion"),[h,m]=b.useState(!1);if(b.useEffect(()=>{m(!0)},[]),F_(b.useMemo(()=>({onDragStart(v){let{active:x}=v;u(t.onDragStart({active:x}))},onDragMove(v){let{active:x,over:S}=v;t.onDragMove&&u(t.onDragMove({active:x,over:S}))},onDragOver(v){let{active:x,over:S}=v;u(t.onDragOver({active:x,over:S}))},onDragEnd(v){let{active:x,over:S}=v;u(t.onDragEnd({active:x,over:S}))},onDragCancel(v){let{active:x,over:S}=v;u(t.onDragCancel({active:x,over:S}))}}),[u,t])),!h)return null;const y=je.createElement(je.Fragment,null,je.createElement($_,{id:a,value:o.draggable}),je.createElement(P_,{id:f,announcement:d}));return i?ma.createPortal(y,i):y}var Kn;(function(n){n.DragStart="dragStart",n.DragMove="dragMove",n.DragEnd="dragEnd",n.DragCancel="dragCancel",n.DragOver="dragOver",n.RegisterDroppable="registerDroppable",n.SetDroppableDisabled="setDroppableDisabled",n.UnregisterDroppable="unregisterDroppable"})(Kn||(Kn={}));function Yu(){}function dr(n,t){return b.useMemo(()=>({sensor:n,options:t??{}}),[n,t])}function ba(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return b.useMemo(()=>[...t].filter(a=>a!=null),[...t])}const hs=Object.freeze({x:0,y:0});function Hp(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function Y_(n,t){const i=Ku(n);if(!i)return"0 0";const a={x:(i.x-t.left)/t.width*100,y:(i.y-t.top)/t.height*100};return a.x+"% "+a.y+"%"}function Vp(n,t){let{data:{value:i}}=n,{data:{value:a}}=t;return i-a}function W_(n,t){let{data:{value:i}}=n,{data:{value:a}}=t;return a-i}function pp(n){let{left:t,top:i,height:a,width:o}=n;return[{x:t,y:i},{x:t+o,y:i},{x:t,y:i+a},{x:t+o,y:i+a}]}function X0(n,t){if(!n||n.length===0)return null;const[i]=n;return i[t]}function Jv(n,t,i){return t===void 0&&(t=n.left),i===void 0&&(i=n.top),{x:t+n.width*.5,y:i+n.height*.5}}const Wu=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=Jv(t,t.left,t.top),u=[];for(const d of a){const{id:f}=d,h=i.get(f);if(h){const m=Hp(Jv(h),o);u.push({id:f,data:{droppableContainer:d,value:m}})}}return u.sort(Vp)},Q_=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=pp(t),u=[];for(const d of a){const{id:f}=d,h=i.get(f);if(h){const m=pp(h),y=o.reduce((x,S,_)=>x+Hp(m[_],S),0),v=Number((y/4).toFixed(4));u.push({id:f,data:{droppableContainer:d,value:v}})}}return u.sort(Vp)};function J_(n,t){const i=Math.max(t.top,n.top),a=Math.max(t.left,n.left),o=Math.min(t.left+t.width,n.left+n.width),u=Math.min(t.top+t.height,n.top+n.height),d=o-a,f=u-i;if(a<o&&i<u){const h=t.width*t.height,m=n.width*n.height,y=d*f,v=y/(h+m-y);return Number(v.toFixed(4))}return 0}const X_=n=>{let{collisionRect:t,droppableRects:i,droppableContainers:a}=n;const o=[];for(const u of a){const{id:d}=u,f=i.get(d);if(f){const h=J_(f,t);h>0&&o.push({id:d,data:{droppableContainer:u,value:h}})}}return o.sort(W_)};function Z_(n,t){const{top:i,left:a,bottom:o,right:u}=t;return i<=n.y&&n.y<=o&&a<=n.x&&n.x<=u}const Z0=n=>{let{droppableContainers:t,droppableRects:i,pointerCoordinates:a}=n;if(!a)return[];const o=[];for(const u of t){const{id:d}=u,f=i.get(d);if(f&&Z_(a,f)){const m=pp(f).reduce((v,x)=>v+Hp(a,x),0),y=Number((m/4).toFixed(4));o.push({id:d,data:{droppableContainer:u,value:y}})}}return o.sort(Vp)};function e1(n,t,i){return{...n,scaleX:t&&i?t.width/i.width:1,scaleY:t&&i?t.height/i.height:1}}function eb(n,t){return n&&t?{x:n.left-t.left,y:n.top-t.top}:hs}function t1(n){return function(i){for(var a=arguments.length,o=new Array(a>1?a-1:0),u=1;u<a;u++)o[u-1]=arguments[u];return o.reduce((d,f)=>({...d,top:d.top+n*f.y,bottom:d.bottom+n*f.y,left:d.left+n*f.x,right:d.right+n*f.x}),{...i})}}const n1=t1(1);function tb(n){if(n.startsWith("matrix3d(")){const t=n.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(n.startsWith("matrix(")){const t=n.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function r1(n,t,i){const a=tb(t);if(!a)return n;const{scaleX:o,scaleY:u,x:d,y:f}=a,h=n.left-d-(1-o)*parseFloat(i),m=n.top-f-(1-u)*parseFloat(i.slice(i.indexOf(" ")+1)),y=o?n.width/o:n.width,v=u?n.height/u:n.height;return{width:y,height:v,top:m,right:h+y,bottom:m+v,left:h}}const s1={ignoreTransform:!1};function kl(n,t){t===void 0&&(t=s1);let i=n.getBoundingClientRect();if(t.ignoreTransform){const{transform:m,transformOrigin:y}=fr(n).getComputedStyle(n);m&&(i=r1(i,m,y))}const{top:a,left:o,width:u,height:d,bottom:f,right:h}=i;return{top:a,left:o,width:u,height:d,bottom:f,right:h}}function Xv(n){return kl(n,{ignoreTransform:!0})}function i1(n){const t=n.innerWidth,i=n.innerHeight;return{top:0,left:0,right:t,bottom:i,width:t,height:i}}function a1(n,t){return t===void 0&&(t=fr(n).getComputedStyle(n)),t.position==="fixed"}function l1(n,t){t===void 0&&(t=fr(n).getComputedStyle(n));const i=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const u=t[o];return typeof u=="string"?i.test(u):!1})}function hd(n,t){const i=[];function a(o){if(t!=null&&i.length>=t||!o)return i;if(Fp(o)&&o.scrollingElement!=null&&!i.includes(o.scrollingElement))return i.push(o.scrollingElement),i;if(!lc(o)||W0(o)||i.includes(o))return i;const u=fr(n).getComputedStyle(o);return o!==n&&l1(o,u)&&i.push(o),a1(o,u)?i:a(o.parentNode)}return n?a(n):i}function nb(n){const[t]=hd(n,1);return t??null}function Af(n){return!cd||!n?null:Nl(n)?n:qp(n)?Fp(n)||n===El(n).scrollingElement?window:lc(n)?n:null:null}function rb(n){return Nl(n)?n.scrollX:n.scrollLeft}function sb(n){return Nl(n)?n.scrollY:n.scrollTop}function mp(n){return{x:rb(n),y:sb(n)}}var Xn;(function(n){n[n.Forward=1]="Forward",n[n.Backward=-1]="Backward"})(Xn||(Xn={}));function ib(n){return!cd||!n?!1:n===document.scrollingElement}function ab(n){const t={x:0,y:0},i=ib(n)?{height:window.innerHeight,width:window.innerWidth}:{height:n.clientHeight,width:n.clientWidth},a={x:n.scrollWidth-i.width,y:n.scrollHeight-i.height},o=n.scrollTop<=t.y,u=n.scrollLeft<=t.x,d=n.scrollTop>=a.y,f=n.scrollLeft>=a.x;return{isTop:o,isLeft:u,isBottom:d,isRight:f,maxScroll:a,minScroll:t}}const o1={x:.2,y:.2};function c1(n,t,i,a,o){let{top:u,left:d,right:f,bottom:h}=i;a===void 0&&(a=10),o===void 0&&(o=o1);const{isTop:m,isBottom:y,isLeft:v,isRight:x}=ab(n),S={x:0,y:0},_={x:0,y:0},N={height:t.height*o.y,width:t.width*o.x};return!m&&u<=t.top+N.height?(S.y=Xn.Backward,_.y=a*Math.abs((t.top+N.height-u)/N.height)):!y&&h>=t.bottom-N.height&&(S.y=Xn.Forward,_.y=a*Math.abs((t.bottom-N.height-h)/N.height)),!x&&f>=t.right-N.width?(S.x=Xn.Forward,_.x=a*Math.abs((t.right-N.width-f)/N.width)):!v&&d<=t.left+N.width&&(S.x=Xn.Backward,_.x=a*Math.abs((t.left+N.width-d)/N.width)),{direction:S,speed:_}}function u1(n){if(n===document.scrollingElement){const{innerWidth:u,innerHeight:d}=window;return{top:0,left:0,right:u,bottom:d,width:u,height:d}}const{top:t,left:i,right:a,bottom:o}=n.getBoundingClientRect();return{top:t,left:i,right:a,bottom:o,width:n.clientWidth,height:n.clientHeight}}function lb(n){return n.reduce((t,i)=>xl(t,mp(i)),hs)}function d1(n){return n.reduce((t,i)=>t+rb(i),0)}function h1(n){return n.reduce((t,i)=>t+sb(i),0)}function ob(n,t){if(t===void 0&&(t=kl),!n)return;const{top:i,left:a,bottom:o,right:u}=t(n);nb(n)&&(o<=0||u<=0||i>=window.innerHeight||a>=window.innerWidth)&&n.scrollIntoView({block:"center",inline:"center"})}const f1=[["x",["left","right"],d1],["y",["top","bottom"],h1]];class Gp{constructor(t,i){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=hd(i),o=lb(a);this.rect={...t},this.width=t.width,this.height=t.height;for(const[u,d,f]of f1)for(const h of d)Object.defineProperty(this,h,{get:()=>{const m=f(a),y=o[u]-m;return this.rect[h]+y},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Bo{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(i=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...i)})},this.target=t}add(t,i,a){var o;(o=this.target)==null||o.addEventListener(t,i,a),this.listeners.push([t,i,a])}}function p1(n){const{EventTarget:t}=fr(n);return n instanceof t?n:El(n)}function Rf(n,t){const i=Math.abs(n.x),a=Math.abs(n.y);return typeof t=="number"?Math.sqrt(i**2+a**2)>t:"x"in t&&"y"in t?i>t.x&&a>t.y:"x"in t?i>t.x:"y"in t?a>t.y:!1}var Yr;(function(n){n.Click="click",n.DragStart="dragstart",n.Keydown="keydown",n.ContextMenu="contextmenu",n.Resize="resize",n.SelectionChange="selectionchange",n.VisibilityChange="visibilitychange"})(Yr||(Yr={}));function Zv(n){n.preventDefault()}function m1(n){n.stopPropagation()}var nn;(function(n){n.Space="Space",n.Down="ArrowDown",n.Right="ArrowRight",n.Left="ArrowLeft",n.Up="ArrowUp",n.Esc="Escape",n.Enter="Enter",n.Tab="Tab"})(nn||(nn={}));const cb={start:[nn.Space,nn.Enter],cancel:[nn.Esc],end:[nn.Space,nn.Enter,nn.Tab]},g1=(n,t)=>{let{currentCoordinates:i}=t;switch(n.code){case nn.Right:return{...i,x:i.x+25};case nn.Left:return{...i,x:i.x-25};case nn.Down:return{...i,y:i.y+25};case nn.Up:return{...i,y:i.y-25}}};class Tl{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:i}}=t;this.props=t,this.listeners=new Bo(El(i)),this.windowListeners=new Bo(fr(i)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Yr.Resize,this.handleCancel),this.windowListeners.add(Yr.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Yr.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:i}=this.props,a=t.node.current;a&&ob(a),i(hs)}handleKeyDown(t){if(dd(t)){const{active:i,context:a,options:o}=this.props,{keyboardCodes:u=cb,coordinateGetter:d=g1,scrollBehavior:f="smooth"}=o,{code:h}=t;if(u.end.includes(h)){this.handleEnd(t);return}if(u.cancel.includes(h)){this.handleCancel(t);return}const{collisionRect:m}=a.current,y=m?{x:m.left,y:m.top}:hs;this.referenceCoordinates||(this.referenceCoordinates=y);const v=d(t,{active:i,context:a.current,currentCoordinates:y});if(v){const x=Ko(v,y),S={x:0,y:0},{scrollableAncestors:_}=a.current;for(const N of _){const w=t.code,{isTop:C,isRight:D,isLeft:z,isBottom:T,maxScroll:U,minScroll:E}=ab(N),R=u1(N),A={x:Math.min(w===nn.Right?R.right-R.width/2:R.right,Math.max(w===nn.Right?R.left:R.left+R.width/2,v.x)),y:Math.min(w===nn.Down?R.bottom-R.height/2:R.bottom,Math.max(w===nn.Down?R.top:R.top+R.height/2,v.y))},O=w===nn.Right&&!D||w===nn.Left&&!z,V=w===nn.Down&&!T||w===nn.Up&&!C;if(O&&A.x!==v.x){const P=N.scrollLeft+x.x,F=w===nn.Right&&P<=U.x||w===nn.Left&&P>=E.x;if(F&&!x.y){N.scrollTo({left:P,behavior:f});return}F?S.x=N.scrollLeft-P:S.x=w===nn.Right?N.scrollLeft-U.x:N.scrollLeft-E.x,S.x&&N.scrollBy({left:-S.x,behavior:f});break}else if(V&&A.y!==v.y){const P=N.scrollTop+x.y,F=w===nn.Down&&P<=U.y||w===nn.Up&&P>=E.y;if(F&&!x.x){N.scrollTo({top:P,behavior:f});return}F?S.y=N.scrollTop-P:S.y=w===nn.Down?N.scrollTop-U.y:N.scrollTop-E.y,S.y&&N.scrollBy({top:-S.y,behavior:f});break}}this.handleMove(t,xl(Ko(v,this.referenceCoordinates),S))}}}handleMove(t,i){const{onMove:a}=this.props;t.preventDefault(),a(i)}handleEnd(t){const{onEnd:i}=this.props;t.preventDefault(),this.detach(),i()}handleCancel(t){const{onCancel:i}=this.props;t.preventDefault(),this.detach(),i()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Tl.activators=[{eventName:"onKeyDown",handler:(n,t,i)=>{let{keyboardCodes:a=cb,onActivation:o}=t,{active:u}=i;const{code:d}=n.nativeEvent;if(a.start.includes(d)){const f=u.activatorNode.current;return f&&n.target!==f?!1:(n.preventDefault(),o?.({event:n.nativeEvent}),!0)}return!1}}];function ex(n){return!!(n&&"distance"in n)}function tx(n){return!!(n&&"delay"in n)}class Kp{constructor(t,i,a){var o;a===void 0&&(a=p1(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=i;const{event:u}=t,{target:d}=u;this.props=t,this.events=i,this.document=El(d),this.documentListeners=new Bo(this.document),this.listeners=new Bo(a),this.windowListeners=new Bo(fr(d)),this.initialCoordinates=(o=Ku(u))!=null?o:hs,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:i,bypassActivationConstraint:a}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Yr.Resize,this.handleCancel),this.windowListeners.add(Yr.DragStart,Zv),this.windowListeners.add(Yr.VisibilityChange,this.handleCancel),this.windowListeners.add(Yr.ContextMenu,Zv),this.documentListeners.add(Yr.Keydown,this.handleKeydown),i){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(tx(i)){this.timeoutId=setTimeout(this.handleStart,i.delay),this.handlePending(i);return}if(ex(i)){this.handlePending(i);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,i){const{active:a,onPending:o}=this.props;o(a,t,this.initialCoordinates,i)}handleStart(){const{initialCoordinates:t}=this,{onStart:i}=this.props;t&&(this.activated=!0,this.documentListeners.add(Yr.Click,m1,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Yr.SelectionChange,this.removeTextSelection),i(t))}handleMove(t){var i;const{activated:a,initialCoordinates:o,props:u}=this,{onMove:d,options:{activationConstraint:f}}=u;if(!o)return;const h=(i=Ku(t))!=null?i:hs,m=Ko(o,h);if(!a&&f){if(ex(f)){if(f.tolerance!=null&&Rf(m,f.tolerance))return this.handleCancel();if(Rf(m,f.distance))return this.handleStart()}if(tx(f)&&Rf(m,f.tolerance))return this.handleCancel();this.handlePending(f,m);return}t.cancelable&&t.preventDefault(),d(h)}handleEnd(){const{onAbort:t,onEnd:i}=this.props;this.detach(),this.activated||t(this.props.active),i()}handleCancel(){const{onAbort:t,onCancel:i}=this.props;this.detach(),this.activated||t(this.props.active),i()}handleKeydown(t){t.code===nn.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const y1={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class fd extends Kp{constructor(t){const{event:i}=t,a=El(i.target);super(t,y1,a)}}fd.activators=[{eventName:"onPointerDown",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;return!i.isPrimary||i.button!==0?!1:(a?.({event:i}),!0)}}];const v1={move:{name:"mousemove"},end:{name:"mouseup"}};var gp;(function(n){n[n.RightClick=2]="RightClick"})(gp||(gp={}));class Al extends Kp{constructor(t){super(t,v1,El(t.event.target))}}Al.activators=[{eventName:"onMouseDown",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;return i.button===gp.RightClick?!1:(a?.({event:i}),!0)}}];const Of={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Rl extends Kp{constructor(t){super(t,Of)}static setup(){return window.addEventListener(Of.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Of.move.name,t)};function t(){}}}Rl.activators=[{eventName:"onTouchStart",handler:(n,t)=>{let{nativeEvent:i}=n,{onActivation:a}=t;const{touches:o}=i;return o.length>1?!1:(a?.({event:i}),!0)}}];var $o;(function(n){n[n.Pointer=0]="Pointer",n[n.DraggableRect=1]="DraggableRect"})($o||($o={}));var Qu;(function(n){n[n.TreeOrder=0]="TreeOrder",n[n.ReversedTreeOrder=1]="ReversedTreeOrder"})(Qu||(Qu={}));function x1(n){let{acceleration:t,activator:i=$o.Pointer,canScroll:a,draggingRect:o,enabled:u,interval:d=5,order:f=Qu.TreeOrder,pointerCoordinates:h,scrollableAncestors:m,scrollableAncestorRects:y,delta:v,threshold:x}=n;const S=w1({delta:v,disabled:!u}),[_,N]=z_(),w=b.useRef({x:0,y:0}),C=b.useRef({x:0,y:0}),D=b.useMemo(()=>{switch(i){case $o.Pointer:return h?{top:h.y,bottom:h.y,left:h.x,right:h.x}:null;case $o.DraggableRect:return o}},[i,o,h]),z=b.useRef(null),T=b.useCallback(()=>{const E=z.current;if(!E)return;const R=w.current.x*C.current.x,A=w.current.y*C.current.y;E.scrollBy(R,A)},[]),U=b.useMemo(()=>f===Qu.TreeOrder?[...m].reverse():m,[f,m]);b.useEffect(()=>{if(!u||!m.length||!D){N();return}for(const E of U){if(a?.(E)===!1)continue;const R=m.indexOf(E),A=y[R];if(!A)continue;const{direction:O,speed:V}=c1(E,A,D,t,x);for(const P of["x","y"])S[P][O[P]]||(V[P]=0,O[P]=0);if(V.x>0||V.y>0){N(),z.current=E,_(T,d),w.current=V,C.current=O;return}}w.current={x:0,y:0},C.current={x:0,y:0},N()},[t,T,a,N,u,d,JSON.stringify(D),JSON.stringify(S),_,m,U,y,JSON.stringify(x)])}const b1={x:{[Xn.Backward]:!1,[Xn.Forward]:!1},y:{[Xn.Backward]:!1,[Xn.Forward]:!1}};function w1(n){let{delta:t,disabled:i}=n;const a=Gu(t);return oc(o=>{if(i||!a||!o)return b1;const u={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[Xn.Backward]:o.x[Xn.Backward]||u.x===-1,[Xn.Forward]:o.x[Xn.Forward]||u.x===1},y:{[Xn.Backward]:o.y[Xn.Backward]||u.y===-1,[Xn.Forward]:o.y[Xn.Forward]||u.y===1}}},[i,t,a])}function S1(n,t){const i=t!=null?n.get(t):void 0,a=i?i.node.current:null;return oc(o=>{var u;return t==null?null:(u=a??o)!=null?u:null},[a,t])}function j1(n,t){return b.useMemo(()=>n.reduce((i,a)=>{const{sensor:o}=a,u=o.activators.map(d=>({eventName:d.eventName,handler:t(d.handler,a)}));return[...i,...u]},[]),[n,t])}var Yo;(function(n){n[n.Always=0]="Always",n[n.BeforeDragging=1]="BeforeDragging",n[n.WhileDragging=2]="WhileDragging"})(Yo||(Yo={}));var yp;(function(n){n.Optimized="optimized"})(yp||(yp={}));const nx=new Map;function _1(n,t){let{dragging:i,dependencies:a,config:o}=t;const[u,d]=b.useState(null),{frequency:f,measure:h,strategy:m}=o,y=b.useRef(n),v=w(),x=Go(v),S=b.useCallback(function(C){C===void 0&&(C=[]),!x.current&&d(D=>D===null?C:D.concat(C.filter(z=>!D.includes(z))))},[x]),_=b.useRef(null),N=oc(C=>{if(v&&!i)return nx;if(!C||C===nx||y.current!==n||u!=null){const D=new Map;for(let z of n){if(!z)continue;if(u&&u.length>0&&!u.includes(z.id)&&z.rect.current){D.set(z.id,z.rect.current);continue}const T=z.node.current,U=T?new Gp(h(T),T):null;z.rect.current=U,U&&D.set(z.id,U)}return D}return C},[n,u,i,v,h]);return b.useEffect(()=>{y.current=n},[n]),b.useEffect(()=>{v||S()},[i,v]),b.useEffect(()=>{u&&u.length>0&&d(null)},[JSON.stringify(u)]),b.useEffect(()=>{v||typeof f!="number"||_.current!==null||(_.current=setTimeout(()=>{S(),_.current=null},f))},[f,v,S,...a]),{droppableRects:N,measureDroppableContainers:S,measuringScheduled:u!=null};function w(){switch(m){case Yo.Always:return!1;case Yo.BeforeDragging:return i;default:return!i}}}function Yp(n,t){return oc(i=>n?i||(typeof t=="function"?t(n):n):null,[t,n])}function C1(n,t){return Yp(n,t)}function N1(n){let{callback:t,disabled:i}=n;const a=ud(t),o=b.useMemo(()=>{if(i||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:u}=window;return new u(a)},[a,i]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function pd(n){let{callback:t,disabled:i}=n;const a=ud(t),o=b.useMemo(()=>{if(i||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:u}=window;return new u(a)},[i]);return b.useEffect(()=>()=>o?.disconnect(),[o]),o}function E1(n){return new Gp(kl(n),n)}function rx(n,t,i){t===void 0&&(t=E1);const[a,o]=b.useState(null);function u(){o(h=>{if(!n)return null;if(n.isConnected===!1){var m;return(m=h??i)!=null?m:null}const y=t(n);return JSON.stringify(h)===JSON.stringify(y)?h:y})}const d=N1({callback(h){if(n)for(const m of h){const{type:y,target:v}=m;if(y==="childList"&&v instanceof HTMLElement&&v.contains(n)){u();break}}}}),f=pd({callback:u});return ds(()=>{u(),n?(f?.observe(n),d?.observe(document.body,{childList:!0,subtree:!0})):(f?.disconnect(),d?.disconnect())},[n]),a}function k1(n){const t=Yp(n);return eb(n,t)}const sx=[];function T1(n){const t=b.useRef(n),i=oc(a=>n?a&&a!==sx&&n&&t.current&&n.parentNode===t.current.parentNode?a:hd(n):sx,[n]);return b.useEffect(()=>{t.current=n},[n]),i}function A1(n){const[t,i]=b.useState(null),a=b.useRef(n),o=b.useCallback(u=>{const d=Af(u.target);d&&i(f=>f?(f.set(d,mp(d)),new Map(f)):null)},[]);return b.useEffect(()=>{const u=a.current;if(n!==u){d(u);const f=n.map(h=>{const m=Af(h);return m?(m.addEventListener("scroll",o,{passive:!0}),[m,mp(m)]):null}).filter(h=>h!=null);i(f.length?new Map(f):null),a.current=n}return()=>{d(n),d(u)};function d(f){f.forEach(h=>{const m=Af(h);m?.removeEventListener("scroll",o)})}},[o,n]),b.useMemo(()=>n.length?t?Array.from(t.values()).reduce((u,d)=>xl(u,d),hs):lb(n):hs,[n,t])}function ix(n,t){t===void 0&&(t=[]);const i=b.useRef(null);return b.useEffect(()=>{i.current=null},t),b.useEffect(()=>{const a=n!==hs;a&&!i.current&&(i.current=n),!a&&i.current&&(i.current=null)},[n]),i.current?Ko(n,i.current):hs}function R1(n){b.useEffect(()=>{if(!cd)return;const t=n.map(i=>{let{sensor:a}=i;return a.setup==null?void 0:a.setup()});return()=>{for(const i of t)i?.()}},n.map(t=>{let{sensor:i}=t;return i}))}function O1(n,t){return b.useMemo(()=>n.reduce((i,a)=>{let{eventName:o,handler:u}=a;return i[o]=d=>{u(d,t)},i},{}),[n,t])}function ub(n){return b.useMemo(()=>n?i1(n):null,[n])}const ax=[];function D1(n,t){t===void 0&&(t=kl);const[i]=n,a=ub(i?fr(i):null),[o,u]=b.useState(ax);function d(){u(()=>n.length?n.map(h=>ib(h)?a:new Gp(t(h),h)):ax)}const f=pd({callback:d});return ds(()=>{f?.disconnect(),d(),n.forEach(h=>f?.observe(h))},[n]),o}function db(n){if(!n)return null;if(n.children.length>1)return n;const t=n.children[0];return lc(t)?t:n}function M1(n){let{measure:t}=n;const[i,a]=b.useState(null),o=b.useCallback(m=>{for(const{target:y}of m)if(lc(y)){a(v=>{const x=t(y);return v?{...v,width:x.width,height:x.height}:x});break}},[t]),u=pd({callback:o}),d=b.useCallback(m=>{const y=db(m);u?.disconnect(),y&&u?.observe(y),a(y?t(y):null)},[t,u]),[f,h]=Vu(d);return b.useMemo(()=>({nodeRef:f,rect:i,setRef:h}),[i,f,h])}const z1=[{sensor:fd,options:{}},{sensor:Tl,options:{}}],L1={current:{}},Bu={draggable:{measure:Xv},droppable:{measure:Xv,strategy:Yo.WhileDragging,frequency:yp.Optimized},dragOverlay:{measure:kl}};class Po extends Map{get(t){var i;return t!=null&&(i=super.get(t))!=null?i:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:i}=t;return!i})}getNodeFor(t){var i,a;return(i=(a=this.get(t))==null?void 0:a.node.current)!=null?i:void 0}}const U1={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Po,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Yu},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Bu,measureDroppableContainers:Yu,windowRect:null,measuringScheduled:!1},hb={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Yu,draggableNodes:new Map,over:null,measureDroppableContainers:Yu},uc=b.createContext(hb),fb=b.createContext(U1);function I1(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Po}}}function B1(n,t){switch(t.type){case Kn.DragStart:return{...n,draggable:{...n.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Kn.DragMove:return n.draggable.active==null?n:{...n,draggable:{...n.draggable,translate:{x:t.coordinates.x-n.draggable.initialCoordinates.x,y:t.coordinates.y-n.draggable.initialCoordinates.y}}};case Kn.DragEnd:case Kn.DragCancel:return{...n,draggable:{...n.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Kn.RegisterDroppable:{const{element:i}=t,{id:a}=i,o=new Po(n.droppable.containers);return o.set(a,i),{...n,droppable:{...n.droppable,containers:o}}}case Kn.SetDroppableDisabled:{const{id:i,key:a,disabled:o}=t,u=n.droppable.containers.get(i);if(!u||a!==u.key)return n;const d=new Po(n.droppable.containers);return d.set(i,{...u,disabled:o}),{...n,droppable:{...n.droppable,containers:d}}}case Kn.UnregisterDroppable:{const{id:i,key:a}=t,o=n.droppable.containers.get(i);if(!o||a!==o.key)return n;const u=new Po(n.droppable.containers);return u.delete(i),{...n,droppable:{...n.droppable,containers:u}}}default:return n}}function $1(n){let{disabled:t}=n;const{active:i,activatorEvent:a,draggableNodes:o}=b.useContext(uc),u=Gu(a),d=Gu(i?.id);return b.useEffect(()=>{if(!t&&!a&&u&&d!=null){if(!dd(u)||document.activeElement===u.target)return;const f=o.get(d);if(!f)return;const{activatorNode:h,node:m}=f;if(!h.current&&!m.current)return;requestAnimationFrame(()=>{for(const y of[h.current,m.current]){if(!y)continue;const v=I_(y);if(v){v.focus();break}}})}},[a,t,o,d,u]),null}function pb(n,t){let{transform:i,...a}=t;return n!=null&&n.length?n.reduce((o,u)=>u({transform:o,...a}),i):i}function P1(n){return b.useMemo(()=>({draggable:{...Bu.draggable,...n?.draggable},droppable:{...Bu.droppable,...n?.droppable},dragOverlay:{...Bu.dragOverlay,...n?.dragOverlay}}),[n?.draggable,n?.droppable,n?.dragOverlay])}function q1(n){let{activeNode:t,measure:i,initialRect:a,config:o=!0}=n;const u=b.useRef(!1),{x:d,y:f}=typeof o=="boolean"?{x:o,y:o}:o;ds(()=>{if(!d&&!f||!t){u.current=!1;return}if(u.current||!a)return;const m=t?.node.current;if(!m||m.isConnected===!1)return;const y=i(m),v=eb(y,a);if(d||(v.x=0),f||(v.y=0),u.current=!0,Math.abs(v.x)>0||Math.abs(v.y)>0){const x=nb(m);x&&x.scrollBy({top:v.y,left:v.x})}},[t,d,f,a,i])}const md=b.createContext({...hs,scaleX:1,scaleY:1});var Ei;(function(n){n[n.Uninitialized=0]="Uninitialized",n[n.Initializing=1]="Initializing",n[n.Initialized=2]="Initialized"})(Ei||(Ei={}));const Mi=b.memo(function(t){var i,a,o,u;let{id:d,accessibility:f,autoScroll:h=!0,children:m,sensors:y=z1,collisionDetection:v=X_,measuring:x,modifiers:S,..._}=t;const N=b.useReducer(B1,void 0,I1),[w,C]=N,[D,z]=H_(),[T,U]=b.useState(Ei.Uninitialized),E=T===Ei.Initialized,{draggable:{active:R,nodes:A,translate:O},droppable:{containers:V}}=w,P=R!=null?A.get(R):null,F=b.useRef({initial:null,translated:null}),Q=b.useMemo(()=>{var Ie;return R!=null?{id:R,data:(Ie=P?.data)!=null?Ie:L1,rect:F}:null},[R,P]),$=b.useRef(null),[I,k]=b.useState(null),[L,H]=b.useState(null),G=Go(_,Object.values(_)),ce=cc("DndDescribedBy",d),q=b.useMemo(()=>V.getEnabled(),[V]),W=P1(x),{droppableRects:ie,measureDroppableContainers:ve,measuringScheduled:xe}=_1(q,{dragging:E,dependencies:[O.x,O.y],config:W.droppable}),Ne=S1(A,R),de=b.useMemo(()=>L?Ku(L):null,[L]),K=ke(),ge=C1(Ne,W.draggable.measure);q1({activeNode:R!=null?A.get(R):null,config:K.layoutShiftCompensation,initialRect:ge,measure:W.draggable.measure});const Ae=rx(Ne,W.draggable.measure,ge),ae=rx(Ne?Ne.parentElement:null),Se=b.useRef({activatorEvent:null,active:null,activeNode:Ne,collisionRect:null,collisions:null,droppableRects:ie,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:V,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Re=V.getNodeFor((i=Se.current.over)==null?void 0:i.id),Oe=M1({measure:W.dragOverlay.measure}),He=(a=Oe.nodeRef.current)!=null?a:Ne,nt=E?(o=Oe.rect)!=null?o:Ae:null,ot=!!(Oe.nodeRef.current&&Oe.rect),Fe=k1(ot?null:Ae),Ce=ub(He?fr(He):null),Ee=T1(E?Re??Ne:null),se=D1(Ee),Pe=pb(S,{transform:{x:O.x-Fe.x,y:O.y-Fe.y,scaleX:1,scaleY:1},activatorEvent:L,active:Q,activeNodeRect:Ae,containerNodeRect:ae,draggingNodeRect:nt,over:Se.current.over,overlayNodeRect:Oe.rect,scrollableAncestors:Ee,scrollableAncestorRects:se,windowRect:Ce}),dt=de?xl(de,O):null,gt=A1(Ee),ct=ix(gt),Qe=ix(gt,[Ae]),it=xl(Pe,ct),tt=nt?n1(nt,Pe):null,ut=Q&&tt?v({active:Q,collisionRect:tt,droppableRects:ie,droppableContainers:q,pointerCoordinates:dt}):null,qt=X0(ut,"id"),[$t,an]=b.useState(null),Ht=ot?Pe:xl(Pe,Qe),rn=e1(Ht,(u=$t?.rect)!=null?u:null,Ae),sn=b.useRef(null),Kt=b.useCallback((Ie,Ve)=>{let{sensor:lt,options:bt}=Ve;if($.current==null)return;const Lt=A.get($.current);if(!Lt)return;const Pt=Ie.nativeEvent,hn=new lt({active:$.current,activeNode:Lt,event:Pt,options:bt,context:Se,onAbort(Ye){if(!A.get(Ye))return;const{onDragAbort:We}=G.current,At={id:Ye};We?.(At),D({type:"onDragAbort",event:At})},onPending(Ye,ht,We,At){if(!A.get(Ye))return;const{onDragPending:Dt}=G.current,Vt={id:Ye,constraint:ht,initialCoordinates:We,offset:At};Dt?.(Vt),D({type:"onDragPending",event:Vt})},onStart(Ye){const ht=$.current;if(ht==null)return;const We=A.get(ht);if(!We)return;const{onDragStart:At}=G.current,jt={activatorEvent:Pt,active:{id:ht,data:We.data,rect:F}};ma.unstable_batchedUpdates(()=>{At?.(jt),U(Ei.Initializing),C({type:Kn.DragStart,initialCoordinates:Ye,active:ht}),D({type:"onDragStart",event:jt}),k(sn.current),H(Pt)})},onMove(Ye){C({type:Kn.DragMove,coordinates:Ye})},onEnd:he(Kn.DragEnd),onCancel:he(Kn.DragCancel)});sn.current=hn;function he(Ye){return async function(){const{active:We,collisions:At,over:jt,scrollAdjustedTranslate:Dt}=Se.current;let Vt=null;if(We&&Dt){const{cancelDrop:pt}=G.current;Vt={activatorEvent:Pt,active:We,collisions:At,delta:Dt,over:jt},Ye===Kn.DragEnd&&typeof pt=="function"&&await Promise.resolve(pt(Vt))&&(Ye=Kn.DragCancel)}$.current=null,ma.unstable_batchedUpdates(()=>{C({type:Ye}),U(Ei.Uninitialized),an(null),k(null),H(null),sn.current=null;const pt=Ye===Kn.DragEnd?"onDragEnd":"onDragCancel";if(Vt){const te=G.current[pt];te?.(Vt),D({type:pt,event:Vt})}})}}},[A]),In=b.useCallback((Ie,Ve)=>(lt,bt)=>{const Lt=lt.nativeEvent,Pt=A.get(bt);if($.current!==null||!Pt||Lt.dndKit||Lt.defaultPrevented)return;const hn={active:Pt};Ie(lt,Ve.options,hn)===!0&&(Lt.dndKit={capturedBy:Ve.sensor},$.current=bt,Kt(lt,Ve))},[A,Kt]),mn=j1(y,In);R1(y),ds(()=>{Ae&&T===Ei.Initializing&&U(Ei.Initialized)},[Ae,T]),b.useEffect(()=>{const{onDragMove:Ie}=G.current,{active:Ve,activatorEvent:lt,collisions:bt,over:Lt}=Se.current;if(!Ve||!lt)return;const Pt={active:Ve,activatorEvent:lt,collisions:bt,delta:{x:it.x,y:it.y},over:Lt};ma.unstable_batchedUpdates(()=>{Ie?.(Pt),D({type:"onDragMove",event:Pt})})},[it.x,it.y]),b.useEffect(()=>{const{active:Ie,activatorEvent:Ve,collisions:lt,droppableContainers:bt,scrollAdjustedTranslate:Lt}=Se.current;if(!Ie||$.current==null||!Ve||!Lt)return;const{onDragOver:Pt}=G.current,hn=bt.get(qt),he=hn&&hn.rect.current?{id:hn.id,rect:hn.rect.current,data:hn.data,disabled:hn.disabled}:null,Ye={active:Ie,activatorEvent:Ve,collisions:lt,delta:{x:Lt.x,y:Lt.y},over:he};ma.unstable_batchedUpdates(()=>{an(he),Pt?.(Ye),D({type:"onDragOver",event:Ye})})},[qt]),ds(()=>{Se.current={activatorEvent:L,active:Q,activeNode:Ne,collisionRect:tt,collisions:ut,droppableRects:ie,draggableNodes:A,draggingNode:He,draggingNodeRect:nt,droppableContainers:V,over:$t,scrollableAncestors:Ee,scrollAdjustedTranslate:it},F.current={initial:nt,translated:tt}},[Q,Ne,ut,tt,A,He,nt,ie,V,$t,Ee,it]),x1({...K,delta:O,draggingRect:tt,pointerCoordinates:dt,scrollableAncestors:Ee,scrollableAncestorRects:se});const ee=b.useMemo(()=>({active:Q,activeNode:Ne,activeNodeRect:Ae,activatorEvent:L,collisions:ut,containerNodeRect:ae,dragOverlay:Oe,draggableNodes:A,droppableContainers:V,droppableRects:ie,over:$t,measureDroppableContainers:ve,scrollableAncestors:Ee,scrollableAncestorRects:se,measuringConfiguration:W,measuringScheduled:xe,windowRect:Ce}),[Q,Ne,Ae,L,ut,ae,Oe,A,V,ie,$t,ve,Ee,se,W,xe,Ce]),De=b.useMemo(()=>({activatorEvent:L,activators:mn,active:Q,activeNodeRect:Ae,ariaDescribedById:{draggable:ce},dispatch:C,draggableNodes:A,over:$t,measureDroppableContainers:ve}),[L,mn,Q,Ae,C,ce,A,$t,ve]);return je.createElement(J0.Provider,{value:z},je.createElement(uc.Provider,{value:De},je.createElement(fb.Provider,{value:ee},je.createElement(md.Provider,{value:rn},m)),je.createElement($1,{disabled:f?.restoreFocus===!1})),je.createElement(K_,{...f,hiddenTextDescribedById:ce}));function ke(){const Ie=I?.autoScrollEnabled===!1,Ve=typeof h=="object"?h.enabled===!1:h===!1,lt=E&&!Ie&&!Ve;return typeof h=="object"?{...h,enabled:lt}:{enabled:lt}}}),F1=b.createContext(null),lx="button",H1="Draggable";function Wp(n){let{id:t,data:i,disabled:a=!1,attributes:o}=n;const u=cc(H1),{activators:d,activatorEvent:f,active:h,activeNodeRect:m,ariaDescribedById:y,draggableNodes:v,over:x}=b.useContext(uc),{role:S=lx,roleDescription:_="draggable",tabIndex:N=0}=o??{},w=h?.id===t,C=b.useContext(w?md:F1),[D,z]=Vu(),[T,U]=Vu(),E=O1(d,t),R=Go(i);ds(()=>(v.set(t,{id:t,key:u,node:D,activatorNode:T,data:R}),()=>{const O=v.get(t);O&&O.key===u&&v.delete(t)}),[v,t]);const A=b.useMemo(()=>({role:S,tabIndex:N,"aria-disabled":a,"aria-pressed":w&&S===lx?!0:void 0,"aria-roledescription":_,"aria-describedby":y.draggable}),[a,S,N,w,_,y.draggable]);return{active:h,activatorEvent:f,activeNodeRect:m,attributes:A,isDragging:w,listeners:a?void 0:E,node:D,over:x,setNodeRef:z,setActivatorNodeRef:U,transform:C}}function mb(){return b.useContext(fb)}const V1="Droppable",G1={timeout:25};function dc(n){let{data:t,disabled:i=!1,id:a,resizeObserverConfig:o}=n;const u=cc(V1),{active:d,dispatch:f,over:h,measureDroppableContainers:m}=b.useContext(uc),y=b.useRef({disabled:i}),v=b.useRef(!1),x=b.useRef(null),S=b.useRef(null),{disabled:_,updateMeasurementsFor:N,timeout:w}={...G1,...o},C=Go(N??a),D=b.useCallback(()=>{if(!v.current){v.current=!0;return}S.current!=null&&clearTimeout(S.current),S.current=setTimeout(()=>{m(Array.isArray(C.current)?C.current:[C.current]),S.current=null},w)},[w]),z=pd({callback:D,disabled:_||!d}),T=b.useCallback((A,O)=>{z&&(O&&(z.unobserve(O),v.current=!1),A&&z.observe(A))},[z]),[U,E]=Vu(T),R=Go(t);return b.useEffect(()=>{!z||!U.current||(z.disconnect(),v.current=!1,z.observe(U.current))},[U,z]),b.useEffect(()=>(f({type:Kn.RegisterDroppable,element:{id:a,key:u,disabled:i,node:U,rect:x,data:R}}),()=>f({type:Kn.UnregisterDroppable,key:u,id:a})),[a]),b.useEffect(()=>{i!==y.current.disabled&&(f({type:Kn.SetDroppableDisabled,id:a,key:u,disabled:i}),y.current.disabled=i)},[a,u,i,f]),{active:d,rect:x,isOver:h?.id===a,node:U,over:h,setNodeRef:E}}function K1(n){let{animation:t,children:i}=n;const[a,o]=b.useState(null),[u,d]=b.useState(null),f=Gu(i);return!i&&!a&&f&&o(f),ds(()=>{if(!u)return;const h=a?.key,m=a?.props.id;if(h==null||m==null){o(null);return}Promise.resolve(t(m,u)).then(()=>{o(null)})},[t,a,u]),je.createElement(je.Fragment,null,i,a?b.cloneElement(a,{ref:d}):null)}const Y1={x:0,y:0,scaleX:1,scaleY:1};function W1(n){let{children:t}=n;return je.createElement(uc.Provider,{value:hb},je.createElement(md.Provider,{value:Y1},t))}const Q1={position:"fixed",touchAction:"none"},J1=n=>dd(n)?"transform 250ms ease":void 0,X1=b.forwardRef((n,t)=>{let{as:i,activatorEvent:a,adjustScale:o,children:u,className:d,rect:f,style:h,transform:m,transition:y=J1}=n;if(!f)return null;const v=o?m:{...m,scaleX:1,scaleY:1},x={...Q1,width:f.width,height:f.height,top:f.top,left:f.left,transform:wr.Transform.toString(v),transformOrigin:o&&a?Y_(a,f):void 0,transition:typeof y=="function"?y(a):y,...h};return je.createElement(i,{className:d,style:x,ref:t},u)}),Qp=n=>t=>{let{active:i,dragOverlay:a}=t;const o={},{styles:u,className:d}=n;if(u!=null&&u.active)for(const[f,h]of Object.entries(u.active))h!==void 0&&(o[f]=i.node.style.getPropertyValue(f),i.node.style.setProperty(f,h));if(u!=null&&u.dragOverlay)for(const[f,h]of Object.entries(u.dragOverlay))h!==void 0&&a.node.style.setProperty(f,h);return d!=null&&d.active&&i.node.classList.add(d.active),d!=null&&d.dragOverlay&&a.node.classList.add(d.dragOverlay),function(){for(const[h,m]of Object.entries(o))i.node.style.setProperty(h,m);d!=null&&d.active&&i.node.classList.remove(d.active)}},Z1=n=>{let{transform:{initial:t,final:i}}=n;return[{transform:wr.Transform.toString(t)},{transform:wr.Transform.toString(i)}]},eC={duration:250,easing:"ease",keyframes:Z1,sideEffects:Qp({styles:{active:{opacity:"0"}}})};function tC(n){let{config:t,draggableNodes:i,droppableContainers:a,measuringConfiguration:o}=n;return ud((u,d)=>{if(t===null)return;const f=i.get(u);if(!f)return;const h=f.node.current;if(!h)return;const m=db(d);if(!m)return;const{transform:y}=fr(d).getComputedStyle(d),v=tb(y);if(!v)return;const x=typeof t=="function"?t:nC(t);return ob(h,o.draggable.measure),x({active:{id:u,data:f.data,node:h,rect:o.draggable.measure(h)},draggableNodes:i,dragOverlay:{node:d,rect:o.dragOverlay.measure(m)},droppableContainers:a,measuringConfiguration:o,transform:v})})}function nC(n){const{duration:t,easing:i,sideEffects:a,keyframes:o}={...eC,...n};return u=>{let{active:d,dragOverlay:f,transform:h,...m}=u;if(!t)return;const y={x:f.rect.left-d.rect.left,y:f.rect.top-d.rect.top},v={scaleX:h.scaleX!==1?d.rect.width*h.scaleX/f.rect.width:1,scaleY:h.scaleY!==1?d.rect.height*h.scaleY/f.rect.height:1},x={x:h.x-y.x,y:h.y-y.y,...v},S=o({...m,active:d,dragOverlay:f,transform:{initial:h,final:x}}),[_]=S,N=S[S.length-1];if(JSON.stringify(_)===JSON.stringify(N))return;const w=a?.({active:d,dragOverlay:f,...m}),C=f.node.animate(S,{duration:t,easing:i,fill:"forwards"});return new Promise(D=>{C.onfinish=()=>{w?.(),D()}})}}let ox=0;function rC(n){return b.useMemo(()=>{if(n!=null)return ox++,ox},[n])}const Jp=je.memo(n=>{let{adjustScale:t=!1,children:i,dropAnimation:a,style:o,transition:u,modifiers:d,wrapperElement:f="div",className:h,zIndex:m=999}=n;const{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:S,draggableNodes:_,droppableContainers:N,dragOverlay:w,over:C,measuringConfiguration:D,scrollableAncestors:z,scrollableAncestorRects:T,windowRect:U}=mb(),E=b.useContext(md),R=rC(v?.id),A=pb(d,{activatorEvent:y,active:v,activeNodeRect:x,containerNodeRect:S,draggingNodeRect:w.rect,over:C,overlayNodeRect:w.rect,scrollableAncestors:z,scrollableAncestorRects:T,transform:E,windowRect:U}),O=Yp(x),V=tC({config:a,draggableNodes:_,droppableContainers:N,measuringConfiguration:D}),P=O?w.setRef:void 0;return je.createElement(W1,null,je.createElement(K1,{animation:V},v&&R?je.createElement(X1,{key:R,id:v.id,ref:P,as:f,activatorEvent:y,adjustScale:t,className:h,transition:u,rect:O,style:{zIndex:m,...o},transform:A},i):null))});function Li(n,t,i){const a=n.slice();return a.splice(i<0?a.length+i:i,0,a.splice(t,1)[0]),a}function sC(n,t){return n.reduce((i,a,o)=>{const u=t.get(a);return u&&(i[o]=u),i},Array(n.length))}function Su(n){return n!==null&&n>=0}function iC(n,t){if(n===t)return!0;if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(n[i]!==t[i])return!1;return!0}function aC(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const Xp=n=>{let{rects:t,activeIndex:i,overIndex:a,index:o}=n;const u=Li(t,a,i),d=t[o],f=u[o];return!f||!d?null:{x:f.left-d.left,y:f.top-d.top,scaleX:f.width/d.width,scaleY:f.height/d.height}},ju={scaleX:1,scaleY:1},Sl=n=>{var t;let{activeIndex:i,activeNodeRect:a,index:o,rects:u,overIndex:d}=n;const f=(t=u[i])!=null?t:a;if(!f)return null;if(o===i){const m=u[d];return m?{x:0,y:i<d?m.top+m.height-(f.top+f.height):m.top-f.top,...ju}:null}const h=lC(u,o,i);return o>i&&o<=d?{x:0,y:-f.height-h,...ju}:o<i&&o>=d?{x:0,y:f.height+h,...ju}:{x:0,y:0,...ju}};function lC(n,t,i){const a=n[t],o=n[t-1],u=n[t+1];return a?i<t?o?a.top-(o.top+o.height):u?u.top-(a.top+a.height):0:u?u.top-(a.top+a.height):o?a.top-(o.top+o.height):0:0}const gb="Sortable",yb=je.createContext({activeIndex:-1,containerId:gb,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Xp,disabled:{draggable:!1,droppable:!1}});function xa(n){let{children:t,id:i,items:a,strategy:o=Xp,disabled:u=!1}=n;const{active:d,dragOverlay:f,droppableRects:h,over:m,measureDroppableContainers:y}=mb(),v=cc(gb,i),x=f.rect!==null,S=b.useMemo(()=>a.map(E=>typeof E=="object"&&"id"in E?E.id:E),[a]),_=d!=null,N=d?S.indexOf(d.id):-1,w=m?S.indexOf(m.id):-1,C=b.useRef(S),D=!iC(S,C.current),z=w!==-1&&N===-1||D,T=aC(u);ds(()=>{D&&_&&y(S)},[D,S,_,y]),b.useEffect(()=>{C.current=S},[S]);const U=b.useMemo(()=>({activeIndex:N,containerId:v,disabled:T,disableTransforms:z,items:S,overIndex:w,useDragOverlay:x,sortedRects:sC(S,h),strategy:o}),[N,v,T.draggable,T.droppable,z,S,w,h,x,o]);return je.createElement(yb.Provider,{value:U},t)}const oC=n=>{let{id:t,items:i,activeIndex:a,overIndex:o}=n;return Li(i,a,o).indexOf(t)},cC=n=>{let{containerId:t,isSorting:i,wasDragging:a,index:o,items:u,newIndex:d,previousItems:f,previousContainerId:h,transition:m}=n;return!m||!a||f!==u&&o===d?!1:i?!0:d!==o&&t===h},uC={duration:200,easing:"ease"},vb="transform",dC=wr.Transition.toString({property:vb,duration:0,easing:"linear"}),hC={roleDescription:"sortable"};function fC(n){let{disabled:t,index:i,node:a,rect:o}=n;const[u,d]=b.useState(null),f=b.useRef(i);return ds(()=>{if(!t&&i!==f.current&&a.current){const h=o.current;if(h){const m=kl(a.current,{ignoreTransform:!0}),y={x:h.left-m.left,y:h.top-m.top,scaleX:h.width/m.width,scaleY:h.height/m.height};(y.x||y.y)&&d(y)}}i!==f.current&&(f.current=i)},[t,i,a,o]),b.useEffect(()=>{u&&d(null)},[u]),u}function wa(n){let{animateLayoutChanges:t=cC,attributes:i,disabled:a,data:o,getNewIndex:u=oC,id:d,strategy:f,resizeObserverConfig:h,transition:m=uC}=n;const{items:y,containerId:v,activeIndex:x,disabled:S,disableTransforms:_,sortedRects:N,overIndex:w,useDragOverlay:C,strategy:D}=b.useContext(yb),z=pC(a,S),T=y.indexOf(d),U=b.useMemo(()=>({sortable:{containerId:v,index:T,items:y},...o}),[v,o,T,y]),E=b.useMemo(()=>y.slice(y.indexOf(d)),[y,d]),{rect:R,node:A,isOver:O,setNodeRef:V}=dc({id:d,data:U,disabled:z.droppable,resizeObserverConfig:{updateMeasurementsFor:E,...h}}),{active:P,activatorEvent:F,activeNodeRect:Q,attributes:$,setNodeRef:I,listeners:k,isDragging:L,over:H,setActivatorNodeRef:G,transform:ce}=Wp({id:d,data:U,attributes:{...hC,...i},disabled:z.draggable}),q=M_(V,I),W=!!P,ie=W&&!_&&Su(x)&&Su(w),ve=!C&&L,xe=ve&&ie?ce:null,de=ie?xe??(f??D)({rects:N,activeNodeRect:Q,activeIndex:x,overIndex:w,index:T}):null,K=Su(x)&&Su(w)?u({id:d,items:y,activeIndex:x,overIndex:w}):T,ge=P?.id,Ae=b.useRef({activeId:ge,items:y,newIndex:K,containerId:v}),ae=y!==Ae.current.items,Se=t({active:P,containerId:v,isDragging:L,isSorting:W,id:d,index:T,items:y,newIndex:Ae.current.newIndex,previousItems:Ae.current.items,previousContainerId:Ae.current.containerId,transition:m,wasDragging:Ae.current.activeId!=null}),Re=fC({disabled:!Se,index:T,node:A,rect:R});return b.useEffect(()=>{W&&Ae.current.newIndex!==K&&(Ae.current.newIndex=K),v!==Ae.current.containerId&&(Ae.current.containerId=v),y!==Ae.current.items&&(Ae.current.items=y)},[W,K,v,y]),b.useEffect(()=>{if(ge===Ae.current.activeId)return;if(ge!=null&&Ae.current.activeId==null){Ae.current.activeId=ge;return}const He=setTimeout(()=>{Ae.current.activeId=ge},50);return()=>clearTimeout(He)},[ge]),{active:P,activeIndex:x,attributes:$,data:U,rect:R,index:T,newIndex:K,items:y,isOver:O,isSorting:W,isDragging:L,listeners:k,node:A,overIndex:w,over:H,setNodeRef:q,setActivatorNodeRef:G,setDroppableNodeRef:V,setDraggableNodeRef:I,transform:Re??de,transition:Oe()};function Oe(){if(Re||ae&&Ae.current.newIndex===T)return dC;if(!(ve&&!dd(F)||!m)&&(W||Se))return wr.Transition.toString({...m,property:vb})}}function pC(n,t){var i,a;return typeof n=="boolean"?{draggable:n,droppable:!1}:{draggable:(i=n?.draggable)!=null?i:t.draggable,droppable:(a=n?.droppable)!=null?a:t.droppable}}function Ju(n){if(!n)return!1;const t=n.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const mC=[nn.Down,nn.Right,nn.Up,nn.Left],gd=(n,t)=>{let{context:{active:i,collisionRect:a,droppableRects:o,droppableContainers:u,over:d,scrollableAncestors:f}}=t;if(mC.includes(n.code)){if(n.preventDefault(),!i||!a)return;const h=[];u.getEnabled().forEach(v=>{if(!v||v!=null&&v.disabled)return;const x=o.get(v.id);if(x)switch(n.code){case nn.Down:a.top<x.top&&h.push(v);break;case nn.Up:a.top>x.top&&h.push(v);break;case nn.Left:a.left>x.left&&h.push(v);break;case nn.Right:a.left<x.left&&h.push(v);break}});const m=Q_({collisionRect:a,droppableRects:o,droppableContainers:h});let y=X0(m,"id");if(y===d?.id&&m.length>1&&(y=m[1].id),y!=null){const v=u.get(i.id),x=u.get(y),S=x?o.get(x.id):null,_=x?.node.current;if(_&&S&&v&&x){const w=hd(_).some((E,R)=>f[R]!==E),C=xb(v,x),D=gC(v,x),z=w||!C?{x:0,y:0}:{x:D?a.width-S.width:0,y:D?a.height-S.height:0},T={x:S.left,y:S.top};return z.x&&z.y?T:Ko(T,z)}}}};function xb(n,t){return!Ju(n)||!Ju(t)?!1:n.data.current.sortable.containerId===t.data.current.sortable.containerId}function gC(n,t){return!Ju(n)||!Ju(t)||!xb(n,t)?!1:n.data.current.sortable.index<t.data.current.sortable.index}const yC=()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1,vC=(n,{mobile:t=!1}={})=>{if(!n||typeof n!="string"||n.startsWith("data:")||n.startsWith("blob:"))return n;if(n.includes("/storage/v1/object/public/")){const i=t?360:640,a=t?55:68,o=n.includes("?")?"&":"?";return`${n}${o}width=${i}&quality=${a}&resize=contain`}return n},cx=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},zi=n=>Array.isArray(n)?n.flatMap(t=>String(t||"").split(/[,]/)).map(t=>t.trim()).filter(Boolean):typeof n=="string"?n.split(/[,]/).map(t=>t.trim()).filter(Boolean):[],xC=({recipe:n,isSelected:t,isSelectMode:i,onSelectRecipe:a,onToggleSelection:o,disableDrag:u,showOwner:d,ownerLabelFn:f,index:h=0,mobileView:m=!1})=>{const{attributes:y,listeners:v,setNodeRef:x,transform:S,transition:_,isDragging:N}=wa({id:n.id,disabled:u}),w={transform:wr.Transform.toString(S),transition:_,opacity:N?.5:1,touchAction:"pan-y",height:"100%",outline:"none",cursor:u?"default":"grab"},C=m?4:8,D=h<C?"eager":"lazy",z=h<C?"high":"low",T=vC(n.image,{mobile:m});return r.jsx("div",{ref:x,style:w,...y,...v,children:r.jsxs(un,{hoverable:!0,className:`recipe-card ${t?"selected":""} ${n.type==="bread"?"recipe-card--bread":""} ${/|Dessert/i.test(n.category||"")||n.tags&&n.tags.some(U=>/|Dessert/i.test(U))?"recipe-card--dessert":""} ${n.category==="URL"||n.sourceUrl?"recipe-card--url":""}`,style:{height:"100%"},onClick:()=>{i?o(n.id):a(n)},children:[r.jsxs("div",{className:"recipe-card__image-wrapper",children:[n.image?r.jsx("img",{src:T,alt:n.title,className:"recipe-card__image",loading:D,decoding:"async",fetchPriority:z,sizes:m?"(max-width: 700px) 45vw, 320px":"(max-width: 1024px) 33vw, 280px"}):r.jsx("div",{className:"recipe-card__image placeholder"}),r.jsx("div",{className:"recipe-card__overlay"}),i&&r.jsx("div",{className:"recipe-card__selection-overlay",children:r.jsx("div",{className:`selection-checkbox ${t?"checked":""}`})}),r.jsx("div",{className:"recipe-card__tags",children:(()=>{const U=zi(n.tags);if(U.length===0)return null;const E=U.filter(O=>!O.startsWith("owner:"));return(E.includes("URL")?["URL"]:E).slice(0,1).map((O,V)=>r.jsx("span",{className:"recipe-tag",children:O},`${O}-${V}`))})()})]}),r.jsxs("div",{className:"recipe-card__content",children:[r.jsx("h3",{className:"recipe-title",children:n.title}),r.jsx("p",{className:"recipe-desc",children:n.description}),r.jsxs("div",{className:"recipe-meta",children:[n.storeName&&r.jsxs("span",{children:[" ",n.storeName]}),d&&typeof f=="function"&&r.jsxs("span",{className:"recipe-owner",children:[" ",f(n)]}),r.jsxs("div",{className:"recipe-dates",children:[r.jsxs("span",{className:"recipe-date",children:[" : ",cx(n.created_at)]}),n.updated_at&&r.jsxs("span",{className:"recipe-date",children:[" : ",cx(n.updated_at)]})]})]})]})]})})},ux=n=>{const t=zi(n.tags);return n.type==="bread"||t.some(i=>/|Bread/i.test(i))},dx=n=>{const t=a=>/|Dessert/i.test(a),i=zi(n.tags);return/|Dessert/i.test(n.category||"")||i.some(t)},hx=n=>{const t=zi(n.tags);return/|Sauce/i.test(n.category||"")||t.some(i=>/|Sauce/i.test(i))},fx=n=>{const t=zi(n.tags);return/||Decor/i.test(n.category||"")||t.some(i=>/||Decor/i.test(i))},px=n=>{const t=n.category||"",i=zi(n.tags);return/|Dressing||Vinaigrette||Mayonnaise/i.test(t)||i.some(a=>/|Dressing||Vinaigrette||Mayonnaise/i.test(a))},mx=n=>{const t=n.filter(v=>ux(v)),i=n.filter(v=>!ux(v)),a=i.filter(v=>hx(v)),o=i.filter(v=>!hx(v)),u=o.filter(v=>fx(v)),d=o.filter(v=>!fx(v)),f=d.filter(v=>px(v)),h=d.filter(v=>!px(v)),m=h.filter(v=>dx(v));return{cookingRecipes:h.filter(v=>!dx(v)),breadRecipes:t,dessertRecipes:m,sauceRecipes:a,dressingRecipes:f,decorationRecipes:u}},gx=({recipes:n,onSelectRecipe:t,isSelectMode:i,selectedIds:a,onToggleSelection:o,disableDrag:u,displayMode:d="normal",publicRecipeView:f="none",showOwner:h=!1,ownerLabelFn:m,currentUser:y=null})=>{const[v,x]=b.useState({}),[S,_]=b.useState(()=>yC());je.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const L=window.matchMedia("(max-width: 700px)"),H=()=>_(!!L.matches);return H(),L.addEventListener?L.addEventListener("change",H):L.addListener(H),()=>{L.removeEventListener?L.removeEventListener("change",H):L.removeListener(H)}},[]);const N=L=>{x(H=>({...H,[L]:!H[L]}))},w=L=>zi(L?.tags).map(G=>G.toLowerCase()).includes("public"),C=L=>{if(!y)return!1;const H=zi(L?.tags).filter(ce=>ce.startsWith("owner:"));if(H.length===0)return!1;const G=new Set([y?.id?`owner:${y.id}`:null,y?.displayId?`owner:${y.displayId}`:null].filter(Boolean));return H.some(ce=>G.has(ce))},D=n.filter(L=>w(L)),z=D.filter(L=>C(L)),T=D.filter(L=>!C(L)),U=n.filter(L=>!w(L)),{cookingRecipes:E,breadRecipes:R,dessertRecipes:A,sauceRecipes:O,dressingRecipes:V,decorationRecipes:P}=mx(U),[F,Q]=b.useState(typeof window<"u"&&window.innerWidth>=1024?9:8);je.useEffect(()=>{const L=()=>{window.innerWidth>=1024?Q(9):Q(8)};return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[]);const $=(L,H,G,ce,{showWhenEmpty:q=!1,emptyMessage:W=""}={})=>{if(H.length===0&&!q)return null;const ie=d==="all";let ve=H,xe=!1,Ne=!1;return ie||(xe=v[ce],Ne=H.length>F,ve=xe?H:H.slice(0,F)),r.jsxs("div",{className:"recipe-section",style:{marginBottom:"2rem"},children:[r.jsxs("h3",{onClick:()=>!ie&&Ne&&N(ce),style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"8px",cursor:!ie&&Ne?"pointer":"default",userSelect:"none",color:"#ffffff"},children:[r.jsx("span",{children:G})," ",L,r.jsxs("span",{style:{fontSize:"0.8rem",color:"#ccc",fontWeight:"normal"},children:["(",H.length,")"]}),!ie&&Ne&&r.jsx("span",{className:"section-toggle-btn",children:xe?" ":" "})]}),r.jsx("div",{className:"recipe-grid",children:r.jsx(xa,{items:ve.map(de=>de.id),strategy:Xp,children:ve.map((de,K)=>{const ge=a&&a.has(de.id);return r.jsx(xC,{recipe:de,isSelected:ge,isSelectMode:i,onSelectRecipe:t,onToggleSelection:o,disableDrag:u,showOwner:h,ownerLabelFn:m,index:K,mobileView:S},de.id)})})}),H.length===0&&r.jsx("div",{style:{color:"#9ca3af",fontSize:"0.9rem",marginTop:"0.5rem"},children:W||`${L}`})]})},I=()=>{if(f!=="mine"&&f!=="others")return null;const L=f==="mine",H=L?"":"",G=L?"":"",ce=L?"public-mine":"public-others",q=L?z:T,W=L?"":"",ie=mx(q);return r.jsxs("div",{className:"public-recipes-block",children:[r.jsxs("div",{className:"public-recipes-block__header",children:[r.jsx("span",{children:G}),r.jsx("span",{children:H}),r.jsxs("span",{className:"public-recipes-block__count",children:["(",q.length,")"]})]}),q.length===0?r.jsx("div",{className:"public-recipes-block__empty",children:W}):r.jsxs(r.Fragment,{children:[$("",ie.cookingRecipes,"",`${ce}-cooking`),$("",ie.breadRecipes,"",`${ce}-bread`),$("",ie.dessertRecipes,"",`${ce}-dessert`),$("",ie.sauceRecipes,"",`${ce}-sauce`),$("",ie.dressingRecipes,"",`${ce}-dressing`),$("",ie.decorationRecipes,"",`${ce}-decoration`)]})]})},k=f==="none"&&D.length>0&&U.length===0;return r.jsxs("div",{className:"recipe-list-container",children:[I(),k&&r.jsx("div",{className:"recipe-list-empty-hint",children:""}),$("",E,"","cooking"),$("",R,"","bread"),$("",A,"","dessert"),$("",O,"","sauce"),$("",V,"","dressing"),$("",P,"","decoration"),n.length===0&&r.jsx("div",{style:{padding:"2rem",textAlign:"center",color:"#888"},children:""})]})},jn=({isOpen:n,onClose:t,title:i,children:a,size:o="medium",showCloseButton:u=!0})=>{if(b.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[n]),b.useEffect(()=>{const f=h=>{h.key==="Escape"&&n&&t()};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[n,t]),!n)return null;const d=f=>{f.target===f.currentTarget&&t()};return r.jsx("div",{className:"modal-overlay",onClick:d,children:r.jsxs("div",{className:`modal-content modal-${o}`,children:[r.jsxs("div",{className:"modal-header",children:[r.jsx("h3",{className:"modal-title",children:i}),u&&r.jsx("button",{className:"modal-close-btn",onClick:t,"aria-label":"",children:""})]}),r.jsx("div",{className:"modal-body",children:a})]})})};function yd(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,a=Object.getOwnPropertySymbols(n);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(n,a[o])&&(i[a[o]]=n[a[o]]);return i}function bC(n,t,i,a){function o(u){return u instanceof i?u:new i(function(d){d(u)})}return new(i||(i=Promise))(function(u,d){function f(y){try{m(a.next(y))}catch(v){d(v)}}function h(y){try{m(a.throw(y))}catch(v){d(v)}}function m(y){y.done?u(y.value):o(y.value).then(f,h)}m((a=a.apply(n,t||[])).next())})}const wC=n=>n?(...t)=>n(...t):(...t)=>fetch(...t);class Zp extends Error{constructor(t,i="FunctionsError",a){super(t),this.name=i,this.context=a}}class SC extends Zp{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class yx extends Zp{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class vx extends Zp{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var vp;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(vp||(vp={}));class jC{constructor(t,{headers:i={},customFetch:a,region:o=vp.Any}={}){this.url=t,this.headers=i,this.region=o,this.fetch=wC(a)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return bC(this,arguments,void 0,function*(i,a={}){var o;let u,d;try{const{headers:f,method:h,body:m,signal:y,timeout:v}=a;let x={},{region:S}=a;S||(S=this.region);const _=new URL(`${this.url}/${i}`);S&&S!=="any"&&(x["x-region"]=S,_.searchParams.set("forceFunctionRegion",S));let N;m&&(f&&!Object.prototype.hasOwnProperty.call(f,"Content-Type")||!f)?typeof Blob<"u"&&m instanceof Blob||m instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",N=m):typeof m=="string"?(x["Content-Type"]="text/plain",N=m):typeof FormData<"u"&&m instanceof FormData?N=m:(x["Content-Type"]="application/json",N=JSON.stringify(m)):N=m;let w=y;v&&(d=new AbortController,u=setTimeout(()=>d.abort(),v),y?(w=d.signal,y.addEventListener("abort",()=>d.abort())):w=d.signal);const C=yield this.fetch(_.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),f),body:N,signal:w}).catch(U=>{throw new SC(U)}),D=C.headers.get("x-relay-error");if(D&&D==="true")throw new yx(C);if(!C.ok)throw new vx(C);let z=((o=C.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),T;return z==="application/json"?T=yield C.json():z==="application/octet-stream"||z==="application/pdf"?T=yield C.blob():z==="text/event-stream"?T=C:z==="multipart/form-data"?T=yield C.formData():T=yield C.text(),{data:T,error:null,response:C}}catch(f){return{data:null,error:f,response:f instanceof vx||f instanceof yx?f.context:void 0}}finally{u&&clearTimeout(u)}})}}var _C=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},CC=class{constructor(n){var t,i;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(t=n.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=n.signal,this.isMaybeSingle=(i=n.isMaybeSingle)!==null&&i!==void 0?i:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,t){return this.headers=new Headers(this.headers),this.headers.set(n,t),this}then(n,t){var i=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let o=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let d=null,f=null,h=null,m=u.status,y=u.statusText;if(u.ok){var v,x;if(i.method!=="HEAD"){var S;const C=await u.text();C===""||(i.headers.get("Accept")==="text/csv"||i.headers.get("Accept")&&(!((S=i.headers.get("Accept"))===null||S===void 0)&&S.includes("application/vnd.pgrst.plan+text"))?f=C:f=JSON.parse(C))}const N=(v=i.headers.get("Prefer"))===null||v===void 0?void 0:v.match(/count=(exact|planned|estimated)/),w=(x=u.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");N&&w&&w.length>1&&(h=parseInt(w[1])),i.isMaybeSingle&&i.method==="GET"&&Array.isArray(f)&&(f.length>1?(d={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,h=null,m=406,y="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{var _;const N=await u.text();try{d=JSON.parse(N),Array.isArray(d)&&u.status===404&&(f=[],d=null,m=200,y="OK")}catch{u.status===404&&N===""?(m=204,y="No Content"):d={message:N}}if(d&&i.isMaybeSingle&&(!(d==null||(_=d.details)===null||_===void 0)&&_.includes("0 rows"))&&(d=null,m=200,y="OK"),d&&i.shouldThrowOnError)throw new _C(d)}return{error:d,data:f,count:h,status:m,statusText:y}});return this.shouldThrowOnError||(o=o.catch(u=>{var d;let f="";const h=u?.cause;if(h){var m,y,v,x;const _=(m=h?.message)!==null&&m!==void 0?m:"",N=(y=h?.code)!==null&&y!==void 0?y:"";f=`${(v=u?.name)!==null&&v!==void 0?v:"FetchError"}: ${u?.message}`,f+=`

Caused by: ${(x=h?.name)!==null&&x!==void 0?x:"Error"}: ${_}`,N&&(f+=` (${N})`),h?.stack&&(f+=`
${h.stack}`)}else{var S;f=(S=u?.stack)!==null&&S!==void 0?S:""}return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:f,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),o.then(n,t)}returns(){return this}overrideTypes(){return this}},NC=class extends CC{select(n){let t=!1;const i=(n??"*").split("").map(a=>/\s/.test(a)&&!t?"":(a==='"'&&(t=!t),a)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:t=!0,nullsFirst:i,foreignTable:a,referencedTable:o=a}={}){const u=o?`${o}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${n}.${t?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:t,referencedTable:i=t}={}){const a=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(a,`${n}`),this}range(n,t,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"offset":`${a}.offset`,u=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this.url.searchParams.set(u,`${t-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:t=!1,settings:i=!1,buffers:a=!1,wal:o=!1,format:u="text"}={}){var d;const f=[n?"analyze":null,t?"verbose":null,i?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),h=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${h}"; options=${f};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const xx=new RegExp("[,()]");var fl=class extends NC{eq(n,t){return this.url.searchParams.append(n,`eq.${t}`),this}neq(n,t){return this.url.searchParams.append(n,`neq.${t}`),this}gt(n,t){return this.url.searchParams.append(n,`gt.${t}`),this}gte(n,t){return this.url.searchParams.append(n,`gte.${t}`),this}lt(n,t){return this.url.searchParams.append(n,`lt.${t}`),this}lte(n,t){return this.url.searchParams.append(n,`lte.${t}`),this}like(n,t){return this.url.searchParams.append(n,`like.${t}`),this}likeAllOf(n,t){return this.url.searchParams.append(n,`like(all).{${t.join(",")}}`),this}likeAnyOf(n,t){return this.url.searchParams.append(n,`like(any).{${t.join(",")}}`),this}ilike(n,t){return this.url.searchParams.append(n,`ilike.${t}`),this}ilikeAllOf(n,t){return this.url.searchParams.append(n,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(n,t){return this.url.searchParams.append(n,`ilike(any).{${t.join(",")}}`),this}regexMatch(n,t){return this.url.searchParams.append(n,`match.${t}`),this}regexIMatch(n,t){return this.url.searchParams.append(n,`imatch.${t}`),this}is(n,t){return this.url.searchParams.append(n,`is.${t}`),this}isDistinct(n,t){return this.url.searchParams.append(n,`isdistinct.${t}`),this}in(n,t){const i=Array.from(new Set(t)).map(a=>typeof a=="string"&&xx.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`in.(${i})`),this}notIn(n,t){const i=Array.from(new Set(t)).map(a=>typeof a=="string"&&xx.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(n,`not.in.(${i})`),this}contains(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cs.{${t.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(t)}`),this}containedBy(n,t){return typeof t=="string"?this.url.searchParams.append(n,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(n,`cd.{${t.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(t)}`),this}rangeGt(n,t){return this.url.searchParams.append(n,`sr.${t}`),this}rangeGte(n,t){return this.url.searchParams.append(n,`nxl.${t}`),this}rangeLt(n,t){return this.url.searchParams.append(n,`sl.${t}`),this}rangeLte(n,t){return this.url.searchParams.append(n,`nxr.${t}`),this}rangeAdjacent(n,t){return this.url.searchParams.append(n,`adj.${t}`),this}overlaps(n,t){return typeof t=="string"?this.url.searchParams.append(n,`ov.${t}`):this.url.searchParams.append(n,`ov.{${t.join(",")}}`),this}textSearch(n,t,{config:i,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const u=i===void 0?"":`(${i})`;return this.url.searchParams.append(n,`${o}fts${u}.${t}`),this}match(n){return Object.entries(n).forEach(([t,i])=>{this.url.searchParams.append(t,`eq.${i}`)}),this}not(n,t,i){return this.url.searchParams.append(n,`not.${t}.${i}`),this}or(n,{foreignTable:t,referencedTable:i=t}={}){const a=i?`${i}.or`:"or";return this.url.searchParams.append(a,`(${n})`),this}filter(n,t,i){return this.url.searchParams.append(n,`${t}.${i}`),this}},EC=class{constructor(n,{headers:t={},schema:i,fetch:a}){this.url=n,this.headers=new Headers(t),this.schema=i,this.fetch=a}select(n,t){const{head:i=!1,count:a}=t??{},o=i?"HEAD":"GET";let u=!1;const d=(n??"*").split("").map(f=>/\s/.test(f)&&!u?"":(f==='"'&&(u=!u),f)).join("");return this.url.searchParams.set("select",d),a&&this.headers.append("Prefer",`count=${a}`),new fl({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:t,defaultToNull:i=!0}={}){var a;const o="POST";if(t&&this.headers.append("Prefer",`count=${t}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const u=n.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(u.length>0){const d=[...new Set(u)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new fl({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(n,{onConflict:t,ignoreDuplicates:i=!1,count:a,defaultToNull:o=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const f=n.reduce((h,m)=>h.concat(Object.keys(m)),[]);if(f.length>0){const h=[...new Set(f)].map(m=>`"${m}"`);this.url.searchParams.set("columns",h.join(","))}}return new fl({method:d,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(n,{count:t}={}){var i;const a="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new fl({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:n}={}){var t;const i="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new fl({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},kC=class bb{constructor(t,{headers:i={},schema:a,fetch:o}={}){this.url=t,this.headers=new Headers(i),this.schemaName=a,this.fetch=o}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new EC(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new bb(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,i={},{head:a=!1,get:o=!1,count:u}={}){var d;let f;const h=new URL(`${this.url}/rpc/${t}`);let m;a||o?(f=a?"HEAD":"GET",Object.entries(i).filter(([v,x])=>x!==void 0).map(([v,x])=>[v,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([v,x])=>{h.searchParams.append(v,x)})):(f="POST",m=i);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new fl({method:f,url:h,headers:y,schema:this.schemaName,body:m,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}};class TC{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const i=process.versions;if(i&&i.node){const a=i.node,o=parseInt(a.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let i=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(i+=`

Suggested solution: ${t.workaround}`),new Error(i)}static createWebSocket(t,i){const a=this.getWebSocketConstructor();return new a(t,i)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const AC="2.89.0",RC=`realtime-js/${AC}`,wb="1.0.0",OC="2.0.0",bx=wb,xp=1e4,DC=1e3,MC=100;var ki;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(ki||(ki={}));var Gn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Gn||(Gn={}));var cs;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(cs||(cs={}));var bp;(function(n){n.websocket="websocket"})(bp||(bp={}));var ha;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(ha||(ha={}));class zC{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,i){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return i(this._binaryEncodeUserBroadcastPush(t));let a=[t.join_ref,t.ref,t.topic,t.event,t.payload];return i(JSON.stringify(a))}_binaryEncodeUserBroadcastPush(t){var i;return this._isArrayBuffer((i=t.payload)===null||i===void 0?void 0:i.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var i,a;const o=(a=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&a!==void 0?a:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var i,a;const o=(a=(i=t.payload)===null||i===void 0?void 0:i.payload)!==null&&a!==void 0?a:{},d=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,d)}_encodeUserBroadcastPush(t,i,a){var o,u;const d=t.topic,f=(o=t.ref)!==null&&o!==void 0?o:"",h=(u=t.join_ref)!==null&&u!==void 0?u:"",m=t.payload.event,y=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},v=Object.keys(y).length===0?"":JSON.stringify(y);if(h.length>255)throw new Error(`joinRef length ${h.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`ref length ${f.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`topic length ${d.length} exceeds maximum of 255`);if(m.length>255)throw new Error(`userEvent length ${m.length} exceeds maximum of 255`);if(v.length>255)throw new Error(`metadata length ${v.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+f.length+d.length+m.length+v.length,S=new ArrayBuffer(this.HEADER_LENGTH+x);let _=new DataView(S),N=0;_.setUint8(N++,this.KINDS.userBroadcastPush),_.setUint8(N++,h.length),_.setUint8(N++,f.length),_.setUint8(N++,d.length),_.setUint8(N++,m.length),_.setUint8(N++,v.length),_.setUint8(N++,i),Array.from(h,C=>_.setUint8(N++,C.charCodeAt(0))),Array.from(f,C=>_.setUint8(N++,C.charCodeAt(0))),Array.from(d,C=>_.setUint8(N++,C.charCodeAt(0))),Array.from(m,C=>_.setUint8(N++,C.charCodeAt(0))),Array.from(v,C=>_.setUint8(N++,C.charCodeAt(0)));var w=new Uint8Array(S.byteLength+a.byteLength);return w.set(new Uint8Array(S),0),w.set(new Uint8Array(a),S.byteLength),w.buffer}decode(t,i){if(this._isArrayBuffer(t)){let a=this._binaryDecode(t);return i(a)}if(typeof t=="string"){const a=JSON.parse(t),[o,u,d,f,h]=a;return i({join_ref:o,ref:u,topic:d,event:f,payload:h})}return i({})}_binaryDecode(t){const i=new DataView(t),a=i.getUint8(0),o=new TextDecoder;if(a===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,i,o)}_decodeUserBroadcast(t,i,a){const o=i.getUint8(1),u=i.getUint8(2),d=i.getUint8(3),f=i.getUint8(4);let h=this.HEADER_LENGTH+4;const m=a.decode(t.slice(h,h+o));h=h+o;const y=a.decode(t.slice(h,h+u));h=h+u;const v=a.decode(t.slice(h,h+d));h=h+d;const x=t.slice(h,t.byteLength),S=f===this.JSON_ENCODING?JSON.parse(a.decode(x)):x,_={type:this.BROADCAST_EVENT,event:y,payload:S};return d>0&&(_.meta=JSON.parse(v)),{join_ref:null,ref:null,topic:m,event:this.BROADCAST_EVENT,payload:_}}_isArrayBuffer(t){var i;return t instanceof ArrayBuffer||((i=t?.constructor)===null||i===void 0?void 0:i.name)==="ArrayBuffer"}_pick(t,i){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([a])=>i.includes(a)))}}class Sb{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Sn;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Sn||(Sn={}));const wx=(n,t,i={})=>{var a;const o=(a=i.skipTypes)!==null&&a!==void 0?a:[];return t?Object.keys(t).reduce((u,d)=>(u[d]=LC(d,n,t,o),u),{}):{}},LC=(n,t,i,a)=>{const o=t.find(f=>f.name===n),u=o?.type,d=i[n];return u&&!a.includes(u)?jb(u,d):wp(d)},jb=(n,t)=>{if(n.charAt(0)==="_"){const i=n.slice(1,n.length);return $C(t,i)}switch(n){case Sn.bool:return UC(t);case Sn.float4:case Sn.float8:case Sn.int2:case Sn.int4:case Sn.int8:case Sn.numeric:case Sn.oid:return IC(t);case Sn.json:case Sn.jsonb:return BC(t);case Sn.timestamp:return PC(t);case Sn.abstime:case Sn.date:case Sn.daterange:case Sn.int4range:case Sn.int8range:case Sn.money:case Sn.reltime:case Sn.text:case Sn.time:case Sn.timestamptz:case Sn.timetz:case Sn.tsrange:case Sn.tstzrange:return wp(t);default:return wp(t)}},wp=n=>n,UC=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},IC=n=>{if(typeof n=="string"){const t=parseFloat(n);if(!Number.isNaN(t))return t}return n},BC=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},$C=(n,t)=>{if(typeof n!="string")return n;const i=n.length-1,a=n[i];if(n[0]==="{"&&a==="}"){let u;const d=n.slice(1,i);try{u=JSON.parse("["+d+"]")}catch{u=d?d.split(","):[]}return u.map(f=>jb(t,f))}return n},PC=n=>typeof n=="string"?n.replace(" ","T"):n,_b=n=>{const t=new URL(n);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Df{constructor(t,i,a={},o=xp){this.channel=t,this.event=i,this.payload=a,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var a;return this._hasReceived(t)&&i((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(a=>a.status===t).forEach(a=>a.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Sx;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Sx||(Sx={}));class qo{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=i?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},o=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.joinRef=this.channel._joinRef(),this.state=qo.syncState(this.state,o,u,d),this.pendingDiffs.forEach(h=>{this.state=qo.syncDiff(this.state,h,u,d)}),this.pendingDiffs=[],f()}),this.channel._on(a.diff,{},o=>{const{onJoin:u,onLeave:d,onSync:f}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=qo.syncDiff(this.state,o,u,d),f())}),this.onJoin((o,u,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:u,newPresences:d})}),this.onLeave((o,u,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:u,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,a,o){const u=this.cloneDeep(t),d=this.transformState(i),f={},h={};return this.map(u,(m,y)=>{d[m]||(h[m]=y)}),this.map(d,(m,y)=>{const v=u[m];if(v){const x=y.map(w=>w.presence_ref),S=v.map(w=>w.presence_ref),_=y.filter(w=>S.indexOf(w.presence_ref)<0),N=v.filter(w=>x.indexOf(w.presence_ref)<0);_.length>0&&(f[m]=_),N.length>0&&(h[m]=N)}else f[m]=y}),this.syncDiff(u,{joins:f,leaves:h},a,o)}static syncDiff(t,i,a,o){const{joins:u,leaves:d}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return a||(a=()=>{}),o||(o=()=>{}),this.map(u,(f,h)=>{var m;const y=(m=t[f])!==null&&m!==void 0?m:[];if(t[f]=this.cloneDeep(h),y.length>0){const v=t[f].map(S=>S.presence_ref),x=y.filter(S=>v.indexOf(S.presence_ref)<0);t[f].unshift(...x)}a(f,y,h)}),this.map(d,(f,h)=>{let m=t[f];if(!m)return;const y=h.map(v=>v.presence_ref);m=m.filter(v=>y.indexOf(v.presence_ref)<0),t[f]=m,o(f,m,h),m.length===0&&delete t[f]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(a=>i(a,t[a]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,a)=>{const o=t[a];return"metas"in o?i[a]=o.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):i[a]=o,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var jx;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(jx||(jx={}));var Fo;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Fo||(Fo={}));var Ps;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Ps||(Ps={}));class yl{constructor(t,i={config:{}},a){var o,u;if(this.topic=t,this.params=i,this.socket=a,this.bindings={},this.state=Gn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new Df(this,cs.join,this.params,this.timeout),this.rejoinTimer=new Sb(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Gn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Gn.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Gn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Gn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=Gn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(cs.reply,{},(d,f)=>{this._trigger(this._replyEventName(f),d)}),this.presence=new qo(this),this.broadcastEndpointURL=_b(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,i=this.timeout){var a,o,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Gn.closed){const{config:{broadcast:d,presence:f,private:h}}=this.params,m=(o=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(S=>S.filter))!==null&&o!==void 0?o:[],y=!!this.bindings[Fo.PRESENCE]&&this.bindings[Fo.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,v={},x={broadcast:d,presence:Object.assign(Object.assign({},f),{enabled:y}),postgres_changes:m,private:h};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(S=>t?.(Ps.CHANNEL_ERROR,S)),this._onClose(()=>t?.(Ps.CLOSED)),this.updateJoinPayload(Object.assign({config:x},v)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:S})=>{var _;if(this.socket._isManualToken()||this.socket.setAuth(),S===void 0){t?.(Ps.SUBSCRIBED);return}else{const N=this.bindings.postgres_changes,w=(_=N?.length)!==null&&_!==void 0?_:0,C=[];for(let D=0;D<w;D++){const z=N[D],{filter:{event:T,schema:U,table:E,filter:R}}=z,A=S&&S[D];if(A&&A.event===T&&yl.isFilterValueEqual(A.schema,U)&&yl.isFilterValueEqual(A.table,E)&&yl.isFilterValueEqual(A.filter,R))C.push(Object.assign(Object.assign({},z),{id:A.id}));else{this.unsubscribe(),this.state=Gn.errored,t?.(Ps.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=C,t&&t(Ps.SUBSCRIBED);return}}).receive("error",S=>{this.state=Gn.errored,t?.(Ps.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{t?.(Ps.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,a){return this.state===Gn.joined&&t===Fo.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,i,a)}async httpSend(t,i,a={}){var o;if(i==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:i,private:this.private}]})},f=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=a.timeout)!==null&&o!==void 0?o:this.timeout);if(f.status===202)return{success:!0};let h=f.statusText;try{const m=await f.json();h=m.error||m.message||h}catch{}return Promise.reject(new Error(h))}async send(t,i={}){var a,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:d}=t,f={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(f.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:f,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:d,private:this.private}]})};try{const m=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(a=i.timeout)!==null&&a!==void 0?a:this.timeout);return await((o=m.body)===null||o===void 0?void 0:o.cancel()),m.ok?"ok":"error"}catch(m){return m.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var d,f,h;const m=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((h=(f=(d=this.params)===null||d===void 0?void 0:d.config)===null||f===void 0?void 0:f.broadcast)===null||h===void 0)&&h.ack)&&u("ok"),m.receive("ok",()=>u("ok")),m.receive("error",()=>u("error")),m.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Gn.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(cs.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(o=>{a=new Df(this,cs.leave,{},t),a.receive("ok",()=>{i(),o("ok")}).receive("timeout",()=>{i(),o("timed out")}).receive("error",()=>{o("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Gn.closed,this.bindings={}}async _fetchWithTimeout(t,i,a){const o=new AbortController,u=setTimeout(()=>o.abort(),a),d=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:o.signal}));return clearTimeout(u),d}_push(t,i,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Df(this,t,i,a);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>MC){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(t,i,a){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,a){var o,u;const d=t.toLocaleLowerCase(),{close:f,error:h,leave:m,join:y}=cs;if(a&&[f,h,m,y].indexOf(d)>=0&&a!==this._joinRef())return;let x=this._onMessage(d,i,a);if(i&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(S=>{var _,N,w;return((_=S.filter)===null||_===void 0?void 0:_.event)==="*"||((w=(N=S.filter)===null||N===void 0?void 0:N.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===d}).map(S=>S.callback(x,a)):(u=this.bindings[d])===null||u===void 0||u.filter(S=>{var _,N,w,C,D,z;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in S){const T=S.id,U=(_=S.filter)===null||_===void 0?void 0:_.event;return T&&((N=i.ids)===null||N===void 0?void 0:N.includes(T))&&(U==="*"||U?.toLocaleLowerCase()===((w=i.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const T=(D=(C=S?.filter)===null||C===void 0?void 0:C.event)===null||D===void 0?void 0:D.toLocaleLowerCase();return T==="*"||T===((z=i?.event)===null||z===void 0?void 0:z.toLocaleLowerCase())}else return S.type.toLocaleLowerCase()===d}).map(S=>{if(typeof x=="object"&&"ids"in x){const _=x.data,{schema:N,table:w,commit_timestamp:C,type:D,errors:z}=_;x=Object.assign(Object.assign({},{schema:N,table:w,commit_timestamp:C,eventType:D,new:{},old:{},errors:z}),this._getPayloadRecords(_))}S.callback(x,a)})}_isClosed(){return this.state===Gn.closed}_isJoined(){return this.state===Gn.joined}_isJoining(){return this.state===Gn.joining}_isLeaving(){return this.state===Gn.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,a){const o=t.toLocaleLowerCase(),u={type:o,filter:i,callback:a};return this.bindings[o]?this.bindings[o].push(u):this.bindings[o]=[u],this}_off(t,i){const a=t.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(o=>{var u;return!(((u=o.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===a&&yl.isEqual(o.filter,i))})),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const a in t)if(t[a]!==i[a])return!1;return!0}static isFilterValueEqual(t,i){return(t??void 0)===(i??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(cs.close,{},t)}_onError(t){this._on(cs.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Gn.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=wx(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=wx(t.columns,t.old_record)),i}}const Mf=()=>{},_u={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},qC=[1e3,2e3,5e3,1e4],FC=1e4,HC=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class VC{constructor(t,i){var a;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=xp,this.transport=null,this.heartbeatIntervalMs=_u.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Mf,this.ref=0,this.reconnectTimer=null,this.vsn=bx,this.logger=Mf,this.conn=null,this.sendBuffer=[],this.serializer=new zC,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...u)=>o(...u):(...u)=>fetch(...u),!(!((a=i?.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${t}/${bp.websocket}`,this.httpEndpoint=_b(t),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=TC.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const i=t.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,i??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,i,a){this.logger(t,i,a)}connectionState(){switch(this.conn&&this.conn.readyState){case ki.connecting:return ha.Connecting;case ki.open:return ha.Open;case ki.closing:return ha.Closing;default:return ha.Closed}}isConnected(){return this.connectionState()===ha.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,i={config:{}}){const a=`realtime:${t}`,o=this.getChannels().find(u=>u.topic===a);if(o)return o;{const u=new yl(`realtime:${t}`,i,this);return this.channels.push(u),u}}push(t){const{topic:i,event:a,payload:o,ref:u}=t,d=()=>{this.encode(t,f=>{var h;(h=this.conn)===null||h===void 0||h.send(f)})};this.log("push",`${i} ${a} (${u})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(DC,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},_u.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(a=>a.topic===t&&(a._isJoined()||a._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply")try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error")}catch(m){this.log("error","error in heartbeat callback",m)}i.ref&&i.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:a,event:o,payload:u,ref:d}=i,f=d?`(${d})`:"",h=u.status||"";this.log("receive",`${h} ${a} ${o} ${f}`.trim(),u),this.channels.filter(m=>m._isMember(a)).forEach(m=>m._trigger(o,u,d)),this._triggerStateCallbacks("message",i)})}_clearTimer(t){var i;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===ki.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ki.open||this.conn.readyState===ki.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(i=>{this.log("error","error waiting for auth on connect",i),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this._terminateWorker()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var i;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(cs.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const a=t.match(/\?/)?"&":"?",o=new URLSearchParams(i);return`${t}${a}${o}`}_workerObjectUrl(t){let i;if(t)i=t;else{const a=new Blob([HC],{type:"application/javascript"});i=URL.createObjectURL(a)}return i}_setConnectionState(t,i=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(t=null){let i,a=!1;if(t)i=t,a=!0;else if(this.accessToken)try{i=await this.accessToken()}catch(o){this.log("error","Error fetching access token from callback",o),i=this.accessTokenValue}else i=this.accessTokenValue;a?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(o=>{const u={access_token:i,version:RC};i&&o.updateJoinPayload(u),o.joinedOnce&&o._isJoined()&&o._push(cs.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(i=>{this.log("error",`Error setting auth in ${t}`,i)})}_triggerStateCallbacks(t,i){try{this.stateChangeCallbacks[t].forEach(a=>{try{a(i)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(a){this.log("error",`error triggering ${t} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new Sb(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},_u.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var i,a,o,u,d,f,h,m,y,v,x,S;switch(this.transport=(i=t?.transport)!==null&&i!==void 0?i:null,this.timeout=(a=t?.timeout)!==null&&a!==void 0?a:xp,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:_u.HEARTBEAT_INTERVAL,this.worker=(u=t?.worker)!==null&&u!==void 0?u:!1,this.accessToken=(d=t?.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(f=t?.heartbeatCallback)!==null&&f!==void 0?f:Mf,this.vsn=(h=t?.vsn)!==null&&h!==void 0?h:bx,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(m=t?.reconnectAfterMs)!==null&&m!==void 0?m:(_=>qC[_-1]||FC),this.vsn){case wb:this.encode=(y=t?.encode)!==null&&y!==void 0?y:((_,N)=>N(JSON.stringify(_))),this.decode=(v=t?.decode)!==null&&v!==void 0?v:((_,N)=>N(JSON.parse(_)));break;case OC:this.encode=(x=t?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(S=t?.decode)!==null&&S!==void 0?S:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}var Wo=class extends Error{constructor(n,t){super(n),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function GC(n,t,i){const a=new URL(t,n);if(i)for(const[o,u]of Object.entries(i))u!==void 0&&a.searchParams.set(o,u);return a.toString()}async function KC(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function YC(n){const t=n.fetchImpl??globalThis.fetch;return{async request({method:i,path:a,query:o,body:u,headers:d}){const f=GC(n.baseUrl,a,o),h=await KC(n.auth),m=await t(f,{method:i,headers:{...u?{"Content-Type":"application/json"}:{},...h,...d},body:u?JSON.stringify(u):void 0}),y=await m.text(),v=(m.headers.get("content-type")||"").includes("application/json"),x=v&&y?JSON.parse(y):y;if(!m.ok){const S=v?x:void 0,_=S?.error;throw new Wo(_?.message??`Request failed with status ${m.status}`,{status:m.status,icebergType:_?.type,icebergCode:_?.code,details:S})}return{status:m.status,headers:m.headers,data:x}}}}function Cu(n){return n.join("")}var WC=class{constructor(n,t=""){this.client=n,this.prefix=t}async listNamespaces(n){const t=n?{parent:Cu(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(n,t){const i={namespace:n.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:i})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Cu(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Cu(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Cu(n.namespace)}`}),!0}catch(t){if(t instanceof Wo&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(n,t){try{return await this.createNamespace(n,t)}catch(i){if(i instanceof Wo&&i.status===409)return;throw i}}};function tl(n){return n.join("")}var QC=class{constructor(n,t="",i){this.client=n,this.prefix=t,this.accessDelegation=i}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables`})).data.identifiers}async createTable(n,t){const i={};return this.accessDelegation&&(i["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables`,body:t,headers:i})).data.metadata}async updateTable(n,t){const i=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables/${n.name}`,body:t});return{"metadata-location":i.data["metadata-location"],metadata:i.data.metadata}}async dropTable(n,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(n){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables/${n.name}`,headers:t})).data.metadata}async tableExists(n){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${tl(n.namespace)}/tables/${n.name}`,headers:t}),!0}catch(i){if(i instanceof Wo&&i.status===404)return!1;throw i}}async createTableIfNotExists(n,t){try{return await this.createTable(n,t)}catch(i){if(i instanceof Wo&&i.status===409)return await this.loadTable({namespace:n.namespace,name:t.name});throw i}}},JC=class{constructor(n){let t="v1";n.catalogName&&(t+=`/${n.catalogName}`);const i=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=YC({baseUrl:i,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=n.accessDelegation?.join(","),this.namespaceOps=new WC(this.client,t),this.tableOps=new QC(this.client,t,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,t){return this.namespaceOps.createNamespace(n,t)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,t){return this.tableOps.createTable(n,t)}async updateTable(n,t){return this.tableOps.updateTable(n,t)}async dropTable(n,t){await this.tableOps.dropTable(n,t)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,t){return this.namespaceOps.createNamespaceIfNotExists(n,t)}async createTableIfNotExists(n,t){return this.tableOps.createTableIfNotExists(n,t)}},vd=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function Rn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var XC=class extends vd{constructor(n,t,i){super(n),this.name="StorageApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Sp=class extends vd{constructor(n,t){super(n),this.name="StorageUnknownError",this.originalError=t}};const em=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),ZC=()=>Response,jp=n=>{if(Array.isArray(n))return n.map(i=>jp(i));if(typeof n=="function"||n!==Object(n))return n;const t={};return Object.entries(n).forEach(([i,a])=>{const o=i.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[o]=jp(a)}),t},eN=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},tN=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function Qo(n){"@babel/helpers - typeof";return Qo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qo(n)}function nN(n,t){if(Qo(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(Qo(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function rN(n){var t=nN(n,"string");return Qo(t)=="symbol"?t:t+""}function sN(n,t,i){return(t=rN(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function _x(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function Ot(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?_x(Object(i),!0).forEach(function(a){sN(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):_x(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}const zf=n=>{var t;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(t=n.error)===null||t===void 0?void 0:t.message)||JSON.stringify(n)},iN=async(n,t,i)=>{n instanceof await ZC()&&!i?.noResolveJson?n.json().then(a=>{const o=n.status||500,u=a?.statusCode||o+"";t(new XC(zf(a),o,u))}).catch(a=>{t(new Sp(zf(a),a))}):t(new Sp(zf(n),n))},aN=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"||!a?o:(eN(a)?(o.headers=Ot({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,t?.duplex&&(o.duplex=t.duplex),Ot(Ot({},o),i))};async function hc(n,t,i,a,o,u){return new Promise((d,f)=>{n(i,aN(t,a,o,u)).then(h=>{if(!h.ok)throw h;return a?.noResolveJson?h:h.json()}).then(h=>d(h)).catch(h=>iN(h,f,a))})}async function Jo(n,t,i,a){return hc(n,"GET",t,i,a)}async function os(n,t,i,a,o){return hc(n,"POST",t,a,o,i)}async function _p(n,t,i,a,o){return hc(n,"PUT",t,a,o,i)}async function lN(n,t,i,a){return hc(n,"HEAD",t,Ot(Ot({},i),{},{noResolveJson:!0}),a)}async function tm(n,t,i,a,o){return hc(n,"DELETE",t,a,o,i)}var oN=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t}then(n,t){return this.execute().then(n,t)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Rn(t))return{data:null,error:t};throw t}}};let Cb;Cb=Symbol.toStringTag;var cN=class{constructor(n,t){this.downloadFn=n,this.shouldThrowOnError=t,this[Cb]="BlobDownloadBuilder",this.promise=null}asStream(){return new oN(this.downloadFn,this.shouldThrowOnError)}then(n,t){return this.getPromise().then(n,t)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(t){if(n.shouldThrowOnError)throw t;if(Rn(t))return{data:null,error:t};throw t}}};const uN={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Cx={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var dN=class{constructor(n,t={},i,a){this.shouldThrowOnError=!1,this.url=n,this.headers=t,this.bucketId=i,this.fetch=em(a)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(n,t,i,a){var o=this;try{let u;const d=Ot(Ot({},Cx),a);let f=Ot(Ot({},o.headers),n==="POST"&&{"x-upsert":String(d.upsert)});const h=d.metadata;typeof Blob<"u"&&i instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),h&&u.append("metadata",o.encodeMetadata(h)),u.append("",i)):typeof FormData<"u"&&i instanceof FormData?(u=i,u.has("cacheControl")||u.append("cacheControl",d.cacheControl),h&&!u.has("metadata")&&u.append("metadata",o.encodeMetadata(h))):(u=i,f["cache-control"]=`max-age=${d.cacheControl}`,f["content-type"]=d.contentType,h&&(f["x-metadata"]=o.toBase64(o.encodeMetadata(h))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!d.duplex&&(d.duplex="half")),a?.headers&&(f=Ot(Ot({},f),a.headers));const m=o._removeEmptyFolders(t),y=o._getFinalPath(m),v=await(n=="PUT"?_p:os)(o.fetch,`${o.url}/object/${y}`,u,Ot({headers:f},d?.duplex?{duplex:d.duplex}:{}));return{data:{path:m,id:v.Id,fullPath:v.Key},error:null}}catch(u){if(o.shouldThrowOnError)throw u;if(Rn(u))return{data:null,error:u};throw u}}async upload(n,t,i){return this.uploadOrUpdate("POST",n,t,i)}async uploadToSignedUrl(n,t,i,a){var o=this;const u=o._removeEmptyFolders(n),d=o._getFinalPath(u),f=new URL(o.url+`/object/upload/sign/${d}`);f.searchParams.set("token",t);try{let h;const m=Ot({upsert:Cx.upsert},a),y=Ot(Ot({},o.headers),{"x-upsert":String(m.upsert)});return typeof Blob<"u"&&i instanceof Blob?(h=new FormData,h.append("cacheControl",m.cacheControl),h.append("",i)):typeof FormData<"u"&&i instanceof FormData?(h=i,h.append("cacheControl",m.cacheControl)):(h=i,y["cache-control"]=`max-age=${m.cacheControl}`,y["content-type"]=m.contentType),{data:{path:u,fullPath:(await _p(o.fetch,f.toString(),h,{headers:y})).Key},error:null}}catch(h){if(o.shouldThrowOnError)throw h;if(Rn(h))return{data:null,error:h};throw h}}async createSignedUploadUrl(n,t){var i=this;try{let a=i._getFinalPath(n);const o=Ot({},i.headers);t?.upsert&&(o["x-upsert"]="true");const u=await os(i.fetch,`${i.url}/object/upload/sign/${a}`,{},{headers:o}),d=new URL(i.url+u.url),f=d.searchParams.get("token");if(!f)throw new vd("No token returned by API");return{data:{signedUrl:d.toString(),path:n,token:f},error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Rn(a))return{data:null,error:a};throw a}}async update(n,t,i){return this.uploadOrUpdate("PUT",n,t,i)}async move(n,t,i){var a=this;try{return{data:await os(a.fetch,`${a.url}/object/move`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:a.headers}),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Rn(o))return{data:null,error:o};throw o}}async copy(n,t,i){var a=this;try{return{data:{path:(await os(a.fetch,`${a.url}/object/copy`,{bucketId:a.bucketId,sourceKey:n,destinationKey:t,destinationBucket:i?.destinationBucket},{headers:a.headers})).Key},error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Rn(o))return{data:null,error:o};throw o}}async createSignedUrl(n,t,i){var a=this;try{let o=a._getFinalPath(n),u=await os(a.fetch,`${a.url}/object/sign/${o}`,Ot({expiresIn:t},i?.transform?{transform:i.transform}:{}),{headers:a.headers});const d=i?.download?`&download=${i.download===!0?"":i.download}`:"";return u={signedUrl:encodeURI(`${a.url}${u.signedURL}${d}`)},{data:u,error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Rn(o))return{data:null,error:o};throw o}}async createSignedUrls(n,t,i){var a=this;try{const o=await os(a.fetch,`${a.url}/object/sign/${a.bucketId}`,{expiresIn:t,paths:n},{headers:a.headers}),u=i?.download?`&download=${i.download===!0?"":i.download}`:"";return{data:o.map(d=>Ot(Ot({},d),{},{signedUrl:d.signedURL?encodeURI(`${a.url}${d.signedURL}${u}`):null})),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Rn(o))return{data:null,error:o};throw o}}download(n,t){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(t?.transform||{}),o=a?`?${a}`:"",u=this._getFinalPath(n),d=()=>Jo(this.fetch,`${this.url}/${i}/${u}${o}`,{headers:this.headers,noResolveJson:!0});return new cN(d,this.shouldThrowOnError)}async info(n){var t=this;const i=t._getFinalPath(n);try{return{data:jp(await Jo(t.fetch,`${t.url}/object/info/${i}`,{headers:t.headers})),error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Rn(a))return{data:null,error:a};throw a}}async exists(n){var t=this;const i=t._getFinalPath(n);try{return await lN(t.fetch,`${t.url}/object/${i}`,{headers:t.headers}),{data:!0,error:null}}catch(a){if(t.shouldThrowOnError)throw a;if(Rn(a)&&a instanceof Sp){const o=a.originalError;if([400,404].includes(o?.status))return{data:!1,error:a}}throw a}}getPublicUrl(n,t){const i=this._getFinalPath(n),a=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&a.push(o);const u=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&a.push(d);let f=a.join("&");return f!==""&&(f=`?${f}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${i}${f}`)}}}async remove(n){var t=this;try{return{data:await tm(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rn(i))return{data:null,error:i};throw i}}async list(n,t,i){var a=this;try{const o=Ot(Ot(Ot({},uN),t),{},{prefix:n||""});return{data:await os(a.fetch,`${a.url}/object/list/${a.bucketId}`,o,{headers:a.headers},i),error:null}}catch(o){if(a.shouldThrowOnError)throw o;if(Rn(o))return{data:null,error:o};throw o}}async listV2(n,t){var i=this;try{const a=Ot({},n);return{data:await os(i.fetch,`${i.url}/object/list-v2/${i.bucketId}`,a,{headers:i.headers},t),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Rn(a))return{data:null,error:a};throw a}}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const t=[];return n.width&&t.push(`width=${n.width}`),n.height&&t.push(`height=${n.height}`),n.resize&&t.push(`resize=${n.resize}`),n.format&&t.push(`format=${n.format}`),n.quality&&t.push(`quality=${n.quality}`),t.join("&")}};const Nb="2.89.0",Eb={"X-Client-Info":`storage-js/${Nb}`};var hN=class{constructor(n,t={},i,a){this.shouldThrowOnError=!1;const o=new URL(n);a?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Ot(Ot({},Eb),t),this.fetch=em(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(n){var t=this;try{const i=t.listBucketOptionsToQueryString(n);return{data:await Jo(t.fetch,`${t.url}/bucket${i}`,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rn(i))return{data:null,error:i};throw i}}async getBucket(n){var t=this;try{return{data:await Jo(t.fetch,`${t.url}/bucket/${n}`,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rn(i))return{data:null,error:i};throw i}}async createBucket(n,t={public:!1}){var i=this;try{return{data:await os(i.fetch,`${i.url}/bucket`,{id:n,name:n,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Rn(a))return{data:null,error:a};throw a}}async updateBucket(n,t){var i=this;try{return{data:await _p(i.fetch,`${i.url}/bucket/${n}`,{id:n,name:n,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Rn(a))return{data:null,error:a};throw a}}async emptyBucket(n){var t=this;try{return{data:await os(t.fetch,`${t.url}/bucket/${n}/empty`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rn(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await tm(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rn(i))return{data:null,error:i};throw i}}listBucketOptionsToQueryString(n){const t={};return n&&("limit"in n&&(t.limit=String(n.limit)),"offset"in n&&(t.offset=String(n.offset)),n.search&&(t.search=n.search),n.sortColumn&&(t.sortColumn=n.sortColumn),n.sortOrder&&(t.sortOrder=n.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},fN=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Ot(Ot({},Eb),t),this.fetch=em(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await os(t.fetch,`${t.url}/bucket`,{name:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rn(i))return{data:null,error:i};throw i}}async listBuckets(n){var t=this;try{const i=new URLSearchParams;n?.limit!==void 0&&i.set("limit",n.limit.toString()),n?.offset!==void 0&&i.set("offset",n.offset.toString()),n?.sortColumn&&i.set("sortColumn",n.sortColumn),n?.sortOrder&&i.set("sortOrder",n.sortOrder),n?.search&&i.set("search",n.search);const a=i.toString(),o=a?`${t.url}/bucket?${a}`:`${t.url}/bucket`;return{data:await Jo(t.fetch,o,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rn(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await tm(t.fetch,`${t.url}/bucket/${n}`,{},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Rn(i))return{data:null,error:i};throw i}}from(n){var t=this;if(!tN(n))throw new vd("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const i=new JC({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),a=this.shouldThrowOnError;return new Proxy(i,{get(o,u){const d=o[u];return typeof d!="function"?d:async(...f)=>{try{return{data:await d.apply(o,f),error:null}}catch(h){if(a)throw h;return{data:null,error:h}}}}})}};const nm={"X-Client-Info":`storage-js/${Nb}`,"Content-Type":"application/json"};var kb=class extends Error{constructor(n){super(n),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Or(n){return typeof n=="object"&&n!==null&&"__isStorageVectorsError"in n}var Lf=class extends kb{constructor(n,t,i){super(n),this.name="StorageVectorsApiError",this.status=t,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},pN=class extends kb{constructor(n,t){super(n),this.name="StorageVectorsUnknownError",this.originalError=t}};const rm=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),mN=n=>{if(typeof n!="object"||n===null)return!1;const t=Object.getPrototypeOf(n);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},Nx=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),gN=async(n,t,i)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!i?.noResolveJson){const a=n.status||500,o=n;if(typeof o.json=="function")o.json().then(u=>{const d=u?.statusCode||u?.code||a+"";t(new Lf(Nx(u),a,d))}).catch(()=>{const u=a+"";t(new Lf(o.statusText||`HTTP ${a} error`,a,u))});else{const u=a+"";t(new Lf(o.statusText||`HTTP ${a} error`,a,u))}}else t(new pN(Nx(n),n))},yN=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return a?(mN(a)?(o.headers=Ot({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(a)):o.body=a,Ot(Ot({},o),i)):o};async function vN(n,t,i,a,o,u){return new Promise((d,f)=>{n(i,yN(t,a,o,u)).then(h=>{if(!h.ok)throw h;if(a?.noResolveJson)return h;const m=h.headers.get("content-type");return!m||!m.includes("application/json")?{}:h.json()}).then(h=>d(h)).catch(h=>gN(h,f,a))})}async function Dr(n,t,i,a,o){return vN(n,"POST",t,a,o,i)}var xN=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Ot(Ot({},nm),t),this.fetch=rm(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/CreateIndex`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async getIndex(n,t){var i=this;try{return{data:await Dr(i.fetch,`${i.url}/GetIndex`,{vectorBucketName:n,indexName:t},{headers:i.headers}),error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Or(a))return{data:null,error:a};throw a}}async listIndexes(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/ListIndexes`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async deleteIndex(n,t){var i=this;try{return{data:await Dr(i.fetch,`${i.url}/DeleteIndex`,{vectorBucketName:n,indexName:t},{headers:i.headers})||{},error:null}}catch(a){if(i.shouldThrowOnError)throw a;if(Or(a))return{data:null,error:a};throw a}}},bN=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Ot(Ot({},nm),t),this.fetch=rm(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(n){var t=this;try{if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Dr(t.fetch,`${t.url}/PutVectors`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async getVectors(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/GetVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async listVectors(n){var t=this;try{if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return{data:await Dr(t.fetch,`${t.url}/ListVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async queryVectors(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/QueryVectors`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async deleteVectors(n){var t=this;try{if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Dr(t.fetch,`${t.url}/DeleteVectors`,n,{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}},wN=class{constructor(n,t={},i){this.shouldThrowOnError=!1,this.url=n.replace(/\/$/,""),this.headers=Ot(Ot({},nm),t),this.fetch=rm(i)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async getBucket(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:n},{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async listBuckets(n={}){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/ListVectorBuckets`,n,{headers:t.headers}),error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}async deleteBucket(n){var t=this;try{return{data:await Dr(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:t.headers})||{},error:null}}catch(i){if(t.shouldThrowOnError)throw i;if(Or(i))return{data:null,error:i};throw i}}},SN=class extends wN{constructor(n,t={}){super(n,t.headers||{},t.fetch)}from(n){return new jN(this.url,this.headers,n,this.fetch)}async createBucket(n){var t=()=>super.createBucket,i=this;return t().call(i,n)}async getBucket(n){var t=()=>super.getBucket,i=this;return t().call(i,n)}async listBuckets(n={}){var t=()=>super.listBuckets,i=this;return t().call(i,n)}async deleteBucket(n){var t=()=>super.deleteBucket,i=this;return t().call(i,n)}},jN=class extends xN{constructor(n,t,i,a){super(n,t,a),this.vectorBucketName=i}async createIndex(n){var t=()=>super.createIndex,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName}))}async listIndexes(n={}){var t=()=>super.listIndexes,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName}))}async getIndex(n){var t=()=>super.getIndex,i=this;return t().call(i,i.vectorBucketName,n)}async deleteIndex(n){var t=()=>super.deleteIndex,i=this;return t().call(i,i.vectorBucketName,n)}index(n){return new _N(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},_N=class extends bN{constructor(n,t,i,a,o){super(n,t,o),this.vectorBucketName=i,this.indexName=a}async putVectors(n){var t=()=>super.putVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async getVectors(n){var t=()=>super.getVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async listVectors(n={}){var t=()=>super.listVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async queryVectors(n){var t=()=>super.queryVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}async deleteVectors(n){var t=()=>super.deleteVectors,i=this;return t().call(i,Ot(Ot({},n),{},{vectorBucketName:i.vectorBucketName,indexName:i.indexName}))}},CN=class extends hN{constructor(n,t={},i,a){super(n,t,i,a)}from(n){return new dN(this.url,this.headers,n,this.fetch)}get vectors(){return new SN(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new fN(this.url+"/iceberg",this.headers,this.fetch)}};const Tb="2.89.0",pl=30*1e3,Cp=3,Uf=Cp*pl,NN="http://localhost:9999",EN="supabase.auth.token",kN={"X-Client-Info":`gotrue-js/${Tb}`},Np="X-Supabase-Api-Version",Ab={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},TN=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,AN=600*1e3;class Xo extends Error{constructor(t,i,a){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=a}}function wt(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class RN extends Xo{constructor(t,i,a){super(t,i,a),this.name="AuthApiError",this.status=i,this.code=a}}function ON(n){return wt(n)&&n.name==="AuthApiError"}class fa extends Xo{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class Ys extends Xo{constructor(t,i,a,o){super(t,a,o),this.name=i,this.status=a}}class Ar extends Ys{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function DN(n){return wt(n)&&n.name==="AuthSessionMissingError"}class nl extends Ys{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Nu extends Ys{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Eu extends Ys{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function MN(n){return wt(n)&&n.name==="AuthImplicitGrantRedirectError"}class Ex extends Ys{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class zN extends Ys{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Ep extends Ys{constructor(t,i){super(t,"AuthRetryableFetchError",i,void 0)}}function If(n){return wt(n)&&n.name==="AuthRetryableFetchError"}class kx extends Ys{constructor(t,i,a){super(t,"AuthWeakPasswordError",i,"weak_password"),this.reasons=a}}class kp extends Ys{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Xu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Tx=` 	
\r=`.split(""),LN=(()=>{const n=new Array(128);for(let t=0;t<n.length;t+=1)n[t]=-1;for(let t=0;t<Tx.length;t+=1)n[Tx[t].charCodeAt(0)]=-2;for(let t=0;t<Xu.length;t+=1)n[Xu[t].charCodeAt(0)]=t;return n})();function Ax(n,t,i){if(n!==null)for(t.queue=t.queue<<8|n,t.queuedBits+=8;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;i(Xu[a]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const a=t.queue>>t.queuedBits-6&63;i(Xu[a]),t.queuedBits-=6}}function Rb(n,t,i){const a=LN[n];if(a>-1)for(t.queue=t.queue<<6|a,t.queuedBits+=6;t.queuedBits>=8;)i(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Rx(n){const t=[],i=d=>{t.push(String.fromCodePoint(d))},a={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},u=d=>{BN(d,a,i)};for(let d=0;d<n.length;d+=1)Rb(n.charCodeAt(d),o,u);return t.join("")}function UN(n,t){if(n<=127){t(n);return}else if(n<=2047){t(192|n>>6),t(128|n&63);return}else if(n<=65535){t(224|n>>12),t(128|n>>6&63),t(128|n&63);return}else if(n<=1114111){t(240|n>>18),t(128|n>>12&63),t(128|n>>6&63),t(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function IN(n,t){for(let i=0;i<n.length;i+=1){let a=n.charCodeAt(i);if(a>55295&&a<=56319){const o=(a-55296)*1024&65535;a=(n.charCodeAt(i+1)-56320&65535|o)+65536,i+=1}UN(a,t)}}function BN(n,t,i){if(t.utf8seq===0){if(n<=127){i(n);return}for(let a=1;a<6;a+=1)if((n>>7-a&1)===0){t.utf8seq=a;break}if(t.utf8seq===2)t.codepoint=n&31;else if(t.utf8seq===3)t.codepoint=n&15;else if(t.utf8seq===4)t.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|n&63,t.utf8seq-=1,t.utf8seq===0&&i(t.codepoint)}}function bl(n){const t=[],i={queue:0,queuedBits:0},a=o=>{t.push(o)};for(let o=0;o<n.length;o+=1)Rb(n.charCodeAt(o),i,a);return new Uint8Array(t)}function $N(n){const t=[];return IN(n,i=>t.push(i)),new Uint8Array(t)}function ga(n){const t=[],i={queue:0,queuedBits:0},a=o=>{t.push(o)};return n.forEach(o=>Ax(o,i,a)),Ax(null,i,a),t.join("")}function PN(n){return Math.round(Date.now()/1e3)+n}function qN(){return Symbol("auth-callback")}const ar=()=>typeof window<"u"&&typeof document<"u",sa={tested:!1,writable:!1},Ob=()=>{if(!ar())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(sa.tested)return sa.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),sa.tested=!0,sa.writable=!0}catch{sa.tested=!0,sa.writable=!1}return sa.writable};function FN(n){const t={},i=new URL(n);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((o,u)=>{t[u]=o})}catch{}return i.searchParams.forEach((a,o)=>{t[o]=a}),t}const Db=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),HN=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",ml=async(n,t,i)=>{await n.setItem(t,JSON.stringify(i))},ia=async(n,t)=>{const i=await n.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},ir=async(n,t)=>{await n.removeItem(t)};class xd{constructor(){this.promise=new xd.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}xd.promiseConstructor=Promise;function Bf(n){const t=n.split(".");if(t.length!==3)throw new kp("Invalid JWT structure");for(let a=0;a<t.length;a++)if(!TN.test(t[a]))throw new kp("JWT not in base64url format");return{header:JSON.parse(Rx(t[0])),payload:JSON.parse(Rx(t[1])),signature:bl(t[2]),raw:{header:t[0],payload:t[1]}}}async function VN(n){return await new Promise(t=>{setTimeout(()=>t(null),n)})}function GN(n,t){return new Promise((a,o)=>{(async()=>{for(let u=0;u<1/0;u++)try{const d=await n(u);if(!t(u,null,d)){a(d);return}}catch(d){if(!t(u,d)){o(d);return}}})()})}function KN(n){return("0"+n.toString(16)).substr(-2)}function YN(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=i.length;let o="";for(let u=0;u<56;u++)o+=i.charAt(Math.floor(Math.random()*a));return o}return crypto.getRandomValues(t),Array.from(t,KN).join("")}async function WN(n){const i=new TextEncoder().encode(n),a=await crypto.subtle.digest("SHA-256",i),o=new Uint8Array(a);return Array.from(o).map(u=>String.fromCharCode(u)).join("")}async function QN(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const i=await WN(n);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function rl(n,t,i=!1){const a=YN();let o=a;i&&(o+="/PASSWORD_RECOVERY"),await ml(n,`${t}-code-verifier`,o);const u=await QN(a);return[u,a===u?"plain":"s256"]}const JN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function XN(n){const t=n.headers.get(Np);if(!t||!t.match(JN))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function ZN(n){if(!n)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(n<=t)throw new Error("JWT has expired")}function eE(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const tE=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function sl(n){if(!tE.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function $f(){const n={};return new Proxy(n,{get:(t,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const a=i.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function nE(n,t){return new Proxy(n,{get:(i,a,o)=>{if(a==="__isInsecureUserWarningProxy")return!0;if(typeof a=="symbol"){const u=a.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(i,a,o)}return!t.value&&typeof a=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(i,a,o)}})}function Ox(n){return JSON.parse(JSON.stringify(n))}const da=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),rE=[502,503,504];async function Dx(n){var t;if(!HN(n))throw new Ep(da(n),0);if(rE.includes(n.status))throw new Ep(da(n),n.status);let i;try{i=await n.json()}catch(u){throw new fa(da(u),u)}let a;const o=XN(n);if(o&&o.getTime()>=Ab["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?a=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(a=i.error_code),a){if(a==="weak_password")throw new kx(da(i),n.status,((t=i.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(a==="session_not_found")throw new Ar}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((u,d)=>u&&typeof d=="string",!0))throw new kx(da(i),n.status,i.weak_password.reasons);throw new RN(da(i),n.status||500,a)}const sE=(n,t,i,a)=>{const o={method:n,headers:t?.headers||{}};return n==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(a),Object.assign(Object.assign({},o),i))};async function Rt(n,t,i,a){var o;const u=Object.assign({},a?.headers);u[Np]||(u[Np]=Ab["2024-01-01"].name),a?.jwt&&(u.Authorization=`Bearer ${a.jwt}`);const d=(o=a?.query)!==null&&o!==void 0?o:{};a?.redirectTo&&(d.redirect_to=a.redirectTo);const f=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",h=await iE(n,t,i+f,{headers:u,noResolveJson:a?.noResolveJson},{},a?.body);return a?.xform?a?.xform(h):{data:Object.assign({},h),error:null}}async function iE(n,t,i,a,o,u){const d=sE(t,a,o,u);let f;try{f=await n(i,Object.assign({},d))}catch(h){throw console.error(h),new Ep(da(h),0)}if(f.ok||await Dx(f),a?.noResolveJson)return f;try{return await f.json()}catch(h){await Dx(h)}}function is(n){var t;let i=null;oE(n)&&(i=Object.assign({},n),n.expires_at||(i.expires_at=PN(n.expires_in)));const a=(t=n.user)!==null&&t!==void 0?t:n;return{data:{session:i,user:a},error:null}}function Mx(n){const t=is(n);return!t.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0)&&(t.data.weak_password=n.weak_password),t}function Ai(n){var t;return{data:{user:(t=n.user)!==null&&t!==void 0?t:n},error:null}}function aE(n){return{data:n,error:null}}function lE(n){const{action_link:t,email_otp:i,hashed_token:a,redirect_to:o,verification_type:u}=n,d=yd(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),f={action_link:t,email_otp:i,hashed_token:a,redirect_to:o,verification_type:u},h=Object.assign({},d);return{data:{properties:f,user:h},error:null}}function zx(n){return n}function oE(n){return n.access_token&&n.refresh_token&&n.expires_in}const Pf=["global","local","others"];class cE{constructor({url:t="",headers:i={},fetch:a}){this.url=t,this.headers=i,this.fetch=Db(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,i=Pf[0]){if(Pf.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Pf.join(", ")}`);try{return await Rt(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(a){if(wt(a))return{data:null,error:a};throw a}}async inviteUserByEmail(t,i={}){try{return await Rt(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:Ai})}catch(a){if(wt(a))return{data:{user:null},error:a};throw a}}async generateLink(t){try{const{options:i}=t,a=yd(t,["options"]),o=Object.assign(Object.assign({},a),i);return"newEmail"in a&&(o.new_email=a?.newEmail,delete o.newEmail),await Rt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:lE,redirectTo:i?.redirectTo})}catch(i){if(wt(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await Rt(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Ai})}catch(i){if(wt(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,a,o,u,d,f,h;try{const m={nextPage:null,lastPage:0,total:0},y=await Rt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:zx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,S=(h=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&h!==void 0?h:[];return S.length>0&&(S.forEach(_=>{const N=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(_.split(";")[1].split("=")[1]);m[`${w}Page`]=N}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(wt(m))return{data:{users:[]},error:m};throw m}}async getUserById(t){sl(t);try{return await Rt(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Ai})}catch(i){if(wt(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){sl(t);try{return await Rt(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:Ai})}catch(a){if(wt(a))return{data:{user:null},error:a};throw a}}async deleteUser(t,i=!1){sl(t);try{return await Rt(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:Ai})}catch(a){if(wt(a))return{data:{user:null},error:a};throw a}}async _listFactors(t){sl(t.userId);try{const{data:i,error:a}=await Rt(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:i,error:a}}catch(i){if(wt(i))return{data:null,error:i};throw i}}async _deleteFactor(t){sl(t.userId),sl(t.id);try{return{data:await Rt(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(wt(i))return{data:null,error:i};throw i}}async _listOAuthClients(t){var i,a,o,u,d,f,h;try{const m={nextPage:null,lastPage:0,total:0},y=await Rt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&a!==void 0?a:"",per_page:(u=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&u!==void 0?u:""},xform:zx});if(y.error)throw y.error;const v=await y.json(),x=(d=y.headers.get("x-total-count"))!==null&&d!==void 0?d:0,S=(h=(f=y.headers.get("link"))===null||f===void 0?void 0:f.split(","))!==null&&h!==void 0?h:[];return S.length>0&&(S.forEach(_=>{const N=parseInt(_.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(_.split(";")[1].split("=")[1]);m[`${w}Page`]=N}),m.total=parseInt(x)),{data:Object.assign(Object.assign({},v),m),error:null}}catch(m){if(wt(m))return{data:{clients:[]},error:m};throw m}}async _createOAuthClient(t){try{return await Rt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(wt(i))return{data:null,error:i};throw i}}async _getOAuthClient(t){try{return await Rt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(wt(i))return{data:null,error:i};throw i}}async _updateOAuthClient(t,i){try{return await Rt(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:i,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(wt(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(t){try{return await Rt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(i){if(wt(i))return{data:null,error:i};throw i}}async _regenerateOAuthClientSecret(t){try{return await Rt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:i=>({data:i,error:null})})}catch(i){if(wt(i))return{data:null,error:i};throw i}}}function Lx(n={}){return{getItem:t=>n[t]||null,setItem:(t,i)=>{n[t]=i},removeItem:t=>{delete n[t]}}}const il={debug:!!(globalThis&&Ob()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Mb extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class uE extends Mb{}async function dE(n,t,i){il.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,t);const a=new globalThis.AbortController;return t>0&&setTimeout(()=>{a.abort(),il.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async o=>{if(o){il.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,o.name);try{return await i()}finally{il.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,o.name)}}else{if(t===0)throw il.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new uE(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(il.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}function hE(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function zb(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function fE(n){return parseInt(n,16)}function pE(n){const t=new TextEncoder().encode(n);return"0x"+Array.from(t,a=>a.toString(16).padStart(2,"0")).join("")}function mE(n){var t;const{chainId:i,domain:a,expirationTime:o,issuedAt:u=new Date,nonce:d,notBefore:f,requestId:h,resources:m,scheme:y,uri:v,version:x}=n;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!a)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!v)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((t=n.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const S=zb(n.address),_=y?`${y}://${a}`:a,N=n.statement?`${n.statement}
`:"",w=`${_} wants you to sign in with your Ethereum account:
${S}

${N}`;let C=`URI: ${v}
Version: ${x}
Chain ID: ${i}${d?`
Nonce: ${d}`:""}
Issued At: ${u.toISOString()}`;if(o&&(C+=`
Expiration Time: ${o.toISOString()}`),f&&(C+=`
Not Before: ${f.toISOString()}`),h&&(C+=`
Request ID: ${h}`),m){let D=`
Resources:`;for(const z of m){if(!z||typeof z!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${z}`);D+=`
- ${z}`}C+=D}return`${w}
${C}`}class Hn extends Error{constructor({message:t,code:i,cause:a,name:o}){var u;super(t,{cause:a}),this.__isWebAuthnError=!0,this.name=(u=o??(a instanceof Error?a.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=i}}class Zu extends Hn{constructor(t,i){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i,message:t}),this.name="WebAuthnUnknownError",this.originalError=i}}function gE({error:n,options:t}){var i,a,o;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Hn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((i=u.authenticatorSelection)===null||i===void 0?void 0:i.requireResidentKey)===!0)return new Hn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(t.mediation==="conditional"&&((a=u.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new Hn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((o=u.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Hn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Hn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Hn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return u.pubKeyCredParams.filter(f=>f.type==="public-key").length===0?new Hn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Hn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const d=window.location.hostname;if(Lb(d)){if(u.rp.id!==d)return new Hn({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Hn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new Hn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Hn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Hn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function yE({error:n,options:t}){const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Hn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Hn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const a=window.location.hostname;if(Lb(a)){if(i.rpId!==a)return new Hn({message:`The RP ID "${i.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Hn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Hn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Hn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class vE{createNewAbortSignal(){if(this.controller){const i=new Error("Cancelling existing WebAuthn API call for new one");i.name="AbortError",this.controller.abort(i)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const xE=new vE;function bE(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:t,user:i,excludeCredentials:a}=n,o=yd(n,["challenge","user","excludeCredentials"]),u=bl(t).buffer,d=Object.assign(Object.assign({},i),{id:bl(i.id).buffer}),f=Object.assign(Object.assign({},o),{challenge:u,user:d});if(a&&a.length>0){f.excludeCredentials=new Array(a.length);for(let h=0;h<a.length;h++){const m=a[h];f.excludeCredentials[h]=Object.assign(Object.assign({},m),{id:bl(m.id).buffer,type:m.type||"public-key",transports:m.transports})}}return f}function wE(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:t,allowCredentials:i}=n,a=yd(n,["challenge","allowCredentials"]),o=bl(t).buffer,u=Object.assign(Object.assign({},a),{challenge:o});if(i&&i.length>0){u.allowCredentials=new Array(i.length);for(let d=0;d<i.length;d++){const f=i[d];u.allowCredentials[d]=Object.assign(Object.assign({},f),{id:bl(f.id).buffer,type:f.type||"public-key",transports:f.transports})}}return u}function SE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const i=n;return{id:n.id,rawId:n.id,response:{attestationObject:ga(new Uint8Array(n.response.attestationObject)),clientDataJSON:ga(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function jE(n){var t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const i=n,a=n.getClientExtensionResults(),o=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:ga(new Uint8Array(o.authenticatorData)),clientDataJSON:ga(new Uint8Array(o.clientDataJSON)),signature:ga(new Uint8Array(o.signature)),userHandle:o.userHandle?ga(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:a,authenticatorAttachment:(t=i.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Lb(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Ux(){var n,t;return!!(ar()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function _E(n){try{const t=await navigator.credentials.create(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Zu("Browser returned unexpected credential type",t)}:{data:null,error:new Zu("Empty credential response",t)}}catch(t){return{data:null,error:gE({error:t,options:n})}}}async function CE(n){try{const t=await navigator.credentials.get(n);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Zu("Browser returned unexpected credential type",t)}:{data:null,error:new Zu("Empty credential response",t)}}catch(t){return{data:null,error:yE({error:t,options:n})}}}const NE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},EE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function ed(...n){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),i=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),a={};for(const o of n)if(o)for(const u in o){const d=o[u];if(d!==void 0)if(Array.isArray(d))a[u]=d;else if(i(d))a[u]=d;else if(t(d)){const f=a[u];t(f)?a[u]=ed(f,d):a[u]=ed(d)}else a[u]=d}return a}function kE(n,t){return ed(NE,n,t||{})}function TE(n,t){return ed(EE,n,t||{})}class AE{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:i,friendlyName:a,signal:o},u){try{const{data:d,error:f}=await this.client.mfa.challenge({factorId:t,webauthn:i});if(!d)return{data:null,error:f};const h=o??xE.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:m}=d.webauthn.credential_options.publicKey;m.name||(m.name=`${m.id}:${a}`),m.displayName||(m.displayName=m.name)}switch(d.webauthn.type){case"create":{const m=kE(d.webauthn.credential_options.publicKey,u?.create),{data:y,error:v}=await _E({publicKey:m,signal:h});return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}case"request":{const m=TE(d.webauthn.credential_options.publicKey,u?.request),{data:y,error:v}=await CE(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:m,signal:h}));return y?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:y}},error:null}:{data:null,error:v}}}}catch(d){return wt(d)?{data:null,error:d}:{data:null,error:new fa("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:i,webauthn:a}){return this.client.mfa.verify({factorId:i,challengeId:t,webauthn:a})}async _authenticate({factorId:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!i)return{data:null,error:new Xo("rpId is required for WebAuthn authentication")};try{if(!Ux())return{data:null,error:new fa("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this.challenge({factorId:t,webauthn:{rpId:i,rpOrigins:a},signal:o},{request:u});if(!d)return{data:null,error:f};const{webauthn:h}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:h.type,rpId:i,rpOrigins:a,credential_response:h.credential_response}})}catch(d){return wt(d)?{data:null,error:d}:{data:null,error:new fa("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:i=typeof window<"u"?window.location.hostname:void 0,rpOrigins:a=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},u){if(!i)return{data:null,error:new Xo("rpId is required for WebAuthn registration")};try{if(!Ux())return{data:null,error:new fa("Browser does not support WebAuthn",null)};const{data:d,error:f}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(y=>{var v;return(v=y.data)===null||v===void 0?void 0:v.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===t&&x.status!=="unverified")}).then(y=>y?this.client.mfa.unenroll({factorId:y?.id}):void 0),{data:null,error:f};const{data:h,error:m}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:i,rpOrigins:a},signal:o},{create:u});return h?this._verify({factorId:d.id,challengeId:h.challengeId,webauthn:{rpId:i,rpOrigins:a,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:m}}catch(d){return wt(d)?{data:null,error:d}:{data:null,error:new fa("Unexpected error in register",d)}}}}hE();const RE={url:NN,storageKey:EN,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:kN,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Ix(n,t,i){return await i()}const al={};class Zo{get jwks(){var t,i;return(i=(t=al[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(t){al[this.storageKey]=Object.assign(Object.assign({},al[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,i;return(i=(t=al[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){al[this.storageKey]=Object.assign(Object.assign({},al[this.storageKey]),{cachedAt:t})}constructor(t){var i,a,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},RE),t);if(this.storageKey=u.storageKey,this.instanceID=(i=Zo.nextInstanceID[this.storageKey])!==null&&i!==void 0?i:0,Zo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&ar()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new cE({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=Db(u.fetch),this.lock=u.lock||Ix,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,u.lock?this.lock=u.lock:this.persistSession&&ar()&&(!((a=globalThis?.navigator)===null||a===void 0)&&a.locks)?this.lock=dE:this.lock=Ix,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new AE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:Ob()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Lx(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=Lx(this.memoryStorage)),ar()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Tb}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let i={},a="none";if(ar()&&(i=FN(window.location.href),this._isImplicitGrantCallback(i)?a="implicit":await this._isPKCECallback(i)&&(a="pkce")),ar()&&this.detectSessionInUrl&&a!=="none"){const{data:o,error:u}=await this._getSessionFromURL(i,a);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),MN(u)){const h=(t=u.details)===null||t===void 0?void 0:t.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:u}}return await this._removeSession(),{error:u}}const{session:d,redirectType:f}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",f),await this._saveSession(d),setTimeout(async()=>{f==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return wt(i)?this._returnResult({error:i}):this._returnResult({error:new fa("Unexpected error during initialization",i)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var i,a,o;try{const u=await Rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(i=t?.options)===null||i===void 0?void 0:i.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:is}),{data:d,error:f}=u;if(f||!d)return this._returnResult({data:{user:null,session:null},error:f});const h=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(u){if(wt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var i,a,o;try{let u;if("email"in t){const{email:y,password:v,options:x}=t;let S=null,_=null;this.flowType==="pkce"&&([S,_]=await rl(this.storage,this.storageKey)),u=await Rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:y,password:v,data:(i=x?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:S,code_challenge_method:_},xform:is})}else if("phone"in t){const{phone:y,password:v,options:x}=t;u=await Rt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:y,password:v,data:(a=x?.data)!==null&&a!==void 0?a:{},channel:(o=x?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:is})}else throw new Nu("You must provide either an email or phone number and a password");const{data:d,error:f}=u;if(f||!d)return await ir(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:f});const h=d.session,m=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(u){if(await ir(this.storage,`${this.storageKey}-code-verifier`),wt(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let i;if("email"in t){const{email:u,password:d,options:f}=t;i=await Rt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Mx})}else if("phone"in t){const{phone:u,password:d,options:f}=t;i=await Rt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:d,gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Mx})}else throw new Nu("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!a||!a.session||!a.user){const u=new nl;return this._returnResult({data:{user:null,session:null},error:u})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:o})}catch(i){if(wt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOAuth(t){var i,a,o,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:i}=t;switch(i){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(t){var i,a,o,u,d,f,h,m,y,v,x;let S,_;if("message"in t)S=t.message,_=t.signature;else{const{chain:N,wallet:w,statement:C,options:D}=t;let z;if(ar())if(typeof w=="object")z=w;else{const O=window;if("ethereum"in O&&typeof O.ethereum=="object"&&"request"in O.ethereum&&typeof O.ethereum.request=="function")z=O.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!D?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");z=w}const T=new URL((i=D?.url)!==null&&i!==void 0?i:window.location.href),U=await z.request({method:"eth_requestAccounts"}).then(O=>O).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!U||U.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const E=zb(U[0]);let R=(a=D?.signInWithEthereum)===null||a===void 0?void 0:a.chainId;if(!R){const O=await z.request({method:"eth_chainId"});R=fE(O)}const A={domain:T.host,address:E,statement:C,uri:T.href,version:"1",chainId:R,nonce:(o=D?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(u=D?.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(f=D?.signInWithEthereum)===null||f===void 0?void 0:f.expirationTime,notBefore:(h=D?.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(m=D?.signInWithEthereum)===null||m===void 0?void 0:m.requestId,resources:(y=D?.signInWithEthereum)===null||y===void 0?void 0:y.resources};S=mE(A),_=await z.request({method:"personal_sign",params:[pE(S),E]})}try{const{data:N,error:w}=await Rt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:S,signature:_},!((v=t.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:is});if(w)throw w;if(!N||!N.session||!N.user){const C=new nl;return this._returnResult({data:{user:null,session:null},error:C})}return N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),this._returnResult({data:Object.assign({},N),error:w})}catch(N){if(wt(N))return this._returnResult({data:{user:null,session:null},error:N});throw N}}async signInWithSolana(t){var i,a,o,u,d,f,h,m,y,v,x,S;let _,N;if("message"in t)_=t.message,N=t.signature;else{const{chain:w,wallet:C,statement:D,options:z}=t;let T;if(ar())if(typeof C=="object")T=C;else{const E=window;if("solana"in E&&typeof E.solana=="object"&&("signIn"in E.solana&&typeof E.solana.signIn=="function"||"signMessage"in E.solana&&typeof E.solana.signMessage=="function"))T=E.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof C!="object"||!z?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");T=C}const U=new URL((i=z?.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in T&&T.signIn){const E=await T.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},z?.signInWithSolana),{version:"1",domain:U.host,uri:U.href}),D?{statement:D}:null));let R;if(Array.isArray(E)&&E[0]&&typeof E[0]=="object")R=E[0];else if(E&&typeof E=="object"&&"signedMessage"in E&&"signature"in E)R=E;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in R&&"signature"in R&&(typeof R.signedMessage=="string"||R.signedMessage instanceof Uint8Array)&&R.signature instanceof Uint8Array)_=typeof R.signedMessage=="string"?R.signedMessage:new TextDecoder().decode(R.signedMessage),N=R.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in T)||typeof T.signMessage!="function"||!("publicKey"in T)||typeof T!="object"||!T.publicKey||!("toBase58"in T.publicKey)||typeof T.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");_=[`${U.host} wants you to sign in with your Solana account:`,T.publicKey.toBase58(),...D?["",D,""]:[""],"Version: 1",`URI: ${U.href}`,`Issued At: ${(o=(a=z?.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((u=z?.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${z.signInWithSolana.notBefore}`]:[],...!((d=z?.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${z.signInWithSolana.expirationTime}`]:[],...!((f=z?.signInWithSolana)===null||f===void 0)&&f.chainId?[`Chain ID: ${z.signInWithSolana.chainId}`]:[],...!((h=z?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${z.signInWithSolana.nonce}`]:[],...!((m=z?.signInWithSolana)===null||m===void 0)&&m.requestId?[`Request ID: ${z.signInWithSolana.requestId}`]:[],...!((v=(y=z?.signInWithSolana)===null||y===void 0?void 0:y.resources)===null||v===void 0)&&v.length?["Resources",...z.signInWithSolana.resources.map(R=>`- ${R}`)]:[]].join(`
`);const E=await T.signMessage(new TextEncoder().encode(_),"utf8");if(!E||!(E instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=E}}try{const{data:w,error:C}=await Rt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:_,signature:ga(N)},!((x=t.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(S=t.options)===null||S===void 0?void 0:S.captchaToken}}:null),xform:is});if(C)throw C;if(!w||!w.session||!w.user){const D=new nl;return this._returnResult({data:{user:null,session:null},error:D})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign({},w),error:C})}catch(w){if(wt(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async _exchangeCodeForSession(t){const i=await ia(this.storage,`${this.storageKey}-code-verifier`),[a,o]=(i??"").split("/");try{if(!a&&this.flowType==="pkce")throw new zN;const{data:u,error:d}=await Rt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:is});if(await ir(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!u||!u.session||!u.user){const f=new nl;return this._returnResult({data:{user:null,session:null,redirectType:null},error:f})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:o??null}),error:d})}catch(u){if(await ir(this.storage,`${this.storageKey}-code-verifier`),wt(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:i,provider:a,token:o,access_token:u,nonce:d}=t,f=await Rt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:o,access_token:u,nonce:d,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:is}),{data:h,error:m}=f;if(m)return this._returnResult({data:{user:null,session:null},error:m});if(!h||!h.session||!h.user){const y=new nl;return this._returnResult({data:{user:null,session:null},error:y})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:m})}catch(i){if(wt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithOtp(t){var i,a,o,u,d;try{if("email"in t){const{email:f,options:h}=t;let m=null,y=null;this.flowType==="pkce"&&([m,y]=await rl(this.storage,this.storageKey));const{error:v}=await Rt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:f,data:(i=h?.data)!==null&&i!==void 0?i:{},create_user:(a=h?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:m,code_challenge_method:y},redirectTo:h?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:v})}if("phone"in t){const{phone:f,options:h}=t,{data:m,error:y}=await Rt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:f,data:(o=h?.data)!==null&&o!==void 0?o:{},create_user:(u=h?.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(d=h?.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:m?.message_id},error:y})}throw new Nu("You must provide either an email or phone number.")}catch(f){if(await ir(this.storage,`${this.storageKey}-code-verifier`),wt(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async verifyOtp(t){var i,a;try{let o,u;"options"in t&&(o=(i=t.options)===null||i===void 0?void 0:i.redirectTo,u=(a=t.options)===null||a===void 0?void 0:a.captchaToken);const{data:d,error:f}=await Rt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:o,xform:is});if(f)throw f;if(!d)throw new Error("An error occurred on token verification.");const h=d.session,m=d.user;return h?.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:m,session:h},error:null})}catch(o){if(wt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var i,a,o,u,d;try{let f=null,h=null;this.flowType==="pkce"&&([f,h]=await rl(this.storage,this.storageKey));const m=await Rt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(a=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&a!==void 0?a:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:h}),headers:this.headers,xform:aE});return!((u=m.data)===null||u===void 0)&&u.url&&ar()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(m.data.url),this._returnResult(m)}catch(f){if(await ir(this.storage,`${this.storageKey}-code-verifier`),wt(f))return this._returnResult({data:null,error:f});throw f}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;if(a)throw a;if(!i)throw new Ar;const{error:o}=await Rt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(wt(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const i=`${this.url}/resend`;if("email"in t){const{email:a,type:o,options:u}=t,{error:d}=await Rt(this.fetch,"POST",i,{headers:this.headers,body:{email:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}},redirectTo:u?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:a,type:o,options:u}=t,{data:d,error:f}=await Rt(this.fetch,"POST",i,{headers:this.headers,body:{phone:a,type:o,gotrue_meta_security:{captcha_token:u?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d?.message_id},error:f})}throw new Nu("You must provide either an email or phone number and a type")}catch(i){if(wt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await a,await i()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=i();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await ia(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const a=t.expires_at?t.expires_at*1e3-Date.now()<Uf:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",t.expires_at),!a){if(this.userStorage){const d=await ia(this.userStorage,this.storageKey+"-user");d?.user?t.user=d.user:t.user=$f()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=nE(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const i=await this._acquireLock(-1,async()=>await this._getUser());return i.data.user&&(this.suppressGetSessionWarning=!0),i}async _getUser(t){try{return t?await Rt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Ai}):await this._useSession(async i=>{var a,o,u;const{data:d,error:f}=i;if(f)throw f;return!(!((a=d.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ar}:await Rt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&u!==void 0?u:void 0,xform:Ai})})}catch(i){if(wt(i))return DN(i)&&(await this._removeSession(),await ir(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:i});throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async a=>{const{data:o,error:u}=a;if(u)throw u;if(!o.session)throw new Ar;const d=o.session;let f=null,h=null;this.flowType==="pkce"&&t.email!=null&&([f,h]=await rl(this.storage,this.storageKey));const{data:m,error:y}=await Rt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:f,code_challenge_method:h}),jwt:d.access_token,xform:Ai});if(y)throw y;return d.user=m.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(a){if(await ir(this.storage,`${this.storageKey}-code-verifier`),wt(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ar;const i=Date.now()/1e3;let a=i,o=!0,u=null;const{payload:d}=Bf(t.access_token);if(d.exp&&(a=d.exp,o=a<=i),o){const{data:f,error:h}=await this._callRefreshToken(t.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!f)return{data:{user:null,session:null},error:null};u=f}else{const{data:f,error:h}=await this._getUser(t.access_token);if(h)throw h;u={access_token:t.access_token,refresh_token:t.refresh_token,user:f.user,token_type:"bearer",expires_in:a-i,expires_at:a},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(i){if(wt(i))return this._returnResult({data:{session:null,user:null},error:i});throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var a;if(!t){const{data:d,error:f}=i;if(f)throw f;t=(a=d.session)!==null&&a!==void 0?a:void 0}if(!t?.refresh_token)throw new Ar;const{data:o,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(i){if(wt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async _getSessionFromURL(t,i){try{if(!ar())throw new Eu("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Eu(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new Ex("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Eu("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Ex("No code detected.");const{data:D,error:z}=await this._exchangeCodeForSession(t.code);if(z)throw z;const T=new URL(window.location.href);return T.searchParams.delete("code"),window.history.replaceState(window.history.state,"",T.toString()),{data:{session:D.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:o,access_token:u,refresh_token:d,expires_in:f,expires_at:h,token_type:m}=t;if(!u||!f||!d||!m)throw new Eu("No session defined in URL");const y=Math.round(Date.now()/1e3),v=parseInt(f);let x=y+v;h&&(x=parseInt(h));const S=x-y;S*1e3<=pl&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${S}s, should have been closer to ${v}s`);const _=x-v;y-_>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",_,x,y):y-_<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",_,x,y);const{data:N,error:w}=await this._getUser(u);if(w)throw w;const C={provider_token:a,provider_refresh_token:o,access_token:u,expires_in:v,expires_at:x,refresh_token:d,token_type:m,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:C,redirectType:t.type},error:null})}catch(a){if(wt(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const i=await ia(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({error:u});const d=(a=o.session)===null||a===void 0?void 0:a.access_token;if(d){const{error:f}=await this.admin.signOut(d,t);if(f&&!(ON(f)&&(f.status===404||f.status===401||f.status===403)))return this._returnResult({error:f})}return t!=="others"&&(await this._removeSession(),await ir(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const i=qN(),a={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:a}}}async _emitInitialSession(t){return await this._useSession(async i=>{var a,o;try{const{data:{session:u},error:d}=i;if(d)throw d;await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,i={}){let a=null,o=null;this.flowType==="pkce"&&([a,o]=await rl(this.storage,this.storageKey,!0));try{return await Rt(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:a,code_challenge_method:o,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(u){if(await ir(this.storage,`${this.storageKey}-code-verifier`),wt(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:i,error:a}=await this.getUser();if(a)throw a;return this._returnResult({data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(i){if(wt(i))return this._returnResult({data:null,error:i});throw i}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var i;try{const{data:a,error:o}=await this._useSession(async u=>{var d,f,h,m,y;const{data:v,error:x}=u;if(x)throw x;const S=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(f=t.options)===null||f===void 0?void 0:f.scopes,queryParams:(h=t.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await Rt(this.fetch,"GET",S,{headers:this.headers,jwt:(y=(m=v.session)===null||m===void 0?void 0:m.access_token)!==null&&y!==void 0?y:void 0})});if(o)throw o;return ar()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(a?.url),this._returnResult({data:{provider:t.provider,url:a?.url},error:null})}catch(a){if(wt(a))return this._returnResult({data:{provider:t.provider,url:null},error:a});throw a}}async linkIdentityIdToken(t){return await this._useSession(async i=>{var a;try{const{error:o,data:{session:u}}=i;if(o)throw o;const{options:d,provider:f,token:h,access_token:m,nonce:y}=t,v=await Rt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(a=u?.access_token)!==null&&a!==void 0?a:void 0,body:{provider:f,id_token:h,access_token:m,nonce:y,link_identity:!0,gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:is}),{data:x,error:S}=v;return S?this._returnResult({data:{user:null,session:null},error:S}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new nl}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:S}))}catch(o){if(await ir(this.storage,`${this.storageKey}-code-verifier`),wt(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async i=>{var a,o;const{data:u,error:d}=i;if(d)throw d;return await Rt(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(a=u.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0})})}catch(i){if(wt(i))return this._returnResult({data:null,error:i});throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const a=Date.now();return await GN(async o=>(o>0&&await VN(200*Math.pow(2,o-1)),this._debug(i,"refreshing attempt",o),await Rt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:is})),(o,u)=>{const d=200*Math.pow(2,o);return u&&If(u)&&Date.now()+d-a<pl})}catch(a){if(this._debug(i,"error",a),wt(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const a=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",a),ar()&&!i.skipBrowserRedirect&&window.location.assign(a),{data:{provider:t,url:a},error:null}}async _recoverAndRefresh(){var t,i;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const o=await ia(this.storage,this.storageKey);if(o&&this.userStorage){let d=await ia(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await ml(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d?.user)!==null&&t!==void 0?t:$f()}else if(o&&!o.user&&!o.user){const d=await ia(this.storage,this.storageKey+"-user");d&&d?.user?(o.user=d.user,await ir(this.storage,this.storageKey+"-user"),await ml(this.storage,this.storageKey,o)):o.user=$f()}if(this._debug(a,"session from storage",o),!this._isValidSession(o)){this._debug(a,"session is not valid"),o!==null&&await this._removeSession();return}const u=((i=o.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<Uf;if(this._debug(a,`session has${u?"":" not"} expired with margin of ${Uf}s`),u){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),If(d)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:f}=await this._getUser(o.access_token);!f&&d?.user?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(a,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(a,"error",o),console.error(o);return}finally{this._debug(a,"end")}}async _callRefreshToken(t){var i,a;if(!t)throw new Ar;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new xd;const{data:u,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!u.session)throw new Ar;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const f={data:u.session,error:null};return this.refreshingDeferred.resolve(f),f}catch(u){if(this._debug(o,"error",u),wt(u)){const d={data:null,error:u};return If(u)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(d),d}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(u),u}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,i,a=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",i,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:t,session:i});const u=[],d=Array.from(this.stateChangeEmitters.values()).map(async f=>{try{await f.callback(t,i)}catch(h){u.push(h)}});if(await Promise.all(d),u.length>0){for(let f=0;f<u.length;f+=1)console.error(u[f]);throw u[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await ir(this.storage,`${this.storageKey}-code-verifier`);const i=Object.assign({},t),a=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&i.user&&await ml(this.userStorage,this.storageKey+"-user",{user:i.user});const o=Object.assign({},i);delete o.user;const u=Ox(o);await ml(this.storage,this.storageKey,u)}else{const o=Ox(i);await ml(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ir(this.storage,this.storageKey),await ir(this.storage,this.storageKey+"-code-verifier"),await ir(this.storage,this.storageKey+"-user"),this.userStorage&&await ir(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ar()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),pl);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:a}}=i;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((a.expires_at*1e3-t)/pl);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${pl}ms, refresh threshold is ${Cp} ticks`),o<=Cp&&await this._callRefreshToken(a.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Mb)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ar()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,a){const o=[`provider=${encodeURIComponent(i)}`];if(a?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a?.scopes&&o.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[u,d]=await rl(this.storage,this.storageKey),f=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(f.toString())}if(a?.queryParams){const u=new URLSearchParams(a.queryParams);o.push(u.toString())}return a?.skipBrowserRedirect&&o.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;return u?this._returnResult({data:null,error:u}):await Rt(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token})})}catch(i){if(wt(i))return this._returnResult({data:null,error:i});throw i}}async _enroll(t){try{return await this._useSession(async i=>{var a,o;const{data:u,error:d}=i;if(d)return this._returnResult({data:null,error:d});const f=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:h,error:m}=await Rt(this.fetch,"POST",`${this.url}/factors`,{body:f,headers:this.headers,jwt:(a=u?.session)===null||a===void 0?void 0:a.access_token});return m?this._returnResult({data:null,error:m}):(t.factorType==="totp"&&h.type==="totp"&&(!((o=h?.totp)===null||o===void 0)&&o.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(i){if(wt(i))return this._returnResult({data:null,error:i});throw i}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({data:null,error:u});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?SE(t.webauthn.credential_response):jE(t.webauthn.credential_response)})}:{code:t.code}),{data:f,error:h}=await Rt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+f.expires_in},f)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",f),this._returnResult({data:f,error:h}))})}catch(i){if(wt(i))return this._returnResult({data:null,error:i});throw i}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var a;const{data:o,error:u}=i;if(u)return this._returnResult({data:null,error:u});const d=await Rt(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(a=o?.session)===null||a===void 0?void 0:a.access_token});if(d.error)return d;const{data:f}=d;if(f.type!=="webauthn")return{data:f,error:null};switch(f.webauthn.type){case"create":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:bE(f.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},f),{webauthn:Object.assign(Object.assign({},f.webauthn),{credential_options:Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:wE(f.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(i){if(wt(i))return this._returnResult({data:null,error:i});throw i}})}async _challengeAndVerify(t){const{data:i,error:a}=await this._challenge({factorId:t.factorId});return a?this._returnResult({data:null,error:a}):await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){var t;const{data:{user:i},error:a}=await this.getUser();if(a)return{data:null,error:a};const o={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=i?.factors)!==null&&t!==void 0?t:[])o.all.push(u),u.status==="verified"&&o[u.factor_type].push(u);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,i;const{data:{session:a},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=Bf(a.access_token);let d=null;u.aal&&(d=u.aal);let f=d;((i=(t=a.user.factors)===null||t===void 0?void 0:t.filter(y=>y.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(f="aal2");const m=u.amr||[];return{data:{currentLevel:d,nextLevel:f,currentAuthenticationMethods:m},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;return o?this._returnResult({data:null,error:o}):a?await Rt(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:a.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Ar})})}catch(i){if(wt(i))return this._returnResult({data:null,error:i});throw i}}async _approveAuthorization(t,i){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Ar});const d=await Rt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&ar()&&!i?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(wt(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(t,i){try{return await this._useSession(async a=>{const{data:{session:o},error:u}=a;if(u)return this._returnResult({data:null,error:u});if(!o)return this._returnResult({data:null,error:new Ar});const d=await Rt(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:f=>({data:f,error:null})});return d.data&&d.data.redirect_url&&ar()&&!i?.skipBrowserRedirect&&window.location.assign(d.data.redirect_url),d})}catch(a){if(wt(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:i},error:a}=t;return a?this._returnResult({data:null,error:a}):i?await Rt(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:i.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Ar})})}catch(t){if(wt(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async i=>{const{data:{session:a},error:o}=i;return o?this._returnResult({data:null,error:o}):a?(await Rt(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:a.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ar})})}catch(i){if(wt(i))return this._returnResult({data:null,error:i});throw i}}async fetchJwk(t,i={keys:[]}){let a=i.keys.find(f=>f.kid===t);if(a)return a;const o=Date.now();if(a=this.jwks.keys.find(f=>f.kid===t),a&&this.jwks_cached_at+AN>o)return a;const{data:u,error:d}=await Rt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=o,a=u.keys.find(f=>f.kid===t),!a)?null:a}async getClaims(t,i={}){try{let a=t;if(!a){const{data:S,error:_}=await this.getSession();if(_||!S.session)return this._returnResult({data:null,error:_});a=S.session.access_token}const{header:o,payload:u,signature:d,raw:{header:f,payload:h}}=Bf(a);i?.allowExpired||ZN(u.exp);const m=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,i?.keys?{keys:i.keys}:i?.jwks);if(!m){const{error:S}=await this.getUser(a);if(S)throw S;return{data:{claims:u,header:o,signature:d},error:null}}const y=eE(o.alg),v=await crypto.subtle.importKey("jwk",m,y,!0,["verify"]);if(!await crypto.subtle.verify(y,v,d,$N(`${f}.${h}`)))throw new kp("Invalid JWT signature");return{data:{claims:u,header:o,signature:d},error:null}}catch(a){if(wt(a))return this._returnResult({data:null,error:a});throw a}}}Zo.nextInstanceID={};const OE=Zo,DE="2.89.0";let Lo="";typeof Deno<"u"?Lo="deno":typeof document<"u"?Lo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Lo="react-native":Lo="node";const ME={"X-Client-Info":`supabase-js-${Lo}/${DE}`},zE={headers:ME},LE={schema:"public"},UE={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},IE={};function ec(n){"@babel/helpers - typeof";return ec=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ec(n)}function BE(n,t){if(ec(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(ec(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function $E(n){var t=BE(n,"string");return ec(t)=="symbol"?t:t+""}function PE(n,t,i){return(t=$E(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function Bx(n,t){var i=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),i.push.apply(i,a)}return i}function Mn(n){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Bx(Object(i),!0).forEach(function(a){PE(n,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):Bx(Object(i)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(i,a))})}return n}const qE=n=>n?(...t)=>n(...t):(...t)=>fetch(...t),FE=()=>Headers,HE=(n,t,i)=>{const a=qE(i),o=FE();return async(u,d)=>{var f;const h=(f=await t())!==null&&f!==void 0?f:n;let m=new o(d?.headers);return m.has("apikey")||m.set("apikey",n),m.has("Authorization")||m.set("Authorization",`Bearer ${h}`),a(u,Mn(Mn({},d),{},{headers:m}))}};function VE(n){return n.endsWith("/")?n:n+"/"}function GE(n,t){var i,a;const{db:o,auth:u,realtime:d,global:f}=n,{db:h,auth:m,realtime:y,global:v}=t,x={db:Mn(Mn({},h),o),auth:Mn(Mn({},m),u),realtime:Mn(Mn({},y),d),storage:{},global:Mn(Mn(Mn({},v),f),{},{headers:Mn(Mn({},(i=v?.headers)!==null&&i!==void 0?i:{}),(a=f?.headers)!==null&&a!==void 0?a:{})}),accessToken:async()=>""};return n.accessToken?x.accessToken=n.accessToken:delete x.accessToken,x}function KE(n){const t=n?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(VE(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var YE=class extends OE{constructor(n){super(n)}},WE=class{constructor(n,t,i){var a,o;this.supabaseUrl=n,this.supabaseKey=t;const u=KE(n);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,f={db:LE,realtime:IE,auth:Mn(Mn({},UE),{},{storageKey:d}),global:zE},h=GE(i??{},f);if(this.storageKey=(a=h.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken)this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(y,v)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(v)} is not possible`)}});else{var m;this.auth=this._initSupabaseAuthClient((m=h.auth)!==null&&m!==void 0?m:{},this.headers,h.global.fetch)}this.fetch=HE(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Mn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&this.accessToken().then(y=>this.realtime.setAuth(y)).catch(y=>console.warn("Failed to set initial Realtime auth token:",y)),this.rest=new kC(new URL("rest/v1",u).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new CN(this.storageUrl.href,this.headers,this.fetch,i?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new jC(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,t={},i={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,t,i)}channel(n,t={config:{}}){return this.realtime.channel(n,t)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,t,i;if(n.accessToken)return await n.accessToken();const{data:a}=await n.auth.getSession();return(t=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&t!==void 0?t:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:t,detectSessionInUrl:i,storage:a,userStorage:o,storageKey:u,flowType:d,lock:f,debug:h,throwOnError:m},y,v){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new YE({url:this.authUrl.href,headers:Mn(Mn({},x),y),storageKey:u,autoRefreshToken:n,persistSession:t,detectSessionInUrl:i,storage:a,userStorage:o,flowType:d,lock:f,debug:h,throwOnError:m,fetch:v,hasCustomAuthorizationHeader:Object.keys(this.headers).some(S=>S.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new VC(this.realtimeUrl.href,Mn(Mn({},n),{},{params:Mn(Mn({},{apikey:this.supabaseKey}),n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,t)=>{this._handleTokenChanged(n,"CLIENT",t?.access_token)})}_handleTokenChanged(n,t,i){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const QE=(n,t,i)=>new WE(n,t,i);function JE(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const t=n.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}JE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const qf={BASE_URL:"/app/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var XE={};const Ub=n=>{if(typeof import.meta<"u"&&qf&&qf[n])return qf[n];const t=XE;return t&&t[n]?t[n]:null},Ib=Ub("VITE_SUPABASE_URL")||"https://hocbnifuactbvmyjraxy.supabase.co",Bb=Ub("VITE_SUPABASE_ANON_KEY")||"sb_publishable_CmEv4H4dXwtqm65i_jpsCQ_8BtDOucx",Ho=Ib,$u=Bb,_e=QE(Ib,Bb),ZE=2,Ff=n=>{if(typeof n!="string")return!1;const t=n.trim();return t?!/^[\d-\s.,+\-/%~]+$/.test(t):!1},$x={async translateRecipe(n,t="EN-US"){const i=[],a=[],o=(h,m)=>{const y=typeof h=="string"?h:String(h??"");i.push(y),a.push((v,x)=>{m(x,v||y,y)})},u=h=>Array.isArray(h)?h.map(m=>m&&typeof m=="object"?{...m}:m):h,d={...n,ingredients:u(n.ingredients),flours:u(n.flours),breadIngredients:u(n.breadIngredients),steps:u(n.steps),ingredientGroups:u(n.ingredientGroups),stepGroups:u(n.stepGroups)};if(o(n.title||n.name||"",(h,m)=>{h.title=m,(h.name!==void 0||n.name!==void 0)&&(h.name=m)}),o(n.description||"",(h,m)=>{h.description=m}),n.course&&o(n.course,(h,m)=>{h.course=m}),n.category&&o(n.category,(h,m)=>{h.category=m}),n.storeName&&o(n.storeName,(h,m)=>{h.storeName=m}),Array.isArray(n.ingredientGroups)&&n.ingredientGroups.forEach((h,m)=>{const y=h?.name;y&&o(y,(v,x)=>{v.ingredientGroups?.[m]&&(v.ingredientGroups[m].name=x)})}),Array.isArray(n.stepGroups)&&n.stepGroups.forEach((h,m)=>{const y=h?.name;y&&o(y,(v,x)=>{v.stepGroups?.[m]&&(v.stepGroups[m].name=x)})}),n.type==="bread"?((n.flours||[]).forEach((h,m)=>{!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.flours?.[m]&&(y.flours[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.flours?.[m]&&(y.flours[m].unit=v)}),Ff(h.quantity)&&o(h.quantity,(y,v)=>{y.flours?.[m]&&(y.flours[m].quantity=v)}))}),(n.breadIngredients||[]).forEach((h,m)=>{!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].unit=v)}),Ff(h.quantity)&&o(h.quantity,(y,v)=>{y.breadIngredients?.[m]&&(y.breadIngredients[m].quantity=v)}))})):(n.ingredients||[]).forEach((h,m)=>{if(typeof h=="string"){o(h,(y,v)=>{Array.isArray(y.ingredients)&&(y.ingredients[m]=v)});return}!h||typeof h!="object"||(o(h.name||"",(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].name=v)}),h.unit&&o(h.unit,(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].unit=v)}),Ff(h.quantity)&&o(h.quantity,(y,v)=>{y.ingredients?.[m]&&typeof y.ingredients[m]=="object"&&(y.ingredients[m].quantity=v)}))}),(n.steps||[]).forEach((h,m)=>{const y=typeof h=="object"&&h!==null?h.text||"":h||"";o(y,(v,x)=>{const S=v.steps?.[m];if(typeof S=="object"&&S!==null){S.text=x;return}Array.isArray(v.steps)&&(v.steps[m]=x)})}),!i.some(h=>String(h||"").trim().length>0))return n;try{const h=await this.translateList(i,t);return a.forEach((m,y)=>{m(h[y],d)}),d.__translationVersion=ZE,d}catch(h){throw console.error("Translation failed:",h),h}},async translateList(n,t){const i=(n||[]).map(m=>typeof m=="string"?m:String(m??""));if(!i.some(m=>m.trim().length>0))return i;const a=`${Ho}/functions/v1/translate`,o=async m=>await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",apikey:$u,Authorization:`Bearer ${m}`},body:JSON.stringify({text:i,target_lang:t})}),u=async()=>{const{data:m}=await _e.auth.getSession();if(m?.session?.access_token)return m.session.access_token;const{data:y,error:v}=await _e.auth.refreshSession();if(v||!y?.session?.access_token){const x=v?.message||"",S=/refresh_token|session|expired|invalid|not found/i.test(x);throw new Error(S?"":x||"")}return y.session.access_token};let d=await u(),f=await o(d);if(f.status===401&&(d=await u(),f=await o(d)),!f.ok){const m=f.status;let y="";try{const v=await f.text();if(v)try{const x=JSON.parse(v);y=x?.error||x?.message||v}catch{y=v}}catch{}throw new Error(y||`Translation Error (${m})`)}const h=await f.json();if(h&&h.error)throw console.error("Edge Function returned error:",h.error),new Error(`Translation Error: ${h.error}`);if(!Array.isArray(h?.translations))throw console.error("Edge Function returned invalid payload:",h),new Error("Translation Error: invalid response payload");return h.translations.map(m=>m.text)}},Jt=n=>{const t=(n??"").toString();return(typeof t.normalize=="function"?t.normalize("NFKC"):t).trim().replace(/[\s\u3000]+/g,"").toLowerCase()},ku=async(n,t,i)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${i||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},Pu=n=>{if(Array.isArray(n))return n.map(i=>String(i)).filter(Boolean);if(typeof n!="string")return[];const t=n.trim();if(!t)return[];if(t.startsWith("{")&&t.endsWith("}")){const i=t.slice(1,-1);return i?i.split(",").map(a=>a.trim().replace(/^"(.*)"$/,"$1")).filter(Boolean):[]}return[]},ek=n=>{if(n==null)return[];if(Array.isArray(n)){if(n.every(t=>typeof t=="string"))return n.filter(Boolean);if(n.length===1&&n[0]&&typeof n[0]=="object"){const t=n[0],i=Object.values(t)[0];return Pu(i)}return[]}if(typeof n=="object"){const t=Object.values(n)[0];return Pu(t)}return Pu(n)},$b=n=>{if(Array.isArray(n))return n.map(t=>String(t)).filter(Boolean);if(typeof n=="string"){const t=n.trim();if(!t)return[];const i=Pu(t);return i.length>0?i:t.split(",").map(a=>a.trim()).filter(Boolean)}return[]},Px=n=>{if(!n)return!1;const t=String(n.code||"").toUpperCase(),i=String(n.message||"").toLowerCase(),a=String(n.details||"").toLowerCase();return t==="42501"||t.startsWith("PGRST")||i.includes("row-level security")||i.includes("permission denied")||i.includes("violates row-level security")||i.includes("invalid input syntax")||i.includes("column")||a.includes("row-level security")?!1:i.includes("failed to fetch")||i.includes("network")||i.includes("timeout")||i.includes("timed out")||i.includes("load failed")},Pb="recipe_list_cache",tk=300*1e3,Hf=(n,t)=>{try{const i=(n||[]).map(a=>({id:a.id,title:a.title,description:a.description,image:a.image,servings:a.servings,course:a.course,category:a.category,storeName:a.storeName,store_name:a.store_name,tags:a.tags,created_at:a.created_at,updated_at:a.updated_at,type:a.type,sourceUrl:a.sourceUrl}));localStorage.setItem(Pb,JSON.stringify({userId:t,updatedAt:Date.now(),recipes:i}))}catch{}},nk=n=>{try{const t=localStorage.getItem(Pb);if(!t)return null;const i=JSON.parse(t);return i.userId!==n||Date.now()-i.updatedAt>tk?null:i.recipes||null}catch{return null}},bn={_queryPattern:null,_queryPatternCache:new Map,_showMasterPrefCache:new Map,_masterOwnerTagsCache:{value:new Set(["owner:yoshito","owner:admin"]),updatedAt:0},getCachedRecipes(n){return nk(n)},saveCachedRecipes(n,t){Hf(n,t)},async _resolveShowMasterPreference(n,t=15e3){const i=n?.showMasterRecipes===!0,a=n?.id;if(!a)return i;const o=this._showMasterPrefCache.get(a),u=Date.now();if(o&&o.value!==i)return this._showMasterPrefCache.set(a,{value:i,updatedAt:u}),i;if(o&&u-o.updatedAt<3e4)return o.value;try{const{data:d,error:f}=await ku(_e.from("profiles").select("show_master_recipes").eq("id",a).single(),Math.min(3e3,t/3),"profiles.select(show_master_recipes)");if(f)throw f;const h=d?.show_master_recipes===!0;return this._showMasterPrefCache.set(a,{value:h,updatedAt:u}),h}catch{return this._showMasterPrefCache.set(a,{value:i,updatedAt:u}),i}},async _resolveMasterOwnerTags(n=15e3){const t=Date.now();if(this._masterOwnerTagsCache?.value&&t-this._masterOwnerTagsCache.updatedAt<3e4)return this._masterOwnerTagsCache.value;try{const{data:i,error:a}=await ku(_e.rpc("get_master_recipe_owner_tags"),Math.min(3e3,n/3),"rpc.get_master_recipe_owner_tags");if(a)throw a;const o=ek(i),u=new Set(o.length>0?o:["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:u,updatedAt:t},u}catch{const i=this._masterOwnerTagsCache?.value||new Set(["owner:yoshito","owner:admin"]);return this._masterOwnerTagsCache={value:i,updatedAt:t},i}},async fetchRecipes(n,{timeoutMs:t=15e3,includeIngredients:i=!0,includeSources:a=!0,offset:o=0,limit:u=null,skipCacheSave:d=!1,returnMeta:f=!1}={}){if(!n)return console.warn("fetchRecipes: No currentUser, returning empty list."),[];const h=n.role==="admin",m=h?Promise.resolve(!1):this._resolveShowMasterPreference(n,t),y=Number.isInteger(o)&&o>=0?o:0,v=Number.isInteger(u)&&u>0?u:null;let x=0,S=[];const _=async(P,{withOrderIndex:F,queryTimeoutMs:Q})=>{let $=_e.from("recipes").select(P);F?$=$.order("order_index",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!1}):$=$.order("created_at",{ascending:!1}),v!=null&&($=$.range(y,y+v-1));const{data:I,error:k}=await ku($,Q,"recipes.select(list)");if(k)throw k;return x=Array.isArray(I)?I.length:0,(I||[]).map(as)},N=i?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at,order_index${a?",recipe_sources(url)":""}`,w=i?`id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at${a?",recipe_sources(url)":""}`:`id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at${a?",recipe_sources(url)":""}`,C=i?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at,updated_at":"id,title,description,image,servings,course,category,store_name,tags,created_at,updated_at",D=i?"id,title,description,image,servings,course,category,store_name,ingredients,tags,created_at":"id,title,description,image,servings,course,category,store_name,tags,created_at";let z=null;const T=`recipe_query_pattern:${i?"ing":"noing"}:${a?"src":"nosrc"}`,U=this._queryPatternCache.get(T),E=Math.max(2500,t);if(U)try{S=await _(U.spec,{withOrderIndex:U.withOrderIndex,queryTimeoutMs:E})}catch(P){console.warn("Cached query pattern failed, re-detecting...",P),this._queryPatternCache.delete(T),z=P}else{const F=Math.max(2500,Math.round(t/(i?[N,w,C,D]:[N,w,D]).length));try{S=await _(N,{withOrderIndex:!0,queryTimeoutMs:F}),this._queryPatternCache.set(T,{spec:N,withOrderIndex:!0})}catch(Q){z=Q;try{S=await _(w,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(T,{spec:w,withOrderIndex:!1})}catch($){z=$;try{S=await _(C,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(T,{spec:C,withOrderIndex:!1})}catch(I){z=I;try{S=await _(D,{withOrderIndex:!1,queryTimeoutMs:F}),this._queryPatternCache.set(T,{spec:D,withOrderIndex:!1})}catch(k){z=k,S=[]}}}}}if(S.length===0&&z)try{const P=localStorage.getItem("local_recipes");if(P){const F=JSON.parse(P).map(Q=>typeof as=="function"?as(Q):Q);S=v!=null?F.slice(y,y+v):F,x=S.length}else throw z}catch{throw z}if(h)return d||Hf(S,n.id),f?{recipes:S,hasMoreRaw:v!=null?x===v:!1}:S;const R=[String(n.id)];n.displayId&&R.push(String(n.displayId));const A=await m,O=A?await this._resolveMasterOwnerTags(t):new Set,V=S.filter(P=>{const F=$b(P.tags),Q=F.filter(L=>L&&L.startsWith("owner:"));if(Q.length===0)return!0;const $=Q.some(L=>O.has(L));if(A&&$)return!0;const I=Q.some(L=>R.some(H=>L===`owner:${H}`)),k=F.includes("public");return!!(I||k)});return d||Hf(V,n.id),f?{recipes:V,hasMoreRaw:v!=null?x===v:!1}:V},_filterRecipesInApp(n,t){return this.fetchRecipes(t)},async uploadImage(n){const t=n.name.split(".").pop(),a=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`}`,{error:o}=await _e.storage.from("recipe-images").upload(a,n);if(o)throw o;const{data:u}=_e.storage.from("recipe-images").getPublicUrl(a);return u.publicUrl},async getRecipe(n){try{const{data:t,error:i}=await ku(_e.from("recipes").select("*, recipe_sources(url)").eq("id",n).single(),15e3,"recipes.select(detail)");if(i)throw i;return as(t)}catch(t){console.warn("Supabase getRecipe failed, falling back to LocalStorage:",t);const i=localStorage.getItem("local_recipes");if(i){const o=JSON.parse(i).find(u=>u.id==n);if(o)return as(o)}throw t}},async createRecipe(n,t){console.log("createRecipe called with user:",t);const{id:i,created_at:a,sourceUrl:o,...u}=n;if(u.image instanceof File&&(u.image=await this.uploadImage(u.image)),t){const h=(u.tags||[]).filter(m=>!m.startsWith("owner:"));u.tags=[...h,`owner:${t.id}`],console.log("Added owner tag. New tags:",u.tags)}else console.warn("createRecipe: No currentUser provided! Recipe will be public.");const d=Tu(u);try{const{data:f,error:h}=await _e.from("recipes").insert([d]).select().single();if(h)throw h;if(o){const{error:m}=await _e.from("recipe_sources").insert([{recipe_id:f.id,url:o}]);m&&console.error("Failed to save source URL:",m)}return as({...f,recipe_sources:o?[{url:o}]:[]})}catch(f){if(!Px(f))throw f;console.warn("Supabase create failed (network/transient), using LocalStorage fallback:",f);const h=Date.now(),m={...u,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),tags:u.tags||[]},y=Tu(m);y.id=h,y.created_at=m.created_at,console.log("Saving to LocalStorage:",y);try{const v=localStorage.getItem("local_recipes"),x=v?JSON.parse(v):[];x.push(y),localStorage.setItem("local_recipes",JSON.stringify(x)),console.log("Saved to LocalStorage success. Total recipes:",x.length)}catch(v){throw console.error("Failed to save to LocalStorage:",v),f}return as(y)}},async updateRecipe(n){const{id:t,created_at:i,sourceUrl:a,...o}=n;o.image instanceof File&&(o.image=await this.uploadImage(o.image));const u=Tu(o);o.steps===void 0&&delete u.steps,o.tags===void 0&&delete u.tags,o.ingredients!==void 0||o.type!==void 0||o.ingredientGroups!==void 0||o.flours!==void 0||o.breadIngredients!==void 0||o.stepGroups!==void 0||delete u.ingredients;try{const{data:f,error:h}=await _e.from("recipes").update(u).eq("id",n.id).select().single();if(h)throw h;if(a!==void 0&&(await _e.from("recipe_sources").delete().eq("recipe_id",n.id),a)){const{error:m}=await _e.from("recipe_sources").insert([{recipe_id:n.id,url:a}]);m&&console.error("Failed to update source URL:",m)}return as({...f,recipe_sources:a?[{url:a}]:[]})}catch(f){if(!Px(f))throw f;console.warn("Supabase update failed (network/transient), using LocalStorage fallback:",f);const h=localStorage.getItem("local_recipes");if(h){let m=JSON.parse(h);const y=m.findIndex(v=>v.id==n.id);if(y!==-1){const v={...m[y],...u,updated_at:new Date().toISOString()};return m[y]=v,localStorage.setItem("local_recipes",JSON.stringify(m)),as(v)}}throw f}},async duplicateRecipe(n,t){const{id:i,created_at:a,updated_at:o,image:u,...d}=n;d.title=`${d.title} ()`;let f=null;if(u)try{const h=u.split("/").pop(),m=`copy-${Date.now()}-${h}`,{error:y}=await _e.storage.from("recipe-images").copy(h,m);if(y)console.warn("Image copy failed, using original URL:",y),f=u;else{const{data:v}=_e.storage.from("recipe-images").getPublicUrl(m);f=v.publicUrl}}catch(h){console.warn("Image copy logic error:",h),f=u}return d.image=f,await this.createRecipe(d,t)},async fetchDeletedRecipes(){const{data:n,error:t}=await _e.from("deleted_recipes").select("*").order("deleted_at",{ascending:!1});if(t)throw t;return n.map(rk)},async getDeletedCount(){const{count:n,error:t}=await _e.from("deleted_recipes").select("*",{count:"exact",head:!0});if(t)throw t;return n},async deleteRecipe(n){try{const{data:t,error:i}=await _e.from("recipes").select("*").eq("id",n).single();if(i)throw i;const{error:a}=await _e.from("deleted_recipes").insert([{original_id:t.id,title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await _e.from("recipes").delete().eq("id",n);if(o)throw o;return!0}catch(t){console.warn("Supabase delete failed, using LocalStorage fallback:",t);const i=localStorage.getItem("local_recipes");if(i){let a=JSON.parse(i);const o=a.length;if(a=a.filter(u=>u.id!=n),a.length<o)return localStorage.setItem("local_recipes",JSON.stringify(a)),!0}throw t}},async restoreRecipe(n){const{data:t,error:i}=await _e.from("deleted_recipes").select("*").eq("id",n).single();if(i)throw i;const{error:a}=await _e.from("recipes").insert([{title:t.title,description:t.description,image:t.image,prep_time:t.prep_time,cook_time:t.cook_time,servings:t.servings,tags:t.tags,ingredients:t.ingredients,steps:t.steps,created_at:t.created_at}]);if(a)throw a;const{error:o}=await _e.from("deleted_recipes").delete().eq("id",n);if(o)throw o;return!0},async hardDeleteRecipe(n){const{error:t}=await _e.from("deleted_recipes").delete().eq("id",n);if(t)throw t;return!0},async fetchRecentRecipes(){const{data:n,error:t}=await _e.from("recent_views").select("recipe_id").order("viewed_at",{ascending:!1}).limit(20);if(t)throw t;return n.map(i=>i.recipe_id)},async addToHistory(n){const{error:t}=await _e.from("recent_views").upsert({recipe_id:n,viewed_at:new Date().toISOString()},{onConflict:"recipe_id"});if(t)throw t;return!0},async updateOrder(n){const t=n.map(i=>_e.from("recipes").update({order_index:i.order_index}).eq("id",i.id));await Promise.all(t)},async exportAllRecipes(){return await this.fetchRecipes()},async importRecipes(n){if(!Array.isArray(n))throw new Error("Invalid backup format");let t=0,i=[];for(const a of n)try{await this.createRecipe(a),t++}catch(o){console.error("Import failed for recipe:",a.title,o),i.push({title:a.title,error:o.message})}return{success:!0,count:t,errors:i}},async updateRecipeCosts(n){const{data:t,error:i}=await _e.from("recipes").select("*");if(i)throw i;let a=0;const o=[];for(const u of t){const d=as(u);let f=!1;const h=m=>m.map(y=>{if(!y.name)return y;const v=n.get(Jt(y.name));if(v&&y.purchaseCost!==v.price){f=!0;const x={...y,purchaseCost:v.price};if(d.type==="bread"){const S=parseFloat(x.quantity)||0;x.cost=Math.round(S/1e3*x.purchaseCost)}else if(y.cost&&y.purchaseCost){const S=y.cost/y.purchaseCost;x.cost=Math.round(x.purchaseCost*S)}return x}return y});if(d.type==="bread"){const m=h(d.flours||[]),y=h(d.breadIngredients||[]);f&&(d.flours=m,d.breadIngredients=y)}else{const m=h(d.ingredients||[]);f&&(d.ingredients=m)}if(f){const m=Tu(d);o.push(_e.from("recipes").update(m).eq("id",d.id)),a++}}return o.length>0&&await Promise.all(o),a}},Tu=n=>{let t=n.ingredients||[];const i={_meta:!0,type:n.type||"normal"};if(n.ingredientGroups&&n.ingredientGroups.length>0&&(i.groups=n.ingredientGroups),n.stepGroups&&n.stepGroups.length>0){const o=n.steps||[],u=n.stepGroups.map(d=>({...d,count:o.filter(f=>f.groupId===d.id).length}));i.stepGroups=u}if(n.type==="bread"){const o=(n.flours||[]).map(d=>({...d,_group:"flour"})),u=(n.breadIngredients||[]).map(d=>({...d,_group:"other"}));t=[i,...o,...u]}else t=[i,...t];const a=(n.steps||[]).map(o=>typeof o=="string"?o:o.text);return{title:n.title,description:n.description,image:n.image,servings:n.servings,course:n.course,category:n.category,store_name:n.storeName,ingredients:t,steps:a,tags:n.tags||[]}},as=n=>{const t=n.ingredients||[];let i="normal",a=[],o=[],u=[],d=[],f=t;const h=$b(n.tags);if(Array.isArray(t)&&t.length>0&&t[0]&&typeof t[0]=="object"&&t[0]._meta){const v=t[0];i=v.type||"normal",v.groups&&(u=v.groups),v.stepGroups&&(d=v.stepGroups);const x=t.slice(1);i==="bread"?(a=x.filter(S=>S._group==="flour").map(S=>{const{_group:_,...N}=S;return N}),o=x.filter(S=>S._group==="other").map(S=>{const{_group:_,...N}=S;return N}),f=[...a,...o]):f=x}else n.ingredients_meta&&(i=n.ingredients_meta.type||"normal",Array.isArray(n.ingredients_meta.groups)&&(u=n.ingredients_meta.groups),Array.isArray(n.ingredients_meta.stepGroups)&&(d=n.ingredients_meta.stepGroups),f=Array.isArray(t)?t:[]);let y=n.steps||[];if(d.length>0&&Array.isArray(y)){let v=0;y=y.map(S=>({text:S}));const x=[];for(d.forEach(S=>{const _=S.count||0;for(let N=0;N<_;N++)v<y.length&&(x.push({...y[v],text:y[v].text,groupId:S.id}),v++)});v<y.length;)x.push({...y[v],groupId:"default"}),v++;y=x}return{...n,prepTime:n.prep_time,cookTime:n.cook_time,storeName:n.store_name,type:i,flours:a,breadIngredients:o,ingredientGroups:u,stepGroups:d,ingredients:f,steps:y.length>0&&typeof y[0]=="object"?y:n.steps,tags:h,sourceUrl:n.recipe_sources&&n.recipe_sources.length>0?n.recipe_sources[0].url:""}},rk=n=>({...as(n),deletedAt:n.deleted_at,originalId:n.original_id}),Vf=Object.freeze(Object.defineProperty({__proto__:null,recipeService:bn},Symbol.toStringTag,{value:"Module"})),Gf="food",sk="food_alcohol",ik=new Set(["food","alcohol","soft_drink","supplies"]),Au=n=>{const t=String(n||"").trim();return!t||t===sk?Gf:ik.has(t)?t:Gf},Un={async _getCurrentUserId(){const{data:n,error:t}=await _e.auth.getUser();if(t)throw t;return n?.user?.id||null},async saveConversion(n,t,i,a=null,o=null,u=void 0,d=void 0){try{const f=await this._getCurrentUserId();if(!f)throw new Error("");const h={user_id:f,ingredient_name:n,packet_size:parseFloat(t),packet_unit:i,last_price:a?parseFloat(a):null,updated_at:new Date().toISOString()};if(o&&(h.item_category=Au(o)),u!==void 0){const x=String(u??"").trim();h.vendor=x||null}if(d!==void 0){const x=parseFloat(d);let S=Number.isFinite(x)?x:100;S<=0&&(S=100),S>100&&(S=100),h.yield_percent=S}const m=async x=>_e.from("unit_conversions").upsert(x,{onConflict:"user_id,ingredient_name"}).select().single();let{data:y,error:v}=await m(h);if(v){const x=String(v.message||""),S=!!h.item_category&&x.includes("item_category"),_=Object.prototype.hasOwnProperty.call(h,"vendor")&&x.includes("vendor"),N=Object.prototype.hasOwnProperty.call(h,"yield_percent")&&x.includes("yield_percent");if(S||_||N){const w={...h};S&&delete w.item_category,_&&delete w.vendor,N&&delete w.yield_percent,{data:y,error:v}=await m(w)}}if(v)throw v;return{ingredientName:y.ingredient_name,packetSize:y.packet_size,packetUnit:y.packet_unit,lastPrice:y.last_price,vendor:y.vendor||"",itemCategory:Au(y.item_category),yieldPercent:y.yield_percent===null||y.yield_percent===void 0?100:y.yield_percent,updatedAt:y.updated_at}}catch(f){throw console.error("Error saving conversion:",f),f}},async getConversion(n){try{const t=await this._getCurrentUserId();if(!t)return null;const{data:i,error:a}=await _e.from("unit_conversions").select("*").eq("ingredient_name",n).eq("user_id",t).single();return a?(a.code==="PGRST116"||console.warn("Error fetching conversion:",a),null):{ingredientName:i.ingredient_name,packetSize:i.packet_size,packetUnit:i.packet_unit,lastPrice:i.last_price,vendor:i.vendor||"",itemCategory:Au(i.item_category),yieldPercent:i.yield_percent===null||i.yield_percent===void 0?100:i.yield_percent,updatedAt:i.updated_at}}catch(t){return console.error("Error in getConversion:",t),null}},async getAllConversions(){try{const n=await this._getCurrentUserId();if(!n)return new Map;const{data:t,error:i}=await _e.from("unit_conversions").select("*").eq("user_id",n);if(i)throw i;const a=new Map;return t.forEach(o=>{a.set(o.ingredient_name,{ingredientName:o.ingredient_name,packetSize:o.packet_size,packetUnit:o.packet_unit,lastPrice:o.last_price,vendor:o.vendor||"",itemCategory:Au(o.item_category),yieldPercent:o.yield_percent===null||o.yield_percent===void 0?100:o.yield_percent,updatedAt:o.updated_at})}),a}catch(n){return console.error("Error in getAllConversions:",n),new Map}},async deleteConversion(n){try{const t=await this._getCurrentUserId();if(!t)throw new Error("");const{error:i}=await _e.from("unit_conversions").delete().eq("ingredient_name",n).eq("user_id",t);if(i)throw i;return{success:!0}}catch(t){throw console.error("Error deleting conversion:",t),t}},async adminCopyIngredientMasterToUser(n,{overwrite:t=!1}={}){const i=String(n||"").trim();if(!i)throw new Error("");const{data:a,error:o}=await _e.rpc("admin_copy_ingredient_master",{target_profile_id:i,overwrite:t===!0});if(o)throw o;return a}},qb=b.createContext(null),fs=()=>b.useContext(qb),Fb=b.createContext(null),Ui=()=>{const n=b.useContext(Fb);if(!n)throw new Error("useToast must be used within a ToastProvider");return n},td=["","MARUGO-D","MARUGO-OTTO","MARUGO-S","","","MARUGO","MARUGO2","MARUGO GRANDE","MARUGO MARUNOUCHI","","MARUGO YOTSUYA","371BAR","","BAR PELOTA","Claudia2","BISTRO CAVACAVA","eric'S","MITAN","","SOBA-JU","Bar Violet","X&C"," "],ak=[{code:"EN-US",label:" English",name:"English"},{code:"JA",label:" Japanese",name:"Japanese"},{code:"FR",label:" French",name:"French"},{code:"IT",label:" Italian",name:"Italian"},{code:"ES",label:" Spanish",name:"Spanish"},{code:"ZH",label:" Chinese",name:"Chinese"}];var ll={},Kf={exports:{}},Yf,qx;function lk(){if(qx)return Yf;qx=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Yf=n,Yf}var Wf,Fx;function ok(){if(Fx)return Wf;Fx=1;var n=lk();function t(){}function i(){}return i.resetWarningCache=t,Wf=function(){function a(d,f,h,m,y,v){if(v!==n){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}a.isRequired=a;function o(){return a}var u={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:o,element:a,elementType:a,instanceOf:o,node:a,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:i,resetWarningCache:t};return u.PropTypes=u,u},Wf}var Hx;function Hb(){return Hx||(Hx=1,Kf.exports=ok()()),Kf.exports}var Qf,Vx;function Vb(){return Vx||(Vx=1,Qf={L:1,M:0,Q:3,H:2}),Qf}var Jf,Gx;function Gb(){return Gx||(Gx=1,Jf={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8}),Jf}var Xf,Kx;function ck(){if(Kx)return Xf;Kx=1;var n=Gb();function t(i){this.mode=n.MODE_8BIT_BYTE,this.data=i}return t.prototype={getLength:function(i){return this.data.length},write:function(i){for(var a=0;a<this.data.length;a++)i.put(this.data.charCodeAt(a),8)}},Xf=t,Xf}var Zf,Yx;function uk(){if(Yx)return Zf;Yx=1;var n=Vb();function t(i,a){this.totalCount=i,this.dataCount=a}return t.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t.getRSBlocks=function(i,a){var o=t.getRsBlockTable(i,a);if(o==null)throw new Error("bad rs block @ typeNumber:"+i+"/errorCorrectLevel:"+a);for(var u=o.length/3,d=new Array,f=0;f<u;f++)for(var h=o[f*3+0],m=o[f*3+1],y=o[f*3+2],v=0;v<h;v++)d.push(new t(m,y));return d},t.getRsBlockTable=function(i,a){switch(a){case n.L:return t.RS_BLOCK_TABLE[(i-1)*4+0];case n.M:return t.RS_BLOCK_TABLE[(i-1)*4+1];case n.Q:return t.RS_BLOCK_TABLE[(i-1)*4+2];case n.H:return t.RS_BLOCK_TABLE[(i-1)*4+3];default:return}},Zf=t,Zf}var ep,Wx;function dk(){if(Wx)return ep;Wx=1;function n(){this.buffer=new Array,this.length=0}return n.prototype={get:function(t){var i=Math.floor(t/8);return(this.buffer[i]>>>7-t%8&1)==1},put:function(t,i){for(var a=0;a<i;a++)this.putBit((t>>>i-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(t){var i=Math.floor(this.length/8);this.buffer.length<=i&&this.buffer.push(0),t&&(this.buffer[i]|=128>>>this.length%8),this.length++}},ep=n,ep}var tp,Qx;function Kb(){if(Qx)return tp;Qx=1;for(var n={glog:function(i){if(i<1)throw new Error("glog("+i+")");return n.LOG_TABLE[i]},gexp:function(i){for(;i<0;)i+=255;for(;i>=256;)i-=255;return n.EXP_TABLE[i]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},t=0;t<8;t++)n.EXP_TABLE[t]=1<<t;for(var t=8;t<256;t++)n.EXP_TABLE[t]=n.EXP_TABLE[t-4]^n.EXP_TABLE[t-5]^n.EXP_TABLE[t-6]^n.EXP_TABLE[t-8];for(var t=0;t<255;t++)n.LOG_TABLE[n.EXP_TABLE[t]]=t;return tp=n,tp}var np,Jx;function Yb(){if(Jx)return np;Jx=1;var n=Kb();function t(i,a){if(i.length==null)throw new Error(i.length+"/"+a);for(var o=0;o<i.length&&i[o]==0;)o++;this.num=new Array(i.length-o+a);for(var u=0;u<i.length-o;u++)this.num[u]=i[u+o]}return t.prototype={get:function(i){return this.num[i]},getLength:function(){return this.num.length},multiply:function(i){for(var a=new Array(this.getLength()+i.getLength()-1),o=0;o<this.getLength();o++)for(var u=0;u<i.getLength();u++)a[o+u]^=n.gexp(n.glog(this.get(o))+n.glog(i.get(u)));return new t(a,0)},mod:function(i){if(this.getLength()-i.getLength()<0)return this;for(var a=n.glog(this.get(0))-n.glog(i.get(0)),o=new Array(this.getLength()),u=0;u<this.getLength();u++)o[u]=this.get(u);for(var u=0;u<i.getLength();u++)o[u]^=n.gexp(n.glog(i.get(u))+a);return new t(o,0).mod(i)}},np=t,np}var rp,Xx;function hk(){if(Xx)return rp;Xx=1;var n=Gb(),t=Yb(),i=Kb(),a={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(u){for(var d=u<<10;o.getBCHDigit(d)-o.getBCHDigit(o.G15)>=0;)d^=o.G15<<o.getBCHDigit(d)-o.getBCHDigit(o.G15);return(u<<10|d)^o.G15_MASK},getBCHTypeNumber:function(u){for(var d=u<<12;o.getBCHDigit(d)-o.getBCHDigit(o.G18)>=0;)d^=o.G18<<o.getBCHDigit(d)-o.getBCHDigit(o.G18);return u<<12|d},getBCHDigit:function(u){for(var d=0;u!=0;)d++,u>>>=1;return d},getPatternPosition:function(u){return o.PATTERN_POSITION_TABLE[u-1]},getMask:function(u,d,f){switch(u){case a.PATTERN000:return(d+f)%2==0;case a.PATTERN001:return d%2==0;case a.PATTERN010:return f%3==0;case a.PATTERN011:return(d+f)%3==0;case a.PATTERN100:return(Math.floor(d/2)+Math.floor(f/3))%2==0;case a.PATTERN101:return d*f%2+d*f%3==0;case a.PATTERN110:return(d*f%2+d*f%3)%2==0;case a.PATTERN111:return(d*f%3+(d+f)%2)%2==0;default:throw new Error("bad maskPattern:"+u)}},getErrorCorrectPolynomial:function(u){for(var d=new t([1],0),f=0;f<u;f++)d=d.multiply(new t([1,i.gexp(f)],0));return d},getLengthInBits:function(u,d){if(1<=d&&d<10)switch(u){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+u)}else if(d<27)switch(u){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+u)}else if(d<41)switch(u){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+u)}else throw new Error("type:"+d)},getLostPoint:function(u){for(var d=u.getModuleCount(),f=0,h=0;h<d;h++)for(var m=0;m<d;m++){for(var y=0,v=u.isDark(h,m),x=-1;x<=1;x++)if(!(h+x<0||d<=h+x))for(var S=-1;S<=1;S++)m+S<0||d<=m+S||x==0&&S==0||v==u.isDark(h+x,m+S)&&y++;y>5&&(f+=3+y-5)}for(var h=0;h<d-1;h++)for(var m=0;m<d-1;m++){var _=0;u.isDark(h,m)&&_++,u.isDark(h+1,m)&&_++,u.isDark(h,m+1)&&_++,u.isDark(h+1,m+1)&&_++,(_==0||_==4)&&(f+=3)}for(var h=0;h<d;h++)for(var m=0;m<d-6;m++)u.isDark(h,m)&&!u.isDark(h,m+1)&&u.isDark(h,m+2)&&u.isDark(h,m+3)&&u.isDark(h,m+4)&&!u.isDark(h,m+5)&&u.isDark(h,m+6)&&(f+=40);for(var m=0;m<d;m++)for(var h=0;h<d-6;h++)u.isDark(h,m)&&!u.isDark(h+1,m)&&u.isDark(h+2,m)&&u.isDark(h+3,m)&&u.isDark(h+4,m)&&!u.isDark(h+5,m)&&u.isDark(h+6,m)&&(f+=40);for(var N=0,m=0;m<d;m++)for(var h=0;h<d;h++)u.isDark(h,m)&&N++;var w=Math.abs(100*N/d/d-50)/5;return f+=w*10,f}};return rp=o,rp}var sp,Zx;function fk(){if(Zx)return sp;Zx=1;var n=ck(),t=uk(),i=dk(),a=hk(),o=Yb();function u(f,h){this.typeNumber=f,this.errorCorrectLevel=h,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var d=u.prototype;return d.addData=function(f){var h=new n(f);this.dataList.push(h),this.dataCache=null},d.isDark=function(f,h){if(f<0||this.moduleCount<=f||h<0||this.moduleCount<=h)throw new Error(f+","+h);return this.modules[f][h]},d.getModuleCount=function(){return this.moduleCount},d.make=function(){if(this.typeNumber<1){var f=1;for(f=1;f<40;f++){for(var h=t.getRSBlocks(f,this.errorCorrectLevel),m=new i,y=0,v=0;v<h.length;v++)y+=h[v].dataCount;for(var v=0;v<this.dataList.length;v++){var x=this.dataList[v];m.put(x.mode,4),m.put(x.getLength(),a.getLengthInBits(x.mode,f)),x.write(m)}if(m.getLengthInBits()<=y*8)break}this.typeNumber=f}this.makeImpl(!1,this.getBestMaskPattern())},d.makeImpl=function(f,h){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var m=0;m<this.moduleCount;m++){this.modules[m]=new Array(this.moduleCount);for(var y=0;y<this.moduleCount;y++)this.modules[m][y]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(f,h),this.typeNumber>=7&&this.setupTypeNumber(f),this.dataCache==null&&(this.dataCache=u.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,h)},d.setupPositionProbePattern=function(f,h){for(var m=-1;m<=7;m++)if(!(f+m<=-1||this.moduleCount<=f+m))for(var y=-1;y<=7;y++)h+y<=-1||this.moduleCount<=h+y||(0<=m&&m<=6&&(y==0||y==6)||0<=y&&y<=6&&(m==0||m==6)||2<=m&&m<=4&&2<=y&&y<=4?this.modules[f+m][h+y]=!0:this.modules[f+m][h+y]=!1)},d.getBestMaskPattern=function(){for(var f=0,h=0,m=0;m<8;m++){this.makeImpl(!0,m);var y=a.getLostPoint(this);(m==0||f>y)&&(f=y,h=m)}return h},d.createMovieClip=function(f,h,m){var y=f.createEmptyMovieClip(h,m),v=1;this.make();for(var x=0;x<this.modules.length;x++)for(var S=x*v,_=0;_<this.modules[x].length;_++){var N=_*v,w=this.modules[x][_];w&&(y.beginFill(0,100),y.moveTo(N,S),y.lineTo(N+v,S),y.lineTo(N+v,S+v),y.lineTo(N,S+v),y.endFill())}return y},d.setupTimingPattern=function(){for(var f=8;f<this.moduleCount-8;f++)this.modules[f][6]==null&&(this.modules[f][6]=f%2==0);for(var h=8;h<this.moduleCount-8;h++)this.modules[6][h]==null&&(this.modules[6][h]=h%2==0)},d.setupPositionAdjustPattern=function(){for(var f=a.getPatternPosition(this.typeNumber),h=0;h<f.length;h++)for(var m=0;m<f.length;m++){var y=f[h],v=f[m];if(this.modules[y][v]==null)for(var x=-2;x<=2;x++)for(var S=-2;S<=2;S++)x==-2||x==2||S==-2||S==2||x==0&&S==0?this.modules[y+x][v+S]=!0:this.modules[y+x][v+S]=!1}},d.setupTypeNumber=function(f){for(var h=a.getBCHTypeNumber(this.typeNumber),m=0;m<18;m++){var y=!f&&(h>>m&1)==1;this.modules[Math.floor(m/3)][m%3+this.moduleCount-8-3]=y}for(var m=0;m<18;m++){var y=!f&&(h>>m&1)==1;this.modules[m%3+this.moduleCount-8-3][Math.floor(m/3)]=y}},d.setupTypeInfo=function(f,h){for(var m=this.errorCorrectLevel<<3|h,y=a.getBCHTypeInfo(m),v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<6?this.modules[v][8]=x:v<8?this.modules[v+1][8]=x:this.modules[this.moduleCount-15+v][8]=x}for(var v=0;v<15;v++){var x=!f&&(y>>v&1)==1;v<8?this.modules[8][this.moduleCount-v-1]=x:v<9?this.modules[8][15-v-1+1]=x:this.modules[8][15-v-1]=x}this.modules[this.moduleCount-8][8]=!f},d.mapData=function(f,h){for(var m=-1,y=this.moduleCount-1,v=7,x=0,S=this.moduleCount-1;S>0;S-=2)for(S==6&&S--;;){for(var _=0;_<2;_++)if(this.modules[y][S-_]==null){var N=!1;x<f.length&&(N=(f[x]>>>v&1)==1);var w=a.getMask(h,y,S-_);w&&(N=!N),this.modules[y][S-_]=N,v--,v==-1&&(x++,v=7)}if(y+=m,y<0||this.moduleCount<=y){y-=m,m=-m;break}}},u.PAD0=236,u.PAD1=17,u.createData=function(f,h,m){for(var y=t.getRSBlocks(f,h),v=new i,x=0;x<m.length;x++){var S=m[x];v.put(S.mode,4),v.put(S.getLength(),a.getLengthInBits(S.mode,f)),S.write(v)}for(var _=0,x=0;x<y.length;x++)_+=y[x].dataCount;if(v.getLengthInBits()>_*8)throw new Error("code length overflow. ("+v.getLengthInBits()+">"+_*8+")");for(v.getLengthInBits()+4<=_*8&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=_*8||(v.put(u.PAD0,8),v.getLengthInBits()>=_*8));)v.put(u.PAD1,8);return u.createBytes(v,y)},u.createBytes=function(f,h){for(var m=0,y=0,v=0,x=new Array(h.length),S=new Array(h.length),_=0;_<h.length;_++){var N=h[_].dataCount,w=h[_].totalCount-N;y=Math.max(y,N),v=Math.max(v,w),x[_]=new Array(N);for(var C=0;C<x[_].length;C++)x[_][C]=255&f.buffer[C+m];m+=N;var D=a.getErrorCorrectPolynomial(w),z=new o(x[_],D.getLength()-1),T=z.mod(D);S[_]=new Array(D.getLength()-1);for(var C=0;C<S[_].length;C++){var U=C+T.getLength()-S[_].length;S[_][C]=U>=0?T.get(U):0}}for(var E=0,C=0;C<h.length;C++)E+=h[C].totalCount;for(var R=new Array(E),A=0,C=0;C<y;C++)for(var _=0;_<h.length;_++)C<x[_].length&&(R[A++]=x[_][C]);for(var C=0;C<v;C++)for(var _=0;_<h.length;_++)C<S[_].length&&(R[A++]=S[_][C]);return R},sp=u,sp}var Ru={},e0;function pk(){if(e0)return Ru;e0=1,Object.defineProperty(Ru,"__esModule",{value:!0});var n=Object.assign||function(m){for(var y=1;y<arguments.length;y++){var v=arguments[y];for(var x in v)Object.prototype.hasOwnProperty.call(v,x)&&(m[x]=v[x])}return m},t=Hb(),i=u(t),a=nc(),o=u(a);function u(m){return m&&m.__esModule?m:{default:m}}function d(m,y){var v={};for(var x in m)y.indexOf(x)>=0||Object.prototype.hasOwnProperty.call(m,x)&&(v[x]=m[x]);return v}var f={bgColor:i.default.oneOfType([i.default.object,i.default.string]).isRequired,bgD:i.default.string.isRequired,fgColor:i.default.oneOfType([i.default.object,i.default.string]).isRequired,fgD:i.default.string.isRequired,size:i.default.number.isRequired,title:i.default.string,viewBoxSize:i.default.number.isRequired,xmlns:i.default.string},h=(0,a.forwardRef)(function(m,y){var v=m.bgColor,x=m.bgD,S=m.fgD,_=m.fgColor,N=m.size,w=m.title,C=m.viewBoxSize,D=m.xmlns,z=D===void 0?"http://www.w3.org/2000/svg":D,T=d(m,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return o.default.createElement("svg",n({},T,{height:N,ref:y,viewBox:"0 0 "+C+" "+C,width:N,xmlns:z}),w?o.default.createElement("title",null,w):null,o.default.createElement("path",{d:x,fill:v}),o.default.createElement("path",{d:S,fill:_}))});return h.displayName="QRCodeSvg",h.propTypes=f,Ru.default=h,Ru}var t0;function mk(){if(t0)return ll;t0=1,Object.defineProperty(ll,"__esModule",{value:!0}),ll.QRCode=void 0;var n=Object.assign||function(N){for(var w=1;w<arguments.length;w++){var C=arguments[w];for(var D in C)Object.prototype.hasOwnProperty.call(C,D)&&(N[D]=C[D])}return N},t=Hb(),i=v(t),a=Vb(),o=v(a),u=fk(),d=v(u),f=nc(),h=v(f),m=pk(),y=v(m);function v(N){return N&&N.__esModule?N:{default:N}}function x(N,w){var C={};for(var D in N)w.indexOf(D)>=0||Object.prototype.hasOwnProperty.call(N,D)&&(C[D]=N[D]);return C}var S={bgColor:i.default.oneOfType([i.default.object,i.default.string]),fgColor:i.default.oneOfType([i.default.object,i.default.string]),level:i.default.string,size:i.default.number,value:i.default.string.isRequired},_=(0,f.forwardRef)(function(N,w){var C=N.bgColor,D=C===void 0?"#FFFFFF":C,z=N.fgColor,T=z===void 0?"#000000":z,U=N.level,E=U===void 0?"L":U,R=N.size,A=R===void 0?256:R,O=N.value,V=x(N,["bgColor","fgColor","level","size","value"]),P=new d.default(-1,o.default[E]);P.addData(O),P.make();var F=P.modules;return h.default.createElement(y.default,n({},V,{bgColor:D,bgD:F.map(function(Q,$){return Q.map(function(I,k){return I?"":"M "+k+" "+$+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:T,fgD:F.map(function(Q,$){return Q.map(function(I,k){return I?"M "+k+" "+$+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:w,size:A,viewBoxSize:F.length}))});return ll.QRCode=_,_.displayName="QRCode",_.propTypes=S,ll.default=_,ll}var gk=mk();const n0=N0(gk),r0=n=>{if(!n)return"";const t=new Date(n);return`${t.getFullYear()}/${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}`},yk=n=>{if(n==null)return NaN;if(typeof n=="number")return Number.isFinite(n)?n:NaN;const t=String(n).trim().replace(/[,\s]/g,"");if(!t)return NaN;const i=parseFloat(t);return Number.isFinite(i)?i:NaN},vs=(n,{maximumFractionDigits:t=1}={})=>{const i=yk(n);return Number.isFinite(i)?`${i.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:t})}`:null},vk=new Set(["food","alcohol","soft_drink","supplies"]),Wb=new Set(["alcohol","supplies"]),Qb=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":vk.has(t)?t:"":""},Tp=n=>{const t=Qb(n?.itemCategory??n?.item_category);return t?Wb.has(t):!!n?.isAlcohol},aa=n=>Tp(n)?1.1:1.08,s0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),xk=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=s0(t);if(!a)return null;for(const[o,u]of n.entries())if(s0(o)===a)return u;return null},Vs=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},bk=n=>{const t=Vs(n);return!Number.isFinite(t)||t<=0||t>100?100:t},wk=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return bk(i)/100},Sk=(n,t,i)=>{const a=Vs(n),o=Vs(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:["kg","","l",""].includes(u)?a/o:["cl",""].includes(u)?a/o*100:a/o},i0=(n,t,i,{defaultWeightWhenUnitEmpty:a=!1,forceWeightBased:o=!1,yieldRate:u=1}={})=>{const d=Vs(n),f=Vs(t);if(!Number.isFinite(d)||!Number.isFinite(f))return NaN;const h=Number.isFinite(u)&&u>0?u:1,m=String(i||"").trim().toLowerCase();return o||!m&&a||["g","","ml","","cc",""].includes(m)?d/1e3*f/h:["cl",""].includes(m)?d*10/1e3*f/h:d*f/h},jk=(n,t)=>{const i=Vs(n?.purchaseCost),a=Vs(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},_k=2,gl=Object.freeze({course:"",category:"",storeName:"",servings:"",ingredients:"",ingredientName:"",quantity:"",quantityGram:" (g)",unit:"",purchase:"",cost:"",totalCost:"",instructions:"",sourceRecipe:"",flourGroup:"",otherIngredients:"",scaleMultiplier:"",noSteps:"",print:"",close:""}),a0=Object.keys(gl),Ck=({recipe:n,ownerLabel:t,onBack:i,onEdit:a,onDelete:o,onHardDelete:u,isDeleted:d,onView:f,onDuplicate:h,backLabel:m,onList:y})=>{const{user:v}=fs(),x=Ui(),[S,_]=je.useState(!1),[N,w]=je.useState(!1),[C,D]=je.useState(!1),[z,T]=je.useState(new Set),[U,E]=je.useState(new Set),[R,A]=je.useState(new Set),[O,V]=je.useState({}),[P,F]=je.useState("ORIGINAL"),[Q,$]=je.useState(!1),[I,k]=je.useState(!0),[L,H]=je.useState(!1),[G,ce]=je.useState(new Map),[q,W]=je.useState({}),[ie,ve]=je.useState(""),[xe,Ne]=je.useState(1),[de,K]=je.useState(""),[ge,Ae]=je.useState(""),ae=je.useMemo(()=>{const J=parseFloat(xe);return isNaN(J)?1:J},[xe]),Se=(J,Z)=>{if(!J)return"";const oe=parseFloat(J);if(isNaN(oe))return J;const fe=oe*parseFloat(Z);return Number.isInteger(fe)?fe.toString():fe.toFixed(1).replace(/\.0$/,"")},Re=(J,Z)=>{if(!J)return"";const oe=parseFloat(J);return isNaN(oe)?J:(oe*parseFloat(Z)).toFixed(2).replace(/\.00$/,"")},[Oe,He]=je.useState(n),[nt,ot]=je.useState(!1),Fe=Oe||n,Ce=P==="ORIGINAL"?Oe:O[P]||Oe,Ee=P==="ORIGINAL"||P==="JA"?gl:q[P]||gl,se=J=>Ee[J]||gl[J]||J;je.useEffect(()=>{let J=!0;return Un.getAllConversions().then(Z=>{J&&ce(Z)}).catch(()=>{J&&ce(new Map)}),()=>{J=!1}},[]);const Pe=je.useMemo(()=>{const J=(Z,oe={})=>{if(!Z||typeof Z!="object")return Z;const fe=xk(G,Z.name),Le=Qb(Z.itemCategory??Z.item_category??fe?.itemCategory),qe=wk(Z,fe);let Ze=Z;if(Le&&(Ze={...Ze,itemCategory:Le,isAlcohol:Wb.has(Le)}),!fe||!fe.packetSize){const rt=String(Z.unit||"").trim();if(oe.forceWeightBased||oe.defaultWeightWhenUnitEmpty&&!rt){const Xt=i0(Z.quantity,Ze.purchaseCost,Z.unit,{...oe,yieldRate:qe}),dn=Number.isFinite(Xt)?Math.round(Xt*100)/100:NaN,Wn=Vs(Ze.cost);if(Number.isFinite(dn)&&(!Number.isFinite(Wn)||Math.abs(Wn-dn)>.01))return{...Ze,cost:dn}}return Ze}const Ct=[fe.lastPrice,Z.purchaseCostRef,Z.purchase_cost,Z.purchaseCost].find(rt=>Number.isFinite(Vs(rt))),Nt=Sk(Ct,fe.packetSize,fe.packetUnit);if(!Number.isFinite(Nt)||!jk(Z,Nt))return Ze;const It=i0(Z.quantity,Nt,Z.unit,{...oe,yieldRate:qe});return{...Ze,purchaseCost:Math.round(Nt*100)/100,cost:Number.isFinite(It)?Math.round(It*100)/100:Ze.cost}};return{...Ce,ingredients:(Ce.ingredients||[]).map(Z=>J(Z)),flours:(Ce.flours||[]).map(Z=>J(Z,{forceWeightBased:!0})),breadIngredients:(Ce.breadIngredients||[]).map(Z=>J(Z,{forceWeightBased:!0}))}},[G,Ce]);je.useEffect(()=>{He(n),!n.steps&&!d&&(ot(!0),bn.getRecipe(n.id).then(J=>{He(J)}).catch(J=>{console.error("Failed to load details",J)}).finally(()=>{ot(!1)}))},[n,d]);const[dt,gt]=je.useState(n.tags?.includes("public")||!1),ct=v?.role==="admin"||n.tags&&n.tags.includes(`owner:${v?.id}`)||v?.displayId&&n.tags&&n.tags.includes(`owner:${v.displayId}`),it=!(n.tags&&n.tags.some(J=>J.startsWith("owner:")))||ct,tt=async()=>{const J=!dt;try{const Z=n.tags||[];let oe;J?oe=[...Z,"public"]:oe=Z.filter(fe=>fe!=="public"),gt(J),await bn.updateRecipe({id:n.id,tags:oe})}catch(Z){console.error("Failed to toggle public",Z),x.error(""),gt(!J)}},ut=(J,Z,oe=!1)=>P==="ORIGINAL"||!I||!Z||J===Z?J:r.jsxs(r.Fragment,{children:[J,oe?r.jsx("br",{}):" ",r.jsxs("span",{className:"original-text-sub",style:{opacity:.6,fontSize:"0.85em",fontWeight:"normal"},children:["(",Z,")"]})]}),qt=(J,Z)=>{const oe=String(J??"").trim(),fe=String(Z??"").trim();return P==="ORIGINAL"||!I||!fe||oe===fe?oe||fe:`${oe}${fe}`},$t=J=>!J||!Array.isArray(J.steps)?!1:J.type==="bread"?Array.isArray(J.flours)&&Array.isArray(J.breadIngredients):Array.isArray(J.ingredients),an=(J,Z)=>!J||!Z||J.__translationVersion!==_k||Array.isArray(Z.steps)&&!Array.isArray(J.steps)?!1:Z.type==="bread"?!((Z.flours||[]).length>0&&(J.flours||[]).length===0||(Z.breadIngredients||[]).length>0&&(J.breadIngredients||[]).length===0):!((Z.ingredients||[]).length>0&&(J.ingredients||[]).length===0),Ht=async J=>{const Z=J.target.value;if(F(Z),Z==="ORIGINAL")return;let oe=Oe||n;if(!d&&n?.id&&!$t(oe))try{ot(!0);const qe=await bn.getRecipe(n.id);qe&&(oe=qe,He(qe))}catch(qe){console.error("Failed to load full recipe for translation",qe)}finally{ot(!1)}const fe=O[Z]&&an(O[Z],oe),Le=Z!=="JA"&&!q[Z];if(!(fe&&!Le)){$(!0);try{let qe=null;if(await Promise.all([(async()=>{if(!fe)try{const Ze=await $x.translateRecipe(oe,Z);V(Xe=>({...Xe,[Z]:Ze}))}catch(Ze){qe=Ze}})(),(async()=>{if(Le)try{const Ze=await $x.translateList(a0.map(Ct=>gl[Ct]),Z),Xe=a0.reduce((Ct,Nt,It)=>(Ct[Nt]=Ze[It]||gl[Nt],Ct),{});W(Ct=>({...Ct,[Z]:Xe}))}catch(Ze){console.error("Failed to translate UI labels",Ze)}})()]),qe)throw qe}catch(qe){console.error(qe),x.error(""),F("ORIGINAL")}finally{$(!1)}}},rn=J=>{T(Z=>{const oe=new Set(Z);return oe.has(J)?oe.delete(J):oe.add(J),oe})},sn=J=>{E(Z=>{const oe=new Set(Z);return oe.has(J)?oe.delete(J):oe.add(J),oe})},Kt=J=>{A(Z=>{const oe=new Set(Z);return oe.has(J)?oe.delete(J):oe.add(J),oe})};je.useEffect(()=>{window.scrollTo(0,0),f&&n&&!d&&f(n.id);const J=document.title;return n&&n.title&&(document.title=n.title),V({}),F("ORIGINAL"),T(new Set),E(new Set),A(new Set),gt(n.tags?.includes("public")||!1),()=>{document.title=J}},[n.id,n.title]),je.useEffect(()=>{n&&n.servings?Ae(n.servings.toString()):Ae(""),K("")},[n]);const In=()=>{_(!0)},mn=()=>{_(!1),o(n)},ee=()=>{_(!1)},De=()=>{D(!0)},ke=()=>{D(!1),u(n)},Ie=()=>{D(!1)},Ve=()=>{w(!0)},lt=async()=>{w(!1);try{const J=await bn.duplicateRecipe(n,v);h&&h(J)}catch(J){console.error("Duplication failed",J),x.error("")}},bt=()=>{w(!1)},Lt=je.useRef(null),Pt=je.useRef(null),hn=J=>{Pt.current=null,Lt.current=J.targetTouches[0].clientX},he=J=>{Pt.current=J.targetTouches[0].clientX},Ye=()=>{if(!Lt.current||!Pt.current)return;const J=Lt.current-Pt.current,Z=Lt.current<50,oe=J<-100;Z&&oe&&i()},ht=J=>{const Z=Math.round(parseFloat(J)),oe=parseFloat(de),fe=parseFloat(ge);let Le=null,qe=null,Ze=null;return!isNaN(Z)&&!isNaN(fe)&&fe>0&&(Ze=Z/fe),!isNaN(Z)&&!isNaN(oe)&&!isNaN(fe)&&oe>0&&fe>0&&(qe=oe*fe,Le=Z/qe*100),r.jsxs("div",{className:"profit-calculator screen-only",style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef"},children:[r.jsxs("h4",{style:{margin:"0 0 0.8rem 0",fontSize:"1rem",color:"#555",borderBottom:"1px solid #ddd",paddingBottom:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{children:["  ",r.jsx("small",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"()"})]}),r.jsx("span",{style:{fontSize:"0.7em",fontWeight:"normal"},children:"(8% or 10%)"})]}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[r.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" (1/1)"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("span",{style:{position:"absolute",left:"8px",top:"50%",transform:"translateY(-50%)",color:"#888"},children:""}),r.jsx("input",{type:"number",value:de,onChange:Xe=>K(Xe.target.value),placeholder:"0",style:{padding:"6px 6px 6px 20px",width:"100px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[r.jsx("label",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#666"},children:" ()"}),r.jsx("input",{type:"number",value:ge,onChange:Xe=>Ae(Xe.target.value),placeholder:"0",style:{padding:"6px",width:"60px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem",textAlign:"center"}})]}),Ze!==null&&r.jsxs("div",{style:{marginLeft:"auto",padding:"8px 12px",background:Le!==null?Le>40?"#ffebee":"#e8f5e9":"#eef3ff",borderRadius:"6px",border:`1px solid ${Le!==null?Le>40?"#ffcdd2":"#c8e6c9":"#d6e3ff"}`,textAlign:"right"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:Le!==null?"6px":"0"},children:["1(): ",r.jsxs("strong",{children:["",Ze.toLocaleString(void 0,{maximumFractionDigits:2})]})]}),Le!==null&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:[": ",qe.toLocaleString()]}),r.jsxs("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px",fontWeight:"bold"},children:[": ",(qe-Z).toLocaleString()]}),r.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:Le>40?"#d32f2f":"#2e7d32"},children:[": ",Le.toFixed(1),"%"]})]})]})]})]})},We=Pe.ingredients||[];let At=Ce.steps||[];const jt=J=>String(J||"").trim().toLowerCase(),Dt=J=>{const Z=jt(J);return Z?["","","steps","method"].some(oe=>Z===oe||Z.includes(oe)):!1};if(!At.length&&Ce.ingredientGroups){const J=Ce.ingredientGroups.find(Z=>Dt(Z.name));if(J)At=We.filter(oe=>oe.groupId===J.id).map(oe=>typeof oe=="string"?oe:{...oe,text:oe.name||oe.text||""});else{const Z=We.filter(oe=>Dt(oe.group)||Dt(oe.groupName));Z.length&&(At=Z.map(oe=>typeof oe=="string"?oe:{...oe,text:oe.name||oe.text||""}))}}const Vt=At,pt=je.useMemo(()=>{const J=Ce.ingredientGroups||[],Z=["","steps","method",""],oe=Xe=>String(Xe||"").trim().toLowerCase(),fe=new Set(J.filter(Xe=>Z.includes(oe(Xe.name))).map(Xe=>Xe.id)),Le=J.filter(Xe=>!fe.has(Xe.id));if(!Le.length)return[{id:"default",name:null,items:We.filter(Xe=>!fe.has(Xe.groupId))}];const qe=Le.map(Xe=>{const Ct=We.filter(Nt=>Nt.groupId===Xe.id);return{id:Xe.id,name:Xe.name===""?null:Xe.name,items:Ct}}).filter(Xe=>Xe.items.length>0),Ze=We.filter(Xe=>Xe.groupId?fe.has(Xe.groupId)?!1:!Le.some(Ct=>Ct.id===Xe.groupId):!0);return Ze.length&&qe.push({id:"ungrouped",name:null,items:Ze}),qe.length?qe:[{id:"default",name:null,items:We.filter(Xe=>!fe.has(Xe.groupId))}]},[Ce.ingredientGroups,We]),te=je.useMemo(()=>{if(Ce.type!=="bread")return null;const J=Pe.flours||[],Z=Pe.breadIngredients||[],oe=J.reduce((rt,kt)=>rt+(parseFloat(kt.quantity)||0),0),fe=oe+Z.reduce((rt,kt)=>rt+(parseFloat(kt.quantity)||0),0),Le=parseFloat(ie),qe=Le&&fe?Le/fe:1,Ze=rt=>oe?((parseFloat(rt)||0)/oe*100).toFixed(1):"0.0",Xe=rt=>Le?((parseFloat(rt)||0)*qe).toFixed(1):rt,Ct=rt=>{const kt=parseFloat(rt)||0;if(!Le)return kt;const Xt=kt*qe;return Math.round(Xt*100)/100},Nt=rt=>{const kt=Ct(rt);return Number.isFinite(kt)?kt.toLocaleString(void 0,{maximumFractionDigits:2}):""},It=rt=>rt.reduce((kt,Xt)=>{const Wn=(parseFloat(Xt.cost)||0)*(Le?qe:1),Sr=aa(Xt);return kt+Wn*Sr},0);return{flours:J,others:Z,totalFlour:oe,grandTotal:fe,calcPercent:Ze,getScaledQtyValue:Xe,getScaledCostValue:Ct,formatCostValue:Nt,scaleFactor:qe,totalTaxIncluded:It(J)+It(Z)}},[Pe.breadIngredients,Pe.flours,Ce.type,ie]),$e=je.useMemo(()=>Ce.type==="bread"?0:We.reduce((J,Z)=>{const fe=(parseFloat(Z.cost)||0)*ae,Le=aa(Z);return J+fe*Le},0),[Ce.type,We,ae]),Ge=Ce.type==="bread"?te?Math.round(te.totalTaxIncluded).toLocaleString():"0":Math.round($e).toLocaleString(),Et=Ce.description||Fe.description;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"recipe-detail fade-in",onTouchStart:hn,onTouchMove:he,onTouchEnd:Ye,children:[N&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(un,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-primary)"},children:""}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(le,{variant:"ghost",onClick:bt,children:""}),r.jsx(le,{variant:"primary",onClick:lt,children:""})]})]})}),C&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(un,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:" "}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(le,{variant:"ghost",onClick:Ie,children:""}),r.jsx(le,{variant:"danger",onClick:ke,children:""})]})]})}),S&&r.jsx("div",{className:"modal-overlay fade-in",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(un,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",color:"#333"},children:[r.jsx("h3",{style:{marginTop:0,color:"var(--color-danger)"},children:""}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("small",{style:{color:"#666"},children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(le,{variant:"ghost",onClick:ee,children:""}),r.jsx(le,{variant:"danger",onClick:mn,children:""})]})]})}),r.jsxs("div",{className:"recipe-detail__header",children:[r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx(le,{variant:"secondary",onClick:i,size:"sm",children:m||" "}),y&&r.jsx(le,{variant:"secondary",onClick:y,size:"sm",children:""})]}),!d&&r.jsxs("div",{className:"recipe-detail__actions",children:[it&&(v?.displayId==="yoshito"||v?.role==="admin")&&r.jsx("div",{style:{marginRight:"1rem",display:"flex",alignItems:"center",gap:"8px"},children:r.jsxs("label",{className:"switch",style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:dt,onChange:tt,style:{accentColor:"#4CAF50",transform:"scale(1.2)"}}),r.jsx("span",{style:{marginLeft:"4px",fontSize:"0.9rem",fontWeight:"bold",color:dt?"#4CAF50":"#888"},children:dt?"":""})]})}),!it&&r.jsx("span",{style:{padding:"4px 8px",backgroundColor:"#e0e0e0",color:"#555",borderRadius:"4px",fontSize:"0.85rem",marginRight:"0.5rem"},children:"  ()"}),r.jsxs("select",{className:"language-select",value:P,onChange:Ht,disabled:Q,style:{padding:"0.4rem",borderRadius:"4px",border:"1px solid #ccc",marginRight:"0.5rem",cursor:"pointer"},children:[r.jsx("option",{value:"ORIGINAL",children:" Original ()"}),ak.map(J=>r.jsx("option",{value:J.code,children:J.label},J.code))]}),P!=="ORIGINAL"&&r.jsxs("label",{style:{display:"flex",alignItems:"center",marginRight:"0.5rem",cursor:"pointer",fontSize:"0.9rem",userSelect:"none"},children:[r.jsx("input",{type:"checkbox",checked:I,onChange:J=>k(J.target.checked),style:{marginRight:"4px"}}),""]}),r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>H(!0),children:" "}),r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>window.print(),children:" "}),r.jsx(le,{variant:"secondary",size:"sm",onClick:Ve,children:""}),it&&r.jsxs(r.Fragment,{children:[r.jsx(le,{variant:"secondary",size:"sm",onClick:a,children:""}),r.jsx(le,{variant:"danger",size:"sm",onClick:In,style:{marginLeft:"0.5rem"},children:""})]})]}),d&&r.jsxs("div",{className:"recipe-detail__actions",children:[r.jsx(le,{variant:"ghost",size:"sm",onClick:De,style:{color:"var(--color-danger)",marginRight:"auto"},children:""}),r.jsx(le,{variant:"primary",size:"sm",onClick:()=>o(n,!0),children:""})]})]}),r.jsx("div",{className:"recipe-detail__hero",children:Ce.image?r.jsx("img",{src:Ce.image,alt:Ce.title,className:"recipe-detail__image"}):r.jsx("div",{className:"recipe-detail__image-placeholder",style:{height:"100%",backgroundColor:"#eee",display:"flex",alignItems:"center",justifyContent:"center",color:"#888"},children:""})}),r.jsxs("div",{className:"recipe-detail__title-card glass-panel",children:[r.jsx("h1",{children:ut(Ce.title,Fe.title)}),r.jsx("p",{className:"recipe-detail__desc",children:ut(Ce.description,Fe.description,!0)}),v?.role==="admin"&&t&&r.jsxs("div",{className:"recipe-detail__owner",children:[" : ",t]}),r.jsxs("div",{className:"recipe-detail__meta",children:[Ce.course&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:se("course")}),r.jsx("span",{className:"meta-value",children:ut(Ce.course,Fe.course)})]}),Ce.category&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:se("category")}),r.jsx("span",{className:"meta-value",children:ut(Ce.category,Fe.category)})]}),Ce.storeName&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:se("storeName")}),r.jsx("span",{className:"meta-value",children:ut(Ce.storeName,Fe.storeName)})]}),r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:se("servings")}),r.jsxs("span",{className:"meta-value",children:[Ce.servings,""]})]})]}),Ce.sourceUrl&&r.jsxs("div",{className:"print-qr-container",style:{marginTop:"0.8rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[r.jsx("div",{style:{fontSize:"0.85rem"},children:r.jsxs("a",{href:Ce.sourceUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--color-primary)",textDecoration:"underline",display:"flex",alignItems:"center",gap:"4px"},children:[" ",r.jsx("span",{className:"screen-only",children:se("sourceRecipe")}),r.jsx("span",{className:"print-only",children:se("sourceRecipe")})]})}),r.jsx("div",{style:{background:"white",padding:"4px",width:"fit-content"},children:r.jsx(n0,{value:Ce.sourceUrl,size:128,style:{display:"block"}})})]})]}),r.jsxs("div",{className:"recipe-detail-dates",style:{marginTop:"0.5rem",marginBottom:"1.5rem",borderTop:"none",paddingRight:"0.5rem"},children:[r.jsxs("span",{children:[" : ",r0(n.created_at)]}),n.updated_at&&r.jsxs("span",{children:[" : ",r0(n.updated_at)]})]}),r.jsx("div",{className:"recipe-detail__content",children:r.jsxs("div",{className:"recipe-detail__main",children:[r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:se("ingredients")}),r.jsx(un,{className:"ingredients-card",children:Ce.type==="bread"?r.jsx("div",{className:"bread-detail-view",children:(()=>{const J=Pe.flours||[],Z=Pe.breadIngredients||[],oe=J.reduce((rt,kt)=>rt+(parseFloat(kt.quantity)||0),0),fe=oe+Z.reduce((rt,kt)=>rt+(parseFloat(kt.quantity)||0),0),Le=oe?(fe/oe*100).toFixed(1):"0.0",qe=rt=>oe?((parseFloat(rt)||0)/oe*100).toFixed(1):"0.0",Ze=parseFloat(ie),Xe=Ze&&fe?Ze/fe:1,Ct=rt=>Ze?((parseFloat(rt)||0)*Xe).toFixed(1):rt,Nt=rt=>{const kt=parseFloat(rt)||0;if(!Ze)return kt;const Xt=kt*Xe;return Math.round(Xt*100)/100},It=rt=>Number.isFinite(rt)?rt.toLocaleString(void 0,{maximumFractionDigits:2}):"-";return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"screen-only",style:{background:"#f1f3f5",padding:"0.4rem 0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem 1rem",flexWrap:"wrap",border:"1px solid #dee2e6",lineHeight:1.2},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),r.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000"},children:[fe.toLocaleString(),"g"]}),r.jsxs("span",{style:{fontSize:"0.75rem",color:"#444"},children:["(",Le,"%)"]})]}),r.jsx("div",{style:{height:"16px",width:"1px",background:"#adb5bd"}}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx("label",{htmlFor:"target-total-input",style:{fontSize:"0.8rem",fontWeight:"bold",color:"#000"},children:":"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("input",{id:"target-total-input",type:"number",value:ie,onChange:rt=>ve(rt.target.value),placeholder:"1000",style:{padding:"2px 20px 2px 6px",width:"80px",borderRadius:"4px",border:"1.5px solid #333",fontSize:"0.9rem",fontWeight:"bold",textAlign:"right",color:"#000",backgroundColor:"#fff"}}),r.jsx("span",{style:{position:"absolute",right:"4px",top:"50%",transform:"translateY(-50%)",fontSize:"0.75rem",color:"#333"},children:"g"})]}),ie&&r.jsx(le,{variant:"ghost",size:"sm",onClick:()=>ve(""),style:{padding:"0 4px",fontSize:"0.7rem",color:"#555",height:"22px",border:"1px solid #dee2e6"},children:""})]}),ie&&r.jsxs("div",{style:{fontSize:"0.75rem",color:"#000",fontWeight:"bold",marginLeft:"auto"},children:[" : ",Xe.toFixed(3)," "]})]}),r.jsxs("div",{className:"bread-section",style:{marginBottom:"2rem"},children:[r.jsxs("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px",marginBottom:"1rem",marginTop:0,display:"flex",justifyContent:"space-between",alignItems:"center",color:"var(--color-text-main)"},children:[r.jsx("span",{children:se("flourGroup")}),r.jsxs("span",{style:{fontSize:"0.9rem",background:"var(--color-primary)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:["Total: ",ie?Ct(oe):oe,"g (100%)"]})]}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:se("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:se("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:se("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:se("cost")})]})}),r.jsx("tbody",{children:J.map((rt,kt)=>{const Xt=Fe.flours?.[kt]||{};return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`flour-${kt}`}),r.jsx("label",{htmlFor:`flour-${kt}`,children:ut(rt.name,Xt?.name)})]})}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:ie?r.jsx("span",{style:{color:"var(--color-primary)"},children:Ct(rt.quantity)}):rt.quantity}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-primary)"},children:[qe(rt.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(rt.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:rt.cost?`${It(Nt(rt.cost))}`:"-"})]},kt)})})]})]}),r.jsxs("div",{className:"bread-section",style:{marginTop:"3rem"},children:[r.jsx("h3",{style:{fontSize:"1.2rem",borderLeft:"4px solid #f39c12",paddingLeft:"10px",marginBottom:"1rem",color:"var(--color-text-main)"},children:se("otherIngredients")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:se("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:se("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:se("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:se("cost")})]})}),r.jsx("tbody",{children:Z.map((rt,kt)=>{const Xt=Fe.breadIngredients?.[kt]||{};return r.jsxs("tr",{children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ingredient-${kt}`}),r.jsx("label",{htmlFor:`ingredient-${kt}`,children:ut(rt.name,Xt?.name)})]})}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:ie?r.jsx("span",{style:{color:"var(--color-primary)"},children:Ct(rt.quantity)}):rt.quantity}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"var(--color-text-muted)"},children:[qe(rt.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(rt.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:rt.cost?`${It(Nt(rt.cost))}`:"-"})]},kt)})})]}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[se("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",(()=>{const rt=Xt=>Xt.reduce((dn,Wn)=>{const Sr=parseFloat(Wn.cost)||0,Jr=aa(Wn),Mr=Sr*Xe;return dn+Mr*Jr},0),kt=rt(J)+rt(Z);return Math.round(kt).toLocaleString()})()]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]}),(()=>{const rt=Xt=>Xt.reduce((dn,Wn)=>{const Sr=parseFloat(Wn.cost)||0,Jr=aa(Wn),Mr=Sr*Xe;return dn+Mr*Jr},0),kt=rt(J)+rt(Z);return ht(kt)})()]})]})})()}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"screen-only no-print",style:{background:"#f8f9fa",color:"#333",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"1rem",border:"1px solid #e9ecef"},children:[r.jsxs("label",{htmlFor:"multiplier-input",style:{fontWeight:"bold",fontSize:"0.9rem",color:"#333"},children:[se("scaleMultiplier"),":"]}),r.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold",marginRight:"4px",color:"#333"},children:""}),r.jsx("input",{id:"multiplier-input",type:"number",min:"0.1",step:"0.1",value:xe,onChange:J=>Ne(J.target.value),style:{width:"60px",padding:"4px",fontSize:"1rem",fontWeight:"bold",textAlign:"center",borderRadius:"4px",border:"1px solid #ced4da",background:"#fff",color:"#333"}})]}),parseFloat(xe)!==1&&r.jsx(le,{variant:"ghost",size:"sm",onClick:()=>Ne("1"),style:{fontSize:"0.8rem",padding:"2px 8px",height:"auto",color:"#555",borderColor:"#ccc",background:"#fff"},children:""})]}),(()=>{const J=Ce.ingredientGroups&&Ce.ingredientGroups.length>0?Ce.ingredientGroups:null;return J?J.map(Z=>{const oe=We.filter(fe=>fe.groupId===Z.id);return oe.length===0||["","Steps","Method",""].includes(Z.name)?null:r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{fontSize:"1rem",borderBottom:"2px solid var(--color-border)",paddingBottom:"0.5rem",marginBottom:"0.5rem",marginTop:"0.5rem",color:"var(--color-text-main)",display:["","Ingredients","ingredients"].includes(Z.name)?"none":"block"},children:Z.name}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:se("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:se("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:se("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:se("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:se("cost")})]})}),r.jsx("tbody",{children:oe.map((fe,Le)=>{const qe=We.indexOf(fe),Ze=Fe.ingredients?.[qe],Xe=typeof fe=="string"?fe:fe.name,Ct=Ze?typeof Ze=="string"?Ze:Ze.name:"",Nt=typeof fe=="object"?fe.unit:"",It=Ze&&typeof Ze=="object"?Ze.unit:"",rt=Se(fe.quantity,xe),kt=Re(fe.cost,xe),Xt=String(xe)!=="1";return r.jsxs("tr",{className:"ingredient-row",children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ing-${Z.id}-${Le}`}),r.jsx("label",{htmlFor:`ing-${Z.id}-${Le}`,children:ut(Xe,Ct)})]})}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:Xt?"bold":"normal",color:Xt?"var(--color-primary)":"inherit"},children:rt}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:ut(Nt,It)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(fe.purchaseCost)??"-"}),r.jsxs("td",{style:{textAlign:"right"},children:[vs(kt)??"-",Tp(fe)&&r.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},Le)})})]})]},Z.id)}):r.jsxs(r.Fragment,{children:[r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:se("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:se("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:se("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:se("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:se("cost")})]})}),r.jsx("tbody",{children:We.map((Z,oe)=>{const fe=Fe.ingredients?.[oe],Le=typeof Z=="string"?Z:Z.name,qe=fe?typeof fe=="string"?fe:fe.name:"",Ze=typeof Z=="object"?Z.unit:"",Xe=fe&&typeof fe=="object"?fe.unit:"",Ct=Se(Z.quantity,xe),Nt=Re(Z.cost,xe),It=String(xe)!=="1";return r.jsxs("tr",{className:"ingredient-row",children:[r.jsx("td",{children:r.jsxs("div",{className:"ingredient-name",children:[r.jsx("input",{type:"checkbox",id:`ing-${oe}`}),r.jsx("label",{htmlFor:`ing-${oe}`,children:ut(Le,qe)})]})}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem",fontWeight:It?"bold":"normal",color:It?"var(--color-primary)":"inherit"},children:Ct}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:ut(Ze,Xe)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(Z.purchaseCost)??"-"}),r.jsxs("td",{style:{textAlign:"right"},children:[vs(Nt)??"-",Tp(Z)&&r.jsx("span",{style:{fontSize:"0.7em",color:"#d35400",marginLeft:"2px"},children:"(10%)"})]})]},oe)})})]}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[se("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Math.round((oe=>oe.reduce((fe,Le)=>{const qe=parseFloat(Le.cost)||0,Ze=aa(Le),Xe=Re(qe,xe),Ct=parseFloat(Xe)||0;return fe+Ct*Ze},0))(We)).toLocaleString()]})]})]})})(),r.jsx("div",{className:"screen-only no-print",children:r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[se("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Math.round((Z=>Z.reduce((oe,fe)=>{const Le=parseFloat(fe.cost)||0,qe=aa(fe),Ze=Re(Le,xe),Xe=parseFloat(Ze)||0;return oe+Xe*qe},0))(We)).toLocaleString()]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]})}),r.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"}),(()=>{const Z=(oe=>oe.reduce((fe,Le)=>{const qe=parseFloat(Le.cost)||0,Ze=aa(Le),Xe=parseFloat(Re(qe,xe))||0;return fe+Xe*Ze},0))(We);return ht(Z)})()]})})]}),r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:se("instructions")}),(()=>{const J=Ce.stepGroups&&Ce.stepGroups.length>0?Ce.stepGroups:null,Z=J&&Vt.some(oe=>!oe||typeof oe!="object"||!oe.groupId?!1:J.some(fe=>fe.id===oe.groupId));return J&&Z?r.jsx("div",{className:"steps-container",children:J.map(oe=>{const fe=Vt.filter(Le=>(typeof Le=="object"?Le.groupId:null)===oe.id);return fe.length===0?null:r.jsxs("div",{className:"step-group",style:{marginBottom:"2rem"},children:[oe.name!==""&&oe.name!=="Steps"&&r.jsx("h3",{style:{fontSize:"1.1rem",marginBottom:"1rem",color:"var(--color-text-main)",borderLeft:"4px solid var(--color-primary)",paddingLeft:"10px"},children:oe.name}),r.jsx("div",{className:"steps-list",children:fe.map((Le,qe)=>{const Ze=Vt.indexOf(Le),Xe=typeof Le=="object"?Le.text:Le,Ct=Fe.steps?.[Ze],Nt=typeof Ct=="object"?Ct.text:Ct,It=rt=>rt?rt.replace(/<[^>]*>?/gm,""):"";return r.jsxs(un,{className:`step-card ${z.has(Ze)?"is-completed":""}`,onClick:()=>rn(Ze),children:[r.jsx("div",{className:"step-number",children:Ze+1}),r.jsx("p",{className:"step-text",children:ut(It(Xe),It(Nt),!0)})]},qe)})})]},oe.id)})}):r.jsx("div",{className:"steps-list",children:Vt.map((oe,fe)=>{const Le=typeof oe=="object"?oe.text:oe,qe=Fe.steps?.[fe],Ze=typeof qe=="object"?qe.text:qe;return r.jsxs(un,{className:`step-card ${z.has(fe)?"is-completed":""}`,onClick:()=>rn(fe),children:[r.jsx("div",{className:"step-number",children:fe+1}),r.jsx("p",{className:"step-text",children:ut(Le,Ze,!0)})]},fe)})})})()]})]})}),r.jsx(jn,{isOpen:L,onClose:()=>H(!1),title:" ",size:"large",children:r.jsxs("div",{className:"print-preview-recipe",children:[r.jsx("div",{className:"preview-header",children:r.jsx("h2",{children:Ce.title})}),r.jsxs("div",{className:"preview-meta",children:[Ce.course&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",Ce.course]}),Ce.category&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",Ce.category]}),Ce.storeName&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",Ce.storeName]}),Ce.servings&&r.jsxs("div",{children:[r.jsx("strong",{children:":"})," ",Ce.servings,""]})]}),Ce.description&&r.jsx("div",{className:"preview-description",children:r.jsx("p",{children:Ce.description})}),r.jsx("div",{className:"preview-controls",children:Ce.type==="bread"?r.jsxs("div",{className:"preview-control-row",children:[r.jsx("label",{className:"preview-control-label",htmlFor:"preview-target-total",children:"(g)"}),r.jsx("input",{id:"preview-target-total",className:"preview-control-input",type:"number",value:ie,onChange:J=>ve(J.target.value),placeholder:"1000"}),ie&&r.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>ve(""),children:""}),te?.grandTotal?r.jsxs("span",{className:"preview-control-note",children:[": ",te.grandTotal.toLocaleString(),"g"]}):null]}):r.jsxs("div",{className:"preview-control-row",children:[r.jsx("label",{className:"preview-control-label",htmlFor:"preview-multiplier",children:se("scaleMultiplier")}),r.jsx("span",{className:"preview-control-mult",children:""}),r.jsx("input",{id:"preview-multiplier",className:"preview-control-input",type:"number",step:"0.1",value:xe,onChange:J=>Ne(J.target.value),placeholder:"1"}),String(xe)!=="1"&&r.jsx("button",{type:"button",className:"preview-control-reset",onClick:()=>Ne("1"),children:""})]})}),r.jsxs("div",{className:"preview-section",children:[r.jsx("h3",{children:se("ingredients")}),Ce.type==="bread"?r.jsxs("div",{className:"preview-ingredients-bread",children:[r.jsxs("div",{className:"bread-group",children:[r.jsx("h4",{children:se("flourGroup")}),r.jsxs("table",{className:"preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:se("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:se("quantity")})]})}),r.jsx("tbody",{children:(Pe.flours||[]).map((J,Z)=>{const oe=`flour-${Z}`,fe=te?te.getScaledQtyValue(J.quantity):J.quantity;return r.jsxs("tr",{className:R.has(oe)?"is-completed":"",onClick:()=>Kt(oe),role:"button",tabIndex:0,onKeyDown:Le=>{(Le.key==="Enter"||Le.key===" ")&&(Le.preventDefault(),Kt(oe))},children:[r.jsx("td",{children:J.name}),r.jsxs("td",{style:{textAlign:"right"},children:[fe,"g"]})]},Z)})})]})]}),r.jsxs("div",{className:"bread-group",children:[r.jsx("h4",{children:se("otherIngredients")}),r.jsxs("table",{className:"preview-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:se("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:se("quantity")})]})}),r.jsx("tbody",{children:(Pe.breadIngredients||[]).map((J,Z)=>{const oe=`bread-${Z}`,fe=te?te.getScaledQtyValue(J.quantity):J.quantity;return r.jsxs("tr",{className:R.has(oe)?"is-completed":"",onClick:()=>Kt(oe),role:"button",tabIndex:0,onKeyDown:Le=>{(Le.key==="Enter"||Le.key===" ")&&(Le.preventDefault(),Kt(oe))},children:[r.jsx("td",{children:J.name}),r.jsxs("td",{style:{textAlign:"right"},children:[fe,"g"]})]},Z)})})]})]})]}):r.jsx("div",{className:"preview-ingredients-normal",children:(()=>{const J=Ce.ingredientGroups&&Ce.ingredientGroups.length>0?Ce.ingredientGroups:null;return J?J.map(Z=>{const oe=We.filter(fe=>fe.groupId===Z.id);return oe.length===0||["","Steps","Method",""].includes(Z.name)?null:r.jsxs("div",{className:"ingredient-group",children:[r.jsx("h4",{children:Z.name}),r.jsxs("table",{className:"preview-table preview-table--normal",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:se("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:se("quantity")}),r.jsx("th",{children:se("unit")})]})}),r.jsx("tbody",{children:oe.map((fe,Le)=>{const qe=`${Z.id}-${Le}`,Ze=typeof fe=="string"?fe:fe.name,Xe=typeof fe=="object"?Se(fe.quantity,ae):"",Ct=typeof fe=="object"?fe.unit:"";return r.jsxs("tr",{className:R.has(qe)?"is-completed":"",onClick:()=>Kt(qe),role:"button",tabIndex:0,onKeyDown:Nt=>{(Nt.key==="Enter"||Nt.key===" ")&&(Nt.preventDefault(),Kt(qe))},children:[r.jsx("td",{children:Ze}),r.jsx("td",{style:{textAlign:"right"},children:Xe}),r.jsx("td",{children:Ct})]},Le)})})]})]},Z.id)}):r.jsxs("table",{className:"preview-table preview-table--normal",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:se("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:se("quantity")}),r.jsx("th",{children:se("unit")})]})}),r.jsx("tbody",{children:We.map((Z,oe)=>{const fe=`ungrouped-${oe}`,Le=typeof Z=="string"?Z:Z.name,qe=typeof Z=="object"?Se(Z.quantity,ae):"",Ze=typeof Z=="object"?Z.unit:"";return r.jsxs("tr",{className:R.has(fe)?"is-completed":"",onClick:()=>Kt(fe),role:"button",tabIndex:0,onKeyDown:Xe=>{(Xe.key==="Enter"||Xe.key===" ")&&(Xe.preventDefault(),Kt(fe))},children:[r.jsx("td",{children:Le}),r.jsx("td",{style:{textAlign:"right"},children:qe}),r.jsx("td",{children:Ze})]},oe)})})]})})()})]}),Vt.length>0&&r.jsxs("div",{className:"preview-section",children:[r.jsx("h3",{children:se("instructions")}),r.jsx("ol",{className:"preview-steps",children:Vt.map((J,Z)=>{const oe=typeof J=="object"?J.text:J;return r.jsx("li",{className:U.has(Z)?"is-completed":"",onClick:()=>sn(Z),role:"button",tabIndex:0,onKeyDown:fe=>{(fe.key==="Enter"||fe.key===" ")&&(fe.preventDefault(),sn(Z))},children:oe},Z)})})]}),r.jsxs("div",{className:"modal-actions",children:[r.jsxs(le,{variant:"primary",onClick:()=>window.print(),children:[" ",se("print")]}),r.jsx(le,{variant:"ghost",onClick:()=>H(!1),children:se("close")})]})]})})]}),r.jsxs("div",{className:"print-layout",children:[r.jsx("div",{className:"recipe-detail__hero",children:Ce.image?r.jsx("img",{src:Ce.image,alt:Ce.title,className:"recipe-detail__image"}):r.jsx("div",{className:"recipe-detail__image-placeholder",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",color:"#888",fontSize:"0.8rem"},children:"No Image"})}),r.jsxs("div",{className:"recipe-detail__title-card",children:[r.jsx("h1",{children:qt(Ce.title,Fe.title)}),Et&&r.jsx("p",{className:"recipe-detail__desc",children:qt(Et,Fe.description)})]}),r.jsxs("div",{className:"recipe-detail__meta",children:[Ce.category&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:se("category")}),r.jsx("span",{className:"meta-value",children:qt(Ce.category,Fe.category)})]}),Ce.storeName&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:se("storeName")}),r.jsx("span",{className:"meta-value meta-value--store",children:qt(Ce.storeName,Fe.storeName)})]}),Ce.course&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:se("course")}),r.jsx("span",{className:"meta-value",children:qt(Ce.course,Fe.course)})]}),Ce.servings&&r.jsxs("div",{className:"meta-item",children:[r.jsx("span",{className:"meta-label",children:se("servings")}),r.jsx("span",{className:"meta-value",children:qt(`${Ce.servings}`,Fe.servings?`${Fe.servings}`:"")})]})]}),Ce.sourceUrl&&r.jsxs("div",{className:"print-layout__source",children:[r.jsx("div",{className:"print-layout__source-label",children:se("sourceRecipe")}),r.jsx("div",{className:"print-layout__source-qr",children:r.jsx(n0,{value:Ce.sourceUrl,size:84,style:{display:"block"}})})]}),r.jsxs("div",{className:"recipe-detail__main",children:[r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:se("ingredients")}),Ce.type==="bread"&&te?r.jsxs("div",{children:[r.jsxs("div",{className:"bread-section",style:{marginBottom:"1.5rem"},children:[r.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:se("flourGroup")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:se("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:se("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:se("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:se("cost")})]})}),r.jsx("tbody",{children:te.flours.map((J,Z)=>{const oe=Fe.flours?.[Z]||{},fe=te.getScaledQtyValue(J.quantity),Le=ie?"":oe.quantity;return r.jsxs("tr",{children:[r.jsx("td",{children:qt(J.name,oe.name)}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:qt(fe,Le)}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[te.calcPercent(J.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(J.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:J.cost?`${te.formatCostValue(J.cost)}`:"-"})]},`print-flour-${Z}`)})})]})]}),r.jsxs("div",{className:"bread-section",children:[r.jsx("h3",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:se("otherIngredients")}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:se("ingredientName")}),r.jsx("th",{style:{textAlign:"right"},children:se("quantityGram")}),r.jsx("th",{style:{textAlign:"center",width:"60px"},children:"%"}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:se("purchase")}),r.jsx("th",{style:{textAlign:"right",width:"80px"},children:se("cost")})]})}),r.jsx("tbody",{children:te.others.map((J,Z)=>{const oe=Fe.breadIngredients?.[Z]||{},fe=te.getScaledQtyValue(J.quantity),Le=ie?"":oe.quantity;return r.jsxs("tr",{children:[r.jsx("td",{children:qt(J.name,oe.name)}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:qt(fe,Le)}),r.jsxs("td",{style:{textAlign:"center",fontWeight:"bold",color:"#555"},children:[te.calcPercent(J.quantity),"%"]}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(J.purchaseCost)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:J.cost?`${te.formatCostValue(J.cost)}`:"-"})]},`print-others-${Z}`)})})]})]})]}):pt.map(J=>{const Z=Fe.ingredientGroups?.find(oe=>oe.id===J.id)?.name||"";return r.jsxs("div",{style:{marginBottom:"1.2rem"},children:[J.name&&r.jsx("div",{className:"print-group-heading",children:qt(J.name,Z)}),r.jsxs("table",{className:"ingredients-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40%"},children:se("ingredientName")}),r.jsx("th",{style:{width:"20%",textAlign:"right",paddingRight:"0.5rem"},children:se("quantity")}),r.jsx("th",{style:{width:"15%",paddingLeft:"0.5rem"},children:se("unit")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:se("purchase")}),r.jsx("th",{style:{width:"15%",textAlign:"right"},children:se("cost")})]})}),r.jsx("tbody",{children:J.items.map((oe,fe)=>{const Le=typeof oe=="object"?oe.quantity:"",qe=typeof oe=="object"?oe.unit:"",Ze=typeof oe=="object"?oe.purchaseCost:null,Xe=typeof oe=="object"?oe.cost:null,Ct=typeof oe=="string"?oe:oe.name,Nt=typeof oe=="object"?Se(oe.quantity,ae):Le,It=We.indexOf(oe),rt=Fe.ingredients?.[It],kt=rt?typeof rt=="string"?rt:rt.name:"",Xt=rt&&typeof rt=="object"?rt.unit:"",dn=String(ae)==="1"&&rt&&typeof rt=="object"?rt.quantity:"";return r.jsxs("tr",{children:[r.jsx("td",{children:qt(Ct,kt)}),r.jsx("td",{style:{textAlign:"right",paddingRight:"0.5rem"},children:qt(Nt,dn)}),r.jsx("td",{style:{paddingLeft:"0.5rem"},children:qt(qe,Xt)}),r.jsx("td",{className:"ingredient-cost-muted",style:{textAlign:"right"},children:vs(Ze)??"-"}),r.jsx("td",{style:{textAlign:"right"},children:vs(Xe)??"-"})]},`print-ing-${J.id}-${fe}`)})})]})]},J.id)}),r.jsxs("div",{className:"cost-summary",children:[r.jsxs("span",{className:"cost-summary__label",children:[se("totalCost"),":"]}),r.jsxs("span",{className:"cost-summary__value",children:["",Ge]}),r.jsx("span",{className:"cost-summary__note",children:"()"})]}),r.jsx("p",{className:"recipe-detail__subtle recipe-detail__tax-footnote",children:"(8% or 10%)"})]}),r.jsxs("section",{className:"detail-section",children:[r.jsx("h2",{children:se("instructions")}),Vt.length>0?r.jsx("div",{className:"steps-list",children:Vt.map((J,Z)=>{const oe=typeof J=="object"?J.text:J,fe=Fe.steps?.[Z],Le=typeof fe=="object"?fe?.text:fe;return r.jsxs("div",{className:"step-card",children:[r.jsx("div",{className:"step-number",children:Z+1}),r.jsx("p",{className:"step-text",children:qt(oe,Le)})]},`print-step-${Z}`)})}):r.jsx("p",{style:{fontSize:"0.9rem",color:"#555"},children:se("noSteps")})]})]})]})]})},Jb=n=>{if(n==null)return"";let t=String(n);return t=t.replace(/[-]/g,i=>String.fromCharCode(i.charCodeAt(0)-65248)),t=t.replace(/[--]/g,i=>String.fromCharCode(i.charCodeAt(0)-65248)),t=t.replace(/[]/g,"-").replace(/[]/g,"+").replace(/[]/g,".").replace(/[]/g,",").replace(/[ \t\r\n\u00A0\u3000]/g,""),t=t.toLowerCase(),t=t.replace(/,/g,""),t},Mt=({label:n,id:t,error:i,textarea:a,wrapperClassName:o,...u})=>{const d=a?"textarea":"input",f=u.type==="number"||u.inputMode==="decimal"||u.inputMode==="numeric",h=m=>{if(!u.onChange)return;if(!f){u.onChange(m);return}const y=m?.target?.value??"",v=Jb(y);if(v===y){u.onChange(m);return}u.onChange({target:{id:m?.target?.id,name:m?.target?.name,value:v}})};return r.jsxs("div",{className:`input-group ${i?"input-group--error":""} ${o||""}`,children:[n&&r.jsx("label",{htmlFor:t,className:"input-label",children:n}),r.jsx(d,{id:t,className:`input-field ${u.className||""}`,style:u.style,...u,onChange:h}),i&&r.jsx("span",{className:"input-error",children:i})]})},xs="app-data",lr={_cacheByUserId:new Map,_historyCacheByUserId:new Map,async _getCurrentUserId(){const{data:n,error:t}=await _e.auth.getUser();if(t)throw t;return n?.user?.id||null},_getUserScopedPath(n,t){if(!n)throw new Error("User ID is required");const i=String(t||"").replace(/^\/+/,"");return`${n}/${i}`},clearCache(n=null){n?(this._cacheByUserId.delete(n),this._historyCacheByUserId.delete(n)):(this._cacheByUserId.clear(),this._historyCacheByUserId.clear())},async _downloadAllCsvTexts(n){const{data:t,error:i}=await _e.storage.from(xs).list(n);if(i)return console.warn("Failed to list price files:",i.message),[];if(!t||t.length===0)return[];const a=t.filter(u=>String(u?.name||"").toLowerCase().endsWith(".csv")).map(async u=>{const d=this._getUserScopedPath(n,u.name),{data:f,error:h}=await _e.storage.from(xs).download(d);if(h)return console.error(`Failed to download ${u.name}:`,h),null;const m=await f.arrayBuffer();try{const y=new TextDecoder("shift-jis");return{fileName:u.name,text:y.decode(m)}}catch(y){try{const v=new TextDecoder("utf-8");return{fileName:u.name,text:v.decode(m)}}catch{return console.warn("TextDecoder failed (shift-jis/utf-8). Skipping file:",u.name,y),null}}});return(await Promise.all(a)).filter(Boolean)},async fetchPriceList(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const i=this._cacheByUserId.get(t);if(i)return i;try{const a=new Map,o=await this._downloadAllCsvTexts(t);if(!o||o.length===0)return new Map;for(const{text:u}of o){if(!u)continue;const d=this.parseCSV(u);for(const[f,h]of d)if(a.has(f)){const m=a.get(f);(h?.dateStr||"")>(m?.dateStr||"")&&a.set(f,h)}else a.set(f,h)}return this._cacheByUserId.set(t,a),a}catch(a){return console.error("Error in fetchPriceList:",a),new Map}},async getFileList(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return[];const{data:i,error:a}=await _e.storage.from(xs).list(t);if(a)throw a;return i.filter(o=>String(o?.name||"").toLowerCase().endsWith(".csv"))||[]}catch(t){return console.error("Error fetching file list:",t),[]}},async uploadPriceList(n,t=null){try{const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=n.name;this.clearCache(i);const o=this._getUserScopedPath(i,a),{data:u,error:d}=await _e.storage.from(xs).upload(o,n,{upsert:!0,contentType:"text/csv"});if(d)throw d;return{success:!0,data:u}}catch(i){return console.error("Error uploading price list:",i),{success:!1,error:i}}},async deletePriceFile(n,t=null){try{const i=t||await this._getCurrentUserId();if(!i)throw new Error("");this.clearCache(i);const a=this._getUserScopedPath(i,n),{data:o,error:u}=await _e.storage.from(xs).remove([a]);if(u)throw u;if(!o||o.length===0)throw new Error("");return{success:!0,data:o}}catch(i){return console.error("Error deleting price file:",i),{success:!1,error:i}}},_splitFileName(n){const t=String(n||""),i=t.lastIndexOf(".");return i<=0?{base:t,ext:""}:{base:t.slice(0,i),ext:t.slice(i)}},_makeCopyFileName(n,t){const i=String(n||"");if(!t?.has?.(i))return i;const{base:a,ext:o}=this._splitFileName(i),u=a||i||"price";let d=1;for(;d<1e3;){const f=d===1?"_copy":`_copy${d}`,h=`${u}${f}${o}`;if(!t.has(h))return h;d++}return`${u}_copy_${Date.now()}${o}`},async copyPriceFilesToUser({targetUserId:n,sourceUserId:t=null,onProgress:i=null}={}){const a=t||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("");if(o===a)throw new Error("");const{data:u,error:d}=await _e.storage.from(xs).list(a);if(d)throw d;const f=(u||[]).map(S=>S?.name).filter(Boolean).filter(S=>String(S).toLowerCase().endsWith(".csv")),{data:h,error:m}=await _e.storage.from(xs).list(o);let y=new Set;if(m){const S=String(m?.message||"").toLowerCase();if(S.includes("not found")||S.includes("404"))y=new Set;else throw m}else y=new Set((h||[]).map(S=>S?.name).filter(Boolean));const v={sourceUserId:a,targetUserId:o,copied:[],skipped:[],failed:[]},x=f.length;i?.({phase:"start",total:x,done:0,current:""});for(let S=0;S<f.length;S++){const _=f[S],N=this._makeCopyFileName(_,y);y.add(N);const w=this._getUserScopedPath(a,_),C=this._getUserScopedPath(o,N);i?.({phase:"progress",total:x,done:S,current:`${_}  ${N}`,fromFile:_,toFile:N});try{const{data:D,error:z}=await _e.storage.from(xs).download(w);if(z)throw z;if(!D)throw new Error("");const{error:T}=await _e.storage.from(xs).upload(C,D,{upsert:!1,contentType:"text/csv"});if(T){const U=String(T?.message||"").toLowerCase();if(U.includes("already exists")||U.includes("exists")||U.includes("409")){let E=0,R=T;for(;E<5;){E++;const A=this._makeCopyFileName(_,y);y.add(A);const O=this._getUserScopedPath(o,A),{error:V}=await _e.storage.from(xs).upload(O,D,{upsert:!1,contentType:"text/csv"});if(!V){v.copied.push({fromFile:_,toFile:A}),R=null;break}R=V}if(R)throw R;continue}throw T}v.copied.push({fromFile:_,toFile:N})}catch(D){console.error("copyPriceFilesToUser failed:",D),v.failed.push({file:_,errorMessage:String(D?.message||D)})}i?.({phase:"progress",total:x,done:S+1,current:`${_}  ${N}`,fromFile:_,toFile:N})}return i?.({phase:"done",total:x,done:x,current:"",result:v}),this.clearCache(o),v},parseCSV(n){const t=new Map,i=n.split(/\r?\n/).filter(o=>o.trim());if(i.length===0)return t;if(i.some(o=>o.startsWith("D,")||o.startsWith('"D",')))for(let o of i){const u=[];let d="",f=!1;for(let w=0;w<o.length;w++){const C=o[w];C==='"'?f=!f:C===","&&!f?(u.push(d),d=""):d+=C}u.push(d);const h=u.map(w=>(w=w.trim(),w.startsWith('"')&&w.endsWith('"')?w.slice(1,-1):w));if(h[0]!=="D")continue;const m=h[1],y=h[8],v=h[14],x=h[18],S=h[20],_=String(v??"").trim(),N=Jt(_);if(N&&x){const w=parseFloat(x);if(!isNaN(w)){const C={price:w,vendor:y,unit:S,dateStr:m,displayName:_};if(t.has(N)){const D=t.get(N);(m||"")>=(D?.dateStr||"")&&t.set(N,C)}else t.set(N,C)}}}else{let o={name:-1,price:-1,unit:-1,vendor:-1},u=0;if(i[0].split(",").map(h=>h.trim().replace(/^"|"$/g,"")).forEach((h,m)=>{["","","","","name","item"].some(y=>h.includes(y))&&(o.name=m),["","","","","price","cost"].some(y=>h.includes(y))&&(o.price=m),["","unit"].some(y=>h.includes(y))&&(o.unit=m),["","","","vendor","supplier"].some(y=>h.includes(y))&&(o.vendor=m)}),o.name===-1&&o.price===-1){o={name:0,price:1,unit:2,vendor:3};const h=i[0].split(",");isNaN(parseFloat(h[1]))&&(u=1)}else u=1;const f=new Date().toISOString().slice(0,10).replace(/-/g,"/");for(let h=u;h<i.length;h++){const m=i[h],y=[];let v="",x=!1;for(let T=0;T<m.length;T++){const U=m[T];U==='"'?x=!x:U===","&&!x?(y.push(v),v=""):v+=U}y.push(v);const S=y.map(T=>(T=T.trim(),T.startsWith('"')&&T.endsWith('"')?T.slice(1,-1):T)),_=o.name>-1?S[o.name]:null,N=o.price>-1?S[o.price]:null,w=o.unit>-1?S[o.unit]:"",C=o.vendor>-1?S[o.vendor]:"",D=String(_??"").trim(),z=Jt(D);if(z&&N){const T=parseFloat(N.replace(/[^0-9.]/g,""));isNaN(T)||t.set(z,{price:T,vendor:C,unit:w,dateStr:f,displayName:D})}}}return t},parseCSVEntries(n,t=""){const i=[],a=n.split(/\r?\n/).filter(x=>x.trim());if(a.length===0)return i;const o=x=>{const S=String(x??"").trim();if(!S)return null;const _=parseFloat(S.replace(/[^0-9.]/g,""));return Number.isFinite(_)?_:null},u=x=>{const S=[];let _="",N=!1;for(let w=0;w<x.length;w++){const C=x[w];C==='"'?N=!N:C===","&&!N?(S.push(_),_=""):_+=C}return S.push(_),S.map(w=>(w=w.trim(),w.startsWith('"')&&w.endsWith('"')?w.slice(1,-1):w))},d=x=>{const S=String(x??"").trim();if(!S)return"";const _=S.match(/^(\d{4})[/.-](\d{1,2})[/.-](\d{1,2})/);if(_)return`${_[1]}/${String(_[2]).padStart(2,"0")}/${String(_[3]).padStart(2,"0")}`;const N=S.match(/^(\d{4})(\d{2})(\d{2})$/);return N?`${N[1]}/${N[2]}/${N[3]}`:S};if(a.some(x=>x.startsWith("D,")||x.startsWith('"D",'))){for(let x of a){const S=u(x);if(S[0]!=="D")continue;const _=d(S[1]),N=S[8],w=S[14],C=S[18],D=o(S[19]),z=S[20],T=String(w??"").trim(),U=Jt(T);if(!U||!C)continue;const E=o(C);Number.isFinite(E)&&i.push({key:U,displayName:T,price:E,vendor:N,unit:z,dateStr:_,incomingQty:D,sourceFile:t})}return i}let h={name:-1,price:-1,unit:-1,vendor:-1,date:-1,quantity:-1},m=0;if(a[0].split(",").map(x=>x.trim().replace(/^"|"$/g,"")).forEach((x,S)=>{const _=String(x||"").toLowerCase();["","","","","name","item"].some(N=>_.includes(N))&&(h.name=S),["","","","","price","cost"].some(N=>_.includes(N))&&(h.price=S),["","unit"].some(N=>_.includes(N))&&(h.unit=S),["","","","vendor","supplier"].some(N=>_.includes(N))&&(h.vendor=S),["","","","date"].some(N=>_.includes(N))&&(h.date=S),["","","","","","qty","quantity"].some(N=>_.includes(N))&&(h.quantity=S)}),h.name===-1&&h.price===-1){h={name:0,price:1,unit:2,vendor:3,date:-1,quantity:-1};const x=a[0].split(",");isNaN(parseFloat(x[1]))&&(m=1)}else m=1;const v=d(new Date().toISOString().slice(0,10));for(let x=m;x<a.length;x++){const S=u(a[x]),_=h.name>-1?S[h.name]:null,N=h.price>-1?S[h.price]:null,w=h.unit>-1?S[h.unit]:"",C=h.vendor>-1?S[h.vendor]:"",D=h.date>-1?S[h.date]:"",z=h.quantity>-1?o(S[h.quantity]):null,T=String(_??"").trim(),U=Jt(T);if(!U||!N)continue;const E=o(N);Number.isFinite(E)&&i.push({key:U,displayName:T,price:E,vendor:C,unit:w,dateStr:d(D)||v,incomingQty:z,sourceFile:t})}return i},async fetchPriceHistory(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Map;const i=this._historyCacheByUserId.get(t);if(i)return i;try{const a=await this._downloadAllCsvTexts(t);if(!a||a.length===0)return new Map;const o=new Map;for(const{fileName:u,text:d}of a){if(!d)continue;this.parseCSVEntries(d,u).forEach(h=>{const m=h?.key;m&&(o.has(m)||o.set(m,[]),o.get(m).push(h))})}for(const u of o.values())u.sort((d,f)=>{const h=String(d?.dateStr||""),m=String(f?.dateStr||"");if(h!==m)return h.localeCompare(m);const y=Number(d?.price),v=Number(f?.price);return Number.isFinite(y)&&Number.isFinite(v)&&y!==v?y-v:String(d?.sourceFile||"").localeCompare(String(f?.sourceFile||""))});return this._historyCacheByUserId.set(t,o),o}catch(a){return console.error("Error in fetchPriceHistory:",a),new Map}},async getPriceListArray(n=null){const t=await this.fetchPriceList(n),i=[];for(const[a,o]of t.entries())if(o&&typeof o=="object"){const{displayName:u,...d}=o;i.push({name:u||a,...d})}else i.push({name:a,price:o});return i.sort((a,o)=>a.dateStr&&o.dateStr?o.dateStr.localeCompare(a.dateStr):a.name.localeCompare(o.name))},async getPrice(n,t=null){return n&&(await this.fetchPriceList(t)).get(Jt(n))||null}},tc={_csvCache:null,_csvCacheKey:null,_lastDbResults:null,_lastDbQuery:null,invalidateCache(){this._csvCache=null,this._csvCacheKey=null,this._lastDbResults=null,this._lastDbQuery=null},async _searchFromDatabase(n){try{console.log(" Searching DB for:",n);const{data:t,error:i}=await _e.rpc("search_ingredients",{search_query:n,max_results:15});return i?(console.warn(" Database search failed:",i),console.warn("Error message:",i.message),console.warn("Error code:",i.code),null):(console.log(" DB search result:",t),t||[])}catch(t){return console.warn(" Database search exception:",t),null}},async search(n){const t=String(n||"").trim();if(!t)return this._lastDbResults=null,this._lastDbQuery=null,[];const i=t.toLowerCase(),a=Jt(t);try{const o=await this._searchFromDatabase(i);if(o&&Array.isArray(o)){this._lastDbResults=o,this._lastDbQuery=i;const d=o.map(w=>({name:w.ingredient_name,price:w.last_price,size:w.packet_size,unit:w.packet_unit,itemCategory:w.item_category||null,source:"manual",displaySource:" "}));if(d.length===0)return await this._fallbackSearch(i);if(!this._csvCache){const w=await lr.getPriceListArray();this._csvCache=w.map(C=>({name:C.name,price:C.price,size:null,unit:C.unit,source:"csv",displaySource:" CSV"}))}const f=w=>{if(!a)return null;const C=String(w||"").indexOf(a);return C<0?null:{tier:w===a?0:C===0?1:2,idx:C,len:String(w||"").length}},h=(w,C)=>w.score.tier!==C.score.tier?w.score.tier-C.score.tier:w.score.idx!==C.score.idx?w.score.idx-C.score.idx:w.score.len!==C.score.len?w.score.len-C.score.len:w.name.localeCompare(C.name,"ja"),m=(w,C,D)=>{let z=0;for(;z<w.length&&h(w[z],C)<=0;)z++;w.splice(z,0,C),w.length>D&&w.pop()},v=Math.max(0,15-d.length),x=new Set(d.map(w=>Jt(w.name))),S=[],_=new Set;if(v>0)for(const w of this._csvCache){const C=Jt(w?.name);if(!C||x.has(C)||_.has(C))continue;const D=f(C);D&&(_.add(C),m(S,{...w,nameKey:C,score:D},v))}const N=S.map(w=>({name:w.name,price:w.price,size:w.size,unit:w.unit,source:w.source,displaySource:w.displaySource}));return[...d,...N]}console.info(" Database search unavailable (dbResults is null/empty), using fallback CSV search"),console.log(" dbResults:",o);const u=await this._fallbackSearch(i);return console.log(" Fallback search returned:",u.length,"results"),u}catch(o){return console.error("Error searching ingredients:",o),[]}},async _fallbackSearch(n){try{const t=Jt(n);if(!this._csvCache){console.log(" Building cache from CSV and manual data...");const[h,m]=await Promise.all([lr.getPriceListArray(),Un.getAllConversions()]);console.log(" CSV Data rows:",h.length),console.log(" Manual Data items:",m.size);const y=Array.from(m.values()).map(_=>({name:_.ingredientName,price:_.lastPrice,size:_.packetSize,unit:_.packetUnit,itemCategory:_.itemCategory||null,source:"manual",displaySource:" "})),v=h.map(_=>({name:_.name,price:_.price,size:null,unit:_.unit,source:"csv",displaySource:" CSV"})),x=new Set(y.map(_=>_.name)),S=v.filter(_=>!x.has(_.name));this._csvCache=[...y,...S],console.log(" Cache built. Total items:",this._csvCache.length)}const i=h=>{if(!t)return null;const m=String(h||"").indexOf(t);return m<0?null:{tier:h===t?0:m===0?1:2,idx:m,len:String(h||"").length}},a=(h,m)=>h.score.tier!==m.score.tier?h.score.tier-m.score.tier:h.score.idx!==m.score.idx?h.score.idx-m.score.idx:h.score.len!==m.score.len?h.score.len-m.score.len:h.name.localeCompare(m.name,"ja"),o=(h,m,y)=>{let v=0;for(;v<h.length&&a(h[v],m)<=0;)v++;h.splice(v,0,m),h.length>y&&h.pop()},u=15,d=[],f=new Set;for(const h of this._csvCache){const m=Jt(h?.name);if(!m||f.has(m))continue;const y=i(m);y&&(f.add(m),o(d,{...h,nameKey:m,score:y},u))}return d.map(h=>({name:h.name,price:h.price,size:h.size,unit:h.unit,itemCategory:h.itemCategory||null,source:h.source,displaySource:h.displaySource}))}catch(t){return console.error("Error in fallback search:",t),[]}}},bd=({value:n,onChange:t,placeholder:i,disabled:a,onSelect:o,name:u,required:d=!1})=>{const[f,h]=b.useState([]),[m,y]=b.useState(!1),[v,x]=b.useState(-1),S=b.useRef(null),_=b.useRef(null),[N,w]=b.useState({top:0,left:0,width:0,maxHeight:250,placeAbove:!0}),C=b.useCallback(()=>{if(S.current){const R=S.current.getBoundingClientRect(),A=8,O=4,V=R.top-A,P=window.innerHeight-R.bottom-A,Q=(V>=180||V>=P)&&V>=110,$=Math.max(110,Math.min(280,Q?V-O:P-O)),I=R.left,k=Math.max(220,window.innerWidth-A*2),L=Math.min(Math.max(R.width,220),k),H=Math.min(Math.max(A,I),window.innerWidth-A-L);w({top:Q?R.top-O:R.bottom+O,left:H,width:L,maxHeight:$,placeAbove:Q})}},[]);b.useEffect(()=>{const R=V=>{S.current&&!S.current.contains(V.target)&&_.current&&!_.current.contains(V.target)&&y(!1)},A=V=>{_.current&&_.current.contains(V.target)||y(!1)},O=()=>{m&&C()};return document.addEventListener("mousedown",R),window.addEventListener("scroll",A,{capture:!0}),window.addEventListener("resize",O),()=>{document.removeEventListener("mousedown",R),window.removeEventListener("scroll",A,{capture:!0}),window.removeEventListener("resize",O)}},[m,C]),b.useEffect(()=>{m&&C()},[m,f,C]);const D=b.useRef(0),z=b.useRef(null),T=async R=>{const A=R.target.value;if(t(R),z.current&&clearTimeout(z.current),A.length===0){y(!1);return}z.current=setTimeout(async()=>{if(A.length>0){const O=++D.current;console.log(" AutocompleteInput: Fetching suggestions for:",A);const V=await tc.search(A);console.log(" AutocompleteInput: Got",V.length,"suggestions"),O===D.current&&(h(V),y(V.length>0),x(-1))}},150)},U=R=>{const A={target:{value:R.name}};t(A),y(!1),o&&o(R)},E=R=>{m&&(R.key==="ArrowDown"?(R.preventDefault(),x(A=>A<f.length-1?A+1:A)):R.key==="ArrowUp"?(R.preventDefault(),x(A=>A>0?A-1:-1)):R.key==="Enter"?v>=0&&(R.preventDefault(),U(f[v])):R.key==="Escape"&&y(!1))};return r.jsxs("div",{className:"autocomplete-wrapper",ref:S,children:[r.jsx("input",{type:"text",className:"input-field autocomplete-input",name:u,value:n,onChange:T,onKeyDown:E,onFocus:async()=>{if(n&&n.length>0){C();const R=await tc.search(n);h(R),y(R.length>0)}else C()},placeholder:i,disabled:a,required:d}),m&&ma.createPortal(r.jsx("ul",{className:"suggestions-list",ref:_,style:{position:"fixed",top:`${N.top}px`,left:`${N.left}px`,width:`${N.width}px`,maxHeight:`${N.maxHeight}px`,transform:N.placeAbove?"translateY(-100%)":"none",zIndex:9999},children:f.map((R,A)=>r.jsxs("li",{className:`suggestion-item ${A===v?"selected":""}`,onClick:()=>U(R),onMouseEnter:()=>x(A),children:[r.jsxs("div",{className:"suggestion-main",children:[r.jsx("span",{className:"suggestion-name",children:R.name}),R?.source&&R.source!=="manual"&&r.jsx("span",{className:"suggestion-source",children:R.displaySource})]}),r.jsxs("div",{className:"suggestion-details",children:[R.price&&`${Number(R.price).toLocaleString()}`,R.size&&` / ${R.size}${R.unit}`,!R.size&&R.unit&&` / ${R.unit}`]})]},`${R.source}-${A}`))}),document.body)]})},Xb=({isOpen:n,onClose:t,onApply:i,ingredientName:a,currentCost:o,currentQuantity:u,unit:d="g",initialPurchaseCost:f,initialContentAmount:h})=>{const[m,y]=b.useState(""),[v,x]=b.useState(""),[S,_]=b.useState(d),[N,w]=b.useState(""),[C,D]=b.useState(!1),[z,T]=b.useState(!1),U=b.useCallback(async()=>{if(T(!0),w(""),f&&h){y(f),x(h);const F=await Un.getConversion(a);if(F)_(F.packetUnit||d),w(F.vendor||"");else{_(d);try{const Q=await lr.getPrice(a);w(Q?.vendor||"")}catch{}}}else{const F=await Un.getConversion(a);if(F)x(F.packetSize),_(F.packetUnit||d),F.lastPrice&&y(F.lastPrice),w(F.vendor||"");else try{const Q=await lr.getPrice(a);if(Q)if(y(o||Q.price),w(Q.vendor||""),Q.unit){const $=Q.unit.match(/^(\d+(?:\.\d+)?)?\s*(.*)$/);if($){let I=$[1]?parseFloat($[1]):1,k=$[2]?$[2].trim().toLowerCase():"";k==="kg"?(I*=1e3,k="g"):k==="l"?(I*=1e3,k="ml"):k==="cl"?(I*=10,k="ml"):k==="pk"||k==="pack"?k="":k==="bag"?k="":(k==="pc"||k==="pcs")&&(k=""),x(I),_(k||d)}else x(1),_(Q.unit)}else x(""),_(d);else x(""),y(o||""),_(d),w("")}catch(Q){console.warn("Failed to load master price:",Q),x(""),y(o||""),_(d),w("")}}T(!1)},[a,f,h,d,o]);b.useEffect(()=>{if(!n||!a)return;const F=setTimeout(()=>{U()},0);return()=>clearTimeout(F)},[n,a,U]);const E=()=>{const F=parseFloat(m),Q=parseFloat(v);return!F||!Q?0:["g","ml","cc"].includes(S)?F/Q*1e3:S==="cl"?F/Q*100:(["kg","l"].includes(S),F/Q)},R=async()=>{const F=E();if(C&&v)try{await Un.saveConversion(a,v,S,m,null,N)}catch(Q){console.error("Failed to save default conversion:",Q)}i(F,S,m,v,N),t()};if(!n)return null;const A=E(),O=String(d||"").trim().toLowerCase(),V=u?O==="cl"||O===""?A*(u*10/1e3):["g","ml","cc"].includes(O)?A*(u/1e3):A*u:0,P=r.jsx("div",{className:"unit-conversion-modal__overlay",role:"dialog","aria-modal":"true","aria-label":"",onClick:t,children:r.jsx("div",{className:"unit-conversion-modal__card",onClick:F=>F.stopPropagation(),children:r.jsxs("div",{className:"unit-conversion-modal__body",children:[r.jsx("h3",{className:"unit-conversion-modal__title",children:""}),r.jsxs("div",{className:"unit-conversion-modal__field",children:[r.jsx("span",{className:"unit-conversion-modal__label",children:""}),r.jsx("div",{className:"unit-conversion-modal__value",children:a||"()"})]}),r.jsxs("div",{className:"unit-conversion-modal__inputs",children:[r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:" ()"}),r.jsx("input",{type:"number",value:m,onChange:F=>y(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:""}),r.jsxs("div",{className:"unit-conversion-modal__row",children:[r.jsx("input",{type:"number",value:v,onChange:F=>x(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": 1000"}),r.jsxs("select",{value:S,onChange:F=>_(F.target.value),className:"unit-conversion-modal__select",children:[r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:"p"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),!["g","ml","","","","","","cc","cl"].includes(S)&&r.jsx("option",{value:S,children:S})]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"unit-conversion-modal__label",children:""}),r.jsx("input",{type:"text",value:N,onChange:F=>w(F.target.value),className:"input-field unit-conversion-modal__input",placeholder:": "})]})]}),r.jsx("div",{className:"unit-conversion-modal__summary","aria-live":"polite",children:z?r.jsx("div",{className:"unit-conversion-modal__summary-sub",style:{textAlign:"center"},children:"CSV..."}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"unit-conversion-modal__summary-row",children:[r.jsx("span",{className:"unit-conversion-modal__summary-label",children:" (1kg/1):"}),r.jsxs("span",{className:"unit-conversion-modal__summary-value",children:["",Math.round(A).toLocaleString()]})]}),u&&r.jsxs("div",{className:"unit-conversion-modal__summary-row unit-conversion-modal__summary-sub",children:[r.jsxs("span",{children:[" (",u,d,"):"]}),r.jsxs("span",{children:["",Math.round(V).toLocaleString()]})]})]})}),r.jsxs("label",{className:"unit-conversion-modal__checkbox",htmlFor:"saveDefault",children:[r.jsx("input",{type:"checkbox",id:"saveDefault",checked:C,onChange:F=>D(F.target.checked)}),r.jsxs("span",{children:["(",v,S,")"]})]}),r.jsxs("div",{className:"unit-conversion-modal__actions",children:[r.jsx(le,{type:"button",variant:"secondary",onClick:t,disabled:z,children:""}),r.jsx(le,{type:"button",variant:"primary",onClick:R,disabled:!m||!v||z,children:""})]})]})})});return ma.createPortal(P,document.body)},Nk=new Set(["food","alcohol","soft_drink","supplies"]),Ek=new Set(["alcohol","supplies"]),Zb={food:"",alcohol:"",soft_drink:"",supplies:""},Ri=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":Nk.has(t)?t:"":""},wd=n=>Ek.has(n),ip=(n,t)=>{const i=Ri(t);return i?{...n,itemCategory:i,isAlcohol:wd(i)}:{...n,itemCategory:null}},Zn=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},Ap=n=>{const t=Zn(n);return!Number.isFinite(t)||t<=0||t>100?100:t},la=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return Ap(i)/100},kk=(n,t,i)=>{const a=Zn(n),o=Zn(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:["kg","","l",""].includes(u)?a/o:["cl",""].includes(u)?a/o*100:a/o},l0=(n,t,i,a=!1,o=1)=>{const u=Zn(n),d=Zn(t);if(!Number.isFinite(u)||!Number.isFinite(d))return NaN;const f=Number.isFinite(o)&&o>0?o:1;if(a)return u/1e3*d/f;const h=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(h)||!h?u/1e3*d/f:["cl",""].includes(h)?u*10/1e3*d/f:u*d/f},Tk=(n,t)=>{const i=Zn(n?.purchaseCost),a=Zn(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},o0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Gr=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=o0(t);if(!a)return null;for(const[o,u]of n.entries())if(o0(o)===a)return u;return null},Ak=({formData:n,setFormData:t})=>{const[i,a]=b.useState(new Map),[o,u]=b.useState({isOpen:!1,type:null,index:null}),[d,f]=b.useState(new Map);b.useEffect(()=>{(async()=>{const[R,A]=await Promise.all([lr.fetchPriceList(),Un.getAllConversions()]);a(R),f(A)})()},[]);const m=(E=>E.reduce((R,A)=>R+(parseFloat(A.quantity)||0),0))(n.flours||[]),y=E=>!m||m===0?0:((parseFloat(E)||0)/m*100).toFixed(1);b.useEffect(()=>{if(d.size===0)return;const E=(O=[])=>{let V=!1;return{adjusted:O.map(F=>{if(!F||typeof F!="object")return F;const Q=Gr(d,F.name);let $=F;const I=Ri(F.itemCategory??F.item_category??Q?.itemCategory);if(I){const ce=wd(I);(Ri(F.itemCategory??F.item_category)!==I||!!F.isAlcohol!==ce)&&($={...$,itemCategory:I,isAlcohol:ce})}const k=la(F,Q),L=l0(F.quantity,$.purchaseCost,F.unit,!0,k),H=Number.isFinite(L)?Math.round(L*100)/100:NaN,G=Zn($.cost);if(Number.isFinite(H)&&(!Number.isFinite(G)||Math.abs(G-H)>.01)&&($={...$,cost:H}),Q&&Q.packetSize){const q=[Q.lastPrice,F.purchaseCostRef,F.purchase_cost,F.purchaseCost].find(ie=>Number.isFinite(Zn(ie))),W=kk(q,Q.packetSize,Q.packetUnit);if(Number.isFinite(W)&&Tk(F,W)){const ie=la(F,Q),ve=Math.round(W*100)/100,xe=l0(F.quantity,ve,F.unit,!0,ie),Ne=Number.isFinite(xe)?Math.round(xe*100)/100:$.cost,de=Zn($.purchaseCost),K=Zn($.cost),ge=!Number.isFinite(de)||Math.abs(de-ve)>.01,Ae=Number.isFinite(Zn(Ne))&&(!Number.isFinite(K)||Math.abs(K-Ne)>.01);(ge||Ae)&&($={...$,purchaseCost:ve,cost:Ne})}}return $!==F&&(V=!0),$}),changed:V}},R=E(n.flours||[]),A=E(n.breadIngredients||[]);!R.changed&&!A.changed||t(O=>({...O,flours:R.adjusted,breadIngredients:A.adjusted}))},[d,n.breadIngredients,n.flours,t]);const v=(E,R,A)=>{const O=[...n.flours||[]];if(O[E]={...O[E],[R]:A},R==="name"){const V=i.get(Jt(A));if(V){const P=typeof V=="object"?V.price:V,F=typeof V=="object"?V.vendor:null,Q=typeof V=="object"?V.unit:null;O[E].purchaseCostRef=P,O[E].vendorRef=F;const $=Gr(d,A);if($&&$.packetSize){let k=0;const L=$.lastPrice!==null&&$.lastPrice!==void 0&&$.lastPrice!==""?$.lastPrice:P,H=($.packetUnit||"").trim().toLowerCase();["g",""].includes(H)?k=L/$.packetSize*1e3:["kg",""].includes(H)?k=L/$.packetSize:["ml","","cc",""].includes(H)?k=L/$.packetSize*1e3:["l",""].includes(H)?k=L/$.packetSize:["cl",""].includes(H)?k=L/$.packetSize*100:k=L/$.packetSize,O[E].purchaseCost=Math.round(k*100)/100,O[E].unit="g"}else O[E].purchaseCost||(O[E].purchaseCost=P,!O[E].unit&&Q&&(O[E].unit=Q));const I=Ri($?.itemCategory);I?O[E]=ip(O[E],I):O[E].itemCategory=null}else O[E].purchaseCostRef=null,O[E].vendorRef=null,O[E].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(R)||R==="name"){const V=O[E],P=parseFloat(V.quantity),F=parseFloat(V.purchaseCost);if(!isNaN(P)&&!isNaN(F)){let Q=0;const $=(V.unit||"").trim().toLowerCase();$==="g"||$===""||$==="ml"||$===""||$==="cc"||$===""||!$?Q=P/1e3*F:$==="cl"||$===""?Q=P*10/1e3*F:Q=P*F;const I=Gr(d,V.name),k=la(V,I),L=Number.isFinite(k)&&k>0?k:1,H=Math.round(Q/L*100)/100;H!==V.cost&&(O[E].cost=H)}}t(V=>({...V,flours:O}))},x=(E,R,A)=>{const O=[...n.breadIngredients||[]];if(O[E]={...O[E],[R]:A},R==="name"){const V=i.get(Jt(A));if(V){const P=typeof V=="object"?V.price:V,F=typeof V=="object"?V.vendor:null,Q=typeof V=="object"?V.unit:null;O[E].purchaseCostRef=P,O[E].vendorRef=F;const $=Gr(d,A);if($&&$.packetSize){let k=0;const L=$.lastPrice!==null&&$.lastPrice!==void 0&&$.lastPrice!==""?$.lastPrice:P,H=($.packetUnit||"").trim().toLowerCase();["g",""].includes(H)?(k=L/$.packetSize*1e3,O[E].unit="g"):["kg",""].includes(H)?(k=L/$.packetSize,O[E].unit="g"):["ml","","cc",""].includes(H)?(k=L/$.packetSize*1e3,O[E].unit="ml"):["l",""].includes(H)?(k=L/$.packetSize,O[E].unit="ml"):(k=L/$.packetSize,O[E].unit=$.packetUnit),O[E].purchaseCost=Math.round(k*100)/100}else O[E].purchaseCost||(O[E].purchaseCost=P,!O[E].unit&&Q&&(O[E].unit=Q));const I=Ri($?.itemCategory);I?O[E]=ip(O[E],I):O[E].itemCategory=null}else O[E].purchaseCostRef=null,O[E].vendorRef=null,O[E].itemCategory=null}if(["quantity","purchaseCost","name","isAlcohol","unit"].includes(R)||R==="name"){const V=O[E],P=parseFloat(V.quantity),F=parseFloat(V.purchaseCost);if(!isNaN(P)&&!isNaN(F)){let Q=0;const $=V.unit?V.unit.trim().toLowerCase():"g";$==="g"||$===""||$==="ml"||$===""||$==="cc"||$===""?Q=P/1e3*F:Q=P*F;const I=Gr(d,V.name),k=la(V,I),L=Number.isFinite(k)&&k>0?k:1,H=Math.round(Q/L*100)/100;H!==V.cost&&(O[E].cost=H)}}t(V=>({...V,breadIngredients:O}))},S=()=>{t(E=>({...E,flours:[...E.flours||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},_=()=>{t(E=>({...E,breadIngredients:[...E.breadIngredients||[],{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}))},N=E=>{t(R=>({...R,flours:R.flours.filter((A,O)=>O!==E)}))},w=E=>{t(R=>({...R,breadIngredients:R.breadIngredients.filter((A,O)=>O!==E)}))},C=ba(dr(Al,{activationConstraint:{distance:10}}),dr(Rl,{activationConstraint:{delay:250,tolerance:5}}),dr(Tl,{coordinateGetter:gd})),D=E=>{const{active:R,over:A}=E;R.id!==A.id&&t(O=>{const P=O.flours.some($=>$.id===R.id)?"flours":"breadIngredients",F=O[P].findIndex($=>$.id===R.id),Q=O[P].findIndex($=>$.id===A.id);return F!==-1&&Q!==-1?{...O,[P]:Li(O[P],F,Q)}:O})};b.useEffect(()=>{if(!n.flours)t(E=>({...E,flours:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const E=n.flours.map(R=>R.id?R:{...R,id:crypto.randomUUID()});JSON.stringify(E)!==JSON.stringify(n.flours)&&t(R=>({...R,flours:E}))}if(!n.breadIngredients)t(E=>({...E,breadIngredients:[{id:crypto.randomUUID(),name:"",quantity:"",unit:"g",cost:"",isAlcohol:!1,itemCategory:null}]}));else{const E=n.breadIngredients.map(R=>R.id?R:{...R,id:crypto.randomUUID()});JSON.stringify(E)!==JSON.stringify(n.breadIngredients)&&t(R=>({...R,breadIngredients:E}))}},[]);const z=(E,R,A,O)=>{const{type:V,index:P}=o;t(F=>{if(V==="flour"){const Q=[...F.flours],$={...Q[P],purchaseCost:E,unit:R,purchase_cost:A,content_amount:O},I=parseFloat($.quantity),k=parseFloat(E);if(!isNaN(I)&&!isNaN(k)){let L=0;R==="g"||R===""?L=I/1e3*k:L=I*k;const H=Gr(d,$.name),G=la($,H),ce=Number.isFinite(G)&&G>0?G:1;$.cost=Math.round(L/ce*100)/100}return Q[P]=$,Un.getAllConversions().then(L=>f(L)),tc.invalidateCache(),{...F,flours:Q}}else if(V==="ingredient"){const Q=[...F.breadIngredients],$={...Q[P],purchaseCost:E,unit:R,purchase_cost:A,content_amount:O},I=parseFloat($.quantity),k=parseFloat(E);if(!isNaN(I)&&!isNaN(k)){let L=0;R==="g"||R===""?L=I/1e3*k:L=I*k;const H=Gr(d,$.name),G=la($,H),ce=Number.isFinite(G)&&G>0?G:1;$.cost=Math.round(L/ce*100)/100}return Q[P]=$,Un.getAllConversions().then(L=>f(L)),tc.invalidateCache(),{...F,breadIngredients:Q}}return F})},T=(E,R,A)=>{A&&t(O=>{const V=E==="flour"?"flours":"breadIngredients",P=[...O[V]||[]],F={...P[R]};if(F.name=A.name,F.itemCategory=null,A.price!==void 0&&A.price!==null&&A.price!==""){F.purchaseCostRef=A.price,F.vendorRef=A.source==="csv"?"CSV":"Master";let k=A.price,L=A.unit;if(A.source==="manual")if(A.size&&A.size>0){const H=(A.unit||"").trim().toLowerCase();["g",""].includes(H)?(k=A.price/A.size*1e3,L="g"):["kg",""].includes(H)?(k=A.price/A.size,L="g"):["ml","","cc",""].includes(H)?(k=A.price/A.size*1e3,L="ml"):["l",""].includes(H)?(k=A.price/A.size,L="ml"):["cl",""].includes(H)?(k=A.price/A.size*100,L="ml"):(k=A.price/A.size,L=A.unit)}else k=A.price,L=A.unit;else{const H=Gr(d,A.name);if(H&&H.packetSize){const G=H.lastPrice!==null&&H.lastPrice!==void 0&&H.lastPrice!==""?H.lastPrice:A.price,ce=(H.packetUnit||"").trim().toLowerCase();["g",""].includes(ce)?(k=G/H.packetSize*1e3,L="g"):["kg",""].includes(ce)?(k=G/H.packetSize,L="g"):["ml","","cc",""].includes(ce)?(k=G/H.packetSize*1e3,L="ml"):["l",""].includes(ce)?(k=G/H.packetSize,L="ml"):["cl",""].includes(ce)?(k=G/H.packetSize*100,L="ml"):(k=G/H.packetSize,L=H.packetUnit)}else k=A.price,L=A.unit}F.purchaseCost=Math.round(k*100)/100,E==="flour"?F.unit="g":L&&(F.unit=L)}const Q=Ri(A.itemCategory??A.item_category??Gr(d,A.name)?.itemCategory);if(Q){const k=ip(F,Q);Object.assign(F,k)}const $=parseFloat(F.quantity),I=parseFloat(F.purchaseCost);if(!isNaN($)&&!isNaN(I)){const k=Gr(d,F.name),L=la(F,k),H=Number.isFinite(L)&&L>0?L:1,G=(F.unit||"").trim().toLowerCase();let ce=0;G==="g"||G===""||G==="ml"||G===""||G==="cc"||G===""?ce=$/1e3*I:G==="cl"||G===""?ce=$*10/1e3*I:ce=$*I,F.cost=Math.round(ce/H*100)/100}return P[R]=F,{...O,[V]:P}})},U=o.isOpen&&o.index!==null?o.type==="flour"?n.flours[o.index]:n.breadIngredients[o.index]:null;return r.jsxs("div",{className:"bread-form",children:[r.jsxs(un,{className:"mb-md bread-card",style:{position:"relative",zIndex:10},children:[r.jsxs("div",{className:"bread-header",children:[r.jsxs("h3",{children:[" (Total: ",m,"g)"]}),r.jsx("span",{className:"bread-badge",children:"Base (100%)"})]}),r.jsxs("div",{className:"recipe-scroll-wrapper",children:[r.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[r.jsx("span",{})," ",r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{className:"text-center",children:"%"}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsx("div",{className:"bread-grid-body",children:r.jsx(Mi,{sensors:C,collisionDetection:Wu,onDragEnd:D,id:"flours-dnd",children:r.jsx(xa,{items:n.flours||[],strategy:Sl,children:(n.flours||[]).map((E,R)=>{const A=Gr(d,E?.name),O=Ap(A?.yieldPercent??A?.yield_percent??E?.yieldPercent??E?.yield_percent);return r.jsx(Rk,{id:E.id,index:R,item:E,yieldPercentApplied:O,onChange:v,onRemove:N,onSelect:T,calculatePercentage:y,floursLength:(n.flours||[]).length,onOpenConversion:()=>u({isOpen:!0,type:"flour",index:R})},E.id)})})})})]}),r.jsx(le,{type:"button",variant:"secondary",size:"sm",onClick:S,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),r.jsxs(un,{className:"mb-md bread-card",style:{position:"relative",zIndex:5},children:[r.jsxs("div",{className:"bread-header",children:[r.jsx("h3",{children:""}),r.jsx("span",{className:"bread-subtitle",children:"Water, Salt, Yeast, etc."})]}),r.jsxs("div",{className:"recipe-scroll-wrapper",children:[r.jsxs("div",{className:"recipe-list-header recipe-list-header--bread",children:[r.jsx("span",{})," ",r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{className:"text-center",children:"%"}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsx("div",{className:"bread-grid-body",children:r.jsx(Mi,{sensors:C,collisionDetection:Wu,onDragEnd:D,id:"breadIngredients-dnd",children:r.jsx(xa,{items:n.breadIngredients||[],strategy:Sl,children:(n.breadIngredients||[]).map((E,R)=>{const A=Gr(d,E?.name),O=Ap(A?.yieldPercent??A?.yield_percent??E?.yieldPercent??E?.yield_percent);return r.jsx(Ok,{id:E.id,index:R,item:E,yieldPercentApplied:O,onChange:x,onRemove:w,onSelect:T,calculatePercentage:y,onOpenConversion:()=>u({isOpen:!0,type:"ingredient",index:R})},E.id)})})})})]}),r.jsx(le,{type:"button",variant:"secondary",size:"sm",onClick:_,block:!0,style:{marginTop:"0.5rem"},children:"+ "})]}),r.jsx("div",{style:{textAlign:"center",marginTop:"1rem",marginBottom:"2rem"},children:r.jsx(le,{variant:"secondary",onClick:()=>window.history.back(),style:{width:"120px"},children:""})}),r.jsx(Xb,{isOpen:o.isOpen,onClose:()=>u({isOpen:!1,type:null,index:null}),onApply:z,ingredientName:U?.name||"",currentCost:U?.purchaseCost,currentQuantity:U?.quantity,unit:U?.unit||"g",initialPurchaseCost:U?.purchase_cost,initialContentAmount:U?.content_amount})]})},Rk=({id:n,index:t,item:i,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:f,floursLength:h,onOpenConversion:m})=>{const y=Ri(i.itemCategory??i.item_category),v=!!y,x=Zb[y]||"",S=v?`${x}${wd(y)?"10%":"8%"}`:"",{attributes:_,listeners:N,setNodeRef:w,transform:C,transition:D,isDragging:z}=wa({id:n}),T={transform:wr.Transform.toString(C),transition:D,opacity:z?.5:1,position:"relative",zIndex:z?999:"auto"};return r.jsxs("div",{ref:w,style:T,className:"form-ingredient-row--bread",children:[r.jsx("div",{..._,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),r.jsx("div",{className:"ingredient-name",children:r.jsx(bd,{value:i.name,onChange:U=>o(t,"name",U.target.value),onSelect:U=>d("flour",t,U),placeholder:": "})}),r.jsx("div",{className:"ingredient-qty",children:r.jsx(Mt,{type:"number",step:"any",value:i.quantity,onChange:U=>o(t,"quantity",U.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),r.jsx("div",{className:"ingredient-unit",children:r.jsx(Mt,{value:i.unit,onChange:U=>o(t,"unit",U.target.value),placeholder:"",style:{width:"100%",textAlign:"center"},wrapperClassName:"input-group--no-margin"})}),r.jsxs("div",{className:"bread-percent",children:[f(i.quantity),"%"]}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[r.jsx(Mt,{type:"number",step:"any",value:i.purchaseCost||"",onChange:U=>o(t,"purchaseCost",U.target.value),placeholder:i.purchaseCostRef?`Ref: ${i.purchaseCostRef}`:"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:i.purchaseCostRef?`: ${i.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",onClick:m,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",i.purchaseCostRef," ",i.vendorRef&&`(${i.vendorRef})`]})]}),r.jsxs("div",{className:"ingredient-cost",children:[r.jsx(Mt,{type:"number",step:"any",value:i.cost||"",onChange:U=>o(t,"cost",U.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Zn(a))&&Zn(a)<99.999&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const U=Zn(a),E=Math.round(U*10)/10;return`${Number.isInteger(E)?Math.round(E):E}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:i.isAlcohol||!1,onChange:U=>o(t,"isAlcohol",U.target.checked),disabled:v,style:{cursor:v?"not-allowed":"pointer"},title:v?`${S}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:h>1&&r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},Ok=({id:n,index:t,item:i,yieldPercentApplied:a,onChange:o,onRemove:u,onSelect:d,calculatePercentage:f,onOpenConversion:h})=>{const m=Ri(i.itemCategory??i.item_category),y=!!m,v=Zb[m]||"",x=y?`${v}${wd(m)?"10%":"8%"}`:"",{attributes:S,listeners:_,setNodeRef:N,transform:w,transition:C,isDragging:D}=wa({id:n}),z={transform:wr.Transform.toString(w),transition:C,opacity:D?.5:1,position:"relative",zIndex:D?999:"auto"};return r.jsxs("div",{ref:N,style:z,className:"form-ingredient-row--bread",children:[r.jsx("div",{...S,..._,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",height:"100%",touchAction:"none"},children:""}),r.jsx("div",{className:"ingredient-name",children:r.jsx(bd,{value:i.name,onChange:T=>o(t,"name",T.target.value),onSelect:T=>d("ingredient",t,T),placeholder:": "})}),r.jsx("div",{className:"ingredient-qty",children:r.jsx(Mt,{type:"number",step:"any",value:i.quantity,onChange:T=>o(t,"quantity",T.target.value),placeholder:"0",wrapperClassName:"input-group--no-margin"})}),r.jsx("div",{className:"ingredient-unit",children:r.jsx(Mt,{value:i.unit,onChange:T=>o(t,"unit",T.target.value),placeholder:"",style:{width:"100%",textAlign:"center"},wrapperClassName:"input-group--no-margin"})}),r.jsxs("div",{className:"bread-percent",children:[f(i.quantity),"%"]}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},children:[r.jsx(Mt,{type:"number",step:"any",value:i.purchaseCost||"",onChange:T=>o(t,"purchaseCost",T.target.value),placeholder:i.purchaseCostRef?`Ref: ${i.purchaseCostRef}`:"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},min:"0",title:i.purchaseCostRef?`: ${i.purchaseCostRef}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",onClick:h,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all"},children:["",i.purchaseCostRef," ",i.vendorRef&&`(${i.vendorRef})`]})]}),r.jsxs("div",{className:"ingredient-cost",children:[r.jsx(Mt,{type:"number",step:"any",value:i.cost||"",onChange:T=>o(t,"cost",T.target.value),placeholder:"",style:{width:"100%"},min:"0",wrapperClassName:"input-group--no-margin"}),Number.isFinite(Zn(a))&&Zn(a)<99.999&&r.jsxs("div",{style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},title:"",children:[": ",(()=>{const T=Zn(a),U=Math.round(T*10)/10;return`${Number.isInteger(U)?Math.round(U):U}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:i.isAlcohol||!1,onChange:T=>o(t,"isAlcohol",T.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>u(t),children:""})})]})},Dk=n=>new Promise((t,i)=>{const a=new FileReader;a.onerror=()=>i(new Error("")),a.onload=()=>{const o=String(a.result||""),u=o.includes(",")?o.split(",")[1]:o;t(u)},a.readAsDataURL(n)}),Mk={async transcribe(n,{mimeType:t,fileName:i,language:a="ja"}={}){if(!(n instanceof Blob))throw new Error("");const o=await Dk(n);if(!o)throw new Error("");const{data:u,error:d}=await _e.functions.invoke("transcribe",{body:{audioBase64:o,mimeType:t||n.type||"audio/webm",fileName:i||"voice-input.webm",language:a}});if(d)throw new Error(d.message||"");if(u?.success!==!0)throw new Error(u?.error||"");return String(u?.text||"").trim()}},zk=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/ogg;codecs=opus","audio/wav"],Lk=()=>{if(typeof MediaRecorder>"u")return"";for(const n of zk)if(MediaRecorder.isTypeSupported(n))return n;return""},Uk=()=>typeof window>"u"?!1:!!(navigator?.mediaDevices?.getUserMedia&&typeof window.MediaRecorder<"u"),Ik=n=>{let t=String(n||"").trim();return t=t.replace(/[]+$/u,""),t.trim()},Bk=(n,t)=>{const i=String(n||"").trim(),a=Ik(t);return a?i?/[.!?]$/.test(i)?`${i}
${a}`:`${i}
${a}`:a:i},sm=({onTranscript:n,getCurrentValue:t,disabled:i=!1,size:a="sm",className:o="",label:u="",language:d="ja"})=>{const f=Ui(),[h,m]=b.useState(!1),[y,v]=b.useState(!1),x=b.useRef(null),S=b.useRef(null),_=b.useRef([]),N=b.useRef(!0),w=b.useRef(!1),C=()=>{const A=S.current;A&&A.getTracks().forEach(O=>O.stop()),S.current=null},D=()=>{x.current=null,_.current=[]},z=()=>{console.warn("[VoiceInputButton] Forcing reset. Mounted:",N.current);try{C(),D()}catch(A){console.error("[VoiceInputButton] cleanup failed:",A)}finally{m(!1),v(!1)}},T=async()=>{if(!h&&!y)return;const A=x.current;if(!A){h&&z();return}try{A.state!=="inactive"?(A.stop(),m(!1),v(!0)):z()}catch(O){console.error("[VoiceInputButton] failed to stop recorder:",O),f.error(""),z()}},U=async()=>{if(!(i||h||y)){if(!Uk()){f.error("");return}try{w.current=!1;const A=await navigator.mediaDevices.getUserMedia({audio:!0});S.current=A;const O=Lk(),V=O?new MediaRecorder(A,{mimeType:O}):new MediaRecorder(A);_.current=[],V.ondataavailable=P=>{P?.data?.size>0&&_.current.push(P.data)},V.onerror=P=>{console.error("[VoiceInputButton] MediaRecorder error:",P?.error||P),C(),D(),m(!1),v(!1),f.error("")},V.onstop=async()=>{if(w.current){C(),D(),N.current&&(m(!1),v(!1));return}N.current&&(m(!1),v(!0));try{const P=V.mimeType||O||"audio/webm",F=new Blob(_.current,{type:P});if(F.size===0)throw new Error("");const Q=await Mk.transcribe(F,{mimeType:P,fileName:`voice-input.${P.includes("mp4")?"m4a":"webm"}`,language:d});if(!Q){f.warning("");return}const $=typeof t=="function"?t():"",I=Bk($,Q);n?.(I,Q),f.success("")}catch(P){console.error("[VoiceInputButton] transcription failed:",P),f.error(P?.message||"")}finally{try{C()}catch{}try{D()}catch{}m(!1),v(!1)}},x.current=V,V.start(),m(!0)}catch(A){if(console.error("[VoiceInputButton] failed to start recording:",A),A?.name==="NotAllowedError"||A?.name==="SecurityError"){f.error(""),z();return}f.error(""),z()}}};b.useEffect(()=>()=>{N.current=!1,w.current=!0;try{x.current&&x.current.state!=="inactive"&&x.current.stop()}catch{}C(),D()},[]);const E=()=>{if(!i){if(y){z();return}if(h){T();return}U()}},R=y?"...":h?"":u;return r.jsxs(le,{type:"button",variant:"secondary",size:a,onClick:E,disabled:i,className:["voice-input-btn",h?"is-recording":"",o].filter(Boolean).join(" "),title:h?"":y?"":"",children:[h?"":y?"":""," ",R]})},$k=new Set(["food","alcohol","soft_drink","supplies"]),Pk=new Set(["alcohol","supplies"]),qk={food:"",alcohol:"",soft_drink:"",supplies:""},vl=n=>{const t=String(n||"").trim().toLowerCase();return t?t==="food_alcohol"?"food":$k.has(t)?t:"":""},nd=n=>Pk.has(n),c0=(n,t)=>{const i=vl(t);return i?{...n,itemCategory:i,isAlcohol:nd(i)}:{...n,itemCategory:null}},u0=n=>String(n||"").trim().replace(/\s+/g," ").toLowerCase(),Is=(n,t)=>{if(!n||n.size===0||!t)return null;const i=n.get(t);if(i)return i;const a=u0(t);if(!a)return null;for(const[o,u]of n.entries())if(u0(o)===a)return u;return null},ur=n=>{const t=parseFloat(n);return Number.isFinite(t)?t:NaN},ew=n=>{const t=ur(n);return!Number.isFinite(t)||t<=0||t>100?100:t},ol=(n,t)=>{const i=t?.yieldPercent??t?.yield_percent??n?.yieldPercent??n?.yield_percent;return ew(i)/100},Fk=(n,t,i)=>{const a=ur(n),o=ur(t);if(!Number.isFinite(a)||!Number.isFinite(o)||o<=0)return NaN;const u=String(i||"").trim().toLowerCase();return["g","","ml","","cc",""].includes(u)?a/o*1e3:["kg","","l",""].includes(u)?a/o:["cl",""].includes(u)?a/o*100:a/o},ap=(n,t,i,a=1)=>{const o=ur(n),u=ur(t);if(!Number.isFinite(o)||!Number.isFinite(u))return NaN;const d=String(i||"").trim().toLowerCase();let f=0;["g","","ml","","cc",""].includes(d)?f=o/1e3*u:["cl",""].includes(d)?f=o*10/1e3*u:f=o*u;const h=Number.isFinite(a)&&a>0?a:1;return f/h},Hk=(n,t)=>{const i=ur(n?.purchaseCost),a=ur(n?.purchaseCostRef??n?.purchase_cost);return Number.isFinite(t)?!!(!Number.isFinite(i)||Number.isFinite(a)&&Math.abs(i-a)<1e-4&&Math.abs(i-t)>.01):!1},Vk=je.memo(({id:n,index:t,item:i,groupId:a,yieldPercentApplied:o,onChange:u,onRemove:d,handleSuggestionSelect:f,onOpenConversion:h})=>{const m=vl(i.itemCategory??i.item_category),y=!!m,v=qk[m]||"",x=y?`${v}${nd(m)?"10%":"8%"}`:"",S=y?nd(m):!!i.isAlcohol,{attributes:_,listeners:N,setNodeRef:w,transform:C,transition:D,isDragging:z}=wa({id:n,data:{groupId:a,index:t}}),T={transform:wr.Translate.toString(C),transition:D,opacity:z?.3:1,position:"relative",zIndex:z?999:"auto"};return r.jsxs("div",{ref:w,style:T,className:"form-ingredient-row",children:[r.jsx("div",{..._,...N,className:"ingredient-drag-handle",style:{cursor:"grab",padding:"0 0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",touchAction:"none"},children:""}),r.jsxs("div",{className:"ingredient-name",style:{display:"flex",alignItems:"center",gap:"4px"},children:[r.jsx(bd,{value:i.name,onChange:U=>u(a,t,"name",U.target.value),onSelect:U=>f(a,t,U),placeholder:""}),r.jsx("div",{style:{flexShrink:0},children:r.jsx(sm,{size:"xs",label:"",getCurrentValue:()=>i.name,onTranscript:U=>u(a,t,"name",U),className:"ingredient-voice-btn"})})]}),r.jsx("div",{className:"ingredient-qty",children:r.jsx(Mt,{value:i.quantity,onChange:U=>u(a,t,"quantity",U.target.value),placeholder:"0",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),r.jsx("div",{className:"ingredient-unit",children:r.jsx(Mt,{value:i.unit,onChange:U=>u(a,t,"unit",U.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"})}),r.jsxs("div",{className:"ingredient-cost",style:{position:"relative"},"data-label":"",children:[r.jsx(Mt,{type:"number",value:i.purchaseCost,onChange:U=>u(a,t,"purchaseCost",U.target.value),step:"0.01",placeholder:i.purchaseCostRef?"Ref":"",style:{width:"100%",borderColor:i.purchaseCostRef&&!i.purchaseCost?"orange":"",paddingRight:"20px"},title:i.purchaseCostRef?`: ${i.purchaseCostRef}${i.vendorRef?` (${i.vendorRef})`:""}`:"No data",wrapperClassName:"input-group--no-margin"}),r.jsx("button",{type:"button",className:"ingredient-cost-conversion-btn",onClick:h,style:{position:"absolute",right:2,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",fontSize:"1rem",padding:"0 4px",lineHeight:1},title:"",children:""}),i.purchaseCostRef&&r.jsxs("div",{className:"ingredient-cost-ref",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",wordBreak:"break-all",textAlign:"center"},children:["",i.purchaseCostRef]})]}),r.jsxs("div",{className:"ingredient-cost","data-label":"",children:[r.jsx(Mt,{type:"number",step:"0.01",value:i.cost,onChange:U=>u(a,t,"cost",U.target.value),placeholder:"",style:{width:"100%"},wrapperClassName:"input-group--no-margin"}),Number.isFinite(ur(o))&&ur(o)<99.999&&r.jsxs("div",{className:"ingredient-yield-indicator",style:{fontSize:"10px",color:"#666",lineHeight:"1.2",marginTop:"2px",textAlign:"center"},title:"",children:[": ",(()=>{const U=ur(o),E=Math.round(U*10)/10;return`${Number.isInteger(E)?Math.round(E):E}%`})()]})]}),r.jsx("div",{className:"ingredient-alcohol",style:{display:"flex",justifyContent:"center",alignItems:"center"},children:r.jsx("input",{type:"checkbox",checked:S,onChange:U=>u(a,t,"isAlcohol",U.target.checked),disabled:y,style:{cursor:y?"not-allowed":"pointer"},title:y?`${x}`:"10%"})}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(a,t),children:""})})]})},(n,t)=>n.id===t.id&&n.index===t.index&&n.groupId===t.groupId&&n.yieldPercentApplied===t.yieldPercentApplied&&JSON.stringify(n.item)===JSON.stringify(t.item)),Gk=({section:n,sections:t,onSectionChange:i,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=dc({id:n.id});return r.jsxs(un,{className:"ingredient-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[r.jsx(Mt,{value:n.name,onChange:d=>i(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),r.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&r.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),r.jsxs("div",{className:"recipe-list-header",style:{marginBottom:"0.5rem"},children:[r.jsx("span",{}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},children:""}),r.jsx("span",{style:{textAlign:"center"},title:"10%",children:"10%"}),r.jsx("span",{})]}),r.jsxs("div",{ref:u,className:"section-ingredients-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&r.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},Kk=({formData:n,setFormData:t,priceList:i})=>{const[a,o]=b.useState(new Map);b.useEffect(()=>{Un.getAllConversions().then(T=>o(T))},[]);const[u,d]=b.useState({isOpen:!1,groupId:null,index:null});b.useEffect(()=>{if(!n.ingredientSections){const T=n.ingredientGroups||[{id:"default",name:""}],U=n.ingredients||[],E=T.map(O=>({id:O.id,name:O.name,items:U.filter(V=>O.id==="default"&&!V.groupId?!0:V.groupId===O.id)})),R=new Set(E.flatMap(O=>O.items.map(V=>V.id))),A=U.filter(O=>!R.has(O.id));A.length>0&&(E.length>0?E[0].items.push(...A):E.push({id:"default",name:"",items:A})),E.length===0&&E.push({id:crypto.randomUUID(),name:"",items:[]}),t(O=>({...O,ingredientSections:E}))}},[n.ingredients,n.ingredientGroups,n.ingredientSections,t]);const f=n.ingredientSections||[];b.useEffect(()=>{if(!n.ingredientSections||n.ingredientSections.length===0||a.size===0)return;let T=!1;const U=n.ingredientSections.map(E=>{const R=E.items.map(A=>{if(!A||typeof A!="object")return A;const O=Is(a,A.name);let V=A;const P=vl(A.itemCategory??A.item_category??O?.itemCategory);if(P){const Q=nd(P);(vl(A.itemCategory??A.item_category)!==P||!!A.isAlcohol!==Q)&&(V={...V,itemCategory:P,isAlcohol:Q})}if(O&&O.packetSize){const $=[O.lastPrice,A.purchaseCostRef,A.purchase_cost,A.purchaseCost].find(k=>Number.isFinite(ur(k))),I=Fk($,O.packetSize,O.packetUnit);if(Number.isFinite(I)&&Hk(A,I)){const k=ol(A,O),L=Math.round(I*100)/100,H=ap(A.quantity,L,A.unit,k),G=Number.isFinite(H)?Math.round(H*100)/100:V.cost,ce=ur(V.purchaseCost),q=ur(V.cost),W=!Number.isFinite(ce)||Math.abs(ce-L)>.01,ie=Number.isFinite(ur(G))&&(!Number.isFinite(q)||Math.abs(q-G)>.01);(W||ie)&&(V={...V,purchaseCost:L,cost:G})}}const F=ol(A,O);if(Number.isFinite(F)&&F>0&&Math.abs(F-1)>1e-4){const Q=ap(A.quantity,V.purchaseCost,A.unit,F),$=ap(A.quantity,V.purchaseCost,A.unit,1),I=ur(V.cost);if(Number.isFinite(Q)&&(!Number.isFinite(I)||Number.isFinite($)&&Math.abs(I-$)<=.01)){const L=Math.round(Q*100)/100,H=ur(V.cost);(!Number.isFinite(H)||Math.abs(H-L)>.01)&&(V={...V,cost:L})}}return V!==A&&(T=!0),V});return R!==E.items?{...E,items:R}:E});T&&t(E=>({...E,ingredientSections:U}))},[a,n.ingredientSections,t]);const h=ba(dr(Al,{activationConstraint:{distance:10}}),dr(Rl,{activationConstraint:{delay:250,tolerance:5}}),dr(Tl,{coordinateGetter:gd})),m=({active:T,over:U})=>{if(!U)return;const E=T.id,R=U.id,A=f.find(V=>V.items.some(P=>P.id===E)),O=f.find(V=>V.items.some(P=>P.id===R))||f.find(V=>V.id===R);!A||!O||A===O||t(V=>{const P=A.items,F=O.items,Q=P.findIndex(k=>k.id===E),$=F.findIndex(k=>k.id===R);let I;if(R===O.id)I=F.length+1;else{const L=U&&T.rect.current.translated&&T.rect.current.translated.top>U.rect.top+U.rect.height?1:0;I=$>=0?$+L:F.length+1}return{...V,ingredientSections:V.ingredientSections.map(k=>k.id===A.id?{...k,items:P.filter(L=>L.id!==E)}:k.id===O.id?{...k,items:[...F.slice(0,I),P[Q],...F.slice(I,F.length)]}:k)}})},y=({active:T,over:U})=>{if(!U)return;const E=T.id,R=U.id,A=f.find(V=>V.items.some(P=>P.id===E)),O=f.find(V=>V.items.some(P=>P.id===R))||f.find(V=>V.id===R);if(A&&O&&A===O){const V=A.items.findIndex(F=>F.id===E),P=O.items.findIndex(F=>F.id===R);V!==P&&t(F=>({...F,ingredientSections:F.ingredientSections.map(Q=>Q.id===A.id?{...Q,items:Li(Q.items,V,P)}:Q)}))}},v=(T,U,E,R)=>{const{groupId:A,index:O}=u;A!==null&&O!==null&&t(V=>{const P=V.ingredientSections.map(F=>{if(F.id!==A)return F;const Q=[...F.items],$={...Q[O],purchaseCost:T,unit:U,purchase_cost:E,content_amount:R},I=parseFloat($.quantity),k=parseFloat(T);if(!isNaN(I)&&!isNaN(k)){const L=Is(a,$.name),H=ol($,L),G=U?U.trim().toLowerCase():"";let ce=0;G==="g"||G===""||G==="ml"||G===""||G==="cc"||G===""?ce=I/1e3*k:G==="cl"||G===""?ce=I*10/1e3*k:ce=I*k;const q=Number.isFinite(H)&&H>0?H:1;$.cost=Math.round(ce/q*100)/100}return Q[O]=$,{...F,items:Q}});return Un.getAllConversions().then(F=>o(F)),tc.invalidateCache(),{...V,ingredientSections:P}})},x=u.isOpen&&u.groupId!==null&&u.index!==null?f.find(T=>T.id===u.groupId)?.items[u.index]:null,S=je.useCallback((T,U,E,R)=>{t(A=>{const O=A.ingredientSections.map(V=>{if(V.id!==T)return V;const P=[...V.items],F={...P[U],[E]:R};if(P[U]=F,["quantity","purchaseCost","unit","name","isAlcohol"].includes(E)){const Q=parseFloat(F.quantity),$=parseFloat(F.purchaseCost),I=Is(a,F.name),k=ol(F,I),L=Number.isFinite(k)&&k>0?k:1;if(!isNaN(Q)&&!isNaN($)){let H=0;const G=F.unit?F.unit.trim().toLowerCase():"";G==="g"||G===""||G==="ml"||G===""||G==="cc"||G===""?H=Q/1e3*$:G==="cl"||G===""?H=Q*10/1e3*$:H=Q*$;const ce=Math.round(H/L*100)/100;ce!==F.cost&&(F.cost=ce,P[U]=F)}}if(E==="name"){const Q=i.get(Jt(R)),$=Is(a,R),I=vl($?.itemCategory);if(I){const k=c0(F,I);Object.assign(F,k)}else Q||(F.itemCategory=null);if(Q){const k=typeof Q=="object"?Q.price:Q,L=typeof Q=="object"?Q.vendor:null,H=typeof Q=="object"?Q.unit:null,G=typeof Q=="object"?Q.size:null;if(F.purchaseCostRef=k,F.vendorRef=L,$&&$.packetSize){const W=$.lastPrice!==null&&$.lastPrice!==void 0&&$.lastPrice!==""?$.lastPrice:k;let ie=0;const ve=($.packetUnit||"").trim().toLowerCase();["g",""].includes(ve)?(ie=W/$.packetSize*1e3,F.unit="g"):["kg",""].includes(ve)?(ie=W/$.packetSize,F.unit="g"):["ml","","cc",""].includes(ve)?(ie=W/$.packetSize*1e3,F.unit="ml"):["l",""].includes(ve)?(ie=W/$.packetSize,F.unit="ml"):["cl",""].includes(ve)?(ie=W/$.packetSize*100,F.unit="ml"):(ie=W/$.packetSize,F.unit=$.packetUnit),F.purchaseCost=Math.round(ie*100)/100}else{let W=k,ie=H;G&&G>1&&(["g",""].includes((H||"").toLowerCase())?(W=k/G*1e3,ie="g"):["ml","","cc",""].includes((H||"").toLowerCase())?(W=k/G*1e3,ie="ml"):["cl",""].includes((H||"").toLowerCase())?(W=k/G*100,ie="ml"):["kg",""].includes(H?H.toLowerCase():"")?(W=k/G,ie="g"):["l",""].includes(H?H.toLowerCase():"")?(W=k/G,ie="ml"):W=k/G),F.purchaseCost||(F.purchaseCost=Math.round(W*100)/100),!F.unit&&ie&&(F.unit=ie)}const ce=parseFloat(F.quantity),q=parseFloat(F.purchaseCost);if(!isNaN(ce)&&!isNaN(q)){const W=Is(a,F.name),ie=ol(F,W),ve=Number.isFinite(ie)&&ie>0?ie:1,xe=F.unit?F.unit.trim().toLowerCase():"";let Ne=0;xe==="g"||xe===""||xe==="ml"||xe===""||xe==="cc"||xe===""?Ne=ce/1e3*q:xe==="cl"||xe===""?Ne=ce*10/1e3*q:Ne=ce*q,F.cost=Math.round(Ne/ve*100)/100}}else F.purchaseCostRef=null,F.vendorRef=null;P[U]=F}return{...V,items:P}});return{...A,ingredientSections:O}})},[a,i,t]),_=je.useCallback((T,U,E)=>{t(R=>{const A=R.ingredientSections.map(O=>{if(O.id!==T)return O;const V=[...O.items],P={...V[U]};if(P.name=E.name,P.itemCategory=null,E.price)if(P.purchaseCostRef=E.price,P.vendorRef=E.source==="csv"?"CSV":"Master",E.source==="manual")if(E.size&&E.size>0){const I=(E.unit||"").trim().toLowerCase();if(["g",""].includes(I)){const k=E.price/E.size*1e3;P.purchaseCost=Math.round(k*100)/100,P.unit="g"}else if(["kg",""].includes(I)){const k=E.price/E.size;P.purchaseCost=Math.round(k*100)/100,P.unit="g"}else if(["ml","","cc",""].includes(I)){const k=E.price/E.size*1e3;P.purchaseCost=Math.round(k*100)/100,P.unit="ml"}else if(["l",""].includes(I)){const k=E.price/E.size;P.purchaseCost=Math.round(k*100)/100,P.unit="ml"}else if(["cl",""].includes(I)){const k=E.price/E.size*100;P.purchaseCost=Math.round(k*100)/100,P.unit="ml"}else{const k=E.price/E.size;P.purchaseCost=Math.round(k*100)/100,P.unit=E.unit}}else P.purchaseCost=E.price,P.unit=E.unit;else{const I=Is(a,E.name);if(I&&I.packetSize){const k=I.lastPrice!==null&&I.lastPrice!==void 0&&I.lastPrice!==""?I.lastPrice:E.price;let L=0;const H=(I.packetUnit||"").trim().toLowerCase();["g",""].includes(H)?(L=k/I.packetSize*1e3,P.unit="g"):["kg",""].includes(H)?(L=k/I.packetSize,P.unit="g"):["ml","","cc",""].includes(H)?(L=k/I.packetSize*1e3,P.unit="ml"):["l",""].includes(H)?(L=k/I.packetSize,P.unit="ml"):["cl",""].includes(H)?(L=k/I.packetSize*100,P.unit="ml"):(L=k/I.packetSize,P.unit=I.packetUnit),P.purchaseCost=Math.round(L*100)/100}else P.purchaseCost=E.price,P.unit=E.unit}const F=vl(E.itemCategory??E.item_category??Is(a,E.name)?.itemCategory);if(F){const I=c0(P,F);Object.assign(P,I)}const Q=parseFloat(P.quantity),$=parseFloat(P.purchaseCost);if(!isNaN(Q)&&!isNaN($)){const I=Is(a,P.name),k=ol(P,I),L=Number.isFinite(k)&&k>0?k:1,H=P.unit?P.unit.trim().toLowerCase():"";let G=0;H==="g"||H===""||H==="ml"||H===""||H==="cc"||H===""?G=Q/1e3*$:H==="cl"||H===""?G=Q*10/1e3*$:G=Q*$,P.cost=Math.round(G/L*100)/100}return V[U]=P,{...O,items:V}});return{...R,ingredientSections:A}})},[a,t]),N=je.useCallback((T,U)=>{t(E=>({...E,ingredientSections:E.ingredientSections.map(R=>R.id===T?{...R,items:R.items.filter((A,O)=>O!==U)}:R)}))},[t]),w=T=>{const U={id:crypto.randomUUID(),name:"",quantity:"",unit:"",cost:"",purchaseCost:"",isAlcohol:!1,itemCategory:null};t(E=>({...E,ingredientSections:E.ingredientSections.map(R=>R.id===T?{...R,items:[...R.items,U]}:R)}))},C=()=>{t(T=>({...T,ingredientSections:[...T.ingredientSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},D=T=>{t(U=>({...U,ingredientSections:U.ingredientSections.filter(E=>E.id!==T)}))},z=(T,U)=>{t(E=>({...E,ingredientSections:E.ingredientSections.map(R=>R.id===T?{...R,name:U}:R)}))};return r.jsxs(Mi,{sensors:h,collisionDetection:Z0,onDragOver:m,onDragEnd:y,children:[r.jsxs("div",{className:"recipe-form-ingredients",children:[f.map(T=>r.jsx(xa,{id:T.id,items:T.items.map(U=>U.id),strategy:Sl,children:r.jsxs(Gk,{section:T,sections:f,onSectionChange:z,onRemoveSection:D,children:[T.items.map((U,E)=>(()=>{const R=Is(a,U?.name),A=ew(R?.yieldPercent??R?.yield_percent??U?.yieldPercent??U?.yield_percent);return r.jsx(Vk,{id:U.id,index:E,item:U,groupId:T.id,yieldPercentApplied:A,onChange:S,onRemove:N,handleSuggestionSelect:_,onOpenConversion:()=>d({isOpen:!0,groupId:T.id,index:E})},U.id)})()),r.jsx(le,{type:"button",variant:"ghost",onClick:()=>w(T.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},T.id)),r.jsx(le,{type:"button",variant:"secondary",onClick:C,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),r.jsx(Jp,{dropAnimation:{sideEffects:Qp({styles:{active:{opacity:"0.5"}}})},children:null}),r.jsx(Xb,{isOpen:u.isOpen,onClose:()=>d({isOpen:!1,groupId:null,index:null}),onApply:v,ingredientName:x?.name||"",currentCost:x?.purchaseCost,currentQuantity:x?.quantity,unit:x?.unit||"g",initialPurchaseCost:x?.purchase_cost,initialContentAmount:x?.content_amount})]})},Yk=({id:n,index:t,item:i,groupId:a,voiceInputEnabled:o,onChange:u,onRemove:d,onVoiceAppend:f})=>{const{attributes:h,listeners:m,setNodeRef:y,transform:v,transition:x,isDragging:S}=wa({id:n,data:{groupId:a,index:t}}),_={transform:wr.Translate.toString(v),transition:x,opacity:S?.3:1,position:"relative",zIndex:S?999:"auto"};return r.jsxs("div",{ref:y,style:{..._,display:"flex",gap:"0.5rem",marginBottom:"0.5rem",alignItems:"flex-start"},className:"step-row",children:[r.jsx("div",{...h,...m,className:"step-drag-handle",style:{cursor:"grab",padding:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",color:"#ccc",alignSelf:"stretch",touchAction:"none"},children:""}),r.jsx("div",{className:"step-count",style:{display:"flex",alignItems:"center",justifyContent:"center",minWidth:"24px",height:"24px",borderRadius:"50%",background:"#eee",fontSize:"0.8rem",fontWeight:"bold",marginTop:"8px"},children:t+1}),r.jsxs("div",{style:{flex:1},children:[r.jsx(Mt,{textarea:!0,value:i.text,onChange:N=>u(a,t,N.target.value),placeholder:` ${t+1}...`,style:{minHeight:"60px",width:"100%"}}),o&&r.jsx("div",{className:"step-row__voice-action",children:r.jsx(sm,{label:"",getCurrentValue:()=>i.text,onTranscript:N=>f(a,t,N)})})]}),r.jsx("div",{className:"remove-button-cell",children:r.jsx("button",{type:"button",className:"icon-btn-delete",onClick:()=>d(a,t),title:"",children:""})})]})},Wk=({section:n,sections:t,onSectionChange:i,onRemoveSection:a,children:o})=>{const{setNodeRef:u}=dc({id:n.id});return r.jsxs(un,{className:"step-section mb-md",style:{border:"1px solid #e0e0e0",boxShadow:"none"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem",borderBottom:"1px solid #f0f0f0",paddingBottom:"0.5rem"},children:[r.jsx(Mt,{value:n.name,onChange:d=>i(n.id,d.target.value),placeholder:" (: )",className:"section-header-input",style:{fontWeight:"bold",border:"none",background:"transparent",fontSize:"1.05rem",padding:"4px",width:"70%"}}),r.jsx("div",{style:{display:"flex",gap:"8px"},children:t.length>1&&r.jsx("button",{type:"button",onClick:()=>a(n.id),className:"group-delete-btn",children:""})})]}),r.jsxs("div",{ref:u,className:"section-steps-list",style:{minHeight:"50px",transition:"min-height 0.2s",paddingBottom:"10px"},children:[o,n.items.length===0&&r.jsx("div",{className:"recipe-form-drop-placeholder",style:{padding:"10px",textAlign:"center",color:"#aaa",fontSize:"0.85rem",border:"1px dashed #ddd",borderRadius:"4px"},children:""})]})]})},Qk=({formData:n,setFormData:t,voiceInputEnabled:i=!1})=>{b.useEffect(()=>{if(!n.stepSections){const _=n.stepGroups||[{id:"default",name:""}],w=(n.steps||[]||[]).map(T=>typeof T=="string"?{id:crypto.randomUUID(),text:T}:T),C=_.map(T=>({id:T.id,name:T.name,items:w.filter(U=>T.id==="default"&&!U.groupId?!0:U.groupId===T.id)})),D=new Set(C.flatMap(T=>T.items.map(U=>U.id))),z=w.filter(T=>!D.has(T.id));z.length>0&&(C.length>0?C[0].items.push(...z):C.push({id:"default",name:"",items:z})),C.length===0&&C.push({id:crypto.randomUUID(),name:"",items:[]}),t(T=>({...T,stepSections:C}))}},[n.steps,n.stepGroups,n.stepSections,t]);const a=n.stepSections||[],o=ba(dr(Al,{activationConstraint:{distance:10}}),dr(Rl,{activationConstraint:{delay:250,tolerance:5}}),dr(Tl,{coordinateGetter:gd})),u=({active:_,over:N})=>{if(!N)return;const w=_.id,C=N.id,D=a.find(T=>T.items.some(U=>U.id===w)),z=a.find(T=>T.items.some(U=>U.id===C))||a.find(T=>T.id===C);!D||!z||D===z||t(T=>{const U=D.items,E=z.items,R=U.findIndex(V=>V.id===w),A=E.findIndex(V=>V.id===C);let O;if(C===z.id)O=E.length+1;else{const P=N&&_.rect.current.translated&&_.rect.current.translated.top>N.rect.top+N.rect.height?1:0;O=A>=0?A+P:E.length+1}return{...T,stepSections:T.stepSections.map(V=>V.id===D.id?{...V,items:U.filter(P=>P.id!==w)}:V.id===z.id?{...V,items:[...E.slice(0,O),U[R],...E.slice(O,E.length)]}:V)}})},d=({active:_,over:N})=>{if(!N)return;const w=_.id,C=N.id,D=a.find(T=>T.items.some(U=>U.id===w)),z=a.find(T=>T.items.some(U=>U.id===C))||a.find(T=>T.id===C);if(D&&z&&D===z){const T=D.items.findIndex(E=>E.id===w),U=z.items.findIndex(E=>E.id===C);T!==U&&t(E=>({...E,stepSections:E.stepSections.map(R=>R.id===D.id?{...R,items:Li(R.items,T,U)}:R)}))}},f=(_,N,w)=>{t(C=>({...C,stepSections:C.stepSections.map(D=>{if(D.id!==_)return D;const z=[...D.items];return z[N]={...z[N],text:w},{...D,items:z}})}))},h=(_,N)=>{t(w=>({...w,stepSections:w.stepSections.map(C=>C.id===_?{...C,items:C.items.filter((D,z)=>z!==N)}:C)}))},m=(_,N,w)=>{t(C=>({...C,stepSections:C.stepSections.map(D=>{if(D.id!==_)return D;const z=[...D.items];return z[N]={...z[N],text:w},{...D,items:z}})}))},y=_=>{const N={id:crypto.randomUUID(),text:""};t(w=>({...w,stepSections:w.stepSections.map(C=>C.id===_?{...C,items:[...C.items,N]}:C)}))},v=()=>{t(_=>({..._,stepSections:[..._.stepSections,{id:crypto.randomUUID(),name:"",items:[]}]}))},x=_=>{t(N=>({...N,stepSections:N.stepSections.filter(w=>w.id!==_)}))},S=(_,N)=>{t(w=>({...w,stepSections:w.stepSections.map(C=>C.id===_?{...C,name:N}:C)}))};return r.jsxs(Mi,{sensors:o,collisionDetection:Z0,onDragOver:u,onDragEnd:d,children:[r.jsxs("div",{className:"recipe-form-steps",children:[a.map(_=>r.jsx(xa,{id:_.id,items:_.items.map(N=>N.id),strategy:Sl,children:r.jsxs(Wk,{section:_,sections:a,onSectionChange:S,onRemoveSection:x,children:[_.items.map((N,w)=>r.jsx(Yk,{id:N.id,index:w,item:N,groupId:_.id,voiceInputEnabled:i,onChange:f,onRemove:h,onVoiceAppend:m},N.id)),r.jsx(le,{type:"button",variant:"ghost",onClick:()=>y(_.id),style:{width:"100%",marginTop:"0.5rem",borderStyle:"dashed"},children:"+ "})]})},_.id)),r.jsx(le,{type:"button",variant:"secondary",onClick:v,style:{width:"100%",marginTop:"1rem",padding:"1rem"},children:"+ "})]}),r.jsx(Jp,{dropAnimation:{sideEffects:Qp({styles:{active:{opacity:"0.5"}}})},children:null})]})},Jk="voice_input_enabled",Xk=15*1e3,rd=new Map,Ou=(n,t)=>{rd.set(n,{value:t===!0,expiresAt:Date.now()+Xk})},Zk=n=>{const t=rd.get(n);return t?Date.now()>t.expiresAt?(rd.delete(n),null):t.value:null},eT=async n=>{const{data:t,error:i}=await _e.rpc("get_feature_flag",{p_key:n});if(i)throw i;return t===!0},tT=async n=>{const{data:t,error:i}=await _e.from("app_feature_flags").select("enabled").eq("feature_key",n).maybeSingle();if(i)throw i;return t?.enabled===!0},Rp={async getFlag(n,{force:t=!1}={}){if(!t){const i=Zk(n);if(i!==null)return i}try{const i=await eT(n);return Ou(n,i),i}catch(i){console.warn("[featureFlagService] RPC get_feature_flag failed, fallback to table:",i);const a=await tT(n);return Ou(n,a),a}},async setFlag(n,t){const i=t===!0;try{const{data:a,error:o}=await _e.rpc("admin_set_feature_flag",{p_key:n,p_enabled:i});if(o)throw o;return Ou(n,a?.enabled===!0),a?.enabled===!0}catch(a){console.warn("[featureFlagService] RPC admin_set_feature_flag failed, fallback to table:",a);const{data:o,error:u}=await _e.from("app_feature_flags").upsert({feature_key:n,enabled:i,updated_at:new Date().toISOString()},{onConflict:"feature_key"}).select("enabled").single();if(u)throw u;const d=o?.enabled===!0;return Ou(n,d),d}},async getVoiceInputEnabled(n){return!0},async setVoiceInputEnabled(n){return this.setFlag(Jk,n)},clearCache(){rd.clear()}},tw=({onClose:n,onImport:t,initialMode:i="url"})=>{const a=Ui(),[o,u]=b.useState(i),[d,f]=b.useState(null),[h,m]=b.useState(""),[y,v]=b.useState(""),[x,S]=b.useState(null),[_,N]=b.useState(null),w="auto",[C,D]=b.useState(()=>{try{return localStorage.getItem("preferredImageEngine")||w}catch{return w}}),[z,T]=b.useState(!1),[U,E]=b.useState(!1),[R,A]=b.useState(null),[O,V]=b.useState(!1),P=b.useRef(null),F=b.useRef(null),Q=b.useRef(null),$=b.useRef(null),I=()=>{$.current&&(clearTimeout($.current),$.current=null)},k=(ae="")=>{if(I(),Q.current){try{Q.current.abort()}catch{}Q.current=null}E(!1),ae&&A(ae)};b.useEffect(()=>()=>{if(I(),Q.current){try{Q.current.abort()}catch{}Q.current=null}},[]),b.useEffect(()=>{if(!x){N(null);return}const ae=URL.createObjectURL(x);return N(ae),()=>URL.revokeObjectURL(ae)},[x]),b.useEffect(()=>{try{localStorage.setItem("preferredImageEngine",C)}catch{}},[C]);const L=ae=>new Promise(Se=>{if(!ae||typeof ae!="object")return Se(ae);const Re=String(ae.type||"").toLowerCase();if(!Re.startsWith("image/"))return Se(ae);const Oe=2e6,He=2e3,nt=.9,ot=String(ae.name||"").toLowerCase(),Fe=Re.includes("heic")||Re.includes("heif")||ot.endsWith(".heic")||ot.endsWith(".heif"),Ce=URL.createObjectURL(ae);let Ee=!1;const se=gt=>{if(!Ee){Ee=!0;try{URL.revokeObjectURL(Ce)}catch{}Se(gt)}},Pe=setTimeout(()=>se(ae),15e3),dt=new Image;dt.onload=()=>{const gt=dt.naturalWidth||dt.width||0,ct=dt.naturalHeight||dt.height||0;if(!gt||!ct)return clearTimeout(Pe),se(ae);const Qe=Math.min(1,He/Math.max(gt,ct)),it=Math.max(1,Math.round(gt*Qe)),tt=Math.max(1,Math.round(ct*Qe)),ut=Qe<1,qt=Fe||ae.size>Oe;if(!ut&&!qt)return clearTimeout(Pe),se(ae);const $t=document.createElement("canvas");$t.width=it,$t.height=tt;const an=$t.getContext("2d");if(!an)return clearTimeout(Pe),se(ae);an.drawImage(dt,0,0,it,tt),$t.toBlob(Ht=>{if(clearTimeout(Pe),!Ht)return se(ae);const rn=String(ae.name||"recipe").replace(/\.[^/.]+$/,"").slice(0,80);se(new File([Ht],`${rn}.jpg`,{type:"image/jpeg"}))},"image/jpeg",nt)},dt.onerror=()=>{clearTimeout(Pe),se(ae)},dt.src=Ce}),H=async ae=>{if(ae){if(!String(ae.type||"").startsWith("image/")){A("");return}A(null),T(!0);try{const Se=await L(ae);S(Se||ae)}finally{T(!1)}}},G=()=>P.current?.click?.(),ce=()=>F.current?.click?.(),q=ae=>{ae.preventDefault(),ae.stopPropagation(),ae.type==="dragenter"||ae.type==="dragover"?V(!0):ae.type==="dragleave"&&V(!1)},W=ae=>{if(ae.preventDefault(),ae.stopPropagation(),V(!1),ae.dataTransfer.files&&ae.dataTransfer.files[0]){const Se=ae.dataTransfer.files[0];Se.type.startsWith("image/")&&H(Se)}},ie=ae=>/[---]/.test(ae||""),ve=ae=>typeof ae=="string"?ae.trim():ae&&typeof ae=="object"?String(ae.text||ae.name||"").trim():"",xe=async ae=>{const Se=[];Se.push((ae.name||ae.title||"").trim()),Se.push((ae.description||"").trim());const Re=[];Array.isArray(ae.ingredients)&&ae.ingredients.forEach((ct,Qe)=>{if(typeof ct=="string"){const tt=ct.trim();if(!tt)return;Se.push(tt),Re.push(Qe);return}const it=String(ct?.name||ct?.text||"").trim();it&&(Se.push(it),Re.push(Qe))});const Oe=[];if(Array.isArray(ae.steps)&&ae.steps.forEach((ct,Qe)=>{const it=ve(ct);it&&(Se.push(it),Oe.push(Qe))}),!Se.some(ct=>String(ct||"").trim()))return ae;const{data:He,error:nt}=await _e.auth.refreshSession(),ot=He?.session;if(nt||!ot?.access_token){const ct=nt?.message||"",Qe=/refresh_token|session|expired|invalid|not found/i.test(ct);throw new Error(Qe?"":ct||"")}const Fe=`${Ho}/functions/v1/translate`,Ce=await fetch(Fe,{method:"POST",headers:{"Content-Type":"application/json",apikey:$u,Authorization:`Bearer ${ot.access_token}`},body:JSON.stringify({text:Se,target_lang:"JA"})});if(!Ce.ok){const ct=Ce.status;if(ct===401)throw new Error("");let Qe="";try{const it=await Ce.text();if(it)try{const tt=JSON.parse(it);Qe=tt?.error||tt?.message||it}catch{Qe=it}}catch{}throw new Error(Qe||`: ${ct}`)}const Ee=await Ce.json();if(Ee&&Ee.error)throw new Error(String(Ee.error));if(!Array.isArray(Ee?.translations))throw new Error("");const se=Ee.translations.map(ct=>ct.text);let Pe=0;const dt={...ae},gt=se[Pe++]||dt.name||dt.title||"";if(dt.name=gt,dt.title=gt,dt.description=se[Pe++]||dt.description,Re.length>0){const ct=new Map;Re.forEach((Qe,it)=>{ct.set(Qe,se[Pe+it])}),dt.ingredients=dt.ingredients.map((Qe,it)=>{const tt=ct.get(it);return tt?typeof Qe=="string"?tt:Qe&&typeof Qe=="object"?{...Qe,name:tt}:Qe:Qe}),Pe+=Re.length}if(Oe.length>0){const ct=new Map;Oe.forEach((Qe,it)=>{ct.set(Qe,se[Pe+it])}),dt.steps=dt.steps.map((Qe,it)=>{const tt=ct.get(it);return tt?Qe&&typeof Qe=="object"?{...Qe,text:tt}:tt:Qe})}return dt},[Ne,de]=b.useState([]),K=async()=>{E(!0),A(null),de([]);try{let ae,Se="";if(o==="url"){if(!y)return;Se=y;const{data:nt,error:ot}=await _e.auth.refreshSession(),Fe=nt?.session;if(ot||!Fe?.access_token){const Pe=ot?.message||"",dt=/refresh_token|session|expired|invalid|not found/i.test(Pe);throw new Error(dt?"":Pe||"")}const Ce=`${Ho}/functions/v1/scrape-recipe`,Ee=await fetch(Ce,{method:"POST",headers:{"Content-Type":"application/json",apikey:$u,Authorization:`Bearer ${Fe.access_token}`},body:JSON.stringify({url:y})});if(!Ee.ok){const Pe=Ee.status;if(Pe===401)throw new Error("");if(Pe===403)throw new Error("URL");if(Pe>=500)throw new Error("");let dt="";try{const gt=await Ee.text();if(gt)try{const ct=JSON.parse(gt);dt=ct?.error||ct?.message||gt}catch{dt=gt}}catch{}throw new Error(dt||`URL: ${Pe}`)}ae=await Ee.json()}else{if(!x)return;I();const nt=new AbortController;Q.current=nt;const ot=12e4;$.current=setTimeout(()=>{k("")},ot),de(tt=>[...tt," ..."]);const Fe=new FormData;Fe.append("image",x),Fe.append("engine",C);const Ce=Ho,Ee=$u,se=`${Ce}/functions/v1/analyze-image`,{data:Pe,error:dt}=await _e.auth.refreshSession(),gt=Pe?.session;if(dt||!gt?.access_token){const tt=dt?.message||"",ut=/refresh_token|session|expired|invalid/i.test(tt);throw new Error(ut?"":tt||"")}const ct=gt.access_token,Qe={apikey:Ee,Authorization:`Bearer ${ct}`,"X-User-JWT":ct};let it;try{it=await fetch(se,{method:"POST",headers:Qe,body:Fe,signal:nt.signal})}catch(tt){throw console.error("Network Error:",tt),new Error("")}if(it.status===401){let tt="";try{tt=await it.text()}catch{}if(/invalid\s+jwt|jwt\s+expired|token\s+expired/i.test(String(tt||"")))try{const{data:qt,error:$t}=await _e.auth.refreshSession(),an=qt?.session;if($t||!an?.access_token)throw $t||new Error("No session after refresh");const Ht=an.access_token;Qe.Authorization=`Bearer ${Ht}`,Qe["X-User-JWT"]=Ht,it=await fetch(se,{method:"POST",headers:Qe,body:Fe,signal:nt.signal})}catch(qt){throw console.warn("Session refresh failed:",qt),new Error("")}}if(!it.ok){const tt=it.status;let ut="";try{const $t=await it.text();if($t)try{const an=JSON.parse($t);ut=an?.message||an?.error||$t}catch{ut=$t}}catch{}const qt=ut?`: ${ut}`:"";throw new Error(`Server Error (${tt})${qt}`)}if(!it.body)ae=await it.json();else{const tt=it.body.getReader(),ut=new TextDecoder;let qt=null,$t="",an=!1;for(;;){const{done:Ht,value:rn}=await tt.read();if(Ht)break;$t+=ut.decode(rn,{stream:!0});const sn=$t.split(`

`);$t=sn.pop()||"";for(const Kt of sn){const In=Kt.trim();if(In.startsWith("data: "))try{const mn=JSON.parse(In.slice(6));if(mn.type==="log")de(ee=>[...ee,mn.message]);else if(mn.type==="result")qt=mn,an=!0;else if(mn.type==="error")throw new Error(mn.message)}catch(mn){if(mn.message&&!mn.message.includes("Failed to parse"))throw mn;console.warn("Failed to parse SSE event",mn)}}if(an)break}try{await tt.cancel()}catch{}if(!qt)throw new Error("");ae=qt}}if(ae.error)throw new Error(ae.error);if(!ae.recipe)throw new Error("No recipe found");let Re=ae.recipe;if(Re.title=Re.title||Re.name||"",Re.name=Re.name||Re.title||"",Re.recipeYield=Re.recipeYield||Re.servings||"",Re.description=Re.description||"",!Re.ingredients&&Re.recipeIngredient&&(Re.ingredients=Re.recipeIngredient),Array.isArray(Re.ingredients)){const nt=["","","method","instructions","steps","preparation"],ot=[],Fe=[];Re.ingredients.forEach(Ce=>{const Ee=(Ce.group||"").trim().toLowerCase();if(Ee&&nt.some(se=>Ee===se||Ee.includes(se))){const se=Ce.name||Ce.text||"";se&&Fe.push(se)}else ot.push(Ce)}),Fe.length>0&&(console.log("Extracted steps from ingredients:",Fe),Re.ingredients=ot,Re.steps=Array.isArray(Re.steps)?Re.steps:[],Re.steps=[...Re.steps,...Fe])}const Oe=Array.isArray(Re.steps)?Re.steps.slice(0,3).map(nt=>ve(nt)).join(""):"",He=`${Re.name||Re.title||""}${Oe}`;if(He&&!ie(He)){f(Re),m(Se),u("confirm-translation"),E(!1);return}t(Re,Se),n()}catch(ae){if(console.error("Import failed details:",ae),ae?.name==="AbortError")return;const Se=ae.message||"Import failed. Please try again.";A(Se)}finally{I(),Q.current=null,o!=="confirm-translation"&&E(!1)}},ge=async ae=>{E(!0),A(null);try{let Se=d;ae&&(Se=await xe(d)),t(Se,h),n()}catch(Se){console.error("Translation flow error:",Se);const Re=Se?.message||"";A(Re),a.warning(Re)}finally{E(!1)}},Ae=ae=>{const Se=ae.target.files[0];Se&&H(Se),ae.target.value=""};return r.jsxs("div",{className:"modal-overlay fade-in",children:[U&&r.jsx("div",{className:"analyze-status-popup",role:"status","aria-live":"polite",children:r.jsxs("div",{className:"analyze-status-popup-inner",children:[r.jsx("div",{className:"spinner"}),r.jsx("p",{className:"analyze-status-title",children:"..."}),Ne.length>0&&r.jsx("div",{className:"progress-log-container",children:r.jsxs("div",{className:"progress-log",children:[Ne.map((ae,Se)=>r.jsx("div",{className:"log-entry",children:r.jsx("span",{className:"log-message",children:ae})},Se)),r.jsx("div",{ref:ae=>ae?.scrollIntoView({behavior:"smooth"})})]})}),r.jsx("div",{className:"analyze-status-actions",children:r.jsx(le,{type:"button",variant:"secondary",onClick:()=>k(),children:""})})]})}),r.jsxs(un,{className:"import-modal-card",children:[r.jsx("h3",{className:"modal-title",children:o==="confirm-translation"?"":""}),o==="confirm-translation"?r.jsxs("div",{className:"translation-confirm-content",children:[r.jsxs("div",{style:{textAlign:"center",padding:"1rem 0",marginBottom:"1rem"},children:[r.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"  "}),r.jsx("p",{style:{fontWeight:"bold",marginBottom:"0.5rem"},children:""}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:["",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.8rem"},children:"(DeepL)"})]})]}),R&&r.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto",marginBottom:"12px"},children:R}),r.jsxs("div",{className:"modal-actions",style:{flexDirection:"column",gap:"8px"},children:[r.jsx(le,{type:"button",variant:"primary",onClick:()=>ge(!0),isLoading:U,style:{width:"100%"},children:""}),r.jsx(le,{type:"button",variant:"secondary",onClick:()=>ge(!1),disabled:U,style:{width:"100%"},children:""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"import-mode-tabs",children:[r.jsx("button",{type:"button",onClick:()=>u("url"),className:`tab-btn tab-import-web ${o==="url"?"active":""}`,children:" Web URL"}),r.jsx("button",{type:"button",onClick:()=>u("image"),className:`tab-btn tab-import-image ${o==="image"?"active":""}`,children:"  (Best Effort)"})]}),o==="url"?r.jsxs(r.Fragment,{children:[r.jsx("p",{children:"URL"}),r.jsx("input",{type:"url",placeholder:"https://...",value:y,onChange:ae=>v(ae.target.value),className:"import-url-input",autoFocus:!0})]}):r.jsxs(r.Fragment,{children:[r.jsx("p",{children:""}),r.jsxs("div",{className:"image-engine-panel",children:[r.jsxs("label",{className:"image-engine-label",children:["",r.jsxs("select",{className:"image-engine-select",value:C,onChange:ae=>D(ae.target.value),disabled:U||z,children:[r.jsx("option",{value:"groq",children:"Groq"}),r.jsx("option",{value:"auto",children:"Best EffortGroqAzure OCRGroqGemini"}),r.jsx("option",{value:"gemini",children:"Gemini"}),r.jsx("option",{value:"groq_vision",children:"Groq"})]})]}),r.jsx("div",{className:"image-engine-help",children:"AIGroqBest EffortGeminiGemini"})]}),r.jsxs("div",{className:"image-upload-wrapper",children:[r.jsx("input",{ref:P,type:"file",accept:"image/*",capture:"environment",onChange:Ae,className:"image-upload-input"}),r.jsx("input",{ref:F,type:"file",accept:"image/*",onChange:Ae,className:"image-upload-input"}),r.jsx("div",{onDragEnter:q,onDragLeave:q,onDragOver:q,onDrop:W,className:`image-upload-label ${O?"drag-active":""}`,role:"button",tabIndex:0,onClick:()=>{U||z||ce()},onKeyDown:ae=>{U||z||(ae.key==="Enter"||ae.key===" ")&&(ae.preventDefault(),ce())},children:_?r.jsx("img",{src:_,alt:"Preview",className:"image-upload-preview"}):O?"":""}),r.jsxs("div",{className:"image-upload-actions",children:[r.jsx(le,{type:"button",variant:"secondary",onClick:G,disabled:U||z,children:""}),r.jsx(le,{type:"button",variant:"secondary",onClick:ce,disabled:U||z,children:""})]})]}),z&&r.jsx("p",{style:{fontSize:"0.85rem",opacity:.8,marginTop:"0.5rem"},children:"..."})]}),R&&r.jsx("div",{className:"error-text",style:{color:"#d32f2f",background:"#ffebee",padding:"10px",borderRadius:"4px",fontSize:"0.85rem",wordBreak:"break-word",maxHeight:"200px",overflowY:"auto"},children:R}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(le,{type:"button",variant:"ghost",onClick:n,disabled:U,children:""}),r.jsx(le,{type:"button",variant:"primary",onClick:K,isLoading:U,disabled:z||(o==="url"?!y:!x),children:""})]})]})]})]})},d0=({onSave:n,onCancel:t,initialData:i})=>{const a=i||{},[o,u]=b.useState("ingredients"),[d,f]=b.useState(null),[h,m]=b.useState(new Map);je.useEffect(()=>{(async()=>{const k=await lr.fetchPriceList();m(k)})()},[]);const y=b.useMemo(()=>{const I=a.steps||[""];let k=a.stepGroups||[];const L=I.some(G=>typeof G=="object"&&G.group);if(k.length===0&&L){const G=new Map;I.forEach(ce=>{typeof ce=="object"&&ce.group&&!G.has(ce.group)&&G.set(ce.group,crypto.randomUUID())}),k=Array.from(G.entries()).map(([ce,q])=>({id:q,name:ce}))}return{steps:I.map(G=>{const ce=typeof G=="string"?G:G.text||"",q=typeof G=="object"&&G.id?G.id:crypto.randomUUID();let W=typeof G=="object"?G.groupId:void 0;const ie=typeof G=="object"?G.group:void 0;if(!W&&ie&&k.length>0){const ve=k.find(xe=>xe.name===ie);ve&&(W=ve.id)}return{id:q,text:ce,groupId:W}}),stepGroups:k}},[a]),v=y.steps,x=y.stepGroups,S=b.useMemo(()=>{const I=a.ingredients||[{name:"",quantity:"",unit:"",cost:"",purchaseCost:""}];let k=a.ingredientGroups||[];if(k.length===0&&I.some(H=>H.group)){const H=new Map;I.forEach(G=>{G.group&&!H.has(G.group)&&H.set(G.group,crypto.randomUUID())}),k=Array.from(H.entries()).map(([G,ce])=>({id:ce,name:G})),H.size>0&&I.some(G=>!G.group)}return{ingredients:I.map(H=>{const G=typeof H=="string"?{name:H,quantity:"",unit:"",cost:"",purchaseCost:""}:{...H,cost:H.cost||"",purchaseCost:H.purchaseCost||""};let ce=G.groupId;if(!ce&&G.group&&k.length>0){const q=k.find(W=>W.name===G.group);q&&(ce=q.id)}return{...G,id:G.id||crypto.randomUUID(),groupId:ce}}),ingredientGroups:k}},[a]),_=S.ingredients,N=S.ingredientGroups,[w,C]=b.useState({title:a.title||"",description:a.description||"",image:a.image||"",imageFile:null,storeName:a.storeName||"",servings:a.servings||"",ingredients:_,ingredientGroups:N,steps:v,stepGroups:x,tags:a.tags||[""],course:a.course||"",category:a.category||"",type:a.type||"normal",flours:a.flours||[],breadIngredients:a.breadIngredients||[],sourceUrl:a.sourceUrl||""}),[D,z]=b.useState(!1),[T,U]=b.useState(!1);b.useEffect(()=>{let I=!0;return(async()=>{try{const L=await Rp.getVoiceInputEnabled();I&&U(L)}catch(L){console.warn("[RecipeForm] failed to load voice input feature flag:",L),I&&U(!1)}})(),()=>{I=!1}},[]);const E=(I,k="")=>{const L=new Map,H=I.ingredients||[];H.forEach(xe=>{let Ne=xe.group||"";Ne==="Main"&&(Ne=""),L.has(Ne)||L.set(Ne,crypto.randomUUID())});const G=Array.from(L.entries()).map(([xe,Ne])=>({id:Ne,name:xe})),ce=H.map(xe=>{let Ne=xe.group||"";Ne==="Main"&&(Ne="");let de;return L.has(Ne)&&(de=L.get(Ne)),{id:crypto.randomUUID(),name:xe.name||"",quantity:xe.quantity||"",unit:xe.unit||"",cost:"",purchaseCost:"",groupId:de}}),q=new Map,W=I.steps||[];W.forEach(xe=>{typeof xe=="object"&&xe.group&&xe.group!=="Main"&&(q.has(xe.group)||q.set(xe.group,crypto.randomUUID()))});const ie=Array.from(q.entries()).map(([xe,Ne])=>({id:Ne,name:xe})),ve=W.map(xe=>{const Ne=typeof xe=="object",de=Ne?xe.text||"":xe,K=Ne?xe.group:null;let ge;return K&&q.has(K)&&(ge=q.get(K)),{id:crypto.randomUUID(),text:de,groupId:ge}});C(xe=>({...xe,title:I.name||I.title||xe.title,description:I.description||xe.description,category:k?"URL":I.category||xe.category,image:I.image||xe.image,servings:I.recipeYield||I.servings||xe.servings,ingredients:ce,ingredientGroups:G,steps:ve,stepGroups:ie,ingredientSections:void 0,stepSections:void 0,sourceUrl:k||xe.sourceUrl})),f(null),u("ingredients")},R=I=>{I.preventDefault(),I.stopPropagation(),I.type==="dragenter"||I.type==="dragover"?z(!0):I.type==="dragleave"&&z(!1)},A=I=>{if(I.preventDefault(),I.stopPropagation(),z(!1),I.dataTransfer.files&&I.dataTransfer.files[0]){const k=I.dataTransfer.files[0];k.type.startsWith("image/")&&C(L=>({...L,imageFile:k,image:URL.createObjectURL(k)}))}},O=I=>{const{id:k,value:L}=I.target;C(H=>({...H,[k]:L}))},V=I=>{const k=I.target.files[0];k&&C(L=>({...L,imageFile:k,image:URL.createObjectURL(k)}))},P=b.useMemo(()=>{if(w.type==="bread")return(w.flours?.length||0)+(w.breadIngredients?.length||0);const I=w.ingredientSections||[];return I.length>0?I.reduce((k,L)=>k+(L?.items?.length||0),0):w.ingredients?.length||0},[w.breadIngredients,w.flours,w.ingredientSections,w.ingredients,w.type]),F=b.useMemo(()=>{const I=w.stepSections||[];return I.length>0?I.reduce((k,L)=>k+(L?.items?.length||0),0):w.steps?.length||0},[w.stepSections,w.steps]),Q=I=>{I.preventDefault();let k=[],L=[];if(w.type==="bread")k=w.ingredients.map(ie=>{const{id:ve,...xe}=ie;return xe});else{const ie=w.ingredientSections||[];ie.length===0&&w.ingredients.length>0?k=w.ingredients.map(ve=>{const{id:xe,...Ne}=ve;return Ne}):(k=ie.flatMap(ve=>ve.items.map(xe=>({...xe,groupId:ve.id}))).map(ve=>{const{id:xe,...Ne}=ve;return Ne}),L=ie.map(ve=>({id:ve.id,name:ve.name})))}const H=new Set(w.tags||[]);w.course&&H.add(w.course),w.category&&H.add(w.category),w.type==="bread"&&H.add("");const G=Array.from(H).filter(Boolean);let ce=[],q=[];const W=w.stepSections||[];W.length===0&&w.steps.length>0?ce=w.steps.map(ie=>typeof ie=="string"?{text:ie}:ie):(ce=W.flatMap(ie=>ie.items.map(ve=>({text:ve.text,groupId:ie.id}))),q=W.map(ie=>({id:ie.id,name:ie.name}))),n({...w,ingredients:k,ingredientGroups:L,steps:ce,stepGroups:q,image:w.imageFile||w.image,id:a.id||Date.now(),tags:G,ingredientSections:void 0,stepSections:void 0})},$=!!a?.id;return r.jsxs("form",{className:"recipe-form-mock fade-in",onSubmit:Q,children:[d&&r.jsx(tw,{onClose:()=>f(null),onImport:E,initialMode:d}),r.jsxs("div",{className:"recipe-form-mock__page",children:[r.jsx("div",{className:"recipe-form-mock__commandbar",role:"banner",children:r.jsxs("div",{className:"recipe-form-mock__commandbar-inner",children:[r.jsxs("div",{className:"recipe-form-mock__crumb",children:[r.jsx("span",{className:"recipe-form-mock__crumb-app",children:""}),r.jsx("span",{className:"recipe-form-mock__crumb-sep",children:"/"}),r.jsx("span",{className:"recipe-form-mock__crumb-page",children:$?"":""})]}),r.jsxs("div",{className:"recipe-form-mock__actions",children:[r.jsx(le,{type:"button",variant:"ghost",onClick:t,children:""}),r.jsx(le,{type:"submit",variant:"primary",children:""})]})]})}),r.jsxs("div",{className:"recipe-form-mock__sheet",children:[r.jsxs("header",{className:"recipe-form-mock__doc",children:[r.jsxs("div",{className:"recipe-form-mock__doc-title",children:[r.jsx("input",{id:"title",className:"recipe-form-mock__title-input",value:w.title,onChange:O,placeholder:"",required:!0}),r.jsx("div",{className:"recipe-form-mock__doc-sub",children:""})]}),r.jsxs("div",{className:"recipe-form-mock__meta-grid",children:[r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(Mt,{label:"",id:"course",value:w.course,onChange:O,placeholder:": , ",list:"course-options",wrapperClassName:"input-group--no-margin"}),r.jsxs("datalist",{id:"course-options",children:[r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""})]})]}),r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(Mt,{label:"",id:"category",value:w.category,onChange:O,placeholder:": , ",list:"category-options",wrapperClassName:"input-group--no-margin"}),r.jsxs("datalist",{id:"category-options",children:[r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""}),r.jsx("option",{value:""})]})]}),r.jsxs("div",{className:"recipe-form-mock__meta-field",children:[r.jsx(Mt,{label:"",id:"storeName",value:w.storeName,onChange:O,placeholder:"",list:"store-options",wrapperClassName:"input-group--no-margin"}),r.jsx("datalist",{id:"store-options",children:td.map(I=>r.jsx("option",{value:I},I))})]}),r.jsx("div",{className:"recipe-form-mock__meta-field",children:r.jsx(Mt,{label:"",id:"servings",value:w.servings,onChange:O,placeholder:"4",wrapperClassName:"input-group--no-margin"})})]})]}),r.jsxs("div",{className:"recipe-form-mock__grid",children:[r.jsxs("aside",{className:"recipe-form-mock__col recipe-form-mock__col--side",children:[r.jsxs(un,{className:"recipe-form-mock__card recipe-form-mock__card--notes",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsx(Mt,{label:"",id:"description",textarea:!0,value:w.description,onChange:O,placeholder:"..."}),T&&r.jsx("div",{className:"recipe-form__voice-action",children:r.jsx(sm,{label:"",getCurrentValue:()=>w.description,onTranscript:I=>C(k=>({...k,description:I}))})}),r.jsx(Mt,{label:"URL",id:"sourceUrl",value:w.sourceUrl||"",onChange:O,placeholder:"https://example.com/recipe/..."})]}),r.jsxs(un,{className:"recipe-form-mock__card recipe-form-mock__card--image",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("div",{className:`recipe-form-mock__image-drop ${D?"is-active":""}`,onDragEnter:R,onDragLeave:R,onDragOver:R,onDrop:A,children:[w.image?r.jsxs("div",{className:"recipe-form-mock__image-preview",children:[r.jsx("img",{src:w.image,alt:"",onError:I=>{I.target.style.display="none"}}),r.jsx("button",{type:"button",className:"recipe-form-mock__image-remove",onClick:()=>C(I=>({...I,image:"",imageFile:null})),title:"",children:""})]}):r.jsxs("div",{className:"recipe-form-mock__image-empty",children:["",r.jsx("div",{className:"recipe-form-mock__image-sub",children:""})]}),r.jsx("input",{type:"file",accept:"image/*",onChange:V,className:"recipe-form-mock__image-input"})]})]}),!a?.id&&r.jsxs(un,{className:"recipe-form-mock__card recipe-form-mock__card--import",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("div",{className:"recipe-form-mock__import-actions",children:[r.jsx(le,{variant:"secondary",type:"button",onClick:()=>f("url"),children:"URL"}),r.jsx(le,{variant:"secondary",type:"button",onClick:()=>f("image"),children:""})]}),r.jsx("div",{className:"recipe-form-mock__import-note",children:""})]}),r.jsxs(un,{className:"recipe-form-mock__card recipe-form-mock__card--tips",children:[r.jsx("div",{className:"recipe-form-mock__card-title",children:""}),r.jsxs("ul",{className:"recipe-form-mock__tips-list",children:[r.jsx("li",{children:""}),r.jsx("li",{children:""}),r.jsx("li",{children:""})]})]})]}),r.jsx("section",{className:"recipe-form-mock__col recipe-form-mock__col--main",children:r.jsxs("div",{className:"recipe-form-mock__workspace",role:"region","aria-label":"",children:[r.jsxs("div",{className:"recipe-form-mock__workspace-head",children:[r.jsxs("div",{className:"recipe-form-mock__nav",children:[r.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--ingredients ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:[" ",r.jsx("span",{className:"recipe-form-mock__nav-count",children:P.toLocaleString()})]}),r.jsxs("button",{type:"button",className:`recipe-form-mock__nav-btn recipe-form-mock__nav-btn--steps ${o==="steps"?"active":""}`,onClick:()=>u("steps"),children:[" ",r.jsx("span",{className:"recipe-form-mock__nav-count",children:F.toLocaleString()})]})]}),r.jsx("div",{className:"recipe-form-mock__workspace-right",children:o==="ingredients"?r.jsxs("div",{className:"recipe-form-mock__segmented",children:[r.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${w.type==="normal"?"active":""}`,onClick:()=>C(I=>({...I,type:"normal"})),children:""}),r.jsx("button",{type:"button",className:`recipe-form-mock__seg-btn ${w.type==="bread"?"active":""}`,onClick:()=>C(I=>({...I,type:"bread"})),children:""})]}):r.jsx("div",{className:"recipe-form-mock__hint",children:""})})]}),r.jsx("div",{className:"recipe-form-mock__workspace-body",children:o==="ingredients"?r.jsx("div",{className:"recipe-form-mock__editor-surface",children:w.type==="bread"?r.jsx(Ak,{formData:w,setFormData:C}):r.jsx(Kk,{formData:w,setFormData:C,priceList:h})}):r.jsx("div",{className:"recipe-form-mock__editor-surface",children:r.jsx(Qk,{formData:w,setFormData:C,voiceInputEnabled:T})})})]})})]})]})]})]})},nT="modulepreload",rT=function(n){return"/app/"+n},h0={},qu=function(t,i,a){let o=Promise.resolve();if(i&&i.length>0){let h=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(v=>({status:"fulfilled",value:v}),v=>({status:"rejected",reason:v}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");o=h(i.map(m=>{if(m=rT(m),m in h0)return;h0[m]=!0;const y=m.endsWith(".css"),v=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${v}`))return;const x=document.createElement("link");if(x.rel=y?"stylesheet":nT,y||(x.as="script"),x.crossOrigin="",x.href=m,f&&x.setAttribute("nonce",f),document.head.appendChild(x),y)return new Promise((S,_)=>{x.addEventListener("load",S),x.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${m}`)))})}))}function u(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return o.then(d=>{for(const f of d||[])f.status==="rejected"&&u(f.reason);return t().catch(u)})},sT=n=>{if(!n)return null;if(Array.isArray(n))return n[0]||null;if(typeof n=="object"){if(n.id&&n.display_id!==void 0)return n;const t=Object.values(n)[0];if(Array.isArray(t))return t[0]||null;if(t&&typeof t=="object"&&t.id)return t}return null},Di={async fetchAllProfiles(){try{const{data:t,error:i}=await _e.rpc("admin_list_profiles");if(!i&&Array.isArray(t))return t;i&&console.warn("admin_list_profiles RPC failed (fallback to direct select):",i)}catch(t){console.warn("admin_list_profiles RPC threw (fallback to direct select):",t)}const n=await _e.from("profiles").select("id, display_id, email, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(!n.error)return n.data||[];if(String(n.error.message||"").toLowerCase().includes("email")){const t=await _e.from("profiles").select("id, display_id, role, show_master_recipes, created_at, updated_at").order("created_at",{ascending:!1});if(t.error)throw t.error;return t.data||[]}throw n.error},async updateProfile(n,t){const a=Object.keys(t||{}).length===1&&Object.prototype.hasOwnProperty.call(t,"show_master_recipes");let o=null;if(a)try{const{data:d,error:f}=await _e.rpc("admin_set_show_master_recipes",{target_profile_id:n,enabled:t.show_master_recipes===!0});if(f)throw f;if(d){const h=sT(d);if(h)return h}}catch(d){console.warn("RPC admin_set_show_master_recipes failed:",d),o=d}const u=await _e.from("profiles").update(t).eq("id",n).select("id, display_id, email, role, show_master_recipes, created_at, updated_at").single();if(!u.error)return u.data;if(o&&a)throw console.error("Direct update also failed:",u.error),new Error(`(RPC: ${o.message})`);if(String(u.error.message||"").toLowerCase().includes("email")){const d=await _e.from("profiles").update(t).eq("id",n).select("id, display_id, role, show_master_recipes, created_at, updated_at").single();if(d.error)throw d.error;return d.data}throw u.error},async adminResetPassword(n,t){const{data:i,error:a}=await _e.functions.invoke("admin-reset-password",{body:{userId:n,newPassword:t}});if(a)throw a;if(i?.error)throw new Error(i.error);return i},async sendPasswordResetEmail(n){const{error:t}=await _e.auth.resetPasswordForEmail(n,{redirectTo:window.location.origin});if(t)throw t;return!0}},f0="csv_unit_overrides",p0=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),sd={async _getCurrentUserId(){const{data:n,error:t}=await _e.auth.getUser();if(t)throw t;return n?.user?.id||null},async getAll(n=null){try{const t=n||await this._getCurrentUserId();if(!t)return new Map;const{data:i,error:a}=await _e.from(f0).select("ingredient_name,csv_unit").eq("user_id",t);if(a){if(p0(a))return new Map;throw a}const o=new Map;return(i||[]).forEach(u=>{u?.ingredient_name&&o.set(String(u.ingredient_name),String(u.csv_unit||""))}),o}catch(t){return console.warn("csvUnitOverrideService.getAll failed",t),new Map}},async upsert(n,t,i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim(),u=String(t||"").trim();if(!o)throw new Error("");if(!u)throw new Error("");const{data:d,error:f}=await _e.from(f0).upsert({user_id:a,ingredient_name:o,csv_unit:u,updated_at:new Date().toISOString()},{onConflict:"user_id,ingredient_name"}).select().single();if(f)throw p0(f)?new Error("DB csv_unit_overrides "):f;return d}},m0="ingredient_vendor_orders",g0=n=>String(n?.code||"")==="42P01"||String(n?.message||"").toLowerCase().includes("does not exist"),y0={async getAll(n){const t=String(n||"").trim();if(!t)return[];const{data:i,error:a}=await _e.from(m0).select("vendor_name,sort_order").eq("user_id",t).order("sort_order",{ascending:!0}).order("vendor_name",{ascending:!0});if(a){if(g0(a))return[];throw a}return(i||[]).map(o=>String(o?.vendor_name||"").trim()).filter(Boolean)},async saveOrder(n,t){const i=String(n||"").trim();if(!i)throw new Error("User ID is required");const a=[],o=new Set;if((t||[]).forEach(h=>{const m=String(h||"").trim();!m||o.has(m)||(o.add(m),a.push(m))}),a.length===0)return;const u=new Date().toISOString(),d=a.map((h,m)=>({user_id:i,vendor_name:h,sort_order:m,updated_at:u})),{error:f}=await _e.from(m0).upsert(d,{onConflict:"user_id,vendor_name"});if(f)throw g0(f)?new Error("DB ingredient_vendor_orders "):f}},ko="manual",To="__all__",oa="__unassigned__",iT=({vendorKey:n,label:t,count:i,active:a,disabled:o,onSelect:u})=>{const{attributes:d,listeners:f,setNodeRef:h,transform:m,transition:y,isDragging:v}=wa({id:n,data:{type:"vendor-order-item"},disabled:!!o}),x={transform:wr.Transform.toString(m),transition:y,opacity:v?.7:1};return r.jsxs("li",{ref:h,style:x,className:`vendor-order-item ${a?"active":""} ${o?"disabled":""}`,onClick:()=>{o||u(n)},role:"button",tabIndex:o?-1:0,onKeyDown:S=>{o||(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),u(n))},"aria-label":`${t} `,children:[r.jsxs("span",{className:"vendor-order-item__label",title:t,children:[t,r.jsxs("span",{className:"vendor-order-item__count",children:["(",Number(i||0).toLocaleString(),")"]})]}),r.jsx("span",{className:"vendor-order-item__handle",...o?{}:d,...o?{}:f,title:"","aria-label":`${t} `,children:""})]})},aT=()=>{const n=Ui(),{user:t}=fs(),i=t?.id||null,[a,o]=b.useState([]),[u,d]=b.useState(""),[f,h]=b.useState("all"),[m,y]=b.useState(!1),[v,x]=b.useState(To),[S,_]=b.useState([]),[N,w]=b.useState(!1),[C,D]=b.useState(null),[z,T]=b.useState(!1),[U,E]=b.useState(new Map),[R,A]=b.useState(new Map),[O,V]=b.useState({}),[P,F]=b.useState(!1),[Q,$]=b.useState([]),[I,k]=b.useState(!1),[L,H]=b.useState(""),[G,ce]=b.useState(""),[q,W]=b.useState(!1),[ie,ve]=b.useState(!1),[xe,Ne]=b.useState(null),[de,K]=b.useState(!1),ge=ee=>{const De=String(ee||"").trim();return!De||De==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(De)?De:"food"},Ae=ee=>{const De=ge(ee);return De==="food"?"8%":De==="soft_drink"?"8%":De==="alcohol"?"10%":De==="supplies"?"10%":"8%"},ae=[{key:"all",label:""},{key:"food",label:""},{key:"alcohol",label:""},{key:"soft_drink",label:""},{key:"supplies",label:""},{key:ko,label:""}],Se=b.useCallback(ee=>{const De=Jt(ee);return De?U?.has(De):!1},[U]),Re=je.useMemo(()=>{const ee={all:a.length,food:0,alcohol:0,soft_drink:0,supplies:0,[ko]:0};return a.forEach(De=>{const ke=ge(De?.itemCategory);ee[ke]=(ee[ke]||0)+1,Se(De?.ingredientName)||(ee[ko]=(ee[ko]||0)+1)}),ee},[a,Se]),Oe=b.useCallback(async()=>{T(!0);try{let ee=await Un.getAllConversions();if((ee?.size||0)===0){await new Promise(Ie=>setTimeout(Ie,350));const ke=await Un.getAllConversions();(ke?.size||0)>0&&(ee=ke)}const De=Array.from(ee.values()).map(ke=>({...ke,clientId:ke.ingredientName,isNew:!1,isEditing:!1}));o(De.sort((ke,Ie)=>String(ke?.ingredientName||"").localeCompare(String(Ie?.ingredientName||""),"ja"))),T(!1),Promise.allSettled([lr.fetchPriceList(),sd.getAll()]).then(([ke,Ie])=>{ke.status==="fulfilled"?E(ke.value||new Map):(E(new Map),console.warn("Failed to load CSV prices (ingredient master still available):",ke.reason)),Ie.status==="fulfilled"?A(Ie.value||new Map):(A(new Map),console.warn("Failed to load CSV unit overrides (ingredient master still available):",Ie.reason))}).catch(ke=>{console.warn("Failed to load auxiliary ingredient master data:",ke),E(new Map),A(new Map)})}catch(ee){n.error(""),console.error("Failed to load ingredients:",ee),T(!1)}},[n]);b.useEffect(()=>{const ee=setTimeout(()=>{Oe()},0);return()=>clearTimeout(ee)},[Oe]),b.useEffect(()=>{let ee=!0;return(async()=>{if(!i){ee&&_([]);return}try{const ke=await y0.getAll(i);ee&&_(ke)}catch(ke){console.error("Failed to load vendor order:",ke),ee&&_([])}})(),()=>{ee=!1}},[i]);const He=()=>{const ee=`new-${Date.now()}-${Math.random().toString(16).slice(2)}`,De=["food","alcohol","soft_drink","supplies"].includes(f)?f:"food",ke={clientId:ee,ingredientName:"",vendor:"",packetSize:"",packetUnit:"g",lastPrice:"",yieldPercent:100,itemCategory:De,isNew:!0,isEditing:!0};o(Ie=>[ke,...Ie.map(Ve=>({...Ve,isEditing:!1}))]),D(ee)},nt=b.useCallback(ee=>a.findIndex(De=>De?.clientId===ee),[a]),ot=async ee=>{const De=nt(ee);if(De<0)return;const ke=a[De];if(!ke.ingredientName||!ke.packetSize||!ke.lastPrice){n.warning("");return}const Ie=parseFloat(ke.yieldPercent),Ve=Number.isFinite(Ie)?Ie:100;if(Ve<=0||Ve>100){n.warning("% 1100 ");return}try{await Un.saveConversion(ke.ingredientName,ke.packetSize,ke.packetUnit,ke.lastPrice,ke.itemCategory,ke.vendor,Ve),n.success(""),Oe(),D(null)}catch(lt){n.error(""),console.error("Save error:",lt)}},Fe=async ee=>{const De=nt(ee);if(De<0)return;const ke=a[De],Ie=ke?.ingredientName;if(ke.isNew){o(Ve=>Ve.filter(lt=>lt?.clientId!==ee)),D(null);return}try{await Un.deleteConversion(Ie),n.success(""),Oe()}catch(Ve){n.error(""),console.error("Delete error:",Ve)}},Ce=ee=>{D(ee),o(De=>De.map(ke=>({...ke,isEditing:ke?.clientId===ee})))},Ee=ee=>{const De=nt(ee);De<0||(a[De].isNew?o(ke=>ke.filter(Ie=>Ie?.clientId!==ee)):Oe(),D(null))},se=(ee,De,ke)=>{o(Ie=>Ie.map(Ve=>Ve?.clientId!==ee?Ve:{...Ve,[De]:ke}))},Pe=ee=>{const De=parseFloat(ee.lastPrice),ke=parseFloat(ee.packetSize);if(!De||!ke)return"-";const Ie=ee.packetUnit?ee.packetUnit.trim().toLowerCase():"";return Ie==="g"||Ie===""?`${Math.round(De/ke*1e3).toLocaleString()}/kg`:Ie==="ml"||Ie==="cc"||Ie===""||Ie===""?`${Math.round(De/ke*1e3).toLocaleString()}/L`:Ie==="cl"||Ie===""?`${Math.round(De/ke*100).toLocaleString()}/L`:`${Math.round(De/ke).toLocaleString()}/${ee.packetUnit}`},dt=a.filter(ee=>{const De=String(ee?.ingredientName||"");return De.toLowerCase().includes(u.toLowerCase())?f==="all"?!0:f===ko?!Se(De):ge(ee?.itemCategory)===f:!1}),gt=je.useMemo(()=>{const ee=new Map;a.forEach(lt=>{const bt=String(lt?.ingredientName||"").trim();if(!bt)return;const Lt=Jt(bt);if(!Lt)return;const Pt=ee.get(Lt)||[];Pt.push({clientId:lt?.clientId,name:bt}),ee.set(Lt,Pt)});const De=new Set,ke=new Set,Ie=new Map,Ve=[];for(const[lt,bt]of ee.entries()){if(!Array.isArray(bt)||bt.length<2)continue;De.add(lt),bt.forEach(Pt=>{Pt?.clientId&&ke.add(Pt.clientId)});const Lt=Array.from(new Set(bt.map(Pt=>Pt?.name).filter(Boolean)));Ie.set(lt,Lt),Ve.push({key:lt,names:Lt,rows:bt.length})}return Ve.sort((lt,bt)=>{const Lt=String(lt?.names?.[0]||""),Pt=String(bt?.names?.[0]||"");return Lt.localeCompare(Pt,"ja")}),{duplicateKeys:De,duplicateClientIds:ke,keyToNames:Ie,groups:Ve}},[a]);b.useEffect(()=>{m&&(gt?.groups?.length||0)===0&&y(!1)},[m,gt]);const ct=f!=="all"||String(u||"").trim()!=="",Qe=ee=>{const De=Jt(ee);if(!De)return"-";const Ie=(U?.get(De)||null)?.unit;return Ie?String(Ie):"-"},it=b.useCallback(ee=>{const De=Jt(ee);if(!De)return"";const Ie=(U?.get(De)||null)?.vendor;return Ie?String(Ie):""},[U]),tt=je.useCallback(ee=>{const De=String(ee?.vendor||"").trim();if(De)return De;const ke=it(ee?.ingredientName);return ke||oa},[it]),ut=je.useMemo(()=>{const ee=new Map;dt.forEach(Ve=>{const lt=tt(Ve);ee.set(lt,(ee.get(lt)||0)+1)});const De=new Set(ee.keys()),ke=Array.from(ee.entries()).map(([Ve,lt])=>({key:Ve,count:lt})),Ie=new Map((S||[]).map((Ve,lt)=>[Ve,lt]));return ke.sort((Ve,lt)=>{const bt=Ie.has(Ve.key)?Ie.get(Ve.key):Number.MAX_SAFE_INTEGER,Lt=Ie.has(lt.key)?Ie.get(lt.key):Number.MAX_SAFE_INTEGER;return bt!==Lt?bt-Lt:Ve.key===oa&&lt.key!==oa?1:lt.key===oa&&Ve.key!==oa?-1:String(Ve.key).localeCompare(String(lt.key),"ja")}),{total:dt.length,vendorKeys:De,entries:ke}},[dt,tt,S]);b.useEffect(()=>{const ee=(ut?.entries||[]).map(De=>De.key);_(De=>{const ke=Array.isArray(De)?De:[],Ie=ke.filter(bt=>ee.includes(bt)),Ve=ee.filter(bt=>!Ie.includes(bt)),lt=[...Ie,...Ve];return lt.length===ke.length&&lt.every((bt,Lt)=>bt===ke[Lt])?ke:lt})},[ut]);const qt=ba(dr(fd,{activationConstraint:{distance:6}})),$t=b.useCallback(async ee=>{if(C!==null)return;const{active:De,over:ke}=ee;if(!De?.id||!ke?.id||De.id===ke.id)return;const Ie=(ut?.entries||[]).map(he=>he.key),Ve=Ie.indexOf(De.id),lt=Ie.indexOf(ke.id);if(Ve<0||lt<0)return;const bt=Li(Ie,Ve,lt),Pt=(Array.isArray(S)?S:[]).filter(he=>!Ie.includes(he)),hn=[...bt,...Pt];if(_(hn),!!i)try{await y0.saveOrder(i,hn)}catch(he){console.error("Failed to save vendor order:",he),n.error(he?.message||"")}},[C,i,ut,n,S]);b.useEffect(()=>{v!==To&&(ut?.vendorKeys?.has?.(v)||x(To))},[v,ut]);const an=je.useMemo(()=>{let ee=dt.filter(De=>{const ke=De?.clientId,Ie=!!C&&ke===C;return!(m&&!(gt?.duplicateClientIds||new Set).has(ke)&&!Ie||v!==To&&!(tt(De)===v)&&!Ie)});if(C&&!ee.some(De=>De?.clientId===C)){const De=a.find(ke=>ke?.clientId===C);De&&(ee=[De,...ee])}return ee},[dt,m,gt,v,tt,C,a]),Ht=ee=>{const De=(ee??"").toString().trim();if(!De)return"";if(Object.prototype.hasOwnProperty.call(O,De))return O[De];const ke=R?.get(De);if(ke)return String(ke);const Ie=Qe(De);return Ie==="-"?"":Ie},rn=ee=>{const De=(ee??"").toString().trim();if(!De)return"-";const ke=R?.get(De);return ke?String(ke):Qe(De)},sn=async(ee,De)=>{const ke=(ee??"").toString().trim(),Ie=(De??"").toString().trim();if(ke){if(!Ie){V(Ve=>{const lt={...Ve};return delete lt[ke],lt});return}try{await sd.upsert(ke,Ie),A(Ve=>{const lt=new Map(Ve);return lt.set(ke,Ie),lt}),n.success("CSV")}catch(Ve){console.error(Ve),n.error(Ve?.message||"")}}},Kt=async()=>{if(t?.role==="admin"){F(!0),H(""),$([]),ce(""),W(!1),Ne(null),K(!1),k(!0);try{const ee=await Di.fetchAllProfiles();$(ee||[])}catch(ee){console.error(ee),H("")}finally{k(!1)}}},In=()=>{ie||(K(!1),F(!1))},mn=async()=>{if(!(!G||ie)){ve(!0),Ne({type:"info",message:"..."});try{const ee=await Un.adminCopyIngredientMasterToUser(G,{overwrite:q}),De=ee?.unit_conversions||{},ke=ee?.csv_unit_overrides||{},Ie=`: ${Number(De.source_total||0).toLocaleString()}   ${Number(De.copied||0).toLocaleString()} /  ${Number(De.updated||0).toLocaleString()} /  ${Number(De.skipped||0).toLocaleString()}`,Ve=`(CSV): ${Number(ke.source_total||0).toLocaleString()}   ${Number(ke.copied||0).toLocaleString()} /  ${Number(ke.updated||0).toLocaleString()} /  ${Number(ke.skipped||0).toLocaleString()}`;Ne({type:"success",message:`
${Ie}
${Ve}`}),n.success("")}catch(ee){console.error(ee),Ne({type:"error",message:`: ${String(ee?.message||ee)}`}),n.error("")}finally{ve(!1)}}};return r.jsxs("div",{className:"ingredient-master-container",children:[r.jsxs("div",{className:"master-header",children:[r.jsx("h3",{children:" "}),r.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",justifyContent:"flex-end"},children:[t?.role==="admin"&&r.jsx(le,{variant:"secondary",onClick:Kt,disabled:C!==null||z||ie,title:C!==null?"":void 0,children:""}),r.jsx(le,{variant:"primary",onClick:He,disabled:C!==null,children:"+ "})]})]}),r.jsx("div",{className:"master-search",children:r.jsx(Mt,{placeholder:"...",value:u,onChange:ee=>d(ee.target.value)})}),r.jsxs("div",{className:"ingredient-master-stats",children:[r.jsxs("span",{children:[": ",r.jsx("strong",{children:(a.length||0).toLocaleString()})," "]}),ct&&r.jsxs("span",{className:"ingredient-master-stats-muted",children:[": ",r.jsx("strong",{children:(dt.length||0).toLocaleString()})," "]}),r.jsxs("button",{type:"button",className:`ingredient-dup-toggle ${m?"active":""}`,onClick:()=>y(ee=>!ee),disabled:C!==null||(gt?.groups?.length||0)===0,title:C!==null?"":(gt?.groups?.length||0)===0?"":"",children:[": ",r.jsx("strong",{children:(gt?.groups?.length||0).toLocaleString()})," "]})]}),r.jsx("div",{className:"ingredient-category-tabs",children:ae.map(ee=>r.jsxs("button",{type:"button",className:`ingredient-category-tab ${f===ee.key?"active":""}`,onClick:()=>h(ee.key),disabled:C!==null,title:C!==null?"":void 0,children:[ee.label," (",(Re[ee.key]??0).toLocaleString(),")"]},ee.key))}),r.jsxs("div",{className:"ingredient-vendor-filter-row",children:[r.jsx("label",{htmlFor:"ingredient-vendor-filter",className:"ingredient-vendor-filter-label",children:""}),r.jsxs("select",{id:"ingredient-vendor-filter",value:v,onChange:ee=>x(ee.target.value),disabled:C!==null,className:"ingredient-vendor-select",title:C!==null?"":"",children:[r.jsxs("option",{value:To,children:[" (",(ut?.total||0).toLocaleString(),")"]}),(ut?.entries||[]).map(({key:ee,count:De})=>{const ke=ee===oa?"":ee;return r.jsxs("option",{value:ee,children:[ke," (",Number(De||0).toLocaleString(),")"]},ee)})]}),r.jsx("button",{type:"button",className:`ingredient-vendor-order-toggle ${N?"active":""}`,onClick:()=>w(ee=>!ee),disabled:C!==null,title:C!==null?"":"",children:N?"":""})]}),N&&r.jsxs("div",{className:"ingredient-vendor-order-panel",children:[r.jsx("div",{className:"ingredient-vendor-order-title",children:""}),(ut?.entries||[]).length===0?r.jsx("div",{className:"ingredient-vendor-order-empty",children:""}):r.jsx(Mi,{sensors:qt,collisionDetection:Wu,onDragEnd:$t,children:r.jsx(xa,{items:(ut?.entries||[]).map(ee=>ee.key),strategy:Sl,children:r.jsx("ul",{className:"vendor-order-list",children:(ut?.entries||[]).map(({key:ee,count:De})=>{const ke=ee===oa?"":ee;return r.jsx(iT,{vendorKey:ee,label:ke,count:De,active:v===ee,disabled:C!==null,onSelect:x},ee)})})})})]}),z?r.jsx("div",{className:"master-loading",children:"..."}):r.jsx("div",{className:"master-table-wrapper",children:r.jsxs("table",{className:"master-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"master-col-no",children:"No"}),r.jsx("th",{children:""}),r.jsx("th",{className:"master-col-category",children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:"CSV"}),r.jsx("th",{children:""}),r.jsx("th",{children:"%"}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:an.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#999"},children:m?"":ct?"":""})}):an.map((ee,De)=>{const ke=ee?.clientId??ee?.ingredientName??String(De),Ie=it(ee?.ingredientName),Ve=String(ee?.vendor||"").trim(),lt=ee?.isEditing&&!!Ie&&Ie!==Ve,bt=Ve||Ie||"",Lt=Ve?"vendor-tag--master":Ie?"vendor-tag--csv":"vendor-tag--empty",Pt=bt?Ve&&Ie&&Ie!==Ve?`: ${Ve} / CSV: ${Ie}`:Ve?"":"CSV":"",hn=ge(ee?.itemCategory),he=hn==="food",Ye=Jt(ee?.ingredientName),ht=!!Ye&&gt?.duplicateKeys?.has?.(Ye),We=Ye&&gt?.keyToNames?.get?.(Ye)||null,At=ht&&Array.isArray(We)&&We.length>0?`: ${We.join(" / ")}`:"";return r.jsxs("tr",{className:[ee.isEditing?"editing":"",ht?"duplicate":""].filter(Boolean).join(" "),children:[r.jsx("td",{className:"master-col-no",children:r.jsx("span",{className:"master-col-no__text",children:De+1})}),r.jsx("td",{children:ee.isEditing?r.jsxs("div",{className:"ingredient-name-cell",children:[r.jsx(Mt,{value:ee.ingredientName,onChange:jt=>se(ke,"ingredientName",jt.target.value),placeholder:": ",disabled:!ee.isNew,wrapperClassName:"input-group--no-margin"}),r.jsx(Mt,{value:ee.vendor||"",onChange:jt=>se(ke,"vendor",jt.target.value),placeholder:"",wrapperClassName:"input-group--no-margin"}),lt&&r.jsx("div",{className:"ingredient-vendor-tags",children:r.jsxs("span",{className:"vendor-tag vendor-tag--csv",title:"CSV",children:[": ",Ie]})})]}):r.jsxs("div",{className:"ingredient-name-cell",children:[r.jsxs("div",{className:"ingredient-name-row",children:[r.jsx("span",{children:ee.ingredientName}),ht&&r.jsx("span",{className:"ingredient-dup-badge",title:At,children:""})]}),r.jsx("div",{className:"ingredient-vendor-tags",children:r.jsxs("span",{className:`vendor-tag ${Lt}`,title:Pt,children:[": ",bt||"-"]})})]})}),r.jsx("td",{className:"master-col-category",children:ee.isEditing?r.jsxs("select",{value:hn,onChange:jt=>se(ke,"itemCategory",jt.target.value),className:"category-select",children:[r.jsx("option",{value:"food",children:"8%"}),r.jsx("option",{value:"soft_drink",children:"8%"}),r.jsx("option",{value:"alcohol",children:"10%"}),r.jsx("option",{value:"supplies",children:"10%"})]}):r.jsx("span",{title:"",children:Ae(ee?.itemCategory)})}),r.jsx("td",{children:ee.isEditing?r.jsx(Mt,{type:"number",value:ee.lastPrice,onChange:jt=>se(ke,"lastPrice",jt.target.value),placeholder:": 500"}):`${parseFloat(ee.lastPrice||0).toLocaleString()}`}),r.jsx("td",{children:ee.isEditing?r.jsxs("div",{className:"input-with-hint",children:[r.jsx(Mt,{type:"number",value:ee.packetSize,onChange:jt=>se(ke,"packetSize",jt.target.value),placeholder:["","","","PC","","",""].includes(ee.packetUnit)?" (: 1)":": 1000"}),["","","","PC","","",""].includes(ee.packetUnit)&&r.jsxs("span",{className:"unit-hint",children:["1",ee.packetUnit,"1"]})]}):ee.packetSize}),r.jsx("td",{children:ee.isEditing?r.jsxs("select",{value:ee.packetUnit,onChange:jt=>se(ke,"packetUnit",jt.target.value),className:"unit-select",children:[r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]}):ee.packetUnit}),r.jsx("td",{className:"csv-unit-cell",children:ee.isEditing?r.jsx(Mt,{value:Ht(ee.ingredientName),onChange:jt=>{const Dt=(ee.ingredientName??"").toString().trim(),Vt=jt.target.value;V(pt=>({...pt,[Dt]:Vt}))},onBlur:jt=>sn(ee.ingredientName,jt.target.value),placeholder:Qe(ee.ingredientName)==="-"?"":`CSV: ${Qe(ee.ingredientName)}`}):r.jsx("span",{children:rn(ee.ingredientName)})}),r.jsx("td",{className:"normalized-cost",children:Pe(ee)}),r.jsx("td",{children:he?ee.isEditing?r.jsx(Mt,{type:"number",value:ee.yieldPercent??"",onChange:jt=>se(ke,"yieldPercent",jt.target.value),placeholder:"100",min:"1",max:"100",step:"0.1",title:": 100% = "}):(()=>{const jt=parseFloat(ee.yieldPercent);if(!Number.isFinite(jt)||jt<=0)return"-";const Dt=Math.round(jt*10)/10;return`${Number.isInteger(Dt)?Math.round(Dt):Dt}%`})():r.jsx("span",{style:{color:"#999"},children:"-"})}),r.jsx("td",{children:r.jsx("div",{className:"action-buttons",children:ee.isEditing?r.jsxs(r.Fragment,{children:[r.jsx(le,{variant:"primary",size:"sm",onClick:()=>ot(ke),children:""}),r.jsx(le,{variant:"ghost",size:"sm",onClick:()=>Ee(ke),children:""})]}):r.jsxs(r.Fragment,{children:[r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Ce(ke),disabled:C!==null,children:""}),r.jsx(le,{variant:"ghost",size:"sm",onClick:()=>Fe(ke),disabled:C!==null,children:""})]})})})]},ke)})})]})}),r.jsx("div",{className:"master-info",children:r.jsx("p",{children:" "})}),r.jsx(jn,{isOpen:P,onClose:In,title:"",size:"medium",showCloseButton:!ie,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["//////(CSV)",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" 1"})]}),de?r.jsxs(r.Fragment,{children:[(()=>{const ee=Q.find(ke=>String(ke?.id)===String(G)),De=ee?`${ee.display_id}${ee.email?` (${ee.email})`:""}`:G?String(G).slice(0,8):"-";return r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",r.jsx("strong",{children:De}),r.jsx("br",{}),": ",r.jsx("strong",{children:q?"":""})]})]})})(),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>K(!1),disabled:ie,children:""}),r.jsx(le,{variant:"primary",onClick:mn,disabled:!G||ie,children:ie?"...":""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),I?r.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):r.jsxs("select",{value:G,onChange:ee=>ce(ee.target.value),disabled:ie||!!L,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:ie?"#f3f4f6":"white"},children:[r.jsx("option",{value:"",children:"..."}),Q.filter(ee=>String(ee?.id)&&String(ee?.id)!==String(t?.id)).map(ee=>r.jsxs("option",{value:ee.id,children:[ee.display_id,ee.email?` (${ee.email})`:"",ee.role==="admin"?" []":""]},ee.id))]}),L&&r.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:L})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem",color:"#374151"},children:[r.jsx("input",{type:"checkbox",checked:q,onChange:ee=>W(ee.target.checked),disabled:ie}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(le,{variant:"ghost",onClick:In,disabled:ie,children:""}),r.jsx(le,{variant:"primary",onClick:()=>K(!0),disabled:!G||ie||I||!!L,children:""})]})]}),ie&&r.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),xe?.message&&r.jsx("div",{className:`status-msg ${xe.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:xe.message})]})})]})},Du="__all_vendors__",nw="__unknown_vendor__",Ao="__all_categories__",lp="food",Fu=[{value:"food",label:""},{value:"alcohol",label:""},{value:"soft_drink",label:""},{value:"supplies",label:""}],Op=Fu.reduce((n,t)=>(n[t.value]=t.label,n),{}),lT=new Set(["","","","","PC","","",""]),ca=n=>{if(n==null||n==="")return null;const t=String(n).replace(/,/g,"").trim();if(!t)return null;const i=Number(t);return Number.isFinite(i)?i:null},v0=n=>(typeof n=="string"?n.trim():"")||nw,cl=n=>{const t=String(n||"").trim();return!t||t==="food_alcohol"?lp:Op[t]?t:lp},oT=()=>{const[n,t]=b.useState([]),[i,a]=b.useState(!0),[o,u]=b.useState(null),[d,f]=b.useState(null),[h,m]=b.useState("all"),[y,v]=b.useState({key:null,direction:"asc"}),[x,S]=b.useState(""),[_,N]=b.useState(Ao),[w,C]=b.useState(Du),[D,z]=b.useState(!1),[T,U]=b.useState(null),E=b.useRef(null),R=Ui(),[A,O]=b.useState({isOpen:!1,title:"",message:"",onConfirm:null}),V=()=>{f(K=>!K||K.phase==="running"?K:null)};b.useEffect(()=>{P()},[]);const P=async()=>{a(!0),U(null);try{console.log("Starting data load for CsvToMasterImporter...");const[K,ge]=await Promise.all([lr.getPriceListArray().catch(ae=>(console.error("Error fetching price list:",ae),[])),Un.getAllConversions().catch(ae=>(console.error("Error fetching conversions:",ae),new Map))]);if(console.log("Data fetched:",{csvCount:K?.length,masterSize:ge?.size}),!Array.isArray(K))throw new Error("CSV");if(!(ge instanceof Map))throw new Error("Map");const Ae=[];for(const ae of K){if(!ae||!ae.name)continue;const Se=ge.get(ae.name),Re=cl(Se?.itemCategory),Oe=Se?.packetSize??"",He=Se?.packetUnit||ae.unit||"",nt=Se?.lastPrice??"",ot=Se?Oe:lT.has(He)?1:"";Ae.push({name:ae.name,csvPrice:ae.price,csvUnit:ae.unit,csvVendor:ae.vendor,masterCategory:Re,masterSize:Oe,masterUnit:He,masterPrice:nt,isRegistered:!!Se,inputSize:ot,inputUnit:He,inputPrice:Se?nt:ae.price??"",inputCategory:Re,isModified:!1})}console.log("Merge completed. Items:",Ae.length),t(Ae)}catch(K){console.error("Failed to load data for importer:",K),U(K.message||"")}finally{a(!1)}},F=async K=>{u(K.name);try{const ge=ca(K.inputSize),Ae=ca(K.inputPrice);if(ge===null||ge<=0){R.error("");return}if(!K.inputUnit){R.error("");return}if(!K.inputCategory){R.error("");return}await Un.saveConversion(K.name,ge,K.inputUnit,Ae,K.inputCategory),t(ae=>ae.map(Se=>Se.name===K.name?{...Se,isRegistered:!0,isModified:!1,masterSize:ge,masterUnit:K.inputUnit,masterPrice:Ae??"",masterCategory:K.inputCategory,inputCategory:K.inputCategory}:Se)),R.success("")}catch(ge){console.error("Failed to save ingredient:",ge),R.error("")}finally{u(null)}},Q=async K=>{O(ge=>({...ge,isOpen:!1}));try{const ge=K.filter(ct=>{const Qe=ca(ct.inputSize);return!(Qe!==null&&Qe>0)||!ct.inputUnit||!ct.inputCategory});if(ge.length>0){const ct=ge.slice(0,5).map(it=>it.name).join(""),Qe=ge.length>5?` ${ge.length-5}`:"";R.error(`: ${ct}${Qe}`);return}u("bulk");const Ae=K.length;f({phase:"running",total:Ae,processed:0,success:0,failed:0,currentName:"",failedNames:[]});const ae=5,Se=120;let Re=0,Oe=0,He=0,nt=0;const ot=[],Fe=[],Ce=(ct=!1,Qe="")=>{const it=Date.now();!ct&&it-nt<Se||(nt=it,f(tt=>!tt||tt.phase!=="running"?tt:{...tt,processed:Re,success:Oe,failed:He,currentName:Qe||tt.currentName}))};let Ee=0;const se=async()=>{for(;;){const ct=Ee++;if(ct>=K.length)return;const Qe=K[ct],it=Qe?.name?String(Qe.name):"";try{const tt=ca(Qe.inputSize),ut=ca(Qe.inputPrice);if(tt===null||tt<=0)throw new Error("Invalid size");if(!Qe.inputUnit)throw new Error("Invalid unit");if(!Qe.inputCategory)throw new Error("Invalid category");await Un.saveConversion(Qe.name,tt,Qe.inputUnit,ut,Qe.inputCategory),Oe++,ot.push(Qe)}catch(tt){He++,Fe.push(it||`#${ct+1}`),console.error(`Failed to save ${it}:`,tt)}finally{Re++,Ce(!1,it)}}},Pe=Math.min(ae,K.length);await Promise.all(Array.from({length:Pe},()=>se())),Ce(!0);const dt=new Set(ot.map(ct=>ct.name)),gt=new Map(K.map(ct=>[ct.name,ct]));t(ct=>ct.map(Qe=>{if(dt.has(Qe.name)){const it=gt.get(Qe.name);return{...Qe,isRegistered:!0,isModified:!1,masterSize:ca(it.inputSize)??"",masterUnit:it.inputUnit,masterPrice:ca(it.inputPrice)??"",masterCategory:it.inputCategory,inputCategory:it.inputCategory}}return Qe})),He===0?R.success(`${Oe} `):R.warning(`:  ${Oe}  /  ${He} `),f({phase:"done",total:Ae,processed:Re,success:Oe,failed:He,currentName:"",failedNames:Fe.slice(0,10)})}catch(ge){console.error("Bulk save error:",ge),R.error(""),f(Ae=>({phase:"error",total:Ae?.total??K.length,processed:Ae?.processed??0,success:Ae?.success??0,failed:Ae?.failed??0,currentName:"",failedNames:Ae?.failedNames??[],errorMessage:ge?.message?String(ge.message):""}))}finally{u(null)}},$=()=>{const K=n.filter(ge=>ge.isModified);K.length!==0&&O({isOpen:!0,title:"",message:`${K.length} `,onConfirm:()=>Q(K)})},I=(K,ge,Ae)=>{t(ae=>ae.map(Se=>Se.name===K?{...Se,[ge]:Ae,isModified:!0}:Se))},k=K=>{(K.key==="ArrowUp"||K.key==="ArrowDown")&&K.preventDefault()},L=K=>{v(ge=>ge.key===K?{key:K,direction:ge.direction==="asc"?"desc":"asc"}:{key:K,direction:"asc"})},H=K=>y.key!==K?"":y.direction==="asc"?" ":" ",G=b.useMemo(()=>{const K=new Map;n.forEach(Ae=>{const ae=v0(Ae.csvVendor),Se=ae===nw?"":ae,Re=K.get(ae);Re?Re.count+=1:K.set(ae,{key:ae,label:Se,count:1})});const ge=Array.from(K.values()).sort((Ae,ae)=>Ae.label.localeCompare(ae.label,"ja"));return[{key:Du,label:"",count:n.length},...ge]},[n]);b.useEffect(()=>{G.some(ge=>ge.key===w)||C(Du)},[G,w]),b.useEffect(()=>{if(!D)return;const K=Ae=>{E.current&&!E.current.contains(Ae.target)&&z(!1)},ge=Ae=>{Ae.key==="Escape"&&z(!1)};return document.addEventListener("mousedown",K),document.addEventListener("touchstart",K),document.addEventListener("keydown",ge),()=>{document.removeEventListener("mousedown",K),document.removeEventListener("touchstart",K),document.removeEventListener("keydown",ge)}},[D]);const ce=b.useMemo(()=>w===Du?n:n.filter(K=>v0(K.csvVendor)===w),[n,w]),q=b.useMemo(()=>{const K={[Ao]:ce.length};return Fu.forEach(ge=>{K[ge.value]=0}),ce.forEach(ge=>{const Ae=cl(ge.inputCategory);K[Ae]=(K[Ae]||0)+1}),K},[ce]),W=b.useMemo(()=>_===Ao?ce:ce.filter(K=>cl(K.inputCategory)===_),[ce,_]),ie=b.useMemo(()=>({all:W.length,unregistered:W.filter(K=>!K.isRegistered).length,registered:W.filter(K=>K.isRegistered).length}),[W]),ve=b.useMemo(()=>G.find(K=>K.key===w)||G[0],[G,w]),xe=b.useMemo(()=>W.filter(K=>!(h==="unregistered"&&K.isRegistered||h==="registered"&&!K.isRegistered||x&&!K.name.includes(x))),[W,h,x]),Ne=b.useMemo(()=>{if(!y.key)return xe;const K=ae=>String(ae??""),ge=ae=>{const Se=parseFloat(ae);return Number.isFinite(Se)?Se:Number.NEGATIVE_INFINITY},Ae=[...xe];return Ae.sort((ae,Se)=>{let Re=0;switch(y.key){case"name":Re=K(ae.name).localeCompare(K(Se.name),"ja");break;case"csvPrice":Re=ge(ae.csvPrice)-ge(Se.csvPrice);break;case"inputCategory":{const Oe=Op[cl(ae.inputCategory)]||"",He=Op[cl(Se.inputCategory)]||"";Re=Oe.localeCompare(He,"ja");break}case"inputSize":Re=ge(ae.inputSize)-ge(Se.inputSize);break;case"inputUnit":Re=K(ae.inputUnit).localeCompare(K(Se.inputUnit),"ja");break;case"inputPrice":Re=ge(ae.inputPrice)-ge(Se.inputPrice);break;default:Re=0;break}return Re===0&&(Re=K(ae.name).localeCompare(K(Se.name),"ja")),y.direction==="asc"?Re:-Re}),Ae},[xe,y]),de=n.filter(K=>K.isModified).length;return i?r.jsx("div",{style:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#666",padding:"2rem"},children:"..."}):T?r.jsxs("div",{style:{padding:"2rem",color:"#c62828",background:"#ffebee",borderRadius:"4px"},children:[r.jsx("h3",{children:""}),r.jsx("p",{children:T}),r.jsx(le,{variant:"secondary",onClick:P,children:""})]}):r.jsxs("div",{className:"csv-importer",children:[r.jsxs("div",{className:"importer-header",children:[r.jsx(Mt,{placeholder:"...",value:x,onChange:K=>S(K.target.value),style:{maxWidth:"300px"}}),r.jsxs("div",{className:"filter-buttons",children:[r.jsxs(le,{variant:h==="all"?"primary":"secondary",onClick:()=>m("all"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",ie.all,")"]}),r.jsxs(le,{variant:h==="unregistered"?"primary":"secondary",onClick:()=>m("unregistered"),size:"sm",style:{marginRight:"0.5rem"},children:[" (",ie.unregistered,")"]}),r.jsxs(le,{variant:h==="registered"?"primary":"secondary",onClick:()=>m("registered"),size:"sm",children:[" (",ie.registered,")"]})]}),r.jsxs("div",{className:"vendor-dropdown",ref:E,children:[r.jsxs("button",{type:"button",className:"vendor-dropdown-trigger",onClick:()=>z(K=>!K),"aria-haspopup":"listbox","aria-expanded":D,children:[r.jsxs("span",{children:[": ",ve?.label," (",ve?.count??0,")"]}),r.jsx("span",{className:`vendor-dropdown-chevron ${D?"open":""}`,children:""})]}),D&&r.jsx("div",{className:"vendor-dropdown-menu",role:"listbox","aria-label":"",children:G.map(K=>r.jsxs("button",{type:"button",className:`vendor-tab ${w===K.key?"active":""}`,onClick:()=>{C(K.key),z(!1)},role:"option","aria-selected":w===K.key,children:[K.label," (",K.count,")"]},K.key))})]}),r.jsxs("div",{className:"category-filter-row",children:[r.jsx("label",{htmlFor:"csv-item-category-filter",className:"category-filter-label",children:":"}),r.jsxs("select",{id:"csv-item-category-filter",className:"input-field category-filter-select",value:_,onChange:K=>N(K.target.value),children:[r.jsxs("option",{value:Ao,children:[" (",q[Ao]||0,")"]}),Fu.map(K=>r.jsxs("option",{value:K.value,children:[K.label," (",q[K.value]||0,")"]},K.value))]})]}),r.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[de>0&&r.jsx(le,{variant:"primary",size:"sm",onClick:$,disabled:o!==null,style:{fontWeight:"bold",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:o==="bulk"?"...":`(${de})`}),r.jsx(le,{variant:"secondary",size:"sm",onClick:P,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",style:{overflowX:"auto",flex:1},children:r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsxs("th",{style:{width:"22%"},onClick:()=>L("name"),children:[" (CSV)",H("name")]}),r.jsxs("th",{style:{width:"14%"},onClick:()=>L("csvPrice"),children:[" (CSV)",H("csvPrice")]}),r.jsxs("th",{style:{width:"14%"},onClick:()=>L("inputCategory"),children:[" ",r.jsx("span",{style:{color:"red"},children:"*"}),H("inputCategory")]}),r.jsxs("th",{style:{width:"18%"},onClick:()=>L("inputSize"),children:[" () ",r.jsx("span",{style:{color:"red"},children:"*"}),H("inputSize")]}),r.jsxs("th",{style:{width:"13%"},onClick:()=>L("inputUnit"),children:[" () ",r.jsx("span",{style:{color:"red"},children:"*"}),H("inputUnit")]}),r.jsxs("th",{style:{width:"12%"},onClick:()=>L("inputPrice"),children:[" ()",H("inputPrice")]}),r.jsx("th",{style:{width:"7%"},children:""})]})}),r.jsx("tbody",{children:Ne.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"no-data",children:""})}):Ne.map(K=>r.jsxs("tr",{style:{backgroundColor:K.isModified?"#fff8e1":K.isRegistered?"#f9fff9":"inherit",transition:"background-color 0.3s"},children:[r.jsxs("td",{style:{fontWeight:"500"},children:[K.name,K.csvVendor&&r.jsx("div",{style:{fontSize:"0.75rem",color:"#888"},children:K.csvVendor})]}),r.jsxs("td",{children:[K.csvPrice?`${K.csvPrice.toLocaleString()} `:"-",K.csvUnit&&r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:[" / ",K.csvUnit]})]}),r.jsx("td",{children:r.jsx("select",{className:"input-field",value:cl(K.inputCategory),onChange:ge=>I(K.name,"inputCategory",ge.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:Fu.map(ge=>r.jsx("option",{value:ge.value,children:ge.label},ge.value))})}),r.jsx("td",{children:r.jsx(Mt,{type:"number",value:K.inputSize,onChange:ge=>I(K.name,"inputSize",ge.target.value),onKeyDown:k,placeholder:["","","","PC","","",""].includes(K.inputUnit)?" (: 1)":": 1000",style:{width:"100%"}})}),r.jsx("td",{children:r.jsxs("select",{className:"input-field",value:K.inputUnit,onChange:ge=>I(K.name,"inputUnit",ge.target.value),style:{width:"100%",padding:"8px",cursor:"pointer"},children:[!["g","kg","ml","L","cc","cl","","","","","PC","","",""].includes(K.inputUnit)&&K.inputUnit&&r.jsxs("option",{value:K.inputUnit,children:[K.inputUnit," (CSV)"]}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"kg",children:"kg"}),r.jsx("option",{value:"ml",children:"ml"}),r.jsx("option",{value:"L",children:"L"}),r.jsx("option",{value:"cc",children:"cc"}),r.jsx("option",{value:"cl",children:"cl"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"PC",children:"PC"}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""}),r.jsx("option",{value:"",children:""})]})}),r.jsx("td",{children:r.jsx(Mt,{type:"number",value:K.inputPrice,onChange:ge=>I(K.name,"inputPrice",ge.target.value),placeholder:"",style:{width:"100%"}})}),r.jsx("td",{children:r.jsx(le,{variant:K.isRegistered?"secondary":"primary",size:"sm",onClick:()=>F(K),disabled:o===K.name||o==="bulk",block:!0,children:o===K.name?"...":K.isRegistered?"":""})})]},K.name))})]})}),r.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.85rem",color:"#666"},children:[r.jsx("p",{children:" CSV"}),r.jsx("p",{children:" "})]}),r.jsxs(jn,{isOpen:A.isOpen,onClose:()=>O({...A,isOpen:!1}),title:A.title,size:"small",children:[r.jsx("div",{style:{marginBottom:"1.5rem"},children:A.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[r.jsx(le,{variant:"secondary",onClick:()=>O({...A,isOpen:!1}),children:""}),r.jsx(le,{variant:"primary",onClick:A.onConfirm,children:""})]})]}),r.jsx(jn,{isOpen:!!d,onClose:V,title:d?.phase==="running"?"":d?.phase==="error"?"":"",size:"small",showCloseButton:d?.phase!=="running",children:d?.phase==="running"?r.jsxs("div",{className:"bulk-progress",children:[r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner","aria-hidden":"true"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:""}),r.jsxs("div",{className:"bulk-progress-subtitle",children:[(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]})]})]}),r.jsx("div",{className:"bulk-progress-bar","aria-label":"",children:r.jsx("div",{className:"bulk-progress-bar-inner",style:{width:d.total>0?`${Math.min(100,Math.round((d.processed||0)/d.total*100))}%`:"0%"}})}),r.jsxs("div",{className:"bulk-progress-meta",children:[r.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]}),d.currentName&&r.jsxs("div",{className:"bulk-progress-current",title:d.currentName,children:[": ",d.currentName]})]})]}):d?.phase==="error"?r.jsxs("div",{className:"bulk-progress",children:[r.jsx("div",{style:{color:"#991b1b",fontWeight:700,marginBottom:"0.25rem"},children:""}),d.errorMessage&&r.jsx("div",{style:{color:"#444",fontSize:"0.9rem"},children:d.errorMessage}),r.jsxs("div",{className:"bulk-progress-meta",style:{marginTop:"0.75rem"},children:[r.jsxs("div",{children:[": ",(d.processed||0).toLocaleString()," / ",(d.total||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d.failed||0).toLocaleString()," "]})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:r.jsx(le,{variant:"primary",onClick:V,children:""})})]}):r.jsxs("div",{className:"bulk-progress",children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"0.25rem"},children:""}),r.jsxs("div",{className:"bulk-progress-meta",children:[r.jsxs("div",{children:[": ",(d?.total||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d?.success||0).toLocaleString()," "]}),r.jsxs("div",{children:[": ",(d?.failed||0).toLocaleString()," "]})]}),Array.isArray(d?.failedNames)&&d.failedNames.length>0&&r.jsxs("div",{className:"bulk-progress-failures",children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"0.35rem"},children:"10"}),r.jsx("div",{style:{lineHeight:1.5},children:d.failedNames.join("")})]}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"1rem"},children:r.jsx(le,{variant:"primary",onClick:V,children:""})})]})})]})},x0=n=>{const t=String(n||"");return t?t.slice(0,7).replace("/","-"):""},cT=({onBack:n})=>{const[t,i]=ac(),{user:a}=fs(),[o,u]=b.useState("price"),[d,f]=b.useState(null),[h,m]=b.useState({type:"",message:""}),[y,v]=b.useState(!1),[x,S]=b.useState([]),[_,N]=b.useState(!1),[w,C]=b.useState(null),[D,z]=b.useState({type:"",message:""}),[T,U]=b.useState(null),[E,R]=b.useState(!1),[A,O]=b.useState(!1),[V,P]=b.useState(!1),[F,Q]=b.useState([]),[$,I]=b.useState(!1),[k,L]=b.useState(""),[H,G]=b.useState(""),[ce,q]=b.useState(!1),[W,ie]=b.useState({total:0,done:0,current:""}),[ve,xe]=b.useState(null),[Ne,de]=b.useState(!1),[K,ge]=b.useState(!1),[Ae,ae]=b.useState(!1),[Se,Re]=b.useState(!1),[Oe,He]=b.useState({type:"",message:""}),[nt,ot]=b.useState(!1),[Fe,Ce]=b.useState(new Map),[Ee,se]=b.useState([]),[Pe,dt]=b.useState(""),[gt,ct]=b.useState(""),[Qe,it]=b.useState(""),tt=je.useMemo(()=>{if(!Pe)return[];const he=Fe.get(Pe)||[],Ye=new Set;return he.forEach(ht=>{const We=x0(ht?.dateStr);We&&Ye.add(We)}),Array.from(Ye).sort((ht,We)=>We.localeCompare(ht))},[Fe,Pe]);b.useEffect(()=>{if(Qe){if(!Pe){it("");return}tt.length>0&&!tt.includes(Qe)&&it("")}},[tt,Qe,Pe]);const[ut,qt]=b.useState({key:"dateStr",direction:"desc"}),[$t,an]=b.useState("");b.useEffect(()=>{const he=t.get("tab");(he==="price"||he==="ingredients"||he==="csv-import"||he==="duplicates")&&u(he)},[]);const Ht=he=>{let Ye="asc";ut.key===he&&ut.direction==="asc"&&(Ye="desc"),qt({key:he,direction:Ye})},rn=je.useMemo(()=>{let he=[...x];if($t){const Ye=$t.toLowerCase().trim();he=he.filter(ht=>ht.name&&ht.name.toLowerCase().includes(Ye)||ht.vendor&&ht.vendor.toLowerCase().includes(Ye)||ht.dateStr&&ht.dateStr.includes(Ye))}return ut.key&&he.sort((Ye,ht)=>{let We=Ye[ut.key]||"",At=ht[ut.key]||"";return We<At?ut.direction==="asc"?-1:1:We>At?ut.direction==="asc"?1:-1:0}),he},[x,ut,$t]),[sn,Kt]=b.useState([]);b.useEffect(()=>{ee()},[]),b.useEffect(()=>{let he=!0;return(async()=>{if(o==="price"){if(a?.role!=="admin"){he&&(ge(!1),Re(!1));return}ge(!0);try{const ht=await Rp.getVoiceInputEnabled({force:!0});if(!he)return;Re(ht),He({type:"",message:""})}catch(ht){if(console.error("Failed to load voice feature flag:",ht),!he)return;He({type:"error",message:""})}finally{he&&ge(!1)}}})(),()=>{he=!1}},[o,a?.id,a?.role]);const In=async he=>{if(!(a?.role!=="admin"||Ae)){ae(!0),He({type:"info",message:"..."});try{const Ye=await Rp.setVoiceInputEnabled(he);Re(Ye),He({type:"success",message:`${Ye?"":""}`})}catch(Ye){console.error("Failed to save voice feature flag:",Ye),He({type:"error",message:""})}finally{ae(!1)}}},mn=async()=>{ot(!0);try{const Ye=await lr.fetchPriceHistory()||new Map;Ce(Ye);const ht=[];for(const[We,At]of Ye.entries()){const jt=new Set,Dt=[];if((At||[]).forEach(Z=>{const oe=[String(Z?.dateStr||""),String(Z?.price??""),String(Z?.incomingQty??""),String(Z?.unit||""),String(Z?.vendor||""),String(Z?.displayName||"")].join("|");jt.has(oe)||(jt.add(oe),Dt.push(Z))}),Dt.length<2)continue;Dt.sort((Z,oe)=>String(Z?.dateStr||"").localeCompare(String(oe?.dateStr||"")));const Vt=Dt[Dt.length-1]||{},pt=Dt.map(Z=>Number(Z?.price)).filter(Z=>Number.isFinite(Z)),te=pt.length?Math.min(...pt):null,$e=pt.length?Math.max(...pt):null,Ge=new Set(Dt.map(Z=>String(Z?.dateStr||""))).size,Et=new Set(Dt.map(Z=>String(Z?.displayName||""))).size;let J=0;for(let Z=1;Z<Dt.length;Z++){const oe=Number(Dt[Z-1]?.price),fe=Number(Dt[Z]?.price);Number.isFinite(oe)&&Number.isFinite(fe)&&oe!==fe&&J++}ht.push({key:We,name:Vt?.displayName||We,lastDate:Vt?.dateStr||"",lastPrice:Number.isFinite(Number(Vt?.price))?Number(Vt?.price):null,lastIncomingQty:Number.isFinite(Number(Vt?.incomingQty))?Number(Vt?.incomingQty):null,unit:Vt?.unit||"",vendor:Vt?.vendor||"",rows:Dt.length,dates:Ge,nameVariants:Et,minPrice:te,maxPrice:$e,changes:J})}ht.sort((We,At)=>{const jt=String(We?.lastDate||""),Dt=String(At?.lastDate||"");return jt!==Dt?Dt.localeCompare(jt):(At?.changes||0)!==(We?.changes||0)?(At?.changes||0)-(We?.changes||0):(At?.rows||0)!==(We?.rows||0)?(At?.rows||0)-(We?.rows||0):String(We?.name||"").localeCompare(String(At?.name||""),"ja")}),se(ht),Pe&&!Ye.has(Pe)&&dt("")}catch(he){console.error(he)}finally{ot(!1)}};b.useEffect(()=>{o==="duplicates"&&mn()},[o]);const ee=async()=>{N(!0);try{const he=await lr.getPriceListArray();S(he);const Ye=await lr.getFileList();Kt(Ye)}catch(he){console.error("Failed to load price data",he)}finally{N(!1)}},De=he=>{he.target.files&&he.target.files[0]&&(f(he.target.files[0]),m({type:"",message:""}))},ke=async()=>{if(!d)return;v(!0),m({type:"info",message:"..."});const he=await lr.uploadPriceList(d);if(he.success){m({type:"success",message:"..."});try{const{recipeService:ht}=await qu(async()=>{const{recipeService:jt}=await Promise.resolve().then(()=>Vf);return{recipeService:jt}},[]),We=await lr.fetchPriceList(),At=await ht.updateRecipeCosts(We);m({type:"success",message:`${At}`})}catch(ht){console.error("Cost update failed",ht),m({type:"warning",message:""})}f(null);const Ye=document.getElementById("csv-upload-input");Ye&&(Ye.value=""),ee()}else m({type:"error",message:`: ${he.error.message}`});v(!1)},Ie=he=>{C({message:`${he}
`,onConfirm:async()=>{v(!0);const Ye=await lr.deletePriceFile(he);v(!1),Ye.success?(m({type:"success",message:""}),ee()):m({type:"error",message:`: ${Ye.error.message}`})}})},Ve=he=>{he&&(U(he),R(!0),z({type:"",message:""}))},lt=()=>{if(A)return;R(!1),U(null);const he=document.getElementById("backup-upload-input");he&&(he.value="")},bt=async()=>{const he=T;if(!(!he||A)){O(!0),z({type:"info",message:"..."});try{const Ye=await he.text(),ht=JSON.parse(Ye),{recipeService:We}=await qu(async()=>{const{recipeService:Vt}=await Promise.resolve().then(()=>Vf);return{recipeService:Vt}},void 0),At=await We.importRecipes(ht),jt=Number(At?.count||0),Dt=Array.isArray(At?.errors)?At.errors.length:0;z({type:Dt>0?"warning":"success",message:`: ${jt}${Dt>0?` / : ${Dt}`:""}`}),R(!1),U(null)}catch(Ye){console.error(Ye),z({type:"error",message:""})}finally{O(!1);const Ye=document.getElementById("backup-upload-input");Ye&&(Ye.value="")}}},Lt=async()=>{P(!0),xe(null),ie({total:0,done:0,current:""}),G(""),L(""),de(!1),I(!0);try{const he=await Di.fetchAllProfiles();Q(he||[])}catch(he){console.error(he),Q([]),L("")}finally{I(!1)}},Pt=()=>{ce||(de(!1),P(!1))},hn=async()=>{if(!(!H||ce)){q(!0),xe({type:"info",message:"..."}),ie({total:0,done:0,current:""});try{const he=await lr.copyPriceFilesToUser({targetUserId:H,onProgress:({total:We,done:At,current:jt})=>{ie({total:We||0,done:At||0,current:jt||""})}}),Ye=he?.copied?.length??0,ht=he?.failed?.length??0;xe({type:ht>0?"error":"success",message:`: ${Ye}${ht>0?` / : ${ht}`:""}`,failed:he?.failed||[]})}catch(he){console.error(he),xe({type:"error",message:`: ${String(he?.message||he)}`})}finally{q(!1)}}};return r.jsxs("div",{className:["dashboard-container","fade-in",o==="ingredients"||o==="csv-import"?"dashboard-container--auto-height":""].filter(Boolean).join(" "),children:[r.jsxs("div",{className:"dashboard-header",children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsx("h2",{className:"section-title",style:{margin:0,fontSize:"1.5rem"},children:""}),r.jsx("span",{style:{fontSize:"0.85rem",color:"#666",background:"#eee",padding:"2px 8px",borderRadius:"12px"},children:"Admin Mode"})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"flex-end"},children:[o==="csv-import"&&r.jsx(le,{variant:"secondary",onClick:()=>i({view:"inventory"}),title:"",children:" "}),r.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsx("div",{className:"tabs-container",children:r.jsxs("div",{className:"tabs",children:[r.jsx("button",{className:`tab ${o==="price"?"active":""}`,onClick:()=>u("price"),children:" "}),r.jsx("button",{className:`tab ${o==="ingredients"?"active":""}`,onClick:()=>u("ingredients"),children:" "}),r.jsx("button",{className:`tab ${o==="csv-import"?"active":""}`,onClick:()=>u("csv-import"),children:" CSV"}),r.jsx("button",{className:`tab ${o==="duplicates"?"active":""}`,onClick:()=>u("duplicates"),children:" "})]})}),a?.role==="admin"&&o==="price"&&r.jsxs("div",{className:"voice-feature-card",children:[r.jsxs("div",{className:"voice-feature-card__left",children:[r.jsx("div",{className:"voice-feature-card__title",children:" Avalon API"}),r.jsx("div",{className:"voice-feature-card__desc",children:"ON/OFF"})]}),r.jsxs("div",{className:"voice-feature-card__right",children:[r.jsxs("label",{className:`voice-feature-switch ${Se?"is-on":""}`,children:[r.jsx("input",{type:"checkbox",checked:Se,onChange:he=>In(he.target.checked),disabled:K||Ae}),r.jsx("span",{className:"voice-feature-switch__slider"})]}),r.jsx("div",{className:"voice-feature-card__state",children:K?"...":Se?": ":": "})]}),Oe.message&&r.jsx("div",{className:`status-msg ${Oe.type||"info"}`,style:{marginTop:"10px",width:"100%"},children:Oe.message})]}),o==="ingredients"?r.jsx(aT,{}):o==="csv-import"?r.jsx(oT,{}):o==="duplicates"?r.jsxs("div",{className:"dashboard-content",children:[r.jsxs("aside",{className:"dashboard-sidebar",children:[r.jsxs("div",{className:"sidebar-card",style:{flex:1,minWidth:0},children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," ",r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[Ee.length.toLocaleString(),""]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem"},children:[r.jsx(Mt,{placeholder:"...",value:gt,onChange:he=>ct(he.target.value),style:{flex:1,fontSize:"0.9rem"}}),r.jsx(le,{variant:"secondary",size:"sm",onClick:mn,disabled:nt,title:"",children:""})]}),r.jsx("div",{className:"dup-list",children:nt?r.jsx("div",{className:"dup-empty",children:"..."}):Ee.length===0?r.jsx("div",{className:"dup-empty",children:"2"}):Ee.filter(he=>{const Ye=String(gt||"").trim();return Ye?String(he?.name||"").includes(Ye):!0}).map(he=>{const Ye=he.key===Pe,ht=he.minPrice!==null&&he.maxPrice!==null&&he.minPrice!==he.maxPrice;return r.jsxs("button",{type:"button",className:`dup-item ${Ye?"active":""}`,onClick:()=>dt(he.key),children:[r.jsxs("div",{className:"dup-item-top",children:[r.jsx("div",{className:"dup-item-name",title:he.name,children:he.name}),ht&&r.jsx("span",{className:"dup-badge",children:""})]}),r.jsxs("div",{className:"dup-item-meta",children:[r.jsxs("span",{children:[": ",he.lastDate||"-"]}),r.jsxs("span",{children:[": ",he.rows,""]}),r.jsxs("span",{children:[": ",he.dates,""]})]}),r.jsxs("div",{className:"dup-item-meta",children:[r.jsxs("span",{children:[he.lastPrice!==null?`${Math.round(he.lastPrice).toLocaleString()}`:"-",he.unit?` / ${he.unit}`:""]}),r.jsxs("span",{children:[": ",he.lastIncomingQty!==null?Math.round(he.lastIncomingQty).toLocaleString():"-"]}),he.vendor?r.jsxs("span",{title:he.vendor,children:[": ",he.vendor]}):r.jsx("span",{children:": -"})]}),he.nameVariants>1&&r.jsxs("div",{className:"dup-item-note",children:[": ",he.nameVariants,""]})]},he.key)})})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsx("div",{className:"sidebar-title",children:" "}),r.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:"//"})]})]})]}),r.jsxs("main",{className:"dashboard-main",children:[r.jsxs("div",{className:"main-toolbar",children:[r.jsx("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:Pe?"":""})}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsxs("select",{value:Qe,onChange:he=>it(he.target.value),disabled:!Pe,title:Pe?"":"",className:"dup-month-select",children:[r.jsx("option",{value:"",children:""}),tt.map(he=>r.jsx("option",{value:he,children:he.replace("-","/")},he))]}),r.jsx(le,{variant:"secondary",size:"sm",onClick:mn,disabled:nt,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",children:(()=>{if(!Pe)return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"220px",color:"#888"},children:""});const he=Fe.get(Pe)||[],Ye=new Set,ht=[];he.forEach(pt=>{const te=[String(pt?.dateStr||""),String(pt?.price??""),String(pt?.incomingQty??""),String(pt?.unit||""),String(pt?.vendor||""),String(pt?.displayName||""),String(pt?.sourceFile||"")].join("|");Ye.has(te)||(Ye.add(te),ht.push(pt))}),ht.sort((pt,te)=>String(pt?.dateStr||"").localeCompare(String(te?.dateStr||"")));const We=Qe?ht.filter(pt=>x0(pt?.dateStr)===Qe):ht,At=We.map((pt,te)=>{const $e=te>0?We[te-1]:null,Ge=$e?Number($e?.price):NaN,Et=Number(pt?.price);let J=null,Z=null;return Number.isFinite(Ge)&&Number.isFinite(Et)&&(J=Et-Ge,Z=Ge!==0?J/Ge*100:null),{...pt,_diff:J,_pct:Z}}),jt=We.reduce((pt,te)=>{const $e=Number(te?.incomingQty);return pt+(Number.isFinite($e)?$e:0)},0),Dt=We.reduce((pt,te)=>{const $e=Number(te?.incomingQty),Ge=Number(te?.price);return!Number.isFinite($e)||!Number.isFinite(Ge)?pt:pt+$e*Ge},0),Vt=[...At].reverse();return r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"120px"},children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:"CSV"}),r.jsx("th",{style:{textAlign:"right",width:"120px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"160px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"180px"},children:""}),r.jsx("th",{style:{textAlign:"right",width:"180px"},children:""})]})}),r.jsx("tbody",{children:Vt.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"7",className:"no-data",children:Qe?`${Qe}`:""})}):Vt.map((pt,te)=>{const $e=pt?._diff,Ge=pt?._pct,Et=$e==null||!Number.isFinite($e)?"-":`${$e>=0?"+":""}${Math.round($e).toLocaleString()}`,J=Ge==null||!Number.isFinite(Ge)?"":` (${Ge>=0?"+":""}${Ge.toFixed(1)}%)`,Z=$e==null||!Number.isFinite($e)?"#888":$e>0?"#c92a2a":$e<0?"#2b8a3e":"#666",oe=Number(pt?.price),fe=Number.isFinite(oe)?`${Math.round(oe).toLocaleString()}`:"-",Le=Number(pt?.incomingQty),qe=Number.isFinite(Le)?Math.round(Le).toLocaleString():"-",Ze=Number.isFinite(Le)&&Number.isFinite(oe)?Le*oe:NaN,Xe=Number.isFinite(Ze)?`${Math.round(Ze).toLocaleString()}`:"-";return r.jsxs("tr",{children:[r.jsx("td",{className:"col-date",children:pt?.dateStr||"-"}),r.jsx("td",{children:pt?.vendor||"-"}),r.jsx("td",{style:{fontWeight:500},children:pt?.displayName||"-"}),r.jsx("td",{className:"col-number",children:qe}),r.jsxs("td",{className:"col-number",children:[fe,pt?.unit&&r.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",pt.unit]})]}),r.jsx("td",{className:"col-number",children:Xe}),r.jsxs("td",{className:"col-number",style:{color:Z},children:[Et,J]})]},`${pt?.dateStr||"d"}-${te}`)})}),Vt.length>0&&r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsxs("td",{colSpan:"3",style:{fontWeight:700},children:["",Qe?`${Qe}`:""]}),r.jsx("td",{className:"col-number",style:{fontWeight:700},children:Math.round(jt).toLocaleString()}),r.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"}),r.jsxs("td",{className:"col-number",style:{fontWeight:700},children:["",Math.round(Dt).toLocaleString()]}),r.jsx("td",{className:"col-number",style:{color:"#888"},children:"-"})]})})]})})()})]})]}):r.jsxs("div",{className:"dashboard-content",children:[r.jsxs("aside",{className:"dashboard-sidebar",children:[r.jsxs("div",{className:"sidebar-card",style:{borderColor:"var(--color-primary)"},children:[r.jsxs("div",{className:"sidebar-title",style:{color:"#000"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:""}),r.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:async()=>{try{const he=await qu(()=>Promise.resolve().then(()=>Vf),void 0).then(At=>At.recipeService.exportAllRecipes()),Ye=new Blob([JSON.stringify(he,null,2)],{type:"application/json"}),ht=URL.createObjectURL(Ye),We=document.createElement("a");We.href=ht,We.download=`recipe_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(We),We.click(),document.body.removeChild(We),URL.revokeObjectURL(ht)}catch(he){z({type:"error",message:""}),console.error(he)}},children:" JSON"})]}),r.jsxs("div",{children:[r.jsx("p",{style:{fontSize:"0.85rem",color:"#333",marginBottom:"0.5rem"},children:" / "}),r.jsx("input",{type:"file",accept:".json",id:"backup-upload-input",style:{display:"none"},onChange:he=>{const Ye=he.target.files?.[0];Ye&&Ve(Ye)}}),r.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:()=>document.getElementById("backup-upload-input").click(),disabled:y||A,children:" "}),D.message&&r.jsx("div",{className:`status-msg ${D.type}`,style:{marginTop:"10px"},children:D.message})]})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," "]}),r.jsxs("div",{className:"upload-area",children:[r.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",marginBottom:"0.5rem"},children:["CSV (Shift-JIS)",r.jsx("br",{}),r.jsxs("span",{style:{fontSize:"0.75rem",color:"#888"},children:[" 1: ...",r.jsx("br",{})," 2: "]})]}),r.jsx("input",{type:"file",accept:".csv",onChange:De,id:"csv-upload-input",className:"csv-input",style:{width:"100%",marginBottom:"0.5rem",fontSize:"0.85rem"}}),r.jsx(le,{variant:"primary",onClick:ke,disabled:!d||y,className:"upload-btn",size:"sm",block:!0,children:y?"...":""})]}),h.message&&r.jsx("div",{className:`status-msg ${h.type}`,children:h.message})]}),a?.role==="admin"&&r.jsxs("div",{className:"sidebar-card",children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{fontSize:"0.85rem",color:"#333",margin:0,lineHeight:1.5},children:["CSV",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.75rem",color:"#888"},children:" 1"})]}),r.jsxs("div",{style:{fontSize:"0.82rem",color:"#666",marginTop:"0.6rem"},children:[": ",sn.length,""]}),r.jsx("div",{style:{marginTop:"0.75rem"},children:r.jsx(le,{variant:"secondary",size:"sm",block:!0,onClick:Lt,disabled:ce||y,title:"",children:""})})]}),r.jsxs("div",{className:"sidebar-card",style:{flex:1},children:[r.jsxs("div",{className:"sidebar-title",children:[r.jsx("span",{children:""})," ",r.jsxs("span",{style:{fontSize:"0.8rem",color:"#888",fontWeight:"normal",marginLeft:"auto"},children:[sn.length,""]})]}),sn.length===0?r.jsx("p",{style:{color:"#aaa",fontStyle:"italic",fontSize:"0.85rem",textAlign:"center"},children:""}):r.jsx("div",{className:"file-list",children:sn.map(he=>r.jsxs("div",{className:"file-list-item",children:[r.jsx("span",{className:"file-name",title:he.name,children:he.name}),r.jsx(le,{variant:"danger",size:"sm",onClick:()=>Ie(he.name),disabled:y,style:{padding:"2px 8px",fontSize:"0.75rem",minWidth:"auto"},children:""})]},he.name))})]}),r.jsxs("div",{className:"sidebar-card",children:[r.jsx("div",{className:"sidebar-title",children:" "}),r.jsxs("ul",{style:{fontSize:"0.75rem",color:"#666",paddingLeft:"1.2rem",margin:0},children:[r.jsx("li",{style:{marginBottom:"4px"},children:""}),r.jsx("li",{style:{marginBottom:"4px"},children:" "}),r.jsx("li",{style:{marginBottom:"4px"},children:""})]})]})]}),r.jsxs("main",{className:"dashboard-main",children:[r.jsxs("div",{className:"main-toolbar",children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[r.jsx("h3",{style:{margin:0,fontSize:"1.1rem",color:"#333"},children:""}),r.jsxs("span",{style:{fontSize:"0.9rem",color:"#666",fontWeight:"500"},children:[" ",rn.length.toLocaleString()," "]})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[r.jsx(Mt,{placeholder:" (, , )...",value:$t,onChange:he=>an(he.target.value),style:{width:"250px",fontSize:"0.9rem"}}),r.jsx(le,{variant:"secondary",size:"sm",onClick:ee,children:" "})]})]}),r.jsx("div",{className:"table-wrapper",children:_?r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",color:"#888"},children:"..."}):r.jsxs("table",{className:"enterprise-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsxs("th",{onClick:()=>Ht("dateStr"),style:{width:"120px"},children:[" ",ut.key==="dateStr"&&(ut.direction==="asc"?"":"")]}),r.jsxs("th",{onClick:()=>Ht("vendor"),children:[" ",ut.key==="vendor"&&(ut.direction==="asc"?"":"")]}),r.jsxs("th",{onClick:()=>Ht("name"),children:[" ",ut.key==="name"&&(ut.direction==="asc"?"":"")]}),r.jsx("th",{style:{textAlign:"right",width:"150px"},children:" ()"})]})}),r.jsx("tbody",{children:rn.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"4",className:"no-data",children:""})}):rn.map((he,Ye)=>r.jsxs("tr",{children:[r.jsx("td",{className:"col-date",children:he.dateStr||"-"}),r.jsx("td",{children:he.vendor||"-"}),r.jsx("td",{style:{fontWeight:"500"},children:he.name}),r.jsxs("td",{className:"col-number",children:[he.price?he.price.toLocaleString():"-",he.unit&&r.jsxs("span",{style:{color:"#888",fontSize:"0.85em",marginLeft:"4px"},children:["/ ",he.unit]})]})]},Ye))})]})})]})]}),r.jsx(jn,{isOpen:E,onClose:lt,title:" / ",size:"medium",showCloseButton:!A,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["JSON",r.jsx("br",{}),r.jsx("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:" "})]}),r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsx("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:T?.name||"-"})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(le,{variant:"ghost",onClick:lt,disabled:A,children:""}),r.jsx(le,{variant:"primary",onClick:bt,disabled:!T||A,children:A?"...":""})]}),A&&r.jsx("div",{className:"bulk-progress",style:{marginTop:"10px"},children:r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:""})]})]})}),D.message&&r.jsx("div",{className:`status-msg ${D.type||"info"}`,style:{whiteSpace:"pre-wrap"},children:D.message})]})}),r.jsx(jn,{isOpen:V,onClose:Pt,title:"",size:"medium",showCloseButton:!ce,children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["CSV",r.jsx("br",{}),r.jsxs("span",{style:{color:"#6b7280",fontSize:"0.85rem"},children:[" 1 ",r.jsx("code",{children:"_copy"})," "]})]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#6b7280"},children:[": ",r.jsx("strong",{style:{color:"#111827"},children:a?.displayId||""})," / : ",sn.length,""]}),Ne?r.jsxs(r.Fragment,{children:[(()=>{const he=F.find(ht=>String(ht?.id)===String(H)),Ye=he?`${he.display_id}${he.email?` (${he.email})`:""}`:H?String(H).slice(0,8):"-";return r.jsxs("div",{style:{border:"1px solid #e5e7eb",borderRadius:"10px",padding:"12px",background:"#f8fafc",color:"#111827"},children:[r.jsx("div",{style:{fontWeight:700,marginBottom:"6px"},children:""}),r.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[": ",r.jsx("strong",{children:Ye}),r.jsx("br",{}),": ",r.jsx("strong",{children:sn.length.toLocaleString()})," CSV",r.jsx("br",{}),": ",r.jsx("code",{children:"_copy"})," "]})]})})(),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>de(!1),disabled:ce,children:""}),r.jsx(le,{variant:"primary",onClick:hn,disabled:!H||ce,children:ce?"...":""})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:600,marginBottom:"6px",color:"#111827"},children:""}),$?r.jsx("div",{style:{color:"#6b7280",fontSize:"0.9rem"},children:"..."}):r.jsxs("select",{value:H,onChange:he=>G(he.target.value),disabled:ce||!!k,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #d1d5db",fontSize:"0.95rem",background:ce?"#f3f4f6":"white"},children:[r.jsx("option",{value:"",children:"..."}),F.filter(he=>String(he?.id)&&String(he?.id)!==String(a?.id)).map(he=>r.jsxs("option",{value:he.id,children:[he.display_id,he.email?` (${he.email})`:"",he.role==="admin"?" []":""]},he.id))]}),k&&r.jsx("div",{style:{marginTop:"8px",color:"#c92a2a",fontSize:"0.85rem"},children:k})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"4px"},children:[r.jsx(le,{variant:"ghost",onClick:Pt,disabled:ce,children:""}),r.jsx(le,{variant:"primary",onClick:()=>de(!0),disabled:!H||ce||$||!!k,children:""})]})]}),ce&&r.jsxs("div",{className:"bulk-progress",style:{marginTop:"10px"},children:[r.jsxs("div",{className:"bulk-progress-head",children:[r.jsx("div",{className:"bulk-progress-spinner"}),r.jsxs("div",{children:[r.jsx("div",{className:"bulk-progress-title",children:"..."}),r.jsx("div",{className:"bulk-progress-subtitle",children:W.total?`${W.done} / ${W.total}`:"..."})]})]}),r.jsx("div",{className:"bulk-progress-bar",children:r.jsx("div",{className:"bulk-progress-bar-inner",style:{width:W.total?`${Math.round(W.done/W.total*100)}%`:"0%"}})}),r.jsx("div",{className:"bulk-progress-current",title:W.current,children:W.current})]}),ve?.message&&r.jsx("div",{className:`status-msg ${ve.type||"info"}`,children:ve.message}),Array.isArray(ve?.failed)&&ve.failed.length>0&&r.jsxs("div",{className:"bulk-progress-failures",children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"6px"},children:[": ",ve.failed.length,""]}),r.jsx("ul",{style:{paddingLeft:"1.2rem",margin:0},children:ve.failed.slice(0,10).map((he,Ye)=>r.jsxs("li",{children:[he?.file||"-",": ",he?.errorMessage||"unknown error"]},`${he?.file||"f"}-${Ye}`))}),ve.failed.length>10&&r.jsxs("div",{style:{marginTop:"6px"},children:["... ",ve.failed.length-10,""]})]})]})}),w&&r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,animation:"fadeIn 0.2s ease-out"},onClick:()=>C(null),children:r.jsxs("div",{style:{backgroundColor:"white",padding:"24px",borderRadius:"8px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.1)"},onClick:he=>he.stopPropagation(),children:[r.jsx("h3",{style:{marginTop:0,marginBottom:"16px",color:"#333"},children:""}),r.jsx("p",{style:{whiteSpace:"pre-wrap",marginBottom:"24px",color:"#666"},children:w.message}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"12px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>C(null),children:""}),r.jsx(le,{variant:"danger",onClick:()=>{w.onConfirm(),C(null)},children:""})]})]})})]})},uT=({recipes:n,recentIds:t,onSelect:i})=>{if(!t||t.length===0)return null;const a=t.map(o=>n.find(u=>u.id===o)).filter(Boolean).slice(0,7);return a.length===0?null:r.jsxs("div",{className:"recent-recipes",children:[r.jsx("h3",{className:"recent-header",children:""}),r.jsx("div",{className:"recent-list",children:a.map(o=>r.jsxs("div",{className:"recent-item",onClick:()=>i(o),children:[r.jsx("div",{className:"recent-thumbnail",children:o.image?r.jsx("img",{src:o.image,alt:o.title}):r.jsx("div",{className:"recent-placeholder"})}),r.jsx("div",{className:"recent-info",children:r.jsx("div",{className:"recent-title",children:o.title})})]},o.id))})]})},dT=({onBack:n})=>(b.useEffect(()=>{window.scrollTo(0,0)},[]),r.jsxs("div",{className:"levain-guide-container",children:[r.jsxs("header",{className:"levain-guide-header",children:[r.jsx("h1",{children:"LEVAIN GUIDE"}),r.jsx("p",{className:"subtitle",children:" "}),r.jsx("p",{className:"subtitle",children:""}),r.jsx("div",{className:"divider"})]}),r.jsxs("main",{className:"levain-guide-main",children:[r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("p",{children:"Levain"}),r.jsx("h3",{children:""}),r.jsx("p",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"Yeast"})," Saccharomyces cerevisiae, Saccharomyces pastorianus ",r.jsx("br",{}),r.jsx("strong",{children:"LAB"})," Lactobacillus plantarum, Lactobacillus brevis ",r.jsx("br",{}),r.jsx("strong",{children:""})," Acetobacter aceti "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:["",r.jsx("br",{}),r.jsxs("div",{className:"formula",children:["CHO  2CHOH + 2CO + ",r.jsx("br",{}),"(   +  + )"]}),"",r.jsx("br",{}),r.jsxs("div",{className:"formula",children:["CHO  2CHO",r.jsx("br",{}),"(  )"]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"- 7-10"}),r.jsxs("div",{className:"timeline",children:[r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 1-2 "}),r.jsx("p",{children:"100g + 100ml 20-22"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," "]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 3-4 "}),r.jsx("p",{children:"50%50g + 50ml "}),r.jsx("p",{children:"100g  50g50g + 50ml"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," pH 3.5-4.5"]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 5-6 2"}),r.jsx("p",{children:"50%50g + 50ml "}),r.jsxs("div",{className:"success-box",children:[" ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]}),r.jsxs("div",{className:"timeline-item",children:[r.jsx("span",{className:"timeline-label",children:"Day 7-10 3"}),r.jsx("p",{children:"1150%1:1"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," 15",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," pH 3.5-4.0"]})]})]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"(g)"}),r.jsx("th",{children:"(ml)"}),r.jsx("th",{children:"(g)"}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"0"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"2"}),r.jsx("td",{children:"1"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"100"}),r.jsx("td",{children:"0"}),r.jsx("td",{children:""})]})]})]})})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"5-8"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"2-4"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"15-18"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"1-2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"20-22"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"3-5"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"25-28"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"2-3"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"30"}),r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:"1-2"})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"1"}),r.jsx("br",{}),"100g50g + 50ml"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"8-12"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),""]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"2%100ml2g"}),r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"2"}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 12 8:00"}),r.jsx("br",{}),"50g25g + 25ml "]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 1  14:00"}),r.jsx("br",{}),"25g + 25ml 2"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:"Day 1  20:00"}),r.jsx("br",{}),""]})]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:" "})," ",r.jsx("br",{}),"",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:" "})," pH",r.jsx("br",{}),"pH 3.5-4.0pH"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"18"}),r.jsx("td",{children:"16-24"}),r.jsx("td",{children:"1"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"20-22"}),r.jsx("td",{children:"12-16"}),r.jsx("td",{children:"2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"24-26"}),r.jsx("td",{children:"8-12"}),r.jsx("td",{children:"2"})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"28"}),r.jsx("td",{children:"4-8"}),r.jsx("td",{children:"2"})]})]})]})})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"1"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. 22",r.jsx("br",{}),"2. 12",r.jsx("br",{}),"3. 1",r.jsx("br",{}),"4. 1-2"]}),r.jsx("h3",{children:"2"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," pH",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," "]}),r.jsx("h3",{children:"3"}),r.jsxs("div",{className:"warning-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. 15",r.jsx("br",{}),"3. 80%"]}),r.jsx("h3",{children:"4"}),r.jsxs("div",{className:"success-box",children:["",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""})," "]}),r.jsx("h3",{children:"5"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{}),"1. 1:0.8",r.jsx("br",{}),"2. ",r.jsx("br",{}),"3. "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:"pH"}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"pH4-8.0"}),r.jsx("br",{}),r.jsx("br",{})," pH 7.0",r.jsx("br",{})," pH 4.5-5.5",r.jsx("br",{})," pH 3.5-4.0",r.jsx("br",{})," pH 3.0"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"science-box",children:[r.jsx("strong",{children:"pH 3.8-4.0"})," ",r.jsx("br",{}),r.jsx("strong",{children:"pH 3.5"})," ",r.jsx("br",{}),r.jsx("strong",{children:"pH 4.5"})," "]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," 1",r.jsx("br",{})," ",r.jsx("br",{})," -203"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:"15-20"}),r.jsx("td",{children:"18-20"}),r.jsx("td",{children:"1-2"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"25+"}),r.jsx("td",{children:"22-24"}),r.jsx("td",{children:""}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"18-22"}),r.jsx("td",{children:"20-22"}),r.jsx("td",{children:"1-2"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:"5-15"}),r.jsx("td",{children:"18"}),r.jsx("td",{children:"2-3"}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," 24",r.jsx("br",{})," ",r.jsx("br",{}),r.jsx("br",{}),r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," 18",r.jsx("br",{})," "]}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"step-list",children:[r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""})," ",r.jsx("br",{}),":=1:1 :=1:2 or 1:3"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{}),"100g + 50g + 150ml 12-24",r.jsx("br",{}),"11-2"]}),r.jsxs("div",{className:"step",children:[r.jsx("strong",{children:""}),r.jsx("br",{})," ",r.jsx("br",{})," ",r.jsx("br",{})," "]})]})]})]}),r.jsxs("div",{className:"levain-section",children:[r.jsx("h2",{children:""}),r.jsxs("div",{className:"levain-content",children:[r.jsx("h3",{children:""}),r.jsxs("div",{className:"highlight-box",children:[r.jsx("strong",{children:"100ml"}),r.jsx("br",{})," 110 to 110 CFU/ml",r.jsx("br",{})," 110 to 110 CFU/ml",r.jsx("br",{})," pH3.5-4.0",r.jsx("br",{})," 0.5-1.5%",r.jsx("br",{})," 0.3-0.8%"]}),r.jsx("h3",{children:""}),r.jsx("div",{className:"comparison-table-container",children:r.jsxs("table",{className:"levain-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsxs("tbody",{children:[r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"15-25% ()"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"5-15%"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"20-30%"}),r.jsx("td",{children:""})]}),r.jsxs("tr",{children:[r.jsx("td",{children:""}),r.jsx("td",{children:"30-50%"}),r.jsx("td",{children:""})]})]})]})}),r.jsx("h3",{children:""}),r.jsxs("div",{className:"formula",children:[" 18   - 8",r.jsx("br",{}),r.jsx("br",{}),"",r.jsx("br",{})," 2018  (20-8) = 1.5",r.jsx("br",{})," 2418  (24-8) = 1.125",r.jsx("br",{})," 2818  (28-8) = 0.954"]})]})]})]}),r.jsxs("footer",{className:"levain-footer",children:[r.jsx("p",{children:" Maitriser le Levain, c'est comprendre la vie "}),r.jsx("p",{children:""})]}),r.jsxs("button",{className:"levain-back-button",onClick:n,children:[r.jsx("span",{children:""})," "]})]})),hT=({onBack:n})=>{const{user:t,patchCurrentUserProfile:i}=fs(),[a,o]=b.useState([]),[u,d]=b.useState(!0),[f,h]=b.useState(null),[m,y]=b.useState(null),[v,x]=b.useState(""),[S,_]=b.useState(""),[N,w]=b.useState(""),[C,D]=b.useState(""),[z,T]=b.useState(!1),[U,E]=b.useState(!1),[R,A]=b.useState(new Set);b.useEffect(()=>{O()},[]);const O=async()=>{try{d(!0);const I=await Di.fetchAllProfiles();o(I)}catch(I){console.error(I),h("")}finally{d(!1)}},V=a.filter(I=>I.role==="admin"),P=a.filter(I=>I.role!=="admin"),F=(I,k)=>{A(L=>{const H=new Set(L);return k?H.add(I):H.delete(I),H})},Q=async(I,k)=>{const L=!!I.show_master_recipes;h(null),o(H=>H.map(G=>G.id===I.id?{...G,show_master_recipes:k}:G)),I.id===t?.id&&i?.({showMasterRecipes:k}),F(I.id,!0);try{const G=!!(await Di.updateProfile(I.id,{show_master_recipes:k}))?.show_master_recipes;o(ce=>ce.map(q=>q.id===I.id?{...q,show_master_recipes:G}:q)),I.id===t?.id&&i?.({showMasterRecipes:G})}catch(H){console.error(H),o(G=>G.map(ce=>ce.id===I.id?{...ce,show_master_recipes:L}:ce)),I.id===t?.id&&i?.({showMasterRecipes:L}),h("RLS")}finally{F(I.id,!1)}},$=({user:I,isAdmin:k})=>r.jsxs(un,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px",backgroundColor:"white"},children:[r.jsxs("div",{children:[r.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1rem",color:"#333"},children:[I.display_id," ",k&&r.jsx("span",{style:{fontSize:"0.8rem",backgroundColor:"#e0e0e0",padding:"2px 6px",borderRadius:"4px",marginLeft:"6px",color:"#555"},children:""})]}),I.email&&r.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px",wordBreak:"break-all"},children:I.email}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",new Date(I.created_at).toLocaleString()]}),r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"2px"},children:[": ",I.updated_at?new Date(I.updated_at).toLocaleString():"---"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"0.9rem",color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:I.show_master_recipes||!1,disabled:R.has(I.id),onChange:L=>Q(I,L.target.checked)}),""]}),r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>{y({id:I.id,display_id:I.display_id,email:I.email}),x(""),_(""),w(""),D("")},style:{whiteSpace:"nowrap"},children:""})]})]},I.id);return r.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto",height:"100%",overflowY:"auto"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",color:"var(--text-color)"},children:[r.jsx("h2",{children:""}),r.jsx(le,{variant:"ghost",onClick:n,children:""})]}),f&&r.jsx("div",{style:{padding:"10px",backgroundColor:"#ffebee",color:"#c62828",borderRadius:"4px",marginBottom:"20px"},children:f}),u?r.jsx("div",{style:{textAlign:"center",padding:"20px"},children:"..."}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[V.length>0&&r.jsxs("div",{children:[r.jsx("h3",{style:{borderBottom:"2px solid var(--color-primary)",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--color-primary)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:V.map(I=>r.jsx($,{user:I,isAdmin:!0},I.id))})]}),r.jsxs("div",{children:[r.jsx("h3",{style:{borderBottom:"2px solid #ddd",paddingBottom:"0.5rem",marginBottom:"1rem",color:"var(--text-color)"},children:""}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:P.length>0?P.map(I=>r.jsx($,{user:I,isAdmin:!1},I.id)):r.jsx("div",{style:{textAlign:"center",padding:"20px",color:"#666",backgroundColor:"#f9f9f9",borderRadius:"8px"},children:""})})]})]}),r.jsx(jn,{isOpen:!!m,onClose:()=>{z||y(null)},title:": ",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.5},children:[r.jsxs("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:[": ",m?.display_id||m?.email||m?.id]}),m?.email&&r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px",wordBreak:"break-all"},children:m.email}),r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"12px"},children:"8"}),N&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:N}),C&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"6px",marginBottom:"12px"},children:C}),r.jsxs("div",{style:{display:"grid",gap:"10px"},children:[r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),r.jsx("input",{type:"password",value:v,onChange:I=>x(I.target.value),autoComplete:"new-password",placeholder:"8",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.85rem",color:"#555",marginBottom:"6px"},children:""}),r.jsx("input",{type:"password",value:S,onChange:I=>_(I.target.value),autoComplete:"new-password",placeholder:"",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"1px solid #ddd"}})]})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>y(null),disabled:z,children:""}),r.jsx(le,{variant:"secondary",isLoading:U,disabled:!m?.email||z,onClick:async()=>{if(w(""),D(""),!m?.email){w("");return}E(!0);try{await Di.sendPasswordResetEmail(m.email),D("")}catch(I){console.error(I),w(I?.message||"")}finally{E(!1)}},style:{whiteSpace:"nowrap"},children:""}),r.jsx(le,{variant:"danger",isLoading:z,onClick:async()=>{if(w(""),D(""),!!m?.id){if(!v||v.length<8){w("8");return}if(v!==S){w("");return}T(!0);try{await Di.adminResetPassword(m.id,v),D(""),x(""),_("")}catch(I){console.error(I);const k=I?.message||"";/FunctionsHttpError|not found|404/i.test(k)||/admin-reset-password/i.test(k)?w(""):w(k)}finally{T(!1)}}},children:""})]})]})})]})},bs="inventory_items",ua="inventory_snapshots",Ro="deleted_inventory_snapshots",ul=(n,t)=>{const i=String(n?.message||"");return String(n?.code||"")==="42703"?i.toLowerCase().includes(String(t).toLowerCase()):i.toLowerCase().includes(`column "${String(t).toLowerCase()}"`)&&i.toLowerCase().includes("does not exist")},Jn={getAll:async n=>{if(!n)return[];const{data:t,error:i}=await _e.from(bs).select("*").eq("user_id",n).order("created_at",{ascending:!0});return i?(console.error("Error fetching inventory:",i),[]):t||[]},add:async(n,t)=>{if(!n)throw new Error("User ID is required");const{id:i,isPhantom:a,_master:o,_csv:u,...d}=t,f=t?.tax10_override??t?.tax10Override,h=Object.prototype.hasOwnProperty.call(t||{},"tax10"),m=Object.prototype.hasOwnProperty.call(t||{},"tax10_override")||Object.prototype.hasOwnProperty.call(t||{},"tax10Override"),y=String(d?.name??"").trim(),v=String(d?.vendor??"").trim(),x={...d,name:y,vendor:v||null,user_id:n,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0};h&&(x.tax10=!!t.tax10),m&&(x.tax10_override=!!f);const S=async w=>_e.from(bs).insert([w]).select().single();let{data:_,error:N}=await S(x);if(N){const w=ul(N,"tax10"),C=ul(N,"tax10_override");if(w||C){const D={...x};w&&delete D.tax10,C&&delete D.tax10_override,{data:_,error:N}=await S(D)}}if(N&&String(N?.code||"")==="23505"){let w=_e.from(bs).select("*").eq("user_id",n).eq("name",y).order("updated_at",{ascending:!1}).order("id",{ascending:!1}).limit(1);v?w=w.eq("vendor",v):w=w.is("vendor",null);const{data:C,error:D}=await w;if(!D&&Array.isArray(C)&&C.length>0){const z=C[0];return await Jn.update(n,{...z,...x,id:z.id})}}if(N)throw console.error("Error adding item:",N),N;return _},update:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t.id)throw new Error("Item ID is required for update");const{id:i,isPhantom:a,created_at:o,_master:u,_csv:d,...f}=t,h=t?.tax10_override??t?.tax10Override,m=Object.prototype.hasOwnProperty.call(t||{},"tax10"),y=Object.prototype.hasOwnProperty.call(t||{},"tax10_override")||Object.prototype.hasOwnProperty.call(t||{},"tax10Override"),v={...f,name:Object.prototype.hasOwnProperty.call(f||{},"name")?String(f.name??"").trim():f.name,vendor:Object.prototype.hasOwnProperty.call(f||{},"vendor")?String(f.vendor??"").trim()||null:f.vendor,quantity:parseFloat(t.quantity)||0,threshold:parseFloat(t.threshold)||0,price:parseFloat(t.price)||0,updated_at:new Date().toISOString()};m&&(v.tax10=!!t.tax10),y&&(v.tax10_override=!!h);const x=async N=>_e.from(bs).update(N).eq("id",t.id).eq("user_id",n).select().single();let{data:S,error:_}=await x(v);if(_){const N=ul(_,"tax10"),w=ul(_,"tax10_override");if(N||w){const C={...v};N&&delete C.tax10,w&&delete C.tax10_override,{data:S,error:_}=await x(C)}}if(_)throw console.error("Error updating item:",_),_;return S},delete:async(n,t)=>{if(!n)throw new Error("User ID is required");const{error:i}=await _e.from(bs).delete().eq("id",t).eq("user_id",n);if(i)throw console.error("Error deleting item:",i),i},adjustStock:async(n,t,i)=>{if(!n)throw new Error("User ID is required");const{data:a,error:o}=await _e.from(bs).select("quantity").eq("id",t).eq("user_id",n).single();if(o||!a)throw new Error("Item not found");const u=Math.max(0,(a.quantity||0)+i),{data:d,error:f}=await _e.from(bs).update({quantity:u,updated_at:new Date().toISOString()}).eq("id",t).eq("user_id",n).select().single();if(f)throw f;return d},clearAll:async n=>{if(!n)throw new Error("User ID is required");const{error:t}=await _e.from(bs).delete().eq("user_id",n).not("id","is",null);if(t)throw console.error("Error clearing inventory:",t),t},getIgnoredItems:async n=>{if(!n)return new Set;const{data:t,error:i}=await _e.from("ignored_items").select("name").eq("user_id",n);return i?(console.error("Error fetching ignored items:",i),new Set):new Set(t.map(a=>a.name))},ignoreItem:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)return;const{error:i}=await _e.from("ignored_items").insert([{user_id:n,name:t}]).select();if(i&&i.code!=="23505")throw console.error("Error ignoring item:",i),i},getSnapshots:async n=>{if(!n)return[];const{data:t,error:i}=await _e.from(ua).select("*").eq("user_id",n).order("snapshot_date",{ascending:!1});return i?(console.error("Error fetching snapshots:",i),[]):t||[]},getDeletedSnapshots:async n=>{if(!n)return[];const{data:t,error:i}=await _e.from(Ro).select("*").eq("user_id",n).order("deleted_at",{ascending:!1});return i?(console.error("Error fetching deleted snapshots:",i),[]):t||[]},createSnapshot:async(n,t,i,a)=>{if(!n)throw new Error("User ID is required");let o=null,u=null;const d=await _e.from(ua).insert([{user_id:n,title:t,items:i,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();if(o=d.data??null,u=d.error??null,u&&ul(u,"user_id")){const f=await _e.from(ua).insert([{title:t,items:i,total_value:a,snapshot_date:new Date().toISOString()}]).select().single();o=f.data??null,u=f.error??null}if(u)throw console.error("Error creating snapshot:",u),u;return o},deleteSnapshotToTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Snapshot ID is required");const{data:i,error:a}=await _e.from(ua).select("*").eq("id",t).eq("user_id",n).single();if(a||!i)throw console.error("Error fetching snapshot for delete:",a),a||new Error("Snapshot not found");const{error:o}=await _e.from(Ro).insert([{original_id:i.id,user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at,deleted_at:new Date().toISOString()}]);if(o)throw console.error("Error moving snapshot to trash:",o),o;const{error:u}=await _e.from(ua).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error deleting snapshot from main table:",u),u;return!0},restoreSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{data:i,error:a}=await _e.from(Ro).select("*").eq("id",t).eq("user_id",n).single();if(a||!i)throw console.error("Error fetching deleted snapshot:",a),a||new Error("Deleted snapshot not found");let o=null;{const{error:d}=await _e.from(ua).insert([{id:i.original_id,user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at}]);o=d}if(o){const{error:d}=await _e.from(ua).insert([{user_id:n,title:i.title,items:i.items,total_value:i.total_value,snapshot_date:i.snapshot_date,created_at:i.created_at}]);if(d)throw console.error("Error restoring snapshot (fallback) :",d),d}const{error:u}=await _e.from(Ro).delete().eq("id",t).eq("user_id",n);if(u)throw console.error("Error removing restored snapshot from trash:",u),u;return!0},hardDeleteSnapshotFromTrash:async(n,t)=>{if(!n)throw new Error("User ID is required");if(!t)throw new Error("Deleted snapshot ID is required");const{error:i}=await _e.from(Ro).delete().eq("id",t).eq("user_id",n);if(i)throw console.error("Error hard deleting snapshot from trash:",i),i;return!0},resetStockQuantities:async n=>{if(!n)throw new Error("User ID is required");const t=await _e.from(bs).update({quantity:0,updated_at:new Date().toISOString()}).eq("user_id",n).not("id","is",null);if(t.error){if(ul(t.error,"user_id")){const i=await _e.from(bs).update({quantity:0,updated_at:new Date().toISOString()}).not("id","is",null);if(i.error)throw console.error("Error resetting quantities (fallback):",i.error),i.error;return}throw console.error("Error resetting quantities:",t.error),t.error}}},pa=n=>{const t=String(n??"").trim();if(!t)return"";const i=t.toLowerCase();return i===""?"g":i===""?"ml":i===""?"cc":i===""?"kg":i===""?"l":i===""?"cl":i},fT=(n,t)=>{const i=pa(n),a=pa(t);if(!i||!a)return null;if(i===a)return 1;if(i==="kg"&&a==="g")return 1e3;if(i==="g"&&a==="kg")return 1/1e3;const o=i==="cc"?"ml":i,u=a==="cc"?"ml":a;return o==="l"&&u==="ml"?1e3:o==="ml"&&u==="l"?1/1e3:o==="cl"&&u==="ml"?10:o==="ml"&&u==="cl"?1/10:null},pT=n=>{const t=String(n??"").trim();return t?["","","","","","","","pc","PC",""].includes(t):!1},Oo=n=>{if(!Number.isFinite(n))return"-";const t=Math.round(n*100)/100;return Number.isInteger(t)?t.toLocaleString():t.toLocaleString("ja-JP",{maximumFractionDigits:2})},mT=({index:n,item:t,isLowStock:i,onUpdateQuantity:a,onDelete:o,onToggleTax:u,onEdit:d,onRequestUnitSync:f})=>{const[h,m]=je.useState(t.quantity===""?"":parseFloat(t.quantity)||0),y=$=>{const I=String($||"").trim();return I?I==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(I)?I:"":""},v={food:"",alcohol:"",soft_drink:"",supplies:""};je.useEffect(()=>{m(t.quantity===""?"":parseFloat(t.quantity)||0)},[t.quantity]);const x=parseFloat(t.price)||0,S=(()=>{if(!Number.isFinite(x)||x<=0)return"-";const $=t?._csv?.unit,I=String($||"").trim(),k=String(t?.unit||"").trim();if(!I)return`${Oo(x)}`;const L=pa(k),H=pa(I);if(H===L)return`${Oo(x)}/${I}`;const G=fT(H,L);if(G!==null)return`${Oo(x*G)}/${I}`;const ce=parseFloat(t?._master?.packetSize),q=String(t?._master?.packetUnit||"").trim(),W=pa(q);return pT(I)&&Number.isFinite(ce)&&ce>0&&W===L?`${Oo(x*ce)}/${I}`:`${Oo(x)}/${k||"-"}`})(),_=y(t?._master?.itemCategory),N=_==="alcohol"||_==="supplies",w=t?.tax10_override===!0||t?.tax10_override===1||t?.tax10_override==="1"||t?.tax10_override==="true",C=_?w?t?.tax10===!0||t?.tax10===1||t?.tax10==="1"||t?.tax10==="true":N:t?.tax10===!0||t?.tax10===1||t?.tax10==="1"||t?.tax10==="true",D=_?w?`${v[_]||_}: ${N?"10%":"8%"}/ `:`${v[_]||_}${C?"10%":"8%"}`:"10%",z=C?1.1:1.08,T=h===""?0:parseFloat(h),U=x*T*z,E=je.useMemo(()=>{const $=t?._master?.packetSize,I=t?._master?.packetUnit,k=parseFloat($);return!Number.isFinite(k)||k<=0?"-":`${Number.isInteger(k)?k.toLocaleString():k.toLocaleString(void 0,{maximumFractionDigits:3})}${I?String(I):""}`},[t?._master?.packetSize,t?._master?.packetUnit]),R=()=>{const $=parseFloat(h);!isNaN($)&&$!==t.quantity&&a(t.id,$)},A=$=>{$&&setTimeout(()=>{try{$.select()}catch{}},0)},O=$=>{const k=$?.closest?.("table")||document;return Array.from(k.querySelectorAll("input.inventory-quantity-input"))},V=($,I)=>{const k=O($).filter(G=>!G.disabled),L=k.indexOf($);if(L<0)return!1;const H=k[L+I];return H?(requestAnimationFrame(()=>{try{H.scrollIntoView({block:"nearest"})}catch{}H.focus(),A(H)}),!0):!1},P=$=>{if($.key==="Enter"){$.preventDefault(),V($.currentTarget,$.shiftKey?-1:1),$.currentTarget.blur();return}$.key==="Tab"&&V($.currentTarget,$.shiftKey?-1:1)&&($.preventDefault(),$.currentTarget.blur()),($.key==="ArrowUp"||$.key==="ArrowDown")&&V($.currentTarget,$.key==="ArrowUp"?-1:1)&&($.preventDefault(),$.currentTarget.blur())},F=t?._master?.packetUnit||"",Q=!!F&&pa(F)!==pa(t?.unit);return r.jsxs("tr",{className:i(t)?"low-stock":"",children:[r.jsx("td",{style:{textAlign:"center",color:"#6b7280",fontVariantNumeric:"tabular-nums"},children:Number.isFinite(n)?n+1:""}),r.jsx("td",{style:{textAlign:"center"},children:r.jsx("input",{type:"checkbox",checked:C,onChange:$=>u&&u(t,$.target.checked),title:D,className:"inventory-tax-checkbox"})}),r.jsxs("td",{children:[t.name,i(t)&&r.jsx("span",{className:"warning-badge","data-tooltip":"",style:{marginLeft:"6px"},children:""})]}),r.jsx("td",{style:{textAlign:"right"},children:S}),r.jsx("td",{style:{textAlign:"right",fontSize:"0.85rem",color:"#666"},children:E}),r.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:[r.jsx("input",{type:"text",inputMode:"decimal",value:h,onChange:$=>m(Jb($.target.value)),className:"inventory-quantity-input no-print",onBlur:R,onKeyDown:P,onFocus:$=>A($.target),onClick:$=>A($.target),style:{width:"80px",textAlign:"right",padding:"4px",border:"1px solid #ddd",borderRadius:"4px",background:"transparent"}}),r.jsx("span",{className:"print-only",style:{display:"none"},children:h})]}),r.jsx("td",{children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[r.jsx("span",{children:t.unit}),Q&&typeof f=="function"&&r.jsx("button",{type:"button",onClick:()=>f(t),title:`${F}`,style:{border:"1px solid #ddd",background:"#fff",borderRadius:"999px",padding:"0 6px",fontSize:"0.8rem",lineHeight:1.6,cursor:"pointer",opacity:.85},children:""})]})}),r.jsx("td",{style:{textAlign:"right"},children:U>0?`${Math.round(U).toLocaleString()}`:"-"}),r.jsx("td",{style:{fontSize:"0.8rem",color:"#666"},children:t.vendor||"-"}),r.jsxs("td",{style:{textAlign:"center",whiteSpace:"nowrap"},children:[typeof d=="function"&&r.jsx("button",{type:"button",onClick:()=>d(t),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.7},title:"",children:""}),r.jsx("button",{onClick:()=>o(t),style:{background:"none",border:"none",cursor:"pointer",fontSize:"1rem",opacity:.6},title:"",children:""})]})]})},gT=({items:n,loading:t,onDelete:i,onUpdateQuantity:a,onToggleTax:o,onEdit:u,onRequestUnitSync:d})=>{const{setNodeRef:f,isOver:h}=dc({id:"inventory-list-droppable"}),m=_=>_.threshold>0&&_.quantity<=_.threshold,[y,v]=je.useState({key:null,direction:"asc"}),x=_=>{v(N=>N.key===_?{key:_,direction:N.direction==="asc"?"desc":"asc"}:{key:_,direction:"asc"})},S=je.useMemo(()=>{if(!y.key)return n;const _=[...n];return y.key==="vendor"&&_.sort((N,w)=>{const C=(N?.vendor||"").toString(),D=(w?.vendor||"").toString(),z=C.localeCompare(D,"ja");if(z!==0)return y.direction==="asc"?z:-z;const T=(N?.name||"").toString(),U=(w?.name||"").toString(),E=T.localeCompare(U,"ja");return y.direction==="asc"?E:-E}),_},[n,y]);return r.jsxs("div",{ref:f,className:`inventory-list-droppable ${h?"highlight-drop":""}`,style:{flex:1,display:"flex",flexDirection:"column",backgroundColor:h?"#f0f9ff":"transparent",transition:"background-color 0.2s",borderRadius:"8px",padding:"8px"},children:[r.jsx("div",{className:"inventory-table-container",children:t?r.jsx("p",{children:"Loading..."}):r.jsxs("table",{className:"inventory-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{textAlign:"center",width:"44px"},children:"No"}),r.jsx("th",{style:{textAlign:"center",width:"50px"},children:"10%"}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"}),r.jsxs("th",{onClick:()=>x("vendor"),title:"",style:{cursor:"pointer",userSelect:"none"},children:[" ",y.key==="vendor"&&(y.direction==="asc"?"":"")]}),r.jsx("th",{style:{width:"40px"}})]})}),r.jsxs("tbody",{children:[S.map((_,N)=>r.jsx(mT,{index:N,item:_,isLowStock:m,onUpdateQuantity:a,onEdit:u,onDelete:i,onToggleTax:o,onRequestUnitSync:d},_.id)),S.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"10",style:{textAlign:"center",color:"#888",padding:"2rem"},children:h?"":""})})]}),r.jsx("tfoot",{children:(()=>{const _=n.reduce((N,w)=>{const C=parseFloat(w.price)||0,D=w.quantity===""?0:parseFloat(w.quantity)||0,z=w?.tax10===!0||w?.tax10===1||w?.tax10==="1"||w?.tax10==="true"?1.1:1.08,T=C*D;return N.net+=T,N.taxed+=T*z,N},{net:0,taxed:0});return r.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f9f9f9"},children:[r.jsx("td",{colSpan:"7",style:{textAlign:"right",paddingRight:"10px"},children:" / :"}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(_.net).toLocaleString()," / ",Math.round(_.taxed).toLocaleString()]}),r.jsx("td",{colSpan:"2"})]})})()})]})}),h&&r.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(52, 152, 219, 0.1)",border:"2px dashed #3498db",borderRadius:"8px",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.5rem",color:"#3498db",fontWeight:"bold"},children:"+ "})]})},yT=({onBack:n})=>{const{user:t}=fs(),i=t?.id,[,a]=ac(),[o,u]=b.useState([]),[d,f]=b.useState([]),[h,m]=b.useState([]),[y,v]=b.useState([]),[x,S]=b.useState(new Map),[_,N]=b.useState(new Map),[w,C]=b.useState(new Set),[D,z]=b.useState(!0),[T,U]=b.useState(""),[E,R]=b.useState(!1),[A,O]=b.useState(null),[V,P]=b.useState(""),[F,Q]=b.useState(!1),[$,I]=b.useState(null),[k,L]=b.useState(!1),[H,G]=b.useState(!1),[ce,q]=b.useState(""),[W,ie]=b.useState(!1),[ve,xe]=b.useState(!0),[Ne,de]=b.useState(!1),[K,ge]=b.useState(null),[Ae,ae]=b.useState("history"),[Se,Re]=b.useState(null),[Oe,He]=b.useState(""),[nt,ot]=b.useState(!1),[Fe,Ce]=b.useState(null),[Ee,se]=b.useState(!0),[Pe,dt]=b.useState({key:"name",direction:"asc"}),[gt,ct]=b.useState(!1),[Qe,it]=b.useState(null),[tt,ut]=b.useState(new Set),[qt,$t]=b.useState(!1),[an,Ht]=b.useState(null),[rn,sn]=b.useState(null),[Kt,In]=b.useState(!1),mn=ba(dr(fd,{activationConstraint:{distance:8}})),[ee,De]=b.useState("all"),[ke,Ie]=b.useState(new Set),[Ve,lt]=b.useState(""),[bt,Lt]=b.useState(""),[Pt,hn]=b.useState({});b.useEffect(()=>{P(A&&A.name||"")},[A]);const[he,Ye]=b.useState(""),ht=({row:B,onVendorClick:X,isSelected:ne})=>{const{attributes:be,listeners:Ue,setNodeRef:Be,setActivatorNodeRef:Ke,transform:Je,transition:et,isDragging:at}=wa({id:B.vendor,data:{type:"summary-row"}}),mt={transform:wr.Transform.toString(Je),transition:et,opacity:at?.6:1};return r.jsxs("tr",{ref:Be,style:mt,...be,className:ne?"inventory-summary__row inventory-summary__row--selected":"inventory-summary__row",children:[r.jsx("td",{className:"inventory-summary__drag",children:r.jsx("span",{ref:Ke,...Ue,className:"inventory-summary__drag-handle",title:"",children:""})}),r.jsx("td",{children:r.jsxs("button",{type:"button",className:"inventory-summary__vendor-btn",onClick:()=>X?.(B.vendor),"aria-expanded":!!ne,children:[r.jsx("span",{children:B.vendor}),r.jsx("span",{className:"inventory-summary__vendor-btn-icon",children:ne?"":""})]})}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(B.total||0).toLocaleString()]})]})};b.useEffect(()=>{i&&(De("all"),U(""),We())},[i]);const We=async(B=!1)=>{B||z(!0);try{const[X,ne,be,Ue,Be,Ke,Je]=await Promise.all([Jn.getAll(i),lr.getPriceListArray(),Jn.getIgnoredItems(i),Jn.getSnapshots(i),Jn.getDeletedSnapshots(i),Un.getAllConversions(),sd.getAll(i)]);u(X),v(ne),C(be),f(Ue||[]),m(Be||[]),S(Ke||new Map),N(Je||new Map);const et=st=>{if(!st)return-1;const Nn=new Date(st).getTime();return Number.isFinite(Nn)?Nn:-1},at=(st,Ut)=>{const Nn=Math.max(et(st?.updated_at),et(st?.updatedAt),et(st?.created_at),et(st?.createdAt)),En=Math.max(et(Ut?.updated_at),et(Ut?.updatedAt),et(Ut?.created_at),et(Ut?.createdAt));return Nn!==En&&En>Nn?Ut:st},mt=new Map;(X||[]).forEach(st=>{const Ut=String(st?.vendor??"").trim()||"__no_vendor__",Nn=Jt(st?.name)||String(st?.name??"").trim();if(!Nn)return;const En=`${Ut}@@${Nn}`,Ur=mt.get(En);if(!Ur){mt.set(En,st);return}mt.set(En,at(Ur,st))});const xt=new Set(Array.from(mt.values()).map(st=>st.id));Ie(xt)}catch(X){console.error("Failed to load data:",X)}finally{B||z(!1)}},At=B=>{if(!B)return"-";const X=new Date(B);if(Number.isNaN(X.getTime()))return String(B);const ne=X.getFullYear(),be=String(X.getMonth()+1).padStart(2,"0"),Ue=String(X.getDate()).padStart(2,"0"),Be=String(X.getHours()).padStart(2,"0"),Ke=String(X.getMinutes()).padStart(2,"0");return`${ne}/${be}/${Ue} ${Be}:${Ke}`},jt=B=>{const X=B?.items;return Array.isArray(X)?X:X?[]:[]},Dt=B=>{const X=B?.snapshot_date||B?.created_at;if(!X)return null;const ne=new Date(X);return Number.isNaN(ne.getTime())?null:ne},Vt=je.useMemo(()=>new Set([""]),[]),pt=B=>{const X=String(B??"").trim();return Vt.has(X)},te=B=>B===!0||B===1||B==="1"||B==="true",$e=B=>{const X=String(B??"").trim();if(!X)return"";const ne=X.toLowerCase();return ne===""?"g":ne===""?"ml":ne===""?"cc":ne===""?"kg":ne===""?"l":ne===""?"cl":ne},Ge=(B,X)=>{const ne=parseFloat(B?.lastPrice),be=parseFloat(B?.packetSize),Ue=$e(B?.packetUnit),Be=$e(X||Ue);if(!Number.isFinite(ne)||!Number.isFinite(be)||be<=0||!Ue)return null;const Ke=ne/be;if(Be===Ue)return Ke;if(Ue==="g"&&Be==="kg")return Ke*1e3;if(Ue==="kg"&&Be==="g")return Ke/1e3;const Je=Ue==="cc"?"ml":Ue,et=Be==="cc"?"ml":Be;return Je==="ml"&&et==="l"?Ke*1e3:Je==="l"&&et==="ml"?Ke/1e3:Je==="cl"&&et==="ml"?ne/be/10:Je==="ml"&&et==="cl"?Ke*10:Je==="cl"&&et==="cl"?Ke:null},Et=(B,X)=>{const ne=$e(B),be=$e(X);if(!ne||!be)return null;if(ne===be)return 1;if(ne==="kg"&&be==="g")return 1e3;if(ne==="g"&&be==="kg")return 1/1e3;const Ue=ne==="cc"?"ml":ne,Be=be==="cc"?"ml":be;return Ue==="l"&&Be==="ml"?1e3:Ue==="ml"&&Be==="l"?1/1e3:Ue==="cl"&&Be==="ml"?10:Ue==="ml"&&Be==="cl"?1/10:null},J=B=>{const X=String(B||"").trim();return X?X==="food_alcohol"?"food":["food","alcohol","soft_drink","supplies"].includes(X)?X:"":""},Z=B=>{const X=J(B);return X==="alcohol"||X==="supplies"},oe=B=>{const X=J(B);return X==="food"?"":X==="alcohol"||X==="soft_drink"?"":X==="supplies"?"":""},fe=B=>{const X=J(B);return X==="food"?"food":X==="alcohol"||X==="soft_drink"?"drink":X==="supplies"?"supplies":"unknown"},Le=B=>B==="food"?"":B==="drink"?"":B==="supplies"?"":"",qe=B=>te(B?.tax10)?1.1:1.08,Ze=B=>B?`${B.getFullYear()}-${String(B.getMonth()+1).padStart(2,"0")}`:"",Xe=B=>{if(!B)return-1;const ne=new Date(B).getTime();return Number.isFinite(ne)?ne:-1},Ct=B=>{const X=[B?.updated_at,B?.updatedAt,B?.created_at,B?.createdAt];for(const ne of X){const be=Xe(ne);if(be>=0)return be}return-1},Nt=je.useMemo(()=>{const B=new Map;return d.forEach(X=>{const ne=Dt(X);if(!ne)return;const be=Ze(ne);B.has(be)||B.set(be,{key:be,year:ne.getFullYear(),month:ne.getMonth()+1})}),Array.from(B.values()).sort((X,ne)=>ne.key.localeCompare(X.key)).map(X=>({...X,label:`${X.year}${X.month}`}))},[d]);b.useEffect(()=>{if(Nt.length===0){Ve&&lt("");return}if(Ve&&Nt.some(ne=>ne.key===Ve))return;const B=Ze(new Date),X=Nt.find(ne=>ne.key===B)?.key||Nt[0].key;lt(X)},[Nt,Ve]),b.useEffect(()=>{if(Nt.length===0){bt&&Lt("");return}if(bt&&Nt.some(ne=>ne.key===bt))return;const B=Ze(new Date),X=Nt.find(ne=>ne.key===B)?.key||Nt[0].key;Lt(X)},[Nt,bt]);const It=je.useMemo(()=>{if(!bt)return null;const[B,X]=bt.split("-"),ne=parseInt(B,10),be=parseInt(X,10);if(!Number.isFinite(ne)||!Number.isFinite(be))return null;const Ue=Je=>String(Je).padStart(2,"0"),Be=new Date(ne,be-1,1),Ke=new Date(ne,be,0);return{year:ne,month:be,start:Be,end:Ke,rangeLabel:`${ne}/${Ue(be)}/01${ne}/${Ue(be)}/${Ue(Ke.getDate())}`}},[bt]),rt=je.useMemo(()=>bt?d.map(B=>({snapshot:B,date:Dt(B)})).filter(B=>B.date&&Ze(B.date)===bt).sort((B,X)=>X.date-B.date).map(B=>B.snapshot):d,[d,bt]),kt=je.useMemo(()=>{if(!Ve)return null;const[B,X]=Ve.split("-"),ne=parseInt(B,10),be=parseInt(X,10);if(!Number.isFinite(ne)||!Number.isFinite(be))return null;const Ue=Je=>String(Je).padStart(2,"0"),Be=new Date(ne,be-1,1),Ke=new Date(ne,be,0);return{year:ne,month:be,start:Be,end:Ke,rangeLabel:`${ne}/${Ue(be)}/01${ne}/${Ue(be)}/${Ue(Ke.getDate())}`}},[Ve]),Xt=je.useMemo(()=>Ve?d.map(B=>({snapshot:B,date:Dt(B)})).filter(B=>B.date&&Ze(B.date)===Ve).sort((B,X)=>X.date-B.date).map(B=>B.snapshot):[],[d,Ve]),dn=Xt[0]||null,Wn=Ve||(dn?.id?`snapshot:${dn.id}`:""),Sr=je.useMemo(()=>{const B=new Map;return Xt.forEach(X=>{const ne=Dt(X)?.getTime()||-1;jt(X).forEach((Ue,Be)=>{const Ke=(Ue?.vendor||"").toString().trim();if(pt(Ke))return;const Je=Ke||"",et=String(Ue?.name||"").trim();if(!et)return;const at=`${Je}::${et}`,mt={item:{...Ue,vendor:Je},snapshotMs:ne,itemUpdatedMs:Ct(Ue),rowIndex:Be},xt=B.get(at);if(!xt){B.set(at,mt);return}if(mt.snapshotMs!==xt.snapshotMs){mt.snapshotMs>xt.snapshotMs&&B.set(at,mt);return}if(mt.itemUpdatedMs!==xt.itemUpdatedMs){mt.itemUpdatedMs>xt.itemUpdatedMs&&B.set(at,mt);return}mt.rowIndex>=xt.rowIndex&&B.set(at,mt)})}),Array.from(B.values()).map(X=>X.item)},[Xt,pt]),Jr=je.useMemo(()=>{const B=new Map;return Sr.forEach(X=>{const ne=(X?.vendor||"").toString().trim(),be=ne||"";if(pt(ne))return;const Ue=parseFloat(X?.price)||0,Be=X?.quantity===""?0:parseFloat(X?.quantity)||0,Ke=Ue*Be,Je=Ke*qe(X),et=B.get(be)||{vendor:be,net:0,taxed:0};et.net+=Ke,et.taxed+=Je,B.set(be,et)}),Array.from(B.values()).map(X=>({vendor:X.vendor,net:X.net,taxed:X.taxed,total:X.taxed}))},[Sr,pt,qe]),Mr=je.useMemo(()=>{const B=new Map;return Jr.forEach(X=>{B.set(X.vendor,X)}),B},[Jr]),Ii=je.useMemo(()=>{const B=new Map;try{for(const[X,ne]of(x||new Map).entries()){const be=String(X??"").trim();be&&B.set(be,ne)}}catch{}return B},[x]),Ws=je.useCallback(B=>{const X=J(B?.itemCategory??B?.item_category);if(X)return X;const ne=String(B?.name??"").trim();if(!ne)return"";const be=Ii.get(ne);return J(be?.itemCategory??be?.item_category)},[Ii]),Xr=je.useMemo(()=>{const B=new Map;Sr.forEach((X,ne)=>{const be=(X?.vendor||"").toString().trim(),Ue=be||"";if(pt(be))return;const Be=parseFloat(X?.price)||0,Ke=X?.quantity===""?0:parseFloat(X?.quantity)||0,Je=Be*Ke,et=Je*qe(X),at=Ws(X),mt=fe(at),xt=B.get(Ue)||{vendor:Ue,rows:[],totals:{food:0,drink:0,supplies:0,unknown:0,net:0,taxed:0}};xt.totals[mt]+=et,xt.totals.net+=Je,xt.totals.taxed+=et,xt.rows.push({id:X?.id||`${Ue}-${X?.name||"item"}-${ne}`,name:X?.name||"",unit:X?.unit||"",quantity:Ke,price:Be,taxed:et,itemCategory:at,breakdownKey:mt}),B.set(Ue,xt)});for(const X of B.values())X.rows.sort((ne,be)=>{const Ue={food:0,drink:1,unknown:2,supplies:3},Be=Ue[ne?.breakdownKey]??2,Ke=Ue[be?.breakdownKey]??2;if(Be!==Ke)return Be-Ke;const Je=(ne?.name||"").toString(),et=(be?.name||"").toString();return Je.localeCompare(et,"ja")});return B},[Sr,pt,qe,Ws]),or=je.useMemo(()=>Jr.slice().sort((B,X)=>X.taxed!==B.taxed?X.taxed-B.taxed:B.vendor.localeCompare(X.vendor,"ja")).map(B=>B.vendor),[Jr]),Bi=je.useMemo(()=>{if(!Wn)return or;const B=Pt[Wn],X=new Set(Mr.keys()),ne=Array.isArray(B)?B.filter(Ue=>X.has(Ue)):[],be=or.filter(Ue=>!ne.includes(Ue));return[...ne,...be]},[Pt,Wn,or,Mr]),Sa=je.useMemo(()=>Bi.map(B=>Mr.get(B)).filter(Boolean),[Bi,Mr]),ja=Sa.reduce((B,X)=>(B.net+=X.net||0,B.taxed+=X.taxed||0,B),{net:0,taxed:0});b.useEffect(()=>{he&&(Mr.has(he)||Ye(""))},[he,Mr]);const fc=B=>{Ye(X=>X===B?"":B)},_a=B=>{B?.id&&i&&(ot(!1),Ce(null),He(""),Re({title:"",message:`${B.title||""}
`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{ot(!0),Ce({type:"move",id:B.id});try{await Jn.deleteSnapshotToTrash(i,B.id),await We(!0),Ht({title:"",message:"",type:"success"})}catch(X){console.error(X),Ht({title:"",message:"()",type:"error"})}finally{ot(!1),Ce(null),Re(null)}}}))},Sd=B=>{B?.id&&i&&(ot(!1),Ce(null),He(""),Re({title:"",message:`${B.title||""}`,confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{ot(!0),Ce({type:"restore",id:B.id});try{await Jn.restoreSnapshotFromTrash(i,B.id),await We(!0),Ht({title:"",message:"",type:"success"})}catch(X){console.error(X),Ht({title:"",message:"",type:"error"})}finally{ot(!1),Ce(null),Re(null)}}}))},pr=B=>{B?.id&&i&&(ot(!1),Ce(null),He(""),Re({title:" ",message:`${B.title||""}


 delete `,requireText:"delete",confirmLabel:"",loadingLabel:"...",onConfirm:async()=>{ot(!0),Ce({type:"hard-delete",id:B.id});try{await Jn.hardDeleteSnapshotFromTrash(i,B.id),await We(!0),Ht({title:"",message:"",type:"success"})}catch(X){console.error(X),Ht({title:"",message:"",type:"error"})}finally{ot(!1),Ce(null),Re(null)}}}))},$i=B=>{if(!B)return;const X=jt(B).filter(st=>!pt(st?.vendor)),ne=["","","","","()",""],be=X.map(st=>{const Ut=parseFloat(st?.price)||0,Nn=st?.quantity===""?0:parseFloat(st?.quantity)||0,En=Math.round(Ut*Nn*qe(st));return[st?.name??"",Ut||"",st?.unit??"",st?.quantity??"",En||"",st?.vendor??""]}),Ue=st=>{const Ut=String(st??"");return Ut.includes(",")||Ut.includes('"')||Ut.includes(`
`)||Ut.includes("\r")?`"${Ut.replace(/"/g,'""')}"`:Ut},Be=[ne.map(Ue).join(","),...be.map(st=>st.map(Ue).join(","))].join(`
`),Ke=new Uint8Array([239,187,191]),Je=new Blob([Ke,Be],{type:"text/csv"}),et=URL.createObjectURL(Je),at=(B.title||"inventory_snapshot").toString().replace(/[\\/:*?"<>|]/g,"_"),mt=(B.snapshot_date?new Date(B.snapshot_date):new Date).toISOString().slice(0,10),xt=document.createElement("a");xt.href=et,xt.download=`InventorySnapshot_${mt}_${at}.csv`,document.body.appendChild(xt),xt.click(),document.body.removeChild(xt),URL.revokeObjectURL(et)},pc=()=>{if(!dn)return;const B=["","()"],X=Sa.map(st=>[st.vendor,Math.round(st.total||0)]),ne=st=>{const Ut=String(st??"");return Ut.includes(",")||Ut.includes('"')||Ut.includes(`
`)||Ut.includes("\r")?`"${Ut.replace(/"/g,'""')}"`:Ut},be=[B.map(ne).join(","),...X.map(st=>st.map(ne).join(","))].join(`
`),Ue=new Uint8Array([239,187,191]),Be=new Blob([Ue,be],{type:"text/csv"}),Ke=URL.createObjectURL(Be),Je=(dn.snapshot_date?new Date(dn.snapshot_date):new Date).toISOString().slice(0,10),et=dn.title||"inventory_summary",at=kt?`${kt.year}${String(kt.month).padStart(2,"0")}`:Je,mt=et.toString().replace(/[\\/:*?"<>|]/g,"_"),xt=document.createElement("a");xt.href=Ke,xt.download=`InventorySummary_${at}_${mt}.csv`,document.body.appendChild(xt),xt.click(),document.body.removeChild(xt),URL.revokeObjectURL(Ke)},Ol=B=>{if(!B?.vendor)return;const X=["","","","","","()",""],ne=(B.rows||[]).map(st=>{const Ut=st.itemCategory?oe(st.itemCategory):Le(st.breakdownKey);return[st.name||"",Ut,Math.round(st.price||0),st.unit||"",Number(st.quantity||0),Math.round(st.taxed||0),B.vendor]}),be=st=>{const Ut=String(st??"");return Ut.includes(",")||Ut.includes('"')||Ut.includes(`
`)||Ut.includes("\r")?`"${Ut.replace(/"/g,'""')}"`:Ut},Ue=[X.map(be).join(","),...ne.map(st=>st.map(be).join(","))].join(`
`),Be=new Uint8Array([239,187,191]),Ke=new Blob([Be,Ue],{type:"text/csv"}),Je=URL.createObjectURL(Ke),et=(dn?.snapshot_date?new Date(dn.snapshot_date):new Date).toISOString().slice(0,10),at=kt?`${kt.year}${String(kt.month).padStart(2,"0")}`:et,mt=B.vendor.toString().replace(/[\\/:*?"<>|]/g,"_"),xt=document.createElement("a");xt.href=Je,xt.download=`InventorySummary_${at}_${mt}.csv`,document.body.appendChild(xt),xt.click(),document.body.removeChild(xt),URL.revokeObjectURL(Je)},zr=je.useMemo(()=>{const B=vt=>vt?vt.toString().trim():"",X=vt=>Jt(vt),ne=new Set;try{for(const vt of(w||new Set).values()){const _t=X(vt);_t&&ne.add(_t)}}catch{}const be=new Set;try{for(const vt of(tt||new Set).values()){const _t=X(vt);_t&&be.add(_t)}}catch{}const Ue=new Map;try{for(const[vt,_t]of(x||new Map).entries()){const zt=X(vt);zt&&Ue.set(zt,_t)}}catch{}const Be=new Map;try{(y||[]).forEach(vt=>{const _t=X(vt?.name);_t&&Be.set(_t,vt)})}catch{}const Ke=new Map;try{for(const[vt,_t]of(_||new Map).entries()){const zt=X(vt);zt&&Ke.set(zt,_t)}}catch{}const Je=vt=>{const _t=String(vt??"").trim();if(!_t)return"";const zt=_t.toLowerCase();return zt===""?"g":zt===""?"ml":zt===""?"cc":zt===""?"kg":zt===""?"l":zt===""?"cl":zt},et=(vt,_t)=>{const zt=parseFloat(vt?.lastPrice),wn=parseFloat(vt?.packetSize),Tn=Je(vt?.packetUnit),Bn=Je(_t||Tn);if(!Number.isFinite(zt)||!Number.isFinite(wn)||wn<=0||!Tn)return null;const Yt=zt/wn;if(Bn===Tn)return Yt;if(Tn==="g"&&Bn==="kg")return Yt*1e3;if(Tn==="kg"&&Bn==="g")return Yt/1e3;const er=Tn==="cc"?"ml":Tn,An=Bn==="cc"?"ml":Bn;return er==="ml"&&An==="l"?Yt*1e3:er==="l"&&An==="ml"?Yt/1e3:er==="cl"&&An==="ml"?zt/wn/10:er==="ml"&&An==="cl"?Yt*10:er==="cl"&&An==="cl"?Yt:null},at=vt=>{const _t=String(vt??"").trim();return _t?["","","","","","","","pc","PC",""].includes(_t):!1},mt=vt=>{const _t=X(vt?.name),zt=_t?Ue.get(_t):null,wn=_t?Be.get(_t):null,Tn=_t&&Ke.has(_t)?String(Ke.get(_t)||""):String(wn?.unit||""),Bn={...vt};if(Bn.name=B(Bn.name),Bn.vendor=B(Bn.vendor),Bn._csv={unit:Tn,price:wn?.price??null,vendor:B(wn?.vendor)||null,dateStr:wn?.dateStr??null},!zt)return Bn;const Yt={...Bn},er=J(zt?.itemCategory),An=zt.packetUnit||"",ws=parseFloat(zt.packetSize),ts=An?et(zt,An):null;if(Yt.isPhantom)An&&ts!==null&&(Yt.unit=An,Yt.price=ts);else{if(!!An&&Number.isFinite(ws)&&ws>0&&(at(Yt.unit)||!Yt.unit)&&ts!==null){const Ss=Yt.quantity;if(Ss!==""&&Ss!==null&&Ss!==void 0){const qi=parseFloat(Ss);Number.isFinite(qi)&&(Yt.quantity=qi*ws)}const ti=Yt.threshold;if(ti!==""&&ti!==null&&ti!==void 0){const qi=parseFloat(ti);Number.isFinite(qi)&&(Yt.threshold=qi*ws)}Yt.unit=An}else(An&&ts!==null||!Yt.unit&&An)&&(Yt.unit=An);if(ts!==null&&Je(Yt.unit)===Je(An))Yt.price=ts;else{const Ss=et(zt,Yt.unit||An);Ss!==null&&(Yt.price=Ss)}}const ei=te(Yt?.tax10_override??Yt?.tax10Override),$l=er?Z(er):null;return Yt._master={packetSize:zt.packetSize,packetUnit:zt.packetUnit,lastPrice:zt.lastPrice,itemCategory:er||null,tax10Auto:$l,tax10Override:ei,updatedAt:zt.updatedAt},er&&(Yt.tax10_override=ei,!ei&&$l!==null&&(Yt.tax10=$l)),Yt},xt=o.map(mt),st=new Map;xt.forEach(vt=>{const _t=X(vt?.name);_t&&st.set(_t,vt)});const Ut=[...xt];y.forEach((vt,_t)=>{const zt=String(vt?.name??""),wn=B(zt),Tn=X(zt);if(Tn&&!(w.has(zt)||wn&&w.has(wn)||ne.has(Tn))&&!st.has(Tn)){const Bn={id:`phantom-${_t}`,isPhantom:!0,name:wn,quantity:"",unit:vt.unit||"",category:"",price:vt.price,vendor:B(vt.vendor),threshold:0,tax10:!1,tax10_override:!1};Ut.push(mt(Bn))}});const Nn=Ut.filter(vt=>{const _t=String(vt?.name??""),zt=B(_t),wn=X(_t);return!(w.has(_t)||zt&&w.has(zt)||wn&&ne.has(wn)||tt.has(_t)||zt&&tt.has(zt)||wn&&be.has(wn)||pt(vt.vendor))}),En=vt=>{if(!vt)return-1;const zt=new Date(vt).getTime();return Number.isFinite(zt)?zt:-1},Ur=(vt,_t)=>{const zt=!!vt?.isPhantom,wn=!!_t?.isPhantom;if(zt!==wn)return zt?_t:vt;const Tn=Math.max(En(vt?.updated_at),En(vt?.updatedAt),En(vt?.created_at),En(vt?.createdAt)),Bn=Math.max(En(_t?.updated_at),En(_t?.updatedAt),En(_t?.created_at),En(_t?.createdAt));if(Tn!==Bn)return Bn>Tn?_t:vt;const Yt=vt?.quantity,er=_t?.quantity,An=Yt===""||Yt===null||Yt===void 0?null:parseFloat(Yt),ws=er===""||er===null||er===void 0?null:parseFloat(er),ts=An!==null&&Number.isFinite(An),ei=ws!==null&&Number.isFinite(ws);return ts!==ei&&ei?_t:vt},es=new Map;return Nn.forEach(vt=>{const _t=X(vt?.name)||B(vt?.name);if(!_t)return;const wn=`${B(vt?.vendor)||"__no_vendor__"}@@${_t}`,Tn=es.get(wn);if(!Tn){es.set(wn,vt);return}es.set(wn,Ur(Tn,vt))}),Array.from(es.values())},[o,y,w,tt,x,_,pt]),mc=B=>{const{active:X,over:ne}=B;if(!ne)return;if(X?.data?.current?.type==="summary-row"){if(!Wn)return;const Ue=X.id,Be=ne.id;if(!Ue||!Be||Ue===Be)return;const Ke=Bi,Je=Ke.indexOf(Ue),et=Ke.indexOf(Be);if(Je<0||et<0)return;const at=Li(Ke,Je,et);hn(mt=>({...mt,[Wn]:at}));return}if(ne.id==="inventory-list-droppable"){const Ue=X.data.current.item;if(X.data.current.type==="csv-item"){const Be=String(Ue?.name??"").trim(),Ke=Jt(Be);let Je=null;if(x&&x.size>0&&Ke&&(Je=x.get(Be)||null,!Je)){for(const[xt,st]of x.entries())if(Jt(xt)===Ke){Je=st;break}}const et=Je?.packetUnit||Ue.unit,at=Je?Ge(Je,et):null,mt=at!==null?at:Je?.lastPrice!==null&&Je?.lastPrice!==void 0&&Je?.lastPrice!==""?Je.lastPrice:Ue.price;O({name:Ue.name,price:mt,unit:et,category:"",threshold:0,quantity:0,vendor:Ue.vendor,tax10:te(Ue?.tax10),isNewFromCsv:!0}),R(!0),P(Ue.name||"")}}},gc=async B=>{if(B.preventDefault(),!i)return;const X=new FormData(B.target),ne=X.get("name"),be=parseFloat(X.get("quantity")),Ue=X.get("unit"),Be=X.get("category"),Ke=parseFloat(X.get("threshold")),Je=X.get("vendor"),et=parseFloat(X.get("price")),at=X.get("packetSize"),mt=X.get("packetUnit"),xt={name:ne,quantity:Number.isFinite(be)?be:0,unit:Ue,category:Be,threshold:Number.isFinite(Ke)?Ke:0,vendor:Je||A?.vendor||"",price:Number.isFinite(et)?et:A?.price||0,tax10:te(A?.tax10)};try{if(at&&mt){const st=parseFloat(at);Number.isFinite(st)&&st>0&&await Un.saveConversion(ne,st,mt,Number.isFinite(et)?et:null,Be,Je)}A?.id&&!A.isPhantom?await Jn.update(i,{...A,...xt}):await Jn.add(i,xt),R(!1),O(null),We()}catch(st){console.error("Failed to save item:",st),Ht({title:"",message:"",type:"error"})}},Qs=B=>{it(B),ct(!0)},jd=B=>{!B||B.isPhantom||!B?._master?.packetUnit||(I(B),Q(!0))},Dl=()=>{k||(Q(!1),I(null))},Ml=async({convertQuantity:B})=>{if(!i)return;const X=$;if(!X||X.isPhantom)return;const ne=X?._master?.packetUnit;if(!ne)return;const be=ne,Ue=Ge(X?._master,be);if(Ue===null){Ht({title:"",message:"/",type:"error"});return}let Be=X.quantity,Ke=X.threshold;if(B){const Je=Et(X.unit,be);if(!Je){Ht({title:"",message:"kgg / lml ",type:"error"});return}const et=X.quantity===""?null:parseFloat(X.quantity);et!==null&&Number.isFinite(et)&&(Be=et*Je);const at=X.threshold===""?null:parseFloat(X.threshold);at!==null&&Number.isFinite(at)&&(Ke=at*Je)}L(!0);try{await Jn.update(i,{id:X.id,unit:be,price:Ue,quantity:Be===""?0:parseFloat(Be)||0,threshold:Ke===""?0:parseFloat(Ke)||0,tax10:te(X?.tax10)}),await We(!0),Q(!1),I(null)}catch(Je){console.error("Failed to sync unit:",Je),Ht({title:"",message:"",type:"error"})}finally{L(!1)}},zl=async()=>{if(Qe)try{const X=(ne=>ne?ne.toString().trim():"")(Qe?.name);X&&ut(ne=>{const be=new Set(ne);return be.add(X),be}),ct(!1),it(null)}catch(B){console.error("Failed to delete/ignore item:",B)}},_d=async(B,X)=>{try{if(!i)return;const ne=zr.find(be=>be.id===B);if(!ne)return;if(ne.isPhantom){const be={name:ne.name.trim(),quantity:X,unit:ne.unit,category:ne.category||"",price:ne.price,vendor:ne.vendor,threshold:0,tax10:te(ne?.tax10)},Ue=await Jn.add(i,be);await We(!0),Ie(Be=>{const Ke=new Set(Be);return Ke.add(Ue.id),Ke})}else u(be=>be.map(Ue=>Ue.id!==B?Ue:{...Ue,quantity:X,unit:ne.unit??Ue.unit,price:ne.price??Ue.price,threshold:ne.threshold??Ue.threshold})),Ie(be=>{const Ue=new Set(be);return Ue.add(B),Ue}),await Jn.update(i,{...ne,quantity:X})}catch(ne){console.error(ne);const be=ne?.message||ne?.error_description||(typeof ne=="string"?ne:null)||(()=>{try{return JSON.stringify(ne)}catch{return null}})()||"";Ht({title:"",message:`
${be}`,type:"error"}),We()}},yc=async(B,X)=>{try{if(!i||!B)return;const ne=!!X;if(B.isPhantom){const be={name:B.name.trim(),quantity:B.quantity===""?0:parseFloat(B.quantity)||0,unit:B.unit,category:B.category||"",price:B.price,vendor:B.vendor,threshold:0,tax10:ne,tax10_override:!0};await Jn.add(i,be),await We(!0)}else{const be=new Date().toISOString();u(Ue=>Ue.map(Be=>Be.id===B.id?{...Be,tax10:ne,tax10_override:!0,updated_at:be,updatedAt:be}:Be)),await Jn.update(i,{...B,tax10:ne,tax10_override:!0}),await We(!0)}}catch(ne){console.error(ne);const be=ne?.message||ne?.error_description||(typeof ne=="string"?ne:null)||(()=>{try{return JSON.stringify(ne)}catch{return null}})()||"";Ht({title:"",message:`
${be}`,type:"error"}),We()}},Ca=(B,X)=>{if(X===!0){sn({item:B});return}yc(B,X)},Lr=()=>{Kt||sn(null)},Ll=async()=>{const B=rn?.item;if(B){In(!0);try{await yc(B,!0),sn(null)}finally{In(!1)}}},Ul=async()=>{if(!W&&ce&&i){ie(!0);try{const B=zr.filter(ne=>!ne.isPhantom).map(ne=>{const be={...ne};return delete be.isPhantom,delete be._master,delete be._csv,be}),X=B.reduce((ne,be)=>{const Ue=parseFloat(be.price)||0,Be=be.quantity===""?0:parseFloat(be.quantity)||0;return ne+Ue*Be*qe(be)},0);await Jn.createSnapshot(i,ce,B,X),ve?(await Jn.resetStockQuantities(i),await We(),Ie(new Set)):await We(!0),G(!1),$t(!0)}catch(B){console.error("Failed to complete inventory:",B);const X=B?.message||B?.error_description||(typeof B=="string"?B:null)||(()=>{try{return JSON.stringify(B)}catch{return null}})()||"";Ht({title:"",message:`
${X}`,type:"error"})}finally{ie(!1)}}},Js=()=>{const B=["","","","","()",""],X=Zs.map(et=>{const at=parseFloat(et.price)||0,mt=et.quantity===""?0:parseFloat(et.quantity)||0,xt=Math.round(at*mt*qe(et));return[et.name,at,et.unit,et.quantity,xt,et.vendor||""]}),ne=[B.join(","),...X.map(et=>et.map(at=>{const mt=String(at??"");return mt.includes(",")||mt.includes('"')||mt.includes(`
`)?`"${mt.replace(/"/g,'""')}"`:mt}).join(","))].join(`
`),be=new Uint8Array([239,187,191]),Ue=new Blob([be,ne],{type:"text/csv"}),Be=document.createElement("a"),Ke=URL.createObjectURL(Ue),Je=new Date().toISOString().split("T")[0];Be.href=Ke,Be.download=`Inventory_${Je}.csv`,document.body.appendChild(Be),Be.click(),document.body.removeChild(Be),URL.revokeObjectURL(Ke)},Xs=["","","","","","","","","","","",""],Il=[...new Set(zr.map(B=>B.vendor).filter(B=>B&&!pt(B)))].sort(),Bl=zr.some(B=>!B.vendor),Pi=ee==="summary",Zs=zr.filter(B=>B.name.toLowerCase().includes(T.toLowerCase())?ee==="all"||ee==="summary"?!0:ee==="inventory-check"?ke.has(B.id)||!B.isPhantom:ee==="other"?!B.vendor:B.vendor===ee:!1),Zr=B=>{if(!B)return;const X=Jt(B.name);let ne=null;if(x&&x.size>0&&X&&(ne=x.get(B.name)||null,!ne)){for(const[be,Ue]of x.entries())if(Jt(be)===X){ne=Ue;break}}if(ne){const be=ne.packetUnit||A?.unit||"",Ue=ne.packetUnit?Ge(ne,be):null,Be=Ue!==null?Ue:ne.lastPrice||A?.price||0;O(Ke=>({...Ke,name:B.name,price:Be,unit:be,vendor:ne.vendor||Ke?.vendor||"",_master:{packetSize:ne.packetSize,packetUnit:ne.packetUnit,lastPrice:ne.lastPrice,itemCategory:ne.itemCategory,updatedAt:ne.updatedAt}}))}else O(be=>({...be,name:B.name}))};if(E){const B=A?._master?.packetSize||"",X=A?._master?.packetUnit||"";return r.jsxs("div",{className:"inventory-edit-container fade-in",children:[r.jsx("div",{className:"container-header",children:r.jsx("h2",{className:"section-title",children:A&&!A.isNewFromCsv?"":""})}),r.jsx(un,{className:"edit-form-card",children:r.jsxs("form",{onSubmit:gc,children:[r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(bd,{name:"name",required:!0,value:V,onChange:ne=>P(ne.target.value),onSelect:Zr,placeholder:": "})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:""}),r.jsx(Mt,{name:"vendor",defaultValue:A?.vendor,list:"vendor-list",placeholder:": "}),r.jsx("datalist",{id:"vendor-list",children:Il.filter(ne=>ne!=="").map(ne=>r.jsx("option",{value:ne},ne))})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:" ()"}),r.jsx(Mt,{name:"price",type:"number",step:"1",defaultValue:A?.price,placeholder:"0"})]})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(Mt,{name:"quantity",type:"number",step:"0.01",defaultValue:A?.quantity,required:!0})]}),r.jsxs("div",{className:"form-group",children:[r.jsxs("label",{children:[" ",r.jsx("span",{className:"badge-required",children:""})]}),r.jsx(Mt,{name:"unit",defaultValue:A?.unit||"pc",required:!0,placeholder:"g, ml, , pc..."})]})]}),r.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[r.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px",color:"#495057"},children:["  ()",r.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"normal",marginLeft:"8px",color:"#868e96"},children:" 1pc = 400g "})]}),r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{fontSize:"0.85rem"},children:" (1)"}),r.jsx(Mt,{name:"packetSize",type:"number",step:"0.01",defaultValue:B,placeholder:": 400"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{style:{fontSize:"0.85rem"},children:""}),r.jsx(Mt,{name:"packetUnit",defaultValue:X,placeholder:": g"})]})]})]}),r.jsxs("div",{className:"form-row",style:{marginTop:"16px"},children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:""}),r.jsx(Mt,{name:"category",defaultValue:A?.category,list:"category-list",placeholder:"",autoComplete:"off"}),r.jsx("datalist",{id:"category-list",children:Xs.map(ne=>r.jsx("option",{value:ne},ne))})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:" ()"}),r.jsx(Mt,{name:"threshold",type:"number",step:"0.01",defaultValue:A?.threshold||0})]})]}),r.jsxs("div",{className:"form-actions",children:[r.jsx(le,{variant:"ghost",type:"button",onClick:()=>{R(!1),O(null)},children:""}),r.jsx(le,{variant:"primary",type:"submit",children:""})]})]})})]})}return r.jsx(Mi,{onDragEnd:mc,sensors:mn,autoScroll:!1,children:r.jsxs("div",{className:"inventory-container fade-in",children:[r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions inventory-header-actions",children:[r.jsx(le,{variant:"ghost",onClick:n,children:" "}),r.jsx(le,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>a({view:"data",tab:"csv-import"}),title:"CSV",children:" CSV"}),r.jsx(le,{variant:"primary",className:"inventory-header-actions__btn inventory-header-actions__btn--main",style:{backgroundColor:"#2ecc71",borderColor:"#27ae60"},onClick:()=>{const B=new Date;q(`${B.getFullYear()}${B.getMonth()+1} `),xe(!0),G(!0)},children:" "}),r.jsx(le,{variant:"secondary",className:"inventory-header-actions__btn",onClick:()=>{ge(null),ae("history"),de(!0)},title:"",children:" "}),r.jsx(le,{variant:"primary",className:"inventory-header-actions__btn",onClick:()=>{O(null),P(""),R(!0)},children:"+ "})]})]}),r.jsx("div",{className:"inventory-split-layout",children:r.jsxs("div",{className:"inventory-right-panel",style:{paddingLeft:0,borderLeft:"none"},children:[r.jsxs("div",{className:"inventory-controls",children:[Pi?r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[r.jsxs("div",{className:"inventory-controls__field",children:[r.jsx("label",{className:"inventory-controls__label",children:":"}),r.jsx("select",{className:"inventory-controls__select",value:Ve,onChange:B=>lt(B.target.value),disabled:Nt.length===0,children:Nt.length===0?r.jsx("option",{value:"",children:""}):Nt.map(B=>r.jsx("option",{value:B.key,children:B.label},B.key))})]}),kt&&r.jsxs("div",{className:"inventory-controls__summary-range",children:[": ",kt.rangeLabel]})]}):r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--filters",children:[r.jsxs("div",{className:"inventory-controls__field",children:[r.jsx("label",{className:"inventory-controls__label",children:":"}),r.jsxs("select",{className:"inventory-controls__select",value:ee==="inventory-check"?"":ee,onChange:B=>{B.target.value&&De(B.target.value)},children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"",disabled:!0,children:""}),r.jsxs("optgroup",{label:"",children:[Il.map(B=>r.jsx("option",{value:B,children:B},B)),Bl&&r.jsx("option",{value:"other",children:""})]})]})]}),r.jsx("input",{className:"inventory-controls__search",placeholder:" ...",value:T,onChange:B=>U(B.target.value)})]}),r.jsxs("div",{className:"inventory-controls__row inventory-controls__row--actions",children:[r.jsxs("button",{className:"inventory-controls__btn",onClick:()=>De("inventory-check"),"data-active":ee==="inventory-check"?"true":"false",children:["  (",ke.size,")"]}),r.jsx("button",{className:"inventory-controls__btn",onClick:()=>De("summary"),"data-active":ee==="summary"?"true":"false",children:" "}),!Pi&&r.jsx("button",{className:"inventory-controls__btn",onClick:Js,title:"CSV",children:" CSV (.csv)"}),!Pi&&ee==="inventory-check"&&r.jsx("button",{className:"inventory-controls__btn",onClick:()=>window.print(),title:" / PDF",children:" "})]})]}),Pi?r.jsxs("div",{className:"inventory-summary",children:[r.jsx("div",{className:"inventory-summary__header",children:r.jsxs("div",{children:[r.jsx("div",{className:"inventory-summary__title",children:""}),kt&&r.jsxs("div",{className:"inventory-summary__meta",children:[": ",kt.rangeLabel]}),dn?r.jsxs("div",{className:"inventory-summary__meta",children:[": ",dn.title||"","",At(dn.snapshot_date),""]}):r.jsx("div",{className:"inventory-summary__meta",children:""}),Xt.length>1&&r.jsxs("div",{className:"inventory-summary__note",children:[" ",Xt.length," "]})]})}),dn?r.jsxs("div",{className:"inventory-summary__table-wrap",children:[r.jsx("div",{className:"inventory-summary__actions",children:r.jsx(le,{variant:"secondary",size:"sm",onClick:pc,children:" CSV (.csv)"})}),r.jsxs("table",{className:"inventory-summary__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"40px"}}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),r.jsx(xa,{items:Bi,strategy:Sl,children:r.jsxs("tbody",{children:[Sa.map(B=>{const X=he===B.vendor,ne=Xr.get(B.vendor)||null;return r.jsxs(je.Fragment,{children:[r.jsx(ht,{row:B,onVendorClick:fc,isSelected:X}),X&&ne&&r.jsxs("tr",{className:"inventory-summary__detail-row",children:[r.jsx("td",{}),r.jsx("td",{colSpan:"2",children:r.jsxs("div",{className:"inventory-summary__inline-detail",children:[r.jsxs("div",{className:"inventory-summary__inline-detail-head",children:[r.jsxs("span",{className:"inventory-summary__inline-detail-title",children:[ne.vendor," "]}),r.jsxs("div",{className:"inventory-summary__inline-detail-actions",children:[r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Ol(ne),disabled:!ne.rows||ne.rows.length===0,children:" CSV"}),r.jsxs("span",{className:"inventory-summary__inline-detail-total",children:[": ",Math.round(ne.totals.taxed||0).toLocaleString()]})]})]}),r.jsxs("div",{className:"inventory-summary__inline-breakdown",children:[["food","drink","supplies"].map(be=>r.jsxs("div",{className:"inventory-summary__inline-breakdown-row",children:[r.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:Le(be)}),r.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ne.totals[be]||0).toLocaleString()]})]},be)),ne.totals.unknown>0&&r.jsxs("div",{className:"inventory-summary__inline-breakdown-row inventory-summary__inline-breakdown-row--unknown",children:[r.jsx("span",{className:"inventory-summary__inline-breakdown-label",children:""}),r.jsxs("span",{className:"inventory-summary__inline-breakdown-value",children:["",Math.round(ne.totals.unknown).toLocaleString()]})]})]}),r.jsxs("div",{className:"inventory-summary__inline-detail-subtotal",children:[": ",Math.round(ne.totals.net||0).toLocaleString()]}),r.jsx("div",{className:"inventory-summary__inline-items-wrap",children:r.jsxs("table",{className:"inventory-summary__inline-items-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:"()"})]})}),r.jsx("tbody",{children:ne.rows.map((be,Ue)=>{const Be=be.itemCategory?oe(be.itemCategory):Le(be.breakdownKey),Ke=Ue>0?ne.rows[Ue-1]:null,Je=!!Ke&&Ke.breakdownKey!==be.breakdownKey;return r.jsxs("tr",{className:Je?"inventory-summary__inline-items-row inventory-summary__inline-items-row--category-start":"inventory-summary__inline-items-row",children:[r.jsx("td",{children:be.name||"-"}),r.jsx("td",{children:Be}),r.jsxs("td",{style:{textAlign:"right"},children:["",Number(be.price||0).toLocaleString("ja-JP",{maximumFractionDigits:2})]}),r.jsxs("td",{style:{textAlign:"right"},children:[Number(be.quantity||0).toLocaleString("ja-JP",{maximumFractionDigits:3}),be.unit?` ${be.unit}`:""]}),r.jsxs("td",{style:{textAlign:"right"},children:["",Math.round(be.taxed||0).toLocaleString()]})]},be.id)})})]})})]})})]})]},B.vendor)}),Sa.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:"3",className:"inventory-summary__empty",children:""})})]})}),r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsx("td",{}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:" / "}),r.jsxs("td",{style:{textAlign:"right",fontWeight:"bold"},children:["",Math.round(ja.net).toLocaleString()," / ",Math.round(ja.taxed).toLocaleString()]})]})})]})]}):r.jsx("div",{className:"inventory-summary__empty",children:""})]}):r.jsx(gT,{items:Zs,loading:D,onSearch:U,searchQuery:T,onEdit:B=>{O(B),P(B?.name||""),R(!0)},onDelete:Qs,onUpdateQuantity:_d,onToggleTax:Ca,onRequestUnitSync:jd})]})}),r.jsx(jn,{isOpen:!!rn,onClose:Lr,title:"10%",size:"small",showCloseButton:!Kt,children:r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("p",{style:{fontSize:"1rem",marginBottom:"0.75rem",lineHeight:1.6},children:["",rn?.item?.name||"","",r.jsx("strong",{children:"10%"}),""]}),r.jsx("div",{style:{fontSize:"0.85rem",color:"#555",lineHeight:1.5},children:""}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"16px"},children:[r.jsx(le,{variant:"secondary",onClick:Lr,disabled:Kt,children:""}),r.jsx(le,{variant:"primary",onClick:Ll,disabled:Kt,children:Kt?"...":""})]})]})}),r.jsx(jn,{isOpen:H,onClose:()=>{W||G(!1)},title:" ",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsx("p",{style:{fontSize:"1rem",marginBottom:"1rem",lineHeight:"1.6"},children:""}),r.jsxs("div",{style:{background:"#e3f2fd",padding:"10px",borderRadius:"4px",marginBottom:"1.5rem",fontSize:"0.9rem",color:"#0d47a1"},children:[r.jsx("strong",{children:":"}),r.jsx("br",{}),"1. ",r.jsx("br",{}),"2. ",ve?r.jsxs(r.Fragment,{children:[r.jsx("strong",{children:"()0"}),""]}):r.jsxs(r.Fragment,{children:[r.jsx("strong",{children:""}),""]}),r.jsx("br",{}),""]}),r.jsxs("div",{style:{marginBottom:"16px"},children:[r.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",marginBottom:"8px"},children:""}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none",marginBottom:"6px"},children:[r.jsx("input",{type:"radio",name:"inventory-reset",checked:ve,disabled:W,onChange:()=>xe(!0)}),r.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",r.jsx("strong",{children:"0"}),""]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",userSelect:"none"},children:[r.jsx("input",{type:"radio",name:"inventory-reset",checked:!ve,disabled:W,onChange:()=>xe(!1)}),r.jsxs("span",{style:{fontSize:"0.95rem",color:"#333"},children:["",r.jsx("strong",{children:""}),""]})]}),r.jsx("div",{style:{fontSize:"0.85rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:""})]}),r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:" ()"}),r.jsx("input",{type:"text",value:ce,onChange:B=>q(B.target.value),disabled:W,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx("button",{onClick:()=>{W||G(!1)},style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:W?"not-allowed":"pointer",opacity:W?.6:1,fontSize:"0.9rem"},children:""}),r.jsx("button",{onClick:Ul,disabled:W,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:W?"#94a3b8":"#2ecc71",color:"white",cursor:W?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:W?"...":ve?"":""})]}),W&&r.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",color:"#475569",textAlign:"right"},children:""})]})}),r.jsxs(jn,{isOpen:Ne,onClose:()=>de(!1),title:" ",size:"large",children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[r.jsx("div",{style:{color:"#555",fontSize:"0.9rem"},children:Ae==="history"?r.jsxs(r.Fragment,{children:[": ",r.jsx("strong",{children:rt.length})," "]}):r.jsxs(r.Fragment,{children:[": ",r.jsx("strong",{children:h.length})," "]})}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",gap:"6px"},children:[r.jsx("button",{type:"button",onClick:()=>ae("history"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:Ae==="history"?"#111":"#fff",color:Ae==="history"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""}),r.jsx("button",{type:"button",onClick:()=>ae("trash"),style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #ccc",background:Ae==="trash"?"#111":"#fff",color:Ae==="trash"?"#fff":"#333",cursor:"pointer",fontWeight:"bold",fontSize:"0.85rem"},children:""})]}),r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>We(!0),title:"",children:" "})]})]}),Ae==="history"&&r.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center",marginBottom:"12px",flexWrap:"wrap"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{style:{fontSize:"0.85rem",color:"#555"},children:":"}),r.jsx("select",{value:bt,onChange:B=>Lt(B.target.value),disabled:Nt.length===0,style:{padding:"6px 8px",borderRadius:"6px",border:"1px solid #ccc",fontSize:"0.85rem"},children:Nt.length===0?r.jsx("option",{value:"",children:""}):Nt.map(B=>r.jsx("option",{value:B.key,children:B.label},B.key))})]}),It&&r.jsxs("div",{style:{fontSize:"0.85rem",color:"#666"},children:[": ",It.rangeLabel]})]}),Ae==="history"&&rt.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):Ae==="trash"&&h.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f0f0f0"},children:[r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:Ae==="trash"?"":""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",width:"120px"}})]})}),r.jsx("tbody",{children:(Ae==="history"?rt:h).map(B=>{const X=jt(B).filter(mt=>!pt(mt?.vendor)),ne=X.length,be=Math.round(X.reduce((mt,xt)=>{const st=parseFloat(xt?.price)||0,Ut=xt?.quantity===""?0:parseFloat(xt?.quantity)||0;return mt+st*Ut*qe(xt)},0)),Ue=Ae==="trash"?`trash-${B.id}`:B.id,Be=At(Ae==="trash"?B.deleted_at:B.snapshot_date),Ke=Fe?.type==="move"&&Fe?.id===B.id,Je=Fe?.type==="restore"&&Fe?.id===B.id,et=Fe?.type==="hard-delete"&&Fe?.id===B.id,at=Ke||Je||et;return r.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[r.jsx("td",{style:{padding:"10px",whiteSpace:"nowrap"},children:Be}),r.jsx("td",{style:{padding:"10px"},children:B.title||"-"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:ne.toLocaleString()}),r.jsxs("td",{style:{padding:"10px",textAlign:"right"},children:["",be.toLocaleString()]}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Ae==="history"?r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>$i(B),disabled:ne===0||at,title:ne===0?"items CSV":"CSV",children:" CSV"}),r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>ge(B),disabled:at,children:""}),r.jsx(le,{variant:"danger",size:"sm",onClick:()=>_a(B),disabled:at,title:"",children:Ke?"...":""})]}):r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>$i(B),disabled:ne===0||at,children:" CSV"}),r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>ge(B),disabled:at,children:""}),r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>Sd(B),disabled:at,title:"",children:Je?"...":""}),r.jsx(le,{variant:"danger",size:"sm",onClick:()=>pr(B),disabled:at,title:"",children:et?"...":""})]})})]},Ue)})})]})})]}),r.jsx(jn,{isOpen:!!Se,onClose:()=>{nt||Re(null)},title:Se?.title||"",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:Se?.message}),Se?.requireText&&r.jsxs("div",{style:{marginTop:"14px"},children:[r.jsxs("label",{style:{display:"block",marginBottom:"8px",fontSize:"0.9rem",fontWeight:"bold"},children:[" ",r.jsx("span",{style:{fontFamily:"monospace",background:"#eee",padding:"2px 4px"},children:Se.requireText})," "]}),r.jsx("input",{type:"text",value:Oe,onChange:B=>He(B.target.value),placeholder:Se.requireText,disabled:nt,style:{width:"100%",padding:"10px",borderRadius:"4px",border:"1px solid #ccc",fontSize:"1rem"}})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(le,{variant:"ghost",disabled:nt,onClick:()=>{nt||Re(null)},children:""}),r.jsx(le,{variant:"danger",disabled:nt||!!Se?.requireText&&Oe!==Se.requireText,onClick:()=>Se?.onConfirm&&Se.onConfirm(),children:nt?Se?.loadingLabel||"...":Se?.confirmLabel||""})]})]})}),r.jsx(jn,{isOpen:!!K,onClose:()=>ge(null),title:K?` ${K.title||""}`:" ",size:"large",children:(()=>{const B=K;if(!B)return null;const be=[...jt(B).filter(Be=>pt(Be?.vendor)?!1:Ee?(Be?.quantity===""?0:parseFloat(Be?.quantity)||0)!==0:!0)].sort((Be,Ke)=>{const Je=Pe.direction==="desc"?-1:1;if(Pe.key==="vendor"){const Ut=(Be?.vendor||"").toString(),Nn=(Ke?.vendor||"").toString(),En=Ut.localeCompare(Nn,"ja");if(En!==0)return En*Je;const Ur=(Be?.name||"").toString(),es=(Ke?.name||"").toString();return Ur.localeCompare(es,"ja")*Je}const et=(Be?.name||"").toString(),at=(Ke?.name||"").toString(),mt=et.localeCompare(at,"ja");if(mt!==0)return mt*Je;const xt=(Be?.vendor||"").toString(),st=(Ke?.vendor||"").toString();return xt.localeCompare(st,"ja")*Je}),Ue=be.reduce((Be,Ke)=>{const Je=parseFloat(Ke?.price)||0,et=Ke?.quantity===""?0:parseFloat(Ke?.quantity)||0,at=Je*et;return Be.net+=at,Be.taxed+=at*qe(Ke),Be},{net:0,taxed:0});return r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",marginBottom:"12px",color:"#555",fontSize:"0.9rem"},children:[r.jsxs("div",{children:[": ",r.jsx("strong",{children:At(B.snapshot_date)})]}),r.jsxs("div",{children:[": ",r.jsx("strong",{children:be.length.toLocaleString()})]}),r.jsxs("div",{style:{marginLeft:"auto"},children:[" / : ",r.jsxs("strong",{children:["",Math.round(Ue.net).toLocaleString()," / ",Math.round(Ue.taxed).toLocaleString()]})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"8px",marginBottom:"12px",flexWrap:"wrap"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"0.85rem",color:"#555"},children:[r.jsx("input",{type:"checkbox",checked:Ee,onChange:Be=>se(Be.target.checked)}),"0"]}),r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>$i(B),children:" CSV (.csv)"})]}),be.length===0?r.jsx("div",{style:{color:"#666",textAlign:"center",padding:"24px 0"},children:""}):r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{background:"#f0f0f0"},children:[r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:""}),r.jsx("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"right",whiteSpace:"nowrap"},children:"()"}),r.jsxs("th",{style:{padding:"10px",borderBottom:"1px solid #e5e7eb",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer"},title:"",onClick:()=>{dt(Be=>Be.key==="vendor"?{key:"vendor",direction:Be.direction==="asc"?"desc":"asc"}:{key:"vendor",direction:"asc"})},children:[" ",Pe.key==="vendor"&&(Pe.direction==="asc"?"":"")]})]})}),r.jsx("tbody",{children:be.map((Be,Ke)=>{const Je=parseFloat(Be?.price)||0,et=Be?.quantity===""?0:parseFloat(Be?.quantity)||0,at=Math.round(Je*et*qe(Be)),mt=Ws(Be),xt=oe(mt);return r.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[r.jsxs("td",{style:{padding:"10px"},children:[Be?.name||"-",te(Be?.tax10)&&r.jsx("span",{className:"snapshot-tax-badge",title:"10%",children:"10%"})]}),r.jsx("td",{style:{padding:"10px"},children:xt}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:Je?`${Number(Je).toLocaleString("ja-JP",{maximumFractionDigits:2})}`:"-"}),r.jsx("td",{style:{padding:"10px"},children:Be?.unit||"-"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:et?et.toLocaleString():"0"}),r.jsx("td",{style:{padding:"10px",textAlign:"right"},children:at?`${at.toLocaleString()}`:"-"}),r.jsx("td",{style:{padding:"10px"},children:Be?.vendor||"-"})]},Be?.id||`${Be?.name||"item"}-${Ke}`)})})]})})]})})()}),r.jsx(jn,{isOpen:F,onClose:Dl,title:"",size:"small",children:(()=>{const B=$,X=B?._master?.packetUnit||"",ne=B?.unit||"",be=Et(ne,X),Ue=be!==null&&be!==1,Be=parseFloat(B?.price)||0,Ke=B?.quantity===""?0:parseFloat(B?.quantity)||0,Je=B?qe(B):1.08,et=Be*Ke*Je,at=X?Ge(B?._master,X):null,mt=at===null?null:at*Ke*Je,xt=at===null||!Ue?null:at*(Ke*be)*Je,st=Nn=>`${Math.round(Nn).toLocaleString()}`,Ut=Nn=>Number.isInteger(Nn)?Nn.toLocaleString():Nn.toLocaleString(void 0,{maximumFractionDigits:3});return r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("div",{style:{marginBottom:"12px",lineHeight:1.6},children:[r.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:B?.name||"-"}),r.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",Ut(Ke)," ",ne," /  ",Be.toLocaleString()," /  ",st(et)]}),!!X&&r.jsxs("div",{style:{color:"#666",fontSize:"0.9rem"},children:[": ",X]})]}),r.jsx("div",{style:{background:"#f7fafc",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"10px",marginBottom:"14px"},children:r.jsxs("div",{style:{fontSize:"0.9rem",color:"#374151",lineHeight:1.6},children:["/",r.jsx("br",{}),""]})}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",flexWrap:"wrap"},children:[r.jsx(le,{variant:"ghost",type:"button",onClick:Dl,disabled:k,children:""}),r.jsx(le,{variant:"secondary",type:"button",onClick:()=>Ml({convertQuantity:!1}),isLoading:k,disabled:k||!X||at===null,title:mt===null?"":`:  ${st(mt)}`,children:""}),Ue&&r.jsx(le,{variant:"primary",type:"button",onClick:()=>Ml({convertQuantity:!0}),isLoading:k,disabled:k||!X||at===null,title:xt===null?"":`:  ${st(xt)}`,children:""})]})]})})()}),r.jsx(jn,{isOpen:gt,onClose:()=>ct(!1),title:"",size:"small",children:r.jsxs("div",{style:{color:"#333"},children:[r.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"1rem",lineHeight:"1.6"},children:["",r.jsx("strong",{children:Qe?.name}),""]}),r.jsxs("p",{style:{color:"#666",fontSize:"0.9rem",marginBottom:"1.5rem",lineHeight:"1.5"},children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),"CSV"]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx("button",{onClick:()=>ct(!1),style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ccc",background:"#f5f5f5",color:"#333",cursor:"pointer",fontSize:"0.9rem"},children:""}),r.jsx("button",{onClick:zl,style:{padding:"8px 16px",borderRadius:"4px",border:"none",background:"#d32f2f",color:"white",cursor:"pointer",fontSize:"0.9rem",fontWeight:"bold"},children:""})]})]})}),r.jsx(jn,{isOpen:qt,onClose:()=>$t(!1),title:" ",size:"small",children:r.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[r.jsx("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:""}),r.jsxs("h3",{style:{marginBottom:"1rem"},children:[ce," "]}),r.jsxs("p",{style:{color:"#666",marginBottom:"1.5rem",lineHeight:"1.6"},children:["",r.jsx("br",{}),""]}),r.jsx("button",{onClick:()=>$t(!1),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})}),r.jsx(jn,{isOpen:!!an,onClose:()=>Ht(null),title:an?.title||"",size:"small",children:r.jsxs("div",{style:{color:"#333",textAlign:"center",padding:"1rem"},children:[an?.type==="success"&&r.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),an?.type==="error"&&r.jsx("div",{style:{fontSize:"2rem",marginBottom:"10px"},children:""}),r.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1.5rem",lineHeight:"1.6"},children:an?.message}),r.jsx("button",{onClick:()=>Ht(null),style:{padding:"8px 24px",borderRadius:"4px",border:"none",background:an?.type==="error"?"#e74c3c":"#2ecc71",color:"white",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"OK"})]})})]})})},Do="app-data",vT="incoming-deliveries",xT=n=>{const t=String(n||"").trim();return t&&t.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9._-]/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)||"delivery"},bT=n=>{const t=String(n),i=t.lastIndexOf(".");return i<=0?t:t.slice(0,i)},wT=async n=>{if(!n)return"";const t=await n.arrayBuffer();try{return new TextDecoder("utf-8").decode(t)}catch{return String.fromCharCode(...new Uint8Array(t))}},us={async _getCurrentUserId(){const{data:n,error:t}=await _e.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${vT}`},_filePath(n,t){const i=this._folderPath(n),a=String(t||"").replace(/^\/+/,"");return`${i}/${a}`},async listJsonFiles(n=null){const t=n||await this._getCurrentUserId();if(!t)return[];const i=this._folderPath(t),{data:a,error:o}=await _e.storage.from(Do).list(i,{limit:200,sortBy:{column:"updated_at",order:"desc"}});return o?(console.error("Failed to list incoming deliveries:",o),[]):(a||[]).filter(u=>String(u?.name||"").toLowerCase().endsWith(".json"))},async downloadJson(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._filePath(i,n),{data:o,error:u}=await _e.storage.from(Do).download(a);if(u)throw u;const d=await wT(o);return JSON.parse(d)},async saveDeliverySet({pdfFile:n,parsed:t},i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");if(!n)throw new Error("PDF");if(!t)throw new Error("");const o=new Date,u=`${o.getFullYear()}${String(o.getMonth()+1).padStart(2,"0")}${String(o.getDate()).padStart(2,"0")}_${String(o.getHours()).padStart(2,"0")}${String(o.getMinutes()).padStart(2,"0")}${String(o.getSeconds()).padStart(2,"0")}`,d=xT(bT(n.name||"delivery")),f=`${u}_${d}`,h=this._filePath(a,`${f}.pdf`),m=this._filePath(a,`${f}.json`),y={...t,_meta:{savedAt:o.toISOString(),originalFileName:n.name||null}},[v,x]=await Promise.all([_e.storage.from(Do).upload(h,n,{upsert:!1,contentType:"application/pdf"}),_e.storage.from(Do).upload(m,new Blob([JSON.stringify(y,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"})]);if(v.error)throw v.error;if(x.error)throw x.error;return{baseName:f,pdfPath:h,jsonPath:m}},async deleteDeliverySet(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=String(n||"").trim();if(!a)throw new Error("baseName ");const o=this._filePath(i,`${a}.pdf`),u=this._filePath(i,`${a}.json`),{data:d,error:f}=await _e.storage.from(Do).remove([o,u]);if(f)throw f;return d}},ST="/app/assets/pdf.worker-DU8cYlj-.js",jT=n=>typeof n=="string"&&n.trim().length>0,qs=n=>String(n??"").replace(/\u0000/g,"").trim(),Uo=n=>{const t=String(n??"").trim();if(!t)return null;const i=t.replace(/[,\s]/g,""),a=Number(i);return Number.isFinite(a)?a:null},Mo=n=>{const t=String(n??"").trim();if(!t)return null;const i=t.match(/^(\d{4}\/\d{2}\/\d{2})(?:\s+(\d{2}:\d{2}))?$/);return i?i[2]?`${i[1]} ${i[2]}`:i[1]:null},_T=n=>{const t=String(n??"").trim();return!!(!t||t==="/"||t.startsWith("")||t.includes(""))},CT=(n,t)=>{const i=String(n??"").trim(),a=i.match(/^No\.?\s*(\d{3,})\s*$/);if(a?.[1])return{slipNo:a[1],consumeNext:!1};if(/^No\.?\s*$/.test(i)){const o=String(t??"").trim();if(/^\d{3,}$/.test(o))return{slipNo:o,consumeNext:!0}}return null},Dp=n=>{const t=String(n??"").trim();return t?!!/^No\.?\s*(\d{3,})?\s*$/.test(t):!1},NT=(n,t)=>{const i=qs(n[t]);if(!i||Dp(i)||i===""||i===""||i===""||i==="No"||i===""||i===""||i===""||i===""||i===""||i==="")return null;let a=t+1;const o=Uo(n[a]);if(o==null)return null;a+=1;const u=Uo(n[a]);if(u==null)return null;a+=1;const d=qs(n[a]);if(!d)return null;a+=1;let f=null,h=null,m=null;const y=Uo(n[a]);for(y!=null?(h=y,a+=1,m=qs(n[a]),a+=1):(f=qs(n[a])||null,a+=1,h=Uo(n[a]),a+=1,m=qs(n[a]),a+=1);a<n.length;){const S=qs(n[a]);if(S===""||S===""){a+=1;continue}break}let v=null;const x=qs(n[a]);return/^\d+$/.test(x)&&(v=parseInt(x,10),a+=1),{item:{no:v,code:null,name:i,unitPrice:o,deliveryQty:u,deliveryUnit:d,spec:f,orderQty:h,orderUnit:m},nextIndex:a}},ET=n=>{const t=(n||[]).map(qs).filter(f=>!_T(f)),i={title:t.find(f=>f.includes(""))||null,outputAt:null,rangeFrom:null,rangeTo:null};for(let f=0;f<t.length;f+=1){const h=t[f],m=h.match(/^?\s*(.+)$/);if(m?.[1]&&!i.outputAt){i.outputAt=Mo(m[1])||m[1].trim();continue}const y=h.match(/^(\d{4}\/\d{2}\/\d{2})\s*\s*(\d{4}\/\d{2}\/\d{2})/);y&&!i.rangeFrom&&(i.rangeFrom=y[1],i.rangeTo=y[2])}const a=new Map;let o=null,u=null;for(let f=0;f<t.length;f+=1){const h=t[f],m=t[f+1],y=CT(h,m);if(y?.slipNo){const v=y.slipNo;y.consumeNext&&(f+=1);const x=a.get(v);x?o=x:(o={slipNo:v,vendor:u||null,slipDate:null,deliveryDate:null,total:null,comment:null,items:[]},a.set(v,o));continue}if(/^(||)/.test(h)&&!h.includes("")&&!h.includes("")&&!h.includes("")){let v=3;(h.startsWith("")||h.startsWith("")||h.startsWith(""))&&(v=4);let x=h.slice(v).trim();(x.startsWith(":")||x.startsWith(""))&&(x=x.slice(1).trim());let S=null;if(!x)jT(m)&&!/^\d+$/.test(m)&&!m.includes("")&&(S=m.trim());else{const _=x.match(/^(\d+)\s+(.+)$/);_&&(x=_[2].trim()),S=x}S&&(o?o.vendor||(o.vendor=S):u=S);continue}if(o){if(h===""||h.startsWith("")){const v=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.slipDate=v[1]:Mo(m)&&(o.slipDate=Mo(m));continue}if(h===""){const v=Uo(m);v!=null&&(o.total=v);continue}if(h===""||h.startsWith("")){const v=h.match(/^\s*(\d{4}\/\d{2}\/\d{2})$/);v?.[1]?o.deliveryDate=v[1]:Mo(m)&&(o.deliveryDate=Mo(m)?.slice(0,10));continue}if(h.startsWith("")){const x=h.match(/^[:]?\s*(.*)$/)?.[1]?.trim()||"";if(x&&x!=="No"){o.comment=x;continue}const S=[];for(let N=f+1;N<t.length;N+=1){const w=t[N];if(w){if(Dp(w)||w==="No"||w===""||w===""||w===""||w===""||w===""||w===""||w==="")break;S.push(w)}}const _=S.join(" ").trim();_&&_!=="No"&&(o.comment=_);continue}if(h===""||h===""){let v=f+1;for(;v<t.length;){const x=t[v];if(Dp(x)||x==="")break;const S=NT(t,v);if(!S){v+=1;continue}o.items.push(S.item),v=S.nextIndex}f=v-1}}}const d=Array.from(a.values()).sort((f,h)=>String(f.slipNo).localeCompare(String(h.slipNo),"ja"));return{report:i,slips:d}},b0=async n=>{if(!n)throw new Error("PDF");const t=await n.arrayBuffer(),i=await qu(()=>import("./pdf-hxzSPqug.js").then(f=>f.p),[]),a=i?.default&&i.default.getDocument?i.default:i;if(!a?.getDocument)throw new Error("PDF");a?.GlobalWorkerOptions&&(a.GlobalWorkerOptions.workerSrc=ST);const o=await a.getDocument({data:new Uint8Array(t)}).promise,u=[];for(let f=1;f<=o.numPages;f+=1){const m=await(await o.getPage(f)).getTextContent();for(const y of m.items||[]){const v=qs(y?.str);v&&u.push(v)}}const d=ET(u);if(!d?.slips||d.slips.length===0)throw new Error("PDFPDF");return d},op=n=>String(n||"").replace(/\.json$/i,""),w0=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${i}/${a}/${o} ${u}:${d}`},kT=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},TT=n=>String(n||"").trim(),AT=({onBack:n})=>{const[t,i]=ac(),[a,o]=je.useState(!0),[u,d]=je.useState([]),[f,h]=je.useState(null),[m,y]=je.useState(!1),[v,x]=je.useState(!1),[S,_]=je.useState(null),[N,w]=je.useState(!1),[C,D]=je.useState(""),[z,T]=je.useState(null),[U,E]=je.useState(!1),[R,A]=je.useState(null),[O,V]=je.useState(!1),[P,F]=je.useState(!1),[Q,$]=je.useState(null),I=je.useCallback(async()=>{o(!0),D("");try{const de=await us.listJsonFiles();d(de||[])}catch(de){console.error(de),D(""),d([])}finally{o(!1)}},[]);je.useEffect(()=>{I()},[I]);const k=de=>{de.preventDefault(),y(!0)},L=de=>{de.preventDefault(),y(!1)},H=de=>{de.preventDefault(),y(!1);const K=de.dataTransfer.files?.[0];K&&K.type==="application/pdf"?(h(K),_(null),$(null),D(""),G(K)):K&&D("PDF")},G=async de=>{if(de){D(""),x(!0),_(null),$(null);try{const K=await b0(de);_(K||null)}catch(K){console.error(K),D(`PDF:
${K?.message||String(K)}`)}finally{x(!1)}}},ce=async()=>{if(f){D(""),x(!0),_(null),$(null);try{const de=await b0(f);_(de||null)}catch(de){console.error(de),D(`PDF:
${de?.message||String(de)}`)}finally{x(!1)}}},q=async()=>{if(!(!f||!S)){D(""),w(!0);try{await us.saveDeliverySet({pdfFile:f,parsed:S}),h(null),_(null),await I()}catch(de){console.error(de),D(`: ${de?.message||String(de)}`)}finally{w(!1)}}},W=async de=>{const K=op(de);E(!0),D("");try{const ge=await us.downloadJson(de);T({baseName:K,data:ge})}catch(ge){console.error(ge),D(`: ${ge?.message||String(ge)}`)}finally{E(!1)}},ie=async()=>{if(R?.baseName){V(!0),D("");try{await us.deleteDeliverySet(R.baseName),A(null),await I()}catch(de){console.error(de),D(`: ${de?.message||String(de)}`)}finally{V(!1)}}},ve=de=>{const K=new Map,ge=(ae,Se)=>{const Re=String(ae?.name||"").trim();if(!Re)return;const Oe=TT(ae?.deliveryUnit||ae?.unit||ae?.unitName||""),He=kT(ae?.deliveryQty??ae?.quantity??ae?.qty);if(!Number.isFinite(He)||He===null)return;const nt=String(Se||"").trim(),ot=`${nt}@@${Jt(Re)}@@${Oe||""}`,Fe=K.get(ot);Fe?Fe.qty+=He:K.set(ot,{vendor:nt,name:Re,unit:Oe,qty:He})};return(de?.slips||de?.receipts||[]).forEach(ae=>{const Se=ae?.vendor||"";(ae?.items||[]).forEach(Oe=>ge(Oe,Se))}),Array.from(K.values()).sort((ae,Se)=>ae.vendor!==Se.vendor?ae.vendor.localeCompare(Se.vendor,"ja"):ae.name!==Se.name?ae.name.localeCompare(Se.name,"ja"):String(ae.unit||"").localeCompare(String(Se.unit||""),"ja"))},xe=async()=>{F(!0),D(""),$(null);try{const de=await us.listJsonFiles();if(!de||de.length===0){$([]);return}const K=[];for(const ae of de){const Se=ae?.name;if(Se)try{const Re=await us.downloadJson(Se);K.push(Re)}catch(Re){console.warn("Failed to download:",Se,Re)}}const ge=new Map;K.forEach(ae=>{ve(ae).forEach(Re=>{const Oe=`${Re.vendor}@@${Jt(Re.name)}@@${Re.unit||""}`,He=ge.get(Oe);He?He.qty+=Re.qty:ge.set(Oe,{...Re})})});const Ae=Array.from(ge.values()).sort((ae,Se)=>ae.vendor!==Se.vendor?ae.vendor.localeCompare(Se.vendor,"ja"):ae.name!==Se.name?ae.name.localeCompare(Se.name,"ja"):String(ae.unit||"").localeCompare(String(Se.unit||""),"ja"));$(Ae)}catch(de){console.error(de),D(`: ${de?.message||String(de)}`)}finally{F(!1)}},Ne=S?.slips||S?.receipts||[];return r.jsxs("div",{className:"incoming-deliveries",children:[r.jsxs("div",{className:"incoming-deliveries__header",children:[r.jsx("h2",{className:"incoming-deliveries__title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[r.jsx(le,{variant:"secondary",onClick:()=>i({view:"incoming-stock"}),children:" "}),r.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),C&&r.jsx(un,{className:"incoming-deliveries__error",children:C}),r.jsxs(un,{className:"incoming-deliveries__card",children:[r.jsx("h3",{className:"incoming-deliveries__section-title",children:"PDF"}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75,marginTop:"-4px",marginBottom:"10px"},children:[": ",Ho]}),r.jsxs("div",{className:"incoming-deliveries__upload",children:[r.jsxs("div",{className:`incoming-deliveries__upload-zone ${m?"incoming-deliveries__upload-zone--dragging":""}`,onDragOver:k,onDragLeave:L,onDrop:H,children:[r.jsx("div",{style:{textAlign:"center",marginBottom:"10px",fontWeight:"bold",color:m?"var(--color-primary)":"inherit"},children:m?"":"PDF"}),r.jsx("input",{type:"file",accept:"application/pdf",onChange:de=>{const K=de.target.files?.[0]||null;h(K),_(null),$(null),D("")},style:{width:"100%"}})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[r.jsx(le,{variant:"secondary",onClick:ce,disabled:!f||v||N,children:v?"":""}),r.jsx(le,{variant:"primary",onClick:q,disabled:!f||!S||N||v,children:N?"":""})]})]}),S&&r.jsxs("div",{className:"incoming-deliveries__preview",children:[r.jsxs("div",{style:{fontSize:"0.9rem",opacity:.9},children:[": ",r.jsx("strong",{children:S?.report?.outputAt||S?.report?.outputDate||"-"})]}),r.jsxs("div",{style:{marginTop:"8px",fontSize:"0.9rem",opacity:.9},children:[": ",r.jsx("strong",{children:Ne.length})]}),Ne.slice(0,3).map((de,K)=>r.jsxs("div",{className:"incoming-deliveries__slip",children:[r.jsxs("div",{className:"incoming-deliveries__slip-head",children:[r.jsx("div",{style:{fontWeight:700},children:de?.vendor||""}),r.jsxs("div",{style:{opacity:.85},children:["No: ",de?.slipNo||"-"," / : ",de?.deliveryDate||"-"]})]}),r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"52%"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%"},children:""})]})}),r.jsx("tbody",{children:(de?.items||[]).slice(0,6).map((ge,Ae)=>r.jsxs("tr",{children:[r.jsx("td",{children:ge?.name||"-"}),r.jsx("td",{style:{textAlign:"right"},children:ge?.unitPrice!=null?`${Math.round(ge.unitPrice).toLocaleString()}`:"-"}),r.jsx("td",{style:{textAlign:"right"},children:ge?.deliveryQty!=null?ge.deliveryQty:"-"}),r.jsx("td",{children:ge?.deliveryUnit||"-"})]},`${ge?.no||Ae}`))})]}),(de?.items||[]).length>6&&r.jsxs("div",{style:{marginTop:"6px",fontSize:"0.85rem",opacity:.8},children:[" ",Math.max(0,(de?.items||[]).length-6)," "]})]},`${de?.slipNo||de?.id||K}`)),Ne.length>3&&r.jsx("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.85},children:" 3"})]})]}),r.jsxs(un,{className:"incoming-deliveries__card",children:[r.jsxs("div",{className:"incoming-deliveries__list-head",children:[r.jsx("h3",{className:"incoming-deliveries__section-title",style:{margin:0},children:""}),r.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[r.jsx(le,{variant:"secondary",onClick:I,disabled:a||P,children:""}),r.jsx(le,{variant:"secondary",onClick:xe,disabled:a||P,children:P?"":""})]})]}),a?r.jsx("div",{style:{padding:"10px 0",opacity:.8},children:""}):u.length===0?r.jsx("div",{style:{padding:"10px 0",opacity:.8},children:"PDF"}):r.jsx("div",{className:"incoming-deliveries__file-list",children:u.map(de=>r.jsxs("div",{className:"incoming-deliveries__file-row",children:[r.jsxs("div",{className:"incoming-deliveries__file-info",children:[r.jsx("div",{style:{fontWeight:700},children:op(de.name)}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.8},children:[": ",w0(de.updated_at||de.created_at)]})]}),r.jsxs("div",{style:{display:"flex",gap:"8px"},children:[r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>W(de.name),disabled:U||O,children:U?"":""}),r.jsx(le,{variant:"ghost",size:"sm",onClick:()=>A({baseName:op(de.name)}),disabled:O,children:""})]})]},de.name))}),Q&&r.jsxs("div",{className:"incoming-deliveries__aggregate",children:[r.jsx("h4",{style:{margin:"10px 0 6px"},children:""}),Q.length===0?r.jsx("div",{style:{opacity:.85},children:""}):r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"/"}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:Q.slice(0,60).map(de=>r.jsxs("tr",{children:[r.jsx("td",{children:de.vendor||"-"}),r.jsx("td",{children:de.name}),r.jsx("td",{style:{textAlign:"right"},children:Number.isFinite(de.qty)?de.qty:"-"}),r.jsx("td",{children:de.unit||"-"})]},`${de.vendor}@@${de.name}@@${de.unit||""}`))})]}),Q.length>60&&r.jsx("div",{style:{marginTop:"8px",fontSize:"0.85rem",opacity:.8},children:" 60/"})]})]}),r.jsx(jn,{isOpen:!!z,onClose:()=>T(null),title:"PDF ",size:"large",children:z?.data?r.jsxs("div",{children:[r.jsxs("div",{style:{marginBottom:"10px",opacity:.85},children:[": ",w0(z.data?._meta?.savedAt),z.data?._meta?.originalFileName?` / : ${z.data._meta.originalFileName}`:""]}),(z.data?.slips||z.data?.receipts||[]).map((de,K)=>r.jsxs("div",{style:{marginBottom:"16px"},children:[r.jsxs("div",{style:{fontWeight:700,marginBottom:"4px"},children:[de?.vendor||"","No: ",de?.slipNo||"-"," / : ",de?.deliveryDate||"-",""]}),r.jsxs("table",{className:"incoming-deliveries__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"52%"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"16%"},children:""})]})}),r.jsx("tbody",{children:(de?.items||[]).map((ge,Ae)=>r.jsxs("tr",{children:[r.jsx("td",{children:ge?.name||"-"}),r.jsx("td",{style:{textAlign:"right"},children:ge?.unitPrice!=null?`${Math.round(ge.unitPrice).toLocaleString()}`:"-"}),r.jsx("td",{style:{textAlign:"right"},children:ge?.deliveryQty!=null?ge.deliveryQty:"-"}),r.jsx("td",{children:ge?.deliveryUnit||"-"})]},`${ge?.no||Ae}`))})]})]},`${de?.slipNo||K}`))]}):r.jsx("div",{style:{opacity:.8},children:""})}),r.jsx(jn,{isOpen:!!R,onClose:()=>A(null),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",R?.baseName,""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>A(null),disabled:O,children:""}),r.jsx(le,{variant:"danger",onClick:ie,disabled:O,children:O?"":""})]})]})})]})},Bs="app-data",RT="incoming-stock",OT="stock.json",DT="applied",ya=n=>{const t=typeof n=="number"?n:parseFloat(String(n||"").replace(/[^0-9.+-]/g,""));return Number.isFinite(t)?t:null},jl=n=>String(n||"").trim(),va=(n,t,i)=>`${String(i||"").trim()}@@${Jt(n)}@@${jl(t)}`,cp=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===404)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("not found")||a.includes("object not found")},MT=n=>{const t=n?.statusCode??n?.status??null;if((typeof t=="string"?parseInt(t,10):t)===409)return!0;const a=String(n?.message||"").toLowerCase();return a.includes("already exists")||a.includes("duplicate")||a.includes("409")},zT=n=>{const t=new Map;return(n?.slips||n?.receipts||[]).forEach(a=>{const o=String(a?.vendor||"").trim();(a?.items||[]).forEach(u=>{const d=String(u?.name||"").trim();if(!d)return;const f=jl(u?.deliveryUnit||u?.unit||u?.unitName||""),h=ya(u?.deliveryQty??u?.quantity??u?.qty);if(h==null)return;const m=va(d,f,o),y=t.get(m);y?y.quantity+=h:t.set(m,{vendor:o,name:d,unit:f,quantity:h})})}),Array.from(t.values()).filter(a=>Number.isFinite(a.quantity))},LT=(n,t,i)=>{const a=new Map;return(n||[]).forEach(o=>{const u=String(o?.name||"").trim();if(!u)return;const d=jl(o?.unit||""),f=String(o?.vendor||"").trim(),h=ya(o?.quantity)??0;a.set(va(u,d,f),{vendor:f,name:u,unit:d,quantity:h,updatedAt:o?.updatedAt||null})}),t.forEach(o=>{const u=va(o.name,o.unit,o.vendor),d=a.get(u);d?(d.quantity=Math.max(0,(ya(d.quantity)??0)+(ya(o.quantity)??0)),d.updatedAt=i):a.set(u,{vendor:o.vendor,name:o.name,unit:jl(o.unit),quantity:Math.max(0,ya(o.quantity)??0),updatedAt:i})}),Array.from(a.values()).sort((o,u)=>o.vendor!==u.vendor?o.vendor.localeCompare(u.vendor,"ja"):o.name!==u.name?o.name.localeCompare(u.name,"ja"):String(o.unit||"").localeCompare(String(u.unit||""),"ja"))},$s={async _getCurrentUserId(){const{data:n,error:t}=await _e.auth.getUser();if(t)throw t;return n?.user?.id||null},_folderPath(n){if(!n)throw new Error("User ID is required");return`${n}/${RT}`},_stockPath(n){return`${this._folderPath(n)}/${OT}`},_appliedFolder(n){return`${this._folderPath(n)}/${DT}`},_appliedMarkerPath(n,t){const i=this._appliedFolder(n),a=String(t||"").trim();if(!a)throw new Error("baseName is required");return`${i}/${a}.json`},async listAppliedBaseNames(n=null){const t=n||await this._getCurrentUserId();if(!t)return new Set;const i=this._appliedFolder(t),{data:a,error:o}=await _e.storage.from(Bs).list(i,{limit:1e3,sortBy:{column:"updated_at",order:"desc"}});if(o)return cp(o)?new Set:(console.error("Failed to list applied markers:",o),new Set);const u=new Set;return(a||[]).forEach(d=>{const f=String(d?.name||"");f.toLowerCase().endsWith(".json")&&u.add(f.replace(/\.json$/i,""))}),u},async loadStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const i=this._stockPath(t),{data:a,error:o}=await _e.storage.from(Bs).createSignedUrl(i,60);if(o){if(cp(o))return{_meta:{version:1,updatedAt:null},items:[]};throw o}try{const u=await fetch(a.signedUrl,{cache:"no-store"});if(!u.ok){if(u.status===404)return{_meta:{version:1,updatedAt:null},items:[]};throw new Error(`Failed to fetch stock: ${u.status} ${u.statusText}`)}const d=await u.text(),f=JSON.parse(d||"{}"),h=Array.isArray(f?.items)?f.items:[];return{_meta:{version:1,updatedAt:f?._meta?.updatedAt||null},items:h}}catch(u){throw console.warn("loadStock fetch failed",u),u}},async saveStock(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._stockPath(i),o={_meta:{version:1,updatedAt:new Date().toISOString()},items:Array.isArray(n?.items)?n.items:[]},{error:u}=await _e.storage.from(Bs).upload(a,new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});if(u)throw u;return o},async applyDeliverySet({baseName:n,parsed:t},i=null){const a=i||await this._getCurrentUserId();if(!a)throw new Error("");const o=String(n||"").trim();if(!o)throw new Error("baseName ");if(!t)throw new Error("");const u=zT(t),d=new Date().toISOString(),f=this._appliedMarkerPath(a,o),h={baseName:o,appliedAt:d,slipCount:(t?.slips||t?.receipts||[]).length||0,itemCount:u.length},m=await _e.storage.from(Bs).upload(f,new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),{upsert:!1,contentType:"application/json"});if(m.error){if(MT(m.error))return{status:"already_applied"};throw m.error}try{const y=await this.loadStock(a),v=LT(y.items||[],u,d);return await this.saveStock({items:v},a),{status:"applied",addedCount:u.length}}catch(y){try{await _e.storage.from(Bs).remove([f])}catch{}throw y}},async updateStockItem({name:n,unit:t,vendor:i,delta:a},o=null){const u=o||await this._getCurrentUserId();if(!u)throw new Error("");const d=String(n||"").trim();if(!d)throw new Error("");const f=jl(t),h=String(i||"").trim(),m=va(d,f,h),y=ya(a);if(y===null||!Number.isFinite(y))throw new Error("");const x=(await this.loadStock(u)).items||[],S=new Date().toISOString();let _=!1;const N=x.map(w=>{if(va(w.name,w.unit,w.vendor)===m){_=!0;const D=Math.max(0,(ya(w.quantity)??0)+y);return{...w,quantity:D,updatedAt:S}}return w});if(!_)throw new Error("");return await this.saveStock({items:N},u),{status:"updated",name:d,unit:f}},async deleteStockItem({name:n,unit:t,vendor:i},a=null){const o=a||await this._getCurrentUserId();if(!o)throw new Error("");const u=String(n||"").trim();if(!u)throw new Error("");const d=jl(t),f=String(i||"").trim(),h=va(u,d,f),y=(await this.loadStock(o)).items||[],v=y.filter(x=>va(x.name,x.unit,x.vendor)!==h);return v.length,y.length,await this.saveStock({items:v},o),{status:"deleted",name:u}},async clearStock(n=null){const t=n||await this._getCurrentUserId();if(!t)throw new Error("");const i=this._stockPath(t),a={_meta:{version:1,updatedAt:new Date().toISOString()},items:[]};await _e.storage.from(Bs).upload(i,new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),{upsert:!0,contentType:"application/json"});const o=this._appliedFolder(t),{data:u}=await _e.storage.from(Bs).list(o,{limit:1e3});if(u?.length){const d=u.map(f=>`${o}/${f.name}`);await _e.storage.from(Bs).remove(d)}return{status:"cleared"}},async deleteAppliedMarker(n,t=null){const i=t||await this._getCurrentUserId();if(!i)throw new Error("");const a=this._appliedMarkerPath(i,n),{error:o}=await _e.storage.from(Bs).remove([a]);if(o){if(cp(o))return{status:"not_found"};throw o}return{status:"deleted"}}},Oi="meal_plans",UT="planner_data",_i="",S0=20,Ti=[],IT=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,rw=n=>`planner_data_${n}`,Ci=n=>{Ti[Ti.length-1]!==n&&(Ti.push(n),Ti.length>S0&&Ti.splice(0,Ti.length-S0))},br=(n,t=null)=>{if(n==null||n==="")return t;const i=Number(n);return Number.isFinite(i)?i:t},Mp=(n,t)=>{const i=String(n?.message||"").toLowerCase();return String(n?.code||"")==="42703"?i.includes(`column "${String(t).toLowerCase()}"`):i.includes(`column "${String(t).toLowerCase()}"`)&&i.includes("does not exist")},Ni=n=>{try{if(!n)return{};const t=localStorage.getItem(rw(n));if(t)return JSON.parse(t);const i=localStorage.getItem(UT);if(i){const a=JSON.parse(i);return ls(n,a),a}return{}}catch{return{}}},ls=(n,t)=>{n&&localStorage.setItem(rw(n),JSON.stringify(t))},BT=()=>`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,wl=n=>{if(typeof n=="number")return n;const t=Number(n);return Number.isFinite(t)?t:n},$T=n=>({id:String(n.id),recipeId:wl(n.recipe_id??n.recipeId),type:n.meal_type??n.type??"dinner",note:n.note??"",multiplier:br(n.multiplier,1),totalWeight:br(n.total_weight??n.totalWeight,null)}),PT=n=>n?typeof n=="string"?n.slice(0,10):n instanceof Date?n.toISOString().slice(0,10):String(n).slice(0,10):"",qT=n=>{const t={};return(n||[]).forEach(i=>{const a=PT(i.plan_date??i.planDate);a&&(t[a]||(t[a]=[]),t[a].push($T(i)))}),t},FT=(n,t)=>{const i=[];return Object.keys(t||{}).forEach(a=>{(t[a]||[]).forEach(u=>{i.push({user_id:n,plan_date:a,recipe_id:wl(u.recipeId),meal_type:u.type||"dinner",note:u.note||"",multiplier:br(u.multiplier,1),total_weight:br(u.totalWeight,null)})})}),i},HT=n=>({...n,date_str:n.plan_date,type:n.meal_type}),VT=n=>{const{date_str:t,type:i,...a}=n;return a},im=async n=>{if(!n||n.length===0)return;const t=n.map(HT);let{error:i}=await _e.from(Oi).insert(t);if(i&&(Mp(i,"date_str")||Mp(i,"type"))){const a=t.map(VT);({error:i}=await _e.from(Oi).insert(a))}if(i)throw i},j0=n=>IT.test(String(n||"")),zo=n=>{if(n==null||n==="")return"";if(typeof n=="number")return String(n);const t=Number(n);return Number.isFinite(t)?String(t):String(n)},id=(n,t)=>{const i=zo(t?.recipeId),a=zo(t?.type||"dinner"),o=zo(t?.note||""),u=zo(br(t?.multiplier,1)),d=zo(br(t?.totalWeight,null));return`${n}|${i}|${a}|${o}|${u}|${d}`},GT=(n,t)=>{const i={};Object.keys(n||{}).forEach(o=>{i[o]=[...n[o]||[]]});const a=new Set;return Object.keys(n||{}).forEach(o=>{(n[o]||[]).forEach(u=>{a.add(id(o,u))})}),Object.keys(t||{}).forEach(o=>{(t[o]||[]).forEach(d=>{const f=id(o,d);a.has(f)||(i[o]||(i[o]=[]),i[o].push(d),a.add(f))})}),i},KT=(n,t,i)=>{const a={...n||{}};return a[t]||(a[t]=[]),a[t]=[...a[t],i],a},YT=(n,t,i)=>{const a={...n||{}};return a[t]&&(a[t]=(a[t]||[]).filter(o=>String(o.id)!==String(i)),a[t].length===0&&delete a[t]),a},WT=(n,t,i,a)=>{const o={...n||{}};return o[t]&&(o[t]=o[t].map(u=>String(u.id)!==String(i)?u:{...u,...a})),o},QT=(n,t,i)=>{const a={...n||{}};return Object.keys(a).forEach(o=>{o>=t&&o<=i&&delete a[o]}),a},JT=(n,t)=>{const i=new Set((t||[]).map(d=>String(d))),a={},o=[];let u=!1;return Object.keys(n||{}).forEach(d=>{const f=n[d]||[],h=f.filter(m=>{const y=i.has(String(m.recipeId));return y||o.push(String(m.id)),y});h.length>0&&(a[d]=h),h.length!==f.length&&(u=!0)}),{nextPlans:u?a:n,invalidIds:o,hasChanges:u}},am=async n=>{const{data:t,error:i}=await _e.from(Oi).select("id, plan_date, recipe_id, meal_type, note, multiplier, total_weight, created_at").eq("user_id",n).order("plan_date",{ascending:!0}).order("created_at",{ascending:!0});if(i)throw i;return qT(t||[])},XT=async(n,t)=>{const i=FT(n,t);return i.length===0?null:(await im(i),am(n))},ZT=async(n,t)=>{const i=Ni(n);if(!Object.keys(i).some(f=>(i[f]||[]).some(h=>!j0(h?.id))))return t;const o=new Set;Object.keys(t||{}).forEach(f=>{(t[f]||[]).forEach(h=>{o.add(id(f,h))})});const u=[];Object.keys(i||{}).forEach(f=>{(i[f]||[]).forEach(h=>{if(j0(h?.id))return;const m=id(f,h);o.has(m)||(u.push({user_id:n,plan_date:f,recipe_id:wl(h.recipeId),meal_type:h.type||"dinner",note:h.note||"",multiplier:br(h.multiplier,1),total_weight:br(h.totalWeight,null)}),o.add(m))})}),u.length>0&&await im(u);const d=await am(n);return ls(n,d),d},Kr={consumeWarnings:()=>{const n=[...Ti];return Ti.length=0,n},getAll:async n=>{if(!n)return{};try{const t=await am(n);if(Object.keys(t).length===0){const i=Ni(n);if(Object.keys(i).length>0)try{const a=await XT(n,i);if(a)return ls(n,a),a}catch{return Ci(_i),ls(n,i),i}}try{const i=await ZT(n,t);return ls(n,i),i}catch(i){console.warn("plannerService.getAll: failed to sync local fallback meals",i),Ci(_i);const a=Ni(n),o=GT(t,a);return ls(n,o),o}}catch(t){return console.warn("plannerService.getAll: falling back to localStorage",t),Ci(_i),Ni(n)}},cleanupInvalidPlans:async(n,t)=>{if(!n)return{};if(!Array.isArray(t)||t.length===0)return Kr.getAll(n);const i=await Kr.getAll(n),{nextPlans:a,invalidIds:o,hasChanges:u}=JT(i,t);if(!u)return i;try{if(o.length>0)for(let f=0;f<o.length;f+=200){const h=o.slice(f,f+200),{error:m}=await _e.from(Oi).delete().eq("user_id",n).in("id",h);if(m)throw m}}catch(d){console.warn("plannerService.cleanupInvalidPlans: delete fallback to localStorage",d),Ci(_i)}return ls(n,a),a},addMeal:async(n,t,i,a,o={})=>{if(!n)return null;const u={id:BT(),recipeId:wl(i),type:a||"dinner",note:"",multiplier:br(o?.multiplier,1),totalWeight:br(o?.totalWeight,null)},d=Ni(n),f=KT(d,t,u);ls(n,f);try{const h={user_id:n,plan_date:t,recipe_id:wl(i),meal_type:a||"dinner",note:"",multiplier:br(o?.multiplier,1),total_weight:br(o?.totalWeight,null)};return await im([h]),u}catch(h){return console.warn("plannerService.addMeal: insert fallback to localStorage",h),Ci(_i),u}},removeMeal:async(n,t,i)=>{if(!n)return;try{const{error:u}=await _e.from(Oi).delete().eq("id",String(i)).eq("user_id",n);if(u)throw u}catch(u){console.warn("plannerService.removeMeal: delete fallback to localStorage",u),Ci(_i)}const a=Ni(n),o=YT(a,t,i);ls(n,o)},updateMeal:async(n,t,i,a)=>{if(!n)return;const o={};Object.prototype.hasOwnProperty.call(a,"recipeId")&&(o.recipe_id=wl(a.recipeId)),Object.prototype.hasOwnProperty.call(a,"type")&&(o.meal_type=a.type||"dinner",o.type=o.meal_type),Object.prototype.hasOwnProperty.call(a,"note")&&(o.note=a.note||""),Object.prototype.hasOwnProperty.call(a,"multiplier")&&(o.multiplier=br(a.multiplier,1)),Object.prototype.hasOwnProperty.call(a,"totalWeight")&&(o.total_weight=br(a.totalWeight,null));try{if(Object.keys(o).length>0){let{error:f}=await _e.from(Oi).update(o).eq("id",String(i)).eq("user_id",n);if(f&&Mp(f,"type")){const{type:h,...m}=o;({error:f}=await _e.from(Oi).update(m).eq("id",String(i)).eq("user_id",n))}if(f)throw f}}catch(f){console.warn("plannerService.updateMeal: update fallback to localStorage",f),Ci(_i)}const u=Ni(n),d=WT(u,t,i,a);ls(n,d)},clearPeriod:async(n,t,i)=>{if(!n)return;try{const{error:u}=await _e.from(Oi).delete().eq("user_id",n).gte("plan_date",t).lte("plan_date",i);if(u)throw u}catch(u){console.warn("plannerService.clearPeriod: delete fallback to localStorage",u),Ci(_i)}const a=Ni(n),o=QT(a,t,i);ls(n,o)}},eA=["g","kg","ml","cc","l","cl"],_l=n=>(n??"").toString().trim(),sw=n=>{const t=_l(n);if(!t)return"";const i=t.toLowerCase();return i===""?"g":i===""?"ml":i===""?"cc":i===""?"kg":i===""?"l":i===""?"cl":i},tA=n=>{const t=_l(n);return t?["","","","","","","","PC","pc",""].includes(t):!1},Io=(n,t)=>{const i=parseFloat(n)||0,a=sw(t);return a==="kg"?{qty:i*1e3,unit:"g"}:a==="g"?{qty:i,unit:"g"}:a==="l"?{qty:i*1e3,unit:"ml"}:a==="cc"?{qty:i,unit:"ml"}:a==="ml"?{qty:i,unit:"ml"}:a==="cl"?{qty:i*10,unit:"ml"}:{qty:i,unit:_l(t)||""}},_0=(n,t,i,a)=>{const o=_l(i),u=parseFloat(t)||0;if(!a)return Io(u,o);const d=parseFloat(a.packetSize),f=sw(a.packetUnit);if(!Number.isFinite(d)||d<=0||!f)return Io(u,o);if(eA.includes(f)&&tA(o)){const m=u*d;return Io(m,f)}return Io(u,o)},zp={async calculateShortages(n,t,i,a={}){if(!n?.id)throw new Error("User required");const o=a?.includeRecipeBreakdown===!0,u=await Kr.getAll(n.id),d=new Date(t),f=new Date(i);f.setHours(23,59,59,999);const h=[];if(Object.keys(u).forEach(E=>{const R=new Date(E);R>=d&&R<=f&&u[E].forEach(A=>{h.push(A)})}),h.length===0)return o?{items:[],recipeBreakdown:[]}:[];const[m,y,v,x,S]=await Promise.all([bn.fetchRecipes(n),Un.getAllConversions(),lr.fetchPriceList(n.id),Jn.getAll(n.id),sd.getAll(n.id)]),_=new Map;m.forEach(E=>_.set(E.id,E));const N=new Map;try{for(const[E,R]of(y||new Map).entries()){const A=Jt(E);A&&(N.has(A)||N.set(A,R))}}catch{}const w=new Map;try{for(const[E,R]of(S||new Map).entries()){const A=Jt(E);A&&(w.has(A)||w.set(A,R))}}catch{}const C=new Map;try{(x||[]).forEach(E=>{const R=Jt(E?.name);R&&(C.has(R)||C.set(R,E))})}catch{}const D={},z=new Map;h.forEach(E=>{const R=_.get(E.recipeId);if(!R)return;let A=null;if(o){const F=String(R.id);z.has(F)||z.set(F,{recipeId:R.id,recipeTitle:R.title||`Recipe ${R.id}`,itemMap:new Map}),A=z.get(F)}let O=1;if(E.totalWeight&&E.totalWeight>0){let F=0;(R.ingredients||[]).forEach(Q=>{const{qty:$,unit:I}=Io(Q.quantity,Q.unit);(I==="g"||I==="ml")&&(F+=$)}),F>0&&(O=E.totalWeight/F)}else E.multiplier&&E.multiplier>0&&(O=E.multiplier);[...R.ingredients||[]].forEach(F=>{if(!F.name)return;const Q=_l(F.name),$=Jt(Q),I=($?N.get($):null)||y?.get(Q)||null,k=(parseFloat(F.quantity)||0)*O,L=_0(Q,k,F.unit,I),H=L.qty||0,G=L.unit||"";if(D[Q]||(D[Q]={quantity:0,unit:G,count:0}),D[Q].quantity+=H,o&&A){const ce=$||Q,q=A.itemMap.get(ce);q?(q.required+=H,!q.unit&&G&&(q.unit=G)):A.itemMap.set(ce,{ingredientKey:ce,name:Q,required:H,unit:G})}})});const T=Object.keys(D).map(E=>{const R=D[E],A=Jt(E),O=(A?N.get(A):null)||y?.get(E)||null,V=A&&v?.get(A)||null,P=A&&C.get(A)||null,F=_0(E,P?.quantity??0,P?.unit??R.unit,O),Q=R.quantity||0,$=F.qty||0,I=R.unit||F.unit||"",k=$-Q,L=parseFloat(O?.packetSize),H=_l(O?.packetUnit),G=Number.isFinite(L)&&L>0&&!!H,ce=G?L*.2:0,q=G?k<ce:!1,W=V?.unit?String(V.unit).trim():"",ie=A&&w.has(A)?String(w.get(A)).trim():"",ve=ie||""||W||""||"",xe=(O?.lastPrice!==null&&O?.lastPrice!==void 0&&O?.lastPrice!==""?parseFloat(O.lastPrice):null)??(V?.price!==null&&V?.price!==void 0?parseFloat(V.price):null);let Ne=null,de=0,K=I;if(G){const Ae=Math.max(0,ce-k);Ne=Math.ceil(Ae/L),q&&Ne<1&&(Ne=1),de=Ne,K=ve}else de=Math.max(0,Q-$),K=I;const ge=G?q:de>.01;return{name:E,required:Q,stock:$,remaining:k,unit:I,shouldShow:ge,toOrder:de,orderUnit:K,orderPacks:Ne,packSize:G?L:null,packUnit:G?H:null,packPrice:Number.isFinite(xe)?xe:null,vendor:V?.vendor||P?.vendor||""}}).filter(E=>E.shouldShow);if(!o)return T;const U=Array.from(z.values()).map(E=>({recipeId:E.recipeId,recipeTitle:E.recipeTitle,items:Array.from(E.itemMap.values()).filter(R=>Number(R.required||0)>1e-4)}));return{items:T,recipeBreakdown:U}}},Mu=n=>String(n||"").replace(/\.json$/i,""),nA=n=>{if(!n)return"-";const t=new Date(n);if(Number.isNaN(t.getTime()))return String(n);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),u=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return`${i}/${a}/${o} ${u}:${d}`},rA=({onBack:n})=>{const{user:t}=fs(),[i,a]=ac(),[o,u]=je.useState(!0),[d,f]=je.useState(""),[h,m]=je.useState([]),[y,v]=je.useState(new Set),[x,S]=je.useState({items:[]}),[_,N]=je.useState([]),[w,C]=je.useState(null),[D,z]=je.useState("need_order"),[T,U]=je.useState(!1),[E,R]=je.useState(null),[A,O]=je.useState(""),[V,P]=je.useState(!1),F=je.useCallback(async()=>{u(!0),f("");try{const Ee=new Date,se=new Date(Ee);se.setDate(Ee.getDate()+7);const[Pe,dt,gt,ct]=await Promise.all([us.listJsonFiles(),$s.listAppliedBaseNames(),$s.loadStock(),t?.id?zp.calculateShortages(t,Ee.toISOString(),se.toISOString()):Promise.resolve([])]);m(Pe||[]),v(dt||new Set),S(gt||{items:[]}),N(ct||[])}catch(Ee){console.error(Ee),f(Ee?.message||String(Ee))}finally{u(!1)}},[t]);je.useEffect(()=>{F()},[F]);const Q=je.useMemo(()=>{const Ee=new Map;return(_||[]).forEach(se=>{const Pe=`${se.vendor||""}@@${se.name}@@${se.unit||""}`;Ee.set(Pe,{...se,quantity:se.stock,isShortage:!0,reason:` (: ${se.required.toFixed(1)}${se.unit})`})}),(x?.items||[]).forEach(se=>{if((se.quantity||0)<=0){const Pe=`${se.vendor||""}@@${se.name}@@${se.unit||""}`;Ee.has(Pe)||Ee.set(Pe,{...se,isShortage:!1})}}),Array.from(Ee.values()).sort((se,Pe)=>se.isShortage!==Pe.isShortage?se.isShortage?-1:1:(se.vendor||"").localeCompare(Pe.vendor||""))},[_,x]),$=async Ee=>{const se=Mu(Ee);C(se),f("");try{const Pe=await us.downloadJson(Ee);(await $s.applyDeliverySet({baseName:se,parsed:Pe}))?.status==="already_applied"&&f("PDF"),await F()}catch(Pe){console.error(Pe),f(Pe?.message||String(Pe))}finally{C(null)}},I=async()=>{C("all"),f("");try{const Ee=await us.listJsonFiles(),se=await $s.listAppliedBaseNames();for(const Pe of Ee||[]){const dt=Pe?.name;if(!dt)continue;const gt=Mu(dt);if(se.has(gt))continue;const ct=await us.downloadJson(dt);(await $s.applyDeliverySet({baseName:gt,parsed:ct}))?.status==="applied"&&se.add(gt)}await F()}catch(Ee){console.error(Ee),f(Ee?.message||String(Ee))}finally{C(null)}},k=Ee=>{R(Ee),O(""),U(!0),f("")},L=Ee=>{O(se=>{const dt=(parseFloat(se)||0)+Ee;return String(Math.round(dt*1e3)/1e3)})},H=async()=>{if(!E)return;const Ee=Number(A);if(!A||isNaN(Ee)||Ee<=0){f("");return}P(!0),f("");try{await $s.updateStockItem({name:E.name,unit:E.unit,vendor:E.vendor,delta:-Ee}),await F(),U(!1),R(null)}catch(se){console.error(se),f(se?.message||String(se))}finally{P(!1)}},[G,ce]=je.useState(!1),[q,W]=je.useState(null),[ie,ve]=je.useState(!1),[xe,Ne]=je.useState(!1),[de,K]=je.useState(!1),ge=Ee=>{W(Ee),ce(!0),f("")},Ae=async()=>{if(q){ve(!0),f("");try{await $s.deleteStockItem({name:q.name,unit:q.unit,vendor:q.vendor}),await F(),ce(!1),W(null)}catch(Ee){console.error(Ee),f(": "+(Ee.message||String(Ee)))}finally{ve(!1)}}},[ae,Se]=je.useState(!1),[Re,Oe]=je.useState(null),[He,nt]=je.useState(!1),ot=Ee=>{const se=Mu(Ee.name);Oe({name:Ee.name,baseName:se}),Se(!0),f("")},Fe=async()=>{if(Re){nt(!0),f("");try{await us.deleteDeliverySet(Re.baseName),await $s.deleteAppliedMarker(Re.baseName),await F(),Se(!1),Oe(null)}catch(Ee){console.error(Ee),f("PDF: "+(Ee.message||String(Ee)))}finally{nt(!1)}}},Ce=async()=>{K(!0),f("");try{await $s.clearStock(),await F(),Ne(!1)}catch(Ee){console.error(Ee),f(": "+(Ee.message||String(Ee)))}finally{K(!1)}};return r.jsxs("div",{className:"incoming-stock",children:[r.jsxs("div",{className:"incoming-stock__header",children:[r.jsx("h2",{className:"incoming-stock__title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px"},children:[r.jsx(le,{variant:"secondary",onClick:()=>a({view:"incoming-deliveries"}),children:" PDF"}),r.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),d&&r.jsx(un,{className:"incoming-stock__error",children:d}),r.jsxs(un,{className:"incoming-stock__card",children:[r.jsxs("div",{className:"incoming-stock__card-head",children:[r.jsx("h3",{className:"incoming-stock__section-title",children:"PDF"}),r.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[r.jsx(le,{variant:"secondary",onClick:F,disabled:o||!!w,children:""}),r.jsx(le,{variant:"primary",onClick:I,disabled:o||!!w,children:w==="all"?"":""}),r.jsx(le,{variant:"secondary",style:{marginLeft:"auto",color:"#d32f2f",borderColor:"#d32f2f"},onClick:()=>Ne(!0),disabled:o||!!w||!x?.items?.length,children:" "})]})]}),o?r.jsx("div",{style:{padding:"10px 0",opacity:.75},children:""}):h.length===0?r.jsx("div",{style:{padding:"10px 0",opacity:.75},children:"PDFPDF"}):r.jsx("div",{className:"incoming-stock__file-list",children:h.map(Ee=>{const se=Mu(Ee?.name),Pe=y.has(se);return r.jsxs("div",{className:"incoming-stock__file-row",children:[r.jsxs("div",{className:"incoming-stock__file-info",children:[r.jsx("div",{style:{fontWeight:700},children:se}),r.jsxs("div",{style:{fontSize:"0.85rem",opacity:.75},children:[": ",nA(Ee.updated_at||Ee.created_at)]})]}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[Pe?r.jsx("span",{className:"incoming-stock__badge",children:""}):r.jsx("span",{className:"incoming-stock__badge incoming-stock__badge--pending",children:""}),r.jsx(le,{variant:Pe?"secondary":"primary",size:"sm",onClick:()=>$(Ee.name),disabled:!!w||Pe,children:w===se?"":Pe?"":""}),r.jsx(le,{variant:"ghost",size:"sm",style:{color:"#d32f2f",marginLeft:"4px"},onClick:()=>ot(Ee),disabled:!!w,title:"PDF",children:""})]})]},Ee.name)})}),!o&&r.jsxs("div",{style:{marginTop:"10px",fontSize:"0.85rem",opacity:.75},children:[": ",r.jsx("strong",{children:y.size}),"  / PDF: ",r.jsx("strong",{children:h.length})," "]})]}),r.jsxs(un,{className:"incoming-stock__card",children:[r.jsx("div",{className:"incoming-stock__card-head",children:r.jsx("h3",{className:"incoming-stock__section-title",children:""})}),r.jsxs("div",{className:"incoming-stock__tabs",children:[r.jsxs("button",{className:`incoming-stock__tab-button ${D==="need_order"?"incoming-stock__tab-button--active":""}`,onClick:()=>z("need_order"),children:[" ",r.jsx("span",{className:"incoming-stock__tab-count",children:Q.length})]}),Array.from(new Set((x?.items||[]).map(Ee=>Ee.vendor||""))).sort().map(Ee=>r.jsx("button",{className:`incoming-stock__tab-button ${D===Ee?"incoming-stock__tab-button--active":""}`,onClick:()=>z(Ee),children:Ee},Ee))]}),(()=>{let Ee=[];if(D==="need_order")Ee=Q;else{const se=D===""?"":D;Ee=(x?.items||[]).filter(Pe=>(Pe.vendor||"")===se)}return Ee.length===0?r.jsx("div",{style:{padding:"20px",textAlign:"center",opacity:.6},children:D==="need_order"?"0":""}):r.jsx("div",{className:"incoming-stock__table-wrap",children:r.jsxs("table",{className:"incoming-stock__table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{style:{width:"45%"},children:"/"}),r.jsx("th",{style:{width:"25%",textAlign:"right"},children:""}),r.jsx("th",{style:{width:"10%"},children:""}),r.jsx("th",{style:{width:"20%",textAlign:"center"},children:""})]})}),r.jsx("tbody",{children:Ee.map(se=>r.jsxs("tr",{style:se.isShortage?{backgroundColor:"#fff5f5"}:{},children:[r.jsxs("td",{children:[r.jsxs("div",{style:{fontWeight:500},children:[se.name,se.isShortage&&r.jsx("span",{style:{marginLeft:"8px",fontSize:"0.75rem",color:"#d32f2f",border:"1px solid #d32f2f",borderRadius:"4px",padding:"1px 4px",verticalAlign:"middle"},children:""})]}),se.reason&&r.jsxs("div",{style:{fontSize:"0.8rem",color:"#d32f2f",marginTop:"2px"},children:[se.reason,"  : ",se.toOrder,se.orderUnit]}),!se.reason&&D==="need_order"&&se.vendor&&r.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:se.vendor})]}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold",color:(se.quantity||0)<=0||se.isShortage?"#d32f2f":"inherit"},children:Number.isFinite(se.quantity)?se.quantity:"-"}),r.jsx("td",{children:se.unit||"-"}),r.jsx("td",{style:{textAlign:"center"},children:r.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[r.jsx(le,{variant:"secondary",size:"sm",onClick:()=>k(se),children:"/"}),r.jsx(le,{variant:"ghost",size:"sm",style:{color:"#d32f2f"},onClick:()=>ge(se),children:""})]})})]},`${se.vendor}@@${se.name}@@${se.unit||""}`))})]})})})()]}),r.jsx(jn,{isOpen:T,onClose:()=>U(!1),title:"",children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsx("div",{style:{fontWeight:"bold"},children:E?.name})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsxs("div",{children:[E?.quantity," ",E?.unit]})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:"0.9rem",color:"#666",marginBottom:"4px"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[r.jsx(Mt,{type:"text",inputMode:"decimal",value:A,onChange:Ee=>O(Ee.target.value),readOnly:!0,placeholder:"0",style:{width:"100%",fontSize:"1.2rem",padding:"10px",textAlign:"center",backgroundColor:"#f9f9f9",cursor:"default"}}),r.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:E?.unit})]}),r.jsxs("div",{className:"incoming-stock__calc-grid",children:[r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>L(.001),children:"+0.001"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>L(.01),children:"+0.01"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>L(.1),children:"+0.1"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>L(.5),children:"+0.5"}),r.jsx("button",{className:"incoming-stock__calc-btn",onClick:()=>L(1),children:"+1"}),r.jsx("button",{className:"incoming-stock__calc-btn incoming-stock__calc-btn--clear",onClick:()=>O(""),children:""})]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>U(!1),disabled:V,children:""}),r.jsx(le,{variant:"primary",onClick:H,disabled:V||!A,children:V?"":""})]})]})}),r.jsx(jn,{isOpen:G,onClose:()=>ce(!1),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",q?.name,"",r.jsx("br",{}),r.jsx("span",{style:{fontSize:"0.85rem",color:"#666"},children:""})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>ce(!1),disabled:ie,children:""}),r.jsx(le,{variant:"danger",onClick:Ae,disabled:ie,children:ie?"":""})]})]})}),r.jsx(jn,{isOpen:ae,onClose:()=>Se(!1),title:"PDF",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsxs("p",{style:{marginTop:0},children:["",Re?.baseName,""]}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["",r.jsx("strong",{children:""}),"",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>Se(!1),disabled:He,children:""}),r.jsx(le,{variant:"danger",onClick:Fe,disabled:He,children:He?"":""})]})]})}),r.jsx(jn,{isOpen:xe,onClose:()=>Ne(!1),title:"",size:"small",children:r.jsxs("div",{style:{lineHeight:1.6},children:[r.jsx("p",{style:{marginTop:0,fontWeight:"bold",color:"#d32f2f"},children:""}),r.jsxs("p",{style:{fontSize:"0.9rem",color:"#333"},children:["PDF",r.jsx("br",{}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>Ne(!1),disabled:de,children:""}),r.jsx(le,{variant:"danger",onClick:Ce,disabled:de,children:de?"":""})]})]})}),r.jsx(jn,{isOpen:!!w,onClose:()=>{},title:"",size:"small",showCloseButton:!1,children:r.jsxs("div",{style:{textAlign:"center",padding:"20px 0"},children:[r.jsx("div",{className:"incoming-stock__spinner"}),r.jsx("p",{style:{margin:"0 0 8px",fontWeight:"bold"},children:"PDF..."}),r.jsxs("p",{style:{fontSize:"0.85rem",color:"#666",margin:0},children:[w==="all"?"":"",r.jsx("br",{}),""]})]})})]})},iw=n=>{const{totalWeight:t,multiplier:i}=n||{};return t?`${t}g`:i&&i!==1?`x${i}`:""},sA=({recipe:n})=>{const{attributes:t,listeners:i,setNodeRef:a,transform:o,isDragging:u}=Wp({id:`recipe-${n.id}`,data:{recipe:n}}),d=u?{opacity:.35}:o?{transform:`translate3d(${o.x}px, ${o.y}px, 0)`,position:"relative",zIndex:999}:void 0;return r.jsx("div",{ref:a,style:d,...i,...t,className:"draggable-recipe",children:n.title})},iA=({meal:n,dateStr:t,children:i})=>{const{attributes:a,listeners:o,setNodeRef:u,transform:d,isDragging:f}=Wp({id:`meal-${n.id}`,data:{meal:n,dateStr:t,type:"meal"}}),h=f?{opacity:.35}:d?{transform:`translate3d(${d.x}px, ${d.y}px, 0)`,position:"relative",zIndex:999}:void 0,m=iw(n);return r.jsxs("div",{ref:u,style:h,...o,...a,className:"draggable-meal-wrapper",children:[i,m&&r.jsx("div",{style:{position:"absolute",bottom:"2px",right:"4px",fontSize:"0.75rem",fontWeight:"bold",color:"#666",backgroundColor:"rgba(255,255,255,0.8)",padding:"0 2px",borderRadius:"2px",pointerEvents:"none"},children:m})]})},aA=({dateStr:n,dayNum:t,isToday:i,isOutside:a,children:o})=>{const{setNodeRef:u,isOver:d}=dc({id:`date-${n}`,data:{dateStr:n}});return r.jsxs("div",{ref:u,className:`calendar-cell ${i?"today":""} ${a?"outside-month":""}`,style:{backgroundColor:d?"#ffe0b2":void 0},children:[r.jsx("div",{className:"day-number",children:t}),o]})},dl=n=>`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,lA=({onBack:n,onSelectRecipe:t,onNavigateToOrderList:i})=>{const{user:a}=fs(),o=Ui(),u=b.useRef(o),[d,f]=b.useState([]),[h,m]=b.useState({}),[y,v]=b.useState(new Date),[x,S]=b.useState(""),[_,N]=b.useState(!1),[w,C]=b.useState(null),[D,z]=b.useState(!1),[T,U]=b.useState(null),[E,R]=b.useState(1),[A,O]=b.useState(""),[V,P]=b.useState(null),[F,Q]=b.useState(!1),[$,I]=b.useState(dl(new Date)),[k,L]=b.useState(dl(new Date)),H=ba(dr(Al,{activationConstraint:{distance:6}}),dr(Rl,{activationConstraint:{delay:70,tolerance:8}}));b.useEffect(()=>{u.current=o},[o]);const G=b.useCallback(()=>{const Oe=Kr.consumeWarnings?.()||[];Oe.length!==0&&[...new Set(Oe)].forEach(He=>{u.current.warning(He)})},[]),ce=b.useCallback(async()=>{if(!a){f([]),m({});return}let Oe=[];try{Oe=await bn.fetchRecipes(a)}catch(He){console.error("Planner: failed to fetch recipes",He),u.current.error(""),Oe=[]}if(f(Oe),a?.id)try{let He;if(Array.isArray(Oe)&&Oe.length>0){const nt=Oe.map(ot=>ot.id);He=await Kr.cleanupInvalidPlans(a.id,nt)}else He=await Kr.getAll(a.id);m(He)}finally{G()}},[G,a]);b.useEffect(()=>{const Oe=setTimeout(()=>{ce()},0);return()=>clearTimeout(Oe)},[ce]);const q=b.useCallback(Oe=>{const He=Oe?.active;if(!He?.id){P(null);return}const nt=String(He.id);if(nt.startsWith("recipe-")){const ot=He.data.current?.recipe;P({kind:"recipe",title:ot?.title||"",qtyStr:""});return}if(nt.startsWith("meal-")){const ot=He.data.current?.meal,Fe=d.find(Ce=>Ce.id===ot?.recipeId);P({kind:"meal",title:Fe?.title||"Unknown",qtyStr:iw(ot)});return}P(null)},[d]),W=b.useCallback(()=>{P(null)},[]),ie=async Oe=>{const{active:He,over:nt}=Oe;try{if(!nt)return;if(nt.id.startsWith("date-")){const ot=nt.data.current.dateStr;if(He.id.startsWith("recipe-")){const Fe=He.data.current.recipe;U({type:"new",recipe:Fe,targetDateStr:ot}),R(1),O(""),z(!0)}else if(He.id.startsWith("meal-")){const{meal:Fe,dateStr:Ce}=He.data.current;if(Ce===ot)return;const Ee={multiplier:Fe.multiplier,totalWeight:Fe.totalWeight};await Kr.addMeal(a.id,ot,Fe.recipeId,Fe.type||"dinner",Ee),await Kr.removeMeal(a.id,Ce,Fe.id),ce()}}}finally{P(null)}},ve=async()=>{if(!T)return;const{type:Oe,recipe:He,targetDateStr:nt}=T;if(Oe==="new"){const ot={};if(He.type==="bread"){const Fe=parseFloat(A);ot.totalWeight=Number.isFinite(Fe)?Fe:null,ot.multiplier=1}else{const Fe=parseFloat(E);ot.multiplier=Number.isFinite(Fe)?Fe:1,ot.totalWeight=null}await Kr.addMeal(a.id,nt,He.id,"dinner",ot)}z(!1),U(null),ce()},xe=()=>{z(!1),U(null)},Ne=async(Oe,He,nt)=>{nt&&nt.stopPropagation(),C({dateStr:Oe,mealId:He}),N(!0)},de=async()=>{if(!w)return;const{dateStr:Oe,mealId:He}=w;N(!1),C(null);try{await Kr.removeMeal(a.id,Oe,He),await ce(),o.success("")}catch(nt){o.error(""),console.error("Delete meal error:",nt)}},K=()=>{N(!1),C(null)},ge=()=>{I(dl(new Date)),L(dl(new Date)),Q(!0)},Ae=async()=>{if(a?.id)try{await Kr.clearPeriod(a.id,$,k),await ce(),Q(!1),o.success(`${$}${k}`)}catch(Oe){console.error(Oe),o.error("")}},ae=()=>{const Oe=y.getFullYear(),He=y.getMonth(),nt=new Date(Oe,He,1),ot=new Date(Oe,He+1,0),Fe=[],Ce=nt.getDay();for(let se=Ce-1;se>=0;se--){const Pe=new Date(Oe,He,-se);Fe.push({date:Pe,isOutside:!0})}for(let se=1;se<=ot.getDate();se++){const Pe=new Date(Oe,He,se);Fe.push({date:Pe,isOutside:!1})}const Ee=42-Fe.length;for(let se=1;se<=Ee;se++){const Pe=new Date(Oe,He+1,se);Fe.push({date:Pe,isOutside:!0})}return Fe},Se=d.filter(Oe=>Oe.title.toLowerCase().includes(x.toLowerCase())),Re=Oe=>{v(new Date(y.getFullYear(),y.getMonth()+Oe,1))};return r.jsxs("div",{className:`planner-container fade-in ${V?"dragging":""}`,children:[_&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(un,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("strong",{children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(le,{variant:"ghost",onClick:K,children:""}),r.jsx(le,{variant:"danger",onClick:de,children:""})]})]})}),F&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(un,{style:{width:"90%",maxWidth:"500px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," "]}),r.jsxs("p",{style:{margin:"1rem 0",color:"#333"},children:["",r.jsx("br",{}),r.jsx("strong",{children:""})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",marginBottom:"1.5rem"},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),r.jsx(Mt,{type:"date",value:$,onChange:Oe=>I(Oe.target.value)})]}),r.jsx("span",{style:{paddingTop:"24px"},children:""}),r.jsxs("div",{style:{flex:1},children:[r.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"0.9rem",fontWeight:"bold"},children:""}),r.jsx(Mt,{type:"date",value:k,onChange:Oe=>L(Oe.target.value)})]})]}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[r.jsx(le,{variant:"ghost",onClick:()=>Q(!1),children:""}),r.jsx(le,{variant:"danger",onClick:Ae,children:""})]})]})}),D&&T&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(un,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",backgroundColor:"white"},children:[r.jsx("h3",{style:{marginTop:0},children:T.recipe.type==="bread"?"":""}),r.jsx("p",{style:{margin:"1rem 0",color:"#666"},children:T.recipe.title}),r.jsx("div",{style:{marginBottom:"1.5rem"},children:T.recipe.type==="bread"?r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:" (g)"}),r.jsx(Mt,{type:"number",value:A,onChange:Oe=>O(Oe.target.value),placeholder:": 1200",autoFocus:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:" "})]}):r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:""}),r.jsx(Mt,{type:"number",step:"0.1",value:E,onChange:Oe=>R(Oe.target.value),placeholder:": 1, 1.5, 2",autoFocus:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"4px"},children:"  (1 = )"})]})}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[r.jsx(le,{variant:"ghost",onClick:xe,children:""}),r.jsx(le,{variant:"primary",onClick:ve,children:""})]})]})}),r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions",children:[r.jsx(le,{variant:"secondary",onClick:i,style:{marginRight:"8px"},children:" "}),r.jsx(le,{variant:"danger",onClick:ge,style:{marginRight:"8px"},children:" "}),r.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsxs(Mi,{sensors:H,onDragStart:q,onDragCancel:W,onDragEnd:ie,autoScroll:!0,children:[r.jsxs("div",{className:"planner-layout",children:[r.jsxs("div",{className:"recipe-sidebar",children:[r.jsx("div",{className:"sidebar-search",children:r.jsx(Mt,{placeholder:"...",value:x,onChange:Oe=>S(Oe.target.value)})}),r.jsx("div",{className:"draggable-list",children:Se.map(Oe=>r.jsx(sA,{recipe:Oe},Oe.id))})]}),r.jsxs("div",{className:"planner-calendar",children:[r.jsxs("div",{className:"calendar-header",children:[r.jsx(le,{variant:"ghost",onClick:()=>Re(-1),children:" "}),r.jsxs("h3",{style:{margin:0},children:[y.getFullYear()," ",y.getMonth()+1,""]}),r.jsx(le,{variant:"ghost",onClick:()=>Re(1),children:" "})]}),r.jsxs("div",{className:"calendar-grid",children:[["","","","","","",""].map(Oe=>r.jsx("div",{className:"calendar-day-header",children:Oe},Oe)),ae().map((Oe,He)=>{const nt=dl(Oe.date),ot=h[nt]||[],Fe=nt===dl(new Date);return r.jsx(aA,{dateStr:nt,dayNum:Oe.date.getDate(),isToday:Fe,isOutside:Oe.isOutside,children:ot.map(Ce=>{const Ee=d.find(se=>se.id===Ce.recipeId);return r.jsx(iA,{meal:Ce,dateStr:nt,children:r.jsxs("div",{className:"planned-meal",title:Ee?.title,onClick:()=>Ee&&t&&t(Ee),children:[r.jsx("span",{children:Ee?.title||"Unknown"}),r.jsx("span",{className:"delete-meal-btn",onPointerDown:se=>{se.stopPropagation()},onClick:se=>Ne(nt,Ce.id,se),children:""})]})},Ce.id)})},He)})]})]})]}),r.jsx(Jp,{children:V?r.jsxs("div",{className:`drag-overlay-card ${V.kind==="meal"?"meal":""}`,children:[r.jsx("span",{className:"drag-overlay-title",children:V.title}),V.qtyStr&&r.jsx("span",{className:"drag-overlay-qty",children:V.qtyStr})]}):null})]})]})},oA=({onBack:n,onNavigateToPlanner:t})=>{const{user:i}=fs(),a=Ui(),[o,u]=b.useState(new Date().toISOString().slice(0,10)),[d,f]=b.useState(new Date(Date.now()+7*864e5).toISOString().slice(0,10)),[h,m]=b.useState([]),[y,v]=b.useState([]),[x,S]=b.useState(!1),[_,N]=b.useState(!1),[w,C]=b.useState(!1),[D,z]=b.useState(!1);je.useEffect(()=>{window.plannerService=Kr,window.shortageService=zp,window.recipeService=bn},[]);const T=je.useMemo(()=>{const P=new Set;return(h||[]).forEach(F=>{const Q=Jt(F?.name);P.add(Q||F?.name||"")}),P},[h]),U=je.useMemo(()=>{const P=new Map;return(h||[]).forEach(F=>{const Q=Jt(F?.name)||F?.name||"";Q&&(P.has(Q)||P.set(Q,F))}),P},[h]),E=async()=>{S(!0);try{if(!i?.id){a.error(""),S(!1);return}const P=await zp.calculateShortages(i,o,d,{includeRecipeBreakdown:!0}),F=Array.isArray(P)?P:P?.items||[],Q=Array.isArray(P)?[]:P?.recipeBreakdown||[];F.length,m(F),v(Q),N(!0)}catch(P){console.error(P),a.error(": "+(P.message||String(P)))}finally{S(!1)}},R=()=>{C(!0)},A=()=>{z(!0)},O=()=>h.map(P=>{if(Number.isFinite(P.orderPacks)&&P.orderPacks!==null){const F=P.packSize&&P.packUnit?`1${P.orderUnit}=${P.packSize}${P.packUnit}`:"";return`${P.name}: ${P.orderPacks}${P.orderUnit}${F}`}return`${P.name}: ${Number(P.toOrder||0).toFixed(1)}${P.unit}`}).join(`
`),V=async()=>{const P=document.getElementById("copy-textarea");if(P){P.select();try{await navigator.clipboard.writeText(P.value),a.success("")}catch{document.execCommand("copy"),a.success("")}}};return r.jsxs("div",{className:"order-list-container fade-in",children:[r.jsxs("div",{className:"container-header",children:[r.jsx("h2",{className:"section-title",children:" "}),r.jsxs("div",{className:"header-actions",children:[r.jsx(le,{variant:"secondary",onClick:t,style:{marginRight:"8px"},children:" "}),r.jsx(le,{variant:"ghost",onClick:n,children:" "})]})]}),r.jsx("div",{className:"filter-card",children:r.jsxs("div",{className:"date-range-inputs",children:[r.jsxs("div",{children:[r.jsx("label",{children:""}),r.jsx("input",{type:"date",value:o,onChange:P=>u(P.target.value)})]}),r.jsx("span",{children:""}),r.jsxs("div",{children:[r.jsx("label",{children:""}),r.jsx("input",{type:"date",value:d,onChange:P=>f(P.target.value)})]}),r.jsx(le,{variant:"primary",onClick:E,disabled:x,children:x?"...":""})]})}),_&&r.jsxs("div",{className:"order-results",children:[r.jsxs("div",{className:"results-header",children:[r.jsxs("h3",{children:[" (",h.length,")"]}),r.jsxs("div",{className:"result-actions",children:[r.jsx(le,{variant:"secondary",onClick:R,children:" "}),r.jsx(le,{variant:"secondary",onClick:A,children:" "})]})]}),r.jsxs("table",{className:"order-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""})]})}),r.jsx("tbody",{children:h.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:"4",style:{textAlign:"center"},children:""})}):h.map((P,F)=>r.jsxs("tr",{children:[r.jsx("td",{children:P.name}),r.jsxs("td",{style:{textAlign:"right"},children:[P.required.toFixed(1)," ",P.unit]}),r.jsxs("td",{style:{textAlign:"right"},children:[Math.max(0,P.remaining??0).toFixed(1)," ",P.unit]}),r.jsx("td",{style:{textAlign:"right",fontWeight:"bold"},children:Number.isFinite(P.orderPacks)&&P.orderPacks!==null?r.jsxs(r.Fragment,{children:[P.orderPacks,P.orderUnit,P.packSize&&P.packUnit&&r.jsxs("div",{style:{fontSize:"0.75em",fontWeight:"normal",color:"#666"},children:["1",P.orderUnit," = ",Number(P.packSize).toLocaleString(),P.packUnit,P.packPrice?` / ${Math.round(P.packPrice).toLocaleString()}`:""]})]}):r.jsxs(r.Fragment,{children:[P.toOrder.toFixed(1)," ",r.jsx("span",{style:{fontSize:"0.8em"},children:P.unit})]})})]},F))})]})]}),r.jsx(jn,{isOpen:w,onClose:()=>C(!1),title:" ",size:"medium",children:r.jsxs("div",{className:"copy-modal-content",children:[r.jsx("p",{className:"copy-instructions",children:""}),r.jsx("textarea",{id:"copy-textarea",className:"copy-textarea",readOnly:!0,value:O(),onClick:P=>P.target.select()}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(le,{variant:"primary",onClick:V,children:" "}),r.jsx(le,{variant:"ghost",onClick:()=>C(!1),children:""})]})]})}),r.jsx(jn,{isOpen:D,onClose:()=>z(!1),title:" ",size:"large",children:r.jsxs("div",{className:"print-preview-content",children:[r.jsxs("div",{className:"print-preview-header",children:[r.jsx("h3",{children:""}),r.jsxs("p",{className:"print-period",children:[": ",o,"  ",d]})]}),y.length>0&&r.jsxs("div",{className:"recipe-breakdown-print",children:[r.jsx("h4",{children:" "}),y.map((P,F)=>{const Q=(P.items||[]).filter($=>{const I=$.ingredientKey||Jt($.name)||$.name;return T.has(I)});return Q.length===0?null:r.jsxs("section",{className:"recipe-breakdown-section",children:[r.jsx("div",{className:"recipe-breakdown-section-title",children:P.recipeTitle}),r.jsxs("table",{className:"recipe-breakdown-table",children:[r.jsxs("colgroup",{children:[r.jsx("col",{className:"rb-col-name"}),r.jsx("col",{className:"rb-col-required"}),r.jsx("col",{className:"rb-col-stock"}),r.jsx("col",{className:"rb-col-spec"})]}),r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""}),r.jsx("th",{style:{textAlign:"right"},children:""})]})}),r.jsx("tbody",{children:Q.map(($,I)=>{const k=$.ingredientKey||Jt($.name)||$.name,L=U.get(k),H=L?.unit||$.unit||"",G=Math.max(0,Number(L?.remaining??0)),ce=(L?.vendor||"").trim(),q=L?.packSize&&L?.packUnit?`1${L.orderUnit||""} = ${Number(L.packSize).toLocaleString()}${L.packUnit}${L.packPrice?` / ${Math.round(L.packPrice).toLocaleString()}`:""}`:"-";return r.jsxs("tr",{children:[r.jsxs("td",{children:[$.name,ce&&r.jsxs("span",{className:"recipe-material-vendor",children:["",ce]})]}),r.jsxs("td",{style:{textAlign:"right"},children:[Number($.required||0).toFixed(1)," ",$.unit||""]}),r.jsxs("td",{style:{textAlign:"right"},children:[G.toFixed(1)," ",H]}),r.jsx("td",{style:{textAlign:"right",color:"#666",fontWeight:"normal"},children:q})]},`${$.ingredientKey||$.name||I}-${I}`)})})]})]},`${P.recipeId||P.recipeTitle||F}`)})]}),y.length===0&&r.jsx("p",{style:{margin:0,fontSize:"0.95rem",color:"#374151"},children:""}),r.jsxs("div",{className:"modal-actions",children:[r.jsx(le,{variant:"primary",onClick:()=>window.print(),children:" "}),r.jsx(le,{variant:"ghost",onClick:()=>z(!1),children:""})]})]})})]})};function cA(){const[n,t]=b.useState([]),[i,a]=b.useState({}),[o,u]=b.useState(!0),[d,f]=b.useState("all"),[h,m]=b.useState({status:"all",dateFrom:"",dateTo:""}),[y,v]=b.useState({totalCalls:0,successRate:0,totalCost:0,totalAudioSec:0,byApi:{}}),x=[{id:"all",label:""},{id:"voice",label:""},{id:"vision",label:""}];b.useEffect(()=>{_()},[h]);const S=b.useMemo(()=>n.filter(T=>{if(d==="all")return!0;if(d==="voice"){const U=T.model_name&&T.model_name.toLowerCase().includes("whisper"),E=T.endpoint&&T.endpoint.toLowerCase().includes("voice"),R=T.metadata&&T.metadata.audio_duration_sec!==void 0;return U||E||R}return d==="vision"?T.endpoint&&T.endpoint.toLowerCase().includes("analyze-image"):!0}),[n,d]);b.useEffect(()=>{w(S)},[S]);async function _(){u(!0);try{let T=_e.from("api_usage_logs").select("*").order("created_at",{ascending:!1}).limit(500);h.status!=="all"&&(T=T.eq("status",h.status)),h.dateFrom&&(T=T.gte("created_at",h.dateFrom)),h.dateTo&&(T=T.lte("created_at",h.dateTo+"T23:59:59"));const{data:U,error:E}=await T;if(E)throw E;t(U||[]),N()}catch(T){console.error(":",T),alert("")}finally{u(!1)}}async function N(){try{const T=await Di.fetchAllProfiles(),U={};Array.isArray(T)&&T.forEach(E=>{E.id&&(U[E.id]=E)}),a(U)}catch(T){console.error("Failed to fetch user profiles for logs",T)}}function w(T){const U=T.length,E=T.filter(O=>O.status==="success").length,R=T.reduce((O,V)=>O+(V.estimated_cost_jpy||0),0),A=T.filter(O=>O.metadata?.audio_duration_sec).reduce((O,V)=>O+(Number(V.metadata.audio_duration_sec)||0),0);v({totalCalls:U,successRate:U>0?(E/U*100).toFixed(1):0,totalCost:R.toFixed(2),totalAudioSec:A.toFixed(1),byApi:{}})}function C(T){return new Date(T).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function D(T){return{success:" ",error:" ",rate_limited:" "}[T]||T}async function z(){const T=[["","API","","","ID","","(ms)","/","()",""].join(",")];S.forEach(O=>{let V="";O.metadata?.audio_duration_sec?V=`${O.metadata.audio_duration_sec}s`:(O.input_tokens||O.output_tokens)&&(V=`${O.input_tokens} ${O.output_tokens}`),T.push([C(O.created_at),O.api_name,O.endpoint,O.model_name||"",O.user_id||"",O.status,O.duration_ms||"",V,O.estimated_cost_jpy||"",(O.error_message||"").replace(/,/g,"")].join(","))});const U=T.join(`
`),E=new Blob(["\uFEFF"+U],{type:"text/csv;charset=utf-8;"}),R=URL.createObjectURL(E),A=document.createElement("a");A.href=R,A.download=`api_usage_logs_${d}_${new Date().toISOString().split("T")[0]}.csv`,A.click()}return r.jsxs("div",{className:"api-usage-logs",children:[r.jsxs("div",{className:"logs-header",children:[r.jsx("h1",{children:" API"}),r.jsx("button",{onClick:z,className:"export-btn",children:" CSV"})]}),r.jsx("div",{className:"logs-tabs",children:x.map(T=>r.jsx("button",{className:`log-tab ${d===T.id?"active":""}`,onClick:()=>f(T.id),children:T.label},T.id))}),r.jsx("div",{className:"stats-grid",children:d==="voice"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.totalAudioSec,""]}),r.jsxs("div",{className:"secondary-stat",children:[(y.totalAudioSec/60).toFixed(1),""]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(y.totalCost).toLocaleString()]}),r.jsx("div",{className:"secondary-stat",children:"Whisper large-v3 turbo"})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.successRate,"%"]}),r.jsxs("div",{className:"secondary-stat",children:[y.totalCalls,""]})]})]}):d==="vision"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.totalCalls,""]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(y.totalCost).toLocaleString()]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.successRate,"%"]})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsx("div",{className:"stat-value",children:y.totalCalls.toLocaleString()})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:[y.successRate,"%"]})]}),r.jsxs("div",{className:"stat-card",children:[r.jsx("div",{className:"stat-label",children:""}),r.jsxs("div",{className:"stat-value",children:["",parseFloat(y.totalCost).toLocaleString()]})]})]})}),r.jsxs("div",{className:"filters",children:[r.jsxs("select",{value:h.status,onChange:T=>m({...h,status:T.target.value}),children:[r.jsx("option",{value:"all",children:""}),r.jsx("option",{value:"success",children:""}),r.jsx("option",{value:"error",children:""}),r.jsx("option",{value:"rate_limited",children:""})]}),r.jsx("input",{type:"date",value:h.dateFrom,onChange:T=>m({...h,dateFrom:T.target.value}),placeholder:""}),r.jsx("input",{type:"date",value:h.dateTo,onChange:T=>m({...h,dateTo:T.target.value}),placeholder:""}),r.jsx("button",{onClick:_,className:"refresh-btn",children:" "})]}),o?r.jsx("div",{className:"loading",children:"..."}):r.jsxs("div",{className:"logs-table-container",children:[r.jsxs("table",{className:"logs-table",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:""}),r.jsx("th",{children:"API"}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:""}),r.jsx("th",{children:" (/)"}),r.jsx("th",{children:""}),r.jsx("th",{children:""})]})}),r.jsx("tbody",{children:S.map(T=>r.jsxs("tr",{className:`status-${T.status}`,children:[r.jsx("td",{children:C(T.created_at)}),r.jsx("td",{children:r.jsx("span",{className:`api-badge api-${T.api_name}`,children:T.api_name})}),r.jsx("td",{children:T.endpoint}),r.jsx("td",{children:r.jsx("code",{children:T.model_name||"-"})}),r.jsx("td",{children:T.user_email||i[T.user_id]?.email||i[T.user_id]?.display_id||(T.user_id?T.user_id.substring(0,8):"-")}),r.jsx("td",{children:D(T.status)}),r.jsx("td",{children:T.duration_ms?`${T.duration_ms}ms`:"-"}),r.jsx("td",{children:T.metadata&&T.metadata.audio_duration_sec?r.jsxs("span",{className:"audio-sec",children:[" ",Number(T.metadata.audio_duration_sec).toFixed(2),"s"]}):T.input_tokens||T.output_tokens?r.jsxs("span",{className:"tokens",children:[T.input_tokens?`${T.input_tokens}`:"",T.output_tokens?` ${T.output_tokens}`:""]}):"-"}),r.jsx("td",{children:T.estimated_cost_jpy!=null&&T.estimated_cost_jpy!==""?r.jsxs("span",{className:"cost",children:["",Number(T.estimated_cost_jpy)]}):"-"}),r.jsx("td",{className:"error-cell",children:T.error_message?r.jsxs("span",{className:"error-msg",title:T.error_message,children:[T.error_message.substring(0,50),"..."]}):"-"})]},T.id))})]}),S.length===0&&r.jsx("div",{className:"no-logs",children:""})]})]})}const hl=async(n,t,i)=>{let a=null;try{const o=new Promise((u,d)=>{a=setTimeout(()=>d(new Error(`${i||"operation"} timed out after ${t}ms`)),t)});return await Promise.race([n,o])}finally{a&&clearTimeout(a)}},up=n=>{if(!n)return"";const t=n.indexOf("@");return t>0?n.slice(0,t):n},uA=({children:n})=>{const[t,i]=b.useState(null),[a,o]=b.useState(!0),[u,d]=b.useState(!1),f=b.useCallback(async w=>{if(!w){i(null);try{localStorage.removeItem("auth_user_cache")}catch{}return}const C=w.id,D=w.email||"";let z=null;try{const $=localStorage.getItem("auth_user_cache");if($){const I=JSON.parse($);I&&I.id===C&&(z=I,i(I))}}catch($){console.warn("[Auth] Failed to load cache",$)}let T=null;const U=4e3,E=2,R=async()=>{let $=0;for(;$<E;)try{const[I,k]=await Promise.all([hl(_e.from("profiles").select("id, display_id, role, show_master_recipes, email").eq("id",C).single().then(G=>({data:G,error:null})).catch(G=>({data:null,error:G})),U,"profiles.select(with_email)").catch(G=>({data:null,error:G})),hl(_e.from("profiles").select("id, display_id, role, show_master_recipes").eq("id",C).single().then(G=>({data:G,error:null})).catch(G=>({data:null,error:G})),U,"profiles.select").catch(G=>({data:null,error:G}))]);let L=null,H=null;if(I?.data?.data?L=I.data.data:k?.data?.data?L=k.data.data:H=I?.error??k?.error??new Error("Profile fetch failed"),H)if(H.code==="PGRST116"){const G=w.user_metadata?.display_id?String(w.user_metadata.display_id):up(D)||C.slice(0,8);let ce=null,q=null;const W=await hl(_e.from("profiles").insert([{id:C,display_id:G,email:D||null,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes, email").single(),6e3,"profiles.insert(with_email)");if(ce=W?.data??null,q=W?.error??null,q&&String(q.message||"").toLowerCase().includes("email")){const ie=await hl(_e.from("profiles").insert([{id:C,display_id:G,role:"user",show_master_recipes:!1}]).select("id, display_id, role, show_master_recipes").single(),6e3,"profiles.insert");ce=ie?.data??null,q=ie?.error??null}if(q)throw q;T=ce}else throw H;else T=L;if(T&&Object.prototype.hasOwnProperty.call(T,"email")&&D&&!T.email)try{await _e.from("profiles").update({email:D}).eq("id",C)}catch(G){console.warn("Failed to backfill profile email",G)}break}catch(I){console.error(`Failed to load/create profile (Attempt ${$+1}/${E}):`,I),$++,$<E&&await new Promise(k=>setTimeout(k,300*$))}return T};if(z){R().then($=>{if($){const I=(w?.user_metadata?.display_id||"").toString().trim(),k=$.display_id||I||z.displayId||up(D)||C.slice(0,8),L=String($.role||"user").trim().toLowerCase(),H=$.show_master_recipes===!0;i({id:C,email:D,displayId:k,role:L,showMasterRecipes:H});try{localStorage.setItem("auth_user_cache",JSON.stringify({id:C,email:D,displayId:k,role:L,showMasterRecipes:H}))}catch(G){console.warn("[Auth] Failed to save cache",G)}}}).catch(()=>{});return}T=await R();const A=(w?.user_metadata?.display_id||"").toString().trim(),O=T?.display_id||A||""||z?.displayId||""||up(D)||C.slice(0,8),V=T?.role||w?.app_metadata?.role||z?.role||"user",P=String(V).trim().toLowerCase(),F=T?.show_master_recipes===!0||T?.show_master_recipes==null&&z?.showMasterRecipes===!0,Q={id:C,email:D,displayId:O,role:P,showMasterRecipes:F};i(Q);try{localStorage.setItem("auth_user_cache",JSON.stringify(Q))}catch($){console.warn("[Auth] Failed to save cache",$)}},[]);b.useEffect(()=>{let w=null;typeof window<"u"&&window.location.hash&&window.location.hash.includes("type=recovery")&&d(!0);const{data:C}=_e.auth.onAuthStateChange(async(z,T)=>{z==="PASSWORD_RECOVERY"&&d(!0);try{await f(T?.user||null)}catch(U){console.error("Auth state change handler failed:",U)}});return w=C?.subscription,(async()=>{try{const{data:z}=await hl(_e.auth.getSession(),5e3,"auth.getSession");await f(z?.session?.user||null)}catch(z){console.error("Auth init failed:",z)}finally{o(!1)}})(),()=>{try{w?.unsubscribe?.()}catch{}}},[f]);const h=b.useCallback(async(w,C)=>{const{error:D}=await _e.auth.signInWithPassword({email:w,password:C});if(D)throw console.error("Login error:",D),new Error("")},[]),m=b.useCallback(async(w,C,D)=>{const{data:z,error:T}=await _e.auth.signUp({email:w,password:C,options:{data:{display_id:D}}});if(T)throw console.error("SignUp error:",T),new Error(T.message||"");const U=z?.user;if(U?.id){let E=null;E=(await _e.from("profiles").insert([{id:U.id,display_id:D,email:w||null,role:"user",show_master_recipes:!1}]))?.error??null,E&&String(E.message||"").toLowerCase().includes("email")&&(E=(await _e.from("profiles").insert([{id:U.id,display_id:D,role:"user",show_master_recipes:!1}]))?.error??null),E&&E.code!=="23505"&&console.error("Profile create error:",E)}return{needsEmailConfirmation:!z?.session}},[]),y=b.useCallback(async()=>{i(null),d(!1);try{localStorage.removeItem("auth_user_cache")}catch{}try{const{error:w}=await hl(_e.auth.signOut({scope:"local"}),3e3,"auth.signOut(local)");w&&console.warn("Logout (local scope) returned error:",w)}catch(w){console.warn("Logout (local scope) failed/timed out:",w)}},[]),v=b.useCallback(w=>{!w||typeof w!="object"||i(C=>C&&{...C,...w})},[]),x=b.useCallback(async w=>{const{error:C}=await _e.auth.resetPasswordForEmail(w,{redirectTo:window.location.origin});if(C)throw console.error("Password reset email error:",C),new Error("");return!0},[]),S=b.useCallback(async w=>{const{error:C}=await _e.auth.updateUser({password:w});if(C)throw console.error("Update password error:",C),new Error("");return!0},[]),_=b.useCallback(()=>{d(!1);try{window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}catch{}},[]),N=b.useMemo(()=>({user:t,loading:a,login:h,register:m,logout:y,patchCurrentUserProfile:v,sendPasswordResetEmail:x,isPasswordRecovery:u,updatePassword:S,finishPasswordRecovery:_}),[t,a,h,m,y,v,x,u,S,_]);return r.jsx(qb.Provider,{value:N,children:n})},dA=({id:n,message:t,type:i="info",onClose:a})=>{b.useEffect(()=>{const u=setTimeout(()=>{a(n)},3e3);return()=>clearTimeout(u)},[n,a]);const o=()=>{switch(i){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return r.jsxs("div",{className:`toast toast-${i}`,children:[r.jsx("div",{className:"toast-icon",children:o()}),r.jsx("div",{className:"toast-message",children:t}),r.jsx("button",{className:"toast-close",onClick:()=>a(n),"aria-label":"",children:""})]})},hA=({toasts:n,onRemove:t})=>n.length===0?null:r.jsx("div",{className:"toast-container",children:n.map(i=>r.jsx(dA,{id:i.id,message:i.message,type:i.type,onClose:t},i.id))}),fA=({children:n})=>{const[t,i]=b.useState([]),a=b.useCallback((d,f="info")=>{const h=Date.now()+Math.random();i(m=>[...m,{id:h,message:d,type:f}].slice(-5))},[]),o=b.useCallback(d=>{i(f=>f.filter(h=>h.id!==d))},[]),u={showToast:a,success:d=>a(d,"success"),error:d=>a(d,"error"),warning:d=>a(d,"warning"),info:d=>a(d,"info")};return r.jsxs(Fb.Provider,{value:u,children:[n,r.jsx(hA,{toasts:t,onRemove:o})]})},pA=()=>{const[n,t]=b.useState(!0),[i,a]=b.useState(!1),[o,u]=b.useState(""),[d,f]=b.useState(""),[h,m]=b.useState(""),[y,v]=b.useState(""),[x,S]=b.useState(""),[_,N]=b.useState(!1),[w,C]=b.useState(!1);je.useEffect(()=>{const A=localStorage.getItem("savedEmail"),O=localStorage.getItem("savedPassword");A&&(u(A),O&&f(O),C(!0))},[]);const{login:D,register:z,sendPasswordResetEmail:T}=fs(),U=async A=>{A.preventDefault(),v(""),S(""),N(!0);try{await D(o.trim(),d),w?(localStorage.setItem("savedEmail",o.trim()),localStorage.setItem("savedPassword",d)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword"))}catch(O){v(O.message||"")}finally{N(!1)}},E=async A=>{A.preventDefault(),v(""),S(""),N(!0);try{if(!h.trim()){v("ID: yoshito");return}(await z(o.trim(),d,h.trim()))?.needsEmailConfirmation?S(""):S(""),t(!0),f("")}catch(O){v(O.message||"")}finally{N(!1)}},R=async A=>{A.preventDefault(),v(""),S(""),N(!0);try{await T(o.trim()),S(""),a(!1)}catch(O){v(O.message||"")}finally{N(!1)}};return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:r.jsxs(un,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[r.jsxs("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[r.jsxs("h1",{style:{fontFamily:'"Pinyon Script", cursive',fontSize:"3rem",margin:0,color:"var(--color-primary)"},children:["Recipe",r.jsx("br",{}),"Management"]}),r.jsx("p",{style:{color:"#666",marginTop:"0.5rem"},children:i?"":n?"":""})]}),y&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:y}),x&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:x}),r.jsxs("form",{onSubmit:i?R:n?U:E,children:[r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"email",value:o,onChange:A=>u(A.target.value),placeholder:"name@example.com",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!i&&r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:d,onChange:A=>f(A.target.value),placeholder:"",autoComplete:"current-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),!i&&!n&&r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsxs("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:["ID ",r.jsx("span",{style:{fontSize:"0.85em",fontWeight:"normal",color:"#666"},children:"(: yoshito / staff)"})]}),r.jsx("input",{type:"text",value:h,onChange:A=>m(A.target.value),placeholder:"ID",autoComplete:"username",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0}),r.jsx("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"6px",lineHeight:1.4},children:"//"})]}),n&&!i&&r.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"1rem"},children:[r.jsx("input",{type:"checkbox",id:"rememberMe",checked:w,onChange:A=>C(A.target.checked),style:{marginRight:"8px",width:"auto",cursor:"pointer"}}),r.jsx("label",{htmlFor:"rememberMe",style:{color:"#333",cursor:"pointer",userSelect:"none"},children:""})]}),r.jsx(le,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:_,children:i?"":n?"":""})]}),r.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i?r.jsx("button",{type:"button",onClick:()=>{a(!1),v(""),S("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}):r.jsx("button",{type:"button",onClick:()=>{a(!0),v(""),S("")},style:{background:"none",border:"none",color:"#666",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:""}),!i&&r.jsx("button",{type:"button",onClick:()=>{t(!n),v(""),S("")},style:{background:"none",border:"none",color:"var(--color-primary)",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem"},children:n?"":""})]})]})})},mA=()=>{const{updatePassword:n,finishPasswordRecovery:t,logout:i}=fs(),[a,o]=je.useState(""),[u,d]=je.useState(""),[f,h]=je.useState(""),[m,y]=je.useState(""),[v,x]=je.useState(!1),S=async _=>{if(_.preventDefault(),h(""),y(""),!a||a.length<8){h("8");return}if(a!==u){h("");return}x(!0);try{await n(a),y(""),t()}catch(N){console.error(N),h(N.message||"")}finally{x(!1)}};return r.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#353535",padding:"20px"},children:r.jsxs(un,{style:{width:"100%",maxWidth:"420px",padding:"2rem",backgroundColor:"white",color:"#333"},children:[r.jsx("h2",{style:{textAlign:"center",color:"var(--color-primary)",marginBottom:"1rem"},children:""}),r.jsx("p",{style:{color:"#666",fontSize:"0.9rem",lineHeight:1.5,marginTop:0},children:""}),f&&r.jsx("div",{style:{backgroundColor:"#ffebee",color:"#c62828",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:f}),m&&r.jsx("div",{style:{backgroundColor:"#e8f5e9",color:"#2e7d32",padding:"10px",borderRadius:"4px",marginBottom:"1rem",fontSize:"0.9rem"},children:m}),r.jsxs("form",{onSubmit:S,children:[r.jsxs("div",{style:{marginBottom:"1rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:a,onChange:_=>o(_.target.value),placeholder:"8",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),r.jsxs("div",{style:{marginBottom:"1.5rem"},children:[r.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold",color:"#333"},children:""}),r.jsx("input",{type:"password",value:u,onChange:_=>d(_.target.value),placeholder:"",autoComplete:"new-password",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid #ddd",fontSize:"1rem",color:"#333",backgroundColor:"#fff"},required:!0})]}),r.jsx(le,{type:"submit",variant:"primary",style:{width:"100%",padding:"12px",fontSize:"1.05rem"},disabled:v,children:""})]}),r.jsxs("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",gap:"10px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>{t()},style:{flex:1},children:""}),r.jsx(le,{variant:"ghost",onClick:i,style:{flex:1},children:""})]})]})})},dp=({label:n,subLabel:t,variant:i="screen",showLogo:a=!0})=>r.jsxs("div",{className:i==="screen"?"loading-screen":"loading-inline",children:[a&&r.jsx("img",{className:"loading-logo",src:"/app/header-logo.png",alt:"Recipe management"}),r.jsxs("div",{className:"loading-text",children:[n,r.jsxs("span",{className:"loading-dots","aria-hidden":"true",children:[r.jsx("span",{children:"."}),r.jsx("span",{children:"."}),r.jsx("span",{children:"."})]})]}),r.jsx("div",{className:"loading-spinner","aria-hidden":"true"}),t&&r.jsx("div",{className:"loading-subtext",children:t})]}),gA=24,yA=120,vA=64,xA=180,zu="__NO_STORE__",Lu="__OTHER_STORE__",bA=(n,t)=>{const i=new Set((n||[]).map(o=>String(o.id))),a=[...n||[]];for(const o of t||[]){const u=String(o.id);i.has(u)||(i.add(u),a.push(o))}return a},Lp=n=>(n||"").toString().replace(/\s+/g," ").trim(),Rr=n=>Lp(n).toLowerCase(),C0=new Set(td.map(n=>Rr(n)).filter(Boolean));function wA(){const{user:n,logout:t,loading:i,isPasswordRecovery:a}=fs(),o=Ui(),[u,d]=ac(),[f,h]=b.useState([]),[m,y]=b.useState(!0),[v,x]=b.useState(0),[S,_]=b.useState([]),[N,w]=b.useState(!1),[C,D]=b.useState({}),[z,T]=b.useState({}),[U,E]=b.useState(!1),R=b.useRef(0),A=u.get("view"),O=(A==="create-mock"?"create":A)||"list",V=u.get("id"),P=f.find(te=>String(te.id)===V)||null,[F,Q]=b.useState(null),[$,I]=b.useState(!1),[k,L]=b.useState(""),[H,G]=b.useState(null),[ce,q]=b.useState(null),[W,ie]=b.useState(""),[ve,xe]=b.useState("none"),[Ne,de]=b.useState(!1),[K,ge]=b.useState(!1),[Ae,ae]=b.useState(new Set),[Se,Re]=b.useState("normal"),[Oe,He]=b.useState(!1),[nt,ot]=b.useState(!1),[Fe,Ce]=b.useState(null),[Ee,se]=b.useState(()=>typeof window>"u"?!1:window.matchMedia?.("(max-width: 700px)")?.matches??!1),Pe={inventory:"","incoming-deliveries":"PDF","incoming-stock":"",planner:"",data:"",users:"","order-list":""};b.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const te=window.matchMedia("(max-width: 700px)"),$e=()=>se(!!te.matches);return $e(),te.addEventListener?te.addEventListener("change",$e):te.addListener($e),()=>{te.removeEventListener?te.removeEventListener("change",$e):te.removeListener($e)}},[]),b.useEffect(()=>{if(!Ee||!Pe[O]||typeof window>"u")return;const te=`pc-recommend-shown:${O}`;try{if(window.sessionStorage.getItem(te)==="1")return;window.sessionStorage.setItem(te,"1")}catch{}Ce(O)},[O,Ee]),b.useEffect(()=>{O!=="list"&&xe("none")},[O]),b.useEffect(()=>{if(typeof document>"u"||!Ne)return;const te=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=te}},[Ne]),b.useEffect(()=>{if(!i){w(!1);return}const te=setTimeout(()=>w(!0),3500);return()=>clearTimeout(te)},[i]),b.useEffect(()=>{if(f.length>0||O==="trash")return;let te=n?.id;if(!te)try{te=JSON.parse(localStorage.getItem("auth_user_cache")||"null")?.id}catch{}if(!te)return;const $e=bn.getCachedRecipes(te);$e&&$e.length>0&&(h($e),E(!0),y(!1))},[n?.id]),b.useEffect(()=>{i||n&&(tt(),Qe())},[i,n?.id]),b.useEffect(()=>{if(i)return;if(!n||n.role!=="admin"){D({}),T({});return}let te=!1;return(async()=>{try{const $e=await Di.fetchAllProfiles();if(te)return;const Ge={},Et={};for(const J of $e||[])J?.id&&(Ge[String(J.id)]=J),J?.display_id&&(Et[String(J.display_id)]=J);D(Ge),T(Et)}catch($e){console.warn("Failed to load profiles for admin owner labels",$e)}})(),()=>{te=!0}},[i,n?.id,n?.role]);const dt=te=>{const Ge=(te?.tags||[]).find(Z=>Z&&Z.startsWith("owner:"));if(!Ge)return"/";const Et=String(Ge.slice(6)),J=C[Et]||z[Et]||null;return J?J.display_id||J.email||Et:Et.length>12?`${Et.slice(0,8)}`:Et},gt=ba(dr(Al,{activationConstraint:{distance:10}}),dr(Rl,{activationConstraint:{delay:1e3,tolerance:5}}),dr(Tl,{coordinateGetter:gd})),ct=te=>{const{active:$e,over:Ge}=te;$e.id!==Ge.id&&h(Et=>{const J=Et.findIndex(Le=>Le.id===$e.id),Z=Et.findIndex(Le=>Le.id===Ge.id);if(J===-1||Z===-1)return Et;const oe=Li(Et,J,Z),fe=oe.map((Le,qe)=>({id:Le.id,order_index:qe}));return bn.updateOrder(fe).catch(Le=>console.error("Order update failed",Le)),oe})},Qe=async()=>{try{const te=await bn.fetchRecentRecipes();_(te||[])}catch(te){console.error("Failed to load history:",te)}},it=async te=>{const $e=[te,...S.filter(Ge=>Ge!==te)].slice(0,20);_($e);try{await bn.addToHistory(te)}catch(Ge){console.error("Failed to sync history",Ge)}},tt=async()=>{try{const te=await bn.getDeletedCount();x(te||0)}catch(te){console.error("Failed to load trash count:",te)}},ut=async()=>{if(!n)return;const te=R.current+1;R.current=te;const $e=()=>R.current!==te,Ge=Ee?gA:yA,Et=Ee?vA:xA;try{U||y(!0);const J=await bn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:0,limit:Ge,skipCacheSave:!0,returnMeta:!0});if($e())return;let Z=J?.recipes||[],oe=J?.hasMoreRaw===!0,fe=Ge;h(Z);let Le=!1;for(!U&&(Z.length>0||!oe)&&(y(!1),Le=!0);oe;){const qe=await bn.fetchRecipes(n,{timeoutMs:12e3,includeIngredients:!1,includeSources:!1,offset:fe,limit:Et,skipCacheSave:!0,returnMeta:!0});if($e())return;const Ze=qe?.recipes||[];if(Ze.length>0&&(Z=bA(Z,Ze),h(Z),!U&&!Le&&(y(!1),Le=!0)),fe+=Et,oe=qe?.hasMoreRaw===!0,Ze.length===0&&!oe)break}if($e())return;bn.saveCachedRecipes(Z,n.id)}catch(J){if($e())return;console.error("Failed to fetch recipes:",J),o.error(`

(${J?.message||"unknown error"})`)}finally{$e()||(y(!1),E(!1))}},{allCourses:qt,allCategories:$t,storeCounts:an,noStoreCount:Ht,otherStoreCount:rn,courseCounts:sn,categoryCounts:Kt}=b.useMemo(()=>{const te=[...new Set(f.map(fe=>Lp(fe.course)).filter(Boolean))],$e=[...new Set(f.map(fe=>Lp(fe.category)).filter(Boolean))],Ge=f.reduce((fe,Le)=>{const qe=Rr(Le.storeName);return qe&&(fe[qe]=(fe[qe]||0)+1),fe},{}),Et=f.reduce((fe,Le)=>Rr(Le.storeName)?fe:fe+1,0),J=f.reduce((fe,Le)=>{const qe=Rr(Le.storeName);return qe?C0.has(qe)?fe:fe+1:fe},0),Z=f.reduce((fe,Le)=>{const qe=Rr(Le.course);return qe&&(fe[qe]=(fe[qe]||0)+1),fe},{}),oe=f.reduce((fe,Le)=>{const qe=Rr(Le.category);return qe&&(fe[qe]=(fe[qe]||0)+1),fe},{});return{allCourses:te,allCategories:$e,storeCounts:Ge,noStoreCount:Et,otherStoreCount:J,courseCounts:Z,categoryCounts:oe}},[f]),In=b.useMemo(()=>{const te=Rr(k),$e=W.toLowerCase().trim();return f.filter(Ge=>{const Et=Rr(Ge.storeName);return k===""||k==="recent"&&S.includes(Ge.id)||Ge.tags&&Ge.tags.includes(k)||k===zu&&!Et||k===Lu&&Et&&!C0.has(Et)||Ge.category&&Rr(Ge.category)===te||Ge.course&&Rr(Ge.course)===te||Ge.storeName&&Et===te?$e?(Ge.title||"").toLowerCase().includes($e)||Ge.description&&Ge.description.toLowerCase().includes($e)||Array.isArray(Ge.ingredients)&&Ge.ingredients.some(Z=>(Z?.name||"").toLowerCase().includes($e)):!0:!1})},[f,k,S,W]),mn=k===""&&!W.trim()&&O==="list",ee=(te,$e={})=>{d({view:"detail",id:te.id,...$e})},De=async(te,$e=!1)=>{try{if(te.tags&&n.role!=="admin"&&n.displayId!=="yoshito"&&te.tags.some(Et=>Et==="owner:yoshito")){o.warning("");return}$e?(await bn.restoreRecipe(te.id),(O==="trash"||O==="detail")&&(d({view:"trash"}),Ie()),o.success("")):(await bn.deleteRecipe(te.id),h(f.filter(Ge=>Ge.id!==te.id)),d({view:"list"}),tt())}catch(Ge){console.error("Failed to delete/restore recipe:",Ge),o.error("")}finally{tt()}},ke=async te=>{try{await bn.hardDeleteRecipe(te.id),h(f.filter($e=>$e.id!==te.id)),d({view:"trash"}),o.success(""),Ie(),tt()}catch($e){console.error("Failed to hard delete recipe:",$e),o.error("")}},Ie=async()=>{try{R.current+=1,y(!0);const te=await bn.fetchDeletedRecipes();h(te||[]),L("")}catch(te){console.error("Failed to fetch deleted recipes:",te)}finally{y(!1)}},Ve=()=>{d({view:"trash"})},lt=()=>{d({view:"list"})},bt=async()=>{de(!1);try{await t()}catch(te){console.error("Logout failed:",te),o.warning("")}},Lt=async(te,$e)=>{try{let Ge,Et=$e;if($e&&n.role!=="admin"){const J=te.tags?.find(oe=>oe.startsWith("owner:"));J===`owner:${n.id}`||n.displayId&&J===`owner:${n.displayId}`||(console.log(`Editing Recipe (Owner Tag: ${J||"None"}) as ${n.id}. Not the owner. Switching to Create mode (Copy).`),Et=!1)}Et?(Ge=await bn.updateRecipe(te,n),h(f.map(J=>J.id===Ge.id?Ge:J))):(Ge=await bn.createRecipe(te,n),h([Ge,...f])),d(Et?{view:"detail",id:Ge.id}:{view:"detail",id:Ge.id})}catch(Ge){console.error("Failed to save recipe:",Ge),o.error(`
: ${Ge.message||Ge.error_description||JSON.stringify(Ge)}`)}};b.useEffect(()=>{let te=!1;return(async()=>{if(O!=="edit"||!V){Q(null),I(!1);return}I(!0);try{const Ge=await bn.getRecipe(V);if(te)return;Q(Ge)}catch(Ge){if(console.error("Failed to load edit recipe details",Ge),te)return;Q(P),o.warning("")}finally{te||I(!1)}})(),()=>{te=!0}},[O,V]);const Pt=(te,$e="")=>{try{te.__importId=globalThis.crypto&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}_${Math.random().toString(16).slice(2)}`}catch{te.__importId=`${Date.now()}_${Math.random().toString(16).slice(2)}`}const Ge=["","baker","","","","dough","fermentation"],Et=te.title||te.name||"",J=Ge.some(Xe=>Et.toLowerCase().includes(Xe)),Z=["flour","","","","","","","","",""],oe=["yeast","","",""],fe=te.ingredients||[],Le=fe.some(Xe=>oe.some(Ct=>(Xe.name||"").toLowerCase().includes(Ct))),qe=fe.some(Xe=>Z.some(Ct=>(Xe.name||"").toLowerCase().includes(Ct))&&!Xe.name.includes(""));if(fe.some(Xe=>Xe.quantity&&String(Xe.quantity).includes("%")||Xe.unit&&String(Xe.unit).includes("%"))||Le||J&&qe){te.type="bread",te.flours=[],te.breadIngredients=[];const Xe=["flour","","","","","","","",""];if(fe.forEach(Ct=>{Xe.some(It=>(Ct.name||"").includes(It))?te.flours.push(Ct):te.breadIngredients.push(Ct)}),te.flours.length===0&&fe.length>0){const Ct=fe[0];(Ct.name||"").includes("")&&(te.flours.push(Ct),te.breadIngredients=te.breadIngredients.filter(Nt=>Nt!==Ct))}}te.sourceUrl=$e,$e&&(te.category="URL"),q(te),d({view:"create"})},hn=()=>{ge(!K),ae(new Set)},he=te=>{const $e=new Set(Ae);$e.has(te)?$e.delete(te):$e.add(te),ae($e)},Ye=()=>{He(!0)},ht=()=>{He(!1)},We=async()=>{He(!1);try{y(!0),O==="trash"?(await Promise.all(Array.from(Ae).map(te=>bn.hardDeleteRecipe(te))),Ie()):(await Promise.all(Array.from(Ae).map(te=>bn.deleteRecipe(te))),h(f.filter(te=>!Ae.has(te.id))),tt()),ae(new Set),ge(!1),o.success("")}catch(te){console.error("Bulk delete failed",te),o.warning(""),O==="trash"?Ie():ut()}finally{y(!1)}},At=()=>{Ae.size!==0&&ot(!0)},jt=()=>{ot(!1)},Dt=async()=>{ot(!1);try{y(!0);for(const te of Ae)await bn.restoreRecipe(te);h(f.filter(te=>!Ae.has(te.id))),tt(),ge(!1),ae(new Set),o.success(""),Ie()}catch(te){console.error("Bulk restore failed",te),o.warning(""),Ie()}finally{y(!1)}},Vt=()=>{const te=In.map($e=>$e.id);ae(new Set(te))},pt=te=>{h([te,...f]),d({view:"edit",id:te.id})};if(b.useEffect(()=>{i||n&&(O==="trash"?Ie():O==="list"&&ut())},[O,i,n?.id]),i&&!N){let te=!1;try{const $e=JSON.parse(localStorage.getItem("auth_user_cache")||"null");$e?.id&&(te=!!bn.getCachedRecipes($e.id))}catch{}if(!te)return r.jsx(dp,{label:"",subLabel:""})}return n?a?r.jsx(mA,{}):r.jsxs(D_,{children:[Oe&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(un,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid var(--color-danger)",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#dc3545",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," ",Ae.size,"",O==="trash"?"":""]}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:O==="trash"?"":""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(le,{variant:"ghost",onClick:ht,children:""}),r.jsx(le,{variant:"danger",onClick:We,children:O==="trash"?"":""})]})]})}),nt&&r.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsxs(un,{style:{width:"90%",maxWidth:"400px",padding:"1.5rem",border:"2px solid #2f9e44",backgroundColor:"white"},children:[r.jsxs("h3",{style:{marginTop:0,color:"#2f9e44",display:"flex",alignItems:"center",gap:"8px"},children:[r.jsx("span",{children:""})," ",Ae.size,""]}),r.jsx("p",{style:{margin:"1rem 0",color:"#333"},children:""}),r.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[r.jsx(le,{variant:"ghost",onClick:jt,children:""}),r.jsx(le,{variant:"secondary",onClick:Dt,style:{backgroundColor:"#2f9e44",color:"white",border:"none"},children:""})]})]})}),r.jsx(jn,{isOpen:!!Fe,onClose:()=>Ce(null),title:"PC",size:"small",children:r.jsxs("div",{style:{color:"#333",lineHeight:1.6},children:[r.jsx("p",{style:{marginTop:0},children:Pe[Fe]?r.jsxs(r.Fragment,{children:["",r.jsx("strong",{children:Pe[Fe]}),"/"]}):r.jsx(r.Fragment,{children:"/"})}),r.jsxs("p",{style:{marginBottom:0},children:["",r.jsx("strong",{children:"PC"}),""]}),r.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"18px"},children:[r.jsx(le,{variant:"ghost",onClick:()=>{Ce(null),d({view:"list"})},children:""}),r.jsx(le,{variant:"primary",onClick:()=>Ce(null),children:"OK"})]})]})}),(O==="list"||O==="trash")&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"container-header",children:[r.jsxs("h2",{className:"section-title",children:[O==="trash"?" ()":"",O==="list"&&r.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666",fontWeight:"normal"},children:["(",f.length,")"]})]}),r.jsx("div",{className:"header-actions",children:O==="list"||O==="trash"?r.jsxs(r.Fragment,{children:[K?r.jsxs(r.Fragment,{children:[r.jsx(le,{variant:"ghost",onClick:hn,children:""}),r.jsx(le,{variant:"secondary",onClick:Vt,children:""}),O==="trash"&&r.jsxs(le,{variant:"secondary",onClick:At,disabled:Ae.size===0,style:{marginRight:"8px",backgroundColor:"#4CAF50",color:"white",border:"none"},children:[" (",Ae.size,")"]}),r.jsxs(le,{variant:"danger",onClick:Ye,disabled:Ae.size===0,children:[O==="trash"?"":""," (",Ae.size,")"]})]}):r.jsx(r.Fragment,{children:O==="list"?r.jsx(r.Fragment,{children:r.jsx(le,{onClick:()=>{q(null),d({view:"create"})},className:"primary-action-btn",children:"+ "})}):r.jsx(le,{variant:"ghost",onClick:lt,children:" "})}),r.jsx("button",{className:"mobile-menu-toggle",onClick:()=>de(!Ne),"aria-label":"",children:""}),r.jsxs("div",{className:`secondary-actions ${Ne?"open":""}`,children:[r.jsx("button",{type:"button",className:"slide-menu-close",onClick:()=>de(!1),"aria-label":"",children:""}),r.jsxs("div",{className:"secondary-actions-content",children:[r.jsxs("div",{className:"slide-menu-user",style:{marginBottom:"1rem",padding:"10px 12px",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.15)",color:"white",fontSize:"0.9rem",lineHeight:1.4},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"10px"},children:[r.jsxs("div",{style:{fontWeight:"bold"},children:[": ",n?.displayId||n?.email||(n?.id?`${String(n.id).slice(0,8)}`:"---")]}),n?.role==="admin"&&r.jsx("span",{style:{fontSize:"0.75rem",padding:"2px 8px",borderRadius:"999px",background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.25)",whiteSpace:"nowrap"},children:""})]}),n?.email&&n?.displayId&&r.jsx("div",{style:{opacity:.85,fontSize:"0.8rem",marginTop:"4px",wordBreak:"break-all"},children:n.email})]}),r.jsxs(le,{variant:"secondary",onClick:()=>{window.open("/app/recipe.html","_blank","noopener,noreferrer"),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," Q&A"]}),r.jsxs(le,{variant:"secondary",onClick:()=>{window.open("/app/recipe_management.pdf","_blank","noopener,noreferrer"),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),O==="list"&&r.jsxs(r.Fragment,{children:[r.jsxs(le,{variant:"secondary",onClick:()=>{G("url"),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," Web"]}),r.jsxs(le,{variant:"secondary",onClick:()=>{G("image"),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsx("div",{className:"pc-recommend-note",children:r.jsx("div",{className:"pc-recommend-note__title",children:"PC"})}),r.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"inventory"}),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"incoming-deliveries"}),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," PDF"]}),r.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"incoming-stock"}),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"planner"}),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"order-list"}),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"data"}),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),n?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"users"}),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsxs(le,{variant:"secondary",onClick:()=>{d({view:"api-logs"}),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," API"]})]}),r.jsx("div",{className:"menu-divider"})]}),!K&&r.jsxs(le,{variant:"ghost",onClick:()=>{hn(),de(!1)},className:"danger-text",children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," ",O==="trash"?"":""]}),O==="list"&&r.jsxs(le,{variant:"ghost",onClick:()=>{Ve(),de(!1)},style:{position:"relative"},children:[r.jsx("span",{style:{marginRight:"8px"},children:""}),"  ",v>0&&r.jsx("span",{className:"trash-badge",children:v})]}),r.jsxs(le,{variant:"ghost",onClick:()=>{lt(),de(!1)},children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]}),r.jsx("div",{className:"menu-divider"}),r.jsxs(le,{variant:"ghost",onClick:bt,children:[r.jsx("span",{style:{marginRight:"8px"},children:""})," "]})]})]}),r.jsx("div",{className:`menu-backdrop ${Ne?"open":""}`,onClick:()=>de(!1),"aria-hidden":"true"})]}):null})]}),O==="list"&&r.jsxs("div",{className:"list-toolbar",children:[r.jsxs("div",{className:"search-container search-container--compact",children:[r.jsx("span",{className:"search-icon",children:""}),r.jsx("input",{type:"text",className:"search-input",placeholder:"...",value:W,onChange:te=>ie(te.target.value)})]}),r.jsxs("div",{className:"public-recipe-toggles",children:[r.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${ve==="mine"?"active":""}`,"aria-pressed":ve==="mine",onClick:()=>xe("mine"),children:" "}),r.jsx("button",{type:"button",className:`public-recipe-toggle-btn ${ve==="others"?"active":""}`,"aria-pressed":ve==="others",onClick:()=>xe("others"),children:" "}),ve!=="none"&&r.jsx("button",{type:"button",className:"public-recipe-toggle-btn public-recipe-toggle-btn--hide",onClick:()=>xe("none"),children:" "})]})]}),r.jsxs("div",{className:"tag-filter-container",children:[r.jsxs("select",{className:"store-filter-select",value:k===zu?zu:k===Lu?Lu:td.includes(k)?k:"",onChange:te=>L(te.target.value||""),children:[r.jsx("option",{value:"",children:""}),td.map(te=>r.jsxs("option",{value:te,children:[te," (",an[Rr(te)]||0,")"]},te)),r.jsxs("option",{value:zu,children:[" (",Ht,")"]}),r.jsxs("option",{value:Lu,children:[" (",rn,")"]})]}),r.jsxs("select",{className:"store-filter-select",value:qt.includes(k)?k:"",onChange:te=>L(te.target.value||""),children:[r.jsx("option",{value:"",children:""}),qt.sort().map(te=>r.jsxs("option",{value:te,children:[te," (",sn[Rr(te)]||0,")"]},te))]}),r.jsxs("select",{className:"store-filter-select",value:$t.includes(k)?k:"",onChange:te=>L(te.target.value||""),children:[r.jsx("option",{value:"",children:""}),$t.sort().map(te=>r.jsxs("option",{value:te,children:[te," (",Kt[Rr(te)]||0,")"]},te))]}),r.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"16px",display:"flex",gap:"8px",borderLeft:"1px solid #ccc",paddingLeft:"16px"},children:[r.jsx("button",{className:`tag-filter-btn ${Se==="normal"?"active":""}`,onClick:()=>Re("normal"),style:{minWidth:"auto",padding:"4px 12px"},children:""}),r.jsx("button",{className:`tag-filter-btn ${Se==="all"?"active":""}`,onClick:()=>Re("all"),style:{minWidth:"auto",padding:"4px 12px"},children:""})]})]}),m?r.jsx(dp,{label:U?"":"",subLabel:U?void 0:"",variant:"inline",showLogo:!1}):f.length===0?r.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#888"},children:[O==="trash"?"":"",k!==""&&r.jsx("p",{children:""})]}):r.jsxs("div",{className:"main-content-wrapper",children:[O==="list"&&r.jsx("div",{className:"recent-list-wrapper",children:r.jsx(uT,{recipes:f,recentIds:S,onSelect:ee})}),r.jsx("div",{className:"recipe-list-container",children:O==="list"?r.jsx(Mi,{sensors:gt,collisionDetection:Wu,onDragEnd:ct,children:r.jsx(gx,{recipes:In,onSelectRecipe:ee,isSelectMode:K,selectedIds:Ae,onToggleSelection:he,disableDrag:!mn,displayMode:Se,publicRecipeView:ve,showOwner:n?.role==="admin",ownerLabelFn:dt,currentUser:n})}):r.jsx(gx,{recipes:In,onSelectRecipe:ee,isSelectMode:K,selectedIds:Ae,onToggleSelection:he,disableDrag:!0,displayMode:Se,publicRecipeView:ve,showOwner:n?.role==="admin",ownerLabelFn:dt,currentUser:n})})]})]}),O==="detail"&&P&&r.jsx(Ck,{recipe:P,ownerLabel:n?.role==="admin"?dt(P):void 0,isDeleted:!!P.deletedAt,onBack:()=>{u.get("from")==="planner"?d({view:"planner"}):P.deletedAt?Ve():lt()},backLabel:u.get("from")==="planner"?" ":void 0,onList:u.get("from")==="planner"?lt:void 0,onEdit:()=>d({view:"edit",id:P.id,from:u.get("from")}),onDelete:De,onView:it,onHardDelete:ke,onDuplicate:pt}),O==="edit"&&V&&($?r.jsx(dp,{label:"",subLabel:"URL"}):F&&r.jsx(d0,{initialData:F,onCancel:()=>d({view:"detail",id:V}),onSave:te=>Lt(te,!0)},`edit-${V}`)),O==="create"&&r.jsx(d0,{initialData:ce,onCancel:()=>{d({view:"list"}),q(null)},onSave:te=>Lt(te,!1)},ce?.__importId?`create-form-imported-${ce.__importId}`:"create-form"),H&&r.jsx(tw,{initialMode:H,onClose:()=>G(null),onImport:Pt}),(O==="data"||O==="data-management")&&r.jsx(cT,{onBack:()=>d({view:"list"})}),O==="levain-guide"&&r.jsx(dT,{onBack:()=>d({view:"list"})}),O==="users"&&n?.role==="admin"&&r.jsx(hT,{onBack:()=>d({view:"list"})}),O==="inventory"&&r.jsx(yT,{onBack:()=>d({view:"list"})}),O==="incoming-deliveries"&&r.jsx(AT,{onBack:()=>d({view:"list"})}),O==="incoming-stock"&&r.jsx(rA,{onBack:()=>d({view:"list"})}),O==="planner"&&r.jsx(lA,{onBack:()=>d({view:"list"}),onSelectRecipe:te=>ee(te,{from:"planner"}),onNavigateToOrderList:()=>d({view:"order-list"})}),O==="order-list"&&r.jsx(oA,{onBack:()=>d({view:"list"}),onNavigateToPlanner:()=>d({view:"planner"})}),O==="api-logs"&&n?.role==="admin"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{padding:"20px 20px 0",textAlign:"left"},children:r.jsx(le,{onClick:()=>d({view:"list"}),children:" "})}),r.jsx(cA,{}),r.jsx("div",{style:{padding:"20px",textAlign:"center"},children:r.jsx(le,{onClick:()=>d({view:"list"}),children:" "})})]})]}):r.jsx(pA,{})}function SA(){return r.jsx(fA,{children:r.jsx(uA,{children:r.jsx(wA,{})})})}class jA extends je.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,i){console.error("Uncaught error:",t,i),this.setState({error:t,errorInfo:i})}render(){return this.state.hasError?r.jsxs("div",{style:{padding:"2rem",color:"red"},children:[r.jsx("h1",{children:""}),r.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),r.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),r.jsx("br",{}),r.jsx("button",{onClick:()=>window.location.reload(),children:""})]}):this.props.children}}nj.createRoot(document.getElementById("root")).render(r.jsx(b.StrictMode,{children:r.jsx(jA,{children:r.jsx(j_,{children:r.jsx(SA,{})})})}));export{N0 as a,_A as c,CA as g};
